var hello={sayHello:()=>{spEvent("START")}};!function(){var a;function Z(t,e){var i=function(){return i.method.apply(i.scope,arguments)};return i.scope=t,i.method=e,i}window.js=js={_Boot:{}},window.zpp_nape=zpp_nape={shape:{},constraint:{},geom:{},phys:{},dynamics:{},callbacks:{},util:{},space:{}},window.sandbox=sandbox={},window.nape=nape={shape:{},constraint:{},geom:{},phys:{},dynamics:{},callbacks:{},space:{},util:{}};var l=function(){};l.__name__=["Reflect"],l.field=function(t,e){try{return t[e]}catch(t){return null}},l.fields=function(t){var e=[];if(null!=t){var i,n=Object.prototype.hasOwnProperty;for(i in t)"__id__"!=i&&"hx__closures__"!=i&&n.call(t,i)&&e.push(i)}return e},l.copy=function(t){for(var e={},i=0,n=l.fields(t);i<n.length;){var r=n[i];++i,e[r]=l.field(t,r)}return e},l.prototype.__class__=l;var n=function(){};n.__name__=["Std"],n.string=function(t){return F.__string_rec(t,"")},n.prototype.__class__=n;var t=function(){};t.__name__=["StringTools"],t.hex=function(t,e){for(var i="";i="0123456789ABCDEF".charAt(15&t)+i,0<(t>>>=4););if(null!=e)for(;i.length<e;)i="0"+i;return i},t.prototype.__class__=t;var r=js._Boot.HaxeError=function(t){Error.call(this),this.val=t,this.message=String(t),Error.captureStackTrace&&Error.captureStackTrace(this,r)};r.__name__=["js","_Boot","HaxeError"],r.__super__=Error,r.prototype=Object.create(Error.prototype),r.wrap=function(t){return t instanceof Error?t:new r(t)},r.prototype.val=null,r.prototype.__class__=r;var F=js.Boot=function(){};F.__name__=["js","Boot"],F.getClass=function(t){if(t instanceof Array&&null==t.__enum__)return Array;var e=t.__class__;if(null!=e)return e;t=F.__nativeClassName(t);return null!=t?F.__resolveNativeClass(t):null},F.__string_rec=function(t,e){if(null==t)return"null";if(5<=e.length)return"<...>";var i,n=typeof t;switch("function"==n&&(t.__name__||t.__ename__)&&(n="object"),n){case"function":return"<function>";case"object":if(t instanceof Array){if(t.__enum__){if(2==t.length)return t[0];var r=t[0]+"(";e+="\t";for(var s=2,o=t.length;s<o;){var a=s++;r+=2!=a?","+F.__string_rec(t[a],e):F.__string_rec(t[a],e)}return r+")"}var l="[";e+="\t";for(var p=0,h=t.length;p<h;){var u=p++;l+=(0<u?",":"")+F.__string_rec(t[u],e)}return l+="]"}try{i=t.toString}catch(t){return"???"}if(null!=i&&i!=Object.toString&&"function"==typeof i){var c=t.toString();if("[object Object]"!=c)return c}var d=null,_="{\n";e+="\t";var y=null!=t.hasOwnProperty;for(d in t)y&&!t.hasOwnProperty(d)||"prototype"!=d&&"__class__"!=d&&"__super__"!=d&&"__interfaces__"!=d&&"__properties__"!=d&&(2!=_.length&&(_+=", \n"),_+=e+d+" : "+F.__string_rec(t[d],e));return _+="\n"+(e=e.substring(1))+"}";case"string":return t;default:return String(t)}},F.__interfLoop=function(t,e){if(null==t)return!1;if(t==e)return!0;var i=t.__interfaces__;if(null!=i)for(var n=0,r=i.length;n<r;){var s=i[n++];if(s==e||F.__interfLoop(s,e))return!0}return F.__interfLoop(t.__super__,e)},F.__instanceof=function(t,e){if(null==e)return!1;switch(e){case Array:return t instanceof Array&&null==t.__enum__;case ur:return"boolean"==typeof t;case pr:return!0;case hr:return"number"==typeof t;case lr:return"number"==typeof t&&(0|t)===t;case String:return"string"==typeof t;default:if(null==t)return!1;if("function"==typeof e){if(t instanceof e)return!0;if(F.__interfLoop(F.getClass(t),e))return!0}else if("object"==typeof e&&F.__isNativeObj(e)&&t instanceof e)return!0;return e==cr&&null!=t.__name__?!0:e==dr&&null!=t.__ename__||t.__enum__==e}},F.__nativeClassName=function(t){t=F.__toStr.call(t).slice(8,-1);return"Object"==t||"Function"==t||"Math"==t||"JSON"==t?null:t},F.__isNativeObj=function(t){return null!=F.__nativeClassName(t)},F.__resolveNativeClass=function(t){return $global[t]},F.prototype.__class__=F;var kr=nape.Config=function(){};kr.__name__=["nape","Config"],kr.prototype.__class__=kr;var e=nape.callbacks.Callback=function(){this.zpp_inner=null};e.__name__=["nape","callbacks","Callback"],e.prototype.zpp_inner=null,e.prototype.get_event=function(){return At.events[this.zpp_inner.event]},e.prototype.get_listener=function(){return this.zpp_inner.listener.outer},e.prototype.toString=function(){return""},Object.defineProperty(e.prototype,"event",{get:e.prototype.get_event}),Object.defineProperty(e.prototype,"listener",{get:e.prototype.get_listener}),e.prototype.__class__=e;var i=nape.callbacks.BodyCallback=function(){e.call(this)};i.__name__=["nape","callbacks","BodyCallback"],i.__super__=e,i.prototype=Object.create(e.prototype),i.prototype.get_body=function(){return this.zpp_inner.body.outer},i.prototype.toString=function(){var t="Cb:"+["WAKE","SLEEP"][this.zpp_inner.event-2];return t+=":"+this.zpp_inner.body.outer.toString(),t+=" : listener: "+n.string(this.zpp_inner.listener.outer)},Object.defineProperty(i.prototype,"body",{get:i.prototype.get_body}),i.prototype.__class__=i;var p=nape.callbacks.Listener=function(){this.zpp_inner=null};p.__name__=["nape","callbacks","Listener"],p.prototype.zpp_inner=null,p.prototype.get_type=function(){return At.types[this.zpp_inner.type]},p.prototype.get_event=function(){return At.events[this.zpp_inner.event]},p.prototype.set_event=function(t){return At.events[this.zpp_inner.event]!=t&&(null==Yn.CbEvent_BEGIN&&(Yn.internal=!0,Yn.CbEvent_BEGIN=new h,Yn.internal=!1),t=t==Yn.CbEvent_BEGIN?0:(null==Yn.CbEvent_ONGOING&&(Yn.internal=!0,Yn.CbEvent_ONGOING=new h,Yn.internal=!1),t==Yn.CbEvent_ONGOING?6:(null==Yn.CbEvent_END&&(Yn.internal=!0,Yn.CbEvent_END=new h,Yn.internal=!1),t==Yn.CbEvent_END?1:(null==Yn.CbEvent_SLEEP&&(Yn.internal=!0,Yn.CbEvent_SLEEP=new h,Yn.internal=!1),t==Yn.CbEvent_SLEEP?3:(null==Yn.CbEvent_WAKE&&(Yn.internal=!0,Yn.CbEvent_WAKE=new h,Yn.internal=!1),t==Yn.CbEvent_WAKE?2:(null==Yn.CbEvent_PRE&&(Yn.internal=!0,Yn.CbEvent_PRE=new h,Yn.internal=!1),t==Yn.CbEvent_PRE?5:4))))),this.zpp_inner.swapEvent(t)),At.events[this.zpp_inner.event]},p.prototype.get_precedence=function(){return this.zpp_inner.precedence},p.prototype.set_precedence=function(t){return this.zpp_inner.precedence!=t&&(this.zpp_inner.precedence=t,this.zpp_inner.invalidate_precedence()),this.zpp_inner.precedence},p.prototype.get_space=function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},p.prototype.set_space=function(t){return(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=t&&(null!=this.zpp_inner.space&&this.zpp_inner.space.outer.zpp_inner.wrap_listeners.remove(this),null!=t?(t=t.zpp_inner.wrap_listeners).zpp_inner.reverse_flag?t.push(this):t.unshift(this):this.zpp_inner.space=null),null==this.zpp_inner.space?null:this.zpp_inner.space.outer},p.prototype.toString=function(){var t=["BEGIN","END","WAKE","SLEEP","BREAK","PRE","ONGOING"][this.zpp_inner.event];if(0==this.zpp_inner.type)return"BodyListener{"+t+"::"+n.string(this.zpp_inner.body.outer_zn.zpp_inner_zn.options.outer)+"}";if(1==this.zpp_inner.type)return"ConstraintListener{"+t+"::"+n.string(this.zpp_inner.constraint.outer_zn.zpp_inner_zn.options.outer)+"}";var e,i=this.zpp_inner.interaction;switch(i.itype){case 1:e="COLLISION";break;case 2:e="SENSOR";break;case 4:e="FLUID";break;default:e="ALL"}return(2==this.zpp_inner.type?"InteractionListener{"+t+"#"+e+"::"+n.string(i.outer_zni.zpp_inner_zn.options1.outer)+":"+n.string(i.outer_zni.zpp_inner_zn.options2.outer)+"}":"PreListener{"+e+"::"+n.string(i.outer_znp.zpp_inner_zn.options1.outer)+":"+n.string(i.outer_znp.zpp_inner_zn.options2.outer)+"}")+" precedence="+this.zpp_inner.precedence},Object.defineProperty(p.prototype,"type",{get:p.prototype.get_type}),Object.defineProperty(p.prototype,"event",{get:p.prototype.get_event,set:p.prototype.set_event}),Object.defineProperty(p.prototype,"precedence",{get:p.prototype.get_precedence,set:p.prototype.set_precedence}),Object.defineProperty(p.prototype,"space",{get:p.prototype.get_space,set:p.prototype.set_space}),p.prototype.__class__=p;var s=nape.callbacks.BodyListener=function(t,e,i,n){null==n&&(n=0),this.zpp_inner_zn=null,p.call(this);var r=-1;null==Yn.CbEvent_WAKE&&(Yn.internal=!0,Yn.CbEvent_WAKE=new h,Yn.internal=!1),t==Yn.CbEvent_WAKE?r=2:(null==Yn.CbEvent_SLEEP&&(Yn.internal=!0,Yn.CbEvent_SLEEP=new h,Yn.internal=!1),t==Yn.CbEvent_SLEEP&&(r=3)),this.zpp_inner_zn=new Ot(It.argument(e),r,i),this.zpp_inner=this.zpp_inner_zn,((this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this).zpp_inner.precedence=n};s.__name__=["nape","callbacks","BodyListener"],s.__super__=p,s.prototype=Object.create(p.prototype),s.prototype.zpp_inner_zn=null,s.prototype.get_options=function(){return this.zpp_inner_zn.options.outer},s.prototype.set_options=function(t){return this.zpp_inner_zn.options.set(t.zpp_inner),this.zpp_inner_zn.options.outer},s.prototype.get_handler=function(){return this.zpp_inner_zn.handler},s.prototype.set_handler=function(t){return this.zpp_inner_zn.handler=t,this.zpp_inner_zn.handler},Object.defineProperty(s.prototype,"options",{get:s.prototype.get_options,set:s.prototype.set_options}),Object.defineProperty(s.prototype,"handler",{get:s.prototype.get_handler,set:s.prototype.set_handler}),s.prototype.__class__=s;var h=nape.callbacks.CbEvent=function(){};h.__name__=["nape","callbacks","CbEvent"],h.BEGIN=null,h.get_BEGIN=function(){return null==Yn.CbEvent_BEGIN&&(Yn.internal=!0,Yn.CbEvent_BEGIN=new h,Yn.internal=!1),Yn.CbEvent_BEGIN},h.ONGOING=null,h.get_ONGOING=function(){return null==Yn.CbEvent_ONGOING&&(Yn.internal=!0,Yn.CbEvent_ONGOING=new h,Yn.internal=!1),Yn.CbEvent_ONGOING},h.END=null,h.get_END=function(){return null==Yn.CbEvent_END&&(Yn.internal=!0,Yn.CbEvent_END=new h,Yn.internal=!1),Yn.CbEvent_END},h.WAKE=null,h.get_WAKE=function(){return null==Yn.CbEvent_WAKE&&(Yn.internal=!0,Yn.CbEvent_WAKE=new h,Yn.internal=!1),Yn.CbEvent_WAKE},h.SLEEP=null,h.get_SLEEP=function(){return null==Yn.CbEvent_SLEEP&&(Yn.internal=!0,Yn.CbEvent_SLEEP=new h,Yn.internal=!1),Yn.CbEvent_SLEEP},h.BREAK=null,h.get_BREAK=function(){return null==Yn.CbEvent_BREAK&&(Yn.internal=!0,Yn.CbEvent_BREAK=new h,Yn.internal=!1),Yn.CbEvent_BREAK},h.PRE=null,h.get_PRE=function(){return null==Yn.CbEvent_PRE&&(Yn.internal=!0,Yn.CbEvent_PRE=new h,Yn.internal=!1),Yn.CbEvent_PRE},h.prototype.toString=function(){return null==Yn.CbEvent_PRE&&(Yn.internal=!0,Yn.CbEvent_PRE=new h,Yn.internal=!1),this==Yn.CbEvent_PRE?"PRE":(null==Yn.CbEvent_BEGIN&&(Yn.internal=!0,Yn.CbEvent_BEGIN=new h,Yn.internal=!1),this==Yn.CbEvent_BEGIN?"BEGIN":(null==Yn.CbEvent_ONGOING&&(Yn.internal=!0,Yn.CbEvent_ONGOING=new h,Yn.internal=!1),this==Yn.CbEvent_ONGOING?"ONGOING":(null==Yn.CbEvent_END&&(Yn.internal=!0,Yn.CbEvent_END=new h,Yn.internal=!1),this==Yn.CbEvent_END?"END":(null==Yn.CbEvent_WAKE&&(Yn.internal=!0,Yn.CbEvent_WAKE=new h,Yn.internal=!1),this==Yn.CbEvent_WAKE?"WAKE":(null==Yn.CbEvent_SLEEP&&(Yn.internal=!0,Yn.CbEvent_SLEEP=new h,Yn.internal=!1),this==Yn.CbEvent_SLEEP?"SLEEP":(null==Yn.CbEvent_BREAK&&(Yn.internal=!0,Yn.CbEvent_BREAK=new h,Yn.internal=!1),this==Yn.CbEvent_BREAK?"BREAK":""))))))},Object.defineProperty(h,"BEGIN",{get:h.get_BEGIN}),Object.defineProperty(h,"ONGOING",{get:h.get_ONGOING}),Object.defineProperty(h,"END",{get:h.get_END}),Object.defineProperty(h,"WAKE",{get:h.get_WAKE}),Object.defineProperty(h,"SLEEP",{get:h.get_SLEEP}),Object.defineProperty(h,"BREAK",{get:h.get_BREAK}),Object.defineProperty(h,"PRE",{get:h.get_PRE}),h.prototype.__class__=h;var u=nape.callbacks.CbType=function(){this.zpp_inner=null,this.zpp_inner=new Mt,this.zpp_inner.outer=this};u.__name__=["nape","callbacks","CbType"],u.ANY_BODY=null,u.get_ANY_BODY=function(){return Mt.ANY_BODY},u.ANY_CONSTRAINT=null,u.get_ANY_CONSTRAINT=function(){return Mt.ANY_CONSTRAINT},u.ANY_SHAPE=null,u.get_ANY_SHAPE=function(){return Mt.ANY_SHAPE},u.ANY_COMPOUND=null,u.get_ANY_COMPOUND=function(){return Mt.ANY_COMPOUND},u.prototype.zpp_inner=null,u.prototype.get_id=function(){return this.zpp_inner.id},u.prototype.including=function(t){return new v(this).including(t)},u.prototype.excluding=function(t){return new v(this).excluding(t)},u.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},u.prototype.get_interactors=function(){return null==this.zpp_inner.wrap_interactors&&(this.zpp_inner.wrap_interactors=Cn.get(this.zpp_inner.interactors,!0)),this.zpp_inner.wrap_interactors},u.prototype.get_constraints=function(){return null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=zn.get(this.zpp_inner.constraints,!0)),this.zpp_inner.wrap_constraints},u.prototype.toString=function(){return this==Mt.ANY_BODY?"ANY_BODY":this==Mt.ANY_SHAPE?"ANY_SHAPE":this==Mt.ANY_COMPOUND?"ANY_COMPOUND":this==Mt.ANY_CONSTRAINT?"ANY_CONSTRAINT":"CbType#"+this.zpp_inner.id},Object.defineProperty(u,"ANY_BODY",{get:u.get_ANY_BODY}),Object.defineProperty(u,"ANY_CONSTRAINT",{get:u.get_ANY_CONSTRAINT}),Object.defineProperty(u,"ANY_SHAPE",{get:u.get_ANY_SHAPE}),Object.defineProperty(u,"ANY_COMPOUND",{get:u.get_ANY_COMPOUND}),Object.defineProperty(u.prototype,"id",{get:u.prototype.get_id}),Object.defineProperty(u.prototype,"userData",{get:u.prototype.get_userData}),Object.defineProperty(u.prototype,"interactors",{get:u.prototype.get_interactors}),Object.defineProperty(u.prototype,"constraints",{get:u.prototype.get_constraints}),u.prototype.__class__=u;var Xt=nape.callbacks.CbTypeIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Xt.__name__=["nape","callbacks","CbTypeIterator"],Xt.get=function(t){var e,i=null==Xt.zpp_pool?(Sn.internal=!0,e=new Xt,Sn.internal=!1,e):(i=Xt.zpp_pool,Xt.zpp_pool=i.zpp_next,i);return i.zpp_i=0,i.zpp_inner=t,i.zpp_critical=!1,i},Xt.prototype.zpp_inner=null,Xt.prototype.zpp_i=null,Xt.prototype.zpp_critical=null,Xt.prototype.zpp_next=null,Xt.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);t=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=Xt.zpp_pool,(Xt.zpp_pool=this).zpp_inner=null,!1)},Xt.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Xt.prototype.__class__=Xt;var c=nape.callbacks.CbTypeList=function(){this.zpp_inner=null,this.zpp_inner=new Sn,this.zpp_inner.outer=this};c.__name__=["nape","callbacks","CbTypeList"],c.fromArray=function(t){for(var e=new c,i=0;i<t.length;){var n=t[i];++i,e.push(n)}return e},c.prototype.zpp_inner=null,c.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},c.prototype.has=function(t){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(t.zpp_inner)},c.prototype.at=function(t){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.user_length-1-t),t<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=t,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(t);else for(;this.zpp_inner.at_index!=t;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},c.prototype.push=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(t.zpp_inner):(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},c.prototype.unshift=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)):this.zpp_inner.inner.add(t.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},c.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e,i=null;return this.zpp_inner.reverse_flag?(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(i=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.outer},c.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(i=(null==(e=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:e.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)):(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.outer},c.prototype.add=function(t){return this.zpp_inner.reverse_flag?this.push(t):this.unshift(t)},c.prototype.remove=function(t){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==t.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(t.zpp_inner),this.zpp_inner.invalidate()),e},c.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},c.prototype.empty=function(){return null==this.zpp_inner.inner.head},c.prototype.iterator=function(){return this.zpp_inner.valmod(),Xt.get(this)},c.prototype.copy=function(t){null==t&&(t=!1);var e=new c;this.zpp_inner.valmod();for(var i=Xt.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=Xt.zpp_pool,(Xt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e.push(t?null:n)}return e},c.prototype.merge=function(t){t.zpp_inner.valmod();for(var e=Xt.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Xt.zpp_pool,(Xt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);this.has(i)||(this.zpp_inner.reverse_flag?this.push(i):this.unshift(i))}},c.prototype.toString=function(){var t="[",e=!0;this.zpp_inner.valmod();for(var i=Xt.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=Xt.zpp_pool,(Xt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e||(t+=","),t+=null==n?"NULL":n.toString(),e=!1}return t+"]"},c.prototype.foreach=function(t){this.zpp_inner.valmod();for(var e=Xt.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Xt.zpp_pool,(Xt.zpp_pool=e).zpp_inner=null,!1)))break;try{e.zpp_critical=!1,t(e.zpp_inner.at(e.zpp_i++))}catch(t){e.zpp_next=Xt.zpp_pool,(Xt.zpp_pool=e).zpp_inner=null;break}}return this},c.prototype.filter=function(t){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var i=this.at(e);try{t(i)?++e:this.remove(i)}catch(t){break}}return this},Object.defineProperty(c.prototype,"length",{get:c.prototype.get_length}),c.prototype.__class__=c;var o=nape.callbacks.ConstraintCallback=function(){e.call(this)};o.__name__=["nape","callbacks","ConstraintCallback"],o.__super__=e,o.prototype=Object.create(e.prototype),o.prototype.get_constraint=function(){return this.zpp_inner.constraint.outer},o.prototype.toString=function(){var t="Cb:"+["WAKE","SLEEP","BREAK"][this.zpp_inner.event-2];return t+=":"+this.zpp_inner.constraint.outer.toString(),t+=" : listener: "+n.string(this.zpp_inner.listener.outer)},Object.defineProperty(o.prototype,"constraint",{get:o.prototype.get_constraint}),o.prototype.__class__=o;var d=nape.callbacks.ConstraintListener=function(t,e,i,n){null==n&&(n=0),this.zpp_inner_zn=null,p.call(this);var r=-1;null==Yn.CbEvent_WAKE&&(Yn.internal=!0,Yn.CbEvent_WAKE=new h,Yn.internal=!1),t==Yn.CbEvent_WAKE?r=2:(null==Yn.CbEvent_SLEEP&&(Yn.internal=!0,Yn.CbEvent_SLEEP=new h,Yn.internal=!1),t==Yn.CbEvent_SLEEP?r=3:(null==Yn.CbEvent_BREAK&&(Yn.internal=!0,Yn.CbEvent_BREAK=new h,Yn.internal=!1),t==Yn.CbEvent_BREAK&&(r=4))),this.zpp_inner_zn=new kt(It.argument(e),r,i),this.zpp_inner=this.zpp_inner_zn,((this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this).zpp_inner.precedence=n};d.__name__=["nape","callbacks","ConstraintListener"],d.__super__=p,d.prototype=Object.create(p.prototype),d.prototype.zpp_inner_zn=null,d.prototype.get_options=function(){return this.zpp_inner_zn.options.outer},d.prototype.set_options=function(t){return this.zpp_inner_zn.options.set(t.zpp_inner),this.zpp_inner_zn.options.outer},d.prototype.get_handler=function(){return this.zpp_inner_zn.handler},d.prototype.set_handler=function(t){return this.zpp_inner_zn.handler=t,this.zpp_inner_zn.handler},Object.defineProperty(d.prototype,"options",{get:d.prototype.get_options,set:d.prototype.set_options}),Object.defineProperty(d.prototype,"handler",{get:d.prototype.get_handler,set:d.prototype.set_handler}),d.prototype.__class__=d;var _=nape.callbacks.InteractionCallback=function(){e.call(this)};_.__name__=["nape","callbacks","InteractionCallback"],_.__super__=e,_.prototype=Object.create(e.prototype),_.prototype.get_int1=function(){return this.zpp_inner.int1.outer_i},_.prototype.get_int2=function(){return this.zpp_inner.int2.outer_i},_.prototype.get_arbiters=function(){return this.zpp_inner.wrap_arbiters},_.prototype.toString=function(){var t="Cb:"+["BEGIN","END","","","","","ONGOING"][this.zpp_inner.event];return t+=":"+this.zpp_inner.int1.outer_i.toString()+"/"+this.zpp_inner.int2.outer_i.toString(),t+=" : "+this.zpp_inner.wrap_arbiters.toString(),t+=" : listener: "+n.string(this.zpp_inner.listener.outer)},Object.defineProperty(_.prototype,"int1",{get:_.prototype.get_int1}),Object.defineProperty(_.prototype,"int2",{get:_.prototype.get_int2}),Object.defineProperty(_.prototype,"arbiters",{get:_.prototype.get_arbiters}),_.prototype.__class__=_;var y=nape.callbacks.InteractionListener=function(t,e,i,n,r,s){null==s&&(s=0),this.zpp_inner_zn=null,p.call(this);var o=-1;null==Yn.CbEvent_BEGIN&&(Yn.internal=!0,Yn.CbEvent_BEGIN=new h,Yn.internal=!1),t==Yn.CbEvent_BEGIN?o=0:(null==Yn.CbEvent_END&&(Yn.internal=!0,Yn.CbEvent_END=new h,Yn.internal=!1),t==Yn.CbEvent_END?o=1:(null==Yn.CbEvent_ONGOING&&(Yn.internal=!0,Yn.CbEvent_ONGOING=new h,Yn.internal=!1),t==Yn.CbEvent_ONGOING&&(o=6))),this.zpp_inner_zn=new Re(It.argument(i),It.argument(n),o,2),this.zpp_inner=this.zpp_inner_zn,((this.zpp_inner.outer=this).zpp_inner_zn.outer_zni=this).zpp_inner.precedence=s,this.zpp_inner_zn.handleri=r;r=this.zpp_inner_zn.itype,r=1==r?(null==Yn.InteractionType_COLLISION&&(Yn.internal=!0,Yn.InteractionType_COLLISION=new f,Yn.internal=!1),Yn.InteractionType_COLLISION):2==r?(null==Yn.InteractionType_SENSOR&&(Yn.internal=!0,Yn.InteractionType_SENSOR=new f,Yn.internal=!1),Yn.InteractionType_SENSOR):4==r?(null==Yn.InteractionType_FLUID&&(Yn.internal=!0,Yn.InteractionType_FLUID=new f,Yn.internal=!1),Yn.InteractionType_FLUID):7==r?(null==Yn.InteractionType_ANY&&(Yn.internal=!0,Yn.InteractionType_ANY=new f,Yn.internal=!1),Yn.InteractionType_ANY):null;r!=e&&(null==Yn.InteractionType_COLLISION&&(Yn.internal=!0,Yn.InteractionType_COLLISION=new f,Yn.internal=!1),a=e==Yn.InteractionType_COLLISION?1:(null==Yn.InteractionType_SENSOR&&(Yn.internal=!0,Yn.InteractionType_SENSOR=new f,Yn.internal=!1),e==Yn.InteractionType_SENSOR?2:(null==Yn.InteractionType_FLUID&&(Yn.internal=!0,Yn.InteractionType_FLUID=new f,Yn.internal=!1),e==Yn.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=a);var a=this.zpp_inner_zn.itype;1==a?null==Yn.InteractionType_COLLISION&&(Yn.internal=!0,Yn.InteractionType_COLLISION=new f,Yn.internal=!1):2==a?null==Yn.InteractionType_SENSOR&&(Yn.internal=!0,Yn.InteractionType_SENSOR=new f,Yn.internal=!1):4==a?null==Yn.InteractionType_FLUID&&(Yn.internal=!0,Yn.InteractionType_FLUID=new f,Yn.internal=!1):7==a&&null==Yn.InteractionType_ANY&&(Yn.internal=!0,Yn.InteractionType_ANY=new f,Yn.internal=!1)};y.__name__=["nape","callbacks","InteractionListener"],y.__super__=p,y.prototype=Object.create(p.prototype),y.prototype.zpp_inner_zn=null,y.prototype.get_options1=function(){return this.zpp_inner_zn.options1.outer},y.prototype.set_options1=function(t){return this.zpp_inner_zn.options1.set(t.zpp_inner),this.zpp_inner_zn.options1.outer},y.prototype.get_options2=function(){return this.zpp_inner_zn.options2.outer},y.prototype.set_options2=function(t){return this.zpp_inner_zn.options2.set(t.zpp_inner),this.zpp_inner_zn.options2.outer},y.prototype.get_interactionType=function(){var t=this.zpp_inner_zn.itype;return 1==t?(null==Yn.InteractionType_COLLISION&&(Yn.internal=!0,Yn.InteractionType_COLLISION=new f,Yn.internal=!1),Yn.InteractionType_COLLISION):2==t?(null==Yn.InteractionType_SENSOR&&(Yn.internal=!0,Yn.InteractionType_SENSOR=new f,Yn.internal=!1),Yn.InteractionType_SENSOR):4==t?(null==Yn.InteractionType_FLUID&&(Yn.internal=!0,Yn.InteractionType_FLUID=new f,Yn.internal=!1),Yn.InteractionType_FLUID):7==t?(null==Yn.InteractionType_ANY&&(Yn.internal=!0,Yn.InteractionType_ANY=new f,Yn.internal=!1),Yn.InteractionType_ANY):null},y.prototype.set_interactionType=function(t){var e=this.zpp_inner_zn.itype,e=1==e?(null==Yn.InteractionType_COLLISION&&(Yn.internal=!0,Yn.InteractionType_COLLISION=new f,Yn.internal=!1),Yn.InteractionType_COLLISION):2==e?(null==Yn.InteractionType_SENSOR&&(Yn.internal=!0,Yn.InteractionType_SENSOR=new f,Yn.internal=!1),Yn.InteractionType_SENSOR):4==e?(null==Yn.InteractionType_FLUID&&(Yn.internal=!0,Yn.InteractionType_FLUID=new f,Yn.internal=!1),Yn.InteractionType_FLUID):7==e?(null==Yn.InteractionType_ANY&&(Yn.internal=!0,Yn.InteractionType_ANY=new f,Yn.internal=!1),Yn.InteractionType_ANY):null;e!=t&&(null==Yn.InteractionType_COLLISION&&(Yn.internal=!0,Yn.InteractionType_COLLISION=new f,Yn.internal=!1),i=t==Yn.InteractionType_COLLISION?1:(null==Yn.InteractionType_SENSOR&&(Yn.internal=!0,Yn.InteractionType_SENSOR=new f,Yn.internal=!1),t==Yn.InteractionType_SENSOR?2:(null==Yn.InteractionType_FLUID&&(Yn.internal=!0,Yn.InteractionType_FLUID=new f,Yn.internal=!1),t==Yn.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=i);var i=this.zpp_inner_zn.itype;return 1==i?(null==Yn.InteractionType_COLLISION&&(Yn.internal=!0,Yn.InteractionType_COLLISION=new f,Yn.internal=!1),Yn.InteractionType_COLLISION):2==i?(null==Yn.InteractionType_SENSOR&&(Yn.internal=!0,Yn.InteractionType_SENSOR=new f,Yn.internal=!1),Yn.InteractionType_SENSOR):4==i?(null==Yn.InteractionType_FLUID&&(Yn.internal=!0,Yn.InteractionType_FLUID=new f,Yn.internal=!1),Yn.InteractionType_FLUID):7==i?(null==Yn.InteractionType_ANY&&(Yn.internal=!0,Yn.InteractionType_ANY=new f,Yn.internal=!1),Yn.InteractionType_ANY):null},y.prototype.get_handler=function(){return this.zpp_inner_zn.handleri},y.prototype.set_handler=function(t){return this.zpp_inner_zn.handleri=t,this.zpp_inner_zn.handleri},y.prototype.get_allowSleepingCallbacks=function(){return this.zpp_inner_zn.allowSleepingCallbacks},y.prototype.set_allowSleepingCallbacks=function(t){return this.zpp_inner_zn.allowSleepingCallbacks=t,this.zpp_inner_zn.allowSleepingCallbacks},Object.defineProperty(y.prototype,"options1",{get:y.prototype.get_options1,set:y.prototype.set_options1}),Object.defineProperty(y.prototype,"options2",{get:y.prototype.get_options2,set:y.prototype.set_options2}),Object.defineProperty(y.prototype,"interactionType",{get:y.prototype.get_interactionType,set:y.prototype.set_interactionType}),Object.defineProperty(y.prototype,"handler",{get:y.prototype.get_handler,set:y.prototype.set_handler}),Object.defineProperty(y.prototype,"allowSleepingCallbacks",{get:y.prototype.get_allowSleepingCallbacks,set:y.prototype.set_allowSleepingCallbacks}),y.prototype.__class__=y;var f=nape.callbacks.InteractionType=function(){};f.__name__=["nape","callbacks","InteractionType"],f.COLLISION=null,f.get_COLLISION=function(){return null==Yn.InteractionType_COLLISION&&(Yn.internal=!0,Yn.InteractionType_COLLISION=new f,Yn.internal=!1),Yn.InteractionType_COLLISION},f.SENSOR=null,f.get_SENSOR=function(){return null==Yn.InteractionType_SENSOR&&(Yn.internal=!0,Yn.InteractionType_SENSOR=new f,Yn.internal=!1),Yn.InteractionType_SENSOR},f.FLUID=null,f.get_FLUID=function(){return null==Yn.InteractionType_FLUID&&(Yn.internal=!0,Yn.InteractionType_FLUID=new f,Yn.internal=!1),Yn.InteractionType_FLUID},f.ANY=null,f.get_ANY=function(){return null==Yn.InteractionType_ANY&&(Yn.internal=!0,Yn.InteractionType_ANY=new f,Yn.internal=!1),Yn.InteractionType_ANY},f.prototype.toString=function(){return null==Yn.InteractionType_COLLISION&&(Yn.internal=!0,Yn.InteractionType_COLLISION=new f,Yn.internal=!1),this==Yn.InteractionType_COLLISION?"COLLISION":(null==Yn.InteractionType_SENSOR&&(Yn.internal=!0,Yn.InteractionType_SENSOR=new f,Yn.internal=!1),this==Yn.InteractionType_SENSOR?"SENSOR":(null==Yn.InteractionType_FLUID&&(Yn.internal=!0,Yn.InteractionType_FLUID=new f,Yn.internal=!1),this==Yn.InteractionType_FLUID?"FLUID":(null==Yn.InteractionType_ANY&&(Yn.internal=!0,Yn.InteractionType_ANY=new f,Yn.internal=!1),this==Yn.InteractionType_ANY?"ANY":"")))},Object.defineProperty(f,"COLLISION",{get:f.get_COLLISION}),Object.defineProperty(f,"SENSOR",{get:f.get_SENSOR}),Object.defineProperty(f,"FLUID",{get:f.get_FLUID}),Object.defineProperty(f,"ANY",{get:f.get_ANY}),f.prototype.__class__=f;var Vt=nape.callbacks.ListenerIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Vt.__name__=["nape","callbacks","ListenerIterator"],Vt.get=function(t){var e,i=null==Vt.zpp_pool?(Tn.internal=!0,e=new Vt,Tn.internal=!1,e):(i=Vt.zpp_pool,Vt.zpp_pool=i.zpp_next,i);return i.zpp_i=0,i.zpp_inner=t,i.zpp_critical=!1,i},Vt.prototype.zpp_inner=null,Vt.prototype.zpp_i=null,Vt.prototype.zpp_critical=null,Vt.prototype.zpp_next=null,Vt.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);t=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=Vt.zpp_pool,(Vt.zpp_pool=this).zpp_inner=null,!1)},Vt.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Vt.prototype.__class__=Vt;var m=nape.callbacks.ListenerList=function(){this.zpp_inner=null,this.zpp_inner=new Tn,this.zpp_inner.outer=this};m.__name__=["nape","callbacks","ListenerList"],m.fromArray=function(t){for(var e=new m,i=0;i<t.length;){var n=t[i];++i,e.push(n)}return e},m.prototype.zpp_inner=null,m.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},m.prototype.has=function(t){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(t.zpp_inner)},m.prototype.at=function(t){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.user_length-1-t),t<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=t,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(t);else for(;this.zpp_inner.at_index!=t;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},m.prototype.push=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(t.zpp_inner):(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},m.prototype.unshift=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)):this.zpp_inner.inner.add(t.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},m.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e,i=null;return this.zpp_inner.reverse_flag?(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(i=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.outer},m.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(i=(null==(e=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:e.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)):(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.outer},m.prototype.add=function(t){return this.zpp_inner.reverse_flag?this.push(t):this.unshift(t)},m.prototype.remove=function(t){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==t.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(t.zpp_inner),this.zpp_inner.invalidate()),e},m.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},m.prototype.empty=function(){return null==this.zpp_inner.inner.head},m.prototype.iterator=function(){return this.zpp_inner.valmod(),Vt.get(this)},m.prototype.copy=function(t){null==t&&(t=!1);var e=new m;this.zpp_inner.valmod();for(var i=Vt.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=Vt.zpp_pool,(Vt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e.push(t?null:n)}return e},m.prototype.merge=function(t){t.zpp_inner.valmod();for(var e=Vt.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Vt.zpp_pool,(Vt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);this.has(i)||(this.zpp_inner.reverse_flag?this.push(i):this.unshift(i))}},m.prototype.toString=function(){var t="[",e=!0;this.zpp_inner.valmod();for(var i=Vt.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=Vt.zpp_pool,(Vt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e||(t+=","),t+=null==n?"NULL":n.toString(),e=!1}return t+"]"},m.prototype.foreach=function(t){this.zpp_inner.valmod();for(var e=Vt.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Vt.zpp_pool,(Vt.zpp_pool=e).zpp_inner=null,!1)))break;try{e.zpp_critical=!1,t(e.zpp_inner.at(e.zpp_i++))}catch(t){e.zpp_next=Vt.zpp_pool,(Vt.zpp_pool=e).zpp_inner=null;break}}return this},m.prototype.filter=function(t){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var i=this.at(e);try{t(i)?++e:this.remove(i)}catch(t){break}}return this},Object.defineProperty(m.prototype,"length",{get:m.prototype.get_length}),m.prototype.__class__=m;var x=nape.callbacks.ListenerType=function(){};x.__name__=["nape","callbacks","ListenerType"],x.BODY=null,x.get_BODY=function(){return null==Yn.ListenerType_BODY&&(Yn.internal=!0,Yn.ListenerType_BODY=new x,Yn.internal=!1),Yn.ListenerType_BODY},x.CONSTRAINT=null,x.get_CONSTRAINT=function(){return null==Yn.ListenerType_CONSTRAINT&&(Yn.internal=!0,Yn.ListenerType_CONSTRAINT=new x,Yn.internal=!1),Yn.ListenerType_CONSTRAINT},x.INTERACTION=null,x.get_INTERACTION=function(){return null==Yn.ListenerType_INTERACTION&&(Yn.internal=!0,Yn.ListenerType_INTERACTION=new x,Yn.internal=!1),Yn.ListenerType_INTERACTION},x.PRE=null,x.get_PRE=function(){return null==Yn.ListenerType_PRE&&(Yn.internal=!0,Yn.ListenerType_PRE=new x,Yn.internal=!1),Yn.ListenerType_PRE},x.prototype.toString=function(){return null==Yn.ListenerType_BODY&&(Yn.internal=!0,Yn.ListenerType_BODY=new x,Yn.internal=!1),this==Yn.ListenerType_BODY?"BODY":(null==Yn.ListenerType_CONSTRAINT&&(Yn.internal=!0,Yn.ListenerType_CONSTRAINT=new x,Yn.internal=!1),this==Yn.ListenerType_CONSTRAINT?"CONSTRAINT":(null==Yn.ListenerType_INTERACTION&&(Yn.internal=!0,Yn.ListenerType_INTERACTION=new x,Yn.internal=!1),this==Yn.ListenerType_INTERACTION?"INTERACTION":(null==Yn.ListenerType_PRE&&(Yn.internal=!0,Yn.ListenerType_PRE=new x,Yn.internal=!1),this==Yn.ListenerType_PRE?"PRE":"")))},Object.defineProperty(x,"BODY",{get:x.get_BODY}),Object.defineProperty(x,"CONSTRAINT",{get:x.get_CONSTRAINT}),Object.defineProperty(x,"INTERACTION",{get:x.get_INTERACTION}),Object.defineProperty(x,"PRE",{get:x.get_PRE}),x.prototype.__class__=x;var v=nape.callbacks.OptionType=function(t,e){this.zpp_inner=null,this.zpp_inner=new It,this.zpp_inner.outer=this,null!=t&&this.including(t),null!=e&&this.excluding(e)};v.__name__=["nape","callbacks","OptionType"],v.prototype.zpp_inner=null,v.prototype.get_includes=function(){return null==this.zpp_inner.wrap_includes&&this.zpp_inner.setup_includes(),this.zpp_inner.wrap_includes},v.prototype.get_excludes=function(){return null==this.zpp_inner.wrap_excludes&&this.zpp_inner.setup_excludes(),this.zpp_inner.wrap_excludes},v.prototype.including=function(t){return this.zpp_inner.append(this.zpp_inner.includes,t),this},v.prototype.excluding=function(t){return this.zpp_inner.append(this.zpp_inner.excludes,t),this},v.prototype.toString=function(){null==this.zpp_inner.wrap_includes&&this.zpp_inner.setup_includes();var t=this.zpp_inner.wrap_includes.toString();return null==this.zpp_inner.wrap_excludes&&this.zpp_inner.setup_excludes(),"@{"+t+" excluding "+this.zpp_inner.wrap_excludes.toString()+"}"},Object.defineProperty(v.prototype,"includes",{get:v.prototype.get_includes}),Object.defineProperty(v.prototype,"excludes",{get:v.prototype.get_excludes}),v.prototype.__class__=v;var g=nape.callbacks.PreCallback=function(){e.call(this)};g.__name__=["nape","callbacks","PreCallback"],g.__super__=e,g.prototype=Object.create(e.prototype),g.prototype.get_arbiter=function(){return this.zpp_inner.pre_arbiter.wrapper()},g.prototype.get_int1=function(){return this.zpp_inner.int1.outer_i},g.prototype.get_int2=function(){return this.zpp_inner.int2.outer_i},g.prototype.get_swapped=function(){return this.zpp_inner.pre_swapped},g.prototype.toString=function(){var t="Cb:PRE::"+this.zpp_inner.int1.outer_i.toString()+"/"+this.zpp_inner.int2.outer_i.toString();return t+=" : "+this.zpp_inner.pre_arbiter.wrapper().toString(),t+=" : listnener: "+n.string(this.zpp_inner.listener.outer)},Object.defineProperty(g.prototype,"arbiter",{get:g.prototype.get_arbiter}),Object.defineProperty(g.prototype,"int1",{get:g.prototype.get_int1}),Object.defineProperty(g.prototype,"int2",{get:g.prototype.get_int2}),Object.defineProperty(g.prototype,"swapped",{get:g.prototype.get_swapped}),g.prototype.__class__=g;var Wn=nape.callbacks.PreFlag=function(){};Wn.__name__=["nape","callbacks","PreFlag"],Wn.ACCEPT=null,Wn.get_ACCEPT=function(){return null==Yn.PreFlag_ACCEPT&&(Yn.internal=!0,Yn.PreFlag_ACCEPT=new Wn,Yn.internal=!1),Yn.PreFlag_ACCEPT},Wn.IGNORE=null,Wn.get_IGNORE=function(){return null==Yn.PreFlag_IGNORE&&(Yn.internal=!0,Yn.PreFlag_IGNORE=new Wn,Yn.internal=!1),Yn.PreFlag_IGNORE},Wn.ACCEPT_ONCE=null,Wn.get_ACCEPT_ONCE=function(){return null==Yn.PreFlag_ACCEPT_ONCE&&(Yn.internal=!0,Yn.PreFlag_ACCEPT_ONCE=new Wn,Yn.internal=!1),Yn.PreFlag_ACCEPT_ONCE},Wn.IGNORE_ONCE=null,Wn.get_IGNORE_ONCE=function(){return null==Yn.PreFlag_IGNORE_ONCE&&(Yn.internal=!0,Yn.PreFlag_IGNORE_ONCE=new Wn,Yn.internal=!1),Yn.PreFlag_IGNORE_ONCE},Wn.prototype.toString=function(){return null==Yn.PreFlag_ACCEPT&&(Yn.internal=!0,Yn.PreFlag_ACCEPT=new Wn,Yn.internal=!1),this==Yn.PreFlag_ACCEPT?"ACCEPT":(null==Yn.PreFlag_IGNORE&&(Yn.internal=!0,Yn.PreFlag_IGNORE=new Wn,Yn.internal=!1),this==Yn.PreFlag_IGNORE?"IGNORE":(null==Yn.PreFlag_ACCEPT_ONCE&&(Yn.internal=!0,Yn.PreFlag_ACCEPT_ONCE=new Wn,Yn.internal=!1),this==Yn.PreFlag_ACCEPT_ONCE?"ACCEPT_ONCE":(null==Yn.PreFlag_IGNORE_ONCE&&(Yn.internal=!0,Yn.PreFlag_IGNORE_ONCE=new Wn,Yn.internal=!1),this==Yn.PreFlag_IGNORE_ONCE?"IGNORE_ONCE":"")))},Object.defineProperty(Wn,"ACCEPT",{get:Wn.get_ACCEPT}),Object.defineProperty(Wn,"IGNORE",{get:Wn.get_IGNORE}),Object.defineProperty(Wn,"ACCEPT_ONCE",{get:Wn.get_ACCEPT_ONCE}),Object.defineProperty(Wn,"IGNORE_ONCE",{get:Wn.get_IGNORE_ONCE}),Wn.prototype.__class__=Wn,(s=nape.callbacks.PreListener=function(t,e,i,n,r,s){null==s&&(s=!1),null==r&&(r=0),this.zpp_inner_zn=null,p.call(this),this.zpp_inner_zn=new Re(It.argument(e),It.argument(i),5,3),this.zpp_inner=this.zpp_inner_zn,((this.zpp_inner.outer=this).zpp_inner_zn.outer_znp=this).zpp_inner.precedence=r,this.zpp_inner_zn.pure=s,this.zpp_inner_zn.handlerp=n;n=this.zpp_inner_zn.itype,n=1==n?(null==Yn.InteractionType_COLLISION&&(Yn.internal=!0,Yn.InteractionType_COLLISION=new f,Yn.internal=!1),Yn.InteractionType_COLLISION):2==n?(null==Yn.InteractionType_SENSOR&&(Yn.internal=!0,Yn.InteractionType_SENSOR=new f,Yn.internal=!1),Yn.InteractionType_SENSOR):4==n?(null==Yn.InteractionType_FLUID&&(Yn.internal=!0,Yn.InteractionType_FLUID=new f,Yn.internal=!1),Yn.InteractionType_FLUID):7==n?(null==Yn.InteractionType_ANY&&(Yn.internal=!0,Yn.InteractionType_ANY=new f,Yn.internal=!1),Yn.InteractionType_ANY):null;n!=t&&(null==Yn.InteractionType_COLLISION&&(Yn.internal=!0,Yn.InteractionType_COLLISION=new f,Yn.internal=!1),o=t==Yn.InteractionType_COLLISION?1:(null==Yn.InteractionType_SENSOR&&(Yn.internal=!0,Yn.InteractionType_SENSOR=new f,Yn.internal=!1),t==Yn.InteractionType_SENSOR?2:(null==Yn.InteractionType_FLUID&&(Yn.internal=!0,Yn.InteractionType_FLUID=new f,Yn.internal=!1),t==Yn.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=o);var o=this.zpp_inner_zn.itype;1==o?null==Yn.InteractionType_COLLISION&&(Yn.internal=!0,Yn.InteractionType_COLLISION=new f,Yn.internal=!1):2==o?null==Yn.InteractionType_SENSOR&&(Yn.internal=!0,Yn.InteractionType_SENSOR=new f,Yn.internal=!1):4==o?null==Yn.InteractionType_FLUID&&(Yn.internal=!0,Yn.InteractionType_FLUID=new f,Yn.internal=!1):7==o&&null==Yn.InteractionType_ANY&&(Yn.internal=!0,Yn.InteractionType_ANY=new f,Yn.internal=!1)}).__name__=["nape","callbacks","PreListener"],s.__super__=p,s.prototype=Object.create(p.prototype),s.prototype.zpp_inner_zn=null,s.prototype.get_options1=function(){return this.zpp_inner_zn.options1.outer},s.prototype.set_options1=function(t){return this.zpp_inner_zn.options1.set(t.zpp_inner),this.zpp_inner_zn.options1.outer},s.prototype.get_options2=function(){return this.zpp_inner_zn.options2.outer},s.prototype.set_options2=function(t){return this.zpp_inner_zn.options2.set(t.zpp_inner),this.zpp_inner_zn.options2.outer},s.prototype.get_handler=function(){return this.zpp_inner_zn.handlerp},s.prototype.set_handler=function(t){return this.zpp_inner_zn.handlerp=t,this.zpp_inner_zn.wake(),this.zpp_inner_zn.handlerp},s.prototype.get_pure=function(){return this.zpp_inner_zn.pure},s.prototype.set_pure=function(t){return t||this.zpp_inner_zn.wake(),this.zpp_inner_zn.pure=t,this.zpp_inner_zn.pure},s.prototype.get_interactionType=function(){var t=this.zpp_inner_zn.itype;return 1==t?(null==Yn.InteractionType_COLLISION&&(Yn.internal=!0,Yn.InteractionType_COLLISION=new f,Yn.internal=!1),Yn.InteractionType_COLLISION):2==t?(null==Yn.InteractionType_SENSOR&&(Yn.internal=!0,Yn.InteractionType_SENSOR=new f,Yn.internal=!1),Yn.InteractionType_SENSOR):4==t?(null==Yn.InteractionType_FLUID&&(Yn.internal=!0,Yn.InteractionType_FLUID=new f,Yn.internal=!1),Yn.InteractionType_FLUID):7==t?(null==Yn.InteractionType_ANY&&(Yn.internal=!0,Yn.InteractionType_ANY=new f,Yn.internal=!1),Yn.InteractionType_ANY):null},s.prototype.set_interactionType=function(t){var e=this.zpp_inner_zn.itype,e=1==e?(null==Yn.InteractionType_COLLISION&&(Yn.internal=!0,Yn.InteractionType_COLLISION=new f,Yn.internal=!1),Yn.InteractionType_COLLISION):2==e?(null==Yn.InteractionType_SENSOR&&(Yn.internal=!0,Yn.InteractionType_SENSOR=new f,Yn.internal=!1),Yn.InteractionType_SENSOR):4==e?(null==Yn.InteractionType_FLUID&&(Yn.internal=!0,Yn.InteractionType_FLUID=new f,Yn.internal=!1),Yn.InteractionType_FLUID):7==e?(null==Yn.InteractionType_ANY&&(Yn.internal=!0,Yn.InteractionType_ANY=new f,Yn.internal=!1),Yn.InteractionType_ANY):null;e!=t&&(null==Yn.InteractionType_COLLISION&&(Yn.internal=!0,Yn.InteractionType_COLLISION=new f,Yn.internal=!1),i=t==Yn.InteractionType_COLLISION?1:(null==Yn.InteractionType_SENSOR&&(Yn.internal=!0,Yn.InteractionType_SENSOR=new f,Yn.internal=!1),t==Yn.InteractionType_SENSOR?2:(null==Yn.InteractionType_FLUID&&(Yn.internal=!0,Yn.InteractionType_FLUID=new f,Yn.internal=!1),t==Yn.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=i);var i=this.zpp_inner_zn.itype;return 1==i?(null==Yn.InteractionType_COLLISION&&(Yn.internal=!0,Yn.InteractionType_COLLISION=new f,Yn.internal=!1),Yn.InteractionType_COLLISION):2==i?(null==Yn.InteractionType_SENSOR&&(Yn.internal=!0,Yn.InteractionType_SENSOR=new f,Yn.internal=!1),Yn.InteractionType_SENSOR):4==i?(null==Yn.InteractionType_FLUID&&(Yn.internal=!0,Yn.InteractionType_FLUID=new f,Yn.internal=!1),Yn.InteractionType_FLUID):7==i?(null==Yn.InteractionType_ANY&&(Yn.internal=!0,Yn.InteractionType_ANY=new f,Yn.internal=!1),Yn.InteractionType_ANY):null},Object.defineProperty(s.prototype,"options1",{get:s.prototype.get_options1,set:s.prototype.set_options1}),Object.defineProperty(s.prototype,"options2",{get:s.prototype.get_options2,set:s.prototype.set_options2}),Object.defineProperty(s.prototype,"handler",{get:s.prototype.get_handler,set:s.prototype.set_handler}),Object.defineProperty(s.prototype,"pure",{get:s.prototype.get_pure,set:s.prototype.set_pure}),Object.defineProperty(s.prototype,"interactionType",{get:s.prototype.get_interactionType,set:s.prototype.set_interactionType}),s.prototype.__class__=s;var b=nape.constraint.Constraint=function(){this.debugDraw=!0,this.zpp_inner.insert_cbtype(Mt.ANY_CONSTRAINT.zpp_inner)};b.__name__=["nape","constraint","Constraint"],b.prototype.zpp_inner=null,b.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},b.prototype.debugDraw=null,b.prototype.get_compound=function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},b.prototype.set_compound=function(t){return(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=t&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_constraints.remove(this),null!=t&&((t=t.zpp_inner.wrap_constraints).zpp_inner.reverse_flag?t.push(this):t.unshift(this))),null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},b.prototype.get_space=function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},b.prototype.set_space=function(t){return(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=t&&(null!=this.zpp_inner.component&&(this.zpp_inner.component.woken=!1),this.zpp_inner.clearcache(),null!=this.zpp_inner.space&&this.zpp_inner.space.outer.zpp_inner.wrap_constraints.remove(this),null!=t?(t=t.zpp_inner.wrap_constraints).zpp_inner.reverse_flag?t.push(this):t.unshift(this):this.zpp_inner.space=null),null==this.zpp_inner.space?null:this.zpp_inner.space.outer},b.prototype.get_isSleeping=function(){return this.zpp_inner.component.sleeping},b.prototype.get_active=function(){return this.zpp_inner.active},b.prototype.set_active=function(t){return this.zpp_inner.active!=t&&(null!=this.zpp_inner.component&&(this.zpp_inner.component.woken=!1),this.zpp_inner.clearcache(),t?(this.zpp_inner.active=t,this.zpp_inner.activate(),null!=this.zpp_inner.space&&(null!=this.zpp_inner.component&&(this.zpp_inner.component.sleeping=!0),this.zpp_inner.space.wake_constraint(this.zpp_inner,!0))):(null!=this.zpp_inner.space&&(this.zpp_inner.wake(),this.zpp_inner.space.live_constraints.remove(this.zpp_inner)),this.zpp_inner.active=t,this.zpp_inner.deactivate())),this.zpp_inner.active},b.prototype.get_ignore=function(){return this.zpp_inner.ignore},b.prototype.set_ignore=function(t){return this.zpp_inner.ignore!=t&&(this.zpp_inner.ignore=t,this.zpp_inner.wake()),this.zpp_inner.ignore},b.prototype.get_stiff=function(){return this.zpp_inner.stiff},b.prototype.set_stiff=function(t){return this.zpp_inner.stiff!=t&&(this.zpp_inner.stiff=t,this.zpp_inner.wake()),this.zpp_inner.stiff},b.prototype.get_frequency=function(){return this.zpp_inner.frequency},b.prototype.set_frequency=function(t){return this.zpp_inner.frequency!=t&&(this.zpp_inner.frequency=t,this.zpp_inner.stiff||this.zpp_inner.wake()),this.zpp_inner.frequency},b.prototype.get_damping=function(){return this.zpp_inner.damping},b.prototype.set_damping=function(t){return this.zpp_inner.damping!=t&&(this.zpp_inner.damping=t,this.zpp_inner.stiff||this.zpp_inner.wake()),this.zpp_inner.damping},b.prototype.get_maxForce=function(){return this.zpp_inner.maxForce},b.prototype.set_maxForce=function(t){return this.zpp_inner.maxForce!=t&&(this.zpp_inner.maxForce=t,this.zpp_inner.wake()),this.zpp_inner.maxForce},b.prototype.get_maxError=function(){return this.zpp_inner.maxError},b.prototype.set_maxError=function(t){return this.zpp_inner.maxError!=t&&(this.zpp_inner.maxError=t,this.zpp_inner.wake()),this.zpp_inner.maxError},b.prototype.get_breakUnderForce=function(){return this.zpp_inner.breakUnderForce},b.prototype.set_breakUnderForce=function(t){return this.zpp_inner.breakUnderForce!=t&&(this.zpp_inner.breakUnderForce=t,this.zpp_inner.wake()),this.zpp_inner.breakUnderForce},b.prototype.get_breakUnderError=function(){return this.zpp_inner.breakUnderError},b.prototype.set_breakUnderError=function(t){return this.zpp_inner.breakUnderError!=t&&(this.zpp_inner.breakUnderError=t,this.zpp_inner.wake()),this.zpp_inner.breakUnderError},b.prototype.get_removeOnBreak=function(){return this.zpp_inner.removeOnBreak},b.prototype.set_removeOnBreak=function(t){return this.zpp_inner.removeOnBreak=t,this.zpp_inner.removeOnBreak},b.prototype.impulse=function(){return null},b.prototype.bodyImpulse=function(t){return null},b.prototype.visitBodies=function(t){},b.prototype.get_cbTypes=function(){return null==this.zpp_inner.wrap_cbTypes&&this.zpp_inner.setupcbTypes(),this.zpp_inner.wrap_cbTypes},b.prototype.toString=function(){return"{Constraint}"},b.prototype.copy=function(){return this.zpp_inner.copy()},Object.defineProperty(b.prototype,"userData",{get:b.prototype.get_userData}),Object.defineProperty(b.prototype,"compound",{get:b.prototype.get_compound,set:b.prototype.set_compound}),Object.defineProperty(b.prototype,"space",{get:b.prototype.get_space,set:b.prototype.set_space}),Object.defineProperty(b.prototype,"isSleeping",{get:b.prototype.get_isSleeping}),Object.defineProperty(b.prototype,"active",{get:b.prototype.get_active,set:b.prototype.set_active}),Object.defineProperty(b.prototype,"ignore",{get:b.prototype.get_ignore,set:b.prototype.set_ignore}),Object.defineProperty(b.prototype,"stiff",{get:b.prototype.get_stiff,set:b.prototype.set_stiff}),Object.defineProperty(b.prototype,"frequency",{get:b.prototype.get_frequency,set:b.prototype.set_frequency}),Object.defineProperty(b.prototype,"damping",{get:b.prototype.get_damping,set:b.prototype.set_damping}),Object.defineProperty(b.prototype,"maxForce",{get:b.prototype.get_maxForce,set:b.prototype.set_maxForce}),Object.defineProperty(b.prototype,"maxError",{get:b.prototype.get_maxError,set:b.prototype.set_maxError}),Object.defineProperty(b.prototype,"breakUnderForce",{get:b.prototype.get_breakUnderForce,set:b.prototype.set_breakUnderForce}),Object.defineProperty(b.prototype,"breakUnderError",{get:b.prototype.get_breakUnderError,set:b.prototype.set_breakUnderError}),Object.defineProperty(b.prototype,"removeOnBreak",{get:b.prototype.get_removeOnBreak,set:b.prototype.set_removeOnBreak}),Object.defineProperty(b.prototype,"cbTypes",{get:b.prototype.get_cbTypes}),b.prototype.__class__=b;var z=nape.constraint.AngleJoint=function(t,e,i,n,r){null==r&&(r=1),this.zpp_inner_zn=null,this.zpp_inner_zn=new Bt,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,b.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");t=null==t?null:t.zpp_inner;t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");e=null==e?null:e.zpp_inner;e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),this.zpp_inner.immutable_midstep("AngleJoint::jointMin"),this.zpp_inner_zn.jointMin!=i&&(this.zpp_inner_zn.jointMin=i,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("AngleJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("AngleJoint::ratio"),this.zpp_inner_zn.ratio!=r&&(this.zpp_inner_zn.ratio=r,this.zpp_inner.wake())};z.__name__=["nape","constraint","AngleJoint"],z.__super__=b,z.prototype=Object.create(b.prototype),z.prototype.zpp_inner_zn=null,z.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},z.prototype.set_body1=function(t){this.zpp_inner.immutable_midstep("Constraint::body1");t=null==t?null:t.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},z.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},z.prototype.set_body2=function(t){this.zpp_inner.immutable_midstep("Constraint::body2");t=null==t?null:t.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},z.prototype.get_jointMin=function(){return this.zpp_inner_zn.jointMin},z.prototype.set_jointMin=function(t){return this.zpp_inner.immutable_midstep("AngleJoint::jointMin"),this.zpp_inner_zn.jointMin!=t&&(this.zpp_inner_zn.jointMin=t,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},z.prototype.get_jointMax=function(){return this.zpp_inner_zn.jointMax},z.prototype.set_jointMax=function(t){return this.zpp_inner.immutable_midstep("AngleJoint::jointMax"),this.zpp_inner_zn.jointMax!=t&&(this.zpp_inner_zn.jointMax=t,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},z.prototype.get_ratio=function(){return this.zpp_inner_zn.ratio},z.prototype.set_ratio=function(t){return this.zpp_inner.immutable_midstep("AngleJoint::ratio"),this.zpp_inner_zn.ratio!=t&&(this.zpp_inner_zn.ratio=t,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},z.prototype.isSlack=function(){var t,e=this.zpp_inner_zn,i=e.ratio*e.b2.rot-e.b1.rot;return e.equal?(t=!1,e.scale=1):t=i<e.jointMin?!(e.scale=-1):i>e.jointMax?(i-=e.jointMax,!(e.scale=1)):!(i=e.scale=0),t},z.prototype.impulse=function(){var t=new V(1,1);return t.zpp_inner.x[0*t.zpp_inner.n]=this.zpp_inner_zn.jAcc,t},z.prototype.bodyImpulse=function(t){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(t.zpp_inner):K.get(0,0,0)},z.prototype.visitBodies=function(t){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(z.prototype,"body1",{get:z.prototype.get_body1,set:z.prototype.set_body1}),Object.defineProperty(z.prototype,"body2",{get:z.prototype.get_body2,set:z.prototype.set_body2}),Object.defineProperty(z.prototype,"jointMin",{get:z.prototype.get_jointMin,set:z.prototype.set_jointMin}),Object.defineProperty(z.prototype,"jointMax",{get:z.prototype.get_jointMax,set:z.prototype.set_jointMax}),Object.defineProperty(z.prototype,"ratio",{get:z.prototype.get_ratio,set:z.prototype.set_ratio}),z.prototype.__class__=z;var Wt=nape.constraint.ConstraintIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Wt.__name__=["nape","constraint","ConstraintIterator"],Wt.get=function(t){var e,i=null==Wt.zpp_pool?(zn.internal=!0,e=new Wt,zn.internal=!1,e):(i=Wt.zpp_pool,Wt.zpp_pool=i.zpp_next,i);return i.zpp_i=0,i.zpp_inner=t,i.zpp_critical=!1,i},Wt.prototype.zpp_inner=null,Wt.prototype.zpp_i=null,Wt.prototype.zpp_critical=null,Wt.prototype.zpp_next=null,Wt.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);t=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=Wt.zpp_pool,(Wt.zpp_pool=this).zpp_inner=null,!1)},Wt.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Wt.prototype.__class__=Wt;var w=nape.constraint.ConstraintList=function(){this.zpp_inner=null,this.zpp_inner=new zn,this.zpp_inner.outer=this};w.__name__=["nape","constraint","ConstraintList"],w.fromArray=function(t){for(var e=new w,i=0;i<t.length;){var n=t[i];++i,e.push(n)}return e},w.prototype.zpp_inner=null,w.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},w.prototype.has=function(t){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(t.zpp_inner)},w.prototype.at=function(t){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.user_length-1-t),t<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=t,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(t);else for(;this.zpp_inner.at_index!=t;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},w.prototype.push=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(t.zpp_inner):(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},w.prototype.unshift=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)):this.zpp_inner.inner.add(t.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},w.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e,i=null;return this.zpp_inner.reverse_flag?(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(i=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.outer},w.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(i=(null==(e=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:e.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)):(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.outer},w.prototype.add=function(t){return this.zpp_inner.reverse_flag?this.push(t):this.unshift(t)},w.prototype.remove=function(t){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==t.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(t.zpp_inner),this.zpp_inner.invalidate()),e},w.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},w.prototype.empty=function(){return null==this.zpp_inner.inner.head},w.prototype.iterator=function(){return this.zpp_inner.valmod(),Wt.get(this)},w.prototype.copy=function(t){null==t&&(t=!1);var e=new w;this.zpp_inner.valmod();for(var i=Wt.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=Wt.zpp_pool,(Wt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e.push(t?null:n)}return e},w.prototype.merge=function(t){t.zpp_inner.valmod();for(var e=Wt.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Wt.zpp_pool,(Wt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);this.has(i)||(this.zpp_inner.reverse_flag?this.push(i):this.unshift(i))}},w.prototype.toString=function(){var t="[",e=!0;this.zpp_inner.valmod();for(var i=Wt.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=Wt.zpp_pool,(Wt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e||(t+=","),t+=null==n?"NULL":n.toString(),e=!1}return t+"]"},w.prototype.foreach=function(t){this.zpp_inner.valmod();for(var e=Wt.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Wt.zpp_pool,(Wt.zpp_pool=e).zpp_inner=null,!1)))break;try{e.zpp_critical=!1,t(e.zpp_inner.at(e.zpp_i++))}catch(t){e.zpp_next=Wt.zpp_pool,(Wt.zpp_pool=e).zpp_inner=null;break}}return this},w.prototype.filter=function(t){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var i=this.at(e);try{t(i)?++e:this.remove(i)}catch(t){break}}return this},Object.defineProperty(w.prototype,"length",{get:w.prototype.get_length}),w.prototype.__class__=w;var C=nape.constraint.DistanceJoint=function(t,e,i,n,r,s){this.zpp_inner_zn=null,this.zpp_inner_zn=new Rt,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,b.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var o=null==t?null:t.zpp_inner;o!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=o,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=o&&this.zpp_inner_zn.b2!=o&&null!=o&&o.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=o&&o.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var a=null==e?null:e.zpp_inner;a!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b1!=a&&null!=a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=a&&a.wake())),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();t=this.zpp_inner_zn.wrap_a1,o=i.zpp_inner;null!=o._validate&&o._validate();e=i.zpp_inner.x,a=i.zpp_inner;null!=a._validate&&a._validate();o=i.zpp_inner.y,a=t.zpp_inner;null!=a._validate&&a._validate(),t.zpp_inner.x==e&&(null!=(a=t.zpp_inner)._validate&&a._validate(),t.zpp_inner.y==o)||(t.zpp_inner.x=e,t.zpp_inner.y=o,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),i.zpp_inner.weak&&(p=i.zpp_inner,i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Rn.poolVec2,Rn.poolVec2=i,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Ir.zpp_pool,Ir.zpp_pool=p),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var t=this.zpp_inner_zn.wrap_a2,l=n.zpp_inner;null!=l._validate&&l._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var h,l=n.zpp_inner.y,p=t.zpp_inner;null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==l)||(t.zpp_inner.x=i,t.zpp_inner.y=l,null!=(h=t.zpp_inner)._invalidate&&h._invalidate(h)),n.zpp_inner.weak&&(h=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Rn.poolVec2,Rn.poolVec2=n,null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=Ir.zpp_pool,Ir.zpp_pool=h),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner.immutable_midstep("DistanceJoint::jointMin"),this.zpp_inner_zn.jointMin!=r&&(this.zpp_inner_zn.jointMin=r,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("DistanceJoint::jointMax"),this.zpp_inner_zn.jointMax!=s&&(this.zpp_inner_zn.jointMax=s,this.zpp_inner.wake())};C.__name__=["nape","constraint","DistanceJoint"],C.__super__=b,C.prototype=Object.create(b.prototype),C.prototype.zpp_inner_zn=null,C.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},C.prototype.set_body1=function(t){this.zpp_inner.immutable_midstep("Constraint::body1");t=null==t?null:t.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},C.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},C.prototype.set_body2=function(t){this.zpp_inner.immutable_midstep("Constraint::body2");t=null==t?null:t.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},C.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},C.prototype.set_anchor1=function(t){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var e=this.zpp_inner_zn.wrap_a1,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},C.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},C.prototype.set_anchor2=function(t){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},C.prototype.get_jointMin=function(){return this.zpp_inner_zn.jointMin},C.prototype.set_jointMin=function(t){return this.zpp_inner.immutable_midstep("DistanceJoint::jointMin"),this.zpp_inner_zn.jointMin!=t&&(this.zpp_inner_zn.jointMin=t,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},C.prototype.get_jointMax=function(){return this.zpp_inner_zn.jointMax},C.prototype.set_jointMax=function(t){return this.zpp_inner.immutable_midstep("DistanceJoint::jointMax"),this.zpp_inner_zn.jointMax!=t&&(this.zpp_inner_zn.jointMax=t,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},C.prototype.isSlack=function(){return this.zpp_inner_zn.slack},C.prototype.impulse=function(){var t=new V(1,1);return t.zpp_inner.x[0*t.zpp_inner.n]=this.zpp_inner_zn.jAcc,t},C.prototype.bodyImpulse=function(t){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(t.zpp_inner):K.get()},C.prototype.visitBodies=function(t){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(C.prototype,"body1",{get:C.prototype.get_body1,set:C.prototype.set_body1}),Object.defineProperty(C.prototype,"body2",{get:C.prototype.get_body2,set:C.prototype.set_body2}),Object.defineProperty(C.prototype,"anchor1",{get:C.prototype.get_anchor1,set:C.prototype.set_anchor1}),Object.defineProperty(C.prototype,"anchor2",{get:C.prototype.get_anchor2,set:C.prototype.set_anchor2}),Object.defineProperty(C.prototype,"jointMin",{get:C.prototype.get_jointMin,set:C.prototype.set_jointMin}),Object.defineProperty(C.prototype,"jointMax",{get:C.prototype.get_jointMax,set:C.prototype.set_jointMax}),C.prototype.__class__=C;var P=nape.constraint.LineJoint=function(t,e,i,n,r,s,o){this.zpp_inner_zn=null,this.zpp_inner_zn=new Ft,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,b.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var a=null==t?null:t.zpp_inner;a!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b2!=a&&null!=a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=a&&a.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var l=null==e?null:e.zpp_inner;l!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=l,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=l&&this.zpp_inner_zn.b1!=l&&null!=l&&l.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=l&&l.wake())),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();t=this.zpp_inner_zn.wrap_a1,a=i.zpp_inner;null!=a._validate&&a._validate();e=i.zpp_inner.x,l=i.zpp_inner;null!=l._validate&&l._validate();a=i.zpp_inner.y,l=t.zpp_inner;null!=l._validate&&l._validate(),t.zpp_inner.x==e&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=e,t.zpp_inner.y=a,null!=(p=t.zpp_inner)._invalidate&&p._invalidate(p)),i.zpp_inner.weak&&(h=i.zpp_inner,i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Rn.poolVec2,Rn.poolVec2=i,null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=Ir.zpp_pool,Ir.zpp_pool=h),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var t=this.zpp_inner_zn.wrap_a2,p=n.zpp_inner;null!=p._validate&&p._validate();var i=n.zpp_inner.x,h=n.zpp_inner;null!=h._validate&&h._validate();p=n.zpp_inner.y,h=t.zpp_inner;null!=h._validate&&h._validate(),t.zpp_inner.x==i&&(null!=(h=t.zpp_inner)._validate&&h._validate(),t.zpp_inner.y==p)||(t.zpp_inner.x=i,t.zpp_inner.y=p,null!=(u=t.zpp_inner)._invalidate&&u._invalidate(u)),n.zpp_inner.weak&&(c=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Rn.poolVec2,Rn.poolVec2=n,null!=c.outer&&(c.outer.zpp_inner=null,c.outer=null),c._isimmutable=null,c._validate=null,c._invalidate=null,c.next=Ir.zpp_pool,Ir.zpp_pool=c),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n();var t=this.zpp_inner_zn.wrap_n,u=r.zpp_inner;null!=u._validate&&u._validate();var n=r.zpp_inner.x,c=r.zpp_inner;null!=c._validate&&c._validate();var d,u=r.zpp_inner.y,c=t.zpp_inner;null!=c._validate&&c._validate(),t.zpp_inner.x==n&&(null!=(c=t.zpp_inner)._validate&&c._validate(),t.zpp_inner.y==u)||(t.zpp_inner.x=n,t.zpp_inner.y=u,null!=(d=t.zpp_inner)._invalidate&&d._invalidate(d)),r.zpp_inner.weak&&(d=r.zpp_inner,r.zpp_inner.outer=null,r.zpp_inner=null,r.zpp_pool=Rn.poolVec2,Rn.poolVec2=r,null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=Ir.zpp_pool,Ir.zpp_pool=d),null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner.immutable_midstep("LineJoint::jointMin"),this.zpp_inner_zn.jointMin!=s&&(this.zpp_inner_zn.jointMin=s,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("LineJoint::jointMax"),this.zpp_inner_zn.jointMax!=o&&(this.zpp_inner_zn.jointMax=o,this.zpp_inner.wake())};P.__name__=["nape","constraint","LineJoint"],P.__super__=b,P.prototype=Object.create(b.prototype),P.prototype.zpp_inner_zn=null,P.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},P.prototype.set_body1=function(t){this.zpp_inner.immutable_midstep("Constraint::body1");t=null==t?null:t.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},P.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},P.prototype.set_body2=function(t){this.zpp_inner.immutable_midstep("Constraint::body2");t=null==t?null:t.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},P.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},P.prototype.set_anchor1=function(t){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var e=this.zpp_inner_zn.wrap_a1,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},P.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},P.prototype.set_anchor2=function(t){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},P.prototype.get_direction=function(){return null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner_zn.wrap_n},P.prototype.set_direction=function(t){null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n();var e=this.zpp_inner_zn.wrap_n,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner_zn.wrap_n},P.prototype.get_jointMin=function(){return this.zpp_inner_zn.jointMin},P.prototype.set_jointMin=function(t){return this.zpp_inner.immutable_midstep("LineJoint::jointMin"),this.zpp_inner_zn.jointMin!=t&&(this.zpp_inner_zn.jointMin=t,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},P.prototype.get_jointMax=function(){return this.zpp_inner_zn.jointMax},P.prototype.set_jointMax=function(t){return this.zpp_inner.immutable_midstep("LineJoint::jointMax"),this.zpp_inner_zn.jointMax!=t&&(this.zpp_inner_zn.jointMax=t,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},P.prototype.impulse=function(){var t=new V(2,1);return t.zpp_inner.x[0*t.zpp_inner.n]=this.zpp_inner_zn.jAccx,t.zpp_inner.x[t.zpp_inner.n]=this.zpp_inner_zn.jAccy,t},P.prototype.bodyImpulse=function(t){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(t.zpp_inner):K.get()},P.prototype.visitBodies=function(t){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(P.prototype,"body1",{get:P.prototype.get_body1,set:P.prototype.set_body1}),Object.defineProperty(P.prototype,"body2",{get:P.prototype.get_body2,set:P.prototype.set_body2}),Object.defineProperty(P.prototype,"anchor1",{get:P.prototype.get_anchor1,set:P.prototype.set_anchor1}),Object.defineProperty(P.prototype,"anchor2",{get:P.prototype.get_anchor2,set:P.prototype.set_anchor2}),Object.defineProperty(P.prototype,"direction",{get:P.prototype.get_direction,set:P.prototype.set_direction}),Object.defineProperty(P.prototype,"jointMin",{get:P.prototype.get_jointMin,set:P.prototype.set_jointMin}),Object.defineProperty(P.prototype,"jointMax",{get:P.prototype.get_jointMax,set:P.prototype.set_jointMax}),P.prototype.__class__=P;var T=nape.constraint.MotorJoint=function(t,e,i,n){null==n&&(n=1),null==i&&(i=0),this.zpp_inner_zn=null,this.zpp_inner_zn=new jt,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,b.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");t=null==t?null:t.zpp_inner;t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");e=null==e?null:e.zpp_inner;e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),this.zpp_inner.immutable_midstep("MotorJoint::rate"),this.zpp_inner_zn.rate!=i&&(this.zpp_inner_zn.rate=i,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("MotorJoint::ratio"),this.zpp_inner_zn.ratio!=n&&(this.zpp_inner_zn.ratio=n,this.zpp_inner.wake())};T.__name__=["nape","constraint","MotorJoint"],T.__super__=b,T.prototype=Object.create(b.prototype),T.prototype.zpp_inner_zn=null,T.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},T.prototype.set_body1=function(t){this.zpp_inner.immutable_midstep("Constraint::body1");t=null==t?null:t.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},T.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},T.prototype.set_body2=function(t){this.zpp_inner.immutable_midstep("Constraint::body2");t=null==t?null:t.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},T.prototype.get_ratio=function(){return this.zpp_inner_zn.ratio},T.prototype.set_ratio=function(t){return this.zpp_inner.immutable_midstep("MotorJoint::ratio"),this.zpp_inner_zn.ratio!=t&&(this.zpp_inner_zn.ratio=t,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},T.prototype.get_rate=function(){return this.zpp_inner_zn.rate},T.prototype.set_rate=function(t){return this.zpp_inner.immutable_midstep("MotorJoint::rate"),this.zpp_inner_zn.rate!=t&&(this.zpp_inner_zn.rate=t,this.zpp_inner.wake()),this.zpp_inner_zn.rate},T.prototype.impulse=function(){var t=new V(1,1);return t.zpp_inner.x[0*t.zpp_inner.n]=this.zpp_inner_zn.jAcc,t},T.prototype.bodyImpulse=function(t){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(t.zpp_inner):K.get()},T.prototype.visitBodies=function(t){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(T.prototype,"body1",{get:T.prototype.get_body1,set:T.prototype.set_body1}),Object.defineProperty(T.prototype,"body2",{get:T.prototype.get_body2,set:T.prototype.set_body2}),Object.defineProperty(T.prototype,"ratio",{get:T.prototype.get_ratio,set:T.prototype.set_ratio}),Object.defineProperty(T.prototype,"rate",{get:T.prototype.get_rate,set:T.prototype.set_rate}),T.prototype.__class__=T;var S=nape.constraint.PivotJoint=function(t,e,i,n){this.zpp_inner_zn=null,this.zpp_inner_zn=new Nt,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,b.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var r=null==t?null:t.zpp_inner;r!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=r,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=r&&this.zpp_inner_zn.b2!=r&&null!=r&&r.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=r&&r.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var s=null==e?null:e.zpp_inner;s!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=s,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=s&&this.zpp_inner_zn.b1!=s&&null!=s&&s.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=s&&s.wake())),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();t=this.zpp_inner_zn.wrap_a1,r=i.zpp_inner;null!=r._validate&&r._validate();e=i.zpp_inner.x,s=i.zpp_inner;null!=s._validate&&s._validate();r=i.zpp_inner.y,s=t.zpp_inner;null!=s._validate&&s._validate(),t.zpp_inner.x==e&&(null!=(s=t.zpp_inner)._validate&&s._validate(),t.zpp_inner.y==r)||(t.zpp_inner.x=e,t.zpp_inner.y=r,null!=(o=t.zpp_inner)._invalidate&&o._invalidate(o)),i.zpp_inner.weak&&(a=i.zpp_inner,i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Rn.poolVec2,Rn.poolVec2=i,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ir.zpp_pool,Ir.zpp_pool=a),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var t=this.zpp_inner_zn.wrap_a2,o=n.zpp_inner;null!=o._validate&&o._validate();var i=n.zpp_inner.x,a=n.zpp_inner;null!=a._validate&&a._validate();var l,o=n.zpp_inner.y,a=t.zpp_inner;null!=a._validate&&a._validate(),t.zpp_inner.x==i&&(null!=(a=t.zpp_inner)._validate&&a._validate(),t.zpp_inner.y==o)||(t.zpp_inner.x=i,t.zpp_inner.y=o,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Rn.poolVec2,Rn.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ir.zpp_pool,Ir.zpp_pool=l),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2()};S.__name__=["nape","constraint","PivotJoint"],S.__super__=b,S.prototype=Object.create(b.prototype),S.prototype.zpp_inner_zn=null,S.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},S.prototype.set_body1=function(t){this.zpp_inner.immutable_midstep("Constraint::body1");t=null==t?null:t.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},S.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},S.prototype.set_body2=function(t){this.zpp_inner.immutable_midstep("Constraint::body2");t=null==t?null:t.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},S.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},S.prototype.set_anchor1=function(t){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var e=this.zpp_inner_zn.wrap_a1,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},S.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},S.prototype.set_anchor2=function(t){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},S.prototype.impulse=function(){var t=new V(2,1);return t.zpp_inner.x[0*t.zpp_inner.n]=this.zpp_inner_zn.jAccx,t.zpp_inner.x[t.zpp_inner.n]=this.zpp_inner_zn.jAccy,t},S.prototype.bodyImpulse=function(t){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(t.zpp_inner):K.get()},S.prototype.visitBodies=function(t){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(S.prototype,"body1",{get:S.prototype.get_body1,set:S.prototype.set_body1}),Object.defineProperty(S.prototype,"body2",{get:S.prototype.get_body2,set:S.prototype.set_body2}),Object.defineProperty(S.prototype,"anchor1",{get:S.prototype.get_anchor1,set:S.prototype.set_anchor1}),Object.defineProperty(S.prototype,"anchor2",{get:S.prototype.get_anchor2,set:S.prototype.set_anchor2}),S.prototype.__class__=S;var M=nape.constraint.PulleyJoint=function(t,e,i,n,r,s,o,a,l,p,h){null==h&&(h=1),this.zpp_inner_zn=null,this.zpp_inner_zn=new Gt,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,b.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");t=null==t?null:t.zpp_inner;t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&this.zpp_inner_zn.b3!=t&&this.zpp_inner_zn.b4!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");t=null==e?null:e.zpp_inner;t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&this.zpp_inner_zn.b3!=t&&this.zpp_inner_zn.b4!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),this.zpp_inner.immutable_midstep("Constraint::body3");e=null==i?null:i.zpp_inner;e!=this.zpp_inner_zn.b3&&(null!=this.zpp_inner_zn.b3&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b3&&null!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b3.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b3.wake()),this.zpp_inner_zn.b3=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&this.zpp_inner_zn.b2!=e&&this.zpp_inner_zn.b4!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),this.zpp_inner.immutable_midstep("Constraint::body4");t=null==n?null:n.zpp_inner;t!=this.zpp_inner_zn.b4&&(null!=this.zpp_inner_zn.b4&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b4&&null!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b4.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b4.wake()),this.zpp_inner_zn.b4=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&this.zpp_inner_zn.b2!=t&&this.zpp_inner_zn.b3!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();i=this.zpp_inner_zn.wrap_a1,e=r.zpp_inner;null!=e._validate&&e._validate();n=r.zpp_inner.x,t=r.zpp_inner;null!=t._validate&&t._validate();e=r.zpp_inner.y,t=i.zpp_inner;null!=t._validate&&t._validate(),i.zpp_inner.x==n&&(null!=(t=i.zpp_inner)._validate&&t._validate(),i.zpp_inner.y==e)||(i.zpp_inner.x=n,i.zpp_inner.y=e,null!=(u=i.zpp_inner)._invalidate&&u._invalidate(u)),r.zpp_inner.weak&&(c=r.zpp_inner,r.zpp_inner.outer=null,r.zpp_inner=null,r.zpp_pool=Rn.poolVec2,Rn.poolVec2=r,null!=c.outer&&(c.outer.zpp_inner=null,c.outer=null),c._isimmutable=null,c._validate=null,c._invalidate=null,c.next=Ir.zpp_pool,Ir.zpp_pool=c),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var i=this.zpp_inner_zn.wrap_a2,u=s.zpp_inner;null!=u._validate&&u._validate();var r=s.zpp_inner.x,c=s.zpp_inner;null!=c._validate&&c._validate();u=s.zpp_inner.y,c=i.zpp_inner;null!=c._validate&&c._validate(),i.zpp_inner.x==r&&(null!=(c=i.zpp_inner)._validate&&c._validate(),i.zpp_inner.y==u)||(i.zpp_inner.x=r,i.zpp_inner.y=u,null!=(d=i.zpp_inner)._invalidate&&d._invalidate(d)),s.zpp_inner.weak&&(_=s.zpp_inner,s.zpp_inner.outer=null,s.zpp_inner=null,s.zpp_pool=Rn.poolVec2,Rn.poolVec2=s,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=Ir.zpp_pool,Ir.zpp_pool=_),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3();var i=this.zpp_inner_zn.wrap_a3,d=o.zpp_inner;null!=d._validate&&d._validate();var s=o.zpp_inner.x,_=o.zpp_inner;null!=_._validate&&_._validate();d=o.zpp_inner.y,_=i.zpp_inner;null!=_._validate&&_._validate(),i.zpp_inner.x==s&&(null!=(_=i.zpp_inner)._validate&&_._validate(),i.zpp_inner.y==d)||(i.zpp_inner.x=s,i.zpp_inner.y=d,null!=(y=i.zpp_inner)._invalidate&&y._invalidate(y)),o.zpp_inner.weak&&(f=o.zpp_inner,o.zpp_inner.outer=null,o.zpp_inner=null,o.zpp_pool=Rn.poolVec2,Rn.poolVec2=o,null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=Ir.zpp_pool,Ir.zpp_pool=f),null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4();var i=this.zpp_inner_zn.wrap_a4,y=a.zpp_inner;null!=y._validate&&y._validate();var o=a.zpp_inner.x,f=a.zpp_inner;null!=f._validate&&f._validate();var m,y=a.zpp_inner.y,f=i.zpp_inner;null!=f._validate&&f._validate(),i.zpp_inner.x==o&&(null!=(f=i.zpp_inner)._validate&&f._validate(),i.zpp_inner.y==y)||(i.zpp_inner.x=o,i.zpp_inner.y=y,null!=(m=i.zpp_inner)._invalidate&&m._invalidate(m)),a.zpp_inner.weak&&(m=a.zpp_inner,a.zpp_inner.outer=null,a.zpp_inner=null,a.zpp_pool=Rn.poolVec2,Rn.poolVec2=a,null!=m.outer&&(m.outer.zpp_inner=null,m.outer=null),m._isimmutable=null,m._validate=null,m._invalidate=null,m.next=Ir.zpp_pool,Ir.zpp_pool=m),null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner.immutable_midstep("PulleyJoint::ratio"),this.zpp_inner_zn.ratio!=h&&(this.zpp_inner_zn.ratio=h,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("PulleyJoint::jointMin"),this.zpp_inner_zn.jointMin!=l&&(this.zpp_inner_zn.jointMin=l,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("PulleyJoint::jointMax"),this.zpp_inner_zn.jointMax!=p&&(this.zpp_inner_zn.jointMax=p,this.zpp_inner.wake())};M.__name__=["nape","constraint","PulleyJoint"],M.__super__=b,M.prototype=Object.create(b.prototype),M.prototype.zpp_inner_zn=null,M.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},M.prototype.set_body1=function(t){this.zpp_inner.immutable_midstep("Constraint::body1");t=null==t?null:t.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&this.zpp_inner_zn.b3!=t&&this.zpp_inner_zn.b4!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},M.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},M.prototype.set_body2=function(t){this.zpp_inner.immutable_midstep("Constraint::body2");t=null==t?null:t.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&this.zpp_inner_zn.b3!=t&&this.zpp_inner_zn.b4!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},M.prototype.get_body3=function(){return null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer},M.prototype.set_body3=function(t){this.zpp_inner.immutable_midstep("Constraint::body3");t=null==t?null:t.zpp_inner;return t!=this.zpp_inner_zn.b3&&(null!=this.zpp_inner_zn.b3&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b3&&null!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b3.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b3.wake()),this.zpp_inner_zn.b3=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&this.zpp_inner_zn.b2!=t&&this.zpp_inner_zn.b4!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer},M.prototype.get_body4=function(){return null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer},M.prototype.set_body4=function(t){this.zpp_inner.immutable_midstep("Constraint::body4");t=null==t?null:t.zpp_inner;return t!=this.zpp_inner_zn.b4&&(null!=this.zpp_inner_zn.b4&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b4&&null!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b4.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b4.wake()),this.zpp_inner_zn.b4=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&this.zpp_inner_zn.b2!=t&&this.zpp_inner_zn.b3!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer},M.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},M.prototype.set_anchor1=function(t){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var e=this.zpp_inner_zn.wrap_a1,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},M.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},M.prototype.set_anchor2=function(t){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},M.prototype.get_anchor3=function(){return null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),this.zpp_inner_zn.wrap_a3},M.prototype.set_anchor3=function(t){null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3();var e=this.zpp_inner_zn.wrap_a3,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),this.zpp_inner_zn.wrap_a3},M.prototype.get_anchor4=function(){return null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner_zn.wrap_a4},M.prototype.set_anchor4=function(t){null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4();var e=this.zpp_inner_zn.wrap_a4,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner_zn.wrap_a4},M.prototype.get_jointMin=function(){return this.zpp_inner_zn.jointMin},M.prototype.set_jointMin=function(t){return this.zpp_inner.immutable_midstep("PulleyJoint::jointMin"),this.zpp_inner_zn.jointMin!=t&&(this.zpp_inner_zn.jointMin=t,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},M.prototype.get_jointMax=function(){return this.zpp_inner_zn.jointMax},M.prototype.set_jointMax=function(t){return this.zpp_inner.immutable_midstep("PulleyJoint::jointMax"),this.zpp_inner_zn.jointMax!=t&&(this.zpp_inner_zn.jointMax=t,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},M.prototype.get_ratio=function(){return this.zpp_inner_zn.ratio},M.prototype.set_ratio=function(t){return this.zpp_inner.immutable_midstep("PulleyJoint::ratio"),this.zpp_inner_zn.ratio!=t&&(this.zpp_inner_zn.ratio=t,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},M.prototype.isSlack=function(){return this.zpp_inner_zn.slack},M.prototype.impulse=function(){var t=new V(1,1);return t.zpp_inner.x[0*t.zpp_inner.n]=this.zpp_inner_zn.jAcc,t},M.prototype.bodyImpulse=function(t){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(t.zpp_inner):K.get()},M.prototype.visitBodies=function(t){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer),null!=(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)&&(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&t(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer),null!=(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)&&t(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)},Object.defineProperty(M.prototype,"body1",{get:M.prototype.get_body1,set:M.prototype.set_body1}),Object.defineProperty(M.prototype,"body2",{get:M.prototype.get_body2,set:M.prototype.set_body2}),Object.defineProperty(M.prototype,"body3",{get:M.prototype.get_body3,set:M.prototype.set_body3}),Object.defineProperty(M.prototype,"body4",{get:M.prototype.get_body4,set:M.prototype.set_body4}),Object.defineProperty(M.prototype,"anchor1",{get:M.prototype.get_anchor1,set:M.prototype.set_anchor1}),Object.defineProperty(M.prototype,"anchor2",{get:M.prototype.get_anchor2,set:M.prototype.set_anchor2}),Object.defineProperty(M.prototype,"anchor3",{get:M.prototype.get_anchor3,set:M.prototype.set_anchor3}),Object.defineProperty(M.prototype,"anchor4",{get:M.prototype.get_anchor4,set:M.prototype.set_anchor4}),Object.defineProperty(M.prototype,"jointMin",{get:M.prototype.get_jointMin,set:M.prototype.set_jointMin}),Object.defineProperty(M.prototype,"jointMax",{get:M.prototype.get_jointMax,set:M.prototype.set_jointMax}),Object.defineProperty(M.prototype,"ratio",{get:M.prototype.get_ratio,set:M.prototype.set_ratio}),M.prototype.__class__=M,(d=nape.constraint.UserConstraint=function(t,e){null==e&&(e=!1),this.zpp_inner_zn=null,this.zpp_inner_zn=new Ut(t,e),this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,b.call(this)}).__name__=["nape","constraint","UserConstraint"],d.__super__=b,d.prototype=Object.create(b.prototype),d.prototype.zpp_inner_zn=null,d.prototype.__bindVec2=function(){var t=new Ct;return t.zpp_inner._inuse=!0,t.zpp_inner._invalidate=Z(a=this.zpp_inner_zn,a.bindVec2_invalidate),t},d.prototype.__copy=function(){return null},d.prototype.__broken=function(){},d.prototype.__validate=function(){},d.prototype.__draw=function(t){},d.prototype.__prepare=function(){},d.prototype.__position=function(t){},d.prototype.__velocity=function(t){},d.prototype.__eff_mass=function(t){},d.prototype.__clamp=function(t){},d.prototype.__impulse=function(t,e,i){},d.prototype.impulse=function(){for(var t=new V(this.zpp_inner_zn.dim,1),e=0,i=this.zpp_inner_zn.dim;e<i;){var n=e++;t.zpp_inner.x[n*t.zpp_inner.n]=this.zpp_inner_zn.jAcc[n]}return t},d.prototype.bodyImpulse=function(t){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(t.zpp_inner):K.get()},d.prototype.visitBodies=function(t){for(var e=0,i=this.zpp_inner_zn.bodies.length;e<i;){var n=this.zpp_inner_zn.bodies[e];if(null!=n.body){for(var r=!1,s=e+1;s<i;)if(this.zpp_inner_zn.bodies[s++].body==n.body){r=!0;break}r||t(n.body.outer)}++e}},d.prototype.__invalidate=function(){this.zpp_inner.immutable_midstep("UserConstraint::invalidate()"),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner.wake()},d.prototype.__registerBody=function(t,e){return this.zpp_inner.immutable_midstep("UserConstraint::registerBody(..)"),t!=e&&(null!=t&&(this.zpp_inner_zn.remBody(t.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&t.zpp_inner.wake()),null!=e&&this.zpp_inner_zn.addBody(e.zpp_inner),this.zpp_inner.wake(),null!=e&&e.zpp_inner.wake()),e},d.prototype.__class__=d;var A=nape.constraint.WeldJoint=function(t,e,i,n,r){null==r&&(r=0),this.zpp_inner_zn=null,this.zpp_inner_zn=new oe,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,b.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var s=null==t?null:t.zpp_inner;s!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=s,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=s&&this.zpp_inner_zn.b2!=s&&null!=s&&s.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=s&&s.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var o=null==e?null:e.zpp_inner;o!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=o,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=o&&this.zpp_inner_zn.b1!=o&&null!=o&&o.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=o&&o.wake())),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();t=this.zpp_inner_zn.wrap_a1,s=i.zpp_inner;null!=s._validate&&s._validate();e=i.zpp_inner.x,o=i.zpp_inner;null!=o._validate&&o._validate();s=i.zpp_inner.y,o=t.zpp_inner;null!=o._validate&&o._validate(),t.zpp_inner.x==e&&(null!=(o=t.zpp_inner)._validate&&o._validate(),t.zpp_inner.y==s)||(t.zpp_inner.x=e,t.zpp_inner.y=s,null!=(a=t.zpp_inner)._invalidate&&a._invalidate(a)),i.zpp_inner.weak&&(l=i.zpp_inner,i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Rn.poolVec2,Rn.poolVec2=i,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ir.zpp_pool,Ir.zpp_pool=l),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var t=this.zpp_inner_zn.wrap_a2,a=n.zpp_inner;null!=a._validate&&a._validate();var i=n.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var p,a=n.zpp_inner.y,l=t.zpp_inner;null!=l._validate&&l._validate(),t.zpp_inner.x==i&&(null!=(l=t.zpp_inner)._validate&&l._validate(),t.zpp_inner.y==a)||(t.zpp_inner.x=i,t.zpp_inner.y=a,null!=(p=t.zpp_inner)._invalidate&&p._invalidate(p)),n.zpp_inner.weak&&(p=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Rn.poolVec2,Rn.poolVec2=n,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Ir.zpp_pool,Ir.zpp_pool=p),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner.immutable_midstep("WeldJoint::phase"),this.zpp_inner_zn.phase!=r&&(this.zpp_inner_zn.phase=r,this.zpp_inner.wake())};A.__name__=["nape","constraint","WeldJoint"],A.__super__=b,A.prototype=Object.create(b.prototype),A.prototype.zpp_inner_zn=null,A.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},A.prototype.set_body1=function(t){this.zpp_inner.immutable_midstep("Constraint::body1");t=null==t?null:t.zpp_inner;return t!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b2!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},A.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},A.prototype.set_body2=function(t){this.zpp_inner.immutable_midstep("Constraint::body2");t=null==t?null:t.zpp_inner;return t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},A.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},A.prototype.set_anchor1=function(t){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var e=this.zpp_inner_zn.wrap_a1,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},A.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},A.prototype.set_anchor2=function(t){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},A.prototype.get_phase=function(){return this.zpp_inner_zn.phase},A.prototype.set_phase=function(t){return this.zpp_inner.immutable_midstep("WeldJoint::phase"),this.zpp_inner_zn.phase!=t&&(this.zpp_inner_zn.phase=t,this.zpp_inner.wake()),this.zpp_inner_zn.phase},A.prototype.impulse=function(){var t=new V(3,1);return t.zpp_inner.x[0*t.zpp_inner.n]=this.zpp_inner_zn.jAccx,t.zpp_inner.x[t.zpp_inner.n]=this.zpp_inner_zn.jAccy,t.zpp_inner.x[t.zpp_inner.n]=this.zpp_inner_zn.jAccz,t},A.prototype.bodyImpulse=function(t){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(t.zpp_inner):K.get()},A.prototype.visitBodies=function(t){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&t(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(A.prototype,"body1",{get:A.prototype.get_body1,set:A.prototype.set_body1}),Object.defineProperty(A.prototype,"body2",{get:A.prototype.get_body2,set:A.prototype.set_body2}),Object.defineProperty(A.prototype,"anchor1",{get:A.prototype.get_anchor1,set:A.prototype.set_anchor1}),Object.defineProperty(A.prototype,"anchor2",{get:A.prototype.get_anchor2,set:A.prototype.set_anchor2}),Object.defineProperty(A.prototype,"phase",{get:A.prototype.get_phase,set:A.prototype.set_phase}),A.prototype.__class__=A;var O=nape.dynamics.Arbiter=function(){this.zpp_inner=null};O.__name__=["nape","dynamics","Arbiter"],O.prototype.zpp_inner=null,O.prototype.get_isSleeping=function(){return this.zpp_inner.sleeping},O.prototype.get_type=function(){return Qe.types[this.zpp_inner.type]},O.prototype.isCollisionArbiter=function(){return this.zpp_inner.type==Qe.COL},O.prototype.isFluidArbiter=function(){return this.zpp_inner.type==Qe.FLUID},O.prototype.isSensorArbiter=function(){return this.zpp_inner.type==Qe.SENSOR},O.prototype.get_collisionArbiter=function(){return this.zpp_inner.type==Qe.COL?this.zpp_inner.colarb.outer_zn:null},O.prototype.get_fluidArbiter=function(){return this.zpp_inner.type==Qe.FLUID?this.zpp_inner.fluidarb.outer_zn:null},O.prototype.get_shape1=function(){return(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2:this.zpp_inner.ws1).outer},O.prototype.get_shape2=function(){return(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1:this.zpp_inner.ws2).outer},O.prototype.get_body1=function(){return(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2:this.zpp_inner.b1).outer},O.prototype.get_body2=function(){return(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b1:this.zpp_inner.b2).outer},O.prototype.get_state=function(){var t=this.zpp_inner.immState;return 5==t?(null==Yn.PreFlag_ACCEPT&&(Yn.internal=!0,Yn.PreFlag_ACCEPT=new Wn,Yn.internal=!1),Yn.PreFlag_ACCEPT):1==t?(null==Yn.PreFlag_ACCEPT_ONCE&&(Yn.internal=!0,Yn.PreFlag_ACCEPT_ONCE=new Wn,Yn.internal=!1),Yn.PreFlag_ACCEPT_ONCE):6==t?(null==Yn.PreFlag_IGNORE&&(Yn.internal=!0,Yn.PreFlag_IGNORE=new Wn,Yn.internal=!1),Yn.PreFlag_IGNORE):(null==Yn.PreFlag_IGNORE_ONCE&&(Yn.internal=!0,Yn.PreFlag_IGNORE_ONCE=new Wn,Yn.internal=!1),Yn.PreFlag_IGNORE_ONCE)},O.prototype.totalImpulse=function(t,e){return null==e&&(e=!1),K.get(0,0,0)},O.prototype.toString=function(){var t=this.zpp_inner.type==Qe.COL?"CollisionArbiter":this.zpp_inner.type==Qe.FLUID?"FluidArbiter":"SensorArbiter";if(this.zpp_inner.cleared)return t+"(object-pooled)";var e=t+"("+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2:this.zpp_inner.ws1).outer.toString()+"|"+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1:this.zpp_inner.ws2).outer.toString()+")"+(this.zpp_inner.type==Qe.COL?"["+["SD","DD"][this.zpp_inner.colarb.stat?0:1]+"]":"")+"<-",t=this.zpp_inner.immState,t=5==t?(null==Yn.PreFlag_ACCEPT&&(Yn.internal=!0,Yn.PreFlag_ACCEPT=new Wn,Yn.internal=!1),Yn.PreFlag_ACCEPT):1==t?(null==Yn.PreFlag_ACCEPT_ONCE&&(Yn.internal=!0,Yn.PreFlag_ACCEPT_ONCE=new Wn,Yn.internal=!1),Yn.PreFlag_ACCEPT_ONCE):6==t?(null==Yn.PreFlag_IGNORE&&(Yn.internal=!0,Yn.PreFlag_IGNORE=new Wn,Yn.internal=!1),Yn.PreFlag_IGNORE):(null==Yn.PreFlag_IGNORE_ONCE&&(Yn.internal=!0,Yn.PreFlag_IGNORE_ONCE=new Wn,Yn.internal=!1),Yn.PreFlag_IGNORE_ONCE);return e+t.toString()},Object.defineProperty(O.prototype,"isSleeping",{get:O.prototype.get_isSleeping}),Object.defineProperty(O.prototype,"type",{get:O.prototype.get_type}),Object.defineProperty(O.prototype,"collisionArbiter",{get:O.prototype.get_collisionArbiter}),Object.defineProperty(O.prototype,"fluidArbiter",{get:O.prototype.get_fluidArbiter}),Object.defineProperty(O.prototype,"shape1",{get:O.prototype.get_shape1}),Object.defineProperty(O.prototype,"shape2",{get:O.prototype.get_shape2}),Object.defineProperty(O.prototype,"body1",{get:O.prototype.get_body1}),Object.defineProperty(O.prototype,"body2",{get:O.prototype.get_body2}),Object.defineProperty(O.prototype,"state",{get:O.prototype.get_state}),O.prototype.__class__=O;var Ht=nape.dynamics.ArbiterIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Ht.__name__=["nape","dynamics","ArbiterIterator"],Ht.get=function(t){var e,i=null==Ht.zpp_pool?(Bn.internal=!0,e=new Ht,Bn.internal=!1,e):(i=Ht.zpp_pool,Ht.zpp_pool=i.zpp_next,i);return i.zpp_i=0,i.zpp_inner=t,i.zpp_critical=!1,i},Ht.prototype.zpp_inner=null,Ht.prototype.zpp_i=null,Ht.prototype.zpp_critical=null,Ht.prototype.zpp_next=null,Ht.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner.zpp_gl();return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=Ht.zpp_pool,(Ht.zpp_pool=this).zpp_inner=null,!1)},Ht.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Ht.prototype.__class__=Ht;var k=nape.dynamics.ArbiterList=function(){this.zpp_inner=null,this.zpp_inner=new Bn,this.zpp_inner.outer=this};k.__name__=["nape","dynamics","ArbiterList"],k.fromArray=function(t){for(var e=new k,i=0;i<t.length;){var n=t[i];++i,e.push(n)}return e},k.prototype.zpp_inner=null,k.prototype.get_length=function(){return this.zpp_gl()},k.prototype.zpp_gl=function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var t=this.zpp_inner.inner.head;null!=t;)t.elt.active&&this.zpp_inner.user_length++,t=t.next}return this.zpp_inner.user_length},k.prototype.zpp_vm=function(){this.zpp_inner.valmod()},k.prototype.has=function(t){return this.zpp_vm(),this.zpp_inner.inner.has(t.zpp_inner)},k.prototype.at=function(t){if(this.zpp_vm(),this.zpp_inner.reverse_flag&&(t=this.zpp_gl()-1-t),t<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)for(this.zpp_inner.at_index=0,this.zpp_inner.at_ite=this.zpp_inner.inner.head;!this.zpp_inner.at_ite.elt.active;)this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;for(;this.zpp_inner.at_index!=t;)for(this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;!this.zpp_inner.at_ite.elt.active;)this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.wrapper()},k.prototype.push=function(t){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(t.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),e},k.prototype.unshift=function(t){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)):this.zpp_inner.inner.add(t.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),e},k.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_vm();var t,e,i=null;return this.zpp_inner.reverse_flag?(e=(i=this.zpp_inner.inner.head.elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),e=(i=(null==(t=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2))?this.zpp_inner.inner.head:t.next).elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.wrapper()},k.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_vm();var t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),t=(i=(null==(e=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2))?this.zpp_inner.inner.head:e.next).elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)):(e=(i=this.zpp_inner.inner.head.elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.wrapper()},k.prototype.add=function(t){return this.zpp_inner.reverse_flag?this.push(t):this.unshift(t)},k.prototype.remove=function(t){var e;this.zpp_inner.modify_test(),this.zpp_vm(),e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==t.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(t.zpp_inner),this.zpp_inner.invalidate()),e},k.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},k.prototype.empty=function(){return 0==this.zpp_gl()},k.prototype.iterator=function(){return this.zpp_vm(),Ht.get(this)},k.prototype.copy=function(t){null==t&&(t=!1);for(var e=new k,i=this.iterator();;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner.zpp_gl();if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=Ht.zpp_pool,(Ht.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e.push(t?null:n)}return e},k.prototype.merge=function(t){for(var e=t.iterator();;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner.zpp_gl();if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Ht.zpp_pool,(Ht.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);this.has(i)||this.add(i)}},k.prototype.toString=function(){for(var t="[",e=!0,i=this.iterator();;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner.zpp_gl();if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=Ht.zpp_pool,(Ht.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e||(t+=","),t+=null==n?"NULL":n.toString(),e=!1}return t+"]"},k.prototype.foreach=function(t){for(var e=this.iterator();;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner.zpp_gl();if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Ht.zpp_pool,(Ht.zpp_pool=e).zpp_inner=null,!1)))break;try{e.zpp_critical=!1,t(e.zpp_inner.at(e.zpp_i++))}catch(t){e.zpp_next=Ht.zpp_pool,(Ht.zpp_pool=e).zpp_inner=null;break}}return this},k.prototype.filter=function(t){for(var e=0;e<this.zpp_gl();){var i=this.at(e);try{t(i)?++e:this.remove(i)}catch(t){break}}return this},Object.defineProperty(k.prototype,"length",{get:k.prototype.get_length}),k.prototype.__class__=k;var E=nape.dynamics.ArbiterType=function(){};E.__name__=["nape","dynamics","ArbiterType"],E.COLLISION=null,E.get_COLLISION=function(){return null==Yn.ArbiterType_COLLISION&&(Yn.internal=!0,Yn.ArbiterType_COLLISION=new E,Yn.internal=!1),Yn.ArbiterType_COLLISION},E.SENSOR=null,E.get_SENSOR=function(){return null==Yn.ArbiterType_SENSOR&&(Yn.internal=!0,Yn.ArbiterType_SENSOR=new E,Yn.internal=!1),Yn.ArbiterType_SENSOR},E.FLUID=null,E.get_FLUID=function(){return null==Yn.ArbiterType_FLUID&&(Yn.internal=!0,Yn.ArbiterType_FLUID=new E,Yn.internal=!1),Yn.ArbiterType_FLUID},E.prototype.toString=function(){return null==Yn.ArbiterType_COLLISION&&(Yn.internal=!0,Yn.ArbiterType_COLLISION=new E,Yn.internal=!1),this==Yn.ArbiterType_COLLISION?"COLLISION":(null==Yn.ArbiterType_SENSOR&&(Yn.internal=!0,Yn.ArbiterType_SENSOR=new E,Yn.internal=!1),this==Yn.ArbiterType_SENSOR?"SENSOR":(null==Yn.ArbiterType_FLUID&&(Yn.internal=!0,Yn.ArbiterType_FLUID=new E,Yn.internal=!1),this==Yn.ArbiterType_FLUID?"FLUID":""))},Object.defineProperty(E,"COLLISION",{get:E.get_COLLISION}),Object.defineProperty(E,"SENSOR",{get:E.get_SENSOR}),Object.defineProperty(E,"FLUID",{get:E.get_FLUID}),E.prototype.__class__=E;var I=nape.dynamics.CollisionArbiter=function(){O.call(this)};I.__name__=["nape","dynamics","CollisionArbiter"],I.__super__=O,I.prototype=Object.create(O.prototype),I.prototype.get_contacts=function(){return null==this.zpp_inner.colarb.wrap_contacts&&this.zpp_inner.colarb.setupcontacts(),this.zpp_inner.colarb.wrap_contacts},I.prototype.get_normal=function(){return null==this.zpp_inner.colarb.wrap_normal&&this.zpp_inner.colarb.getnormal(),this.zpp_inner.colarb.wrap_normal},I.prototype.get_radius=function(){return this.zpp_inner.colarb.radius},I.prototype.get_referenceEdge1=function(){var t=this.zpp_inner.colarb.__ref_edge1;return null==t||1==(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2:this.zpp_inner.ws1).outer.zpp_inner.type&&(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2:this.zpp_inner.ws1).outer.zpp_inner==t.polygon||(t=this.zpp_inner.colarb.__ref_edge2),null==t?null:t.wrapper()},I.prototype.get_referenceEdge2=function(){var t=this.zpp_inner.colarb.__ref_edge1;return null==t||1==(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1:this.zpp_inner.ws2).outer.zpp_inner.type&&(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1:this.zpp_inner.ws2).outer.zpp_inner==t.polygon||(t=this.zpp_inner.colarb.__ref_edge2),null==t?null:t.wrapper()},I.prototype.firstVertex=function(){return null!=this.zpp_inner.colarb.__ref_edge1!=(null!=this.zpp_inner.colarb.__ref_edge2)&&-1==this.zpp_inner.colarb.__ref_vertex},I.prototype.secondVertex=function(){return null!=this.zpp_inner.colarb.__ref_edge1!=(null!=this.zpp_inner.colarb.__ref_edge2)&&1==this.zpp_inner.colarb.__ref_vertex},I.prototype.normalImpulse=function(t,e){null==e&&(e=!1);var i,n,r=0,s=0,o=0,a=this.zpp_inner.colarb;return e&&!a.oc1.fresh||(null!=(n=(i=a.oc1.wrapper().normalImpulse(t)).zpp_inner)._validate&&n._validate(),r+=i.zpp_inner.x,null!=(n=i.zpp_inner)._validate&&n._validate(),s+=i.zpp_inner.y,null!=(n=i.zpp_inner)._validate&&n._validate(),o+=i.zpp_inner.z,i.dispose()),a.hc2&&(e&&!a.oc2.fresh||(null!=(t=(a=a.oc2.wrapper().normalImpulse(t)).zpp_inner)._validate&&t._validate(),r+=a.zpp_inner.x,null!=(t=a.zpp_inner)._validate&&t._validate(),s+=a.zpp_inner.y,null!=(t=a.zpp_inner)._validate&&t._validate(),o+=a.zpp_inner.z,a.dispose())),K.get(r,s,o)},I.prototype.tangentImpulse=function(t,e){null==e&&(e=!1);var i,n,r=0,s=0,o=0,a=this.zpp_inner.colarb;return e&&!a.oc1.fresh||(null!=(n=(i=a.oc1.wrapper().tangentImpulse(t)).zpp_inner)._validate&&n._validate(),r+=i.zpp_inner.x,null!=(n=i.zpp_inner)._validate&&n._validate(),s+=i.zpp_inner.y,null!=(n=i.zpp_inner)._validate&&n._validate(),o+=i.zpp_inner.z,i.dispose()),a.hc2&&(e&&!a.oc2.fresh||(null!=(t=(a=a.oc2.wrapper().tangentImpulse(t)).zpp_inner)._validate&&t._validate(),r+=a.zpp_inner.x,null!=(t=a.zpp_inner)._validate&&t._validate(),s+=a.zpp_inner.y,null!=(t=a.zpp_inner)._validate&&t._validate(),o+=a.zpp_inner.z,a.dispose())),K.get(r,s,o)},I.prototype.totalImpulse=function(t,e){null==e&&(e=!1);var i,n,r=0,s=0,o=0,a=this.zpp_inner.colarb;return e&&!a.oc1.fresh||(null!=(n=(i=a.oc1.wrapper().totalImpulse(t)).zpp_inner)._validate&&n._validate(),r+=i.zpp_inner.x,null!=(n=i.zpp_inner)._validate&&n._validate(),s+=i.zpp_inner.y,null!=(n=i.zpp_inner)._validate&&n._validate(),o+=i.zpp_inner.z,i.dispose()),a.hc2&&(e&&!a.oc2.fresh||(null!=(t=(a=a.oc2.wrapper().totalImpulse(t)).zpp_inner)._validate&&t._validate(),r+=a.zpp_inner.x,null!=(t=a.zpp_inner)._validate&&t._validate(),s+=a.zpp_inner.y,null!=(t=a.zpp_inner)._validate&&t._validate(),o+=a.zpp_inner.z,a.dispose())),K.get(r,s,o)},I.prototype.rollingImpulse=function(t,e){null==e&&(e=!1);var i=this.zpp_inner.colarb;return!e||i.oc1.fresh?i.oc1.wrapper().rollingImpulse(t):0},I.prototype.get_elasticity=function(){var t=this.zpp_inner.colarb;return t.invalidated&&(t.invalidated=!1,t.userdef_restitution||(t.s1.material.elasticity<=-1/0||t.s2.material.elasticity<=-1/0?t.restitution=0:t.s1.material.elasticity>=1/0||t.s2.material.elasticity>=1/0?t.restitution=1:t.restitution=(t.s1.material.elasticity+t.s2.material.elasticity)/2,t.restitution<0&&(t.restitution=0),1<t.restitution&&(t.restitution=1)),t.userdef_dyn_fric||(t.dyn_fric=Math.sqrt(t.s1.material.dynamicFriction*t.s2.material.dynamicFriction)),t.userdef_stat_fric||(t.stat_fric=Math.sqrt(t.s1.material.staticFriction*t.s2.material.staticFriction)),t.userdef_rfric||(t.rfric=Math.sqrt(t.s1.material.rollingFriction*t.s2.material.rollingFriction))),t.restitution},I.prototype.set_elasticity=function(t){var e=this.zpp_inner.colarb;e.restitution=t,e.userdef_restitution=!0;e=this.zpp_inner.colarb;return e.invalidated&&(e.invalidated=!1,e.userdef_restitution||(e.s1.material.elasticity<=-1/0||e.s2.material.elasticity<=-1/0?e.restitution=0:e.s1.material.elasticity>=1/0||e.s2.material.elasticity>=1/0?e.restitution=1:e.restitution=(e.s1.material.elasticity+e.s2.material.elasticity)/2,e.restitution<0&&(e.restitution=0),1<e.restitution&&(e.restitution=1)),e.userdef_dyn_fric||(e.dyn_fric=Math.sqrt(e.s1.material.dynamicFriction*e.s2.material.dynamicFriction)),e.userdef_stat_fric||(e.stat_fric=Math.sqrt(e.s1.material.staticFriction*e.s2.material.staticFriction)),e.userdef_rfric||(e.rfric=Math.sqrt(e.s1.material.rollingFriction*e.s2.material.rollingFriction))),e.restitution},I.prototype.get_dynamicFriction=function(){var t=this.zpp_inner.colarb;return t.invalidated&&(t.invalidated=!1,t.userdef_restitution||(t.s1.material.elasticity<=-1/0||t.s2.material.elasticity<=-1/0?t.restitution=0:t.s1.material.elasticity>=1/0||t.s2.material.elasticity>=1/0?t.restitution=1:t.restitution=(t.s1.material.elasticity+t.s2.material.elasticity)/2,t.restitution<0&&(t.restitution=0),1<t.restitution&&(t.restitution=1)),t.userdef_dyn_fric||(t.dyn_fric=Math.sqrt(t.s1.material.dynamicFriction*t.s2.material.dynamicFriction)),t.userdef_stat_fric||(t.stat_fric=Math.sqrt(t.s1.material.staticFriction*t.s2.material.staticFriction)),t.userdef_rfric||(t.rfric=Math.sqrt(t.s1.material.rollingFriction*t.s2.material.rollingFriction))),t.dyn_fric},I.prototype.set_dynamicFriction=function(t){var e=this.zpp_inner.colarb;e.dyn_fric=t,e.userdef_dyn_fric=!0;e=this.zpp_inner.colarb;return e.invalidated&&(e.invalidated=!1,e.userdef_restitution||(e.s1.material.elasticity<=-1/0||e.s2.material.elasticity<=-1/0?e.restitution=0:e.s1.material.elasticity>=1/0||e.s2.material.elasticity>=1/0?e.restitution=1:e.restitution=(e.s1.material.elasticity+e.s2.material.elasticity)/2,e.restitution<0&&(e.restitution=0),1<e.restitution&&(e.restitution=1)),e.userdef_dyn_fric||(e.dyn_fric=Math.sqrt(e.s1.material.dynamicFriction*e.s2.material.dynamicFriction)),e.userdef_stat_fric||(e.stat_fric=Math.sqrt(e.s1.material.staticFriction*e.s2.material.staticFriction)),e.userdef_rfric||(e.rfric=Math.sqrt(e.s1.material.rollingFriction*e.s2.material.rollingFriction))),e.dyn_fric},I.prototype.get_staticFriction=function(){var t=this.zpp_inner.colarb;return t.invalidated&&(t.invalidated=!1,t.userdef_restitution||(t.s1.material.elasticity<=-1/0||t.s2.material.elasticity<=-1/0?t.restitution=0:t.s1.material.elasticity>=1/0||t.s2.material.elasticity>=1/0?t.restitution=1:t.restitution=(t.s1.material.elasticity+t.s2.material.elasticity)/2,t.restitution<0&&(t.restitution=0),1<t.restitution&&(t.restitution=1)),t.userdef_dyn_fric||(t.dyn_fric=Math.sqrt(t.s1.material.dynamicFriction*t.s2.material.dynamicFriction)),t.userdef_stat_fric||(t.stat_fric=Math.sqrt(t.s1.material.staticFriction*t.s2.material.staticFriction)),t.userdef_rfric||(t.rfric=Math.sqrt(t.s1.material.rollingFriction*t.s2.material.rollingFriction))),t.stat_fric},I.prototype.set_staticFriction=function(t){var e=this.zpp_inner.colarb;e.stat_fric=t,e.userdef_stat_fric=!0;e=this.zpp_inner.colarb;return e.invalidated&&(e.invalidated=!1,e.userdef_restitution||(e.s1.material.elasticity<=-1/0||e.s2.material.elasticity<=-1/0?e.restitution=0:e.s1.material.elasticity>=1/0||e.s2.material.elasticity>=1/0?e.restitution=1:e.restitution=(e.s1.material.elasticity+e.s2.material.elasticity)/2,e.restitution<0&&(e.restitution=0),1<e.restitution&&(e.restitution=1)),e.userdef_dyn_fric||(e.dyn_fric=Math.sqrt(e.s1.material.dynamicFriction*e.s2.material.dynamicFriction)),e.userdef_stat_fric||(e.stat_fric=Math.sqrt(e.s1.material.staticFriction*e.s2.material.staticFriction)),e.userdef_rfric||(e.rfric=Math.sqrt(e.s1.material.rollingFriction*e.s2.material.rollingFriction))),e.stat_fric},I.prototype.get_rollingFriction=function(){var t=this.zpp_inner.colarb;return t.invalidated&&(t.invalidated=!1,t.userdef_restitution||(t.s1.material.elasticity<=-1/0||t.s2.material.elasticity<=-1/0?t.restitution=0:t.s1.material.elasticity>=1/0||t.s2.material.elasticity>=1/0?t.restitution=1:t.restitution=(t.s1.material.elasticity+t.s2.material.elasticity)/2,t.restitution<0&&(t.restitution=0),1<t.restitution&&(t.restitution=1)),t.userdef_dyn_fric||(t.dyn_fric=Math.sqrt(t.s1.material.dynamicFriction*t.s2.material.dynamicFriction)),t.userdef_stat_fric||(t.stat_fric=Math.sqrt(t.s1.material.staticFriction*t.s2.material.staticFriction)),t.userdef_rfric||(t.rfric=Math.sqrt(t.s1.material.rollingFriction*t.s2.material.rollingFriction))),t.rfric},I.prototype.set_rollingFriction=function(t){var e=this.zpp_inner.colarb;e.rfric=t,e.userdef_rfric=!0;e=this.zpp_inner.colarb;return e.invalidated&&(e.invalidated=!1,e.userdef_restitution||(e.s1.material.elasticity<=-1/0||e.s2.material.elasticity<=-1/0?e.restitution=0:e.s1.material.elasticity>=1/0||e.s2.material.elasticity>=1/0?e.restitution=1:e.restitution=(e.s1.material.elasticity+e.s2.material.elasticity)/2,e.restitution<0&&(e.restitution=0),1<e.restitution&&(e.restitution=1)),e.userdef_dyn_fric||(e.dyn_fric=Math.sqrt(e.s1.material.dynamicFriction*e.s2.material.dynamicFriction)),e.userdef_stat_fric||(e.stat_fric=Math.sqrt(e.s1.material.staticFriction*e.s2.material.staticFriction)),e.userdef_rfric||(e.rfric=Math.sqrt(e.s1.material.rollingFriction*e.s2.material.rollingFriction))),e.rfric},Object.defineProperty(I.prototype,"contacts",{get:I.prototype.get_contacts}),Object.defineProperty(I.prototype,"normal",{get:I.prototype.get_normal}),Object.defineProperty(I.prototype,"radius",{get:I.prototype.get_radius}),Object.defineProperty(I.prototype,"referenceEdge1",{get:I.prototype.get_referenceEdge1}),Object.defineProperty(I.prototype,"referenceEdge2",{get:I.prototype.get_referenceEdge2}),Object.defineProperty(I.prototype,"elasticity",{get:I.prototype.get_elasticity,set:I.prototype.set_elasticity}),Object.defineProperty(I.prototype,"dynamicFriction",{get:I.prototype.get_dynamicFriction,set:I.prototype.set_dynamicFriction}),Object.defineProperty(I.prototype,"staticFriction",{get:I.prototype.get_staticFriction,set:I.prototype.set_staticFriction}),Object.defineProperty(I.prototype,"rollingFriction",{get:I.prototype.get_rollingFriction,set:I.prototype.set_rollingFriction}),I.prototype.__class__=I;var D=nape.dynamics.Contact=function(){this.zpp_inner=null};D.__name__=["nape","dynamics","Contact"],D.prototype.zpp_inner=null,D.prototype.get_arbiter=function(){if(null==this.zpp_inner.arbiter)return null;var t=this.zpp_inner.arbiter.outer;return t.zpp_inner.type==Qe.COL?t.zpp_inner.colarb.outer_zn:null},D.prototype.get_penetration=function(){return-this.zpp_inner.dist},D.prototype.get_position=function(){return null==this.zpp_inner.wrap_position&&this.zpp_inner.getposition(),this.zpp_inner.wrap_position},D.prototype.get_fresh=function(){return this.zpp_inner.fresh},D.prototype.normalImpulse=function(t){var e=this.zpp_inner.arbiter.colarb,i=this.zpp_inner.inner,n=i.jnAcc;return null==t?K.get(e.nx*n,e.ny*n):t==e.b1.outer?K.get(e.nx*-n,e.ny*-n,-(e.ny*i.r1x-e.nx*i.r1y)*n):K.get(e.nx*n,e.ny*n,(e.ny*i.r2x-e.nx*i.r2y)*n)},D.prototype.tangentImpulse=function(t){var e=this.zpp_inner.arbiter.colarb,i=this.zpp_inner.inner,n=i.jtAcc;return null==t?K.get(-e.ny*n,e.nx*n):t==e.b1.outer?K.get(e.ny*n,-e.nx*n,-(i.r1x*e.nx+i.r1y*e.ny)*n):K.get(-e.ny*n,e.nx*n,(i.r2x*e.nx+i.r2y*e.ny)*n)},D.prototype.rollingImpulse=function(t){var e=this.zpp_inner.arbiter.colarb,i=this.zpp_inner.arbiter.colarb.jrAcc;return null!=t&&t==e.b1.outer?-i:i},D.prototype.totalImpulse=function(t){var e=this.zpp_inner.arbiter.colarb,i=this.zpp_inner.inner,n=i.jnAcc,r=i.jtAcc,s=e.jrAcc;if(null==t)return K.get(e.nx*n-e.ny*r,e.ny*n+e.nx*r,s);var o=e.nx*n-e.ny*r,r=e.ny*n+e.nx*r;return t==e.b1.outer?K.get(-o,-r,-(r*i.r1x-o*i.r1y)-s):K.get(o,r,r*i.r2x-o*i.r2y+s)},D.prototype.get_friction=function(){return this.zpp_inner.inner.friction},D.prototype.toString=function(){return null==this.zpp_inner.arbiter||this.zpp_inner.arbiter.cleared?"{object-pooled}":"{Contact}"},Object.defineProperty(D.prototype,"arbiter",{get:D.prototype.get_arbiter}),Object.defineProperty(D.prototype,"penetration",{get:D.prototype.get_penetration}),Object.defineProperty(D.prototype,"position",{get:D.prototype.get_position}),Object.defineProperty(D.prototype,"fresh",{get:D.prototype.get_fresh}),Object.defineProperty(D.prototype,"friction",{get:D.prototype.get_friction}),D.prototype.__class__=D;var qt=nape.dynamics.ContactIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};qt.__name__=["nape","dynamics","ContactIterator"],qt.get=function(t){var e,i=null==qt.zpp_pool?(Ln.internal=!0,e=new qt,Ln.internal=!1,e):(i=qt.zpp_pool,qt.zpp_pool=i.zpp_next,i);return i.zpp_i=0,i.zpp_inner=t,i.zpp_critical=!1,i},qt.prototype.zpp_inner=null,qt.prototype.zpp_i=null,qt.prototype.zpp_critical=null,qt.prototype.zpp_next=null,qt.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;if(t.zpp_inner.valmod(),t.zpp_inner.zip_length){t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=0;for(var e=t.zpp_inner.inner.next;null!=e;)e.active&&e.arbiter.active&&t.zpp_inner.user_length++,e=e.next}var i=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<i||(this.zpp_next=qt.zpp_pool,(qt.zpp_pool=this).zpp_inner=null,!1)},qt.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},qt.prototype.__class__=qt;var B=nape.dynamics.ContactList=function(){this.zpp_inner=null,this.zpp_inner=new Ln,this.zpp_inner.outer=this};B.__name__=["nape","dynamics","ContactList"],B.fromArray=function(t){for(var e=new B,i=0;i<t.length;){var n=t[i];++i,e.push(n)}return e},B.prototype.zpp_inner=null,B.prototype.get_length=function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var t=this.zpp_inner.inner.next;null!=t;)t.active&&t.arbiter.active&&this.zpp_inner.user_length++,t=t.next}return this.zpp_inner.user_length},B.prototype.has=function(t){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(t.zpp_inner)},B.prototype.at=function(t){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var e=this.zpp_inner.inner.next;null!=e;)e.active&&e.arbiter.active&&this.zpp_inner.user_length++,e=e.next}t=this.zpp_inner.user_length-1-t}if(t<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)for(this.zpp_inner.at_index=0,this.zpp_inner.at_ite=this.zpp_inner.inner.next;;){var i=this.zpp_inner.at_ite;if(i.active&&i.arbiter.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}for(;this.zpp_inner.at_index!=t;)for(this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;;){var n=this.zpp_inner.at_ite;if(n.active&&n.arbiter.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}return this.zpp_inner.at_ite.wrapper()},B.prototype.push=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);if(i){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(t.zpp_inner);else{if(null==this.zpp_inner.push_ite){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;)n.active&&n.arbiter.active&&this.zpp_inner.user_length++,n=n.next}if(0==this.zpp_inner.user_length)e=null;else{if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var r=this.zpp_inner.inner.next;null!=r;)r.active&&r.arbiter.active&&this.zpp_inner.user_length++,r=r.next}e=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=e}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)}return i},B.prototype.unshift=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);if(i){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;)n.active&&n.arbiter.active&&this.zpp_inner.user_length++,n=n.next}if(0==this.zpp_inner.user_length)e=null;else{if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var r=this.zpp_inner.inner.next;null!=r;)r.active&&r.arbiter.active&&this.zpp_inner.user_length++,r=r.next}e=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=e}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)}else this.zpp_inner.inner.add(t.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)}return i},B.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null;if(this.zpp_inner.reverse_flag){var i=(e=this.zpp_inner.inner.next).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;)n.active&&n.arbiter.active&&this.zpp_inner.user_length++,n=n.next}if(1==this.zpp_inner.user_length)t=null;else{if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var r=this.zpp_inner.inner.next;null!=r;)r.active&&r.arbiter.active&&this.zpp_inner.user_length++,r=r.next}t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)}i=(e=(null==t?this.zpp_inner.inner:t).next).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),e.wrapper()},B.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t=null;if(this.zpp_inner.reverse_flag){if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var e=this.zpp_inner.inner.next;null!=e;)e.active&&e.arbiter.active&&this.zpp_inner.user_length++,e=e.next}if(1==this.zpp_inner.user_length)r=null;else{if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var i=this.zpp_inner.inner.next;null!=i;)i.active&&i.arbiter.active&&this.zpp_inner.user_length++,i=i.next}r=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)}var n=(t=(null==r?this.zpp_inner.inner:r).next).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(r)}else{var r=(t=this.zpp_inner.inner.next).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),t.wrapper()},B.prototype.add=function(t){return this.zpp_inner.reverse_flag?this.push(t):this.unshift(t)},B.prototype.remove=function(t){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var i=this.zpp_inner.inner.next;null!=i;){if(i==t.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(t.zpp_inner),this.zpp_inner.invalidate()),e},B.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var t=this.zpp_inner.inner.next;null!=t;)t.active&&t.arbiter.active&&this.zpp_inner.user_length++,t=t.next}if(0==this.zpp_inner.user_length)break;this.pop()}else for(;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var e=this.zpp_inner.inner.next;null!=e;)e.active&&e.arbiter.active&&this.zpp_inner.user_length++,e=e.next}if(0==this.zpp_inner.user_length)break;this.shift()}},B.prototype.empty=function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var t=this.zpp_inner.inner.next;null!=t;)t.active&&t.arbiter.active&&this.zpp_inner.user_length++,t=t.next}return 0==this.zpp_inner.user_length},B.prototype.iterator=function(){return this.zpp_inner.valmod(),qt.get(this)},B.prototype.copy=function(t){null==t&&(t=!1);var e=new B;this.zpp_inner.valmod();for(var i=qt.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;if(n.zpp_inner.valmod(),n.zpp_inner.zip_length){n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=0;for(var r=n.zpp_inner.inner.next;null!=r;)r.active&&r.arbiter.active&&n.zpp_inner.user_length++,r=r.next}var s=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<s||(i.zpp_next=qt.zpp_pool,(qt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;s=i.zpp_inner.at(i.zpp_i++);e.push(t?null:s)}return e},B.prototype.merge=function(t){t.zpp_inner.valmod();for(var e=qt.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;if(i.zpp_inner.valmod(),i.zpp_inner.zip_length){i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=0;for(var n=i.zpp_inner.inner.next;null!=n;)n.active&&n.arbiter.active&&i.zpp_inner.user_length++,n=n.next}var r=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<r||(e.zpp_next=qt.zpp_pool,(qt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;r=e.zpp_inner.at(e.zpp_i++);this.has(r)||(this.zpp_inner.reverse_flag?this.push(r):this.unshift(r))}},B.prototype.toString=function(){var t="[",e=!0;this.zpp_inner.valmod();for(var i=qt.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;if(n.zpp_inner.valmod(),n.zpp_inner.zip_length){n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=0;for(var r=n.zpp_inner.inner.next;null!=r;)r.active&&r.arbiter.active&&n.zpp_inner.user_length++,r=r.next}var s=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<s||(i.zpp_next=qt.zpp_pool,(qt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;s=i.zpp_inner.at(i.zpp_i++);e||(t+=","),t+=null==s?"NULL":s.toString(),e=!1}return t+"]"},B.prototype.foreach=function(t){this.zpp_inner.valmod();for(var e=qt.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;if(i.zpp_inner.valmod(),i.zpp_inner.zip_length){i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=0;for(var n=i.zpp_inner.inner.next;null!=n;)n.active&&n.arbiter.active&&i.zpp_inner.user_length++,n=n.next}var r=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<r||(e.zpp_next=qt.zpp_pool,(qt.zpp_pool=e).zpp_inner=null,!1)))break;try{e.zpp_critical=!1,t(e.zpp_inner.at(e.zpp_i++))}catch(t){e.zpp_next=qt.zpp_pool,(qt.zpp_pool=e).zpp_inner=null;break}}return this},B.prototype.filter=function(t){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var i=this.zpp_inner.inner.next;null!=i;)i.active&&i.arbiter.active&&this.zpp_inner.user_length++,i=i.next}if(!(e<this.zpp_inner.user_length))break;var n=this.at(e);try{t(n)?++e:this.remove(n)}catch(t){break}}return this},Object.defineProperty(B.prototype,"length",{get:B.prototype.get_length}),B.prototype.__class__=B;var L=nape.dynamics.FluidArbiter=function(){O.call(this)};L.__name__=["nape","dynamics","FluidArbiter"],L.__super__=O,L.prototype=Object.create(O.prototype),L.prototype.get_position=function(){return null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition(),this.zpp_inner.fluidarb.wrap_position},L.prototype.set_position=function(t){null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition();var e=this.zpp_inner.fluidarb.wrap_position,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition(),this.zpp_inner.fluidarb.wrap_position},L.prototype.get_overlap=function(){return this.zpp_inner.fluidarb.overlap},L.prototype.set_overlap=function(t){return this.zpp_inner.fluidarb.overlap=t,this.zpp_inner.fluidarb.overlap},L.prototype.buoyancyImpulse=function(t){var e=this.zpp_inner.fluidarb;return null==t?K.get(e.buoyx,e.buoyy,0):t.zpp_inner==this.zpp_inner.b2?K.get(e.buoyx,e.buoyy,e.buoyy*e.r2x-e.buoyx*e.r2y):K.get(-e.buoyx,-e.buoyy,-(e.buoyy*e.r1x-e.buoyx*e.r1y))},L.prototype.dragImpulse=function(t){var e=this.zpp_inner.fluidarb,t=null==t||t.zpp_inner==this.zpp_inner.b2?1:-1;return K.get(e.dampx*t,e.dampy*t,e.adamp*t)},L.prototype.totalImpulse=function(t,e){null==e&&(e=!1);var i=this.buoyancyImpulse(t),n=this.dragImpulse(t),e=n.zpp_inner;null!=e._validate&&e._validate();t=n.zpp_inner.x,e=i.zpp_inner;null!=e._validate&&e._validate(),n.zpp_inner.x=t+i.zpp_inner.x;e=n.zpp_inner;null!=e._validate&&e._validate();t=n.zpp_inner;null!=t._validate&&t._validate();e=n.zpp_inner.y,t=i.zpp_inner;null!=t._validate&&t._validate(),n.zpp_inner.y=e+i.zpp_inner.y;t=n.zpp_inner;null!=t._validate&&t._validate();e=n.zpp_inner;null!=e._validate&&e._validate();t=n.zpp_inner.z,e=i.zpp_inner;null!=e._validate&&e._validate(),n.zpp_inner.z=t+i.zpp_inner.z;t=n.zpp_inner;return null!=t._validate&&t._validate(),i.dispose(),n},Object.defineProperty(L.prototype,"position",{get:L.prototype.get_position,set:L.prototype.set_position}),Object.defineProperty(L.prototype,"overlap",{get:L.prototype.get_overlap,set:L.prototype.set_overlap}),L.prototype.__class__=L;var R=nape.dynamics.InteractionFilter=function(t,e,i,n,r,s){null==s&&(s=-1),null==r&&(r=1),null==n&&(n=-1),null==i&&(i=1),null==e&&(e=-1),null==t&&(t=1),(this.zpp_inner=null)==le.zpp_pool?this.zpp_inner=new le:(this.zpp_inner=le.zpp_pool,le.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null),(this.zpp_inner.outer=this).zpp_inner.collisionGroup!=t&&(this.zpp_inner.collisionGroup=t,this.zpp_inner.invalidate()),this.zpp_inner.collisionMask!=e&&(this.zpp_inner.collisionMask=e,this.zpp_inner.invalidate()),this.zpp_inner.sensorGroup!=i&&(this.zpp_inner.sensorGroup=i,this.zpp_inner.invalidate()),this.zpp_inner.sensorMask!=n&&(this.zpp_inner.sensorMask=n,this.zpp_inner.invalidate()),this.zpp_inner.fluidGroup!=r&&(this.zpp_inner.fluidGroup=r,this.zpp_inner.invalidate()),this.zpp_inner.fluidMask!=s&&(this.zpp_inner.fluidMask=s,this.zpp_inner.invalidate())};R.__name__=["nape","dynamics","InteractionFilter"],R.prototype.zpp_inner=null,R.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},R.prototype.get_shapes=function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=In.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},R.prototype.get_collisionGroup=function(){return this.zpp_inner.collisionGroup},R.prototype.set_collisionGroup=function(t){return this.zpp_inner.collisionGroup!=t&&(this.zpp_inner.collisionGroup=t,this.zpp_inner.invalidate()),this.zpp_inner.collisionGroup},R.prototype.get_collisionMask=function(){return this.zpp_inner.collisionMask},R.prototype.set_collisionMask=function(t){return this.zpp_inner.collisionMask!=t&&(this.zpp_inner.collisionMask=t,this.zpp_inner.invalidate()),this.zpp_inner.collisionMask},R.prototype.get_sensorGroup=function(){return this.zpp_inner.sensorGroup},R.prototype.set_sensorGroup=function(t){return this.zpp_inner.sensorGroup!=t&&(this.zpp_inner.sensorGroup=t,this.zpp_inner.invalidate()),this.zpp_inner.sensorGroup},R.prototype.get_sensorMask=function(){return this.zpp_inner.sensorMask},R.prototype.set_sensorMask=function(t){return this.zpp_inner.sensorMask!=t&&(this.zpp_inner.sensorMask=t,this.zpp_inner.invalidate()),this.zpp_inner.sensorMask},R.prototype.get_fluidGroup=function(){return this.zpp_inner.fluidGroup},R.prototype.set_fluidGroup=function(t){return this.zpp_inner.fluidGroup!=t&&(this.zpp_inner.fluidGroup=t,this.zpp_inner.invalidate()),this.zpp_inner.fluidGroup},R.prototype.get_fluidMask=function(){return this.zpp_inner.fluidMask},R.prototype.set_fluidMask=function(t){return this.zpp_inner.fluidMask!=t&&(this.zpp_inner.fluidMask=t,this.zpp_inner.invalidate()),this.zpp_inner.fluidMask},R.prototype.shouldCollide=function(t){var e=this.zpp_inner,t=t.zpp_inner;return 0!=(e.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&e.collisionGroup)},R.prototype.shouldSense=function(t){var e=this.zpp_inner,t=t.zpp_inner;return 0!=(e.sensorMask&t.sensorGroup)&&0!=(t.sensorMask&e.sensorGroup)},R.prototype.shouldFlow=function(t){var e=this.zpp_inner,t=t.zpp_inner;return 0!=(e.fluidMask&t.fluidGroup)&&0!=(t.fluidMask&e.fluidGroup)},R.prototype.copy=function(){return new R(this.zpp_inner.collisionGroup,this.zpp_inner.collisionMask,this.zpp_inner.sensorGroup,this.zpp_inner.sensorMask,this.zpp_inner.fluidGroup,this.zpp_inner.fluidMask)},R.prototype.toString=function(){return"{ collision: "+t.hex(this.zpp_inner.collisionGroup,8)+"~"+t.hex(this.zpp_inner.collisionMask,8)+" sensor: "+t.hex(this.zpp_inner.sensorGroup,8)+"~"+t.hex(this.zpp_inner.sensorMask,8)+" fluid: "+t.hex(this.zpp_inner.fluidGroup,8)+"~"+t.hex(this.zpp_inner.fluidMask,8)+" }"},Object.defineProperty(R.prototype,"userData",{get:R.prototype.get_userData}),Object.defineProperty(R.prototype,"shapes",{get:R.prototype.get_shapes}),Object.defineProperty(R.prototype,"collisionGroup",{get:R.prototype.get_collisionGroup,set:R.prototype.set_collisionGroup}),Object.defineProperty(R.prototype,"collisionMask",{get:R.prototype.get_collisionMask,set:R.prototype.set_collisionMask}),Object.defineProperty(R.prototype,"sensorGroup",{get:R.prototype.get_sensorGroup,set:R.prototype.set_sensorGroup}),Object.defineProperty(R.prototype,"sensorMask",{get:R.prototype.get_sensorMask,set:R.prototype.set_sensorMask}),Object.defineProperty(R.prototype,"fluidGroup",{get:R.prototype.get_fluidGroup,set:R.prototype.set_fluidGroup}),Object.defineProperty(R.prototype,"fluidMask",{get:R.prototype.get_fluidMask,set:R.prototype.set_fluidMask}),R.prototype.__class__=R,(y=nape.dynamics.InteractionGroup=function(t){null==t&&(t=!1),this.zpp_inner=null,this.zpp_inner=new pe,(this.zpp_inner.outer=this).zpp_inner.ignore!=t&&(this.zpp_inner.invalidate(!0),this.zpp_inner.ignore=t)}).__name__=["nape","dynamics","InteractionGroup"],y.prototype.zpp_inner=null,y.prototype.get_group=function(){return null==this.zpp_inner.group?null:this.zpp_inner.group.outer},y.prototype.set_group=function(t){return this.zpp_inner.setGroup(null==t?null:t.zpp_inner),null==this.zpp_inner.group?null:this.zpp_inner.group.outer},y.prototype.get_ignore=function(){return this.zpp_inner.ignore},y.prototype.set_ignore=function(t){return this.zpp_inner.ignore!=t&&(this.zpp_inner.invalidate(!0),this.zpp_inner.ignore=t),this.zpp_inner.ignore},y.prototype.get_interactors=function(){return null==this.zpp_inner.wrap_interactors&&(this.zpp_inner.wrap_interactors=Cn.get(this.zpp_inner.interactors,!0)),this.zpp_inner.wrap_interactors},y.prototype.get_groups=function(){return null==this.zpp_inner.wrap_groups&&(this.zpp_inner.wrap_groups=Dn.get(this.zpp_inner.groups,!0)),this.zpp_inner.wrap_groups},y.prototype.toString=function(){var t="InteractionGroup";return this.zpp_inner.ignore&&(t="InteractionGroup:ignore"),t},Object.defineProperty(y.prototype,"group",{get:y.prototype.get_group,set:y.prototype.set_group}),Object.defineProperty(y.prototype,"ignore",{get:y.prototype.get_ignore,set:y.prototype.set_ignore}),Object.defineProperty(y.prototype,"interactors",{get:y.prototype.get_interactors}),Object.defineProperty(y.prototype,"groups",{get:y.prototype.get_groups}),y.prototype.__class__=y;var Yt=nape.dynamics.InteractionGroupIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Yt.__name__=["nape","dynamics","InteractionGroupIterator"],Yt.get=function(t){var e,i=null==Yt.zpp_pool?(Dn.internal=!0,e=new Yt,Dn.internal=!1,e):(i=Yt.zpp_pool,Yt.zpp_pool=i.zpp_next,i);return i.zpp_i=0,i.zpp_inner=t,i.zpp_critical=!1,i},Yt.prototype.zpp_inner=null,Yt.prototype.zpp_i=null,Yt.prototype.zpp_critical=null,Yt.prototype.zpp_next=null,Yt.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);t=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=Yt.zpp_pool,(Yt.zpp_pool=this).zpp_inner=null,!1)},Yt.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Yt.prototype.__class__=Yt;var j=nape.dynamics.InteractionGroupList=function(){this.zpp_inner=null,this.zpp_inner=new Dn,this.zpp_inner.outer=this};j.__name__=["nape","dynamics","InteractionGroupList"],j.fromArray=function(t){for(var e=new j,i=0;i<t.length;){var n=t[i];++i,e.push(n)}return e},j.prototype.zpp_inner=null,j.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},j.prototype.has=function(t){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(t.zpp_inner)},j.prototype.at=function(t){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.user_length-1-t),t<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=t,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(t);else for(;this.zpp_inner.at_index!=t;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},j.prototype.push=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(t.zpp_inner):(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},j.prototype.unshift=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)):this.zpp_inner.inner.add(t.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},j.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e,i=null;return this.zpp_inner.reverse_flag?(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(i=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.outer},j.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(i=(null==(e=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:e.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)):(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.outer},j.prototype.add=function(t){return this.zpp_inner.reverse_flag?this.push(t):this.unshift(t)},j.prototype.remove=function(t){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==t.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(t.zpp_inner),this.zpp_inner.invalidate()),e},j.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},j.prototype.empty=function(){return null==this.zpp_inner.inner.head},j.prototype.iterator=function(){return this.zpp_inner.valmod(),Yt.get(this)},j.prototype.copy=function(t){null==t&&(t=!1);var e=new j;this.zpp_inner.valmod();for(var i=Yt.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=Yt.zpp_pool,(Yt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e.push(t?null:n)}return e},j.prototype.merge=function(t){t.zpp_inner.valmod();for(var e=Yt.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Yt.zpp_pool,(Yt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);this.has(i)||(this.zpp_inner.reverse_flag?this.push(i):this.unshift(i))}},j.prototype.toString=function(){var t="[",e=!0;this.zpp_inner.valmod();for(var i=Yt.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=Yt.zpp_pool,(Yt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e||(t+=","),t+=null==n?"NULL":n.toString(),e=!1}return t+"]"},j.prototype.foreach=function(t){this.zpp_inner.valmod();for(var e=Yt.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Yt.zpp_pool,(Yt.zpp_pool=e).zpp_inner=null,!1)))break;try{e.zpp_critical=!1,t(e.zpp_inner.at(e.zpp_i++))}catch(t){e.zpp_next=Yt.zpp_pool,(Yt.zpp_pool=e).zpp_inner=null;break}}return this},j.prototype.filter=function(t){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var i=this.at(e);try{t(i)?++e:this.remove(i)}catch(t){break}}return this},Object.defineProperty(j.prototype,"length",{get:j.prototype.get_length}),j.prototype.__class__=j;var N=nape.geom.AABB=function(t,e,i,n){var r;null==n&&(n=0),null==i&&(i=0),null==e&&(e=0),null==t&&(t=0),(this.zpp_inner=null)==Be.zpp_pool?r=new Be:(r=Be.zpp_pool,Be.zpp_pool=r.next,r.next=null),r.minx=t,r.miny=e,r.maxx=t+i,r.maxy=e+n,this.zpp_inner=r,this.zpp_inner.outer=this};N.__name__=["nape","geom","AABB"],N.prototype.zpp_inner=null,N.prototype.copy=function(){var t=this.zpp_inner;null!=t._validate&&t._validate();var e,i=this.zpp_inner,n=i.minx,r=i.miny,t=i.maxx,i=i.maxy;return null==Be.zpp_pool?e=new Be:(e=Be.zpp_pool,Be.zpp_pool=e.next,e.next=null),e.minx=n,e.miny=r,e.maxx=t,e.maxy=i,e.wrapper()},N.prototype.get_min=function(){return this.zpp_inner.getmin()},N.prototype.set_min=function(t){var e=this.zpp_inner.getmin(),i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),this.zpp_inner.getmin()},N.prototype.get_max=function(){return this.zpp_inner.getmax()},N.prototype.set_max=function(t){var e=this.zpp_inner.getmax(),i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),this.zpp_inner.getmax()},N.prototype.get_x=function(){var t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.minx},N.prototype.set_x=function(t){var e=this.zpp_inner;null!=e._validate&&e._validate(),this.zpp_inner.minx!=t&&(this.zpp_inner.maxx+=t-this.zpp_inner.minx,this.zpp_inner.minx=t,null!=(i=this.zpp_inner)._invalidate&&i._invalidate(i));var i=this.zpp_inner;return null!=i._validate&&i._validate(),this.zpp_inner.minx},N.prototype.get_y=function(){var t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.miny},N.prototype.set_y=function(t){var e=this.zpp_inner;null!=e._validate&&e._validate(),this.zpp_inner.miny!=t&&(this.zpp_inner.maxy+=t-this.zpp_inner.miny,this.zpp_inner.miny=t,null!=(i=this.zpp_inner)._invalidate&&i._invalidate(i));var i=this.zpp_inner;return null!=i._validate&&i._validate(),this.zpp_inner.miny},N.prototype.get_width=function(){var t=this.zpp_inner;null!=t._validate&&t._validate();t=this.zpp_inner;return t.maxx-t.minx},N.prototype.set_width=function(t){var e=this.zpp_inner;null!=e._validate&&e._validate();e=this.zpp_inner;e.maxx-e.minx!=t&&(null!=(i=this.zpp_inner)._validate&&i._validate(),this.zpp_inner.maxx=this.zpp_inner.minx+t,null!=(i=this.zpp_inner)._invalidate&&i._invalidate(i));var i=this.zpp_inner;null!=i._validate&&i._validate();i=this.zpp_inner;return i.maxx-i.minx},N.prototype.get_height=function(){var t=this.zpp_inner;null!=t._validate&&t._validate();t=this.zpp_inner;return t.maxy-t.miny},N.prototype.set_height=function(t){var e=this.zpp_inner;null!=e._validate&&e._validate();e=this.zpp_inner;e.maxy-e.miny!=t&&(null!=(i=this.zpp_inner)._validate&&i._validate(),this.zpp_inner.maxy=this.zpp_inner.miny+t,null!=(i=this.zpp_inner)._invalidate&&i._invalidate(i));var i=this.zpp_inner;null!=i._validate&&i._validate();i=this.zpp_inner;return i.maxy-i.miny},N.prototype.toString=function(){var t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.toString()},Object.defineProperty(N.prototype,"min",{get:N.prototype.get_min,set:N.prototype.set_min}),Object.defineProperty(N.prototype,"max",{get:N.prototype.get_max,set:N.prototype.set_max}),Object.defineProperty(N.prototype,"x",{get:N.prototype.get_x,set:N.prototype.set_x}),Object.defineProperty(N.prototype,"y",{get:N.prototype.get_y,set:N.prototype.set_y}),Object.defineProperty(N.prototype,"width",{get:N.prototype.get_width,set:N.prototype.set_width}),Object.defineProperty(N.prototype,"height",{get:N.prototype.get_height,set:N.prototype.set_height}),N.prototype.__class__=N;var G=nape.geom.ConvexResult=function(){this.zpp_inner=null};G.__name__=["nape","geom","ConvexResult"],G.prototype.zpp_inner=null,G.prototype.get_normal=function(){return this.zpp_inner.normal},G.prototype.get_position=function(){return this.zpp_inner.position},G.prototype.get_toi=function(){return this.zpp_inner.toiDistance},G.prototype.get_shape=function(){return this.zpp_inner.shape},G.prototype.dispose=function(){this.zpp_inner.free()},G.prototype.toString=function(){return"{ shape: "+n.string(this.zpp_inner.shape)+" toi: "+this.zpp_inner.toiDistance+" }"},Object.defineProperty(G.prototype,"normal",{get:G.prototype.get_normal}),Object.defineProperty(G.prototype,"position",{get:G.prototype.get_position}),Object.defineProperty(G.prototype,"toi",{get:G.prototype.get_toi}),Object.defineProperty(G.prototype,"shape",{get:G.prototype.get_shape}),G.prototype.__class__=G;var Kt=nape.geom.ConvexResultIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Kt.__name__=["nape","geom","ConvexResultIterator"],Kt.get=function(t){var e,i=null==Kt.zpp_pool?(kn.internal=!0,e=new Kt,kn.internal=!1,e):(i=Kt.zpp_pool,Kt.zpp_pool=i.zpp_next,i);return i.zpp_i=0,i.zpp_inner=t,i.zpp_critical=!1,i},Kt.prototype.zpp_inner=null,Kt.prototype.zpp_i=null,Kt.prototype.zpp_critical=null,Kt.prototype.zpp_next=null,Kt.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);t=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=Kt.zpp_pool,(Kt.zpp_pool=this).zpp_inner=null,!1)},Kt.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Kt.prototype.__class__=Kt;var wt=nape.geom.ConvexResultList=function(){this.zpp_inner=null,this.zpp_inner=new kn,this.zpp_inner.outer=this};wt.__name__=["nape","geom","ConvexResultList"],wt.fromArray=function(t){for(var e=new wt,i=0;i<t.length;){var n=t[i];++i,e.push(n)}return e},wt.prototype.zpp_inner=null,wt.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},wt.prototype.has=function(t){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(t)},wt.prototype.at=function(t){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.user_length-1-t),t<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=t,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(t);else for(;this.zpp_inner.at_index!=t;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt},wt.prototype.push=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(t):(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},wt.prototype.unshift=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t)):this.zpp_inner.inner.add(t),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},wt.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null;return this.zpp_inner.reverse_flag?(e=this.zpp_inner.inner.head.elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),e},wt.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)):(e=this.zpp_inner.inner.head.elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),e},wt.prototype.add=function(t){return this.zpp_inner.reverse_flag?this.push(t):this.unshift(t)},wt.prototype.remove=function(t){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(t),this.zpp_inner.invalidate()),e},wt.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},wt.prototype.empty=function(){return null==this.zpp_inner.inner.head},wt.prototype.iterator=function(){return this.zpp_inner.valmod(),Kt.get(this)},wt.prototype.copy=function(t){null==t&&(t=!1);var e=new wt;this.zpp_inner.valmod();for(var i=Kt.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=Kt.zpp_pool,(Kt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e.push(t?null:n)}return e},wt.prototype.merge=function(t){t.zpp_inner.valmod();for(var e=Kt.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Kt.zpp_pool,(Kt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);this.has(i)||(this.zpp_inner.reverse_flag?this.push(i):this.unshift(i))}},wt.prototype.toString=function(){var t="[",e=!0;this.zpp_inner.valmod();for(var i=Kt.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=Kt.zpp_pool,(Kt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e||(t+=","),t+=null==n?"NULL":n.toString(),e=!1}return t+"]"},wt.prototype.foreach=function(t){this.zpp_inner.valmod();for(var e=Kt.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Kt.zpp_pool,(Kt.zpp_pool=e).zpp_inner=null,!1)))break;try{e.zpp_critical=!1,t(e.zpp_inner.at(e.zpp_i++))}catch(t){e.zpp_next=Kt.zpp_pool,(Kt.zpp_pool=e).zpp_inner=null;break}}return this},wt.prototype.filter=function(t){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var i=this.at(e);try{t(i)?++e:this.remove(i)}catch(t){break}}return this},Object.defineProperty(wt.prototype,"length",{get:wt.prototype.get_length}),wt.prototype.__class__=wt,(s=nape.geom.Geom=function(){}).__name__=["nape","geom","Geom"],s.distanceBody=function(t,e,i,n){for(var r=t.zpp_inner.shapes.head;null!=r;)_e.validateShape(r.elt),r=r.next;for(var s=e.zpp_inner.shapes.head;null!=s;)_e.validateShape(s.elt),s=s.next;return Ie.distanceBody(t.zpp_inner,e.zpp_inner,i.zpp_inner,n.zpp_inner)},s.distance=function(t,e,i,n){_e.validateShape(t.zpp_inner),_e.validateShape(e.zpp_inner),null==Ir.zpp_pool?pt=new Ir:(pt=Ir.zpp_pool,Ir.zpp_pool=pt.next,pt.next=null),pt.weak=!1;var r=t.zpp_inner,s=e.zpp_inner,o=i.zpp_inner,a=n.zpp_inner;if(0==r.type&&0==s.type){var l,t=r.circle,e=s.circle,i=0,p=0,i=e.worldCOMx-t.worldCOMx,p=e.worldCOMy-t.worldCOMy,n=Math.sqrt(i*i+p*p),h=n-(t.radius+e.radius);h<1e100&&(0==n?(i=1,p=0):(i*=l=1/n,p*=l),l=t.radius,o.x=t.worldCOMx+i*l,o.y=t.worldCOMy+p*l,l=-e.radius,a.x=e.worldCOMx+i*l,a.y=e.worldCOMy+p*l,pt.x=i,pt.y=p),p=h}else{h=!1;if(0==r.type&&1==s.type&&(c=r,r=s,s=c,u=o,o=a,a=u,h=!0),1==r.type&&0==s.type){for(var u,c=r.polygon,d=s.circle,_=-1e100,y=null,f=c.edges.head;null!=f;){var m=f.elt,x=m.gnormx*d.worldCOMx+m.gnormy*d.worldCOMy-m.gprojection-d.radius;if(1e100<x){_=x;break}0<x?_<x&&(_=x,y=m):_<0&&_<x&&(_=x,y=m),f=f.next}_<1e100&&(u=y.gp0,q=y.gp1,(H=d.worldCOMy*y.gnormx-d.worldCOMx*y.gnormy)<=u.y*y.gnormx-u.x*y.gnormy?(F=R=0,R=d.worldCOMx-u.x,F=d.worldCOMy-u.y,(_=(c=Math.sqrt(R*R+F*F))-d.radius)<1e100&&(0==c?(R=1,F=0):(R*=L=1/c,F*=L),o.x=u.x+0*R,o.y=u.y+0*F,L=-d.radius,a.x=d.worldCOMx+R*L,a.y=d.worldCOMy+F*L,pt.x=R,pt.y=F)):H>=q.y*y.gnormx-q.x*y.gnormy?(N=j=0,j=d.worldCOMx-q.x,N=d.worldCOMy-q.y,(_=(K=Math.sqrt(j*j+N*N))-d.radius)<1e100&&(0==K?(j=1,N=0):(j*=W=1/K,N*=W),o.x=q.x+0*j,o.y=q.y+0*N,Y=-d.radius,a.x=d.worldCOMx+j*Y,a.y=d.worldCOMy+N*Y,pt.x=j,pt.y=N)):(G=-d.radius,a.x=d.worldCOMx+y.gnormx*G,a.y=d.worldCOMy+y.gnormy*G,U=-_,o.x=a.x+y.gnormx*U,o.y=a.y+y.gnormy*U,pt.x=y.gnormx,pt.y=y.gnormy)),h&&(pt.x=-pt.x,pt.y=-pt.y),p=_}else{for(var v=r.polygon,g=s.polygon,b=-1e100,z=null,w=null,C=0,P=v.edges.head;null!=P;){for(var T=P.elt,S=1e100,M=g.gverts.next;null!=M;){var A=T.gnormx*M.x+T.gnormy*M.y;A<S&&(S=A),M=M.next}if(1e100<(S-=T.gprojection)){b=S;break}0<S?b<S&&(b=S,z=T,C=1):b<0&&b<S&&(b=S,z=T,C=1),P=P.next}if(b<1e100){for(var O,k=g.edges.head;null!=k;){for(var E=k.elt,I=1e100,D=v.gverts.next;null!=D;){var B=E.gnormx*D.x+E.gnormy*D.y;B<I&&(I=B),D=D.next}if(1e100<(I-=E.gprojection)){b=I;break}0<I?b<I&&(b=I,w=E,C=2):b<0&&b<I&&(b=I,w=E,C=2),k=k.next}if(b<1e100){1==C?(V=g,O=z):(V=v,O=w,X=o,o=a,a=X,h=!h);for(var L,R,F,j,N,G,U,X,V,W,H,q,Y,K,Z,J,Q,$,tt,et,it,nt,rt=null,st=1e100,ot=V.edges.head;null!=ot;){var at=ot.elt,lt=O.gnormx*at.gnormx+O.gnormy*at.gnormy;lt<st&&(st=lt,rt=at),ot=ot.next}h?(pt.x=-O.gnormx,pt.y=-O.gnormy):(pt.x=O.gnormx,pt.y=O.gnormy),p=0<=b?(L=O.gp0,R=O.gp1,F=rt.gp0,Q=rt.gp1,Z=K=tt=H=0,J=1/((H=R.x-L.x)*H+(tt=R.y-L.y)*tt),W=1/((K=Q.x-F.x)*K+(Z=Q.y-F.y)*Z),(et=-(H*(L.x-F.x)+tt*(L.y-F.y))*J)<0?et=0:1<et&&(et=1),(q=-(H*(L.x-Q.x)+tt*(L.y-Q.y))*J)<0?q=0:1<q&&(q=1),(Y=-(K*(F.x-L.x)+Z*(F.y-L.y))*W)<0?Y=0:1<Y&&(Y=1),(it=-(K*(F.x-R.x)+Z*(F.y-R.y))*W)<0?it=0:1<it&&(it=1),N=j=0,j=L.x+H*et,N=L.y+tt*et,nt=G=0,G=L.x+H*q,nt=L.y+tt*q,r=U=0,U=F.x+K*Y,r=F.y+Z*Y,X=s=0,s=F.x+K*it,X=F.y+Z*it,Z=K=Y=q=tt=H=et=W=J=V=0,it=null,(J=(V=j-F.x)*V+(J=N-F.y)*J)<(et=(W=G-Q.x)*W+(et=nt-Q.y)*et)?(K=j,Z=N,it=F):(K=G,Z=nt,it=Q,J=et),Q=nt=0,et=null,(tt=(H=U-L.x)*H+(tt=r-L.y)*tt)<(Y=(q=s-R.x)*q+(Y=X-R.y)*Y)?(nt=U,Q=r,et=L):(nt=s,Q=X,et=R,tt=Y),0!=(b=J<tt?(o.x=K,o.y=Z,a.x=it.x,a.y=it.y,Math.sqrt(J)):(a.x=nt,a.y=Q,o.x=et.x,o.y=et.y,Math.sqrt(tt)))&&(pt.x=a.x-o.x,pt.y=a.y-o.y,$=1/b,pt.x*=$,pt.y*=$,h&&(pt.x=-pt.x,pt.y=-pt.y)),b):(it=Z=0,Z=rt.gp0.x,it=rt.gp0.y,et=Q=nt=J=0,Q=(J=rt.gp1.x)-Z,et=(nt=rt.gp1.y)-it,tt=O.gnormy*Z-O.gnormx*it,h=1/(($=O.gnormy*J-O.gnormx*nt)-tt),(tt=(-O.tp1-tt)*h)>kr.epsilon&&(Z+=Q*tt,it+=et*tt),(h=(-O.tp0-$)*h)<-kr.epsilon&&(J+=Q*h,nt+=et*h),(et=Z*O.gnormx+it*O.gnormy-O.gprojection)<(h=J*O.gnormx+nt*O.gnormy-O.gprojection)?(a.x=Z,a.y=it,it=-et,o.x=a.x+O.gnormx*it,o.y=a.y+O.gnormy*it,et):(a.x=J,a.y=nt,nt=-h,o.x=a.x+O.gnormx*nt,o.y=a.y+O.gnormy*nt,h))}else p=1e100}else p=1e100}}var pt=pt;return null!=pt.outer&&(pt.outer.zpp_inner=null,pt.outer=null),pt._isimmutable=null,pt._validate=null,pt._invalidate=null,pt.next=Ir.zpp_pool,Ir.zpp_pool=pt,p},s.intersectsBody=function(t,e){for(var i=t.zpp_inner.shapes.head;null!=i;)_e.validateShape(i.elt),i=i.next;for(var n=e.zpp_inner.shapes.head;null!=n;)_e.validateShape(n.elt),n=n.next;var r=t.zpp_inner.aabb,s=e.zpp_inner.aabb;if(s.miny<=r.maxy&&r.miny<=s.maxy&&s.minx<=r.maxx&&r.minx<=s.maxx){for(var o=t.zpp_inner.shapes.head;null!=o;){for(var a=o.elt,l=e.zpp_inner.shapes.head;null!=l;){if(Er.testCollide_safe(a,l.elt))return!0;l=l.next}o=o.next}return!1}return!1},s.intersects=function(t,e){_e.validateShape(t.zpp_inner),_e.validateShape(e.zpp_inner);var i=t.zpp_inner.aabb,n=e.zpp_inner.aabb;return n.miny<=i.maxy&&i.miny<=n.maxy&&n.minx<=i.maxx&&i.minx<=n.maxx&&Er.testCollide_safe(t.zpp_inner,e.zpp_inner)},s.contains=function(t,e){return _e.validateShape(t.zpp_inner),_e.validateShape(e.zpp_inner),Er.containTest(t.zpp_inner,e.zpp_inner)},s.prototype.__class__=s;var ci=nape.geom.GeomPoly=function(t){if(this.zpp_inner=null,this.zpp_pool=null,this.zpp_inner=new ye(this),null!=t){if(t instanceof Array&&null==t.__enum__)for(var e=t,i=0;i<e.length;){var n=e[i];++i;var r=n,s=r.zpp_inner;null!=s._validate&&s._validate();n=r.zpp_inner.x,s=r.zpp_inner;null!=s._validate&&s._validate();var o,r=r.zpp_inner.y;null==nn.zpp_pool?o=new nn:(o=nn.zpp_pool,nn.zpp_pool=o.next,o.next=null),o.forced=!1,o.x=n,o.y=r;r=o;null==this.zpp_inner.vertices?this.zpp_inner.vertices=r.prev=r.next=r:(r.prev=this.zpp_inner.vertices,r.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=r,this.zpp_inner.vertices.next=r),this.zpp_inner.vertices=r}else if(F.__instanceof(t,Y))for(var a=t.iterator();;){a.zpp_inner.zpp_inner.valmod();var l=a.zpp_inner.zpp_gl();if(a.zpp_critical=!0,!(a.zpp_i<l||(a.zpp_next=Qt.zpp_pool,(Qt.zpp_pool=a).zpp_inner=null,!1)))break;a.zpp_critical=!1;var p=a.zpp_inner.at(a.zpp_i++),h=p.zpp_inner;null!=h._validate&&h._validate();l=p.zpp_inner.x,h=p.zpp_inner;null!=h._validate&&h._validate();var u,p=p.zpp_inner.y;null==nn.zpp_pool?u=new nn:(u=nn.zpp_pool,nn.zpp_pool=u.next,u.next=null),u.forced=!1,u.x=l,u.y=p;p=u;null==this.zpp_inner.vertices?this.zpp_inner.vertices=p.prev=p.next=p:(p.prev=this.zpp_inner.vertices,p.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=p,this.zpp_inner.vertices.next=p),this.zpp_inner.vertices=p}else if(F.__instanceof(t,ci)){var c=t.zpp_inner.vertices;if(null!=c)for(var d=c;;){var _,y,f,m=d.x,x=d.y;null==Rn.poolVec2?_=new Ct:(_=Rn.poolVec2,Rn.poolVec2=_.zpp_pool,_.zpp_pool=null),null==_.zpp_inner?(null==Ir.zpp_pool?y=new Ir:(y=Ir.zpp_pool,Ir.zpp_pool=y.next,y.next=null),y.weak=!1,y._immutable=!1,y.x=m,y.y=x,_.zpp_inner=y,_.zpp_inner.outer=_):(null!=(f=_.zpp_inner)._validate&&f._validate(),_.zpp_inner.x==m&&(null!=(f=_.zpp_inner)._validate&&f._validate(),_.zpp_inner.y==x)||(_.zpp_inner.x=m,_.zpp_inner.y=x,null!=(v=_.zpp_inner)._invalidate&&v._invalidate(v))),_.zpp_inner.weak=!1;m=_,d=d.next,x=m.zpp_inner;null!=x._validate&&x._validate();var v=m.zpp_inner.x,x=m.zpp_inner;null!=x._validate&&x._validate();var g,x=m.zpp_inner.y;null==nn.zpp_pool?g=new nn:(g=nn.zpp_pool,nn.zpp_pool=g.next,g.next=null),g.forced=!1,g.x=v,g.y=x;x=g;null==this.zpp_inner.vertices?this.zpp_inner.vertices=x.prev=x.next=x:(x.prev=this.zpp_inner.vertices,x.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=x,this.zpp_inner.vertices.next=x),this.zpp_inner.vertices=x;x=m.zpp_inner;m.zpp_inner.outer=null,m.zpp_inner=null;m=m;m.zpp_pool=Rn.poolVec2,Rn.poolVec2=m;x=x;if(null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ir.zpp_pool,Ir.zpp_pool=x,d==c)break}}if(this.skipForward(1),t instanceof Array&&null==t.__enum__)for(var b=t,z=0;z<b.length;){var w=b[z],C=!!w.zpp_inner.weak&&(C=w.zpp_inner,w.zpp_inner.outer=null,w.zpp_inner=null,(w=w).zpp_pool=Rn.poolVec2,Rn.poolVec2=w,null!=(C=C).outer&&(C.outer.zpp_inner=null,C.outer=null),C._isimmutable=null,C._validate=null,C._invalidate=null,C.next=Ir.zpp_pool,Ir.zpp_pool=C,!0);C?b.splice(z,1):++z}else if(F.__instanceof(t,Y)){t=t;null!=t.zpp_inner._validate&&t.zpp_inner._validate();for(var P=t.zpp_inner.inner,T=null,S=P.head;null!=S;){var M,A=S.elt;A.outer.zpp_inner.weak?(S=P.erase(T),A.outer.zpp_inner.weak&&(A=(M=A.outer).zpp_inner,M.zpp_inner.outer=null,M.zpp_inner=null,(M=M).zpp_pool=Rn.poolVec2,Rn.poolVec2=M,null!=(A=A).outer&&(A.outer.zpp_inner=null,A.outer=null),A._isimmutable=null,A._validate=null,A._invalidate=null,A.next=Ir.zpp_pool,Ir.zpp_pool=A)):S=(T=S).next}}}};ci.__name__=["nape","geom","GeomPoly"],ci.get=function(t){var e;if(null==Rn.poolGeomPoly?e=new ci:(e=Rn.poolGeomPoly,Rn.poolGeomPoly=e.zpp_pool,e.zpp_pool=null),null!=t){if(t instanceof Array&&null==t.__enum__)for(var i=t,n=0;n<i.length;){var r=i[n];++n;var s=r,o=s.zpp_inner;null!=o._validate&&o._validate();r=s.zpp_inner.x,o=s.zpp_inner;null!=o._validate&&o._validate();var a,s=s.zpp_inner.y;null==nn.zpp_pool?a=new nn:(a=nn.zpp_pool,nn.zpp_pool=a.next,a.next=null),a.forced=!1,a.x=r,a.y=s;s=a;null==e.zpp_inner.vertices?e.zpp_inner.vertices=s.prev=s.next=s:(s.prev=e.zpp_inner.vertices,s.next=e.zpp_inner.vertices.next,e.zpp_inner.vertices.next.prev=s,e.zpp_inner.vertices.next=s),e.zpp_inner.vertices=s}else if(F.__instanceof(t,Y))for(var l=t.iterator();;){l.zpp_inner.zpp_inner.valmod();var p=l.zpp_inner.zpp_gl();if(l.zpp_critical=!0,!(l.zpp_i<p||(l.zpp_next=Qt.zpp_pool,(Qt.zpp_pool=l).zpp_inner=null,!1)))break;l.zpp_critical=!1;var h=l.zpp_inner.at(l.zpp_i++),u=h.zpp_inner;null!=u._validate&&u._validate();p=h.zpp_inner.x,u=h.zpp_inner;null!=u._validate&&u._validate();var c,h=h.zpp_inner.y;null==nn.zpp_pool?c=new nn:(c=nn.zpp_pool,nn.zpp_pool=c.next,c.next=null),c.forced=!1,c.x=p,c.y=h;h=c;null==e.zpp_inner.vertices?e.zpp_inner.vertices=h.prev=h.next=h:(h.prev=e.zpp_inner.vertices,h.next=e.zpp_inner.vertices.next,e.zpp_inner.vertices.next.prev=h,e.zpp_inner.vertices.next=h),e.zpp_inner.vertices=h}else if(F.__instanceof(t,ci)){var d=t.zpp_inner.vertices;if(null!=d)for(var _=d;;){var y,f,m,x=_.x,v=_.y;null==Rn.poolVec2?y=new Ct:(y=Rn.poolVec2,Rn.poolVec2=y.zpp_pool,y.zpp_pool=null),null==y.zpp_inner?(null==Ir.zpp_pool?f=new Ir:(f=Ir.zpp_pool,Ir.zpp_pool=f.next,f.next=null),f.weak=!1,f._immutable=!1,f.x=x,f.y=v,y.zpp_inner=f,y.zpp_inner.outer=y):(null!=(m=y.zpp_inner)._validate&&m._validate(),y.zpp_inner.x==x&&(null!=(m=y.zpp_inner)._validate&&m._validate(),y.zpp_inner.y==v)||(y.zpp_inner.x=x,y.zpp_inner.y=v,null!=(g=y.zpp_inner)._invalidate&&g._invalidate(g))),y.zpp_inner.weak=!1;x=y,_=_.next,v=x.zpp_inner;null!=v._validate&&v._validate();var g=x.zpp_inner.x,v=x.zpp_inner;null!=v._validate&&v._validate();var b,v=x.zpp_inner.y;null==nn.zpp_pool?b=new nn:(b=nn.zpp_pool,nn.zpp_pool=b.next,b.next=null),b.forced=!1,b.x=g,b.y=v;v=b;null==e.zpp_inner.vertices?e.zpp_inner.vertices=v.prev=v.next=v:(v.prev=e.zpp_inner.vertices,v.next=e.zpp_inner.vertices.next,e.zpp_inner.vertices.next.prev=v,e.zpp_inner.vertices.next=v),e.zpp_inner.vertices=v;v=x.zpp_inner;x.zpp_inner.outer=null,x.zpp_inner=null;x=x;x.zpp_pool=Rn.poolVec2,Rn.poolVec2=x;v=v;if(null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Ir.zpp_pool,Ir.zpp_pool=v,_==d)break}}if(e.skipForward(1),t instanceof Array&&null==t.__enum__)for(var z=t,w=0;w<z.length;){var C=z[w],P=!!C.zpp_inner.weak&&(P=C.zpp_inner,C.zpp_inner.outer=null,C.zpp_inner=null,(C=C).zpp_pool=Rn.poolVec2,Rn.poolVec2=C,null!=(P=P).outer&&(P.outer.zpp_inner=null,P.outer=null),P._isimmutable=null,P._validate=null,P._invalidate=null,P.next=Ir.zpp_pool,Ir.zpp_pool=P,!0);P?z.splice(w,1):++w}else if(F.__instanceof(t,Y)){t=t;null!=t.zpp_inner._validate&&t.zpp_inner._validate();for(var T=t.zpp_inner.inner,S=null,M=T.head;null!=M;){var A,O=M.elt;O.outer.zpp_inner.weak?(M=T.erase(S),O.outer.zpp_inner.weak&&(O=(A=O.outer).zpp_inner,A.zpp_inner.outer=null,A.zpp_inner=null,(A=A).zpp_pool=Rn.poolVec2,Rn.poolVec2=A,null!=(O=O).outer&&(O.outer.zpp_inner=null,O.outer=null),O._isimmutable=null,O._validate=null,O._invalidate=null,O.next=Ir.zpp_pool,Ir.zpp_pool=O)):M=(S=M).next}}}return e},ci.prototype.zpp_pool=null,ci.prototype.zpp_inner=null,ci.prototype.empty=function(){return null==this.zpp_inner.vertices},ci.prototype.size=function(){var t=0,e=this.zpp_inner.vertices,i=this.zpp_inner.vertices;if(null!=e)for(var n=e;++t,(n=n.next)!=i;);return t},ci.prototype.iterator=function(){return fe.get(this.zpp_inner.vertices,!0)},ci.prototype.forwardIterator=function(){return fe.get(this.zpp_inner.vertices,!0)},ci.prototype.backwardsIterator=function(){return fe.get(this.zpp_inner.vertices,!1)},ci.prototype.current=function(){var t,e,i,n,r=this.zpp_inner.vertices;return null==r.wrap&&(t=r.x,n=r.y,null==Rn.poolVec2?e=new Ct:(e=Rn.poolVec2,Rn.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==Ir.zpp_pool?i=new Ir:(i=Ir.zpp_pool,Ir.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=t,i.y=n,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.x==t&&(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.y==n)||(e.zpp_inner.x=t,e.zpp_inner.y=n,null!=(n=e.zpp_inner)._invalidate&&n._invalidate(n))),e.zpp_inner.weak=!1,r.wrap=e,r.wrap.zpp_inner._inuse=!0,r.wrap.zpp_inner._invalidate=Z(r,r.modwrap),r.wrap.zpp_inner._validate=Z(r,r.getwrap)),r.wrap},ci.prototype.push=function(t){var e=t.zpp_inner;null!=e._validate&&e._validate();var i=t.zpp_inner.x,e=t.zpp_inner;null!=e._validate&&e._validate();e=t.zpp_inner.y;null==nn.zpp_pool?n=new nn:(n=nn.zpp_pool,nn.zpp_pool=n.next,n.next=null),n.forced=!1,n.x=i,n.y=e;var n=n;return null==this.zpp_inner.vertices?this.zpp_inner.vertices=n.prev=n.next=n:(n.prev=this.zpp_inner.vertices,n.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=n,this.zpp_inner.vertices.next=n),this.zpp_inner.vertices=n,t.zpp_inner.weak&&(n=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Ir.zpp_pool,Ir.zpp_pool=n),this},ci.prototype.pop=function(){var t,e=this.zpp_inner.vertices,i=null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices?this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null:(t=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,t);return this.zpp_inner.vertices=i,null!=e.wrap&&(e.wrap.zpp_inner._inuse=!1,i=(t=e.wrap).zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ir.zpp_pool,Ir.zpp_pool=i,e.wrap=null),e.prev=e.next=null,e.next=nn.zpp_pool,nn.zpp_pool=e,this},ci.prototype.unshift=function(t){var e=t.zpp_inner;null!=e._validate&&e._validate();var i=t.zpp_inner.x,e=t.zpp_inner;null!=e._validate&&e._validate();e=t.zpp_inner.y;null==nn.zpp_pool?n=new nn:(n=nn.zpp_pool,nn.zpp_pool=n.next,n.next=null),n.forced=!1,n.x=i,n.y=e;var n=n;return null==this.zpp_inner.vertices?this.zpp_inner.vertices=n.prev=n.next=n:(n.next=this.zpp_inner.vertices,n.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.prev.next=n,this.zpp_inner.vertices.prev=n),this.zpp_inner.vertices=n,t.zpp_inner.weak&&(n=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Ir.zpp_pool,Ir.zpp_pool=n),this},ci.prototype.shift=function(){var t,e=this.zpp_inner.vertices,i=null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices?(this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null):(t=this.zpp_inner.vertices.next,this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,t);return this.zpp_inner.vertices=i,null!=e.wrap&&(e.wrap.zpp_inner._inuse=!1,i=(t=e.wrap).zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ir.zpp_pool,Ir.zpp_pool=i,e.wrap=null),e.prev=e.next=null,e.next=nn.zpp_pool,nn.zpp_pool=e,this},ci.prototype.skipForward=function(t){if(null!=this.zpp_inner.vertices)if(0<t)for(;0<t--;)this.zpp_inner.vertices=this.zpp_inner.vertices.next;else if(t<0)for(;t++<0;)this.zpp_inner.vertices=this.zpp_inner.vertices.prev;return this},ci.prototype.skipBackwards=function(t){return this.skipForward(-t)},ci.prototype.erase=function(t){for(;0!=t&&null!=this.zpp_inner.vertices;){var e,i,n,r=this.zpp_inner.vertices;0<t?(e=null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices?(this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null):(e=this.zpp_inner.vertices.next,this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,e),this.zpp_inner.vertices=e,--t):t<0&&(n=null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices?this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null:(i=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,i),this.zpp_inner.vertices=n,++t),null!=r.wrap&&(r.wrap.zpp_inner._inuse=!1,n=(i=r.wrap).zpp_inner,i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Rn.poolVec2,Rn.poolVec2=i,null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Ir.zpp_pool,Ir.zpp_pool=n,r.wrap=null),r.prev=r.next=null,r.next=nn.zpp_pool,nn.zpp_pool=r}return this},ci.prototype.clear=function(){for(;null!=this.zpp_inner.vertices;){var t,e=this.zpp_inner.vertices,i=null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices?(this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null):(t=this.zpp_inner.vertices.next,this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,t);this.zpp_inner.vertices=i,null!=e.wrap&&(e.wrap.zpp_inner._inuse=!1,i=(t=e.wrap).zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ir.zpp_pool,Ir.zpp_pool=i,e.wrap=null),e.prev=e.next=null,e.next=nn.zpp_pool,nn.zpp_pool=e}return this},ci.prototype.copy=function(){var t=ci.get(),e=this.zpp_inner.vertices,i=this.zpp_inner.vertices;if(null!=e)for(var n=e;;){var r,s=n.x,o=n.y;null==nn.zpp_pool?r=new nn:(r=nn.zpp_pool,nn.zpp_pool=r.next,r.next=null),r.forced=!1,r.x=s,r.y=o;o=r;if(null==t.zpp_inner.vertices?t.zpp_inner.vertices=o.prev=o.next=o:(o.prev=t.zpp_inner.vertices,o.next=t.zpp_inner.vertices.next,t.zpp_inner.vertices.next.prev=o,t.zpp_inner.vertices.next=o),t.zpp_inner.vertices=o,(n=n.next)==i)break}return t.skipForward(1)},ci.prototype.dispose=function(){this.clear();this.zpp_pool=Rn.poolGeomPoly,Rn.poolGeomPoly=this},ci.prototype.toString=function(){var t="GeomPoly[",e=this.zpp_inner.vertices,i=this.zpp_inner.vertices;if(null!=e)for(var n=e;;)if(n!=this.zpp_inner.vertices&&(t+=","),t+="{"+n.x+","+n.y+"}",(n=n.next)==i)break;return t+"]"},ci.prototype.area=function(){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return 0;var t=0,e=this.zpp_inner.vertices,i=this.zpp_inner.vertices;if(null!=e)for(var n=e;;)if(t+=n.x*(n.next.y-n.prev.y),(n=n.next)==i)break;e=.5*t;return e<0?-e:e},ci.prototype.winding=function(){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return null==Yn.Winding_UNDEFINED&&(Yn.internal=!0,Yn.Winding_UNDEFINED=new J,Yn.internal=!1),Yn.Winding_UNDEFINED;var t=0,e=this.zpp_inner.vertices,i=this.zpp_inner.vertices;if(null!=e)for(var n=e;;)if(t+=n.x*(n.next.y-n.prev.y),(n=n.next)==i)break;e=.5*t;return 0<e?(null==Yn.Winding_CLOCKWISE&&(Yn.internal=!0,Yn.Winding_CLOCKWISE=new J,Yn.internal=!1),Yn.Winding_CLOCKWISE):0==e?(null==Yn.Winding_UNDEFINED&&(Yn.internal=!0,Yn.Winding_UNDEFINED=new J,Yn.internal=!1),Yn.Winding_UNDEFINED):(null==Yn.Winding_ANTICLOCKWISE&&(Yn.internal=!0,Yn.Winding_ANTICLOCKWISE=new J,Yn.internal=!1),Yn.Winding_ANTICLOCKWISE)},ci.prototype.contains=function(t){var e=t.zpp_inner;null!=e._validate&&e._validate();var i=t.zpp_inner.x,n=t.zpp_inner;null!=n._validate&&n._validate();var r=t.zpp_inner.y,s=!1,e=this.zpp_inner.vertices,o=this.zpp_inner.vertices;if(null!=e)for(var a=e;;){var l=a.prev;if((a.y<r&&l.y>=r||l.y<r&&a.y>=r)&&(a.x<=i||l.x<=i)&&a.x+(r-a.y)/(l.y-a.y)*(l.x-a.x)<i&&(s=!s),(a=a.next)==o)break}n=s;return t.zpp_inner.weak&&(e=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ir.zpp_pool,Ir.zpp_pool=e),n},ci.prototype.isClockwise=function(){var t=this.winding();return null==Yn.Winding_CLOCKWISE&&(Yn.internal=!0,Yn.Winding_CLOCKWISE=new J,Yn.internal=!1),t==Yn.Winding_CLOCKWISE},ci.prototype.isConvex=function(){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return!0;var t=!1,e=!1,i=!0,n=this.zpp_inner.vertices,r=this.zpp_inner.vertices;if(null!=n)for(var s=n;;){var o=s.prev,a=s.next,l=a.x-s.x,p=a.y-s.y,a=s.x-o.x,p=(s.y-o.y)*l-a*p;if(0<p?e=!0:p<0&&(t=!0),e&&t){i=!1;break}if((s=s.next)==r)break}return i},ci.prototype.isSimple=function(){return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||Me.isSimple(this.zpp_inner.vertices)},ci.prototype.isMonotone=function(){return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||ge.isMonotone(this.zpp_inner.vertices)},ci.prototype.isDegenerate=function(){return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||this.area()<kr.epsilon},ci.prototype.simplify=function(t){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return this.copy();var e=ke.simplify(this.zpp_inner.vertices,t),t=ci.get();return t.zpp_inner.vertices=e,t},ci.prototype.simpleDecomposition=function(t){null==ze.sharedGVList&&(ze.sharedGVList=new Ti);for(var e=Me.decompose(this.zpp_inner.vertices,ze.sharedGVList),i=null==t?new di:t;null!=e.head;){var n=e.pop_unsafe(),r=ci.get();r.zpp_inner.vertices=n,i.zpp_inner.reverse_flag?i.push(r):i.unshift(r)}return i},ci.prototype.monotoneDecomposition=function(t){null==ge.sharedPPoly&&(ge.sharedPPoly=new ze);var e=ge.decompose(this.zpp_inner.vertices,ge.sharedPPoly);null==ze.sharedGVList&&(ze.sharedGVList=new Ti);for(var i=e.extract(ze.sharedGVList),n=null==t?new di:t;null!=i.head;){var r=i.pop_unsafe(),s=ci.get();s.zpp_inner.vertices=r,n.zpp_inner.reverse_flag?n.push(s):n.unshift(s)}return n},ci.prototype.convexDecomposition=function(t,e){null==t&&(t=!1),null==ge.sharedPPoly&&(ge.sharedPPoly=new ze);var i=ge.decompose(this.zpp_inner.vertices,ge.sharedPPoly);null==ze.sharedPPList&&(ze.sharedPPList=new Pi);for(var n=i.extract_partitions(ze.sharedPPList),r=null==e?new di:e;null!=n.head;){var s=n.pop_unsafe();Le.triangulate(s),t&&Le.optimise(s),ce.optimise(s),null==ze.sharedGVList&&(ze.sharedGVList=new Ti);var o=s.extract(ze.sharedGVList);for(s.next=ze.zpp_pool,ze.zpp_pool=s;null!=o.head;){var a=o.pop_unsafe(),l=ci.get();l.zpp_inner.vertices=a,r.zpp_inner.reverse_flag?r.push(l):r.unshift(l)}}return r},ci.prototype.triangularDecomposition=function(t,e){null==t&&(t=!1),null==ge.sharedPPoly&&(ge.sharedPPoly=new ze);var i=ge.decompose(this.zpp_inner.vertices,ge.sharedPPoly);null==ze.sharedPPList&&(ze.sharedPPList=new Pi);for(var n=i.extract_partitions(ze.sharedPPList),r=null==e?new di:e;null!=n.head;){var s=n.pop_unsafe();Le.triangulate(s),t&&Le.optimise(s),null==ze.sharedGVList&&(ze.sharedGVList=new Ti);var o=s.extract(ze.sharedGVList);for(s.next=ze.zpp_pool,ze.zpp_pool=s;null!=o.head;){var a=o.pop_unsafe(),l=ci.get();l.zpp_inner.vertices=a,r.zpp_inner.reverse_flag?r.push(l):r.unshift(l)}}return r},ci.prototype.inflate=function(t){var e=ci.get(),i=this.winding();null==Yn.Winding_CLOCKWISE&&(Yn.internal=!0,Yn.Winding_CLOCKWISE=new J,Yn.internal=!1),i==Yn.Winding_CLOCKWISE&&(t=-t);var i=this.zpp_inner.vertices,n=this.zpp_inner.vertices;if(null!=i)for(var r=i;;){var s=r,o=s.prev,a=s.next,l=0,p=s.x-o.x,h=s.y-o.y,l=a.x-s.x,u=a.y-s.y,c=0,d=p,_=h,o=1/Math.sqrt(d*d+_*_),a=d*=o;d=-(_*=o),_=a,d*=t,_*=t,m=l,c=u;var y,f,o=1/Math.sqrt(m*m+c*c),a=m*=o,m=-(c*=o),c=a,c=u*((m*=t)-d)-l*((c*=t)-_),c=0==c?0:c/(u*p-l*h),l=0,u=s.x+d,l=s.y+_;if(u+=p*c,l+=h*c,null==Rn.poolVec2?y=new Ct:(y=Rn.poolVec2,Rn.poolVec2=y.zpp_pool,y.zpp_pool=null),null==y.zpp_inner?(null==Ir.zpp_pool?f=new Ir:(f=Ir.zpp_pool,Ir.zpp_pool=f.next,f.next=null),f.weak=!1,f._immutable=!1,f.x=u,f.y=l,y.zpp_inner=f,y.zpp_inner.outer=y):(null!=(c=y.zpp_inner)._validate&&c._validate(),y.zpp_inner.x==u&&(null!=(c=y.zpp_inner)._validate&&c._validate(),y.zpp_inner.y==l)||(y.zpp_inner.x=u,y.zpp_inner.y=l,null!=(l=y.zpp_inner)._invalidate&&l._invalidate(l))),y.zpp_inner.weak=!1,e.push(y),(r=r.next)==n)break}return e.skipForward(1)},ci.prototype.cut=function(t,e,i,n,r){null==n&&(n=!1),null==i&&(i=!1);var s,r=fi.run(this.zpp_inner.vertices,t,e,i,n,r);return t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),e.zpp_inner.weak&&(s=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Rn.poolVec2,Rn.poolVec2=e,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),r},ci.prototype.transform=function(t){var e=this.zpp_inner.vertices,i=this.zpp_inner.vertices;if(null!=e)for(var n=e;;){var r=n,s=t.zpp_inner.a*r.x+t.zpp_inner.b*r.y+t.zpp_inner.tx;if(r.y=t.zpp_inner.c*r.x+t.zpp_inner.d*r.y+t.zpp_inner.ty,r.x=s,(n=n.next)==i)break}return this},ci.prototype.bounds=function(){var t=1e100,e=1e100,i=-1e100,n=-1e100,r=this.zpp_inner.vertices,s=this.zpp_inner.vertices;if(null!=r)for(var o=r;;)if(o.x<t&&(t=o.x),o.y<e&&(e=o.y),o.x>i&&(i=o.x),o.y>n&&(n=o.y),(o=o.next)==s)break;return new N(t,e,i-t,n-e)},ci.prototype.top=function(){var t,e,i,n=this.zpp_inner.vertices,r=this.zpp_inner.vertices.next,s=this.zpp_inner.vertices;if(null!=r)for(var o=r;;)if(o.y<n.y&&(n=o),(o=o.next)==s)break;return null==n.wrap&&(t=n.x,r=n.y,null==Rn.poolVec2?e=new Ct:(e=Rn.poolVec2,Rn.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==Ir.zpp_pool?i=new Ir:(i=Ir.zpp_pool,Ir.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=t,i.y=r,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.x==t&&(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.y==r)||(e.zpp_inner.x=t,e.zpp_inner.y=r,null!=(r=e.zpp_inner)._invalidate&&r._invalidate(r))),e.zpp_inner.weak=!1,n.wrap=e,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=Z(n,n.modwrap),n.wrap.zpp_inner._validate=Z(n,n.getwrap)),n.wrap},ci.prototype.bottom=function(){var t,e,i,n=this.zpp_inner.vertices,r=this.zpp_inner.vertices.next,s=this.zpp_inner.vertices;if(null!=r)for(var o=r;;)if(o.y>n.y&&(n=o),(o=o.next)==s)break;return null==n.wrap&&(t=n.x,r=n.y,null==Rn.poolVec2?e=new Ct:(e=Rn.poolVec2,Rn.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==Ir.zpp_pool?i=new Ir:(i=Ir.zpp_pool,Ir.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=t,i.y=r,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.x==t&&(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.y==r)||(e.zpp_inner.x=t,e.zpp_inner.y=r,null!=(r=e.zpp_inner)._invalidate&&r._invalidate(r))),e.zpp_inner.weak=!1,n.wrap=e,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=Z(n,n.modwrap),n.wrap.zpp_inner._validate=Z(n,n.getwrap)),n.wrap},ci.prototype.left=function(){var t,e,i,n=this.zpp_inner.vertices,r=this.zpp_inner.vertices.next,s=this.zpp_inner.vertices;if(null!=r)for(var o=r;;)if(o.x<n.x&&(n=o),(o=o.next)==s)break;return null==n.wrap&&(t=n.x,r=n.y,null==Rn.poolVec2?e=new Ct:(e=Rn.poolVec2,Rn.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==Ir.zpp_pool?i=new Ir:(i=Ir.zpp_pool,Ir.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=t,i.y=r,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.x==t&&(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.y==r)||(e.zpp_inner.x=t,e.zpp_inner.y=r,null!=(r=e.zpp_inner)._invalidate&&r._invalidate(r))),e.zpp_inner.weak=!1,n.wrap=e,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=Z(n,n.modwrap),n.wrap.zpp_inner._validate=Z(n,n.getwrap)),n.wrap},ci.prototype.right=function(){var t,e,i,n=this.zpp_inner.vertices,r=this.zpp_inner.vertices.next,s=this.zpp_inner.vertices;if(null!=r)for(var o=r;;)if(o.x>n.x&&(n=o),(o=o.next)==s)break;return null==n.wrap&&(t=n.x,r=n.y,null==Rn.poolVec2?e=new Ct:(e=Rn.poolVec2,Rn.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==Ir.zpp_pool?i=new Ir:(i=Ir.zpp_pool,Ir.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=t,i.y=r,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.x==t&&(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.y==r)||(e.zpp_inner.x=t,e.zpp_inner.y=r,null!=(r=e.zpp_inner)._invalidate&&r._invalidate(r))),e.zpp_inner.weak=!1,n.wrap=e,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=Z(n,n.modwrap),n.wrap.zpp_inner._validate=Z(n,n.getwrap)),n.wrap},ci.prototype.__class__=ci;var Zt=nape.geom.GeomPolyIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Zt.__name__=["nape","geom","GeomPolyIterator"],Zt.get=function(t){var e,i=null==Zt.zpp_pool?(An.internal=!0,e=new Zt,An.internal=!1,e):(i=Zt.zpp_pool,Zt.zpp_pool=i.zpp_next,i);return i.zpp_i=0,i.zpp_inner=t,i.zpp_critical=!1,i},Zt.prototype.zpp_inner=null,Zt.prototype.zpp_i=null,Zt.prototype.zpp_critical=null,Zt.prototype.zpp_next=null,Zt.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);t=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=Zt.zpp_pool,(Zt.zpp_pool=this).zpp_inner=null,!1)},Zt.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Zt.prototype.__class__=Zt;var di=nape.geom.GeomPolyList=function(){this.zpp_inner=null,this.zpp_inner=new An,this.zpp_inner.outer=this};di.__name__=["nape","geom","GeomPolyList"],di.fromArray=function(t){for(var e=new di,i=0;i<t.length;){var n=t[i];++i,e.push(n)}return e},di.prototype.zpp_inner=null,di.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},di.prototype.has=function(t){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(t.zpp_inner)},di.prototype.at=function(t){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.user_length-1-t),t<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=t,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(t);else for(;this.zpp_inner.at_index!=t;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},di.prototype.push=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(t.zpp_inner):(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},di.prototype.unshift=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)):this.zpp_inner.inner.add(t.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},di.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e,i=null;return this.zpp_inner.reverse_flag?(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(i=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.outer},di.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(i=(null==(e=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:e.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)):(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.outer},di.prototype.add=function(t){return this.zpp_inner.reverse_flag?this.push(t):this.unshift(t)},di.prototype.remove=function(t){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==t.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(t.zpp_inner),this.zpp_inner.invalidate()),e},di.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},di.prototype.empty=function(){return null==this.zpp_inner.inner.head},di.prototype.iterator=function(){return this.zpp_inner.valmod(),Zt.get(this)},di.prototype.copy=function(t){null==t&&(t=!1);var e=new di;this.zpp_inner.valmod();for(var i=Zt.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=Zt.zpp_pool,(Zt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e.push(t?null:n)}return e},di.prototype.merge=function(t){t.zpp_inner.valmod();for(var e=Zt.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Zt.zpp_pool,(Zt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);this.has(i)||(this.zpp_inner.reverse_flag?this.push(i):this.unshift(i))}},di.prototype.toString=function(){var t="[",e=!0;this.zpp_inner.valmod();for(var i=Zt.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=Zt.zpp_pool,(Zt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e||(t+=","),t+=null==n?"NULL":n.toString(),e=!1}return t+"]"},di.prototype.foreach=function(t){this.zpp_inner.valmod();for(var e=Zt.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Zt.zpp_pool,(Zt.zpp_pool=e).zpp_inner=null,!1)))break;try{e.zpp_critical=!1,t(e.zpp_inner.at(e.zpp_i++))}catch(t){e.zpp_next=Zt.zpp_pool,(Zt.zpp_pool=e).zpp_inner=null;break}}return this},di.prototype.filter=function(t){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var i=this.at(e);try{t(i)?++e:this.remove(i)}catch(t){break}}return this},Object.defineProperty(di.prototype,"length",{get:di.prototype.get_length}),di.prototype.__class__=di;var U=nape.geom.GeomVertexIterator=function(){};U.__name__=["nape","geom","GeomVertexIterator"],U.prototype.zpp_inner=null,U.prototype.hasNext=function(){var t,e=this.zpp_inner.ptr!=this.zpp_inner.start||this.zpp_inner.first;return this.zpp_inner.first=!1,e||((t=this.zpp_inner).outer.zpp_inner=null,t.ptr=t.start=null,t.next=fe.zpp_pool,fe.zpp_pool=t),e},U.prototype.next=function(){var t,e,i,n,r=this.zpp_inner.ptr;null==r.wrap&&(t=r.x,n=r.y,null==Rn.poolVec2?e=new Ct:(e=Rn.poolVec2,Rn.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==Ir.zpp_pool?i=new Ir:(i=Ir.zpp_pool,Ir.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=t,i.y=n,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.x==t&&(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.y==n)||(e.zpp_inner.x=t,e.zpp_inner.y=n,null!=(n=e.zpp_inner)._invalidate&&n._invalidate(n))),e.zpp_inner.weak=!1,r.wrap=e,r.wrap.zpp_inner._inuse=!0,r.wrap.zpp_inner._invalidate=Z(r,r.modwrap),r.wrap.zpp_inner._validate=Z(r,r.getwrap));r=r.wrap;return this.zpp_inner.ptr=this.zpp_inner.forward?this.zpp_inner.ptr.next:this.zpp_inner.ptr.prev,r},U.prototype.__class__=U,(d=nape.geom.MarchingSquares=function(){}).__name__=["nape","geom","MarchingSquares"],d.run=function(t,e,i,n,r,s,o){null==s&&(s=!0),null==n&&(n=2);var a,l=null!=o?o:new di;if(null==r){var p=e.zpp_inner;null!=p._validate&&p._validate();var h=e.zpp_inner.minx,u=e.zpp_inner;null!=u._validate&&u._validate();var c=e.zpp_inner.miny,o=e.zpp_inner.getmax(),p=o.zpp_inner;null!=p._validate&&p._validate();u=o.zpp_inner.x,p=e.zpp_inner.getmax(),o=p.zpp_inner;null!=o._validate&&o._validate(),sn.run(t,h,c,u,p.zpp_inner.y,i,n,s,l)}else{c=e.zpp_inner;null!=c._validate&&c._validate();u=e.zpp_inner,p=u.maxx-u.minx,c=r.zpp_inner;null!=c._validate&&c._validate();u=p/r.zpp_inner.x,c=e.zpp_inner;null!=c._validate&&c._validate();p=e.zpp_inner,c=p.maxy-p.miny,p=r.zpp_inner;null!=p._validate&&p._validate();var c=c/r.zpp_inner.y,d=0|u,_=0|c;d!=u&&++d,_!=c&&++_;for(var y=0,f=d;y<f;){var m=y++,x=e.zpp_inner;null!=x._validate&&x._validate();var v=e.zpp_inner.minx,x=r.zpp_inner;null!=x._validate&&x._validate();for(var g,b=v+r.zpp_inner.x*m,z=m==d-1?(null!=(m=(g=e.zpp_inner.getmax()).zpp_inner)._validate&&m._validate(),g.zpp_inner.x):(null!=(g=r.zpp_inner)._validate&&g._validate(),b+r.zpp_inner.x),w=0,C=_;w<C;){var P=w++,T=e.zpp_inner;null!=T._validate&&T._validate();var S=e.zpp_inner.miny,T=r.zpp_inner;null!=T._validate&&T._validate();var T=S+r.zpp_inner.y*P,M=P==_-1?(null!=(P=(S=e.zpp_inner.getmax()).zpp_inner)._validate&&P._validate(),S.zpp_inner.y):(null!=(M=r.zpp_inner)._validate&&M._validate(),T+r.zpp_inner.y);sn.run(t,b,T,z,M,i,n,s,l)}}}return i.zpp_inner.weak&&(a=i.zpp_inner,i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Rn.poolVec2,Rn.poolVec2=i,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ir.zpp_pool,Ir.zpp_pool=a),null!=r&&r.zpp_inner.weak&&(a=r.zpp_inner,r.zpp_inner.outer=null,r.zpp_inner=null,r.zpp_pool=Rn.poolVec2,Rn.poolVec2=r,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ir.zpp_pool,Ir.zpp_pool=a),l},d.prototype.__class__=d;var X=nape.geom.Mat23=function(t,e,i,n,r,s){null==s&&(s=0),null==r&&(r=0),null==n&&(n=1),null==i&&(i=0),null==e&&(e=0),null==t&&(t=1),this.zpp_inner=null,this.zpp_inner=xe.get(),(this.zpp_inner.outer=this).zpp_inner.a=t;t=this.zpp_inner;null!=t._invalidate&&t._invalidate(),this.zpp_inner.b=e;e=this.zpp_inner;null!=e._invalidate&&e._invalidate(),this.zpp_inner.tx=r;r=this.zpp_inner;null!=r._invalidate&&r._invalidate(),this.zpp_inner.c=i;i=this.zpp_inner;null!=i._invalidate&&i._invalidate(),this.zpp_inner.d=n;n=this.zpp_inner;null!=n._invalidate&&n._invalidate(),this.zpp_inner.ty=s;s=this.zpp_inner;null!=s._invalidate&&s._invalidate()};X.__name__=["nape","geom","Mat23"],X.rotation=function(t){var e=Math.cos(t),t=Math.sin(t);return new X(e,-t,t,e,0,0)},X.translation=function(t,e){return new X(1,0,0,1,t,e)},X.scale=function(t,e){return new X(t,0,0,e,0,0)},X.prototype.zpp_inner=null,X.prototype.get_a=function(){return this.zpp_inner.a},X.prototype.set_a=function(t){this.zpp_inner.a=t;t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this.zpp_inner.a},X.prototype.get_b=function(){return this.zpp_inner.b},X.prototype.set_b=function(t){this.zpp_inner.b=t;t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this.zpp_inner.b},X.prototype.get_c=function(){return this.zpp_inner.c},X.prototype.set_c=function(t){this.zpp_inner.c=t;t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this.zpp_inner.c},X.prototype.get_d=function(){return this.zpp_inner.d},X.prototype.set_d=function(t){this.zpp_inner.d=t;t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this.zpp_inner.d},X.prototype.get_tx=function(){return this.zpp_inner.tx},X.prototype.set_tx=function(t){this.zpp_inner.tx=t;t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this.zpp_inner.tx},X.prototype.get_ty=function(){return this.zpp_inner.ty},X.prototype.set_ty=function(t){this.zpp_inner.ty=t;t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this.zpp_inner.ty},X.prototype.copy=function(){return new X(this.zpp_inner.a,this.zpp_inner.b,this.zpp_inner.c,this.zpp_inner.d,this.zpp_inner.tx,this.zpp_inner.ty)},X.prototype.set=function(t){t=t.zpp_inner;this.zpp_inner.setas(t.a,t.b,t.c,t.d,t.tx,t.ty);t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this},X.prototype.setAs=function(t,e,i,n,r,s){null==s&&(s=0),null==r&&(r=0),null==n&&(n=1),null==i&&(i=0),null==e&&(e=0),null==t&&(t=1),this.zpp_inner.setas(t,e,i,n,r,s);s=this.zpp_inner;return null!=s._invalidate&&s._invalidate(),this},X.prototype.reset=function(){return this.setAs()},X.prototype.get_determinant=function(){return this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c},X.prototype.singular=function(){var t=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.c+this.zpp_inner.d*this.zpp_inner.d,e=this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c;return e<0&&(e=-e),t>kr.illConditionedThreshold*e},X.prototype.inverse=function(){var t=1/(this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c);return new X(this.zpp_inner.d*t,-this.zpp_inner.b*t,-this.zpp_inner.c*t,this.zpp_inner.a*t,(this.zpp_inner.b*this.zpp_inner.ty-this.zpp_inner.d*this.zpp_inner.tx)*t,(this.zpp_inner.c*this.zpp_inner.tx-this.zpp_inner.a*this.zpp_inner.ty)*t)},X.prototype.transpose=function(){return new X(this.zpp_inner.a,this.zpp_inner.c,this.zpp_inner.b,this.zpp_inner.d,-this.zpp_inner.a*this.zpp_inner.tx-this.zpp_inner.c*this.zpp_inner.ty,-this.zpp_inner.b*this.zpp_inner.tx-this.zpp_inner.d*this.zpp_inner.ty)},X.prototype.concat=function(t){return new X(t.zpp_inner.a*this.zpp_inner.a+t.zpp_inner.b*this.zpp_inner.c,t.zpp_inner.a*this.zpp_inner.b+t.zpp_inner.b*this.zpp_inner.d,t.zpp_inner.c*this.zpp_inner.a+t.zpp_inner.d*this.zpp_inner.c,t.zpp_inner.c*this.zpp_inner.b+t.zpp_inner.d*this.zpp_inner.d,t.zpp_inner.a*this.zpp_inner.tx+t.zpp_inner.b*this.zpp_inner.ty+t.zpp_inner.tx,t.zpp_inner.c*this.zpp_inner.tx+t.zpp_inner.d*this.zpp_inner.ty+t.zpp_inner.ty)},X.prototype.transform=function(t,e,i){var n,r,s,o,a,l,p;return null==i&&(i=!1),null==e&&(e=!1),i=e?(null!=(n=t.zpp_inner)._validate&&n._validate(),s=t.zpp_inner.x*this.zpp_inner.a,null!=(e=t.zpp_inner)._validate&&e._validate(),n=s+t.zpp_inner.y*this.zpp_inner.b,null!=(e=t.zpp_inner)._validate&&e._validate(),s=t.zpp_inner.x*this.zpp_inner.c,null!=(e=t.zpp_inner)._validate&&e._validate(),s=s+t.zpp_inner.y*this.zpp_inner.d,null==Rn.poolVec2?o=new Ct:(o=Rn.poolVec2,Rn.poolVec2=o.zpp_pool,o.zpp_pool=null),null==o.zpp_inner?(null==Ir.zpp_pool?r=new Ir:(r=Ir.zpp_pool,Ir.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=n,r.y=s,o.zpp_inner=r,o.zpp_inner.outer=o):(null!=(r=o.zpp_inner)._validate&&r._validate(),o.zpp_inner.x==n&&(null!=(r=o.zpp_inner)._validate&&r._validate(),o.zpp_inner.y==s)||(o.zpp_inner.x=n,o.zpp_inner.y=s,null!=(l=o.zpp_inner)._invalidate&&l._invalidate(l))),o.zpp_inner.weak=i,o):(null!=(s=t.zpp_inner)._validate&&s._validate(),l=t.zpp_inner.x*this.zpp_inner.a,null!=(o=t.zpp_inner)._validate&&o._validate(),s=l+t.zpp_inner.y*this.zpp_inner.b+this.zpp_inner.tx,null!=(o=t.zpp_inner)._validate&&o._validate(),l=t.zpp_inner.x*this.zpp_inner.c,null!=(o=t.zpp_inner)._validate&&o._validate(),l=l+t.zpp_inner.y*this.zpp_inner.d+this.zpp_inner.ty,null==Rn.poolVec2?p=new Ct:(p=Rn.poolVec2,Rn.poolVec2=p.zpp_pool,p.zpp_pool=null),null==p.zpp_inner?(null==Ir.zpp_pool?a=new Ir:(a=Ir.zpp_pool,Ir.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=s,a.y=l,p.zpp_inner=a,p.zpp_inner.outer=p):(null!=(a=p.zpp_inner)._validate&&a._validate(),p.zpp_inner.x==s&&(null!=(a=p.zpp_inner)._validate&&a._validate(),p.zpp_inner.y==l)||(p.zpp_inner.x=s,p.zpp_inner.y=l,null!=(l=p.zpp_inner)._invalidate&&l._invalidate(l))),p.zpp_inner.weak=i,p),t.zpp_inner.weak&&(p=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Ir.zpp_pool,Ir.zpp_pool=p),i},X.prototype.inverseTransform=function(t,e,i){null==i&&(i=!1),null==e&&(e=!1);var n,r,s,o,a,l,p,h=1/(this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c),i=e?(null!=(n=t.zpp_inner)._validate&&n._validate(),o=t.zpp_inner.x*this.zpp_inner.d,null!=(e=t.zpp_inner)._validate&&e._validate(),n=(o-t.zpp_inner.y*this.zpp_inner.b)*h,null!=(e=t.zpp_inner)._validate&&e._validate(),o=t.zpp_inner.y*this.zpp_inner.a,null!=(e=t.zpp_inner)._validate&&e._validate(),o=(o-t.zpp_inner.x*this.zpp_inner.c)*h,null==Rn.poolVec2?a=new Ct:(a=Rn.poolVec2,Rn.poolVec2=a.zpp_pool,a.zpp_pool=null),null==a.zpp_inner?(null==Ir.zpp_pool?r=new Ir:(r=Ir.zpp_pool,Ir.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=n,r.y=o,a.zpp_inner=r,a.zpp_inner.outer=a):(null!=(r=a.zpp_inner)._validate&&r._validate(),a.zpp_inner.x==n&&(null!=(r=a.zpp_inner)._validate&&r._validate(),a.zpp_inner.y==o)||(a.zpp_inner.x=n,a.zpp_inner.y=o,null!=(s=a.zpp_inner)._invalidate&&s._invalidate(s))),a.zpp_inner.weak=i,a):(null!=(o=t.zpp_inner)._validate&&o._validate(),s=t.zpp_inner.x-this.zpp_inner.tx,null!=(a=t.zpp_inner)._validate&&a._validate(),o=t.zpp_inner.y-this.zpp_inner.ty,a=(s*this.zpp_inner.d-o*this.zpp_inner.b)*h,h=(o*this.zpp_inner.a-s*this.zpp_inner.c)*h,null==Rn.poolVec2?p=new Ct:(p=Rn.poolVec2,Rn.poolVec2=p.zpp_pool,p.zpp_pool=null),null==p.zpp_inner?(null==Ir.zpp_pool?l=new Ir:(l=Ir.zpp_pool,Ir.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=a,l.y=h,p.zpp_inner=l,p.zpp_inner.outer=p):(null!=(l=p.zpp_inner)._validate&&l._validate(),p.zpp_inner.x==a&&(null!=(l=p.zpp_inner)._validate&&l._validate(),p.zpp_inner.y==h)||(p.zpp_inner.x=a,p.zpp_inner.y=h,null!=(h=p.zpp_inner)._invalidate&&h._invalidate(h))),p.zpp_inner.weak=i,p);return t.zpp_inner.weak&&(p=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Ir.zpp_pool,Ir.zpp_pool=p),i},X.prototype.toString=function(){return"{ a: "+this.zpp_inner.a+" b: "+this.zpp_inner.b+" c: "+this.zpp_inner.c+" d: "+this.zpp_inner.d+" tx: "+this.zpp_inner.tx+" ty: "+this.zpp_inner.ty+" }"},X.prototype.equiorthogonal=function(){if(this.singular())return!1;var t=this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d;if(t*t<kr.epsilon){t=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b-this.zpp_inner.c*this.zpp_inner.c-this.zpp_inner.d*this.zpp_inner.d;return t*t<kr.epsilon}return!1},X.prototype.orthogonal=function(){var t=this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d;if(t*t<kr.epsilon){var e=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b-1,t=this.zpp_inner.c*this.zpp_inner.c+this.zpp_inner.d*this.zpp_inner.d-1;return e*e<kr.epsilon&&t*t<kr.epsilon}return!1},X.prototype.equiorthogonalise=function(){var t,e,i,n,r;return this.equiorthogonal()||(i=(r=((i=Math.sqrt(this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.c*this.zpp_inner.c))+(t=Math.sqrt(this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.d*this.zpp_inner.d)))/2)/i,t=r/t,this.zpp_inner.a=this.zpp_inner.a*i,null!=(n=this.zpp_inner)._invalidate&&n._invalidate(),this.zpp_inner.c=this.zpp_inner.c*i,null!=(e=this.zpp_inner)._invalidate&&e._invalidate(),this.zpp_inner.b=this.zpp_inner.b*t,null!=(n=this.zpp_inner)._invalidate&&n._invalidate(),this.zpp_inner.d=this.zpp_inner.d*t,null!=(i=this.zpp_inner)._invalidate&&i._invalidate(),e=.25*Math.PI-.5*Math.acos((this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d)/(r*r)),0<this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c&&(e=-e),n=Math.sin(e),t=Math.cos(e),i=this.zpp_inner.a*t-this.zpp_inner.c*n,r=this.zpp_inner.b*t+this.zpp_inner.d*n,this.zpp_inner.c=this.zpp_inner.c*t+this.zpp_inner.a*n,null!=(e=this.zpp_inner)._invalidate&&e._invalidate(),this.zpp_inner.a=i,null!=(i=this.zpp_inner)._invalidate&&i._invalidate(),this.zpp_inner.d=this.zpp_inner.d*t-this.zpp_inner.b*n,null!=(n=this.zpp_inner)._invalidate&&n._invalidate(),this.zpp_inner.b=r,null!=(r=this.zpp_inner)._invalidate&&r._invalidate(),null!=(r=this.zpp_inner)._invalidate&&r._invalidate()),this},X.prototype.orthogonalise=function(){var t,e,i,n,r;return this.orthogonal()||(e=1/(e=Math.sqrt(this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.c*this.zpp_inner.c)),i=1/(i=Math.sqrt(this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.d*this.zpp_inner.d)),this.zpp_inner.a=this.zpp_inner.a*e,null!=(r=this.zpp_inner)._invalidate&&r._invalidate(),this.zpp_inner.c=this.zpp_inner.c*e,null!=(n=this.zpp_inner)._invalidate&&n._invalidate(),this.zpp_inner.b=this.zpp_inner.b*i,null!=(t=this.zpp_inner)._invalidate&&t._invalidate(),this.zpp_inner.d=this.zpp_inner.d*i,null!=(r=this.zpp_inner)._invalidate&&r._invalidate(),e=.25*Math.PI-.5*Math.acos(this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d),0<this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c&&(e=-e),n=Math.sin(e),t=Math.cos(e),i=this.zpp_inner.a*t-this.zpp_inner.c*n,r=this.zpp_inner.b*t+this.zpp_inner.d*n,this.zpp_inner.c=this.zpp_inner.c*t+this.zpp_inner.a*n,null!=(e=this.zpp_inner)._invalidate&&e._invalidate(),this.zpp_inner.a=i,null!=(i=this.zpp_inner)._invalidate&&i._invalidate(),this.zpp_inner.d=this.zpp_inner.d*t-this.zpp_inner.b*n,null!=(n=this.zpp_inner)._invalidate&&n._invalidate(),this.zpp_inner.b=r,null!=(r=this.zpp_inner)._invalidate&&r._invalidate(),null!=(r=this.zpp_inner)._invalidate&&r._invalidate()),this},Object.defineProperty(X.prototype,"a",{get:X.prototype.get_a,set:X.prototype.set_a}),Object.defineProperty(X.prototype,"b",{get:X.prototype.get_b,set:X.prototype.set_b}),Object.defineProperty(X.prototype,"c",{get:X.prototype.get_c,set:X.prototype.set_c}),Object.defineProperty(X.prototype,"d",{get:X.prototype.get_d,set:X.prototype.set_d}),Object.defineProperty(X.prototype,"tx",{get:X.prototype.get_tx,set:X.prototype.set_tx}),Object.defineProperty(X.prototype,"ty",{get:X.prototype.get_ty,set:X.prototype.set_ty}),Object.defineProperty(X.prototype,"determinant",{get:X.prototype.get_determinant}),X.prototype.__class__=X;var V=nape.geom.MatMN=function(t,e){this.zpp_inner=null,this.zpp_inner=new ve(t,e),this.zpp_inner.outer=this};V.__name__=["nape","geom","MatMN"],V.prototype.zpp_inner=null,V.prototype.get_rows=function(){return this.zpp_inner.m},V.prototype.get_cols=function(){return this.zpp_inner.n},V.prototype.x=function(t,e){return this.zpp_inner.x[t*this.zpp_inner.n+e]},V.prototype.setx=function(t,e,i){return this.zpp_inner.x[t*this.zpp_inner.n+e]=i},V.prototype.toString=function(){for(var t="{ ",e=!0,i=0,n=this.zpp_inner.m;i<n;){var r=i++;e||(t+="; "),e=!1;for(var s=0,o=this.zpp_inner.n;s<o;)t+=this.zpp_inner.x[r*this.zpp_inner.n+s++]+" "}return t+="}"},V.prototype.transpose=function(){for(var t=new V(this.zpp_inner.n,this.zpp_inner.m),e=0,i=this.zpp_inner.m;e<i;)for(var n=e++,r=0,s=this.zpp_inner.n;r<s;){var o=r++;t.zpp_inner.x[o*t.zpp_inner.n+n]=this.zpp_inner.x[n*this.zpp_inner.n+o]}return t},V.prototype.mul=function(t){for(var e=new V(this.zpp_inner.m,t.zpp_inner.n),i=0,n=this.zpp_inner.m;i<n;)for(var r=i++,s=0,o=t.zpp_inner.n;s<o;){for(var a=s++,l=0,p=0,h=this.zpp_inner.n;p<h;){var u=p++;l+=this.zpp_inner.x[r*this.zpp_inner.n+u]*t.zpp_inner.x[u*t.zpp_inner.n+a]}e.zpp_inner.x[r*e.zpp_inner.n+a]=l}return e},Object.defineProperty(V.prototype,"rows",{get:V.prototype.get_rows}),Object.defineProperty(V.prototype,"cols",{get:V.prototype.get_cols}),V.prototype.__class__=V;var W=nape.geom.Ray=function(t,e){this.zpp_inner=null,this.zpp_inner=new we;var i=this.zpp_inner.origin,n=t.zpp_inner;null!=n._validate&&n._validate();var r=t.zpp_inner.x,s=t.zpp_inner;null!=s._validate&&s._validate();n=t.zpp_inner.y,s=i.zpp_inner;null!=s._validate&&s._validate(),i.zpp_inner.x==r&&(null!=(s=i.zpp_inner)._validate&&s._validate(),i.zpp_inner.y==n)||(i.zpp_inner.x=r,i.zpp_inner.y=n,null!=(o=i.zpp_inner)._invalidate&&o._invalidate(o)),t.zpp_inner.weak&&(a=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ir.zpp_pool,Ir.zpp_pool=a);var i=this.zpp_inner.direction,o=e.zpp_inner;null!=o._validate&&o._validate();var t=e.zpp_inner.x,a=e.zpp_inner;null!=a._validate&&a._validate();var l,o=e.zpp_inner.y,a=i.zpp_inner;null!=a._validate&&a._validate(),i.zpp_inner.x==t&&(null!=(a=i.zpp_inner)._validate&&a._validate(),i.zpp_inner.y==o)||(i.zpp_inner.x=t,i.zpp_inner.y=o,null!=(l=i.zpp_inner)._invalidate&&l._invalidate(l)),e.zpp_inner.weak&&(l=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Rn.poolVec2,Rn.poolVec2=e,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ir.zpp_pool,Ir.zpp_pool=l),this.zpp_inner.zip_dir=!0,this.zpp_inner.maxdist=1/0};W.__name__=["nape","geom","Ray"],W.fromSegment=function(t,e){var i=new W(t,e.sub(t,!0)),n=t.zpp_inner;null!=n._validate&&n._validate();var r=t.zpp_inner.x,s=t.zpp_inner;null!=s._validate&&s._validate();var o=t.zpp_inner.y,a=e.zpp_inner;null!=a._validate&&a._validate();n=e.zpp_inner.x,s=e.zpp_inner;null!=s._validate&&s._validate();var l,a=0,s=0,a=r-n,s=o-e.zpp_inner.y;return i.zpp_inner.maxdist=Math.sqrt(a*a+s*s),t.zpp_inner.weak&&(l=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ir.zpp_pool,Ir.zpp_pool=l),e.zpp_inner.weak&&(l=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Rn.poolVec2,Rn.poolVec2=e,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ir.zpp_pool,Ir.zpp_pool=l),i},W.prototype.zpp_inner=null,W.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},W.prototype.get_origin=function(){return this.zpp_inner.origin},W.prototype.set_origin=function(t){var e=this.zpp_inner.origin,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),this.zpp_inner.origin},W.prototype.get_direction=function(){return this.zpp_inner.direction},W.prototype.set_direction=function(t){var e=this.zpp_inner.direction,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),this.zpp_inner.zip_dir=!0,this.zpp_inner.direction},W.prototype.get_maxDistance=function(){return this.zpp_inner.maxdist},W.prototype.set_maxDistance=function(t){return this.zpp_inner.maxdist=t,this.zpp_inner.maxdist},W.prototype.aabb=function(){return this.zpp_inner.rayAABB().wrapper()},W.prototype.at=function(t,e){null==e&&(e=!1),this.zpp_inner.validate_dir();var i=this.zpp_inner.origin,n=i.zpp_inner;null!=n._validate&&n._validate();var r=i.zpp_inner.x+t*this.zpp_inner.dirx,n=this.zpp_inner.origin,i=n.zpp_inner;null!=i._validate&&i._validate();var s,o,t=n.zpp_inner.y+t*this.zpp_inner.diry;return null==Rn.poolVec2?s=new Ct:(s=Rn.poolVec2,Rn.poolVec2=s.zpp_pool,s.zpp_pool=null),null==s.zpp_inner?(null==Ir.zpp_pool?o=new Ir:(o=Ir.zpp_pool,Ir.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=r,o.y=t,s.zpp_inner=o,s.zpp_inner.outer=s):(null!=(o=s.zpp_inner)._validate&&o._validate(),s.zpp_inner.x==r&&(null!=(o=s.zpp_inner)._validate&&o._validate(),s.zpp_inner.y==t)||(s.zpp_inner.x=r,s.zpp_inner.y=t,null!=(t=s.zpp_inner)._invalidate&&t._invalidate(t))),s.zpp_inner.weak=e,s},W.prototype.copy=function(){var t=new W(this.zpp_inner.origin,this.zpp_inner.direction);return t.zpp_inner.maxdist=this.zpp_inner.maxdist,t},Object.defineProperty(W.prototype,"userData",{get:W.prototype.get_userData}),Object.defineProperty(W.prototype,"origin",{get:W.prototype.get_origin,set:W.prototype.set_origin}),Object.defineProperty(W.prototype,"direction",{get:W.prototype.get_direction,set:W.prototype.set_direction}),Object.defineProperty(W.prototype,"maxDistance",{get:W.prototype.get_maxDistance,set:W.prototype.set_maxDistance}),W.prototype.__class__=W;var H=nape.geom.RayResult=function(){this.zpp_inner=null};H.__name__=["nape","geom","RayResult"],H.prototype.zpp_inner=null,H.prototype.get_normal=function(){return this.zpp_inner.normal},H.prototype.get_distance=function(){return this.zpp_inner.toiDistance},H.prototype.get_inner=function(){return this.zpp_inner.inner},H.prototype.get_shape=function(){return this.zpp_inner.shape},H.prototype.dispose=function(){this.zpp_inner.free()},H.prototype.toString=function(){return"{ shape: "+n.string(this.zpp_inner.shape)+" distance: "+this.zpp_inner.toiDistance+" ?inner: "+n.string(this.zpp_inner.inner)+" }"},Object.defineProperty(H.prototype,"normal",{get:H.prototype.get_normal}),Object.defineProperty(H.prototype,"distance",{get:H.prototype.get_distance}),Object.defineProperty(H.prototype,"inner",{get:H.prototype.get_inner}),Object.defineProperty(H.prototype,"shape",{get:H.prototype.get_shape}),H.prototype.__class__=H;var Jt=nape.geom.RayResultIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Jt.__name__=["nape","geom","RayResultIterator"],Jt.get=function(t){var e,i=null==Jt.zpp_pool?(On.internal=!0,e=new Jt,On.internal=!1,e):(i=Jt.zpp_pool,Jt.zpp_pool=i.zpp_next,i);return i.zpp_i=0,i.zpp_inner=t,i.zpp_critical=!1,i},Jt.prototype.zpp_inner=null,Jt.prototype.zpp_i=null,Jt.prototype.zpp_critical=null,Jt.prototype.zpp_next=null,Jt.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);t=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=Jt.zpp_pool,(Jt.zpp_pool=this).zpp_inner=null,!1)},Jt.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Jt.prototype.__class__=Jt;var q=nape.geom.RayResultList=function(){this.zpp_inner=null,this.zpp_inner=new On,this.zpp_inner.outer=this};q.__name__=["nape","geom","RayResultList"],q.fromArray=function(t){for(var e=new q,i=0;i<t.length;){var n=t[i];++i,e.push(n)}return e},q.prototype.zpp_inner=null,q.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},q.prototype.has=function(t){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(t)},q.prototype.at=function(t){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.user_length-1-t),t<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=t,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(t);else for(;this.zpp_inner.at_index!=t;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt},q.prototype.push=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(t):(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},q.prototype.unshift=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t)):this.zpp_inner.inner.add(t),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},q.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null;return this.zpp_inner.reverse_flag?(e=this.zpp_inner.inner.head.elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),e},q.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)):(e=this.zpp_inner.inner.head.elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),e},q.prototype.add=function(t){return this.zpp_inner.reverse_flag?this.push(t):this.unshift(t)},q.prototype.remove=function(t){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(t),this.zpp_inner.invalidate()),e},q.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},q.prototype.empty=function(){return null==this.zpp_inner.inner.head},q.prototype.iterator=function(){return this.zpp_inner.valmod(),Jt.get(this)},q.prototype.copy=function(t){null==t&&(t=!1);var e=new q;this.zpp_inner.valmod();for(var i=Jt.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=Jt.zpp_pool,(Jt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e.push(t?null:n)}return e},q.prototype.merge=function(t){t.zpp_inner.valmod();for(var e=Jt.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Jt.zpp_pool,(Jt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);this.has(i)||(this.zpp_inner.reverse_flag?this.push(i):this.unshift(i))}},q.prototype.toString=function(){var t="[",e=!0;this.zpp_inner.valmod();for(var i=Jt.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=Jt.zpp_pool,(Jt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e||(t+=","),t+=null==n?"NULL":n.toString(),e=!1}return t+"]"},q.prototype.foreach=function(t){this.zpp_inner.valmod();for(var e=Jt.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Jt.zpp_pool,(Jt.zpp_pool=e).zpp_inner=null,!1)))break;try{e.zpp_critical=!1,t(e.zpp_inner.at(e.zpp_i++))}catch(t){e.zpp_next=Jt.zpp_pool,(Jt.zpp_pool=e).zpp_inner=null;break}}return this},q.prototype.filter=function(t){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var i=this.at(e);try{t(i)?++e:this.remove(i)}catch(t){break}}return this},Object.defineProperty(q.prototype,"length",{get:q.prototype.get_length}),q.prototype.__class__=q;var Ct=nape.geom.Vec2=function(t,e){var i;null==e&&(e=0),null==t&&(t=0),this.zpp_pool=null,(this.zpp_inner=null)==Ir.zpp_pool?i=new Ir:(i=Ir.zpp_pool,Ir.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=t,i.y=e,this.zpp_inner=i,this.zpp_inner.outer=this};Ct.__name__=["nape","geom","Vec2"],Ct.weak=function(t,e){var i,n;return null==e&&(e=0),null==t&&(t=0),null==Rn.poolVec2?i=new Ct:(i=Rn.poolVec2,Rn.poolVec2=i.zpp_pool,i.zpp_pool=null),null==i.zpp_inner?(null==Ir.zpp_pool?n=new Ir:(n=Ir.zpp_pool,Ir.zpp_pool=n.next,n.next=null),n.weak=!1,n._immutable=!1,n.x=t,n.y=e,i.zpp_inner=n,i.zpp_inner.outer=i):(null!=(n=i.zpp_inner)._validate&&n._validate(),i.zpp_inner.x==t&&(null!=(n=i.zpp_inner)._validate&&n._validate(),i.zpp_inner.y==e)||(i.zpp_inner.x=t,i.zpp_inner.y=e,null!=(e=i.zpp_inner)._invalidate&&e._invalidate(e))),i.zpp_inner.weak=!0,i},Ct.get=function(t,e,i){var n,r;return null==i&&(i=!1),null==e&&(e=0),null==t&&(t=0),null==Rn.poolVec2?n=new Ct:(n=Rn.poolVec2,Rn.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ir.zpp_pool?r=new Ir:(r=Ir.zpp_pool,Ir.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=t,r.y=e,n.zpp_inner=r,n.zpp_inner.outer=n):(null!=(r=n.zpp_inner)._validate&&r._validate(),n.zpp_inner.x==t&&(null!=(r=n.zpp_inner)._validate&&r._validate(),n.zpp_inner.y==e)||(n.zpp_inner.x=t,n.zpp_inner.y=e,null!=(e=n.zpp_inner)._invalidate&&e._invalidate(e))),n.zpp_inner.weak=i,n},Ct.fromPolar=function(t,e,i){null==i&&(i=!1);var n,r,s=t*Math.cos(e),e=t*Math.sin(e);return null==Rn.poolVec2?n=new Ct:(n=Rn.poolVec2,Rn.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ir.zpp_pool?r=new Ir:(r=Ir.zpp_pool,Ir.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=s,r.y=e,n.zpp_inner=r,n.zpp_inner.outer=n):(null!=(r=n.zpp_inner)._validate&&r._validate(),n.zpp_inner.x==s&&(null!=(r=n.zpp_inner)._validate&&r._validate(),n.zpp_inner.y==e)||(n.zpp_inner.x=s,n.zpp_inner.y=e,null!=(e=n.zpp_inner)._invalidate&&e._invalidate(e))),n.zpp_inner.weak=i,n},Ct.dsq=function(t,e){var i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s=t.zpp_inner.y,o=e.zpp_inner;null!=o._validate&&o._validate();i=e.zpp_inner.x,r=e.zpp_inner;null!=r._validate&&r._validate();var a,o=0,r=0,r=(o=n-i)*o+(r=s-e.zpp_inner.y)*r;return t.zpp_inner.weak&&(a=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ir.zpp_pool,Ir.zpp_pool=a),e.zpp_inner.weak&&(a=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Rn.poolVec2,Rn.poolVec2=e,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ir.zpp_pool,Ir.zpp_pool=a),r},Ct.distance=function(t,e){var i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s=t.zpp_inner.y,o=e.zpp_inner;null!=o._validate&&o._validate();i=e.zpp_inner.x,r=e.zpp_inner;null!=r._validate&&r._validate();var a,o=0,r=0,o=n-i,r=s-e.zpp_inner.y,r=Math.sqrt(o*o+r*r);return t.zpp_inner.weak&&(a=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ir.zpp_pool,Ir.zpp_pool=a),e.zpp_inner.weak&&(a=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Rn.poolVec2,Rn.poolVec2=e,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ir.zpp_pool,Ir.zpp_pool=a),r},Ct.prototype.zpp_inner=null,Ct.prototype.zpp_pool=null,Ct.prototype.dispose=function(){var t=this.zpp_inner;this.zpp_inner.outer=null,this.zpp_inner=null;this.zpp_pool=Rn.poolVec2,Rn.poolVec2=this,null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ir.zpp_pool,Ir.zpp_pool=t},Ct.prototype.copy=function(t){null==t&&(t=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,e=this.zpp_inner;null!=e._validate&&e._validate();var n,r,e=this.zpp_inner.y;return null==Rn.poolVec2?n=new Ct:(n=Rn.poolVec2,Rn.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ir.zpp_pool?r=new Ir:(r=Ir.zpp_pool,Ir.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=i,r.y=e,n.zpp_inner=r,n.zpp_inner.outer=n):(null!=(r=n.zpp_inner)._validate&&r._validate(),n.zpp_inner.x==i&&(null!=(r=n.zpp_inner)._validate&&r._validate(),n.zpp_inner.y==e)||(n.zpp_inner.x=i,n.zpp_inner.y=e,null!=(e=n.zpp_inner)._invalidate&&e._invalidate(e))),n.zpp_inner.weak=t,n},Ct.prototype.get_x=function(){var t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.x},Ct.prototype.set_x=function(t){var e=this.zpp_inner;null!=e._validate&&e._validate(),this.zpp_inner.x!=t&&(this.zpp_inner.x=t,null!=(i=this.zpp_inner)._invalidate&&i._invalidate(i));var i=this.zpp_inner;return null!=i._validate&&i._validate(),this.zpp_inner.x},Ct.prototype.get_y=function(){var t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.y},Ct.prototype.set_y=function(t){var e=this.zpp_inner;null!=e._validate&&e._validate(),this.zpp_inner.y!=t&&(this.zpp_inner.y=t,null!=(i=this.zpp_inner)._invalidate&&i._invalidate(i));var i=this.zpp_inner;return null!=i._validate&&i._validate(),this.zpp_inner.y},Ct.prototype.get_length=function(){var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();t=e*this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();e=this.zpp_inner.y,i=this.zpp_inner;return null!=i._validate&&i._validate(),Math.sqrt(t+e*this.zpp_inner.y)},Ct.prototype.set_length=function(t){var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,n=this.zpp_inner;null!=n._validate&&n._validate();e=i*this.zpp_inner.x,n=this.zpp_inner;null!=n._validate&&n._validate();i=this.zpp_inner.y,n=this.zpp_inner;null!=n._validate&&n._validate();n=t/Math.sqrt(e+i*this.zpp_inner.y),t=this,e=t.zpp_inner;null!=e._validate&&e._validate();i=t.zpp_inner.x*n,e=t.zpp_inner;null!=e._validate&&e._validate(),t.zpp_inner.x!=i&&(t.zpp_inner.x=i,null!=(r=t.zpp_inner)._invalidate&&r._invalidate(r));var r=t.zpp_inner;null!=r._validate&&r._validate();t=this,r=t.zpp_inner;null!=r._validate&&r._validate();r=t.zpp_inner.y*n,n=t.zpp_inner;null!=n._validate&&n._validate(),t.zpp_inner.y!=r&&(t.zpp_inner.y=r,null!=(s=t.zpp_inner)._invalidate&&s._invalidate(s));r=t.zpp_inner;null!=r._validate&&r._validate();var s=this.zpp_inner;null!=s._invalidate&&s._invalidate(s);t=this.zpp_inner;null!=t._validate&&t._validate();r=this.zpp_inner.x,s=this.zpp_inner;null!=s._validate&&s._validate();t=r*this.zpp_inner.x,s=this.zpp_inner;null!=s._validate&&s._validate();r=this.zpp_inner.y,s=this.zpp_inner;return null!=s._validate&&s._validate(),Math.sqrt(t+r*this.zpp_inner.y)},Ct.prototype.lsq=function(){var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();t=e*this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();e=this.zpp_inner.y,i=this.zpp_inner;return null!=i._validate&&i._validate(),t+e*this.zpp_inner.y},Ct.prototype.set=function(t){var e=t.zpp_inner;null!=e._validate&&e._validate();var i=t.zpp_inner.x,n=t.zpp_inner;null!=n._validate&&n._validate();e=t.zpp_inner.y,n=this.zpp_inner;null!=n._validate&&n._validate(),this.zpp_inner.x==i&&(null!=(n=this.zpp_inner)._validate&&n._validate(),this.zpp_inner.y==e)||(this.zpp_inner.x=i,this.zpp_inner.y=e,null!=(r=this.zpp_inner)._invalidate&&r._invalidate(r));var r;return t.zpp_inner.weak&&(r=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Ir.zpp_pool,Ir.zpp_pool=r),this},Ct.prototype.setxy=function(t,e){var i=this.zpp_inner;return null!=i._validate&&i._validate(),this.zpp_inner.x==t&&(null!=(i=this.zpp_inner)._validate&&i._validate(),this.zpp_inner.y==e)||(this.zpp_inner.x=t,this.zpp_inner.y=e,null!=(e=this.zpp_inner)._invalidate&&e._invalidate(e)),this},Ct.prototype.get_angle=function(){var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,t=this.zpp_inner;if(null!=t._validate&&t._validate(),e==this.zpp_inner.y&&(null!=(i=this.zpp_inner)._validate&&i._validate(),0==this.zpp_inner.x))return 0;e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.y,e=this.zpp_inner;return null!=e._validate&&e._validate(),Math.atan2(i,this.zpp_inner.x)},Ct.prototype.set_angle=function(t){var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,n=this.zpp_inner;null!=n._validate&&n._validate();e=i*this.zpp_inner.x,n=this.zpp_inner;null!=n._validate&&n._validate();i=this.zpp_inner.y,n=this.zpp_inner;null!=n._validate&&n._validate();e=Math.sqrt(e+i*this.zpp_inner.y),i=e*Math.cos(t),e*=Math.sin(t),t=this.zpp_inner;null!=t._validate&&t._validate(),this.zpp_inner.x==i&&(null!=(t=this.zpp_inner)._validate&&t._validate(),this.zpp_inner.y==e)||(this.zpp_inner.x=i,this.zpp_inner.y=e,null!=(r=this.zpp_inner)._invalidate&&r._invalidate(r));e=this.zpp_inner;null!=e._validate&&e._validate();var r=this.zpp_inner.x,e=this.zpp_inner;if(null!=e._validate&&e._validate(),r==this.zpp_inner.y&&(null!=(s=this.zpp_inner)._validate&&s._validate(),0==this.zpp_inner.x))return 0;r=this.zpp_inner;null!=r._validate&&r._validate();var s=this.zpp_inner.y,r=this.zpp_inner;return null!=r._validate&&r._validate(),Math.atan2(s,this.zpp_inner.x)},Ct.prototype.rotate=function(t){var e,i;return t%(2*Math.PI)!=0&&(e=Math.sin(t),t=(i=Math.cos(t))*this.zpp_inner.x-e*this.zpp_inner.y,this.zpp_inner.y=this.zpp_inner.x*e+this.zpp_inner.y*i,this.zpp_inner.x=t,null!=(t=this.zpp_inner)._invalidate&&t._invalidate(t)),this},Ct.prototype.reflect=function(t,e){null==e&&(e=!1);var i=this.zpp_inner;null!=i._validate&&i._validate();var n=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var r,i=this.zpp_inner.y;null==Rn.poolVec2?s=new Ct:(s=Rn.poolVec2,Rn.poolVec2=s.zpp_pool,s.zpp_pool=null),null==s.zpp_inner?(null==Ir.zpp_pool?r=new Ir:(r=Ir.zpp_pool,Ir.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=n,r.y=i,s.zpp_inner=r,s.zpp_inner.outer=s):(null!=(r=s.zpp_inner)._validate&&r._validate(),s.zpp_inner.x==n&&(null!=(r=s.zpp_inner)._validate&&r._validate(),s.zpp_inner.y==i)||(s.zpp_inner.x=n,s.zpp_inner.y=i,null!=(i=s.zpp_inner)._invalidate&&i._invalidate(i))),s.zpp_inner.weak=!0;var s=s.normalise(),s=t.sub(s.muleq(2*s.dot(t)),e);return t.zpp_inner.weak&&(e=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ir.zpp_pool,Ir.zpp_pool=e),s},Ct.prototype.normalise=function(){var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var n=e*this.zpp_inner.x,t=this.zpp_inner;null!=t._validate&&t._validate();i=this.zpp_inner.y,e=this.zpp_inner;null!=e._validate&&e._validate();t=1/Math.sqrt(n+i*this.zpp_inner.y),e=this,n=e.zpp_inner;null!=n._validate&&n._validate();i=e.zpp_inner.x*t,n=e.zpp_inner;null!=n._validate&&n._validate(),e.zpp_inner.x!=i&&(e.zpp_inner.x=i,null!=(r=e.zpp_inner)._invalidate&&r._invalidate(r));var r=e.zpp_inner;null!=r._validate&&r._validate();e=this,r=e.zpp_inner;null!=r._validate&&r._validate();r=e.zpp_inner.y*t,t=e.zpp_inner;null!=t._validate&&t._validate(),e.zpp_inner.y!=r&&(e.zpp_inner.y=r,null!=(r=e.zpp_inner)._invalidate&&r._invalidate(r));e=e.zpp_inner;null!=e._validate&&e._validate();e=this.zpp_inner;return null!=e._invalidate&&e._invalidate(e),this},Ct.prototype.unit=function(t){null==t&&(t=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,n=this.zpp_inner;null!=n._validate&&n._validate();e=i*this.zpp_inner.x,n=this.zpp_inner;null!=n._validate&&n._validate();i=this.zpp_inner.y,n=this.zpp_inner;null!=n._validate&&n._validate();n=1/Math.sqrt(e+i*this.zpp_inner.y),e=this.zpp_inner;null!=e._validate&&e._validate();i=this.zpp_inner.x*n,e=this.zpp_inner;null!=e._validate&&e._validate();var r,s,n=this.zpp_inner.y*n;return null==Rn.poolVec2?r=new Ct:(r=Rn.poolVec2,Rn.poolVec2=r.zpp_pool,r.zpp_pool=null),null==r.zpp_inner?(null==Ir.zpp_pool?s=new Ir:(s=Ir.zpp_pool,Ir.zpp_pool=s.next,s.next=null),s.weak=!1,s._immutable=!1,s.x=i,s.y=n,r.zpp_inner=s,r.zpp_inner.outer=r):(null!=(s=r.zpp_inner)._validate&&s._validate(),r.zpp_inner.x==i&&(null!=(s=r.zpp_inner)._validate&&s._validate(),r.zpp_inner.y==n)||(r.zpp_inner.x=i,r.zpp_inner.y=n,null!=(n=r.zpp_inner)._invalidate&&n._invalidate(n))),r.zpp_inner.weak=t,r},Ct.prototype.add=function(t,e){null==e&&(e=!1);var i=this.zpp_inner;null!=i._validate&&i._validate();var n=this.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();i=n+t.zpp_inner.x,r=this.zpp_inner;null!=r._validate&&r._validate();n=this.zpp_inner.y,r=t.zpp_inner;null!=r._validate&&r._validate();var s,n=n+t.zpp_inner.y;null==Rn.poolVec2?o=new Ct:(o=Rn.poolVec2,Rn.poolVec2=o.zpp_pool,o.zpp_pool=null),null==o.zpp_inner?(null==Ir.zpp_pool?s=new Ir:(s=Ir.zpp_pool,Ir.zpp_pool=s.next,s.next=null),s.weak=!1,s._immutable=!1,s.x=i,s.y=n,o.zpp_inner=s,o.zpp_inner.outer=o):(null!=(s=o.zpp_inner)._validate&&s._validate(),o.zpp_inner.x==i&&(null!=(s=o.zpp_inner)._validate&&s._validate(),o.zpp_inner.y==n)||(o.zpp_inner.x=i,o.zpp_inner.y=n,null!=(n=o.zpp_inner)._invalidate&&n._invalidate(n))),o.zpp_inner.weak=e;var o,e=o;return t.zpp_inner.weak&&(o=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ir.zpp_pool,Ir.zpp_pool=o),e},Ct.prototype.addMul=function(t,e,i){null==i&&(i=!1);var n=this.zpp_inner;null!=n._validate&&n._validate();var r=this.zpp_inner.x,s=t.zpp_inner;null!=s._validate&&s._validate();n=r+t.zpp_inner.x*e,s=this.zpp_inner;null!=s._validate&&s._validate();r=this.zpp_inner.y,s=t.zpp_inner;null!=s._validate&&s._validate();var o,e=r+t.zpp_inner.y*e;null==Rn.poolVec2?a=new Ct:(a=Rn.poolVec2,Rn.poolVec2=a.zpp_pool,a.zpp_pool=null),null==a.zpp_inner?(null==Ir.zpp_pool?o=new Ir:(o=Ir.zpp_pool,Ir.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=n,o.y=e,a.zpp_inner=o,a.zpp_inner.outer=a):(null!=(o=a.zpp_inner)._validate&&o._validate(),a.zpp_inner.x==n&&(null!=(o=a.zpp_inner)._validate&&o._validate(),a.zpp_inner.y==e)||(a.zpp_inner.x=n,a.zpp_inner.y=e,null!=(e=a.zpp_inner)._invalidate&&e._invalidate(e))),a.zpp_inner.weak=i;var a,i=a;return t.zpp_inner.weak&&(a=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ir.zpp_pool,Ir.zpp_pool=a),i},Ct.prototype.sub=function(t,e){null==e&&(e=!1);var i=this.zpp_inner;null!=i._validate&&i._validate();var n=this.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();i=n-t.zpp_inner.x,r=this.zpp_inner;null!=r._validate&&r._validate();n=this.zpp_inner.y,r=t.zpp_inner;null!=r._validate&&r._validate();var s,n=n-t.zpp_inner.y;null==Rn.poolVec2?o=new Ct:(o=Rn.poolVec2,Rn.poolVec2=o.zpp_pool,o.zpp_pool=null),null==o.zpp_inner?(null==Ir.zpp_pool?s=new Ir:(s=Ir.zpp_pool,Ir.zpp_pool=s.next,s.next=null),s.weak=!1,s._immutable=!1,s.x=i,s.y=n,o.zpp_inner=s,o.zpp_inner.outer=o):(null!=(s=o.zpp_inner)._validate&&s._validate(),o.zpp_inner.x==i&&(null!=(s=o.zpp_inner)._validate&&s._validate(),o.zpp_inner.y==n)||(o.zpp_inner.x=i,o.zpp_inner.y=n,null!=(n=o.zpp_inner)._invalidate&&n._invalidate(n))),o.zpp_inner.weak=e;var o,e=o;return t.zpp_inner.weak&&(o=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ir.zpp_pool,Ir.zpp_pool=o),e},Ct.prototype.mul=function(t,e){null==e&&(e=!1);var i=this.zpp_inner;null!=i._validate&&i._validate();var n=this.zpp_inner.x*t,i=this.zpp_inner;null!=i._validate&&i._validate();var r,s,t=this.zpp_inner.y*t;return null==Rn.poolVec2?r=new Ct:(r=Rn.poolVec2,Rn.poolVec2=r.zpp_pool,r.zpp_pool=null),null==r.zpp_inner?(null==Ir.zpp_pool?s=new Ir:(s=Ir.zpp_pool,Ir.zpp_pool=s.next,s.next=null),s.weak=!1,s._immutable=!1,s.x=n,s.y=t,r.zpp_inner=s,r.zpp_inner.outer=r):(null!=(s=r.zpp_inner)._validate&&s._validate(),r.zpp_inner.x==n&&(null!=(s=r.zpp_inner)._validate&&s._validate(),r.zpp_inner.y==t)||(r.zpp_inner.x=n,r.zpp_inner.y=t,null!=(t=r.zpp_inner)._invalidate&&t._invalidate(t))),r.zpp_inner.weak=e,r},Ct.prototype.addeq=function(t){var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,n=t.zpp_inner;null!=n._validate&&n._validate();e=i+t.zpp_inner.x,n=this.zpp_inner;null!=n._validate&&n._validate();i=this.zpp_inner.y,n=t.zpp_inner;null!=n._validate&&n._validate();var r,n=i+t.zpp_inner.y,i=this.zpp_inner;return null!=i._validate&&i._validate(),this.zpp_inner.x==e&&(null!=(i=this.zpp_inner)._validate&&i._validate(),this.zpp_inner.y==n)||(this.zpp_inner.x=e,this.zpp_inner.y=n,null!=(r=this.zpp_inner)._invalidate&&r._invalidate(r)),t.zpp_inner.weak&&(r=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Ir.zpp_pool,Ir.zpp_pool=r),this},Ct.prototype.subeq=function(t){var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,n=t.zpp_inner;null!=n._validate&&n._validate();e=i-t.zpp_inner.x,n=this.zpp_inner;null!=n._validate&&n._validate();i=this.zpp_inner.y,n=t.zpp_inner;null!=n._validate&&n._validate();var r,n=i-t.zpp_inner.y,i=this.zpp_inner;return null!=i._validate&&i._validate(),this.zpp_inner.x==e&&(null!=(i=this.zpp_inner)._validate&&i._validate(),this.zpp_inner.y==n)||(this.zpp_inner.x=e,this.zpp_inner.y=n,null!=(r=this.zpp_inner)._invalidate&&r._invalidate(r)),t.zpp_inner.weak&&(r=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Ir.zpp_pool,Ir.zpp_pool=r),this},Ct.prototype.muleq=function(t){var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x*t,e=this.zpp_inner;null!=e._validate&&e._validate();e=this.zpp_inner.y*t,t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.x==i&&(null!=(t=this.zpp_inner)._validate&&t._validate(),this.zpp_inner.y==e)||(this.zpp_inner.x=i,this.zpp_inner.y=e,null!=(e=this.zpp_inner)._invalidate&&e._invalidate(e)),this},Ct.prototype.dot=function(t){var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,n=t.zpp_inner;null!=n._validate&&n._validate();e=i*t.zpp_inner.x,n=this.zpp_inner;null!=n._validate&&n._validate();i=this.zpp_inner.y,n=t.zpp_inner;null!=n._validate&&n._validate();e+=i*t.zpp_inner.y;return t.zpp_inner.weak&&(i=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ir.zpp_pool,Ir.zpp_pool=i),e},Ct.prototype.cross=function(t){var e=t.zpp_inner;null!=e._validate&&e._validate();var i=t.zpp_inner.y,n=this.zpp_inner;null!=n._validate&&n._validate();e=i*this.zpp_inner.x,n=t.zpp_inner;null!=n._validate&&n._validate();i=t.zpp_inner.x,n=this.zpp_inner;null!=n._validate&&n._validate();e-=i*this.zpp_inner.y;return t.zpp_inner.weak&&(i=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ir.zpp_pool,Ir.zpp_pool=i),e},Ct.prototype.perp=function(t){null==t&&(t=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var i=-this.zpp_inner.y,e=this.zpp_inner;null!=e._validate&&e._validate();var n,r,e=this.zpp_inner.x;return null==Rn.poolVec2?n=new Ct:(n=Rn.poolVec2,Rn.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ir.zpp_pool?r=new Ir:(r=Ir.zpp_pool,Ir.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=i,r.y=e,n.zpp_inner=r,n.zpp_inner.outer=n):(null!=(r=n.zpp_inner)._validate&&r._validate(),n.zpp_inner.x==i&&(null!=(r=n.zpp_inner)._validate&&r._validate(),n.zpp_inner.y==e)||(n.zpp_inner.x=i,n.zpp_inner.y=e,null!=(e=n.zpp_inner)._invalidate&&e._invalidate(e))),n.zpp_inner.weak=t,n},Ct.prototype.toString=function(){var t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.toString()},Object.defineProperty(Ct.prototype,"x",{get:Ct.prototype.get_x,set:Ct.prototype.set_x}),Object.defineProperty(Ct.prototype,"y",{get:Ct.prototype.get_y,set:Ct.prototype.set_y}),Object.defineProperty(Ct.prototype,"length",{get:Ct.prototype.get_length,set:Ct.prototype.set_length}),Object.defineProperty(Ct.prototype,"angle",{get:Ct.prototype.get_angle,set:Ct.prototype.set_angle}),Ct.prototype.__class__=Ct;var Qt=nape.geom.Vec2Iterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Qt.__name__=["nape","geom","Vec2Iterator"],Qt.get=function(t){var e,i=null==Qt.zpp_pool?(Mn.internal=!0,e=new Qt,Mn.internal=!1,e):(i=Qt.zpp_pool,Qt.zpp_pool=i.zpp_next,i);return i.zpp_i=0,i.zpp_inner=t,i.zpp_critical=!1,i},Qt.prototype.zpp_inner=null,Qt.prototype.zpp_i=null,Qt.prototype.zpp_critical=null,Qt.prototype.zpp_next=null,Qt.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner.zpp_gl();return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=Qt.zpp_pool,(Qt.zpp_pool=this).zpp_inner=null,!1)},Qt.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Qt.prototype.__class__=Qt;var Y=nape.geom.Vec2List=function(){this.zpp_inner=null,this.zpp_inner=new Mn,this.zpp_inner.outer=this};Y.__name__=["nape","geom","Vec2List"],Y.fromArray=function(t){for(var e=new Y,i=0;i<t.length;){var n=t[i];++i,e.push(n)}return e},Y.prototype.zpp_inner=null,Y.prototype.get_length=function(){return this.zpp_gl()},Y.prototype.zpp_gl=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},Y.prototype.zpp_vm=function(){this.zpp_inner.valmod()},Y.prototype.has=function(t){return this.zpp_vm(),this.zpp_inner.inner.has(t.zpp_inner)},Y.prototype.at=function(t){if(this.zpp_vm(),this.zpp_inner.reverse_flag&&(t=this.zpp_gl()-1-t),t<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=t,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(t);else for(;this.zpp_inner.at_index!=t;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;var e,i=this.zpp_inner.at_ite.elt;return null==i.outer&&(i.outer=new Ct,null!=(e=i.outer.zpp_inner).outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ir.zpp_pool,Ir.zpp_pool=e,i.outer.zpp_inner=i),i.outer},Y.prototype.push=function(t){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(t.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),e},Y.prototype.unshift=function(t){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)):this.zpp_inner.inner.add(t.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),e},Y.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_vm();var t,e,i,n=null;return this.zpp_inner.reverse_flag?(null==(n=this.zpp_inner.inner.head.elt).outer&&(n.outer=new Ct,null!=(t=n.outer.zpp_inner).outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ir.zpp_pool,Ir.zpp_pool=t,n.outer.zpp_inner=n),t=n.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),null==(n=(null==(i=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2))?this.zpp_inner.inner.head:i.next).elt).outer&&(n.outer=new Ct,null!=(e=n.outer.zpp_inner).outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ir.zpp_pool,Ir.zpp_pool=e,n.outer.zpp_inner=n),e=n.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)),this.zpp_inner.invalidate(),null==n.outer&&(n.outer=new Ct,null!=(i=n.outer.zpp_inner).outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ir.zpp_pool,Ir.zpp_pool=i,n.outer.zpp_inner=n),n.outer},Y.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_vm();var t,e,i,n=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),null==(n=(null==(t=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2))?this.zpp_inner.inner.head:t.next).elt).outer&&(n.outer=new Ct,null!=(e=n.outer.zpp_inner).outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ir.zpp_pool,Ir.zpp_pool=e,n.outer.zpp_inner=n),e=n.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)):(null==(n=this.zpp_inner.inner.head.elt).outer&&(n.outer=new Ct,null!=(i=n.outer.zpp_inner).outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ir.zpp_pool,Ir.zpp_pool=i,n.outer.zpp_inner=n),i=n.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),null==n.outer&&(n.outer=new Ct,null!=(i=n.outer.zpp_inner).outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ir.zpp_pool,Ir.zpp_pool=i,n.outer.zpp_inner=n),n.outer},Y.prototype.add=function(t){return this.zpp_inner.reverse_flag?this.push(t):this.unshift(t)},Y.prototype.remove=function(t){var e;this.zpp_inner.modify_test(),this.zpp_vm(),e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==t.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(t.zpp_inner),this.zpp_inner.invalidate()),e},Y.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},Y.prototype.empty=function(){return 0==this.zpp_gl()},Y.prototype.iterator=function(){return this.zpp_vm(),Qt.get(this)},Y.prototype.copy=function(t){null==t&&(t=!1);for(var e=new Y,i=this.iterator();;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner.zpp_gl();if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=Qt.zpp_pool,(Qt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;var r,s,o,a,l=i.zpp_inner.at(i.zpp_i++),l=t?(null!=(a=l.zpp_inner)._validate&&a._validate(),r=l.zpp_inner.x,null!=(n=l.zpp_inner)._validate&&n._validate(),a=l.zpp_inner.y,null==Rn.poolVec2?s=new Ct:(s=Rn.poolVec2,Rn.poolVec2=s.zpp_pool,s.zpp_pool=null),null==s.zpp_inner?(null==Ir.zpp_pool?o=new Ir:(o=Ir.zpp_pool,Ir.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=r,o.y=a,s.zpp_inner=o,s.zpp_inner.outer=s):(null!=(n=s.zpp_inner)._validate&&n._validate(),s.zpp_inner.x==r&&(null!=(n=s.zpp_inner)._validate&&n._validate(),s.zpp_inner.y==a)||(s.zpp_inner.x=r,s.zpp_inner.y=a,null!=(a=s.zpp_inner)._invalidate&&a._invalidate(a))),s.zpp_inner.weak=!1,s):l;e.push(l)}return e},Y.prototype.merge=function(t){for(var e=t.iterator();;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner.zpp_gl();if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Qt.zpp_pool,(Qt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);this.has(i)||this.add(i)}},Y.prototype.toString=function(){for(var t="[",e=!0,i=this.iterator();;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner.zpp_gl();if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=Qt.zpp_pool,(Qt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e||(t+=","),t+=null==n?"NULL":n.toString(),e=!1}return t+"]"},Y.prototype.foreach=function(t){for(var e=this.iterator();;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner.zpp_gl();if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Qt.zpp_pool,(Qt.zpp_pool=e).zpp_inner=null,!1)))break;try{e.zpp_critical=!1,t(e.zpp_inner.at(e.zpp_i++))}catch(t){e.zpp_next=Qt.zpp_pool,(Qt.zpp_pool=e).zpp_inner=null;break}}return this},Y.prototype.filter=function(t){for(var e=0;e<this.zpp_gl();){var i=this.at(e);try{t(i)?++e:this.remove(i)}catch(t){break}}return this},Object.defineProperty(Y.prototype,"length",{get:Y.prototype.get_length}),Y.prototype.__class__=Y;var K=nape.geom.Vec3=function(t,e,i){null==i&&(i=0),null==e&&(e=0),null==t&&(t=0),this.zpp_pool=null,this.zpp_inner=null,this.zpp_inner=new Fe,(this.zpp_inner.outer=this).zpp_inner.x=t;t=this.zpp_inner;null!=t._validate&&t._validate(),this.zpp_inner.y=e;e=this.zpp_inner;null!=e._validate&&e._validate(),this.zpp_inner.z=i;i=this.zpp_inner;null!=i._validate&&i._validate()};K.__name__=["nape","geom","Vec3"],K.get=function(t,e,i){var n;return null==i&&(i=0),null==e&&(e=0),null==t&&(t=0),null==Rn.poolVec3?n=new K:(n=Rn.poolVec3,Rn.poolVec3=n.zpp_pool,n.zpp_pool=null),n.setxyz(t,e,i),n.zpp_inner.immutable=!1,n.zpp_inner._validate=null,n},K.prototype.zpp_inner=null,K.prototype.zpp_pool=null,K.prototype.get_x=function(){var t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.x},K.prototype.set_x=function(t){this.zpp_inner.x=t;t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.x},K.prototype.get_y=function(){var t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.y},K.prototype.set_y=function(t){this.zpp_inner.y=t;t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.y},K.prototype.get_z=function(){var t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.z},K.prototype.set_z=function(t){this.zpp_inner.z=t;t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.z},K.prototype.dispose=function(){this.zpp_pool=Rn.poolVec3,Rn.poolVec3=this},K.prototype.get_length=function(){var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();t=e*this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();e=this.zpp_inner.y,i=this.zpp_inner;null!=i._validate&&i._validate();i=t+e*this.zpp_inner.y,t=this.zpp_inner;null!=t._validate&&t._validate();e=this.zpp_inner.z,t=this.zpp_inner;return null!=t._validate&&t._validate(),Math.sqrt(i+e*this.zpp_inner.z)},K.prototype.set_length=function(t){var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,n=this.zpp_inner;null!=n._validate&&n._validate();e=i*this.zpp_inner.x,n=this.zpp_inner;null!=n._validate&&n._validate();i=this.zpp_inner.y,n=this.zpp_inner;null!=n._validate&&n._validate();n=e+i*this.zpp_inner.y,e=this.zpp_inner;null!=e._validate&&e._validate();i=this.zpp_inner.z,e=this.zpp_inner;null!=e._validate&&e._validate();t/=Math.sqrt(n+i*this.zpp_inner.z),n=this.zpp_inner;null!=n._validate&&n._validate(),this.zpp_inner.x=this.zpp_inner.x*t;i=this.zpp_inner;null!=i._validate&&i._validate();n=this.zpp_inner;null!=n._validate&&n._validate(),this.zpp_inner.y=this.zpp_inner.y*t;i=this.zpp_inner;null!=i._validate&&i._validate();n=this.zpp_inner;null!=n._validate&&n._validate(),this.zpp_inner.z=this.zpp_inner.z*t;i=this.zpp_inner;null!=i._validate&&i._validate();n=this.zpp_inner;null!=n._validate&&n._validate();t=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();n=t*this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();t=this.zpp_inner.y,i=this.zpp_inner;null!=i._validate&&i._validate();i=n+t*this.zpp_inner.y,n=this.zpp_inner;null!=n._validate&&n._validate();t=this.zpp_inner.z,n=this.zpp_inner;return null!=n._validate&&n._validate(),Math.sqrt(i+t*this.zpp_inner.z)},K.prototype.lsq=function(){var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();t=e*this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();e=this.zpp_inner.y,i=this.zpp_inner;null!=i._validate&&i._validate();i=t+e*this.zpp_inner.y,t=this.zpp_inner;null!=t._validate&&t._validate();e=this.zpp_inner.z,t=this.zpp_inner;return null!=t._validate&&t._validate(),i+e*this.zpp_inner.z},K.prototype.set=function(t){var e=t.zpp_inner;null!=e._validate&&e._validate();var i=t.zpp_inner.x,n=t.zpp_inner;null!=n._validate&&n._validate();e=t.zpp_inner.y,n=t.zpp_inner;return null!=n._validate&&n._validate(),this.setxyz(i,e,t.zpp_inner.z)},K.prototype.setxyz=function(t,e,i){this.zpp_inner.x=t;t=this.zpp_inner;null!=t._validate&&t._validate(),this.zpp_inner.y=e;e=this.zpp_inner;null!=e._validate&&e._validate(),this.zpp_inner.z=i;i=this.zpp_inner;return null!=i._validate&&i._validate(),this},K.prototype.xy=function(t){null==t&&(t=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,e=this.zpp_inner;null!=e._validate&&e._validate();var n,r,e=this.zpp_inner.y;return null==Rn.poolVec2?n=new Ct:(n=Rn.poolVec2,Rn.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ir.zpp_pool?r=new Ir:(r=Ir.zpp_pool,Ir.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=i,r.y=e,n.zpp_inner=r,n.zpp_inner.outer=n):(null!=(r=n.zpp_inner)._validate&&r._validate(),n.zpp_inner.x==i&&(null!=(r=n.zpp_inner)._validate&&r._validate(),n.zpp_inner.y==e)||(n.zpp_inner.x=i,n.zpp_inner.y=e,null!=(e=n.zpp_inner)._invalidate&&e._invalidate(e))),n.zpp_inner.weak=t,n},K.prototype.toString=function(){var t=this.zpp_inner;null!=t._validate&&t._validate();var e="{ x: "+this.zpp_inner.x+" y: ",t=this.zpp_inner;null!=t._validate&&t._validate();t=e+this.zpp_inner.y+" z: ",e=this.zpp_inner;return null!=e._validate&&e._validate(),t+this.zpp_inner.z+" }"},Object.defineProperty(K.prototype,"x",{get:K.prototype.get_x,set:K.prototype.set_x}),Object.defineProperty(K.prototype,"y",{get:K.prototype.get_y,set:K.prototype.set_y}),Object.defineProperty(K.prototype,"z",{get:K.prototype.get_z,set:K.prototype.set_z}),Object.defineProperty(K.prototype,"length",{get:K.prototype.get_length,set:K.prototype.set_length}),K.prototype.__class__=K;var J=nape.geom.Winding=function(){};J.__name__=["nape","geom","Winding"],J.UNDEFINED=null,J.get_UNDEFINED=function(){return null==Yn.Winding_UNDEFINED&&(Yn.internal=!0,Yn.Winding_UNDEFINED=new J,Yn.internal=!1),Yn.Winding_UNDEFINED},J.CLOCKWISE=null,J.get_CLOCKWISE=function(){return null==Yn.Winding_CLOCKWISE&&(Yn.internal=!0,Yn.Winding_CLOCKWISE=new J,Yn.internal=!1),Yn.Winding_CLOCKWISE},J.ANTICLOCKWISE=null,J.get_ANTICLOCKWISE=function(){return null==Yn.Winding_ANTICLOCKWISE&&(Yn.internal=!0,Yn.Winding_ANTICLOCKWISE=new J,Yn.internal=!1),Yn.Winding_ANTICLOCKWISE},J.prototype.toString=function(){return null==Yn.Winding_UNDEFINED&&(Yn.internal=!0,Yn.Winding_UNDEFINED=new J,Yn.internal=!1),this==Yn.Winding_UNDEFINED?"UNDEFINED":(null==Yn.Winding_CLOCKWISE&&(Yn.internal=!0,Yn.Winding_CLOCKWISE=new J,Yn.internal=!1),this==Yn.Winding_CLOCKWISE?"CLOCKWISE":(null==Yn.Winding_ANTICLOCKWISE&&(Yn.internal=!0,Yn.Winding_ANTICLOCKWISE=new J,Yn.internal=!1),this==Yn.Winding_ANTICLOCKWISE?"ANTICLOCKWISE":""))},Object.defineProperty(J,"UNDEFINED",{get:J.get_UNDEFINED}),Object.defineProperty(J,"CLOCKWISE",{get:J.get_CLOCKWISE}),Object.defineProperty(J,"ANTICLOCKWISE",{get:J.get_ANTICLOCKWISE}),J.prototype.__class__=J;var Q=nape.phys.Interactor=function(){this.zpp_inner_i=null};Q.__name__=["nape","phys","Interactor"],Q.prototype.zpp_inner_i=null,Q.prototype.get_id=function(){return this.zpp_inner_i.id},Q.prototype.get_userData=function(){return null==this.zpp_inner_i.userData&&(this.zpp_inner_i.userData={}),this.zpp_inner_i.userData},Q.prototype.isShape=function(){return null!=this.zpp_inner_i.ishape},Q.prototype.isBody=function(){return null!=this.zpp_inner_i.ibody},Q.prototype.isCompound=function(){return null!=this.zpp_inner_i.icompound},Q.prototype.get_castShape=function(){return null!=this.zpp_inner_i.ishape?this.zpp_inner_i.ishape.outer:null},Q.prototype.get_castBody=function(){return null!=this.zpp_inner_i.ibody?this.zpp_inner_i.ibody.outer:null},Q.prototype.get_castCompound=function(){return null!=this.zpp_inner_i.icompound?this.zpp_inner_i.icompound.outer:null},Q.prototype.get_group=function(){return null==this.zpp_inner_i.group?null:this.zpp_inner_i.group.outer},Q.prototype.set_group=function(t){return this.zpp_inner_i.immutable_midstep("Interactor::group"),this.zpp_inner_i.setGroup(null==t?null:t.zpp_inner),null==this.zpp_inner_i.group?null:this.zpp_inner_i.group.outer},Q.prototype.get_cbTypes=function(){return null==this.zpp_inner_i.wrap_cbTypes&&this.zpp_inner_i.setupcbTypes(),this.zpp_inner_i.wrap_cbTypes},Q.prototype.toString=function(){return""},Object.defineProperty(Q.prototype,"id",{get:Q.prototype.get_id}),Object.defineProperty(Q.prototype,"userData",{get:Q.prototype.get_userData}),Object.defineProperty(Q.prototype,"castShape",{get:Q.prototype.get_castShape}),Object.defineProperty(Q.prototype,"castBody",{get:Q.prototype.get_castBody}),Object.defineProperty(Q.prototype,"castCompound",{get:Q.prototype.get_castCompound}),Object.defineProperty(Q.prototype,"group",{get:Q.prototype.get_group,set:Q.prototype.set_group}),Object.defineProperty(Q.prototype,"cbTypes",{get:Q.prototype.get_cbTypes}),Q.prototype.__class__=Q;var $=nape.phys.Body=function(t,e){var i,n;this.debugDraw=!0,this.zpp_inner=null,Q.call(this),this.zpp_inner=new je,((this.zpp_inner.outer=this).zpp_inner.outer_i=this).zpp_inner_i=this.zpp_inner,null!=e?(null!=(i=e.zpp_inner)._validate&&i._validate(),this.zpp_inner.posx=e.zpp_inner.x,null!=(i=e.zpp_inner)._validate&&i._validate(),this.zpp_inner.posy=e.zpp_inner.y):(this.zpp_inner.posx=0,this.zpp_inner.posy=0),t=null==t?(null==Yn.BodyType_DYNAMIC&&(Yn.internal=!0,Yn.BodyType_DYNAMIC=new et,Yn.internal=!1),Yn.BodyType_DYNAMIC):t,this.zpp_inner.immutable_midstep("Body::type"),je.types[this.zpp_inner.type]!=t&&(null==Yn.BodyType_DYNAMIC&&(Yn.internal=!0,Yn.BodyType_DYNAMIC=new et,Yn.internal=!1),1==(n=t==Yn.BodyType_DYNAMIC?2:(null==Yn.BodyType_KINEMATIC&&(Yn.internal=!0,Yn.BodyType_KINEMATIC=new et,Yn.internal=!1),t==Yn.BodyType_KINEMATIC?3:1))&&null!=this.zpp_inner.space&&(this.zpp_inner.velx=0,this.zpp_inner.vely=0,this.zpp_inner.angvel=0),this.zpp_inner.invalidate_type(),null!=this.zpp_inner.space?this.zpp_inner.space.transmitType(this.zpp_inner,n):this.zpp_inner.type=n),null!=e&&e.zpp_inner.weak&&(n=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Rn.poolVec2,Rn.poolVec2=e,null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Ir.zpp_pool,Ir.zpp_pool=n),this.zpp_inner_i.insert_cbtype(Mt.ANY_BODY.zpp_inner)};$.__name__=["nape","phys","Body"],$.__super__=Q,$.prototype=Object.create(Q.prototype),$.prototype.zpp_inner=null,$.prototype.debugDraw=null,$.prototype.get_type=function(){return je.types[this.zpp_inner.type]},$.prototype.set_type=function(t){return this.zpp_inner.immutable_midstep("Body::type"),je.types[this.zpp_inner.type]!=t&&(null==Yn.BodyType_DYNAMIC&&(Yn.internal=!0,Yn.BodyType_DYNAMIC=new et,Yn.internal=!1),1==(t=t==Yn.BodyType_DYNAMIC?2:(null==Yn.BodyType_KINEMATIC&&(Yn.internal=!0,Yn.BodyType_KINEMATIC=new et,Yn.internal=!1),t==Yn.BodyType_KINEMATIC?3:1))&&null!=this.zpp_inner.space&&(this.zpp_inner.velx=0,this.zpp_inner.vely=0,this.zpp_inner.angvel=0),this.zpp_inner.invalidate_type(),null!=this.zpp_inner.space?this.zpp_inner.space.transmitType(this.zpp_inner,t):this.zpp_inner.type=t),je.types[this.zpp_inner.type]},$.prototype.get_isBullet=function(){return this.zpp_inner.bulletEnabled},$.prototype.set_isBullet=function(t){return this.zpp_inner.bulletEnabled=t,this.zpp_inner.bulletEnabled},$.prototype.get_disableCCD=function(){return this.zpp_inner.disableCCD},$.prototype.set_disableCCD=function(t){return this.zpp_inner.disableCCD=t,this.zpp_inner.disableCCD},$.prototype.integrate=function(t){if(this.zpp_inner.immutable_midstep("Body::space"),0==t)return this;var e=this.zpp_inner;e.sweepTime=0,e.sweep_angvel=e.angvel;var i,n,r=t-e.sweepTime;0!=r&&(e.sweepTime=t,e.posx+=e.velx*r,e.posy+=e.vely*r,0!=e.angvel&&(i=e.sweep_angvel*r,e.rot+=i,1e-4<i*i?(e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)):(t=1-(n=i*i)*n/8,n=((r=1-.5*n)*e.axisx+i*e.axisy)*t,e.axisy=(r*e.axisy-i*e.axisx)*t,e.axisx=n)));for(var s=e.shapes.head;null!=s;){var o=s.elt;1==o.type&&(o.polygon.invalidate_gverts(),o.polygon.invalidate_gaxi()),o.invalidate_worldCOM(),s=s.next}e.zip_worldCOM=!0,e.zip_axis=!0;for(var a=e.shapes.head;null!=a;){var l=a.elt;1==l.type&&(l.polygon.invalidate_gverts(),l.polygon.invalidate_gaxi()),l.invalidate_worldCOM(),a=a.next}return e.zip_worldCOM=!0,e.sweepTime=0,this},$.prototype.isStatic=function(){return 1==this.zpp_inner.type},$.prototype.isDynamic=function(){return 2==this.zpp_inner.type},$.prototype.isKinematic=function(){return 3==this.zpp_inner.type},$.prototype.get_shapes=function(){return this.zpp_inner.wrap_shapes},$.prototype.get_compound=function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},$.prototype.set_compound=function(t){return(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=t&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_bodies.remove(this),null!=t&&((t=t.zpp_inner.wrap_bodies).zpp_inner.reverse_flag?t.push(this):t.unshift(this))),null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},$.prototype.get_space=function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},$.prototype.set_space=function(t){return this.zpp_inner.immutable_midstep("Body::space"),(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=t&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.component.woken=!1),null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.wrap_bodies.remove(this),null!=t&&((t=t.zpp_inner.wrap_bodies).zpp_inner.reverse_flag?t.push(this):t.unshift(this))),null==this.zpp_inner.space?null:this.zpp_inner.space.outer},$.prototype.get_arbiters=function(){return null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Bn.get(this.zpp_inner.arbiters,!0)),this.zpp_inner.wrap_arbiters},$.prototype.get_isSleeping=function(){return this.zpp_inner.component.sleeping},$.prototype.get_constraints=function(){return null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=zn.get(this.zpp_inner.constraints,!0)),this.zpp_inner.wrap_constraints},$.prototype.copy=function(){return this.zpp_inner.copy()},$.prototype.get_position=function(){return null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos},$.prototype.set_position=function(t){null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var e=this.zpp_inner.wrap_pos,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos},$.prototype.get_velocity=function(){return null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity(),this.zpp_inner.wrap_vel},$.prototype.set_velocity=function(t){null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity();var e=this.zpp_inner.wrap_vel,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity(),this.zpp_inner.wrap_vel},$.prototype.setVelocityFromTarget=function(t,e,i){var n=1/i;null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity();var r=this.zpp_inner.wrap_vel;null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var s=t.sub(this.zpp_inner.wrap_pos,!0).muleq(n),o=s.zpp_inner;null!=o._validate&&o._validate();var a=s.zpp_inner.x,i=s.zpp_inner;null!=i._validate&&i._validate();var l,o=s.zpp_inner.y,i=r.zpp_inner;null!=i._validate&&i._validate(),r.zpp_inner.x==a&&(null!=(i=r.zpp_inner)._validate&&i._validate(),r.zpp_inner.y==o)||(r.zpp_inner.x=a,r.zpp_inner.y=o,null!=(l=r.zpp_inner)._invalidate&&l._invalidate(l)),s.zpp_inner.weak&&(l=s.zpp_inner,s.zpp_inner.outer=null,s.zpp_inner=null,s.zpp_pool=Rn.poolVec2,Rn.poolVec2=s,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ir.zpp_pool,Ir.zpp_pool=l);n=(e-this.zpp_inner.rot)*n;return this.zpp_inner.angvel!=n&&(this.zpp_inner.angvel=n,this.zpp_inner.wake()),t.zpp_inner.weak&&(n=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Ir.zpp_pool,Ir.zpp_pool=n),this},$.prototype.get_kinematicVel=function(){return null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel(),this.zpp_inner.wrap_kinvel},$.prototype.set_kinematicVel=function(t){null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel();var e=this.zpp_inner.wrap_kinvel,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel(),this.zpp_inner.wrap_kinvel},$.prototype.get_surfaceVel=function(){return null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel(),this.zpp_inner.wrap_svel},$.prototype.set_surfaceVel=function(t){null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel();var e=this.zpp_inner.wrap_svel,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel(),this.zpp_inner.wrap_svel},$.prototype.get_force=function(){return null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce(),this.zpp_inner.wrap_force},$.prototype.set_force=function(t){null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce();var e=this.zpp_inner.wrap_force,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce(),this.zpp_inner.wrap_force},$.prototype.get_constraintVelocity=function(){return null==this.zpp_inner.wrapcvel&&this.zpp_inner.setup_cvel(),this.zpp_inner.wrapcvel},$.prototype.get_rotation=function(){return this.zpp_inner.rot},$.prototype.set_rotation=function(t){if(this.zpp_inner.immutable_midstep("Body::rotation"),this.zpp_inner.rot!=t){this.zpp_inner.rot=t;t=this.zpp_inner;t.zip_axis=!0;for(var e=t.shapes.head;null!=e;){var i=e.elt;1==i.type&&(i.polygon.invalidate_gverts(),i.polygon.invalidate_gaxi()),i.invalidate_worldCOM(),e=e.next}t.zip_worldCOM=!0,this.zpp_inner.wake()}return this.zpp_inner.rot},$.prototype.get_angularVel=function(){return this.zpp_inner.angvel},$.prototype.set_angularVel=function(t){return this.zpp_inner.angvel!=t&&(this.zpp_inner.angvel=t,this.zpp_inner.wake()),this.zpp_inner.angvel},$.prototype.get_kinAngVel=function(){return this.zpp_inner.kinangvel},$.prototype.set_kinAngVel=function(t){return this.zpp_inner.kinangvel!=t&&(this.zpp_inner.kinangvel=t,this.zpp_inner.wake()),this.zpp_inner.kinangvel},$.prototype.get_torque=function(){return this.zpp_inner.torque},$.prototype.set_torque=function(t){return this.zpp_inner.torque!=t&&(this.zpp_inner.torque=t,this.zpp_inner.wake()),this.zpp_inner.torque},$.prototype.get_bounds=function(){return this.zpp_inner.aabb.wrapper()},$.prototype.get_allowMovement=function(){return!this.zpp_inner.nomove},$.prototype.set_allowMovement=function(t){return this.zpp_inner.immutable_midstep("Body::"+(null==t?"null":""+t)),!this.zpp_inner.nomove!=t&&(this.zpp_inner.nomove=!t,this.zpp_inner.invalidate_mass()),!this.zpp_inner.nomove},$.prototype.get_allowRotation=function(){return!this.zpp_inner.norotate},$.prototype.set_allowRotation=function(t){return this.zpp_inner.immutable_midstep("Body::"+(null==t?"null":""+t)),!this.zpp_inner.norotate!=t&&(this.zpp_inner.norotate=!t,this.zpp_inner.invalidate_inertia()),!this.zpp_inner.norotate},$.prototype.get_massMode=function(){null==Yn.MassMode_DEFAULT&&(Yn.internal=!0,Yn.MassMode_DEFAULT=new lt,Yn.internal=!1);var t=Yn.MassMode_DEFAULT;return null==Yn.MassMode_FIXED&&(Yn.internal=!0,Yn.MassMode_FIXED=new lt,Yn.internal=!1),[t,Yn.MassMode_FIXED][this.zpp_inner.massMode]},$.prototype.set_massMode=function(t){this.zpp_inner.immutable_midstep("Body::massMode"),null==Yn.MassMode_DEFAULT&&(Yn.internal=!0,Yn.MassMode_DEFAULT=new lt,Yn.internal=!1),t=t==Yn.MassMode_DEFAULT?0:1,this.zpp_inner.massMode=t,this.zpp_inner.invalidate_mass(),null==Yn.MassMode_DEFAULT&&(Yn.internal=!0,Yn.MassMode_DEFAULT=new lt,Yn.internal=!1);t=Yn.MassMode_DEFAULT;return null==Yn.MassMode_FIXED&&(Yn.internal=!0,Yn.MassMode_FIXED=new lt,Yn.internal=!1),[t,Yn.MassMode_FIXED][this.zpp_inner.massMode]},$.prototype.get_constraintMass=function(){return this.zpp_inner.world||this.zpp_inner.validate_mass(),this.zpp_inner.smass},$.prototype.get_mass=function(){return this.zpp_inner.validate_mass(),this.zpp_inner.cmass},$.prototype.set_mass=function(t){return this.zpp_inner.immutable_midstep("Body::mass"),this.zpp_inner.massMode=1,this.zpp_inner.cmass=t,this.zpp_inner.invalidate_mass(),this.zpp_inner.validate_mass(),this.zpp_inner.cmass},$.prototype.get_gravMassMode=function(){null==Yn.GravMassMode_DEFAULT&&(Yn.internal=!0,Yn.GravMassMode_DEFAULT=new st,Yn.internal=!1);var t=Yn.GravMassMode_DEFAULT;null==Yn.GravMassMode_FIXED&&(Yn.internal=!0,Yn.GravMassMode_FIXED=new st,Yn.internal=!1);var e=Yn.GravMassMode_FIXED;return null==Yn.GravMassMode_SCALED&&(Yn.internal=!0,Yn.GravMassMode_SCALED=new st,Yn.internal=!1),[t,e,Yn.GravMassMode_SCALED][this.zpp_inner.massMode]},$.prototype.set_gravMassMode=function(t){this.zpp_inner.immutable_midstep("Body::gravMassMode"),null==Yn.GravMassMode_SCALED&&(Yn.internal=!0,Yn.GravMassMode_SCALED=new st,Yn.internal=!1),e=t==Yn.GravMassMode_SCALED?2:(null==Yn.GravMassMode_DEFAULT&&(Yn.internal=!0,Yn.GravMassMode_DEFAULT=new st,Yn.internal=!1),t==Yn.GravMassMode_DEFAULT?0:1),this.zpp_inner.gravMassMode=e,this.zpp_inner.invalidate_gravMass(),null==Yn.GravMassMode_DEFAULT&&(Yn.internal=!0,Yn.GravMassMode_DEFAULT=new st,Yn.internal=!1);t=Yn.GravMassMode_DEFAULT;null==Yn.GravMassMode_FIXED&&(Yn.internal=!0,Yn.GravMassMode_FIXED=new st,Yn.internal=!1);var e=Yn.GravMassMode_FIXED;return null==Yn.GravMassMode_SCALED&&(Yn.internal=!0,Yn.GravMassMode_SCALED=new st,Yn.internal=!1),[t,e,Yn.GravMassMode_SCALED][this.zpp_inner.massMode]},$.prototype.get_gravMass=function(){return this.zpp_inner.validate_gravMass(),this.zpp_inner.gravMass},$.prototype.set_gravMass=function(t){return this.zpp_inner.immutable_midstep("Body::gravMass"),this.zpp_inner.gravMassMode=1,this.zpp_inner.gravMass=t,this.zpp_inner.invalidate_gravMass(),this.zpp_inner.validate_gravMass(),this.zpp_inner.gravMass},$.prototype.get_gravMassScale=function(){return this.zpp_inner.validate_gravMassScale(),this.zpp_inner.gravMassScale},$.prototype.set_gravMassScale=function(t){return this.zpp_inner.immutable_midstep("Body::gravMassScale"),this.zpp_inner.gravMassMode=2,this.zpp_inner.gravMassScale=t,this.zpp_inner.invalidate_gravMassScale(),this.zpp_inner.validate_gravMassScale(),this.zpp_inner.gravMassScale},$.prototype.get_inertiaMode=function(){null==Yn.InertiaMode_DEFAULT&&(Yn.internal=!0,Yn.InertiaMode_DEFAULT=new ot,Yn.internal=!1);var t=Yn.InertiaMode_DEFAULT;return null==Yn.InertiaMode_FIXED&&(Yn.internal=!0,Yn.InertiaMode_FIXED=new ot,Yn.internal=!1),[t,Yn.InertiaMode_FIXED][this.zpp_inner.inertiaMode]},$.prototype.set_inertiaMode=function(t){this.zpp_inner.immutable_midstep("Body::inertiaMode"),null==Yn.InertiaMode_FIXED&&(Yn.internal=!0,Yn.InertiaMode_FIXED=new ot,Yn.internal=!1),t=t==Yn.InertiaMode_FIXED?1:0,this.zpp_inner.inertiaMode=t,this.zpp_inner.invalidate_inertia(),null==Yn.InertiaMode_DEFAULT&&(Yn.internal=!0,Yn.InertiaMode_DEFAULT=new ot,Yn.internal=!1);t=Yn.InertiaMode_DEFAULT;return null==Yn.InertiaMode_FIXED&&(Yn.internal=!0,Yn.InertiaMode_FIXED=new ot,Yn.internal=!1),[t,Yn.InertiaMode_FIXED][this.zpp_inner.inertiaMode]},$.prototype.get_constraintInertia=function(){return this.zpp_inner.world||this.zpp_inner.validate_inertia(),this.zpp_inner.sinertia},$.prototype.get_inertia=function(){return this.zpp_inner.validate_inertia(),this.zpp_inner.cinertia},$.prototype.set_inertia=function(t){return this.zpp_inner.immutable_midstep("Body::inertia"),this.zpp_inner.inertiaMode=1,this.zpp_inner.cinertia=t,this.zpp_inner.invalidate_inertia(),this.zpp_inner.validate_inertia(),this.zpp_inner.cinertia},$.prototype.connectedBodies=function(t,e){return null==t&&(t=-1),this.zpp_inner.connectedBodies(t,e)},$.prototype.interactingBodies=function(t,e,i){return null==e&&(e=-1),t=null==t?Qe.COL|Qe.SENSOR|Qe.FLUID:(null==Yn.InteractionType_COLLISION&&(Yn.internal=!0,Yn.InteractionType_COLLISION=new f,Yn.internal=!1),t==Yn.InteractionType_COLLISION?Qe.COL:(null==Yn.InteractionType_SENSOR&&(Yn.internal=!0,Yn.InteractionType_SENSOR=new f,Yn.internal=!1),t==Yn.InteractionType_SENSOR?Qe.SENSOR:Qe.FLUID)),this.zpp_inner.interactingBodies(t,e,i)},$.prototype.crushFactor=function(){var t,e=0;null==Rn.poolVec2?m=new Ct:(m=Rn.poolVec2,Rn.poolVec2=m.zpp_pool,m.zpp_pool=null),null==m.zpp_inner?(null==Ir.zpp_pool?t=new Ir:(t=Ir.zpp_pool,Ir.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=0,t.y=0,m.zpp_inner=t,m.zpp_inner.outer=m):(null!=(t=m.zpp_inner)._validate&&t._validate(),0==m.zpp_inner.x&&(null!=(p=m.zpp_inner)._validate&&p._validate(),0==m.zpp_inner.y)||(m.zpp_inner.x=0,m.zpp_inner.y=0,null!=(f=m.zpp_inner)._invalidate&&f._invalidate(f))),m.zpp_inner.weak=!1;var i=m;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Bn.get(this.zpp_inner.arbiters,!0));for(var n=this.zpp_inner.wrap_arbiters.iterator();;){n.zpp_inner.zpp_inner.valmod();var r=n.zpp_inner.zpp_gl();if(n.zpp_critical=!0,!(n.zpp_i<r||(n.zpp_next=Ht.zpp_pool,(Ht.zpp_pool=n).zpp_inner=null,!1)))break;n.zpp_critical=!1;var s=n.zpp_inner.at(n.zpp_i++).totalImpulse(this),o=s.xy();i.addeq(o);var a=o.zpp_inner;null!=a._validate&&a._validate();var l=o.zpp_inner.x,r=o.zpp_inner;null!=r._validate&&r._validate();a=l*o.zpp_inner.x,r=o.zpp_inner;null!=r._validate&&r._validate();l=o.zpp_inner.y,r=o.zpp_inner;null!=r._validate&&r._validate(),e+=Math.sqrt(a+l*o.zpp_inner.y);l=o.zpp_inner;o.zpp_inner.outer=null,o.zpp_inner=null,o.zpp_pool=Rn.poolVec2,Rn.poolVec2=o,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ir.zpp_pool,Ir.zpp_pool=l,s.dispose()}null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=zn.get(this.zpp_inner.constraints,!0));var p=this.zpp_inner.wrap_constraints;p.zpp_inner.valmod();for(var h=Wt.get(p);;){h.zpp_inner.zpp_inner.valmod();var u=h.zpp_inner;u.zpp_inner.valmod(),u.zpp_inner.zip_length&&(u.zpp_inner.zip_length=!1,u.zpp_inner.user_length=u.zpp_inner.inner.length);var c=u.zpp_inner.user_length;if(h.zpp_critical=!0,!(h.zpp_i<c||(h.zpp_next=Wt.zpp_pool,(Wt.zpp_pool=h).zpp_inner=null,!1)))break;h.zpp_critical=!1;var d=h.zpp_inner.at(h.zpp_i++).bodyImpulse(this),_=d.xy();i.addeq(_);var y=_.zpp_inner;null!=y._validate&&y._validate();u=_.zpp_inner.x,c=_.zpp_inner;null!=c._validate&&c._validate();y=u*_.zpp_inner.x,c=_.zpp_inner;null!=c._validate&&c._validate();u=_.zpp_inner.y,c=_.zpp_inner;null!=c._validate&&c._validate(),e+=Math.sqrt(y+u*_.zpp_inner.y);u=_.zpp_inner;_.zpp_inner.outer=null,_.zpp_inner=null,_.zpp_pool=Rn.poolVec2,Rn.poolVec2=_,null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=Ir.zpp_pool,Ir.zpp_pool=u,d.dispose()}var f=i.zpp_inner;null!=f._validate&&f._validate();var m=i.zpp_inner.x,p=i.zpp_inner;null!=p._validate&&p._validate();f=m*i.zpp_inner.x,p=i.zpp_inner;null!=p._validate&&p._validate();m=i.zpp_inner.y,p=i.zpp_inner;null!=p._validate&&p._validate();f=e-Math.sqrt(f+m*i.zpp_inner.y);this.zpp_inner.validate_mass();m=f/(this.zpp_inner.cmass*(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.pre_dt),f=i.zpp_inner;return i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Rn.poolVec2,Rn.poolVec2=i,null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=Ir.zpp_pool,Ir.zpp_pool=f,m},$.prototype.localPointToWorld=function(t,e){null==e&&(e=!1);var i=this.zpp_inner;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));var n=0,r=t.zpp_inner;null!=r._validate&&r._validate();i=this.zpp_inner.axisy*t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate(),a=i-this.zpp_inner.axisx*t.zpp_inner.y;r=t.zpp_inner;null!=r._validate&&r._validate();i=t.zpp_inner.x*this.zpp_inner.axisx,r=t.zpp_inner;null!=r._validate&&r._validate(),n=i+t.zpp_inner.y*this.zpp_inner.axisy,t.zpp_inner.weak&&(i=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ir.zpp_pool,Ir.zpp_pool=i);var s,o,a=a+this.zpp_inner.posx,n=n+this.zpp_inner.posy;return null==Rn.poolVec2?s=new Ct:(s=Rn.poolVec2,Rn.poolVec2=s.zpp_pool,s.zpp_pool=null),null==s.zpp_inner?(null==Ir.zpp_pool?o=new Ir:(o=Ir.zpp_pool,Ir.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=a,o.y=n,s.zpp_inner=o,s.zpp_inner.outer=s):(null!=(o=s.zpp_inner)._validate&&o._validate(),s.zpp_inner.x==a&&(null!=(o=s.zpp_inner)._validate&&o._validate(),s.zpp_inner.y==n)||(s.zpp_inner.x=a,s.zpp_inner.y=n,null!=(n=s.zpp_inner)._invalidate&&n._invalidate(n))),s.zpp_inner.weak=e,s},$.prototype.worldPointToLocal=function(t,e){null==e&&(e=!1);var i=this.zpp_inner;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));var n,r,s=0,o=0,i=t.zpp_inner;null!=i._validate&&i._validate(),o=t.zpp_inner.x-this.zpp_inner.posx;var a,l,i=t.zpp_inner;return null!=i._validate&&i._validate(),r=t.zpp_inner.y-this.zpp_inner.posy,n=o*this.zpp_inner.axisy+r*this.zpp_inner.axisx,s=r*this.zpp_inner.axisy-o*this.zpp_inner.axisx,t.zpp_inner.weak&&(o=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ir.zpp_pool,Ir.zpp_pool=o),null==Rn.poolVec2?a=new Ct:(a=Rn.poolVec2,Rn.poolVec2=a.zpp_pool,a.zpp_pool=null),null==a.zpp_inner?(null==Ir.zpp_pool?l=new Ir:(l=Ir.zpp_pool,Ir.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=n,l.y=s,a.zpp_inner=l,a.zpp_inner.outer=a):(null!=(l=a.zpp_inner)._validate&&l._validate(),a.zpp_inner.x==n&&(null!=(l=a.zpp_inner)._validate&&l._validate(),a.zpp_inner.y==s)||(a.zpp_inner.x=n,a.zpp_inner.y=s,null!=(s=a.zpp_inner)._invalidate&&s._invalidate(s))),a.zpp_inner.weak=e,a},$.prototype.localVectorToWorld=function(t,e){null==e&&(e=!1);var i=this.zpp_inner;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));var n,r=0,s=t.zpp_inner;null!=s._validate&&s._validate();i=this.zpp_inner.axisy*t.zpp_inner.x,s=t.zpp_inner;null!=s._validate&&s._validate(),n=i-this.zpp_inner.axisx*t.zpp_inner.y;s=t.zpp_inner;null!=s._validate&&s._validate();var o,a,i=t.zpp_inner.x*this.zpp_inner.axisx,s=t.zpp_inner;return null!=s._validate&&s._validate(),r=i+t.zpp_inner.y*this.zpp_inner.axisy,t.zpp_inner.weak&&(i=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ir.zpp_pool,Ir.zpp_pool=i),null==Rn.poolVec2?o=new Ct:(o=Rn.poolVec2,Rn.poolVec2=o.zpp_pool,o.zpp_pool=null),null==o.zpp_inner?(null==Ir.zpp_pool?a=new Ir:(a=Ir.zpp_pool,Ir.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=n,a.y=r,o.zpp_inner=a,o.zpp_inner.outer=o):(null!=(a=o.zpp_inner)._validate&&a._validate(),o.zpp_inner.x==n&&(null!=(a=o.zpp_inner)._validate&&a._validate(),o.zpp_inner.y==r)||(o.zpp_inner.x=n,o.zpp_inner.y=r,null!=(r=o.zpp_inner)._invalidate&&r._invalidate(r))),o.zpp_inner.weak=e,o},$.prototype.worldVectorToLocal=function(t,e){null==e&&(e=!1);var i=this.zpp_inner;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));var n,r=0,s=t.zpp_inner;null!=s._validate&&s._validate();i=t.zpp_inner.x*this.zpp_inner.axisy,s=t.zpp_inner;null!=s._validate&&s._validate(),n=i+t.zpp_inner.y*this.zpp_inner.axisx;s=t.zpp_inner;null!=s._validate&&s._validate();var o,a,i=t.zpp_inner.y*this.zpp_inner.axisy,s=t.zpp_inner;return null!=s._validate&&s._validate(),r=i-t.zpp_inner.x*this.zpp_inner.axisx,t.zpp_inner.weak&&(i=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ir.zpp_pool,Ir.zpp_pool=i),null==Rn.poolVec2?o=new Ct:(o=Rn.poolVec2,Rn.poolVec2=o.zpp_pool,o.zpp_pool=null),null==o.zpp_inner?(null==Ir.zpp_pool?a=new Ir:(a=Ir.zpp_pool,Ir.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=n,a.y=r,o.zpp_inner=a,o.zpp_inner.outer=o):(null!=(a=o.zpp_inner)._validate&&a._validate(),o.zpp_inner.x==n&&(null!=(a=o.zpp_inner)._validate&&a._validate(),o.zpp_inner.y==r)||(o.zpp_inner.x=n,o.zpp_inner.y=r,null!=(r=o.zpp_inner)._invalidate&&r._invalidate(r))),o.zpp_inner.weak=e,o},$.prototype.applyImpulse=function(t,e,i){if(null==i&&(i=!1),i&&this.zpp_inner.component.sleeping)return t.zpp_inner.weak&&(r=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Ir.zpp_pool,Ir.zpp_pool=r),null!=e&&e.zpp_inner.weak&&(s=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Rn.poolVec2,Rn.poolVec2=e,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),this;this.zpp_inner.validate_mass();var n=this.zpp_inner.imass,r=t.zpp_inner;null!=r._validate&&r._validate(),this.zpp_inner.velx+=t.zpp_inner.x*n;var s=t.zpp_inner;return null!=s._validate&&s._validate(),this.zpp_inner.vely+=t.zpp_inner.y*n,null!=e&&(s=r=0,null!=(n=e.zpp_inner)._validate&&n._validate(),r=e.zpp_inner.x-this.zpp_inner.posx,null!=(n=e.zpp_inner)._validate&&n._validate(),s=e.zpp_inner.y-this.zpp_inner.posy,this.zpp_inner.validate_inertia(),null!=(n=t.zpp_inner)._validate&&n._validate(),n=t.zpp_inner.y*r,null!=(r=t.zpp_inner)._validate&&r._validate(),this.zpp_inner.angvel+=(n-t.zpp_inner.x*s)*this.zpp_inner.iinertia,e.zpp_inner.weak&&(s=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Rn.poolVec2,Rn.poolVec2=e,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s)),i||2==this.zpp_inner.type&&this.zpp_inner.wake(),t.zpp_inner.weak&&(i=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ir.zpp_pool,Ir.zpp_pool=i),this},$.prototype.applyAngularImpulse=function(t,e){return null==e&&(e=!1),e&&this.zpp_inner.component.sleeping||(this.zpp_inner.validate_inertia(),this.zpp_inner.angvel+=t*this.zpp_inner.iinertia,e||2==this.zpp_inner.type&&this.zpp_inner.wake()),this},$.prototype.translateShapes=function(t){this.zpp_inner.immutable_midstep("Body::translateShapes()");var e=t.zpp_inner.weak;t.zpp_inner.weak=!1;for(var i=this.zpp_inner.shapes.head;null!=i;)i.elt.outer.translate(t),i=i.next;return t.zpp_inner.weak=e,t.zpp_inner.weak&&(e=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ir.zpp_pool,Ir.zpp_pool=e),this},$.prototype.rotateShapes=function(t){this.zpp_inner.immutable_midstep("Body::rotateShapes()");for(var e=this.zpp_inner.shapes.head;null!=e;)e.elt.outer.rotate(t),e=e.next;return this},$.prototype.scaleShapes=function(t,e){this.zpp_inner.immutable_midstep("Body::scaleShapes()");for(var i=this.zpp_inner.shapes.head;null!=i;)i.elt.outer.scale(t,e),i=i.next;return this},$.prototype.transformShapes=function(t){this.zpp_inner.immutable_midstep("Body::transformShapes()");for(var e=this.zpp_inner.shapes.head;null!=e;)e.elt.outer.transform(t),e=e.next;return this},$.prototype.align=function(){this.zpp_inner.immutable_midstep("Body::align()"),this.zpp_inner.validate_localCOM();var t,e=-this.zpp_inner.localCOMx,i=-this.zpp_inner.localCOMy;null==Rn.poolVec2?r=new Ct:(r=Rn.poolVec2,Rn.poolVec2=r.zpp_pool,r.zpp_pool=null),null==r.zpp_inner?(null==Ir.zpp_pool?t=new Ir:(t=Ir.zpp_pool,Ir.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,r.zpp_inner=t,r.zpp_inner.outer=r):(null!=(t=r.zpp_inner)._validate&&t._validate(),r.zpp_inner.x==e&&(null!=(t=r.zpp_inner)._validate&&t._validate(),r.zpp_inner.y==i)||(r.zpp_inner.x=e,r.zpp_inner.y=i,null!=(n=r.zpp_inner)._invalidate&&n._invalidate(n))),r.zpp_inner.weak=!1;var n=r;this.translateShapes(n);var r=this.localVectorToWorld(n);null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos.subeq(r),this.zpp_inner.pre_posx<1/0&&(null!=(s=r.zpp_inner)._validate&&s._validate(),this.zpp_inner.pre_posx-=r.zpp_inner.x,null!=(s=r.zpp_inner)._validate&&s._validate(),this.zpp_inner.pre_posy-=r.zpp_inner.y);var s=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Rn.poolVec2,Rn.poolVec2=n,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s;s=r.zpp_inner;return r.zpp_inner.outer=null,r.zpp_inner=null,r.zpp_pool=Rn.poolVec2,Rn.poolVec2=r,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s,this},$.prototype.rotate=function(t,e){var i=t.zpp_inner.weak;t.zpp_inner.weak=!1,null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var n=this.zpp_inner.wrap_pos.sub(t);n.rotate(e);var r=t.add(n,!0);null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var s=this.zpp_inner.wrap_pos,o=r.zpp_inner;null!=o._validate&&o._validate();var a=r.zpp_inner.x,l=r.zpp_inner;null!=l._validate&&l._validate();o=r.zpp_inner.y,l=s.zpp_inner;null!=l._validate&&l._validate(),s.zpp_inner.x==a&&(null!=(l=s.zpp_inner)._validate&&l._validate(),s.zpp_inner.y==o)||(s.zpp_inner.x=a,s.zpp_inner.y=o,null!=(s=s.zpp_inner)._invalidate&&s._invalidate(s)),r.zpp_inner.weak&&(p=r.zpp_inner,r.zpp_inner.outer=null,r.zpp_inner=null,r.zpp_pool=Rn.poolVec2,Rn.poolVec2=r,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Ir.zpp_pool,Ir.zpp_pool=p),null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var p=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Rn.poolVec2,Rn.poolVec2=n,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Ir.zpp_pool,Ir.zpp_pool=p;p=this,e=p.zpp_inner.rot+e;if(p.zpp_inner.immutable_midstep("Body::rotation"),p.zpp_inner.rot!=e){p.zpp_inner.rot=e;e=p.zpp_inner;e.zip_axis=!0;for(var h=e.shapes.head;null!=h;){var u=h.elt;1==u.type&&(u.polygon.invalidate_gverts(),u.polygon.invalidate_gaxi()),u.invalidate_worldCOM(),h=h.next}e.zip_worldCOM=!0,p.zpp_inner.wake()}return t.zpp_inner.weak=i,t.zpp_inner.weak&&(i=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ir.zpp_pool,Ir.zpp_pool=i),this},$.prototype.setShapeMaterials=function(t){this.zpp_inner.immutable_midstep("Body::setShapeMaterials()");for(var e=this.zpp_inner.shapes.head;null!=e;){var i=e.elt.outer;i.zpp_inner.immutable_midstep("Shape::material"),i.zpp_inner.setMaterial(t.zpp_inner),i.zpp_inner.material.wrapper(),e=e.next}return this},$.prototype.setShapeFilters=function(t){this.zpp_inner.immutable_midstep("Body::setShapeFilters()");for(var e=this.zpp_inner.shapes.head;null!=e;){var i=e.elt.outer;i.zpp_inner.immutable_midstep("Shape::filter"),i.zpp_inner.setFilter(t.zpp_inner),i.zpp_inner.filter.wrapper(),e=e.next}return this},$.prototype.setShapeFluidProperties=function(t){this.zpp_inner.immutable_midstep("Body::setShapeFluidProperties()");for(var e=this.zpp_inner.shapes.head;null!=e;){var i=e.elt.outer;i.zpp_inner.setFluid(t.zpp_inner),i.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==i.zpp_inner.fluidProperties&&i.zpp_inner.setFluid((new rt).zpp_inner),i.zpp_inner.fluidProperties.wrapper(),e=e.next}return this},$.prototype.get_localCOM=function(){var t,e,i,n;return null==this.zpp_inner.wrap_localCOM&&(t=this.zpp_inner.localCOMx,n=this.zpp_inner.localCOMy,null==Rn.poolVec2?e=new Ct:(e=Rn.poolVec2,Rn.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==Ir.zpp_pool?i=new Ir:(i=Ir.zpp_pool,Ir.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=t,i.y=n,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.x==t&&(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.y==n)||(e.zpp_inner.x=t,e.zpp_inner.y=n,null!=(n=e.zpp_inner)._invalidate&&n._invalidate(n))),e.zpp_inner.weak=!1,this.zpp_inner.wrap_localCOM=e,this.zpp_inner.wrap_localCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_localCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_localCOM.zpp_inner._validate=Z(a=this.zpp_inner,a.getlocalCOM)),this.zpp_inner.wrap_localCOM},$.prototype.get_worldCOM=function(){var t,e,i,n;return null==this.zpp_inner.wrap_worldCOM&&(t=this.zpp_inner.worldCOMx,n=this.zpp_inner.worldCOMy,null==Rn.poolVec2?e=new Ct:(e=Rn.poolVec2,Rn.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==Ir.zpp_pool?i=new Ir:(i=Ir.zpp_pool,Ir.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=t,i.y=n,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.x==t&&(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.y==n)||(e.zpp_inner.x=t,e.zpp_inner.y=n,null!=(n=e.zpp_inner)._invalidate&&n._invalidate(n))),e.zpp_inner.weak=!1,this.zpp_inner.wrap_worldCOM=e,this.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._validate=Z(a=this.zpp_inner,a.getworldCOM)),this.zpp_inner.wrap_worldCOM},$.prototype.normalImpulse=function(t,e){null==e&&(e=!1);var i=0,n=0,r=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Bn.get(this.zpp_inner.arbiters,!0));for(var s=this.zpp_inner.wrap_arbiters.iterator();;){s.zpp_inner.zpp_inner.valmod();var o=s.zpp_inner.zpp_gl();if(s.zpp_critical=!0,!(s.zpp_i<o||(s.zpp_next=Ht.zpp_pool,(Ht.zpp_pool=s).zpp_inner=null,!1)))break;s.zpp_critical=!1;var a=s.zpp_inner.at(s.zpp_i++).zpp_inner;a.type==Qe.COL&&(null!=t&&a.b2!=t.zpp_inner&&a.b1!=t.zpp_inner||(null!=(o=(a=((o=a.wrapper()).zpp_inner.type==Qe.COL?o.zpp_inner.colarb.outer_zn:null).normalImpulse(this,e)).zpp_inner)._validate&&o._validate(),i+=a.zpp_inner.x,null!=(o=a.zpp_inner)._validate&&o._validate(),n+=a.zpp_inner.y,null!=(o=a.zpp_inner)._validate&&o._validate(),r+=a.zpp_inner.z,a.dispose()))}return K.get(i,n,r)},$.prototype.tangentImpulse=function(t,e){null==e&&(e=!1);var i=0,n=0,r=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Bn.get(this.zpp_inner.arbiters,!0));for(var s=this.zpp_inner.wrap_arbiters.iterator();;){s.zpp_inner.zpp_inner.valmod();var o=s.zpp_inner.zpp_gl();if(s.zpp_critical=!0,!(s.zpp_i<o||(s.zpp_next=Ht.zpp_pool,(Ht.zpp_pool=s).zpp_inner=null,!1)))break;s.zpp_critical=!1;var a=s.zpp_inner.at(s.zpp_i++).zpp_inner;a.type==Qe.COL&&(null!=t&&a.b2!=t.zpp_inner&&a.b1!=t.zpp_inner||(null!=(o=(a=((o=a.wrapper()).zpp_inner.type==Qe.COL?o.zpp_inner.colarb.outer_zn:null).tangentImpulse(this,e)).zpp_inner)._validate&&o._validate(),i+=a.zpp_inner.x,null!=(o=a.zpp_inner)._validate&&o._validate(),n+=a.zpp_inner.y,null!=(o=a.zpp_inner)._validate&&o._validate(),r+=a.zpp_inner.z,a.dispose()))}return K.get(i,n,r)},$.prototype.totalContactsImpulse=function(t,e){null==e&&(e=!1);var i=0,n=0,r=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Bn.get(this.zpp_inner.arbiters,!0));for(var s=this.zpp_inner.wrap_arbiters.iterator();;){s.zpp_inner.zpp_inner.valmod();var o=s.zpp_inner.zpp_gl();if(s.zpp_critical=!0,!(s.zpp_i<o||(s.zpp_next=Ht.zpp_pool,(Ht.zpp_pool=s).zpp_inner=null,!1)))break;s.zpp_critical=!1;var a=s.zpp_inner.at(s.zpp_i++).zpp_inner;a.type==Qe.COL&&(null!=t&&a.b2!=t.zpp_inner&&a.b1!=t.zpp_inner||(null!=(o=(a=((o=a.wrapper()).zpp_inner.type==Qe.COL?o.zpp_inner.colarb.outer_zn:null).totalImpulse(this,e)).zpp_inner)._validate&&o._validate(),i+=a.zpp_inner.x,null!=(o=a.zpp_inner)._validate&&o._validate(),n+=a.zpp_inner.y,null!=(o=a.zpp_inner)._validate&&o._validate(),r+=a.zpp_inner.z,a.dispose()))}return K.get(i,n,r)},$.prototype.rollingImpulse=function(t,e){null==e&&(e=!1);var i=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Bn.get(this.zpp_inner.arbiters,!0));for(var n=this.zpp_inner.wrap_arbiters.iterator();;){n.zpp_inner.zpp_inner.valmod();var r=n.zpp_inner.zpp_gl();if(n.zpp_critical=!0,!(n.zpp_i<r||(n.zpp_next=Ht.zpp_pool,(Ht.zpp_pool=n).zpp_inner=null,!1)))break;n.zpp_critical=!1;r=n.zpp_inner.at(n.zpp_i++).zpp_inner;r.type==Qe.COL&&(null!=t&&r.b2!=t.zpp_inner&&r.b1!=t.zpp_inner||(i+=((r=r.wrapper()).zpp_inner.type==Qe.COL?r.zpp_inner.colarb.outer_zn:null).rollingImpulse(this,e)))}return i},$.prototype.buoyancyImpulse=function(t){var e=0,i=0,n=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Bn.get(this.zpp_inner.arbiters,!0));for(var r=this.zpp_inner.wrap_arbiters.iterator();;){r.zpp_inner.zpp_inner.valmod();var s=r.zpp_inner.zpp_gl();if(r.zpp_critical=!0,!(r.zpp_i<s||(r.zpp_next=Ht.zpp_pool,(Ht.zpp_pool=r).zpp_inner=null,!1)))break;r.zpp_critical=!1;var o=r.zpp_inner.at(r.zpp_i++).zpp_inner;o.type==Qe.FLUID&&(null!=t&&o.b2!=t.zpp_inner&&o.b1!=t.zpp_inner||(null!=(s=(o=((s=o.wrapper()).zpp_inner.type==Qe.FLUID?s.zpp_inner.fluidarb.outer_zn:null).buoyancyImpulse(this)).zpp_inner)._validate&&s._validate(),e+=o.zpp_inner.x,null!=(s=o.zpp_inner)._validate&&s._validate(),i+=o.zpp_inner.y,null!=(s=o.zpp_inner)._validate&&s._validate(),n+=o.zpp_inner.z,o.dispose()))}return K.get(e,i,n)},$.prototype.dragImpulse=function(t){var e=0,i=0,n=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Bn.get(this.zpp_inner.arbiters,!0));for(var r=this.zpp_inner.wrap_arbiters.iterator();;){r.zpp_inner.zpp_inner.valmod();var s=r.zpp_inner.zpp_gl();if(r.zpp_critical=!0,!(r.zpp_i<s||(r.zpp_next=Ht.zpp_pool,(Ht.zpp_pool=r).zpp_inner=null,!1)))break;r.zpp_critical=!1;var o=r.zpp_inner.at(r.zpp_i++).zpp_inner;o.type==Qe.FLUID&&(null!=t&&o.b2!=t.zpp_inner&&o.b1!=t.zpp_inner||(null!=(s=(o=((s=o.wrapper()).zpp_inner.type==Qe.FLUID?s.zpp_inner.fluidarb.outer_zn:null).dragImpulse(this)).zpp_inner)._validate&&s._validate(),e+=o.zpp_inner.x,null!=(s=o.zpp_inner)._validate&&s._validate(),i+=o.zpp_inner.y,null!=(s=o.zpp_inner)._validate&&s._validate(),n+=o.zpp_inner.z,o.dispose()))}return K.get(e,i,n)},$.prototype.totalFluidImpulse=function(t){var e=0,i=0,n=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Bn.get(this.zpp_inner.arbiters,!0));for(var r=this.zpp_inner.wrap_arbiters.iterator();;){r.zpp_inner.zpp_inner.valmod();var s=r.zpp_inner.zpp_gl();if(r.zpp_critical=!0,!(r.zpp_i<s||(r.zpp_next=Ht.zpp_pool,(Ht.zpp_pool=r).zpp_inner=null,!1)))break;r.zpp_critical=!1;var o=r.zpp_inner.at(r.zpp_i++).zpp_inner;o.type==Qe.FLUID&&(null!=t&&o.b2!=t.zpp_inner&&o.b1!=t.zpp_inner||(null!=(s=(o=((s=o.wrapper()).zpp_inner.type==Qe.FLUID?s.zpp_inner.fluidarb.outer_zn:null).totalImpulse(this)).zpp_inner)._validate&&s._validate(),e+=o.zpp_inner.x,null!=(s=o.zpp_inner)._validate&&s._validate(),i+=o.zpp_inner.y,null!=(s=o.zpp_inner)._validate&&s._validate(),n+=o.zpp_inner.z,o.dispose()))}return K.get(e,i,n)},$.prototype.constraintsImpulse=function(){for(var t=0,e=0,i=0,n=this.zpp_inner.constraints.head;null!=n;){var r=n.elt.outer.bodyImpulse(this),s=r.zpp_inner;null!=s._validate&&s._validate(),t+=r.zpp_inner.x;s=r.zpp_inner;null!=s._validate&&s._validate(),e+=r.zpp_inner.y;s=r.zpp_inner;null!=s._validate&&s._validate(),i+=r.zpp_inner.z,r.dispose(),n=n.next}return K.get(t,e,i)},$.prototype.totalImpulse=function(t,e){null==e&&(e=!1);var i=0,n=0,r=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Bn.get(this.zpp_inner.arbiters,!0));for(var s=this.zpp_inner.wrap_arbiters.iterator();;){s.zpp_inner.zpp_inner.valmod();var o=s.zpp_inner.zpp_gl();if(s.zpp_critical=!0,!(s.zpp_i<o||(s.zpp_next=Ht.zpp_pool,(Ht.zpp_pool=s).zpp_inner=null,!1)))break;s.zpp_critical=!1;var a=s.zpp_inner.at(s.zpp_i++).zpp_inner;a.type!=Qe.SENSOR&&(null!=t&&a.b2!=t.zpp_inner&&a.b1!=t.zpp_inner||(null!=(a=(o=a.wrapper().totalImpulse(this,e)).zpp_inner)._validate&&a._validate(),i+=o.zpp_inner.x,null!=(a=o.zpp_inner)._validate&&a._validate(),n+=o.zpp_inner.y,null!=(a=o.zpp_inner)._validate&&a._validate(),r+=o.zpp_inner.z,o.dispose()))}for(var l=this.zpp_inner.constraints.head;null!=l;){var p,h=l.elt;h.active&&(null!=(h=(p=h.outer.bodyImpulse(this)).zpp_inner)._validate&&h._validate(),i+=p.zpp_inner.x,null!=(h=p.zpp_inner)._validate&&h._validate(),n+=p.zpp_inner.y,null!=(h=p.zpp_inner)._validate&&h._validate(),r+=p.zpp_inner.z,p.dispose()),l=l.next}return K.get(i,n,r)},$.prototype.contains=function(t){for(var e=t.zpp_inner.weak,i=t.zpp_inner.weak=!1,n=this.zpp_inner.shapes.head;null!=n;){if(n.elt.outer.contains(t)){i=!0;break}n=n.next}return t.zpp_inner.weak=e,t.zpp_inner.weak&&(e=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ir.zpp_pool,Ir.zpp_pool=e),i},$.prototype.toString=function(){return(this.zpp_inner.world?"(space::world":"("+(2==this.zpp_inner.type?"dynamic":1==this.zpp_inner.type?"static":"kinematic"))+")#"+this.zpp_inner_i.id},Object.defineProperty($.prototype,"type",{get:$.prototype.get_type,set:$.prototype.set_type}),Object.defineProperty($.prototype,"isBullet",{get:$.prototype.get_isBullet,set:$.prototype.set_isBullet}),Object.defineProperty($.prototype,"disableCCD",{get:$.prototype.get_disableCCD,set:$.prototype.set_disableCCD}),Object.defineProperty($.prototype,"shapes",{get:$.prototype.get_shapes}),Object.defineProperty($.prototype,"compound",{get:$.prototype.get_compound,set:$.prototype.set_compound}),Object.defineProperty($.prototype,"space",{get:$.prototype.get_space,set:$.prototype.set_space}),Object.defineProperty($.prototype,"arbiters",{get:$.prototype.get_arbiters}),Object.defineProperty($.prototype,"isSleeping",{get:$.prototype.get_isSleeping}),Object.defineProperty($.prototype,"constraints",{get:$.prototype.get_constraints}),Object.defineProperty($.prototype,"position",{get:$.prototype.get_position,set:$.prototype.set_position}),Object.defineProperty($.prototype,"velocity",{get:$.prototype.get_velocity,set:$.prototype.set_velocity}),Object.defineProperty($.prototype,"kinematicVel",{get:$.prototype.get_kinematicVel,set:$.prototype.set_kinematicVel}),Object.defineProperty($.prototype,"surfaceVel",{get:$.prototype.get_surfaceVel,set:$.prototype.set_surfaceVel}),Object.defineProperty($.prototype,"force",{get:$.prototype.get_force,set:$.prototype.set_force}),Object.defineProperty($.prototype,"constraintVelocity",{get:$.prototype.get_constraintVelocity}),Object.defineProperty($.prototype,"rotation",{get:$.prototype.get_rotation,set:$.prototype.set_rotation}),Object.defineProperty($.prototype,"angularVel",{get:$.prototype.get_angularVel,set:$.prototype.set_angularVel}),Object.defineProperty($.prototype,"kinAngVel",{get:$.prototype.get_kinAngVel,set:$.prototype.set_kinAngVel}),Object.defineProperty($.prototype,"torque",{get:$.prototype.get_torque,set:$.prototype.set_torque}),Object.defineProperty($.prototype,"bounds",{get:$.prototype.get_bounds}),Object.defineProperty($.prototype,"allowMovement",{get:$.prototype.get_allowMovement,set:$.prototype.set_allowMovement}),Object.defineProperty($.prototype,"allowRotation",{get:$.prototype.get_allowRotation,set:$.prototype.set_allowRotation}),Object.defineProperty($.prototype,"massMode",{get:$.prototype.get_massMode,set:$.prototype.set_massMode}),Object.defineProperty($.prototype,"constraintMass",{get:$.prototype.get_constraintMass}),Object.defineProperty($.prototype,"mass",{get:$.prototype.get_mass,set:$.prototype.set_mass}),Object.defineProperty($.prototype,"gravMassMode",{get:$.prototype.get_gravMassMode,set:$.prototype.set_gravMassMode}),Object.defineProperty($.prototype,"gravMass",{get:$.prototype.get_gravMass,set:$.prototype.set_gravMass}),Object.defineProperty($.prototype,"gravMassScale",{get:$.prototype.get_gravMassScale,set:$.prototype.set_gravMassScale}),Object.defineProperty($.prototype,"inertiaMode",{get:$.prototype.get_inertiaMode,set:$.prototype.set_inertiaMode}),Object.defineProperty($.prototype,"constraintInertia",{get:$.prototype.get_constraintInertia}),Object.defineProperty($.prototype,"inertia",{get:$.prototype.get_inertia,set:$.prototype.set_inertia}),Object.defineProperty($.prototype,"localCOM",{get:$.prototype.get_localCOM}),Object.defineProperty($.prototype,"worldCOM",{get:$.prototype.get_worldCOM}),$.prototype.__class__=$;var $t=nape.phys.BodyIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};$t.__name__=["nape","phys","BodyIterator"],$t.get=function(t){var e,i=null==$t.zpp_pool?(wn.internal=!0,e=new $t,wn.internal=!1,e):(i=$t.zpp_pool,$t.zpp_pool=i.zpp_next,i);return i.zpp_i=0,i.zpp_inner=t,i.zpp_critical=!1,i},$t.prototype.zpp_inner=null,$t.prototype.zpp_i=null,$t.prototype.zpp_critical=null,$t.prototype.zpp_next=null,$t.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);t=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=$t.zpp_pool,($t.zpp_pool=this).zpp_inner=null,!1)},$t.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},$t.prototype.__class__=$t;var tt=nape.phys.BodyList=function(){this.zpp_inner=null,this.zpp_inner=new wn,this.zpp_inner.outer=this};tt.__name__=["nape","phys","BodyList"],tt.fromArray=function(t){for(var e=new tt,i=0;i<t.length;){var n=t[i];++i,e.push(n)}return e},tt.prototype.zpp_inner=null,tt.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},tt.prototype.has=function(t){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(t.zpp_inner)},tt.prototype.at=function(t){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.user_length-1-t),t<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=t,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(t);else for(;this.zpp_inner.at_index!=t;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},tt.prototype.push=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(t.zpp_inner):(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},tt.prototype.unshift=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)):this.zpp_inner.inner.add(t.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},tt.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e,i=null;return this.zpp_inner.reverse_flag?(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(i=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.outer},tt.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(i=(null==(e=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:e.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)):(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.outer},tt.prototype.add=function(t){return this.zpp_inner.reverse_flag?this.push(t):this.unshift(t)},tt.prototype.remove=function(t){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==t.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(t.zpp_inner),this.zpp_inner.invalidate()),e},tt.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},tt.prototype.empty=function(){return null==this.zpp_inner.inner.head},tt.prototype.iterator=function(){return this.zpp_inner.valmod(),$t.get(this)},tt.prototype.copy=function(t){null==t&&(t=!1);var e=new tt;this.zpp_inner.valmod();for(var i=$t.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=$t.zpp_pool,($t.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e.push(t?null:n)}return e},tt.prototype.merge=function(t){t.zpp_inner.valmod();for(var e=$t.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=$t.zpp_pool,($t.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);this.has(i)||(this.zpp_inner.reverse_flag?this.push(i):this.unshift(i))}},tt.prototype.toString=function(){var t="[",e=!0;this.zpp_inner.valmod();for(var i=$t.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=$t.zpp_pool,($t.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e||(t+=","),t+=null==n?"NULL":n.toString(),e=!1}return t+"]"},tt.prototype.foreach=function(t){this.zpp_inner.valmod();for(var e=$t.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=$t.zpp_pool,($t.zpp_pool=e).zpp_inner=null,!1)))break;try{e.zpp_critical=!1,t(e.zpp_inner.at(e.zpp_i++))}catch(t){e.zpp_next=$t.zpp_pool,($t.zpp_pool=e).zpp_inner=null;break}}return this},tt.prototype.filter=function(t){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var i=this.at(e);try{t(i)?++e:this.remove(i)}catch(t){break}}return this},Object.defineProperty(tt.prototype,"length",{get:tt.prototype.get_length}),tt.prototype.__class__=tt;var et=nape.phys.BodyType=function(){};et.__name__=["nape","phys","BodyType"],et.STATIC=null,et.get_STATIC=function(){return null==Yn.BodyType_STATIC&&(Yn.internal=!0,Yn.BodyType_STATIC=new et,Yn.internal=!1),Yn.BodyType_STATIC},et.DYNAMIC=null,et.get_DYNAMIC=function(){return null==Yn.BodyType_DYNAMIC&&(Yn.internal=!0,Yn.BodyType_DYNAMIC=new et,Yn.internal=!1),Yn.BodyType_DYNAMIC},et.KINEMATIC=null,et.get_KINEMATIC=function(){return null==Yn.BodyType_KINEMATIC&&(Yn.internal=!0,Yn.BodyType_KINEMATIC=new et,Yn.internal=!1),Yn.BodyType_KINEMATIC},et.prototype.toString=function(){return null==Yn.BodyType_STATIC&&(Yn.internal=!0,Yn.BodyType_STATIC=new et,Yn.internal=!1),this==Yn.BodyType_STATIC?"STATIC":(null==Yn.BodyType_DYNAMIC&&(Yn.internal=!0,Yn.BodyType_DYNAMIC=new et,Yn.internal=!1),this==Yn.BodyType_DYNAMIC?"DYNAMIC":(null==Yn.BodyType_KINEMATIC&&(Yn.internal=!0,Yn.BodyType_KINEMATIC=new et,Yn.internal=!1),this==Yn.BodyType_KINEMATIC?"KINEMATIC":""))},Object.defineProperty(et,"STATIC",{get:et.get_STATIC}),Object.defineProperty(et,"DYNAMIC",{get:et.get_DYNAMIC}),Object.defineProperty(et,"KINEMATIC",{get:et.get_KINEMATIC}),et.prototype.__class__=et;var it=nape.phys.Compound=function(){this.zpp_inner=null,Q.call(this),this.zpp_inner=new Ne,((this.zpp_inner.outer=this).zpp_inner.outer_i=this).zpp_inner_i=this.zpp_inner,this.zpp_inner.insert_cbtype(Mt.ANY_COMPOUND.zpp_inner)};it.__name__=["nape","phys","Compound"],it.__super__=Q,it.prototype=Object.create(Q.prototype),it.prototype.zpp_inner=null,it.prototype.get_bodies=function(){return this.zpp_inner.wrap_bodies},it.prototype.get_constraints=function(){return this.zpp_inner.wrap_constraints},it.prototype.get_compounds=function(){return this.zpp_inner.wrap_compounds},it.prototype.get_compound=function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},it.prototype.set_compound=function(t){return this.zpp_inner.immutable_midstep("Compound::compound"),(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=t&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_compounds.remove(this),null!=t&&((t=t.zpp_inner.wrap_compounds).zpp_inner.reverse_flag?t.push(this):t.unshift(this))),null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},it.prototype.get_space=function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},it.prototype.set_space=function(t){return this.zpp_inner.immutable_midstep("Compound::space"),(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=t&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.wrap_compounds.remove(this),null!=t&&((t=t.zpp_inner.wrap_compounds).zpp_inner.reverse_flag?t.push(this):t.unshift(this))),null==this.zpp_inner.space?null:this.zpp_inner.space.outer},it.prototype.toString=function(){return"Compound"+this.zpp_inner_i.id},it.prototype.copy=function(){return this.zpp_inner.copy()},it.prototype.breakApart=function(){this.zpp_inner.breakApart()},it.prototype.visitBodies=function(t){var e=this.zpp_inner.wrap_bodies;e.zpp_inner.valmod();for(var i=$t.get(e);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=$t.zpp_pool,($t.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1,t(i.zpp_inner.at(i.zpp_i++))}e=this.zpp_inner.wrap_compounds;e.zpp_inner.valmod();for(var r=te.get(e);;){r.zpp_inner.zpp_inner.valmod();var s=r.zpp_inner;s.zpp_inner.valmod(),s.zpp_inner.zip_length&&(s.zpp_inner.zip_length=!1,s.zpp_inner.user_length=s.zpp_inner.inner.length);s=s.zpp_inner.user_length;if(r.zpp_critical=!0,!(r.zpp_i<s||(r.zpp_next=te.zpp_pool,(te.zpp_pool=r).zpp_inner=null,!1)))break;r.zpp_critical=!1,r.zpp_inner.at(r.zpp_i++).visitBodies(t)}},it.prototype.visitConstraints=function(t){var e=this.zpp_inner.wrap_constraints;e.zpp_inner.valmod();for(var i=Wt.get(e);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=Wt.zpp_pool,(Wt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1,t(i.zpp_inner.at(i.zpp_i++))}e=this.zpp_inner.wrap_compounds;e.zpp_inner.valmod();for(var r=te.get(e);;){r.zpp_inner.zpp_inner.valmod();var s=r.zpp_inner;s.zpp_inner.valmod(),s.zpp_inner.zip_length&&(s.zpp_inner.zip_length=!1,s.zpp_inner.user_length=s.zpp_inner.inner.length);s=s.zpp_inner.user_length;if(r.zpp_critical=!0,!(r.zpp_i<s||(r.zpp_next=te.zpp_pool,(te.zpp_pool=r).zpp_inner=null,!1)))break;r.zpp_critical=!1,r.zpp_inner.at(r.zpp_i++).visitConstraints(t)}},it.prototype.visitCompounds=function(t){var e=this.zpp_inner.wrap_compounds;e.zpp_inner.valmod();for(var i=te.get(e);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=te.zpp_pool,(te.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);t(n),n.visitCompounds(t)}},it.prototype.COM=function(t){var e,i,n;null==t&&(t=!1),null==Rn.poolVec2?e=new Ct:(e=Rn.poolVec2,Rn.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==Ir.zpp_pool?i=new Ir:(i=Ir.zpp_pool,Ir.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=0,i.y=0,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(i=e.zpp_inner)._validate&&i._validate(),0==e.zpp_inner.x&&(null!=(n=e.zpp_inner)._validate&&n._validate(),0==e.zpp_inner.y)||(e.zpp_inner.x=0,e.zpp_inner.y=0,null!=(n=e.zpp_inner)._invalidate&&n._invalidate(n))),e.zpp_inner.weak=t;var s=e,o=0;return this.visitBodies(function(t){var e,i,n,r;null!=t.zpp_inner.wrap_shapes.zpp_inner.inner.head&&(null==t.zpp_inner.wrap_worldCOM&&(e=t.zpp_inner.worldCOMx,n=t.zpp_inner.worldCOMy,null==Rn.poolVec2?r=new Ct:(r=Rn.poolVec2,Rn.poolVec2=r.zpp_pool,r.zpp_pool=null),null==r.zpp_inner?(null==Ir.zpp_pool?i=new Ir:(i=Ir.zpp_pool,Ir.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=e,i.y=n,r.zpp_inner=i,r.zpp_inner.outer=r):(null!=(i=r.zpp_inner)._validate&&i._validate(),r.zpp_inner.x==e&&(null!=(i=r.zpp_inner)._validate&&i._validate(),r.zpp_inner.y==n)||(r.zpp_inner.x=e,r.zpp_inner.y=n,null!=(n=r.zpp_inner)._invalidate&&n._invalidate(n))),r.zpp_inner.weak=!1,t.zpp_inner.wrap_worldCOM=r,t.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,t.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,t.zpp_inner.wrap_worldCOM.zpp_inner._validate=Z(a=t.zpp_inner,a.getworldCOM)),r=t.zpp_inner.wrap_worldCOM,t.zpp_inner.validate_mass(),s.addeq(r.mul(t.zpp_inner.cmass,!0)),t.zpp_inner.validate_mass(),o+=t.zpp_inner.cmass)}),s.muleq(1/o),s},it.prototype.translate=function(e){var t,i=e.zpp_inner.weak;return e.zpp_inner.weak=!1,this.visitBodies(function(t){null==t.zpp_inner.wrap_pos&&t.zpp_inner.setupPosition(),t.zpp_inner.wrap_pos.addeq(e)}),e.zpp_inner.weak=i,e.zpp_inner.weak&&(t=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,(i=e).zpp_pool=Rn.poolVec2,Rn.poolVec2=i,null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ir.zpp_pool,Ir.zpp_pool=t),this},it.prototype.rotate=function(e,i){var t,n=e.zpp_inner.weak;return e.zpp_inner.weak=!1,this.visitBodies(function(t){t.rotate(e,i)}),e.zpp_inner.weak=n,e.zpp_inner.weak&&(t=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,(n=e).zpp_pool=Rn.poolVec2,Rn.poolVec2=n,null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ir.zpp_pool,Ir.zpp_pool=t),this},Object.defineProperty(it.prototype,"bodies",{get:it.prototype.get_bodies}),Object.defineProperty(it.prototype,"constraints",{get:it.prototype.get_constraints}),Object.defineProperty(it.prototype,"compounds",{get:it.prototype.get_compounds}),Object.defineProperty(it.prototype,"compound",{get:it.prototype.get_compound,set:it.prototype.set_compound}),Object.defineProperty(it.prototype,"space",{get:it.prototype.get_space,set:it.prototype.set_space}),it.prototype.__class__=it;var te=nape.phys.CompoundIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};te.__name__=["nape","phys","CompoundIterator"],te.get=function(t){var e,i=null==te.zpp_pool?(Pn.internal=!0,e=new te,Pn.internal=!1,e):(i=te.zpp_pool,te.zpp_pool=i.zpp_next,i);return i.zpp_i=0,i.zpp_inner=t,i.zpp_critical=!1,i},te.prototype.zpp_inner=null,te.prototype.zpp_i=null,te.prototype.zpp_critical=null,te.prototype.zpp_next=null,te.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);t=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=te.zpp_pool,(te.zpp_pool=this).zpp_inner=null,!1)},te.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},te.prototype.__class__=te;var nt=nape.phys.CompoundList=function(){this.zpp_inner=null,this.zpp_inner=new Pn,this.zpp_inner.outer=this};nt.__name__=["nape","phys","CompoundList"],nt.fromArray=function(t){for(var e=new nt,i=0;i<t.length;){var n=t[i];++i,e.push(n)}return e},nt.prototype.zpp_inner=null,nt.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},nt.prototype.has=function(t){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(t.zpp_inner)},nt.prototype.at=function(t){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.user_length-1-t),t<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=t,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(t);else for(;this.zpp_inner.at_index!=t;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},nt.prototype.push=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(t.zpp_inner):(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},nt.prototype.unshift=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)):this.zpp_inner.inner.add(t.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},nt.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e,i=null;return this.zpp_inner.reverse_flag?(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(i=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.outer},nt.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(i=(null==(e=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:e.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)):(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.outer},nt.prototype.add=function(t){return this.zpp_inner.reverse_flag?this.push(t):this.unshift(t)},nt.prototype.remove=function(t){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==t.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(t.zpp_inner),this.zpp_inner.invalidate()),e},nt.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},nt.prototype.empty=function(){return null==this.zpp_inner.inner.head},nt.prototype.iterator=function(){return this.zpp_inner.valmod(),te.get(this)},nt.prototype.copy=function(t){null==t&&(t=!1);var e=new nt;this.zpp_inner.valmod();for(var i=te.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=te.zpp_pool,(te.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e.push(t?null:n)}return e},nt.prototype.merge=function(t){t.zpp_inner.valmod();for(var e=te.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=te.zpp_pool,(te.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);this.has(i)||(this.zpp_inner.reverse_flag?this.push(i):this.unshift(i))}},nt.prototype.toString=function(){var t="[",e=!0;this.zpp_inner.valmod();for(var i=te.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=te.zpp_pool,(te.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e||(t+=","),t+=null==n?"NULL":n.toString(),e=!1}return t+"]"},nt.prototype.foreach=function(t){this.zpp_inner.valmod();for(var e=te.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=te.zpp_pool,(te.zpp_pool=e).zpp_inner=null,!1)))break;try{e.zpp_critical=!1,t(e.zpp_inner.at(e.zpp_i++))}catch(t){e.zpp_next=te.zpp_pool,(te.zpp_pool=e).zpp_inner=null;break}}return this},nt.prototype.filter=function(t){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var i=this.at(e);try{t(i)?++e:this.remove(i)}catch(t){break}}return this},Object.defineProperty(nt.prototype,"length",{get:nt.prototype.get_length}),nt.prototype.__class__=nt;var rt=nape.phys.FluidProperties=function(t,e){null==e&&(e=1),null==t&&(t=1),(this.zpp_inner=null)==Ge.zpp_pool?this.zpp_inner=new Ge:(this.zpp_inner=Ge.zpp_pool,Ge.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null),t!=1e3*(this.zpp_inner.outer=this).zpp_inner.density&&(this.zpp_inner.density=t/1e3,this.zpp_inner.invalidate()),e!=this.zpp_inner.viscosity&&(this.zpp_inner.viscosity=+e,this.zpp_inner.invalidate())};rt.__name__=["nape","phys","FluidProperties"],rt.prototype.zpp_inner=null,rt.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},rt.prototype.get_shapes=function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=In.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},rt.prototype.copy=function(){var t=new rt(1e3*this.zpp_inner.density,this.zpp_inner.viscosity);null!=this.zpp_inner.userData&&(t.zpp_inner.userData=l.copy(this.zpp_inner.userData));var e,i,n,r,s,o=this.zpp_inner.wrap_gravity;return null==o?null!=t.zpp_inner.wrap_gravity&&(t.zpp_inner.wrap_gravity.zpp_inner._inuse=!1,r=(i=t.zpp_inner.wrap_gravity).zpp_inner,i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Rn.poolVec2,Rn.poolVec2=i,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Ir.zpp_pool,Ir.zpp_pool=r,t.zpp_inner.wrap_gravity=null):(null==t.zpp_inner.wrap_gravity&&t.zpp_inner.getgravity(),e=t.zpp_inner.wrap_gravity,null!=(n=o.zpp_inner)._validate&&n._validate(),i=o.zpp_inner.x,null!=(r=o.zpp_inner)._validate&&r._validate(),n=o.zpp_inner.y,null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.x==i&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==n)||(e.zpp_inner.x=i,e.zpp_inner.y=n,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),o.zpp_inner.weak&&(s=o.zpp_inner,o.zpp_inner.outer=null,o.zpp_inner=null,o.zpp_pool=Rn.poolVec2,Rn.poolVec2=o,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s)),t},rt.prototype.get_density=function(){return 1e3*this.zpp_inner.density},rt.prototype.set_density=function(t){return t!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=t/1e3,this.zpp_inner.invalidate()),1e3*this.zpp_inner.density},rt.prototype.get_viscosity=function(){return this.zpp_inner.viscosity},rt.prototype.set_viscosity=function(t){return t!=this.zpp_inner.viscosity&&(this.zpp_inner.viscosity=+t,this.zpp_inner.invalidate()),this.zpp_inner.viscosity},rt.prototype.get_gravity=function(){return this.zpp_inner.wrap_gravity},rt.prototype.set_gravity=function(t){var e,i,n,r,s;return null==t?null!=this.zpp_inner.wrap_gravity&&(this.zpp_inner.wrap_gravity.zpp_inner._inuse=!1,r=(i=this.zpp_inner.wrap_gravity).zpp_inner,i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Rn.poolVec2,Rn.poolVec2=i,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Ir.zpp_pool,Ir.zpp_pool=r,this.zpp_inner.wrap_gravity=null):(null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity(),e=this.zpp_inner.wrap_gravity,null!=(n=t.zpp_inner)._validate&&n._validate(),i=t.zpp_inner.x,null!=(r=t.zpp_inner)._validate&&r._validate(),n=t.zpp_inner.y,null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.x==i&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==n)||(e.zpp_inner.x=i,e.zpp_inner.y=n,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s)),this.zpp_inner.wrap_gravity},rt.prototype.toString=function(){return"{ density: "+1e3*this.zpp_inner.density+" viscosity: "+this.zpp_inner.viscosity+" gravity: "+n.string(this.zpp_inner.wrap_gravity)+" }"},Object.defineProperty(rt.prototype,"userData",{get:rt.prototype.get_userData}),Object.defineProperty(rt.prototype,"shapes",{get:rt.prototype.get_shapes}),Object.defineProperty(rt.prototype,"density",{get:rt.prototype.get_density,set:rt.prototype.set_density}),Object.defineProperty(rt.prototype,"viscosity",{get:rt.prototype.get_viscosity,set:rt.prototype.set_viscosity}),Object.defineProperty(rt.prototype,"gravity",{get:rt.prototype.get_gravity,set:rt.prototype.set_gravity}),rt.prototype.__class__=rt;var st=nape.phys.GravMassMode=function(){};st.__name__=["nape","phys","GravMassMode"],st.DEFAULT=null,st.get_DEFAULT=function(){return null==Yn.GravMassMode_DEFAULT&&(Yn.internal=!0,Yn.GravMassMode_DEFAULT=new st,Yn.internal=!1),Yn.GravMassMode_DEFAULT},st.FIXED=null,st.get_FIXED=function(){return null==Yn.GravMassMode_FIXED&&(Yn.internal=!0,Yn.GravMassMode_FIXED=new st,Yn.internal=!1),Yn.GravMassMode_FIXED},st.SCALED=null,st.get_SCALED=function(){return null==Yn.GravMassMode_SCALED&&(Yn.internal=!0,Yn.GravMassMode_SCALED=new st,Yn.internal=!1),Yn.GravMassMode_SCALED},st.prototype.toString=function(){return null==Yn.GravMassMode_DEFAULT&&(Yn.internal=!0,Yn.GravMassMode_DEFAULT=new st,Yn.internal=!1),this==Yn.GravMassMode_DEFAULT?"DEFAULT":(null==Yn.GravMassMode_FIXED&&(Yn.internal=!0,Yn.GravMassMode_FIXED=new st,Yn.internal=!1),this==Yn.GravMassMode_FIXED?"FIXED":(null==Yn.GravMassMode_SCALED&&(Yn.internal=!0,Yn.GravMassMode_SCALED=new st,Yn.internal=!1),this==Yn.GravMassMode_SCALED?"SCALED":""))},Object.defineProperty(st,"DEFAULT",{get:st.get_DEFAULT}),Object.defineProperty(st,"FIXED",{get:st.get_FIXED}),Object.defineProperty(st,"SCALED",{get:st.get_SCALED}),st.prototype.__class__=st;var ot=nape.phys.InertiaMode=function(){};ot.__name__=["nape","phys","InertiaMode"],ot.DEFAULT=null,ot.get_DEFAULT=function(){return null==Yn.InertiaMode_DEFAULT&&(Yn.internal=!0,Yn.InertiaMode_DEFAULT=new ot,Yn.internal=!1),Yn.InertiaMode_DEFAULT},ot.FIXED=null,ot.get_FIXED=function(){return null==Yn.InertiaMode_FIXED&&(Yn.internal=!0,Yn.InertiaMode_FIXED=new ot,Yn.internal=!1),Yn.InertiaMode_FIXED},ot.prototype.toString=function(){return null==Yn.InertiaMode_DEFAULT&&(Yn.internal=!0,Yn.InertiaMode_DEFAULT=new ot,Yn.internal=!1),this==Yn.InertiaMode_DEFAULT?"DEFAULT":(null==Yn.InertiaMode_FIXED&&(Yn.internal=!0,Yn.InertiaMode_FIXED=new ot,Yn.internal=!1),this==Yn.InertiaMode_FIXED?"FIXED":"")},Object.defineProperty(ot,"DEFAULT",{get:ot.get_DEFAULT}),Object.defineProperty(ot,"FIXED",{get:ot.get_FIXED}),ot.prototype.__class__=ot;var ee=nape.phys.InteractorIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};ee.__name__=["nape","phys","InteractorIterator"],ee.get=function(t){var e,i=null==ee.zpp_pool?(Cn.internal=!0,e=new ee,Cn.internal=!1,e):(i=ee.zpp_pool,ee.zpp_pool=i.zpp_next,i);return i.zpp_i=0,i.zpp_inner=t,i.zpp_critical=!1,i},ee.prototype.zpp_inner=null,ee.prototype.zpp_i=null,ee.prototype.zpp_critical=null,ee.prototype.zpp_next=null,ee.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);t=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=ee.zpp_pool,(ee.zpp_pool=this).zpp_inner=null,!1)},ee.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},ee.prototype.__class__=ee;var at=nape.phys.InteractorList=function(){this.zpp_inner=null,this.zpp_inner=new Cn,this.zpp_inner.outer=this};at.__name__=["nape","phys","InteractorList"],at.fromArray=function(t){for(var e=new at,i=0;i<t.length;){var n=t[i];++i,e.push(n)}return e},at.prototype.zpp_inner=null,at.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},at.prototype.has=function(t){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(t.zpp_inner_i)},at.prototype.at=function(t){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.user_length-1-t),t<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=t,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(t);else for(;this.zpp_inner.at_index!=t;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer_i},at.prototype.push=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(t.zpp_inner_i):(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner_i)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},at.prototype.unshift=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner_i)):this.zpp_inner.inner.add(t.zpp_inner_i),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},at.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e,i=null;return this.zpp_inner.reverse_flag?(e=(i=this.zpp_inner.inner.head.elt).outer_i,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(i=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt).outer_i,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.outer_i},at.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(i=(null==(e=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:e.next).elt).outer_i,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)):(e=(i=this.zpp_inner.inner.head.elt).outer_i,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.outer_i},at.prototype.add=function(t){return this.zpp_inner.reverse_flag?this.push(t):this.unshift(t)},at.prototype.remove=function(t){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==t.zpp_inner_i){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(t.zpp_inner_i),this.zpp_inner.invalidate()),e},at.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},at.prototype.empty=function(){return null==this.zpp_inner.inner.head},at.prototype.iterator=function(){return this.zpp_inner.valmod(),ee.get(this)},at.prototype.copy=function(t){null==t&&(t=!1);var e=new at;this.zpp_inner.valmod();for(var i=ee.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=ee.zpp_pool,(ee.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e.push(t?null:n)}return e},at.prototype.merge=function(t){t.zpp_inner.valmod();for(var e=ee.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=ee.zpp_pool,(ee.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);this.has(i)||(this.zpp_inner.reverse_flag?this.push(i):this.unshift(i))}},at.prototype.toString=function(){var t="[",e=!0;this.zpp_inner.valmod();for(var i=ee.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=ee.zpp_pool,(ee.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e||(t+=","),t+=null==n?"NULL":n.toString(),e=!1}return t+"]"},at.prototype.foreach=function(t){this.zpp_inner.valmod();for(var e=ee.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=ee.zpp_pool,(ee.zpp_pool=e).zpp_inner=null,!1)))break;try{e.zpp_critical=!1,t(e.zpp_inner.at(e.zpp_i++))}catch(t){e.zpp_next=ee.zpp_pool,(ee.zpp_pool=e).zpp_inner=null;break}}return this},at.prototype.filter=function(t){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var i=this.at(e);try{t(i)?++e:this.remove(i)}catch(t){break}}return this},Object.defineProperty(at.prototype,"length",{get:at.prototype.get_length}),at.prototype.__class__=at;var lt=nape.phys.MassMode=function(){};lt.__name__=["nape","phys","MassMode"],lt.DEFAULT=null,lt.get_DEFAULT=function(){return null==Yn.MassMode_DEFAULT&&(Yn.internal=!0,Yn.MassMode_DEFAULT=new lt,Yn.internal=!1),Yn.MassMode_DEFAULT},lt.FIXED=null,lt.get_FIXED=function(){return null==Yn.MassMode_FIXED&&(Yn.internal=!0,Yn.MassMode_FIXED=new lt,Yn.internal=!1),Yn.MassMode_FIXED},lt.prototype.toString=function(){return null==Yn.MassMode_DEFAULT&&(Yn.internal=!0,Yn.MassMode_DEFAULT=new lt,Yn.internal=!1),this==Yn.MassMode_DEFAULT?"DEFAULT":(null==Yn.MassMode_FIXED&&(Yn.internal=!0,Yn.MassMode_FIXED=new lt,Yn.internal=!1),this==Yn.MassMode_FIXED?"FIXED":"")},Object.defineProperty(lt,"DEFAULT",{get:lt.get_DEFAULT}),Object.defineProperty(lt,"FIXED",{get:lt.get_FIXED}),lt.prototype.__class__=lt;var pt=nape.phys.Material=function(t,e,i,n,r){null==r&&(r=.001),null==n&&(n=1),null==i&&(i=2),null==e&&(e=1),null==t&&(t=0),(this.zpp_inner=null)==Ue.zpp_pool?this.zpp_inner=new Ue:(this.zpp_inner=Ue.zpp_pool,Ue.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null),t!=(this.zpp_inner.outer=this).zpp_inner.elasticity&&(this.zpp_inner.elasticity=+t,this.zpp_inner.invalidate(Ue.WAKE|Ue.ARBITERS)),e!=this.zpp_inner.dynamicFriction&&(this.zpp_inner.dynamicFriction=+e,this.zpp_inner.invalidate(Ue.WAKE|Ue.ANGDRAG|Ue.ARBITERS)),i!=this.zpp_inner.staticFriction&&(this.zpp_inner.staticFriction=+i,this.zpp_inner.invalidate(Ue.WAKE|Ue.ARBITERS)),n!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=n/1e3,this.zpp_inner.invalidate(Ue.WAKE|Ue.PROPS)),r!=this.zpp_inner.rollingFriction&&(this.zpp_inner.rollingFriction=+r,this.zpp_inner.invalidate(Ue.WAKE|Ue.ARBITERS))};pt.__name__=["nape","phys","Material"],pt.wood=function(){return new pt(.4,.2,.38,.7,.005)},pt.steel=function(){return new pt(.2,.57,.74,7.8,.001)},pt.ice=function(){return new pt(.3,.03,.1,.9,1e-4)},pt.rubber=function(){return new pt(.8,1,1.4,1.5,.01)},pt.glass=function(){return new pt(.4,.4,.94,2.6,.002)},pt.sand=function(){return new pt(-1,.45,.6,1.6,16)},pt.prototype.zpp_inner=null,pt.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},pt.prototype.get_shapes=function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=In.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},pt.prototype.copy=function(){var t=new pt(this.zpp_inner.elasticity,this.zpp_inner.dynamicFriction,this.zpp_inner.staticFriction,1e3*this.zpp_inner.density,this.zpp_inner.rollingFriction);return null!=this.zpp_inner.userData&&(t.zpp_inner.userData=l.copy(this.zpp_inner.userData)),t},pt.prototype.get_elasticity=function(){return this.zpp_inner.elasticity},pt.prototype.set_elasticity=function(t){return t!=this.zpp_inner.elasticity&&(this.zpp_inner.elasticity=+t,this.zpp_inner.invalidate(Ue.WAKE|Ue.ARBITERS)),this.zpp_inner.elasticity},pt.prototype.get_dynamicFriction=function(){return this.zpp_inner.dynamicFriction},pt.prototype.set_dynamicFriction=function(t){return t!=this.zpp_inner.dynamicFriction&&(this.zpp_inner.dynamicFriction=+t,this.zpp_inner.invalidate(Ue.WAKE|Ue.ANGDRAG|Ue.ARBITERS)),this.zpp_inner.dynamicFriction},pt.prototype.get_staticFriction=function(){return this.zpp_inner.staticFriction},pt.prototype.set_staticFriction=function(t){return t!=this.zpp_inner.staticFriction&&(this.zpp_inner.staticFriction=+t,this.zpp_inner.invalidate(Ue.WAKE|Ue.ARBITERS)),this.zpp_inner.staticFriction},pt.prototype.get_density=function(){return 1e3*this.zpp_inner.density},pt.prototype.set_density=function(t){return t!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=t/1e3,this.zpp_inner.invalidate(Ue.WAKE|Ue.PROPS)),1e3*this.zpp_inner.density},pt.prototype.get_rollingFriction=function(){return this.zpp_inner.rollingFriction},pt.prototype.set_rollingFriction=function(t){return t!=this.zpp_inner.rollingFriction&&(this.zpp_inner.rollingFriction=+t,this.zpp_inner.invalidate(Ue.WAKE|Ue.ARBITERS)),this.zpp_inner.rollingFriction},pt.prototype.toString=function(){return"{ elasticity: "+this.zpp_inner.elasticity+" dynamicFriction: "+this.zpp_inner.dynamicFriction+" staticFriction: "+this.zpp_inner.staticFriction+" density: "+1e3*this.zpp_inner.density+" rollingFriction: "+this.zpp_inner.rollingFriction+" }"},Object.defineProperty(pt.prototype,"userData",{get:pt.prototype.get_userData}),Object.defineProperty(pt.prototype,"shapes",{get:pt.prototype.get_shapes}),Object.defineProperty(pt.prototype,"elasticity",{get:pt.prototype.get_elasticity,set:pt.prototype.set_elasticity}),Object.defineProperty(pt.prototype,"dynamicFriction",{get:pt.prototype.get_dynamicFriction,set:pt.prototype.set_dynamicFriction}),Object.defineProperty(pt.prototype,"staticFriction",{get:pt.prototype.get_staticFriction,set:pt.prototype.set_staticFriction}),Object.defineProperty(pt.prototype,"density",{get:pt.prototype.get_density,set:pt.prototype.set_density}),Object.defineProperty(pt.prototype,"rollingFriction",{get:pt.prototype.get_rollingFriction,set:pt.prototype.set_rollingFriction}),pt.prototype.__class__=pt;var ht=nape.shape.Shape=function(){this.zpp_inner=null,Q.call(this)};ht.__name__=["nape","shape","Shape"],ht.__super__=Q,ht.prototype=Object.create(Q.prototype),ht.prototype.zpp_inner=null,ht.prototype.get_type=function(){return Xe.types[this.zpp_inner.type]},ht.prototype.isCircle=function(){return 0==this.zpp_inner.type},ht.prototype.isPolygon=function(){return 1==this.zpp_inner.type},ht.prototype.get_body=function(){return null!=this.zpp_inner.body?this.zpp_inner.body.outer:null},ht.prototype.set_body=function(t){return this.zpp_inner.immutable_midstep("Shape::body"),(null!=this.zpp_inner.body?this.zpp_inner.body.outer:null)!=t&&(null!=this.zpp_inner.body&&(null!=this.zpp_inner.body?this.zpp_inner.body.outer:null).zpp_inner.wrap_shapes.remove(this),null!=t&&((t=t.zpp_inner.wrap_shapes).zpp_inner.reverse_flag?t.push(this):t.unshift(this))),null!=this.zpp_inner.body?this.zpp_inner.body.outer:null},ht.prototype.get_castCircle=function(){return 0==this.zpp_inner.type?this.zpp_inner.circle.outer_zn:null},ht.prototype.get_castPolygon=function(){return 1==this.zpp_inner.type?this.zpp_inner.polygon.outer_zn:null},ht.prototype.get_worldCOM=function(){var t,e,i,n;return null==this.zpp_inner.wrap_worldCOM&&(t=this.zpp_inner.worldCOMx,n=this.zpp_inner.worldCOMy,null==Rn.poolVec2?e=new Ct:(e=Rn.poolVec2,Rn.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==Ir.zpp_pool?i=new Ir:(i=Ir.zpp_pool,Ir.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=t,i.y=n,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.x==t&&(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.y==n)||(e.zpp_inner.x=t,e.zpp_inner.y=n,null!=(n=e.zpp_inner)._invalidate&&n._invalidate(n))),e.zpp_inner.weak=!1,this.zpp_inner.wrap_worldCOM=e,this.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._validate=Z(a=this.zpp_inner,a.getworldCOM)),this.zpp_inner.wrap_worldCOM},ht.prototype.get_localCOM=function(){return null==this.zpp_inner.wrap_localCOM&&(0==this.zpp_inner.type?this.zpp_inner.circle:this.zpp_inner.polygon).setupLocalCOM(),this.zpp_inner.wrap_localCOM},ht.prototype.set_localCOM=function(t){this.zpp_inner.immutable_midstep("Body::localCOM"),null==this.zpp_inner.wrap_localCOM&&(0==this.zpp_inner.type?this.zpp_inner.circle:this.zpp_inner.polygon).setupLocalCOM();var e=this.zpp_inner.wrap_localCOM,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner.wrap_localCOM&&(0==this.zpp_inner.type?this.zpp_inner.circle:this.zpp_inner.polygon).setupLocalCOM(),this.zpp_inner.wrap_localCOM},ht.prototype.get_area=function(){return this.zpp_inner.validate_area_inertia(),this.zpp_inner.area},ht.prototype.get_inertia=function(){return this.zpp_inner.validate_area_inertia(),this.zpp_inner.inertia},ht.prototype.get_angDrag=function(){return this.zpp_inner.validate_angDrag(),this.zpp_inner.angDrag},ht.prototype.get_material=function(){return this.zpp_inner.material.wrapper()},ht.prototype.set_material=function(t){return this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(t.zpp_inner),this.zpp_inner.material.wrapper()},ht.prototype.get_filter=function(){return this.zpp_inner.filter.wrapper()},ht.prototype.set_filter=function(t){return this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(t.zpp_inner),this.zpp_inner.filter.wrapper()},ht.prototype.get_fluidProperties=function(){return this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new rt).zpp_inner),this.zpp_inner.fluidProperties.wrapper()},ht.prototype.set_fluidProperties=function(t){return this.zpp_inner.setFluid(t.zpp_inner),this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new rt).zpp_inner),this.zpp_inner.fluidProperties.wrapper()},ht.prototype.get_fluidEnabled=function(){return this.zpp_inner.fluidEnabled},ht.prototype.set_fluidEnabled=function(t){return this.zpp_inner.immutable_midstep("Shape::fluidEnabled"),(this.zpp_inner.fluidEnabled=t)&&null==this.zpp_inner.fluidProperties&&(this.zpp_inner.setFluid((new rt).zpp_inner),this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new rt).zpp_inner),this.zpp_inner.fluidProperties.wrapper()),this.zpp_inner.wake(),this.zpp_inner.fluidEnabled},ht.prototype.get_sensorEnabled=function(){return this.zpp_inner.sensorEnabled},ht.prototype.set_sensorEnabled=function(t){return this.zpp_inner.immutable_midstep("Shape::sensorEnabled"),this.zpp_inner.sensorEnabled=t,this.zpp_inner.wake(),this.zpp_inner.sensorEnabled},ht.prototype.get_bounds=function(){return this.zpp_inner.aabb.wrapper()},ht.prototype.translate=function(t){var e,i,n;return this.zpp_inner.immutable_midstep("Shape::translate()"),0<t.lsq()&&(0==this.zpp_inner.type?(null!=(e=t.zpp_inner)._validate&&e._validate(),i=t.zpp_inner.x,null!=(e=t.zpp_inner)._validate&&e._validate(),this.zpp_inner.circle.__translate(i,t.zpp_inner.y)):(null!=(i=t.zpp_inner)._validate&&i._validate(),n=t.zpp_inner.x,null!=(i=t.zpp_inner)._validate&&i._validate(),this.zpp_inner.polygon.__translate(n,t.zpp_inner.y))),t.zpp_inner.weak&&(n=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Ir.zpp_pool,Ir.zpp_pool=n),this},ht.prototype.scale=function(t,e){var i;return this.zpp_inner.immutable_midstep("Shape::scale()"),0==this.zpp_inner.type?(i=t*t-e*e)*i<kr.epsilon*kr.epsilon&&this.zpp_inner.circle.__scale(t,e):this.zpp_inner.polygon.__scale(t,e),this},ht.prototype.rotate=function(t){var e;return this.zpp_inner.immutable_midstep("Shape::rotate()"),t%(2*Math.PI)!=0&&(e=Math.cos(t),t=Math.sin(t),(0==this.zpp_inner.type?this.zpp_inner.circle:this.zpp_inner.polygon).__rotate(t,e)),this},ht.prototype.transform=function(t){return this.zpp_inner.immutable_midstep("Shape::transform()"),0==this.zpp_inner.type?t.equiorthogonal()&&this.zpp_inner.circle.__transform(t):this.zpp_inner.polygon.__transform(t),this},ht.prototype.contains=function(t){_e.validateShape(this.zpp_inner);var e=t.zpp_inner;null!=e._validate&&e._validate();var i=Er.shapeContains(this.zpp_inner,t.zpp_inner);return t.zpp_inner.weak&&(e=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ir.zpp_pool,Ir.zpp_pool=e),i},ht.prototype.copy=function(){return this.zpp_inner.copy()},ht.prototype.toString=function(){return(0==this.zpp_inner.type?"Circle":"Polygon")+"#"+this.zpp_inner_i.id},Object.defineProperty(ht.prototype,"type",{get:ht.prototype.get_type}),Object.defineProperty(ht.prototype,"body",{get:ht.prototype.get_body,set:ht.prototype.set_body}),Object.defineProperty(ht.prototype,"castCircle",{get:ht.prototype.get_castCircle}),Object.defineProperty(ht.prototype,"castPolygon",{get:ht.prototype.get_castPolygon}),Object.defineProperty(ht.prototype,"worldCOM",{get:ht.prototype.get_worldCOM}),Object.defineProperty(ht.prototype,"localCOM",{get:ht.prototype.get_localCOM,set:ht.prototype.set_localCOM}),Object.defineProperty(ht.prototype,"area",{get:ht.prototype.get_area}),Object.defineProperty(ht.prototype,"inertia",{get:ht.prototype.get_inertia}),Object.defineProperty(ht.prototype,"angDrag",{get:ht.prototype.get_angDrag}),Object.defineProperty(ht.prototype,"material",{get:ht.prototype.get_material,set:ht.prototype.set_material}),Object.defineProperty(ht.prototype,"filter",{get:ht.prototype.get_filter,set:ht.prototype.set_filter}),Object.defineProperty(ht.prototype,"fluidProperties",{get:ht.prototype.get_fluidProperties,set:ht.prototype.set_fluidProperties}),Object.defineProperty(ht.prototype,"fluidEnabled",{get:ht.prototype.get_fluidEnabled,set:ht.prototype.set_fluidEnabled}),Object.defineProperty(ht.prototype,"sensorEnabled",{get:ht.prototype.get_sensorEnabled,set:ht.prototype.set_sensorEnabled}),Object.defineProperty(ht.prototype,"bounds",{get:ht.prototype.get_bounds}),ht.prototype.__class__=ht;var ut=nape.shape.Circle=function(t,e,i,n){this.zpp_inner_zn=null,ht.call(this),this.zpp_inner_zn=new Ve,((this.zpp_inner_zn.outer=this).zpp_inner_zn.outer_zn=this).zpp_inner=this.zpp_inner_zn,this.zpp_inner_i=this.zpp_inner,(this.zpp_inner_i.outer_i=this).zpp_inner.immutable_midstep("Circle::radius"),t!=this.zpp_inner_zn.radius&&(this.zpp_inner_zn.radius=t,this.zpp_inner_zn.invalidate_radius()),null==e?(this.zpp_inner.localCOMx=0,this.zpp_inner.localCOMy=0):(null!=(t=e.zpp_inner)._validate&&t._validate(),this.zpp_inner.localCOMx=e.zpp_inner.x,null!=(t=e.zpp_inner)._validate&&t._validate(),this.zpp_inner.localCOMy=e.zpp_inner.y,e.zpp_inner.weak&&(t=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Rn.poolVec2,Rn.poolVec2=e,null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ir.zpp_pool,Ir.zpp_pool=t)),null==i?null==Ue.zpp_pool?this.zpp_inner.material=new Ue:(this.zpp_inner.material=Ue.zpp_pool,Ue.zpp_pool=this.zpp_inner.material.next,this.zpp_inner.material.next=null):(this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(i.zpp_inner),this.zpp_inner.material.wrapper()),null==n?null==le.zpp_pool?this.zpp_inner.filter=new le:(this.zpp_inner.filter=le.zpp_pool,le.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=null):(this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(n.zpp_inner),this.zpp_inner.filter.wrapper()),this.zpp_inner_i.insert_cbtype(Mt.ANY_SHAPE.zpp_inner)};ut.__name__=["nape","shape","Circle"],ut.__super__=ht,ut.prototype=Object.create(ht.prototype),ut.prototype.zpp_inner_zn=null,ut.prototype.get_radius=function(){return this.zpp_inner_zn.radius},ut.prototype.set_radius=function(t){return this.zpp_inner.immutable_midstep("Circle::radius"),t!=this.zpp_inner_zn.radius&&(this.zpp_inner_zn.radius=t,this.zpp_inner_zn.invalidate_radius()),this.zpp_inner_zn.radius},Object.defineProperty(ut.prototype,"radius",{get:ut.prototype.get_radius,set:ut.prototype.set_radius}),ut.prototype.__class__=ut;var ct=nape.shape.Edge=function(){this.zpp_inner=null};ct.__name__=["nape","shape","Edge"],ct.prototype.zpp_inner=null,ct.prototype.get_polygon=function(){return this.zpp_inner.polygon.outer_zn},ct.prototype.get_localNormal=function(){return null==this.zpp_inner.wrap_lnorm&&this.zpp_inner.getlnorm(),this.zpp_inner.wrap_lnorm},ct.prototype.get_worldNormal=function(){return null==this.zpp_inner.wrap_gnorm&&this.zpp_inner.getgnorm(),this.zpp_inner.wrap_gnorm},ct.prototype.get_length=function(){return this.zpp_inner.polygon.validate_laxi(),this.zpp_inner.length},ct.prototype.get_localProjection=function(){return this.zpp_inner.polygon.validate_laxi(),this.zpp_inner.lprojection},ct.prototype.get_worldProjection=function(){var t=this.zpp_inner.polygon;if(t.zip_gaxi&&null!=t.body){t.zip_gaxi=!1,t.validate_laxi();var e=t.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),t.zip_gverts&&null!=t.body){t.zip_gverts=!1,t.validate_lverts();var i=t.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var n=t.lverts.next,r=t.gverts.next;null!=r;){var s=r,o=n,n=n.next;s.x=t.body.posx+(t.body.axisy*o.x-t.body.axisx*o.y),s.y=t.body.posy+(o.x*t.body.axisx+o.y*t.body.axisy),r=r.next}}for(var a=t.edges.head,l=p=t.gverts.next,p=p.next;null!=p;){var h=p,u=a.elt,a=a.next;u.gp0=l,u.gp1=h,u.gnormx=t.body.axisy*u.lnormx-t.body.axisx*u.lnormy,u.gnormy=u.lnormx*t.body.axisx+u.lnormy*t.body.axisy,u.gprojection=t.body.posx*u.gnormx+t.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy,l=h,p=p.next}i=a.elt;i.gp0=l,i.gp1=t.gverts.next,i.gnormx=t.body.axisy*i.lnormx-t.body.axisx*i.lnormy,i.gnormy=i.lnormx*t.body.axisx+i.lnormy*t.body.axisy,i.gprojection=t.body.posx*i.gnormx+t.body.posy*i.gnormy+i.lprojection,null!=i.wrap_gnorm&&(i.wrap_gnorm.zpp_inner.x=i.gnormx,i.wrap_gnorm.zpp_inner.y=i.gnormy),i.tp0=i.gp0.y*i.gnormx-i.gp0.x*i.gnormy,i.tp1=i.gp1.y*i.gnormx-i.gp1.x*i.gnormy}return this.zpp_inner.gprojection},ct.prototype.get_localVertex1=function(){this.zpp_inner.polygon.validate_laxi();var t,e=this.zpp_inner.lp0;return null==e.outer&&(e.outer=new Ct,null!=(t=e.outer.zpp_inner).outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ir.zpp_pool,Ir.zpp_pool=t,e.outer.zpp_inner=e),e.outer},ct.prototype.get_localVertex2=function(){this.zpp_inner.polygon.validate_laxi();var t,e=this.zpp_inner.lp1;return null==e.outer&&(e.outer=new Ct,null!=(t=e.outer.zpp_inner).outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ir.zpp_pool,Ir.zpp_pool=t,e.outer.zpp_inner=e),e.outer},ct.prototype.get_worldVertex1=function(){var t=this.zpp_inner.polygon;if(t.zip_gaxi&&null!=t.body){t.zip_gaxi=!1,t.validate_laxi();var e=t.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),t.zip_gverts&&null!=t.body){t.zip_gverts=!1,t.validate_lverts();var i=t.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var n=t.lverts.next,r=t.gverts.next;null!=r;){var s=r,o=n,n=n.next;s.x=t.body.posx+(t.body.axisy*o.x-t.body.axisx*o.y),s.y=t.body.posy+(o.x*t.body.axisx+o.y*t.body.axisy),r=r.next}}for(var a=t.edges.head,l=p=t.gverts.next,p=p.next;null!=p;){var h=p,u=a.elt,a=a.next;u.gp0=l,u.gp1=h,u.gnormx=t.body.axisy*u.lnormx-t.body.axisx*u.lnormy,u.gnormy=u.lnormx*t.body.axisx+u.lnormy*t.body.axisy,u.gprojection=t.body.posx*u.gnormx+t.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy,l=h,p=p.next}e=a.elt;e.gp0=l,e.gp1=t.gverts.next,e.gnormx=t.body.axisy*e.lnormx-t.body.axisx*e.lnormy,e.gnormy=e.lnormx*t.body.axisx+e.lnormy*t.body.axisy,e.gprojection=t.body.posx*e.gnormx+t.body.posy*e.gnormy+e.lprojection,null!=e.wrap_gnorm&&(e.wrap_gnorm.zpp_inner.x=e.gnormx,e.wrap_gnorm.zpp_inner.y=e.gnormy),e.tp0=e.gp0.y*e.gnormx-e.gp0.x*e.gnormy,e.tp1=e.gp1.y*e.gnormx-e.gp1.x*e.gnormy}i=this.zpp_inner.gp0;return null==i.outer&&(i.outer=new Ct,null!=(e=i.outer.zpp_inner).outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ir.zpp_pool,Ir.zpp_pool=e,i.outer.zpp_inner=i),i.outer},ct.prototype.get_worldVertex2=function(){var t=this.zpp_inner.polygon;if(t.zip_gaxi&&null!=t.body){t.zip_gaxi=!1,t.validate_laxi();var e=t.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),t.zip_gverts&&null!=t.body){t.zip_gverts=!1,t.validate_lverts();var i=t.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var n=t.lverts.next,r=t.gverts.next;null!=r;){var s=r,o=n,n=n.next;s.x=t.body.posx+(t.body.axisy*o.x-t.body.axisx*o.y),s.y=t.body.posy+(o.x*t.body.axisx+o.y*t.body.axisy),r=r.next}}for(var a=t.edges.head,l=p=t.gverts.next,p=p.next;null!=p;){var h=p,u=a.elt,a=a.next;u.gp0=l,u.gp1=h,u.gnormx=t.body.axisy*u.lnormx-t.body.axisx*u.lnormy,u.gnormy=u.lnormx*t.body.axisx+u.lnormy*t.body.axisy,u.gprojection=t.body.posx*u.gnormx+t.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy,l=h,p=p.next}e=a.elt;e.gp0=l,e.gp1=t.gverts.next,e.gnormx=t.body.axisy*e.lnormx-t.body.axisx*e.lnormy,e.gnormy=e.lnormx*t.body.axisx+e.lnormy*t.body.axisy,e.gprojection=t.body.posx*e.gnormx+t.body.posy*e.gnormy+e.lprojection,null!=e.wrap_gnorm&&(e.wrap_gnorm.zpp_inner.x=e.gnormx,e.wrap_gnorm.zpp_inner.y=e.gnormy),e.tp0=e.gp0.y*e.gnormx-e.gp0.x*e.gnormy,e.tp1=e.gp1.y*e.gnormx-e.gp1.x*e.gnormy}i=this.zpp_inner.gp1;return null==i.outer&&(i.outer=new Ct,null!=(e=i.outer.zpp_inner).outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ir.zpp_pool,Ir.zpp_pool=e,i.outer.zpp_inner=i),i.outer},ct.prototype.toString=function(){if(null==this.zpp_inner.polygon)return"Edge(object-pooled)";if(null==this.zpp_inner.polygon.body)return this.zpp_inner.polygon.validate_laxi(),"{ localNormal : { x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" } }";var t=this.zpp_inner.polygon;if(t.zip_gaxi&&null!=t.body){t.zip_gaxi=!1,t.validate_laxi();var e=t.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),t.zip_gverts&&null!=t.body){t.zip_gverts=!1,t.validate_lverts();var i=t.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var n=t.lverts.next,r=t.gverts.next;null!=r;){var s=r,o=n,n=n.next;s.x=t.body.posx+(t.body.axisy*o.x-t.body.axisx*o.y),s.y=t.body.posy+(o.x*t.body.axisx+o.y*t.body.axisy),r=r.next}}for(var a=t.edges.head,l=p=t.gverts.next,p=p.next;null!=p;){var h=p,u=a.elt,a=a.next;u.gp0=l,u.gp1=h,u.gnormx=t.body.axisy*u.lnormx-t.body.axisx*u.lnormy,u.gnormy=u.lnormx*t.body.axisx+u.lnormy*t.body.axisy,u.gprojection=t.body.posx*u.gnormx+t.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy,l=h,p=p.next}i=a.elt;i.gp0=l,i.gp1=t.gverts.next,i.gnormx=t.body.axisy*i.lnormx-t.body.axisx*i.lnormy,i.gnormy=i.lnormx*t.body.axisx+i.lnormy*t.body.axisy,i.gprojection=t.body.posx*i.gnormx+t.body.posy*i.gnormy+i.lprojection,null!=i.wrap_gnorm&&(i.wrap_gnorm.zpp_inner.x=i.gnormx,i.wrap_gnorm.zpp_inner.y=i.gnormy),i.tp0=i.gp0.y*i.gnormx-i.gp0.x*i.gnormy,i.tp1=i.gp1.y*i.gnormx-i.gp1.x*i.gnormy}return"{ localNormal : { x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" } worldNormal : { x: "+this.zpp_inner.gnormx+" y: "+this.zpp_inner.gnormy+" } }"},Object.defineProperty(ct.prototype,"polygon",{get:ct.prototype.get_polygon}),Object.defineProperty(ct.prototype,"localNormal",{get:ct.prototype.get_localNormal}),Object.defineProperty(ct.prototype,"worldNormal",{get:ct.prototype.get_worldNormal}),Object.defineProperty(ct.prototype,"length",{get:ct.prototype.get_length}),Object.defineProperty(ct.prototype,"localProjection",{get:ct.prototype.get_localProjection}),Object.defineProperty(ct.prototype,"worldProjection",{get:ct.prototype.get_worldProjection}),Object.defineProperty(ct.prototype,"localVertex1",{get:ct.prototype.get_localVertex1}),Object.defineProperty(ct.prototype,"localVertex2",{get:ct.prototype.get_localVertex2}),Object.defineProperty(ct.prototype,"worldVertex1",{get:ct.prototype.get_worldVertex1}),Object.defineProperty(ct.prototype,"worldVertex2",{get:ct.prototype.get_worldVertex2}),ct.prototype.__class__=ct;var ie=nape.shape.EdgeIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};ie.__name__=["nape","shape","EdgeIterator"],ie.get=function(t){var e,i=null==ie.zpp_pool?(En.internal=!0,e=new ie,En.internal=!1,e):(i=ie.zpp_pool,ie.zpp_pool=i.zpp_next,i);return i.zpp_i=0,i.zpp_inner=t,i.zpp_critical=!1,i},ie.prototype.zpp_inner=null,ie.prototype.zpp_i=null,ie.prototype.zpp_critical=null,ie.prototype.zpp_next=null,ie.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);t=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=ie.zpp_pool,(ie.zpp_pool=this).zpp_inner=null,!1)},ie.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},ie.prototype.__class__=ie;var dt=nape.shape.EdgeList=function(){this.zpp_inner=null,this.zpp_inner=new En,this.zpp_inner.outer=this};dt.__name__=["nape","shape","EdgeList"],dt.fromArray=function(t){for(var e=new dt,i=0;i<t.length;){var n=t[i];++i,e.push(n)}return e},dt.prototype.zpp_inner=null,dt.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},dt.prototype.has=function(t){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(t.zpp_inner)},dt.prototype.at=function(t){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t==this.zpp_inner.user_length-1||(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.user_length-2-t)),t<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=t,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(t);else for(;this.zpp_inner.at_index!=t;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.wrapper()},dt.prototype.push=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(t.zpp_inner):(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},dt.prototype.unshift=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)):this.zpp_inner.inner.add(t.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},dt.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e,i=null;return this.zpp_inner.reverse_flag?(e=(i=this.zpp_inner.inner.head.elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(i=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.wrapper()},dt.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(i=(null==(e=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:e.next).elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)):(e=(i=this.zpp_inner.inner.head.elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.wrapper()},dt.prototype.add=function(t){return this.zpp_inner.reverse_flag?this.push(t):this.unshift(t)},dt.prototype.remove=function(t){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==t.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(t.zpp_inner),this.zpp_inner.invalidate()),e},dt.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},dt.prototype.empty=function(){return null==this.zpp_inner.inner.head},dt.prototype.iterator=function(){return this.zpp_inner.valmod(),ie.get(this)},dt.prototype.copy=function(t){null==t&&(t=!1);var e=new dt;this.zpp_inner.valmod();for(var i=ie.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=ie.zpp_pool,(ie.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e.push(t?null:n)}return e},dt.prototype.merge=function(t){t.zpp_inner.valmod();for(var e=ie.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=ie.zpp_pool,(ie.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);this.has(i)||(this.zpp_inner.reverse_flag?this.push(i):this.unshift(i))}},dt.prototype.toString=function(){var t="[",e=!0;this.zpp_inner.valmod();for(var i=ie.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=ie.zpp_pool,(ie.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e||(t+=","),t+=null==n?"NULL":n.toString(),e=!1}return t+"]"},dt.prototype.foreach=function(t){this.zpp_inner.valmod();for(var e=ie.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=ie.zpp_pool,(ie.zpp_pool=e).zpp_inner=null,!1)))break;try{e.zpp_critical=!1,t(e.zpp_inner.at(e.zpp_i++))}catch(t){e.zpp_next=ie.zpp_pool,(ie.zpp_pool=e).zpp_inner=null;break}}return this},dt.prototype.filter=function(t){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var i=this.at(e);try{t(i)?++e:this.remove(i)}catch(t){break}}return this},Object.defineProperty(dt.prototype,"length",{get:dt.prototype.get_length}),dt.prototype.__class__=dt;var _t=nape.shape.Polygon=function(t,e,i){if(this.zpp_inner_zn=null,ht.call(this),this.zpp_inner_zn=new He,((this.zpp_inner_zn.outer=this).zpp_inner_zn.outer_zn=this).zpp_inner=this.zpp_inner_zn,this.zpp_inner_i=this.zpp_inner,this.zpp_inner_i.outer_i=this,t instanceof Array&&null==t.__enum__)for(var n=t,r=0;r<n.length;){var s=n[r];++r;var o=s;null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var a=this.zpp_inner_zn.wrap_lverts,l=o.zpp_inner;null!=l._validate&&l._validate();s=o.zpp_inner.x,l=o.zpp_inner;null!=l._validate&&l._validate();var p,h,l=o.zpp_inner.y;null==Rn.poolVec2?p=new Ct:(p=Rn.poolVec2,Rn.poolVec2=p.zpp_pool,p.zpp_pool=null),null==p.zpp_inner?(null==Ir.zpp_pool?h=new Ir:(h=Ir.zpp_pool,Ir.zpp_pool=h.next,h.next=null),h.weak=!1,h._immutable=!1,h.x=s,h.y=l,p.zpp_inner=h,p.zpp_inner.outer=p):(null!=(o=p.zpp_inner)._validate&&o._validate(),p.zpp_inner.x==s&&(null!=(o=p.zpp_inner)._validate&&o._validate(),p.zpp_inner.y==l)||(p.zpp_inner.x=s,p.zpp_inner.y=l,null!=(l=p.zpp_inner)._invalidate&&l._invalidate(l))),p.zpp_inner.weak=!1,a.push(p)}else if(F.__instanceof(t,Y))for(var u=t.iterator();;){u.zpp_inner.zpp_inner.valmod();var c=u.zpp_inner.zpp_gl();if(u.zpp_critical=!0,!(u.zpp_i<c||(u.zpp_next=Qt.zpp_pool,(Qt.zpp_pool=u).zpp_inner=null,!1)))break;u.zpp_critical=!1;var d=u.zpp_inner.at(u.zpp_i++);null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var _=this.zpp_inner_zn.wrap_lverts,y=d.zpp_inner;null!=y._validate&&y._validate();c=d.zpp_inner.x,y=d.zpp_inner;null!=y._validate&&y._validate();var f,m,y=d.zpp_inner.y;null==Rn.poolVec2?f=new Ct:(f=Rn.poolVec2,Rn.poolVec2=f.zpp_pool,f.zpp_pool=null),null==f.zpp_inner?(null==Ir.zpp_pool?m=new Ir:(m=Ir.zpp_pool,Ir.zpp_pool=m.next,m.next=null),m.weak=!1,m._immutable=!1,m.x=c,m.y=y,f.zpp_inner=m,f.zpp_inner.outer=f):(null!=(d=f.zpp_inner)._validate&&d._validate(),f.zpp_inner.x==c&&(null!=(d=f.zpp_inner)._validate&&d._validate(),f.zpp_inner.y==y)||(f.zpp_inner.x=c,f.zpp_inner.y=y,null!=(y=f.zpp_inner)._invalidate&&y._invalidate(y))),f.zpp_inner.weak=!1,_.push(f)}else if(F.__instanceof(t,ci)){var x=t.zpp_inner.vertices;if(null!=x)for(var v=x;;){var g,b,z=v.x,w=v.y;null==Rn.poolVec2?g=new Ct:(g=Rn.poolVec2,Rn.poolVec2=g.zpp_pool,g.zpp_pool=null),null==g.zpp_inner?(null==Ir.zpp_pool?b=new Ir:(b=Ir.zpp_pool,Ir.zpp_pool=b.next,b.next=null),b.weak=!1,b._immutable=!1,b.x=z,b.y=w,g.zpp_inner=b,g.zpp_inner.outer=g):(null!=(C=g.zpp_inner)._validate&&C._validate(),g.zpp_inner.x==z&&(null!=(P=g.zpp_inner)._validate&&P._validate(),g.zpp_inner.y==w)||(g.zpp_inner.x=z,g.zpp_inner.y=w,null!=(T=g.zpp_inner)._invalidate&&T._invalidate(T))),g.zpp_inner.weak=!1;var C=g,v=v.next;null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var P=this.zpp_inner_zn.wrap_lverts,z=C.zpp_inner;null!=z._validate&&z._validate();var w=C.zpp_inner.x,T=C.zpp_inner;null!=T._validate&&T._validate();var S,M,z=C.zpp_inner.y;null==Rn.poolVec2?S=new Ct:(S=Rn.poolVec2,Rn.poolVec2=S.zpp_pool,S.zpp_pool=null),null==S.zpp_inner?(null==Ir.zpp_pool?M=new Ir:(M=Ir.zpp_pool,Ir.zpp_pool=M.next,M.next=null),M.weak=!1,M._immutable=!1,M.x=w,M.y=z,S.zpp_inner=M,S.zpp_inner.outer=S):(null!=(T=S.zpp_inner)._validate&&T._validate(),S.zpp_inner.x==w&&(null!=(T=S.zpp_inner)._validate&&T._validate(),S.zpp_inner.y==z)||(S.zpp_inner.x=w,S.zpp_inner.y=z,null!=(z=S.zpp_inner)._invalidate&&z._invalidate(z))),S.zpp_inner.weak=!1,P.push(S);P=C.zpp_inner;C.zpp_inner.outer=null,C.zpp_inner=null;C=C;C.zpp_pool=Rn.poolVec2,Rn.poolVec2=C;P=P;if(null!=P.outer&&(P.outer.zpp_inner=null,P.outer=null),P._isimmutable=null,P._validate=null,P._invalidate=null,P.next=Ir.zpp_pool,Ir.zpp_pool=P,v==x)break}}if(t instanceof Array&&null==t.__enum__)for(var A=t,O=0;O<A.length;){var k=A[O],E=!!k.zpp_inner.weak&&(E=k.zpp_inner,k.zpp_inner.outer=null,k.zpp_inner=null,(k=k).zpp_pool=Rn.poolVec2,Rn.poolVec2=k,null!=(E=E).outer&&(E.outer.zpp_inner=null,E.outer=null),E._isimmutable=null,E._validate=null,E._invalidate=null,E.next=Ir.zpp_pool,Ir.zpp_pool=E,!0);E?A.splice(O,1):++O}else if(F.__instanceof(t,Y)){t=t;null!=t.zpp_inner._validate&&t.zpp_inner._validate();for(var I=t.zpp_inner.inner,D=null,B=I.head;null!=B;){var L,R=B.elt;R.outer.zpp_inner.weak?(B=I.erase(D),R.outer.zpp_inner.weak&&(R=(L=R.outer).zpp_inner,L.zpp_inner.outer=null,L.zpp_inner=null,(L=L).zpp_pool=Rn.poolVec2,Rn.poolVec2=L,null!=(R=R).outer&&(R.outer.zpp_inner=null,R.outer=null),R._isimmutable=null,R._validate=null,R._invalidate=null,R.next=Ir.zpp_pool,Ir.zpp_pool=R)):B=(D=B).next}}null==e?null==Ue.zpp_pool?this.zpp_inner.material=new Ue:(this.zpp_inner.material=Ue.zpp_pool,Ue.zpp_pool=this.zpp_inner.material.next,this.zpp_inner.material.next=null):(this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(e.zpp_inner),this.zpp_inner.material.wrapper()),null==i?null==le.zpp_pool?this.zpp_inner.filter=new le:(this.zpp_inner.filter=le.zpp_pool,le.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=null):(this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(i.zpp_inner),this.zpp_inner.filter.wrapper()),this.zpp_inner_i.insert_cbtype(Mt.ANY_SHAPE.zpp_inner)};_t.__name__=["nape","shape","Polygon"],_t.__super__=ht,_t.prototype=Object.create(ht.prototype),_t.rect=function(t,e,i,n,r){var s;null==r&&(r=!1),null==Rn.poolVec2?l=new Ct:(l=Rn.poolVec2,Rn.poolVec2=l.zpp_pool,l.zpp_pool=null),null==l.zpp_inner?(null==Ir.zpp_pool?s=new Ir:(s=Ir.zpp_pool,Ir.zpp_pool=s.next,s.next=null),s.weak=!1,s._immutable=!1,s.x=t,s.y=e,l.zpp_inner=s,l.zpp_inner.outer=l):(null!=(s=l.zpp_inner)._validate&&s._validate(),l.zpp_inner.x==t&&(null!=(s=l.zpp_inner)._validate&&s._validate(),l.zpp_inner.y==e)||(l.zpp_inner.x=t,l.zpp_inner.y=e,null!=(a=l.zpp_inner)._invalidate&&a._invalidate(a))),l.zpp_inner.weak=r;var o,a=l,l=t+i;null==Rn.poolVec2?u=new Ct:(u=Rn.poolVec2,Rn.poolVec2=u.zpp_pool,u.zpp_pool=null),null==u.zpp_inner?(null==Ir.zpp_pool?o=new Ir:(o=Ir.zpp_pool,Ir.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=l,o.y=e,u.zpp_inner=o,u.zpp_inner.outer=u):(null!=(o=u.zpp_inner)._validate&&o._validate(),u.zpp_inner.x==l&&(null!=(o=u.zpp_inner)._validate&&o._validate(),u.zpp_inner.y==e)||(u.zpp_inner.x=l,u.zpp_inner.y=e,null!=(h=u.zpp_inner)._invalidate&&h._invalidate(h))),u.zpp_inner.weak=r;var p,h=u,u=t+i,i=e+n;null==Rn.poolVec2?_=new Ct:(_=Rn.poolVec2,Rn.poolVec2=_.zpp_pool,_.zpp_pool=null),null==_.zpp_inner?(null==Ir.zpp_pool?p=new Ir:(p=Ir.zpp_pool,Ir.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=u,p.y=i,_.zpp_inner=p,_.zpp_inner.outer=_):(null!=(p=_.zpp_inner)._validate&&p._validate(),_.zpp_inner.x==u&&(null!=(p=_.zpp_inner)._validate&&p._validate(),_.zpp_inner.y==i)||(_.zpp_inner.x=u,_.zpp_inner.y=i,null!=(i=_.zpp_inner)._invalidate&&i._invalidate(i))),_.zpp_inner.weak=r;var c,d,_=_,n=e+n;return null==Rn.poolVec2?c=new Ct:(c=Rn.poolVec2,Rn.poolVec2=c.zpp_pool,c.zpp_pool=null),null==c.zpp_inner?(null==Ir.zpp_pool?d=new Ir:(d=Ir.zpp_pool,Ir.zpp_pool=d.next,d.next=null),d.weak=!1,d._immutable=!1,d.x=t,d.y=n,c.zpp_inner=d,c.zpp_inner.outer=c):(null!=(d=c.zpp_inner)._validate&&d._validate(),c.zpp_inner.x==t&&(null!=(d=c.zpp_inner)._validate&&d._validate(),c.zpp_inner.y==n)||(c.zpp_inner.x=t,c.zpp_inner.y=n,null!=(n=c.zpp_inner)._invalidate&&n._invalidate(n))),c.zpp_inner.weak=r,[a,h,_,c]},_t.box=function(t,e,i){return null==i&&(i=!1),_t.rect(-t/2,-e/2,t,e,i)},_t.regular=function(t,e,i,n,r){null==r&&(r=!1),null==n&&(n=0);for(var s=[],o=2*Math.PI/i,a=0;a<i;){var l,p,h=a++*o+n,u=Math.cos(h)*t,c=Math.sin(h)*e;null==Rn.poolVec2?l=new Ct:(l=Rn.poolVec2,Rn.poolVec2=l.zpp_pool,l.zpp_pool=null),null==l.zpp_inner?(null==Ir.zpp_pool?p=new Ir:(p=Ir.zpp_pool,Ir.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=u,p.y=c,l.zpp_inner=p,l.zpp_inner.outer=l):(null!=(h=l.zpp_inner)._validate&&h._validate(),l.zpp_inner.x==u&&(null!=(h=l.zpp_inner)._validate&&h._validate(),l.zpp_inner.y==c)||(l.zpp_inner.x=u,l.zpp_inner.y=c,null!=(c=l.zpp_inner)._invalidate&&c._invalidate(c))),l.zpp_inner.weak=r,s.push(l)}return s},_t.prototype.zpp_inner_zn=null,_t.prototype.get_localVerts=function(){return null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts(),this.zpp_inner_zn.wrap_lverts},_t.prototype.get_worldVerts=function(){return null==this.zpp_inner_zn.wrap_gverts&&this.zpp_inner_zn.getgverts(),this.zpp_inner_zn.wrap_gverts},_t.prototype.get_edges=function(){return null==this.zpp_inner_zn.wrap_edges&&this.zpp_inner_zn.getedges(),this.zpp_inner_zn.wrap_edges},_t.prototype.validity=function(){return this.zpp_inner_zn.valid()},Object.defineProperty(_t.prototype,"localVerts",{get:_t.prototype.get_localVerts}),Object.defineProperty(_t.prototype,"worldVerts",{get:_t.prototype.get_worldVerts}),Object.defineProperty(_t.prototype,"edges",{get:_t.prototype.get_edges}),_t.prototype.__class__=_t;var ne=nape.shape.ShapeIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};ne.__name__=["nape","shape","ShapeIterator"],ne.get=function(t){var e,i=null==ne.zpp_pool?(In.internal=!0,e=new ne,In.internal=!1,e):(i=ne.zpp_pool,ne.zpp_pool=i.zpp_next,i);return i.zpp_i=0,i.zpp_inner=t,i.zpp_critical=!1,i},ne.prototype.zpp_inner=null,ne.prototype.zpp_i=null,ne.prototype.zpp_critical=null,ne.prototype.zpp_next=null,ne.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var t=this.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);t=t.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<t||(this.zpp_next=ne.zpp_pool,(ne.zpp_pool=this).zpp_inner=null,!1)},ne.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},ne.prototype.__class__=ne;var yt=nape.shape.ShapeList=function(){this.zpp_inner=null,this.zpp_inner=new In,this.zpp_inner.outer=this};yt.__name__=["nape","shape","ShapeList"],yt.fromArray=function(t){for(var e=new yt,i=0;i<t.length;){var n=t[i];++i,e.push(n)}return e},yt.prototype.zpp_inner=null,yt.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},yt.prototype.has=function(t){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(t.zpp_inner)},yt.prototype.at=function(t){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.user_length-1-t),t<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=t,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(t);else for(;this.zpp_inner.at_index!=t;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},yt.prototype.push=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(t.zpp_inner):(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},yt.prototype.unshift=function(t){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e,i=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return i&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(e=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=e),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,t.zpp_inner)):this.zpp_inner.inner.add(t.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),i},yt.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e,i=null;return this.zpp_inner.reverse_flag?(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=(i=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)),this.zpp_inner.invalidate(),i.outer},yt.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(i=(null==(e=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:e.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)):(e=(i=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),i.outer},yt.prototype.add=function(t){return this.zpp_inner.reverse_flag?this.push(t):this.unshift(t)},yt.prototype.remove=function(t){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==t.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(t.zpp_inner),this.zpp_inner.invalidate()),e},yt.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},yt.prototype.empty=function(){return null==this.zpp_inner.inner.head},yt.prototype.iterator=function(){return this.zpp_inner.valmod(),ne.get(this)},yt.prototype.copy=function(t){null==t&&(t=!1);var e=new yt;this.zpp_inner.valmod();for(var i=ne.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=ne.zpp_pool,(ne.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e.push(t?null:n)}return e},yt.prototype.merge=function(t){t.zpp_inner.valmod();for(var e=ne.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=ne.zpp_pool,(ne.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);this.has(i)||(this.zpp_inner.reverse_flag?this.push(i):this.unshift(i))}},yt.prototype.toString=function(){var t="[",e=!0;this.zpp_inner.valmod();for(var i=ne.get(this);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=ne.zpp_pool,(ne.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);e||(t+=","),t+=null==n?"NULL":n.toString(),e=!1}return t+"]"},yt.prototype.foreach=function(t){this.zpp_inner.valmod();for(var e=ne.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=ne.zpp_pool,(ne.zpp_pool=e).zpp_inner=null,!1)))break;try{e.zpp_critical=!1,t(e.zpp_inner.at(e.zpp_i++))}catch(t){e.zpp_next=ne.zpp_pool,(ne.zpp_pool=e).zpp_inner=null;break}}return this},yt.prototype.filter=function(t){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var i=this.at(e);try{t(i)?++e:this.remove(i)}catch(t){break}}return this},Object.defineProperty(yt.prototype,"length",{get:yt.prototype.get_length}),yt.prototype.__class__=yt;var ft=nape.shape.ShapeType=function(){};ft.__name__=["nape","shape","ShapeType"],ft.CIRCLE=null,ft.get_CIRCLE=function(){return null==Yn.ShapeType_CIRCLE&&(Yn.internal=!0,Yn.ShapeType_CIRCLE=new ft,Yn.internal=!1),Yn.ShapeType_CIRCLE},ft.POLYGON=null,ft.get_POLYGON=function(){return null==Yn.ShapeType_POLYGON&&(Yn.internal=!0,Yn.ShapeType_POLYGON=new ft,Yn.internal=!1),Yn.ShapeType_POLYGON},ft.prototype.toString=function(){return null==Yn.ShapeType_CIRCLE&&(Yn.internal=!0,Yn.ShapeType_CIRCLE=new ft,Yn.internal=!1),this==Yn.ShapeType_CIRCLE?"CIRCLE":(null==Yn.ShapeType_POLYGON&&(Yn.internal=!0,Yn.ShapeType_POLYGON=new ft,Yn.internal=!1),this==Yn.ShapeType_POLYGON?"POLYGON":"")},Object.defineProperty(ft,"CIRCLE",{get:ft.get_CIRCLE}),Object.defineProperty(ft,"POLYGON",{get:ft.get_POLYGON}),ft.prototype.__class__=ft;var mt=nape.shape.ValidationResult=function(){};mt.__name__=["nape","shape","ValidationResult"],mt.VALID=null,mt.get_VALID=function(){return null==Yn.ValidationResult_VALID&&(Yn.internal=!0,Yn.ValidationResult_VALID=new mt,Yn.internal=!1),Yn.ValidationResult_VALID},mt.DEGENERATE=null,mt.get_DEGENERATE=function(){return null==Yn.ValidationResult_DEGENERATE&&(Yn.internal=!0,Yn.ValidationResult_DEGENERATE=new mt,Yn.internal=!1),Yn.ValidationResult_DEGENERATE},mt.CONCAVE=null,mt.get_CONCAVE=function(){return null==Yn.ValidationResult_CONCAVE&&(Yn.internal=!0,Yn.ValidationResult_CONCAVE=new mt,Yn.internal=!1),Yn.ValidationResult_CONCAVE},mt.SELF_INTERSECTING=null,mt.get_SELF_INTERSECTING=function(){return null==Yn.ValidationResult_SELF_INTERSECTING&&(Yn.internal=!0,Yn.ValidationResult_SELF_INTERSECTING=new mt,Yn.internal=!1),Yn.ValidationResult_SELF_INTERSECTING},mt.prototype.toString=function(){return null==Yn.ValidationResult_VALID&&(Yn.internal=!0,Yn.ValidationResult_VALID=new mt,Yn.internal=!1),this==Yn.ValidationResult_VALID?"VALID":(null==Yn.ValidationResult_DEGENERATE&&(Yn.internal=!0,Yn.ValidationResult_DEGENERATE=new mt,Yn.internal=!1),this==Yn.ValidationResult_DEGENERATE?"DEGENERATE":(null==Yn.ValidationResult_CONCAVE&&(Yn.internal=!0,Yn.ValidationResult_CONCAVE=new mt,Yn.internal=!1),this==Yn.ValidationResult_CONCAVE?"CONCAVE":(null==Yn.ValidationResult_SELF_INTERSECTING&&(Yn.internal=!0,Yn.ValidationResult_SELF_INTERSECTING=new mt,Yn.internal=!1),this==Yn.ValidationResult_SELF_INTERSECTING?"SELF_INTERSECTING":"")))},Object.defineProperty(mt,"VALID",{get:mt.get_VALID}),Object.defineProperty(mt,"DEGENERATE",{get:mt.get_DEGENERATE}),Object.defineProperty(mt,"CONCAVE",{get:mt.get_CONCAVE}),Object.defineProperty(mt,"SELF_INTERSECTING",{get:mt.get_SELF_INTERSECTING}),mt.prototype.__class__=mt;var xt=nape.space.Broadphase=function(){};xt.__name__=["nape","space","Broadphase"],xt.DYNAMIC_AABB_TREE=null,xt.get_DYNAMIC_AABB_TREE=function(){return null==Yn.Broadphase_DYNAMIC_AABB_TREE&&(Yn.internal=!0,Yn.Broadphase_DYNAMIC_AABB_TREE=new xt,Yn.internal=!1),Yn.Broadphase_DYNAMIC_AABB_TREE},xt.SWEEP_AND_PRUNE=null,xt.get_SWEEP_AND_PRUNE=function(){return null==Yn.Broadphase_SWEEP_AND_PRUNE&&(Yn.internal=!0,Yn.Broadphase_SWEEP_AND_PRUNE=new xt,Yn.internal=!1),Yn.Broadphase_SWEEP_AND_PRUNE},xt.prototype.toString=function(){return null==Yn.Broadphase_DYNAMIC_AABB_TREE&&(Yn.internal=!0,Yn.Broadphase_DYNAMIC_AABB_TREE=new xt,Yn.internal=!1),this==Yn.Broadphase_DYNAMIC_AABB_TREE?"DYNAMIC_AABB_TREE":(null==Yn.Broadphase_SWEEP_AND_PRUNE&&(Yn.internal=!0,Yn.Broadphase_SWEEP_AND_PRUNE=new xt,Yn.internal=!1),this==Yn.Broadphase_SWEEP_AND_PRUNE?"SWEEP_AND_PRUNE":"")},Object.defineProperty(xt,"DYNAMIC_AABB_TREE",{get:xt.get_DYNAMIC_AABB_TREE}),Object.defineProperty(xt,"SWEEP_AND_PRUNE",{get:xt.get_SWEEP_AND_PRUNE}),xt.prototype.__class__=xt,(y=nape.space.Space=function(t,e){this.zpp_inner=null,this.zpp_inner=new ii(null==t?null:t.zpp_inner,e),this.zpp_inner.outer=this,null!=t&&t.zpp_inner.weak&&(e=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ir.zpp_pool,Ir.zpp_pool=e)}).__name__=["nape","space","Space"],y.prototype.zpp_inner=null,y.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},y.prototype.get_gravity=function(){return null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity(),this.zpp_inner.wrap_gravity},y.prototype.set_gravity=function(t){null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity();var e=this.zpp_inner.wrap_gravity,i=t.zpp_inner;null!=i._validate&&i._validate();var n=t.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate();var s,i=t.zpp_inner.y,r=e.zpp_inner;return null!=r._validate&&r._validate(),e.zpp_inner.x==n&&(null!=(r=e.zpp_inner)._validate&&r._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=n,e.zpp_inner.y=i,null!=(s=e.zpp_inner)._invalidate&&s._invalidate(s)),t.zpp_inner.weak&&(s=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s),null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity(),this.zpp_inner.wrap_gravity},y.prototype.get_broadphase=function(){return this.zpp_inner.bphase.is_sweep?(null==Yn.Broadphase_SWEEP_AND_PRUNE&&(Yn.internal=!0,Yn.Broadphase_SWEEP_AND_PRUNE=new xt,Yn.internal=!1),Yn.Broadphase_SWEEP_AND_PRUNE):(null==Yn.Broadphase_DYNAMIC_AABB_TREE&&(Yn.internal=!0,Yn.Broadphase_DYNAMIC_AABB_TREE=new xt,Yn.internal=!1),Yn.Broadphase_DYNAMIC_AABB_TREE)},y.prototype.get_sortContacts=function(){return this.zpp_inner.sortcontacts},y.prototype.set_sortContacts=function(t){return this.zpp_inner.sortcontacts=t,this.zpp_inner.sortcontacts},y.prototype.get_worldAngularDrag=function(){return this.zpp_inner.global_ang_drag},y.prototype.set_worldAngularDrag=function(t){return this.zpp_inner.global_ang_drag=t,this.zpp_inner.global_ang_drag},y.prototype.get_worldLinearDrag=function(){return this.zpp_inner.global_lin_drag},y.prototype.set_worldLinearDrag=function(t){return this.zpp_inner.global_lin_drag=t,this.zpp_inner.global_lin_drag},y.prototype.get_compounds=function(){return this.zpp_inner.wrap_compounds},y.prototype.get_bodies=function(){return this.zpp_inner.wrap_bodies},y.prototype.get_liveBodies=function(){return this.zpp_inner.wrap_live},y.prototype.get_constraints=function(){return this.zpp_inner.wrap_constraints},y.prototype.get_liveConstraints=function(){return this.zpp_inner.wrap_livecon},y.prototype.visitBodies=function(t){var e=this.zpp_inner.wrap_bodies;e.zpp_inner.valmod();for(var i=$t.get(e);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=$t.zpp_pool,($t.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1,t(i.zpp_inner.at(i.zpp_i++))}e=this.zpp_inner.wrap_compounds;e.zpp_inner.valmod();for(var r=te.get(e);;){r.zpp_inner.zpp_inner.valmod();var s=r.zpp_inner;s.zpp_inner.valmod(),s.zpp_inner.zip_length&&(s.zpp_inner.zip_length=!1,s.zpp_inner.user_length=s.zpp_inner.inner.length);s=s.zpp_inner.user_length;if(r.zpp_critical=!0,!(r.zpp_i<s||(r.zpp_next=te.zpp_pool,(te.zpp_pool=r).zpp_inner=null,!1)))break;r.zpp_critical=!1,r.zpp_inner.at(r.zpp_i++).visitBodies(t)}},y.prototype.visitConstraints=function(t){var e=this.zpp_inner.wrap_constraints;e.zpp_inner.valmod();for(var i=Wt.get(e);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=Wt.zpp_pool,(Wt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1,t(i.zpp_inner.at(i.zpp_i++))}e=this.zpp_inner.wrap_compounds;e.zpp_inner.valmod();for(var r=te.get(e);;){r.zpp_inner.zpp_inner.valmod();var s=r.zpp_inner;s.zpp_inner.valmod(),s.zpp_inner.zip_length&&(s.zpp_inner.zip_length=!1,s.zpp_inner.user_length=s.zpp_inner.inner.length);s=s.zpp_inner.user_length;if(r.zpp_critical=!0,!(r.zpp_i<s||(r.zpp_next=te.zpp_pool,(te.zpp_pool=r).zpp_inner=null,!1)))break;r.zpp_critical=!1,r.zpp_inner.at(r.zpp_i++).visitConstraints(t)}},y.prototype.visitCompounds=function(t){var e=this.zpp_inner.wrap_compounds;e.zpp_inner.valmod();for(var i=te.get(e);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<n||(i.zpp_next=te.zpp_pool,(te.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);t(n),n.visitCompounds(t)}},y.prototype.get_world=function(){return this.zpp_inner.__static},y.prototype.get_arbiters=function(){var t;return null==this.zpp_inner.wrap_arbiters&&((t=new he).space=this.zpp_inner,this.zpp_inner.wrap_arbiters=t),this.zpp_inner.wrap_arbiters},y.prototype.get_listeners=function(){return this.zpp_inner.wrap_listeners},y.prototype.clear=function(){this.zpp_inner.clear()},y.prototype.step=function(t,e,i){null==i&&(i=10),null==e&&(e=10),this.zpp_inner.step(t,e,i)},y.prototype.get_timeStamp=function(){return this.zpp_inner.stamp},y.prototype.get_elapsedTime=function(){return this.zpp_inner.time},y.prototype.interactionType=function(t,e){if(1==(null!=t.zpp_inner.body?t.zpp_inner.body.outer:null).zpp_inner.type&&1==(null!=e.zpp_inner.body?e.zpp_inner.body.outer:null).zpp_inner.type)return null;if((null!=t.zpp_inner.body?t.zpp_inner.body.outer:null)==(null!=e.zpp_inner.body?e.zpp_inner.body.outer:null))return null;for(var i,n,r,t=t.zpp_inner,e=e.zpp_inner,s=t.body,o=e.body,a=!1,l=s.constraints.head;null!=l;){var p=l.elt;if(p.ignore&&p.pair_exists(s.id,o.id)){a=!0;break}l=l.next}if(a)i=!1;else{for(var h=t;null!=h&&null==h.group;)h=null!=h.ishape?h.ishape.body:(null!=h.icompound?h.icompound:h.ibody).compound;var u,c=null==h?null:h.group;if(null==c)u=!1;else{for(var d=e;null!=d&&null==d.group;)d=null!=d.ishape?d.ishape.body:(null!=d.icompound?d.icompound:d.ibody).compound;var _=null==d?null:d.group;if(null==_)u=!1;else{for(var y=!1;null!=c&&null!=_;){if(c==_){y=c.ignore;break}c.depth<_.depth?_=_.group:c=c.group}u=y}}i=!u}switch(i?!(!t.sensorEnabled&&!e.sensorEnabled)&&(r=t.filter,n=e.filter,0!=(r.sensorMask&n.sensorGroup)&&0!=(n.sensorMask&r.sensorGroup))?2:!!(!(!t.fluidEnabled&&!e.fluidEnabled)&&(n=t.filter,r=e.filter,0!=(n.fluidMask&r.fluidGroup)&&0!=(r.fluidMask&n.fluidGroup)))&&!(0==s.imass&&0==o.imass&&0==s.iinertia&&0==o.iinertia)?0:(t=t.filter,e=e.filter,0!=(t.collisionMask&e.collisionGroup)&&0!=(e.collisionMask&t.collisionGroup)&&!(0==s.imass&&0==o.imass&&0==s.iinertia&&0==o.iinertia)?1:-1):-1){case 0:return null==Yn.InteractionType_FLUID&&(Yn.internal=!0,Yn.InteractionType_FLUID=new f,Yn.internal=!1),Yn.InteractionType_FLUID;case 1:return null==Yn.InteractionType_COLLISION&&(Yn.internal=!0,Yn.InteractionType_COLLISION=new f,Yn.internal=!1),Yn.InteractionType_COLLISION;case 2:return null==Yn.InteractionType_SENSOR&&(Yn.internal=!0,Yn.InteractionType_SENSOR=new f,Yn.internal=!1),Yn.InteractionType_SENSOR;default:return null}},y.prototype.shapesUnderPoint=function(t,e,i){var n=t.zpp_inner;null!=n._validate&&n._validate();var r=t.zpp_inner.x,n=t.zpp_inner;null!=n._validate&&n._validate();e=this.zpp_inner.shapesUnderPoint(r,t.zpp_inner.y,null==e?null:e.zpp_inner,i);return t.zpp_inner.weak&&(i=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ir.zpp_pool,Ir.zpp_pool=i),e},y.prototype.bodiesUnderPoint=function(t,e,i){var n=t.zpp_inner;null!=n._validate&&n._validate();var r=t.zpp_inner.x,n=t.zpp_inner;null!=n._validate&&n._validate();e=this.zpp_inner.bodiesUnderPoint(r,t.zpp_inner.y,null==e?null:e.zpp_inner,i);return t.zpp_inner.weak&&(i=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ir.zpp_pool,Ir.zpp_pool=i),e},y.prototype.shapesInAABB=function(t,e,i,n,r){return null==i&&(i=!0),null==e&&(e=!1),this.zpp_inner.shapesInAABB(t,i,e,null==n?null:n.zpp_inner,r)},y.prototype.bodiesInAABB=function(t,e,i,n,r){return null==i&&(i=!0),null==e&&(e=!1),this.zpp_inner.bodiesInAABB(t,i,e,null==n?null:n.zpp_inner,r)},y.prototype.shapesInCircle=function(t,e,i,n,r){null==i&&(i=!1);n=this.zpp_inner.shapesInCircle(t,e,i,null==n?null:n.zpp_inner,r);return t.zpp_inner.weak&&(r=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Ir.zpp_pool,Ir.zpp_pool=r),n},y.prototype.bodiesInCircle=function(t,e,i,n,r){null==i&&(i=!1);n=this.zpp_inner.bodiesInCircle(t,e,i,null==n?null:n.zpp_inner,r);return t.zpp_inner.weak&&(r=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Ir.zpp_pool,Ir.zpp_pool=r),n},y.prototype.shapesInShape=function(t,e,i,n){return null==e&&(e=!1),this.zpp_inner.shapesInShape(t.zpp_inner,e,null==i?null:i.zpp_inner,n)},y.prototype.bodiesInShape=function(t,e,i,n){return null==e&&(e=!1),this.zpp_inner.bodiesInShape(t.zpp_inner,e,null==i?null:i.zpp_inner,n)},y.prototype.shapesInBody=function(t,e,i){var n=null==i?new yt:i,t=t.zpp_inner.wrap_shapes;t.zpp_inner.valmod();for(var r=ne.get(t);;){r.zpp_inner.zpp_inner.valmod();var s=r.zpp_inner;s.zpp_inner.valmod(),s.zpp_inner.zip_length&&(s.zpp_inner.zip_length=!1,s.zpp_inner.user_length=s.zpp_inner.inner.length);s=s.zpp_inner.user_length;if(r.zpp_critical=!0,!(r.zpp_i<s||(r.zpp_next=ne.zpp_pool,(ne.zpp_pool=r).zpp_inner=null,!1)))break;r.zpp_critical=!1,this.shapesInShape(r.zpp_inner.at(r.zpp_i++),!1,e,n)}return n},y.prototype.bodiesInBody=function(t,e,i){var n=null==i?new tt:i,t=t.zpp_inner.wrap_shapes;t.zpp_inner.valmod();for(var r=ne.get(t);;){r.zpp_inner.zpp_inner.valmod();var s=r.zpp_inner;s.zpp_inner.valmod(),s.zpp_inner.zip_length&&(s.zpp_inner.zip_length=!1,s.zpp_inner.user_length=s.zpp_inner.inner.length);s=s.zpp_inner.user_length;if(r.zpp_critical=!0,!(r.zpp_i<s||(r.zpp_next=ne.zpp_pool,(ne.zpp_pool=r).zpp_inner=null,!1)))break;r.zpp_critical=!1,this.bodiesInShape(r.zpp_inner.at(r.zpp_i++),!1,e,n)}return n},y.prototype.convexCast=function(t,e,i,n){return null==i&&(i=!1),this.zpp_inner.convexCast(t.zpp_inner,e,n,i)},y.prototype.convexMultiCast=function(t,e,i,n,r){return null==i&&(i=!1),this.zpp_inner.convexMultiCast(t.zpp_inner,e,n,i,r)},y.prototype.rayCast=function(t,e,i){return null==e&&(e=!1),this.zpp_inner.rayCast(t,e,i)},y.prototype.rayMultiCast=function(t,e,i,n){return null==e&&(e=!1),this.zpp_inner.rayMultiCast(t,e,i,n)},Object.defineProperty(y.prototype,"userData",{get:y.prototype.get_userData}),Object.defineProperty(y.prototype,"gravity",{get:y.prototype.get_gravity,set:y.prototype.set_gravity}),Object.defineProperty(y.prototype,"broadphase",{get:y.prototype.get_broadphase}),Object.defineProperty(y.prototype,"sortContacts",{get:y.prototype.get_sortContacts,set:y.prototype.set_sortContacts}),Object.defineProperty(y.prototype,"worldAngularDrag",{get:y.prototype.get_worldAngularDrag,set:y.prototype.set_worldAngularDrag}),Object.defineProperty(y.prototype,"worldLinearDrag",{get:y.prototype.get_worldLinearDrag,set:y.prototype.set_worldLinearDrag}),Object.defineProperty(y.prototype,"compounds",{get:y.prototype.get_compounds}),Object.defineProperty(y.prototype,"bodies",{get:y.prototype.get_bodies}),Object.defineProperty(y.prototype,"liveBodies",{get:y.prototype.get_liveBodies}),Object.defineProperty(y.prototype,"constraints",{get:y.prototype.get_constraints}),Object.defineProperty(y.prototype,"liveConstraints",{get:y.prototype.get_liveConstraints}),Object.defineProperty(y.prototype,"world",{get:y.prototype.get_world}),Object.defineProperty(y.prototype,"arbiters",{get:y.prototype.get_arbiters}),Object.defineProperty(y.prototype,"listeners",{get:y.prototype.get_listeners}),Object.defineProperty(y.prototype,"timeStamp",{get:y.prototype.get_timeStamp}),Object.defineProperty(y.prototype,"elapsedTime",{get:y.prototype.get_elapsedTime}),y.prototype.__class__=y,(s=nape.util.Debug=function(){}).__name__=["nape","util","Debug"],s.version=function(){return"Nape 2.0.19"},s.clearObjectPools=function(){for(;null!=Wt.zpp_pool;){var t=Wt.zpp_pool.zpp_next;Wt.zpp_pool.zpp_next=null,Wt.zpp_pool=t}for(;null!=ee.zpp_pool;){var e=ee.zpp_pool.zpp_next;ee.zpp_pool.zpp_next=null,ee.zpp_pool=e}for(;null!=$t.zpp_pool;){var i=$t.zpp_pool.zpp_next;$t.zpp_pool.zpp_next=null,$t.zpp_pool=i}for(;null!=te.zpp_pool;){var n=te.zpp_pool.zpp_next;te.zpp_pool.zpp_next=null,te.zpp_pool=n}for(;null!=Vt.zpp_pool;){var r=Vt.zpp_pool.zpp_next;Vt.zpp_pool.zpp_next=null,Vt.zpp_pool=r}for(;null!=Xt.zpp_pool;){var s=Xt.zpp_pool.zpp_next;Xt.zpp_pool.zpp_next=null,Xt.zpp_pool=s}for(;null!=Kt.zpp_pool;){var o=Kt.zpp_pool.zpp_next;Kt.zpp_pool.zpp_next=null,Kt.zpp_pool=o}for(;null!=Zt.zpp_pool;){var a=Zt.zpp_pool.zpp_next;Zt.zpp_pool.zpp_next=null,Zt.zpp_pool=a}for(;null!=Qt.zpp_pool;){var l=Qt.zpp_pool.zpp_next;Qt.zpp_pool.zpp_next=null,Qt.zpp_pool=l}for(;null!=Jt.zpp_pool;){var p=Jt.zpp_pool.zpp_next;Jt.zpp_pool.zpp_next=null,Jt.zpp_pool=p}for(;null!=ne.zpp_pool;){var h=ne.zpp_pool.zpp_next;ne.zpp_pool.zpp_next=null,ne.zpp_pool=h}for(;null!=ie.zpp_pool;){var u=ie.zpp_pool.zpp_next;ie.zpp_pool.zpp_next=null,ie.zpp_pool=u}for(;null!=qt.zpp_pool;){var c=qt.zpp_pool.zpp_next;qt.zpp_pool.zpp_next=null,qt.zpp_pool=c}for(;null!=Ht.zpp_pool;){var d=Ht.zpp_pool.zpp_next;Ht.zpp_pool.zpp_next=null,Ht.zpp_pool=d}for(;null!=Yt.zpp_pool;){var _=Yt.zpp_pool.zpp_next;Yt.zpp_pool.zpp_next=null,Yt.zpp_pool=_}for(;null!=Ui.zpp_pool;){var y=Ui.zpp_pool.next;Ui.zpp_pool.next=null,Ui.zpp_pool=y}for(;null!=Xi.zpp_pool;){var f=Xi.zpp_pool.next;Xi.zpp_pool.next=null,Xi.zpp_pool=f}for(;null!=Ue.zpp_pool;){var m=Ue.zpp_pool.next;Ue.zpp_pool.next=null,Ue.zpp_pool=m}for(;null!=Vi.zpp_pool;){var x=Vi.zpp_pool.next;Vi.zpp_pool.next=null,Vi.zpp_pool=x}for(;null!=Ge.zpp_pool;){var v=Ge.zpp_pool.next;Ge.zpp_pool.next=null,Ge.zpp_pool=v}for(;null!=Wi.zpp_pool;){var g=Wi.zpp_pool.next;Wi.zpp_pool.next=null,Wi.zpp_pool=g}for(;null!=Hi.zpp_pool;){var b=Hi.zpp_pool.next;Hi.zpp_pool.next=null,Hi.zpp_pool=b}for(;null!=qi.zpp_pool;){var z=qi.zpp_pool.next;qi.zpp_pool.next=null,qi.zpp_pool=z}for(;null!=er.zpp_pool;){var w=er.zpp_pool.next;er.zpp_pool.next=null,er.zpp_pool=w}for(;null!=Fn.zpp_pool;){var C=Fn.zpp_pool.next;Fn.zpp_pool.next=null,Fn.zpp_pool=C}for(;null!=qn.zpp_pool;){var P=qn.zpp_pool.next;qn.zpp_pool.next=null,qn.zpp_pool=P}for(;null!=ir.zpp_pool;){var T=ir.zpp_pool.next;ir.zpp_pool.next=null,ir.zpp_pool=T}for(;null!=Yi.zpp_pool;){var S=Yi.zpp_pool.next;Yi.zpp_pool.next=null,Yi.zpp_pool=S}for(;null!=nr.zpp_pool;){var M=nr.zpp_pool.next;nr.zpp_pool.next=null,nr.zpp_pool=M}for(;null!=Ki.zpp_pool;){var A=Ki.zpp_pool.next;Ki.zpp_pool.next=null,Ki.zpp_pool=A}for(;null!=re.zpp_pool;){var O=re.zpp_pool.next;re.zpp_pool.next=null,re.zpp_pool=O}for(;null!=Hn.zpp_pool;){var k=Hn.zpp_pool.next;Hn.zpp_pool.next=null,Hn.zpp_pool=k}for(;null!=Zi.zpp_pool;){var E=Zi.zpp_pool.next;Zi.zpp_pool.next=null,Zi.zpp_pool=E}for(;null!=Ji.zpp_pool;){var I=Ji.zpp_pool.next;Ji.zpp_pool.next=null,Ji.zpp_pool=I}for(;null!=nn.zpp_pool;){var D=nn.zpp_pool.next;nn.zpp_pool.next=null,nn.zpp_pool=D}for(;null!=fe.zpp_pool;){var B=fe.zpp_pool.next;fe.zpp_pool.next=null,fe.zpp_pool=B}for(;null!=xe.zpp_pool;){var L=xe.zpp_pool.next;xe.zpp_pool.next=null,xe.zpp_pool=L}for(;null!=jn.zpp_pool;){var R=jn.zpp_pool.next;jn.zpp_pool.next=null,jn.zpp_pool=R}for(;null!=_i.zpp_pool;){var F=_i.zpp_pool.next;_i.zpp_pool.next=null,_i.zpp_pool=F}for(;null!=yi.zpp_pool;){var j=yi.zpp_pool.next;yi.zpp_pool.next=null,yi.zpp_pool=j}for(;null!=Qi.zpp_pool;){var N=Qi.zpp_pool.next;Qi.zpp_pool.next=null,Qi.zpp_pool=N}for(;null!=$i.zpp_pool;){var G=$i.zpp_pool.next;$i.zpp_pool.next=null,$i.zpp_pool=G}for(;null!=Ir.zpp_pool;){var U=Ir.zpp_pool.next;Ir.zpp_pool.next=null,Ir.zpp_pool=U}for(;null!=tn.zpp_pool;){var X=tn.zpp_pool.next;tn.zpp_pool.next=null,tn.zpp_pool=X}for(;null!=be.zpp_pool;){var V=be.zpp_pool.next;be.zpp_pool.next=null,be.zpp_pool=V}for(;null!=Nn.zpp_pool;){var W=Nn.zpp_pool.next;Nn.zpp_pool.next=null,Nn.zpp_pool=W}for(;null!=Ae.zpp_pool;){var H=Ae.zpp_pool.next;Ae.zpp_pool.next=null,Ae.zpp_pool=H}for(;null!=Oe.zpp_pool;){var q=Oe.zpp_pool.next;Oe.zpp_pool.next=null,Oe.zpp_pool=q}for(;null!=ze.zpp_pool;){var Y=ze.zpp_pool.next;ze.zpp_pool.next=null,ze.zpp_pool=Y}for(;null!=en.zpp_pool;){var K=en.zpp_pool.next;en.zpp_pool.next=null,en.zpp_pool=K}for(;null!=on.zpp_pool;){var Z=on.zpp_pool.next;on.zpp_pool.next=null,on.zpp_pool=Z}for(;null!=De.zpp_pool;){var J=De.zpp_pool.next;De.zpp_pool.next=null,De.zpp_pool=J}for(;null!=Gn.zpp_pool;){var Q=Gn.zpp_pool.next;Gn.zpp_pool.next=null,Gn.zpp_pool=Q}for(;null!=an.zpp_pool;){var $=an.zpp_pool.next;an.zpp_pool.next=null,an.zpp_pool=$}for(;null!=Be.zpp_pool;){var tt=Be.zpp_pool.next;Be.zpp_pool.next=null,Be.zpp_pool=tt}for(;null!=Un.zpp_pool;){var et=Un.zpp_pool.next;Un.zpp_pool.next=null,Un.zpp_pool=et}for(;null!=Ce.zpp_pool;){var it=Ce.zpp_pool.next;Ce.zpp_pool.next=null,Ce.zpp_pool=it}for(;null!=Pe.zpp_pool;){var nt=Pe.zpp_pool.next;Pe.zpp_pool.next=null,Pe.zpp_pool=nt}for(;null!=Xn.zpp_pool;){var rt=Xn.zpp_pool.next;Xn.zpp_pool.next=null,Xn.zpp_pool=rt}for(;null!=Vn.zpp_pool;){var st=Vn.zpp_pool.next;Vn.zpp_pool.next=null,Vn.zpp_pool=st}for(;null!=Te.zpp_pool;){var ot=Te.zpp_pool.next;Te.zpp_pool.next=null,Te.zpp_pool=ot}for(;null!=li.zpp_pool;){var at=li.zpp_pool.next;li.zpp_pool.next=null,li.zpp_pool=at}for(;null!=Ee.zpp_pool;){var lt=Ee.zpp_pool.next;Ee.zpp_pool.next=null,Ee.zpp_pool=lt}for(;null!=ln.zpp_pool;){var pt=ln.zpp_pool.next;ln.zpp_pool.next=null,ln.zpp_pool=pt}for(;null!=pn.zpp_pool;){var ht=pn.zpp_pool.next;pn.zpp_pool.next=null,pn.zpp_pool=ht}for(;null!=me.zpp_pool;){var ut=me.zpp_pool.next;me.zpp_pool.next=null,me.zpp_pool=ut}for(;null!=rn.zpp_pool;){var ct=rn.zpp_pool.next;rn.zpp_pool.next=null,rn.zpp_pool=ct}for(;null!=hn.zpp_pool;){var dt=hn.zpp_pool.next;hn.zpp_pool.next=null,hn.zpp_pool=dt}for(;null!=We.zpp_pool;){var _t=We.zpp_pool.next;We.zpp_pool.next=null,We.zpp_pool=_t}for(;null!=un.zpp_pool;){var yt=un.zpp_pool.next;un.zpp_pool.next=null,un.zpp_pool=yt}for(;null!=cn.zpp_pool;){var ft=cn.zpp_pool.next;cn.zpp_pool.next=null,cn.zpp_pool=ft}for(;null!=ni.zpp_pool;){var mt=ni.zpp_pool.next;ni.zpp_pool.next=null,ni.zpp_pool=mt}for(;null!=Ye.zpp_pool;){var xt=Ye.zpp_pool.next;Ye.zpp_pool.next=null,Ye.zpp_pool=xt}for(;null!=Ke.zpp_pool;){var vt=Ke.zpp_pool.next;Ke.zpp_pool.next=null,Ke.zpp_pool=vt}for(;null!=dn.zpp_pool;){var gt=dn.zpp_pool.next;dn.zpp_pool.next=null,dn.zpp_pool=gt}for(;null!=Qn.zpp_pool;){var bt=Qn.zpp_pool.next;Qn.zpp_pool.next=null,Qn.zpp_pool=bt}for(;null!=_n.zpp_pool;){var zt=_n.zpp_pool.next;_n.zpp_pool.next=null,_n.zpp_pool=zt}for(;null!=$e.zpp_pool;){var wt=$e.zpp_pool.next;$e.zpp_pool.next=null,$e.zpp_pool=wt}for(;null!=ti.zpp_pool;){var Ct=ti.zpp_pool.next;ti.zpp_pool.next=null,ti.zpp_pool=Ct}for(;null!=tr.zpp_pool;){var Pt=tr.zpp_pool.next;tr.zpp_pool.next=null,tr.zpp_pool=Pt}for(;null!=Kn.zpp_pool;){var Tt=Kn.zpp_pool.next;Kn.zpp_pool.next=null,Kn.zpp_pool=Tt}for(;null!=Zn.zpp_pool;){var St=Zn.zpp_pool.next;Zn.zpp_pool.next=null,Zn.zpp_pool=St}for(;null!=ar.zpp_pool;){var Mt=ar.zpp_pool.next;ar.zpp_pool.next=null,ar.zpp_pool=Mt}for(;null!=rr.zpp_pool;){var At=rr.zpp_pool.next;rr.zpp_pool.next=null,rr.zpp_pool=At}for(;null!=Jn.zpp_pool;){var Ot=Jn.zpp_pool.next;Jn.zpp_pool.next=null,Jn.zpp_pool=Ot}for(;null!=sr.zpp_pool;){var kt=sr.zpp_pool.next;sr.zpp_pool.next=null,sr.zpp_pool=kt}for(;null!=yn.zpp_pool;){var Et=yn.zpp_pool.next;yn.zpp_pool.next=null,yn.zpp_pool=Et}for(;null!=or.zpp_pool;){var It=or.zpp_pool.next;or.zpp_pool.next=null,or.zpp_pool=It}for(;null!=fn.zpp_pool;){var Dt=fn.zpp_pool.next;fn.zpp_pool.next=null,fn.zpp_pool=Dt}for(;null!=mn.zpp_pool;){var Bt=mn.zpp_pool.next;mn.zpp_pool.next=null,mn.zpp_pool=Bt}for(;null!=le.zpp_pool;){var Lt=le.zpp_pool.next;le.zpp_pool.next=null,le.zpp_pool=Lt}for(;null!=xn.zpp_pool;){var Rt=xn.zpp_pool.next;xn.zpp_pool.next=null,xn.zpp_pool=Rt}for(;null!=vn.zpp_pool;){var Ft=vn.zpp_pool.next;vn.zpp_pool.next=null,vn.zpp_pool=Ft}for(;null!=gn.zpp_pool;){var jt=gn.zpp_pool.next;gn.zpp_pool.next=null,gn.zpp_pool=jt}for(;null!=Rn.poolGeomPoly;){var Nt=Rn.poolGeomPoly.zpp_pool;Rn.poolGeomPoly.zpp_pool=null,Rn.poolGeomPoly=Nt}for(;null!=Rn.poolVec2;){var Gt=Rn.poolVec2.zpp_pool;Rn.poolVec2.zpp_pool=null,Rn.poolVec2=Gt}for(;null!=Rn.poolVec3;){var Ut=Rn.poolVec3.zpp_pool;Rn.poolVec3.zpp_pool=null,Rn.poolVec3=Ut}},s.prototype.__class__=s,(d=sandbox.Main=function(){}).__name__=["sandbox","Main"],d.main=function(){},d.prototype.__class__=d,(y=zpp_nape.ZPP_Const=function(){}).__name__=["zpp_nape","ZPP_Const"],y.POSINF=function(){return 1/0},y.NEGINF=function(){return-1/0},y.prototype.__class__=y;var vt=zpp_nape.ZPP_ID=function(){};vt.__name__=["zpp_nape","ZPP_ID"],vt.Constraint=function(){return vt._Constraint++},vt.Interactor=function(){return vt._Interactor++},vt.CbType=function(){return vt._CbType++},vt.CbSet=function(){return vt._CbSet++},vt.Listener=function(){return vt._Listener++},vt.ZPP_SimpleVert=function(){return vt._ZPP_SimpleVert++},vt.ZPP_SimpleSeg=function(){return vt._ZPP_SimpleSeg++},vt.Space=function(){return vt._Space++},vt.InteractionGroup=function(){return vt._InteractionGroup++},vt.prototype.__class__=vt;var re=zpp_nape.callbacks.ZPP_Callback=function(){this.constraint=null,this.body=null,this.pre_swapped=!1,this.pre_arbiter=null,this.wrap_arbiters=null,this.set=null,this.int2=null,this.int1=null,this.length=0,this.prev=null,this.next=null,this.index=0,this.space=null,this.listener=null,this.event=0,this.outer_int=null,this.outer_con=null,this.outer_body=null,this.length=0};re.__name__=["zpp_nape","callbacks","ZPP_Callback"],re.prototype.outer_body=null,re.prototype.outer_con=null,re.prototype.outer_int=null,re.prototype.wrapper_body=function(){return null==this.outer_body&&(this.outer_body=new i,this.outer_body.zpp_inner=this),this.outer_body},re.prototype.wrapper_con=function(){return null==this.outer_con&&(this.outer_con=new o,this.outer_con.zpp_inner=this),this.outer_con},re.prototype.wrapper_int=function(){return null==this.outer_int&&(this.outer_int=new _,this.outer_int.zpp_inner=this),null==this.wrap_arbiters?this.wrap_arbiters=Bn.get(this.set.arbiters,!0):this.wrap_arbiters.zpp_inner.inner=this.set.arbiters,this.wrap_arbiters.zpp_inner.zip_length=!0,this.wrap_arbiters.zpp_inner.at_ite=null,this.outer_int},re.prototype.event=null,re.prototype.listener=null,re.prototype.space=null,re.prototype.index=null,re.prototype.next=null,re.prototype.prev=null,re.prototype.length=null,re.prototype.push=function(t){null!=this.prev?this.prev.next=t:this.next=t,t.prev=this.prev,t.next=null,this.prev=t,this.length++},re.prototype.push_rev=function(t){null!=this.next?this.next.prev=t:this.prev=t,t.next=this.next,t.prev=null,this.next=t,this.length++},re.prototype.pop=function(){var t=this.next;return this.next=t.next,null==this.next?this.prev=null:this.next.prev=null,this.length--,t},re.prototype.pop_rev=function(){var t=this.prev;return this.prev=t.prev,null==this.prev?this.next=null:this.prev.next=null,this.length--,t},re.prototype.empty=function(){return null==this.next},re.prototype.clear=function(){for(;!this.empty();)this.pop()},re.prototype.splice=function(t){var e=t.next;return null==t.prev?(this.next=t.next,null!=this.next?this.next.prev=null:this.prev=null):(t.prev.next=t.next,null!=t.next?t.next.prev=t.prev:this.prev=t.prev),this.length--,e},re.prototype.rotateL=function(){this.push(this.pop())},re.prototype.rotateR=function(){this.push_rev(this.pop_rev())},re.prototype.cycleNext=function(t){return(null==t.next?this:t).next},re.prototype.cyclePrev=function(t){return(null==t.prev?this:t).prev},re.prototype.at=function(t){for(var e=this.next;0!=t--;)e=e.next;return e},re.prototype.rev_at=function(t){for(var e=this.prev;0!=t--;)e=e.prev;return e},re.prototype.free=function(){this.int1=this.int2=null,this.body=null,this.constraint=null,(this.listener=null)!=this.wrap_arbiters&&(this.wrap_arbiters.zpp_inner.inner=null),this.set=null},re.prototype.alloc=function(){},re.prototype.int1=null,re.prototype.int2=null,re.prototype.set=null,re.prototype.wrap_arbiters=null,re.prototype.pre_arbiter=null,re.prototype.pre_swapped=null,re.prototype.genarbs=function(){null==this.wrap_arbiters?this.wrap_arbiters=Bn.get(this.set.arbiters,!0):this.wrap_arbiters.zpp_inner.inner=this.set.arbiters,this.wrap_arbiters.zpp_inner.zip_length=!0,this.wrap_arbiters.zpp_inner.at_ite=null},re.prototype.body=null,re.prototype.constraint=null,re.prototype.__class__=re;var Hn=zpp_nape.callbacks.ZPP_CbSet=function(){this.wrap_constraints=null,this.constraints=null,this.wrap_interactors=null,this.interactors=null,this.zip_conlisteners=!1,this.conlisteners=null,this.zip_bodylisteners=!1,this.bodylisteners=null,this.zip_listeners=!1,this.listeners=null,this.cbpairs=null,this.manager=null,this.id=0,this.next=null,this.count=0,this.cbTypes=null,this.cbTypes=new Et,this.listeners=new gt,this.zip_listeners=!0,this.bodylisteners=new bt,this.zip_bodylisteners=!0,this.conlisteners=new zt,this.zip_conlisteners=!0,this.constraints=new Pt,this.interactors=new Tt,this.id=vt.CbSet(),this.cbpairs=new gi};Hn.__name__=["zpp_nape","callbacks","ZPP_CbSet"],Hn.setlt=function(t,e){for(var i=t.cbTypes.head,n=e.cbTypes.head;null!=i&&null!=n;){var r=i.elt,s=n.elt;if(r.id<s.id)return!0;if(s.id<r.id)return!1;i=i.next,n=n.next}return null!=n&&null==i},Hn.get=function(t){var e;null==Hn.zpp_pool?e=new Hn:(e=Hn.zpp_pool,Hn.zpp_pool=e.next,e.next=null);for(var i=null,n=t.head;null!=n;){var r=n.elt,i=e.cbTypes.insert(i,r);r.cbsets.add(e),n=n.next}return e},Hn.compatible=function(t,e,i){var n=t.options1,r=e.cbTypes;if(!(!n.nonemptyintersection(r,n.includes)||n.nonemptyintersection(r,n.excludes))&&(s=t.options2,n=i.cbTypes,!!s.nonemptyintersection(n,s.includes)&&!s.nonemptyintersection(n,s.excludes)))return!0;var s=t.options2,e=e.cbTypes;if(!s.nonemptyintersection(e,s.includes)||s.nonemptyintersection(e,s.excludes))return!1;t=t.options1,i=i.cbTypes;return!!t.nonemptyintersection(i,t.includes)&&!t.nonemptyintersection(i,t.excludes)},Hn.empty_intersection=function(t,e){for(var i,n=null,r=(t.cbpairs.length<e.cbpairs.length?t:e).cbpairs.head;null!=r;){var s=r.elt;if(s.a==t&&s.b==e||s.a==e&&s.b==t){n=s;break}r=r.next}return null==n&&(null==qn.zpp_pool?i=new qn:(i=qn.zpp_pool,qn.zpp_pool=i.next,i.next=null),i.zip_listeners=!0,Hn.setlt(t,e)?(i.a=t,i.b=e):(i.a=e,i.b=t),n=i,t.cbpairs.add(n),e!=t&&e.cbpairs.add(n)),n.zip_listeners&&(n.zip_listeners=!1,n.__validate()),null==n.listeners.head},Hn.single_intersection=function(t,e,i){for(var n=null,r=(t.cbpairs.length<e.cbpairs.length?t:e).cbpairs.head;null!=r;){var s=r.elt;if(s.a==t&&s.b==e||s.a==e&&s.b==t){n=s;break}r=r.next}null==n&&(null==qn.zpp_pool?o=new qn:(o=qn.zpp_pool,qn.zpp_pool=o.next,o.next=null),o.zip_listeners=!0,Hn.setlt(t,e)?(o.a=t,o.b=e):(o.a=e,o.b=t),n=o,t.cbpairs.add(n),e!=t&&e.cbpairs.add(n)),n.zip_listeners&&(n.zip_listeners=!1,n.__validate());var o=n.listeners.head;return null!=o&&o.elt==i&&null==o.next},Hn.find_all=function(t,e,i,n){for(var r,s=null,o=(t.cbpairs.length<e.cbpairs.length?t:e).cbpairs.head;null!=o;){var a=o.elt;if(a.a==t&&a.b==e||a.a==e&&a.b==t){s=a;break}o=o.next}null==s&&(null==qn.zpp_pool?r=new qn:(r=qn.zpp_pool,qn.zpp_pool=r.next,r.next=null),r.zip_listeners=!0,Hn.setlt(t,e)?(r.a=t,r.b=e):(r.a=e,r.b=t),s=r,t.cbpairs.add(s),e!=t&&e.cbpairs.add(s)),s.zip_listeners&&(s.zip_listeners=!1,s.__validate());for(var l=s.listeners.head;null!=l;){var p=l.elt;p.event==i&&n(p),l=l.next}},Hn.prototype.cbTypes=null,Hn.prototype.count=null,Hn.prototype.next=null,Hn.prototype.id=null,Hn.prototype.manager=null,Hn.prototype.cbpairs=null,Hn.prototype.increment=function(){this.count++},Hn.prototype.decrement=function(){return 0==--this.count},Hn.prototype.invalidate_pairs=function(){for(var t=this.cbpairs.head;null!=t;)t.elt.zip_listeners=!0,t=t.next},Hn.prototype.listeners=null,Hn.prototype.zip_listeners=null,Hn.prototype.invalidate_listeners=function(){this.zip_listeners=!0,this.invalidate_pairs()},Hn.prototype.validate_listeners=function(){this.zip_listeners&&(this.zip_listeners=!1,this.realvalidate_listeners())},Hn.prototype.realvalidate_listeners=function(){this.listeners.clear();for(var t=this.cbTypes.head;null!=t;){for(var e=null,i=this.listeners.head,n=t.elt.listeners.head;null!=n;){var r,s,o=n.elt;null!=i&&i.elt==o?(n=n.next,i=(e=i).next):null==i||(r=i.elt,!(o.precedence<=r.precedence)||o.precedence==r.precedence&&o.id>r.id)?(o.space==this.manager.space&&(r=this.listeners,null==ir.zpp_pool?s=new ir:(s=ir.zpp_pool,ir.zpp_pool=s.next,s.next=null),s.elt=o,o=s,null==e?(o.next=r.head,r.head=o):(o.next=e.next,e.next=o),r.pushmod=r.modified=!0,r.length++,e=o),n=n.next):i=(e=i).next}t=t.next}},Hn.prototype.bodylisteners=null,Hn.prototype.zip_bodylisteners=null,Hn.prototype.invalidate_bodylisteners=function(){this.zip_bodylisteners=!0},Hn.prototype.validate_bodylisteners=function(){this.zip_bodylisteners&&(this.zip_bodylisteners=!1,this.realvalidate_bodylisteners())},Hn.prototype.realvalidate_bodylisteners=function(){this.bodylisteners.clear();for(var t=this.cbTypes.head;null!=t;){for(var e=null,i=this.bodylisteners.head,n=t.elt.bodylisteners.head;null!=n;){var r,s,o=n.elt;null!=i&&i.elt==o?(n=n.next,i=(e=i).next):null==i||(r=i.elt,!(o.precedence<=r.precedence)||o.precedence==r.precedence&&o.id>r.id)?(!(r=o.options).nonemptyintersection(this.cbTypes,r.excludes)&&o.space==this.manager.space&&(r=this.bodylisteners,null==Ki.zpp_pool?s=new Ki:(s=Ki.zpp_pool,Ki.zpp_pool=s.next,s.next=null),s.elt=o,o=s,null==e?(o.next=r.head,r.head=o):(o.next=e.next,e.next=o),r.pushmod=r.modified=!0,r.length++,e=o),n=n.next):i=(e=i).next}t=t.next}},Hn.prototype.conlisteners=null,Hn.prototype.zip_conlisteners=null,Hn.prototype.invalidate_conlisteners=function(){this.zip_conlisteners=!0},Hn.prototype.validate_conlisteners=function(){this.zip_conlisteners&&(this.zip_conlisteners=!1,this.realvalidate_conlisteners())},Hn.prototype.realvalidate_conlisteners=function(){this.conlisteners.clear();for(var t=this.cbTypes.head;null!=t;){for(var e=null,i=this.conlisteners.head,n=t.elt.conlisteners.head;null!=n;){var r,s,o=n.elt;null!=i&&i.elt==o?(n=n.next,i=(e=i).next):null==i||(r=i.elt,!(o.precedence<=r.precedence)||o.precedence==r.precedence&&o.id>r.id)?(!(r=o.options).nonemptyintersection(this.cbTypes,r.excludes)&&o.space==this.manager.space&&(r=this.conlisteners,null==Ji.zpp_pool?s=new Ji:(s=Ji.zpp_pool,Ji.zpp_pool=s.next,s.next=null),s.elt=o,o=s,null==e?(o.next=r.head,r.head=o):(o.next=e.next,e.next=o),r.pushmod=r.modified=!0,r.length++,e=o),n=n.next):i=(e=i).next}t=t.next}},Hn.prototype.validate=function(){this.zip_listeners&&(this.zip_listeners=!1,this.realvalidate_listeners()),this.zip_bodylisteners&&(this.zip_bodylisteners=!1,this.realvalidate_bodylisteners()),this.zip_conlisteners&&(this.zip_conlisteners=!1,this.realvalidate_conlisteners())},Hn.prototype.interactors=null,Hn.prototype.wrap_interactors=null,Hn.prototype.constraints=null,Hn.prototype.wrap_constraints=null,Hn.prototype.addConstraint=function(t){this.constraints.add(t)},Hn.prototype.addInteractor=function(t){this.interactors.add(t)},Hn.prototype.remConstraint=function(t){this.constraints.remove(t)},Hn.prototype.remInteractor=function(t){this.interactors.remove(t)},Hn.prototype.free=function(){for(this.listeners.clear(),this.zip_listeners=!0,this.bodylisteners.clear(),this.zip_bodylisteners=!0,this.conlisteners.clear(),this.zip_conlisteners=!0;null!=this.cbTypes.head;)this.cbTypes.pop_unsafe().cbsets.remove(this)},Hn.prototype.alloc=function(){},Hn.prototype.__class__=Hn;var qn=zpp_nape.callbacks.ZPP_CbSetPair=function(){this.listeners=null,this.zip_listeners=!1,this.next=null,this.b=null,this.a=null,this.listeners=new gt};qn.__name__=["zpp_nape","callbacks","ZPP_CbSetPair"],qn.get=function(t,e){var i;return null==qn.zpp_pool?i=new qn:(i=qn.zpp_pool,qn.zpp_pool=i.next,i.next=null),i.zip_listeners=!0,Hn.setlt(t,e)?(i.a=t,i.b=e):(i.a=e,i.b=t),i},qn.setlt=function(t,e){return!!Hn.setlt(t.a,e.a)||t.a==e.a&&Hn.setlt(t.b,e.b)},qn.prototype.a=null,qn.prototype.b=null,qn.prototype.next=null,qn.prototype.free=function(){this.a=this.b=null,this.listeners.clear()},qn.prototype.alloc=function(){this.zip_listeners=!0},qn.prototype.compatible=function(t){var e=t.options1,i=this.a.cbTypes;if(!(!e.nonemptyintersection(i,e.includes)||e.nonemptyintersection(i,e.excludes))&&(r=t.options2,n=this.b.cbTypes,!!r.nonemptyintersection(n,r.includes)&&!r.nonemptyintersection(n,r.excludes)))return!0;var n=t.options2,r=this.a.cbTypes;if(!n.nonemptyintersection(r,n.includes)||n.nonemptyintersection(r,n.excludes))return!1;n=t.options1,t=this.b.cbTypes;return!!n.nonemptyintersection(t,n.includes)&&!n.nonemptyintersection(t,n.excludes)},qn.prototype.zip_listeners=null,qn.prototype.listeners=null,qn.prototype.invalidate=function(){this.zip_listeners=!0},qn.prototype.validate=function(){this.zip_listeners&&(this.zip_listeners=!1,this.__validate())},qn.prototype.__validate=function(){this.listeners.clear();for(var t=this.a.listeners.head,e=this.b.listeners.head;null!=t&&null!=e;){var i,n,r,s,o=t.elt,a=e.elt;o==a?(i=o.options1,n=this.a.cbTypes,(!!(!(!i.nonemptyintersection(n,i.includes)||i.nonemptyintersection(n,i.excludes))&&(r=o.options2,s=this.b.cbTypes,!!r.nonemptyintersection(s,r.includes)&&!r.nonemptyintersection(s,r.excludes)))||(s=o.options2,r=this.a.cbTypes,!(!s.nonemptyintersection(r,s.includes)||s.nonemptyintersection(r,s.excludes))&&(r=o.options1,s=this.b.cbTypes,!!r.nonemptyintersection(s,r.includes)&&!r.nonemptyintersection(s,r.excludes))))&&this.listeners.add(o),t=t.next,e=e.next):o.precedence>a.precedence||o.precedence==a.precedence&&o.id>a.id?t=t.next:e=e.next}},qn.prototype.empty_intersection=function(){return null==this.listeners.head},qn.prototype.single_intersection=function(t){var e=this.listeners.head;return null!=e&&e.elt==t&&null==e.next},qn.prototype.forall=function(t,e){for(var i=this.listeners.head;null!=i;){var n=i.elt;n.event==t&&e(n),i=i.next}},qn.prototype.__class__=qn;var gt=zpp_nape.util.ZNPList_ZPP_InteractionListener=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};gt.__name__=["zpp_nape","util","ZNPList_ZPP_InteractionListener"],gt.prototype.head=null,gt.prototype.begin=function(){return this.head},gt.prototype.modified=null,gt.prototype.pushmod=null,gt.prototype.length=null,gt.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},gt.prototype.add=function(t){null==ir.zpp_pool?e=new ir:(e=ir.zpp_pool,ir.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},gt.prototype.inlined_add=function(t){null==ir.zpp_pool?e=new ir:(e=ir.zpp_pool,ir.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},gt.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},gt.prototype.insert=function(t,e){null==ir.zpp_pool?i=new ir:(i=ir.zpp_pool,ir.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},gt.prototype.inlined_insert=function(t,e){null==ir.zpp_pool?i=new ir:(i=ir.zpp_pool,ir.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},gt.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=ir.zpp_pool,ir.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},gt.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=ir.zpp_pool,ir.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},gt.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},gt.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},gt.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=ir.zpp_pool,ir.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},gt.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},gt.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=ir.zpp_pool,ir.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},gt.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=ir.zpp_pool,ir.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},gt.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=ir.zpp_pool,ir.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},gt.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=ir.zpp_pool,ir.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},gt.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},gt.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=ir.zpp_pool,ir.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},gt.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=ir.zpp_pool,ir.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},gt.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},gt.prototype.empty=function(){return null==this.head},gt.prototype.size=function(){return this.length},gt.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},gt.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},gt.prototype.front=function(){return this.head.elt},gt.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},gt.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},gt.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},gt.prototype.__class__=gt;var bt=zpp_nape.util.ZNPList_ZPP_BodyListener=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};bt.__name__=["zpp_nape","util","ZNPList_ZPP_BodyListener"],bt.prototype.head=null,bt.prototype.begin=function(){return this.head},bt.prototype.modified=null,bt.prototype.pushmod=null,bt.prototype.length=null,bt.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},bt.prototype.add=function(t){null==Ki.zpp_pool?e=new Ki:(e=Ki.zpp_pool,Ki.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},bt.prototype.inlined_add=function(t){null==Ki.zpp_pool?e=new Ki:(e=Ki.zpp_pool,Ki.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},bt.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},bt.prototype.insert=function(t,e){null==Ki.zpp_pool?i=new Ki:(i=Ki.zpp_pool,Ki.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},bt.prototype.inlined_insert=function(t,e){null==Ki.zpp_pool?i=new Ki:(i=Ki.zpp_pool,Ki.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},bt.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=Ki.zpp_pool,Ki.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},bt.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=Ki.zpp_pool,Ki.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},bt.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},bt.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},bt.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=Ki.zpp_pool,Ki.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},bt.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},bt.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=Ki.zpp_pool,Ki.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},bt.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=Ki.zpp_pool,Ki.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},bt.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=Ki.zpp_pool,Ki.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},bt.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=Ki.zpp_pool,Ki.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},bt.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},bt.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=Ki.zpp_pool,Ki.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},bt.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=Ki.zpp_pool,Ki.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},bt.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},bt.prototype.empty=function(){return null==this.head},bt.prototype.size=function(){return this.length},bt.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},bt.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},bt.prototype.front=function(){return this.head.elt},bt.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},bt.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},bt.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},bt.prototype.__class__=bt;var zt=zpp_nape.util.ZNPList_ZPP_ConstraintListener=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};zt.__name__=["zpp_nape","util","ZNPList_ZPP_ConstraintListener"],zt.prototype.head=null,zt.prototype.begin=function(){return this.head},zt.prototype.modified=null,zt.prototype.pushmod=null,zt.prototype.length=null,zt.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},zt.prototype.add=function(t){null==Ji.zpp_pool?e=new Ji:(e=Ji.zpp_pool,Ji.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},zt.prototype.inlined_add=function(t){null==Ji.zpp_pool?e=new Ji:(e=Ji.zpp_pool,Ji.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},zt.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},zt.prototype.insert=function(t,e){null==Ji.zpp_pool?i=new Ji:(i=Ji.zpp_pool,Ji.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},zt.prototype.inlined_insert=function(t,e){null==Ji.zpp_pool?i=new Ji:(i=Ji.zpp_pool,Ji.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},zt.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=Ji.zpp_pool,Ji.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},zt.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=Ji.zpp_pool,Ji.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},zt.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},zt.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},zt.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=Ji.zpp_pool,Ji.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},zt.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},zt.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=Ji.zpp_pool,Ji.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},zt.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=Ji.zpp_pool,Ji.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},zt.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=Ji.zpp_pool,Ji.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},zt.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=Ji.zpp_pool,Ji.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},zt.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},zt.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=Ji.zpp_pool,Ji.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},zt.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=Ji.zpp_pool,Ji.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},zt.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},zt.prototype.empty=function(){return null==this.head},zt.prototype.size=function(){return this.length},zt.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},zt.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},zt.prototype.front=function(){return this.head.elt},zt.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},zt.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},zt.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},zt.prototype.__class__=zt;var Pt=zpp_nape.util.ZNPList_ZPP_Constraint=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Pt.__name__=["zpp_nape","util","ZNPList_ZPP_Constraint"],Pt.prototype.head=null,Pt.prototype.begin=function(){return this.head},Pt.prototype.modified=null,Pt.prototype.pushmod=null,Pt.prototype.length=null,Pt.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},Pt.prototype.add=function(t){null==Hi.zpp_pool?e=new Hi:(e=Hi.zpp_pool,Hi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Pt.prototype.inlined_add=function(t){null==Hi.zpp_pool?e=new Hi:(e=Hi.zpp_pool,Hi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Pt.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},Pt.prototype.insert=function(t,e){null==Hi.zpp_pool?i=new Hi:(i=Hi.zpp_pool,Hi.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Pt.prototype.inlined_insert=function(t,e){null==Hi.zpp_pool?i=new Hi:(i=Hi.zpp_pool,Hi.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Pt.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=Hi.zpp_pool,Hi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Pt.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=Hi.zpp_pool,Hi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Pt.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Pt.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Pt.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=Hi.zpp_pool,Hi.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Pt.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Pt.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=Hi.zpp_pool,Hi.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Pt.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=Hi.zpp_pool,Hi.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Pt.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=Hi.zpp_pool,Hi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Pt.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=Hi.zpp_pool,Hi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Pt.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Pt.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=Hi.zpp_pool,Hi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Pt.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=Hi.zpp_pool,Hi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Pt.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},Pt.prototype.empty=function(){return null==this.head},Pt.prototype.size=function(){return this.length},Pt.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Pt.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Pt.prototype.front=function(){return this.head.elt},Pt.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},Pt.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},Pt.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},Pt.prototype.__class__=Pt;var Tt=zpp_nape.util.ZNPList_ZPP_Interactor=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Tt.__name__=["zpp_nape","util","ZNPList_ZPP_Interactor"],Tt.prototype.head=null,Tt.prototype.begin=function(){return this.head},Tt.prototype.modified=null,Tt.prototype.pushmod=null,Tt.prototype.length=null,Tt.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},Tt.prototype.add=function(t){null==nr.zpp_pool?e=new nr:(e=nr.zpp_pool,nr.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Tt.prototype.inlined_add=function(t){null==nr.zpp_pool?e=new nr:(e=nr.zpp_pool,nr.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Tt.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},Tt.prototype.insert=function(t,e){null==nr.zpp_pool?i=new nr:(i=nr.zpp_pool,nr.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Tt.prototype.inlined_insert=function(t,e){null==nr.zpp_pool?i=new nr:(i=nr.zpp_pool,nr.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Tt.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=nr.zpp_pool,nr.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Tt.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=nr.zpp_pool,nr.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Tt.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Tt.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Tt.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=nr.zpp_pool,nr.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Tt.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Tt.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=nr.zpp_pool,nr.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Tt.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=nr.zpp_pool,nr.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Tt.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=nr.zpp_pool,nr.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Tt.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=nr.zpp_pool,nr.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Tt.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Tt.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=nr.zpp_pool,nr.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Tt.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=nr.zpp_pool,nr.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Tt.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},Tt.prototype.empty=function(){return null==this.head},Tt.prototype.size=function(){return this.length},Tt.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Tt.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Tt.prototype.front=function(){return this.head.elt},Tt.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},Tt.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},Tt.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},Tt.prototype.__class__=Tt;var St=zpp_nape.util.ZNPList_ZPP_CbSet=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};St.__name__=["zpp_nape","util","ZNPList_ZPP_CbSet"],St.prototype.head=null,St.prototype.begin=function(){return this.head},St.prototype.modified=null,St.prototype.pushmod=null,St.prototype.length=null,St.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},St.prototype.add=function(t){null==Yi.zpp_pool?e=new Yi:(e=Yi.zpp_pool,Yi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},St.prototype.inlined_add=function(t){null==Yi.zpp_pool?e=new Yi:(e=Yi.zpp_pool,Yi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},St.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},St.prototype.insert=function(t,e){null==Yi.zpp_pool?i=new Yi:(i=Yi.zpp_pool,Yi.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},St.prototype.inlined_insert=function(t,e){null==Yi.zpp_pool?i=new Yi:(i=Yi.zpp_pool,Yi.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},St.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=Yi.zpp_pool,Yi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},St.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=Yi.zpp_pool,Yi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},St.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},St.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},St.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=Yi.zpp_pool,Yi.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},St.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},St.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=Yi.zpp_pool,Yi.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},St.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=Yi.zpp_pool,Yi.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},St.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=Yi.zpp_pool,Yi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},St.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=Yi.zpp_pool,Yi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},St.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},St.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=Yi.zpp_pool,Yi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},St.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=Yi.zpp_pool,Yi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},St.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},St.prototype.empty=function(){return null==this.head},St.prototype.size=function(){return this.length},St.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},St.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},St.prototype.front=function(){return this.head.elt},St.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},St.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},St.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},St.prototype.__class__=St;var Mt=zpp_nape.callbacks.ZPP_CbType=function(){this.conlisteners=null,this.bodylisteners=null,this.listeners=null,this.cbsets=null,this.id=0,this.userData=null,this.outer=null,this.id=vt.CbType(),this.listeners=new gt,this.bodylisteners=new bt,this.conlisteners=new zt,this.constraints=new Pt,this.interactors=new Tt,this.cbsets=new St};Mt.__name__=["zpp_nape","callbacks","ZPP_CbType"],Mt.setlt=function(t,e){return t.id<e.id},Mt.prototype.outer=null,Mt.prototype.userData=null,Mt.prototype.id=null,Mt.prototype.cbsets=null,Mt.prototype.interactors=null,Mt.prototype.wrap_interactors=null,Mt.prototype.constraints=null,Mt.prototype.wrap_constraints=null,Mt.prototype.addConstraint=function(t){this.constraints.add(t)},Mt.prototype.addInteractor=function(t){this.interactors.add(t)},Mt.prototype.remConstraint=function(t){this.constraints.remove(t)},Mt.prototype.remInteractor=function(t){this.interactors.remove(t)},Mt.prototype.listeners=null,Mt.prototype.addint=function(t){for(var e=null,i=this.listeners.head;null!=i;){var n=i.elt;if(t.precedence>n.precedence||t.precedence==n.precedence&&t.id>n.id)break;i=(e=i).next}var r=this.listeners;null==ir.zpp_pool?s=new ir:(s=ir.zpp_pool,ir.zpp_pool=s.next,s.next=null),s.elt=t;var s=s;null==e?(s.next=r.head,r.head=s):(s.next=e.next,e.next=s),r.pushmod=r.modified=!0,r.length++;for(var o=this.cbsets.head;null!=o;){var a=o.elt;a.zip_listeners=!0,a.invalidate_pairs(),o=o.next}},Mt.prototype.removeint=function(t){this.listeners.remove(t);for(var e=this.cbsets.head;null!=e;){var i=e.elt;i.zip_listeners=!0,i.invalidate_pairs(),e=e.next}},Mt.prototype.invalidateint=function(){for(var t=this.cbsets.head;null!=t;){var e=t.elt;e.zip_listeners=!0,e.invalidate_pairs(),t=t.next}},Mt.prototype.bodylisteners=null,Mt.prototype.addbody=function(t){for(var e=null,i=this.bodylisteners.head;null!=i;){var n=i.elt;if(t.precedence>n.precedence||t.precedence==n.precedence&&t.id>n.id)break;i=(e=i).next}var r=this.bodylisteners;null==Ki.zpp_pool?s=new Ki:(s=Ki.zpp_pool,Ki.zpp_pool=s.next,s.next=null),s.elt=t;var s=s;null==e?(s.next=r.head,r.head=s):(s.next=e.next,e.next=s),r.pushmod=r.modified=!0,r.length++;for(var o=this.cbsets.head;null!=o;)o.elt.zip_bodylisteners=!0,o=o.next},Mt.prototype.removebody=function(t){this.bodylisteners.remove(t);for(var e=this.cbsets.head;null!=e;)e.elt.zip_bodylisteners=!0,e=e.next},Mt.prototype.invalidatebody=function(){for(var t=this.cbsets.head;null!=t;)t.elt.zip_bodylisteners=!0,t=t.next},Mt.prototype.conlisteners=null,Mt.prototype.addconstraint=function(t){for(var e=null,i=this.conlisteners.head;null!=i;){var n=i.elt;if(t.precedence>n.precedence||t.precedence==n.precedence&&t.id>n.id)break;i=(e=i).next}var r=this.conlisteners;null==Ji.zpp_pool?s=new Ji:(s=Ji.zpp_pool,Ji.zpp_pool=s.next,s.next=null),s.elt=t;var s=s;null==e?(s.next=r.head,r.head=s):(s.next=e.next,e.next=s),r.pushmod=r.modified=!0,r.length++;for(var o=this.cbsets.head;null!=o;)o.elt.zip_conlisteners=!0,o=o.next},Mt.prototype.removeconstraint=function(t){this.conlisteners.remove(t);for(var e=this.cbsets.head;null!=e;)e.elt.zip_conlisteners=!0,e=e.next},Mt.prototype.invalidateconstraint=function(){for(var t=this.cbsets.head;null!=t;)t.elt.zip_conlisteners=!0,t=t.next},Mt.prototype.__class__=Mt;var Yn=zpp_nape.util.ZPP_Flags=function(){};Yn.__name__=["zpp_nape","util","ZPP_Flags"],Yn.GravMassMode_DEFAULT=null,Yn.GravMassMode_FIXED=null,Yn.GravMassMode_SCALED=null,Yn.InertiaMode_DEFAULT=null,Yn.InertiaMode_FIXED=null,Yn.MassMode_DEFAULT=null,Yn.MassMode_FIXED=null,Yn.BodyType_STATIC=null,Yn.BodyType_DYNAMIC=null,Yn.BodyType_KINEMATIC=null,Yn.ListenerType_BODY=null,Yn.PreFlag_ACCEPT=null,Yn.ListenerType_CONSTRAINT=null,Yn.PreFlag_IGNORE=null,Yn.ListenerType_INTERACTION=null,Yn.PreFlag_ACCEPT_ONCE=null,Yn.ListenerType_PRE=null,Yn.PreFlag_IGNORE_ONCE=null,Yn.CbEvent_BEGIN=null,Yn.InteractionType_COLLISION=null,Yn.CbEvent_ONGOING=null,Yn.InteractionType_SENSOR=null,Yn.CbEvent_END=null,Yn.InteractionType_FLUID=null,Yn.CbEvent_WAKE=null,Yn.InteractionType_ANY=null,Yn.CbEvent_SLEEP=null,Yn.CbEvent_BREAK=null,Yn.CbEvent_PRE=null,Yn.Winding_UNDEFINED=null,Yn.Winding_CLOCKWISE=null,Yn.Winding_ANTICLOCKWISE=null,Yn.ValidationResult_VALID=null,Yn.ValidationResult_DEGENERATE=null,Yn.ValidationResult_CONCAVE=null,Yn.ValidationResult_SELF_INTERSECTING=null,Yn.ShapeType_CIRCLE=null,Yn.ShapeType_POLYGON=null,Yn.Broadphase_DYNAMIC_AABB_TREE=null,Yn.Broadphase_SWEEP_AND_PRUNE=null,Yn.ArbiterType_COLLISION=null,Yn.ArbiterType_SENSOR=null,Yn.ArbiterType_FLUID=null,Yn.prototype.__class__=Yn;var At=zpp_nape.callbacks.ZPP_Listener=function(){this.space=null,this.interaction=null,this.constraint=null,this.body=null,this.precedence=0,this.event=0,this.type=0,this.id=0,this.outer=null,this.id=vt.Listener()};At.__name__=["zpp_nape","callbacks","ZPP_Listener"],At.setlt=function(t,e){return!(t.precedence<=e.precedence)||t.precedence==e.precedence&&t.id>e.id},At.prototype.outer=null,At.prototype.id=null,At.prototype.type=null,At.prototype.event=null,At.prototype.precedence=null,At.prototype.body=null,At.prototype.constraint=null,At.prototype.interaction=null,At.prototype.space=null,At.prototype.swapEvent=function(t){},At.prototype.invalidate_precedence=function(){},At.prototype.addedToSpace=function(){},At.prototype.removedFromSpace=function(){},At.prototype.__class__=At;var Ot=zpp_nape.callbacks.ZPP_BodyListener=function(t,e,i){this.handler=null,this.options=null,this.outer_zn=null,At.call(this),this.event=e,this.handler=i,(this.body=this).type=0,this.options=t.zpp_inner};Ot.__name__=["zpp_nape","callbacks","ZPP_BodyListener"],Ot.__super__=At,Ot.prototype=Object.create(At.prototype),Ot.prototype.outer_zn=null,Ot.prototype.options=null,Ot.prototype.handler=null,Ot.prototype.addedToSpace=function(){this.options.handler=Z(this,this.cbtype_change);for(var t=this.options.includes.head;null!=t;){for(var e=t.elt,i=null,n=e.bodylisteners.head;null!=n;){var r=n.elt;if(this.precedence>r.precedence||this.precedence==r.precedence&&this.id>r.id)break;n=(i=n).next}var s,o=e.bodylisteners;null==Ki.zpp_pool?s=new Ki:(s=Ki.zpp_pool,Ki.zpp_pool=s.next,s.next=null),s.elt=this;var a=s;null==i?(a.next=o.head,o.head=a):(a.next=i.next,i.next=a),o.pushmod=o.modified=!0,o.length++;for(var l=e.cbsets.head;null!=l;)l.elt.zip_bodylisteners=!0,l=l.next;t=t.next}},Ot.prototype.removedFromSpace=function(){for(var t=this.options.includes.head;null!=t;){var e=t.elt;e.bodylisteners.remove(this);for(var i=e.cbsets.head;null!=i;)i.elt.zip_bodylisteners=!0,i=i.next;t=t.next}this.options.handler=null},Ot.prototype.cbtype_change=function(t,e,i){this.removedFromSpace();var n=this.options;if(e)if(i){for(var r=null,s=n.includes.head;null!=s&&!(t.id<s.elt.id);)s=(r=s).next;e=n.includes;null==Ui.zpp_pool?o=new Ui:(o=Ui.zpp_pool,Ui.zpp_pool=o.next,o.next=null),o.elt=t;var o=o;null==r?(o.next=e.head,e.head=o):(o.next=r.next,r.next=o),e.pushmod=e.modified=!0,e.length++}else n.includes.remove(t);else if(i){for(var a=null,l=n.excludes.head;null!=l&&!(t.id<l.elt.id);)l=(a=l).next;i=n.excludes;null==Ui.zpp_pool?p=new Ui:(p=Ui.zpp_pool,Ui.zpp_pool=p.next,p.next=null),p.elt=t;var p=p;null==a?(p.next=i.head,i.head=p):(p.next=a.next,a.next=p),i.pushmod=i.modified=!0,i.length++}else n.excludes.remove(t);this.addedToSpace()},Ot.prototype.invalidate_precedence=function(){null!=this.space&&(this.removedFromSpace(),this.addedToSpace())},Ot.prototype.swapEvent=function(t){this.removedFromSpace(),this.event=t,this.addedToSpace()},Ot.prototype.__class__=Ot;var kt=zpp_nape.callbacks.ZPP_ConstraintListener=function(t,e,i){this.handler=null,this.options=null,this.outer_zn=null,At.call(this),this.event=e,this.handler=i,(this.constraint=this).type=1,this.options=t.zpp_inner};kt.__name__=["zpp_nape","callbacks","ZPP_ConstraintListener"],kt.__super__=At,kt.prototype=Object.create(At.prototype),kt.prototype.outer_zn=null,kt.prototype.options=null,kt.prototype.handler=null,kt.prototype.addedToSpace=function(){this.options.handler=Z(this,this.cbtype_change);for(var t=this.options.includes.head;null!=t;){for(var e=t.elt,i=null,n=e.conlisteners.head;null!=n;){var r=n.elt;if(this.precedence>r.precedence||this.precedence==r.precedence&&this.id>r.id)break;n=(i=n).next}var s,o=e.conlisteners;null==Ji.zpp_pool?s=new Ji:(s=Ji.zpp_pool,Ji.zpp_pool=s.next,s.next=null),s.elt=this;var a=s;null==i?(a.next=o.head,o.head=a):(a.next=i.next,i.next=a),o.pushmod=o.modified=!0,o.length++;for(var l=e.cbsets.head;null!=l;)l.elt.zip_conlisteners=!0,l=l.next;t=t.next}},kt.prototype.removedFromSpace=function(){for(var t=this.options.includes.head;null!=t;){var e=t.elt;e.conlisteners.remove(this);for(var i=e.cbsets.head;null!=i;)i.elt.zip_conlisteners=!0,i=i.next;t=t.next}this.options.handler=null},kt.prototype.cbtype_change=function(t,e,i){this.removedFromSpace();var n=this.options;if(e)if(i){for(var r=null,s=n.includes.head;null!=s&&!(t.id<s.elt.id);)s=(r=s).next;e=n.includes;null==Ui.zpp_pool?o=new Ui:(o=Ui.zpp_pool,Ui.zpp_pool=o.next,o.next=null),o.elt=t;var o=o;null==r?(o.next=e.head,e.head=o):(o.next=r.next,r.next=o),e.pushmod=e.modified=!0,e.length++}else n.includes.remove(t);else if(i){for(var a=null,l=n.excludes.head;null!=l&&!(t.id<l.elt.id);)l=(a=l).next;i=n.excludes;null==Ui.zpp_pool?p=new Ui:(p=Ui.zpp_pool,Ui.zpp_pool=p.next,p.next=null),p.elt=t;var p=p;null==a?(p.next=i.head,i.head=p):(p.next=a.next,a.next=p),i.pushmod=i.modified=!0,i.length++}else n.excludes.remove(t);this.addedToSpace()},kt.prototype.invalidate_precedence=function(){null!=this.space&&(this.removedFromSpace(),this.addedToSpace())},kt.prototype.swapEvent=function(t){this.removedFromSpace(),this.event=t,this.addedToSpace()},kt.prototype.__class__=kt;var Et=zpp_nape.util.ZNPList_ZPP_CbType=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Et.__name__=["zpp_nape","util","ZNPList_ZPP_CbType"],Et.prototype.head=null,Et.prototype.begin=function(){return this.head},Et.prototype.modified=null,Et.prototype.pushmod=null,Et.prototype.length=null,Et.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},Et.prototype.add=function(t){null==Ui.zpp_pool?e=new Ui:(e=Ui.zpp_pool,Ui.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Et.prototype.inlined_add=function(t){null==Ui.zpp_pool?e=new Ui:(e=Ui.zpp_pool,Ui.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Et.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},Et.prototype.insert=function(t,e){null==Ui.zpp_pool?i=new Ui:(i=Ui.zpp_pool,Ui.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Et.prototype.inlined_insert=function(t,e){null==Ui.zpp_pool?i=new Ui:(i=Ui.zpp_pool,Ui.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Et.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=Ui.zpp_pool,Ui.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Et.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=Ui.zpp_pool,Ui.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Et.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Et.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Et.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=Ui.zpp_pool,Ui.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Et.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Et.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=Ui.zpp_pool,Ui.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Et.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=Ui.zpp_pool,Ui.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Et.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=Ui.zpp_pool,Ui.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Et.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=Ui.zpp_pool,Ui.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Et.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Et.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=Ui.zpp_pool,Ui.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Et.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=Ui.zpp_pool,Ui.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Et.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},Et.prototype.empty=function(){return null==this.head},Et.prototype.size=function(){return this.length},Et.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Et.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Et.prototype.front=function(){return this.head.elt},Et.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},Et.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},Et.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},Et.prototype.__class__=Et;var Re=zpp_nape.callbacks.ZPP_InteractionListener=function(t,e,i,n){this.handlerp=null,this.pure=!1,this.allowSleepingCallbacks=!1,this.handleri=null,this.options2=null,this.options1=null,this.itype=0,this.outer_znp=null,this.outer_zni=null,At.call(this),this.type=n,(this.interaction=this).event=i,this.options1=t.zpp_inner,this.options2=e.zpp_inner,this.allowSleepingCallbacks=!1};Re.__name__=["zpp_nape","callbacks","ZPP_InteractionListener"],Re.__super__=At,Re.prototype=Object.create(At.prototype),Re.prototype.outer_zni=null,Re.prototype.outer_znp=null,Re.prototype.itype=null,Re.prototype.options1=null,Re.prototype.options2=null,Re.prototype.handleri=null,Re.prototype.allowSleepingCallbacks=null,Re.prototype.pure=null,Re.prototype.handlerp=null,Re.prototype.setInteractionType=function(t){this.itype=t},Re.prototype.wake=function(){for(var t=this.options1.includes.head,e=this.options2.includes.head;null!=t&&null!=e;){var i=t.elt,n=e.elt;if(i==n){for(var r=i.interactors.head;null!=r;)r.elt.wake(),r=r.next;t=t.next,e=e.next}else if(i.id<n.id){for(var s=i.interactors.head;null!=s;)s.elt.wake(),s=s.next;t=t.next}else{for(var o=n.interactors.head;null!=o;)o.elt.wake(),o=o.next;e=e.next}}for(;null!=t;){for(var a=t.elt.interactors.head;null!=a;)a.elt.wake(),a=a.next;t=t.next}for(;null!=e;){for(var l=e.elt.interactors.head;null!=l;)l.elt.wake(),l=l.next;e=e.next}},Re.prototype.CbSetset=function(t,e,i){for(var n=Re.UCbSet,r=Re.VCbSet,s=Re.WCbSet,o=t.head,a=e.head;null!=o&&null!=a;){var l,p,h,u,c=o.elt,d=a.elt;c==d?(null==Yi.zpp_pool?l=new Yi:(l=Yi.zpp_pool,Yi.zpp_pool=l.next,l.next=null),l.elt=c,(p=l).next=s.head,s.head=p,s.modified=!0,s.length++,o=o.next,a=a.next):Hn.setlt(c,d)?(null==Yi.zpp_pool?h=new Yi:(h=Yi.zpp_pool,Yi.zpp_pool=h.next,h.next=null),h.elt=c,(c=h).next=n.head,n.head=c,n.modified=!0,n.length++,o=o.next):(null==Yi.zpp_pool?u=new Yi:(u=Yi.zpp_pool,Yi.zpp_pool=u.next,u.next=null),u.elt=d,(d=u).next=r.head,r.head=d,r.modified=!0,r.length++,a=a.next)}for(;null!=o;){var _,y=o.elt;null==Yi.zpp_pool?_=new Yi:(_=Yi.zpp_pool,Yi.zpp_pool=_.next,_.next=null),_.elt=y;y=_;y.next=n.head,n.head=y,n.modified=!0,n.length++,o=o.next}for(;null!=a;){var f,m=a.elt;null==Yi.zpp_pool?f=new Yi:(f=Yi.zpp_pool,Yi.zpp_pool=f.next,f.next=null),f.elt=m;m=f;m.next=r.head,r.head=m,r.modified=!0,r.length++,a=a.next}for(;null!=n.head;)for(var x=n.pop_unsafe(),v=e.head;null!=v;)i(x,v.elt),v=v.next;for(;null!=r.head;)for(var g=r.pop_unsafe(),b=s.head;null!=b;)i(g,b.elt),b=b.next;for(;null!=s.head;){var z=s.pop_unsafe();i(z,z);for(var w=s.head;null!=w;)i(z,w.elt),w=w.next}},Re.prototype.CbTypeset=function(t,e,i){for(var n=Re.UCbType,r=Re.VCbType,s=Re.WCbType,o=t.head,a=e.head;null!=o&&null!=a;){var l,p,h,u,c=o.elt,d=a.elt;c==d?(null==Ui.zpp_pool?l=new Ui:(l=Ui.zpp_pool,Ui.zpp_pool=l.next,l.next=null),l.elt=c,(p=l).next=s.head,s.head=p,s.modified=!0,s.length++,o=o.next,a=a.next):c.id<d.id?(null==Ui.zpp_pool?h=new Ui:(h=Ui.zpp_pool,Ui.zpp_pool=h.next,h.next=null),h.elt=c,(c=h).next=n.head,n.head=c,n.modified=!0,n.length++,o=o.next):(null==Ui.zpp_pool?u=new Ui:(u=Ui.zpp_pool,Ui.zpp_pool=u.next,u.next=null),u.elt=d,(d=u).next=r.head,r.head=d,r.modified=!0,r.length++,a=a.next)}for(;null!=o;){var _,y=o.elt;null==Ui.zpp_pool?_=new Ui:(_=Ui.zpp_pool,Ui.zpp_pool=_.next,_.next=null),_.elt=y;y=_;y.next=n.head,n.head=y,n.modified=!0,n.length++,o=o.next}for(;null!=a;){var f,m=a.elt;null==Ui.zpp_pool?f=new Ui:(f=Ui.zpp_pool,Ui.zpp_pool=f.next,f.next=null),f.elt=m;m=f;m.next=r.head,r.head=m,r.modified=!0,r.length++,a=a.next}for(;null!=n.head;)for(var x=n.pop_unsafe(),v=e.head;null!=v;)i(x,v.elt),v=v.next;for(;null!=r.head;)for(var g=r.pop_unsafe(),b=s.head;null!=b;)i(g,b.elt),b=b.next;for(;null!=s.head;){var z=s.pop_unsafe();i(z,z);for(var w=s.head;null!=w;)i(z,w.elt),w=w.next}},Re.prototype.with_uniquesets=function(t){var e,i=this;null==jn.zpp_pool?e=new jn:(e=jn.zpp_pool,jn.zpp_pool=e.next,e.next=null),e.lt=qn.setlt;for(var n=this.options2.includes,r=Re.UCbType,s=Re.VCbType,o=Re.WCbType,a=this.options1.includes.head,l=n.head;null!=a&&null!=l;){var p,h,u,c,d=a.elt,_=l.elt;d==_?(null==Ui.zpp_pool?p=new Ui:(p=Ui.zpp_pool,Ui.zpp_pool=p.next,p.next=null),p.elt=d,(h=p).next=o.head,o.head=h,o.modified=!0,o.length++,a=a.next,l=l.next):d.id<_.id?(null==Ui.zpp_pool?u=new Ui:(u=Ui.zpp_pool,Ui.zpp_pool=u.next,u.next=null),u.elt=d,(d=u).next=r.head,r.head=d,r.modified=!0,r.length++,a=a.next):(null==Ui.zpp_pool?c=new Ui:(c=Ui.zpp_pool,Ui.zpp_pool=c.next,c.next=null),c.elt=_,(_=c).next=s.head,s.head=_,s.modified=!0,s.length++,l=l.next)}for(;null!=a;){var y,f=a.elt;null==Ui.zpp_pool?y=new Ui:(y=Ui.zpp_pool,Ui.zpp_pool=y.next,y.next=null),y.elt=f;f=y;f.next=r.head,r.head=f,r.modified=!0,r.length++,a=a.next}for(;null!=l;){var m,x=l.elt;null==Ui.zpp_pool?m=new Ui:(m=Ui.zpp_pool,Ui.zpp_pool=m.next,m.next=null),m.elt=x;x=m;x.next=s.head,s.head=x,s.modified=!0,s.length++,l=l.next}for(;null!=r.head;)for(var v=r.pop_unsafe(),g=n.head;null!=g;){for(var b=g.elt.cbsets,z=Re.UCbSet,w=Re.VCbSet,C=Re.WCbSet,P=v.cbsets.head,T=b.head;null!=P&&null!=T;){var S,M,A,O,k=P.elt,E=T.elt;k==E?(null==Yi.zpp_pool?S=new Yi:(S=Yi.zpp_pool,Yi.zpp_pool=S.next,S.next=null),S.elt=k,(M=S).next=C.head,C.head=M,C.modified=!0,C.length++,P=P.next,T=T.next):Hn.setlt(k,E)?(null==Yi.zpp_pool?A=new Yi:(A=Yi.zpp_pool,Yi.zpp_pool=A.next,A.next=null),A.elt=k,(k=A).next=z.head,z.head=k,z.modified=!0,z.length++,P=P.next):(null==Yi.zpp_pool?O=new Yi:(O=Yi.zpp_pool,Yi.zpp_pool=O.next,O.next=null),O.elt=E,(E=O).next=w.head,w.head=E,w.modified=!0,w.length++,T=T.next)}for(;null!=P;){var I,D=P.elt;null==Yi.zpp_pool?I=new Yi:(I=Yi.zpp_pool,Yi.zpp_pool=I.next,I.next=null),I.elt=D;D=I;D.next=z.head,z.head=D,z.modified=!0,z.length++,P=P.next}for(;null!=T;){var B,L=T.elt;null==Yi.zpp_pool?B=new Yi:(B=Yi.zpp_pool,Yi.zpp_pool=B.next,B.next=null),B.elt=L;L=B;L.next=w.head,w.head=L,w.modified=!0,w.length++,T=T.next}for(;null!=z.head;)for(var R=z.pop_unsafe(),F=b.head;null!=F;){var j,N=F.elt;R.validate(),N.validate(),Hn.single_intersection(R,N,i)&&(null==qn.zpp_pool?j=new qn:(j=qn.zpp_pool,qn.zpp_pool=j.next,j.next=null),j.zip_listeners=!0,Hn.setlt(R,N)?(j.a=R,j.b=N):(j.a=N,j.b=R),e.try_insert(j)),F=F.next}for(;null!=w.head;)for(var G=w.pop_unsafe(),U=C.head;null!=U;){var X,V=U.elt;G.validate(),V.validate(),Hn.single_intersection(G,V,i)&&(null==qn.zpp_pool?X=new qn:(X=qn.zpp_pool,qn.zpp_pool=X.next,X.next=null),X.zip_listeners=!0,Hn.setlt(G,V)?(X.a=G,X.b=V):(X.a=V,X.b=G),e.try_insert(X)),U=U.next}for(;null!=C.head;){var W,H=C.pop_unsafe();H.validate(),H.validate(),Hn.single_intersection(H,H,i)&&(null==qn.zpp_pool?W=new qn:(W=qn.zpp_pool,qn.zpp_pool=W.next,W.next=null),W.zip_listeners=!0,Hn.setlt(H,H),W.a=H,W.b=H,e.try_insert(W));for(var q=C.head;null!=q;){var Y,K=q.elt;H.validate(),K.validate(),Hn.single_intersection(H,K,i)&&(null==qn.zpp_pool?Y=new qn:(Y=qn.zpp_pool,qn.zpp_pool=Y.next,Y.next=null),Y.zip_listeners=!0,Hn.setlt(H,K)?(Y.a=H,Y.b=K):(Y.a=K,Y.b=H),e.try_insert(Y)),q=q.next}}g=g.next}for(;null!=s.head;)for(var Z=s.pop_unsafe(),J=o.head;null!=J;){for(var Q=J.elt.cbsets,$=Re.UCbSet,tt=Re.VCbSet,et=Re.WCbSet,it=Z.cbsets.head,nt=Q.head;null!=it&&null!=nt;){var rt,st,ot,at,lt=it.elt,pt=nt.elt;lt==pt?(null==Yi.zpp_pool?rt=new Yi:(rt=Yi.zpp_pool,Yi.zpp_pool=rt.next,rt.next=null),rt.elt=lt,(st=rt).next=et.head,et.head=st,et.modified=!0,et.length++,it=it.next,nt=nt.next):Hn.setlt(lt,pt)?(null==Yi.zpp_pool?ot=new Yi:(ot=Yi.zpp_pool,Yi.zpp_pool=ot.next,ot.next=null),ot.elt=lt,(lt=ot).next=$.head,$.head=lt,$.modified=!0,$.length++,it=it.next):(null==Yi.zpp_pool?at=new Yi:(at=Yi.zpp_pool,Yi.zpp_pool=at.next,at.next=null),at.elt=pt,(pt=at).next=tt.head,tt.head=pt,tt.modified=!0,tt.length++,nt=nt.next)}for(;null!=it;){var ht,ut=it.elt;null==Yi.zpp_pool?ht=new Yi:(ht=Yi.zpp_pool,Yi.zpp_pool=ht.next,ht.next=null),ht.elt=ut;ut=ht;ut.next=$.head,$.head=ut,$.modified=!0,$.length++,it=it.next}for(;null!=nt;){var ct,dt=nt.elt;null==Yi.zpp_pool?ct=new Yi:(ct=Yi.zpp_pool,Yi.zpp_pool=ct.next,ct.next=null),ct.elt=dt;dt=ct;dt.next=tt.head,tt.head=dt,tt.modified=!0,tt.length++,nt=nt.next}for(;null!=$.head;)for(var _t=$.pop_unsafe(),yt=Q.head;null!=yt;){var ft,mt=yt.elt;_t.validate(),mt.validate(),Hn.single_intersection(_t,mt,i)&&(null==qn.zpp_pool?ft=new qn:(ft=qn.zpp_pool,qn.zpp_pool=ft.next,ft.next=null),ft.zip_listeners=!0,Hn.setlt(_t,mt)?(ft.a=_t,ft.b=mt):(ft.a=mt,ft.b=_t),e.try_insert(ft)),yt=yt.next}for(;null!=tt.head;)for(var xt=tt.pop_unsafe(),vt=et.head;null!=vt;){var gt,bt=vt.elt;xt.validate(),bt.validate(),Hn.single_intersection(xt,bt,i)&&(null==qn.zpp_pool?gt=new qn:(gt=qn.zpp_pool,qn.zpp_pool=gt.next,gt.next=null),gt.zip_listeners=!0,Hn.setlt(xt,bt)?(gt.a=xt,gt.b=bt):(gt.a=bt,gt.b=xt),e.try_insert(gt)),vt=vt.next}for(;null!=et.head;){var zt,wt=et.pop_unsafe();wt.validate(),wt.validate(),Hn.single_intersection(wt,wt,i)&&(null==qn.zpp_pool?zt=new qn:(zt=qn.zpp_pool,qn.zpp_pool=zt.next,zt.next=null),zt.zip_listeners=!0,Hn.setlt(wt,wt),zt.a=wt,zt.b=wt,e.try_insert(zt));for(var Ct=et.head;null!=Ct;){var Pt,Tt=Ct.elt;wt.validate(),Tt.validate(),Hn.single_intersection(wt,Tt,i)&&(null==qn.zpp_pool?Pt=new qn:(Pt=qn.zpp_pool,qn.zpp_pool=Pt.next,Pt.next=null),Pt.zip_listeners=!0,Hn.setlt(wt,Tt)?(Pt.a=wt,Pt.b=Tt):(Pt.a=Tt,Pt.b=wt),e.try_insert(Pt)),Ct=Ct.next}}J=J.next}for(;null!=o.head;){for(var St=o.pop_unsafe(),Mt=St.cbsets,At=Re.UCbSet,Ot=Re.VCbSet,kt=Re.WCbSet,Et=St.cbsets.head,It=Mt.head;null!=Et&&null!=It;){var Dt,Bt,Lt,Rt,Ft=Et.elt,jt=It.elt;Ft==jt?(null==Yi.zpp_pool?Dt=new Yi:(Dt=Yi.zpp_pool,Yi.zpp_pool=Dt.next,Dt.next=null),Dt.elt=Ft,(Bt=Dt).next=kt.head,kt.head=Bt,kt.modified=!0,kt.length++,Et=Et.next,It=It.next):Hn.setlt(Ft,jt)?(null==Yi.zpp_pool?Lt=new Yi:(Lt=Yi.zpp_pool,Yi.zpp_pool=Lt.next,Lt.next=null),Lt.elt=Ft,(Ft=Lt).next=At.head,At.head=Ft,At.modified=!0,At.length++,Et=Et.next):(null==Yi.zpp_pool?Rt=new Yi:(Rt=Yi.zpp_pool,Yi.zpp_pool=Rt.next,Rt.next=null),Rt.elt=jt,(jt=Rt).next=Ot.head,Ot.head=jt,Ot.modified=!0,Ot.length++,It=It.next)}for(;null!=Et;){var Nt,Gt=Et.elt;null==Yi.zpp_pool?Nt=new Yi:(Nt=Yi.zpp_pool,Yi.zpp_pool=Nt.next,Nt.next=null),Nt.elt=Gt;Gt=Nt;Gt.next=At.head,At.head=Gt,At.modified=!0,At.length++,Et=Et.next}for(;null!=It;){var Ut,Xt=It.elt;null==Yi.zpp_pool?Ut=new Yi:(Ut=Yi.zpp_pool,Yi.zpp_pool=Ut.next,Ut.next=null),Ut.elt=Xt;Xt=Ut;Xt.next=Ot.head,Ot.head=Xt,Ot.modified=!0,Ot.length++,It=It.next}for(;null!=At.head;)for(var Vt=At.pop_unsafe(),Wt=Mt.head;null!=Wt;){var Ht,qt=Wt.elt;Vt.validate(),qt.validate(),Hn.single_intersection(Vt,qt,i)&&(null==qn.zpp_pool?Ht=new qn:(Ht=qn.zpp_pool,qn.zpp_pool=Ht.next,Ht.next=null),Ht.zip_listeners=!0,Hn.setlt(Vt,qt)?(Ht.a=Vt,Ht.b=qt):(Ht.a=qt,Ht.b=Vt),e.try_insert(Ht)),Wt=Wt.next}for(;null!=Ot.head;)for(var Yt=Ot.pop_unsafe(),Kt=kt.head;null!=Kt;){var Zt,Jt=Kt.elt;Yt.validate(),Jt.validate(),Hn.single_intersection(Yt,Jt,i)&&(null==qn.zpp_pool?Zt=new qn:(Zt=qn.zpp_pool,qn.zpp_pool=Zt.next,Zt.next=null),Zt.zip_listeners=!0,Hn.setlt(Yt,Jt)?(Zt.a=Yt,Zt.b=Jt):(Zt.a=Jt,Zt.b=Yt),e.try_insert(Zt)),Kt=Kt.next}for(;null!=kt.head;){var Qt,$t=kt.pop_unsafe();$t.validate(),$t.validate(),Hn.single_intersection($t,$t,i)&&(null==qn.zpp_pool?Qt=new qn:(Qt=qn.zpp_pool,qn.zpp_pool=Qt.next,Qt.next=null),Qt.zip_listeners=!0,Hn.setlt($t,$t),Qt.a=$t,Qt.b=$t,e.try_insert(Qt));for(var te=kt.head;null!=te;){var ee,ie=te.elt;$t.validate(),ie.validate(),Hn.single_intersection($t,ie,i)&&(null==qn.zpp_pool?ee=new qn:(ee=qn.zpp_pool,qn.zpp_pool=ee.next,ee.next=null),ee.zip_listeners=!0,Hn.setlt($t,ie)?(ee.a=$t,ee.b=ie):(ee.a=ie,ee.b=$t),e.try_insert(ee)),te=te.next}}for(var ne=o.head;null!=ne;){for(var re=ne.elt.cbsets,se=Re.UCbSet,oe=Re.VCbSet,ae=Re.WCbSet,le=St.cbsets.head,pe=re.head;null!=le&&null!=pe;){var he,ue,ce,de,_e=le.elt,ye=pe.elt;_e==ye?(null==Yi.zpp_pool?he=new Yi:(he=Yi.zpp_pool,Yi.zpp_pool=he.next,he.next=null),he.elt=_e,(ue=he).next=ae.head,ae.head=ue,ae.modified=!0,ae.length++,le=le.next,pe=pe.next):Hn.setlt(_e,ye)?(null==Yi.zpp_pool?ce=new Yi:(ce=Yi.zpp_pool,Yi.zpp_pool=ce.next,ce.next=null),ce.elt=_e,(_e=ce).next=se.head,se.head=_e,se.modified=!0,se.length++,le=le.next):(null==Yi.zpp_pool?de=new Yi:(de=Yi.zpp_pool,Yi.zpp_pool=de.next,de.next=null),de.elt=ye,(ye=de).next=oe.head,oe.head=ye,oe.modified=!0,oe.length++,pe=pe.next)}for(;null!=le;){var fe,me=le.elt;null==Yi.zpp_pool?fe=new Yi:(fe=Yi.zpp_pool,Yi.zpp_pool=fe.next,fe.next=null),fe.elt=me;me=fe;me.next=se.head,se.head=me,se.modified=!0,se.length++,le=le.next}for(;null!=pe;){var xe,ve=pe.elt;null==Yi.zpp_pool?xe=new Yi:(xe=Yi.zpp_pool,Yi.zpp_pool=xe.next,xe.next=null),xe.elt=ve;ve=xe;ve.next=oe.head,oe.head=ve,oe.modified=!0,oe.length++,pe=pe.next}for(;null!=se.head;)for(var ge=se.pop_unsafe(),be=re.head;null!=be;){var ze,we=be.elt;ge.validate(),we.validate(),Hn.single_intersection(ge,we,i)&&(null==qn.zpp_pool?ze=new qn:(ze=qn.zpp_pool,qn.zpp_pool=ze.next,ze.next=null),ze.zip_listeners=!0,Hn.setlt(ge,we)?(ze.a=ge,ze.b=we):(ze.a=we,ze.b=ge),e.try_insert(ze)),be=be.next}for(;null!=oe.head;)for(var Ce=oe.pop_unsafe(),Pe=ae.head;null!=Pe;){var Te,Se=Pe.elt;Ce.validate(),Se.validate(),Hn.single_intersection(Ce,Se,i)&&(null==qn.zpp_pool?Te=new qn:(Te=qn.zpp_pool,qn.zpp_pool=Te.next,Te.next=null),Te.zip_listeners=!0,Hn.setlt(Ce,Se)?(Te.a=Ce,Te.b=Se):(Te.a=Se,Te.b=Ce),e.try_insert(Te)),Pe=Pe.next}for(;null!=ae.head;){var Me,Ae=ae.pop_unsafe();Ae.validate(),Ae.validate(),Hn.single_intersection(Ae,Ae,i)&&(null==qn.zpp_pool?Me=new qn:(Me=qn.zpp_pool,qn.zpp_pool=Me.next,Me.next=null),Me.zip_listeners=!0,Hn.setlt(Ae,Ae),Me.a=Ae,Me.b=Ae,e.try_insert(Me));for(var Oe=ae.head;null!=Oe;){var ke,Ee=Oe.elt;Ae.validate(),Ee.validate(),Hn.single_intersection(Ae,Ee,i)&&(null==qn.zpp_pool?ke=new qn:(ke=qn.zpp_pool,qn.zpp_pool=ke.next,ke.next=null),ke.zip_listeners=!0,Hn.setlt(Ae,Ee)?(ke.a=Ae,ke.b=Ee):(ke.a=Ee,ke.b=Ae),e.try_insert(ke)),Oe=Oe.next}}ne=ne.next}}if(null!=e.parent){for(var Ie,De,Be=e.parent;null!=Be;)Be=null!=Be.prev?Be.prev:null!=Be.next?Be.next:(De=Be.data,t?i.space.freshListenerType(De.a,De.b):i.space.nullListenerType(De.a,De.b),De.a=De.b=null,De.listeners.clear(),De.next=qn.zpp_pool,qn.zpp_pool=De,null!=(Ie=Be.parent)&&(Be==Ie.prev?Ie.prev=null:Ie.next=null,Be.parent=null),(De=Be).data=null,De.lt=null,De.swapped=null,De.next=jn.zpp_pool,jn.zpp_pool=De,Ie);e.parent=null}var Le=e;Le.data=null,Le.lt=null,Le.swapped=null,Le.next=jn.zpp_pool,jn.zpp_pool=Le},Re.prototype.with_union=function(t){for(var e=this.options1.includes.head,i=this.options2.includes.head;null!=e&&null!=i;){var n=e.elt,r=i.elt;n==r?(t(n),e=e.next,i=i.next):n.id<r.id?(t(n),e=e.next):(t(r),i=i.next)}for(;null!=e;)t(e.elt),e=e.next;for(;null!=i;)t(i.elt),i=i.next},Re.prototype.addedToSpace=function(){for(var t=this,e=3==this.type,i=this.options1.includes.head,n=this.options2.includes.head;null!=i&&null!=n;){var r=i.elt,s=n.elt;if(r==s){for(var o=null,a=r.listeners.head;null!=a;){var l=a.elt;if(t.precedence>l.precedence||t.precedence==l.precedence&&t.id>l.id)break;a=(o=a).next}var p,h=r.listeners;null==ir.zpp_pool?p=new ir:(p=ir.zpp_pool,ir.zpp_pool=p.next,p.next=null),p.elt=t;var u=p;null==o?(u.next=h.head,h.head=u):(u.next=o.next,o.next=u),h.pushmod=h.modified=!0,h.length++;for(var c=r.cbsets.head;null!=c;){var d=c.elt;d.zip_listeners=!0,d.invalidate_pairs(),c=c.next}if(e)for(var _=r.interactors.head;null!=_;)_.elt.wake(),_=_.next;i=i.next,n=n.next}else if(r.id<s.id){for(var y=null,f=r.listeners.head;null!=f;){var m=f.elt;if(t.precedence>m.precedence||t.precedence==m.precedence&&t.id>m.id)break;f=(y=f).next}var x,v=r.listeners;null==ir.zpp_pool?x=new ir:(x=ir.zpp_pool,ir.zpp_pool=x.next,x.next=null),x.elt=t;h=x;null==y?(h.next=v.head,v.head=h):(h.next=y.next,y.next=h),v.pushmod=v.modified=!0,v.length++;for(var g=r.cbsets.head;null!=g;){var b=g.elt;b.zip_listeners=!0,b.invalidate_pairs(),g=g.next}if(e)for(var z=r.interactors.head;null!=z;)z.elt.wake(),z=z.next;i=i.next}else{for(var w=null,C=s.listeners.head;null!=C;){var P=C.elt;if(t.precedence>P.precedence||t.precedence==P.precedence&&t.id>P.id)break;C=(w=C).next}var T,v=s.listeners;null==ir.zpp_pool?T=new ir:(T=ir.zpp_pool,ir.zpp_pool=T.next,T.next=null),T.elt=t;r=T;null==w?(r.next=v.head,v.head=r):(r.next=w.next,w.next=r),v.pushmod=v.modified=!0,v.length++;for(var S=s.cbsets.head;null!=S;){var M=S.elt;M.zip_listeners=!0,M.invalidate_pairs(),S=S.next}if(e)for(var A=s.interactors.head;null!=A;)A.elt.wake(),A=A.next;n=n.next}}for(;null!=i;){for(var O=i.elt,k=null,E=O.listeners.head;null!=E;){var I=E.elt;if(t.precedence>I.precedence||t.precedence==I.precedence&&t.id>I.id)break;E=(k=E).next}var D,B=O.listeners;null==ir.zpp_pool?D=new ir:(D=ir.zpp_pool,ir.zpp_pool=D.next,D.next=null),D.elt=t;var L=D;null==k?(L.next=B.head,B.head=L):(L.next=k.next,k.next=L),B.pushmod=B.modified=!0,B.length++;for(var R=O.cbsets.head;null!=R;){var F=R.elt;F.zip_listeners=!0,F.invalidate_pairs(),R=R.next}if(e)for(var j=O.interactors.head;null!=j;)j.elt.wake(),j=j.next;i=i.next}for(;null!=n;){for(var N=n.elt,G=null,U=N.listeners.head;null!=U;){var X=U.elt;if(t.precedence>X.precedence||t.precedence==X.precedence&&t.id>X.id)break;U=(G=U).next}var V,W=N.listeners;null==ir.zpp_pool?V=new ir:(V=ir.zpp_pool,ir.zpp_pool=V.next,V.next=null),V.elt=t;var H=V;null==G?(H.next=W.head,W.head=H):(H.next=G.next,G.next=H),W.pushmod=W.modified=!0,W.length++;for(var q=N.cbsets.head;null!=q;){var Y=q.elt;Y.zip_listeners=!0,Y.invalidate_pairs(),q=q.next}if(e)for(var K=N.interactors.head;null!=K;)K.elt.wake(),K=K.next;n=n.next}this.options1.handler=Z(this,this.cbtype_change1),this.options2.handler=Z(this,this.cbtype_change2),this.with_uniquesets(!0)},Re.prototype.removedFromSpace=function(){this.with_uniquesets(!1);for(var t=3==this.type,e=this.options1.includes.head,i=this.options2.includes.head;null!=e&&null!=i;){var n=e.elt,r=i.elt;if(n==r){n.listeners.remove(this);for(var s=n.cbsets.head;null!=s;){var o=s.elt;o.zip_listeners=!0,o.invalidate_pairs(),s=s.next}if(t)for(var a=n.interactors.head;null!=a;)a.elt.wake(),a=a.next;e=e.next,i=i.next}else if(n.id<r.id){n.listeners.remove(this);for(var l=n.cbsets.head;null!=l;){var p=l.elt;p.zip_listeners=!0,p.invalidate_pairs(),l=l.next}if(t)for(var h=n.interactors.head;null!=h;)h.elt.wake(),h=h.next;e=e.next}else{r.listeners.remove(this);for(var u=r.cbsets.head;null!=u;){var c=u.elt;c.zip_listeners=!0,c.invalidate_pairs(),u=u.next}if(t)for(var d=r.interactors.head;null!=d;)d.elt.wake(),d=d.next;i=i.next}}for(;null!=e;){var _=e.elt;_.listeners.remove(this);for(var y=_.cbsets.head;null!=y;){var f=y.elt;f.zip_listeners=!0,f.invalidate_pairs(),y=y.next}if(t)for(var m=_.interactors.head;null!=m;)m.elt.wake(),m=m.next;e=e.next}for(;null!=i;){var x=i.elt;x.listeners.remove(this);for(var v=x.cbsets.head;null!=v;){var g=v.elt;g.zip_listeners=!0,g.invalidate_pairs(),v=v.next}if(t)for(var b=x.interactors.head;null!=b;)b.elt.wake(),b=b.next;i=i.next}this.options1.handler=null,this.options2.handler=null},Re.prototype.invalidate_precedence=function(){var t=this;if(null!=this.space){for(var e=3==this.type,i=this.options1.includes.head,n=this.options2.includes.head;null!=i&&null!=n;){var r=i.elt,s=n.elt;if(r==s){r.listeners.remove(t);for(var o=r.cbsets.head;null!=o;){var a=o.elt;a.zip_listeners=!0,a.invalidate_pairs(),o=o.next}for(var l=null,p=r.listeners.head;null!=p;){var h=p.elt;if(t.precedence>h.precedence||t.precedence==h.precedence&&t.id>h.id)break;p=(l=p).next}var u,c=r.listeners;null==ir.zpp_pool?u=new ir:(u=ir.zpp_pool,ir.zpp_pool=u.next,u.next=null),u.elt=t;var d=u;null==l?(d.next=c.head,c.head=d):(d.next=l.next,l.next=d),c.pushmod=c.modified=!0,c.length++;for(var _=r.cbsets.head;null!=_;){var y=_.elt;y.zip_listeners=!0,y.invalidate_pairs(),_=_.next}if(e)for(var f=r.interactors.head;null!=f;)f.elt.wake(),f=f.next;i=i.next,n=n.next}else if(r.id<s.id){r.listeners.remove(t);for(var m=r.cbsets.head;null!=m;){var x=m.elt;x.zip_listeners=!0,x.invalidate_pairs(),m=m.next}for(var v=null,g=r.listeners.head;null!=g;){var b=g.elt;if(t.precedence>b.precedence||t.precedence==b.precedence&&t.id>b.id)break;g=(v=g).next}var z,w=r.listeners;null==ir.zpp_pool?z=new ir:(z=ir.zpp_pool,ir.zpp_pool=z.next,z.next=null),z.elt=t;c=z;null==v?(c.next=w.head,w.head=c):(c.next=v.next,v.next=c),w.pushmod=w.modified=!0,w.length++;for(var C=r.cbsets.head;null!=C;){var P=C.elt;P.zip_listeners=!0,P.invalidate_pairs(),C=C.next}if(e)for(var T=r.interactors.head;null!=T;)T.elt.wake(),T=T.next;i=i.next}else{s.listeners.remove(t);for(var S=s.cbsets.head;null!=S;){var M=S.elt;M.zip_listeners=!0,M.invalidate_pairs(),S=S.next}for(var A=null,O=s.listeners.head;null!=O;){var k=O.elt;if(t.precedence>k.precedence||t.precedence==k.precedence&&t.id>k.id)break;O=(A=O).next}var E,w=s.listeners;null==ir.zpp_pool?E=new ir:(E=ir.zpp_pool,ir.zpp_pool=E.next,E.next=null),E.elt=t;r=E;null==A?(r.next=w.head,w.head=r):(r.next=A.next,A.next=r),w.pushmod=w.modified=!0,w.length++;for(var I=s.cbsets.head;null!=I;){var D=I.elt;D.zip_listeners=!0,D.invalidate_pairs(),I=I.next}if(e)for(var B=s.interactors.head;null!=B;)B.elt.wake(),B=B.next;n=n.next}}for(;null!=i;){var L=i.elt;L.listeners.remove(t);for(var R=L.cbsets.head;null!=R;){var F=R.elt;F.zip_listeners=!0,F.invalidate_pairs(),R=R.next}for(var j=null,N=L.listeners.head;null!=N;){var G=N.elt;if(t.precedence>G.precedence||t.precedence==G.precedence&&t.id>G.id)break;N=(j=N).next}var U,X=L.listeners;null==ir.zpp_pool?U=new ir:(U=ir.zpp_pool,ir.zpp_pool=U.next,U.next=null),U.elt=t;var V=U;null==j?(V.next=X.head,X.head=V):(V.next=j.next,j.next=V),X.pushmod=X.modified=!0,X.length++;for(var W=L.cbsets.head;null!=W;){var H=W.elt;H.zip_listeners=!0,H.invalidate_pairs(),W=W.next}if(e)for(var q=L.interactors.head;null!=q;)q.elt.wake(),q=q.next;i=i.next}for(;null!=n;){var Y=n.elt;Y.listeners.remove(t);for(var K=Y.cbsets.head;null!=K;){var Z=K.elt;Z.zip_listeners=!0,Z.invalidate_pairs(),K=K.next}for(var J=null,Q=Y.listeners.head;null!=Q;){var $=Q.elt;if(t.precedence>$.precedence||t.precedence==$.precedence&&t.id>$.id)break;Q=(J=Q).next}var tt,et=Y.listeners;null==ir.zpp_pool?tt=new ir:(tt=ir.zpp_pool,ir.zpp_pool=tt.next,tt.next=null),tt.elt=t;var it=tt;null==J?(it.next=et.head,et.head=it):(it.next=J.next,J.next=it),et.pushmod=et.modified=!0,et.length++;for(var nt=Y.cbsets.head;null!=nt;){var rt=nt.elt;rt.zip_listeners=!0,rt.invalidate_pairs(),nt=nt.next}if(e)for(var st=Y.interactors.head;null!=st;)st.elt.wake(),st=st.next;n=n.next}}},Re.prototype.cbtype_change1=function(t,e,i){this.cbtype_change(this.options1,t,e,i)},Re.prototype.cbtype_change2=function(t,e,i){this.cbtype_change(this.options2,t,e,i)},Re.prototype.cbtype_change=function(t,e,i,n){if(this.removedFromSpace(),i)if(n){for(var r=null,s=t.includes.head;null!=s&&!(e.id<s.elt.id);)s=(r=s).next;i=t.includes;null==Ui.zpp_pool?o=new Ui:(o=Ui.zpp_pool,Ui.zpp_pool=o.next,o.next=null),o.elt=e;var o=o;null==r?(o.next=i.head,i.head=o):(o.next=r.next,r.next=o),i.pushmod=i.modified=!0,i.length++}else t.includes.remove(e);else if(n){for(var a=null,l=t.excludes.head;null!=l&&!(e.id<l.elt.id);)l=(a=l).next;n=t.excludes;null==Ui.zpp_pool?p=new Ui:(p=Ui.zpp_pool,Ui.zpp_pool=p.next,p.next=null),p.elt=e;var p=p;null==a?(p.next=n.head,n.head=p):(p.next=a.next,a.next=p),n.pushmod=n.modified=!0,n.length++}else t.excludes.remove(e);this.addedToSpace()},Re.prototype.swapEvent=function(t){this.removedFromSpace(),this.event=t,this.addedToSpace()},Re.prototype.__class__=Re;var It=zpp_nape.callbacks.ZPP_OptionType=function(){this.wrap_excludes=null,this.wrap_includes=null,this.excludes=null,this.includes=null,this.handler=null,this.outer=null,this.includes=new Et,this.excludes=new Et};It.__name__=["zpp_nape","callbacks","ZPP_OptionType"],It.argument=function(t){return null==t?new v:F.__instanceof(t,v)?t:(new v).including(t)},It.prototype.outer=null,It.prototype.handler=null,It.prototype.includes=null,It.prototype.excludes=null,It.prototype.wrap_includes=null,It.prototype.wrap_excludes=null,It.prototype.setup_includes=function(){this.wrap_includes=Sn.get(this.includes,!0)},It.prototype.setup_excludes=function(){this.wrap_excludes=Sn.get(this.excludes,!0)},It.prototype.excluded=function(t){return this.nonemptyintersection(t,this.excludes)},It.prototype.included=function(t){return this.nonemptyintersection(t,this.includes)},It.prototype.compatible=function(t){return!!this.nonemptyintersection(t,this.includes)&&!this.nonemptyintersection(t,this.excludes)},It.prototype.nonemptyintersection=function(t,e){for(var i=!1,n=t.head,r=e.head;null!=r&&null!=n;){var s=r.elt,o=n.elt;if(s==o){i=!0;break}s.id<o.id?r=r.next:n=n.next}return i},It.prototype.effect_change=function(t,e,i){if(e)if(i){for(var n=null,r=this.includes.head;null!=r&&!(t.id<r.elt.id);)r=(n=r).next;e=this.includes;null==Ui.zpp_pool?s=new Ui:(s=Ui.zpp_pool,Ui.zpp_pool=s.next,s.next=null),s.elt=t;var s=s;null==n?(s.next=e.head,e.head=s):(s.next=n.next,n.next=s),e.pushmod=e.modified=!0,e.length++}else this.includes.remove(t);else if(i){for(var o=null,a=this.excludes.head;null!=a&&!(t.id<a.elt.id);)a=(o=a).next;i=this.excludes;null==Ui.zpp_pool?l=new Ui:(l=Ui.zpp_pool,Ui.zpp_pool=l.next,l.next=null),l.elt=t;var l=l;null==o?(l.next=i.head,i.head=l):(l.next=o.next,o.next=l),i.pushmod=i.modified=!0,i.length++}else this.excludes.remove(t)},It.prototype.append_type=function(t,e){if(t==this.includes){if(!this.includes.has(e))if(this.excludes.has(e))null!=this.handler?this.handler(e,!1,!1):this.excludes.remove(e);else if(null!=this.handler)this.handler(e,!0,!0);else{for(var i=null,n=this.includes.head;null!=n&&!(e.id<n.elt.id);)n=(i=n).next;var r=this.includes;null==Ui.zpp_pool?s=new Ui:(s=Ui.zpp_pool,Ui.zpp_pool=s.next,s.next=null),s.elt=e;var s=s;null==i?(s.next=r.head,r.head=s):(s.next=i.next,i.next=s),r.pushmod=r.modified=!0,r.length++}}else if(!this.excludes.has(e))if(this.includes.has(e))null!=this.handler?this.handler(e,!0,!1):this.includes.remove(e);else if(null!=this.handler)this.handler(e,!1,!0);else{for(var o=null,a=this.excludes.head;null!=a&&!(e.id<a.elt.id);)a=(o=a).next;r=this.excludes;null==Ui.zpp_pool?l=new Ui:(l=Ui.zpp_pool,Ui.zpp_pool=l.next,l.next=null),l.elt=e;var l=l;null==o?(l.next=r.head,r.head=l):(l.next=o.next,o.next=l),r.pushmod=r.modified=!0,r.length++}},It.prototype.set=function(t){if(t!=this){for(;null!=this.includes.head;)this.append_type(this.excludes,this.includes.head.elt);for(;null!=this.excludes.head;)this.append_type(this.includes,this.excludes.head.elt);for(var e=t.excludes.head;null!=e;)this.append_type(this.excludes,e.elt),e=e.next;for(var i=t.includes.head;null!=i;)this.append_type(this.includes,i.elt),i=i.next}return this},It.prototype.append=function(t,e){if(F.__instanceof(e,u))this.append_type(t,e.zpp_inner);else if(F.__instanceof(e,c)){var i=e;i.zpp_inner.valmod();for(var n=Xt.get(i);;){n.zpp_inner.zpp_inner.valmod();var r=n.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);r=r.zpp_inner.user_length;if(n.zpp_critical=!0,!(n.zpp_i<r||(n.zpp_next=Xt.zpp_pool,(Xt.zpp_pool=n).zpp_inner=null,!1)))break;n.zpp_critical=!1,this.append_type(t,n.zpp_inner.at(n.zpp_i++).zpp_inner)}}else if(e instanceof Array&&null==e.__enum__)for(var s=e,o=0;o<s.length;){var a=s[o];++o;this.append_type(t,a.zpp_inner)}},It.prototype.__class__=It;var Dt=zpp_nape.constraint.ZPP_Constraint=function(){this.pre_dt=0,this.wrap_cbTypes=null,this.cbSet=null,this.cbTypes=null,this.__velocity=!1,this.ignore=!1,this.component=null,this.removeOnBreak=!1,this.breakUnderError=!1,this.breakUnderForce=!1,this.maxError=0,this.maxForce=0,this.damping=0,this.frequency=0,this.stiff=!1,this.active=!1,this.space=null,this.compound=null,this.userData=null,this.id=0,this.outer=null,this.__velocity=!1,this.id=vt.Constraint(),this.stiff=!0,this.active=!0,this.ignore=!1,this.frequency=10,this.damping=1,this.maxForce=1/0,this.maxError=1/0,this.breakUnderForce=!1,this.removeOnBreak=!0,this.pre_dt=-1,this.cbTypes=new Et};Dt.__name__=["zpp_nape","constraint","ZPP_Constraint"],Dt.prototype.outer=null,Dt.prototype.clear=function(){},Dt.prototype.id=null,Dt.prototype.userData=null,Dt.prototype.compound=null,Dt.prototype.space=null,Dt.prototype.active=null,Dt.prototype.stiff=null,Dt.prototype.frequency=null,Dt.prototype.damping=null,Dt.prototype.maxForce=null,Dt.prototype.maxError=null,Dt.prototype.breakUnderForce=null,Dt.prototype.breakUnderError=null,Dt.prototype.removeOnBreak=null,Dt.prototype.component=null,Dt.prototype.ignore=null,Dt.prototype.__velocity=null,Dt.prototype.immutable_midstep=function(t){},Dt.prototype.cbTypes=null,Dt.prototype.cbSet=null,Dt.prototype.wrap_cbTypes=null,Dt.prototype.setupcbTypes=function(){this.wrap_cbTypes=Sn.get(this.cbTypes),this.wrap_cbTypes.zpp_inner.adder=Z(this,this.wrap_cbTypes_adder),this.wrap_cbTypes.zpp_inner.subber=Z(this,this.wrap_cbTypes_subber),this.wrap_cbTypes.zpp_inner.dontremove=!0},Dt.prototype.wrap_cbTypes_subber=function(t){t=t.zpp_inner;this.cbTypes.has(t)&&(null!=this.space&&(this.dealloc_cbSet(),t.constraints.remove(this)),this.cbTypes.remove(t),null!=this.space&&(this.alloc_cbSet(),this.wake()))},Dt.prototype.wrap_cbTypes_adder=function(t){return this.insert_cbtype(t.zpp_inner),!1},Dt.prototype.insert_cbtype=function(t){if(!this.cbTypes.has(t)){null!=this.space&&(this.dealloc_cbSet(),t.constraints.add(this));for(var e=null,i=this.cbTypes.head;null!=i&&!(t.id<i.elt.id);)i=(e=i).next;var n=this.cbTypes;null==Ui.zpp_pool?r=new Ui:(r=Ui.zpp_pool,Ui.zpp_pool=r.next,r.next=null),r.elt=t;var r=r;null==e?(r.next=n.head,n.head=r):(r.next=e.next,e.next=r),n.pushmod=n.modified=!0,n.length++,null!=this.space&&(this.alloc_cbSet(),this.wake())}},Dt.prototype.alloc_cbSet=function(){null!=(this.cbSet=this.space.cbsets.get(this.cbTypes))&&(this.cbSet.count++,this.cbSet.constraints.add(this))},Dt.prototype.dealloc_cbSet=function(){if(null!=this.cbSet){if(this.cbSet.constraints.remove(this),0==--this.cbSet.count){this.space.cbsets.remove(this.cbSet);var t=this.cbSet;for(t.listeners.clear(),t.zip_listeners=!0,t.bodylisteners.clear(),t.zip_bodylisteners=!0,t.conlisteners.clear(),t.zip_conlisteners=!0;null!=t.cbTypes.head;)t.cbTypes.pop_unsafe().cbsets.remove(t);t.next=Hn.zpp_pool,Hn.zpp_pool=t}this.cbSet=null}},Dt.prototype.activate=function(){null!=this.space&&this.activeInSpace()},Dt.prototype.deactivate=function(){null!=this.space&&this.inactiveOrOutSpace()},Dt.prototype.addedToSpace=function(){this.active&&this.activeInSpace(),this.activeBodies();for(var t=this.cbTypes.head;null!=t;)t.elt.constraints.add(this),t=t.next},Dt.prototype.removedFromSpace=function(){this.active&&this.inactiveOrOutSpace(),this.inactiveBodies();for(var t=this.cbTypes.head;null!=t;)t.elt.constraints.remove(this),t=t.next},Dt.prototype.activeInSpace=function(){this.alloc_cbSet(),null==ti.zpp_pool?this.component=new ti:(this.component=ti.zpp_pool,ti.zpp_pool=this.component.next,this.component.next=null),this.component.isBody=!1,this.component.constraint=this},Dt.prototype.inactiveOrOutSpace=function(){this.dealloc_cbSet();var t=this.component;t.body=null,t.constraint=null,t.next=ti.zpp_pool,ti.zpp_pool=t,this.component=null},Dt.prototype.activeBodies=function(){},Dt.prototype.inactiveBodies=function(){},Dt.prototype.clearcache=function(){},Dt.prototype.validate=function(){},Dt.prototype.wake_connected=function(){},Dt.prototype.forest=function(){},Dt.prototype.pair_exists=function(t,e){return!1},Dt.prototype.broken=function(){},Dt.prototype.warmStart=function(){},Dt.prototype.pre_dt=null,Dt.prototype.preStep=function(t){return!1},Dt.prototype.applyImpulseVel=function(){return!1},Dt.prototype.applyImpulsePos=function(){return!1},Dt.prototype.wake=function(){null!=this.space&&this.space.wake_constraint(this)},Dt.prototype.draw=function(t){},Dt.prototype.copy=function(t,e){return null},Dt.prototype.copyto=function(t){var e=this.outer;null==e.zpp_inner.wrap_cbTypes&&e.zpp_inner.setupcbTypes();var i=e.zpp_inner.wrap_cbTypes;i.zpp_inner.valmod();for(var n=Xt.get(i);;){n.zpp_inner.zpp_inner.valmod();var r=n.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var s=r.zpp_inner.user_length;if(n.zpp_critical=!0,!(n.zpp_i<s||(n.zpp_next=Xt.zpp_pool,(Xt.zpp_pool=n).zpp_inner=null,!1)))break;n.zpp_critical=!1;r=n.zpp_inner.at(n.zpp_i++);null==t.zpp_inner.wrap_cbTypes&&t.zpp_inner.setupcbTypes();s=t.zpp_inner.wrap_cbTypes;s.zpp_inner.reverse_flag?s.push(r):s.unshift(r)}t.zpp_inner.removeOnBreak=e.zpp_inner.removeOnBreak;i=e.zpp_inner.breakUnderError;t.zpp_inner.breakUnderError!=i&&(t.zpp_inner.breakUnderError=i,t.zpp_inner.wake());i=e.zpp_inner.breakUnderForce;t.zpp_inner.breakUnderForce!=i&&(t.zpp_inner.breakUnderForce=i,t.zpp_inner.wake());i=e.zpp_inner.maxError;t.zpp_inner.maxError!=i&&(t.zpp_inner.maxError=i,t.zpp_inner.wake());i=e.zpp_inner.maxForce;t.zpp_inner.maxForce!=i&&(t.zpp_inner.maxForce=i,t.zpp_inner.wake());i=e.zpp_inner.damping;t.zpp_inner.damping!=i&&(t.zpp_inner.damping=i,t.zpp_inner.stiff||t.zpp_inner.wake());i=e.zpp_inner.frequency;t.zpp_inner.frequency!=i&&(t.zpp_inner.frequency=i,t.zpp_inner.stiff||t.zpp_inner.wake());i=e.zpp_inner.stiff;t.zpp_inner.stiff!=i&&(t.zpp_inner.stiff=i,t.zpp_inner.wake());i=e.zpp_inner.ignore;t.zpp_inner.ignore!=i&&(t.zpp_inner.ignore=i,t.zpp_inner.wake());e=e.zpp_inner.active;t.zpp_inner.active!=e&&(null!=t.zpp_inner.component&&(t.zpp_inner.component.woken=!1),t.zpp_inner.clearcache(),e?(t.zpp_inner.active=e,t.zpp_inner.activate(),null!=t.zpp_inner.space&&(null!=t.zpp_inner.component&&(t.zpp_inner.component.sleeping=!0),t.zpp_inner.space.wake_constraint(t.zpp_inner,!0))):(null!=t.zpp_inner.space&&(t.zpp_inner.wake(),t.zpp_inner.space.live_constraints.remove(t.zpp_inner)),t.zpp_inner.active=e,t.zpp_inner.deactivate()))},Dt.prototype.__class__=Dt;var Bt=zpp_nape.constraint.ZPP_AngleJoint=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.b2=null,this.b1=null,this.scale=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.ratio=0,this.outer_zn=null,Dt.call(this),this.ratio=1,this.jAcc=0,this.slack=!1,this.jMax=1/0,this.stepped=!1};Bt.__name__=["zpp_nape","constraint","ZPP_AngleJoint"],Bt.__super__=Dt,Bt.prototype=Object.create(Dt.prototype),Bt.prototype.outer_zn=null,Bt.prototype.ratio=null,Bt.prototype.jointMin=null,Bt.prototype.jointMax=null,Bt.prototype.slack=null,Bt.prototype.equal=null,Bt.prototype.scale=null,Bt.prototype.is_slack=function(){var t,e=this.ratio*this.b2.rot-this.b1.rot;return this.equal?(t=!1,this.scale=1):t=e<this.jointMin?!(this.scale=-1):e>this.jointMax?(e-=this.jointMax,!(this.scale=1)):!(e=this.scale=0),t},Bt.prototype.bodyImpulse=function(t){return this.stepped?t==this.b1?K.get(0,0,-this.scale*this.jAcc):K.get(0,0,this.ratio*this.scale*this.jAcc):K.get(0,0,0)},Bt.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},Bt.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},Bt.prototype.b1=null,Bt.prototype.b2=null,Bt.prototype.kMass=null,Bt.prototype.jAcc=null,Bt.prototype.jMax=null,Bt.prototype.gamma=null,Bt.prototype.bias=null,Bt.prototype.stepped=null,Bt.prototype.copy=function(t,e){var i=new z(null,null,this.jointMin,this.jointMax,this.ratio);if(this.copyto(i),null!=t&&null!=this.b1){for(var n=null,r=0;r<t.length;){var s=t[r];if(++r,s.id==this.b1.id){n=s.bc;break}}null!=n?i.zpp_inner_zn.b1=n.zpp_inner:e.push(Lt.todo(this.b1.id,function(t){i.zpp_inner_zn.b1=t.zpp_inner}))}if(null!=t&&null!=this.b2){for(var o=null,a=0;a<t.length;){var l=t[a];if(++a,l.id==this.b2.id){o=l.bc;break}}null!=o?i.zpp_inner_zn.b2=o.zpp_inner:e.push(Lt.todo(this.b2.id,function(t){i.zpp_inner_zn.b2=t.zpp_inner}))}return i},Bt.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new r("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new r("Error: AngleJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new r("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(this.jointMin>this.jointMax)throw new r("Error: AngleJoint must have jointMin <= jointMax");if(2!=this.b1.type&&2!=this.b2.type)throw new r("Error: Constraints cannot have both bodies non-dynamic")},Bt.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},Bt.prototype.forest=function(){if(2==this.b1.type){var t,e;if(this.b1.component==this.b1.component.parent)t=this.b1.component;else{for(var i=this.b1.component,n=null;i!=i.parent;){var r=i.parent;i.parent=n,n=i,i=r}for(;null!=n;){var s=n.parent;n.parent=i,n=s}t=i}if(this.component==this.component.parent)e=this.component;else{for(var o=this.component,a=null;o!=o.parent;){var l=o.parent;o.parent=a,a=o,o=l}for(;null!=a;){var p=a.parent;a.parent=o,a=p}e=o}t!=e&&(t.rank<e.rank?t.parent=e:t.rank>e.rank?e.parent=t:(e.parent=t).rank++)}if(2==this.b2.type){var h,u;if(this.b2.component==this.b2.component.parent)h=this.b2.component;else{for(var c=this.b2.component,d=null;c!=c.parent;){var _=c.parent;c.parent=d,d=c,c=_}for(;null!=d;){var y=d.parent;d.parent=c,d=y}h=c}if(this.component==this.component.parent)u=this.component;else{for(var f=this.component,m=null;f!=f.parent;){var x=f.parent;f.parent=m,m=f,f=x}for(;null!=m;){var v=m.parent;m.parent=f,m=v}u=f}h!=u&&(h.rank<u.rank?h.parent=u:h.rank>u.rank?u.parent=h:(u.parent=h).rank++)}},Bt.prototype.pair_exists=function(t,e){return this.b1.id==t&&this.b2.id==e||this.b1.id==e&&this.b2.id==t},Bt.prototype.clearcache=function(){this.jAcc=0,this.pre_dt=-1,this.slack=!1},Bt.prototype.preStep=function(t){-1==this.pre_dt&&(this.pre_dt=t);var e=t/this.pre_dt;this.pre_dt=t,this.stepped=!0,this.equal=this.jointMin==this.jointMax;var i=this.ratio*this.b2.rot-this.b1.rot;this.equal?(i-=this.jointMax,this.slack=!1,this.scale=1):i<this.jointMin?(i=this.jointMin-i,this.scale=-1,this.slack=!1):i>this.jointMax?(i-=this.jointMax,this.scale=1,this.slack=!1):(i=this.scale=0,this.slack=!0);var n=i;if(!this.slack){if(this.kMass=this.b1.sinertia+this.ratio*this.ratio*this.b2.sinertia,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&n*n>this.maxError*this.maxError)return!0;var r=2*Math.PI*this.frequency;this.gamma=1/(t*r*(2*this.damping+r*t));i=1/(1+this.gamma),r=t*r*r*this.gamma;this.gamma*=i,this.kMass*=i,this.bias=-n*r,this.bias<-this.maxError?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=e,this.jMax=this.maxForce*t}return!1},Bt.prototype.warmStart=function(){this.slack||(this.b1.angvel-=this.scale*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.ratio*this.scale*this.b2.iinertia*this.jAcc)},Bt.prototype.applyImpulseVel=function(){if(this.slack)return!1;var t=this.kMass*(this.bias-this.scale*(this.ratio*(this.b2.angvel+this.b2.kinangvel)-this.b1.angvel-this.b1.kinangvel))-this.jAcc*this.gamma,e=this.jAcc;return this.jAcc+=t,!this.equal&&0<this.jAcc&&(this.jAcc=0),!(!this.breakUnderForce||!(this.jAcc>this.jMax||this.jAcc<-this.jMax))||(this.stiff||(this.jAcc>this.jMax?this.jAcc=this.jMax:this.jAcc<-this.jMax&&(this.jAcc=-this.jMax)),t=this.jAcc-e,this.b1.angvel-=this.scale*this.b1.iinertia*t,this.b2.angvel+=this.ratio*this.scale*this.b2.iinertia*t,!1)},Bt.prototype.applyImpulsePos=function(){var t=this.ratio*this.b2.rot-this.b1.rot;if(this.equal?(t-=this.jointMax,i=!1,this.scale=1):i=t<this.jointMin?(t=this.jointMin-t,!(this.scale=-1)):t>this.jointMax?(t-=this.jointMax,!(this.scale=1)):!(t=this.scale=0),e=t,!i){if(this.breakUnderError&&e*e>this.maxError*this.maxError)return!0;var e,i,n,r,s=-(e*=.5)*this.kMass;(this.equal||s<0)&&(t=this.b1,i=-this.scale*s*this.b1.iinertia,t.rot+=i,1e-4<i*i?(t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)):(n=1-(r=i*i)*r/8,r=((e=1-.5*r)*t.axisx+i*t.axisy)*n,t.axisy=(e*t.axisy-i*t.axisx)*n,t.axisx=r),i=this.b2,n=this.ratio*this.scale*s*this.b2.iinertia,i.rot+=n,1e-4<n*n?(i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot)):(r=1-(t=n*n)*t/8,t=((s=1-.5*t)*i.axisx+n*i.axisy)*r,i.axisy=(s*i.axisy-n*i.axisx)*r,i.axisx=t))}return!1},Bt.prototype.draw=function(t){},Bt.prototype.__class__=Bt;var Lt=zpp_nape.constraint.ZPP_CopyHelper=function(){this.cb=null,this.bc=null,this.id=0};Lt.__name__=["zpp_nape","constraint","ZPP_CopyHelper"],Lt.dict=function(t,e){var i=new Lt;return i.id=t,i.bc=e,i},Lt.todo=function(t,e){var i=new Lt;return i.id=t,i.cb=e,i},Lt.prototype.id=null,Lt.prototype.bc=null,Lt.prototype.cb=null,Lt.prototype.__class__=Lt;var Rt=zpp_nape.constraint.ZPP_DistanceJoint=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.cx2=0,this.cx1=0,this.ny=0,this.nx=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.outer_zn=null,Dt.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.jAcc=0,this.jMax=1/0,this.stepped=!1,this.cx1=this.cx2=0};Rt.__name__=["zpp_nape","constraint","ZPP_DistanceJoint"],Rt.__super__=Dt,Rt.prototype=Object.create(Dt.prototype),Rt.prototype.outer_zn=null,Rt.prototype.jointMin=null,Rt.prototype.jointMax=null,Rt.prototype.slack=null,Rt.prototype.equal=null,Rt.prototype.is_slack=function(){this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var t,e=0,i=0,n=(e=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx))*e+(i=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely))*i;return n<kr.epsilon||(e*=t=1/(n=Math.sqrt(n)),i*=t,!this.equal&&(!(n<this.jointMin)&&(n>this.jointMax?(n-=this.jointMax,!1):!(n=0))))},Rt.prototype.nx=null,Rt.prototype.ny=null,Rt.prototype.cx1=null,Rt.prototype.cx2=null,Rt.prototype.bodyImpulse=function(t){return this.stepped?t==this.b1?K.get(-this.jAcc*this.nx,-this.jAcc*this.ny,-this.cx1*this.jAcc):K.get(this.jAcc*this.nx,this.jAcc*this.ny,this.cx2*this.jAcc):K.get(0,0,0)},Rt.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},Rt.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},Rt.prototype.b1=null,Rt.prototype.a1localx=null,Rt.prototype.a1localy=null,Rt.prototype.a1relx=null,Rt.prototype.a1rely=null,Rt.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},Rt.prototype.invalidate_a1=function(t){this.immutable_midstep("Constraint::a1"),this.a1localx=t.x,this.a1localy=t.y,this.wake()},Rt.prototype.setup_a1=function(){var t,e,i=this.a1localx,n=this.a1localy;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_a1=t,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=Z(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=Z(this,this.invalidate_a1)},Rt.prototype.wrap_a1=null,Rt.prototype.b2=null,Rt.prototype.a2localx=null,Rt.prototype.a2localy=null,Rt.prototype.a2relx=null,Rt.prototype.a2rely=null,Rt.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},Rt.prototype.invalidate_a2=function(t){this.immutable_midstep("Constraint::a2"),this.a2localx=t.x,this.a2localy=t.y,this.wake()},Rt.prototype.setup_a2=function(){var t,e,i=this.a2localx,n=this.a2localy;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_a2=t,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=Z(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=Z(this,this.invalidate_a2)},Rt.prototype.wrap_a2=null,Rt.prototype.kMass=null,Rt.prototype.jAcc=null,Rt.prototype.jMax=null,Rt.prototype.gamma=null,Rt.prototype.bias=null,Rt.prototype.stepped=null,Rt.prototype.copy=function(t,e){var i=this.outer_zn;null==i.zpp_inner_zn.wrap_a1&&i.zpp_inner_zn.setup_a1();var n=i.zpp_inner_zn.wrap_a1,i=this.outer_zn;null==i.zpp_inner_zn.wrap_a2&&i.zpp_inner_zn.setup_a2();var r=new C(null,null,n,i.zpp_inner_zn.wrap_a2,this.jointMin,this.jointMax);if(this.copyto(r),null!=t&&null!=this.b1){for(var s=null,o=0;o<t.length;){var a=t[o];if(++o,a.id==this.b1.id){s=a.bc;break}}null!=s?r.zpp_inner_zn.b1=s.zpp_inner:e.push(Lt.todo(this.b1.id,function(t){r.zpp_inner_zn.b1=t.zpp_inner}))}if(null!=t&&null!=this.b2){for(var l=null,p=0;p<t.length;){var h=t[p];if(++p,h.id==this.b2.id){l=h.bc;break}}null!=l?r.zpp_inner_zn.b2=l.zpp_inner:e.push(Lt.todo(this.b2.id,function(t){r.zpp_inner_zn.b2=t.zpp_inner}))}return r},Rt.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new r("Error: DistanceJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new r("Error: DistanceJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new r("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(this.jointMin>this.jointMax)throw new r("Error: DistanceJoint must have jointMin <= jointMax");if(2!=this.b1.type&&2!=this.b2.type)throw new r("Error: Constraints cannot have both bodies non-dynamic")},Rt.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},Rt.prototype.forest=function(){if(2==this.b1.type){var t,e;if(this.b1.component==this.b1.component.parent)t=this.b1.component;else{for(var i=this.b1.component,n=null;i!=i.parent;){var r=i.parent;i.parent=n,n=i,i=r}for(;null!=n;){var s=n.parent;n.parent=i,n=s}t=i}if(this.component==this.component.parent)e=this.component;else{for(var o=this.component,a=null;o!=o.parent;){var l=o.parent;o.parent=a,a=o,o=l}for(;null!=a;){var p=a.parent;a.parent=o,a=p}e=o}t!=e&&(t.rank<e.rank?t.parent=e:t.rank>e.rank?e.parent=t:(e.parent=t).rank++)}if(2==this.b2.type){var h,u;if(this.b2.component==this.b2.component.parent)h=this.b2.component;else{for(var c=this.b2.component,d=null;c!=c.parent;){var _=c.parent;c.parent=d,d=c,c=_}for(;null!=d;){var y=d.parent;d.parent=c,d=y}h=c}if(this.component==this.component.parent)u=this.component;else{for(var f=this.component,m=null;f!=f.parent;){var x=f.parent;f.parent=m,m=f,f=x}for(;null!=m;){var v=m.parent;m.parent=f,m=v}u=f}h!=u&&(h.rank<u.rank?h.parent=u:h.rank>u.rank?u.parent=h:(u.parent=h).rank++)}},Rt.prototype.pair_exists=function(t,e){return this.b1.id==t&&this.b2.id==e||this.b1.id==e&&this.b2.id==t},Rt.prototype.clearcache=function(){this.jAcc=0,this.pre_dt=-1},Rt.prototype.preStep=function(t){-1==this.pre_dt&&(this.pre_dt=t);var e=t/this.pre_dt;this.pre_dt=t,this.stepped=!0,this.equal=this.jointMin==this.jointMax,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.nx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.ny=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely);var i=this.nx*this.nx+this.ny*this.ny;i<kr.epsilon?(this.nx=0,i=this.ny=0,this.slack=!0):(r=1/(i=Math.sqrt(i)),this.nx*=r,this.ny*=r,this.equal?(i-=this.jointMax,this.slack=!1):i<this.jointMin?(i=this.jointMin-i,this.nx=-this.nx,this.ny=-this.ny,this.slack=!1):i>this.jointMax?(i-=this.jointMax,this.slack=!1):(this.nx=0,i=this.ny=0,this.slack=!0));var n=i;if(!this.slack){if(this.cx1=this.ny*this.a1relx-this.nx*this.a1rely,this.cx2=this.ny*this.a2relx-this.nx*this.a2rely,this.kMass=this.b1.smass+this.b2.smass+this.cx1*this.cx1*this.b1.sinertia+this.cx2*this.cx2*this.b2.sinertia,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&n*n>this.maxError*this.maxError)return!0;var r=2*Math.PI*this.frequency;this.gamma=1/(t*r*(2*this.damping+r*t));i=1/(1+this.gamma),r=t*r*r*this.gamma;this.gamma*=i,this.kMass*=i,this.bias=-n*r,this.bias<-this.maxError?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=e,this.jMax=this.maxForce*t}return!1},Rt.prototype.warmStart=function(){var t;this.slack||(t=this.b1.imass*this.jAcc,this.b1.velx-=this.nx*t,this.b1.vely-=this.ny*t,t=this.b2.imass*this.jAcc,this.b2.velx+=this.nx*t,this.b2.vely+=this.ny*t,this.b1.angvel-=this.cx1*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.cx2*this.b2.iinertia*this.jAcc)},Rt.prototype.applyImpulseVel=function(){if(this.slack)return!1;var t=this.kMass*(this.bias-(this.nx*(this.b2.velx+this.b2.kinvelx-this.b1.velx-this.b1.kinvelx)+this.ny*(this.b2.vely+this.b2.kinvely-this.b1.vely-this.b1.kinvely)+(this.b2.angvel+this.b2.kinangvel)*this.cx2-(this.b1.angvel+this.b1.kinangvel)*this.cx1))-this.jAcc*this.gamma,e=this.jAcc;if(this.jAcc+=t,!this.equal&&0<this.jAcc&&(this.jAcc=0),this.breakUnderForce&&this.jAcc<-this.jMax)return!0;this.stiff||this.jAcc<-this.jMax&&(this.jAcc=-this.jMax),t=this.jAcc-e;e=this.b1.imass*t;this.b1.velx-=this.nx*e,this.b1.vely-=this.ny*e;e=this.b2.imass*t;return this.b2.velx+=this.nx*e,this.b2.vely+=this.ny*e,this.b1.angvel-=this.cx1*this.b1.iinertia*t,this.b2.angvel+=this.cx2*this.b2.iinertia*t,!1},Rt.prototype.applyImpulsePos=function(){var t=0,e=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,t=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,i=0,n=0,i=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,n=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,r=0,s=0,o=(r=this.b2.posx+i-(this.b1.posx+e))*r+(s=this.b2.posy+n-(this.b1.posy+t))*s,a=o<kr.epsilon?!(o=s=r=0):(r*=l=1/(o=Math.sqrt(o)),s*=l,this.equal?(o-=this.jointMax,!1):o<this.jointMin?(o=this.jointMin-o,r=-r,s=-s,!1):o>this.jointMax?(o-=this.jointMax,!1):!(o=s=r=0)),l=o;if(!a){if(this.breakUnderError&&l*l>this.maxError*this.maxError)return!0;if(l*l<kr.constraintLinearSlop*kr.constraintLinearSlop)return!1;6<(l*=.5)*l&&((o=this.b1.smass+this.b2.smass)>kr.epsilon&&(h=-l*(o=.75/o),(this.equal||h<0)&&(a=h*this.b1.imass,this.b1.posx-=r*a,this.b1.posy-=s*a,o=h*this.b2.imass,this.b2.posx+=r*o,this.b2.posy+=s*o,(a=(r=this.b2.posx+i-(this.b1.posx+e))*r+(s=this.b2.posy+n-(this.b1.posy+t))*s)<kr.epsilon?a=s=r=0:(r*=o=1/(a=Math.sqrt(a)),s*=o,this.equal?a-=this.jointMax:a<this.jointMin?(a=this.jointMin-a,r=-r,s=-s):a>this.jointMax?a-=this.jointMax:a=s=r=0),l=a,l*=.5))),t=s*e-r*t,i=s*i-r*n;var p,h,u,n=this.b1.smass+this.b2.smass+t*t*this.b1.sinertia+i*i*this.b2.sinertia;0!=n&&(n=1/n),h=-l*n,(this.equal||h<0)&&(n=this.b1.imass*h,this.b1.posx-=r*n,this.b1.posy-=s*n,n=this.b2.imass*h,this.b2.posx+=r*n,this.b2.posy+=s*n,s=this.b1,n=-t*this.b1.iinertia*h,s.rot+=n,1e-4<n*n?(s.axisx=Math.sin(s.rot),s.axisy=Math.cos(s.rot)):(p=1-(u=n*n)*u/8,u=((t=1-.5*u)*s.axisx+n*s.axisy)*p,s.axisy=(t*s.axisy-n*s.axisx)*p,s.axisx=u),p=this.b2,s=i*this.b2.iinertia*h,p.rot+=s,1e-4<s*s?(p.axisx=Math.sin(p.rot),p.axisy=Math.cos(p.rot)):(i=1-(u=s*s)*u/8,u=((h=1-.5*u)*p.axisx+s*p.axisy)*i,p.axisy=(h*p.axisy-s*p.axisx)*i,p.axisx=u))}return!1},Rt.prototype.draw=function(t){},Rt.prototype.__class__=Rt;var Ft=zpp_nape.constraint.ZPP_LineJoint=function(){this.biasy=0,this.biasx=0,this.jAccy=0,this.jAccx=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_n=null,this.nrely=0,this.nrelx=0,this.nlocaly=0,this.nlocalx=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.cx2=0,this.cx1=0,this.dot2=0,this.dot1=0,this.equal=!1,this.jointMax=0,this.jointMin=0,this.scale=0,this.outer_zn=null,Dt.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.nlocalx=0,this.nlocaly=0,this.nrelx=0,this.nrely=0,this.jAccx=0,this.jAccy=0,this.jMax=1/0,this.jointMin=-1/0,this.jointMax=1/0,this.stepped=!1};Ft.__name__=["zpp_nape","constraint","ZPP_LineJoint"],Ft.__super__=Dt,Ft.prototype=Object.create(Dt.prototype),Ft.prototype.outer_zn=null,Ft.prototype.scale=null,Ft.prototype.jointMin=null,Ft.prototype.jointMax=null,Ft.prototype.equal=null,Ft.prototype.dot1=null,Ft.prototype.dot2=null,Ft.prototype.cx1=null,Ft.prototype.cx2=null,Ft.prototype.bodyImpulse=function(t){if(this.stepped){var e=this.scale*this.nrelx*this.jAccy-this.nrely*this.jAccx,i=this.nrelx*this.jAccx+this.scale*this.nrely*this.jAccy;return t==this.b1?K.get(-e,-i,this.scale*this.cx1*i-this.dot1*e):K.get(e,i,this.scale*this.cx1*i-this.dot1*e)}return K.get(0,0,0)},Ft.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},Ft.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},Ft.prototype.b1=null,Ft.prototype.a1localx=null,Ft.prototype.a1localy=null,Ft.prototype.a1relx=null,Ft.prototype.a1rely=null,Ft.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},Ft.prototype.invalidate_a1=function(t){this.immutable_midstep("Constraint::a1"),this.a1localx=t.x,this.a1localy=t.y,this.wake()},Ft.prototype.setup_a1=function(){var t,e,i=this.a1localx,n=this.a1localy;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_a1=t,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=Z(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=Z(this,this.invalidate_a1)},Ft.prototype.wrap_a1=null,Ft.prototype.b2=null,Ft.prototype.a2localx=null,Ft.prototype.a2localy=null,Ft.prototype.a2relx=null,Ft.prototype.a2rely=null,Ft.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},Ft.prototype.invalidate_a2=function(t){this.immutable_midstep("Constraint::a2"),this.a2localx=t.x,this.a2localy=t.y,this.wake()},Ft.prototype.setup_a2=function(){var t,e,i=this.a2localx,n=this.a2localy;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_a2=t,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=Z(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=Z(this,this.invalidate_a2)},Ft.prototype.wrap_a2=null,Ft.prototype.zip_n=null,Ft.prototype.nlocalx=null,Ft.prototype.nlocaly=null,Ft.prototype.nrelx=null,Ft.prototype.nrely=null,Ft.prototype.validate_n=function(){this.wrap_n.zpp_inner.x=this.nlocalx,this.wrap_n.zpp_inner.y=this.nlocaly},Ft.prototype.invalidate_n=function(t){this.immutable_midstep("Constraint::n"),this.nlocalx=t.x,this.nlocaly=t.y,this.zip_n=!0,this.wake()},Ft.prototype.setup_n=function(){var t,e,i=this.nlocalx,n=this.nlocaly;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_n=t,this.wrap_n.zpp_inner._inuse=!0,this.wrap_n.zpp_inner._validate=Z(this,this.validate_n),this.wrap_n.zpp_inner._invalidate=Z(this,this.invalidate_n)},Ft.prototype.wrap_n=null,Ft.prototype.validate_norm=function(){var t;this.zip_n&&(this.zip_n=!1,t=1/Math.sqrt(this.nlocalx*this.nlocalx+this.nlocaly*this.nlocaly),this.nlocalx*=t,this.nlocaly*=t)},Ft.prototype.kMassa=null,Ft.prototype.kMassb=null,Ft.prototype.kMassc=null,Ft.prototype.jAccx=null,Ft.prototype.jAccy=null,Ft.prototype.jMax=null,Ft.prototype.gamma=null,Ft.prototype.biasx=null,Ft.prototype.biasy=null,Ft.prototype.stepped=null,Ft.prototype.copy=function(t,e){var i=this.outer_zn;null==i.zpp_inner_zn.wrap_a1&&i.zpp_inner_zn.setup_a1();var n=i.zpp_inner_zn.wrap_a1,r=this.outer_zn;null==r.zpp_inner_zn.wrap_a2&&r.zpp_inner_zn.setup_a2();i=r.zpp_inner_zn.wrap_a2,r=this.outer_zn;null==r.zpp_inner_zn.wrap_n&&r.zpp_inner_zn.setup_n();var s=new P(null,null,n,i,r.zpp_inner_zn.wrap_n,this.jointMin,this.jointMax);if(this.copyto(s),null!=t&&null!=this.b1){for(var o=null,a=0;a<t.length;){var l=t[a];if(++a,l.id==this.b1.id){o=l.bc;break}}null!=o?s.zpp_inner_zn.b1=o.zpp_inner:e.push(Lt.todo(this.b1.id,function(t){s.zpp_inner_zn.b1=t.zpp_inner}))}if(null!=t&&null!=this.b2){for(var p=null,h=0;h<t.length;){var u=t[h];if(++h,u.id==this.b2.id){p=u.bc;break}}null!=p?s.zpp_inner_zn.b2=p.zpp_inner:e.push(Lt.todo(this.b2.id,function(t){s.zpp_inner_zn.b2=t.zpp_inner}))}return s},Ft.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new r("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new r("Error: DistanceJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new r("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(this.jointMin>this.jointMax)throw new r("Error: DistanceJoint must have jointMin <= jointMax");if(this.nlocalx*this.nlocalx+this.nlocaly*this.nlocaly<kr.epsilon)throw new r("Error: DistanceJoint direction must be non-degenerate");if(2!=this.b1.type&&2!=this.b2.type)throw new r("Error: Constraints cannot have both bodies non-dynamic")},Ft.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},Ft.prototype.forest=function(){if(2==this.b1.type){var t,e;if(this.b1.component==this.b1.component.parent)t=this.b1.component;else{for(var i=this.b1.component,n=null;i!=i.parent;){var r=i.parent;i.parent=n,n=i,i=r}for(;null!=n;){var s=n.parent;n.parent=i,n=s}t=i}if(this.component==this.component.parent)e=this.component;else{for(var o=this.component,a=null;o!=o.parent;){var l=o.parent;o.parent=a,a=o,o=l}for(;null!=a;){var p=a.parent;a.parent=o,a=p}e=o}t!=e&&(t.rank<e.rank?t.parent=e:t.rank>e.rank?e.parent=t:(e.parent=t).rank++)}if(2==this.b2.type){var h,u;if(this.b2.component==this.b2.component.parent)h=this.b2.component;else{for(var c=this.b2.component,d=null;c!=c.parent;){var _=c.parent;c.parent=d,d=c,c=_}for(;null!=d;){var y=d.parent;d.parent=c,d=y}h=c}if(this.component==this.component.parent)u=this.component;else{for(var f=this.component,m=null;f!=f.parent;){var x=f.parent;f.parent=m,m=f,f=x}for(;null!=m;){var v=m.parent;m.parent=f,m=v}u=f}h!=u&&(h.rank<u.rank?h.parent=u:h.rank>u.rank?u.parent=h:(u.parent=h).rank++)}},Ft.prototype.pair_exists=function(t,e){return this.b1.id==t&&this.b2.id==e||this.b1.id==e&&this.b2.id==t},Ft.prototype.clearcache=function(){this.jAccx=0,this.jAccy=0,this.pre_dt=-1},Ft.prototype.preStep=function(t){-1==this.pre_dt&&(this.pre_dt=t);var e=t/this.pre_dt;this.pre_dt=t,this.equal=this.jointMin==this.jointMax,this.stepped=!0,this.validate_norm(),this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.nrelx=this.b1.axisy*this.nlocalx-this.b1.axisx*this.nlocaly,this.nrely=this.nlocalx*this.b1.axisx+this.nlocaly*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var i=0,n=0,r=this.b2.posx+this.a2relx-this.b1.posx-this.a1relx,s=(i=this.b2.posy+this.a2rely-this.b1.posy-this.a1rely)*this.nrelx-r*this.nrely,n=this.nrelx*r+this.nrely*i;this.equal?(n-=this.jointMin,this.scale=1):n>this.jointMax?(n-=this.jointMax,this.scale=1):n<this.jointMin?(n=this.jointMin-n,this.scale=-1):(n=0,this.scale=0);var o=0,a=0,o=r+this.a1relx,a=i+this.a1rely;this.dot1=this.nrelx*o+this.nrely*a,this.cx1=a*this.nrelx-o*this.nrely,this.dot2=this.nrelx*this.a2relx+this.nrely*this.a2rely,this.cx2=this.a2rely*this.nrelx-this.a2relx*this.nrely,this.kMassa=this.b1.smass+this.b2.smass+this.dot1*this.dot1*this.b1.sinertia+this.dot2*this.dot2*this.b2.sinertia,this.kMassb=-this.scale*(this.dot1*this.cx1*this.b1.sinertia+this.dot2*this.cx2*this.b2.sinertia),this.kMassc=this.scale*this.scale*(this.b1.smass+this.b2.smass+this.cx1*this.cx1*this.b1.sinertia+this.cx2*this.cx2*this.b2.sinertia);a=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(0!=(1&(l=a!=a?(this.kMassa=this.kMassb=this.kMassc=0,3):0==a?((o=0)!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,o=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,o|=2),this.kMassb=0,o):(a=1/a,l=this.kMassc*a,this.kMassc=this.kMassa*a,this.kMassa=l,this.kMassb*=-a,0)))&&(this.jAccx=0),0!=(2&l)&&(this.jAccy=0),this.stiff)this.gamma=0,this.biasx=0,this.biasy=0;else{if(this.breakUnderError&&s*s+n*n>this.maxError*this.maxError)return!0;a=2*Math.PI*this.frequency;this.gamma=1/(t*a*(2*this.damping+a*t));var l=1/(1+this.gamma),a=t*a*a*this.gamma;this.gamma*=l,this.kMassa*=l,this.kMassb*=l,this.kMassc*=l,this.biasx=s,this.biasy=n;n=-a;this.biasx*=n,this.biasy*=n;a=this.maxError,n=this.biasx*this.biasx+this.biasy*this.biasy;a*a<n&&(n=a*(1/Math.sqrt(n)),this.biasx*=n,this.biasy*=n)}return this.jAccx*=e,this.jAccy*=e,this.jMax=this.maxForce*t,!1},Ft.prototype.warmStart=function(){var t=this.scale*this.nrelx*this.jAccy-this.nrely*this.jAccx,e=this.nrelx*this.jAccx+this.scale*this.nrely*this.jAccy,i=this.b1.imass;this.b1.velx-=t*i,this.b1.vely-=e*i;i=this.b2.imass;this.b2.velx+=t*i,this.b2.vely+=e*i,this.b1.angvel+=(this.scale*this.cx1*this.jAccy-this.dot1*this.jAccx)*this.b1.iinertia,this.b2.angvel+=(this.dot2*this.jAccx-this.scale*this.cx2*this.jAccy)*this.b2.iinertia},Ft.prototype.applyImpulseVel=function(){var t=0,e=0,t=this.b2.velx-this.b1.velx,e=this.b2.vely-this.b1.vely;t+=this.b2.kinvelx-this.b1.kinvelx,r=(e+=this.b2.kinvely-this.b1.kinvely)*this.nrelx-t*this.nrely+(this.b2.angvel+this.b2.kinangvel)*this.dot2-(this.b1.angvel+this.b1.kinangvel)*this.dot1,s=this.scale*(this.nrelx*t+this.nrely*e-(this.b2.angvel+this.b2.kinangvel)*this.cx2+(this.b1.angvel+this.b1.kinangvel)*this.cx1);var i=this.biasx-r,n=this.biasy-s,t=this.kMassa*i+this.kMassb*n;n=this.kMassb*i+this.kMassc*n,i=t;e=this.gamma;i-=this.jAccx*e,n-=this.jAccy*e;var r=this.jAccx,s=this.jAccy;if(this.jAccx+=i,this.jAccy+=n,0<this.jAccy&&(this.jAccy=0),this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy>this.jMax*this.jMax)return!0}else this.stiff||(t=this.jMax)*t<(e=this.jAccx*this.jAccx+this.jAccy*this.jAccy)&&(o=t*(1/Math.sqrt(e)),this.jAccx*=o,this.jAccy*=o);i=this.jAccx-r,n=this.jAccy-s;var o=this.scale*this.nrelx*n-this.nrely*i,r=this.nrelx*i+this.scale*this.nrely*n,s=this.b1.imass;this.b1.velx-=o*s,this.b1.vely-=r*s;s=this.b2.imass;return this.b2.velx+=o*s,this.b2.vely+=r*s,this.b1.angvel+=(this.scale*this.cx1*n-this.dot1*i)*this.b1.iinertia,this.b2.angvel+=(this.dot2*i-this.scale*this.cx2*n)*this.b2.iinertia,!1},Ft.prototype.applyImpulsePos=function(){var t=0,t=this.b1.axisy*this.nlocalx-this.b1.axisx*this.nlocaly,e=this.nlocalx*this.b1.axisx+this.nlocaly*this.b1.axisy,i=0,n=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,i=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,r=0,r=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,s=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,o=0,a=0,l=0,p=0,o=this.b2.posx+r-this.b1.posx-n,l=(a=this.b2.posy+s-this.b1.posy-i)*t-o*e,p=t*o+e*a,h=this.equal?(p-=this.jointMin,1):p>this.jointMax?(p-=this.jointMax,1):p<this.jointMin?(p=this.jointMin-p,-1):p=0;if(this.breakUnderError&&l*l+p*p>this.maxError*this.maxError)return!0;if(l*l+p*p<kr.constraintLinearSlop*kr.constraintLinearSlop)return!1;var u=0,c=0;6<(l*=.5)*l+(p*=.5)*p&&((d=this.b1.smass+this.b2.smass)>kr.epsilon&&(y=(d=.8/d)*(e*l-h*t*p),f=d*(t*l*h-e*l),_=this.b1.imass,this.b1.posx-=y*_,this.b1.posy-=f*_,m=this.b2.imass,this.b2.posx+=y*m,this.b2.posy+=f*m,o=this.b2.posx+r-this.b1.posx-n,l=(a=this.b2.posy+s-this.b1.posy-i)*t-o*e,p=t*o+e*a,h=this.equal?(p-=this.jointMin,1):p>this.jointMax?(p-=this.jointMax,1):p<this.jointMin?(p=this.jointMin-p,-1):p=0,l*=.5,p*=.5));var d=0,_=0,y=0,f=0,m=0,i=t*(f=o+n)+e*(m=a+i),m=m*t-f*e,f=t*r+e*s,r=s*t-r*e,d=this.b1.smass+this.b2.smass+i*i*this.b1.sinertia+f*f*this.b2.sinertia,_=-h*(i*m*this.b1.sinertia+f*r*this.b2.sinertia);u=-l,c=-p;p=d*(y=h*h*(this.b1.smass+this.b2.smass+m*m*this.b1.sinertia+r*r*this.b2.sinertia))-_*_;p!=p?u=c=0:0==p?(0!=d?u/=d:u=0,0!=y?c/=y:c=0):(x=(p=1/p)*(y*u-_*c),c=p*(d*c-_*u),u=x),0<c&&(c=0);var x=h*t*c-e*u,t=t*u+h*e*c,e=this.b1.imass;this.b1.posx-=x*e,this.b1.posy-=t*e;e=this.b2.imass;this.b2.posx+=x*e,this.b2.posy+=t*e;t=this.b1,e=(h*m*c-i*u)*this.b1.iinertia;t.rot+=e,1e-4<e*e?(t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)):(m=1-(v=e*e)*v/8,v=((i=1-.5*v)*t.axisx+e*t.axisy)*m,t.axisy=(i*t.axisy-e*t.axisx)*m,t.axisx=v);var v=this.b2,u=(f*u-h*r*c)*this.b2.iinertia;return v.rot+=u,1e-4<u*u?(v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot)):(r=1-(h=u*u)*h/8,h=((c=1-.5*h)*v.axisx+u*v.axisy)*r,v.axisy=(c*v.axisy-u*v.axisx)*r,v.axisx=h),!1},Ft.prototype.draw=function(t){},Ft.prototype.__class__=Ft;var jt=zpp_nape.constraint.ZPP_MotorJoint=function(){this.stepped=!1,this.jMax=0,this.jAcc=0,this.kMass=0,this.b2=null,this.b1=null,this.rate=0,this.ratio=0,this.outer_zn=null,Dt.call(this),this.jAcc=0,this.stepped=!1,this.__velocity=!0};jt.__name__=["zpp_nape","constraint","ZPP_MotorJoint"],jt.__super__=Dt,jt.prototype=Object.create(Dt.prototype),jt.prototype.outer_zn=null,jt.prototype.ratio=null,jt.prototype.rate=null,jt.prototype.bodyImpulse=function(t){return this.stepped?t==this.b1?K.get(0,0,-this.jAcc):K.get(0,0,this.ratio*this.jAcc):K.get(0,0,0)},jt.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},jt.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},jt.prototype.b1=null,jt.prototype.b2=null,jt.prototype.kMass=null,jt.prototype.jAcc=null,jt.prototype.jMax=null,jt.prototype.stepped=null,jt.prototype.copy=function(t,e){var i=new T(null,null,this.rate,this.ratio);if(this.copyto(i),null!=t&&null!=this.b1){for(var n=null,r=0;r<t.length;){var s=t[r];if(++r,s.id==this.b1.id){n=s.bc;break}}null!=n?i.zpp_inner_zn.b1=n.zpp_inner:e.push(Lt.todo(this.b1.id,function(t){i.zpp_inner_zn.b1=t.zpp_inner}))}if(null!=t&&null!=this.b2){for(var o=null,a=0;a<t.length;){var l=t[a];if(++a,l.id==this.b2.id){o=l.bc;break}}null!=o?i.zpp_inner_zn.b2=o.zpp_inner:e.push(Lt.todo(this.b2.id,function(t){i.zpp_inner_zn.b2=t.zpp_inner}))}return i},jt.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new r("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new r("Error: MotorJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new r("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(2!=this.b1.type&&2!=this.b2.type)throw new r("Error: Constraints cannot have both bodies non-dynamic")},jt.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},jt.prototype.forest=function(){if(2==this.b1.type){var t,e;if(this.b1.component==this.b1.component.parent)t=this.b1.component;else{for(var i=this.b1.component,n=null;i!=i.parent;){var r=i.parent;i.parent=n,n=i,i=r}for(;null!=n;){var s=n.parent;n.parent=i,n=s}t=i}if(this.component==this.component.parent)e=this.component;else{for(var o=this.component,a=null;o!=o.parent;){var l=o.parent;o.parent=a,a=o,o=l}for(;null!=a;){var p=a.parent;a.parent=o,a=p}e=o}t!=e&&(t.rank<e.rank?t.parent=e:t.rank>e.rank?e.parent=t:(e.parent=t).rank++)}if(2==this.b2.type){var h,u;if(this.b2.component==this.b2.component.parent)h=this.b2.component;else{for(var c=this.b2.component,d=null;c!=c.parent;){var _=c.parent;c.parent=d,d=c,c=_}for(;null!=d;){var y=d.parent;d.parent=c,d=y}h=c}if(this.component==this.component.parent)u=this.component;else{for(var f=this.component,m=null;f!=f.parent;){var x=f.parent;f.parent=m,m=f,f=x}for(;null!=m;){var v=m.parent;m.parent=f,m=v}u=f}h!=u&&(h.rank<u.rank?h.parent=u:h.rank>u.rank?u.parent=h:(u.parent=h).rank++)}},jt.prototype.pair_exists=function(t,e){return this.b1.id==t&&this.b2.id==e||this.b1.id==e&&this.b2.id==t},jt.prototype.clearcache=function(){this.jAcc=0,this.pre_dt=-1},jt.prototype.preStep=function(t){-1==this.pre_dt&&(this.pre_dt=t);var e=t/this.pre_dt;return this.pre_dt=t,this.stepped=!0,this.kMass=this.b1.sinertia+this.ratio*this.ratio*this.b2.sinertia,this.kMass=1/this.kMass,this.jAcc*=e,this.jMax=this.maxForce*t,!1},jt.prototype.warmStart=function(){this.b1.angvel-=this.b1.iinertia*this.jAcc,this.b2.angvel+=this.ratio*this.b2.iinertia*this.jAcc},jt.prototype.applyImpulseVel=function(){var t=-this.kMass*(this.ratio*(this.b2.angvel+this.b2.kinangvel)-this.b1.angvel-this.b1.kinangvel-this.rate),e=this.jAcc;if(this.jAcc+=t,this.breakUnderForce){if(this.jAcc>this.jMax||this.jAcc<-this.jMax)return!0}else this.jAcc<-this.jMax?this.jAcc=-this.jMax:this.jAcc>this.jMax&&(this.jAcc=this.jMax);return t=this.jAcc-e,this.b1.angvel-=this.b1.iinertia*t,this.b2.angvel+=this.ratio*this.b2.iinertia*t,!1},jt.prototype.applyImpulsePos=function(){return!1},jt.prototype.__class__=jt;var Nt=zpp_nape.constraint.ZPP_PivotJoint=function(){this.stepped=!1,this.biasy=0,this.biasx=0,this.gamma=0,this.jMax=0,this.jAccy=0,this.jAccx=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.outer_zn=null,Dt.call(this),this.stepped=!1,this.jAccx=0,this.jAccy=0,this.jMax=1/0,this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0};Nt.__name__=["zpp_nape","constraint","ZPP_PivotJoint"],Nt.__super__=Dt,Nt.prototype=Object.create(Dt.prototype),Nt.prototype.outer_zn=null,Nt.prototype.bodyImpulse=function(t){return this.stepped?t==this.b1?K.get(-this.jAccx,-this.jAccy,-(this.jAccy*this.a1relx-this.jAccx*this.a1rely)):K.get(this.jAccx,this.jAccy,this.jAccy*this.a2relx-this.jAccx*this.a2rely):K.get(0,0,0)},Nt.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},Nt.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},Nt.prototype.b1=null,Nt.prototype.a1localx=null,Nt.prototype.a1localy=null,Nt.prototype.a1relx=null,Nt.prototype.a1rely=null,Nt.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},Nt.prototype.invalidate_a1=function(t){this.immutable_midstep("Constraint::a1"),this.a1localx=t.x,this.a1localy=t.y,this.wake()},Nt.prototype.setup_a1=function(){var t,e,i=this.a1localx,n=this.a1localy;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_a1=t,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=Z(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=Z(this,this.invalidate_a1)},Nt.prototype.wrap_a1=null,Nt.prototype.b2=null,Nt.prototype.a2localx=null,Nt.prototype.a2localy=null,Nt.prototype.a2relx=null,Nt.prototype.a2rely=null,Nt.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},Nt.prototype.invalidate_a2=function(t){this.immutable_midstep("Constraint::a2"),this.a2localx=t.x,this.a2localy=t.y,this.wake()},Nt.prototype.setup_a2=function(){var t,e,i=this.a2localx,n=this.a2localy;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_a2=t,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=Z(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=Z(this,this.invalidate_a2)},Nt.prototype.wrap_a2=null,Nt.prototype.kMassa=null,Nt.prototype.kMassb=null,Nt.prototype.kMassc=null,Nt.prototype.jAccx=null,Nt.prototype.jAccy=null,Nt.prototype.jMax=null,Nt.prototype.gamma=null,Nt.prototype.biasx=null,Nt.prototype.biasy=null,Nt.prototype.stepped=null,Nt.prototype.copy=function(t,e){var i=this.outer_zn;null==i.zpp_inner_zn.wrap_a1&&i.zpp_inner_zn.setup_a1();var n=i.zpp_inner_zn.wrap_a1,i=this.outer_zn;null==i.zpp_inner_zn.wrap_a2&&i.zpp_inner_zn.setup_a2();var r=new S(null,null,n,i.zpp_inner_zn.wrap_a2);if(this.copyto(r),null!=t&&null!=this.b1){for(var s=null,o=0;o<t.length;){var a=t[o];if(++o,a.id==this.b1.id){s=a.bc;break}}null!=s?r.zpp_inner_zn.b1=s.zpp_inner:e.push(Lt.todo(this.b1.id,function(t){r.zpp_inner_zn.b1=t.zpp_inner}))}if(null!=t&&null!=this.b2){for(var l=null,p=0;p<t.length;){var h=t[p];if(++p,h.id==this.b2.id){l=h.bc;break}}null!=l?r.zpp_inner_zn.b2=l.zpp_inner:e.push(Lt.todo(this.b2.id,function(t){r.zpp_inner_zn.b2=t.zpp_inner}))}return r},Nt.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new r("Error: PivotJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new r("Error: PivotJoint cannot be simulated with body1 == body2 (body1=body2="+this.b1.outer.toString()+")");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new r("Error: Constraints must have each body within the same space to which the constraint has been assigned (body1="+this.b1.outer.toString()+", body2="+this.b2.outer.toString()+")");if(2!=this.b1.type&&2!=this.b2.type)throw new r("Error: Constraints cannot have both bodies non-dynamic (body1="+this.b1.outer.toString()+", body2="+this.b2.outer.toString()+")")},Nt.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},Nt.prototype.forest=function(){if(2==this.b1.type){var t,e;if(this.b1.component==this.b1.component.parent)t=this.b1.component;else{for(var i=this.b1.component,n=null;i!=i.parent;){var r=i.parent;i.parent=n,n=i,i=r}for(;null!=n;){var s=n.parent;n.parent=i,n=s}t=i}if(this.component==this.component.parent)e=this.component;else{for(var o=this.component,a=null;o!=o.parent;){var l=o.parent;o.parent=a,a=o,o=l}for(;null!=a;){var p=a.parent;a.parent=o,a=p}e=o}t!=e&&(t.rank<e.rank?t.parent=e:t.rank>e.rank?e.parent=t:(e.parent=t).rank++)}if(2==this.b2.type){var h,u;if(this.b2.component==this.b2.component.parent)h=this.b2.component;else{for(var c=this.b2.component,d=null;c!=c.parent;){var _=c.parent;c.parent=d,d=c,c=_}for(;null!=d;){var y=d.parent;d.parent=c,d=y}h=c}if(this.component==this.component.parent)u=this.component;else{for(var f=this.component,m=null;f!=f.parent;){var x=f.parent;f.parent=m,m=f,f=x}for(;null!=m;){var v=m.parent;m.parent=f,m=v}u=f}h!=u&&(h.rank<u.rank?h.parent=u:h.rank>u.rank?u.parent=h:(u.parent=h).rank++)}},Nt.prototype.pair_exists=function(t,e){return this.b1.id==t&&this.b2.id==e||this.b1.id==e&&this.b2.id==t},Nt.prototype.clearcache=function(){this.jAccx=0,this.jAccy=0,this.pre_dt=-1},Nt.prototype.preStep=function(t){-1==this.pre_dt&&(this.pre_dt=t);var e=t/this.pre_dt;this.pre_dt=t,this.stepped=!0,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var i,n=this.b1.smass+this.b2.smass;this.kMassa=n,this.kMassb=0,this.kMassc=n,0!=this.b1.sinertia&&(i=this.a1relx*this.b1.sinertia,n=this.a1rely*this.b1.sinertia,this.kMassa+=n*this.a1rely,this.kMassb+=-n*this.a1relx,this.kMassc+=i*this.a1relx),0!=this.b2.sinertia&&(r=this.a2relx*this.b2.sinertia,s=this.a2rely*this.b2.sinertia,this.kMassa+=s*this.a2rely,this.kMassb+=-s*this.a2relx,this.kMassc+=r*this.a2relx);var r,s=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(0!=(1&(o=s!=s?(this.kMassa=this.kMassb=this.kMassc=0,3):0==s?((r=0)!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,r=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,r|=2),this.kMassb=0,r):(s=1/s,o=this.kMassc*s,this.kMassc=this.kMassa*s,this.kMassa=o,this.kMassb*=-s,0)))&&(this.jAccx=0),0!=(2&o)&&(this.jAccy=0),this.stiff)this.biasx=0,this.biasy=0,this.gamma=0;else{var s=2*Math.PI*this.frequency;this.gamma=1/(t*s*(2*this.damping+s*t));var o=1/(1+this.gamma),s=t*s*s*this.gamma;if(this.gamma*=o,this.kMassa*=o,this.kMassb*=o,this.kMassc*=o,this.biasx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.biasy=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),this.breakUnderError&&this.biasx*this.biasx+this.biasy*this.biasy>this.maxError*this.maxError)return!0;o=-s;this.biasx*=o,this.biasy*=o;s=this.maxError,o=this.biasx*this.biasx+this.biasy*this.biasy;s*s<o&&(o=s*(1/Math.sqrt(o)),this.biasx*=o,this.biasy*=o)}return this.jAccx*=e,this.jAccy*=e,this.jMax=this.maxForce*t,!1},Nt.prototype.warmStart=function(){var t=this.b1.imass;this.b1.velx-=this.jAccx*t,this.b1.vely-=this.jAccy*t;t=this.b2.imass;this.b2.velx+=this.jAccx*t,this.b2.vely+=this.jAccy*t,this.b1.angvel-=(this.jAccy*this.a1relx-this.jAccx*this.a1rely)*this.b1.iinertia,this.b2.angvel+=(this.jAccy*this.a2relx-this.jAccx*this.a2rely)*this.b2.iinertia},Nt.prototype.applyImpulseVel=function(){var t=this.b2.velx+this.b2.kinvelx-this.a2rely*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.a1rely*(this.b1.angvel+this.b1.kinangvel)),e=this.b2.vely+this.b2.kinvely+this.a2relx*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.a1relx*(this.b1.angvel+this.b1.kinangvel)),i=this.biasx-t,n=this.biasy-e,r=this.kMassa*i+this.kMassb*n;n=this.kMassb*i+this.kMassc*n,i=r;var s=this.gamma;i-=this.jAccx*s,n-=this.jAccy*s;t=this.jAccx,e=this.jAccy;if(this.jAccx+=i,this.jAccy+=n,this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy>this.jMax*this.jMax)return!0}else this.stiff||(r=this.jMax)*r<(s=this.jAccx*this.jAccx+this.jAccy*this.jAccy)&&(s=r*(1/Math.sqrt(s)),this.jAccx*=s,this.jAccy*=s);i=this.jAccx-t,n=this.jAccy-e;e=this.b1.imass;this.b1.velx-=i*e,this.b1.vely-=n*e;e=this.b2.imass;return this.b2.velx+=i*e,this.b2.vely+=n*e,this.b1.angvel-=(n*this.a1relx-i*this.a1rely)*this.b1.iinertia,this.b2.angvel+=(n*this.a2relx-i*this.a2rely)*this.b2.iinertia,!1},Nt.prototype.applyImpulsePos=function(){var t=0,e=0,t=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,e=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,i=0,n=0,i=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,n=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,r=0,s=0,r=this.b2.posx+i-(this.b1.posx+t),s=this.b2.posy+n-(this.b1.posy+e);if(this.breakUnderError&&r*r+s*s>this.maxError*this.maxError)return!0;if(r*r+s*s<kr.constraintLinearSlop*kr.constraintLinearSlop)return!1;var o=0,a=0;6<(r*=.5)*r+(s*=.5)*s&&((h=this.b1.smass+this.b2.smass)>kr.epsilon&&(400<(u=(o=-r*(h=.75/h))*o+(a=-s*h)*a)&&(o*=c=1/Math.sqrt(u)*20,a*=c),d=this.b1.imass,this.b1.posx-=o*d,this.b1.posy-=a*d,l=this.b2.imass,this.b2.posx+=o*l,this.b2.posy+=a*l,r=this.b2.posx+i-(this.b1.posx+t),s=this.b2.posy+n-(this.b1.posy+e),r*=.5,s*=.5));var l,p,h=0,u=0,c=0,d=this.b1.smass+this.b2.smass,c=h=d;(u=0)!=this.b1.sinertia&&(p=t*this.b1.sinertia,h=d+(l=e*this.b1.sinertia)*e,u+=-l*t,c=d+p*t),0!=this.b2.sinertia&&(d=i*this.b2.sinertia,h+=(p=n*this.b2.sinertia)*n,u+=-p*i,c+=d*i);s=(o=-r)*o+(a=-s)*a;36<s&&(o*=_=1/Math.sqrt(s)*6,a*=_);var _=h*c-u*u;_!=_?o=a=0:0==_?(0!=h?o/=h:o=0,0!=c?a/=c:a=0):(y=(_=1/_)*(c*o-u*a),a=_*(h*a-u*o),o=y);u=this.b1.imass;this.b1.posx-=o*u,this.b1.posy-=a*u;var y=this.b2.imass;this.b2.posx+=o*y,this.b2.posy+=a*y;u=this.b1,y=-(a*t-o*e)*this.b1.iinertia;u.rot+=y,1e-4<y*y?(u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot)):(t=1-(f=y*y)*f/8,f=((e=1-.5*f)*u.axisx+y*u.axisy)*t,u.axisy=(e*u.axisy-y*u.axisx)*t,u.axisx=f);var f=this.b2,a=(a*i-o*n)*this.b2.iinertia;return f.rot+=a,1e-4<a*a?(f.axisx=Math.sin(f.rot),f.axisy=Math.cos(f.rot)):(o=1-(i=a*a)*i/8,i=((n=1-.5*i)*f.axisx+a*f.axisy)*o,f.axisy=(n*f.axisy-a*f.axisx)*o,f.axisx=i),!1},Nt.prototype.draw=function(t){},Nt.prototype.__class__=Nt;var Gt=zpp_nape.constraint.ZPP_PulleyJoint=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.wrap_a4=null,this.a4rely=0,this.a4relx=0,this.a4localy=0,this.a4localx=0,this.b4=null,this.wrap_a3=null,this.a3rely=0,this.a3relx=0,this.a3localy=0,this.a3localx=0,this.b3=null,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.cx4=0,this.cx3=0,this.cx2=0,this.cx1=0,this.n34y=0,this.n34x=0,this.n12y=0,this.n12x=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.ratio=1,this.outer_zn=null,Dt.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.a3localx=0,this.a3localy=0,this.a3relx=0,this.a3rely=0,this.a4localx=0,this.a4localy=0,this.a4relx=0,this.a4rely=0,this.n12x=1,this.n12y=0,this.n34x=1,this.n34y=0,this.jAcc=0,this.jMax=1/0,this.stepped=!1,this.cx1=this.cx2=this.cx3=this.cx4=0};Gt.__name__=["zpp_nape","constraint","ZPP_PulleyJoint"],Gt.__super__=Dt,Gt.prototype=Object.create(Dt.prototype),Gt.prototype.outer_zn=null,Gt.prototype.ratio=null,Gt.prototype.jointMin=null,Gt.prototype.jointMax=null,Gt.prototype.slack=null,Gt.prototype.equal=null,Gt.prototype.is_slack=function(){this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.a3relx=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,this.a3rely=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy,this.a4relx=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,this.a4rely=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy;var t=0,e=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),i=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),n=this.b4.posx+this.a4relx-(this.b3.posx+this.a3relx),t=this.b4.posy+this.a4rely-(this.b3.posy+this.a3rely),i=Math.sqrt(e*e+i*i),t=Math.sqrt(n*n+t*t);0==t&&Math.sqrt(0);t=i+this.ratio*t;return!this.equal&&(!(t<this.jointMin)&&(t>this.jointMax?(t-=this.jointMax,!1):!(t=0)))},Gt.prototype.n12x=null,Gt.prototype.n12y=null,Gt.prototype.n34x=null,Gt.prototype.n34y=null,Gt.prototype.cx1=null,Gt.prototype.cx2=null,Gt.prototype.cx3=null,Gt.prototype.cx4=null,Gt.prototype.bodyImpulse=function(t){if(this.stepped){var e,i,n=K.get();return t==this.b1&&(null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.x=n.zpp_inner.x-this.jAcc*this.n12x,null!=(e=n.zpp_inner)._validate&&e._validate(),null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.y=n.zpp_inner.y-this.jAcc*this.n12y,null!=(e=n.zpp_inner)._validate&&e._validate(),null!=(e=n.zpp_inner)._validate&&e._validate(),n.zpp_inner.z=n.zpp_inner.z-this.cx1*this.jAcc,null!=(e=n.zpp_inner)._validate&&e._validate()),t==this.b2&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.x=n.zpp_inner.x+this.jAcc*this.n12x,null!=(i=n.zpp_inner)._validate&&i._validate(),null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y=n.zpp_inner.y+this.jAcc*this.n12y,null!=(i=n.zpp_inner)._validate&&i._validate(),null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.z=n.zpp_inner.z+this.cx2*this.jAcc,null!=(i=n.zpp_inner)._validate&&i._validate()),t==this.b3&&(null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.x=n.zpp_inner.x-this.jAcc*this.n34x,null!=(i=n.zpp_inner)._validate&&i._validate(),null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.y=n.zpp_inner.y-this.jAcc*this.n34y,null!=(i=n.zpp_inner)._validate&&i._validate(),null!=(i=n.zpp_inner)._validate&&i._validate(),n.zpp_inner.z=n.zpp_inner.z-this.cx3*this.jAcc,null!=(i=n.zpp_inner)._validate&&i._validate()),t==this.b4&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x=n.zpp_inner.x+this.jAcc*this.n34x,null!=(t=n.zpp_inner)._validate&&t._validate(),null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y=n.zpp_inner.y+this.jAcc*this.n34y,null!=(t=n.zpp_inner)._validate&&t._validate(),null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.z=n.zpp_inner.z+this.cx4*this.jAcc,null!=(t=n.zpp_inner)._validate&&t._validate()),n}return K.get(0,0,0)},Gt.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this),this.b3!=this.b1&&this.b3!=this.b2&&null!=this.b3&&this.b3.constraints.add(this),this.b4!=this.b1&&this.b4!=this.b2&&this.b4!=this.b3&&null!=this.b4&&this.b4.constraints.add(this)},Gt.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this),this.b3!=this.b1&&this.b3!=this.b2&&null!=this.b3&&this.b3.constraints.remove(this),this.b4!=this.b1&&this.b4!=this.b2&&this.b4!=this.b3&&null!=this.b4&&this.b4.constraints.remove(this)},Gt.prototype.b1=null,Gt.prototype.a1localx=null,Gt.prototype.a1localy=null,Gt.prototype.a1relx=null,Gt.prototype.a1rely=null,Gt.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},Gt.prototype.invalidate_a1=function(t){this.immutable_midstep("Constraint::a1"),this.a1localx=t.x,this.a1localy=t.y,this.wake()},Gt.prototype.setup_a1=function(){var t,e,i=this.a1localx,n=this.a1localy;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_a1=t,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=Z(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=Z(this,this.invalidate_a1)},Gt.prototype.wrap_a1=null,Gt.prototype.b2=null,Gt.prototype.a2localx=null,Gt.prototype.a2localy=null,Gt.prototype.a2relx=null,Gt.prototype.a2rely=null,Gt.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},Gt.prototype.invalidate_a2=function(t){this.immutable_midstep("Constraint::a2"),this.a2localx=t.x,this.a2localy=t.y,this.wake()},Gt.prototype.setup_a2=function(){var t,e,i=this.a2localx,n=this.a2localy;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_a2=t,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=Z(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=Z(this,this.invalidate_a2)},Gt.prototype.wrap_a2=null,Gt.prototype.b3=null,Gt.prototype.a3localx=null,Gt.prototype.a3localy=null,Gt.prototype.a3relx=null,Gt.prototype.a3rely=null,Gt.prototype.validate_a3=function(){this.wrap_a3.zpp_inner.x=this.a3localx,this.wrap_a3.zpp_inner.y=this.a3localy},Gt.prototype.invalidate_a3=function(t){this.immutable_midstep("Constraint::a3"),this.a3localx=t.x,this.a3localy=t.y,this.wake()},Gt.prototype.setup_a3=function(){var t,e,i=this.a3localx,n=this.a3localy;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_a3=t,this.wrap_a3.zpp_inner._inuse=!0,this.wrap_a3.zpp_inner._validate=Z(this,this.validate_a3),this.wrap_a3.zpp_inner._invalidate=Z(this,this.invalidate_a3)},Gt.prototype.wrap_a3=null,Gt.prototype.b4=null,Gt.prototype.a4localx=null,Gt.prototype.a4localy=null,Gt.prototype.a4relx=null,Gt.prototype.a4rely=null,Gt.prototype.validate_a4=function(){this.wrap_a4.zpp_inner.x=this.a4localx,this.wrap_a4.zpp_inner.y=this.a4localy},Gt.prototype.invalidate_a4=function(t){this.immutable_midstep("Constraint::a4"),this.a4localx=t.x,this.a4localy=t.y,this.wake()},Gt.prototype.setup_a4=function(){var t,e,i=this.a4localx,n=this.a4localy;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_a4=t,this.wrap_a4.zpp_inner._inuse=!0,this.wrap_a4.zpp_inner._validate=Z(this,this.validate_a4),this.wrap_a4.zpp_inner._invalidate=Z(this,this.invalidate_a4)},Gt.prototype.wrap_a4=null,Gt.prototype.kMass=null,Gt.prototype.jAcc=null,Gt.prototype.jMax=null,Gt.prototype.gamma=null,Gt.prototype.bias=null,Gt.prototype.stepped=null,Gt.prototype.copy=function(t,e){var i=this.outer_zn;null==i.zpp_inner_zn.wrap_a1&&i.zpp_inner_zn.setup_a1();var n=i.zpp_inner_zn.wrap_a1,r=this.outer_zn;null==r.zpp_inner_zn.wrap_a2&&r.zpp_inner_zn.setup_a2();var s=r.zpp_inner_zn.wrap_a2,i=this.outer_zn;null==i.zpp_inner_zn.wrap_a3&&i.zpp_inner_zn.setup_a3();r=i.zpp_inner_zn.wrap_a3,i=this.outer_zn;null==i.zpp_inner_zn.wrap_a4&&i.zpp_inner_zn.setup_a4();var o=new M(null,null,null,null,n,s,r,i.zpp_inner_zn.wrap_a4,this.jointMin,this.jointMax,this.ratio);if(this.copyto(o),null!=t&&null!=this.b1){for(var a=null,l=0;l<t.length;){var p=t[l];if(++l,p.id==this.b1.id){a=p.bc;break}}null!=a?o.zpp_inner_zn.b1=a.zpp_inner:e.push(Lt.todo(this.b1.id,function(t){o.zpp_inner_zn.b1=t.zpp_inner}))}if(null!=t&&null!=this.b2){for(var h=null,u=0;u<t.length;){var c=t[u];if(++u,c.id==this.b2.id){h=c.bc;break}}null!=h?o.zpp_inner_zn.b2=h.zpp_inner:e.push(Lt.todo(this.b2.id,function(t){o.zpp_inner_zn.b2=t.zpp_inner}))}if(null!=t&&null!=this.b3){for(var d=null,_=0;_<t.length;){var y=t[_];if(++_,y.id==this.b3.id){d=y.bc;break}}null!=d?o.zpp_inner_zn.b3=d.zpp_inner:e.push(Lt.todo(this.b3.id,function(t){o.zpp_inner_zn.b3=t.zpp_inner}))}if(null!=t&&null!=this.b4){for(var f=null,m=0;m<t.length;){var x=t[m];if(++m,x.id==this.b4.id){f=x.bc;break}}null!=f?o.zpp_inner_zn.b4=f.zpp_inner:e.push(Lt.todo(this.b4.id,function(t){o.zpp_inner_zn.b4=t.zpp_inner}))}return o},Gt.prototype.validate=function(){if(null==this.b1||null==this.b2||null==this.b3||null==this.b4)throw new r("Error: PulleyJoint cannot be simulated with null bodies");if(this.b1==this.b2||this.b3==this.b4)throw new r("Error: PulleyJoint cannot have body1==body2 or body3==body4");if(this.b1.space!=this.space||this.b2.space!=this.space||this.b3.space!=this.space||this.b4.space!=this.space)throw new r("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(this.jointMin>this.jointMax)throw new r("Error: PulleyJoint must have jointMin <= jointMax");if(2!=this.b1.type&&2!=this.b2.type)throw new r("Error: PulleyJoint cannot have both bodies in a linked pair non-dynamic");if(2!=this.b3.type&&2!=this.b4.type)throw new r("Error: PulleyJoint cannot have both bodies in a linked pair non-dynamic")},Gt.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake(),null!=this.b3&&2==this.b3.type&&this.b3.wake(),null!=this.b4&&2==this.b4.type&&this.b4.wake()},Gt.prototype.forest=function(){if(2==this.b1.type){var t,e;if(this.b1.component==this.b1.component.parent)t=this.b1.component;else{for(var i=this.b1.component,n=null;i!=i.parent;){var r=i.parent;i.parent=n,n=i,i=r}for(;null!=n;){var s=n.parent;n.parent=i,n=s}t=i}if(this.component==this.component.parent)e=this.component;else{for(var o=this.component,a=null;o!=o.parent;){var l=o.parent;o.parent=a,a=o,o=l}for(;null!=a;){var p=a.parent;a.parent=o,a=p}e=o}t!=e&&(t.rank<e.rank?t.parent=e:t.rank>e.rank?e.parent=t:(e.parent=t).rank++)}if(2==this.b2.type){var h,u;if(this.b2.component==this.b2.component.parent)h=this.b2.component;else{for(var c=this.b2.component,d=null;c!=c.parent;){var _=c.parent;c.parent=d,d=c,c=_}for(;null!=d;){var y=d.parent;d.parent=c,d=y}h=c}if(this.component==this.component.parent)u=this.component;else{for(var f=this.component,m=null;f!=f.parent;){var x=f.parent;f.parent=m,m=f,f=x}for(;null!=m;){var v=m.parent;m.parent=f,m=v}u=f}h!=u&&(h.rank<u.rank?h.parent=u:h.rank>u.rank?u.parent=h:(u.parent=h).rank++)}if(2==this.b3.type){var g,b;if(this.b3.component==this.b3.component.parent)g=this.b3.component;else{for(var z=this.b3.component,w=null;z!=z.parent;){var C=z.parent;z.parent=w,w=z,z=C}for(;null!=w;){var P=w.parent;w.parent=z,w=P}g=z}if(this.component==this.component.parent)b=this.component;else{for(var T=this.component,S=null;T!=T.parent;){var M=T.parent;T.parent=S,S=T,T=M}for(;null!=S;){var A=S.parent;S.parent=T,S=A}b=T}g!=b&&(g.rank<b.rank?g.parent=b:g.rank>b.rank?b.parent=g:(b.parent=g).rank++)}if(2==this.b4.type){var O,k;if(this.b4.component==this.b4.component.parent)O=this.b4.component;else{for(var E=this.b4.component,I=null;E!=E.parent;){var D=E.parent;E.parent=I,I=E,E=D}for(;null!=I;){var B=I.parent;I.parent=E,I=B}O=E}if(this.component==this.component.parent)k=this.component;else{for(var L=this.component,R=null;L!=L.parent;){var F=L.parent;L.parent=R,R=L,L=F}for(;null!=R;){var j=R.parent;R.parent=L,R=j}k=L}O!=k&&(O.rank<k.rank?O.parent=k:O.rank>k.rank?k.parent=O:(k.parent=O).rank++)}},Gt.prototype.pair_exists=function(t,e){return this.b1.id==t&&(this.b2.id==e||this.b3.id==e||this.b4.id==e)||this.b2.id==t&&(this.b3.id==e||this.b4.id==e||this.b1.id==e)||this.b3.id==t&&(this.b4.id==e||this.b1.id==e||this.b2.id==e)||this.b4.id==t&&(this.b1.id==e||this.b2.id==e||this.b3.id==e)},Gt.prototype.clearcache=function(){this.jAcc=0,this.pre_dt=-1},Gt.prototype.preStep=function(t){-1==this.pre_dt&&(this.pre_dt=t);var e=t/this.pre_dt;this.pre_dt=t,this.stepped=!0,this.equal=this.jointMin==this.jointMax,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.a3relx=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,this.a3rely=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy,this.a4relx=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,this.a4rely=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy;var i,n=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),r=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),s=this.b4.posx+this.a4relx-(this.b3.posx+this.a3relx),o=this.b4.posy+this.a4rely-(this.b3.posy+this.a3rely),a=Math.sqrt(n*n+r*r),l=Math.sqrt(s*s+o*o);0!=a&&(i=1/a,this.n12x=n*i,this.n12y=r*i),0!=l?(i=1/l,this.n34x=s*i,this.n34y=o*i,i=this.ratio,this.n34x*=i,this.n34y*=i):(p=this.ratio/Math.sqrt(this.n34x*this.n34x+this.n34y*this.n34y),this.n34x*=p,this.n34y*=p);var p=a+this.ratio*l;this.equal?(p-=this.jointMax,this.slack=!1):p<this.jointMin?(p=this.jointMin-p,this.n12x=-this.n12x,this.n12y=-this.n12y,this.n34x=-this.n34x,this.n34y=-this.n34y,this.slack=!1):p>this.jointMax?(p-=this.jointMax,this.slack=!1):(this.n12x=0,this.n12y=0,this.n34x=0,p=this.n34y=0,this.slack=!0);a=p;if(!this.slack){this.cx1=this.n12y*this.a1relx-this.n12x*this.a1rely,this.cx2=this.n12y*this.a2relx-this.n12x*this.a2rely,this.cx3=this.n34y*this.a3relx-this.n34x*this.a3rely,this.cx4=this.n34y*this.a4relx-this.n34x*this.a4rely;l=this.b1.smass+this.b2.smass+this.ratio*this.ratio*(this.b3.smass+this.b4.smass)+this.b1.sinertia*this.cx1*this.cx1+this.b2.sinertia*this.cx2*this.cx2+this.b3.sinertia*this.cx3*this.cx3+this.b4.sinertia*this.cx4*this.cx4;if(this.b1==this.b4&&(l-=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b1.smass+this.cx1*this.cx4*this.b1.sinertia)),this.b1==this.b3&&(l+=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b1.smass+this.cx1*this.cx3*this.b1.sinertia)),this.b2==this.b3&&(l-=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b2.smass+this.cx2*this.cx3*this.b2.sinertia)),this.b2==this.b4&&(l+=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b2.smass+this.cx2*this.cx4*this.b2.sinertia)),this.kMass=l,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&a*a>this.maxError*this.maxError)return!0;var p=2*Math.PI*this.frequency;this.gamma=1/(t*p*(2*this.damping+p*t));l=1/(1+this.gamma),p=t*p*p*this.gamma;this.gamma*=l,this.kMass*=l,this.bias=-a*p,this.bias<-this.maxError?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=e,this.jMax=this.maxForce*t}return!1},Gt.prototype.warmStart=function(){var t;this.slack||(t=this.b1.imass*this.jAcc,this.b1.velx-=this.n12x*t,this.b1.vely-=this.n12y*t,t=this.b2.imass*this.jAcc,this.b2.velx+=this.n12x*t,this.b2.vely+=this.n12y*t,t=this.b3.imass*this.jAcc,this.b3.velx-=this.n34x*t,this.b3.vely-=this.n34y*t,t=this.b4.imass*this.jAcc,this.b4.velx+=this.n34x*t,this.b4.vely+=this.n34y*t,this.b1.angvel-=this.cx1*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.cx2*this.b2.iinertia*this.jAcc,this.b3.angvel-=this.cx3*this.b3.iinertia*this.jAcc,this.b4.angvel+=this.cx4*this.b4.iinertia*this.jAcc)},Gt.prototype.applyImpulseVel=function(){if(this.slack)return!1;var t=this.kMass*(this.bias-(this.n12x*(this.b2.velx+this.b2.kinvelx-this.b1.velx-this.b1.kinvelx)+this.n12y*(this.b2.vely+this.b2.kinvely-this.b1.vely-this.b1.kinvely)+this.n34x*(this.b4.velx+this.b4.kinvelx-this.b3.velx-this.b3.kinvelx)+this.n34y*(this.b4.vely+this.b4.kinvely-this.b3.vely-this.b3.kinvely)+(this.b2.angvel+this.b2.kinangvel)*this.cx2-(this.b1.angvel+this.b1.kinangvel)*this.cx1+(this.b4.angvel+this.b4.kinangvel)*this.cx4-(this.b3.angvel+this.b3.kinangvel)*this.cx3))-this.jAcc*this.gamma,e=this.jAcc;if(this.jAcc+=t,!this.equal&&0<this.jAcc&&(this.jAcc=0),this.breakUnderForce&&this.jAcc<-this.jMax)return!0;this.stiff||this.jAcc<-this.jMax&&(this.jAcc=-this.jMax),t=this.jAcc-e;e=this.b1.imass*t;this.b1.velx-=this.n12x*e,this.b1.vely-=this.n12y*e;e=this.b2.imass*t;this.b2.velx+=this.n12x*e,this.b2.vely+=this.n12y*e;e=this.b3.imass*t;this.b3.velx-=this.n34x*e,this.b3.vely-=this.n34y*e;e=this.b4.imass*t;return this.b4.velx+=this.n34x*e,this.b4.vely+=this.n34y*e,this.b1.angvel-=this.cx1*this.b1.iinertia*t,this.b2.angvel+=this.cx2*this.b2.iinertia*t,this.b3.angvel-=this.cx3*this.b3.iinertia*t,this.b4.angvel+=this.cx4*this.b4.iinertia*t,!1},Gt.prototype.applyImpulsePos=function(){var t=0,e=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,t=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,i=0,n=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,i=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,r=0,s=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,r=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy,o=0,a=0,o=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,a=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy,l=0,p=0,h=0,u=0;l=this.n12x,p=this.n12y,h=this.n34x,u=this.n34y;var c=0,d=0,c=this.b2.posx+n-(this.b1.posx+e),_=this.b2.posy+i-(this.b1.posy+t),y=this.b4.posx+o-(this.b3.posx+s),d=this.b4.posy+a-(this.b3.posy+r),f=Math.sqrt(c*c+_*_),m=Math.sqrt(y*y+d*d);0!=f&&(l=c*(c=1/f),p=_*c),0!=m?(h=y*(b=1/m),u=d*b,h*=z=this.ratio,u*=z):(h*=g=this.ratio/Math.sqrt(h*h+u*u),u*=g);var x,v,g,d=f+this.ratio*m,b=this.equal?(d-=this.jointMax,!1):d<this.jointMin?(d=this.jointMin-d,l=-l,p=-p,h=-h,u=-u,!1):d>this.jointMax?(d-=this.jointMax,!1):!(d=u=h=p=l=0),z=d;if(!b){if(this.breakUnderError&&z*z>this.maxError*this.maxError)return!0;if(z*z<kr.constraintLinearSlop*kr.constraintLinearSlop)return!1;6<(z*=.5)*z&&((g=this.b1.smass+this.b2.smass)>kr.epsilon&&(S=-z*(g=.75/g),(this.equal||S<0)&&(f=S*this.b1.imass,this.b1.posx-=l*f,this.b1.posy-=p*f,m=S*this.b2.imass,this.b2.posx+=l*m,this.b2.posy+=p*m,d=S*this.b3.imass,this.b3.posx-=h*d,this.b3.posy-=u*d,b=S*this.b4.imass,this.b4.posx+=h*b,this.b4.posy+=u*b,d=m=f=g=0,g=this.b2.posx+n-(this.b1.posx+e),f=this.b2.posy+i-(this.b1.posy+t),m=this.b4.posx+o-(this.b3.posx+s),d=this.b4.posy+a-(this.b3.posy+r),0!=(b=Math.sqrt(g*g+f*f))&&(l=g*(v=1/b),p=f*v),0!=(v=Math.sqrt(m*m+d*d))?(h=m*(x=1/v),u=d*x,h*=x=this.ratio,u*=x):(h*=x=this.ratio/Math.sqrt(h*h+u*u),u*=x),v=b+this.ratio*v,this.equal?v-=this.jointMax:v<this.jointMin?(v=this.jointMin-v,l=-l,p=-p,h=-h,u=-u):v>this.jointMax?v-=this.jointMax:v=u=h=p=l=0,z=v,z*=.5))),t=p*e-l*t,i=p*n-l*i,r=u*s-h*r,o=u*o-h*a;a=this.b1.smass+this.b2.smass+this.ratio*this.ratio*(this.b3.smass+this.b4.smass)+this.b1.sinertia*t*t+this.b2.sinertia*i*i+this.b3.sinertia*r*r+this.b4.sinertia*o*o;this.b1==this.b4&&(a-=2*((l*h+p*u)*this.b1.smass+t*o*this.b1.sinertia)),this.b1==this.b3&&(a+=2*((l*h+p*u)*this.b1.smass+t*r*this.b1.sinertia)),this.b2==this.b3&&(a-=2*((l*h+p*u)*this.b2.smass+i*r*this.b2.sinertia)),this.b2==this.b4&&(a+=2*((l*h+p*u)*this.b2.smass+i*o*this.b2.sinertia));var w,C,P,T,S,M,a=a;0!=a&&(a=1/a),S=-z*a,(this.equal||S<0)&&(a=this.b1.imass*S,this.b1.posx-=l*a,this.b1.posy-=p*a,a=this.b2.imass*S,this.b2.posx+=l*a,this.b2.posy+=p*a,a=this.b3.imass*S,this.b3.posx-=h*a,this.b3.posy-=u*a,a=this.b4.imass*S,this.b4.posx+=h*a,this.b4.posy+=u*a,u=this.b1,a=-t*this.b1.iinertia*S,u.rot+=a,1e-4<a*a?(u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot)):(T=1-(w=a*a)*w/8,w=((t=1-.5*w)*u.axisx+a*u.axisy)*T,u.axisy=(t*u.axisy-a*u.axisx)*T,u.axisx=w),T=this.b2,u=i*this.b2.iinertia*S,T.rot+=u,1e-4<u*u?(T.axisx=Math.sin(T.rot),T.axisy=Math.cos(T.rot)):(w=1-(C=u*u)*C/8,C=((i=1-.5*C)*T.axisx+u*T.axisy)*w,T.axisy=(i*T.axisy-u*T.axisx)*w,T.axisx=C),T=this.b3,C=-r*this.b3.iinertia*S,T.rot+=C,1e-4<C*C?(T.axisx=Math.sin(T.rot),T.axisy=Math.cos(T.rot)):(P=1-(M=C*C)*M/8,M=((r=1-.5*M)*T.axisx+C*T.axisy)*P,T.axisy=(r*T.axisy-C*T.axisx)*P,T.axisx=M),P=this.b4,T=o*this.b4.iinertia*S,P.rot+=T,1e-4<T*T?(P.axisx=Math.sin(P.rot),P.axisy=Math.cos(P.rot)):(o=1-(M=T*T)*M/8,M=((S=1-.5*M)*P.axisx+T*P.axisy)*o,P.axisy=(S*P.axisy-T*P.axisx)*o,P.axisx=M))}return!1},Gt.prototype.draw=function(t){},Gt.prototype.__class__=Gt;var Ut=zpp_nape.constraint.ZPP_UserConstraint=function(t,e){this.jOld=null,this.J=null,this.vec3=null,this.Keff=null,this.jMax=0,this.velonly=!1,this.gamma=0,this.soft=0,this.y=null,this.L=null,this.stepped=!1,this.bias=null,this.jAcc=null,this.dim=0,this.bodies=null,this.outer_zn=null,Dt.call(this),this.bodies=[],this.dim=t,this.velonly=e,this.jAcc=[],this.bias=[],this.L=[],this.J=[],this.jOld=[],this.y=[],this.Keff=[],this.vec3=K.get(0,0,0);for(var i=0;i<t;){var n=i++;this.J[n]=this.jOld[n]=this.y[n]=0,this.bias[n]=0;for(var r=this.jAcc[n]=0;r<t;)this.L[n*t+r++]=0}this.stepped=!1};Ut.__name__=["zpp_nape","constraint","ZPP_UserConstraint"],Ut.__super__=Dt,Ut.prototype=Object.create(Dt.prototype),Ut.prototype.outer_zn=null,Ut.prototype.bindVec2_invalidate=function(t){this.outer_zn.__invalidate()},Ut.prototype.bodies=null,Ut.prototype.dim=null,Ut.prototype.jAcc=null,Ut.prototype.bias=null,Ut.prototype.addBody=function(t){for(var e=null,i=0,n=this.bodies;i<n.length;){var r=n[i];if(++i,r.body==t){e=r;break}}null==e?(this.bodies.push(new se(1,t)),this.active&&null!=this.space&&null!=t&&t.constraints.add(this)):e.cnt++},Ut.prototype.remBody=function(t){for(var e=null,i=0|this.bodies.length,n=0;n<i;){var r=this.bodies[n];if(r.body==t){r.cnt--,0==r.cnt&&(0<i&&(this.bodies[n]=this.bodies[i-1]),this.bodies.pop(),this.active&&null!=this.space&&null!=t&&t.constraints.remove(this)),e=r;break}++n}return null!=e},Ut.prototype.bodyImpulse=function(t){for(var e=0,i=this.dim;e<i;){var n=e++;this.J[n]=this.jAcc[n]}var r=K.get(0,0,0);return this.stepped&&this.outer_zn.__impulse(this.J,t.outer,r),r},Ut.prototype.activeBodies=function(){for(var t=0,e=this.bodies;t<e.length;){var i=e[t];++t,null!=i.body&&i.body.constraints.add(this)}},Ut.prototype.inactiveBodies=function(){for(var t=0,e=this.bodies;t<e.length;){var i=e[t];++t,null!=i.body&&i.body.constraints.remove(this)}},Ut.prototype.stepped=null,Ut.prototype.copy=function(t,e){throw this.copyto(this.outer_zn.__copy()),new r("not done yet")},Ut.prototype.validate=function(){for(var t=0,e=this.bodies;t<e.length;){var i=e[t];if(++t,i.body.space!=this.space)throw new r("Error: Constraints must have each body within the same sapce to which the constraint has been assigned")}this.outer_zn.__validate()},Ut.prototype.wake_connected=function(){for(var t=0,e=this.bodies;t<e.length;){var i=e[t];++t,2==i.body.type&&i.body.wake()}},Ut.prototype.forest=function(){for(var t=0,e=this.bodies;t<e.length;){var i,n,r=e[t];if(++t,2==r.body.type){if(r.body.component==r.body.component.parent)i=r.body.component;else{for(var s=r.body.component,o=null;s!=s.parent;){var a=s.parent;s.parent=o,o=s,s=a}for(;null!=o;){var l=o.parent;o.parent=s,o=l}i=s}if(this.component==this.component.parent)n=this.component;else{for(var p=this.component,h=null;p!=p.parent;){var u=p.parent;p.parent=h,h=p,p=u}for(;null!=h;){var c=h.parent;h.parent=p,h=c}n=p}i!=n&&(i.rank<n.rank?i.parent=n:i.rank>n.rank?n.parent=i:(n.parent=i).rank++)}}},Ut.prototype.pair_exists=function(t,e){for(var i=!1,n=0|this.bodies.length,r=0;r<n;){for(var s=r++,o=this.bodies[s].body,a=1+s;a<n;){var l=this.bodies[a++].body;if(o.id==t&&l.id==e||o.id==e&&l.id==t){i=!0;break}}if(i)break}return i},Ut.prototype.broken=function(){this.outer_zn.__broken()},Ut.prototype.clearcache=function(){for(var t=0,e=this.dim;t<e;)this.jAcc[t++]=0;this.pre_dt=-1},Ut.prototype.lsq=function(t){for(var e=0,i=0,n=this.dim;i<n;){var r=i++;e+=t[r]*t[r]}return e},Ut.prototype._clamp=function(t,e){var i=this.lsq(t);if(e*e<i)for(var n=e/Math.sqrt(i),r=0,s=this.dim;r<s;)t[r++]*=n},Ut.prototype.L=null,Ut.prototype.solve=function(t){for(var e=0,i=0,n=this.dim;i<n;){for(var r=i++,s=0,o=0,a=r-1;o<a;){var l=o++;s+=this.L[r*this.dim+l]*this.L[r*this.dim+l]}var p=Math.sqrt(t[e++]-s);if(0!=(this.L[r*this.dim+r]=p)){p=1/p;for(var h=1+r,u=this.dim;h<u;){for(var c=h++,d=0,_=0,y=r-1;_<y;){var f=_++;d+=this.L[c*this.dim+f]*this.L[r*this.dim+f]}this.L[c*this.dim+r]=p*(t[e++]-d)}}else{for(var m=1+r,x=this.dim;m<x;)this.L[m++*this.dim+r]=0;e+=this.dim-r-1}}return this.L},Ut.prototype.y=null,Ut.prototype.transform=function(t,e){for(var i=0,n=this.dim;i<n;){var r=i++,s=e[r],o=t[r*this.dim+r];if(0!=o){for(var a=0;a<r;){var l=a++;s-=t[r*this.dim+l]*this.y[l]}this.y[r]=s/o}else this.y[r]=0}for(var p=0,h=this.dim;p<h;){var u=this.dim-1-p++,c=t[u*this.dim+u];if(0!=c){for(var d=this.y[u],_=1+u,y=this.dim;_<y;){var f=_++;d-=t[f*this.dim+u]*e[f]}e[u]=d/c}else e[u]=0}},Ut.prototype.soft=null,Ut.prototype.gamma=null,Ut.prototype.velonly=null,Ut.prototype.jMax=null,Ut.prototype.Keff=null,Ut.prototype.preStep=function(t){this.outer_zn.__validate(),-1==this.pre_dt&&(this.pre_dt=t);var e=t/this.pre_dt;if(this.pre_dt=t,this.stepped=!0,this.outer_zn.__prepare(),this.outer_zn.__eff_mass(this.Keff),this.L=this.solve(this.Keff),this.stiff||this.velonly){for(var i=0,n=this.dim;i<n;)this.bias[i++]=0;this.gamma=0,this.soft=1}else{var r=2*Math.PI*this.frequency;this.gamma=1/(t*r*(2*this.damping+r*t));var s=1/(1+this.gamma),o=t*r*r*this.gamma;if(this.gamma*=s,this.soft=s,this.outer_zn.__position(this.bias),this.breakUnderError&&this.lsq(this.bias)>this.maxError*this.maxError)return!0;for(var a=0,l=this.dim;a<l;)this.bias[a++]*=-o;this._clamp(this.bias,this.maxError)}for(var p=0,h=this.dim;p<h;)this.jAcc[p++]*=e;return this.jMax=this.maxForce*t,!1},Ut.prototype.vec3=null,Ut.prototype.warmStart=function(){for(var t=0,e=this.bodies;t<e.length;){var i=e[t];++t;var n=i.body;this.outer_zn.__impulse(this.jAcc,n.outer,this.vec3);var r=n.imass,s=this.vec3,i=s.zpp_inner;null!=i._validate&&i._validate(),n.velx+=s.zpp_inner.x*r;i=this.vec3,s=i.zpp_inner;null!=s._validate&&s._validate(),n.vely+=i.zpp_inner.y*r;i=this.vec3,r=i.zpp_inner;null!=r._validate&&r._validate(),n.angvel+=i.zpp_inner.z*n.iinertia}},Ut.prototype.J=null,Ut.prototype.jOld=null,Ut.prototype.applyImpulseVel=function(){this.outer_zn.__velocity(this.J);for(var t=0,e=this.dim;t<e;){var i=t++;this.J[i]=this.bias[i]-this.J[i]}this.transform(this.L,this.J);for(var n=0,r=this.dim;n<r;){var s=n++;this.jOld[s]=this.jAcc[s],this.jAcc[s]+=this.J[s]=this.J[s]*this.soft-this.jAcc[s]*this.gamma}if(this.outer_zn.__clamp(this.jAcc),(this.breakUnderForce||!this.stiff)&&this.lsq(this.jAcc)>this.jMax*this.jMax){if(this.breakUnderForce)return!0;this.stiff||this._clamp(this.jAcc,this.jMax)}for(var o=0,a=this.dim;o<a;){var l=o++;this.J[l]=this.jAcc[l]-this.jOld[l]}for(var p=0,h=this.bodies;p<h.length;){var u=h[p];++p;var c=u.body;this.outer_zn.__impulse(this.J,c.outer,this.vec3);var d=c.imass,_=this.vec3,u=_.zpp_inner;null!=u._validate&&u._validate(),c.velx+=_.zpp_inner.x*d;u=this.vec3,_=u.zpp_inner;null!=_._validate&&_._validate(),c.vely+=u.zpp_inner.y*d;u=this.vec3,d=u.zpp_inner;null!=d._validate&&d._validate(),c.angvel+=u.zpp_inner.z*c.iinertia}return!1},Ut.prototype.applyImpulsePos=function(){if(this.velonly)return!1;this.outer_zn.__prepare(),this.outer_zn.__position(this.J);var t=this.lsq(this.J);if(this.breakUnderError&&t>this.maxError*this.maxError)return!0;if(t<kr.constraintLinearSlop*kr.constraintLinearSlop)return!1;for(var e=0,i=this.dim;e<i;)this.J[e++]*=-1;this.outer_zn.__eff_mass(this.Keff),this.transform(this.solve(this.Keff),this.J),this.outer_zn.__clamp(this.J);for(var n=0,r=this.bodies;n<r.length;){var s=r[n];++n;var o=s.body;this.outer_zn.__impulse(this.J,o.outer,this.vec3);var a=o.imass,l=this.vec3,p=l.zpp_inner;null!=p._validate&&p._validate(),o.posx+=l.zpp_inner.x*a;s=this.vec3,p=s.zpp_inner;null!=p._validate&&p._validate(),o.posy+=s.zpp_inner.y*a;l=this.vec3,p=l.zpp_inner;null!=p._validate&&p._validate();s=l.zpp_inner.z*o.iinertia;o.rot+=s,1e-4<s*s?(o.axisx=Math.sin(o.rot),o.axisy=Math.cos(o.rot)):(p=1-(a=s*s)*a/8,a=((l=1-.5*a)*o.axisx+s*o.axisy)*p,o.axisy=(l*o.axisy-s*o.axisx)*p,o.axisx=a)}return!1},Ut.prototype.draw=function(t){this.outer_zn.__draw(t)},Ut.prototype.__class__=Ut;var se=zpp_nape.constraint.ZPP_UserBody=function(t,e){this.body=null,this.cnt=0,this.cnt=t,this.body=e};se.__name__=["zpp_nape","constraint","ZPP_UserBody"],se.prototype.cnt=null,se.prototype.body=null,se.prototype.__class__=se;var oe=zpp_nape.constraint.ZPP_WeldJoint=function(){this.stepped=!1,this.biasz=0,this.biasy=0,this.biasx=0,this.gamma=0,this.jMax=0,this.jAccz=0,this.jAccy=0,this.jAccx=0,this.kMassf=0,this.kMasse=0,this.kMassc=0,this.kMassd=0,this.kMassb=0,this.kMassa=0,this.phase=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.outer_zn=null,Dt.call(this),this.phase=0,this.jAccx=0,this.jAccy=0,this.jAccz=0,this.jMax=1/0,this.stepped=!1,this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0};oe.__name__=["zpp_nape","constraint","ZPP_WeldJoint"],oe.__super__=Dt,oe.prototype=Object.create(Dt.prototype),oe.prototype.outer_zn=null,oe.prototype.bodyImpulse=function(t){return this.stepped?t==this.b1?K.get(-this.jAccx,-this.jAccy,-(this.jAccy*this.a1relx-this.jAccx*this.a1rely+this.jAccz)):K.get(this.jAccx,this.jAccy,this.jAccy*this.a2relx-this.jAccx*this.a2rely+this.jAccz):K.get(0,0,0)},oe.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},oe.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},oe.prototype.b1=null,oe.prototype.a1localx=null,oe.prototype.a1localy=null,oe.prototype.a1relx=null,oe.prototype.a1rely=null,oe.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},oe.prototype.invalidate_a1=function(t){this.immutable_midstep("Constraint::a1"),this.a1localx=t.x,this.a1localy=t.y,this.wake()},oe.prototype.setup_a1=function(){var t,e,i=this.a1localx,n=this.a1localy;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_a1=t,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=Z(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=Z(this,this.invalidate_a1)},oe.prototype.wrap_a1=null,oe.prototype.b2=null,oe.prototype.a2localx=null,oe.prototype.a2localy=null,oe.prototype.a2relx=null,oe.prototype.a2rely=null,oe.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},oe.prototype.invalidate_a2=function(t){this.immutable_midstep("Constraint::a2"),this.a2localx=t.x,this.a2localy=t.y,this.wake()},oe.prototype.setup_a2=function(){var t,e,i=this.a2localx,n=this.a2localy;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_a2=t,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=Z(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=Z(this,this.invalidate_a2)},oe.prototype.wrap_a2=null,oe.prototype.phase=null,oe.prototype.kMassa=null,oe.prototype.kMassb=null,oe.prototype.kMassd=null,oe.prototype.kMassc=null,oe.prototype.kMasse=null,oe.prototype.kMassf=null,oe.prototype.jAccx=null,oe.prototype.jAccy=null,oe.prototype.jAccz=null,oe.prototype.jMax=null,oe.prototype.gamma=null,oe.prototype.biasx=null,oe.prototype.biasy=null,oe.prototype.biasz=null,oe.prototype.stepped=null,oe.prototype.copy=function(t,e){var i=this.outer_zn;null==i.zpp_inner_zn.wrap_a1&&i.zpp_inner_zn.setup_a1();var n=i.zpp_inner_zn.wrap_a1,i=this.outer_zn;null==i.zpp_inner_zn.wrap_a2&&i.zpp_inner_zn.setup_a2();var r=new A(null,null,n,i.zpp_inner_zn.wrap_a2);if(this.copyto(r),null!=t&&null!=this.b1){for(var s=null,o=0;o<t.length;){var a=t[o];if(++o,a.id==this.b1.id){s=a.bc;break}}null!=s?r.zpp_inner_zn.b1=s.zpp_inner:e.push(Lt.todo(this.b1.id,function(t){r.zpp_inner_zn.b1=t.zpp_inner}))}if(null!=t&&null!=this.b2){for(var l=null,p=0;p<t.length;){var h=t[p];if(++p,h.id==this.b2.id){l=h.bc;break}}null!=l?r.zpp_inner_zn.b2=l.zpp_inner:e.push(Lt.todo(this.b2.id,function(t){r.zpp_inner_zn.b2=t.zpp_inner}))}return r},oe.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new r("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new r("Error: WeldJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new r("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(2!=this.b1.type&&2!=this.b2.type)throw new r("Error: Constraints cannot have both bodies non-dynamic")},oe.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},oe.prototype.forest=function(){if(2==this.b1.type){var t,e;if(this.b1.component==this.b1.component.parent)t=this.b1.component;else{for(var i=this.b1.component,n=null;i!=i.parent;){var r=i.parent;i.parent=n,n=i,i=r}for(;null!=n;){var s=n.parent;n.parent=i,n=s}t=i}if(this.component==this.component.parent)e=this.component;else{for(var o=this.component,a=null;o!=o.parent;){var l=o.parent;o.parent=a,a=o,o=l}for(;null!=a;){var p=a.parent;a.parent=o,a=p}e=o}t!=e&&(t.rank<e.rank?t.parent=e:t.rank>e.rank?e.parent=t:(e.parent=t).rank++)}if(2==this.b2.type){var h,u;if(this.b2.component==this.b2.component.parent)h=this.b2.component;else{for(var c=this.b2.component,d=null;c!=c.parent;){var _=c.parent;c.parent=d,d=c,c=_}for(;null!=d;){var y=d.parent;d.parent=c,d=y}h=c}if(this.component==this.component.parent)u=this.component;else{for(var f=this.component,m=null;f!=f.parent;){var x=f.parent;f.parent=m,m=f,f=x}for(;null!=m;){var v=m.parent;m.parent=f,m=v}u=f}h!=u&&(h.rank<u.rank?h.parent=u:h.rank>u.rank?u.parent=h:(u.parent=h).rank++)}},oe.prototype.pair_exists=function(t,e){return this.b1.id==t&&this.b2.id==e||this.b1.id==e&&this.b2.id==t},oe.prototype.clearcache=function(){this.jAccx=0,this.jAccy=0,this.jAccz=0,this.pre_dt=-1},oe.prototype.preStep=function(t){-1==this.pre_dt&&(this.pre_dt=t);var e=t/this.pre_dt;this.pre_dt=t,this.stepped=!0,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var i=this.b1.smass+this.b2.smass;this.kMassa=i,this.kMassb=0,this.kMassd=i,this.kMassc=0,this.kMasse=0,(this.kMassf=0)!=this.b1.sinertia&&(r=this.a1relx*this.b1.sinertia,n=this.a1rely*this.b1.sinertia,this.kMassa+=n*this.a1rely,this.kMassb+=-n*this.a1relx,this.kMassd+=r*this.a1relx,this.kMassc+=-n,this.kMasse+=r,this.kMassf+=this.b1.sinertia),0!=this.b2.sinertia&&(o=this.a2relx*this.b2.sinertia,s=this.a2rely*this.b2.sinertia,this.kMassa+=s*this.a2rely,this.kMassb+=-s*this.a2relx,this.kMassd+=o*this.a2relx,this.kMassc+=-s,this.kMasse+=o,this.kMassf+=this.b2.sinertia);var n,r,s,o,a,i=this.kMassa*(this.kMassd*this.kMassf-this.kMasse*this.kMasse)+this.kMassb*(this.kMassc*this.kMasse-this.kMassb*this.kMassf)+this.kMassc*(this.kMassb*this.kMasse-this.kMassc*this.kMassd);if(0!=(1&(i=i!=i?(this.kMassa=0,this.kMassb=0,this.kMassd=0,this.kMassc=0,this.kMasse=0,this.kMassf=0,7):0==i?((a=0)!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,a=1),0!=this.kMassd?this.kMassd=1/this.kMassd:(this.kMassd=0,a|=2),0!=this.kMassf?this.kMassf=1/this.kMassf:(this.kMassf=0,a|=4),this.kMassb=this.kMassc=this.kMasse=0,a):(n=(i=1/i)*(this.kMassd*this.kMassf-this.kMasse*this.kMasse),r=i*(this.kMasse*this.kMassc-this.kMassb*this.kMassf),s=i*(this.kMassa*this.kMassf-this.kMassc*this.kMassc),o=i*(this.kMassb*this.kMasse-this.kMassc*this.kMassd),a=i*(this.kMassb*this.kMassc-this.kMassa*this.kMasse),l=this.kMassa*this.kMassd-this.kMassb*this.kMassb,this.kMassa=n,this.kMassb=r,this.kMassd=s,this.kMassc=o,this.kMasse=a,this.kMassf=i*l,0)))&&(this.jAccx=0),0!=(2&i)&&(this.jAccy=0),0!=(4&i)&&(this.jAccz=0),this.stiff)this.biasx=0,this.biasy=0,this.biasz=0,this.gamma=0;else{var l=2*Math.PI*this.frequency;this.gamma=1/(t*l*(2*this.damping+l*t));i=1/(1+this.gamma),l=t*l*l*this.gamma;if(this.gamma*=i,this.kMassa*=i,this.kMassb*=i,this.kMassd*=i,this.kMassc*=i,this.kMasse*=i,this.kMassf*=i,this.biasx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.biasy=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),this.biasz=this.b2.rot-this.b1.rot-this.phase,this.breakUnderError&&this.biasx*this.biasx+this.biasy*this.biasy+this.biasz*this.biasz>this.maxError*this.maxError)return!0;i=-l;this.biasx*=i,this.biasy*=i,this.biasz*=i;l=this.maxError,i=this.biasx*this.biasx+this.biasy*this.biasy+this.biasz*this.biasz;l*l<i&&(i=l*(1/Math.sqrt(i)),this.biasx*=i,this.biasy*=i,this.biasz*=i)}return this.jAccx*=e,this.jAccy*=e,this.jAccz*=e,this.jMax=this.maxForce*t,!1},oe.prototype.warmStart=function(){var t=this.b1.imass;this.b1.velx-=this.jAccx*t,this.b1.vely-=this.jAccy*t;t=this.b2.imass;this.b2.velx+=this.jAccx*t,this.b2.vely+=this.jAccy*t,this.b1.angvel-=(this.jAccy*this.a1relx-this.jAccx*this.a1rely+this.jAccz)*this.b1.iinertia,this.b2.angvel+=(this.jAccy*this.a2relx-this.jAccx*this.a2rely+this.jAccz)*this.b2.iinertia},oe.prototype.applyImpulseVel=function(){var t=0,t=this.b2.velx+this.b2.kinvelx-this.a2rely*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.a1rely*(this.b1.angvel+this.b1.kinangvel)),e=this.b2.vely+this.b2.kinvely+this.a2relx*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.a1relx*(this.b1.angvel+this.b1.kinangvel)),i=this.b2.angvel+this.b2.kinangvel-this.b1.angvel-this.b1.kinangvel,n=this.biasx-t,r=this.biasy-e,s=this.biasz-i,o=this.kMassa*n+this.kMassb*r+this.kMassc*s,a=this.kMassb*n+this.kMassd*r+this.kMasse*s;s=this.kMassc*n+this.kMasse*r+this.kMassf*s,n=o,r=a;t=this.gamma;n-=this.jAccx*t,r-=this.jAccy*t,s-=this.jAccz*t;e=this.jAccx,i=this.jAccy,o=this.jAccz;if(this.jAccx+=n,this.jAccy+=r,this.jAccz+=s,this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy+this.jAccz*this.jAccz>this.jMax*this.jMax)return!0}else this.stiff||(a=this.jMax)*a<(t=this.jAccx*this.jAccx+this.jAccy*this.jAccy+this.jAccz*this.jAccz)&&(t=a*(1/Math.sqrt(t)),this.jAccx*=t,this.jAccy*=t,this.jAccz*=t);n=this.jAccx-e,r=this.jAccy-i,s=this.jAccz-o;o=this.b1.imass;this.b1.velx-=n*o,this.b1.vely-=r*o;o=this.b2.imass;return this.b2.velx+=n*o,this.b2.vely+=r*o,this.b1.angvel-=(r*this.a1relx-n*this.a1rely+s)*this.b1.iinertia,this.b2.angvel+=(r*this.a2relx-n*this.a2rely+s)*this.b2.iinertia,!1},oe.prototype.applyImpulsePos=function(){var t=0,e=0,t=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,e=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,i=0,n=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,i=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,r=0,s=0,o=0,r=this.b2.posx+n-(this.b1.posx+t),s=this.b2.posy+i-(this.b1.posy+e),o=this.b2.rot-this.b1.rot-this.phase,a=0,l=0,p=0;if(this.breakUnderError&&r*r+s*s+o*o>this.maxError*this.maxError)return!0;var h=!0;r*r+s*s<kr.constraintLinearSlop*kr.constraintLinearSlop&&(h=!1,s=r=0);var u=o*o,c=kr.constraintAngularSlop;if(u<c*c){if(!h)return!1;o=0}o*=.5,6<(r*=.5)*r+(s*=.5)*s&&((y=this.b1.smass+this.b2.smass)>kr.epsilon&&(400<(f=(a=-r*(y=.75/y))*a+(l=-s*y)*l)&&(a*=m=1/Math.sqrt(f)*20,l*=m),x=this.b1.imass,this.b1.posx-=a*x,this.b1.posy-=l*x,v=this.b2.imass,this.b2.posx+=a*v,this.b2.posy+=l*v,r=this.b2.posx+n-(this.b1.posx+t),s=this.b2.posy+i-(this.b1.posy+e),o=this.b2.rot-this.b1.rot-this.phase,r*=.5,s*=.5,o*=.5));var d,_,c=0,h=0,y=0,f=0,m=0,x=0,v=this.b1.smass+this.b2.smass,y=c=v;(x=m=f=h=0)!=this.b1.sinertia&&(_=t*this.b1.sinertia,c=v+(d=e*this.b1.sinertia)*e,h+=-d*t,y=v+_*t,f+=-d,m+=_,x+=this.b1.sinertia),0!=this.b2.sinertia&&(d=n*this.b2.sinertia,c+=(_=i*this.b2.sinertia)*i,h+=-_*n,y+=d*n,f+=-_,m+=d,x+=this.b2.sinertia),p=-o;s=(a=-r)*a+(l=-s)*l;36<s&&(a*=g=1/Math.sqrt(s)*6,l*=g);var g,s=c*(y*x-m*m)+h*(f*m-h*x)+f*(h*m-f*y);s!=s?a=l=p=0:0==s?(0!=c?a/=c:a=0,0!=y?l/=y:l=0,0!=x?p/=x:p=0):(b=(s=1/s)*(a*(y*x-m*m)+l*(z=m*f-h*x)+p*(g=h*m-f*y)),z=s*(a*z+l*(c*x-f*f)+p*(m=h*f-c*m)),p=s*(a*g+l*m+p*(c*y-h*h)),a=b,l=z);var b=this.b1.imass;this.b1.posx-=a*b,this.b1.posy-=l*b;var z=this.b2.imass;this.b2.posx+=a*z,this.b2.posy+=l*z;b=this.b1,z=-(l*t-a*e+p)*this.b1.iinertia;b.rot+=z,1e-4<z*z?(b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot)):(t=1-(w=z*z)*w/8,w=((e=1-.5*w)*b.axisx+z*b.axisy)*t,b.axisy=(e*b.axisy-z*b.axisx)*t,b.axisx=w);var w=this.b2,n=(l*n-a*i+p)*this.b2.iinertia;return w.rot+=n,1e-4<n*n?(w.axisx=Math.sin(w.rot),w.axisy=Math.cos(w.rot)):(i=1-(a=n*n)*a/8,a=((p=1-.5*a)*w.axisx+n*w.axisy)*i,w.axisy=(p*w.axisy-n*w.axisx)*i,w.axisx=a),!1},oe.prototype.draw=function(t){},oe.prototype.__class__=oe;var Qe=zpp_nape.dynamics.ZPP_Arbiter=function(){this.sensorarb=null,this.fluidarb=null,this.colarb=null,this.type=0,this.pair=null,this.ws2=null,this.ws1=null,this.b2=null,this.b1=null,this.invalidated=!1,this.immState=0,this.fresh=!1,this.continuous=!1,this.presentable=!1,this.intchange=!1,this.present=0,this.sleeping=!1,this.cleared=!1,this.active=!1,this.endGenerated=0,this.sleep_stamp=0,this.up_stamp=0,this.stamp=0,this.di=0,this.id=0,this.hnext=null,this.outer=null};Qe.__name__=["zpp_nape","dynamics","ZPP_Arbiter"],Qe.prototype.outer=null,Qe.prototype.wrapper=function(){return null==this.outer&&(Qe.internal=!0,this.type==Qe.COL?(this.colarb.outer_zn=new I,this.outer=this.colarb.outer_zn):this.type==Qe.FLUID?(this.fluidarb.outer_zn=new L,this.outer=this.fluidarb.outer_zn):this.outer=new O,this.outer.zpp_inner=this,Qe.internal=!1),this.outer},Qe.prototype.inactiveme=function(){return!this.active},Qe.prototype.hnext=null,Qe.prototype.id=null,Qe.prototype.di=null,Qe.prototype.stamp=null,Qe.prototype.up_stamp=null,Qe.prototype.sleep_stamp=null,Qe.prototype.endGenerated=null,Qe.prototype.active=null,Qe.prototype.cleared=null,Qe.prototype.sleeping=null,Qe.prototype.present=null,Qe.prototype.intchange=null,Qe.prototype.presentable=null,Qe.prototype.continuous=null,Qe.prototype.fresh=null,Qe.prototype.immState=null,Qe.prototype.acting=function(){return!!this.active&&0!=(1&this.immState)},Qe.prototype.invalidated=null,Qe.prototype.b1=null,Qe.prototype.b2=null,Qe.prototype.ws1=null,Qe.prototype.ws2=null,Qe.prototype.pair=null,Qe.prototype.swap_features=function(){var t=this.b1;this.b1=this.b2,this.b2=t;t=this.ws1;this.ws1=this.ws2,this.ws2=t;t=this.colarb.s1;this.colarb.s1=this.colarb.s2,this.colarb.s2=t},Qe.prototype.type=null,Qe.prototype.colarb=null,Qe.prototype.fluidarb=null,Qe.prototype.sensorarb=null,Qe.prototype.lazyRetire=function(t,e){if(this.cleared=!0,null==e||this.b2==e)for(var i,n,r=this.b1.arbiters,s=null,o=r.head;null!=o;){if(o.elt==this){null==s?(n=(i=r.head).next,r.head=n,null==r.head&&(r.pushmod=!0)):(n=(i=s.next).next,null==(s.next=n)&&(r.pushmod=!0));var a=i;a.elt=null,a.next=er.zpp_pool,er.zpp_pool=a,r.modified=!0,r.length--,r.pushmod=!0;break}o=(s=o).next}if(null==e||this.b1==e)for(var l,p,h=this.b2.arbiters,u=null,c=h.head;null!=c;){if(c.elt==this){null==u?(p=(l=h.head).next,h.head=p,null==h.head&&(h.pushmod=!0)):(p=(l=u.next).next,null==(u.next=p)&&(h.pushmod=!0));var d=l;d.elt=null,d.next=er.zpp_pool,er.zpp_pool=d,h.modified=!0,h.length--,h.pushmod=!0;break}c=(u=c).next}null!=this.pair&&(this.pair.arb=null,this.pair=null),this.active=!1,t.f_arbiters.modified=!0},Qe.prototype.sup_assign=function(t,e,i,n){this.b1=t.body,this.ws1=t,this.b2=e.body,this.ws2=e,this.id=i,this.di=n;n=this.b1.arbiters;null==er.zpp_pool?r=new er:(r=er.zpp_pool,er.zpp_pool=r.next,r.next=null),r.elt=this;var r=r;r.next=n.head,n.head=r,n.modified=!0,n.length++;n=this.b2.arbiters;null==er.zpp_pool?s=new er:(s=er.zpp_pool,er.zpp_pool=s.next,s.next=null),s.elt=this;var s=s;s.next=n.head,n.head=s,n.modified=!0,n.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1},Qe.prototype.sup_retire=function(){if(!this.cleared){for(var t,e,i=this.b1.arbiters,n=null,r=i.head;null!=r;){if(r.elt==this){null==n?(e=(t=i.head).next,i.head=e,null==i.head&&(i.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(i.pushmod=!0));var s=t;s.elt=null,s.next=er.zpp_pool,er.zpp_pool=s,i.modified=!0,i.length--,i.pushmod=!0;break}r=(n=r).next}for(var o,a,l=this.b2.arbiters,p=null,h=l.head;null!=h;){if(h.elt==this){null==p?(a=(o=l.head).next,l.head=a,null==l.head&&(l.pushmod=!0)):(a=(o=p.next).next,null==(p.next=a)&&(l.pushmod=!0));var u=o;u.elt=null,u.next=er.zpp_pool,er.zpp_pool=u,l.modified=!0,l.length--,l.pushmod=!0;break}h=(p=h).next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1},Qe.prototype.__class__=Qe;var Kn=zpp_nape.dynamics.ZPP_SensorArbiter=function(){this.next=null,Qe.call(this),this.type=Qe.SENSOR,this.sensorarb=this};Kn.__name__=["zpp_nape","dynamics","ZPP_SensorArbiter"],Kn.__super__=Qe,Kn.prototype=Object.create(Qe.prototype),Kn.prototype.next=null,Kn.prototype.alloc=function(){},Kn.prototype.free=function(){},Kn.prototype.assign=function(t,e,i,n){this.b1=t.body,this.ws1=t,this.b2=e.body,this.ws2=e,this.id=i,this.di=n;n=this.b1.arbiters;null==er.zpp_pool?r=new er:(r=er.zpp_pool,er.zpp_pool=r.next,r.next=null),r.elt=this;var r=r;r.next=n.head,n.head=r,n.modified=!0,n.length++;n=this.b2.arbiters;null==er.zpp_pool?s=new er:(s=er.zpp_pool,er.zpp_pool=s.next,s.next=null),s.elt=this;var s=s;s.next=n.head,n.head=s,n.modified=!0,n.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1},Kn.prototype.retire=function(){if(!this.cleared){for(var t,e,i=this.b1.arbiters,n=null,r=i.head;null!=r;){if(r.elt==this){null==n?(e=(t=i.head).next,i.head=e,null==i.head&&(i.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(i.pushmod=!0));var s=t;s.elt=null,s.next=er.zpp_pool,er.zpp_pool=s,i.modified=!0,i.length--,i.pushmod=!0;break}r=(n=r).next}for(var o,a,l=this.b2.arbiters,p=null,h=l.head;null!=h;){if(h.elt==this){null==p?(a=(o=l.head).next,l.head=a,null==l.head&&(l.pushmod=!0)):(a=(o=p.next).next,null==(p.next=a)&&(l.pushmod=!0));var u=o;u.elt=null,u.next=er.zpp_pool,er.zpp_pool=u,l.modified=!0,l.length--,l.pushmod=!0;break}h=(p=h).next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1;this.next=Kn.zpp_pool,Kn.zpp_pool=this},Kn.prototype.makemutable=function(){},Kn.prototype.makeimmutable=function(){},Kn.prototype.__class__=Kn;var Zn=zpp_nape.dynamics.ZPP_FluidArbiter=function(){this.pre_dt=0,this.mutable=!1,this.wrap_position=null,this.buoyy=0,this.buoyx=0,this.ny=0,this.nx=0,this.lgamma=0,this.dampy=0,this.dampx=0,this.vMassc=0,this.vMassb=0,this.vMassa=0,this.agamma=0,this.adamp=0,this.wMass=0,this.nodrag=!1,this.r2y=0,this.r2x=0,this.r1y=0,this.r1x=0,this.overlap=0,this.centroidy=0,this.centroidx=0,this.next=null,this.outer_zn=null,Qe.call(this),this.type=Qe.FLUID,(this.fluidarb=this).buoyx=0,this.buoyy=0,this.pre_dt=-1};Zn.__name__=["zpp_nape","dynamics","ZPP_FluidArbiter"],Zn.__super__=Qe,Zn.prototype=Object.create(Qe.prototype),Zn.prototype.outer_zn=null,Zn.prototype.next=null,Zn.prototype.alloc=function(){},Zn.prototype.free=function(){},Zn.prototype.centroidx=null,Zn.prototype.centroidy=null,Zn.prototype.overlap=null,Zn.prototype.r1x=null,Zn.prototype.r1y=null,Zn.prototype.r2x=null,Zn.prototype.r2y=null,Zn.prototype.nodrag=null,Zn.prototype.wMass=null,Zn.prototype.adamp=null,Zn.prototype.agamma=null,Zn.prototype.vMassa=null,Zn.prototype.vMassb=null,Zn.prototype.vMassc=null,Zn.prototype.dampx=null,Zn.prototype.dampy=null,Zn.prototype.lgamma=null,Zn.prototype.nx=null,Zn.prototype.ny=null,Zn.prototype.buoyx=null,Zn.prototype.buoyy=null,Zn.prototype.position_validate=function(){this.wrap_position.zpp_inner.x=this.centroidx,this.wrap_position.zpp_inner.y=this.centroidy},Zn.prototype.position_invalidate=function(t){this.centroidx=t.x,this.centroidy=t.y},Zn.prototype.wrap_position=null,Zn.prototype.getposition=function(){var t,e,i;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=0,e.y=0,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),0==t.zpp_inner.x&&(null!=(i=t.zpp_inner)._validate&&i._validate(),0==t.zpp_inner.y)||(t.zpp_inner.x=0,t.zpp_inner.y=0,null!=(i=t.zpp_inner)._invalidate&&i._invalidate(i))),t.zpp_inner.weak=!1,this.wrap_position=t,this.wrap_position.zpp_inner._inuse=!0,this.wrap_position.zpp_inner._immutable=!this.mutable,this.wrap_position.zpp_inner._validate=Z(this,this.position_validate),this.wrap_position.zpp_inner._invalidate=Z(this,this.position_invalidate)},Zn.prototype.assign=function(t,e,i,n){this.b1=t.body,this.ws1=t,this.b2=e.body,this.ws2=e,this.id=i,this.di=n;n=this.b1.arbiters;null==er.zpp_pool?r=new er:(r=er.zpp_pool,er.zpp_pool=r.next,r.next=null),r.elt=this;var r=r;r.next=n.head,n.head=r,n.modified=!0,n.length++;n=this.b2.arbiters;null==er.zpp_pool?s=new er:(s=er.zpp_pool,er.zpp_pool=s.next,s.next=null),s.elt=this;var s=s;s.next=n.head,n.head=s,n.modified=!0,n.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1,this.nx=0,this.ny=1,this.dampx=0,this.dampy=0,this.adamp=0},Zn.prototype.retire=function(){if(!this.cleared){for(var t,e,i=this.b1.arbiters,n=null,r=i.head;null!=r;){if(r.elt==this){null==n?(e=(t=i.head).next,i.head=e,null==i.head&&(i.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(i.pushmod=!0));var s=t;s.elt=null,s.next=er.zpp_pool,er.zpp_pool=s,i.modified=!0,i.length--,i.pushmod=!0;break}r=(n=r).next}for(var o,a,l=this.b2.arbiters,p=null,h=l.head;null!=h;){if(h.elt==this){null==p?(a=(o=l.head).next,l.head=a,null==l.head&&(l.pushmod=!0)):(a=(o=p.next).next,null==(p.next=a)&&(l.pushmod=!0));var u=o;u.elt=null,u.next=er.zpp_pool,er.zpp_pool=u,l.modified=!0,l.length--,l.pushmod=!0;break}h=(p=h).next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1;this.next=Zn.zpp_pool,(Zn.zpp_pool=this).pre_dt=-1},Zn.prototype.mutable=null,Zn.prototype.makemutable=function(){this.mutable=!0,null!=this.wrap_position&&(this.wrap_position.zpp_inner._immutable=!1)},Zn.prototype.makeimmutable=function(){this.mutable=!1,null!=this.wrap_position&&(this.wrap_position.zpp_inner._immutable=!0)},Zn.prototype.inject=function(t,e,i){this.overlap=t,this.centroidx=e,this.centroidy=i},Zn.prototype.pre_dt=null,Zn.prototype.preStep=function(t,e){-1==this.pre_dt&&(this.pre_dt=e);var i=e/this.pre_dt;this.pre_dt=e,this.r1x=this.centroidx-this.b1.posx,this.r1y=this.centroidy-this.b1.posy,this.r2x=this.centroidx-this.b2.posx,this.r2y=this.centroidy-this.b2.posy;var n,r,s,o,a,l=0,p=0,p=this.ws1.fluidEnabled&&null!=this.ws1.fluidProperties.wrap_gravity?(l=this.ws1.fluidProperties.gravityx,this.ws1.fluidProperties.gravityy):(l=t.gravityx,t.gravityy),h=0,u=0,u=this.ws2.fluidEnabled&&null!=this.ws2.fluidProperties.wrap_gravity?(h=this.ws2.fluidProperties.gravityx,this.ws2.fluidProperties.gravityy):(h=t.gravityx,t.gravityy),c=0,d=0;if(this.ws1.fluidEnabled&&this.ws2.fluidEnabled?(n=this.overlap*this.ws1.fluidProperties.density,(s=this.overlap*this.ws2.fluidProperties.density)<n?(c-=l*(o=n+s),d-=p*o):n<s?(c+=h*(r=n+s),d+=u*r):(o=t=0,t=l+h,o=p+u,t*=.5,o*=.5,this.ws1.worldCOMx*t+this.ws1.worldCOMy*o>this.ws2.worldCOMx*t+this.ws2.worldCOMy*o?(c-=t*(r=n+s),d-=o*r):(c+=t*(s=n+s),d+=o*s))):this.ws1.fluidEnabled?(c-=l*(l=this.overlap*this.ws1.fluidProperties.density),d-=p*l):this.ws2.fluidEnabled&&(c+=h*(a=this.overlap*this.ws2.fluidProperties.density),d+=u*a),c*=e,d*=e,this.buoyx=c,this.buoyy=d,2==this.b1.type&&(a=this.b1.imass,this.b1.velx-=c*a,this.b1.vely-=d*a,this.b1.angvel-=(d*this.r1x-c*this.r1y)*this.b1.iinertia),2==this.b2.type&&(_=this.b2.imass,this.b2.velx+=c*_,this.b2.vely+=d*_,this.b2.angvel+=(d*this.r2x-c*this.r2y)*this.b2.iinertia),this.ws1.fluidEnabled&&0!=this.ws1.fluidProperties.viscosity||this.ws2.fluidEnabled&&0!=this.ws2.fluidProperties.viscosity){this.nodrag=!1;var _=0;this.ws1.fluidEnabled&&(this.ws2.validate_angDrag(),_=this.ws1.fluidProperties.viscosity*this.ws2.angDrag*this.overlap/this.ws2.area),this.ws2.fluidEnabled&&(this.ws1.validate_angDrag(),_+=this.ws2.fluidProperties.viscosity*this.ws1.angDrag*this.overlap/this.ws1.area),0!=_?(g=this.b1.sinertia+this.b2.sinertia,this.wMass=0!=g?1/g:0,_*=4e-4,f=2*Math.PI*_,this.agamma=1/(e*f*(2+f*e)),v=1/(1+this.agamma),this.agamma*=v,this.wMass*=v):(this.wMass=0,this.agamma=0);d=this.b2.velx+this.b2.kinvelx-this.r2y*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.r1y*(this.b2.angvel+this.b2.kinangvel)),c=this.b2.vely+this.b2.kinvely+this.r2x*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.r1x*(this.b1.angvel+this.b1.kinangvel));d*d+c*c<kr.epsilon*kr.epsilon||(d*=y=1/Math.sqrt(d*d+c*c),c*=y,this.nx=d,this.ny=c);var y,f,m,x,v,g=0;if(this.ws1.fluidEnabled){var b=-this.ws1.fluidProperties.viscosity*this.overlap/this.ws2.area;if(0==this.ws2.type)g=0-b*this.ws2.circle.radius*kr.fluidLinearDrag/(2*this.ws2.circle.radius*Math.PI);else{for(var z=0,w=0,C=this.ws2.polygon.edges.head;null!=C;){var P=C.elt;z+=P.length;P=b*P.length*(P.gnormx*this.nx+P.gnormy*this.ny);0<P&&(P*=-kr.fluidVacuumDrag),w-=.5*P*kr.fluidLinearDrag,C=C.next}g=w/z}}if(this.ws2.fluidEnabled){var T=-this.ws2.fluidProperties.viscosity*this.overlap/this.ws1.area;if(0==this.ws1.type)g-=T*this.ws1.circle.radius*kr.fluidLinearDrag/(2*this.ws1.circle.radius*Math.PI);else{for(var S=0,M=0,A=this.ws1.polygon.edges.head;null!=A;){var O=A.elt;S+=O.length;O=T*O.length*(O.gnormx*this.nx+O.gnormy*this.ny);0<O&&(O*=-kr.fluidVacuumDrag),M-=.5*O*kr.fluidLinearDrag,A=A.next}g+=M/S}}0!=g?(v=f=_=0,v=_=y=this.b1.smass+this.b2.smass,(f=0)!=this.b1.sinertia&&(d=this.r1x*this.b1.sinertia,_=y+(c=this.r1y*this.b1.sinertia)*this.r1y,f+=-c*this.r1x,v=y+d*this.r1x),0!=this.b2.sinertia&&(x=this.r2x*this.b2.sinertia,_+=(m=this.r2y*this.b2.sinertia)*this.r2y,f+=-m*this.r2x,v+=x*this.r2x),(m=_*v-f*f)!=m?_=f=v=0:0==m?(_=0!=_?1/_:0,v=0!=v?1/v:0,f=0):(x=v*(m=1/m),v=_*m,_=x,f*=-m),this.vMassa=_,this.vMassb=f,this.vMassc=v,g=2*Math.PI*g,this.lgamma=1/(e*g*(2+g*e)),e=1/(1+this.lgamma),this.lgamma*=e,this.vMassa*=e,this.vMassb*=e,this.vMassc*=e):(this.vMassa=0,this.vMassb=0,this.vMassc=0,this.lgamma=0)}else this.nodrag=!0,this.dampx=0,this.dampy=0,this.adamp=0;this.dampx*=i,this.dampy*=i,this.adamp*=i},Zn.prototype.warmStart=function(){var t=this.b1.imass;this.b1.velx-=this.dampx*t,this.b1.vely-=this.dampy*t;t=this.b2.imass;this.b2.velx+=this.dampx*t,this.b2.vely+=this.dampy*t,this.b1.angvel-=this.b1.iinertia*(this.dampy*this.r1x-this.dampx*this.r1y),this.b2.angvel+=this.b2.iinertia*(this.dampy*this.r2x-this.dampx*this.r2y),this.b1.angvel-=this.adamp*this.b1.iinertia,this.b2.angvel+=this.adamp*this.b2.iinertia},Zn.prototype.applyImpulseVel=function(){var t,e,i,n,r;this.nodrag||(t=this.b1.angvel+this.b1.kinangvel,r=this.b2.angvel+this.b2.kinangvel,i=this.b1.velx+this.b1.kinvelx-this.r1y*t-(this.b2.velx+this.b2.kinvelx-this.r2y*r),e=this.b1.vely+this.b1.kinvely+this.r1x*t-(this.b2.vely+this.b2.kinvely+this.r2x*r),n=this.vMassa*i+this.vMassb*e,e=this.vMassb*i+this.vMassc*e,i=n,n=this.lgamma,i-=this.dampx*n,e-=this.dampy*n,this.dampx+=i,this.dampy+=e,n=this.b1.imass,this.b1.velx-=i*n,this.b1.vely-=e*n,n=this.b2.imass,this.b2.velx+=i*n,this.b2.vely+=e*n,this.b1.angvel-=this.b1.iinertia*(e*this.r1x-i*this.r1y),this.b2.angvel+=this.b2.iinertia*(e*this.r2x-i*this.r2y),r=(t-r)*this.wMass-this.adamp*this.agamma,this.adamp+=r,this.b1.angvel-=r*this.b1.iinertia,this.b2.angvel+=r*this.b2.iinertia)},Zn.prototype.__class__=Zn;var Jn=zpp_nape.dynamics.ZPP_ColArbiter=function(){this.pre_dt=0,this.mutable=!1,this.stat=!1,this.next=null,this.hpc2=!1,this.hc2=!1,this.oc2=null,this.c2=null,this.oc1=null,this.c1=null,this.__ref_vertex=0,this.__ref_edge2=null,this.__ref_edge1=null,this.biasCoef=0,this.rev=!1,this.radius=0,this.lproj=0,this.lnormy=0,this.lnormx=0,this.surfacey=0,this.surfacex=0,this.k2y=0,this.k2x=0,this.k1y=0,this.k1x=0,this.rt2b=0,this.rn2b=0,this.rt2a=0,this.rn2a=0,this.rt1b=0,this.rn1b=0,this.rt1a=0,this.rn1a=0,this.jrAcc=0,this.rMass=0,this.Kc=0,this.Kb=0,this.Ka=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_normal=null,this.ny=0,this.nx=0,this.innards=null,this.wrap_contacts=null,this.contacts=null,this.s2=null,this.s1=null,this.userdef_rfric=!1,this.userdef_restitution=!1,this.userdef_stat_fric=!1,this.userdef_dyn_fric=!1,this.rfric=0,this.restitution=0,this.stat_fric=0,this.dyn_fric=0,this.outer_zn=null,Qe.call(this),this.pre_dt=-1,this.contacts=new Qn,this.innards=new ae,this.type=Qe.COL,this.colarb=this};Jn.__name__=["zpp_nape","dynamics","ZPP_ColArbiter"],Jn.__super__=Qe,Jn.prototype=Object.create(Qe.prototype),Jn.prototype.outer_zn=null,Jn.prototype.dyn_fric=null,Jn.prototype.stat_fric=null,Jn.prototype.restitution=null,Jn.prototype.rfric=null,Jn.prototype.userdef_dyn_fric=null,Jn.prototype.userdef_stat_fric=null,Jn.prototype.userdef_restitution=null,Jn.prototype.userdef_rfric=null,Jn.prototype.s1=null,Jn.prototype.s2=null,Jn.prototype.contacts=null,Jn.prototype.wrap_contacts=null,Jn.prototype.innards=null,Jn.prototype.nx=null,Jn.prototype.ny=null,Jn.prototype.normal_validate=function(){if(this.cleared)throw new r("Error: Arbiter not currently in use");this.wrap_normal.zpp_inner.x=this.nx,this.wrap_normal.zpp_inner.y=this.ny,this.ws1.id>this.ws2.id&&(this.wrap_normal.zpp_inner.x=-this.wrap_normal.zpp_inner.x,this.wrap_normal.zpp_inner.y=-this.wrap_normal.zpp_inner.y)},Jn.prototype.wrap_normal=null,Jn.prototype.getnormal=function(){var t,e,i;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=0,e.y=0,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),0==t.zpp_inner.x&&(null!=(i=t.zpp_inner)._validate&&i._validate(),0==t.zpp_inner.y)||(t.zpp_inner.x=0,t.zpp_inner.y=0,null!=(i=t.zpp_inner)._invalidate&&i._invalidate(i))),t.zpp_inner.weak=!1,this.wrap_normal=t,this.wrap_normal.zpp_inner._immutable=!0,this.wrap_normal.zpp_inner._inuse=!0,this.wrap_normal.zpp_inner._validate=Z(this,this.normal_validate)},Jn.prototype.kMassa=null,Jn.prototype.kMassb=null,Jn.prototype.kMassc=null,Jn.prototype.Ka=null,Jn.prototype.Kb=null,Jn.prototype.Kc=null,Jn.prototype.rMass=null,Jn.prototype.jrAcc=null,Jn.prototype.rn1a=null,Jn.prototype.rt1a=null,Jn.prototype.rn1b=null,Jn.prototype.rt1b=null,Jn.prototype.rn2a=null,Jn.prototype.rt2a=null,Jn.prototype.rn2b=null,Jn.prototype.rt2b=null,Jn.prototype.k1x=null,Jn.prototype.k1y=null,Jn.prototype.k2x=null,Jn.prototype.k2y=null,Jn.prototype.surfacex=null,Jn.prototype.surfacey=null,Jn.prototype.ptype=null,Jn.prototype.lnormx=null,Jn.prototype.lnormy=null,Jn.prototype.lproj=null,Jn.prototype.radius=null,Jn.prototype.rev=null,Jn.prototype.biasCoef=null,Jn.prototype.__ref_edge1=null,Jn.prototype.__ref_edge2=null,Jn.prototype.__ref_vertex=null,Jn.prototype.c1=null,Jn.prototype.oc1=null,Jn.prototype.c2=null,Jn.prototype.oc2=null,Jn.prototype.hc2=null,Jn.prototype.hpc2=null,Jn.prototype.next=null,Jn.prototype.alloc=function(){},Jn.prototype.free=function(){this.userdef_dyn_fric=!1,this.userdef_stat_fric=!1,this.userdef_restitution=!1,this.userdef_rfric=!1,this.__ref_edge1=this.__ref_edge2=null},Jn.prototype.stat=null,Jn.prototype.injectContact=function(t,e,i,n,r,s,o){null==o&&(o=!1);for(var a,l,p,h=null,u=this.contacts.next;null!=u;){if(s==u.hash){h=u;break}u=u.next}return null==h?(null==Qn.zpp_pool?h=new Qn:(h=Qn.zpp_pool,Qn.zpp_pool=h.next,h.next=null),(a=h.inner).jnAcc=a.jtAcc=0,h.hash=s,h.fresh=!0,(h.arbiter=this).jrAcc=0,l=this.contacts,h._inuse=!0,(p=h).next=l.next,l.next=p,l.modified=!0,l.length++,this.innards.add(a)):h.fresh=!1,h.px=t,h.py=e,this.nx=i,this.ny=n,h.dist=r,h.stamp=this.stamp,h.posOnly=o,h},Jn.prototype.assign=function(t,e,i,n){this.b1=t.body,this.ws1=t,this.b2=e.body,this.ws2=e,this.id=i,this.di=n;n=this.b1.arbiters;null==er.zpp_pool?r=new er:(r=er.zpp_pool,er.zpp_pool=r.next,r.next=null),r.elt=this;var r=r;r.next=n.head,n.head=r,n.modified=!0,n.length++;n=this.b2.arbiters;null==er.zpp_pool?s=new er:(s=er.zpp_pool,er.zpp_pool=s.next,s.next=null),s.elt=this;var s=s;s.next=n.head,n.head=s,n.modified=!0,n.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1,this.s1=t,this.s2=e,this.userdef_restitution||(this.s1.material.elasticity<=-1/0||this.s2.material.elasticity<=-1/0?this.restitution=0:this.s1.material.elasticity>=1/0||this.s2.material.elasticity>=1/0?this.restitution=1:this.restitution=(this.s1.material.elasticity+this.s2.material.elasticity)/2,this.restitution<0&&(this.restitution=0),1<this.restitution&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))},Jn.prototype.calcProperties=function(){this.userdef_restitution||(this.s1.material.elasticity<=-1/0||this.s2.material.elasticity<=-1/0?this.restitution=0:this.s1.material.elasticity>=1/0||this.s2.material.elasticity>=1/0?this.restitution=1:this.restitution=(this.s1.material.elasticity+this.s2.material.elasticity)/2,this.restitution<0&&(this.restitution=0),1<this.restitution&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))},Jn.prototype.validate_props=function(){this.invalidated&&(this.invalidated=!1,this.userdef_restitution||(this.s1.material.elasticity<=-1/0||this.s2.material.elasticity<=-1/0?this.restitution=0:this.s1.material.elasticity>=1/0||this.s2.material.elasticity>=1/0?this.restitution=1:this.restitution=(this.s1.material.elasticity+this.s2.material.elasticity)/2,this.restitution<0&&(this.restitution=0),1<this.restitution&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction)))},Jn.prototype.retire=function(){if(!this.cleared){for(var t,e,i=this.b1.arbiters,n=null,r=i.head;null!=r;){if(r.elt==this){null==n?(e=(t=i.head).next,i.head=e,null==i.head&&(i.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(i.pushmod=!0));var s=t;s.elt=null,s.next=er.zpp_pool,er.zpp_pool=s,i.modified=!0,i.length--,i.pushmod=!0;break}r=(n=r).next}for(var o,a,l=this.b2.arbiters,p=null,h=l.head;null!=h;){if(h.elt==this){null==p?(a=(o=l.head).next,l.head=a,null==l.head&&(l.pushmod=!0)):(a=(o=p.next).next,null==(p.next=a)&&(l.pushmod=!0));var u=o;u.elt=null,u.next=er.zpp_pool,er.zpp_pool=u,l.modified=!0,l.length--,l.pushmod=!0;break}h=(p=h).next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}for(this.b1=this.b2=null,this.active=!1,this.intchange=!1;null!=this.contacts.next;){var c=this.contacts,d=c.next;c.pop(),d.arbiter=null,d.next=Qn.zpp_pool,Qn.zpp_pool=d;c=this.innards,d=c.next;c.next=d.next,d._inuse=!1,null==c.next&&(c.pushmod=!0),c.modified=!0,c.length--}this.userdef_dyn_fric=!1,this.userdef_stat_fric=!1,this.userdef_restitution=!1,this.userdef_rfric=!1,this.__ref_edge1=this.__ref_edge2=null,this.next=Jn.zpp_pool,(Jn.zpp_pool=this).pre_dt=-1},Jn.prototype.mutable=null,Jn.prototype.makemutable=function(){this.mutable=!0,null!=this.wrap_normal&&(this.wrap_normal.zpp_inner._immutable=!1),null!=this.wrap_contacts&&(this.wrap_contacts.zpp_inner.immutable=!1)},Jn.prototype.makeimmutable=function(){this.mutable=!1,null!=this.wrap_normal&&(this.wrap_normal.zpp_inner._immutable=!0),null!=this.wrap_contacts&&(this.wrap_contacts.zpp_inner.immutable=!0)},Jn.prototype.contacts_adder=function(t){return!1},Jn.prototype.contacts_subber=function(t){for(var e=null,i=null,n=this.innards.next,r=this.contacts.next;null!=r;){var s=r;if(s==t.zpp_inner){this.contacts.erase(e),this.innards.erase(i),s.arbiter=null,s.next=Qn.zpp_pool,Qn.zpp_pool=s;break}e=r,n=(i=n).next,r=r.next}},Jn.prototype.setupcontacts=function(){this.wrap_contacts=Ln.get(this.contacts,!0),this.wrap_contacts.zpp_inner.immutable=!this.mutable,this.wrap_contacts.zpp_inner.adder=Z(this,this.contacts_adder),this.wrap_contacts.zpp_inner.dontremove=!0,this.wrap_contacts.zpp_inner.subber=Z(this,this.contacts_subber)},Jn.prototype.cleanupContacts=function(){var t=!0,e=null,i=null,n=this.innards.next;this.hc2=!1;for(var r,s=this.contacts.next;null!=s;){var o,a,l,p,h,u,c=s;c.stamp+kr.arbiterExpirationDelay<this.stamp?(h=this.contacts,null==e?(a=(o=h.next).next,h.next=a,null==h.next&&(h.pushmod=!0)):(a=(o=e.next).next,null==(e.next=a)&&(h.pushmod=!0)),o._inuse=!1,h.modified=!0,h.length--,h.pushmod=!0,s=a,u=this.innards,null==i?(p=(l=u.next).next,u.next=p,null==u.next&&(u.pushmod=!0)):(p=(l=i.next).next,null==(i.next=p)&&(u.pushmod=!0)),l._inuse=!1,u.modified=!0,u.length--,u.pushmod=!0,n=p,c.arbiter=null,c.next=Qn.zpp_pool,Qn.zpp_pool=c):(h=c.inner,u=c.active,c.active=c.stamp==this.stamp,c.active&&(t?(t=!1,this.c1=h,this.oc1=c):(this.hc2=!0,this.c2=h,this.oc2=c)),u!=c.active&&(this.contacts.modified=!0),e=s,n=(i=n).next,s=s.next)}return this.hc2?(this.hpc2=!0,this.oc1.posOnly?(r=this.c1,this.c1=this.c2,this.c2=r,r=this.oc1,this.oc1=this.oc2,this.oc2=r,this.hc2=!1):this.oc2.posOnly&&(this.hc2=!1),this.oc1.posOnly&&(t=!0)):this.hpc2=!1,t},Jn.prototype.pre_dt=null,Jn.prototype.preStep=function(t){this.invalidated&&(this.invalidated=!1,this.userdef_restitution||(this.s1.material.elasticity<=-1/0||this.s2.material.elasticity<=-1/0?this.restitution=0:this.s1.material.elasticity>=1/0||this.s2.material.elasticity>=1/0?this.restitution=1:this.restitution=(this.s1.material.elasticity+this.s2.material.elasticity)/2,this.restitution<0&&(this.restitution=0),1<this.restitution&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))),-1==this.pre_dt&&(this.pre_dt=t);var e=t/this.pre_dt;this.pre_dt=t;var i=this.b1.smass+this.b2.smass,n=!(this.hc2=!1);this.biasCoef=2!=this.b1.type||2!=this.b2.type?this.continuous?kr.contactContinuousStaticBiasCoef:kr.contactStaticBiasCoef:this.continuous?kr.contactContinuousBiasCoef:kr.contactBiasCoef,this.continuous=!1;for(var r,s,o=null,a=null,l=this.innards.next,p=this.contacts.next;null!=p;){var h,u,c,d,_,y,f,m,x,v=p;v.stamp+kr.arbiterExpirationDelay<this.stamp?(f=this.contacts,null==o?(u=(h=f.next).next,f.next=u,null==f.next&&(f.pushmod=!0)):(u=(h=o.next).next,null==(o.next=u)&&(f.pushmod=!0)),h._inuse=!1,f.modified=!0,f.length--,f.pushmod=!0,p=u,m=this.innards,null==a?(d=(c=m.next).next,m.next=d,null==m.next&&(m.pushmod=!0)):(d=(c=a.next).next,null==(a.next=d)&&(m.pushmod=!0)),c._inuse=!1,m.modified=!0,m.length--,m.pushmod=!0,l=d,v.arbiter=null,v.next=Qn.zpp_pool,Qn.zpp_pool=v):(_=v.inner,y=v.active,v.active=v.stamp==this.stamp,v.active&&(n?(n=!1,this.c1=_,this.oc1=v):(this.hc2=!0,this.c2=_,this.oc2=v),_.r2x=v.px-this.b2.posx,_.r2y=v.py-this.b2.posy,_.r1x=v.px-this.b1.posx,_.r1y=v.py-this.b1.posy,x=_.r2x*this.nx+_.r2y*this.ny,f=i+this.b2.sinertia*(x*x),m=_.r1x*this.nx+_.r1y*this.ny,f+=this.b1.sinertia*(m*m),_.tMass=f<kr.epsilon*kr.epsilon?0:1/f,x=this.ny*_.r2x-this.nx*_.r2y,m=i+this.b2.sinertia*(x*x),f=this.ny*_.r1x-this.nx*_.r1y,m+=this.b1.sinertia*(f*f),_.nMass=m<kr.epsilon*kr.epsilon?0:1/m,f=x=0,m=this.b2.angvel+this.b2.kinangvel,x=this.b2.velx+this.b2.kinvelx-_.r2y*m,f=this.b2.vely+this.b2.kinvely+_.r2x*m,m=this.b1.angvel+this.b1.kinangvel,x-=this.b1.velx+this.b1.kinvelx-_.r1y*m,f-=this.b1.vely+this.b1.kinvely+_.r1x*m,m=this.nx*x+this.ny*f,v.elasticity=this.restitution,_.bounce=m*v.elasticity,_.bounce>-kr.elasticThreshold&&(_.bounce=0),m=f*this.nx-x*this.ny,x=kr.staticFrictionThreshold,_.friction=x*x<m*m?this.dyn_fric:this.stat_fric,_.jnAcc*=e,_.jtAcc*=e),y!=v.active&&(this.contacts.modified=!0),o=p,l=(a=l).next,p=p.next)}return this.hc2?(this.hpc2=!0,this.oc1.posOnly?(r=this.c1,this.c1=this.c2,this.c2=r,r=this.oc1,this.oc1=this.oc2,this.oc2=r,this.hc2=!1):this.oc2.posOnly&&(this.hc2=!1),this.oc1.posOnly&&(n=!0)):this.hpc2=!1,this.jrAcc*=e,n||(this.rn1a=this.ny*this.c1.r1x-this.nx*this.c1.r1y,this.rt1a=this.c1.r1x*this.nx+this.c1.r1y*this.ny,this.rn1b=this.ny*this.c1.r2x-this.nx*this.c1.r2y,this.rt1b=this.c1.r2x*this.nx+this.c1.r2y*this.ny,this.k1x=this.b2.kinvelx-this.c1.r2y*this.b2.kinangvel-(this.b1.kinvelx-this.c1.r1y*this.b1.kinangvel),this.k1y=this.b2.kinvely+this.c1.r2x*this.b2.kinangvel-(this.b1.kinvely+this.c1.r1x*this.b1.kinangvel)),this.hc2&&(this.rn2a=this.ny*this.c2.r1x-this.nx*this.c2.r1y,this.rt2a=this.c2.r1x*this.nx+this.c2.r1y*this.ny,this.rn2b=this.ny*this.c2.r2x-this.nx*this.c2.r2y,this.rt2b=this.c2.r2x*this.nx+this.c2.r2y*this.ny,this.k2x=this.b2.kinvelx-this.c2.r2y*this.b2.kinangvel-(this.b1.kinvelx-this.c2.r1y*this.b1.kinangvel),this.k2y=this.b2.kinvely+this.c2.r2x*this.b2.kinangvel-(this.b1.kinvely+this.c2.r1x*this.b1.kinangvel),this.kMassa=i+this.b1.sinertia*this.rn1a*this.rn1a+this.b2.sinertia*this.rn1b*this.rn1b,this.kMassb=i+this.b1.sinertia*this.rn1a*this.rn2a+this.b2.sinertia*this.rn1b*this.rn2b,this.kMassc=i+this.b1.sinertia*this.rn2a*this.rn2a+this.b2.sinertia*this.rn2b*this.rn2b,this.kMassa*this.kMassa+2*this.kMassb*this.kMassb+this.kMassc*this.kMassc<kr.illConditionedThreshold*(this.kMassa*this.kMassc-this.kMassb*this.kMassb)?(this.Ka=this.kMassa,this.Kb=this.kMassb,this.Kc=this.kMassc,(s=this.kMassa*this.kMassc-this.kMassb*this.kMassb)!=s?this.kMassa=this.kMassb=this.kMassc=0:0==s?(0!=this.kMassa?this.kMassa=1/this.kMassa:this.kMassa=0,0!=this.kMassc?this.kMassc=1/this.kMassc:this.kMassc=0,this.kMassb=0):(s=1/s,r=this.kMassc*s,this.kMassc=this.kMassa*s,this.kMassa=r,this.kMassb*=-s)):(this.hc2=!1,this.oc2.dist<this.oc1.dist&&(s=this.c1,this.c1=this.c2,this.c2=s),this.oc2.active=!1,this.contacts.modified=!0)),this.surfacex=this.b2.svelx,this.surfacey=this.b2.svely,this.surfacex+=this.b1.svelx,this.surfacey+=this.b1.svely,this.surfacex=-this.surfacex,this.surfacey=-this.surfacey,this.rMass=this.b1.sinertia+this.b2.sinertia,0!=this.rMass&&(this.rMass=1/this.rMass),n},Jn.prototype.warmStart=function(){var t=this.nx*this.c1.jnAcc-this.ny*this.c1.jtAcc,e=this.ny*this.c1.jnAcc+this.nx*this.c1.jtAcc,i=this.b1.imass;this.b1.velx-=t*i,this.b1.vely-=e*i,this.b1.angvel-=this.b1.iinertia*(e*this.c1.r1x-t*this.c1.r1y);i=this.b2.imass;this.b2.velx+=t*i,this.b2.vely+=e*i,this.b2.angvel+=this.b2.iinertia*(e*this.c1.r2x-t*this.c1.r2y),this.hc2&&(i=this.nx*this.c2.jnAcc-this.ny*this.c2.jtAcc,e=this.ny*this.c2.jnAcc+this.nx*this.c2.jtAcc,t=this.b1.imass,this.b1.velx-=i*t,this.b1.vely-=e*t,this.b1.angvel-=this.b1.iinertia*(e*this.c2.r1x-i*this.c2.r1y),t=this.b2.imass,this.b2.velx+=i*t,this.b2.vely+=e*t,this.b2.angvel+=this.b2.iinertia*(e*this.c2.r2x-i*this.c2.r2y)),this.b2.angvel+=this.jrAcc*this.b2.iinertia,this.b1.angvel-=this.jrAcc*this.b1.iinertia},Jn.prototype.applyImpulseVel=function(){var t,e,i,n,r,s,o,a,l,p,h,u,c=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),d=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel);i=(d*this.nx-c*this.ny+this.surfacex)*this.c1.tMass,(n=this.c1.friction*this.c1.jnAcc)<(s=(r=this.c1.jtAcc)-i)?s=n:s<-n&&(s=-n),i=s-r,this.c1.jtAcc=s,t=-this.ny*i,e=this.nx*i,this.b2.velx+=t*this.b2.imass,this.b2.vely+=e*this.b2.imass,this.b1.velx-=t*this.b1.imass,this.b1.vely-=e*this.b1.imass,this.b2.angvel+=this.rt1b*i*this.b2.iinertia,this.b1.angvel-=this.rt1a*i*this.b1.iinertia,this.hc2?(h=this.k2x+this.b2.velx-this.c2.r2y*this.b2.angvel-(this.b1.velx-this.c2.r1y*this.b1.angvel),i=((u=this.k2y+this.b2.vely+this.c2.r2x*this.b2.angvel-(this.b1.vely+this.c2.r1x*this.b1.angvel))*this.nx-h*this.ny+this.surfacex)*this.c2.tMass,(n=this.c2.friction*this.c2.jnAcc)<(s=(r=this.c2.jtAcc)-i)?s=n:s<-n&&(s=-n),i=s-r,this.c2.jtAcc=s,t=-this.ny*i,e=this.nx*i,this.b2.velx+=t*this.b2.imass,this.b2.vely+=e*this.b2.imass,this.b1.velx-=t*this.b1.imass,this.b1.vely-=e*this.b1.imass,this.b2.angvel+=this.rt2b*i*this.b2.iinertia,this.b1.angvel-=this.rt2a*i*this.b1.iinertia,c=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),d=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),h=this.k2x+this.b2.velx-this.c2.r2y*this.b2.angvel-(this.b1.velx-this.c2.r1y*this.b1.angvel),u=this.k2y+this.b2.vely+this.c2.r2x*this.b2.angvel-(this.b1.vely+this.c2.r1x*this.b1.angvel),o=this.c1.jnAcc,a=this.c2.jnAcc,l=c*this.nx+d*this.ny+this.surfacey+this.c1.bounce-(this.Ka*o+this.Kb*a),p=h*this.nx+u*this.ny+this.surfacey+this.c2.bounce-(this.Kb*o+this.Kc*a),h=-(this.kMassa*l+this.kMassb*p),u=-(this.kMassb*l+this.kMassc*p),0<=h&&0<=u?(l=h-o,p=u-a,this.c1.jnAcc=h,this.c2.jnAcc=u):0<=(h=-this.c1.nMass*l)&&0<=this.Kb*h+p?(l=h-o,p=-a,this.c1.jnAcc=h,this.c2.jnAcc=0):0<=(u=-this.c2.nMass*p)&&0<=this.Kb*u+l?(l=-o,p=u-a,this.c1.jnAcc=0,this.c2.jnAcc=u):0<=l&&0<=p?(l=-o,p=-a,this.c1.jnAcc=this.c2.jnAcc=0):p=l=0,i=l+p,t=this.nx*i,e=this.ny*i,this.b2.velx+=t*this.b2.imass,this.b2.vely+=e*this.b2.imass,this.b1.velx-=t*this.b1.imass,this.b1.vely-=e*this.b1.imass,this.b2.angvel+=(this.rn1b*l+this.rn2b*p)*this.b2.iinertia,this.b1.angvel-=(this.rn1a*l+this.rn2a*p)*this.b1.iinertia):(0!=this.radius&&(i=(this.b2.angvel-this.b1.angvel)*this.rMass,n=this.rfric*this.c1.jnAcc,r=this.jrAcc,this.jrAcc-=i,this.jrAcc>n?this.jrAcc=n:this.jrAcc<-n&&(this.jrAcc=-n),i=this.jrAcc-r,this.b2.angvel+=i*this.b2.iinertia,this.b1.angvel-=i*this.b1.iinertia),c=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),d=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),i=(this.c1.bounce+(this.nx*c+this.ny*d)+this.surfacey)*this.c1.nMass,(s=(r=this.c1.jnAcc)-i)<0&&(s=0),i=s-r,this.c1.jnAcc=s,t=this.nx*i,e=this.ny*i,this.b2.velx+=t*this.b2.imass,this.b2.vely+=e*this.b2.imass,this.b1.velx-=t*this.b1.imass,this.b1.vely-=e*this.b1.imass,this.b2.angvel+=this.rn1b*i*this.b2.iinertia,this.b1.angvel-=this.rn1a*i*this.b1.iinertia)},Jn.prototype.applyImpulsePos=function(){if(2==this.ptype){var t=this.c1,e=0,i=0;e=this.b2.axisy*t.lr2x-this.b2.axisx*t.lr2y,i=t.lr2x*this.b2.axisx+t.lr2y*this.b2.axisy,e+=this.b2.posx,i+=this.b2.posy;var n=0,r=0;n=this.b1.axisy*t.lr1x-this.b1.axisx*t.lr1y,r=t.lr1x*this.b1.axisx+t.lr1y*this.b1.axisy;var s=0,o=0,s=e-(n+=this.b1.posx),o=i-(r+=this.b1.posy),a=Math.sqrt(s*s+o*o),l=this.radius-kr.collisionSlop,t=a-l;s*this.nx+o*this.ny<0&&(s=-s,o=-o,t-=this.radius),t<0&&(a<kr.epsilon?0!=this.b1.smass?this.b1.posx+=10*kr.epsilon:this.b2.posx+=10*kr.epsilon:(s*=t=1/a,c=.5*(r+i),l=a-l,r=(o*=t)*(n=(t=.5*(n+e))-this.b1.posx)-s*(r=c-this.b1.posy),c=o*(e=t-this.b2.posx)-s*(i=c-this.b2.posy),0!=(i=this.b2.smass+c*c*this.b2.sinertia+this.b1.smass+r*r*this.b1.sinertia)&&(f=x=0,x=s*(d=-this.biasCoef*l/i),f=o*d,l=this.b1.imass,this.b1.posx-=x*l,this.b1.posy-=f*l,i=this.b1,o=-r*this.b1.iinertia*d,i.rot+=o,1e-4<o*o?(i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot)):(l=1-(u=o*o)*u/8,u=((r=1-.5*u)*i.axisx+o*i.axisy)*l,i.axisy=(r*i.axisy-o*i.axisx)*l,i.axisx=u),u=this.b2.imass,this.b2.posx+=x*u,this.b2.posy+=f*u,x=this.b2,f=c*this.b2.iinertia*d,x.rot+=f,1e-4<f*f?(x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot)):(m=1-(_=f*f)*_/8,v=((y=1-.5*_)*x.axisx+f*x.axisy)*m,x.axisy=(y*x.axisy-f*x.axisx)*m,x.axisx=v))))}else{var p=0,h=0,u=0,c=0,d=0,_=0;0==this.ptype?(p=this.b1.axisy*this.lnormx-this.b1.axisx*this.lnormy,h=this.lnormx*this.b1.axisx+this.lnormy*this.b1.axisy,g=this.lproj+(p*this.b1.posx+h*this.b1.posy),u=this.b2.axisy*this.c1.lr1x-this.b2.axisx*this.c1.lr1y,c=this.c1.lr1x*this.b2.axisx+this.c1.lr1y*this.b2.axisy,u+=this.b2.posx,c+=this.b2.posy,this.hpc2&&(d=this.b2.axisy*this.c2.lr1x-this.b2.axisx*this.c2.lr1y,_=this.c2.lr1x*this.b2.axisx+this.c2.lr1y*this.b2.axisy,d+=this.b2.posx,_+=this.b2.posy)):(p=this.b2.axisy*this.lnormx-this.b2.axisx*this.lnormy,h=this.lnormx*this.b2.axisx+this.lnormy*this.b2.axisy,g=this.lproj+(p*this.b2.posx+h*this.b2.posy),u=this.b1.axisy*this.c1.lr1x-this.b1.axisx*this.c1.lr1y,c=this.c1.lr1x*this.b1.axisx+this.c1.lr1y*this.b1.axisy,u+=this.b1.posx,c+=this.b1.posy,this.hpc2&&(d=this.b1.axisy*this.c2.lr1x-this.b1.axisx*this.c2.lr1y,_=this.c2.lr1x*this.b1.axisx+this.c2.lr1y*this.b1.axisy,d+=this.b1.posx,_+=this.b1.posy));var y=u*p+c*h-g-this.radius;y+=kr.collisionSlop;var f=0;if(this.hpc2&&(f=d*p+_*h-g-this.radius,f+=kr.collisionSlop),y<0||f<0){this.rev&&(p=-p,h=-h);var m=0,x=0,m=u-this.b1.posx,x=c-this.b1.posy,v=0,g=0,v=u-this.b2.posx,g=c-this.b2.posy;if(this.hpc2){var b=h*m-p*x,z=h*v-p*g,w=h*(d-this.b1.posx)-p*(_-this.b1.posy),C=h*(d-this.b2.posx)-p*(_-this.b2.posy),P=this.b1.smass+this.b2.smass;this.kMassa=P+this.b1.sinertia*b*b+this.b2.sinertia*z*z,this.kMassb=P+this.b1.sinertia*b*w+this.b2.sinertia*z*C,this.kMassc=P+this.b1.sinertia*w*w+this.b2.sinertia*C*C;for(var T=this.kMassa,S=this.kMassb,M=this.kMassc,A=y*this.biasCoef,O=f*this.biasCoef;;){var k=0,E=0;k=-(k=A),E=-(E=O);var I=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(I!=I?k=E=0:0==I?(0!=this.kMassa?k/=this.kMassa:k=0,0!=this.kMassc?E/=this.kMassc:E=0):(B=(I=1/I)*(this.kMassc*k-this.kMassb*E),E=I*(this.kMassa*E-this.kMassb*k),k=B),0<=k&&0<=E){var D=(k+E)*this.b1.imass;this.b1.posx-=p*D,this.b1.posy-=h*D;var I=this.b1,B=-this.b1.iinertia*(b*k+w*E);I.rot+=B,1e-4<B*B?(I.axisx=Math.sin(I.rot),I.axisy=Math.cos(I.rot)):(R=1-(L=B*B)*L/8,L=((D=1-.5*L)*I.axisx+B*I.axisy)*R,I.axisy=(D*I.axisy-B*I.axisx)*R,I.axisx=L);B=(k+E)*this.b2.imass;this.b2.posx+=p*B,this.b2.posy+=h*B;var L,R=this.b2,I=this.b2.iinertia*(z*k+C*E);R.rot+=I,1e-4<I*I?(R.axisx=Math.sin(R.rot),R.axisy=Math.cos(R.rot)):(L=1-(j=I*I)*j/8,j=((B=1-.5*j)*R.axisx+I*R.axisy)*L,R.axisy=(B*R.axisy-I*R.axisx)*L,R.axisx=j);break}if((E=0)<=(k=-A/T)&&0<=S*k+O){R=(k+E)*this.b1.imass;this.b1.posx-=p*R,this.b1.posy-=h*R;var F=this.b1,j=-this.b1.iinertia*(b*k+w*E);F.rot+=j,1e-4<j*j?(F.axisx=Math.sin(F.rot),F.axisy=Math.cos(F.rot)):(N=1-(G=j*j)*G/8,G=((R=1-.5*G)*F.axisx+j*F.axisy)*N,F.axisy=(R*F.axisy-j*F.axisx)*N,F.axisx=G);var N=(k+E)*this.b2.imass;this.b2.posx+=p*N,this.b2.posy+=h*N;var F=this.b2,G=this.b2.iinertia*(z*k+C*E);F.rot+=G,1e-4<G*G?(F.axisx=Math.sin(F.rot),F.axisy=Math.cos(F.rot)):(U=1-(X=G*G)*X/8,X=((N=1-.5*X)*F.axisx+G*F.axisy)*U,F.axisy=(N*F.axisy-G*F.axisx)*U,F.axisx=X);break}if((k=0)<=(E=-O/M)&&0<=S*E+A){var U=(k+E)*this.b1.imass;this.b1.posx-=p*U,this.b1.posy-=h*U;var F=this.b1,X=-this.b1.iinertia*(b*k+w*E);F.rot+=X,1e-4<X*X?(F.axisx=Math.sin(F.rot),F.axisy=Math.cos(F.rot)):(V=1-(W=X*X)*W/8,W=((U=1-.5*W)*F.axisx+X*F.axisy)*V,F.axisy=(U*F.axisy-X*F.axisx)*V,F.axisx=W);var V=(k+E)*this.b2.imass;this.b2.posx+=p*V,this.b2.posy+=h*V;var F=this.b2,W=this.b2.iinertia*(z*k+C*E);F.rot+=W,1e-4<W*W?(F.axisx=Math.sin(F.rot),F.axisy=Math.cos(F.rot)):(k=1-(V=W*W)*V/8,V=((E=1-.5*V)*F.axisx+W*F.axisy)*k,F.axisy=(E*F.axisy-W*F.axisx)*k,F.axisx=V);break}break}}else{var H,_=h*m-p*x,P=h*v-p*g,f=this.b2.smass+P*P*this.b2.sinertia+this.b1.smass+_*_*this.b1.sinertia;0!=f&&(x=m=0,m=p*(v=-this.biasCoef*y/f),x=h*v,g=this.b1.imass,this.b1.posx-=m*g,this.b1.posy-=x*g,y=this.b1,f=-_*this.b1.iinertia*v,y.rot+=f,1e-4<f*f?(y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot)):(g=1-(H=f*f)*H/8,H=((_=1-.5*H)*y.axisx+f*y.axisy)*g,y.axisy=(_*y.axisy-f*y.axisx)*g,y.axisx=H),H=this.b2.imass,this.b2.posx+=m*H,this.b2.posy+=x*H,m=this.b2,x=P*this.b2.iinertia*v,m.rot+=x,1e-4<x*x?(m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot)):(P=1-(H=x*x)*H/8,H=((v=1-.5*H)*m.axisx+x*m.axisy)*P,m.axisy=(v*m.axisy-x*m.axisx)*P,m.axisx=H))}}}},Jn.prototype.__class__=Jn;var Qn=zpp_nape.dynamics.ZPP_Contact=function(){this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.elasticity=0,this.dist=0,this.fresh=!1,this.hash=0,this.stamp=0,this.posOnly=!1,this.active=!1,this.inner=null,this.arbiter=null,this.wrap_position=null,this.py=0,this.px=0,this.outer=null,this.inner=new ae};Qn.__name__=["zpp_nape","dynamics","ZPP_Contact"],Qn.prototype.outer=null,Qn.prototype.wrapper=function(){return null==this.outer&&(Qn.internal=!0,this.outer=new D,Qn.internal=!1,this.outer.zpp_inner=this),this.outer},Qn.prototype.px=null,Qn.prototype.py=null,Qn.prototype.position_validate=function(){this.wrap_position.zpp_inner.x=this.px,this.wrap_position.zpp_inner.y=this.py},Qn.prototype.wrap_position=null,Qn.prototype.getposition=function(){var t,e,i;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=0,e.y=0,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),0==t.zpp_inner.x&&(null!=(i=t.zpp_inner)._validate&&i._validate(),0==t.zpp_inner.y)||(t.zpp_inner.x=0,t.zpp_inner.y=0,null!=(i=t.zpp_inner)._invalidate&&i._invalidate(i))),t.zpp_inner.weak=!1,this.wrap_position=t,this.wrap_position.zpp_inner._inuse=!0,this.wrap_position.zpp_inner._immutable=!0,this.wrap_position.zpp_inner._validate=Z(this,this.position_validate)},Qn.prototype.inactiveme=function(){return!(this.active&&null!=this.arbiter&&this.arbiter.active)},Qn.prototype.arbiter=null,Qn.prototype.inner=null,Qn.prototype.active=null,Qn.prototype.posOnly=null,Qn.prototype.stamp=null,Qn.prototype.hash=null,Qn.prototype.fresh=null,Qn.prototype.dist=null,Qn.prototype.elasticity=null,Qn.prototype.free=function(){this.arbiter=null},Qn.prototype.alloc=function(){},Qn.prototype.next=null,Qn.prototype.elem=function(){return this},Qn.prototype.begin=function(){return this.next},Qn.prototype._inuse=null,Qn.prototype.modified=null,Qn.prototype.pushmod=null,Qn.prototype.length=null,Qn.prototype.setbegin=function(t){this.next=t,this.modified=!0,this.pushmod=!0},Qn.prototype.add=function(t){return t._inuse=!0,t.next=this.next,this.next=t,this.modified=!0,this.length++,t},Qn.prototype.inlined_add=function(t){return t._inuse=!0,t.next=this.next,this.next=t,this.modified=!0,this.length++,t},Qn.prototype.addAll=function(t){for(var e=t.next;null!=e;)this.add(e),e=e.next},Qn.prototype.insert=function(t,e){return e._inuse=!0,null==t?(e.next=this.next,this.next=e):(e.next=t.next,t.next=e),this.pushmod=this.modified=!0,this.length++,e},Qn.prototype.inlined_insert=function(t,e){return e._inuse=!0,null==t?(e.next=this.next,this.next=e):(e.next=t.next,t.next=e),this.pushmod=this.modified=!0,this.length++,e},Qn.prototype.pop=function(){var t=this.next;this.next=t.next,t._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},Qn.prototype.inlined_pop=function(){var t=this.next;this.next=t.next,t._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},Qn.prototype.pop_unsafe=function(){var t=this.next;return this.pop(),t},Qn.prototype.inlined_pop_unsafe=function(){var t=this.next;return this.pop(),t},Qn.prototype.remove=function(t){for(var e,i,n=null,r=this.next;null!=r;){if(r==t){null==n?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Qn.prototype.try_remove=function(t){for(var e=null,i=this.next,n=!1;null!=i;){if(i==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Qn.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.next;null!=r;){if(r==t){null==n?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Qn.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.next,s=!1;null!=r;){if(r==t){null==n?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Qn.prototype.erase=function(t){var e,i;return null==t?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=t.next).next,null==(t.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},Qn.prototype.inlined_erase=function(t){var e,i;return null==t?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=t.next).next,null==(t.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},Qn.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Qn.prototype.clear=function(){},Qn.prototype.inlined_clear=function(){},Qn.prototype.reverse=function(){for(var t=this.next,e=null;null!=t;){var i=t.next;t.next=e,e=this.next=t,t=i}this.modified=!0,this.pushmod=!0},Qn.prototype.empty=function(){return null==this.next},Qn.prototype.size=function(){return this.length},Qn.prototype.has=function(t){for(var e=!1,i=this.next;null!=i;){if(i==t){e=!0;break}i=i.next}return e},Qn.prototype.inlined_has=function(t){for(var e=!1,i=this.next;null!=i;){if(i==t){e=!0;break}i=i.next}return e},Qn.prototype.front=function(){return this.next},Qn.prototype.back=function(){for(var t=this.next,e=t;null!=e;)e=(t=e).next;return t},Qn.prototype.iterator_at=function(t){for(var e=this.next;0<t--&&null!=e;)e=e.next;return e},Qn.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t:null},Qn.prototype.__class__=Qn;var ae=zpp_nape.dynamics.ZPP_IContact=function(){this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.lr2y=0,this.lr2x=0,this.lr1y=0,this.lr1x=0,this.jtAcc=0,this.jnAcc=0,this.friction=0,this.bounce=0,this.tMass=0,this.nMass=0,this.r2y=0,this.r2x=0,this.r1y=0,this.r1x=0};ae.__name__=["zpp_nape","dynamics","ZPP_IContact"],ae.prototype.r1x=null,ae.prototype.r1y=null,ae.prototype.r2x=null,ae.prototype.r2y=null,ae.prototype.nMass=null,ae.prototype.tMass=null,ae.prototype.bounce=null,ae.prototype.friction=null,ae.prototype.jnAcc=null,ae.prototype.jtAcc=null,ae.prototype.lr1x=null,ae.prototype.lr1y=null,ae.prototype.lr2x=null,ae.prototype.lr2y=null,ae.prototype.next=null,ae.prototype.elem=function(){return this},ae.prototype.begin=function(){return this.next},ae.prototype._inuse=null,ae.prototype.modified=null,ae.prototype.pushmod=null,ae.prototype.length=null,ae.prototype.setbegin=function(t){this.next=t,this.modified=!0,this.pushmod=!0},ae.prototype.add=function(t){return t._inuse=!0,t.next=this.next,this.next=t,this.modified=!0,this.length++,t},ae.prototype.inlined_add=function(t){return t._inuse=!0,t.next=this.next,this.next=t,this.modified=!0,this.length++,t},ae.prototype.addAll=function(t){for(var e=t.next;null!=e;)this.add(e),e=e.next},ae.prototype.insert=function(t,e){return e._inuse=!0,null==t?(e.next=this.next,this.next=e):(e.next=t.next,t.next=e),this.pushmod=this.modified=!0,this.length++,e},ae.prototype.inlined_insert=function(t,e){return e._inuse=!0,null==t?(e.next=this.next,this.next=e):(e.next=t.next,t.next=e),this.pushmod=this.modified=!0,this.length++,e},ae.prototype.pop=function(){var t=this.next;this.next=t.next,t._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},ae.prototype.inlined_pop=function(){var t=this.next;this.next=t.next,t._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},ae.prototype.pop_unsafe=function(){var t=this.next;return this.pop(),t},ae.prototype.inlined_pop_unsafe=function(){var t=this.next;return this.pop(),t},ae.prototype.remove=function(t){for(var e,i,n=null,r=this.next;null!=r;){if(r==t){null==n?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},ae.prototype.try_remove=function(t){for(var e=null,i=this.next,n=!1;null!=i;){if(i==t){this.erase(e),n=!0;break}i=(e=i).next}return n},ae.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.next;null!=r;){if(r==t){null==n?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},ae.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.next,s=!1;null!=r;){if(r==t){null==n?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},ae.prototype.erase=function(t){var e,i;return null==t?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=t.next).next,null==(t.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},ae.prototype.inlined_erase=function(t){var e,i;return null==t?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=t.next).next,null==(t.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},ae.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},ae.prototype.clear=function(){},ae.prototype.inlined_clear=function(){},ae.prototype.reverse=function(){for(var t=this.next,e=null;null!=t;){var i=t.next;t.next=e,e=this.next=t,t=i}this.modified=!0,this.pushmod=!0},ae.prototype.empty=function(){return null==this.next},ae.prototype.size=function(){return this.length},ae.prototype.has=function(t){for(var e=!1,i=this.next;null!=i;){if(i==t){e=!0;break}i=i.next}return e},ae.prototype.inlined_has=function(t){for(var e=!1,i=this.next;null!=i;){if(i==t){e=!0;break}i=i.next}return e},ae.prototype.front=function(){return this.next},ae.prototype.back=function(){for(var t=this.next,e=t;null!=e;)e=(t=e).next;return t},ae.prototype.iterator_at=function(t){for(var e=this.next;0<t--&&null!=e;)e=e.next;return e},ae.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t:null},ae.prototype.__class__=ae;var le=zpp_nape.dynamics.ZPP_InteractionFilter=function(){this.fluidMask=0,this.fluidGroup=0,this.sensorMask=0,this.sensorGroup=0,this.collisionMask=0,this.collisionGroup=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new ui,this.collisionGroup=this.sensorGroup=this.fluidGroup=1,this.collisionMask=this.sensorMask=this.fluidMask=-1};le.__name__=["zpp_nape","dynamics","ZPP_InteractionFilter"],le.prototype.next=null,le.prototype.userData=null,le.prototype.outer=null,le.prototype.wrapper=function(){var t;return null==this.outer&&(this.outer=new R,(t=this.outer.zpp_inner).outer=null,t.next=le.zpp_pool,le.zpp_pool=t,this.outer.zpp_inner=this),this.outer},le.prototype.free=function(){this.outer=null},le.prototype.alloc=function(){},le.prototype.shapes=null,le.prototype.wrap_shapes=null,le.prototype.feature_cons=function(){this.shapes=new ui},le.prototype.addShape=function(t){this.shapes.add(t)},le.prototype.remShape=function(t){this.shapes.remove(t)},le.prototype.copy=function(){var t;return null==le.zpp_pool?t=new le:(t=le.zpp_pool,le.zpp_pool=t.next,t.next=null),t.collisionGroup=this.collisionGroup,t.collisionMask=this.collisionMask,t.sensorGroup=this.sensorGroup,t.sensorMask=this.sensorMask,t.fluidGroup=this.fluidGroup,t.fluidMask=this.fluidMask,t},le.prototype.collisionGroup=null,le.prototype.collisionMask=null,le.prototype.shouldCollide=function(t){return 0!=(this.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&this.collisionGroup)},le.prototype.sensorGroup=null,le.prototype.sensorMask=null,le.prototype.shouldSense=function(t){return 0!=(this.sensorMask&t.sensorGroup)&&0!=(t.sensorMask&this.sensorGroup)},le.prototype.fluidGroup=null,le.prototype.fluidMask=null,le.prototype.shouldFlow=function(t){return 0!=(this.fluidMask&t.fluidGroup)&&0!=(t.fluidMask&this.fluidGroup)},le.prototype.invalidate=function(){for(var t=this.shapes.head;null!=t;)t.elt.invalidate_filter(),t=t.next},le.prototype.__class__=le;var pe=zpp_nape.dynamics.ZPP_InteractionGroup=function(){this.depth=0,this.wrap_interactors=null,this.interactors=null,this.wrap_groups=null,this.groups=null,this.group=null,this.ignore=!1,this.outer=null,this.depth=0,this.groups=new Ri,this.interactors=new Tt};pe.__name__=["zpp_nape","dynamics","ZPP_InteractionGroup"],pe.prototype.outer=null,pe.prototype.ignore=null,pe.prototype.group=null,pe.prototype.setGroup=function(t){this.group!=t&&(null!=this.group&&(this.group.groups.remove(this),this.depth=0,this.group.invalidate(!0)),null!=(this.group=t)?(t.groups.add(this),this.depth=t.depth+1,t.invalidate(!0)):this.invalidate(!0))},pe.prototype.groups=null,pe.prototype.wrap_groups=null,pe.prototype.interactors=null,pe.prototype.wrap_interactors=null,pe.prototype.depth=null,pe.prototype.invalidate=function(t){if(null==t&&(t=!1),t||this.ignore){for(var e=this.interactors.head;null!=e;){var i=e.elt;(null!=i.ibody?i.ibody:null!=i.ishape?i.ishape.body:i.icompound).wake(),e=e.next}for(var n=this.groups.head;null!=n;)n.elt.invalidate(t),n=n.next}},pe.prototype.addGroup=function(t){this.groups.add(t),t.depth=this.depth+1},pe.prototype.remGroup=function(t){this.groups.remove(t),t.depth=0},pe.prototype.addInteractor=function(t){this.interactors.add(t)},pe.prototype.remInteractor=function(t,e){null==e&&(e=-1),this.interactors.remove(t)},pe.prototype.__class__=pe;var he=zpp_nape.dynamics.ZPP_SpaceArbiterList=function(){this.at_index_3=0,this.at_index_2=0,this.at_index_1=0,this.at_index_0=0,this.ite_3=null,this.ite_2=null,this.ite_1=null,this.ite_0=null,this.lengths=null,this.zip_length=!1,this._length=0,this.space=null,k.call(this),this.at_index_0=0,this.at_index_1=0,this.at_index_2=0,this.at_index_3=0,this.zip_length=!0,this._length=0,this.lengths=[];for(var t=0;t<4;)++t,this.lengths.push(0)};he.__name__=["zpp_nape","dynamics","ZPP_SpaceArbiterList"],he.__super__=k,he.prototype=Object.create(k.prototype),he.prototype.space=null,he.prototype._length=null,he.prototype.zip_length=null,he.prototype.zpp_gl=function(){if(this.zpp_vm(),this.zip_length){for(var t=this._length=0,e=this.space.c_arbiters_true.head;null!=e;)e.elt.active&&++t,e=e.next;this.lengths[0]=t,this._length+=t;for(var i=0,n=this.space.c_arbiters_false.head;null!=n;)n.elt.active&&++i,n=n.next;this.lengths[1]=i,this._length+=i;for(var r=0,s=this.space.f_arbiters.head;null!=s;)s.elt.active&&++r,s=s.next;this.lengths[2]=r,this._length+=r;for(var o=0,a=this.space.s_arbiters.head;null!=a;)a.elt.active&&++o,a=a.next;this.lengths[3]=o,this._length+=o,this.zip_length=!1}return this._length},he.prototype.lengths=null,he.prototype.ite_0=null,he.prototype.ite_1=null,he.prototype.ite_2=null,he.prototype.ite_3=null,he.prototype.at_index_0=null,he.prototype.at_index_1=null,he.prototype.at_index_2=null,he.prototype.at_index_3=null,he.prototype.zpp_vm=function(){var t=!1;this.space.c_arbiters_true.modified&&(t=!0,this.space.c_arbiters_true.modified=!1),this.space.c_arbiters_false.modified&&(t=!0,this.space.c_arbiters_false.modified=!1),this.space.f_arbiters.modified&&(t=!0,this.space.f_arbiters.modified=!1),this.space.s_arbiters.modified&&(t=!0,this.space.s_arbiters.modified=!1),t&&(this.zip_length=!0,this._length=0,this.ite_0=null,this.ite_1=null,this.ite_2=null,this.ite_3=null)},he.prototype.push=function(t){return!1},he.prototype.pop=function(){return null},he.prototype.unshift=function(t){return!1},he.prototype.shift=function(){return null},he.prototype.remove=function(t){return!1},he.prototype.clear=function(){},he.prototype.at=function(t){this.zpp_vm();var e=null,i=0;if(null==e)if(t<this.lengths[0]){var n=t;if(n<this.at_index_0||null==this.ite_0)for(this.at_index_0=0,this.ite_0=this.space.c_arbiters_true.head;!this.ite_0.elt.active;)this.ite_0=this.ite_0.next;for(;this.at_index_0!=n;)for(this.at_index_0++,this.ite_0=this.ite_0.next;!this.ite_0.elt.active;)this.ite_0=this.ite_0.next;e=this.ite_0.elt.wrapper()}else i=this.lengths[0];if(null==e)if(t<i+this.lengths[1]){var r=t-i;if(r<this.at_index_1||null==this.ite_1)for(this.at_index_1=0,this.ite_1=this.space.c_arbiters_false.head;!this.ite_1.elt.active;)this.ite_1=this.ite_1.next;for(;this.at_index_1!=r;)for(this.at_index_1++,this.ite_1=this.ite_1.next;!this.ite_1.elt.active;)this.ite_1=this.ite_1.next;e=this.ite_1.elt.wrapper()}else i+=this.lengths[1];if(null==e)if(t<i+this.lengths[2]){var s=t-i;if(s<this.at_index_2||null==this.ite_2)for(this.at_index_2=0,this.ite_2=this.space.f_arbiters.head;!this.ite_2.elt.active;)this.ite_2=this.ite_2.next;for(;this.at_index_2!=s;)for(this.at_index_2++,this.ite_2=this.ite_2.next;!this.ite_2.elt.active;)this.ite_2=this.ite_2.next;e=this.ite_2.elt.wrapper()}else i+=this.lengths[2];if(null==e)if(t<i+this.lengths[3]){var o=t-i;if(o<this.at_index_3||null==this.ite_3)for(this.at_index_3=0,this.ite_3=this.space.s_arbiters.head;!this.ite_3.elt.active;)this.ite_3=this.ite_3.next;for(;this.at_index_3!=o;)for(this.at_index_3++,this.ite_3=this.ite_3.next;!this.ite_3.elt.active;)this.ite_3=this.ite_3.next;e=this.ite_3.elt.wrapper()}else i+=this.lengths[3];return e},he.prototype.__class__=he;var Be=zpp_nape.geom.ZPP_AABB=function(){this.wrap_max=null,this.maxy=0,this.maxx=0,this.wrap_min=null,this.miny=0,this.minx=0,this.next=null,this.outer=null,this._immutable=!1,this._validate=null,this._invalidate=null};Be.__name__=["zpp_nape","geom","ZPP_AABB"],Be.get=function(t,e,i,n){var r;return null==Be.zpp_pool?r=new Be:(r=Be.zpp_pool,Be.zpp_pool=r.next,r.next=null),r.minx=t,r.miny=e,r.maxx=i,r.maxy=n,r},Be.prototype._invalidate=null,Be.prototype._validate=null,Be.prototype._immutable=null,Be.prototype.validate=function(){null!=this._validate&&this._validate()},Be.prototype.invalidate=function(){null!=this._invalidate&&this._invalidate(this)},Be.prototype.outer=null,Be.prototype.wrapper=function(){var t;return null==this.outer&&(this.outer=new N,null!=(t=this.outer.zpp_inner).outer&&(t.outer.zpp_inner=null,t.outer=null),t.wrap_min=t.wrap_max=null,t._invalidate=null,t._validate=null,t.next=Be.zpp_pool,Be.zpp_pool=t,this.outer.zpp_inner=this),this.outer},Be.prototype.next=null,Be.prototype.alloc=function(){},Be.prototype.free=function(){null!=this.outer&&(this.outer.zpp_inner=null,this.outer=null),this.wrap_min=this.wrap_max=null,this._invalidate=null,this._validate=null},Be.prototype.copy=function(){var t,e=this.minx,i=this.miny,n=this.maxx,r=this.maxy;return null==Be.zpp_pool?t=new Be:(t=Be.zpp_pool,Be.zpp_pool=t.next,t.next=null),t.minx=e,t.miny=i,t.maxx=n,t.maxy=r,t},Be.prototype.width=function(){return this.maxx-this.minx},Be.prototype.height=function(){return this.maxy-this.miny},Be.prototype.perimeter=function(){return 2*(this.maxx-this.minx+(this.maxy-this.miny))},Be.prototype.minx=null,Be.prototype.miny=null,Be.prototype.wrap_min=null,Be.prototype.getmin=function(){var t,e,i,n;return null==this.wrap_min&&(t=this.minx,n=this.miny,null==Rn.poolVec2?e=new Ct:(e=Rn.poolVec2,Rn.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==Ir.zpp_pool?i=new Ir:(i=Ir.zpp_pool,Ir.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=t,i.y=n,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.x==t&&(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.y==n)||(e.zpp_inner.x=t,e.zpp_inner.y=n,null!=(n=e.zpp_inner)._invalidate&&n._invalidate(n))),e.zpp_inner.weak=!1,this.wrap_min=e,this.wrap_min.zpp_inner._inuse=!0,this._immutable?this.wrap_min.zpp_inner._immutable=!0:this.wrap_min.zpp_inner._invalidate=Z(this,this.mod_min),this.wrap_min.zpp_inner._validate=Z(this,this.dom_min)),this.wrap_min},Be.prototype.dom_min=function(){null!=this._validate&&this._validate(),this.wrap_min.zpp_inner.x=this.minx,this.wrap_min.zpp_inner.y=this.miny},Be.prototype.mod_min=function(t){t.x==this.minx&&t.y==this.miny||(this.minx=t.x,this.miny=t.y,null!=this._invalidate&&this._invalidate(this))},Be.prototype.maxx=null,Be.prototype.maxy=null,Be.prototype.wrap_max=null,Be.prototype.getmax=function(){var t,e,i,n;return null==this.wrap_max&&(t=this.maxx,n=this.maxy,null==Rn.poolVec2?e=new Ct:(e=Rn.poolVec2,Rn.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==Ir.zpp_pool?i=new Ir:(i=Ir.zpp_pool,Ir.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=t,i.y=n,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.x==t&&(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.y==n)||(e.zpp_inner.x=t,e.zpp_inner.y=n,null!=(n=e.zpp_inner)._invalidate&&n._invalidate(n))),e.zpp_inner.weak=!1,this.wrap_max=e,this.wrap_max.zpp_inner._inuse=!0,this._immutable?this.wrap_max.zpp_inner._immutable=!0:this.wrap_max.zpp_inner._invalidate=Z(this,this.mod_max),this.wrap_max.zpp_inner._validate=Z(this,this.dom_max)),this.wrap_max},Be.prototype.dom_max=function(){null!=this._validate&&this._validate(),this.wrap_max.zpp_inner.x=this.maxx,this.wrap_max.zpp_inner.y=this.maxy},Be.prototype.mod_max=function(t){t.x==this.maxx&&t.y==this.maxy||(this.maxx=t.x,this.maxy=t.y,null!=this._invalidate&&this._invalidate(this))},Be.prototype.intersectX=function(t){return!(t.minx>this.maxx||this.minx>t.maxx)},Be.prototype.intersectY=function(t){return!(t.miny>this.maxy||this.miny>t.maxy)},Be.prototype.intersect=function(t){return t.miny<=this.maxy&&this.miny<=t.maxy&&t.minx<=this.maxx&&this.minx<=t.maxx},Be.prototype.combine=function(t){t.minx<this.minx&&(this.minx=t.minx),t.maxx>this.maxx&&(this.maxx=t.maxx),t.miny<this.miny&&(this.miny=t.miny),t.maxy>this.maxy&&(this.maxy=t.maxy)},Be.prototype.contains=function(t){return t.minx>=this.minx&&t.miny>=this.miny&&t.maxx<=this.maxx&&t.maxy<=this.maxy},Be.prototype.containsPoint=function(t){return t.x>=this.minx&&t.x<=this.maxx&&t.y>=this.miny&&t.y<=this.maxy},Be.prototype.setCombine=function(t,e){this.minx=(t.minx<e.minx?t:e).minx,this.miny=(t.miny<e.miny?t:e).miny,this.maxx=(t.maxx>e.maxx?t:e).maxx,this.maxy=(t.maxy>e.maxy?t:e).maxy},Be.prototype.setExpand=function(t,e){this.minx=t.minx-e,this.miny=t.miny-e,this.maxx=t.maxx+e,this.maxy=t.maxy+e},Be.prototype.setExpandPoint=function(t,e){t<this.minx&&(this.minx=t),t>this.maxx&&(this.maxx=t),e<this.miny&&(this.miny=e),e>this.maxy&&(this.maxy=e)},Be.prototype.toString=function(){return"{ x: "+this.minx+" y: "+this.miny+" w: "+(this.maxx-this.minx)+" h: "+(this.maxy-this.miny)+" }"},Be.prototype.__class__=Be;var ue=zpp_nape.util.ZNPList_ZPP_Vec2=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ue.__name__=["zpp_nape","util","ZNPList_ZPP_Vec2"],ue.prototype.head=null,ue.prototype.begin=function(){return this.head},ue.prototype.modified=null,ue.prototype.pushmod=null,ue.prototype.length=null,ue.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},ue.prototype.add=function(t){null==hn.zpp_pool?e=new hn:(e=hn.zpp_pool,hn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},ue.prototype.inlined_add=function(t){null==hn.zpp_pool?e=new hn:(e=hn.zpp_pool,hn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},ue.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},ue.prototype.insert=function(t,e){null==hn.zpp_pool?i=new hn:(i=hn.zpp_pool,hn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},ue.prototype.inlined_insert=function(t,e){null==hn.zpp_pool?i=new hn:(i=hn.zpp_pool,hn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},ue.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=hn.zpp_pool,hn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ue.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=hn.zpp_pool,hn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ue.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},ue.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},ue.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=hn.zpp_pool,hn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},ue.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},ue.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=hn.zpp_pool,hn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},ue.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=hn.zpp_pool,hn.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},ue.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=hn.zpp_pool,hn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},ue.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=hn.zpp_pool,hn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},ue.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},ue.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=hn.zpp_pool,hn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ue.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=hn.zpp_pool,hn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ue.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},ue.prototype.empty=function(){return null==this.head},ue.prototype.size=function(){return this.length},ue.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},ue.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},ue.prototype.front=function(){return this.head.elt},ue.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},ue.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},ue.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},ue.prototype.__class__=ue;var Er=zpp_nape.geom.ZPP_Collide=function(){};Er.__name__=["zpp_nape","geom","ZPP_Collide"],Er.circleContains=function(t,e){var i=0,n=0;return(i=e.x-t.worldCOMx)*i+(n=e.y-t.worldCOMy)*n<t.radius*t.radius},Er.polyContains=function(t,e){for(var i=!0,n=t.edges.head;null!=n;){var r=n.elt;if(!(r.gnormx*e.x+r.gnormy*e.y<=r.gprojection)){i=!1;break}n=n.next}return i},Er.shapeContains=function(t,e){return 0==t.type?Er.circleContains(t.circle,e):Er.polyContains(t.polygon,e)},Er.bodyContains=function(t,e){for(var i=!1,n=t.shapes.head;null!=n;){if(Er.shapeContains(n.elt,e)){i=!0;break}n=n.next}return i},Er.containTest=function(t,e){var i=t.aabb,n=e.aabb;if(n.minx>=i.minx&&n.miny>=i.miny&&n.maxx<=i.maxx&&n.maxy<=i.maxy){if(0==t.type){if(0==e.type){var r=t.circle.radius+-e.circle.radius,n=0,i=0;return(n=e.circle.worldCOMx-t.circle.worldCOMx)*n+(i=e.circle.worldCOMy-t.circle.worldCOMy)*i<=r*r}for(var s=!0,o=e.polygon.gverts.next;null!=o;){var a=t.circle.radius,l=0,p=0;if(!((l=o.x-t.circle.worldCOMx)*l+(p=o.y-t.circle.worldCOMy)*p<=a*a)){s=!1;break}o=o.next}return s}if(0==e.type){for(var h=!0,u=t.polygon.edges.head;null!=u;){var c=u.elt;if(!(c.gnormx*e.circle.worldCOMx+c.gnormy*e.circle.worldCOMy+e.circle.radius<=c.gprojection)){h=!1;break}u=u.next}return h}for(var d=!0,_=t.polygon.edges.head;null!=_;){for(var y=_.elt,f=-1e100,m=e.polygon.gverts.next;null!=m;){var x=y.gnormx*m.x+y.gnormy*m.y;f<x&&(f=x),m=m.next}if(!(f<=y.gprojection)){d=!1;break}_=_.next}return d}return!1},Er.contactCollide=function(t,e,i,n){if(1==e.type){if(1==t.type){for(var r=!0,s=-1e100,o=-1,a=null,l=null,p=t.polygon.edges.head;null!=p;){for(var h=p.elt,u=1e100,c=e.polygon.gverts.next;null!=c;){var d=h.gnormx*c.x+h.gnormy*c.y;if(d<u&&(u=d),u-h.gprojection<=s)break;c=c.next}if(0<=(u-=h.gprojection)){r=!1;break}s<u&&(s=u,a=h,o=1),p=p.next}if(r){for(var _=e.polygon.edges.head;null!=_;){for(var y=_.elt,f=1e100,m=t.polygon.gverts.next;null!=m;){var x=y.gnormx*m.x+y.gnormy*m.y;if(x<f&&(f=x),f-y.gprojection<=s)break;m=m.next}if(0<=(f-=y.gprojection)){r=!1;break}s<f&&(s=f,l=y,o=2),_=_.next}if(r){for(var v,g=1==o?(Q=e.polygon,v=a,1):(Q=t.polygon,v=l,-1),b=null,z=1e100,w=Q.edges.head;null!=w;){var C=w.elt,P=v.gnormx*C.gnormx+v.gnormy*C.gnormy;P<z&&(z=P,b=C),w=w.next}var T=0,S=0,T=b.gp0.x,S=b.gp0.y,M=0,A=0,O=(M=b.gp1.x)-T,k=(A=b.gp1.y)-S,E=v.gnormy*T-v.gnormx*S,I=v.gnormy*M-v.gnormx*A,D=1/(I-E),B=(-v.tp1-E)*D;B>kr.epsilon&&(T+=O*B,S+=k*B);var L=(-v.tp0-I)*D;L<-kr.epsilon&&(M+=O*L,A+=k*L);E=0,B=0,E=v.gnormx*g,B=v.gnormy*g;i.lnormx=v.lnormx,i.lnormy=v.lnormy,i.lproj=v.lprojection,i.radius=0,i.rev=n!=(-1==g),i.ptype=i.rev?1:0;I=T*v.gnormx+S*v.gnormy-v.gprojection,D=M*v.gnormx+A*v.gnormy-v.gprojection;if(0<I&&0<D)return!1;n&&(E=-E,B=-B);for(var O=T-v.gnormx*I*.5,k=S-v.gnormy*I*.5,R=i.rev?1:0,F=null,j=i.contacts.next;null!=j;){if(R==j.hash){F=j;break}j=j.next}null==F?(null==Qn.zpp_pool?F=new Qn:(F=Qn.zpp_pool,Qn.zpp_pool=F.next,F.next=null),(N=F.inner).jnAcc=N.jtAcc=0,F.hash=R,F.fresh=!0,(F.arbiter=i).jrAcc=0,L=i.contacts,F._inuse=!0,(g=F).next=L.next,L.next=g,L.modified=!0,L.length++,i.innards.add(N)):F.fresh=!1,F.px=O,F.py=k,i.nx=E,i.ny=B,F.dist=I,F.stamp=i.stamp,F.posOnly=0<I;var N=F;T-=Q.body.posx,S-=Q.body.posy,N.inner.lr1x=T*Q.body.axisy+S*Q.body.axisx,N.inner.lr1y=S*Q.body.axisy-T*Q.body.axisx;for(var O=M-v.gnormx*D*.5,k=A-v.gnormy*D*.5,G=i.rev?0:1,U=null,X=i.contacts.next;null!=X;){if(G==X.hash){U=X;break}X=X.next}return null==U?(null==Qn.zpp_pool?U=new Qn:(U=Qn.zpp_pool,Qn.zpp_pool=U.next,U.next=null),(I=U.inner).jnAcc=I.jtAcc=0,U.hash=G,U.fresh=!0,(U.arbiter=i).jrAcc=0,S=i.contacts,U._inuse=!0,(T=U).next=S.next,S.next=T,S.modified=!0,S.length++,i.innards.add(I)):U.fresh=!1,U.px=O,U.py=k,i.nx=E,i.ny=B,U.dist=D,U.stamp=i.stamp,U.posOnly=0<D,N=U,M-=Q.body.posx,A-=Q.body.posy,N.inner.lr1x=M*Q.body.axisy+A*Q.body.axisx,N.inner.lr1y=A*Q.body.axisy-M*Q.body.axisx,1==o?(i.__ref_edge1=v,i.__ref_edge2=b):(i.__ref_edge2=v,i.__ref_edge1=b),!0}return!1}return!1}for(var V=-1e100,W=!0,H=null,q=null,Y=e.polygon.gverts.next,K=e.polygon.edges.head;null!=K;){var Z=K.elt,J=Z.gnormx*t.circle.worldCOMx+Z.gnormy*t.circle.worldCOMy-Z.gprojection-t.circle.radius;if(0<J){W=!1;break}V<J&&(V=J,H=Z,q=Y),Y=Y.next,K=K.next}if(W){O=q,k=(null==q.next?e.polygon.gverts:q).next,E=t.circle.worldCOMy*H.gnormx-t.circle.worldCOMx*H.gnormy;if(E<=O.y*H.gnormx-O.x*H.gnormy){B=t.circle.radius,D=0,N=0,A=(D=O.x-t.circle.worldCOMx)*D+(N=O.y-t.circle.worldCOMy)*N;if(B*B<A)yt=null;else if(A<kr.epsilon*kr.epsilon){for(var Q,$=t.circle.worldCOMx,tt=t.circle.worldCOMy,et=null,it=i.contacts.next;null!=it;){if(0==it.hash){et=it;break}it=it.next}null==et?(null==Qn.zpp_pool?et=new Qn:(et=Qn.zpp_pool,Qn.zpp_pool=et.next,et.next=null),(nt=et.inner).jnAcc=nt.jtAcc=0,et.hash=0,et.fresh=!0,(et.arbiter=i).jrAcc=0,M=i.contacts,et._inuse=!0,(Q=et).next=M.next,M.next=Q,M.modified=!0,M.length++,i.innards.add(nt)):et.fresh=!1,et.px=$,et.py=tt,i.nx=1,i.ny=0,et.dist=-B,et.stamp=i.stamp,et.posOnly=!1,yt=et}else{var nt=1/Math.sqrt(A),$=nt<kr.epsilon?1e100:1/nt,tt=.5+(t.circle.radius-.5*B)*nt;if(n){for(var rt=t.circle.worldCOMx+D*tt,st=t.circle.worldCOMy+N*tt,ot=null,at=i.contacts.next;null!=at;){if(0==at.hash){ot=at;break}at=at.next}null==ot?(null==Qn.zpp_pool?ot=new Qn:(ot=Qn.zpp_pool,Qn.zpp_pool=ot.next,ot.next=null),(pt=ot.inner).jnAcc=pt.jtAcc=0,ot.hash=0,ot.fresh=!0,(ot.arbiter=i).jrAcc=0,lt=i.contacts,ot._inuse=!0,(A=ot).next=lt.next,lt.next=A,lt.modified=!0,lt.length++,i.innards.add(pt)):ot.fresh=!1,ot.px=rt,ot.py=st,i.nx=-D*nt,i.ny=-N*nt,ot.dist=$-B,ot.stamp=i.stamp,ot.posOnly=!1,yt=ot}else{for(var lt=t.circle.worldCOMx+D*tt,pt=t.circle.worldCOMy+N*tt,ht=null,ut=i.contacts.next;null!=ut;){if(0==ut.hash){ht=ut;break}ut=ut.next}null==ht?(null==Qn.zpp_pool?ht=new Qn:(ht=Qn.zpp_pool,Qn.zpp_pool=ht.next,ht.next=null),(rt=ht.inner).jnAcc=rt.jtAcc=0,ht.hash=0,ht.fresh=!0,(ht.arbiter=i).jrAcc=0,st=i.contacts,ht._inuse=!0,(tt=ht).next=st.next,st.next=tt,st.modified=!0,st.length++,i.innards.add(rt)):ht.fresh=!1,ht.px=lt,ht.py=pt,i.nx=D*nt,i.ny=N*nt,ht.dist=$-B,ht.stamp=i.stamp,ht.posOnly=!1,yt=ht}}return null!=yt&&(_t=yt.inner,i.ptype=2,ct=dt=0,dt=O.x-e.polygon.body.posx,ct=O.y-e.polygon.body.posy,i.__ref_edge1=H,i.__ref_vertex=-1,n?(_t.lr1x=dt*e.polygon.body.axisy+ct*e.polygon.body.axisx,_t.lr1y=ct*e.polygon.body.axisy-dt*e.polygon.body.axisx,_t.lr2x=t.circle.localCOMx,_t.lr2y=t.circle.localCOMy):(_t.lr2x=dt*e.polygon.body.axisy+ct*e.polygon.body.axisx,_t.lr2y=ct*e.polygon.body.axisy-dt*e.polygon.body.axisx,_t.lr1x=t.circle.localCOMx,_t.lr1y=t.circle.localCOMy),i.radius=t.circle.radius),null!=yt}if(E>=k.y*H.gnormx-k.x*H.gnormy){var O=t.circle.radius,ct=0,dt=0,_t=(ct=k.x-t.circle.worldCOMx)*ct+(dt=k.y-t.circle.worldCOMy)*dt;if(O*O<_t)Et=null;else if(_t<kr.epsilon*kr.epsilon){for(var yt,ft=t.circle.worldCOMx,mt=t.circle.worldCOMy,xt=null,vt=i.contacts.next;null!=vt;){if(0==vt.hash){xt=vt;break}vt=vt.next}null==xt?(null==Qn.zpp_pool?xt=new Qn:(xt=Qn.zpp_pool,Qn.zpp_pool=xt.next,xt.next=null),(gt=xt.inner).jnAcc=gt.jtAcc=0,xt.hash=0,xt.fresh=!0,(xt.arbiter=i).jrAcc=0,yt=i.contacts,xt._inuse=!0,(E=xt).next=yt.next,yt.next=E,yt.modified=!0,yt.length++,i.innards.add(gt)):xt.fresh=!1,xt.px=ft,xt.py=mt,i.nx=1,i.ny=0,xt.dist=-O,xt.stamp=i.stamp,xt.posOnly=!1,Et=xt}else{var gt=1/Math.sqrt(_t),ft=gt<kr.epsilon?1e100:1/gt,mt=.5+(t.circle.radius-.5*O)*gt;if(n){for(var bt=t.circle.worldCOMx+ct*mt,zt=t.circle.worldCOMy+dt*mt,wt=null,Ct=i.contacts.next;null!=Ct;){if(0==Ct.hash){wt=Ct;break}Ct=Ct.next}null==wt?(null==Qn.zpp_pool?wt=new Qn:(wt=Qn.zpp_pool,Qn.zpp_pool=wt.next,wt.next=null),(Tt=wt.inner).jnAcc=Tt.jtAcc=0,wt.hash=0,wt.fresh=!0,(wt.arbiter=i).jrAcc=0,Pt=i.contacts,wt._inuse=!0,(_t=wt).next=Pt.next,Pt.next=_t,Pt.modified=!0,Pt.length++,i.innards.add(Tt)):wt.fresh=!1,wt.px=bt,wt.py=zt,i.nx=-ct*gt,i.ny=-dt*gt,wt.dist=ft-O,wt.stamp=i.stamp,wt.posOnly=!1,Et=wt}else{for(var Pt=t.circle.worldCOMx+ct*mt,Tt=t.circle.worldCOMy+dt*mt,St=null,Mt=i.contacts.next;null!=Mt;){if(0==Mt.hash){St=Mt;break}Mt=Mt.next}null==St?(null==Qn.zpp_pool?St=new Qn:(St=Qn.zpp_pool,Qn.zpp_pool=St.next,St.next=null),(bt=St.inner).jnAcc=bt.jtAcc=0,St.hash=0,St.fresh=!0,(St.arbiter=i).jrAcc=0,zt=i.contacts,St._inuse=!0,(mt=St).next=zt.next,zt.next=mt,zt.modified=!0,zt.length++,i.innards.add(bt)):St.fresh=!1,St.px=Pt,St.py=Tt,i.nx=ct*gt,i.ny=dt*gt,St.dist=ft-O,St.stamp=i.stamp,St.posOnly=!1,Et=St}}return null!=Et&&(kt=Et.inner,i.ptype=2,At=Ot=0,Ot=k.x-e.polygon.body.posx,At=k.y-e.polygon.body.posy,i.__ref_edge1=H,i.__ref_vertex=1,n?(kt.lr1x=Ot*e.polygon.body.axisy+At*e.polygon.body.axisx,kt.lr1y=At*e.polygon.body.axisy-Ot*e.polygon.body.axisx,kt.lr2x=t.circle.localCOMx,kt.lr2y=t.circle.localCOMy):(kt.lr2x=Ot*e.polygon.body.axisy+At*e.polygon.body.axisx,kt.lr2y=At*e.polygon.body.axisy-Ot*e.polygon.body.axisx,kt.lr1x=t.circle.localCOMx,kt.lr1y=t.circle.localCOMy),i.radius=t.circle.radius),null!=Et}var At=0,Ot=0,kt=t.circle.radius+.5*V,At=H.gnormx*kt,Ot=H.gnormy*kt,Et=0,kt=0,Et=t.circle.worldCOMx-At,kt=t.circle.worldCOMy-Ot;if(n){for(var It=H.gnormx,Dt=H.gnormy,Bt=null,Lt=i.contacts.next;null!=Lt;){if(0==Lt.hash){Bt=Lt;break}Lt=Lt.next}null==Bt?(null==Qn.zpp_pool?Bt=new Qn:(Bt=Qn.zpp_pool,Qn.zpp_pool=Bt.next,Bt.next=null),(Ut=Bt.inner).jnAcc=Ut.jtAcc=0,Bt.hash=0,Bt.fresh=!0,(Bt.arbiter=i).jrAcc=0,At=i.contacts,Bt._inuse=!0,(Ot=Bt).next=At.next,At.next=Ot,At.modified=!0,At.length++,i.innards.add(Ut)):Bt.fresh=!1,Bt.px=Et,Bt.py=kt,i.nx=It,i.ny=Dt,Bt.dist=V,Bt.stamp=i.stamp,Bt.posOnly=!1,Ut=Bt}else{for(var Rt=-H.gnormx,Ft=-H.gnormy,jt=null,Nt=i.contacts.next;null!=Nt;){if(0==Nt.hash){jt=Nt;break}Nt=Nt.next}null==jt?(null==Qn.zpp_pool?jt=new Qn:(jt=Qn.zpp_pool,Qn.zpp_pool=jt.next,jt.next=null),(Gt=jt.inner).jnAcc=Gt.jtAcc=0,jt.hash=0,jt.fresh=!0,(jt.arbiter=i).jrAcc=0,It=i.contacts,jt._inuse=!0,(Dt=jt).next=It.next,It.next=Dt,It.modified=!0,It.length++,i.innards.add(Gt)):jt.fresh=!1,jt.px=Et,jt.py=kt,i.nx=Rt,i.ny=Ft,jt.dist=V,jt.stamp=i.stamp,jt.posOnly=!1,Ut=jt}return i.ptype=n?0:1,i.lnormx=H.lnormx,i.lnormy=H.lnormy,i.rev=!n,i.lproj=H.lprojection,i.radius=t.circle.radius,Ut.inner.lr1x=t.circle.localCOMx,Ut.inner.lr1y=t.circle.localCOMy,i.__ref_edge1=H,!(i.__ref_vertex=0)}return!1}var Gt=t.circle.radius+e.circle.radius,Et=0,kt=0,Rt=(Et=e.circle.worldCOMx-t.circle.worldCOMx)*Et+(kt=e.circle.worldCOMy-t.circle.worldCOMy)*kt;if(Gt*Gt<Rt)ie=null;else if(Rt<kr.epsilon*kr.epsilon){for(var Ut,Xt=t.circle.worldCOMx,Vt=t.circle.worldCOMy,Wt=null,Ht=i.contacts.next;null!=Ht;){if(0==Ht.hash){Wt=Ht;break}Ht=Ht.next}null==Wt?(null==Qn.zpp_pool?Wt=new Qn:(Wt=Qn.zpp_pool,Qn.zpp_pool=Wt.next,Wt.next=null),(qt=Wt.inner).jnAcc=qt.jtAcc=0,Wt.hash=0,Wt.fresh=!0,(Wt.arbiter=i).jrAcc=0,Ft=i.contacts,Wt._inuse=!0,(Ut=Wt).next=Ft.next,Ft.next=Ut,Ft.modified=!0,Ft.length++,i.innards.add(qt)):Wt.fresh=!1,Wt.px=Xt,Wt.py=Vt,i.nx=1,i.ny=0,Wt.dist=-Gt,Wt.stamp=i.stamp,Wt.posOnly=!1,ie=Wt}else{var qt=1/Math.sqrt(Rt),Xt=qt<kr.epsilon?1e100:1/qt,Vt=.5+(t.circle.radius-.5*Gt)*qt;if(n){for(var Yt=t.circle.worldCOMx+Et*Vt,Kt=t.circle.worldCOMy+kt*Vt,Zt=null,Jt=i.contacts.next;null!=Jt;){if(0==Jt.hash){Zt=Jt;break}Jt=Jt.next}null==Zt?(null==Qn.zpp_pool?Zt=new Qn:(Zt=Qn.zpp_pool,Qn.zpp_pool=Zt.next,Zt.next=null),($t=Zt.inner).jnAcc=$t.jtAcc=0,Zt.hash=0,Zt.fresh=!0,(Zt.arbiter=i).jrAcc=0,Qt=i.contacts,Zt._inuse=!0,(Rt=Zt).next=Qt.next,Qt.next=Rt,Qt.modified=!0,Qt.length++,i.innards.add($t)):Zt.fresh=!1,Zt.px=Yt,Zt.py=Kt,i.nx=-Et*qt,i.ny=-kt*qt,Zt.dist=Xt-Gt,Zt.stamp=i.stamp,Zt.posOnly=!1,ie=Zt}else{for(var Qt=t.circle.worldCOMx+Et*Vt,$t=t.circle.worldCOMy+kt*Vt,te=null,ee=i.contacts.next;null!=ee;){if(0==ee.hash){te=ee;break}ee=ee.next}null==te?(null==Qn.zpp_pool?te=new Qn:(te=Qn.zpp_pool,Qn.zpp_pool=te.next,te.next=null),(Yt=te.inner).jnAcc=Yt.jtAcc=0,te.hash=0,te.fresh=!0,(te.arbiter=i).jrAcc=0,Kt=i.contacts,te._inuse=!0,(Vt=te).next=Kt.next,Kt.next=Vt,Kt.modified=!0,Kt.length++,i.innards.add(Yt)):te.fresh=!1,te.px=Qt,te.py=$t,i.nx=Et*qt,i.ny=kt*qt,te.dist=Xt-Gt,te.stamp=i.stamp,te.posOnly=!1,ie=te}}if(null==ie)return!1;var ie=ie.inner;return n?(ie.lr1x=e.circle.localCOMx,ie.lr1y=e.circle.localCOMy,ie.lr2x=t.circle.localCOMx,ie.lr2y=t.circle.localCOMy):(ie.lr1x=t.circle.localCOMx,ie.lr1y=t.circle.localCOMy,ie.lr2x=e.circle.localCOMx,ie.lr2y=e.circle.localCOMy),i.radius=t.circle.radius+e.circle.radius,i.ptype=2,!0},Er.testCollide_safe=function(t,e){var i;return 0==e.type&&(i=t,t=e,e=i),Er.testCollide(t,e)},Er.testCollide=function(t,e){if(1==e.type){if(1==t.type){for(var i=!0,n=t.polygon.edges.head;null!=n;){for(var r=n.elt,s=1e100,o=e.polygon.gverts.next;null!=o;){var a=r.gnormx*o.x+r.gnormy*o.y;a<s&&(s=a),o=o.next}if(0<(s-=r.gprojection)){i=!1;break}n=n.next}if(i){for(var l=e.polygon.edges.head;null!=l;){for(var p=l.elt,h=1e100,u=t.polygon.gverts.next;null!=u;){var c=p.gnormx*u.x+p.gnormy*u.y;c<h&&(h=c),u=u.next}if(0<(h-=p.gprojection)){i=!1;break}l=l.next}return i}return!1}for(var d=null,_=null,y=!0,f=-1e100,m=e.polygon.gverts.next,x=e.polygon.edges.head;null!=x;){var v=x.elt,g=v.gnormx*t.circle.worldCOMx+v.gnormy*t.circle.worldCOMy-v.gprojection-t.circle.radius;if(0<g){y=!1;break}f<g&&(f=g,d=v,_=m),m=m.next,x=x.next}if(y){var b=(null==_.next?e.polygon.gverts:_).next,z=t.circle.worldCOMy*d.gnormx-t.circle.worldCOMx*d.gnormy;if(z<=_.y*d.gnormx-_.x*d.gnormy){var w=t.circle.radius,C=0,P=0;return(C=_.x-t.circle.worldCOMx)*C+(P=_.y-t.circle.worldCOMy)*P<=w*w}if(z>=b.y*d.gnormx-b.x*d.gnormy){var T=t.circle.radius,z=0,S=0;return(z=b.x-t.circle.worldCOMx)*z+(S=b.y-t.circle.worldCOMy)*S<=T*T}return!0}return!1}b=t.circle.radius+e.circle.radius,S=0,T=0;return(S=e.circle.worldCOMx-t.circle.worldCOMx)*S+(T=e.circle.worldCOMy-t.circle.worldCOMy)*T<=b*b},Er.flowCollide=function(t,e,i){if(1==e.type){if(1==t.type){for(var n=[],r=[],s=!0,o=!0,a=t.polygon.edges.head;null!=a;){for(var l=a.elt,p=1e100,h=0,u=e.polygon.gverts.next;null!=u;){var c=l.gnormx*u.x+l.gnormy*u.y;c<p&&(p=c),c>=l.gprojection+kr.epsilon&&(o=!(r[h]=!0)),++h,u=u.next}if(0<(p-=l.gprojection)){s=!1;break}a=a.next}if(o){var d=e.polygon;if(d.zip_worldCOM&&null!=d.body){if(d.zip_worldCOM=!1,d.zip_localCOM){if(d.zip_localCOM=!1,1==d.type){var _=d.polygon;if(null==_.lverts.next.next)_.localCOMx=_.lverts.next.x,_.localCOMy=_.lverts.next.y;else if(null==_.lverts.next.next.next)_.localCOMx=_.lverts.next.x,_.localCOMy=_.lverts.next.y,_.localCOMx+=_.lverts.next.next.x,_.localCOMy+=_.lverts.next.next.y,_.localCOMx*=.5,_.localCOMy*=.5;else{_.localCOMx=0;var y=_.localCOMy=0,f=_.lverts.next,m=f,x=f=f.next;for(f=f.next;null!=f;){var v=f;y+=x.x*(v.y-m.y);var g=v.y*x.x-v.x*x.y;_.localCOMx+=(x.x+v.x)*g,_.localCOMy+=(x.y+v.y)*g,m=x,x=v,f=f.next}var b=f=_.lverts.next;y+=x.x*(b.y-m.y);var z=b.y*x.x-b.x*x.y;_.localCOMx+=(x.x+b.x)*z,_.localCOMy+=(x.y+b.y)*z,m=x;var w=f=f.next;y+=b.x*(w.y-m.y);z=w.y*b.x-w.x*b.y;_.localCOMx+=(b.x+w.x)*z,_.localCOMy+=(b.y+w.y)*z;w=y=1/(3*y);_.localCOMx*=w,_.localCOMy*=w}}null!=d.wrap_localCOM&&(d.wrap_localCOM.zpp_inner.x=d.localCOMx,d.wrap_localCOM.zpp_inner.y=d.localCOMy)}z=d.body;z.zip_axis&&(z.zip_axis=!1,z.axisx=Math.sin(z.rot),z.axisy=Math.cos(z.rot)),d.worldCOMx=d.body.posx+(d.body.axisy*d.localCOMx-d.body.axisx*d.localCOMy),d.worldCOMy=d.body.posy+(d.localCOMx*d.body.axisx+d.localCOMy*d.body.axisy)}w=e.polygon.area,z=e.polygon.worldCOMx,d=e.polygon.worldCOMy;return i.overlap=w,i.centroidx=z,i.centroidy=d,!0}if(s){o=!0;for(var C=e.polygon.edges.head;null!=C;){for(var P=C.elt,T=1e100,S=0,M=t.polygon.gverts.next;null!=M;){var A=P.gnormx*M.x+P.gnormy*M.y;A<T&&(T=A),A>=P.gprojection+kr.epsilon&&(o=!(n[S]=!0)),++S,M=M.next}if(0<(T-=P.gprojection)){s=!1;break}C=C.next}if(o){var O=t.polygon;if(O.zip_worldCOM&&null!=O.body){if(O.zip_worldCOM=!1,O.zip_localCOM){if(O.zip_localCOM=!1,1==O.type){var k=O.polygon;if(null==k.lverts.next.next)k.localCOMx=k.lverts.next.x,k.localCOMy=k.lverts.next.y;else if(null==k.lverts.next.next.next)k.localCOMx=k.lverts.next.x,k.localCOMy=k.lverts.next.y,k.localCOMx+=k.lverts.next.next.x,k.localCOMy+=k.lverts.next.next.y,k.localCOMx*=.5,k.localCOMy*=.5;else{k.localCOMx=0;var E=k.localCOMy=0,I=k.lverts.next,D=I,B=I=I.next;for(I=I.next;null!=I;){var L=I;E+=B.x*(L.y-D.y);var R=L.y*B.x-L.x*B.y;k.localCOMx+=(B.x+L.x)*R,k.localCOMy+=(B.y+L.y)*R,D=B,B=L,I=I.next}d=I=k.lverts.next;E+=B.x*(d.y-D.y);var F=d.y*B.x-d.x*B.y;k.localCOMx+=(B.x+d.x)*F,k.localCOMy+=(B.y+d.y)*F,D=B;var j=I=I.next;E+=d.x*(j.y-D.y);F=j.y*d.x-j.x*d.y;k.localCOMx+=(d.x+j.x)*F,k.localCOMy+=(d.y+j.y)*F;j=E=1/(3*E);k.localCOMx*=j,k.localCOMy*=j}}null!=O.wrap_localCOM&&(O.wrap_localCOM.zpp_inner.x=O.localCOMx,O.wrap_localCOM.zpp_inner.y=O.localCOMy)}F=O.body;F.zip_axis&&(F.zip_axis=!1,F.axisx=Math.sin(F.rot),F.axisy=Math.cos(F.rot)),O.worldCOMx=O.body.posx+(O.body.axisy*O.localCOMx-O.body.axisx*O.localCOMy),O.worldCOMy=O.body.posy+(O.localCOMx*O.body.axisx+O.localCOMy*O.body.axisy)}j=t.polygon.area,F=t.polygon.worldCOMx,O=t.polygon.worldCOMy;return i.overlap=j,i.centroidx=F,i.centroidy=O,!0}if(s){for(;null!=Er.flowpoly.head;){var N=Er.flowpoly.pop_unsafe();N._inuse||(null!=N.outer&&(N.outer.zpp_inner=null,N.outer=null),N._isimmutable=null,N._validate=null,N._invalidate=null,N.next=Ir.zpp_pool,Ir.zpp_pool=N)}for(var G=null,U=!1,X=t.polygon.gverts.next,V=0,W=e.polygon.gverts.next,H=0,q=0,Y=e.polygon.edgeCnt;q<Y;){var K=q++;if(!r[K]){H=K;break}W=W.next}if(null==W){W=e.polygon.gverts.next,U=!0;for(var Z=0,J=t.polygon.edgeCnt;Z<J;){var Q=Z++;if(!n[Q]){V=Q;break}X=X.next}null==X?X=t.polygon.gverts.next:(Er.flowpoly.add(X),G=Er.flowpoly.head.elt)}else Er.flowpoly.add(W),G=Er.flowpoly.head.elt;var $=1;if(null==Er.flowpoly.head){for(var tt=!0,et=t.polygon.gverts.next,it=et,nt=et.next;null!=nt;){for(var rt=nt,st=2,ot=e.polygon.gverts.next,at=ot,lt=ot.next;null!=lt;){var pt=0,ht=it.x-at.x,ut=it.y-at.y,ct=0,dt=rt.x-it.x,_t=0,yt=0,ft=(ct=rt.y-it.y)*(_t=lt.x-at.x)-dt*(yt=lt.y-at.y);ft*ft>kr.epsilon*kr.epsilon&&((_t=(yt*ht-_t*ut)*(ft=1/ft))>kr.epsilon&&_t<1-kr.epsilon&&((ft=(ct*ht-dt*ut)*ft)>kr.epsilon&&ft<1-kr.epsilon&&(pt=_t,!0)))&&pt<st&&(st=pt,W=ot),lt=(ot=at=lt).next}for(;;){lt=e.polygon.gverts.next;var mt=0,xt=it.x-at.x,vt=it.y-at.y,gt=0,bt=rt.x-it.x,zt=0,wt=0,Ct=(gt=rt.y-it.y)*(zt=lt.x-at.x)-bt*(wt=lt.y-at.y);Ct*Ct>kr.epsilon*kr.epsilon&&((zt=(wt*xt-zt*vt)*(Ct=1/Ct))>kr.epsilon&&zt<1-kr.epsilon&&((Ct=(gt*xt-bt*vt)*Ct)>kr.epsilon&&Ct<1-kr.epsilon&&(mt=zt,!0)))&&mt<st&&(st=mt,W=ot);break}if(2!=st){var Pt,Tt=it.x+(rt.x-it.x)*st,St=it.y+(rt.y-it.y)*st;null==Ir.zpp_pool?Pt=new Ir:(Pt=Ir.zpp_pool,Ir.zpp_pool=Pt.next,Pt.next=null),Pt.weak=!1,Pt._immutable=!1,Pt.x=Tt,Pt.y=St,G=Pt,Er.flowpoly.add(G),X=et,tt=!(U=!0);break}it=rt,nt=(et=nt).next}if(tt)for(;;){for(var Mt=nt=t.polygon.gverts.next,At=2,Ot=e.polygon.gverts.next,kt=Ot,Et=Ot.next;null!=Et;){var It=0,Dt=it.x-kt.x,Bt=it.y-kt.y,Lt=0,Rt=Mt.x-it.x,Ft=0,jt=0,Nt=(Lt=Mt.y-it.y)*(Ft=Et.x-kt.x)-Rt*(jt=Et.y-kt.y);Nt*Nt>kr.epsilon*kr.epsilon&&((Ft=(jt*Dt-Ft*Bt)*(Nt=1/Nt))>kr.epsilon&&Ft<1-kr.epsilon&&((Nt=(Lt*Dt-Rt*Bt)*Nt)>kr.epsilon&&Nt<1-kr.epsilon&&(It=Ft,!0)))&&It<At&&(At=It,W=Ot),Et=(Ot=kt=Et).next}for(;;){Et=e.polygon.gverts.next;var Gt=0,Ut=it.x-kt.x,Xt=it.y-kt.y,Vt=0,Wt=Mt.x-it.x,Ht=0,qt=0,Yt=(Vt=Mt.y-it.y)*(Ht=Et.x-kt.x)-Wt*(qt=Et.y-kt.y);Yt*Yt>kr.epsilon*kr.epsilon&&((Ht=(qt*Ut-Ht*Xt)*(Yt=1/Yt))>kr.epsilon&&Ht<1-kr.epsilon&&((Yt=(Vt*Ut-Wt*Xt)*Yt)>kr.epsilon&&Yt<1-kr.epsilon&&(Gt=Ht,!0)))&&Gt<At&&(At=Gt,W=Ot);break}if(2==At)break;var Kt,Zt=it.x+(Mt.x-it.x)*At,Jt=it.y+(Mt.y-it.y)*At;null==Ir.zpp_pool?Kt=new Ir:(Kt=Ir.zpp_pool,Ir.zpp_pool=Kt.next,Kt.next=null),Kt.weak=!1,Kt._immutable=!1,Kt.x=Zt,Kt.y=Jt,G=Kt,Er.flowpoly.add(G),U=!0,X=et;break}$=2}for(;;)if(U)if(++V,null==(X=X.next)&&(X=t.polygon.gverts.next,V=0),n[V]){var Qt=Er.flowpoly.head.elt,$t=X,te=W,ee=W.next;null==ee&&(ee=e.polygon.gverts.next);for(var ie=-1,ne=null,re=0,se=0,oe=ee,ae=ee;;){var le,pe=ae,he=0,ue=te.x-Qt.x,ce=te.y-Qt.y,de=0,_e=pe.x-te.x,ye=0,fe=0,me=(de=pe.y-te.y)*(ye=$t.x-Qt.x)-_e*(fe=$t.y-Qt.y);if(le=me*me>kr.epsilon*kr.epsilon&&((le=(fe*ue-ye*ce)*(me=1/me))>kr.epsilon&&le<1-kr.epsilon&&((me=(de*ue-_e*ce)*me)>kr.epsilon&&me<1-kr.epsilon&&(he=le,!0))),le&&-1<=he){if(ne=W,re=H,(se=1)==$){ie=he,ae=oe;break}ie=he}te=pe,W=ae,++H>=e.polygon.edgeCnt&&(H=0),null==(ae=ae.next)&&(ae=e.polygon.gverts.next);break}for(;ae!=oe;){var xe,ve=ae,ge=0,be=te.x-Qt.x,ze=te.y-Qt.y,we=0,Ce=ve.x-te.x,Pe=0,Te=0,Se=(we=ve.y-te.y)*(Pe=$t.x-Qt.x)-Ce*(Te=$t.y-Qt.y);if(xe=Se*Se>kr.epsilon*kr.epsilon&&((xe=(Te*be-Pe*ze)*(Se=1/Se))>kr.epsilon&&xe<1-kr.epsilon&&((Se=(we*be-Ce*ze)*Se)>kr.epsilon&&Se<1-kr.epsilon&&(ge=xe,!0))),xe&&ie<=ge){if(ne=W,re=H,++se==$){ie=ge;break}ie=ge}te=ve,W=ae,++H>=e.polygon.edgeCnt&&(H=0),null==(ae=ae.next)&&(ae=e.polygon.gverts.next)}if(null==ne)break;var Me=ne.next;null==Me&&(Me=e.polygon.gverts.next);var Ae,Oe=0,ee=0,Oe=ne.x+(Me.x-ne.x)*ie,ee=ne.y+(Me.y-ne.y)*ie;if(null!=G&&(Ee=ke=0,(ke=Oe-G.x)*ke+(Ee=ee-G.y)*Ee<kr.epsilon))break;null==Ir.zpp_pool?Ae=new Ir:(Ae=Ir.zpp_pool,Ir.zpp_pool=Ae.next,Ae.next=null),Ae.weak=!1,Ae._immutable=!1,Ae.x=Oe,Ae.y=ee,Er.flowpoly.add(Ae),null==G&&(G=Er.flowpoly.head.elt),W=ne,H=re,U=!U,$=2}else{var ke,Ee,Me=X;if(null!=G&&(ke=Me.x,Ee=Me.y,ee=Oe=0,(Oe=ke-G.x)*Oe+(ee=Ee-G.y)*ee<kr.epsilon))break;Er.flowpoly.add(Me),null==G&&(G=Er.flowpoly.head.elt),$=1}else if(++H,null==(W=W.next)&&(W=e.polygon.gverts.next,H=0),r[H]){var Ie=Er.flowpoly.head.elt,De=W,Be=X,Le=X.next;null==Le&&(Le=t.polygon.gverts.next);for(var Re=-1,Fe=null,je=0,Ne=0,Ge=Le,Ue=Le;;){var Xe,Ve=Ue,We=0,He=Be.x-Ie.x,qe=Be.y-Ie.y,Ye=0,Ke=Ve.x-Be.x,Ze=0,Je=0,Qe=(Ye=Ve.y-Be.y)*(Ze=De.x-Ie.x)-Ke*(Je=De.y-Ie.y);if(Xe=Qe*Qe>kr.epsilon*kr.epsilon&&((Xe=(Je*He-Ze*qe)*(Qe=1/Qe))>kr.epsilon&&Xe<1-kr.epsilon&&((Qe=(Ye*He-Ke*qe)*Qe)>kr.epsilon&&Qe<1-kr.epsilon&&(We=Xe,!0))),Xe&&-1<=We){if(Fe=X,je=V,(Ne=1)==$){Re=We,Ue=Ge;break}Re=We}Be=Ve,X=Ue,++V>=t.polygon.edgeCnt&&(V=0),null==(Ue=Ue.next)&&(Ue=t.polygon.gverts.next);break}for(;Ue!=Ge;){var $e,ti=Ue,ei=0,ii=Be.x-Ie.x,ni=Be.y-Ie.y,ri=0,si=ti.x-Be.x,oi=0,ai=0,li=(ri=ti.y-Be.y)*(oi=De.x-Ie.x)-si*(ai=De.y-Ie.y);if($e=li*li>kr.epsilon*kr.epsilon&&(($e=(ai*ii-oi*ni)*(li=1/li))>kr.epsilon&&$e<1-kr.epsilon&&((li=(ri*ii-si*ni)*li)>kr.epsilon&&li<1-kr.epsilon&&(ei=$e,!0))),$e&&Re<=ei){if(Fe=X,je=V,++Ne==$){Re=ei;break}Re=ei}Be=ti,X=Ue,++V>=t.polygon.edgeCnt&&(V=0),null==(Ue=Ue.next)&&(Ue=t.polygon.gverts.next)}if(null==Fe)break;var pi=Fe.next;null==pi&&(pi=t.polygon.gverts.next);var hi,ui=0,Le=0,ui=Fe.x+(pi.x-Fe.x)*Re,Le=Fe.y+(pi.y-Fe.y)*Re;if(null!=G&&(di=ci=0,(ci=ui-G.x)*ci+(di=Le-G.y)*di<kr.epsilon))break;null==Ir.zpp_pool?hi=new Ir:(hi=Ir.zpp_pool,Ir.zpp_pool=hi.next,hi.next=null),hi.weak=!1,hi._immutable=!1,hi.x=ui,hi.y=Le,Er.flowpoly.add(hi),null==G&&(G=Er.flowpoly.head.elt),X=Fe,V=je,U=!U,$=2}else{var ci,di,pi=W;if(null!=G&&(ci=pi.x,di=pi.y,Le=ui=0,(ui=ci-G.x)*ui+(Le=di-G.y)*Le<kr.epsilon))break;Er.flowpoly.add(pi),null==G&&(G=Er.flowpoly.head.elt),$=1}if(null==Er.flowpoly.head||null==Er.flowpoly.head.next||null==Er.flowpoly.head.next.next)return!1;var _i=0,yi=0,fi=0,yi=0,fi=0,_i=0,mi=Er.flowpoly.head,xi=mi.elt,vi=(mi=mi.next).elt;for(mi=mi.next;null!=mi;){var gi=mi.elt;_i+=vi.x*(gi.y-xi.y);var bi=gi.y*vi.x-gi.x*vi.y;yi+=(vi.x+gi.x)*bi,fi+=(vi.y+gi.y)*bi,xi=vi,vi=gi,mi=mi.next}F=(mi=Er.flowpoly.head).elt;_i+=vi.x*(F.y-xi.y);var zi=F.y*vi.x-F.x*vi.y;yi+=(vi.x+F.x)*zi,fi+=(vi.y+F.y)*zi,xi=vi;O=(mi=mi.next).elt;_i+=F.x*(O.y-xi.y);zi=O.y*F.x-O.x*F.y;yi+=(F.x+O.x)*zi,fi+=(F.y+O.y)*zi;zi=1/(6*(_i*=.5));return yi*=zi,fi*=zi,i.overlap=-_i,i.centroidx=yi,i.centroidy=fi,!0}return!1}return!1}for(var wi=[],Ci=!0,Pi=null,Ti=null,Si=-1e100,Mi=!0,Ai=e.polygon.gverts.next,Oi=0,ki=e.polygon.edges.head;null!=ki;){var Ei=ki.elt,Ii=Ei.gnormx*t.circle.worldCOMx+Ei.gnormy*t.circle.worldCOMy;if(Ii>Ei.gprojection+t.circle.radius){Mi=!1;break}Ii+t.circle.radius>Ei.gprojection+kr.epsilon&&(Ci=!1,wi[Oi]=!0),Si<(Ii-=Ei.gprojection+t.circle.radius)&&(Si=Ii,Pi=Ei,Ti=Ai),Ai=Ai.next,++Oi,ki=ki.next}if(Mi){if(Ci){var Di=t.circle.area,Bi=t.circle.worldCOMx,Li=t.circle.worldCOMy;return i.overlap=Di,i.centroidx=Bi,i.centroidy=Li,!0}var Ri,zi=(null==Ti.next?e.polygon.gverts:Ti).next,Di=t.circle.worldCOMy*Pi.gnormx-t.circle.worldCOMx*Pi.gnormy;if(Di<=Ti.y*Pi.gnormx-Ti.x*Pi.gnormy?(Ri=t.circle.radius,Li=Bi=0,(Bi=Ti.x-t.circle.worldCOMx)*Bi+(Li=Ti.y-t.circle.worldCOMy)*Li<=Ri*Ri):!(Di>=zi.y*Pi.gnormx-zi.x*Pi.gnormy)||(nn=t.circle.radius,Di=Ri=0,(Ri=zi.x-t.circle.worldCOMx)*Ri+(Di=zi.y-t.circle.worldCOMy)*Di<=nn*nn)){for(var Fi=[],ji=0,Ni=!0,Gi=null,Ui=0,Xi=e.polygon.gverts.next;null!=Xi;){var Vi=Xi.x,Wi=Xi.y,Hi=Vi-t.circle.worldCOMx,qi=Wi-t.circle.worldCOMy;(Fi[ji]=Hi*Hi+qi*qi<=t.circle.radius*t.circle.radius)?(Ui=ji,Gi=Xi):Ni=!1,++ji,Xi=Xi.next}if(Ni){var Yi=e.polygon;if(Yi.zip_worldCOM&&null!=Yi.body){if(Yi.zip_worldCOM=!1,Yi.zip_localCOM){if(Yi.zip_localCOM=!1,1==Yi.type){var Ki=Yi.polygon;if(null==Ki.lverts.next.next)Ki.localCOMx=Ki.lverts.next.x,Ki.localCOMy=Ki.lverts.next.y;else if(null==Ki.lverts.next.next.next)Ki.localCOMx=Ki.lverts.next.x,Ki.localCOMy=Ki.lverts.next.y,Ki.localCOMx+=Ki.lverts.next.next.x,Ki.localCOMy+=Ki.lverts.next.next.y,Ki.localCOMx*=.5,Ki.localCOMy*=.5;else{Ki.localCOMx=0;var Zi=Ki.localCOMy=0,Ji=Ki.lverts.next,Qi=Ji,$i=Ji=Ji.next;for(Ji=Ji.next;null!=Ji;){var tn=Ji;Zi+=$i.x*(tn.y-Qi.y);var en=tn.y*$i.x-tn.x*$i.y;Ki.localCOMx+=($i.x+tn.x)*en,Ki.localCOMy+=($i.y+tn.y)*en,Qi=$i,$i=tn,Ji=Ji.next}var nn=Ji=Ki.lverts.next;Zi+=$i.x*(nn.y-Qi.y);var rn=nn.y*$i.x-nn.x*$i.y;Ki.localCOMx+=($i.x+nn.x)*rn,Ki.localCOMy+=($i.y+nn.y)*rn,Qi=$i;var sn=Ji=Ji.next;Zi+=nn.x*(sn.y-Qi.y);rn=sn.y*nn.x-sn.x*nn.y;Ki.localCOMx+=(nn.x+sn.x)*rn,Ki.localCOMy+=(nn.y+sn.y)*rn;sn=Zi=1/(3*Zi);Ki.localCOMx*=sn,Ki.localCOMy*=sn}}null!=Yi.wrap_localCOM&&(Yi.wrap_localCOM.zpp_inner.x=Yi.localCOMx,Yi.wrap_localCOM.zpp_inner.y=Yi.localCOMy)}rn=Yi.body;rn.zip_axis&&(rn.zip_axis=!1,rn.axisx=Math.sin(rn.rot),rn.axisy=Math.cos(rn.rot)),Yi.worldCOMx=Yi.body.posx+(Yi.body.axisy*Yi.localCOMx-Yi.body.axisx*Yi.localCOMy),Yi.worldCOMy=Yi.body.posy+(Yi.localCOMx*Yi.body.axisx+Yi.localCOMy*Yi.body.axisy)}sn=e.polygon.area,rn=e.polygon.worldCOMx,Yi=e.polygon.worldCOMy;return i.overlap=sn,i.centroidx=rn,i.centroidy=Yi,!0}for(;null!=Er.flowpoly.head;){var on=Er.flowpoly.pop_unsafe();on._inuse||(null!=on.outer&&(on.outer.zpp_inner=null,on.outer=null),on._isimmutable=null,on._validate=null,on._invalidate=null,on.next=Ir.zpp_pool,Ir.zpp_pool=on)}Er.flowsegs.clear();var an=null,ln=1;for(null==Gi?(Gi=e.polygon.gverts.next,ln=2):(an=Gi,Er.flowpoly.add(an));0!=ln;)if(1==ln)if(null==(Gi=Gi.next)&&(Gi=e.polygon.gverts.next),++Ui>=e.polygon.edgeCnt&&(Ui=0),Fi[Ui]){var pn=an.x,hn=an.y,un=0,cn=0;if((un=pn-Gi.x)*un+(cn=hn-Gi.y)*cn<kr.epsilon)break;Er.flowpoly.add(Gi)}else{var dn,_n=Er.flowpoly.head.elt,yn=Gi,pn=0,un=0,hn=0,fn=0,cn=(pn=yn.x-_n.x)*pn+(un=yn.y-_n.y)*un,un=2*((hn=_n.x-t.circle.worldCOMx)*pn+(fn=_n.y-t.circle.worldCOMy)*un),hn=Math.sqrt(un*un-4*cn*(hn*hn+fn*fn-t.circle.radius*t.circle.radius)),fn=(-un-hn)*(cn=1/(2*cn)),hn=fn<kr.epsilon?(-un+hn)*cn:fn,cn=0,fn=0,cn=_n.x+(yn.x-_n.x)*hn,fn=_n.y+(yn.y-_n.y)*hn,_n=0,hn=0;if((_n=an.x-cn)*_n+(hn=an.y-fn)*hn<kr.epsilon)break;null==Ir.zpp_pool?dn=new Ir:(dn=Ir.zpp_pool,Ir.zpp_pool=dn.next,dn.next=null),dn.weak=!1,dn._immutable=!1,dn.x=cn,dn.y=fn,Er.flowpoly.add(dn),ln=2}else if(2==ln){fn=Gi.next;null==fn&&(fn=e.polygon.gverts.next);for(var mn=Gi,ln=0,xn=fn,vn=fn;;){var gn=vn,bn=Ui+1;if(bn==e.polygon.edgeCnt&&(bn=0),wi[Ui]){if(Fi[bn]){var zn,wn=0,Cn=0,Pn=0,Tn=0,Sn=(wn=gn.x-mn.x)*wn+(Cn=gn.y-mn.y)*Cn,Mn=2*((Pn=mn.x-t.circle.worldCOMx)*wn+(Tn=mn.y-t.circle.worldCOMy)*Cn),An=Math.sqrt(Mn*Mn-4*Sn*(Pn*Pn+Tn*Tn-t.circle.radius*t.circle.radius)),wn=(-Mn-An)*(Sn=1/(2*Sn)),Cn=wn<kr.epsilon?(-Mn+An)*Sn:wn,Pn=0,Tn=0,Pn=mn.x+(gn.x-mn.x)*Cn,Tn=mn.y+(gn.y-mn.y)*Cn,Mn=0,An=0;if((Mn=an.x-Pn)*Mn+(An=an.y-Tn)*An<kr.epsilon){ln=0,vn=xn;break}null==Ir.zpp_pool?zn=new Ir:(zn=Ir.zpp_pool,Ir.zpp_pool=zn.next,zn.next=null),zn.weak=!1,zn._immutable=!1,zn.x=Pn,zn.y=Tn;Sn=zn;Er.flowsegs.add(Er.flowpoly.head.elt),Er.flowsegs.add(Sn),Er.flowpoly.add(Sn),ln=1,vn=xn;break}wn=0,Cn=0,Mn=0,An=0,Pn=0,Tn=0,Sn=(Mn=gn.x-mn.x)*Mn+(An=gn.y-mn.y)*An,An=2*((Pn=mn.x-t.circle.worldCOMx)*Mn+(Tn=mn.y-t.circle.worldCOMy)*An),Pn=An*An-4*Sn*(Pn*Pn+Tn*Tn-t.circle.radius*t.circle.radius),Tn=Pn*Pn<kr.epsilon?(wn=Pn<0?10:Cn=-An/(2*Sn),!1):(wn=(-An-(Pn=Math.sqrt(Pn)))*(Sn=1/(2*Sn)),Cn=(-An+Pn)*Sn,!0);if(wn<1-kr.epsilon&&Cn>kr.epsilon){var On,An=0,Pn=0,An=mn.x+(gn.x-mn.x)*wn,Pn=mn.y+(gn.y-mn.y)*wn;if(null!=an&&(wn=Sn=0,(Sn=an.x-An)*Sn+(wn=an.y-Pn)*wn<kr.epsilon)){ln=0,vn=xn;break}null==Ir.zpp_pool?On=new Ir:(On=Ir.zpp_pool,Ir.zpp_pool=On.next,On.next=null),On.weak=!1,On._immutable=!1,On.x=An,On.y=Pn;var kn,Pn=On;null!=Er.flowpoly.head&&(Er.flowsegs.add(Er.flowpoly.head.elt),Er.flowsegs.add(Pn)),Er.flowpoly.add(Pn),null==an&&(an=Er.flowpoly.head.elt),Tn&&(Tn=Pn=0,Pn=mn.x+(gn.x-mn.x)*Cn,Tn=mn.y+(gn.y-mn.y)*Cn,null==Ir.zpp_pool?kn=new Ir:(kn=Ir.zpp_pool,Ir.zpp_pool=kn.next,kn.next=null),kn.weak=!1,kn._immutable=!1,kn.x=Pn,kn.y=Tn,Er.flowpoly.add(kn))}}mn=gn,Ui=bn,null==(vn=(Gi=vn).next)&&(vn=e.polygon.gverts.next);break}for(;vn!=xn;){var En=vn,In=Ui+1;if(In==e.polygon.edgeCnt&&(In=0),wi[Ui]){if(Fi[In]){var Dn,Bn=0,Ln=0,Rn=0,Fn=0,jn=(Bn=En.x-mn.x)*Bn+(Ln=En.y-mn.y)*Ln,Nn=2*((Rn=mn.x-t.circle.worldCOMx)*Bn+(Fn=mn.y-t.circle.worldCOMy)*Ln),Gn=Math.sqrt(Nn*Nn-4*jn*(Rn*Rn+Fn*Fn-t.circle.radius*t.circle.radius)),Bn=(-Nn-Gn)*(jn=1/(2*jn)),Ln=Bn<kr.epsilon?(-Nn+Gn)*jn:Bn,Rn=0,Fn=0,Rn=mn.x+(En.x-mn.x)*Ln,Fn=mn.y+(En.y-mn.y)*Ln,Nn=0,Gn=0;if((Nn=an.x-Rn)*Nn+(Gn=an.y-Fn)*Gn<kr.epsilon){ln=0;break}null==Ir.zpp_pool?Dn=new Ir:(Dn=Ir.zpp_pool,Ir.zpp_pool=Dn.next,Dn.next=null),Dn.weak=!1,Dn._immutable=!1,Dn.x=Rn,Dn.y=Fn;jn=Dn;Er.flowsegs.add(Er.flowpoly.head.elt),Er.flowsegs.add(jn),Er.flowpoly.add(jn),ln=1;break}Bn=0,Ln=0,Nn=0,Gn=0,Rn=0,Fn=0,jn=(Nn=En.x-mn.x)*Nn+(Gn=En.y-mn.y)*Gn,Gn=2*((Rn=mn.x-t.circle.worldCOMx)*Nn+(Fn=mn.y-t.circle.worldCOMy)*Gn),Rn=Gn*Gn-4*jn*(Rn*Rn+Fn*Fn-t.circle.radius*t.circle.radius),Fn=Rn*Rn<kr.epsilon?(Bn=Rn<0?10:Ln=-Gn/(2*jn),!1):(Bn=(-Gn-(Rn=Math.sqrt(Rn)))*(jn=1/(2*jn)),Ln=(-Gn+Rn)*jn,!0);if(Bn<1-kr.epsilon&&Ln>kr.epsilon){var Un,Gn=0,Rn=0,Gn=mn.x+(En.x-mn.x)*Bn,Rn=mn.y+(En.y-mn.y)*Bn;if(null!=an&&(Bn=jn=0,(jn=an.x-Gn)*jn+(Bn=an.y-Rn)*Bn<kr.epsilon)){ln=0;break}null==Ir.zpp_pool?Un=new Ir:(Un=Ir.zpp_pool,Ir.zpp_pool=Un.next,Un.next=null),Un.weak=!1,Un._immutable=!1,Un.x=Gn,Un.y=Rn;var Xn,Rn=Un;null!=Er.flowpoly.head&&(Er.flowsegs.add(Er.flowpoly.head.elt),Er.flowsegs.add(Rn)),Er.flowpoly.add(Rn),null==an&&(an=Er.flowpoly.head.elt),Fn&&(Fn=Rn=0,Rn=mn.x+(En.x-mn.x)*Ln,Fn=mn.y+(En.y-mn.y)*Ln,null==Ir.zpp_pool?Xn=new Ir:(Xn=Ir.zpp_pool,Ir.zpp_pool=Xn.next,Xn.next=null),Xn.weak=!1,Xn._immutable=!1,Xn.x=Rn,Xn.y=Fn,Er.flowpoly.add(Xn))}}mn=En,Ui=In,null==(vn=(Gi=vn).next)&&(vn=e.polygon.gverts.next)}}if(null==Er.flowpoly.head)return!1;if(null==Er.flowpoly.head.next){for(var Vn=!0,Wn=e.polygon.edges.head;null!=Wn;){var Hn=Wn.elt;if(Hn.gnormx*t.circle.worldCOMx+Hn.gnormy*t.circle.worldCOMy>Hn.gprojection){Vn=!1;break}Wn=Wn.next}if(Vn){var Yi=t.circle.area,qn=t.circle.worldCOMx,Yn=t.circle.worldCOMy;return i.overlap=Yi,i.centroidx=qn,i.centroidy=Yn,!0}return!1}var Kn=0,Zn=0,Jn=0;if(null!=Er.flowpoly.head.next.next){var Qn=0,$n=0,tr=0,$n=0,tr=0,Qn=0,er=Er.flowpoly.head,ir=er.elt,nr=(er=er.next).elt;for(er=er.next;null!=er;){var rr=er.elt;Qn+=nr.x*(rr.y-ir.y);var sr=rr.y*nr.x-rr.x*nr.y;$n+=(nr.x+rr.x)*sr,tr+=(nr.y+rr.y)*sr,ir=nr,nr=rr,er=er.next}var or=(er=Er.flowpoly.head).elt;Qn+=nr.x*(or.y-ir.y);var ar=or.y*nr.x-or.x*nr.y;$n+=(nr.x+or.x)*ar,tr+=(nr.y+or.y)*ar,ir=nr;var lr=(er=er.next).elt;Qn+=or.x*(lr.y-ir.y);var pr=lr.y*or.x-lr.x*or.y;$n+=(or.x+lr.x)*pr,tr+=(or.y+lr.y)*pr;var hr=1/(6*(Qn*=.5)),ur=-Qn;Kn+=($n*=hr)*ur,Zn+=(tr*=hr)*ur,Jn=0-Qn}else Er.flowsegs.add(Er.flowpoly.head.elt),Er.flowsegs.add(Er.flowpoly.head.next.elt);for(;null!=Er.flowsegs.head;){var cr=Er.flowsegs.pop_unsafe(),dr=Er.flowsegs.pop_unsafe(),_r=0,yr=0,_r=dr.x-cr.x,yr=dr.y-cr.y,fr=1/Math.sqrt(_r*_r+yr*yr),mr=_r*=fr;_r=-(yr*=fr),yr=mr;var xr=cr.x+dr.x,vr=cr.y+dr.y;xr*=.5,vr*=.5;var gr=_r*(xr-=t.circle.worldCOMx)+yr*(vr-=t.circle.worldCOMy),mr=gr/t.circle.radius,cr=Math.sqrt(1-mr*mr),dr=Math.acos(mr),br=t.circle.radius*(t.circle.radius*dr-gr*cr),fr=.6666666666666666*t.circle.radius*cr*cr*cr/(dr-mr*cr);xr=t.circle.worldCOMx,vr=t.circle.worldCOMy,Kn+=(xr+=_r*fr)*br,Zn+=(vr+=yr*fr)*br,Jn+=br}qn=1/Jn;return Kn*=qn,Zn*=qn,i.overlap=Jn,i.centroidx=Kn,i.centroidy=Zn,!0}return!1}return!1}Yn=t.circle,ar=e.circle,or=0,or=ar.worldCOMx-Yn.worldCOMx,lr=ar.worldCOMy-Yn.worldCOMy,pr=Yn.radius+ar.radius,hr=or*or+lr*lr;if(pr*pr<hr)return!1;if(hr<kr.epsilon*kr.epsilon)return Yn.radius<ar.radius?(ur=Yn.area,qn=Yn.worldCOMx,pr=Yn.worldCOMy,i.overlap=ur,i.centroidx=qn,i.centroidy=pr):(Mr=ar.area,Ar=ar.worldCOMx,Or=ar.worldCOMy,i.overlap=Mr,i.centroidx=Ar,i.centroidy=Or),!0;var zr,wr,Cr,Pr,Tr,Sr,Mr=Math.sqrt(hr),Ar=1/Mr,Or=.5*(Mr-(ar.radius*ar.radius-Yn.radius*Yn.radius)*Ar);return Or<=-Yn.radius?(zr=Yn.area,wr=Yn.worldCOMx,Sr=Yn.worldCOMy,i.overlap=zr,i.centroidx=wr,i.centroidy=Sr):(hr=Mr-Or)<=-ar.radius?(Pr=ar.area,Tr=ar.worldCOMx,Cr=ar.worldCOMy,i.overlap=Pr,i.centroidx=Tr,i.centroidy=Cr):(Sr=wr=zr=0,Pr=Or/Yn.radius,Tr=Math.sqrt(1-Pr*Pr),Cr=Math.acos(Pr),zr=Yn.radius*(Yn.radius*Cr-Or*Tr),wr=.6666666666666666*Yn.radius*Tr*Tr*Tr/(Cr-Pr*Tr),Cr=hr/ar.radius,Pr=Math.sqrt(1-Cr*Cr),Tr=Math.acos(Cr),hr=zr+(Sr=ar.radius*(ar.radius*Tr-hr*Pr)),Ar=(wr*zr+(Mr-.6666666666666666*ar.radius*Pr*Pr*Pr/(Tr-Cr*Pr))*Sr)/hr*Ar,or=Yn.worldCOMx+or*Ar,Ar=Yn.worldCOMy+lr*Ar,i.overlap=hr,i.centroidx=or,i.centroidy=Ar),!0},Er.prototype.__class__=Er;var ce=zpp_nape.geom.ZPP_Convex=function(){};ce.__name__=["zpp_nape","geom","ZPP_Convex"],ce.isinner=function(t,e,i){var n=t.x-e.x,r=t.y-e.y,t=0,t=i.x-e.x;return 0<=(i.y-e.y)*n-t*r},ce.optimise=function(t){var e=t.vertices,i=t.vertices;if(null!=e)for(var n=e;n.sort(),(n=n.next)!=i;);var e=t.vertices,r=t.vertices;if(null!=e)for(var s=e;;){for(var o=s,a=o.prev,l=null,p=o.diagonals.head;null!=p;){var h=p.elt;if(ce.isinner(null==p.next?o.next:p.next.elt,o,a)){for(var u=!0,c=h.prev,d=null,_=h.diagonals.head;null!=_;){var y=_.elt;if(y==o){u=ce.isinner(null==_.next?h.next:_.next.elt,h,c);break}c=y,_=(d=_).next}u?(p=o.diagonals.erase(l),h.diagonals.erase(d)):(a=h,p=(l=p).next)}else a=h,p=(l=p).next}if((s=s.next)==r)break}},ce.prototype.__class__=ce;var de=zpp_nape.geom.ZPP_ConvexRayResult=function(){this.toiDistance=0,this.next=null,this.inner=!1,this.ray=null,this.position=null,this.convex=null,this.shape=null,this.normal=null};de.__name__=["zpp_nape","geom","ZPP_ConvexRayResult"],de.getRay=function(t,e,i,n){var r;null==de.rayPool?(de.internal=!0,(r=new H).zpp_inner=new de,r.zpp_inner.ray=r,de.internal=!1):(r=de.rayPool.ray,de.rayPool=de.rayPool.next,r.zpp_inner.next=null);var s=r.zpp_inner;return(s.normal=t).zpp_inner._immutable=!0,s.toiDistance=e,s.inner=i,s.shape=n,r},de.getConvex=function(t,e,i,n){var r;null==de.convexPool?(de.internal=!0,(r=new G).zpp_inner=new de,r.zpp_inner.convex=r,de.internal=!1):(r=de.convexPool.convex,de.convexPool=de.convexPool.next,r.zpp_inner.next=null);var s=r.zpp_inner;return s.normal=t,s.position=e,t.zpp_inner._immutable=!0,e.zpp_inner._immutable=!0,s.toiDistance=i,s.shape=n,r},de.prototype.normal=null,de.prototype.shape=null,de.prototype.convex=null,de.prototype.position=null,de.prototype.ray=null,de.prototype.inner=null,de.prototype.next=null,de.prototype.toiDistance=null,de.prototype.disposed=function(){},de.prototype.free=function(){this.normal.zpp_inner._immutable=!1;var t=this.normal,e=t.zpp_inner;t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ir.zpp_pool,Ir.zpp_pool=e,null!=this.position&&(this.position.zpp_inner._immutable=!1,e=(t=this.position).zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ir.zpp_pool,Ir.zpp_pool=e),this.shape=null,this.toiDistance=0,null!=this.convex?(this.next=de.convexPool,de.convexPool=this):(this.next=de.rayPool,de.rayPool=this)},de.prototype.__class__=de;var _i=zpp_nape.geom.ZPP_CutVert=function(){this.used=!1,this.rank=0,this.parent=null,this.positive=!1,this.value=0,this.vert=null,this.posy=0,this.posx=0,this.next=null,this.prev=null};_i.__name__=["zpp_nape","geom","ZPP_CutVert"],_i.path=function(t){var e;return null==_i.zpp_pool?e=new _i:(e=_i.zpp_pool,_i.zpp_pool=e.next,e.next=null),e.vert=t,(e.parent=e).rank=0,e.used=!1,e},_i.prototype.prev=null,_i.prototype.next=null,_i.prototype.posx=null,_i.prototype.posy=null,_i.prototype.vert=null,_i.prototype.value=null,_i.prototype.positive=null,_i.prototype.parent=null,_i.prototype.rank=null,_i.prototype.used=null,_i.prototype.alloc=function(){},_i.prototype.free=function(){this.vert=null,this.parent=null},_i.prototype.__class__=_i;var yi=zpp_nape.geom.ZPP_CutInt=function(){this.path1=null,this.start=null,this.end=null,this.path0=null,this.vertex=!1,this.virtualint=!1,this.time=0,this.next=null};yi.__name__=["zpp_nape","geom","ZPP_CutInt"],yi.get=function(t,e,i,n,r,s,o){var a;return null==o&&(o=!1),null==s&&(s=!1),null==yi.zpp_pool?a=new yi:(a=yi.zpp_pool,yi.zpp_pool=a.next,a.next=null),a.virtualint=s,a.end=e,a.start=i,a.path0=n,a.path1=r,a.time=t,a.vertex=o,a},yi.prototype.next=null,yi.prototype.time=null,yi.prototype.virtualint=null,yi.prototype.vertex=null,yi.prototype.path0=null,yi.prototype.end=null,yi.prototype.start=null,yi.prototype.path1=null,yi.prototype.alloc=function(){},yi.prototype.free=function(){this.end=this.start=null,this.path0=this.path1=null},yi.prototype.__class__=yi;var fi=zpp_nape.geom.ZPP_Cutter=function(){};fi.__name__=["zpp_nape","geom","ZPP_Cutter"],fi.run=function(t,e,i,n,r,s){var o,a,l=e.zpp_inner;null!=l._validate&&l._validate(),o=e.zpp_inner.x;l=e.zpp_inner;null!=l._validate&&l._validate(),a=e.zpp_inner.y;var p,h,e=i.zpp_inner;null!=e._validate&&e._validate(),p=i.zpp_inner.x-o;e=i.zpp_inner;null!=e._validate&&e._validate();for(var u,c=n?0:-1/0,d=r?1:1/0,_=-(a*p-o*(h=i.zpp_inner.y-a)),y=null,f=!1,m=t;;){null==_i.zpp_pool?u=new _i:(u=_i.zpp_pool,_i.zpp_pool=u.next,u.next=null),u.vert=m,u.posx=u.vert.x,u.posy=u.vert.y,u.value=u.posy*p-u.posx*h+_,u.positive=0<u.value,0==u.value&&(f=!0);var x=u;if(null==y?y=x.prev=x.next=x:(x.prev=y,x.next=y.next,y.next.prev=x,y.next=x),y=x,(m=m.next)==t)break}if(f){var v=null,g=y;if(null!=y)for(var b=y;;){if(0!=b.value){v=b;break}if((b=b.next)==g)break}var z=p,w=h,C=1/Math.sqrt(z*z+w*w),P=z*=C;z=-(w*=C),w=P;for(var T=null,S=v;;)if(0==S.value||null!=T&&S!=T.next){var M=T.value*S.value;if(0!=M){var A,O=T.next;if(0<M)A=T.positive;else{var k=O.next,E=O.posx+k.posx,M=O.posy+k.posy,I=(E*=.5)+1e-8*z,D=(M*=.5)+1e-8*w,B=!1;if(null!=t)for(var L=t;;){var R=L.prev;if((L.y<D&&R.y>=D||R.y<D&&L.y>=D)&&(L.x<=I||R.x<=I)&&L.x+(D-L.y)/(R.y-L.y)*(R.x-L.x)<I&&(B=!B),(L=L.next)==t)break}A=B}var F=S;if(null!=O)for(var j=O;j.positive=A,(j=j.next)!=F;);if((S=(T=S).next)==v)break}else if((S=S.next)==v)break}else if((S=(T=S).next)==v)break;for(;;){if(0!=S.value&&(null==T||S==T.next)){S=(T=S).next;break}var N=T.value*S.value;if(0==N){S=S.next;break}var G,U=T.next;if(0<N)G=T.positive;else{var X=U.next,V=U.posx+X.posx,N=U.posy+X.posy,W=(V*=.5)+1e-8*z,H=(N*=.5)+1e-8*w,q=!1;if(null!=t)for(var Y=t;;){var K=Y.prev;if((Y.y<H&&K.y>=H||K.y<H&&Y.y>=H)&&(Y.x<=W||K.x<=W)&&Y.x+(H-Y.y)/(K.y-Y.y)*(K.x-Y.x)<W&&(q=!q),(Y=Y.next)==t)break}G=q}var Z=S;if(null!=U)for(var J=U;J.positive=G,(J=J.next)!=Z;);S=(T=S).next;break}}null==fi.ints&&(fi.ints=new bi),null==fi.paths&&(fi.paths=new zi);var Q=null,C=y.posx,P=y.posy;null==nn.zpp_pool?$=new nn:($=nn.zpp_pool,nn.zpp_pool=$.next,$.next=null),$.forced=!1,$.x=C,$.y=P;P=$;null==Q?Q=P.prev=P.next=P:(P.next=Q,P.prev=Q.prev,Q.prev.next=P,Q.prev=P);var $=Q;null==_i.zpp_pool?Ct=new _i:(Ct=_i.zpp_pool,_i.zpp_pool=Ct.next,Ct.next=null),Ct.vert=Q,(Ct.parent=Ct).rank=0,Ct.used=!1;P=Ct;fi.paths.add(P);for(var tt=y;;){var et,it=tt.next,nt=it.posx,rt=it.posy;null==nn.zpp_pool?et=new nn:(et=nn.zpp_pool,nn.zpp_pool=et.next,et.next=null),et.forced=!1,et.x=nt,et.y=rt;var st,ot,at,lt,pt,ht,ut,ct,dt,_t,yt,ft,mt,xt,vt,gt,bt,zt,wt=et;if(tt.positive==it.positive?null==Q?Q=wt.prev=wt.next=wt:(wt.next=Q,wt.prev=Q.prev,Q.prev.next=wt,Q.prev=wt):(ot=st=0,gt=1/(gt=h*(st=it.posx-tt.posx)-p*(ot=it.posy-tt.posy)),mt=xt=0,(nt=(ot*(xt=o-tt.posx)-st*(mt=a-tt.posy))*gt)<c||d<nt?(null==yi.zpp_pool?at=new yi:(at=yi.zpp_pool,yi.zpp_pool=at.next,at.next=null),at.virtualint=!0,at.end=null,at.start=null,at.path0=null,at.path1=null,at.time=nt,at.vertex=!1,fi.ints.add(at),null==Q?Q=wt.prev=wt.next=wt:(wt.next=Q,wt.prev=Q.prev,Q.prev.next=wt,Q.prev=wt)):0==tt.value?(rt=Q.prev,Q=null,_t=rt.x,ut=rt.y,null==nn.zpp_pool?lt=new nn:(lt=nn.zpp_pool,nn.zpp_pool=lt.next,lt.next=null),lt.forced=!1,lt.x=_t,lt.y=ut,_t=lt,null==Q?Q=_t.prev=_t.next=_t:(_t.next=Q,_t.prev=Q.prev,Q.prev.next=_t,Q.prev=_t),null==Q?Q=wt.prev=wt.next=wt:(wt.next=Q,wt.prev=Q.prev,Q.prev.next=wt,Q.prev=wt),ut=fi.paths.head.elt,null==_i.zpp_pool?pt=new _i:(pt=_i.zpp_pool,_i.zpp_pool=pt.next,pt.next=null),pt.vert=Q,(pt.parent=pt).rank=0,pt.used=!1,fi.paths.add(pt),_t=fi.paths.head.elt,null==yi.zpp_pool?ht=new yi:(ht=yi.zpp_pool,yi.zpp_pool=ht.next,ht.next=null),ht.virtualint=!0,ht.end=rt,ht.start=Q,ht.path0=ut,ht.path1=_t,ht.time=nt,ht.vertex=!1,fi.ints.add(ht)):0==it.value?(null==Q?Q=wt.prev=wt.next=wt:(wt.next=Q,wt.prev=Q.prev,Q.prev.next=wt,Q.prev=wt),ut=Q.prev,Q=null,_t=it.posx,it=it.posy,null==nn.zpp_pool?ct=new nn:(ct=nn.zpp_pool,nn.zpp_pool=ct.next,ct.next=null),ct.forced=!1,ct.x=_t,ct.y=it,_t=ct,null==Q?Q=_t.prev=_t.next=_t:(_t.next=Q,_t.prev=Q.prev,Q.prev.next=_t,Q.prev=_t),it=fi.paths.head.elt,null==_i.zpp_pool?dt=new _i:(dt=_i.zpp_pool,_i.zpp_pool=dt.next,dt.next=null),dt.vert=Q,(dt.parent=dt).rank=0,dt.used=!1,fi.paths.add(dt),_t=fi.paths.head.elt,null==yi.zpp_pool?yt=new yi:(yt=yi.zpp_pool,yi.zpp_pool=yt.next,yt.next=null),yt.virtualint=!0,yt.end=ut,yt.start=Q,yt.path0=it,yt.path1=_t,yt.time=nt,yt.vertex=!1,fi.ints.add(yt)):(xt=(h*xt-p*mt)*gt,gt=mt=0,mt=tt.posx,gt=tt.posy,mt+=st*xt,gt+=ot*xt,null==nn.zpp_pool?ft=new nn:(ft=nn.zpp_pool,nn.zpp_pool=ft.next,ft.next=null),ft.forced=!1,ft.x=mt,ft.y=gt,xt=ft,null==Q?Q=xt.prev=xt.next=xt:(xt.next=Q,xt.prev=Q.prev,Q.prev.next=xt,Q.prev=xt),xt=Q.prev,(Q=null)==nn.zpp_pool?vt=new nn:(vt=nn.zpp_pool,nn.zpp_pool=vt.next,vt.next=null),vt.forced=!1,vt.x=mt,vt.y=gt,gt=vt,null==Q?Q=gt.prev=gt.next=gt:(gt.next=Q,gt.prev=Q.prev,Q.prev.next=gt,Q.prev=gt),null==Q?Q=wt.prev=wt.next=wt:(wt.next=Q,wt.prev=Q.prev,Q.prev.next=wt,Q.prev=wt),gt=fi.paths.head.elt,null==_i.zpp_pool?bt=new _i:(bt=_i.zpp_pool,_i.zpp_pool=bt.next,bt.next=null),bt.vert=Q,(bt.parent=bt).rank=0,bt.used=!1,fi.paths.add(bt),wt=fi.paths.head.elt,null==yi.zpp_pool?zt=new yi:(zt=yi.zpp_pool,yi.zpp_pool=zt.next,zt.next=null),zt.virtualint=!1,zt.end=xt,zt.start=Q,zt.path0=gt,zt.path1=wt,zt.time=nt,zt.vertex=!1,fi.ints.add(zt))),(tt=tt.next)==y)break}var Ct=Q.prev;Ct.next.prev=$.prev,$.prev.next=Ct.next,(Ct.next=$).prev=Ct;var Pt,Ct=fi.paths.head.elt;if(P==P.parent)Dt=P;else{for(var Tt=P,St=null;Tt!=Tt.parent;){var Mt=Tt.parent;Tt.parent=St,St=Tt,Tt=Mt}for(;null!=St;){var At=St.parent;St.parent=Tt,St=At}Dt=Tt}if(Ct==Ct.parent)Pt=Ct;else{for(var Ot=Ct,kt=null;Ot!=Ot.parent;){var Et=Ot.parent;Ot.parent=kt,kt=Ot,Ot=Et}for(;null!=kt;){var It=kt.parent;kt.parent=Ot,kt=It}Pt=Ot}Dt!=Pt&&(Dt.rank<Pt.rank?Dt.parent=Pt:Dt.rank>Pt.rank?Pt.parent=Dt:(Pt.parent=Dt).rank++);var Dt=fi.ints;if(null!=Dt.head&&null!=Dt.head.next){for(var Bt,Lt,Rt,Ft=Dt.head,jt=null,Nt=null,Gt=null,Ut=null,Xt=1;;){for(Bt=0,Nt=Ft,jt=Ft=null;null!=Nt;){for(++Bt,Gt=Nt,Lt=0,Rt=Xt;null!=Gt&&Lt<Xt;)++Lt,Gt=Gt.next;for(;0<Lt||0<Rt&&null!=Gt;)0!=Lt&&(0==Rt||null==Gt||Nt.elt.time<Gt.elt.time)?(Nt=(Ut=Nt).next,--Lt):(Gt=(Ut=Gt).next,--Rt),null!=jt?jt.next=Ut:Ft=Ut,jt=Ut;Nt=Gt}if(jt.next=null,Xt<<=1,!(1<Bt))break}Dt.head=Ft,Dt.modified=!0,Dt.pushmod=!0}for(;null!=fi.ints.head;){var Vt,Wt,Ht,qt,Yt=fi.ints.pop_unsafe(),Kt=fi.ints.pop_unsafe();if(Yt.virtualint||Kt.virtualint){if(Yt.virtualint&&!Kt.virtualint){var Zt,Jt,Qt,$t,te,ee,ie,ne,re,se,oe,ae=null!=Kt.end&&Kt.end.prev==Kt.end?((Kt.end.next=Kt.end.prev=null)!=(Qt=Kt.end).wrap&&(Qt.wrap.zpp_inner._inuse=!1,Jt=(Zt=Qt.wrap).zpp_inner,Zt.zpp_inner.outer=null,Zt.zpp_inner=null,Zt.zpp_pool=Rn.poolVec2,Rn.poolVec2=Zt,null!=Jt.outer&&(Jt.outer.zpp_inner=null,Jt.outer=null),Jt._isimmutable=null,Jt._validate=null,Jt._invalidate=null,Jt.next=Ir.zpp_pool,Ir.zpp_pool=Jt,Qt.wrap=null),Qt.prev=Qt.next=null,Qt.next=nn.zpp_pool,nn.zpp_pool=Qt,null):(ae=Kt.end.prev,Kt.end.prev.next=Kt.end.next,Kt.end.next.prev=Kt.end.prev,(Kt.end.next=Kt.end.prev=null)!=(Zt=Kt.end).wrap&&(Zt.wrap.zpp_inner._inuse=!1,Qt=(Jt=Zt.wrap).zpp_inner,Jt.zpp_inner.outer=null,Jt.zpp_inner=null,Jt.zpp_pool=Rn.poolVec2,Rn.poolVec2=Jt,null!=Qt.outer&&(Qt.outer.zpp_inner=null,Qt.outer=null),Qt._isimmutable=null,Qt._validate=null,Qt._invalidate=null,Qt.next=Ir.zpp_pool,Ir.zpp_pool=Qt,Zt.wrap=null),Zt.prev=Zt.next=null,Zt.next=nn.zpp_pool,nn.zpp_pool=Zt,Kt.end=null,ae);if(Kt.end=ae,Kt.vertex||(Kt.end!=Kt.path0.vert?(Kt.start.x=Kt.end.x,Kt.start.y=Kt.end.y,ee=null!=Kt.end&&Kt.end.prev==Kt.end?((Kt.end.next=Kt.end.prev=null)!=(te=Kt.end).wrap&&(te.wrap.zpp_inner._inuse=!1,$t=(ae=te.wrap).zpp_inner,ae.zpp_inner.outer=null,ae.zpp_inner=null,ae.zpp_pool=Rn.poolVec2,Rn.poolVec2=ae,null!=$t.outer&&($t.outer.zpp_inner=null,$t.outer=null),$t._isimmutable=null,$t._validate=null,$t._invalidate=null,$t.next=Ir.zpp_pool,Ir.zpp_pool=$t,te.wrap=null),te.prev=te.next=null,te.next=nn.zpp_pool,nn.zpp_pool=te,null):(re=Kt.end.prev,Kt.end.prev.next=Kt.end.next,Kt.end.next.prev=Kt.end.prev,(Kt.end.next=Kt.end.prev=null)!=(ee=Kt.end).wrap&&(ee.wrap.zpp_inner._inuse=!1,te=($t=ee.wrap).zpp_inner,$t.zpp_inner.outer=null,$t.zpp_inner=null,$t.zpp_pool=Rn.poolVec2,Rn.poolVec2=$t,null!=te.outer&&(te.outer.zpp_inner=null,te.outer=null),te._isimmutable=null,te._validate=null,te._invalidate=null,te.next=Ir.zpp_pool,Ir.zpp_pool=te,ee.wrap=null),ee.prev=ee.next=null,ee.next=nn.zpp_pool,nn.zpp_pool=ee,Kt.end=null,re),Kt.end=ee):(re=Kt.start.next,Kt.start.x=re.x,Kt.start.y=re.y,null!=re&&re.prev==re?((re.next=re.prev=null)!=(ne=re).wrap&&(ne.wrap.zpp_inner._inuse=!1,ie=(ee=ne.wrap).zpp_inner,ee.zpp_inner.outer=null,ee.zpp_inner=null,ee.zpp_pool=Rn.poolVec2,Rn.poolVec2=ee,null!=ie.outer&&(ie.outer.zpp_inner=null,ie.outer=null),ie._isimmutable=null,ie._validate=null,ie._invalidate=null,ie.next=Ir.zpp_pool,Ir.zpp_pool=ie,ne.wrap=null),ne.prev=ne.next=null,ne.next=nn.zpp_pool,nn.zpp_pool=ne,re=null):(re.prev.next=re.next,re.next.prev=re.prev,(re.next=re.prev=null)!=(ie=re).wrap&&(ie.wrap.zpp_inner._inuse=!1,re=(ne=ie.wrap).zpp_inner,ne.zpp_inner.outer=null,ne.zpp_inner=null,ne.zpp_pool=Rn.poolVec2,Rn.poolVec2=ne,null!=re.outer&&(re.outer.zpp_inner=null,re.outer=null),re._isimmutable=null,re._validate=null,re._invalidate=null,re.next=Ir.zpp_pool,Ir.zpp_pool=re,ie.wrap=null),ie.prev=ie.next=null,ie.next=nn.zpp_pool,nn.zpp_pool=ie))),Kt.end.next.prev=Kt.start.prev,Kt.start.prev.next=Kt.end.next,Kt.end.next=Kt.start,Kt.start.prev=Kt.end,Kt.path0==Kt.path0.parent)se=Kt.path0;else{for(var le=Kt.path0,pe=null;le!=le.parent;){var he=le.parent;le.parent=pe,pe=le,le=he}for(;null!=pe;){var ue=pe.parent;pe.parent=le,pe=ue}se=le}if(Kt.path1==Kt.path1.parent)oe=Kt.path1;else{for(var ce=Kt.path1,de=null;ce!=ce.parent;){var _e=ce.parent;ce.parent=de,de=ce,ce=_e}for(;null!=de;){var ye=de.parent;de.parent=ce,de=ye}oe=ce}se!=oe&&(se.rank<oe.rank?se.parent=oe:se.rank>oe.rank?oe.parent=se:(oe.parent=se).rank++)}else if(Kt.virtualint&&!Yt.virtualint){var fe,me,xe,ve,ge,be,ze,we,Ce,Pe,Te,Se=null!=Yt.end&&Yt.end.prev==Yt.end?((Yt.end.next=Yt.end.prev=null)!=(xe=Yt.end).wrap&&(xe.wrap.zpp_inner._inuse=!1,me=(fe=xe.wrap).zpp_inner,fe.zpp_inner.outer=null,fe.zpp_inner=null,fe.zpp_pool=Rn.poolVec2,Rn.poolVec2=fe,null!=me.outer&&(me.outer.zpp_inner=null,me.outer=null),me._isimmutable=null,me._validate=null,me._invalidate=null,me.next=Ir.zpp_pool,Ir.zpp_pool=me,xe.wrap=null),xe.prev=xe.next=null,xe.next=nn.zpp_pool,nn.zpp_pool=xe,null):(Se=Yt.end.prev,Yt.end.prev.next=Yt.end.next,Yt.end.next.prev=Yt.end.prev,(Yt.end.next=Yt.end.prev=null)!=(fe=Yt.end).wrap&&(fe.wrap.zpp_inner._inuse=!1,xe=(me=fe.wrap).zpp_inner,me.zpp_inner.outer=null,me.zpp_inner=null,me.zpp_pool=Rn.poolVec2,Rn.poolVec2=me,null!=xe.outer&&(xe.outer.zpp_inner=null,xe.outer=null),xe._isimmutable=null,xe._validate=null,xe._invalidate=null,xe.next=Ir.zpp_pool,Ir.zpp_pool=xe,fe.wrap=null),fe.prev=fe.next=null,fe.next=nn.zpp_pool,nn.zpp_pool=fe,Yt.end=null,Se);if(Yt.end=Se,Yt.vertex||(Yt.end!=Yt.path0.vert?(Yt.start.x=Yt.end.x,Yt.start.y=Yt.end.y,be=null!=Yt.end&&Yt.end.prev==Yt.end?((Yt.end.next=Yt.end.prev=null)!=(ge=Yt.end).wrap&&(ge.wrap.zpp_inner._inuse=!1,ve=(Se=ge.wrap).zpp_inner,Se.zpp_inner.outer=null,Se.zpp_inner=null,Se.zpp_pool=Rn.poolVec2,Rn.poolVec2=Se,null!=ve.outer&&(ve.outer.zpp_inner=null,ve.outer=null),ve._isimmutable=null,ve._validate=null,ve._invalidate=null,ve.next=Ir.zpp_pool,Ir.zpp_pool=ve,ge.wrap=null),ge.prev=ge.next=null,ge.next=nn.zpp_pool,nn.zpp_pool=ge,null):(Ce=Yt.end.prev,Yt.end.prev.next=Yt.end.next,Yt.end.next.prev=Yt.end.prev,(Yt.end.next=Yt.end.prev=null)!=(be=Yt.end).wrap&&(be.wrap.zpp_inner._inuse=!1,ge=(ve=be.wrap).zpp_inner,ve.zpp_inner.outer=null,ve.zpp_inner=null,ve.zpp_pool=Rn.poolVec2,Rn.poolVec2=ve,null!=ge.outer&&(ge.outer.zpp_inner=null,ge.outer=null),ge._isimmutable=null,ge._validate=null,ge._invalidate=null,ge.next=Ir.zpp_pool,Ir.zpp_pool=ge,be.wrap=null),be.prev=be.next=null,be.next=nn.zpp_pool,nn.zpp_pool=be,Yt.end=null,Ce),Yt.end=be):(Ce=Yt.start.next,Yt.start.x=Ce.x,Yt.start.y=Ce.y,null!=Ce&&Ce.prev==Ce?((Ce.next=Ce.prev=null)!=(we=Ce).wrap&&(we.wrap.zpp_inner._inuse=!1,ze=(be=we.wrap).zpp_inner,be.zpp_inner.outer=null,be.zpp_inner=null,be.zpp_pool=Rn.poolVec2,Rn.poolVec2=be,null!=ze.outer&&(ze.outer.zpp_inner=null,ze.outer=null),ze._isimmutable=null,ze._validate=null,ze._invalidate=null,ze.next=Ir.zpp_pool,Ir.zpp_pool=ze,we.wrap=null),we.prev=we.next=null,we.next=nn.zpp_pool,nn.zpp_pool=we,Ce=null):(Ce.prev.next=Ce.next,Ce.next.prev=Ce.prev,(Ce.next=Ce.prev=null)!=(ze=Ce).wrap&&(ze.wrap.zpp_inner._inuse=!1,Ce=(we=ze.wrap).zpp_inner,we.zpp_inner.outer=null,we.zpp_inner=null,we.zpp_pool=Rn.poolVec2,Rn.poolVec2=we,null!=Ce.outer&&(Ce.outer.zpp_inner=null,Ce.outer=null),Ce._isimmutable=null,Ce._validate=null,Ce._invalidate=null,Ce.next=Ir.zpp_pool,Ir.zpp_pool=Ce,ze.wrap=null),ze.prev=ze.next=null,ze.next=nn.zpp_pool,nn.zpp_pool=ze))),Yt.end.next.prev=Yt.start.prev,Yt.start.prev.next=Yt.end.next,Yt.end.next=Yt.start,Yt.start.prev=Yt.end,Yt.path0==Yt.path0.parent)Pe=Yt.path0;else{for(var Me=Yt.path0,Ae=null;Me!=Me.parent;){var Oe=Me.parent;Me.parent=Ae,Ae=Me,Me=Oe}for(;null!=Ae;){var ke=Ae.parent;Ae.parent=Me,Ae=ke}Pe=Me}if(Yt.path1==Yt.path1.parent)Te=Yt.path1;else{for(var Ee=Yt.path1,Ie=null;Ee!=Ee.parent;){var De=Ee.parent;Ee.parent=Ie,Ie=Ee,Ee=De}for(;null!=Ie;){var Be=Ie.parent;Ie.parent=Ee,Ie=Be}Te=Ee}Pe!=Te&&(Pe.rank<Te.rank?Pe.parent=Te:Pe.rank>Te.rank?Te.parent=Pe:(Te.parent=Pe).rank++)}}else{if(Yt.end.next.prev=Kt.start.prev,Kt.start.prev.next=Yt.end.next,Yt.end.next=Kt.start,Kt.start.prev=Yt.end,Kt.end.next.prev=Yt.start.prev,Yt.start.prev.next=Kt.end.next,Kt.end.next=Yt.start,Yt.start.prev=Kt.end,Yt.path0==Yt.path0.parent)Vt=Yt.path0;else{for(var Le=Yt.path0,Re=null;Le!=Le.parent;){var Fe=Le.parent;Le.parent=Re,Re=Le,Le=Fe}for(;null!=Re;){var je=Re.parent;Re.parent=Le,Re=je}Vt=Le}if(Kt.path1==Kt.path1.parent)Wt=Kt.path1;else{for(var Ne=Kt.path1,Ge=null;Ne!=Ne.parent;){var Ue=Ne.parent;Ne.parent=Ge,Ge=Ne,Ne=Ue}for(;null!=Ge;){var Xe=Ge.parent;Ge.parent=Ne,Ge=Xe}Wt=Ne}if(Vt!=Wt&&(Vt.rank<Wt.rank?Vt.parent=Wt:Vt.rank>Wt.rank?Wt.parent=Vt:(Wt.parent=Vt).rank++),Yt.path1==Yt.path1.parent)Ht=Yt.path1;else{for(var Ve=Yt.path1,We=null;Ve!=Ve.parent;){var He=Ve.parent;Ve.parent=We,We=Ve,Ve=He}for(;null!=We;){var qe=We.parent;We.parent=Ve,We=qe}Ht=Ve}if(Kt.path0==Kt.path0.parent)qt=Kt.path0;else{for(var Ye=Kt.path0,Ke=null;Ye!=Ye.parent;){var Ze=Ye.parent;Ye.parent=Ke,Ke=Ye,Ye=Ze}for(;null!=Ke;){var Je=Ke.parent;Ke.parent=Ye,Ke=Je}qt=Ye}Ht!=qt&&(Ht.rank<qt.rank?Ht.parent=qt:Ht.rank>qt.rank?qt.parent=Ht:(qt.parent=Ht).rank++)}Yt.end=Yt.start=null,Yt.path0=Yt.path1=null,Yt.next=yi.zpp_pool,yi.zpp_pool=Yt,Kt.end=Kt.start=null,Kt.path0=Kt.path1=null,Kt.next=yi.zpp_pool,yi.zpp_pool=Kt}for(var Qe=null==s?new di:s,$e=fi.paths.head;null!=$e;){var ti,ei=$e.elt;if(ei==ei.parent)ti=ei;else{for(var ii=ei,ni=null;ii!=ii.parent;){var ri=ii.parent;ii.parent=ni,ni=ii,ii=ri}for(;null!=ni;){var si=ni.parent;ni.parent=ii,ni=si}ti=ii}if(ti.used)$e=$e.next;else{ti.used=!0;for(var oi=ti.vert,ai=!0;null!=ti.vert&&(ai||oi!=ti.vert);)var li,ai=!1,oi=oi.x==oi.next.x&&oi.y==oi.next.y?(oi==ti.vert&&(ti.vert=oi.next==oi?null:oi.next,ai=!0),null!=oi&&oi.prev==oi?oi.next=oi.prev=null:(li=oi.next,oi.prev.next=oi.next,oi.next.prev=oi.prev,oi.next=oi.prev=null,oi=null,li)):oi.next;null!=ti.vert&&((ei=ci.get()).zpp_inner.vertices=ti.vert,Qe.zpp_inner.reverse_flag?Qe.push(ei):Qe.unshift(ei)),$e=$e.next}}for(;null!=fi.paths.head;){var pi=fi.paths.pop_unsafe();pi.vert=null,pi.parent=null,pi.next=_i.zpp_pool,_i.zpp_pool=pi}for(;null!=y;)var hi,ui,y=null!=y&&y.prev==y?(y.next=y.prev=null,(ui=y).vert=null,ui.parent=null,ui.next=_i.zpp_pool,_i.zpp_pool=ui,null):(hi=y.next,y.prev.next=y.next,y.next.prev=y.prev,y.next=y.prev=null,(ui=y).vert=null,ui.parent=null,ui.next=_i.zpp_pool,_i.zpp_pool=ui,y=null,hi);return Qe},fi.prototype.__class__=fi;var _e=zpp_nape.geom.ZPP_Geom=function(){};_e.__name__=["zpp_nape","geom","ZPP_Geom"],_e.validateShape=function(t){if(1==t.type){var e=t.polygon;if(e.zip_gaxi&&null!=e.body){e.zip_gaxi=!1,e.validate_laxi();var i=e.body;if(i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot)),e.zip_gverts&&null!=e.body){e.zip_gverts=!1,e.validate_lverts();var n=e.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var r=e.lverts.next,s=e.gverts.next;null!=s;){var o=s,a=r,r=r.next;o.x=e.body.posx+(e.body.axisy*a.x-e.body.axisx*a.y),o.y=e.body.posy+(a.x*e.body.axisx+a.y*e.body.axisy),s=s.next}}for(var l=e.edges.head,p=h=e.gverts.next,h=h.next;null!=h;){var u=h,c=l.elt,l=l.next;c.gp0=p,c.gp1=u,c.gnormx=e.body.axisy*c.lnormx-e.body.axisx*c.lnormy,c.gnormy=c.lnormx*e.body.axisx+c.lnormy*e.body.axisy,c.gprojection=e.body.posx*c.gnormx+e.body.posy*c.gnormy+c.lprojection,null!=c.wrap_gnorm&&(c.wrap_gnorm.zpp_inner.x=c.gnormx,c.wrap_gnorm.zpp_inner.y=c.gnormy),c.tp0=c.gp0.y*c.gnormx-c.gp0.x*c.gnormy,c.tp1=c.gp1.y*c.gnormx-c.gp1.x*c.gnormy,p=u,h=h.next}i=l.elt;i.gp0=p,i.gp1=e.gverts.next,i.gnormx=e.body.axisy*i.lnormx-e.body.axisx*i.lnormy,i.gnormy=i.lnormx*e.body.axisx+i.lnormy*e.body.axisy,i.gprojection=e.body.posx*i.gnormx+e.body.posy*i.gnormy+i.lprojection,null!=i.wrap_gnorm&&(i.wrap_gnorm.zpp_inner.x=i.gnormx,i.wrap_gnorm.zpp_inner.y=i.gnormy),i.tp0=i.gp0.y*i.gnormx-i.gp0.x*i.gnormy,i.tp1=i.gp1.y*i.gnormx-i.gp1.x*i.gnormy}}if(t.zip_aabb&&null!=t.body)if(t.zip_aabb=!1,0==t.type){n=t.circle;if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var d=n.polygon;if(null==d.lverts.next.next)d.localCOMx=d.lverts.next.x,d.localCOMy=d.lverts.next.y;else if(null==d.lverts.next.next.next)d.localCOMx=d.lverts.next.x,d.localCOMy=d.lverts.next.y,d.localCOMx+=d.lverts.next.next.x,d.localCOMy+=d.lverts.next.next.y,d.localCOMx*=.5,d.localCOMy*=.5;else{d.localCOMx=0;var _=d.localCOMy=0,y=d.lverts.next,f=y,m=y=y.next;for(y=y.next;null!=y;){var x=y;_+=m.x*(x.y-f.y);var v=x.y*m.x-x.x*m.y;d.localCOMx+=(m.x+x.x)*v,d.localCOMy+=(m.y+x.y)*v,f=m,m=x,y=y.next}i=y=d.lverts.next;_+=m.x*(i.y-f.y);var g=i.y*m.x-i.x*m.y;d.localCOMx+=(m.x+i.x)*g,d.localCOMy+=(m.y+i.y)*g,f=m;var b=y=y.next;_+=i.x*(b.y-f.y);g=b.y*i.x-b.x*i.y;d.localCOMx+=(i.x+b.x)*g,d.localCOMy+=(i.y+b.y)*g;b=_=1/(3*_);d.localCOMx*=b,d.localCOMy*=b}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}g=n.body;g.zip_axis&&(g.zip_axis=!1,g.axisx=Math.sin(g.rot),g.axisy=Math.cos(g.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}b=n.radius,g=n.radius;n.aabb.minx=n.worldCOMx-b,n.aabb.miny=n.worldCOMy-g,n.aabb.maxx=n.worldCOMx+b,n.aabb.maxy=n.worldCOMy+g}else{var z=t.polygon;if(z.zip_gverts&&null!=z.body){z.zip_gverts=!1,z.validate_lverts();var w=z.body;w.zip_axis&&(w.zip_axis=!1,w.axisx=Math.sin(w.rot),w.axisy=Math.cos(w.rot));for(var C=z.lverts.next,P=z.gverts.next;null!=P;){var T=P,S=C,C=C.next;T.x=z.body.posx+(z.body.axisy*S.x-z.body.axisx*S.y),T.y=z.body.posy+(S.x*z.body.axisx+S.y*z.body.axisy),P=P.next}}var M=z.gverts.next;z.aabb.minx=M.x,z.aabb.miny=M.y,z.aabb.maxx=M.x,z.aabb.maxy=M.y;for(var A=z.gverts.next.next;null!=A;){var O=A;O.x<z.aabb.minx&&(z.aabb.minx=O.x),O.x>z.aabb.maxx&&(z.aabb.maxx=O.x),O.y<z.aabb.miny&&(z.aabb.miny=O.y),O.y>z.aabb.maxy&&(z.aabb.maxy=O.y),A=A.next}}if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,1==t.type){var k=t.polygon;if(null==k.lverts.next.next)k.localCOMx=k.lverts.next.x,k.localCOMy=k.lverts.next.y;else if(null==k.lverts.next.next.next)k.localCOMx=k.lverts.next.x,k.localCOMy=k.lverts.next.y,k.localCOMx+=k.lverts.next.next.x,k.localCOMy+=k.lverts.next.next.y,k.localCOMx*=.5,k.localCOMy*=.5;else{k.localCOMx=0;var E=k.localCOMy=0,I=k.lverts.next,D=I,B=I=I.next;for(I=I.next;null!=I;){var L=I;E+=B.x*(L.y-D.y);var R=L.y*B.x-L.x*B.y;k.localCOMx+=(B.x+L.x)*R,k.localCOMy+=(B.y+L.y)*R,D=B,B=L,I=I.next}w=I=k.lverts.next;E+=B.x*(w.y-D.y);var F=w.y*B.x-w.x*B.y;k.localCOMx+=(B.x+w.x)*F,k.localCOMy+=(B.y+w.y)*F,D=B;M=I=I.next;E+=w.x*(M.y-D.y);F=M.y*w.x-M.x*w.y;k.localCOMx+=(w.x+M.x)*F,k.localCOMy+=(w.y+M.y)*F;F=E=1/(3*E);k.localCOMx*=F,k.localCOMy*=F}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}F=t.body;F.zip_axis&&(F.zip_axis=!1,F.axisx=Math.sin(F.rot),F.axisy=Math.cos(F.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}},_e.prototype.__class__=_e;var nn=zpp_nape.geom.ZPP_GeomVert=function(){this.forced=!1,this.wrap=null,this.next=null,this.prev=null,this.y=0,this.x=0};nn.__name__=["zpp_nape","geom","ZPP_GeomVert"],nn.get=function(t,e){var i;return null==nn.zpp_pool?i=new nn:(i=nn.zpp_pool,nn.zpp_pool=i.next,i.next=null),i.forced=!1,i.x=t,i.y=e,i},nn.prototype.x=null,nn.prototype.y=null,nn.prototype.prev=null,nn.prototype.next=null,nn.prototype.wrap=null,nn.prototype.forced=null,nn.prototype.free=function(){var t,e;null!=this.wrap&&(this.wrap.zpp_inner._inuse=!1,e=(t=this.wrap).zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ir.zpp_pool,Ir.zpp_pool=e,this.wrap=null),this.prev=this.next=null},nn.prototype.alloc=function(){this.forced=!1},nn.prototype.wrapper=function(){var t,e,i,n;return null==this.wrap&&(t=this.x,n=this.y,null==Rn.poolVec2?e=new Ct:(e=Rn.poolVec2,Rn.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==Ir.zpp_pool?i=new Ir:(i=Ir.zpp_pool,Ir.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=t,i.y=n,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.x==t&&(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.y==n)||(e.zpp_inner.x=t,e.zpp_inner.y=n,null!=(n=e.zpp_inner)._invalidate&&n._invalidate(n))),e.zpp_inner.weak=!1,this.wrap=e,this.wrap.zpp_inner._inuse=!0,this.wrap.zpp_inner._invalidate=Z(this,this.modwrap),this.wrap.zpp_inner._validate=Z(this,this.getwrap)),this.wrap},nn.prototype.modwrap=function(t){this.x=t.x,this.y=t.y},nn.prototype.getwrap=function(){this.wrap.zpp_inner.x=this.x,this.wrap.zpp_inner.y=this.y},nn.prototype.__class__=nn;var ye=zpp_nape.geom.ZPP_GeomPoly=function(t){this.vertices=null,this.outer=null,this.outer=t};ye.__name__=["zpp_nape","geom","ZPP_GeomPoly"],ye.prototype.outer=null,ye.prototype.vertices=null,ye.prototype.__class__=ye;var fe=zpp_nape.geom.ZPP_GeomVertexIterator=function(){this.next=null,this.outer=null,this.forward=!1,this.first=!1,this.start=null,this.ptr=null,this.outer=new U};fe.__name__=["zpp_nape","geom","ZPP_GeomVertexIterator"],fe.get=function(t,e){var i;return null==fe.zpp_pool?i=new fe:(i=fe.zpp_pool,fe.zpp_pool=i.next,i.next=null),(i.outer.zpp_inner=i).ptr=t,i.forward=e,i.start=t,i.first=null!=t,i.outer},fe.prototype.ptr=null,fe.prototype.start=null,fe.prototype.first=null,fe.prototype.forward=null,fe.prototype.outer=null,fe.prototype.next=null,fe.prototype.free=function(){this.outer.zpp_inner=null,this.ptr=this.start=null},fe.prototype.alloc=function(){},fe.prototype.__class__=fe;var me=zpp_nape.geom.ZPP_MarchSpan=function(){this.next=null,this.out=!1,this.rank=0,this.parent=null,this.parent=this};me.__name__=["zpp_nape","geom","ZPP_MarchSpan"],me.prototype.parent=null,me.prototype.rank=null,me.prototype.out=null,me.prototype.next=null,me.prototype.free=function(){this.parent=this},me.prototype.alloc=function(){this.out=!1,this.rank=0},me.prototype.__class__=me;var rn=zpp_nape.geom.ZPP_MarchPair=function(){this.next=null,this.spanr=null,this.span2=null,this.span1=null,this.pd=null,this.okeyr=0,this.keyr=0,this.pr=null,this.okey2=0,this.key2=0,this.p2=null,this.okey1=0,this.key1=0,this.p1=null};rn.__name__=["zpp_nape","geom","ZPP_MarchPair"],rn.prototype.p1=null,rn.prototype.key1=null,rn.prototype.okey1=null,rn.prototype.p2=null,rn.prototype.key2=null,rn.prototype.okey2=null,rn.prototype.pr=null,rn.prototype.keyr=null,rn.prototype.okeyr=null,rn.prototype.pd=null,rn.prototype.span1=null,rn.prototype.span2=null,rn.prototype.spanr=null,rn.prototype.next=null,rn.prototype.free=function(){this.p1=this.p2=this.pr=this.pd=null,this.span1=this.span2=this.spanr=null},rn.prototype.alloc=function(){},rn.prototype.__class__=rn;var sn=zpp_nape.geom.ZPP_MarchingSquares=function(){};sn.__name__=["zpp_nape","geom","ZPP_MarchingSquares"],sn.isos=null,sn.ints=null,sn.map=null,sn.run=function(t,e,i,n,r,s,o,a,l){var p=n-e,h=s.zpp_inner;null!=h._validate&&h._validate();var u=p/s.zpp_inner.x,c=0|u,h=r-i,p=s.zpp_inner;null!=p._validate&&p._validate();var h=h/s.zpp_inner.y,d=0|h;u!=c&&++c,h!=d&&++d,a&&(null==sn.map?sn.map=new ai(c,d):sn.map.resize(c,d,null)),null==sn.isos?sn.isos=new si(c+1,d+1):sn.isos.resize(c+1,d+1,0);for(var _=0,y=d+1;_<y;){var f,m,x=_++;m=0==x?i:x<=d?(null!=(f=s.zpp_inner)._validate&&f._validate(),i+s.zpp_inner.y*x):r;for(var v=0,g=c+1;v<g;){var b=v++;w=0==b?e:b<=c?(null!=(z=s.zpp_inner)._validate&&z._validate(),e+s.zpp_inner.x*b):n;var z=sn.isos,w=t(w,m);z.list[x*z.width+b]=w}}null==sn.ints?sn.ints=new oi(c+1,1+(d<<1)):sn.ints.resize(c+1,1+(d<<1),null);var C=null;a&&(null==me.zpp_pool?C=new me:(C=me.zpp_pool,me.zpp_pool=C.next,C.next=null),C.out=!1,C.rank=0);for(var P=i,T=0,S=d;T<S;)for(var M,A=T++,O=P,k=A==d-1?r:(null!=(M=s.zpp_inner)._validate&&M._validate(),i+s.zpp_inner.y*(1+A)),P=k,E=e,I=null,D=0,B=c;D<B;){var L,R,F=D++,j=E,N=F==c-1?n:(null!=(N=s.zpp_inner)._validate&&N._validate(),e+s.zpp_inner.x*(1+F)),E=N,j=sn.me.marchSquare(t,sn.isos,sn.ints,j,O,N,k,F,A,0==F||!a,0==A||!a,F==c-1||!a,A==d-1||!a,o);null!=j?a?(N=null!=j.p2&&14!=j.okey2?j.p2:j.p1,j.pd=(0==(128&(N==j.p2?j.okey2:j.okey1))?N:N.prev).prev,(N=sn.map).list[A*N.width+F]=j,null!=I&&(N=0!=(1&(F=1&(N=j.key1)|(192&N)>>5))?1:0,0!=(2&F)&&++N,0!=(4&F)&&++N,2<=N)?(sn.me.combLR(I,j),j.span1=I.spanr):(null==me.zpp_pool?j.span1=new me:(j.span1=me.zpp_pool,me.zpp_pool=j.span1.next,j.span1.next=null),(L=j.span1).out=!1,L.rank=0,j.span1.next=C,C=j.span1),null!=j.p2?(null==me.zpp_pool?j.span2=new me:(j.span2=me.zpp_pool,me.zpp_pool=j.span2.next,j.span2.next=null),(R=j.span2).out=!1,R.rank=0,j.span2.next=C,C=j.span2,j.spanr=j.span2):j.spanr=j.span1,R=0!=(1&(L=(28&j.keyr)>>2))?1:0,0!=(2&L)&&++R,0!=(4&L)&&++R,I=2<=R?j:null):(sn.me.output(l,j.p1),null!=j.p2&&sn.me.output(l,j.p2),j.p1=j.p2=j.pr=j.pd=null,j.span1=j.span2=j.spanr=null,j.next=rn.zpp_pool,rn.zpp_pool=j):I=null}if(a){for(var G=1,U=d;G<U;)for(var X=G++,V=null,W=0,H=c;W<H;){var q=W++,Y=sn.map,K=Y.list[X*Y.width+q];if(null!=K){var Z=7&(null!=K.p2&&14==K.okey2?K.okey2:K.okey1),Y=0!=(1&Z)?1:0;if(0!=(2&Z)&&++Y,0!=(4&Z)&&++Y,Y<2)V=null;else{Z=sn.map,Y=Z.list[(X-1)*Z.width+q];if(null!=Y){Z=(112&(null!=Y.p2&&56==Y.okey2?Y.okey2:Y.okey1))>>4,q=0!=(1&Z)?1:0;if(0!=(2&Z)&&++q,0!=(4&Z)&&++q,q<2)V=null;else{var J,Q,$,tt,Z=null!=Y.p2&&56==Y.okey2?Y.span2:Y.span1,q=null!=K.p2&&14==K.okey2?K.span2:K.span1;if(Z==Z.parent)J=Z;else{for(var et=Z,it=null;et!=et.parent;){var nt=et.parent;et.parent=it,it=et,et=nt}for(;null!=it;){var rt=it.parent;it.parent=et,it=rt}J=et}if(q==q.parent)Q=q;else{for(var st=q,ot=null;st!=st.parent;){var at=st.parent;st.parent=ot,ot=st,st=at}for(;null!=ot;){var lt=ot.parent;ot.parent=st,ot=lt}Q=st}if(J==Q)V!=q&&sn.me.combUD_virtual(Y,K);else{if(Z==Z.parent)$=Z;else{for(var pt=Z,ht=null;pt!=pt.parent;){var ut=pt.parent;pt.parent=ht,ht=pt,pt=ut}for(;null!=ht;){var ct=ht.parent;ht.parent=pt,ht=ct}$=pt}if(q==q.parent)tt=q;else{for(var dt=q,_t=null;dt!=dt.parent;){var yt=dt.parent;dt.parent=_t,_t=dt,dt=yt}for(;null!=_t;){var ft=_t.parent;_t.parent=dt,_t=ft}tt=dt}$!=tt&&($.rank<tt.rank?$.parent=tt:$.rank>tt.rank?tt.parent=$:(tt.parent=$).rank++),sn.me.combUD(Y,K)}V=0!=(4&(q==K.span2?K.okey2:K.okey1))?q:null}}else V=null}}else V=null}for(var mt=0,xt=d;mt<xt;)for(var vt=mt++,gt=0,bt=c;gt<bt;){var zt,wt=gt++,Ct=sn.map,Ct=Ct.list[vt*Ct.width+wt];if(null!=Ct){if(Ct.span1==Ct.span1.parent)zt=Ct.span1;else{for(var Pt=Ct.span1,Tt=null;Pt!=Pt.parent;){var St=Pt.parent;Pt.parent=Tt,Tt=Pt,Pt=St}for(;null!=Tt;){var Mt=Tt.parent;Tt.parent=Pt,Tt=Mt}zt=Pt}if(zt.out||(zt.out=!0,sn.me.output(l,Ct.p1)),null!=Ct.p2){if(Ct.span2==Ct.span2.parent)zt=Ct.span2;else{for(var At=Ct.span2,Ot=null;At!=At.parent;){var kt=At.parent;At.parent=Ot,Ot=At,At=kt}for(;null!=Ot;){var Et=Ot.parent;Ot.parent=At,Ot=Et}zt=At}zt.out||(zt.out=!0,sn.me.output(l,Ct.p2))}Ct.p1=Ct.p2=Ct.pr=Ct.pd=null,Ct.span1=Ct.span2=Ct.spanr=null,Ct.next=rn.zpp_pool,rn.zpp_pool=Ct;Ct=sn.map;Ct.list[vt*Ct.width+wt]=null}}for(;null!=C;){var It=C,C=It.next;(It.parent=It).next=me.zpp_pool,me.zpp_pool=It}}},sn.ISO=function(t,e,i){return t(e,i)},sn.prototype.output=function(t,e){var i;if(null==e||e.next==e||e.next==e.prev)a=!0;else{var n=0,r=e;if(null!=e)for(var s=e;;)if(n+=s.x*(s.next.y-s.prev.y),(s=s.next)==r)break;var o=.5*n,a=o*o<kr.epsilon*kr.epsilon}if(a)for(;null!=e;)e=null!=e&&e.prev==e?e.next=e.prev=null:(i=e.next,e.prev.next=e.next,e.next.prev=e.prev,e.next=e.prev=null,e=null,i);else{a=ci.get();a.zpp_inner.vertices=e,t.zpp_inner.reverse_flag?t.push(a):t.unshift(a)}},sn.prototype.linkright=function(t,e){e&=7;return 0==e?t:(3==e?t.next:t).next},sn.prototype.linkleft=function(t,e){return 0==(1&e)?t.prev:t},sn.prototype.linkdown=function(t,e){return(0==(128&e)?t:t.prev).prev},sn.prototype.linkup=function(t,e){return t},sn.prototype.combLR=function(t,e){var i=t.pr,n=7&t.okeyr,r=0==n?i:(3==n?i.next:i).next,s=e.p1,o=0==(1&e.okey1)?s.prev:s,a=r.next,n=o.prev;0!=(4&t.keyr)?(e.pr==e.p1&&(e.pr=r.prev),e.p1=r.prev,r.prev.next=o.next,o.next.prev=r.prev,null!=(p=r).wrap&&(p.wrap.zpp_inner._inuse=!1,s=(i=p.wrap).zpp_inner,i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Rn.poolVec2,Rn.poolVec2=i,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s,p.wrap=null),p.prev=p.next=null,p.next=nn.zpp_pool,nn.zpp_pool=p):(r.next=o.next,o.next.prev=r);var l,p=o;null!=p.wrap&&(p.wrap.zpp_inner._inuse=!1,o=(r=p.wrap).zpp_inner,r.zpp_inner.outer=null,r.zpp_inner=null,r.zpp_pool=Rn.poolVec2,Rn.poolVec2=r,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ir.zpp_pool,Ir.zpp_pool=o,p.wrap=null),p.prev=p.next=null,p.next=nn.zpp_pool,nn.zpp_pool=p,0!=(16&t.keyr)?(e.pd=a.next,a.next.prev=n.prev,n.prev.next=a.next,null!=a.wrap&&(a.wrap.zpp_inner._inuse=!1,l=(e=a.wrap).zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Rn.poolVec2,Rn.poolVec2=e,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ir.zpp_pool,Ir.zpp_pool=l,a.wrap=null),a.prev=a.next=null,a.next=nn.zpp_pool,nn.zpp_pool=a):(a.prev=n.prev,n.prev.next=a),null!=n.wrap&&(n.wrap.zpp_inner._inuse=!1,a=(l=n.wrap).zpp_inner,l.zpp_inner.outer=null,l.zpp_inner=null,l.zpp_pool=Rn.poolVec2,Rn.poolVec2=l,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ir.zpp_pool,Ir.zpp_pool=a,n.wrap=null),n.prev=n.next=null,n.next=nn.zpp_pool,nn.zpp_pool=n},sn.prototype.combUD=function(t,e){null!=t.p2&&t.key2;var i=null!=e.p2&&14==e.key2?e.p2:e.p1,n=t.pd,r=i,s=n.prev,e=r.next;r.next=n.next,n.next.prev=r,null!=n.wrap&&(n.wrap.zpp_inner._inuse=!1,r=(i=n.wrap).zpp_inner,i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Rn.poolVec2,Rn.poolVec2=i,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Ir.zpp_pool,Ir.zpp_pool=r,n.wrap=null),n.prev=n.next=null,n.next=nn.zpp_pool,nn.zpp_pool=n,e.prev=s.prev,s.prev.next=e,s==t.p1&&(t.p1=e),null!=s.wrap&&(s.wrap.zpp_inner._inuse=!1,e=(t=s.wrap).zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Rn.poolVec2,Rn.poolVec2=t,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ir.zpp_pool,Ir.zpp_pool=e,s.wrap=null),s.prev=s.next=null,s.next=nn.zpp_pool,nn.zpp_pool=s},sn.prototype.combUD_virtual=function(t,e){null!=t.p2&&t.key2;e=null!=e.p2&&14==e.key2?e.p2:e.p1,t=t.pd;t.forced=e.forced=t.prev.forced=e.next.forced=!0},sn.prototype.combLeft=function(t){var e=1&t|(192&t)>>5,t=0!=(1&e)?1:0;return 0!=(2&e)&&++t,0!=(4&e)&&++t,2<=t},sn.prototype.combRight=function(t){var e=(28&t)>>2,t=0!=(1&e)?1:0;return 0!=(2&e)&&++t,0!=(4&e)&&++t,2<=t},sn.prototype.combUp=function(t){var e=7&t,t=0!=(1&e)?1:0;return 0!=(2&e)&&++t,0!=(4&e)&&++t,2<=t},sn.prototype.combDown=function(t){var e=(112&t)>>4,t=0!=(1&e)?1:0;return 0!=(2&e)&&++t,0!=(4&e)&&++t,2<=t},sn.prototype.comb=function(t){var e=0!=(1&t)?1:0;return 0!=(2&t)&&++e,0!=(4&t)&&++e,2<=e},sn.prototype.marchSquare=function(t,e,i,n,r,s,o,a,l,p,h,u,c,d){var _=0,y=e.list[l*e.width+a];y<0&&(_=8);var f=e.list[l*e.width+(a+1)];f<0&&(_|=4);var m=e.list[(l+1)*e.width+(a+1)];m<0&&(_|=2);var x,v=e.list[(l+1)*e.width+a];if(v<0&&(_|=1),0==_)return null;if(null==rn.zpp_pool?x=new rn:(x=rn.zpp_pool,rn.zpp_pool=x.next,x.next=null),10!=_&&5!=_){var g=sn.look_march[_];x.okey1=g;for(var b=0;b<8;){var z,w,C,P,T,S,M,A,O,k,E,I,D,B,L,R,F,j,N,G=b++;0!=(g&1<<G)&&(N=null,0==G?(null==nn.zpp_pool?z=new nn:(z=nn.zpp_pool,nn.zpp_pool=z.next,z.next=null),z.forced=!1,z.x=n,z.y=r,N=z,(p||h)&&(N.forced=!0)):2==G?(null==nn.zpp_pool?w=new nn:(w=nn.zpp_pool,nn.zpp_pool=w.next,w.next=null),w.forced=!1,w.x=s,w.y=r,N=w,(u||h)&&(N.forced=!0)):4==G?(null==nn.zpp_pool?C=new nn:(C=nn.zpp_pool,nn.zpp_pool=C.next,C.next=null),C.forced=!1,C.x=s,C.y=o,N=C,(u||c)&&(N.forced=!0)):6==G?(null==nn.zpp_pool?P=new nn:(P=nn.zpp_pool,nn.zpp_pool=P.next,P.next=null),P.forced=!1,P.x=n,P.y=o,N=P,(p||c)&&(N.forced=!0)):1==G?(null==(N=i.list[(l<<1)*i.width+a])?(S=this.xlerp(n,s,r,y,f,t,d),null==nn.zpp_pool?T=new nn:(T=nn.zpp_pool,nn.zpp_pool=T.next,T.next=null),T.forced=!1,T.x=S,T.y=r,N=T,i.list[(l<<1)*i.width+a]=N):(S=N.x,O=N.y,null==nn.zpp_pool?M=new nn:(M=nn.zpp_pool,nn.zpp_pool=M.next,M.next=null),M.forced=!1,M.x=S,M.y=O,N=M),h&&(N.forced=!0),N.x!=n&&N.x!=s||(N.x==n&&0!=(1&g)||N.x==s&&0!=(4&g))&&(g^=2)):5==G?(null==(N=i.list[(2+(l<<1))*i.width+a])?(k=this.xlerp(n,s,o,v,m,t,d),null==nn.zpp_pool?A=new nn:(A=nn.zpp_pool,nn.zpp_pool=A.next,A.next=null),A.forced=!1,A.x=k,A.y=o,N=A,i.list[(2+(l<<1))*i.width+a]=N):(O=N.x,k=N.y,null==nn.zpp_pool?E=new nn:(E=nn.zpp_pool,nn.zpp_pool=E.next,E.next=null),E.forced=!1,E.x=O,E.y=k,N=E),c&&(N.forced=!0),N.x!=n&&N.x!=s||(N.x==n&&0!=(64&g)||N.x==s&&0!=(16&g))&&(g^=32)):3==G?(null==(N=i.list[(1+(l<<1))*i.width+(a+1)])?(D=this.ylerp(r,o,s,f,m,t,d),null==nn.zpp_pool?I=new nn:(I=nn.zpp_pool,nn.zpp_pool=I.next,I.next=null),I.forced=!1,I.x=s,I.y=D,N=I,i.list[(1+(l<<1))*i.width+(a+1)]=N):(D=N.x,R=N.y,null==nn.zpp_pool?B=new nn:(B=nn.zpp_pool,nn.zpp_pool=B.next,B.next=null),B.forced=!1,B.x=D,B.y=R,N=B),u&&(N.forced=!0),N.y!=r&&N.y!=o||(N.y==r&&0!=(4&g)||N.y==o&&0!=(16&g))&&(g^=8)):(null==(N=i.list[(1+(l<<1))*i.width+a])?(F=this.ylerp(r,o,n,y,v,t,d),null==nn.zpp_pool?L=new nn:(L=nn.zpp_pool,nn.zpp_pool=L.next,L.next=null),L.forced=!1,L.x=n,L.y=F,N=L,i.list[(1+(l<<1))*i.width+a]=N):(R=N.x,F=N.y,null==nn.zpp_pool?j=new nn:(j=nn.zpp_pool,nn.zpp_pool=j.next,j.next=null),j.forced=!1,j.x=R,j.y=F,N=j),p&&(N.forced=!0),N.y!=r&&N.y!=o||(N.y==r&&0!=(1&g)||N.y==o&&0!=(64&g))&&(g^=128)),N=N,null==x.p1?x.p1=N.prev=N.next=N:(N.prev=x.p1,N.next=x.p1.next,x.p1.next.prev=N,x.p1.next=N),x.p1=N)}x.p1=x.p1.next,1!=(x.key1=g)&&4!=g&&16!=g&&64!=g&&3!=g&&12!=g&&48!=g&&192!=g&&129!=g&&6!=g&&24!=g&&96!=g&&5!=g&&20!=g&&80!=g&&65!=g&&17!=g&&68!=g||(g=0,x.key1=0,x.p1=null),0==g?x=null:(x.pr=x.p1,x.okeyr=x.okey1,x.keyr=x.key1)}else{e=t(.5*(n+s),.5*(r+o))<0;if(10==_)if(e){var U=187;x.okey1=187;for(var X=0;X<8;){var V,W,H,q,Y,K,Z,J,Q,$,tt,et,it,nt,rt,st,ot,at,lt,pt=X++;0!=(U&1<<pt)&&(lt=null,0==pt?(null==nn.zpp_pool?V=new nn:(V=nn.zpp_pool,nn.zpp_pool=V.next,V.next=null),V.forced=!1,V.x=n,V.y=r,lt=V,(p||h)&&(lt.forced=!0)):2==pt?(null==nn.zpp_pool?W=new nn:(W=nn.zpp_pool,nn.zpp_pool=W.next,W.next=null),W.forced=!1,W.x=s,W.y=r,lt=W,(u||h)&&(lt.forced=!0)):4==pt?(null==nn.zpp_pool?H=new nn:(H=nn.zpp_pool,nn.zpp_pool=H.next,H.next=null),H.forced=!1,H.x=s,H.y=o,lt=H,(u||c)&&(lt.forced=!0)):6==pt?(null==nn.zpp_pool?q=new nn:(q=nn.zpp_pool,nn.zpp_pool=q.next,q.next=null),q.forced=!1,q.x=n,q.y=o,lt=q,(p||c)&&(lt.forced=!0)):1==pt?(null==(lt=i.list[(l<<1)*i.width+a])?(K=this.xlerp(n,s,r,y,f,t,d),null==nn.zpp_pool?Y=new nn:(Y=nn.zpp_pool,nn.zpp_pool=Y.next,Y.next=null),Y.forced=!1,Y.x=K,Y.y=r,lt=Y,i.list[(l<<1)*i.width+a]=lt):(K=lt.x,Q=lt.y,null==nn.zpp_pool?Z=new nn:(Z=nn.zpp_pool,nn.zpp_pool=Z.next,Z.next=null),Z.forced=!1,Z.x=K,Z.y=Q,lt=Z),h&&(lt.forced=!0),lt.x!=n&&lt.x!=s||(lt.x==n&&0!=(1&U)||lt.x==s&&0!=(4&U))&&(U^=2)):5==pt?(null==(lt=i.list[(2+(l<<1))*i.width+a])?($=this.xlerp(n,s,o,v,m,t,d),null==nn.zpp_pool?J=new nn:(J=nn.zpp_pool,nn.zpp_pool=J.next,J.next=null),J.forced=!1,J.x=$,J.y=o,lt=J,i.list[(2+(l<<1))*i.width+a]=lt):(Q=lt.x,$=lt.y,null==nn.zpp_pool?tt=new nn:(tt=nn.zpp_pool,nn.zpp_pool=tt.next,tt.next=null),tt.forced=!1,tt.x=Q,tt.y=$,lt=tt),c&&(lt.forced=!0),lt.x!=n&&lt.x!=s||(lt.x==n&&0!=(64&U)||lt.x==s&&0!=(16&U))&&(U^=32)):3==pt?(null==(lt=i.list[(1+(l<<1))*i.width+(a+1)])?(it=this.ylerp(r,o,s,f,m,t,d),null==nn.zpp_pool?et=new nn:(et=nn.zpp_pool,nn.zpp_pool=et.next,et.next=null),et.forced=!1,et.x=s,et.y=it,lt=et,i.list[(1+(l<<1))*i.width+(a+1)]=lt):(it=lt.x,st=lt.y,null==nn.zpp_pool?nt=new nn:(nt=nn.zpp_pool,nn.zpp_pool=nt.next,nt.next=null),nt.forced=!1,nt.x=it,nt.y=st,lt=nt),u&&(lt.forced=!0),lt.y!=r&&lt.y!=o||(lt.y==r&&0!=(4&U)||lt.y==o&&0!=(16&U))&&(U^=8)):(null==(lt=i.list[(1+(l<<1))*i.width+a])?(ot=this.ylerp(r,o,n,y,v,t,d),null==nn.zpp_pool?rt=new nn:(rt=nn.zpp_pool,nn.zpp_pool=rt.next,rt.next=null),rt.forced=!1,rt.x=n,rt.y=ot,lt=rt,i.list[(1+(l<<1))*i.width+a]=lt):(st=lt.x,ot=lt.y,null==nn.zpp_pool?at=new nn:(at=nn.zpp_pool,nn.zpp_pool=at.next,at.next=null),at.forced=!1,at.x=st,at.y=ot,lt=at),p&&(lt.forced=!0),lt.y!=r&&lt.y!=o||(lt.y==r&&0!=(1&U)||lt.y==o&&0!=(64&U))&&(U^=128)),lt=lt,null==x.p1?x.p1=lt.prev=lt.next=lt:(lt.prev=x.p1,lt.next=x.p1.next,x.p1.next.prev=lt,x.p1.next=lt),x.p1=lt)}x.p1=x.p1.next,1!=(x.key1=U)&&4!=U&&16!=U&&64!=U&&3!=U&&12!=U&&48!=U&&192!=U&&129!=U&&6!=U&&24!=U&&96!=U&&5!=U&&20!=U&&80!=U&&65!=U&&17!=U&&68!=U||(U=0,x.key1=0,x.p1=null),0==U?x=null:(x.pr=x.p1,x.okeyr=x.okey1,x.keyr=x.key1)}else{var ht=131;x.okey1=131;for(var ut=0;ut<8;){var ct,dt,_t,yt,ft,mt,xt,vt,gt,bt,zt,wt,Ct,Pt,Tt,St,Mt,At,Ot,kt=ut++;0!=(ht&1<<kt)&&(Ot=null,0==kt?(null==nn.zpp_pool?ct=new nn:(ct=nn.zpp_pool,nn.zpp_pool=ct.next,ct.next=null),ct.forced=!1,ct.x=n,ct.y=r,Ot=ct,(p||h)&&(Ot.forced=!0)):2==kt?(null==nn.zpp_pool?dt=new nn:(dt=nn.zpp_pool,nn.zpp_pool=dt.next,dt.next=null),dt.forced=!1,dt.x=s,dt.y=r,Ot=dt,(u||h)&&(Ot.forced=!0)):4==kt?(null==nn.zpp_pool?_t=new nn:(_t=nn.zpp_pool,nn.zpp_pool=_t.next,_t.next=null),_t.forced=!1,_t.x=s,_t.y=o,Ot=_t,(u||c)&&(Ot.forced=!0)):6==kt?(null==nn.zpp_pool?yt=new nn:(yt=nn.zpp_pool,nn.zpp_pool=yt.next,yt.next=null),yt.forced=!1,yt.x=n,yt.y=o,Ot=yt,(p||c)&&(Ot.forced=!0)):1==kt?(null==(Ot=i.list[(l<<1)*i.width+a])?(mt=this.xlerp(n,s,r,y,f,t,d),null==nn.zpp_pool?ft=new nn:(ft=nn.zpp_pool,nn.zpp_pool=ft.next,ft.next=null),ft.forced=!1,ft.x=mt,ft.y=r,Ot=ft,i.list[(l<<1)*i.width+a]=Ot):(mt=Ot.x,gt=Ot.y,null==nn.zpp_pool?xt=new nn:(xt=nn.zpp_pool,nn.zpp_pool=xt.next,xt.next=null),xt.forced=!1,xt.x=mt,xt.y=gt,Ot=xt),h&&(Ot.forced=!0),Ot.x!=n&&Ot.x!=s||(Ot.x==n&&0!=(1&ht)||Ot.x==s&&0!=(4&ht))&&(ht^=2)):5==kt?(null==(Ot=i.list[(2+(l<<1))*i.width+a])?(bt=this.xlerp(n,s,o,v,m,t,d),null==nn.zpp_pool?vt=new nn:(vt=nn.zpp_pool,nn.zpp_pool=vt.next,vt.next=null),vt.forced=!1,vt.x=bt,vt.y=o,Ot=vt,i.list[(2+(l<<1))*i.width+a]=Ot):(gt=Ot.x,bt=Ot.y,null==nn.zpp_pool?zt=new nn:(zt=nn.zpp_pool,nn.zpp_pool=zt.next,zt.next=null),zt.forced=!1,zt.x=gt,zt.y=bt,Ot=zt),c&&(Ot.forced=!0),Ot.x!=n&&Ot.x!=s||(Ot.x==n&&0!=(64&ht)||Ot.x==s&&0!=(16&ht))&&(ht^=32)):3==kt?(null==(Ot=i.list[(1+(l<<1))*i.width+(a+1)])?(Ct=this.ylerp(r,o,s,f,m,t,d),null==nn.zpp_pool?wt=new nn:(wt=nn.zpp_pool,nn.zpp_pool=wt.next,wt.next=null),wt.forced=!1,wt.x=s,wt.y=Ct,Ot=wt,i.list[(1+(l<<1))*i.width+(a+1)]=Ot):(Ct=Ot.x,St=Ot.y,null==nn.zpp_pool?Pt=new nn:(Pt=nn.zpp_pool,nn.zpp_pool=Pt.next,Pt.next=null),Pt.forced=!1,Pt.x=Ct,Pt.y=St,Ot=Pt),u&&(Ot.forced=!0),Ot.y!=r&&Ot.y!=o||(Ot.y==r&&0!=(4&ht)||Ot.y==o&&0!=(16&ht))&&(ht^=8)):(null==(Ot=i.list[(1+(l<<1))*i.width+a])?(Mt=this.ylerp(r,o,n,y,v,t,d),null==nn.zpp_pool?Tt=new nn:(Tt=nn.zpp_pool,nn.zpp_pool=Tt.next,Tt.next=null),Tt.forced=!1,Tt.x=n,Tt.y=Mt,Ot=Tt,i.list[(1+(l<<1))*i.width+a]=Ot):(St=Ot.x,Mt=Ot.y,null==nn.zpp_pool?At=new nn:(At=nn.zpp_pool,nn.zpp_pool=At.next,At.next=null),At.forced=!1,At.x=St,At.y=Mt,Ot=At),p&&(Ot.forced=!0),Ot.y!=r&&Ot.y!=o||(Ot.y==r&&0!=(1&ht)||Ot.y==o&&0!=(64&ht))&&(ht^=128)),Ot=Ot,null==x.p1?x.p1=Ot.prev=Ot.next=Ot:(Ot.prev=x.p1,Ot.next=x.p1.next,x.p1.next.prev=Ot,x.p1.next=Ot),x.p1=Ot)}if(x.p1=x.p1.next,1!=(x.key1=ht)&&4!=ht&&16!=ht&&64!=ht&&3!=ht&&12!=ht&&48!=ht&&192!=ht&&129!=ht&&6!=ht&&24!=ht&&96!=ht&&5!=ht&&20!=ht&&80!=ht&&65!=ht&&17!=ht&&68!=ht||(ht=0,x.key1=0,x.p1=null),0!=ht){var Et=56;x.okey2=56;for(var It=0;It<8;){var Dt,Bt,Lt,Rt,Ft,jt,Nt,Gt,Ut,Xt,Vt,Wt,Ht,qt,Yt,Kt,Zt,Jt,Qt,$t=It++;0!=(Et&1<<$t)&&(Qt=null,0==$t?(null==nn.zpp_pool?Dt=new nn:(Dt=nn.zpp_pool,nn.zpp_pool=Dt.next,Dt.next=null),Dt.forced=!1,Dt.x=n,Dt.y=r,Qt=Dt,(p||h)&&(Qt.forced=!0)):2==$t?(null==nn.zpp_pool?Bt=new nn:(Bt=nn.zpp_pool,nn.zpp_pool=Bt.next,Bt.next=null),Bt.forced=!1,Bt.x=s,Bt.y=r,Qt=Bt,(u||h)&&(Qt.forced=!0)):4==$t?(null==nn.zpp_pool?Lt=new nn:(Lt=nn.zpp_pool,nn.zpp_pool=Lt.next,Lt.next=null),Lt.forced=!1,Lt.x=s,Lt.y=o,Qt=Lt,(u||c)&&(Qt.forced=!0)):6==$t?(null==nn.zpp_pool?Rt=new nn:(Rt=nn.zpp_pool,nn.zpp_pool=Rt.next,Rt.next=null),Rt.forced=!1,Rt.x=n,Rt.y=o,Qt=Rt,(p||c)&&(Qt.forced=!0)):1==$t?(null==(Qt=i.list[(l<<1)*i.width+a])?(jt=this.xlerp(n,s,r,y,f,t,d),null==nn.zpp_pool?Ft=new nn:(Ft=nn.zpp_pool,nn.zpp_pool=Ft.next,Ft.next=null),Ft.forced=!1,Ft.x=jt,Ft.y=r,Qt=Ft,i.list[(l<<1)*i.width+a]=Qt):(jt=Qt.x,Ut=Qt.y,null==nn.zpp_pool?Nt=new nn:(Nt=nn.zpp_pool,nn.zpp_pool=Nt.next,Nt.next=null),Nt.forced=!1,Nt.x=jt,Nt.y=Ut,Qt=Nt),h&&(Qt.forced=!0),Qt.x!=n&&Qt.x!=s||(Qt.x==n&&0!=(1&Et)||Qt.x==s&&0!=(4&Et))&&(Et^=2)):5==$t?(null==(Qt=i.list[(2+(l<<1))*i.width+a])?(Xt=this.xlerp(n,s,o,v,m,t,d),null==nn.zpp_pool?Gt=new nn:(Gt=nn.zpp_pool,nn.zpp_pool=Gt.next,Gt.next=null),Gt.forced=!1,Gt.x=Xt,Gt.y=o,Qt=Gt,i.list[(2+(l<<1))*i.width+a]=Qt):(Ut=Qt.x,Xt=Qt.y,null==nn.zpp_pool?Vt=new nn:(Vt=nn.zpp_pool,nn.zpp_pool=Vt.next,Vt.next=null),Vt.forced=!1,Vt.x=Ut,Vt.y=Xt,Qt=Vt),c&&(Qt.forced=!0),Qt.x!=n&&Qt.x!=s||(Qt.x==n&&0!=(64&Et)||Qt.x==s&&0!=(16&Et))&&(Et^=32)):3==$t?(null==(Qt=i.list[(1+(l<<1))*i.width+(a+1)])?(Ht=this.ylerp(r,o,s,f,m,t,d),null==nn.zpp_pool?Wt=new nn:(Wt=nn.zpp_pool,nn.zpp_pool=Wt.next,Wt.next=null),Wt.forced=!1,Wt.x=s,Wt.y=Ht,Qt=Wt,i.list[(1+(l<<1))*i.width+(a+1)]=Qt):(Ht=Qt.x,Kt=Qt.y,null==nn.zpp_pool?qt=new nn:(qt=nn.zpp_pool,nn.zpp_pool=qt.next,qt.next=null),qt.forced=!1,qt.x=Ht,qt.y=Kt,Qt=qt),u&&(Qt.forced=!0),Qt.y!=r&&Qt.y!=o||(Qt.y==r&&0!=(4&Et)||Qt.y==o&&0!=(16&Et))&&(Et^=8)):(null==(Qt=i.list[(1+(l<<1))*i.width+a])?(Zt=this.ylerp(r,o,n,y,v,t,d),null==nn.zpp_pool?Yt=new nn:(Yt=nn.zpp_pool,nn.zpp_pool=Yt.next,Yt.next=null),Yt.forced=!1,Yt.x=n,Yt.y=Zt,Qt=Yt,i.list[(1+(l<<1))*i.width+a]=Qt):(Kt=Qt.x,Zt=Qt.y,null==nn.zpp_pool?Jt=new nn:(Jt=nn.zpp_pool,nn.zpp_pool=Jt.next,Jt.next=null),Jt.forced=!1,Jt.x=Kt,Jt.y=Zt,Qt=Jt),p&&(Qt.forced=!0),Qt.y!=r&&Qt.y!=o||(Qt.y==r&&0!=(1&Et)||Qt.y==o&&0!=(64&Et))&&(Et^=128)),Qt=Qt,null==x.p2?x.p2=Qt.prev=Qt.next=Qt:(Qt.prev=x.p2,Qt.next=x.p2.next,x.p2.next.prev=Qt,x.p2.next=Qt),x.p2=Qt)}x.p2=x.p2.next,1!=(x.key2=Et)&&4!=Et&&16!=Et&&64!=Et&&3!=Et&&12!=Et&&48!=Et&&192!=Et&&129!=Et&&6!=Et&&24!=Et&&96!=Et&&5!=Et&&20!=Et&&80!=Et&&65!=Et&&17!=Et&&68!=Et||(Et=0,x.key2=0,x.p2=null),0==Et?(x.pr=x.p1,x.okeyr=x.okey1,x.keyr=x.key1):(x.pr=x.p2,x.okeyr=x.okey2,x.keyr=x.key2)}else{var te=56;x.okey1=56;for(var ee=0;ee<8;){var ie,ne,re,se,oe,ae,le,pe,he,ue,ce,de,_e,ye,fe,me,xe,ve,ge,be=ee++;0!=(te&1<<be)&&(ge=null,0==be?(null==nn.zpp_pool?ie=new nn:(ie=nn.zpp_pool,nn.zpp_pool=ie.next,ie.next=null),ie.forced=!1,ie.x=n,ie.y=r,ge=ie,(p||h)&&(ge.forced=!0)):2==be?(null==nn.zpp_pool?ne=new nn:(ne=nn.zpp_pool,nn.zpp_pool=ne.next,ne.next=null),ne.forced=!1,ne.x=s,ne.y=r,ge=ne,(u||h)&&(ge.forced=!0)):4==be?(null==nn.zpp_pool?re=new nn:(re=nn.zpp_pool,nn.zpp_pool=re.next,re.next=null),re.forced=!1,re.x=s,re.y=o,ge=re,(u||c)&&(ge.forced=!0)):6==be?(null==nn.zpp_pool?se=new nn:(se=nn.zpp_pool,nn.zpp_pool=se.next,se.next=null),se.forced=!1,se.x=n,se.y=o,ge=se,(p||c)&&(ge.forced=!0)):1==be?(null==(ge=i.list[(l<<1)*i.width+a])?(ae=this.xlerp(n,s,r,y,f,t,d),null==nn.zpp_pool?oe=new nn:(oe=nn.zpp_pool,nn.zpp_pool=oe.next,oe.next=null),oe.forced=!1,oe.x=ae,oe.y=r,ge=oe,i.list[(l<<1)*i.width+a]=ge):(ae=ge.x,he=ge.y,null==nn.zpp_pool?le=new nn:(le=nn.zpp_pool,nn.zpp_pool=le.next,le.next=null),le.forced=!1,le.x=ae,le.y=he,ge=le),h&&(ge.forced=!0),ge.x!=n&&ge.x!=s||(ge.x==n&&0!=(1&te)||ge.x==s&&0!=(4&te))&&(te^=2)):5==be?(null==(ge=i.list[(2+(l<<1))*i.width+a])?(ue=this.xlerp(n,s,o,v,m,t,d),null==nn.zpp_pool?pe=new nn:(pe=nn.zpp_pool,nn.zpp_pool=pe.next,pe.next=null),pe.forced=!1,pe.x=ue,pe.y=o,ge=pe,i.list[(2+(l<<1))*i.width+a]=ge):(he=ge.x,ue=ge.y,null==nn.zpp_pool?ce=new nn:(ce=nn.zpp_pool,nn.zpp_pool=ce.next,ce.next=null),ce.forced=!1,ce.x=he,ce.y=ue,ge=ce),c&&(ge.forced=!0),ge.x!=n&&ge.x!=s||(ge.x==n&&0!=(64&te)||ge.x==s&&0!=(16&te))&&(te^=32)):3==be?(null==(ge=i.list[(1+(l<<1))*i.width+(a+1)])?(_e=this.ylerp(r,o,s,f,m,t,d),null==nn.zpp_pool?de=new nn:(de=nn.zpp_pool,nn.zpp_pool=de.next,de.next=null),de.forced=!1,de.x=s,de.y=_e,ge=de,i.list[(1+(l<<1))*i.width+(a+1)]=ge):(_e=ge.x,me=ge.y,null==nn.zpp_pool?ye=new nn:(ye=nn.zpp_pool,nn.zpp_pool=ye.next,ye.next=null),ye.forced=!1,ye.x=_e,ye.y=me,ge=ye),u&&(ge.forced=!0),ge.y!=r&&ge.y!=o||(ge.y==r&&0!=(4&te)||ge.y==o&&0!=(16&te))&&(te^=8)):(null==(ge=i.list[(1+(l<<1))*i.width+a])?(xe=this.ylerp(r,o,n,y,v,t,d),null==nn.zpp_pool?fe=new nn:(fe=nn.zpp_pool,nn.zpp_pool=fe.next,fe.next=null),fe.forced=!1,fe.x=n,fe.y=xe,ge=fe,i.list[(1+(l<<1))*i.width+a]=ge):(me=ge.x,xe=ge.y,null==nn.zpp_pool?ve=new nn:(ve=nn.zpp_pool,nn.zpp_pool=ve.next,ve.next=null),ve.forced=!1,ve.x=me,ve.y=xe,ge=ve),p&&(ge.forced=!0),ge.y!=r&&ge.y!=o||(ge.y==r&&0!=(1&te)||ge.y==o&&0!=(64&te))&&(te^=128)),ge=ge,null==x.p1?x.p1=ge.prev=ge.next=ge:(ge.prev=x.p1,ge.next=x.p1.next,x.p1.next.prev=ge,x.p1.next=ge),x.p1=ge)}x.p1=x.p1.next,1!=(x.key1=te)&&4!=te&&16!=te&&64!=te&&3!=te&&12!=te&&48!=te&&192!=te&&129!=te&&6!=te&&24!=te&&96!=te&&5!=te&&20!=te&&80!=te&&65!=te&&17!=te&&68!=te||(te=0,x.key1=0,x.p1=null),0==te?x=null:(x.pr=x.p1,x.okeyr=x.okey1,x.keyr=x.key1)}}else if(e){var ze=238;x.okey1=238;for(var we=0;we<8;){var Ce,Pe,Te,Se,Me,Ae,Oe,ke,Ee,Ie,De,Be,Le,Re,Fe,je,Ne,Ge,Ue,Xe=we++;0!=(ze&1<<Xe)&&(Ue=null,0==Xe?(null==nn.zpp_pool?Ce=new nn:(Ce=nn.zpp_pool,nn.zpp_pool=Ce.next,Ce.next=null),Ce.forced=!1,Ce.x=n,Ce.y=r,Ue=Ce,(p||h)&&(Ue.forced=!0)):2==Xe?(null==nn.zpp_pool?Pe=new nn:(Pe=nn.zpp_pool,nn.zpp_pool=Pe.next,Pe.next=null),Pe.forced=!1,Pe.x=s,Pe.y=r,Ue=Pe,(u||h)&&(Ue.forced=!0)):4==Xe?(null==nn.zpp_pool?Te=new nn:(Te=nn.zpp_pool,nn.zpp_pool=Te.next,Te.next=null),Te.forced=!1,Te.x=s,Te.y=o,Ue=Te,(u||c)&&(Ue.forced=!0)):6==Xe?(null==nn.zpp_pool?Se=new nn:(Se=nn.zpp_pool,nn.zpp_pool=Se.next,Se.next=null),Se.forced=!1,Se.x=n,Se.y=o,Ue=Se,(p||c)&&(Ue.forced=!0)):1==Xe?(null==(Ue=i.list[(l<<1)*i.width+a])?(Ae=this.xlerp(n,s,r,y,f,t,d),null==nn.zpp_pool?Me=new nn:(Me=nn.zpp_pool,nn.zpp_pool=Me.next,Me.next=null),Me.forced=!1,Me.x=Ae,Me.y=r,Ue=Me,i.list[(l<<1)*i.width+a]=Ue):(Ae=Ue.x,Ee=Ue.y,null==nn.zpp_pool?Oe=new nn:(Oe=nn.zpp_pool,nn.zpp_pool=Oe.next,Oe.next=null),Oe.forced=!1,Oe.x=Ae,Oe.y=Ee,Ue=Oe),h&&(Ue.forced=!0),Ue.x!=n&&Ue.x!=s||(Ue.x==n&&0!=(1&ze)||Ue.x==s&&0!=(4&ze))&&(ze^=2)):5==Xe?(null==(Ue=i.list[(2+(l<<1))*i.width+a])?(Ie=this.xlerp(n,s,o,v,m,t,d),null==nn.zpp_pool?ke=new nn:(ke=nn.zpp_pool,nn.zpp_pool=ke.next,ke.next=null),ke.forced=!1,ke.x=Ie,ke.y=o,Ue=ke,i.list[(2+(l<<1))*i.width+a]=Ue):(Ee=Ue.x,Ie=Ue.y,null==nn.zpp_pool?De=new nn:(De=nn.zpp_pool,nn.zpp_pool=De.next,De.next=null),De.forced=!1,De.x=Ee,De.y=Ie,Ue=De),c&&(Ue.forced=!0),Ue.x!=n&&Ue.x!=s||(Ue.x==n&&0!=(64&ze)||Ue.x==s&&0!=(16&ze))&&(ze^=32)):3==Xe?(null==(Ue=i.list[(1+(l<<1))*i.width+(a+1)])?(Le=this.ylerp(r,o,s,f,m,t,d),null==nn.zpp_pool?Be=new nn:(Be=nn.zpp_pool,nn.zpp_pool=Be.next,Be.next=null),Be.forced=!1,Be.x=s,Be.y=Le,Ue=Be,i.list[(1+(l<<1))*i.width+(a+1)]=Ue):(Le=Ue.x,je=Ue.y,null==nn.zpp_pool?Re=new nn:(Re=nn.zpp_pool,nn.zpp_pool=Re.next,Re.next=null),Re.forced=!1,Re.x=Le,Re.y=je,Ue=Re),u&&(Ue.forced=!0),Ue.y!=r&&Ue.y!=o||(Ue.y==r&&0!=(4&ze)||Ue.y==o&&0!=(16&ze))&&(ze^=8)):(null==(Ue=i.list[(1+(l<<1))*i.width+a])?(Ne=this.ylerp(r,o,n,y,v,t,d),null==nn.zpp_pool?Fe=new nn:(Fe=nn.zpp_pool,nn.zpp_pool=Fe.next,Fe.next=null),Fe.forced=!1,Fe.x=n,Fe.y=Ne,Ue=Fe,i.list[(1+(l<<1))*i.width+a]=Ue):(je=Ue.x,Ne=Ue.y,null==nn.zpp_pool?Ge=new nn:(Ge=nn.zpp_pool,nn.zpp_pool=Ge.next,Ge.next=null),Ge.forced=!1,Ge.x=je,Ge.y=Ne,Ue=Ge),p&&(Ue.forced=!0),Ue.y!=r&&Ue.y!=o||(Ue.y==r&&0!=(1&ze)||Ue.y==o&&0!=(64&ze))&&(ze^=128)),Ue=Ue,null==x.p1?x.p1=Ue.prev=Ue.next=Ue:(Ue.prev=x.p1,Ue.next=x.p1.next,x.p1.next.prev=Ue,x.p1.next=Ue),x.p1=Ue)}x.p1=x.p1.next,1!=(x.key1=ze)&&4!=ze&&16!=ze&&64!=ze&&3!=ze&&12!=ze&&48!=ze&&192!=ze&&129!=ze&&6!=ze&&24!=ze&&96!=ze&&5!=ze&&20!=ze&&80!=ze&&65!=ze&&17!=ze&&68!=ze||(ze=0,x.key1=0,x.p1=null),0==ze?x=null:(x.pr=x.p1,x.okeyr=x.okey1,x.keyr=x.key1)}else{var Ve=224;x.okey1=224;for(var We=0;We<8;){var He,qe,Ye,Ke,Ze,Je,Qe,$e,ti,ei,ii,ni,ri,si,oi,ai,li,pi,hi,ui=We++;0!=(Ve&1<<ui)&&(hi=null,0==ui?(null==nn.zpp_pool?He=new nn:(He=nn.zpp_pool,nn.zpp_pool=He.next,He.next=null),He.forced=!1,He.x=n,He.y=r,hi=He,(p||h)&&(hi.forced=!0)):2==ui?(null==nn.zpp_pool?qe=new nn:(qe=nn.zpp_pool,nn.zpp_pool=qe.next,qe.next=null),qe.forced=!1,qe.x=s,qe.y=r,hi=qe,(u||h)&&(hi.forced=!0)):4==ui?(null==nn.zpp_pool?Ye=new nn:(Ye=nn.zpp_pool,nn.zpp_pool=Ye.next,Ye.next=null),Ye.forced=!1,Ye.x=s,Ye.y=o,hi=Ye,(u||c)&&(hi.forced=!0)):6==ui?(null==nn.zpp_pool?Ke=new nn:(Ke=nn.zpp_pool,nn.zpp_pool=Ke.next,Ke.next=null),Ke.forced=!1,Ke.x=n,Ke.y=o,hi=Ke,(p||c)&&(hi.forced=!0)):1==ui?(null==(hi=i.list[(l<<1)*i.width+a])?(Je=this.xlerp(n,s,r,y,f,t,d),null==nn.zpp_pool?Ze=new nn:(Ze=nn.zpp_pool,nn.zpp_pool=Ze.next,Ze.next=null),Ze.forced=!1,Ze.x=Je,Ze.y=r,hi=Ze,i.list[(l<<1)*i.width+a]=hi):(Je=hi.x,ti=hi.y,null==nn.zpp_pool?Qe=new nn:(Qe=nn.zpp_pool,nn.zpp_pool=Qe.next,Qe.next=null),Qe.forced=!1,Qe.x=Je,Qe.y=ti,hi=Qe),h&&(hi.forced=!0),hi.x!=n&&hi.x!=s||(hi.x==n&&0!=(1&Ve)||hi.x==s&&0!=(4&Ve))&&(Ve^=2)):5==ui?(null==(hi=i.list[(2+(l<<1))*i.width+a])?(ei=this.xlerp(n,s,o,v,m,t,d),null==nn.zpp_pool?$e=new nn:($e=nn.zpp_pool,nn.zpp_pool=$e.next,$e.next=null),$e.forced=!1,$e.x=ei,$e.y=o,hi=$e,i.list[(2+(l<<1))*i.width+a]=hi):(ti=hi.x,ei=hi.y,null==nn.zpp_pool?ii=new nn:(ii=nn.zpp_pool,nn.zpp_pool=ii.next,ii.next=null),ii.forced=!1,ii.x=ti,ii.y=ei,hi=ii),c&&(hi.forced=!0),hi.x!=n&&hi.x!=s||(hi.x==n&&0!=(64&Ve)||hi.x==s&&0!=(16&Ve))&&(Ve^=32)):3==ui?(null==(hi=i.list[(1+(l<<1))*i.width+(a+1)])?(ri=this.ylerp(r,o,s,f,m,t,d),null==nn.zpp_pool?ni=new nn:(ni=nn.zpp_pool,nn.zpp_pool=ni.next,ni.next=null),ni.forced=!1,ni.x=s,ni.y=ri,hi=ni,i.list[(1+(l<<1))*i.width+(a+1)]=hi):(ri=hi.x,ai=hi.y,null==nn.zpp_pool?si=new nn:(si=nn.zpp_pool,nn.zpp_pool=si.next,si.next=null),si.forced=!1,si.x=ri,si.y=ai,hi=si),u&&(hi.forced=!0),hi.y!=r&&hi.y!=o||(hi.y==r&&0!=(4&Ve)||hi.y==o&&0!=(16&Ve))&&(Ve^=8)):(null==(hi=i.list[(1+(l<<1))*i.width+a])?(li=this.ylerp(r,o,n,y,v,t,d),null==nn.zpp_pool?oi=new nn:(oi=nn.zpp_pool,nn.zpp_pool=oi.next,oi.next=null),oi.forced=!1,oi.x=n,oi.y=li,hi=oi,i.list[(1+(l<<1))*i.width+a]=hi):(ai=hi.x,li=hi.y,null==nn.zpp_pool?pi=new nn:(pi=nn.zpp_pool,nn.zpp_pool=pi.next,pi.next=null),pi.forced=!1,pi.x=ai,pi.y=li,hi=pi),p&&(hi.forced=!0),hi.y!=r&&hi.y!=o||(hi.y==r&&0!=(1&Ve)||hi.y==o&&0!=(64&Ve))&&(Ve^=128)),hi=hi,null==x.p1?x.p1=hi.prev=hi.next=hi:(hi.prev=x.p1,hi.next=x.p1.next,x.p1.next.prev=hi,x.p1.next=hi),x.p1=hi)}if(x.p1=x.p1.next,1!=(x.key1=Ve)&&4!=Ve&&16!=Ve&&64!=Ve&&3!=Ve&&12!=Ve&&48!=Ve&&192!=Ve&&129!=Ve&&6!=Ve&&24!=Ve&&96!=Ve&&5!=Ve&&20!=Ve&&80!=Ve&&65!=Ve&&17!=Ve&&68!=Ve||(Ve=0,x.key1=0,x.p1=null),0!=Ve){var ci=14;x.okey2=14;for(var di=0;di<8;){var _i,yi,fi,mi,xi,vi,gi,bi,zi,wi,Ci,Pi,Ti,Si,Mi,Ai,Oi,ki,Ei,Ii=di++;0!=(ci&1<<Ii)&&(Ei=null,0==Ii?(null==nn.zpp_pool?_i=new nn:(_i=nn.zpp_pool,nn.zpp_pool=_i.next,_i.next=null),_i.forced=!1,_i.x=n,_i.y=r,Ei=_i,(p||h)&&(Ei.forced=!0)):2==Ii?(null==nn.zpp_pool?yi=new nn:(yi=nn.zpp_pool,nn.zpp_pool=yi.next,yi.next=null),yi.forced=!1,yi.x=s,yi.y=r,Ei=yi,(u||h)&&(Ei.forced=!0)):4==Ii?(null==nn.zpp_pool?fi=new nn:(fi=nn.zpp_pool,nn.zpp_pool=fi.next,fi.next=null),fi.forced=!1,fi.x=s,fi.y=o,Ei=fi,(u||c)&&(Ei.forced=!0)):6==Ii?(null==nn.zpp_pool?mi=new nn:(mi=nn.zpp_pool,nn.zpp_pool=mi.next,mi.next=null),mi.forced=!1,mi.x=n,mi.y=o,Ei=mi,(p||c)&&(Ei.forced=!0)):1==Ii?(null==(Ei=i.list[(l<<1)*i.width+a])?(vi=this.xlerp(n,s,r,y,f,t,d),null==nn.zpp_pool?xi=new nn:(xi=nn.zpp_pool,nn.zpp_pool=xi.next,xi.next=null),xi.forced=!1,xi.x=vi,xi.y=r,Ei=xi,i.list[(l<<1)*i.width+a]=Ei):(vi=Ei.x,zi=Ei.y,null==nn.zpp_pool?gi=new nn:(gi=nn.zpp_pool,nn.zpp_pool=gi.next,gi.next=null),gi.forced=!1,gi.x=vi,gi.y=zi,Ei=gi),h&&(Ei.forced=!0),Ei.x!=n&&Ei.x!=s||(Ei.x==n&&0!=(1&ci)||Ei.x==s&&0!=(4&ci))&&(ci^=2)):5==Ii?(null==(Ei=i.list[(2+(l<<1))*i.width+a])?(wi=this.xlerp(n,s,o,v,m,t,d),null==nn.zpp_pool?bi=new nn:(bi=nn.zpp_pool,nn.zpp_pool=bi.next,bi.next=null),bi.forced=!1,bi.x=wi,bi.y=o,Ei=bi,i.list[(2+(l<<1))*i.width+a]=Ei):(zi=Ei.x,wi=Ei.y,null==nn.zpp_pool?Ci=new nn:(Ci=nn.zpp_pool,nn.zpp_pool=Ci.next,Ci.next=null),Ci.forced=!1,Ci.x=zi,Ci.y=wi,Ei=Ci),c&&(Ei.forced=!0),Ei.x!=n&&Ei.x!=s||(Ei.x==n&&0!=(64&ci)||Ei.x==s&&0!=(16&ci))&&(ci^=32)):3==Ii?(null==(Ei=i.list[(1+(l<<1))*i.width+(a+1)])?(Ti=this.ylerp(r,o,s,f,m,t,d),null==nn.zpp_pool?Pi=new nn:(Pi=nn.zpp_pool,nn.zpp_pool=Pi.next,Pi.next=null),Pi.forced=!1,Pi.x=s,Pi.y=Ti,Ei=Pi,i.list[(1+(l<<1))*i.width+(a+1)]=Ei):(Ti=Ei.x,Ai=Ei.y,null==nn.zpp_pool?Si=new nn:(Si=nn.zpp_pool,nn.zpp_pool=Si.next,Si.next=null),Si.forced=!1,Si.x=Ti,Si.y=Ai,Ei=Si),u&&(Ei.forced=!0),Ei.y!=r&&Ei.y!=o||(Ei.y==r&&0!=(4&ci)||Ei.y==o&&0!=(16&ci))&&(ci^=8)):(null==(Ei=i.list[(1+(l<<1))*i.width+a])?(Oi=this.ylerp(r,o,n,y,v,t,d),null==nn.zpp_pool?Mi=new nn:(Mi=nn.zpp_pool,nn.zpp_pool=Mi.next,Mi.next=null),Mi.forced=!1,Mi.x=n,Mi.y=Oi,Ei=Mi,i.list[(1+(l<<1))*i.width+a]=Ei):(Ai=Ei.x,Oi=Ei.y,null==nn.zpp_pool?ki=new nn:(ki=nn.zpp_pool,nn.zpp_pool=ki.next,ki.next=null),ki.forced=!1,ki.x=Ai,ki.y=Oi,Ei=ki),p&&(Ei.forced=!0),Ei.y!=r&&Ei.y!=o||(Ei.y==r&&0!=(1&ci)||Ei.y==o&&0!=(64&ci))&&(ci^=128)),Ei=Ei,null==x.p2?x.p2=Ei.prev=Ei.next=Ei:(Ei.prev=x.p2,Ei.next=x.p2.next,x.p2.next.prev=Ei,x.p2.next=Ei),x.p2=Ei)}x.p2=x.p2.next,1!=(x.key2=ci)&&4!=ci&&16!=ci&&64!=ci&&3!=ci&&12!=ci&&48!=ci&&192!=ci&&129!=ci&&6!=ci&&24!=ci&&96!=ci&&5!=ci&&20!=ci&&80!=ci&&65!=ci&&17!=ci&&68!=ci||(ci=0,x.key2=0,x.p2=null),0==ci?(x.pr=x.p1,x.okeyr=x.okey1,x.keyr=x.key1):(x.pr=x.p2,x.okeyr=x.okey2,x.keyr=x.key2)}else{var Di=14;x.okey1=14;for(var Bi=0;Bi<8;){var Li,Ri,Fi,ji,Ni,Gi,Ui,Xi,Vi,Wi,Hi,qi,Yi,Ki,Zi,Ji,Qi,$i,tn,en=Bi++;0!=(Di&1<<en)&&(tn=null,0==en?(null==nn.zpp_pool?Li=new nn:(Li=nn.zpp_pool,nn.zpp_pool=Li.next,Li.next=null),Li.forced=!1,Li.x=n,Li.y=r,tn=Li,(p||h)&&(tn.forced=!0)):2==en?(null==nn.zpp_pool?Ri=new nn:(Ri=nn.zpp_pool,nn.zpp_pool=Ri.next,Ri.next=null),Ri.forced=!1,Ri.x=s,Ri.y=r,tn=Ri,(u||h)&&(tn.forced=!0)):4==en?(null==nn.zpp_pool?Fi=new nn:(Fi=nn.zpp_pool,nn.zpp_pool=Fi.next,Fi.next=null),Fi.forced=!1,Fi.x=s,Fi.y=o,tn=Fi,(u||c)&&(tn.forced=!0)):6==en?(null==nn.zpp_pool?ji=new nn:(ji=nn.zpp_pool,nn.zpp_pool=ji.next,ji.next=null),ji.forced=!1,ji.x=n,ji.y=o,tn=ji,(p||c)&&(tn.forced=!0)):1==en?(null==(tn=i.list[(l<<1)*i.width+a])?(Gi=this.xlerp(n,s,r,y,f,t,d),null==nn.zpp_pool?Ni=new nn:(Ni=nn.zpp_pool,nn.zpp_pool=Ni.next,Ni.next=null),Ni.forced=!1,Ni.x=Gi,Ni.y=r,tn=Ni,i.list[(l<<1)*i.width+a]=tn):(Gi=tn.x,Vi=tn.y,null==nn.zpp_pool?Ui=new nn:(Ui=nn.zpp_pool,nn.zpp_pool=Ui.next,Ui.next=null),Ui.forced=!1,Ui.x=Gi,Ui.y=Vi,tn=Ui),h&&(tn.forced=!0),tn.x!=n&&tn.x!=s||(tn.x==n&&0!=(1&Di)||tn.x==s&&0!=(4&Di))&&(Di^=2)):5==en?(null==(tn=i.list[(2+(l<<1))*i.width+a])?(Wi=this.xlerp(n,s,o,v,m,t,d),null==nn.zpp_pool?Xi=new nn:(Xi=nn.zpp_pool,nn.zpp_pool=Xi.next,Xi.next=null),Xi.forced=!1,Xi.x=Wi,Xi.y=o,tn=Xi,i.list[(2+(l<<1))*i.width+a]=tn):(Vi=tn.x,Wi=tn.y,null==nn.zpp_pool?Hi=new nn:(Hi=nn.zpp_pool,nn.zpp_pool=Hi.next,Hi.next=null),Hi.forced=!1,Hi.x=Vi,Hi.y=Wi,tn=Hi),c&&(tn.forced=!0),tn.x!=n&&tn.x!=s||(tn.x==n&&0!=(64&Di)||tn.x==s&&0!=(16&Di))&&(Di^=32)):3==en?(null==(tn=i.list[(1+(l<<1))*i.width+(a+1)])?(Yi=this.ylerp(r,o,s,f,m,t,d),null==nn.zpp_pool?qi=new nn:(qi=nn.zpp_pool,nn.zpp_pool=qi.next,qi.next=null),qi.forced=!1,qi.x=s,qi.y=Yi,tn=qi,i.list[(1+(l<<1))*i.width+(a+1)]=tn):(Yi=tn.x,Ji=tn.y,null==nn.zpp_pool?Ki=new nn:(Ki=nn.zpp_pool,nn.zpp_pool=Ki.next,Ki.next=null),Ki.forced=!1,Ki.x=Yi,Ki.y=Ji,tn=Ki),u&&(tn.forced=!0),tn.y!=r&&tn.y!=o||(tn.y==r&&0!=(4&Di)||tn.y==o&&0!=(16&Di))&&(Di^=8)):(null==(tn=i.list[(1+(l<<1))*i.width+a])?(Qi=this.ylerp(r,o,n,y,v,t,d),null==nn.zpp_pool?Zi=new nn:(Zi=nn.zpp_pool,nn.zpp_pool=Zi.next,Zi.next=null),Zi.forced=!1,Zi.x=n,Zi.y=Qi,tn=Zi,i.list[(1+(l<<1))*i.width+a]=tn):(Ji=tn.x,Qi=tn.y,null==nn.zpp_pool?$i=new nn:($i=nn.zpp_pool,nn.zpp_pool=$i.next,$i.next=null),$i.forced=!1,$i.x=Ji,$i.y=Qi,tn=$i),p&&(tn.forced=!0),tn.y!=r&&tn.y!=o||(tn.y==r&&0!=(1&Di)||tn.y==o&&0!=(64&Di))&&(Di^=128)),tn=tn,null==x.p1?x.p1=tn.prev=tn.next=tn:(tn.prev=x.p1,tn.next=x.p1.next,x.p1.next.prev=tn,x.p1.next=tn),x.p1=tn)}x.p1=x.p1.next,1!=(x.key1=Di)&&4!=Di&&16!=Di&&64!=Di&&3!=Di&&12!=Di&&48!=Di&&192!=Di&&129!=Di&&6!=Di&&24!=Di&&96!=Di&&5!=Di&&20!=Di&&80!=Di&&65!=Di&&17!=Di&&68!=Di||(Di=0,x.key1=0,x.p1=null),0==Di?x=null:(x.pr=x.p1,x.okeyr=x.okey1,x.keyr=x.key1)}}}return x},sn.prototype.lerp=function(t,e,i,n){if(0==i)return t;if(0==n)return e;n=i-n,n=n*n<kr.epsilon*kr.epsilon?.5:i/n;return n<0?n=0:1<n&&(n=1),t+n*(e-t)},sn.prototype.xlerp=function(t,e,i,n,r,s,o){var a,l;for(l=0==n?t:0==r?e:((a=(a=n-r)*a<kr.epsilon*kr.epsilon?.5:n/a)<0?a=0:1<a&&(a=1),t+a*(e-t));0!=o--&&t<l&&l<e;){var p=s(l,i);if(0==p)break;n*p<0?(e=l,r=p):(t=l,n=p),l=0==n?t:0==r?e:((p=(p=n-r)*p<kr.epsilon*kr.epsilon?.5:n/p)<0?p=0:1<p&&(p=1),t+p*(e-t))}return l},sn.prototype.ylerp=function(t,e,i,n,r,s,o){var a,l;for(l=0==n?t:0==r?e:((a=(a=n-r)*a<kr.epsilon*kr.epsilon?.5:n/a)<0?a=0:1<a&&(a=1),t+a*(e-t));0!=o--&&t<l&&l<e;){var p=s(i,l);if(0==p)break;n*p<0?(e=l,r=p):(t=l,n=p),l=0==n?t:0==r?e:((p=(p=n-r)*p<kr.epsilon*kr.epsilon?.5:n/p)<0?p=0:1<p&&(p=1),t+p*(e-t))}return l},sn.prototype.__class__=sn;var xe=zpp_nape.geom.ZPP_Mat23=function(){this.next=null,this._invalidate=null,this.ty=0,this.tx=0,this.d=0,this.c=0,this.b=0,this.a=0,this.outer=null};xe.__name__=["zpp_nape","geom","ZPP_Mat23"],xe.get=function(){var t;return null==xe.zpp_pool?t=new xe:(t=xe.zpp_pool,xe.zpp_pool=t.next,t.next=null),t},xe.identity=function(){var t=xe.get();return t.setas(1,0,0,1,0,0),t},xe.prototype.outer=null,xe.prototype.wrapper=function(){var t;return null==this.outer&&(this.outer=new X,(t=this.outer.zpp_inner).next=xe.zpp_pool,xe.zpp_pool=t,this.outer.zpp_inner=this),this.outer},xe.prototype.a=null,xe.prototype.b=null,xe.prototype.c=null,xe.prototype.d=null,xe.prototype.tx=null,xe.prototype.ty=null,xe.prototype._invalidate=null,xe.prototype.invalidate=function(){null!=this._invalidate&&this._invalidate()},xe.prototype.set=function(t){this.setas(t.a,t.b,t.c,t.d,t.tx,t.ty)},xe.prototype.setas=function(t,e,i,n,r,s){this.tx=r,this.ty=s,this.a=t,this.b=e,this.c=i,this.d=n},xe.prototype.next=null,xe.prototype.free=function(){},xe.prototype.alloc=function(){},xe.prototype.__class__=xe;var ve=zpp_nape.geom.ZPP_MatMN=function(t,e){this.x=null,this.n=0,this.m=0,this.outer=null,this.m=t,this.n=e,this.x=[];for(var i=0,n=t*e;i<n;)++i,this.x.push(0)};ve.__name__=["zpp_nape","geom","ZPP_MatMN"],ve.prototype.outer=null,ve.prototype.m=null,ve.prototype.n=null,ve.prototype.x=null,ve.prototype.__class__=ve;var ge=zpp_nape.geom.ZPP_Monotone=function(){};ge.__name__=["zpp_nape","geom","ZPP_Monotone"],ge.bisector=function(t){var e=t.prev,i=t.next,n=t.x-e.x,r=t.y-e.y,s=i.x-t.x,e=i.y-t.y;null==Ir.zpp_pool?o=new Ir:(o=Ir.zpp_pool,Ir.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=-r-e,o.y=n+s;var t=o,o=1/Math.sqrt(t.x*t.x+t.y*t.y);return t.x*=o,t.y*=o,e*n-s*r<0&&(t.x=-t.x,t.y=-t.y),t},ge.below=function(t,e){if(t.y<e.y)return!0;if(t.y>e.y)return!1;if(t.x<e.x)return!0;if(t.x>e.x)return!1;var i=ge.bisector(t),n=ge.bisector(e);i.x+=t.x,i.y+=t.y,n.x+=e.x,n.y+=e.y;e=i.x<n.x||i.x==n.x&&i.y<n.y;return null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ir.zpp_pool,Ir.zpp_pool=i,null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Ir.zpp_pool,Ir.zpp_pool=n,e},ge.above=function(t,e){return ge.below(e,t)},ge.left_vertex=function(t){var e=t.prev;return e.y>t.y||e.y==t.y&&t.next.y<t.y},ge.isMonotone=function(t){var e=t,i=t,n=t.next;if(null!=n)for(var r=n;;)if(r.y<e.y&&(e=r),r.y>i.y&&(i=r),(r=r.next)==t)break;var s=!0,o=e;if(i!=e.next){var a=e.next,l=i;if(null!=a)for(var p=a;;){var h=p;if(h.y<o.y){s=!1;break}if(o=h,(p=p.next)==l)break}}if(!s)return!1;if(i!=(o=e).prev){var a=e.prev,u=i;if(null!=a)for(var c=a;;){var d=c;if(d.y<o.y){s=!1;break}if(o=d,(c=c.prev)==u)break}}return s},ge.sharedPPoly=null,ge.getShared=function(){return null==ge.sharedPPoly&&(ge.sharedPPoly=new ze),ge.sharedPPoly},ge.decompose=function(t,e){if(null==e?e=new ze(t):e.init(t),null==e.vertices)return e;null==ge.queue&&(ge.queue=new wi);var t=e.vertices,i=e.vertices;if(null!=t)for(var n=t;;){var r=n;ge.queue.add(r);var s=r.next.x-r.x,o=r.next.y-r.y,a=r.prev.x-r.x,o=0<(r.prev.y-r.y)*s-a*o;if(r.type=ge.below(r.prev,r)?ge.below(r.next,r)?o?0:3:4:ge.below(r,r.next)?o?1:2:4,(n=n.next)==i)break}t=ge.queue;if(null!=t.head&&null!=t.head.next){for(var l,p,h,u=t.head,c=null,d=null,_=null,y=null,f=1;;){for(l=0,d=u,c=u=null;null!=d;){for(++l,_=d,p=0,h=f;null!=_&&p<f;)++p,_=_.next;for(;0<p||0<h&&null!=_;)0!=p&&(0==h||null==_||ge.above(d.elt,_.elt))?(d=(y=d).next,--p):(_=(y=_).next,--h),null!=c?c.next=y:u=y,c=y;d=_}if(c.next=null,f<<=1,!(1<l))break}t.head=u,t.modified=!0,t.pushmod=!0}for(null==ge.edges&&(null==Nn.zpp_pool?ge.edges=new Nn:(ge.edges=Nn.zpp_pool,Nn.zpp_pool=ge.edges.next,ge.edges.next=null),ge.edges.lt=be.edge_lt,ge.edges.swapped=be.edge_swap);null!=ge.queue.head;){var m=ge.queue.pop_unsafe();switch(m.type){case 0:(m.helper=m).node=ge.edges.insert(m);break;case 1:var x=m.prev;2==x.helper.type&&e.add_diagonal(m,x.helper),ge.edges.remove_node(x.node);break;case 2:x=m.prev;2==x.helper.type&&e.add_diagonal(m,x.helper),ge.edges.remove_node(x.node);var v=null;if(!ge.edges.empty()){for(var g=ge.edges.parent;null!=g.prev;)g=g.prev;for(;null!=g;){var b=g.data;if(!be.vert_lt(b,m)){v=b;break}if(null!=g.next)for(g=g.next;null!=g.prev;)g=g.prev;else{for(;null!=g.parent&&g==g.parent.next;)g=g.parent;g=g.parent}}}x=v;null!=x&&(2==x.helper.type&&e.add_diagonal(m,x.helper),x.helper=m);break;case 3:var z=null;if(!ge.edges.empty()){for(var w=ge.edges.parent;null!=w.prev;)w=w.prev;for(;null!=w;){var C=w.data;if(!be.vert_lt(C,m)){z=C;break}if(null!=w.next)for(w=w.next;null!=w.prev;)w=w.prev;else{for(;null!=w.parent&&w==w.parent.next;)w=w.parent;w=w.parent}}}var P=z;null!=P&&(e.add_diagonal(m,P.helper),P.helper=m),m.node=ge.edges.insert(m),m.helper=m;break;case 4:P=m.prev;if(ge.left_vertex(m))2==P.helper.type&&e.add_diagonal(m,P.helper),ge.edges.remove_node(P.node),m.node=ge.edges.insert(m),m.helper=m;else{var T=null;if(!ge.edges.empty()){for(var S=ge.edges.parent;null!=S.prev;)S=S.prev;for(;null!=S;){var M=S.data;if(!be.vert_lt(M,m)){T=M;break}if(null!=S.next)for(S=S.next;null!=S.prev;)S=S.prev;else{for(;null!=S.parent&&S==S.parent.next;)S=S.parent;S=S.parent}}}P=T;2==P.helper.type&&e.add_diagonal(m,P.helper),P.helper=m}}}return e},ge.prototype.__class__=ge;var be=zpp_nape.geom.ZPP_PartitionVertex=function(){this.node=null,this.prev=null,this.next=null,this.rightchain=!1,this.helper=null,this.type=0,this.diagonals=null,this.forced=!1,this.y=0,this.x=0,this.mag=0,this.id=0,this.id=be.nextId++,this.diagonals=new wi};be.__name__=["zpp_nape","geom","ZPP_PartitionVertex"],be.get=function(t){var e;return null==be.zpp_pool?e=new be:(e=be.zpp_pool,be.zpp_pool=e.next,e.next=null),e.x=t.x,e.y=t.y,e},be.rightdistance=function(t,e){var i=t.next.y>t.y,n=t.next.x-t.x,r=t.next.y-t.y,s=e.x-t.x;return(i?-1:1)*((e.y-t.y)*n-s*r)},be.vert_lt=function(t,e){if(e==t||e==t.next)return!0;if(t.y!=t.next.y)return be.rightdistance(t,e)<=0;var i=t.x,t=t.next.x;return(i<t?i:t)<=e.x},be.edge_swap=function(t,e){var i=t.node;t.node=e.node,e.node=i},be.edge_lt=function(t,e){if(t==e&&t.next==e.next)return!1;if(t==e.next)return!be.vert_lt(t,e);if(e==t.next)return be.vert_lt(e,t);if(t.y==t.next.y){if(e.y!=e.next.y)return 0<be.rightdistance(e,t)||0<be.rightdistance(e,t.next);var i=t.x,n=t.next.x,r=n<i?i:n,s=e.x,o=e.next.x;return(o<s?s:o)<r}i=be.rightdistance(t,e),n=be.rightdistance(t,e.next);if(0==i&&0==n){s=t.x,o=t.next.x,r=o<s?s:o,s=e.x,o=e.next.x;return(o<s?s:o)<r}if(0<=i*n)return i<0||n<0;n=be.rightdistance(e,t),t=be.rightdistance(e,t.next);return 0<=n*t&&(0<n||0<t)},be.prototype.id=null,be.prototype.mag=null,be.prototype.x=null,be.prototype.y=null,be.prototype.forced=null,be.prototype.diagonals=null,be.prototype.type=null,be.prototype.helper=null,be.prototype.rightchain=null,be.prototype.next=null,be.prototype.prev=null,be.prototype.alloc=function(){},be.prototype.free=function(){this.helper=null},be.prototype.copy=function(){var t;return null==be.zpp_pool?t=new be:(t=be.zpp_pool,be.zpp_pool=t.next,t.next=null),t.x=this.x,t.y=this.y,t.forced=this.forced,t},be.prototype.sort=function(){var t=0,e=0,i=0;t=this.prev.x-this.x,e=this.prev.y-this.y,i=this.next.x-this.x;var n=(this.next.y-this.y)*t-i*e,r=0<n?-1:0==n?0:1,n=this.diagonals;if(null!=n.head&&null!=n.head.next){for(var s,o,a,l,p,h,u=n.head,c=null,d=null,_=null,y=null,f=1;;){for(s=0,d=u,c=u=null;null!=d;){for(++s,_=d,o=0,a=f;null!=_&&o<f;)++o,_=_.next;for(;0<o||0<a&&null!=_;)0!=o&&(0==a||null==_||(1==r?(t=d.elt.x-this.x,e=d.elt.y-this.y,i=_.elt.x-this.x,1==(0<(l=(_.elt.y-this.y)*t-i*e)?-1:0==l?0:1)):(t=this.prev.x-this.x,e=this.prev.y-this.y,i=d.elt.x-this.x,p=0<(h=(d.elt.y-this.y)*t-i*e)?-1:0==h?0:1,t=this.prev.x-this.x,e=this.prev.y-this.y,i=_.elt.x-this.x,p*(h=0<(l=(_.elt.y-this.y)*t-i*e)?-1:0==l?0:1)==1||p*h==0&&(1==p||1==h)?(t=d.elt.x-this.x,e=d.elt.y-this.y,i=_.elt.x-this.x,1==(0<(l=(_.elt.y-this.y)*t-i*e)?-1:0==l?0:1)):-1==p||-1==h?-1==h:0!=p||0!=h||(t=this.x-this.prev.x,e=this.y-this.prev.y,p=t*(i=d.elt.x-this.x)+e*(d.elt.y-this.y),h=t*(i=_.elt.x-this.x)+e*(_.elt.y-this.y),p<0&&0<h||!(h<0&&0<p)))))?(d=(y=d).next,--o):(_=(y=_).next,--a),null!=c?c.next=y:u=y,c=y;d=_}if(c.next=null,f<<=1,!(1<s))break}n.head=u,n.modified=!0,n.pushmod=!0}},be.prototype.node=null,be.prototype.__class__=be;var ze=zpp_nape.geom.ZPP_PartitionedPoly=function(t){this.next=null,this.vertices=null,this.init(t)};ze.__name__=["zpp_nape","geom","ZPP_PartitionedPoly"],ze.sharedPPList=null,ze.getSharedPP=function(){return null==ze.sharedPPList&&(ze.sharedPPList=new Pi),ze.sharedPPList},ze.sharedGVList=null,ze.getShared=function(){return null==ze.sharedGVList&&(ze.sharedGVList=new Ti),ze.sharedGVList},ze.prototype.vertices=null,ze.prototype.eq=function(t,e){var i=t.x,n=t.y,r=0,t=0;return(r=i-e.x)*r+(t=n-e.y)*t<kr.epsilon*kr.epsilon},ze.prototype.next=null,ze.prototype.alloc=function(){},ze.prototype.free=function(){},ze.prototype.init=function(t){if(null!=t){var e=0;if(null!=t)for(var i=t;;)if(e+=i.x*(i.next.y-i.prev.y),(i=i.next)==t)break;for(var n=0<.5*e,r=t;;){var s,o,a,l=n?(null==be.zpp_pool?s=new be:(s=be.zpp_pool,be.zpp_pool=s.next,s.next=null),s.x=r.x,s.y=r.y,o=s,null==this.vertices?this.vertices=o.prev=o.next=o:(o.prev=this.vertices,o.next=this.vertices.next,this.vertices.next.prev=o,this.vertices.next=o),o):(null==be.zpp_pool?a=new be:(a=be.zpp_pool,be.zpp_pool=a.next,a.next=null),a.x=r.x,a.y=r.y,l=a,null==this.vertices?this.vertices=l.prev=l.next=l:(l.next=this.vertices,l.prev=this.vertices.prev,this.vertices.prev.next=l,this.vertices.prev=l),l);if(this.vertices=l,this.vertices.forced=r.forced,(r=r.next)==t)break}this.remove_collinear_vertices()}},ze.prototype.remove_collinear_vertices=function(){for(var t,e=this.vertices,i=!0;i||e!=this.vertices;){var n,r,i=!1;if(this.eq(e,e.next)){if(e==this.vertices&&(this.vertices=e.next,i=!0),e.forced&&(e.next.forced=!0),null==(e=null!=e&&e.prev==e?(e.next=e.prev=null,(r=e).helper=null,r.next=be.zpp_pool,be.zpp_pool=r,null):(n=e.next,e.prev.next=e.next,e.next.prev=e.prev,e.next=e.prev=null,(r=e).helper=null,r.next=be.zpp_pool,be.zpp_pool=r,e=null,n))){this.vertices=null;break}}else e=e.next}if(null==this.vertices)return!0;for(;;){for(t=!1,e=this.vertices,i=!0;i||e!=this.vertices;){i=!1;var s,o=e.prev,a=0,l=e.x-o.x,a=e.y-o.y,o=e.next.x-e.x,a=(e.next.y-e.y)*l-o*a;if(a*a>=kr.epsilon*kr.epsilon)e=e.next;else if(e==this.vertices&&(this.vertices=e.next,i=!0),t=!0,null==(e=null!=e&&e.prev==e?(e.next=e.prev=null,(s=e).helper=null,s.next=be.zpp_pool,be.zpp_pool=s,null):(a=e.next,e.prev.next=e.next,e.next.prev=e.prev,e.next=e.prev=null,(s=e).helper=null,s.next=be.zpp_pool,be.zpp_pool=s,e=null,a))){t=!1,this.vertices=null;break}}if(!t)break}return null==this.vertices},ze.prototype.add_diagonal=function(t,e){t.diagonals.add(e),e.diagonals.add(t),t.forced=e.forced=!0},ze.prototype.extract_partitions=function(t){if(null==t&&(t=new Pi),null!=this.vertices){var e=this.vertices,i=this.vertices;if(null!=e)for(var n=e;n.sort(),(n=n.next)!=i;);for(this.pull_partitions(this.vertices,t);null!=this.vertices;){var r,s=null!=this.vertices&&this.vertices.prev==this.vertices?(this.vertices.next=this.vertices.prev=null,(r=this.vertices).helper=null,r.next=be.zpp_pool,be.zpp_pool=r,this.vertices=null):(s=this.vertices.next,this.vertices.prev.next=this.vertices.next,this.vertices.next.prev=this.vertices.prev,this.vertices.next=this.vertices.prev=null,(r=this.vertices).helper=null,r.next=be.zpp_pool,be.zpp_pool=r,this.vertices=null,s);this.vertices=s}for(var o=null,a=t.head;null!=a;)a.elt.remove_collinear_vertices()?t.erase(o):a=(o=a).next}return t},ze.prototype.pull_partitions=function(t,e){var i;null==ze.zpp_pool?i=new ze:(i=ze.zpp_pool,ze.zpp_pool=i.next,i.next=null);for(var n,r=t;;){null==be.zpp_pool?n=new be:(n=be.zpp_pool,be.zpp_pool=n.next,n.next=null),n.x=r.x,n.y=r.y,n.forced=r.forced;var s=n;if(null==i.vertices?i.vertices=s.prev=s.next=s:(s.prev=i.vertices,s.next=i.vertices.next,i.vertices.next.prev=s,i.vertices.next=s),i.vertices=s,i.vertices.forced=r.forced,null!=r.diagonals.head){var o=r.diagonals,s=o.head.elt;if(o.pop(),s==t)break;r=this.pull_partitions(r,e)}else r=r.next;if(r==t)break}var a=0,l=i.vertices,p=i.vertices;if(null!=l)for(var h=l;;)if(a+=h.x*(h.next.y-h.prev.y),(h=h.next)==p)break;return.5*a!=0&&e.add(i),r},ze.prototype.extract=function(t){if(null==t&&(t=new Ti),null!=this.vertices){var e=this.vertices,i=this.vertices;if(null!=e)for(var n=e;n.sort(),(n=n.next)!=i;);for(this.pull(this.vertices,t);null!=this.vertices;){var r,s=null!=this.vertices&&this.vertices.prev==this.vertices?(this.vertices.next=this.vertices.prev=null,(r=this.vertices).helper=null,r.next=be.zpp_pool,be.zpp_pool=r,this.vertices=null):(s=this.vertices.next,this.vertices.prev.next=this.vertices.next,this.vertices.next.prev=this.vertices.prev,this.vertices.next=this.vertices.prev=null,(r=this.vertices).helper=null,r.next=be.zpp_pool,be.zpp_pool=r,this.vertices=null,s);this.vertices=s}}return t},ze.prototype.pull=function(t,e){for(var i=null,n=t;;){var r,s=n.x,o=n.y;null==nn.zpp_pool?r=new nn:(r=nn.zpp_pool,nn.zpp_pool=r.next,r.next=null),r.forced=!1,r.x=s,r.y=o;s=r;if(null==i?i=s.prev=s.next=s:(s.prev=i,s.next=i.next,i.next.prev=s,i.next=s),(i=s).forced=n.forced,null!=n.diagonals.head){o=n.diagonals,s=o.head.elt;if(o.pop(),s==t)break;n=this.pull(n,e)}else n=n.next;if(n==t)break}var a=0,l=i;if(null!=i)for(var p=i;;)if(a+=p.x*(p.next.y-p.prev.y),(p=p.next)==l)break;var h=.5*a;if(h*h>=kr.epsilon*kr.epsilon){for(var u,c=i,d=!0;d||c!=i;){d=!1;var _=c.x,y=c.y,f=0,m=_-c.next.x,f=y-c.next.y;if(m*m+f*f<kr.epsilon*kr.epsilon){if(c==i&&(i=c.next,d=!0),c.forced&&(c.next.forced=!0),null==(c=null!=c&&c.prev==c?c.next=c.prev=null:(f=c.next,c.prev.next=c.next,c.next.prev=c.prev,c.next=c.prev=null,c=null,f))){i=null;break}}else c=c.next}if(null!=i)for(;;){for(c=i,d=!(u=!1);d||c!=i;){d=!1;var x=c.prev,v=0,g=c.x-x.x,v=c.y-x.y,x=c.next.x-c.x,v=(c.next.y-c.y)*g-x*v;if(v*v>=kr.epsilon*kr.epsilon)c=c.next;else if(c==i&&(i=c.next,d=!0),u=!0,null==(c=null!=c&&c.prev==c?c.next=c.prev=null:(v=c.next,c.prev.next=c.next,c.next.prev=c.prev,c.next=c.prev=null,c=null,v))){u=!1,i=null;break}}if(!u)break}null!=i&&e.add(i)}return n},ze.prototype.__class__=ze;var we=zpp_nape.geom.ZPP_Ray=function(){var t,e,i,n,r,s;this.zip_dir=!1,this.absnormaly=0,this.absnormalx=0,this.normaly=0,this.normalx=0,this.idiry=0,this.idirx=0,this.diry=0,this.dirx=0,this.originy=0,this.originx=0,this.userData=null,this.maxdist=0,this.direction=null,(this.origin=null)==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=0,e.y=0,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),0==t.zpp_inner.x&&(null!=(i=t.zpp_inner)._validate&&i._validate(),0==t.zpp_inner.y)||(t.zpp_inner.x=0,t.zpp_inner.y=0,null!=(i=t.zpp_inner)._invalidate&&i._invalidate(i))),t.zpp_inner.weak=!1,this.origin=t,this.origin.zpp_inner._invalidate=Z(this,this.origin_invalidate),null==Rn.poolVec2?n=new Ct:(n=Rn.poolVec2,Rn.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ir.zpp_pool?r=new Ir:(r=Ir.zpp_pool,Ir.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=0,r.y=0,n.zpp_inner=r,n.zpp_inner.outer=n):(null!=(r=n.zpp_inner)._validate&&r._validate(),0==n.zpp_inner.x&&(null!=(s=n.zpp_inner)._validate&&s._validate(),0==n.zpp_inner.y)||(n.zpp_inner.x=0,n.zpp_inner.y=0,null!=(s=n.zpp_inner)._invalidate&&s._invalidate(s))),n.zpp_inner.weak=!1,this.direction=n,this.direction.zpp_inner._invalidate=Z(this,this.direction_invalidate),this.originx=0,this.originy=0,this.dirx=0,this.diry=0,this.zip_dir=!1};we.__name__=["zpp_nape","geom","ZPP_Ray"],we.prototype.origin=null,we.prototype.direction=null,we.prototype.maxdist=null,we.prototype.userData=null,we.prototype.originx=null,we.prototype.originy=null,we.prototype.dirx=null,we.prototype.diry=null,we.prototype.idirx=null,we.prototype.idiry=null,we.prototype.normalx=null,we.prototype.normaly=null,we.prototype.absnormalx=null,we.prototype.absnormaly=null,we.prototype.origin_invalidate=function(t){this.originx=t.x,this.originy=t.y},we.prototype.direction_invalidate=function(t){this.dirx=t.x,this.diry=t.y,this.zip_dir=!0},we.prototype.zip_dir=null,we.prototype.invalidate_dir=function(){this.zip_dir=!0},we.prototype.validate_dir=function(){var t;this.zip_dir&&(this.zip_dir=!1,t=1/Math.sqrt(this.dirx*this.dirx+this.diry*this.diry),this.dirx*=t,this.diry*=t,this.idirx=1/this.dirx,this.idiry=1/this.diry,this.normalx=-this.diry,this.normaly=this.dirx,t=this.normalx,this.absnormalx=t<0?-t:t,t=this.normaly,this.absnormaly=t<0?-t:t)},we.prototype.rayAABB=function(){var t,e,i=this.originx,n=i,r=this.originy,s=r;return this.maxdist>=1/0?(0<this.dirx?n=1/0:this.dirx<0&&(n=-1/0),0<this.diry?s=1/0:this.diry<0&&(s=-1/0)):(n+=this.maxdist*this.dirx,s+=this.maxdist*this.diry),n<i&&(t=i,i=n,n=t),s<r&&(t=r,r=s,s=t),null==Be.zpp_pool?e=new Be:(e=Be.zpp_pool,Be.zpp_pool=e.next,e.next=null),e.minx=i,e.miny=r,e.maxx=n,e.maxy=s,e},we.prototype.aabbtest=function(t){var e=this.normalx*(this.originx-.5*(t.minx+t.maxx))+this.normaly*(this.originy-.5*(t.miny+t.maxy));return(e<0?-e:e)<.5*this.absnormalx*(t.maxx-t.minx)+.5*this.absnormaly*(t.maxy-t.miny)},we.prototype.aabbsect=function(t){var e=this.originx>=t.minx&&this.originx<=t.maxx,i=this.originy>=t.miny&&this.originy<=t.maxy;if(e&&i)return 0;for(var n=-1;!(0<=this.dirx&&this.originx>=t.maxx||this.dirx<=0&&this.originx<=t.minx||0<=this.diry&&this.originy>=t.maxy||this.diry<=0&&this.originy<=t.miny);){if(0<this.dirx){var r=(t.minx-this.originx)*this.idirx;if(0<=r&&r<=this.maxdist){var s=this.originy+r*this.diry;if(s>=t.miny&&s<=t.maxy){n=r;break}}}else if(this.dirx<0){s=(t.maxx-this.originx)*this.idirx;if(0<=s&&s<=this.maxdist){r=this.originy+s*this.diry;if(r>=t.miny&&r<=t.maxy){n=s;break}}}if(0<this.diry){var o=(t.miny-this.originy)*this.idiry;if(0<=o&&o<=this.maxdist){var a=this.originx+o*this.dirx;if(a>=t.minx&&a<=t.maxx){n=o;break}}}else if(this.diry<0){a=(t.maxy-this.originy)*this.idiry;if(0<=a&&a<=this.maxdist){o=this.originx+a*this.dirx;if(o>=t.minx&&o<=t.maxx){n=a;break}}}break}return n},we.prototype.circlesect=function(t,e,i){if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,1==t.type){var n=t.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y,n.localCOMx+=n.lverts.next.next.x,n.localCOMy+=n.lverts.next.next.y,n.localCOMx*=.5,n.localCOMy*=.5;else{n.localCOMx=0;var r=n.localCOMy=0,s=n.lverts.next,o=s,a=s=s.next;for(s=s.next;null!=s;){var l=s;r+=a.x*(l.y-o.y);var p=l.y*a.x-l.x*a.y;n.localCOMx+=(a.x+l.x)*p,n.localCOMy+=(a.y+l.y)*p,o=a,a=l,s=s.next}var h=s=n.lverts.next;r+=a.x*(h.y-o.y);var u=h.y*a.x-h.x*a.y;n.localCOMx+=(a.x+h.x)*u,n.localCOMy+=(a.y+h.y)*u,o=a;var c=s=s.next;r+=h.x*(c.y-o.y);var d=c.y*h.x-c.x*h.y;n.localCOMx+=(h.x+c.x)*d,n.localCOMy+=(h.y+c.y)*d;var _=r=1/(3*r);n.localCOMx*=_,n.localCOMy*=_}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}var y=t.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}var f=0,f=this.originx-t.worldCOMx,u=this.originy-t.worldCOMy,h=this.dirx*this.dirx+this.diry*this.diry,c=2*(f*this.dirx+u*this.diry),d=f*f+u*u-t.radius*t.radius,_=c*c-4*h*d;if(0==_){var m=-c/2*h;if((!e||0<d)&&0<m&&m<i&&m<=this.maxdist){y=0,f=0,y=this.originx,f=this.originy;y+=this.dirx*m,f+=this.diry*m,y-=t.worldCOMx,f-=t.worldCOMy;var x,v,u=1/Math.sqrt(y*y+f*f);return y*=u,f*=u,d<=0&&(y=-y,f=-f),null==Rn.poolVec2?x=new Ct:(x=Rn.poolVec2,Rn.poolVec2=x.zpp_pool,x.zpp_pool=null),null==x.zpp_inner?(null==Ir.zpp_pool?v=new Ir:(v=Ir.zpp_pool,Ir.zpp_pool=v.next,v.next=null),v.weak=!1,v._immutable=!1,v.x=y,v.y=f,x.zpp_inner=v,x.zpp_inner.outer=x):(null!=(v=x.zpp_inner)._validate&&v._validate(),x.zpp_inner.x==y&&(null!=(v=x.zpp_inner)._validate&&v._validate(),x.zpp_inner.y==f)||(x.zpp_inner.x=y,x.zpp_inner.y=f,null!=(f=x.zpp_inner)._invalidate&&f._invalidate(f))),x.zpp_inner.weak=!1,de.getRay(x,m,d<=0,t.outer)}return null}m=(-c-(_=Math.sqrt(_)))*(h=1/(2*h)),d=(-c+_)*h;if(0<m){if(m<i&&m<=this.maxdist){_=0,c=this.originx,_=this.originy;c+=this.dirx*m,_+=this.diry*m,c-=t.worldCOMx,_-=t.worldCOMy;var g,b,h=1/Math.sqrt(c*c+_*_);return c*=h,_*=h,null==Rn.poolVec2?g=new Ct:(g=Rn.poolVec2,Rn.poolVec2=g.zpp_pool,g.zpp_pool=null),null==g.zpp_inner?(null==Ir.zpp_pool?b=new Ir:(b=Ir.zpp_pool,Ir.zpp_pool=b.next,b.next=null),b.weak=!1,b._immutable=!1,b.x=c,b.y=_,g.zpp_inner=b,g.zpp_inner.outer=g):(null!=(b=g.zpp_inner)._validate&&b._validate(),g.zpp_inner.x==c&&(null!=(b=g.zpp_inner)._validate&&b._validate(),g.zpp_inner.y==_)||(g.zpp_inner.x=c,g.zpp_inner.y=_,null!=(_=g.zpp_inner)._invalidate&&_._invalidate(_))),g.zpp_inner.weak=!1,de.getRay(g,m,!1,t.outer)}return null}if(0<d&&e){if(d<i&&d<=this.maxdist){e=0,m=this.originx,e=this.originy;m+=this.dirx*d,e+=this.diry*d,m-=t.worldCOMx,e-=t.worldCOMy;var z,w,i=1/Math.sqrt(m*m+e*e);return m=-(m*=i),e=-(e*=i),null==Rn.poolVec2?z=new Ct:(z=Rn.poolVec2,Rn.poolVec2=z.zpp_pool,z.zpp_pool=null),null==z.zpp_inner?(null==Ir.zpp_pool?w=new Ir:(w=Ir.zpp_pool,Ir.zpp_pool=w.next,w.next=null),w.weak=!1,w._immutable=!1,w.x=m,w.y=e,z.zpp_inner=w,z.zpp_inner.outer=z):(null!=(w=z.zpp_inner)._validate&&w._validate(),z.zpp_inner.x==m&&(null!=(w=z.zpp_inner)._validate&&w._validate(),z.zpp_inner.y==e)||(z.zpp_inner.x=m,z.zpp_inner.y=e,null!=(e=z.zpp_inner)._invalidate&&e._invalidate(e))),z.zpp_inner.weak=!1,de.getRay(z,d,!0,t.outer)}return null}return null},we.prototype.circlesect2=function(t,e,i){if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,1==t.type){var n=t.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y,n.localCOMx+=n.lverts.next.next.x,n.localCOMy+=n.lverts.next.next.y,n.localCOMx*=.5,n.localCOMy*=.5;else{n.localCOMx=0;var r=n.localCOMy=0,s=n.lverts.next,o=s,a=s=s.next;for(s=s.next;null!=s;){var l=s;r+=a.x*(l.y-o.y);var p=l.y*a.x-l.x*a.y;n.localCOMx+=(a.x+l.x)*p,n.localCOMy+=(a.y+l.y)*p,o=a,a=l,s=s.next}var h=s=n.lverts.next;r+=a.x*(h.y-o.y);var u=h.y*a.x-h.x*a.y;n.localCOMx+=(a.x+h.x)*u,n.localCOMy+=(a.y+h.y)*u,o=a;var c=s=s.next;r+=h.x*(c.y-o.y);var d=c.y*h.x-c.x*h.y;n.localCOMx+=(h.x+c.x)*d,n.localCOMy+=(h.y+c.y)*d;var _=r=1/(3*r);n.localCOMx*=_,n.localCOMy*=_}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}var y=t.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}var f=0,f=this.originx-t.worldCOMx,m=this.originy-t.worldCOMy,u=this.dirx*this.dirx+this.diry*this.diry,h=2*(f*this.dirx+m*this.diry),c=f*f+m*m-t.radius*t.radius,d=h*h-4*u*c;if(0==d){_=-h/2*u;if((!e||0<c)&&0<_&&_<=this.maxdist){y=0,f=0,y=this.originx,f=this.originy;y+=this.dirx*_,f+=this.diry*_,y-=t.worldCOMx,f-=t.worldCOMy;var x,m=1/Math.sqrt(y*y+f*f);y*=m,f*=m,c<=0&&(y=-y,f=-f),null==Rn.poolVec2?z=new Ct:(z=Rn.poolVec2,Rn.poolVec2=z.zpp_pool,z.zpp_pool=null),null==z.zpp_inner?(null==Ir.zpp_pool?x=new Ir:(x=Ir.zpp_pool,Ir.zpp_pool=x.next,x.next=null),x.weak=!1,x._immutable=!1,x.x=y,x.y=f,z.zpp_inner=x,z.zpp_inner.outer=z):(null!=(x=z.zpp_inner)._validate&&x._validate(),z.zpp_inner.x==y&&(null!=(x=z.zpp_inner)._validate&&x._validate(),z.zpp_inner.y==f)||(z.zpp_inner.x=y,z.zpp_inner.y=f,null!=(f=z.zpp_inner)._invalidate&&f._invalidate(f))),z.zpp_inner.weak=!1;for(var v=de.getRay(z,_,c<=0,t.outer),g=null,b=i.zpp_inner.inner.head;null!=b&&!(v.zpp_inner.toiDistance<b.elt.zpp_inner.toiDistance);)b=(g=b).next;var z=i.zpp_inner.inner;null==gn.zpp_pool?w=new gn:(w=gn.zpp_pool,gn.zpp_pool=w.next,w.next=null),w.elt=v;var w=w;null==g?(w.next=z.head,z.head=w):(w.next=g.next,g.next=w),z.pushmod=z.modified=!0,z.length++}}else{w=(-h-(d=Math.sqrt(d)))*(u=1/(2*u)),z=(-h+d)*u;if(0<w&&w<=this.maxdist){d=0,h=this.originx,d=this.originy;h+=this.dirx*w,d+=this.diry*w,h-=t.worldCOMx,d-=t.worldCOMy;var C,u=1/Math.sqrt(h*h+d*d);h*=u,d*=u,null==Rn.poolVec2?M=new Ct:(M=Rn.poolVec2,Rn.poolVec2=M.zpp_pool,M.zpp_pool=null),null==M.zpp_inner?(null==Ir.zpp_pool?C=new Ir:(C=Ir.zpp_pool,Ir.zpp_pool=C.next,C.next=null),C.weak=!1,C._immutable=!1,C.x=h,C.y=d,M.zpp_inner=C,M.zpp_inner.outer=M):(null!=(C=M.zpp_inner)._validate&&C._validate(),M.zpp_inner.x==h&&(null!=(C=M.zpp_inner)._validate&&C._validate(),M.zpp_inner.y==d)||(M.zpp_inner.x=h,M.zpp_inner.y=d,null!=(d=M.zpp_inner)._invalidate&&d._invalidate(d))),M.zpp_inner.weak=!1;for(var P=de.getRay(M,w,!1,t.outer),T=null,S=i.zpp_inner.inner.head;null!=S&&!(P.zpp_inner.toiDistance<S.elt.zpp_inner.toiDistance);)S=(T=S).next;var M=i.zpp_inner.inner;null==gn.zpp_pool?A=new gn:(A=gn.zpp_pool,gn.zpp_pool=A.next,A.next=null),A.elt=P;var A=A;null==T?(A.next=M.head,M.head=A):(A.next=T.next,T.next=A),M.pushmod=M.modified=!0,M.length++}if(0<z&&z<=this.maxdist&&e){A=0,M=0,A=this.originx,M=this.originy;A+=this.dirx*z,M+=this.diry*z,A-=t.worldCOMx,M-=t.worldCOMy;var O,k,e=1/Math.sqrt(A*A+M*M);A=-(A*=e),M=-(M*=e),null==Rn.poolVec2?O=new Ct:(O=Rn.poolVec2,Rn.poolVec2=O.zpp_pool,O.zpp_pool=null),null==O.zpp_inner?(null==Ir.zpp_pool?k=new Ir:(k=Ir.zpp_pool,Ir.zpp_pool=k.next,k.next=null),k.weak=!1,k._immutable=!1,k.x=A,k.y=M,O.zpp_inner=k,O.zpp_inner.outer=O):(null!=(k=O.zpp_inner)._validate&&k._validate(),O.zpp_inner.x==A&&(null!=(k=O.zpp_inner)._validate&&k._validate(),O.zpp_inner.y==M)||(O.zpp_inner.x=A,O.zpp_inner.y=M,null!=(M=O.zpp_inner)._invalidate&&M._invalidate(M))),O.zpp_inner.weak=!1;for(var E=de.getRay(O,z,!0,t.outer),I=null,D=i.zpp_inner.inner.head;null!=D&&!(E.zpp_inner.toiDistance<D.elt.zpp_inner.toiDistance);)D=(I=D).next;i=i.zpp_inner.inner;null==gn.zpp_pool?B=new gn:(B=gn.zpp_pool,gn.zpp_pool=B.next,B.next=null),B.elt=E;var B=B;null==I?(B.next=i.head,i.head=B):(B.next=I.next,I.next=B),i.pushmod=i.modified=!0,i.length++}}},we.prototype.polysect=function(t,e,i){for(var n=i,r=null,s=t.edges.head,o=t.gverts.next,a=o,l=o.next;null!=l;){var p,h,u,c,d=s.elt;(e||d.gnormx*this.dirx+d.gnormy*this.diry<0)&&(p=c=0,c=l.x-a.x,p=l.y-a.y,u=h=0,h=a.x-this.originx,u=a.y-this.originy,(d=p*this.dirx-c*this.diry)*d>kr.epsilon&&(0<(c=(p*h-c*u)*(d=1/d))&&c<n&&c<=this.maxdist&&((d=(this.diry*h-this.dirx*u)*d)>-kr.epsilon&&d<1+kr.epsilon&&(n=c,r=s.elt)))),s=s.next,l=(a=l).next}for(;;){l=t.gverts.next;var _,y,f,m,x=s.elt;(e||x.gnormx*this.dirx+x.gnormy*this.diry<0)&&(_=m=0,m=l.x-a.x,_=l.y-a.y,f=y=0,y=a.x-this.originx,f=a.y-this.originy,(x=_*this.dirx-m*this.diry)*x>kr.epsilon&&(0<(m=(_*y-m*f)*(x=1/x))&&m<n&&m<=this.maxdist&&((x=(this.diry*y-this.dirx*f)*x)>-kr.epsilon&&x<1+kr.epsilon&&(n=m,r=s.elt)))),s=s.next;break}if(null==r)return null;var v,g,b=0,z=0,b=r.gnormx,z=r.gnormy,i=0<b*this.dirx+z*this.diry;return i&&(b=-b,z=-z),null==Rn.poolVec2?v=new Ct:(v=Rn.poolVec2,Rn.poolVec2=v.zpp_pool,v.zpp_pool=null),null==v.zpp_inner?(null==Ir.zpp_pool?g=new Ir:(g=Ir.zpp_pool,Ir.zpp_pool=g.next,g.next=null),g.weak=!1,g._immutable=!1,g.x=b,g.y=z,v.zpp_inner=g,v.zpp_inner.outer=v):(null!=(g=v.zpp_inner)._validate&&g._validate(),v.zpp_inner.x==b&&(null!=(g=v.zpp_inner)._validate&&g._validate(),v.zpp_inner.y==z)||(v.zpp_inner.x=b,v.zpp_inner.y=z,null!=(z=v.zpp_inner)._invalidate&&z._invalidate(z))),v.zpp_inner.weak=!1,de.getRay(v,n,i,t.outer)},we.prototype.polysect2=function(t,e,i){for(var n=1/0,r=-1,s=null,o=null,a=t.edges.head,l=t.gverts.next,p=l,h=l.next;null!=h;){var u,c,d,_,y=a.elt;(e||y.gnormx*this.dirx+y.gnormy*this.diry<0)&&(u=_=0,_=h.x-p.x,u=h.y-p.y,d=c=0,c=p.x-this.originx,d=p.y-this.originy,(y=u*this.dirx-_*this.diry)*y>kr.epsilon&&(0<(_=(u*c-_*d)*(y=1/y))&&_<=this.maxdist&&(_<n||r<_)&&((y=(this.diry*c-this.dirx*d)*y)>-kr.epsilon&&y<1+kr.epsilon&&(_<n&&(n=_,s=a.elt),r<_&&(r=_,o=a.elt))))),a=a.next,h=(p=h).next}for(;;){h=t.gverts.next;var f,m,x,v,g=a.elt;(e||g.gnormx*this.dirx+g.gnormy*this.diry<0)&&(f=v=0,v=h.x-p.x,f=h.y-p.y,x=m=0,m=p.x-this.originx,x=p.y-this.originy,(g=f*this.dirx-v*this.diry)*g>kr.epsilon&&(0<(v=(f*m-v*x)*(g=1/g))&&v<=this.maxdist&&(v<n||r<v)&&((g=(this.diry*m-this.dirx*x)*g)>-kr.epsilon&&g<1+kr.epsilon&&(v<n&&(n=v,s=a.elt),r<v&&(r=v,o=a.elt))))),a=a.next;break}if(null!=s){var b,z=0,w=0,z=s.gnormx,w=s.gnormy,C=0<z*this.dirx+w*this.diry;C&&(z=-z,w=-w),null==Rn.poolVec2?M=new Ct:(M=Rn.poolVec2,Rn.poolVec2=M.zpp_pool,M.zpp_pool=null),null==M.zpp_inner?(null==Ir.zpp_pool?b=new Ir:(b=Ir.zpp_pool,Ir.zpp_pool=b.next,b.next=null),b.weak=!1,b._immutable=!1,b.x=z,b.y=w,M.zpp_inner=b,M.zpp_inner.outer=M):(null!=(b=M.zpp_inner)._validate&&b._validate(),M.zpp_inner.x==z&&(null!=(b=M.zpp_inner)._validate&&b._validate(),M.zpp_inner.y==w)||(M.zpp_inner.x=z,M.zpp_inner.y=w,null!=(w=M.zpp_inner)._invalidate&&w._invalidate(w))),M.zpp_inner.weak=!1;for(var P=de.getRay(M,n,C,t.outer),T=null,S=i.zpp_inner.inner.head;null!=S&&!(P.zpp_inner.toiDistance<S.elt.zpp_inner.toiDistance);)S=(T=S).next;var M=i.zpp_inner.inner;null==gn.zpp_pool?k=new gn:(k=gn.zpp_pool,gn.zpp_pool=k.next,k.next=null),k.elt=P;C=k;null==T?(C.next=M.head,M.head=C):(C.next=T.next,T.next=C),M.pushmod=M.modified=!0,M.length++}if(null!=o&&s!=o){var A,O,k=0,C=0,k=o.gnormx,C=o.gnormy,M=0<k*this.dirx+C*this.diry;M&&(k=-k,C=-C),null==Rn.poolVec2?A=new Ct:(A=Rn.poolVec2,Rn.poolVec2=A.zpp_pool,A.zpp_pool=null),null==A.zpp_inner?(null==Ir.zpp_pool?O=new Ir:(O=Ir.zpp_pool,Ir.zpp_pool=O.next,O.next=null),O.weak=!1,O._immutable=!1,O.x=k,O.y=C,A.zpp_inner=O,A.zpp_inner.outer=A):(null!=(O=A.zpp_inner)._validate&&O._validate(),A.zpp_inner.x==k&&(null!=(O=A.zpp_inner)._validate&&O._validate(),A.zpp_inner.y==C)||(A.zpp_inner.x=k,A.zpp_inner.y=C,null!=(C=A.zpp_inner)._invalidate&&C._invalidate(C))),A.zpp_inner.weak=!1;for(var E=de.getRay(A,r,M,t.outer),I=null,D=i.zpp_inner.inner.head;null!=D&&!(E.zpp_inner.toiDistance<D.elt.zpp_inner.toiDistance);)D=(I=D).next;i=i.zpp_inner.inner;null==gn.zpp_pool?B=new gn:(B=gn.zpp_pool,gn.zpp_pool=B.next,B.next=null),B.elt=E;var B=B;null==I?(B.next=i.head,i.head=B):(B.next=I.next,I.next=B),i.pushmod=i.modified=!0,i.length++}},we.prototype.__class__=we;var Ce=zpp_nape.geom.ZPP_SimpleVert=function(){this.node=null,this.next=null,this.id=0,this.links=null,this.y=0,this.x=0,this.forced=!1,this.id=vt.ZPP_SimpleVert(),null==Un.zpp_pool?this.links=new Un:(this.links=Un.zpp_pool,Un.zpp_pool=this.links.next,this.links.next=null),this.links.lt=Ce.less_xy};Ce.__name__=["zpp_nape","geom","ZPP_SimpleVert"],Ce.less_xy=function(t,e){return t.y<e.y||t.y==e.y&&t.x<e.x},Ce.swap_nodes=function(t,e){var i=t.node;t.node=e.node,e.node=i},Ce.get=function(t,e){var i;return null==Ce.zpp_pool?i=new Ce:(i=Ce.zpp_pool,Ce.zpp_pool=i.next,i.next=null),i.x=t,i.y=e,i},Ce.prototype.forced=null,Ce.prototype.x=null,Ce.prototype.y=null,Ce.prototype.links=null,Ce.prototype.id=null,Ce.prototype.next=null,Ce.prototype.node=null,Ce.prototype.free=function(){this.links.clear(),this.node=null,this.forced=!1},Ce.prototype.alloc=function(){},Ce.prototype.__class__=Ce;var Pe=zpp_nape.geom.ZPP_SimpleSeg=function(){this.node=null,this.prev=null,this.next=null,this.id=0,this.vertices=null,this.right=null,this.left=null,this.id=vt.ZPP_SimpleSeg(),null==Un.zpp_pool?this.vertices=new Un:(this.vertices=Un.zpp_pool,Un.zpp_pool=this.vertices.next,this.vertices.next=null),this.vertices.lt=Z(this,this.less_xy)};Pe.__name__=["zpp_nape","geom","ZPP_SimpleSeg"],Pe.get=function(t,e){var i;return null==Pe.zpp_pool?i=new Pe:(i=Pe.zpp_pool,Pe.zpp_pool=i.next,i.next=null),i.left=t,i.right=e,i.vertices.insert(t),i.vertices.insert(e),i},Pe.prototype.left=null,Pe.prototype.right=null,Pe.prototype.vertices=null,Pe.prototype.id=null,Pe.prototype.next=null,Pe.prototype.free=function(){this.left=this.right=null,this.prev=null,this.node=null,this.vertices.clear()},Pe.prototype.alloc=function(){},Pe.prototype.prev=null,Pe.prototype.node=null,Pe.prototype.less_xy=function(t,e){return t.x<e.x||t.x==e.x&&t.y<e.y},Pe.prototype.__class__=Pe;var Te=zpp_nape.geom.ZPP_SimpleEvent=function(){this.next=null,this.node=null,this.segment2=null,this.segment=null,this.vertex=null,this.type=0};Te.__name__=["zpp_nape","geom","ZPP_SimpleEvent"],Te.swap_nodes=function(t,e){var i=t.node;t.node=e.node,e.node=i},Te.less_xy=function(t,e){return t.vertex.x<e.vertex.x||!(t.vertex.x>e.vertex.x)&&(t.vertex.y<e.vertex.y||!(t.vertex.y>e.vertex.y)&&t.type<e.type)},Te.get=function(t){var e;return null==Te.zpp_pool?e=new Te:(e=Te.zpp_pool,Te.zpp_pool=e.next,e.next=null),e.vertex=t,e},Te.prototype.type=null,Te.prototype.vertex=null,Te.prototype.segment=null,Te.prototype.segment2=null,Te.prototype.node=null,Te.prototype.next=null,Te.prototype.free=function(){this.vertex=null,this.segment=this.segment2=null,this.node=null},Te.prototype.alloc=function(){},Te.prototype.__class__=Te;var Se=zpp_nape.geom.ZPP_SimpleSweep=function(){this.tree=null,this.sweepx=0,null==Xn.zpp_pool?this.tree=new Xn:(this.tree=Xn.zpp_pool,Xn.zpp_pool=this.tree.next,this.tree.next=null),this.tree.lt=Z(this,this.edge_lt),this.tree.swapped=Z(this,this.swap_nodes)};Se.__name__=["zpp_nape","geom","ZPP_SimpleSweep"],Se.prototype.sweepx=null,Se.prototype.tree=null,Se.prototype.swap_nodes=function(t,e){var i=t.node;t.node=e.node,e.node=i},Se.prototype.edge_lt=function(t,e){var i=0,n=0,r=0,s=0;if(t.left==e.left&&t.right==e.right)return!1;if(t.left==e.right)return t.left.x==t.right.x?t.left.y<t.right.y?t.left.y>e.left.y:t.right.y>e.left.y:(a=t.right.x<t.left.x,i=t.right.x-t.left.x,n=t.right.y-t.left.y,r=e.left.x-t.left.x,s=e.left.y-t.left.y,(a?n*r-i*s:s*i-r*n)<0);if(t.right==e.left){var o=e.left.x==e.right.x?e.left.y<e.right.y?e.left.y>t.left.y:e.right.y>t.left.y:(a=e.right.x<e.left.x,i=e.right.x-e.left.x,n=e.right.y-e.left.y,r=t.left.x-e.left.x,s=t.left.y-e.left.y,(a?n*r-i*s:s*i-r*n)<0);return!o}if(t.left==e.left)return t.left.x==t.right.x?t.left.y<t.right.y?t.left.y>e.right.y:t.right.y>e.right.y:(a=t.right.x<t.left.x,i=t.right.x-t.left.x,n=t.right.y-t.left.y,r=e.right.x-t.left.x,s=e.right.y-t.left.y,(a?n*r-i*s:s*i-r*n)<0);if(t.right==e.right)return t.left.x==t.right.x?t.left.y<t.right.y?t.left.y>e.left.y:t.right.y>e.left.y:(a=t.right.x<t.left.x,i=t.right.x-t.left.x,n=t.right.y-t.left.y,r=e.left.x-t.left.x,s=e.left.y-t.left.y,(a?n*r-i*s:s*i-r*n)<0);if(t.left.x==t.right.x){if(e.left.x==e.right.x)return(t.left.y<t.right.y?t.right:t.left).y>(e.left.y<e.right.y?e.right:e.left).y;a=e.right.x<e.left.x,i=e.right.x-e.left.x,n=e.right.y-e.left.y,r=t.left.x-e.left.x,s=t.left.y-e.left.y;var o=a?n*r-i*s:s*i-r*n,a=e.right.x<e.left.x,i=e.right.x-e.left.x,n=e.right.y-e.left.y,r=t.right.x-e.left.x,s=t.right.y-e.left.y;return 0<=o*(a?n*r-i*s:s*i-r*n)?0<=o:this.sweepx>=t.left.x}if(e.left.x==e.right.x){a=t.right.x<t.left.x,i=t.right.x-t.left.x,n=t.right.y-t.left.y,r=e.left.x-t.left.x,s=e.left.y-t.left.y;var l=a?n*r-i*s:s*i-r*n;return a=t.right.x<t.left.x,i=t.right.x-t.left.x,n=t.right.y-t.left.y,r=e.right.x-t.left.x,s=e.right.y-t.left.y,0<=l*(a?n*r-i*s:s*i-r*n)?l<0:this.sweepx<e.left.x}a=t.right.x<t.left.x,i=t.right.x-t.left.x,n=t.right.y-t.left.y,r=e.left.x-t.left.x,s=e.left.y-t.left.y;l=(a?n*r-i*s:s*i-r*n)<0;if(a=t.right.x<t.left.x,i=t.right.x-t.left.x,n=t.right.y-t.left.y,r=e.right.x-t.left.x,s=e.right.y-t.left.y,l==(a?n*r-i*s:s*i-r*n)<0)return l;a=e.right.x<e.left.x,i=e.right.x-e.left.x,n=e.right.y-e.left.y,r=t.left.x-e.left.x,s=t.left.y-e.left.y;l=0<=(a?n*r-i*s:s*i-r*n);return a=e.right.x<e.left.x,i=e.right.x-e.left.x,n=e.right.y-e.left.y,r=t.right.x-e.left.x,s=t.right.y-e.left.y,l==0<=(a?n*r-i*s:s*i-r*n)?l:(this.sweepx-t.left.x)/(t.right.x-t.left.x)*(t.right.y-t.left.y)+t.left.y>(this.sweepx-e.left.x)/(e.right.x-e.left.x)*(e.right.y-e.left.y)+e.left.y},Se.prototype.clear=function(){this.tree.clear()},Se.prototype.add=function(t){t.node=this.tree.insert(t);var e=this.tree.successor_node(t.node),i=this.tree.predecessor_node(t.node);return null!=e&&(t.next=e.data,e.data.prev=t),null!=i&&(t.prev=i.data,i.data.next=t),t},Se.prototype.remove=function(t){var e=this.tree.successor_node(t.node),i=this.tree.predecessor_node(t.node);null!=e&&(e.data.prev=t.prev),null!=i&&(i.data.next=t.next),this.tree.remove_node(t.node),t.node=null},Se.prototype.intersect=function(t,e){if(null==t||null==e)return!1;if(t.left==e.left||t.left==e.right||t.right==e.left||t.right==e.right)return!1;var i=(e.left.x-t.left.x)*(t.right.y-t.left.y)-(t.right.x-t.left.x)*(e.left.y-t.left.y),n=(e.right.x-t.left.x)*(t.right.y-t.left.y)-(t.right.x-t.left.x)*(e.right.y-t.left.y);if(0<i*n)return!1;n=(t.left.x-e.left.x)*(e.right.y-e.left.y)-(e.right.x-e.left.x)*(t.left.y-e.left.y),e=(t.right.x-e.left.x)*(e.right.y-e.left.y)-(e.right.x-e.left.x)*(t.right.y-e.left.y);return!(0<n*e)},Se.prototype.intersection=function(t,e){if(null==t||null==e)return null;if(t.left==e.left||t.left==e.right||t.right==e.left||t.right==e.right)return null;var i=t.right.x-t.left.x,n=t.right.y-t.left.y,r=0,s=0,r=e.right.x-e.left.x,o=(s=e.right.y-e.left.y)*i-r*n;if(0==o)return null;o=1/o;var a=0,l=0,p=(s*(a=e.left.x-t.left.x)-r*(l=e.left.y-t.left.y))*o;if(p<0||1<p)return null;var h,o=(n*a-i*l)*o;if(o<0||1<o)return null;h=0==o||1==o||0==p||1==p?0==o?e.left:1==o?e.right:0==p?t.left:t.right:(r=.5*(t.left.x+i*p+e.left.x+r*o),o=.5*(t.left.y+n*p+e.left.y+s*o),null==Ce.zpp_pool?h=new Ce:(h=Ce.zpp_pool,Ce.zpp_pool=h.next,h.next=null),h.x=r,h.y=o,h),null==Te.zpp_pool?u=new Te:(u=Te.zpp_pool,Te.zpp_pool=u.next,u.next=null),u.vertex=h;var u=u;return u.type=0,u.segment=t,u.segment2=e,u},Se.prototype.__class__=Se;var Me=zpp_nape.geom.ZPP_Simple=function(){};Me.__name__=["zpp_nape","geom","ZPP_Simple"],Me.decompose=function(t,e){null==Me.sweep&&(Me.sweep=new Se,Me.inthash=new pi),null==Me.vertices&&(null==Un.zpp_pool?Me.vertices=new Un:(Me.vertices=Un.zpp_pool,Un.zpp_pool=Me.vertices.next,Me.vertices.next=null),Me.vertices.lt=Ce.less_xy,Me.vertices.swapped=Ce.swap_nodes),null==Me.queue&&(null==Vn.zpp_pool?Me.queue=new Vn:(Me.queue=Vn.zpp_pool,Vn.zpp_pool=Me.queue.next,Me.queue.next=null),Me.queue.lt=Te.less_xy,Me.queue.swapped=Te.swap_nodes);var i=null,n=null;if(null!=t)for(var r=t;;){var s,o=r.x,a=r.y;null==Ce.zpp_pool?s=new Ce:(s=Ce.zpp_pool,Ce.zpp_pool=s.next,s.next=null),s.x=o,s.y=a;for(var l=s,p=Me.vertices.parent;null!=p;)if(Me.vertices.lt(l,p.data))p=p.prev;else{if(!Me.vertices.lt(p.data,l))break;p=p.next}var h,u,c,o=p;if(null!=o?((c=l).links.clear(),c.node=null,c.forced=!1,c.next=Ce.zpp_pool,Ce.zpp_pool=c,l=o.data):l.node=Me.vertices.insert(l),null!=n&&(null==Te.zpp_pool?h=new Te:(h=Te.zpp_pool,Te.zpp_pool=h.next,h.next=null),h.vertex=n,a=h,null==Te.zpp_pool?u=new Te:(u=Te.zpp_pool,Te.zpp_pool=u.next,u.next=null),u.vertex=l,c=u,o=Te.less_xy(a,c)?(a.type=1,c.type=2,Pe.get(n,l)):(a.type=2,c.type=1,Pe.get(l,n)),a.segment=c.segment=o,Me.queue.insert(a),Me.queue.insert(c),n.links.insert(l),l.links.insert(n)),n=l,null==i&&(i=l),(r=r.next)==t)break}null==Te.zpp_pool?_=new Te:(_=Te.zpp_pool,Te.zpp_pool=_.next,_.next=null),_.vertex=n;var d=_;null==Te.zpp_pool?y=new Te:(y=Te.zpp_pool,Te.zpp_pool=y.next,y.next=null),y.vertex=i;var _=y,y=Te.less_xy(d,_)?(d.type=1,_.type=2,Pe.get(n,i)):(d.type=2,_.type=1,Pe.get(i,n));for(d.segment=_.segment=y,Me.queue.insert(d),Me.queue.insert(_),n.links.insert(i),i.links.insert(n),null==Me.ints&&(null==Vn.zpp_pool?Me.ints=new Vn:(Me.ints=Vn.zpp_pool,Vn.zpp_pool=Me.ints.next,Me.ints.next=null),Me.ints.lt=Te.less_xy);!Me.queue.empty();){var f=Me.queue.pop_front();if(Me.sweep.sweepx=f.vertex.x,1==f.type){var m=f.segment;if(Me.sweep.add(m),null!=m.next&&null!=m&&!(m.next.id<m.id?Me.inthash.has(m.next.id,m.id):Me.inthash.has(m.id,m.next.id))){var x=Me.sweep.intersection(m.next,m);if(null!=x)if(x.vertex.x>=Me.sweep.sweepx){for(var v=Me.queue.parent;null!=v;)if(Me.queue.lt(x,v.data))v=v.prev;else{if(!Me.queue.lt(v.data,x))break;v=v.next}if(null==v){for(var g=Me.ints.parent;null!=g;)if(Me.ints.lt(x,g.data))g=g.prev;else{if(!Me.ints.lt(g.data,x))break;g=g.next}var b,z,w,C,P,T=g;null!=T?((b=x.vertex).links.clear(),b.node=null,b.forced=!1,b.next=Ce.zpp_pool,Ce.zpp_pool=b,x.vertex=T.data.vertex,T.data=x,Me.queue.insert(x)):(Me.queue.insert(x),Me.ints.insert(x)),m.next.id<m.id?(P=m.next.id,w=m.id,null==li.zpp_pool?z=new li:(z=li.zpp_pool,li.zpp_pool=z.next,z.next=null),z.id=P,z.di=w,(P=z).value=!0,Me.inthash.add(P)):(w=m.id,P=m.next.id,null==li.zpp_pool?C=new li:(C=li.zpp_pool,li.zpp_pool=C.next,C.next=null),C.id=w,C.di=P,(P=C).value=!0,Me.inthash.add(P))}else{var S=x.vertex;S.links.clear(),S.node=null,S.forced=!1,S.next=Ce.zpp_pool,Ce.zpp_pool=S,x.vertex=null,x.segment=x.segment2=null,x.node=null,x.next=Te.zpp_pool,Te.zpp_pool=x}}else{var M=x.vertex;M.links.clear(),M.node=null,M.forced=!1,M.next=Ce.zpp_pool,Ce.zpp_pool=M,x.vertex=null,x.segment=x.segment2=null,x.node=null,x.next=Te.zpp_pool,Te.zpp_pool=x}}if(null!=m&&null!=m.prev&&!(m.id<m.prev.id?Me.inthash.has(m.id,m.prev.id):Me.inthash.has(m.prev.id,m.id))){var A=Me.sweep.intersection(m,m.prev);if(null!=A)if(A.vertex.x>=Me.sweep.sweepx){for(var O=Me.queue.parent;null!=O;)if(Me.queue.lt(A,O.data))O=O.prev;else{if(!Me.queue.lt(O.data,A))break;O=O.next}if(null==O){for(var k=Me.ints.parent;null!=k;)if(Me.ints.lt(A,k.data))k=k.prev;else{if(!Me.ints.lt(k.data,A))break;k=k.next}var E,I,D,S=k;null!=S?((M=A.vertex).links.clear(),M.node=null,M.forced=!1,M.next=Ce.zpp_pool,Ce.zpp_pool=M,A.vertex=S.data.vertex,S.data=A,Me.queue.insert(A)):(Me.queue.insert(A),Me.ints.insert(A)),m.id<m.prev.id?(S=m.id,I=m.prev.id,null==li.zpp_pool?E=new li:(E=li.zpp_pool,li.zpp_pool=E.next,E.next=null),E.id=S,E.di=I,(I=E).value=!0,Me.inthash.add(I)):(I=m.prev.id,R=m.id,null==li.zpp_pool?D=new li:(D=li.zpp_pool,li.zpp_pool=D.next,D.next=null),D.id=I,D.di=R,(R=D).value=!0,Me.inthash.add(R))}else{var B=A.vertex;B.links.clear(),B.node=null,B.forced=!1,B.next=Ce.zpp_pool,Ce.zpp_pool=B,A.vertex=null,A.segment=A.segment2=null,A.node=null,A.next=Te.zpp_pool,Te.zpp_pool=A}}else{var L=A.vertex;L.links.clear(),L.node=null,L.forced=!1,L.next=Ce.zpp_pool,Ce.zpp_pool=L,A.vertex=null,A.segment=A.segment2=null,A.node=null,A.next=Te.zpp_pool,Te.zpp_pool=A}}}else if(2==f.type){var R=f.segment;if(null!=R.node){B=R.next,L=R.prev;if(Me.sweep.remove(R),R.left=R.right=null,R.prev=null,R.node=null,R.vertices.clear(),R.next=Pe.zpp_pool,Pe.zpp_pool=R,null!=B&&null!=L&&!(B.id<L.id?Me.inthash.has(B.id,L.id):Me.inthash.has(L.id,B.id))){var F=Me.sweep.intersection(B,L);if(null!=F)if(F.vertex.x>=Me.sweep.sweepx){for(var j=Me.queue.parent;null!=j;)if(Me.queue.lt(F,j.data))j=j.prev;else{if(!Me.queue.lt(j.data,F))break;j=j.next}if(null==j){for(var N=Me.ints.parent;null!=N;)if(Me.ints.lt(F,N.data))N=N.prev;else{if(!Me.ints.lt(N.data,F))break;N=N.next}var G,U,X,R=N;null!=R?((G=F.vertex).links.clear(),G.node=null,G.forced=!1,G.next=Ce.zpp_pool,Ce.zpp_pool=G,F.vertex=R.data.vertex,R.data=F,Me.queue.insert(F)):(Me.queue.insert(F),Me.ints.insert(F)),B.id<L.id?(G=B.id,R=L.id,null==li.zpp_pool?U=new li:(U=li.zpp_pool,li.zpp_pool=U.next,U.next=null),U.id=G,U.di=R,(R=U).value=!0,Me.inthash.add(R)):(L=L.id,B=B.id,null==li.zpp_pool?X=new li:(X=li.zpp_pool,li.zpp_pool=X.next,X.next=null),X.id=L,X.di=B,(B=X).value=!0,Me.inthash.add(B))}else{var V=F.vertex;V.links.clear(),V.node=null,V.forced=!1,V.next=Ce.zpp_pool,Ce.zpp_pool=V,F.vertex=null,F.segment=F.segment2=null,F.node=null,F.next=Te.zpp_pool,Te.zpp_pool=F}}else{var W=F.vertex;W.links.clear(),W.node=null,W.forced=!1,W.next=Ce.zpp_pool,Ce.zpp_pool=W,F.vertex=null,F.segment=F.segment2=null,F.node=null,F.next=Te.zpp_pool,Te.zpp_pool=F}}}}else{var H=f.vertex,V=null==H.node,q=f.segment,Y=f.segment2;Y.next!=q&&(Q=q,q=Y,Y=Q);for(var K=q.vertices.parent;null!=K;)if(q.vertices.lt(H,K.data))K=K.prev;else{if(!q.vertices.lt(K.data,H))break;K=K.next}for(var W=null==K,Z=Y.vertices.parent;null!=Z;)if(Y.vertices.lt(H,Z.data))Z=Z.prev;else{if(!Y.vertices.lt(Z.data,H))break;Z=Z.next}var J,Q=null==Z;if(W&&(J=q.vertices.insert(H),W=H==q.left?H:q.vertices.predecessor_node(J).data,J=H==q.right?H:q.vertices.successor_node(J).data,W.links.remove(J),H!=W&&W.links.insert(H),J.links.remove(W),H!=J&&J.links.insert(H),H!=W&&H.links.insert(W),H!=J&&H.links.insert(J)),Q&&(J=Y.vertices.insert(H),Q=H==Y.left?H:Y.vertices.predecessor_node(J).data,J=H==Y.right?H:Y.vertices.successor_node(J).data,Q.links.remove(J),H!=Q&&Q.links.insert(H),J.links.remove(Q),H!=J&&J.links.insert(H),H!=Q&&H.links.insert(Q),H!=J&&H.links.insert(J)),V&&(H.node=Me.vertices.insert(H)),H.forced=!0,V&&(it=q.node,at=Y.node,it.data=Y,(at.data=q).node=at,Y.node=it,Y.next=q.next,q.next=Y,q.prev=Y.prev,null!=(Y.prev=q).prev&&(q.prev.next=q),null!=Y.next&&(Y.next.prev=Y)),null!=Y.next&&null!=Y&&!(Y.next.id<Y.id?Me.inthash.has(Y.next.id,Y.id):Me.inthash.has(Y.id,Y.next.id))){var $=Me.sweep.intersection(Y.next,Y);if(null!=$)if($.vertex.x>=Me.sweep.sweepx){for(var tt=Me.queue.parent;null!=tt;)if(Me.queue.lt($,tt.data))tt=tt.prev;else{if(!Me.queue.lt(tt.data,$))break;tt=tt.next}if(null==tt){for(var et=Me.ints.parent;null!=et;)if(Me.ints.lt($,et.data))et=et.prev;else{if(!Me.ints.lt(et.data,$))break;et=et.next}var it,nt,rt,st,ot,at=et;null!=at?((it=$.vertex).links.clear(),it.node=null,it.forced=!1,it.next=Ce.zpp_pool,Ce.zpp_pool=it,$.vertex=at.data.vertex,at.data=$,Me.queue.insert($)):(Me.queue.insert($),Me.ints.insert($)),Y.next.id<Y.id?(ot=Y.next.id,rt=Y.id,null==li.zpp_pool?nt=new li:(nt=li.zpp_pool,li.zpp_pool=nt.next,nt.next=null),nt.id=ot,nt.di=rt,(ot=nt).value=!0,Me.inthash.add(ot)):(rt=Y.id,ot=Y.next.id,null==li.zpp_pool?st=new li:(st=li.zpp_pool,li.zpp_pool=st.next,st.next=null),st.id=rt,st.di=ot,(ot=st).value=!0,Me.inthash.add(ot))}else{var lt=$.vertex;lt.links.clear(),lt.node=null,lt.forced=!1,lt.next=Ce.zpp_pool,Ce.zpp_pool=lt,$.vertex=null,$.segment=$.segment2=null,$.node=null,$.next=Te.zpp_pool,Te.zpp_pool=$}}else{var pt=$.vertex;pt.links.clear(),pt.node=null,pt.forced=!1,pt.next=Ce.zpp_pool,Ce.zpp_pool=pt,$.vertex=null,$.segment=$.segment2=null,$.node=null,$.next=Te.zpp_pool,Te.zpp_pool=$}}if(null!=q&&null!=q.prev&&!(q.id<q.prev.id?Me.inthash.has(q.id,q.prev.id):Me.inthash.has(q.prev.id,q.id))){var ht=Me.sweep.intersection(q,q.prev);if(null!=ht)if(ht.vertex.x>=Me.sweep.sweepx){for(var ut=Me.queue.parent;null!=ut;)if(Me.queue.lt(ht,ut.data))ut=ut.prev;else{if(!Me.queue.lt(ut.data,ht))break;ut=ut.next}if(null==ut){for(var ct=Me.ints.parent;null!=ct;)if(Me.ints.lt(ht,ct.data))ct=ct.prev;else{if(!Me.ints.lt(ct.data,ht))break;ct=ct.next}var dt,_t,yt,ft,lt=ct;null!=lt?((pt=ht.vertex).links.clear(),pt.node=null,pt.forced=!1,pt.next=Ce.zpp_pool,Ce.zpp_pool=pt,ht.vertex=lt.data.vertex,lt.data=ht,Me.queue.insert(ht)):(Me.queue.insert(ht),Me.ints.insert(ht)),q.id<q.prev.id?(ft=q.id,_t=q.prev.id,null==li.zpp_pool?dt=new li:(dt=li.zpp_pool,li.zpp_pool=dt.next,dt.next=null),dt.id=ft,dt.di=_t,(ft=dt).value=!0,Me.inthash.add(ft)):(_t=q.prev.id,ft=q.id,null==li.zpp_pool?yt=new li:(yt=li.zpp_pool,li.zpp_pool=yt.next,yt.next=null),yt.id=_t,yt.di=ft,(ft=yt).value=!0,Me.inthash.add(ft))}else{var mt=ht.vertex;mt.links.clear(),mt.node=null,mt.forced=!1,mt.next=Ce.zpp_pool,Ce.zpp_pool=mt,ht.vertex=null,ht.segment=ht.segment2=null,ht.node=null,ht.next=Te.zpp_pool,Te.zpp_pool=ht}}else{mt=ht.vertex;mt.links.clear(),mt.node=null,mt.forced=!1,mt.next=Ce.zpp_pool,Ce.zpp_pool=mt,ht.vertex=null,ht.segment=ht.segment2=null,ht.node=null,ht.next=Te.zpp_pool,Te.zpp_pool=ht}}Me.ints.remove(f)}f.vertex=null,f.segment=f.segment2=null,f.node=null,f.next=Te.zpp_pool,Te.zpp_pool=f}for(var xt=0,vt=Me.inthash.table.length;xt<vt;){var gt=xt++,bt=Me.inthash.table[gt];if(null!=bt){for(;null!=bt;){var zt=bt.hnext;bt.hnext=null;var wt=bt;wt.next=li.zpp_pool,li.zpp_pool=wt,bt=zt}Me.inthash.table[gt]=null}}for(null==e&&(e=new Ti);!Me.vertices.empty();)Me.clip_polygon(Me.vertices,e);return e},Me.clip_polygon=function(t,e){var i=null,n=t.first(),r=n,s=n.links.parent,o=null==s.prev?s.next:s.prev,a=s.data,l=o.data,p=n.x-a.x,s=n.y-a.y,o=l.x-n.x;(l.y-n.y)*p-o*s<0&&(l=a);s=n.x,a=n.y;null==nn.zpp_pool?h=new nn:(h=nn.zpp_pool,nn.zpp_pool=h.next,h.next=null),h.forced=!1,h.x=s,h.y=a;var h=h;for(null==i?i=h.prev=h.next=h:(h.prev=i,h.next=i.next,i.next.prev=h,i.next=h),(i=h).forced=n.forced;;){if(n.links.remove(l),l.links.remove(n),l==r){n.links.empty()&&(t.remove(n),(d=n).links.clear(),d.node=null,d.forced=!1,d.next=Ce.zpp_pool,Ce.zpp_pool=d);break}var u,c=l.x,d=l.y;null==nn.zpp_pool?u=new nn:(u=nn.zpp_pool,nn.zpp_pool=u.next,u.next=null),u.forced=!1,u.x=c,u.y=d;d=u;if(null==i?i=d.prev=d.next=d:(d.prev=i,d.next=i.next,i.next.prev=d,i.next=d),(i=d).forced=l.forced,l.links.singular())n.links.empty()&&(t.remove(n),(_=n).links.clear(),_.node=null,_.forced=!1,_.next=Ce.zpp_pool,Ce.zpp_pool=_),l=(n=l).links.parent.data;else{var _,y=null,f=0;if(!l.links.empty()){for(var m=l.links.parent;null!=m.prev;)m=m.prev;for(;null!=m;){var x,v,g,b,z=m.data;if(null==y?(y=z,x=b=0,b=l.x-n.x,x=l.y-n.y,g=0,g=z.x-l.x,f=(z.y-l.y)*b-g*x):(b=v=0,v=l.x-n.x,b=l.y-n.y,g=0,g=z.x-l.x,0<(x=(z.y-l.y)*v-g*b)&&f<=0?(y=z,f=x):0<=f*x&&(g=v=0,v=l.x-z.x,g=l.y-z.y,b=0,b=y.x-l.x,0<(y.y-l.y)*v-b*g&&(y=z,f=x))),null!=m.next)for(m=m.next;null!=m.prev;)m=m.prev;else{for(;null!=m.parent&&m==m.parent.next;)m=m.parent;m=m.parent}}}n.links.empty()&&(t.remove(n),(_=n).links.clear(),_.node=null,_.forced=!1,_.next=Ce.zpp_pool,Ce.zpp_pool=_),n=l,l=y}}t.remove(r),r.links.clear(),r.node=null,r.forced=!1,r.next=Ce.zpp_pool,Ce.zpp_pool=r,e.add(i)},Me.isSimple=function(t){null==Me.sweep&&(Me.sweep=new Se,Me.inthash=new pi);var e=Me.list_vertices;if(null==e&&(e=Me.list_vertices=new Si),null!=t)for(var i=t;;){var n,r=i.x,s=i.y;if(null==Ce.zpp_pool?n=new Ce:(n=Ce.zpp_pool,Ce.zpp_pool=n.next,n.next=null),n.x=r,n.y=s,e.add(n),(i=i.next)==t)break}var o=Me.list_queue;null==o&&(o=Me.list_queue=new Mi);for(var a=(l=e.head).elt,l=l.next;null!=l;){var p,h=l.elt;null==Te.zpp_pool?p=new Te:(p=Te.zpp_pool,Te.zpp_pool=p.next,p.next=null),p.vertex=a;var u,c=o.add(p);null==Te.zpp_pool?u=new Te:(u=Te.zpp_pool,Te.zpp_pool=u.next,u.next=null),u.vertex=h;var d=o.add(u),_=Te.less_xy(c,d)?(c.type=1,d.type=2,Pe.get(a,h)):(c.type=2,d.type=1,Pe.get(h,a));c.segment=d.segment=_,a=h,l=l.next}var y=e.head.elt;null==Te.zpp_pool?f=new Te:(f=Te.zpp_pool,Te.zpp_pool=f.next,f.next=null),f.vertex=a;var f=o.add(f);null==Te.zpp_pool?m=new Te:(m=Te.zpp_pool,Te.zpp_pool=m.next,m.next=null),m.vertex=y;var m=o.add(m),y=Te.less_xy(f,m)?(f.type=1,m.type=2,Pe.get(a,y)):(f.type=2,m.type=1,Pe.get(y,a));f.segment=m.segment=y;y=o;if(null!=y.head&&null!=y.head.next){for(var x,v,g,b=y.head,z=null,w=null,C=null,P=null,T=1;;){for(x=0,w=b,z=b=null;null!=w;){for(++x,C=w,v=0,g=T;null!=C&&v<T;)++v,C=C.next;for(;0<v||0<g&&null!=C;)0!=v&&(0==g||null==C||Te.less_xy(w.elt,C.elt))?(w=(P=w).next,--v):(C=(P=C).next,--g),null!=z?z.next=P:b=P,z=P;w=C}if(z.next=null,T<<=1,!(1<x))break}y.head=b,y.modified=!0,y.pushmod=!0}for(var S=!0;null!=o.head;){var M=o.pop_unsafe(),A=M.segment;if(1==M.type){if(Me.sweep.add(A),Me.sweep.intersect(A,A.next)||Me.sweep.intersect(A,A.prev)){S=!1;break}}else if(2==M.type){if(Me.sweep.intersect(A.prev,A.next)){S=!1;break}Me.sweep.remove(A),A.left=A.right=null,A.prev=null,A.node=null,A.vertices.clear(),A.next=Pe.zpp_pool,Pe.zpp_pool=A}M.vertex=null,M.segment=M.segment2=null,M.node=null,M.next=Te.zpp_pool,Te.zpp_pool=M}for(;null!=o.head;){var O,k=o.pop_unsafe();2==k.type&&((O=k.segment).left=O.right=null,O.prev=null,O.node=null,O.vertices.clear(),O.next=Pe.zpp_pool,Pe.zpp_pool=O),k.vertex=null,k.segment=k.segment2=null,k.node=null,k.next=Te.zpp_pool,Te.zpp_pool=k}for(Me.sweep.clear();null!=e.head;){var E=e.pop_unsafe();E.links.clear(),E.node=null,E.forced=!1,E.next=Ce.zpp_pool,Ce.zpp_pool=E}return S},Me.prototype.__class__=Me;var Ae=zpp_nape.geom.ZPP_SimplifyV=function(){this.forced=!1,this.flag=!1,this.prev=null,this.next=null,this.y=0,this.x=0};Ae.__name__=["zpp_nape","geom","ZPP_SimplifyV"],Ae.get=function(t){var e;return null==Ae.zpp_pool?e=new Ae:(e=Ae.zpp_pool,Ae.zpp_pool=e.next,e.next=null),e.x=t.x,e.y=t.y,e.flag=!1,e},Ae.prototype.x=null,Ae.prototype.y=null,Ae.prototype.next=null,Ae.prototype.prev=null,Ae.prototype.flag=null,Ae.prototype.forced=null,Ae.prototype.free=function(){},Ae.prototype.alloc=function(){},Ae.prototype.__class__=Ae;var Oe=zpp_nape.geom.ZPP_SimplifyP=function(){this.max=null,this.min=null,this.next=null};Oe.__name__=["zpp_nape","geom","ZPP_SimplifyP"],Oe.get=function(t,e){var i;return null==Oe.zpp_pool?i=new Oe:(i=Oe.zpp_pool,Oe.zpp_pool=i.next,i.next=null),i.min=t,i.max=e,i},Oe.prototype.next=null,Oe.prototype.min=null,Oe.prototype.max=null,Oe.prototype.free=function(){this.min=this.max=null},Oe.prototype.alloc=function(){},Oe.prototype.__class__=Oe;var ke=zpp_nape.geom.ZPP_Simplify=function(){};ke.__name__=["zpp_nape","geom","ZPP_Simplify"],ke.lessval=function(t,e){return t.x-e.x+(t.y-e.y)},ke.less=function(t,e){return t.x-e.x+(t.y-e.y)<0},ke.distance=function(t,e,i){var n=i.x-e.x,r=i.y-e.y,s=0,o=0,s=t.x-e.x,o=t.y-e.y;if(n*n+r*r==0)return s*s+o*o;var a=(s*n+o*r)/(n*n+r*r);if(a<=0)return s*s+o*o;if(1<=a){var l=t.x,p=t.y,e=0,t=0;return(e=l-i.x)*e+(t=p-i.y)*t}return(s-=n*a)*s+(o-=r*a)*o},ke.simplify=function(t,e){var i=null,n=null,r=null;e*=e,null==ke.stack&&(ke.stack=new Ci);for(var s,o,a,l,p,h,u,c,d=null,_=null,y=t;;){null==Ae.zpp_pool?s=new Ae:(s=Ae.zpp_pool,Ae.zpp_pool=s.next,s.next=null),s.x=y.x,s.y=y.y,s.flag=!1;var f,m=s;if(m.forced=y.forced,m.forced&&(m.flag=!0,null!=d?(null==Oe.zpp_pool?f=new Oe:(f=Oe.zpp_pool,Oe.zpp_pool=f.next,f.next=null),f.min=d,f.max=m,ke.stack.add(f)):_=m,d=m),null==i?i=m.prev=m.next=m:(m.prev=i,m.next=i.next,i.next.prev=m,i.next=m),i=m,null==n?r=n=m:(m.x-n.x+(m.y-n.y)<0&&(n=m),r.x-m.x+(r.y-m.y)<0&&(r=m)),(y=y.next)==t)break}for(null==ke.stack.head?null==_?(n.flag=r.flag=!0,null==Oe.zpp_pool?o=new Oe:(o=Oe.zpp_pool,Oe.zpp_pool=o.next,o.next=null),o.min=n,o.max=r,ke.stack.add(o),null==Oe.zpp_pool?a=new Oe:(a=Oe.zpp_pool,Oe.zpp_pool=a.next,a.next=null),a.min=r,a.max=n,ke.stack.add(a)):((o=n.x-_.x+(n.y-_.y))<0&&(o=-o),(a=r.x-_.x+(r.y-_.y))<0&&(a=-a),a<o?(n.flag=_.flag=!0,null==Oe.zpp_pool?l=new Oe:(l=Oe.zpp_pool,Oe.zpp_pool=l.next,l.next=null),l.min=n,l.max=_,ke.stack.add(l),null==Oe.zpp_pool?p=new Oe:(p=Oe.zpp_pool,Oe.zpp_pool=p.next,p.next=null),p.min=_,p.max=n,ke.stack.add(p)):(r.flag=_.flag=!0,null==Oe.zpp_pool?h=new Oe:(h=Oe.zpp_pool,Oe.zpp_pool=h.next,h.next=null),h.min=r,h.max=_,ke.stack.add(h),null==Oe.zpp_pool?u=new Oe:(u=Oe.zpp_pool,Oe.zpp_pool=u.next,u.next=null),u.min=_,u.max=r,ke.stack.add(u))):(null==Oe.zpp_pool?c=new Oe:(c=Oe.zpp_pool,Oe.zpp_pool=c.next,c.next=null),c.min=d,c.max=_,ke.stack.add(c));null!=ke.stack.head;){var x=ke.stack.pop_unsafe(),v=x.min,g=x.max;x.min=x.max=null,x.next=Oe.zpp_pool,Oe.zpp_pool=x;for(var b,z,w=e,C=null,P=v.next;P!=g;){var T=ke.distance(P,v,g);w<T&&(w=T,C=P),P=P.next}null!=C&&(C.flag=!0,null==Oe.zpp_pool?b=new Oe:(b=Oe.zpp_pool,Oe.zpp_pool=b.next,b.next=null),b.min=v,b.max=C,ke.stack.add(b),null==Oe.zpp_pool?z=new Oe:(z=Oe.zpp_pool,Oe.zpp_pool=z.next,z.next=null),z.min=C,z.max=g,ke.stack.add(z))}for(var S,M,A,O,k=null;null!=i;)i.flag&&(S=i.x,A=i.y,null==nn.zpp_pool?M=new nn:(M=nn.zpp_pool,nn.zpp_pool=M.next,M.next=null),M.forced=!1,M.x=S,M.y=A,A=M,null==k?k=A.prev=A.next=A:(A.prev=k,A.next=k.next,k.next.prev=A,k.next=A),(k=A).forced=i.forced),i=null!=i&&i.prev==i?(i.next=i.prev=null,(O=i).next=Ae.zpp_pool,Ae.zpp_pool=O,null):(A=i.next,i.prev.next=i.next,i.next.prev=i.prev,i.next=i.prev=null,(O=i).next=Ae.zpp_pool,Ae.zpp_pool=O,i=null,A);return k},ke.prototype.__class__=ke;var Ee=zpp_nape.geom.ZPP_ToiEvent=function(){this.kinematic=!1,this.failed=!1,this.slipped=!1,this.axis=null,this.c2=null,this.c1=null,this.frozen2=!1,this.frozen1=!1,this.arbiter=null,this.s2=null,this.s1=null,this.toi=0,this.next=null,this.c1=new Ir,this.c2=new Ir,this.axis=new Ir};Ee.__name__=["zpp_nape","geom","ZPP_ToiEvent"],Ee.prototype.next=null,Ee.prototype.alloc=function(){this.failed=!1,this.s1=this.s2=null,this.arbiter=null},Ee.prototype.free=function(){},Ee.prototype.toi=null,Ee.prototype.s1=null,Ee.prototype.s2=null,Ee.prototype.arbiter=null,Ee.prototype.frozen1=null,Ee.prototype.frozen2=null,Ee.prototype.c1=null,Ee.prototype.c2=null,Ee.prototype.axis=null,Ee.prototype.slipped=null,Ee.prototype.failed=null,Ee.prototype.kinematic=null,Ee.prototype.__class__=Ee;var Ie=zpp_nape.geom.ZPP_SweepDistance=function(){};Ie.__name__=["zpp_nape","geom","ZPP_SweepDistance"],Ie.dynamicSweep=function(t,e,i,n,r){null==r&&(r=!1);var s=t.s1,o=t.s2,a=s.body,l=o.body,p=l.velx-a.velx,h=l.vely-a.vely,u=a.angvel;u<0&&(u=-u);var c=l.angvel;c<0&&(c=-c);var d=s.sweepCoef*u+o.sweepCoef*c;if(!r&&!t.kinematic&&p*p+h*h<kr.dynamicSweepLinearThreshold*kr.dynamicSweepLinearThreshold&&d<kr.dynamicSweepAngularThreshold)return t.toi=-1,void(t.failed=!0);for(var _=t.c1,y=t.c2,f=t.axis,m=i,x=0;;){var v,g,b=m*e,z=b-a.sweepTime;if(0!=z&&(a.sweepTime=b,a.posx+=a.velx*z,a.posy+=a.vely*z,0!=a.angvel&&(v=a.sweep_angvel*z,a.rot+=v,1e-4<v*v?(a.axisx=Math.sin(a.rot),a.axisy=Math.cos(a.rot)):(b=1-(g=v*v)*g/8,g=((z=1-.5*g)*a.axisx+v*a.axisy)*b,a.axisy=(z*a.axisy-v*a.axisx)*b,a.axisx=g))),0==s.type)s.worldCOMx=a.posx+(a.axisy*s.localCOMx-a.axisx*s.localCOMy),s.worldCOMy=a.posy+(s.localCOMx*a.axisx+s.localCOMy*a.axisy);else{for(var w=s.polygon,C=w.lverts.next,P=w.gverts.next;null!=P;){var T=P,S=C,C=C.next;T.x=a.posx+(a.axisy*S.x-a.axisx*S.y),T.y=a.posy+(S.x*a.axisx+S.y*a.axisy),P=P.next}for(var M=w.edges.head,A=O=w.gverts.next,O=O.next;null!=O;){var k=O,E=M.elt,M=M.next;E.gnormx=a.axisy*E.lnormx-a.axisx*E.lnormy,E.gnormy=E.lnormx*a.axisx+E.lnormy*a.axisy,E.gprojection=a.posx*E.gnormx+a.posy*E.gnormy+E.lprojection,E.tp0=A.y*E.gnormx-A.x*E.gnormy,E.tp1=k.y*E.gnormx-k.x*E.gnormy,A=k,O=O.next}var I=w.gverts.next,w=M.elt;w.gnormx=a.axisy*w.lnormx-a.axisx*w.lnormy,w.gnormy=w.lnormx*a.axisx+w.lnormy*a.axisy,w.gprojection=a.posx*w.gnormx+a.posy*w.gnormy+w.lprojection,w.tp0=A.y*w.gnormx-A.x*w.gnormy,w.tp1=I.y*w.gnormx-I.x*w.gnormy}I=m*e,w=I-l.sweepTime;if(0!=w&&(l.sweepTime=I,l.posx+=l.velx*w,l.posy+=l.vely*w,0!=l.angvel&&(q=l.sweep_angvel*w,l.rot+=q,1e-4<q*q?(l.axisx=Math.sin(l.rot),l.axisy=Math.cos(l.rot)):(Y=1-(K=q*q)*K/8,K=((H=1-.5*K)*l.axisx+q*l.axisy)*Y,l.axisy=(H*l.axisy-q*l.axisx)*Y,l.axisx=K))),0==o.type)o.worldCOMx=l.posx+(l.axisy*o.localCOMx-l.axisx*o.localCOMy),o.worldCOMy=l.posy+(o.localCOMx*l.axisx+o.localCOMy*l.axisy);else{for(var D=o.polygon,B=D.lverts.next,L=D.gverts.next;null!=L;){var R=L,F=B,B=B.next;R.x=l.posx+(l.axisy*F.x-l.axisx*F.y),R.y=l.posy+(F.x*l.axisx+F.y*l.axisy),L=L.next}for(var j=D.edges.head,N=G=D.gverts.next,G=G.next;null!=G;){var U=G,X=j.elt,j=j.next;X.gnormx=l.axisy*X.lnormx-l.axisx*X.lnormy,X.gnormy=X.lnormx*l.axisx+X.lnormy*l.axisy,X.gprojection=l.posx*X.gnormx+l.posy*X.gnormy+X.lprojection,X.tp0=N.y*X.gnormx-N.x*X.gnormy,X.tp1=U.y*X.gnormx-U.x*X.gnormy,N=U,G=G.next}var V=D.gverts.next,W=j.elt;W.gnormx=l.axisy*W.lnormx-l.axisx*W.lnormy,W.gnormy=W.lnormx*l.axisx+W.lnormy*l.axisy,W.gprojection=l.posx*W.gnormx+l.posy*W.gnormy+W.lprojection,W.tp0=N.y*W.gnormx-N.x*W.gnormy,W.tp1=V.y*W.gnormx-V.x*W.gnormy}var H=s,q=o,Y=_,K=y;if(0==s.type&&0==o.type){var Z,D=s.circle,V=o.circle,J=0,Q=0,J=V.worldCOMx-D.worldCOMx,Q=V.worldCOMy-D.worldCOMy,W=Math.sqrt(J*J+Q*Q),$=W-(D.radius+V.radius);$<1e100&&(0==W?(J=1,Q=0):(J*=Z=1/W,Q*=Z),Z=D.radius,_.x=D.worldCOMx+J*Z,_.y=D.worldCOMy+Q*Z,Z=-V.radius,y.x=V.worldCOMx+J*Z,y.y=V.worldCOMy+Q*Z,f.x=J,f.y=Q),J=$}else{Q=!1;if(0==s.type&&1==o.type&&(H=o,q=s,Y=y,K=_,Q=!0),1==H.type&&0==q.type){for(var $=H.polygon,tt=q.circle,et=-1e100,it=null,nt=$.edges.head;null!=nt;){var rt=nt.elt,st=rt.gnormx*tt.worldCOMx+rt.gnormy*tt.worldCOMy-rt.gprojection-tt.radius;if(1e100<st){et=st;break}0<st?et<st&&(et=st,it=rt):et<0&&et<st&&(et=st,it=rt),nt=nt.next}et<1e100&&(Pt=it.gp0,Lt=it.gp1,(Ft=tt.worldCOMy*it.gnormx-tt.worldCOMx*it.gnormy)<=Pt.y*it.gnormx-Pt.x*it.gnormy?(Rt=Dt=0,Dt=tt.worldCOMx-Pt.x,Rt=tt.worldCOMy-Pt.y,(et=($=Math.sqrt(Dt*Dt+Rt*Rt))-tt.radius)<1e100&&(0==$?(Dt=1,Rt=0):(Dt*=Ct=1/$,Rt*=Ct),Y.x=Pt.x+0*Dt,Y.y=Pt.y+0*Rt,Tt=-tt.radius,K.x=tt.worldCOMx+Dt*Tt,K.y=tt.worldCOMy+Rt*Tt,f.x=Dt,f.y=Rt)):Ft>=Lt.y*it.gnormx-Lt.x*it.gnormy?(At=Mt=0,Mt=tt.worldCOMx-Lt.x,At=tt.worldCOMy-Lt.y,(et=(It=Math.sqrt(Mt*Mt+At*At))-tt.radius)<1e100&&(0==It?(Mt=1,At=0):(Mt*=Bt=1/It,At*=Bt),Y.x=Lt.x+0*Mt,Y.y=Lt.y+0*At,St=-tt.radius,K.x=tt.worldCOMx+Mt*St,K.y=tt.worldCOMy+At*St,f.x=Mt,f.y=At)):(Ot=-tt.radius,K.x=tt.worldCOMx+it.gnormx*Ot,K.y=tt.worldCOMy+it.gnormy*Ot,kt=-et,Y.x=K.x+it.gnormx*kt,Y.y=K.y+it.gnormy*kt,f.x=it.gnormx,f.y=it.gnormy)),Q&&(f.x=-f.x,f.y=-f.y),J=et}else{for(var ot=H.polygon,at=q.polygon,lt=-1e100,pt=null,ht=null,ut=0,ct=ot.edges.head;null!=ct;){for(var dt=ct.elt,_t=1e100,yt=at.gverts.next;null!=yt;){var ft=dt.gnormx*yt.x+dt.gnormy*yt.y;ft<_t&&(_t=ft),yt=yt.next}if(1e100<(_t-=dt.gprojection)){lt=_t;break}0<_t?lt<_t&&(lt=_t,pt=dt,ut=1):lt<0&&lt<_t&&(lt=_t,pt=dt,ut=1),ct=ct.next}if(lt<1e100){for(var mt,xt,vt=at.edges.head;null!=vt;){for(var gt=vt.elt,bt=1e100,zt=ot.gverts.next;null!=zt;){var wt=gt.gnormx*zt.x+gt.gnormy*zt.y;wt<bt&&(bt=wt),zt=zt.next}if(1e100<(bt-=gt.gprojection)){lt=bt;break}0<bt?lt<bt&&(lt=bt,ht=gt,ut=2):lt<0&&lt<bt&&(lt=bt,ht=gt,ut=2),vt=vt.next}if(lt<1e100){1==ut?(mt=at,xt=pt):(mt=ot,xt=ht,Et=Y,Y=K,K=Et,Q=!Q);for(var Ct,Pt,Tt,St,Mt,At,Ot,kt,Et,It,Dt,Bt,Lt,Rt,Ft,jt,Nt,Gt,Ut,Xt,Vt,Wt,Ht=null,qt=1e100,Yt=mt.edges.head;null!=Yt;){var Kt=Yt.elt,Zt=xt.gnormx*Kt.gnormx+xt.gnormy*Kt.gnormy;Zt<qt&&(qt=Zt,Ht=Kt),Yt=Yt.next}Q?(f.x=-xt.gnormx,f.y=-xt.gnormy):(f.x=xt.gnormx,f.y=xt.gnormy),J=0<=lt?(Ct=xt.gp0,Pt=xt.gp1,Tt=Ht.gp0,Gt=Ht.gp1,Ft=Rt=Vt=Dt=0,Wt=1/((Dt=Pt.x-Ct.x)*Dt+(Vt=Pt.y-Ct.y)*Vt),It=1/((Rt=Gt.x-Tt.x)*Rt+(Ft=Gt.y-Tt.y)*Ft),(Ut=-(Dt*(Ct.x-Tt.x)+Vt*(Ct.y-Tt.y))*Wt)<0?Ut=0:1<Ut&&(Ut=1),(Bt=-(Dt*(Ct.x-Gt.x)+Vt*(Ct.y-Gt.y))*Wt)<0?Bt=0:1<Bt&&(Bt=1),(Lt=-(Rt*(Tt.x-Ct.x)+Ft*(Tt.y-Ct.y))*It)<0?Lt=0:1<Lt&&(Lt=1),(jt=-(Rt*(Tt.x-Pt.x)+Ft*(Tt.y-Pt.y))*It)<0?jt=0:1<jt&&(jt=1),Mt=St=0,St=Ct.x+Dt*Ut,Mt=Ct.y+Vt*Ut,Nt=At=0,At=Ct.x+Dt*Bt,Nt=Ct.y+Vt*Bt,kt=Ot=0,Ot=Tt.x+Rt*Lt,kt=Tt.y+Ft*Lt,q=H=0,H=Tt.x+Rt*jt,q=Tt.y+Ft*jt,Ft=Rt=Lt=Bt=Vt=Dt=Ut=It=Wt=Et=0,jt=null,(Wt=(Et=St-Tt.x)*Et+(Wt=Mt-Tt.y)*Wt)<(Ut=(It=At-Gt.x)*It+(Ut=Nt-Gt.y)*Ut)?(Rt=St,Ft=Mt,jt=Tt):(Rt=At,Ft=Nt,jt=Gt,Wt=Ut),Gt=Nt=0,Ut=null,(Vt=(Dt=Ot-Ct.x)*Dt+(Vt=kt-Ct.y)*Vt)<(Lt=(Bt=H-Pt.x)*Bt+(Lt=q-Pt.y)*Lt)?(Nt=Ot,Gt=kt,Ut=Ct):(Nt=H,Gt=q,Ut=Pt,Vt=Lt),0!=(lt=Wt<Vt?(Y.x=Rt,Y.y=Ft,K.x=jt.x,K.y=jt.y,Math.sqrt(Wt)):(K.x=Nt,K.y=Gt,Y.x=Ut.x,Y.y=Ut.y,Math.sqrt(Vt)))&&(f.x=K.x-Y.x,f.y=K.y-Y.y,Xt=1/lt,f.x*=Xt,f.y*=Xt,Q&&(f.x=-f.x,f.y=-f.y)),lt):(Wt=jt=0,jt=Ht.gp0.x,Wt=Ht.gp0.y,Vt=Ut=Gt=Nt=0,Ut=(Nt=Ht.gp1.x)-jt,Vt=(Gt=Ht.gp1.y)-Wt,Xt=xt.gnormy*jt-xt.gnormx*Wt,Qt=1/((Q=xt.gnormy*Nt-xt.gnormx*Gt)-Xt),(Xt=(-xt.tp1-Xt)*Qt)>kr.epsilon&&(jt+=Ut*Xt,Wt+=Vt*Xt),(Qt=(-xt.tp0-Q)*Qt)<-kr.epsilon&&(Nt+=Ut*Qt,Gt+=Vt*Qt),(Vt=jt*xt.gnormx+Wt*xt.gnormy-xt.gprojection)<(Qt=Nt*xt.gnormx+Gt*xt.gnormy-xt.gprojection)?(K.x=jt,K.y=Wt,Wt=-Vt,Y.x=K.x+xt.gnormx*Wt,Y.y=K.y+xt.gnormy*Wt,Vt):(K.x=Nt,K.y=Gt,Jt=-Qt,Y.x=K.x+xt.gnormx*Jt,Y.y=K.y+xt.gnormy*Jt,Qt))}else J=1e100}else J=1e100}}var K=J+n,Jt=p*f.x+h*f.y;if(K<kr.distanceThresholdCCD){if(r)break;var Qt=0,$t=0,Qt=_.x-a.posx,$t=_.y-a.posy,te=0,ee=0,te=y.x-l.posx,ee=y.y-l.posy,$t=Jt-a.sweep_angvel*(f.y*Qt-f.x*$t)+l.sweep_angvel*(f.y*te-f.x*ee);if(0<$t&&(t.slipped=!0),$t<=0||K<.5*kr.distanceThresholdCCD)break}te=(d-Jt)*e;if(te<=0){m=-1;break}ee=K/te;if(ee<1e-6&&(ee=1e-6),1<=(m+=ee)){$t=(m=1)*e,Jt=$t-a.sweepTime;if(0!=Jt&&(a.sweepTime=$t,a.posx+=a.velx*Jt,a.posy+=a.vely*Jt,0!=a.angvel&&(te=a.sweep_angvel*Jt,a.rot+=te,1e-4<te*te?(a.axisx=Math.sin(a.rot),a.axisy=Math.cos(a.rot)):($t=1-(ee=te*te)*ee/8,ee=((Jt=1-.5*ee)*a.axisx+te*a.axisy)*$t,a.axisy=(Jt*a.axisy-te*a.axisx)*$t,a.axisx=ee))),0==s.type)s.worldCOMx=a.posx+(a.axisy*s.localCOMx-a.axisx*s.localCOMy),s.worldCOMy=a.posy+(s.localCOMx*a.axisx+s.localCOMy*a.axisy);else{for(var ie=s.polygon,ne=ie.lverts.next,re=ie.gverts.next;null!=re;){var se=re,oe=ne,ne=ne.next;se.x=a.posx+(a.axisy*oe.x-a.axisx*oe.y),se.y=a.posy+(oe.x*a.axisx+oe.y*a.axisy),re=re.next}for(var ae=ie.edges.head,le=pe=ie.gverts.next,pe=pe.next;null!=pe;){var he=pe,ue=ae.elt,ae=ae.next;ue.gnormx=a.axisy*ue.lnormx-a.axisx*ue.lnormy,ue.gnormy=ue.lnormx*a.axisx+ue.lnormy*a.axisy,ue.gprojection=a.posx*ue.gnormx+a.posy*ue.gnormy+ue.lprojection,ue.tp0=le.y*ue.gnormx-le.x*ue.gnormy,ue.tp1=he.y*ue.gnormx-he.x*ue.gnormy,le=he,pe=pe.next}var ce=ie.gverts.next,ie=ae.elt;ie.gnormx=a.axisy*ie.lnormx-a.axisx*ie.lnormy,ie.gnormy=ie.lnormx*a.axisx+ie.lnormy*a.axisy,ie.gprojection=a.posx*ie.gnormx+a.posy*ie.gnormy+ie.lprojection,ie.tp0=le.y*ie.gnormx-le.x*ie.gnormy,ie.tp1=ce.y*ie.gnormx-ce.x*ie.gnormy}ce=m*e,ie=ce-l.sweepTime;if(0!=ie&&(l.sweepTime=ce,l.posx+=l.velx*ie,l.posy+=l.vely*ie,0!=l.angvel&&(Se=l.sweep_angvel*ie,l.rot+=Se,1e-4<Se*Se?(l.axisx=Math.sin(l.rot),l.axisy=Math.cos(l.rot)):(Me=1-(Pe=Se*Se)*Pe/8,Oe=((Te=1-.5*Pe)*l.axisx+Se*l.axisy)*Me,l.axisy=(Te*l.axisy-Se*l.axisx)*Me,l.axisx=Oe))),0==o.type)o.worldCOMx=l.posx+(l.axisy*o.localCOMx-l.axisx*o.localCOMy),o.worldCOMy=l.posy+(o.localCOMx*l.axisx+o.localCOMy*l.axisy);else{for(var de=o.polygon,_e=de.lverts.next,ye=de.gverts.next;null!=ye;){var fe=ye,me=_e,_e=_e.next;fe.x=l.posx+(l.axisy*me.x-l.axisx*me.y),fe.y=l.posy+(me.x*l.axisx+me.y*l.axisy),ye=ye.next}for(var xe=de.edges.head,ve=ge=de.gverts.next,ge=ge.next;null!=ge;){var be=ge,ze=xe.elt,xe=xe.next;ze.gnormx=l.axisy*ze.lnormx-l.axisx*ze.lnormy,ze.gnormy=ze.lnormx*l.axisx+ze.lnormy*l.axisy,ze.gprojection=l.posx*ze.gnormx+l.posy*ze.gnormy+ze.lprojection,ze.tp0=ve.y*ze.gnormx-ve.x*ze.gnormy,ze.tp1=be.y*ze.gnormx-be.x*ze.gnormy,ve=be,ge=ge.next}var we=de.gverts.next,Ce=xe.elt;Ce.gnormx=l.axisy*Ce.lnormx-l.axisx*Ce.lnormy,Ce.gnormy=Ce.lnormx*l.axisx+Ce.lnormy*l.axisy,Ce.gprojection=l.posx*Ce.gnormx+l.posy*Ce.gnormy+Ce.lprojection,Ce.tp0=ve.y*Ce.gnormx-ve.x*Ce.gnormy,Ce.tp1=we.y*Ce.gnormx-we.x*Ce.gnormy}var Pe=s,Te=o,Se=_,Me=y;if(0==s.type&&0==o.type){var Ae,Oe=s.circle,de=o.circle,we=0,ke=0,we=de.worldCOMx-Oe.worldCOMx,ke=de.worldCOMy-Oe.worldCOMy,Ce=Math.sqrt(we*we+ke*ke),Ee=Ce-(Oe.radius+de.radius);Ee<1e100&&(0==Ce?(we=1,ke=0):(we*=Ae=1/Ce,ke*=Ae),Ae=Oe.radius,_.x=Oe.worldCOMx+we*Ae,_.y=Oe.worldCOMy+ke*Ae,Ae=-de.radius,y.x=de.worldCOMx+we*Ae,y.y=de.worldCOMy+ke*Ae,f.x=we,f.y=ke),ke=Ee}else{Ee=!1;if(0==s.type&&1==o.type&&(Pe=o,Te=s,Se=y,Me=_,Ee=!0),1==Pe.type&&0==Te.type){for(var Ie=Pe.polygon,De=Te.circle,Be=-1e100,Le=null,Re=Ie.edges.head;null!=Re;){var Fe=Re.elt,je=Fe.gnormx*De.worldCOMx+Fe.gnormy*De.worldCOMy-Fe.gprojection-De.radius;if(1e100<je){Be=je;break}0<je?Be<je&&(Be=je,Le=Fe):Be<0&&Be<je&&(Be=je,Le=Fe),Re=Re.next}Be<1e100&&(_i=Le.gp0,vi=Le.gp1,(di=De.worldCOMy*Le.gnormx-De.worldCOMx*Le.gnormy)<=_i.y*Le.gnormx-_i.x*Le.gnormy?(ci=xi=0,xi=De.worldCOMx-_i.x,ci=De.worldCOMy-_i.y,(Be=(ri=Math.sqrt(xi*xi+ci*ci))-De.radius)<1e100&&(0==ri?(xi=1,ci=0):(xi*=si=1/ri,ci*=si),Se.x=_i.x+0*xi,Se.y=_i.y+0*ci,mi=-De.radius,Me.x=De.worldCOMx+xi*mi,Me.y=De.worldCOMy+ci*mi,f.x=xi,f.y=ci)):di>=vi.y*Le.gnormx-vi.x*Le.gnormy?(li=ai=0,ai=De.worldCOMx-vi.x,li=De.worldCOMy-vi.y,(Be=(yi=Math.sqrt(ai*ai+li*li))-De.radius)<1e100&&(0==yi?(ai=1,li=0):(ai*=fi=1/yi,li*=fi),Se.x=vi.x+0*ai,Se.y=vi.y+0*li,oi=-De.radius,Me.x=De.worldCOMx+ai*oi,Me.y=De.worldCOMy+li*oi,f.x=ai,f.y=li)):(pi=-De.radius,Me.x=De.worldCOMx+Le.gnormx*pi,Me.y=De.worldCOMy+Le.gnormy*pi,hi=-Be,Se.x=Me.x+Le.gnormx*hi,Se.y=Me.y+Le.gnormy*hi,f.x=Le.gnormx,f.y=Le.gnormy)),Ee&&(f.x=-f.x,f.y=-f.y),ke=Be}else{for(var Ne=Pe.polygon,Ge=Te.polygon,Ue=-1e100,Xe=null,Ve=null,We=0,He=Ne.edges.head;null!=He;){for(var qe=He.elt,Ye=1e100,Ke=Ge.gverts.next;null!=Ke;){var Ze=qe.gnormx*Ke.x+qe.gnormy*Ke.y;Ze<Ye&&(Ye=Ze),Ke=Ke.next}if(1e100<(Ye-=qe.gprojection)){Ue=Ye;break}0<Ye?Ue<Ye&&(Ue=Ye,Xe=qe,We=1):Ue<0&&Ue<Ye&&(Ue=Ye,Xe=qe,We=1),He=He.next}if(Ue<1e100){for(var Je,Qe,$e=Ge.edges.head;null!=$e;){for(var ti=$e.elt,ei=1e100,ii=Ne.gverts.next;null!=ii;){var ni=ti.gnormx*ii.x+ti.gnormy*ii.y;ni<ei&&(ei=ni),ii=ii.next}if(1e100<(ei-=ti.gprojection)){Ue=ei;break}0<ei?Ue<ei&&(Ue=ei,Ve=ti,We=2):Ue<0&&Ue<ei&&(Ue=ei,Ve=ti,We=2),$e=$e.next}if(Ue<1e100){1==We?(Je=Ge,Qe=Xe):(Je=Ne,Qe=Ve,ui=Se,Se=Me,Me=ui,Ee=!Ee);for(var ri,si,oi,ai,li,pi,hi,ui,ci,di,_i,yi,fi,mi,xi,vi,gi,bi,zi,wi,Ci,Pi=null,Ti=1e100,Si=Je.edges.head;null!=Si;){var Mi=Si.elt,Ai=Qe.gnormx*Mi.gnormx+Qe.gnormy*Mi.gnormy;Ai<Ti&&(Ti=Ai,Pi=Mi),Si=Si.next}Ee?(f.x=-Qe.gnormx,f.y=-Qe.gnormy):(f.x=Qe.gnormx,f.y=Qe.gnormy),ke=0<=Ue?(Ie=Qe.gp0,ri=Qe.gp1,si=Pi.gp0,Ci=Pi.gp1,xi=mi=wi=_i=0,ci=1/((_i=ri.x-Ie.x)*_i+(wi=ri.y-Ie.y)*wi),di=1/((mi=Ci.x-si.x)*mi+(xi=Ci.y-si.y)*xi),(bi=-(_i*(Ie.x-si.x)+wi*(Ie.y-si.y))*ci)<0?bi=0:1<bi&&(bi=1),(yi=-(_i*(Ie.x-Ci.x)+wi*(Ie.y-Ci.y))*ci)<0?yi=0:1<yi&&(yi=1),(fi=-(mi*(si.x-Ie.x)+xi*(si.y-Ie.y))*di)<0?fi=0:1<fi&&(fi=1),(vi=-(mi*(si.x-ri.x)+xi*(si.y-ri.y))*di)<0?vi=0:1<vi&&(vi=1),ai=oi=0,oi=Ie.x+_i*bi,ai=Ie.y+wi*bi,gi=li=0,li=Ie.x+_i*yi,gi=Ie.y+wi*yi,hi=pi=0,pi=si.x+mi*fi,hi=si.y+xi*fi,Te=Pe=0,Pe=si.x+mi*vi,Te=si.y+xi*vi,xi=mi=fi=yi=wi=_i=bi=di=ci=ui=0,vi=null,(ci=(ui=oi-si.x)*ui+(ci=ai-si.y)*ci)<(bi=(di=li-Ci.x)*di+(bi=gi-Ci.y)*bi)?(mi=oi,xi=ai,vi=si):(mi=li,xi=gi,vi=Ci,ci=bi),Ci=gi=0,bi=null,(wi=(_i=pi-Ie.x)*_i+(wi=hi-Ie.y)*wi)<(fi=(yi=Pe-ri.x)*yi+(fi=Te-ri.y)*fi)?(gi=pi,Ci=hi,bi=Ie):(gi=Pe,Ci=Te,bi=ri,wi=fi),0!=(Ue=ci<wi?(Se.x=mi,Se.y=xi,Me.x=vi.x,Me.y=vi.y,Math.sqrt(ci)):(Me.x=gi,Me.y=Ci,Se.x=bi.x,Se.y=bi.y,Math.sqrt(wi)))&&(f.x=Me.x-Se.x,f.y=Me.y-Se.y,zi=1/Ue,f.x*=zi,f.y*=zi,Ee&&(f.x=-f.x,f.y=-f.y)),Ue):(Ci=gi=0,gi=Pi.gp0.x,Ci=Pi.gp0.y,wi=bi=ki=Oi=0,bi=(Oi=Pi.gp1.x)-gi,wi=(ki=Pi.gp1.y)-Ci,zi=Qe.gnormy*gi-Qe.gnormx*Ci,Ii=1/((Ee=Qe.gnormy*Oi-Qe.gnormx*ki)-zi),(zi=(-Qe.tp1-zi)*Ii)>kr.epsilon&&(gi+=bi*zi,Ci+=wi*zi),(Ii=(-Qe.tp0-Ee)*Ii)<-kr.epsilon&&(Oi+=bi*Ii,ki+=wi*Ii),(wi=gi*Qe.gnormx+Ci*Qe.gnormy-Qe.gprojection)<(Ii=Oi*Qe.gnormx+ki*Qe.gnormy-Qe.gprojection)?(Me.x=gi,Me.y=Ci,Ci=-wi,Se.x=Me.x+Qe.gnormx*Ci,Se.y=Me.y+Qe.gnormy*Ci,wi):(Me.x=Oi,Me.y=ki,Ei=-Ii,Se.x=Me.x+Qe.gnormx*Ei,Se.y=Me.y+Qe.gnormy*Ei,Ii))}else ke=1e100}else ke=1e100}}var Oi=ke+n,ki=p*f.x+h*f.y;if(Oi<kr.distanceThresholdCCD){if(r)break;var Se=0,Me=0,Se=_.x-a.posx,Me=_.y-a.posy,Ei=0,Ii=0,Ei=y.x-l.posx,Ii=y.y-l.posy,Ii=ki-a.sweep_angvel*(f.y*Se-f.x*Me)+l.sweep_angvel*(f.y*Ei-f.x*Ii);if(0<Ii&&(t.slipped=!0),Ii<=0||Oi<.5*kr.distanceThresholdCCD)break}m=-1;break}if(40<=++x){n<K&&(t.failed=!0);break}}t.toi=m},Ie.staticSweep=function(t,e,i,n){var r=t.s1,s=t.s2,o=r.body,a=-o.velx,l=-o.vely,p=o.sweep_angvel;p<0&&(p=-p);for(var h=r.sweepCoef*p,u=t.c1,c=t.c2,d=t.axis,_=i,y=0;;){var f=_*e,m=f-o.sweepTime;if(0!=m&&(o.sweepTime=f,o.posx+=o.velx*m,o.posy+=o.vely*m,0!=o.angvel&&(k=o.sweep_angvel*m,o.rot+=k,1e-4<k*k?(o.axisx=Math.sin(o.rot),o.axisy=Math.cos(o.rot)):(E=1-(I=k*k)*I/8,I=((O=1-.5*I)*o.axisx+k*o.axisy)*E,o.axisy=(O*o.axisy-k*o.axisx)*E,o.axisx=I))),0==r.type)r.worldCOMx=o.posx+(o.axisy*r.localCOMx-o.axisx*r.localCOMy),r.worldCOMy=o.posy+(r.localCOMx*o.axisx+r.localCOMy*o.axisy);else{for(var x=r.polygon,v=x.lverts.next,g=x.gverts.next;null!=g;){var b=g,z=v,v=v.next;b.x=o.posx+(o.axisy*z.x-o.axisx*z.y),b.y=o.posy+(z.x*o.axisx+z.y*o.axisy),g=g.next}for(var w=x.edges.head,C=P=x.gverts.next,P=P.next;null!=P;){var T=P,S=w.elt,w=w.next;S.gnormx=o.axisy*S.lnormx-o.axisx*S.lnormy,S.gnormy=S.lnormx*o.axisx+S.lnormy*o.axisy,S.gprojection=o.posx*S.gnormx+o.posy*S.gnormy+S.lprojection,S.tp0=C.y*S.gnormx-C.x*S.gnormy,S.tp1=T.y*S.gnormx-T.x*S.gnormy,C=T,P=P.next}var M=x.gverts.next,A=w.elt;A.gnormx=o.axisy*A.lnormx-o.axisx*A.lnormy,A.gnormy=A.lnormx*o.axisx+A.lnormy*o.axisy,A.gprojection=o.posx*A.gnormx+o.posy*A.gnormy+A.lprojection,A.tp0=C.y*A.gnormx-C.x*A.gnormy,A.tp1=M.y*A.gnormx-M.x*A.gnormy}var O=r,k=s,E=u,I=c;if(0==r.type&&0==s.type){var D,x=r.circle,M=s.circle,B=0,L=0,B=M.worldCOMx-x.worldCOMx,L=M.worldCOMy-x.worldCOMy,A=Math.sqrt(B*B+L*L),R=A-(x.radius+M.radius);R<1e100&&(0==A?(B=1,L=0):(B*=D=1/A,L*=D),D=x.radius,u.x=x.worldCOMx+B*D,u.y=x.worldCOMy+L*D,D=-M.radius,c.x=M.worldCOMx+B*D,c.y=M.worldCOMy+L*D,d.x=B,d.y=L),B=R}else{L=!1;if(0==r.type&&1==s.type&&(O=s,k=r,E=c,I=u,L=!0),1==O.type&&0==k.type){for(var R=O.polygon,F=k.circle,j=-1e100,N=null,G=R.edges.head;null!=G;){var U=G.elt,X=U.gnormx*F.worldCOMx+U.gnormy*F.worldCOMy-U.gprojection-F.radius;if(1e100<X){j=X;break}0<X?j<X&&(j=X,N=U):j<0&&j<X&&(j=X,N=U),G=G.next}j<1e100&&(pt=N.gp0,gt=N.gp1,(zt=F.worldCOMy*N.gnormx-F.worldCOMx*N.gnormy)<=pt.y*N.gnormx-pt.x*N.gnormy?(bt=xt=0,xt=F.worldCOMx-pt.x,bt=F.worldCOMy-pt.y,(j=(R=Math.sqrt(xt*xt+bt*bt))-F.radius)<1e100&&(0==R?(xt=1,bt=0):(xt*=lt=1/R,bt*=lt),E.x=pt.x+0*xt,E.y=pt.y+0*bt,ht=-F.radius,I.x=F.worldCOMx+xt*ht,I.y=F.worldCOMy+bt*ht,d.x=xt,d.y=bt)):zt>=gt.y*N.gnormx-gt.x*N.gnormy?(dt=ct=0,ct=F.worldCOMx-gt.x,dt=F.worldCOMy-gt.y,(j=(mt=Math.sqrt(ct*ct+dt*dt))-F.radius)<1e100&&(0==mt?(ct=1,dt=0):(ct*=vt=1/mt,dt*=vt),E.x=gt.x+0*ct,E.y=gt.y+0*dt,ut=-F.radius,I.x=F.worldCOMx+ct*ut,I.y=F.worldCOMy+dt*ut,d.x=ct,d.y=dt)):(_t=-F.radius,I.x=F.worldCOMx+N.gnormx*_t,I.y=F.worldCOMy+N.gnormy*_t,yt=-j,E.x=I.x+N.gnormx*yt,E.y=I.y+N.gnormy*yt,d.x=N.gnormx,d.y=N.gnormy)),L&&(d.x=-d.x,d.y=-d.y),B=j}else{for(var V=O.polygon,W=k.polygon,H=-1e100,q=null,Y=null,K=0,Z=V.edges.head;null!=Z;){for(var J=Z.elt,Q=1e100,$=W.gverts.next;null!=$;){var tt=J.gnormx*$.x+J.gnormy*$.y;tt<Q&&(Q=tt),$=$.next}if(1e100<(Q-=J.gprojection)){H=Q;break}0<Q?H<Q&&(H=Q,q=J,K=1):H<0&&H<Q&&(H=Q,q=J,K=1),Z=Z.next}if(H<1e100){for(var et,it,nt=W.edges.head;null!=nt;){for(var rt=nt.elt,st=1e100,ot=V.gverts.next;null!=ot;){var at=rt.gnormx*ot.x+rt.gnormy*ot.y;at<st&&(st=at),ot=ot.next}if(1e100<(st-=rt.gprojection)){H=st;break}0<st?H<st&&(H=st,Y=rt,K=2):H<0&&H<st&&(H=st,Y=rt,K=2),nt=nt.next}if(H<1e100){1==K?(et=W,it=q):(et=V,it=Y,ft=E,E=I,I=ft,L=!L);for(var lt,pt,ht,ut,ct,dt,_t,yt,ft,mt,xt,vt,gt,bt,zt,wt,Ct,Pt,Tt,St,Mt,At,Ot=null,kt=1e100,Et=et.edges.head;null!=Et;){var It=Et.elt,Dt=it.gnormx*It.gnormx+it.gnormy*It.gnormy;Dt<kt&&(kt=Dt,Ot=It),Et=Et.next}L?(d.x=-it.gnormx,d.y=-it.gnormy):(d.x=it.gnormx,d.y=it.gnormy),B=0<=H?(lt=it.gp0,pt=it.gp1,ht=Ot.gp0,Pt=Ot.gp1,zt=bt=Mt=xt=0,At=1/((xt=pt.x-lt.x)*xt+(Mt=pt.y-lt.y)*Mt),mt=1/((bt=Pt.x-ht.x)*bt+(zt=Pt.y-ht.y)*zt),(Tt=-(xt*(lt.x-ht.x)+Mt*(lt.y-ht.y))*At)<0?Tt=0:1<Tt&&(Tt=1),(vt=-(xt*(lt.x-Pt.x)+Mt*(lt.y-Pt.y))*At)<0?vt=0:1<vt&&(vt=1),(gt=-(bt*(ht.x-lt.x)+zt*(ht.y-lt.y))*mt)<0?gt=0:1<gt&&(gt=1),(wt=-(bt*(ht.x-pt.x)+zt*(ht.y-pt.y))*mt)<0?wt=0:1<wt&&(wt=1),ct=ut=0,ut=lt.x+xt*Tt,ct=lt.y+Mt*Tt,Ct=dt=0,dt=lt.x+xt*vt,Ct=lt.y+Mt*vt,yt=_t=0,_t=ht.x+bt*gt,yt=ht.y+zt*gt,k=O=0,O=ht.x+bt*wt,k=ht.y+zt*wt,zt=bt=gt=vt=Mt=xt=Tt=mt=At=ft=0,wt=null,(At=(ft=ut-ht.x)*ft+(At=ct-ht.y)*At)<(Tt=(mt=dt-Pt.x)*mt+(Tt=Ct-Pt.y)*Tt)?(bt=ut,zt=ct,wt=ht):(bt=dt,zt=Ct,wt=Pt,At=Tt),Pt=Ct=0,Tt=null,(Mt=(xt=_t-lt.x)*xt+(Mt=yt-lt.y)*Mt)<(gt=(vt=O-pt.x)*vt+(gt=k-pt.y)*gt)?(Ct=_t,Pt=yt,Tt=lt):(Ct=O,Pt=k,Tt=pt,Mt=gt),0!=(H=At<Mt?(E.x=bt,E.y=zt,I.x=wt.x,I.y=wt.y,Math.sqrt(At)):(I.x=Ct,I.y=Pt,E.x=Tt.x,E.y=Tt.y,Math.sqrt(Mt)))&&(d.x=I.x-E.x,d.y=I.y-E.y,St=1/H,d.x*=St,d.y*=St,L&&(d.x=-d.x,d.y=-d.y)),H):(At=wt=0,wt=Ot.gp0.x,At=Ot.gp0.y,Mt=Tt=Pt=Ct=0,Tt=(Ct=Ot.gp1.x)-wt,Mt=(Pt=Ot.gp1.y)-At,St=it.gnormy*wt-it.gnormx*At,Lt=1/((L=it.gnormy*Ct-it.gnormx*Pt)-St),(St=(-it.tp1-St)*Lt)>kr.epsilon&&(wt+=Tt*St,At+=Mt*St),(Lt=(-it.tp0-L)*Lt)<-kr.epsilon&&(Ct+=Tt*Lt,Pt+=Mt*Lt),(Mt=wt*it.gnormx+At*it.gnormy-it.gprojection)<(Lt=Ct*it.gnormx+Pt*it.gnormy-it.gprojection)?(I.x=wt,I.y=At,At=-Mt,E.x=I.x+it.gnormx*At,E.y=I.y+it.gnormy*At,Mt):(I.x=Ct,I.y=Pt,Bt=-Lt,E.x=I.x+it.gnormx*Bt,E.y=I.y+it.gnormy*Bt,Lt))}else B=1e100}else B=1e100}}var I=B+n,Bt=a*d.x+l*d.y;if(I<kr.distanceThresholdCCD){var Lt=0,Lt=u.x-o.posx,Rt=u.y-o.posy,Rt=Bt-o.sweep_angvel*(d.y*Lt-d.x*Rt);if(0<Rt&&(t.slipped=!0),Rt<=0||I<.5*kr.distanceThresholdCCD)break}Rt=(h-Bt)*e;if(Rt<=0){_=-1;break}Bt=I/Rt;if(Bt<1e-6&&(Bt=1e-6),1<=(_+=Bt)){Rt=(_=1)*e,Bt=Rt-o.sweepTime;if(0!=Bt&&(o.sweepTime=Rt,o.posx+=o.velx*Bt,o.posy+=o.vely*Bt,0!=o.angvel&&(Jt=o.sweep_angvel*Bt,o.rot+=Jt,1e-4<Jt*Jt?(o.axisx=Math.sin(o.rot),o.axisy=Math.cos(o.rot)):(Qt=1-($t=Jt*Jt)*$t/8,$t=((Zt=1-.5*$t)*o.axisx+Jt*o.axisy)*Qt,o.axisy=(Zt*o.axisy-Jt*o.axisx)*Qt,o.axisx=$t))),0==r.type)r.worldCOMx=o.posx+(o.axisy*r.localCOMx-o.axisx*r.localCOMy),r.worldCOMy=o.posy+(r.localCOMx*o.axisx+r.localCOMy*o.axisy);else{for(var Ft=r.polygon,jt=Ft.lverts.next,Nt=Ft.gverts.next;null!=Nt;){var Gt=Nt,Ut=jt,jt=jt.next;Gt.x=o.posx+(o.axisy*Ut.x-o.axisx*Ut.y),Gt.y=o.posy+(Ut.x*o.axisx+Ut.y*o.axisy),Nt=Nt.next}for(var Xt=Ft.edges.head,Vt=Wt=Ft.gverts.next,Wt=Wt.next;null!=Wt;){var Ht=Wt,qt=Xt.elt,Xt=Xt.next;qt.gnormx=o.axisy*qt.lnormx-o.axisx*qt.lnormy,qt.gnormy=qt.lnormx*o.axisx+qt.lnormy*o.axisy,qt.gprojection=o.posx*qt.gnormx+o.posy*qt.gnormy+qt.lprojection,qt.tp0=Vt.y*qt.gnormx-Vt.x*qt.gnormy,qt.tp1=Ht.y*qt.gnormx-Ht.x*qt.gnormy,Vt=Ht,Wt=Wt.next}var Yt=Ft.gverts.next,Kt=Xt.elt;Kt.gnormx=o.axisy*Kt.lnormx-o.axisx*Kt.lnormy,Kt.gnormy=Kt.lnormx*o.axisx+Kt.lnormy*o.axisy,Kt.gprojection=o.posx*Kt.gnormx+o.posy*Kt.gnormy+Kt.lprojection,Kt.tp0=Vt.y*Kt.gnormx-Vt.x*Kt.gnormy,Kt.tp1=Yt.y*Kt.gnormx-Yt.x*Kt.gnormy}var Zt=r,Jt=s,Qt=u,$t=c;if(0==r.type&&0==s.type){var te,Ft=r.circle,Yt=s.circle,ee=0,ie=0,ee=Yt.worldCOMx-Ft.worldCOMx,ie=Yt.worldCOMy-Ft.worldCOMy,Kt=Math.sqrt(ee*ee+ie*ie),ne=Kt-(Ft.radius+Yt.radius);ne<1e100&&(0==Kt?(ee=1,ie=0):(ee*=te=1/Kt,ie*=te),te=Ft.radius,u.x=Ft.worldCOMx+ee*te,u.y=Ft.worldCOMy+ie*te,te=-Yt.radius,c.x=Yt.worldCOMx+ee*te,c.y=Yt.worldCOMy+ie*te,d.x=ee,d.y=ie),ee=ne}else{ie=!1;if(0==r.type&&1==s.type&&(Zt=s,Jt=r,Qt=c,$t=u,ie=!0),1==Zt.type&&0==Jt.type){for(var ne=Zt.polygon,re=Jt.circle,se=-1e100,oe=null,ae=ne.edges.head;null!=ae;){var le=ae.elt,pe=le.gnormx*re.worldCOMx+le.gnormy*re.worldCOMy-le.gprojection-re.radius;if(1e100<pe){se=pe;break}0<pe?se<pe&&(se=pe,oe=le):se<0&&se<pe&&(se=pe,oe=le),ae=ae.next}se<1e100&&(Ae=oe.gp0,Ne=oe.gp1,(Ue=re.worldCOMy*oe.gnormx-re.worldCOMx*oe.gnormy)<=Ae.y*oe.gnormx-Ae.x*oe.gnormy?(Ge=Fe=0,Fe=re.worldCOMx-Ae.x,Ge=re.worldCOMy-Ae.y,(se=(ne=Math.sqrt(Fe*Fe+Ge*Ge))-re.radius)<1e100&&(0==ne?(Fe=1,Ge=0):(Fe*=Me=1/ne,Ge*=Me),Qt.x=Ae.x+0*Fe,Qt.y=Ae.y+0*Ge,Oe=-re.radius,$t.x=re.worldCOMx+Fe*Oe,$t.y=re.worldCOMy+Ge*Oe,d.x=Fe,d.y=Ge)):Ue>=Ne.y*oe.gnormx-Ne.x*oe.gnormy?(Ie=Ee=0,Ee=re.worldCOMx-Ne.x,Ie=re.worldCOMy-Ne.y,(se=(Re=Math.sqrt(Ee*Ee+Ie*Ie))-re.radius)<1e100&&(0==Re?(Ee=1,Ie=0):(Ee*=je=1/Re,Ie*=je),Qt.x=Ne.x+0*Ee,Qt.y=Ne.y+0*Ie,ke=-re.radius,$t.x=re.worldCOMx+Ee*ke,$t.y=re.worldCOMy+Ie*ke,d.x=Ee,d.y=Ie)):(De=-re.radius,$t.x=re.worldCOMx+oe.gnormx*De,$t.y=re.worldCOMy+oe.gnormy*De,Be=-se,Qt.x=$t.x+oe.gnormx*Be,Qt.y=$t.y+oe.gnormy*Be,d.x=oe.gnormx,d.y=oe.gnormy)),ie&&(d.x=-d.x,d.y=-d.y),ee=se}else{for(var he=Zt.polygon,ue=Jt.polygon,ce=-1e100,de=null,_e=null,ye=0,fe=he.edges.head;null!=fe;){for(var me=fe.elt,xe=1e100,ve=ue.gverts.next;null!=ve;){var ge=me.gnormx*ve.x+me.gnormy*ve.y;ge<xe&&(xe=ge),ve=ve.next}if(1e100<(xe-=me.gprojection)){ce=xe;break}0<xe?ce<xe&&(ce=xe,de=me,ye=1):ce<0&&ce<xe&&(ce=xe,de=me,ye=1),fe=fe.next}if(ce<1e100){for(var be,ze,we=ue.edges.head;null!=we;){for(var Ce=we.elt,Pe=1e100,Te=he.gverts.next;null!=Te;){var Se=Ce.gnormx*Te.x+Ce.gnormy*Te.y;Se<Pe&&(Pe=Se),Te=Te.next}if(1e100<(Pe-=Ce.gprojection)){ce=Pe;break}0<Pe?ce<Pe&&(ce=Pe,_e=Ce,ye=2):ce<0&&ce<Pe&&(ce=Pe,_e=Ce,ye=2),we=we.next}if(ce<1e100){1==ye?(be=ue,ze=de):(be=he,ze=_e,Le=Qt,Qt=$t,$t=Le,ie=!ie);for(var Me,Ae,Oe,ke,Ee,Ie,De,Be,Le,Re,Fe,je,Ne,Ge,Ue,Xe,Ve,We,He,qe,Ye,Ke,Ze=null,Je=1e100,Qe=be.edges.head;null!=Qe;){var $e=Qe.elt,ti=ze.gnormx*$e.gnormx+ze.gnormy*$e.gnormy;ti<Je&&(Je=ti,Ze=$e),Qe=Qe.next}ie?(d.x=-ze.gnormx,d.y=-ze.gnormy):(d.x=ze.gnormx,d.y=ze.gnormy),ee=0<=ce?(Me=ze.gp0,Ae=ze.gp1,Oe=Ze.gp0,We=Ze.gp1,Ue=Ge=Ye=Fe=0,Ke=1/((Fe=Ae.x-Me.x)*Fe+(Ye=Ae.y-Me.y)*Ye),Re=1/((Ge=We.x-Oe.x)*Ge+(Ue=We.y-Oe.y)*Ue),(He=-(Fe*(Me.x-Oe.x)+Ye*(Me.y-Oe.y))*Ke)<0?He=0:1<He&&(He=1),(je=-(Fe*(Me.x-We.x)+Ye*(Me.y-We.y))*Ke)<0?je=0:1<je&&(je=1),(Ne=-(Ge*(Oe.x-Me.x)+Ue*(Oe.y-Me.y))*Re)<0?Ne=0:1<Ne&&(Ne=1),(Xe=-(Ge*(Oe.x-Ae.x)+Ue*(Oe.y-Ae.y))*Re)<0?Xe=0:1<Xe&&(Xe=1),Ee=ke=0,ke=Me.x+Fe*He,Ee=Me.y+Ye*He,Ve=Ie=0,Ie=Me.x+Fe*je,Ve=Me.y+Ye*je,Be=De=0,De=Oe.x+Ge*Ne,Be=Oe.y+Ue*Ne,Jt=Zt=0,Zt=Oe.x+Ge*Xe,Jt=Oe.y+Ue*Xe,Ue=Ge=Ne=je=Ye=Fe=He=Re=Ke=Le=0,Xe=null,(Ke=(Le=ke-Oe.x)*Le+(Ke=Ee-Oe.y)*Ke)<(He=(Re=Ie-We.x)*Re+(He=Ve-We.y)*He)?(Ge=ke,Ue=Ee,Xe=Oe):(Ge=Ie,Ue=Ve,Xe=We,Ke=He),We=Ve=0,He=null,(Ye=(Fe=De-Me.x)*Fe+(Ye=Be-Me.y)*Ye)<(Ne=(je=Zt-Ae.x)*je+(Ne=Jt-Ae.y)*Ne)?(Ve=De,We=Be,He=Me):(Ve=Zt,We=Jt,He=Ae,Ye=Ne),0!=(ce=Ke<Ye?(Qt.x=Ge,Qt.y=Ue,$t.x=Xe.x,$t.y=Xe.y,Math.sqrt(Ke)):($t.x=Ve,$t.y=We,Qt.x=He.x,Qt.y=He.y,Math.sqrt(Ye)))&&(d.x=$t.x-Qt.x,d.y=$t.y-Qt.y,qe=1/ce,d.x*=qe,d.y*=qe,ie&&(d.x=-d.x,d.y=-d.y)),ce):(Ke=Xe=0,Xe=Ze.gp0.x,Ke=Ze.gp0.y,Ye=He=We=Ve=0,He=(Ve=Ze.gp1.x)-Xe,Ye=(We=Ze.gp1.y)-Ke,qe=ze.gnormy*Xe-ze.gnormx*Ke,ii=1/((ie=ze.gnormy*Ve-ze.gnormx*We)-qe),(qe=(-ze.tp1-qe)*ii)>kr.epsilon&&(Xe+=He*qe,Ke+=Ye*qe),(ii=(-ze.tp0-ie)*ii)<-kr.epsilon&&(Ve+=He*ii,We+=Ye*ii),(Ye=Xe*ze.gnormx+Ke*ze.gnormy-ze.gprojection)<(ii=Ve*ze.gnormx+We*ze.gnormy-ze.gprojection)?($t.x=Xe,$t.y=Ke,Ke=-Ye,Qt.x=$t.x+ze.gnormx*Ke,Qt.y=$t.y+ze.gnormy*Ke,Ye):($t.x=Ve,$t.y=We,ei=-ii,Qt.x=$t.x+ze.gnormx*ei,Qt.y=$t.y+ze.gnormy*ei,ii))}else ee=1e100}else ee=1e100}}Qt=ee+n,$t=a*d.x+l*d.y;if(Qt<kr.distanceThresholdCCD){var ei=0,ii=0,ei=u.x-o.posx,ii=u.y-o.posy,ii=$t-o.sweep_angvel*(d.y*ei-d.x*ii);if(0<ii&&(t.slipped=!0),ii<=0||Qt<.5*kr.distanceThresholdCCD)break}_=-1;break}if(40<=++y){n<I&&(t.failed=!0);break}}t.toi=_},Ie.distanceBody=function(t,e,i,n){var r,s,o;null==Ir.zpp_pool?r=new Ir:(r=Ir.zpp_pool,Ir.zpp_pool=r.next,r.next=null),r.weak=!1,null==Ir.zpp_pool?s=new Ir:(s=Ir.zpp_pool,Ir.zpp_pool=s.next,s.next=null),s.weak=!1,null==Ir.zpp_pool?o=new Ir:(o=Ir.zpp_pool,Ir.zpp_pool=o.next,o.next=null),o.weak=!1;for(var a=1e100,l=t.shapes.head;null!=l;){for(var p=l.elt,h=e.shapes.head;null!=h;){var u=h.elt,c=p,d=u,_=r,y=s;if(0==p.type&&0==u.type){var f,m=p.circle,x=u.circle,v=0,g=0,v=x.worldCOMx-m.worldCOMx,g=x.worldCOMy-m.worldCOMy,b=Math.sqrt(v*v+g*g),z=b-(m.radius+x.radius);z<a&&(0==b?(v=1,g=0):(v*=f=1/b,g*=f),f=m.radius,_.x=m.worldCOMx+v*f,_.y=m.worldCOMy+g*f,f=-x.radius,y.x=x.worldCOMx+v*f,y.y=x.worldCOMy+g*f,o.x=v,o.y=g),g=z}else{z=!1;if(0==p.type&&1==u.type&&(c=u,d=p,w=_,_=y,y=w,z=!0),1==c.type&&0==d.type){for(var w=c.polygon,C=d.circle,P=-1e100,T=null,S=w.edges.head;null!=S;){var M=S.elt,A=M.gnormx*C.worldCOMx+M.gnormy*C.worldCOMy-M.gprojection-C.radius;if(a<A){P=A;break}0<A?P<A&&(P=A,T=M):P<0&&P<A&&(P=A,T=M),S=S.next}P<a&&(Y=T.gp0,ot=T.gp1,(at=C.worldCOMy*T.gnormx-C.worldCOMx*T.gnormy)<=Y.y*T.gnormx-Y.x*T.gnormy?(rt=Z=0,Z=C.worldCOMx-Y.x,rt=C.worldCOMy-Y.y,(P=(w=Math.sqrt(Z*Z+rt*rt))-C.radius)<a&&(0==w?(Z=1,rt=0):(Z*=K=1/w,rt*=K),_.x=Y.x+0*Z,_.y=Y.y+0*rt,K=-C.radius,y.x=C.worldCOMx+Z*K,y.y=C.worldCOMy+rt*K,o.x=Z,o.y=rt)):at>=ot.y*T.gnormx-ot.x*T.gnormy?($=Q=0,Q=C.worldCOMx-ot.x,$=C.worldCOMy-ot.y,(P=(nt=Math.sqrt(Q*Q+$*$))-C.radius)<a&&(0==nt?(Q=1,$=0):(Q*=st=1/nt,$*=st),_.x=ot.x+0*Q,_.y=ot.y+0*$,J=-C.radius,y.x=C.worldCOMx+Q*J,y.y=C.worldCOMy+$*J,o.x=Q,o.y=$)):(tt=-C.radius,y.x=C.worldCOMx+T.gnormx*tt,y.y=C.worldCOMy+T.gnormy*tt,et=-P,_.x=y.x+T.gnormx*et,_.y=y.y+T.gnormy*et,o.x=T.gnormx,o.y=T.gnormy)),z&&(o.x=-o.x,o.y=-o.y),g=P}else{for(var O=c.polygon,k=d.polygon,E=-1e100,I=null,D=null,B=0,L=O.edges.head;null!=L;){for(var R=L.elt,F=1e100,j=k.gverts.next;null!=j;){var N=R.gnormx*j.x+R.gnormy*j.y;N<F&&(F=N),j=j.next}if(a<(F-=R.gprojection)){E=F;break}0<F?E<F&&(E=F,I=R,B=1):E<0&&E<F&&(E=F,I=R,B=1),L=L.next}if(E<a){for(var G,U,X=k.edges.head;null!=X;){for(var V=X.elt,W=1e100,H=O.gverts.next;null!=H;){var q=V.gnormx*H.x+V.gnormy*H.y;q<W&&(W=q),H=H.next}if(a<(W-=V.gprojection)){E=W;break}0<W?E<W&&(E=W,D=V,B=2):E<0&&E<W&&(E=W,D=V,B=2),X=X.next}if(E<a){1==B?(G=k,U=I):(G=O,U=D,it=_,_=y,y=it,z=!z);for(var Y,K,Z,J,Q,$,tt,et,it,nt,rt,st,ot,at,lt,pt,ht,ut,ct,dt,_t,yt,ft=null,mt=1e100,xt=G.edges.head;null!=xt;){var vt=xt.elt,gt=U.gnormx*vt.gnormx+U.gnormy*vt.gnormy;gt<mt&&(mt=gt,ft=vt),xt=xt.next}z?(o.x=-U.gnormx,o.y=-U.gnormy):(o.x=U.gnormx,o.y=U.gnormy),g=0<=E?(Y=U.gp0,K=U.gp1,Z=ft.gp0,ht=ft.gp1,lt=at=ct=rt=0,pt=1/((rt=K.x-Y.x)*rt+(ct=K.y-Y.y)*ct),nt=1/((at=ht.x-Z.x)*at+(lt=ht.y-Z.y)*lt),(dt=-(rt*(Y.x-Z.x)+ct*(Y.y-Z.y))*pt)<0?dt=0:1<dt&&(dt=1),(st=-(rt*(Y.x-ht.x)+ct*(Y.y-ht.y))*pt)<0?st=0:1<st&&(st=1),(ot=-(at*(Z.x-Y.x)+lt*(Z.y-Y.y))*nt)<0?ot=0:1<ot&&(ot=1),(_t=-(at*(Z.x-K.x)+lt*(Z.y-K.y))*nt)<0?_t=0:1<_t&&(_t=1),Q=J=0,J=Y.x+rt*dt,Q=Y.y+ct*dt,yt=$=0,$=Y.x+rt*st,yt=Y.y+ct*st,et=tt=0,tt=Z.x+at*ot,et=Z.y+lt*ot,d=c=0,c=Z.x+at*_t,d=Z.y+lt*_t,lt=at=ot=st=ct=rt=dt=nt=pt=it=0,_t=null,(pt=(it=J-Z.x)*it+(pt=Q-Z.y)*pt)<(dt=(nt=$-ht.x)*nt+(dt=yt-ht.y)*dt)?(at=J,lt=Q,_t=Z):(at=$,lt=yt,_t=ht,pt=dt),ht=yt=0,dt=null,(ct=(rt=tt-Y.x)*rt+(ct=et-Y.y)*ct)<(ot=(st=c-K.x)*st+(ot=d-K.y)*ot)?(yt=tt,ht=et,dt=Y):(yt=c,ht=d,dt=K,ct=ot),0!=(E=pt<ct?(_.x=at,_.y=lt,y.x=_t.x,y.y=_t.y,Math.sqrt(pt)):(y.x=yt,y.y=ht,_.x=dt.x,_.y=dt.y,Math.sqrt(ct)))&&(o.x=y.x-_.x,o.y=y.y-_.y,ut=1/E,o.x*=ut,o.y*=ut,z&&(o.x=-o.x,o.y=-o.y)),E):(_t=lt=0,lt=ft.gp0.x,_t=ft.gp0.y,dt=ht=yt=pt=0,ht=(pt=ft.gp1.x)-lt,dt=(yt=ft.gp1.y)-_t,ct=U.gnormy*lt-U.gnormx*_t,z=1/((ut=U.gnormy*pt-U.gnormx*yt)-ct),(ct=(-U.tp1-ct)*z)>kr.epsilon&&(lt+=ht*ct,_t+=dt*ct),(z=(-U.tp0-ut)*z)<-kr.epsilon&&(pt+=ht*z,yt+=dt*z),(dt=lt*U.gnormx+_t*U.gnormy-U.gprojection)<(z=pt*U.gnormx+yt*U.gnormy-U.gprojection)?(y.x=lt,y.y=_t,_t=-dt,_.x=y.x+U.gnormx*_t,_.y=y.y+U.gnormy*_t,dt):(y.x=pt,y.y=yt,yt=-z,_.x=y.x+U.gnormx*yt,_.y=y.y+U.gnormy*yt,z))}else g=a}else g=a}}g<a&&(a=g,i.x=r.x,i.y=r.y,n.x=s.x,n.y=s.y),h=h.next}l=l.next}t=r;null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ir.zpp_pool,Ir.zpp_pool=t;t=s;null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ir.zpp_pool,Ir.zpp_pool=t;t=o;return null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ir.zpp_pool,Ir.zpp_pool=t,a},Ie.distance=function(t,e,i,n,r,s){if(null==s&&(s=1e100),0==t.type&&0==e.type){var o,a=t.circle,l=e.circle,p=0,h=0,p=l.worldCOMx-a.worldCOMx,h=l.worldCOMy-a.worldCOMy,u=Math.sqrt(p*p+h*h),c=u-(a.radius+l.radius);return c<s&&(0==u?(p=1,h=0):(p*=o=1/u,h*=o),o=a.radius,i.x=a.worldCOMx+p*o,i.y=a.worldCOMy+h*o,o=-l.radius,n.x=l.worldCOMx+p*o,n.y=l.worldCOMy+h*o,r.x=p,r.y=h),c}p=!1;if(0==t.type&&1==e.type&&(d=t,t=e,e=d,_=i,i=n,n=_,p=!0),1==t.type&&0==e.type){for(var d,_,h=t.polygon,y=e.circle,f=-1e100,m=null,x=h.edges.head;null!=x;){var v=x.elt,g=v.gnormx*y.worldCOMx+v.gnormy*y.worldCOMy-v.gprojection-y.radius;if(s<g){f=g;break}0<g?f<g&&(f=g,m=v):f<0&&f<g&&(f=g,m=v),x=x.next}return f<s&&(c=m.gp0,q=m.gp1,(X=y.worldCOMy*m.gnormx-y.worldCOMx*m.gnormy)<=c.y*m.gnormx-c.x*m.gnormy?(_=d=0,d=y.worldCOMx-c.x,_=y.worldCOMy-c.y,(f=(h=Math.sqrt(d*d+_*_))-y.radius)<s&&(0==h?(d=1,_=0):(d*=h=1/h,_*=h),i.x=c.x+0*d,i.y=c.y+0*_,c=-y.radius,n.x=y.worldCOMx+d*c,n.y=y.worldCOMy+_*c,r.x=d,r.y=_)):X>=q.y*m.gnormx-q.x*m.gnormy?($=Q=0,Q=y.worldCOMx-q.x,$=y.worldCOMy-q.y,(f=(V=Math.sqrt(Q*Q+$*$))-y.radius)<s&&(0==V?(Q=1,$=0):(Q*=W=1/V,$*=W),i.x=q.x+0*Q,i.y=q.y+0*$,J=-y.radius,n.x=y.worldCOMx+Q*J,n.y=y.worldCOMy+$*J,r.x=Q,r.y=$)):(et=-y.radius,n.x=y.worldCOMx+m.gnormx*et,n.y=y.worldCOMy+m.gnormy*et,it=-f,i.x=n.x+m.gnormx*it,i.y=n.y+m.gnormy*it,r.x=m.gnormx,r.y=m.gnormy)),p&&(r.x=-r.x,r.y=-r.y),f}for(var b=t.polygon,z=e.polygon,w=-1e100,C=null,P=null,T=0,S=b.edges.head;null!=S;){for(var M=S.elt,A=1e100,O=z.gverts.next;null!=O;){var k=M.gnormx*O.x+M.gnormy*O.y;k<A&&(A=k),O=O.next}if(s<(A-=M.gprojection)){w=A;break}0<A?w<A&&(w=A,C=M,T=1):w<0&&w<A&&(w=A,C=M,T=1),S=S.next}if(w<s){for(var E,I=z.edges.head;null!=I;){for(var D=I.elt,B=1e100,L=b.gverts.next;null!=L;){var R=D.gnormx*L.x+D.gnormy*L.y;R<B&&(B=R),L=L.next}if(s<(B-=D.gprojection)){w=B;break}0<B?w<B&&(w=B,P=D,T=2):w<0&&w<B&&(w=B,P=D,T=2),I=I.next}if(w<s){1==T?(st=z,E=C):(st=b,E=P,nt=i,i=n,n=nt,p=!p);for(var F=null,j=1e100,N=st.edges.head;null!=N;){var G=N.elt,U=E.gnormx*G.gnormx+E.gnormy*G.gnormy;U<j&&(j=U,F=G),N=N.next}if(p?(r.x=-E.gnormx,r.y=-E.gnormy):(r.x=E.gnormx,r.y=E.gnormy),0<=w){var X=E.gp0,V=E.gp1,W=F.gp0,H=F.gp1,q=0,Y=0,K=0,Z=0,J=1/((q=V.x-X.x)*q+(Y=V.y-X.y)*Y),Q=1/((K=H.x-W.x)*K+(Z=H.y-W.y)*Z),$=-(q*(X.x-W.x)+Y*(X.y-W.y))*J,tt=-(q*(X.x-H.x)+Y*(X.y-H.y))*J,et=-(K*(W.x-X.x)+Z*(W.y-X.y))*Q,it=-(K*(W.x-V.x)+Z*(W.y-V.y))*Q;$<0?$=0:1<$&&($=1),tt<0?tt=0:1<tt&&(tt=1),et<0?et=0:1<et&&(et=1),it<0?it=0:1<it&&(it=1);var t=0,e=0,t=X.x+q*$,e=X.y+Y*$,nt=0,rt=0,nt=X.x+q*tt,rt=X.y+Y*tt,st=0,J=0,st=W.x+K*et,J=W.y+Z*et,Q=0,$=0,Q=W.x+K*it,$=W.y+Z*it,q=0,Y=0,tt=(q=t-W.x)*q+(Y=e-W.y)*Y,et=0,K=0,Z=(et=nt-H.x)*et+(K=rt-H.y)*K,it=0,q=0,Y=(it=st-X.x)*it+(q=J-X.y)*q,et=0,K=0,it=(et=Q-V.x)*et+(K=$-V.y)*K,q=0,et=0,K=null;tt<Z?(q=t,et=e,K=W):(q=nt,et=rt,K=H,tt=Z);rt=0,H=0,Z=null;return Y<it?(rt=st,H=J,Z=X):(rt=Q,H=$,Z=V,Y=it),0!=(w=tt<Y?(i.x=q,i.y=et,n.x=K.x,n.y=K.y,Math.sqrt(tt)):(n.x=rt,n.y=H,i.x=Z.x,i.y=Z.y,Math.sqrt(Y)))&&(r.x=n.x-i.x,r.y=n.y-i.y,ot=1/w,r.x*=ot,r.y*=ot,p&&(r.x=-r.x,r.y=-r.y)),w}var K=0,tt=0,K=F.gp0.x,tt=F.gp0.y,rt=0,H=0,Z=0,Y=0,Z=(rt=F.gp1.x)-K,Y=(H=F.gp1.y)-tt,ot=E.gnormy*K-E.gnormx*tt,p=E.gnormy*rt-E.gnormx*H,r=1/(p-ot),ot=(-E.tp1-ot)*r;ot>kr.epsilon&&(K+=Z*ot,tt+=Y*ot);r=(-E.tp0-p)*r;r<-kr.epsilon&&(rt+=Z*r,H+=Y*r);Y=K*E.gnormx+tt*E.gnormy-E.gprojection,r=rt*E.gnormx+H*E.gnormy-E.gprojection;if(Y<r){n.x=K,n.y=tt;tt=-Y;return i.x=n.x+E.gnormx*tt,i.y=n.y+E.gnormy*tt,Y}n.x=rt,n.y=H;H=-r;return i.x=n.x+E.gnormx*H,i.y=n.y+E.gnormy*H,r}return s}return s},Ie.prototype.__class__=Ie;var De=zpp_nape.geom.ZPP_PartitionPair=function(){this.node=null,this.di=0,this.id=0,this.b=null,this.a=null,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null};De.__name__=["zpp_nape","geom","ZPP_PartitionPair"],De.get=function(t,e){var i;return null==De.zpp_pool?i=new De:(i=De.zpp_pool,De.zpp_pool=i.next,i.next=null),i.a=t,i.b=e,t.id<e.id?(i.id=t.id,i.di=e.id):(i.id=e.id,i.di=t.id),i},De.edge_swap=function(t,e){var i=t.node;t.node=e.node,e.node=i},De.edge_lt=function(t,e){return!(t.id>=e.id)||t.id==e.id&&t.di<e.di},De.prototype.next=null,De.prototype.elem=function(){return this},De.prototype.begin=function(){return this.next},De.prototype._inuse=null,De.prototype.modified=null,De.prototype.pushmod=null,De.prototype.length=null,De.prototype.setbegin=function(t){this.next=t,this.modified=!0,this.pushmod=!0},De.prototype.add=function(t){return t._inuse=!0,t.next=this.next,this.next=t,this.modified=!0,this.length++,t},De.prototype.inlined_add=function(t){return t._inuse=!0,t.next=this.next,this.next=t,this.modified=!0,this.length++,t},De.prototype.addAll=function(t){for(var e=t.next;null!=e;)this.add(e),e=e.next},De.prototype.insert=function(t,e){return e._inuse=!0,null==t?(e.next=this.next,this.next=e):(e.next=t.next,t.next=e),this.pushmod=this.modified=!0,this.length++,e},De.prototype.inlined_insert=function(t,e){return e._inuse=!0,null==t?(e.next=this.next,this.next=e):(e.next=t.next,t.next=e),this.pushmod=this.modified=!0,this.length++,e},De.prototype.pop=function(){var t=this.next;this.next=t.next,t._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},De.prototype.inlined_pop=function(){var t=this.next;this.next=t.next,t._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},De.prototype.pop_unsafe=function(){var t=this.next;return this.pop(),t},De.prototype.inlined_pop_unsafe=function(){var t=this.next;return this.pop(),t},De.prototype.remove=function(t){for(var e,i,n=null,r=this.next;null!=r;){if(r==t){null==n?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},De.prototype.try_remove=function(t){for(var e=null,i=this.next,n=!1;null!=i;){if(i==t){this.erase(e),n=!0;break}i=(e=i).next}return n},De.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.next;null!=r;){if(r==t){null==n?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},De.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.next,s=!1;null!=r;){if(r==t){null==n?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},De.prototype.erase=function(t){var e,i;return null==t?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=t.next).next,null==(t.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},De.prototype.inlined_erase=function(t){var e,i;return null==t?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=t.next).next,null==(t.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},De.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},De.prototype.clear=function(){},De.prototype.inlined_clear=function(){},De.prototype.reverse=function(){for(var t=this.next,e=null;null!=t;){var i=t.next;t.next=e,e=this.next=t,t=i}this.modified=!0,this.pushmod=!0},De.prototype.empty=function(){return null==this.next},De.prototype.size=function(){return this.length},De.prototype.has=function(t){for(var e=!1,i=this.next;null!=i;){if(i==t){e=!0;break}i=i.next}return e},De.prototype.inlined_has=function(t){for(var e=!1,i=this.next;null!=i;){if(i==t){e=!0;break}i=i.next}return e},De.prototype.front=function(){return this.next},De.prototype.back=function(){for(var t=this.next,e=t;null!=e;)e=(t=e).next;return t},De.prototype.iterator_at=function(t){for(var e=this.next;0<t--&&null!=e;)e=e.next;return e},De.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t:null},De.prototype.free=function(){this.a=this.b=null,this.node=null},De.prototype.alloc=function(){},De.prototype.a=null,De.prototype.b=null,De.prototype.id=null,De.prototype.di=null,De.prototype.node=null,De.prototype.__class__=De;var Le=zpp_nape.geom.ZPP_Triangular=function(){};Le.__name__=["zpp_nape","geom","ZPP_Triangular"],Le.lt=function(t,e){return t.y<e.y||t.y==e.y&&t.x<e.x},Le.right_turn=function(t,e,i){var n=i.x-e.x,r=i.y-e.y,i=0,i=e.x-t.x;return(e.y-t.y)*n-i*r},Le.delaunay=function(t,e,i,n){var r=0,s=0,o=0,r=i.x-e.x,s=i.y-e.y,o=e.x-t.x,a=0<=(e.y-t.y)*r-o*s||(r=n.x-i.x,s=n.y-i.y,o=i.x-e.x,0<=(i.y-e.y)*r-o*s),a=!!a||(r=t.x-n.x,s=t.y-n.y,o=n.x-i.x,0<=(n.y-i.y)*r-o*s),s=!!a||(r=e.x-t.x,s=e.y-t.y,o=t.x-n.x,0<=(t.y-n.y)*r-o*s);return!!s||0<e.x*(i.y*n.mag-i.mag*n.y)-i.x*(e.y*n.mag-e.mag*n.y)+n.x*(e.y*i.mag-e.mag*i.y)-(t.x*(i.y*n.mag-i.mag*n.y)-i.x*(t.y*n.mag-t.mag*n.y)+n.x*(t.y*i.mag-t.mag*i.y))+(t.x*(e.y*n.mag-e.mag*n.y)-e.x*(t.y*n.mag-t.mag*n.y)+n.x*(t.y*e.mag-t.mag*e.y))-(t.x*(e.y*i.mag-e.mag*i.y)-e.x*(t.y*i.mag-t.mag*i.y)+i.x*(t.y*e.mag-t.mag*e.y))},Le.optimise=function(t){var e,i=t.vertices,n=t.vertices;if(null!=i)for(var r=i;;){var s=r;if(s.sort(),s.mag=s.x*s.x+s.y*s.y,(r=r.next)==n)break}null==Le.edgeSet&&(null==Gn.zpp_pool?Le.edgeSet=new Gn:(Le.edgeSet=Gn.zpp_pool,Gn.zpp_pool=Le.edgeSet.next,Le.edgeSet.next=null),Le.edgeSet.lt=De.edge_lt,Le.edgeSet.swapped=De.edge_swap),null==De.zpp_pool?e=new De:(e=De.zpp_pool,De.zpp_pool=e.next,e.next=null);var i=t.vertices,o=t.vertices;if(null!=i)for(var a=i;;){var l=a,p=l.next;l.diagonals.reverse();for(var h=l.diagonals.head;null!=h;){var u,c,d=h.elt;d.id<l.id?(p=d,h=h.next):(Le.delaunay(l,p,d,null==h.next?l.prev:h.next.elt)||(null==De.zpp_pool?u=new De:(u=De.zpp_pool,De.zpp_pool=u.next,u.next=null),u.a=l,u.b=d,l.id<d.id?(u.id=l.id,u.di=d.id):(u.id=d.id,u.di=l.id),c=u,e.add(c),c.node=Le.edgeSet.insert(c)),p=d,h=h.next)}if((a=a.next)==o)break}for(;null!=e.next;){for(var _=e.pop_unsafe(),y=_.a,f=_.b,m=y.next,x=null,v=y.diagonals.head;null!=v;){var g=v.elt;if(g==f){x=null==(v=v.next)?y.prev:v.elt;break}m=g,v=v.next}if(y.diagonals.remove(f),f.diagonals.remove(y),f==m.next)m.diagonals.add(x);else for(var b=m.diagonals.head;null!=b;){if(b.elt==f){m.diagonals.insert(b,x);break}b=b.next}if(y==x.next)x.diagonals.add(m);else for(var z=x.diagonals.head;null!=z;){if(z.elt==y){x.diagonals.insert(z,m);break}z=z.next}Le.edgeSet.remove_node(_.node),_.a=_.b=null,_.node=null,_.next=De.zpp_pool,De.zpp_pool=_}i=e;i.a=i.b=null,i.node=null,i.next=De.zpp_pool,De.zpp_pool=i},Le.triangulate=function(t){var e=t.vertices,i=t.vertices,n=t.vertices.next,r=t.vertices;if(null!=n)for(var s=n;;)if((s.y<e.y||s.y==e.y&&s.x<e.x)&&(e=s),(i.y<s.y||i.y==s.y&&i.x<s.x)&&(i=s),(s=s.next)==r)break;null==Le.queue&&(Le.queue=new wi);var o=i.prev,a=i.next;for(Le.queue.add(i);o!=e||a!=e;)o==e||a!=e&&(o.y<a.y||o.y==a.y&&o.x<a.x)?(Le.queue.add(a),a.rightchain=!1,a=a.next):(Le.queue.add(o),o.rightchain=!0,o=o.prev);Le.queue.add(e),null==Le.stack&&(Le.stack=new wi),Le.stack.add(Le.queue.pop_unsafe());var l=Le.queue.pop_unsafe();for(Le.stack.add(l);;){var p=Le.queue.pop_unsafe();if(null==Le.queue.head)break;if(p.rightchain!=Le.stack.head.elt.rightchain){for(;;){var h=Le.stack.pop_unsafe();if(null==Le.stack.head)break;t.add_diagonal(h,p)}Le.stack.add(l)}else{for(var u=Le.stack.pop_unsafe();null!=Le.stack.head;){var c=Le.stack.head.elt,d=p.x-u.x,_=p.y-u.y,y=u.x-c.x,_=(u.y-c.y)*d-y*_;if(p.rightchain&&0<=_||!p.rightchain&&_<=0)break;t.add_diagonal(c,p),u=c,Le.stack.pop()}Le.stack.add(u)}Le.stack.add(p),l=p}if(null!=Le.stack.head)for(Le.stack.pop();null!=Le.stack.head;){var f=Le.stack.pop_unsafe();if(null==Le.stack.head)break;t.add_diagonal(i,f)}return t},Le.prototype.__class__=Le;var Ir=zpp_nape.geom.ZPP_Vec2=function(){this.y=0,this.x=0,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.weak=!1,this.outer=null,this._isimmutable=null,this._immutable=!1,this._validate=null,this._invalidate=null};Ir.__name__=["zpp_nape","geom","ZPP_Vec2"],Ir.get=function(t,e,i){var n;return null==i&&(i=!1),null==Ir.zpp_pool?n=new Ir:(n=Ir.zpp_pool,Ir.zpp_pool=n.next,n.next=null),n.weak=!1,n._immutable=i,n.x=t,n.y=e,n},Ir.prototype._invalidate=null,Ir.prototype._validate=null,Ir.prototype.validate=function(){null!=this._validate&&this._validate()},Ir.prototype.invalidate=function(){null!=this._invalidate&&this._invalidate(this)},Ir.prototype._immutable=null,Ir.prototype._isimmutable=null,Ir.prototype.immutable=function(){},Ir.prototype.outer=null,Ir.prototype.wrapper=function(){var t;return null==this.outer&&(this.outer=new Ct,null!=(t=this.outer.zpp_inner).outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ir.zpp_pool,Ir.zpp_pool=t,this.outer.zpp_inner=this),this.outer},Ir.prototype.weak=null,Ir.prototype.free=function(){null!=this.outer&&(this.outer.zpp_inner=null,this.outer=null),this._isimmutable=null,this._validate=null,this._invalidate=null},Ir.prototype.alloc=function(){this.weak=!1},Ir.prototype.next=null,Ir.prototype.elem=function(){return this},Ir.prototype.begin=function(){return this.next},Ir.prototype._inuse=null,Ir.prototype.modified=null,Ir.prototype.pushmod=null,Ir.prototype.length=null,Ir.prototype.setbegin=function(t){this.next=t,this.modified=!0,this.pushmod=!0},Ir.prototype.add=function(t){return t._inuse=!0,t.next=this.next,this.next=t,this.modified=!0,this.length++,t},Ir.prototype.inlined_add=function(t){return t._inuse=!0,t.next=this.next,this.next=t,this.modified=!0,this.length++,t},Ir.prototype.addAll=function(t){for(var e=t.next;null!=e;)this.add(e),e=e.next},Ir.prototype.insert=function(t,e){return e._inuse=!0,null==t?(e.next=this.next,this.next=e):(e.next=t.next,t.next=e),this.pushmod=this.modified=!0,this.length++,e},Ir.prototype.inlined_insert=function(t,e){return e._inuse=!0,null==t?(e.next=this.next,this.next=e):(e.next=t.next,t.next=e),this.pushmod=this.modified=!0,this.length++,e},Ir.prototype.pop=function(){var t=this.next;this.next=t.next,t._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},Ir.prototype.inlined_pop=function(){var t=this.next;this.next=t.next,t._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},Ir.prototype.pop_unsafe=function(){var t=this.next;return this.pop(),t},Ir.prototype.inlined_pop_unsafe=function(){var t=this.next;return this.pop(),t},Ir.prototype.remove=function(t){for(var e,i,n=null,r=this.next;null!=r;){if(r==t){null==n?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Ir.prototype.try_remove=function(t){for(var e=null,i=this.next,n=!1;null!=i;){if(i==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Ir.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.next;null!=r;){if(r==t){null==n?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Ir.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.next,s=!1;null!=r;){if(r==t){null==n?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Ir.prototype.erase=function(t){var e,i;return null==t?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=t.next).next,null==(t.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},Ir.prototype.inlined_erase=function(t){var e,i;return null==t?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=t.next).next,null==(t.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},Ir.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Ir.prototype.clear=function(){},Ir.prototype.inlined_clear=function(){},Ir.prototype.reverse=function(){for(var t=this.next,e=null;null!=t;){var i=t.next;t.next=e,e=this.next=t,t=i}this.modified=!0,this.pushmod=!0},Ir.prototype.empty=function(){return null==this.next},Ir.prototype.size=function(){return this.length},Ir.prototype.has=function(t){for(var e=!1,i=this.next;null!=i;){if(i==t){e=!0;break}i=i.next}return e},Ir.prototype.inlined_has=function(t){for(var e=!1,i=this.next;null!=i;){if(i==t){e=!0;break}i=i.next}return e},Ir.prototype.front=function(){return this.next},Ir.prototype.back=function(){for(var t=this.next,e=t;null!=e;)e=(t=e).next;return t},Ir.prototype.iterator_at=function(t){for(var e=this.next;0<t--&&null!=e;)e=e.next;return e},Ir.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t:null},Ir.prototype.x=null,Ir.prototype.y=null,Ir.prototype.copy=function(){var t,e=this.x,i=this.y;return null==Ir.zpp_pool?t=new Ir:(t=Ir.zpp_pool,Ir.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,t},Ir.prototype.toString=function(){return"{ x: "+this.x+" y: "+this.y+" }"},Ir.prototype.__class__=Ir;var Fe=zpp_nape.geom.ZPP_Vec3=function(){this._validate=null,this.immutable=!1,this.z=0,this.y=0,this.x=0,this.outer=null,this.immutable=!1,this._validate=null};Fe.__name__=["zpp_nape","geom","ZPP_Vec3"],Fe.prototype.outer=null,Fe.prototype.x=null,Fe.prototype.y=null,Fe.prototype.z=null,Fe.prototype.immutable=null,Fe.prototype._validate=null,Fe.prototype.validate=function(){null!=this._validate&&this._validate()},Fe.prototype.__class__=Fe,(s=zpp_nape.geom.ZPP_VecMath=function(){}).__name__=["zpp_nape","geom","ZPP_VecMath"],s.vec_dsq=function(t,e,i,n){var r=0,s=0;return(r=t-i)*r+(s=e-n)*s},s.vec_distance=function(t,e,i,n){var r=t-i,s=e-n;return Math.sqrt(r*r+s*s)},s.prototype.__class__=s;var $n=zpp_nape.phys.ZPP_Interactor=function(){this.wrap_cbTypes=null,this.cbSet=null,this.cbTypes=null,this.group=null,this.cbsets=null,this.icompound=null,this.ibody=null,this.ishape=null,this.userData=null,this.id=0,this.outer_i=null,this.id=vt.Interactor(),this.cbsets=new hi,this.cbTypes=new Et};$n.__name__=["zpp_nape","phys","ZPP_Interactor"],$n.get=function(t,e){for(var i=(t.id<e.id?t:e).id,n=(t.id<e.id?e:t).id,r=null,s=(t.cbsets.length<e.cbsets.length?t:e).cbsets.head;null!=s;){var o=s.elt;if(o.id==i&&o.di==n){r=o;break}s=s.next}return r},$n.int_callback=function(t,e,i){var n=t.int1,r=t.int2,s=e.options1,t=n.cbTypes;!(!s.nonemptyintersection(t,s.includes)||s.nonemptyintersection(t,s.excludes))&&(s=e.options2,e=r.cbTypes,!!s.nonemptyintersection(e,s.includes)&&!s.nonemptyintersection(e,s.excludes))?(i.int1=n,i.int2=r):(i.int1=r,i.int2=n)},$n.prototype.outer_i=null,$n.prototype.id=null,$n.prototype.userData=null,$n.prototype.ishape=null,$n.prototype.ibody=null,$n.prototype.icompound=null,$n.prototype.isShape=function(){return null!=this.ishape},$n.prototype.isBody=function(){return null!=this.ibody},$n.prototype.isCompound=function(){return null!=this.icompound},$n.prototype.__iaddedToSpace=function(){null!=this.group&&this.group.interactors.add(this);for(var t=this.cbTypes.head;null!=t;)t.elt.interactors.add(this),t=t.next;this.alloc_cbSet()},$n.prototype.__iremovedFromSpace=function(){null!=this.group&&this.group.interactors.remove(this);for(var t=this.cbTypes.head;null!=t;)t.elt.interactors.remove(this),t=t.next;this.dealloc_cbSet()},$n.prototype.wake=function(){var t;null!=this.ishape?null!=(t=this.ishape.body)&&null!=t.space&&t.space.non_inlined_wake(t):null!=this.ibody?null!=this.ibody.space&&this.ibody.space.non_inlined_wake(this.ibody):null!=this.icompound.space&&this.icompound.space.wakeCompound(this.icompound)},$n.prototype.cbsets=null,$n.prototype.getSpace=function(){return null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:(null!=this.ibody?this.ibody:this.icompound).space},$n.prototype.group=null,$n.prototype.cbTypes=null,$n.prototype.cbSet=null,$n.prototype.wrap_cbTypes=null,$n.prototype.setupcbTypes=function(){this.wrap_cbTypes=Sn.get(this.cbTypes),this.wrap_cbTypes.zpp_inner.adder=Z(this,this.wrap_cbTypes_adder),this.wrap_cbTypes.zpp_inner.subber=Z(this,this.wrap_cbTypes_subber),this.wrap_cbTypes.zpp_inner.dontremove=!0},$n.prototype.wrap_cbTypes_subber=function(t){var e=t.zpp_inner;this.cbTypes.has(e)&&(null!=(t=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:(null!=this.ibody?this.ibody:this.icompound).space)&&(this.dealloc_cbSet(),e.interactors.remove(this)),this.cbTypes.remove(e),null!=t&&(this.alloc_cbSet(),this.wake()))},$n.prototype.wrap_cbTypes_adder=function(t){return this.insert_cbtype(t.zpp_inner),!1},$n.prototype.insert_cbtype=function(t){if(!this.cbTypes.has(t)){var e=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:(null!=this.ibody?this.ibody:this.icompound).space;null!=e&&(this.dealloc_cbSet(),t.interactors.add(this));for(var i=null,n=this.cbTypes.head;null!=n&&!(t.id<n.elt.id);)n=(i=n).next;var r=this.cbTypes;null==Ui.zpp_pool?s=new Ui:(s=Ui.zpp_pool,Ui.zpp_pool=s.next,s.next=null),s.elt=t;var s=s;null==i?(s.next=r.head,r.head=s):(s.next=i.next,i.next=s),r.pushmod=r.modified=!0,r.length++,null!=e&&(this.alloc_cbSet(),this.wake())}},$n.prototype.alloc_cbSet=function(){var t=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:(null!=this.ibody?this.ibody:this.icompound).space;null!=(this.cbSet=t.cbsets.get(this.cbTypes))&&(this.cbSet.count++,this.cbSet.interactors.add(this),this.cbSet.validate(),t.freshInteractorType(this))},$n.prototype.dealloc_cbSet=function(){var t=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:(null!=this.ibody?this.ibody:this.icompound).space;if(null!=this.cbSet){if(this.cbSet.interactors.remove(this),t.nullInteractorType(this),0==--this.cbSet.count){t.cbsets.remove(this.cbSet);var e=this.cbSet;for(e.listeners.clear(),e.zip_listeners=!0,e.bodylisteners.clear(),e.zip_bodylisteners=!0,e.conlisteners.clear(),e.zip_conlisteners=!0;null!=e.cbTypes.head;)e.cbTypes.pop_unsafe().cbsets.remove(e);e.next=Hn.zpp_pool,Hn.zpp_pool=e}this.cbSet=null}},$n.prototype.setGroup=function(t){var e;this.group!=t&&((e=null!=(null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:(null!=this.ibody?this.ibody:this.icompound).space))&&null!=this.group&&this.group.interactors.remove(this),this.group=t,e&&null!=t&&t.interactors.add(this),e&&(null!=this.ishape?this.ishape.body:null!=this.ibody?this.ibody:this.icompound).wake())},$n.prototype.immutable_midstep=function(t){null==this.ibody&&(null!=this.ishape?this.ishape.__immutable_midstep(t):this.icompound.__imutable_midstep(t))},$n.prototype.lookup_group=function(){for(var t=this;null!=t&&null==t.group;)t=null!=t.ishape?t.ishape.body:(null!=t.icompound?t.icompound:t.ibody).compound;return null==t?null:t.group},$n.prototype.copyto=function(t){t.zpp_inner_i.group=this.group;var e=this.outer_i;null==e.zpp_inner_i.wrap_cbTypes&&e.zpp_inner_i.setupcbTypes();e=e.zpp_inner_i.wrap_cbTypes;e.zpp_inner.valmod();for(var i=Xt.get(e);;){i.zpp_inner.zpp_inner.valmod();var n=i.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var r=n.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<r||(i.zpp_next=Xt.zpp_pool,(Xt.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;n=i.zpp_inner.at(i.zpp_i++);null==t.zpp_inner_i.wrap_cbTypes&&t.zpp_inner_i.setupcbTypes();r=t.zpp_inner_i.wrap_cbTypes;r.zpp_inner.reverse_flag?r.push(n):r.unshift(n)}null!=this.userData&&(t.zpp_inner_i.userData=l.copy(this.userData))},$n.prototype.__class__=$n;var je=zpp_nape.phys.ZPP_Body=function(){var t;this.wrap_worldCOM=null,this.wrap_localCOM=null,this.zip_worldCOM=!1,this.worldCOMy=0,this.worldCOMx=0,this.zip_localCOM=!1,this.localCOMy=0,this.localCOMx=0,this.zip_aabb=!1,this.aabb=null,this.norotate=!1,this.sinertia=0,this.iinertia=0,this.cinertia=0,this.zip_inertia=!1,this.inertia=0,this.inertiaMode=0,this.zip_gravMassScale=!1,this.gravMassScale=0,this.gravMassMode=0,this.zip_gravMass=!1,this.gravMass=0,this.nomove=!1,this.cmass=0,this.smass=0,this.imass=0,this.massMode=0,this.zip_mass=!1,this.mass=0,this.zip_axis=!1,this.axisy=0,this.axisx=0,this.rot=0,this.pre_rot=0,this.kinangvel=0,this.torque=0,this.angvel=0,this.wrapcvel=null,this.wrap_svel=null,this.svely=0,this.svelx=0,this.wrap_kinvel=null,this.kinvely=0,this.kinvelx=0,this.wrap_force=null,this.forcey=0,this.forcex=0,this.wrap_vel=null,this.vely=0,this.velx=0,this.wrap_pos=null,this.posy=0,this.posx=0,this.pre_posy=0,this.pre_posx=0,this.disableCCD=!1,this.bulletEnabled=!1,this.bullet=!1,this.sweepRadius=0,this.sweepFrozen=!1,this.sweep_angvel=0,this.sweepTime=0,this.graph_depth=0,this.component=null,this.wrap_constraints=null,this.constraints=null,this.wrap_arbiters=null,this.arbiters=null,this.space=null,this.wrap_shapes=null,this.shapes=null,this.compound=null,this.type=0,this.world=!1,this.outer=null,$n.call(this),(this.ibody=this).world=!1,this.bulletEnabled=!1,this.sweepTime=0,this.sweep_angvel=0,this.norotate=this.nomove=!1,this.disableCCD=!1,this.posx=0,this.posy=0,this.rot=0,this.axisx=0,this.axisy=1,this.svelx=0,this.svely=0,this.velx=0,this.vely=0,this.kinvelx=0,this.kinvely=0,this.forcex=0,this.forcey=0,this.torque=this.angvel=this.kinangvel=0,this.pre_posx=1/0,this.pre_posy=1/0,this.pre_rot=1/0,this.localCOMx=0,this.localCOMy=0,this.worldCOMx=0,this.worldCOMy=0,this.zip_aabb=!0,null==Be.zpp_pool?t=new Be:(t=Be.zpp_pool,Be.zpp_pool=t.next,t.next=null),t.minx=0,t.miny=0,t.maxx=0,t.maxy=0,this.aabb=t,this.aabb._immutable=!0,this.aabb._validate=Z(this,this.aabb_validate),this.massMode=0,this.gravMassMode=0,this.gravMassScale=1,this.inertiaMode=0,this.arbiters=new vi,this.constraints=new Pt,this.shapes=new ui,this.wrap_shapes=In.get(this.shapes),this.wrap_shapes.zpp_inner.adder=Z(this,this.shapes_adder),this.wrap_shapes.zpp_inner.subber=Z(this,this.shapes_subber),this.wrap_shapes.zpp_inner._invalidate=Z(this,this.shapes_invalidate),this.kinematicDelaySleep=!1};je.__name__=["zpp_nape","phys","ZPP_Body"],je.__super__=$n,je.prototype=Object.create($n.prototype),je.bodysetlt=function(t,e){return t.id<e.id},je.__static=function(){null==Yn.BodyType_STATIC&&(Yn.internal=!0,Yn.BodyType_STATIC=new et,Yn.internal=!1);var t=new $(Yn.BodyType_STATIC),e=t.zpp_inner;return e.world=!0,e.wrap_shapes.zpp_inner.immutable=!0,e.smass=e.imass=e.cmass=e.mass=e.gravMass=0,e.sinertia=e.iinertia=e.cinertia=e.inertia=0,e.cbTypes.clear(),t},je.prototype.outer=null,je.prototype.world=null,je.prototype.type=null,je.prototype.isStatic=function(){return 1==this.type},je.prototype.isDynamic=function(){return 2==this.type},je.prototype.isKinematic=function(){return 3==this.type},je.prototype.invalidate_type=function(){this.invalidate_mass(),this.invalidate_inertia()},je.prototype.compound=null,je.prototype.shapes=null,je.prototype.wrap_shapes=null,je.prototype.invalidate_shapes=function(){this.zip_aabb=!0,this.zip_localCOM=!0,this.zip_worldCOM=!0,this.invalidate_mass(),this.invalidate_inertia()},je.prototype.space=null,je.prototype.arbiters=null,je.prototype.wrap_arbiters=null,je.prototype.constraints=null,je.prototype.wrap_constraints=null,je.prototype.component=null,je.prototype.graph_depth=null,je.prototype.init_bodysetlist=function(){null==je.bodyset&&(je.bodyset=new Fn,je.bodyset.lt=je.bodysetlt,je.bodystack=new mi)},je.prototype.connectedBodies_cont=function(t){je.bodyset.try_insert_bool(t.zpp_inner)&&(je.bodystack.add(t.zpp_inner),t.zpp_inner.graph_depth=je.cur_graph_depth+1)},je.prototype.connectedBodies=function(t,e){null==je.bodyset&&(je.bodyset=new Fn,je.bodyset.lt=je.bodysetlt,je.bodystack=new mi);var i=null==e?new tt:e;for(je.bodystack.add(this),je.bodyset.insert(this),this.graph_depth=0;null!=je.bodystack.head;){var n=je.bodystack.pop_unsafe();if(n.graph_depth!=t){je.cur_graph_depth=n.graph_depth;for(var r=n.constraints.head;null!=r;)r.elt.outer.visitBodies(Z(this,this.connectedBodies_cont)),r=r.next}}e=je.bodyset;if(null!=e.parent){for(var s,o,a=e.parent;null!=a;)a=null!=a.prev?a.prev:null!=a.next?a.next:((s=a.data)!=this&&(o=s.outer,i.zpp_inner.reverse_flag?i.push(o):i.unshift(o)),null!=(s=a.parent)&&(a==s.prev?s.prev=null:s.next=null,a.parent=null),(o=a).data=null,o.lt=null,o.swapped=null,o.next=Fn.zpp_pool,Fn.zpp_pool=o,s);e.parent=null}return i},je.prototype.interactingBodies=function(t,e,i){null==je.bodyset&&(je.bodyset=new Fn,je.bodyset.lt=je.bodysetlt,je.bodystack=new mi);var n=null==i?new tt:i;for(je.bodyset.insert(this),je.bodystack.add(this),this.graph_depth=0;null!=je.bodystack.head;){var r=je.bodystack.pop_unsafe();if(r.graph_depth!=e)for(var s=r.arbiters.head;null!=s;){var o=s.elt;0!=(o.type&t)&&(o=o.b1==r?o.b2:o.b1,je.bodyset.try_insert_bool(o)&&(je.bodystack.add(o),o.graph_depth=r.graph_depth+1)),s=s.next}}i=je.bodyset;if(null!=i.parent){for(var a,l,p=i.parent;null!=p;)p=null!=p.prev?p.prev:null!=p.next?p.next:((a=p.data)!=this&&(l=a.outer,n.zpp_inner.reverse_flag?n.push(l):n.unshift(l)),null!=(a=p.parent)&&(p==a.prev?a.prev=null:a.next=null,p.parent=null),(l=p).data=null,l.lt=null,l.swapped=null,l.next=Fn.zpp_pool,Fn.zpp_pool=l,a);i.parent=null}return n},je.prototype.atRest=function(t){if(2!=this.type)return this.component.sleeping;var e,i,n,r,s=kr.linearSleepThreshold;return s*=s,!(this.velx*this.velx+this.vely*this.vely>s)&&(e=this.posx,i=this.posy,r=n=0,!(.25*s*t*t<(n=e-this.pre_posx)*n+(r=i-this.pre_posy)*r)&&(r=i=0,i=(i=this.aabb.maxx-this.aabb.minx)*i+(r=this.aabb.maxy-this.aabb.miny)*r,r=kr.angularSleepThreshold,r*=r,!(4*this.angvel*this.angvel*i>r)&&!(r*t*t<(t=this.rot-this.pre_rot)*t*i)))||(this.component.waket=this.space.stamp),this.component.waket+kr.sleepDelay<this.space.stamp},je.prototype.refreshArbiters=function(){for(var t=this.arbiters.head;null!=t;)t.elt.invalidated=!0,t=t.next},je.prototype.sweepTime=null,je.prototype.sweep_angvel=null,je.prototype.sweepFrozen=null,je.prototype.sweepRadius=null,je.prototype.bullet=null,je.prototype.bulletEnabled=null,je.prototype.disableCCD=null,je.prototype.sweepIntegrate=function(t){var e,i,n=t-this.sweepTime;0!=n&&(this.sweepTime=t,this.posx+=this.velx*n,this.posy+=this.vely*n,0!=this.angvel&&(e=this.sweep_angvel*n,this.rot+=e,1e-4<e*e?(this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)):(t=1-(i=e*e)*i/8,i=((n=1-.5*i)*this.axisx+e*this.axisy)*t,this.axisy=(n*this.axisy-e*this.axisx)*t,this.axisx=i)))},je.prototype.sweepValidate=function(t){if(0==t.type)t.worldCOMx=this.posx+(this.axisy*t.localCOMx-this.axisx*t.localCOMy),t.worldCOMy=this.posy+(t.localCOMx*this.axisx+t.localCOMy*this.axisy);else{for(var e=t.polygon,i=e.lverts.next,n=e.gverts.next;null!=n;){var r=n,s=i,i=i.next;r.x=this.posx+(this.axisy*s.x-this.axisx*s.y),r.y=this.posy+(s.x*this.axisx+s.y*this.axisy),n=n.next}for(var o=e.edges.head,a=l=e.gverts.next,l=l.next;null!=l;){var p=l,h=o.elt,o=o.next;h.gnormx=this.axisy*h.lnormx-this.axisx*h.lnormy,h.gnormy=h.lnormx*this.axisx+h.lnormy*this.axisy,h.gprojection=this.posx*h.gnormx+this.posy*h.gnormy+h.lprojection,h.tp0=a.y*h.gnormx-a.x*h.gnormy,h.tp1=p.y*h.gnormx-p.x*h.gnormy,a=p,l=l.next}t=e.gverts.next,e=o.elt;e.gnormx=this.axisy*e.lnormx-this.axisx*e.lnormy,e.gnormy=e.lnormx*this.axisx+e.lnormy*this.axisy,e.gprojection=this.posx*e.gnormx+this.posy*e.gnormy+e.lprojection,e.tp0=a.y*e.gnormx-a.x*e.gnormy,e.tp1=t.y*e.gnormx-t.x*e.gnormy}},je.prototype.pre_posx=null,je.prototype.pre_posy=null,je.prototype.posx=null,je.prototype.posy=null,je.prototype.wrap_pos=null,je.prototype.velx=null,je.prototype.vely=null,je.prototype.wrap_vel=null,je.prototype.forcex=null,je.prototype.forcey=null,je.prototype.wrap_force=null,je.prototype.kinvelx=null,je.prototype.kinvely=null,je.prototype.wrap_kinvel=null,je.prototype.svelx=null,je.prototype.svely=null,je.prototype.wrap_svel=null,je.prototype.invalidate_pos=function(){for(var t=this.shapes.head;null!=t;){var e=t.elt;1==e.type&&(e.polygon.invalidate_gverts(),e.polygon.invalidate_gaxi()),e.invalidate_worldCOM(),t=t.next}this.zip_worldCOM=!0},je.prototype.pos_invalidate=function(t){if(this.immutable_midstep("Body::position"),this.posx!=t.x||this.posy!=t.y){this.posx=t.x,this.posy=t.y;for(var e=this.shapes.head;null!=e;){var i=e.elt;1==i.type&&(i.polygon.invalidate_gverts(),i.polygon.invalidate_gaxi()),i.invalidate_worldCOM(),e=e.next}this.zip_worldCOM=!0,this.wake()}},je.prototype.pos_validate=function(){this.wrap_pos.zpp_inner.x=this.posx,this.wrap_pos.zpp_inner.y=this.posy},je.prototype.vel_invalidate=function(t){this.velx=t.x,this.vely=t.y,this.wake()},je.prototype.vel_validate=function(){this.wrap_vel.zpp_inner.x=this.velx,this.wrap_vel.zpp_inner.y=this.vely},je.prototype.kinvel_invalidate=function(t){this.kinvelx=t.x,this.kinvely=t.y,this.wake()},je.prototype.kinvel_validate=function(){this.wrap_kinvel.zpp_inner.x=this.kinvelx,this.wrap_kinvel.zpp_inner.y=this.kinvely},je.prototype.svel_invalidate=function(t){this.svelx=t.x,this.svely=t.y,this.wake()},je.prototype.svel_validate=function(){this.wrap_svel.zpp_inner.x=this.svelx,this.wrap_svel.zpp_inner.y=this.svely},je.prototype.force_invalidate=function(t){this.forcex=t.x,this.forcey=t.y,this.wake()},je.prototype.force_validate=function(){this.wrap_force.zpp_inner.x=this.forcex,this.wrap_force.zpp_inner.y=this.forcey},je.prototype.setupPosition=function(){var t,e,i=this.posx,n=this.posy;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_pos=t,this.wrap_pos.zpp_inner._inuse=!0,this.world?this.wrap_pos.zpp_inner._immutable=!0:(this.wrap_pos.zpp_inner._invalidate=Z(this,this.pos_invalidate),this.wrap_pos.zpp_inner._validate=Z(this,this.pos_validate))},je.prototype.setupVelocity=function(){var t,e,i=this.velx,n=this.vely;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_vel=t,this.wrap_vel.zpp_inner._inuse=!0,this.world?this.wrap_vel.zpp_inner._immutable=!0:(this.wrap_vel.zpp_inner._invalidate=Z(this,this.vel_invalidate),this.wrap_vel.zpp_inner._validate=Z(this,this.vel_validate))},je.prototype.setupkinvel=function(){var t,e,i=this.kinvelx,n=this.kinvely;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_kinvel=t,this.wrap_kinvel.zpp_inner._inuse=!0,this.world?this.wrap_kinvel.zpp_inner._immutable=!0:(this.wrap_kinvel.zpp_inner._invalidate=Z(this,this.kinvel_invalidate),this.wrap_kinvel.zpp_inner._validate=Z(this,this.kinvel_validate))},je.prototype.setupsvel=function(){var t,e,i=this.svelx,n=this.svely;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_svel=t,this.wrap_svel.zpp_inner._inuse=!0,this.world?this.wrap_svel.zpp_inner._immutable=!0:(this.wrap_svel.zpp_inner._invalidate=Z(this,this.svel_invalidate),this.wrap_svel.zpp_inner._validate=Z(this,this.svel_validate))},je.prototype.setupForce=function(){var t,e,i=this.forcex,n=this.forcey;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_force=t,this.wrap_force.zpp_inner._inuse=!0,this.world?this.wrap_force.zpp_inner._immutable=!0:(this.wrap_force.zpp_inner._invalidate=Z(this,this.force_invalidate),this.wrap_force.zpp_inner._validate=Z(this,this.force_validate))},je.prototype.cvel_validate=function(){this.wrapcvel.zpp_inner.x=this.velx+this.kinvelx,this.wrapcvel.zpp_inner.y=this.vely+this.kinvely,this.wrapcvel.zpp_inner.z=this.angvel+this.kinangvel},je.prototype.wrapcvel=null,je.prototype.setup_cvel=function(){this.wrapcvel=K.get(),this.wrapcvel.zpp_inner.immutable=!0,this.wrapcvel.zpp_inner._validate=Z(this,this.cvel_validate)},je.prototype.angvel=null,je.prototype.torque=null,je.prototype.kinangvel=null,je.prototype.pre_rot=null,je.prototype.rot=null,je.prototype.invalidate_rot=function(){this.zip_axis=!0;for(var t=this.shapes.head;null!=t;){var e=t.elt;1==e.type&&(e.polygon.invalidate_gverts(),e.polygon.invalidate_gaxi()),e.invalidate_worldCOM(),t=t.next}this.zip_worldCOM=!0},je.prototype.axisx=null,je.prototype.axisy=null,je.prototype.zip_axis=null,je.prototype.validate_axis=function(){this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot))},je.prototype.quick_validate_axis=function(){this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)},je.prototype.delta_rot=function(t){var e,i,n;this.rot+=t,1e-4<t*t?(this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)):(i=1-(n=t*t)*n/8,n=((e=1-.5*n)*this.axisx+t*this.axisy)*i,this.axisy=(e*this.axisy-t*this.axisx)*i,this.axisx=n)},je.prototype.kinematicDelaySleep=null,je.prototype.mass=null,je.prototype.zip_mass=null,je.prototype.massMode=null,je.prototype.imass=null,je.prototype.smass=null,je.prototype.cmass=null,je.prototype.nomove=null,je.prototype.invalidate_mass=function(){this.zip_mass=!0,this.invalidate_gravMass()},je.prototype.validate_mass=function(){if(this.zip_mass||(this.massMode,0)){if(this.zip_mass=!1,0==this.massMode){this.cmass=0;for(var t=this.shapes.head;null!=t;){var e=t.elt;e.refmaterial.density=e.material.density,e.validate_area_inertia(),this.cmass+=e.area*e.material.density,t=t.next}}2!=this.type||this.nomove?(this.mass=1/0,this.imass=this.smass=0):(this.mass=this.cmass,this.imass=this.smass=1/this.mass)}},je.prototype.gravMass=null,je.prototype.zip_gravMass=null,je.prototype.gravMassMode=null,je.prototype.gravMassScale=null,je.prototype.zip_gravMassScale=null,je.prototype.invalidate_gravMass=function(){1!=this.gravMassMode&&(this.zip_gravMass=!0),2!=this.gravMassMode&&(this.zip_gravMassScale=!0),this.wake()},je.prototype.validate_gravMass=function(){this.zip_gravMass&&(this.zip_gravMass=!1,this.validate_mass(),0==this.gravMassMode?(this.validate_mass(),this.gravMass=this.cmass):2==this.gravMassMode&&(this.validate_mass(),this.gravMass=this.cmass*this.gravMassScale))},je.prototype.invalidate_gravMassScale=function(){2!=this.gravMassMode?this.zip_gravMassScale=!0:this.invalidate_gravMass()},je.prototype.validate_gravMassScale=function(){this.zip_gravMassScale&&(this.zip_gravMassScale=!1,0==this.gravMassMode?this.gravMassScale=1:1==this.gravMassMode&&(this.validate_mass(),this.gravMassScale=this.gravMass/this.cmass))},je.prototype.inertiaMode=null,je.prototype.inertia=null,je.prototype.zip_inertia=null,je.prototype.cinertia=null,je.prototype.iinertia=null,je.prototype.sinertia=null,je.prototype.norotate=null,je.prototype.invalidate_inertia=function(){this.zip_inertia=!0,this.wake()},je.prototype.validate_inertia=function(){if(this.zip_inertia||(this.inertiaMode,0)){if(this.zip_inertia=!1,0==this.inertiaMode){this.cinertia=0;for(var t=this.shapes.head;null!=t;){var e=t.elt;e.refmaterial.density=e.material.density,e.validate_area_inertia(),this.cinertia+=e.inertia*e.area*e.material.density,t=t.next}}2!=this.type||this.norotate?(this.inertia=1/0,this.sinertia=this.iinertia=0):(this.inertia=this.cinertia,this.sinertia=this.iinertia=1/this.inertia)}},je.prototype.invalidate_wake=function(){this.wake()},je.prototype.aabb=null,je.prototype.zip_aabb=null,je.prototype.validate_aabb=function(){if(this.zip_aabb){this.zip_aabb=!1,this.aabb.minx=1/0,this.aabb.miny=1/0,this.aabb.maxx=-1/0,this.aabb.maxy=-1/0;for(var t=this.shapes.head;null!=t;){var e=t.elt;if(e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,0==e.type){var i=e.circle;if(i.zip_worldCOM&&null!=i.body){if(i.zip_worldCOM=!1,i.zip_localCOM){if(i.zip_localCOM=!1,1==i.type){var n=i.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y,n.localCOMx+=n.lverts.next.next.x,n.localCOMy+=n.lverts.next.next.y,n.localCOMx*=.5,n.localCOMy*=.5;else{n.localCOMx=0;var r=n.localCOMy=0,s=n.lverts.next,o=s,a=s=s.next;for(s=s.next;null!=s;){var l=s;r+=a.x*(l.y-o.y);var p=l.y*a.x-l.x*a.y;n.localCOMx+=(a.x+l.x)*p,n.localCOMy+=(a.y+l.y)*p,o=a,a=l,s=s.next}var h=s=n.lverts.next;r+=a.x*(h.y-o.y);var u=h.y*a.x-h.x*a.y;n.localCOMx+=(a.x+h.x)*u,n.localCOMy+=(a.y+h.y)*u,o=a;var c=s=s.next;r+=h.x*(c.y-o.y);u=c.y*h.x-c.x*h.y;n.localCOMx+=(h.x+c.x)*u,n.localCOMy+=(h.y+c.y)*u;c=r=1/(3*r);n.localCOMx*=c,n.localCOMy*=c}}null!=i.wrap_localCOM&&(i.wrap_localCOM.zpp_inner.x=i.localCOMx,i.wrap_localCOM.zpp_inner.y=i.localCOMy)}u=i.body;u.zip_axis&&(u.zip_axis=!1,u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot)),i.worldCOMx=i.body.posx+(i.body.axisy*i.localCOMx-i.body.axisx*i.localCOMy),i.worldCOMy=i.body.posy+(i.localCOMx*i.body.axisx+i.localCOMy*i.body.axisy)}c=i.radius,u=i.radius;i.aabb.minx=i.worldCOMx-c,i.aabb.miny=i.worldCOMy-u,i.aabb.maxx=i.worldCOMx+c,i.aabb.maxy=i.worldCOMy+u}else{var d=e.polygon;if(d.zip_gverts&&null!=d.body){d.zip_gverts=!1,d.validate_lverts();var _=d.body;_.zip_axis&&(_.zip_axis=!1,_.axisx=Math.sin(_.rot),_.axisy=Math.cos(_.rot));for(var y=d.lverts.next,f=d.gverts.next;null!=f;){var m=f,x=y,y=y.next;m.x=d.body.posx+(d.body.axisy*x.x-d.body.axisx*x.y),m.y=d.body.posy+(x.x*d.body.axisx+x.y*d.body.axisy),f=f.next}}_=d.gverts.next;d.aabb.minx=_.x,d.aabb.miny=_.y,d.aabb.maxx=_.x,d.aabb.maxy=_.y;for(var v=d.gverts.next.next;null!=v;){var g=v;g.x<d.aabb.minx&&(d.aabb.minx=g.x),g.x>d.aabb.maxx&&(d.aabb.maxx=g.x),g.y<d.aabb.miny&&(d.aabb.miny=g.y),g.y>d.aabb.maxy&&(d.aabb.maxy=g.y),v=v.next}}_=this.aabb,e=e.aabb;e.minx<_.minx&&(_.minx=e.minx),e.maxx>_.maxx&&(_.maxx=e.maxx),e.miny<_.miny&&(_.miny=e.miny),e.maxy>_.maxy&&(_.maxy=e.maxy),t=t.next}}},je.prototype.invalidate_aabb=function(){this.zip_aabb=!0},je.prototype.localCOMx=null,je.prototype.localCOMy=null,je.prototype.zip_localCOM=null,je.prototype.worldCOMx=null,je.prototype.worldCOMy=null,je.prototype.zip_worldCOM=null,je.prototype.wrap_localCOM=null,je.prototype.wrap_worldCOM=null,je.prototype.invalidate_localCOM=function(){this.zip_localCOM=!0,this.zip_worldCOM=!0},je.prototype.invalidate_worldCOM=function(){this.zip_worldCOM=!0},je.prototype.validate_localCOM=function(){if(this.zip_localCOM){this.zip_localCOM=!1;for(var t,e=0,i=0,n=0,r=this.shapes.head;null!=r;){var s=r.elt;if(s.zip_localCOM){if(s.zip_localCOM=!1,1==s.type){var o=s.polygon;if(null==o.lverts.next.next)o.localCOMx=o.lverts.next.x,o.localCOMy=o.lverts.next.y;else if(null==o.lverts.next.next.next)o.localCOMx=o.lverts.next.x,o.localCOMy=o.lverts.next.y,o.localCOMx+=o.lverts.next.next.x,o.localCOMy+=o.lverts.next.next.y,o.localCOMx*=.5,o.localCOMy*=.5;else{o.localCOMx=0;var a=o.localCOMy=0,l=o.lverts.next,p=l,h=l=l.next;for(l=l.next;null!=l;){var u=l;a+=h.x*(u.y-p.y);var c=u.y*h.x-u.x*h.y;o.localCOMx+=(h.x+u.x)*c,o.localCOMy+=(h.y+u.y)*c,p=h,h=u,l=l.next}var d=l=o.lverts.next;a+=h.x*(d.y-p.y);var _=d.y*h.x-d.x*h.y;o.localCOMx+=(h.x+d.x)*_,o.localCOMy+=(h.y+d.y)*_,p=h;var y=l=l.next;a+=d.x*(y.y-p.y);_=y.y*d.x-y.x*d.y;o.localCOMx+=(d.x+y.x)*_,o.localCOMy+=(d.y+y.y)*_;_=a=1/(3*a);o.localCOMx*=_,o.localCOMy*=_}}null!=s.wrap_localCOM&&(s.wrap_localCOM.zpp_inner.x=s.localCOMx,s.wrap_localCOM.zpp_inner.y=s.localCOMy)}s.validate_area_inertia();_=s.area*s.material.density;e+=s.localCOMx*_,i+=s.localCOMy*_,n+=s.area*s.material.density,r=r.next}0!=n&&(t=1/n,this.localCOMx=e*t,this.localCOMy=i*t),null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy),this.zip_mass&&0==this.massMode&&(this.zip_mass=!1,this.cmass=n,2==this.type?(this.mass=this.cmass,this.imass=this.smass=1/this.mass):(this.mass=1/0,this.imass=this.smass=0))}},je.prototype.validate_worldCOM=function(){this.zip_worldCOM&&(this.zip_worldCOM=!1,this.validate_localCOM(),this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)),this.worldCOMx=this.posx+(this.axisy*this.localCOMx-this.axisx*this.localCOMy),this.worldCOMy=this.posy+(this.localCOMx*this.axisx+this.localCOMy*this.axisy),null!=this.wrap_worldCOM&&(this.wrap_worldCOM.zpp_inner.x=this.worldCOMx,this.wrap_worldCOM.zpp_inner.y=this.worldCOMy))},je.prototype.getlocalCOM=function(){this.validate_localCOM()},je.prototype.getworldCOM=function(){this.validate_worldCOM()},je.prototype.__immutable_midstep=function(t){},je.prototype.clear=function(){for(;null!=this.shapes.head;){var t=this.shapes.pop_unsafe();t.removedFromBody(),t.body=null}this.invalidate_shapes(),this.pre_posx=0,this.pre_posy=0,this.posx=0,this.posy=0,this.velx=0,this.vely=0,this.forcex=0,this.forcey=0,this.kinvelx=0,this.kinvely=0,this.svelx=0,this.svely=0,this.angvel=this.torque=this.kinangvel=this.pre_rot=this.rot=0;for(var e=this.shapes.head;null!=e;){var i=e.elt;1==i.type&&(i.polygon.invalidate_gverts(),i.polygon.invalidate_gaxi()),i.invalidate_worldCOM(),e=e.next}this.zip_worldCOM=!0,this.zip_axis=!0;for(var n=this.shapes.head;null!=n;){var r=n.elt;1==r.type&&(r.polygon.invalidate_gverts(),r.polygon.invalidate_gaxi()),r.invalidate_worldCOM(),n=n.next}this.zip_worldCOM=!0,this.axisx=0,this.axisy=1,this.zip_axis=!1,this.massMode=0,this.gravMassMode=0,this.gravMassScale=1,this.inertiaMode=0,this.norotate=!1,this.nomove=!1},je.prototype.aabb_validate=function(){if(this.zip_aabb){this.zip_aabb=!1,this.aabb.minx=1/0,this.aabb.miny=1/0,this.aabb.maxx=-1/0,this.aabb.maxy=-1/0;for(var t=this.shapes.head;null!=t;){var e=t.elt;if(e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,0==e.type){var i=e.circle;if(i.zip_worldCOM&&null!=i.body){if(i.zip_worldCOM=!1,i.zip_localCOM){if(i.zip_localCOM=!1,1==i.type){var n=i.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y,n.localCOMx+=n.lverts.next.next.x,n.localCOMy+=n.lverts.next.next.y,n.localCOMx*=.5,n.localCOMy*=.5;else{n.localCOMx=0;var r=n.localCOMy=0,s=n.lverts.next,o=s,a=s=s.next;for(s=s.next;null!=s;){var l=s;r+=a.x*(l.y-o.y);var p=l.y*a.x-l.x*a.y;n.localCOMx+=(a.x+l.x)*p,n.localCOMy+=(a.y+l.y)*p,o=a,a=l,s=s.next}var h=s=n.lverts.next;r+=a.x*(h.y-o.y);var u=h.y*a.x-h.x*a.y;n.localCOMx+=(a.x+h.x)*u,n.localCOMy+=(a.y+h.y)*u,o=a;var c=s=s.next;r+=h.x*(c.y-o.y);u=c.y*h.x-c.x*h.y;n.localCOMx+=(h.x+c.x)*u,n.localCOMy+=(h.y+c.y)*u;c=r=1/(3*r);n.localCOMx*=c,n.localCOMy*=c}}null!=i.wrap_localCOM&&(i.wrap_localCOM.zpp_inner.x=i.localCOMx,i.wrap_localCOM.zpp_inner.y=i.localCOMy)}u=i.body;u.zip_axis&&(u.zip_axis=!1,u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot)),i.worldCOMx=i.body.posx+(i.body.axisy*i.localCOMx-i.body.axisx*i.localCOMy),i.worldCOMy=i.body.posy+(i.localCOMx*i.body.axisx+i.localCOMy*i.body.axisy)}c=i.radius,u=i.radius;i.aabb.minx=i.worldCOMx-c,i.aabb.miny=i.worldCOMy-u,i.aabb.maxx=i.worldCOMx+c,i.aabb.maxy=i.worldCOMy+u}else{var d=e.polygon;if(d.zip_gverts&&null!=d.body){d.zip_gverts=!1,d.validate_lverts();var _=d.body;_.zip_axis&&(_.zip_axis=!1,_.axisx=Math.sin(_.rot),_.axisy=Math.cos(_.rot));for(var y=d.lverts.next,f=d.gverts.next;null!=f;){var m=f,x=y,y=y.next;m.x=d.body.posx+(d.body.axisy*x.x-d.body.axisx*x.y),m.y=d.body.posy+(x.x*d.body.axisx+x.y*d.body.axisy),f=f.next}}_=d.gverts.next;d.aabb.minx=_.x,d.aabb.miny=_.y,d.aabb.maxx=_.x,d.aabb.maxy=_.y;for(var v=d.gverts.next.next;null!=v;){var g=v;g.x<d.aabb.minx&&(d.aabb.minx=g.x),g.x>d.aabb.maxx&&(d.aabb.maxx=g.x),g.y<d.aabb.miny&&(d.aabb.miny=g.y),g.y>d.aabb.maxy&&(d.aabb.maxy=g.y),v=v.next}}_=this.aabb,e=e.aabb;e.minx<_.minx&&(_.minx=e.minx),e.maxx>_.maxx&&(_.maxx=e.maxx),e.miny<_.miny&&(_.miny=e.miny),e.maxy>_.maxy&&(_.maxy=e.maxy),t=t.next}}},je.prototype.shapes_adder=function(t){return t.zpp_inner.body!=this&&(null!=t.zpp_inner.body&&t.zpp_inner.body.wrap_shapes.remove(t),t.zpp_inner.body=this,t.zpp_inner.addedToBody(),null!=this.space&&(e=this.space,(n=(i=t.zpp_inner).body).world||(n.component.waket=e.stamp+(e.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&e.really_wake(n,!1)),e.bphase.insert(i),i.addedToSpace()),1==t.zpp_inner.type&&(t.zpp_inner.polygon.invalidate_gaxi(),t.zpp_inner.polygon.invalidate_gverts()),!0);var e,i,n},je.prototype.shapes_subber=function(t){null!=this.space&&this.space.removed_shape(t.zpp_inner),t.zpp_inner.body=null,t.zpp_inner.removedFromBody()},je.prototype.shapes_invalidate=function(t){this.invalidate_shapes()},je.prototype.addedToSpace=function(){null==ti.zpp_pool?this.component=new ti:(this.component=ti.zpp_pool,ti.zpp_pool=this.component.next,this.component.next=null),this.component.isBody=!0,(this.component.body=this).__iaddedToSpace()},je.prototype.removedFromSpace=function(){for(;null!=this.arbiters.head;){var t=this.arbiters.pop_unsafe();if(t.cleared=!0,t.b2==this)for(var e,i,n=t.b1.arbiters,r=null,s=n.head;null!=s;){if(s.elt==t){null==r?(i=(e=n.head).next,n.head=i,null==n.head&&(n.pushmod=!0)):(i=(e=r.next).next,null==(r.next=i)&&(n.pushmod=!0));var o=e;o.elt=null,o.next=er.zpp_pool,er.zpp_pool=o,n.modified=!0,n.length--,n.pushmod=!0;break}s=(r=s).next}if(t.b1==this)for(var a,l,p=t.b2.arbiters,h=null,u=p.head;null!=u;){if(u.elt==t){null==h?(l=(a=p.head).next,p.head=l,null==p.head&&(p.pushmod=!0)):(l=(a=h.next).next,null==(h.next=l)&&(p.pushmod=!0));var c=a;c.elt=null,c.next=er.zpp_pool,er.zpp_pool=c,p.modified=!0,p.length--,p.pushmod=!0;break}u=(h=u).next}null!=t.pair&&(t.pair.arb=null,t.pair=null),t.active=!1,this.space.f_arbiters.modified=!0}var d=this.component;d.body=null,d.constraint=null,d.next=ti.zpp_pool,ti.zpp_pool=d,this.component=null,this.__iremovedFromSpace()},je.prototype.copy=function(){var t=(new $).zpp_inner;t.type=this.type,t.bulletEnabled=this.bulletEnabled,t.disableCCD=this.disableCCD;for(var e=this.shapes.head;null!=e;){var i=t.outer.zpp_inner.wrap_shapes,n=e.elt.outer.copy();i.zpp_inner.reverse_flag?i.push(n):i.unshift(n),e=e.next}if(t.posx=this.posx,t.posy=this.posy,t.velx=this.velx,t.vely=this.vely,t.forcex=this.forcex,t.forcey=this.forcey,t.rot=this.rot,t.angvel=this.angvel,t.torque=this.torque,t.kinvelx=this.kinvelx,t.kinvely=this.kinvely,t.kinangvel=this.kinangvel,t.svelx=this.svelx,t.svely=this.svely,this.zip_axis){t.zip_axis=!0;for(var r=t.shapes.head;null!=r;){var s=r.elt;1==s.type&&(s.polygon.invalidate_gverts(),s.polygon.invalidate_gaxi()),s.invalidate_worldCOM(),r=r.next}t.zip_worldCOM=!0}else t.axisx=this.axisx,t.axisy=this.axisy;return t.rot=this.rot,t.massMode=this.massMode,t.gravMassMode=this.gravMassMode,t.inertiaMode=this.inertiaMode,t.norotate=this.norotate,t.nomove=this.nomove,t.cmass=this.cmass,t.cinertia=this.cinertia,this.zip_mass?t.invalidate_mass():t.mass=this.mass,this.zip_gravMass?t.invalidate_gravMass():t.gravMass=this.gravMass,this.zip_gravMassScale?t.invalidate_gravMassScale():t.gravMassScale=this.gravMassScale,this.zip_inertia?t.invalidate_inertia():t.inertia=this.inertia,this.zip_aabb?t.zip_aabb=!0:(t.aabb.minx=this.aabb.minx,t.aabb.miny=this.aabb.miny,t.aabb.maxx=this.aabb.maxx,t.aabb.maxy=this.aabb.maxy),this.zip_localCOM?(t.zip_localCOM=!0,t.zip_worldCOM=!0):(t.localCOMx=this.localCOMx,t.localCOMy=this.localCOMy),this.zip_worldCOM?t.zip_worldCOM=!0:(t.worldCOMx=this.worldCOMx,t.worldCOMy=this.worldCOMy),this.copyto(t.outer),t.outer},je.prototype.__class__=je;var Ne=zpp_nape.phys.ZPP_Compound=function(){this.space=null,this.compound=null,this.depth=0,this.wrap_compounds=null,this.wrap_constraints=null,this.wrap_bodies=null,this.compounds=null,this.constraints=null,this.bodies=null,this.outer=null,$n.call(this),(this.icompound=this).depth=1,this.bodies=new mi,this.wrap_bodies=wn.get(this.bodies),this.wrap_bodies.zpp_inner.adder=Z(this,this.bodies_adder),this.wrap_bodies.zpp_inner.subber=Z(this,this.bodies_subber),this.constraints=new Pt,this.wrap_constraints=zn.get(this.constraints),this.wrap_constraints.zpp_inner.adder=Z(this,this.constraints_adder),this.wrap_constraints.zpp_inner.subber=Z(this,this.constraints_subber),this.compounds=new xi,this.wrap_compounds=Pn.get(this.compounds),this.wrap_compounds.zpp_inner.adder=Z(this,this.compounds_adder),this.wrap_compounds.zpp_inner.subber=Z(this,this.compounds_subber)};Ne.__name__=["zpp_nape","phys","ZPP_Compound"],Ne.__super__=$n,Ne.prototype=Object.create($n.prototype),Ne.prototype.outer=null,Ne.prototype.bodies=null,Ne.prototype.constraints=null,Ne.prototype.compounds=null,Ne.prototype.wrap_bodies=null,Ne.prototype.wrap_constraints=null,Ne.prototype.wrap_compounds=null,Ne.prototype.depth=null,Ne.prototype.compound=null,Ne.prototype.space=null,Ne.prototype.__imutable_midstep=function(t){},Ne.prototype.addedToSpace=function(){this.__iaddedToSpace()},Ne.prototype.removedFromSpace=function(){this.__iremovedFromSpace()},Ne.prototype.breakApart=function(){for(null!=this.space&&(this.__iremovedFromSpace(),this.space.nullInteractorType(this)),null!=this.compound?this.compound.compounds.remove(this):null!=this.space&&this.space.compounds.remove(this);null!=this.bodies.head;){var t=this.bodies.pop_unsafe();null!=(t.compound=this.compound)?this.compound.bodies.add(t):null!=this.space&&this.space.bodies.add(t),null!=this.space&&this.space.freshInteractorType(t)}for(;null!=this.constraints.head;){var e=this.constraints.pop_unsafe();null!=(e.compound=this.compound)?this.compound.constraints.add(e):null!=this.space&&this.space.constraints.add(e)}for(;null!=this.compounds.head;){var i=this.compounds.pop_unsafe();null!=(i.compound=this.compound)?this.compound.compounds.add(i):null!=this.space&&this.space.compounds.add(i),null!=this.space&&this.space.freshInteractorType(i)}this.compound=null,this.space=null},Ne.prototype.bodies_adder=function(t){return t.zpp_inner.compound!=this&&(null!=t.zpp_inner.compound?t.zpp_inner.compound.wrap_bodies.remove(t):null!=t.zpp_inner.space&&t.zpp_inner.space.wrap_bodies.remove(t),null!=(t.zpp_inner.compound=this).space&&this.space.addBody(t.zpp_inner),!0)},Ne.prototype.bodies_subber=function(t){(t.zpp_inner.compound=null)!=this.space&&this.space.remBody(t.zpp_inner)},Ne.prototype.constraints_adder=function(t){return t.zpp_inner.compound!=this&&(null!=t.zpp_inner.compound?t.zpp_inner.compound.wrap_constraints.remove(t):null!=t.zpp_inner.space&&t.zpp_inner.space.wrap_constraints.remove(t),null!=(t.zpp_inner.compound=this).space&&this.space.addConstraint(t.zpp_inner),!0)},Ne.prototype.constraints_subber=function(t){(t.zpp_inner.compound=null)!=this.space&&this.space.remConstraint(t.zpp_inner)},Ne.prototype.compounds_adder=function(t){return t.zpp_inner.compound!=this&&(null!=t.zpp_inner.compound?t.zpp_inner.compound.wrap_compounds.remove(t):null!=t.zpp_inner.space&&t.zpp_inner.space.wrap_compounds.remove(t),t.zpp_inner.compound=this,t.zpp_inner.depth=this.depth+1,null!=this.space&&this.space.addCompound(t.zpp_inner),!0)},Ne.prototype.compounds_subber=function(t){t.zpp_inner.compound=null,t.zpp_inner.depth=1,null!=this.space&&this.space.remCompound(t.zpp_inner)},Ne.prototype.copy=function(t,e){var i=null==t;null==t&&(t=[]),null==e&&(e=[]);for(var n=new it,r=this.compounds.head;null!=r;){var s,o=r.elt.copy(t,e);o.zpp_inner.immutable_midstep("Compound::compound"),(null==o.zpp_inner.compound?null:o.zpp_inner.compound.outer)!=n&&(null!=(null==o.zpp_inner.compound?null:o.zpp_inner.compound.outer)&&(null==o.zpp_inner.compound?null:o.zpp_inner.compound.outer).zpp_inner.wrap_compounds.remove(o),null!=n&&((s=n.zpp_inner.wrap_compounds).zpp_inner.reverse_flag?s.push(o):s.unshift(o))),r=r.next}for(var a=this.bodies.head;null!=a;){var l=a.elt,p=l.outer.copy();t.push(Lt.dict(l.id,p)),(null==p.zpp_inner.compound?null:p.zpp_inner.compound.outer)!=n&&(null!=(null==p.zpp_inner.compound?null:p.zpp_inner.compound.outer)&&(null==p.zpp_inner.compound?null:p.zpp_inner.compound.outer).zpp_inner.wrap_bodies.remove(p),null!=n&&((l=n.zpp_inner.wrap_bodies).zpp_inner.reverse_flag?l.push(p):l.unshift(p))),a=a.next}for(var h=this.constraints.head;null!=h;){var u,c=h.elt.copy(t,e);(null==c.zpp_inner.compound?null:c.zpp_inner.compound.outer)!=n&&(null!=(null==c.zpp_inner.compound?null:c.zpp_inner.compound.outer)&&(null==c.zpp_inner.compound?null:c.zpp_inner.compound.outer).zpp_inner.wrap_constraints.remove(c),null!=n&&((u=n.zpp_inner.wrap_constraints).zpp_inner.reverse_flag?u.push(c):u.unshift(c))),h=h.next}if(i)for(;0<e.length;)for(var d=e.pop(),_=0;_<t.length;){var y=t[_];if(++_,y.id==d.id){d.cb(y.bc);break}}return this.copyto(n),n},Ne.prototype.__class__=Ne;var Ge=zpp_nape.phys.ZPP_FluidProperties=function(){this.wrap_gravity=null,this.gravityy=0,this.gravityx=0,this.density=0,this.viscosity=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new ui,this.density=this.viscosity=1,this.wrap_gravity=null,this.gravityx=0,this.gravityy=0};Ge.__name__=["zpp_nape","phys","ZPP_FluidProperties"],Ge.prototype.next=null,Ge.prototype.userData=null,Ge.prototype.outer=null,Ge.prototype.wrapper=function(){var t;return null==this.outer&&(this.outer=new rt,(t=this.outer.zpp_inner).outer=null,t.next=Ge.zpp_pool,Ge.zpp_pool=t,this.outer.zpp_inner=this),this.outer},Ge.prototype.free=function(){this.outer=null},Ge.prototype.alloc=function(){},Ge.prototype.shapes=null,Ge.prototype.wrap_shapes=null,Ge.prototype.feature_cons=function(){this.shapes=new ui},Ge.prototype.addShape=function(t){this.shapes.add(t)},Ge.prototype.remShape=function(t){this.shapes.remove(t)},Ge.prototype.copy=function(){var t;return null==Ge.zpp_pool?t=new Ge:(t=Ge.zpp_pool,Ge.zpp_pool=t.next,t.next=null),t.viscosity=this.viscosity,t.density=this.density,t},Ge.prototype.viscosity=null,Ge.prototype.density=null,Ge.prototype.gravityx=null,Ge.prototype.gravityy=null,Ge.prototype.wrap_gravity=null,Ge.prototype.gravity_invalidate=function(t){this.gravityx=t.x,this.gravityy=t.y,this.invalidate()},Ge.prototype.gravity_validate=function(){this.wrap_gravity.zpp_inner.x=this.gravityx,this.wrap_gravity.zpp_inner.y=this.gravityy},Ge.prototype.getgravity=function(){var t,e,i=this.gravityx,n=this.gravityy;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_gravity=t,this.wrap_gravity.zpp_inner._inuse=!0,this.wrap_gravity.zpp_inner._invalidate=Z(this,this.gravity_invalidate),this.wrap_gravity.zpp_inner._validate=Z(this,this.gravity_validate)},Ge.prototype.invalidate=function(){for(var t=this.shapes.head;null!=t;)t.elt.invalidate_fluidprops(),t=t.next},Ge.prototype.__class__=Ge;var Ue=zpp_nape.phys.ZPP_Material=function(){this.rollingFriction=0,this.elasticity=0,this.density=0,this.staticFriction=0,this.dynamicFriction=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new ui,this.elasticity=0,this.dynamicFriction=1,this.staticFriction=2,this.density=.001,this.rollingFriction=.01};Ue.__name__=["zpp_nape","phys","ZPP_Material"],Ue.prototype.next=null,Ue.prototype.userData=null,Ue.prototype.outer=null,Ue.prototype.wrapper=function(){var t;return null==this.outer&&(this.outer=new pt,(t=this.outer.zpp_inner).outer=null,t.next=Ue.zpp_pool,Ue.zpp_pool=t,this.outer.zpp_inner=this),this.outer},Ue.prototype.free=function(){this.outer=null},Ue.prototype.alloc=function(){},Ue.prototype.shapes=null,Ue.prototype.wrap_shapes=null,Ue.prototype.feature_cons=function(){this.shapes=new ui},Ue.prototype.addShape=function(t){this.shapes.add(t)},Ue.prototype.remShape=function(t){this.shapes.remove(t)},Ue.prototype.dynamicFriction=null,Ue.prototype.staticFriction=null,Ue.prototype.density=null,Ue.prototype.elasticity=null,Ue.prototype.rollingFriction=null,Ue.prototype.copy=function(){var t=new Ue;return t.dynamicFriction=this.dynamicFriction,t.staticFriction=this.staticFriction,t.density=this.density,t.elasticity=this.elasticity,t.rollingFriction=this.rollingFriction,t},Ue.prototype.set=function(t){this.dynamicFriction=t.dynamicFriction,this.staticFriction=t.staticFriction,this.density=t.density,this.elasticity=t.elasticity,this.rollingFriction=t.rollingFriction},Ue.prototype.invalidate=function(t){for(var e=this.shapes.head;null!=e;)e.elt.invalidate_material(t),e=e.next},Ue.prototype.__class__=Ue;var Xe=zpp_nape.shape.ZPP_Shape=function(t){var e;this.zip_aabb=!1,this.aabb=null,this.pairs=null,this.node=null,this.sweep=null,this.sensorEnabled=!1,this.fluidEnabled=!1,this.fluidProperties=null,this.filter=null,this.material=null,this.refmaterial=null,this.polygon=null,this.circle=null,this.sweepCoef=0,this.zip_sweepRadius=!1,this.sweepRadius=0,this.wrap_worldCOM=null,this.wrap_localCOM=null,this.zip_worldCOM=!1,this.worldCOMy=0,this.worldCOMx=0,this.zip_localCOM=!1,this.localCOMy=0,this.localCOMx=0,this.zip_angDrag=!1,this.angDrag=0,this.inertia=0,this.zip_area_inertia=!1,this.area=0,this.type=0,this.body=null,this.outer=null,$n.call(this),this.pairs=new Ai,(this.ishape=this).type=t,null==Be.zpp_pool?e=new Be:(e=Be.zpp_pool,Be.zpp_pool=e.next,e.next=null),e.minx=0,e.miny=0,e.maxx=0,e.maxy=0,this.aabb=e,this.aabb._immutable=!0,this.aabb._validate=Z(this,this.aabb_validate),this.zip_area_inertia=this.zip_angDrag=this.zip_localCOM=this.zip_sweepRadius=!0,this.localCOMx=0,this.localCOMy=0,this.worldCOMx=0,this.worldCOMy=0,this.fluidEnabled=!1,this.sensorEnabled=!1,this.fluidProperties=null,this.body=null,this.refmaterial=new Ue,this.sweepRadius=this.sweepCoef=0};Xe.__name__=["zpp_nape","shape","ZPP_Shape"],Xe.__super__=$n,Xe.prototype=Object.create($n.prototype),Xe.prototype.outer=null,Xe.prototype.body=null,Xe.prototype.type=null,Xe.prototype.isCircle=function(){return 0==this.type},Xe.prototype.isPolygon=function(){return 1==this.type},Xe.prototype.area=null,Xe.prototype.zip_area_inertia=null,Xe.prototype.inertia=null,Xe.prototype.angDrag=null,Xe.prototype.zip_angDrag=null,Xe.prototype.localCOMx=null,Xe.prototype.localCOMy=null,Xe.prototype.zip_localCOM=null,Xe.prototype.worldCOMx=null,Xe.prototype.worldCOMy=null,Xe.prototype.zip_worldCOM=null,Xe.prototype.wrap_localCOM=null,Xe.prototype.wrap_worldCOM=null,Xe.prototype.sweepRadius=null,Xe.prototype.zip_sweepRadius=null,Xe.prototype.sweepCoef=null,Xe.prototype.invalidate_sweepRadius=function(){this.zip_sweepRadius=!0},Xe.prototype.validate_sweepRadius=function(){this.zip_sweepRadius&&(this.zip_sweepRadius=!1,(0==this.type?this.circle:this.polygon).__validate_sweepRadius())},Xe.prototype.circle=null,Xe.prototype.polygon=null,Xe.prototype.refmaterial=null,Xe.prototype.material=null,Xe.prototype.filter=null,Xe.prototype.fluidProperties=null,Xe.prototype.fluidEnabled=null,Xe.prototype.sensorEnabled=null,Xe.prototype.sweep=null,Xe.prototype.node=null,Xe.prototype.pairs=null,Xe.prototype.clear=function(){(0==this.type?this.circle:this.polygon).__clear()},Xe.prototype.aabb=null,Xe.prototype.zip_aabb=null,Xe.prototype.validate_aabb=function(){if(this.zip_aabb&&null!=this.body)if(this.zip_aabb=!1,0==this.type){var t=this.circle;if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,1==t.type){var e=t.polygon;if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y,e.localCOMx+=e.lverts.next.next.x,e.localCOMy+=e.lverts.next.next.y,e.localCOMx*=.5,e.localCOMy*=.5;else{e.localCOMx=0;var i=e.localCOMy=0,n=e.lverts.next,r=n,s=n=n.next;for(n=n.next;null!=n;){var o=n;i+=s.x*(o.y-r.y);var a=o.y*s.x-o.x*s.y;e.localCOMx+=(s.x+o.x)*a,e.localCOMy+=(s.y+o.y)*a,r=s,s=o,n=n.next}var l=n=e.lverts.next;i+=s.x*(l.y-r.y);var p=l.y*s.x-l.x*s.y;e.localCOMx+=(s.x+l.x)*p,e.localCOMy+=(s.y+l.y)*p,r=s;var h=n=n.next;i+=l.x*(h.y-r.y);p=h.y*l.x-h.x*l.y;e.localCOMx+=(l.x+h.x)*p,e.localCOMy+=(l.y+h.y)*p;h=i=1/(3*i);e.localCOMx*=h,e.localCOMy*=h}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}p=t.body;p.zip_axis&&(p.zip_axis=!1,p.axisx=Math.sin(p.rot),p.axisy=Math.cos(p.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}h=t.radius,p=t.radius;t.aabb.minx=t.worldCOMx-h,t.aabb.miny=t.worldCOMy-p,t.aabb.maxx=t.worldCOMx+h,t.aabb.maxy=t.worldCOMy+p}else{var u=this.polygon;if(u.zip_gverts&&null!=u.body){u.zip_gverts=!1,u.validate_lverts();var c=u.body;c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot));for(var d=u.lverts.next,_=u.gverts.next;null!=_;){var y=_,f=d,d=d.next;y.x=u.body.posx+(u.body.axisy*f.x-u.body.axisx*f.y),y.y=u.body.posy+(f.x*u.body.axisx+f.y*u.body.axisy),_=_.next}}c=u.gverts.next;u.aabb.minx=c.x,u.aabb.miny=c.y,u.aabb.maxx=c.x,u.aabb.maxy=c.y;for(var m=u.gverts.next.next;null!=m;){var x=m;x.x<u.aabb.minx&&(u.aabb.minx=x.x),x.x>u.aabb.maxx&&(u.aabb.maxx=x.x),x.y<u.aabb.miny&&(u.aabb.miny=x.y),x.y>u.aabb.maxy&&(u.aabb.maxy=x.y),m=m.next}}},Xe.prototype.force_validate_aabb=function(){if(0==this.type){var t=this.circle;t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy),t.aabb.minx=t.worldCOMx-t.radius,t.aabb.miny=t.worldCOMy-t.radius,t.aabb.maxx=t.worldCOMx+t.radius,t.aabb.maxy=t.worldCOMy+t.radius}else{var e=this.polygon,i=e.lverts.next,n=e.gverts.next,t=i;i=i.next,n.x=e.body.posx+(e.body.axisy*t.x-e.body.axisx*t.y),n.y=e.body.posy+(t.x*e.body.axisx+t.y*e.body.axisy),e.aabb.minx=n.x,e.aabb.miny=n.y,e.aabb.maxx=n.x,e.aabb.maxy=n.y;for(var r=e.gverts.next.next;null!=r;){var s=r,o=i,i=i.next;s.x=e.body.posx+(e.body.axisy*o.x-e.body.axisx*o.y),s.y=e.body.posy+(o.x*e.body.axisx+o.y*e.body.axisy),s.x<e.aabb.minx&&(e.aabb.minx=s.x),s.x>e.aabb.maxx&&(e.aabb.maxx=s.x),s.y<e.aabb.miny&&(e.aabb.miny=s.y),s.y>e.aabb.maxy&&(e.aabb.maxy=s.y),r=r.next}}},Xe.prototype.invalidate_aabb=function(){this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},Xe.prototype.validate_area_inertia=function(){this.zip_area_inertia&&(this.zip_area_inertia=!1,(0==this.type?this.circle:this.polygon).__validate_area_inertia())},Xe.prototype.validate_angDrag=function(){!this.zip_angDrag&&this.refmaterial.dynamicFriction==this.material.dynamicFriction||(this.zip_angDrag=!1,this.refmaterial.dynamicFriction=this.material.dynamicFriction,(0==this.type?this.circle:this.polygon).__validate_angDrag())},Xe.prototype.validate_localCOM=function(){if(this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var t=this.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y,t.localCOMx+=t.lverts.next.next.x,t.localCOMy+=t.lverts.next.next.y,t.localCOMx*=.5,t.localCOMy*=.5;else{t.localCOMx=0;var e=t.localCOMy=0,i=t.lverts.next,n=i,r=i=i.next;for(i=i.next;null!=i;){var s=i;e+=r.x*(s.y-n.y);var o=s.y*r.x-s.x*r.y;t.localCOMx+=(r.x+s.x)*o,t.localCOMy+=(r.y+s.y)*o,n=r,r=s,i=i.next}var a=i=t.lverts.next;e+=r.x*(a.y-n.y);var l=a.y*r.x-a.x*r.y;t.localCOMx+=(r.x+a.x)*l,t.localCOMy+=(r.y+a.y)*l,n=r;var p=i=i.next;e+=a.x*(p.y-n.y);l=p.y*a.x-p.x*a.y;t.localCOMx+=(a.x+p.x)*l,t.localCOMy+=(a.y+p.y)*l;l=e=1/(3*e);t.localCOMx*=l,t.localCOMy*=l}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}},Xe.prototype.validate_worldCOM=function(){if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var t=this.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y,t.localCOMx+=t.lverts.next.next.x,t.localCOMy+=t.lverts.next.next.y,t.localCOMx*=.5,t.localCOMy*=.5;else{t.localCOMx=0;var e=t.localCOMy=0,i=t.lverts.next,n=i,r=i=i.next;for(i=i.next;null!=i;){var s=i;e+=r.x*(s.y-n.y);var o=s.y*r.x-s.x*r.y;t.localCOMx+=(r.x+s.x)*o,t.localCOMy+=(r.y+s.y)*o,n=r,r=s,i=i.next}var a=i=t.lverts.next;e+=r.x*(a.y-n.y);var l=a.y*r.x-a.x*r.y;t.localCOMx+=(r.x+a.x)*l,t.localCOMy+=(r.y+a.y)*l,n=r;var p=i=i.next;e+=a.x*(p.y-n.y);l=p.y*a.x-p.x*a.y;t.localCOMx+=(a.x+p.x)*l,t.localCOMy+=(a.y+p.y)*l;l=e=1/(3*e);t.localCOMx*=l,t.localCOMy*=l}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}l=this.body;l.zip_axis&&(l.zip_axis=!1,l.axisx=Math.sin(l.rot),l.axisy=Math.cos(l.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}},Xe.prototype.getworldCOM=function(){if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var t=this.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y,t.localCOMx+=t.lverts.next.next.x,t.localCOMy+=t.lverts.next.next.y,t.localCOMx*=.5,t.localCOMy*=.5;else{t.localCOMx=0;var e=t.localCOMy=0,i=t.lverts.next,n=i,r=i=i.next;for(i=i.next;null!=i;){var s=i;e+=r.x*(s.y-n.y);var o=s.y*r.x-s.x*r.y;t.localCOMx+=(r.x+s.x)*o,t.localCOMy+=(r.y+s.y)*o,n=r,r=s,i=i.next}var a=i=t.lverts.next;e+=r.x*(a.y-n.y);var l=a.y*r.x-a.x*r.y;t.localCOMx+=(r.x+a.x)*l,t.localCOMy+=(r.y+a.y)*l,n=r;var p=i=i.next;e+=a.x*(p.y-n.y);l=p.y*a.x-p.x*a.y;t.localCOMx+=(a.x+p.x)*l,t.localCOMy+=(a.y+p.y)*l;l=e=1/(3*e);t.localCOMx*=l,t.localCOMy*=l}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}l=this.body;l.zip_axis&&(l.zip_axis=!1,l.axisx=Math.sin(l.rot),l.axisy=Math.cos(l.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}this.wrap_worldCOM.zpp_inner.x=this.worldCOMx,this.wrap_worldCOM.zpp_inner.y=this.worldCOMy},Xe.prototype.invalidate_area_inertia=function(){var t;this.zip_area_inertia=!0,null!=this.body&&((t=this.body).zip_localCOM=!0,t.zip_worldCOM=!0,this.body.invalidate_mass(),this.body.invalidate_inertia())},Xe.prototype.invalidate_angDrag=function(){this.zip_angDrag=!0},Xe.prototype.invalidate_localCOM=function(){var t;this.zip_localCOM=!0,this.invalidate_area_inertia(),0==this.type&&(this.zip_sweepRadius=!0),this.invalidate_angDrag(),this.invalidate_worldCOM(),null!=this.body&&((t=this.body).zip_localCOM=!0,t.zip_worldCOM=!0)},Xe.prototype.invalidate_worldCOM=function(){this.zip_worldCOM=!0,this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},Xe.prototype.invalidate_material=function(t){var e;0!=(t&Ue.WAKE)&&this.wake(),0!=(t&Ue.ARBITERS)&&null!=this.body&&this.body.refreshArbiters(),0!=(t&Ue.PROPS)&&null!=this.body&&((e=this.body).zip_localCOM=!0,e.zip_worldCOM=!0,this.body.invalidate_mass(),this.body.invalidate_inertia()),0!=(t&Ue.ANGDRAG)&&this.invalidate_angDrag(),this.refmaterial.set(this.material)},Xe.prototype.invalidate_filter=function(){this.wake()},Xe.prototype.invalidate_fluidprops=function(){this.fluidEnabled&&this.wake()},Xe.prototype.aabb_validate=function(){if(this.zip_aabb&&null!=this.body)if(this.zip_aabb=!1,0==this.type){var t=this.circle;if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,1==t.type){var e=t.polygon;if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y,e.localCOMx+=e.lverts.next.next.x,e.localCOMy+=e.lverts.next.next.y,e.localCOMx*=.5,e.localCOMy*=.5;else{e.localCOMx=0;var i=e.localCOMy=0,n=e.lverts.next,r=n,s=n=n.next;for(n=n.next;null!=n;){var o=n;i+=s.x*(o.y-r.y);var a=o.y*s.x-o.x*s.y;e.localCOMx+=(s.x+o.x)*a,e.localCOMy+=(s.y+o.y)*a,r=s,s=o,n=n.next}var l=n=e.lverts.next;i+=s.x*(l.y-r.y);var p=l.y*s.x-l.x*s.y;e.localCOMx+=(s.x+l.x)*p,e.localCOMy+=(s.y+l.y)*p,r=s;var h=n=n.next;i+=l.x*(h.y-r.y);p=h.y*l.x-h.x*l.y;e.localCOMx+=(l.x+h.x)*p,e.localCOMy+=(l.y+h.y)*p;h=i=1/(3*i);e.localCOMx*=h,e.localCOMy*=h}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}p=t.body;p.zip_axis&&(p.zip_axis=!1,p.axisx=Math.sin(p.rot),p.axisy=Math.cos(p.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}h=t.radius,p=t.radius;t.aabb.minx=t.worldCOMx-h,t.aabb.miny=t.worldCOMy-p,t.aabb.maxx=t.worldCOMx+h,t.aabb.maxy=t.worldCOMy+p}else{var u=this.polygon;if(u.zip_gverts&&null!=u.body){u.zip_gverts=!1,u.validate_lverts();var c=u.body;c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot));for(var d=u.lverts.next,_=u.gverts.next;null!=_;){var y=_,f=d,d=d.next;y.x=u.body.posx+(u.body.axisy*f.x-u.body.axisx*f.y),y.y=u.body.posy+(f.x*u.body.axisx+f.y*u.body.axisy),_=_.next}}c=u.gverts.next;u.aabb.minx=c.x,u.aabb.miny=c.y,u.aabb.maxx=c.x,u.aabb.maxy=c.y;for(var m=u.gverts.next.next;null!=m;){var x=m;x.x<u.aabb.minx&&(u.aabb.minx=x.x),x.x>u.aabb.maxx&&(u.aabb.maxx=x.x),x.y<u.aabb.miny&&(u.aabb.miny=x.y),x.y>u.aabb.maxy&&(u.aabb.maxy=x.y),m=m.next}}},Xe.prototype.setMaterial=function(t){this.material!=t&&(null!=this.body&&null!=this.body.space&&null!=this.material&&this.material.shapes.remove(this),this.material=t,null!=this.body&&null!=this.body.space&&t.shapes.add(this),this.wake(),null!=this.body&&this.body.refreshArbiters())},Xe.prototype.setFilter=function(t){this.filter!=t&&(null!=this.body&&null!=this.body.space&&null!=this.filter&&this.filter.shapes.remove(this),this.filter=t,null!=this.body&&null!=this.body.space&&t.shapes.add(this),this.wake())},Xe.prototype.setFluid=function(t){this.fluidProperties!=t&&(null!=this.body&&null!=this.body.space&&null!=this.fluidProperties&&this.fluidProperties.shapes.remove(this),this.fluidProperties=t,null!=this.body&&null!=this.body.space&&t.shapes.add(this),this.fluidEnabled&&this.wake())},Xe.prototype.__immutable_midstep=function(t){},Xe.prototype.addedToBody=function(){this.invalidate_worldCOM(),this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},Xe.prototype.removedFromBody=function(){},Xe.prototype.addedToSpace=function(){this.__iaddedToSpace(),this.material.shapes.add(this),this.filter.shapes.add(this),null!=this.fluidProperties&&this.fluidProperties.shapes.add(this)},Xe.prototype.removedFromSpace=function(){this.__iremovedFromSpace(),this.material.shapes.remove(this),this.filter.shapes.remove(this),null!=this.fluidProperties&&this.fluidProperties.shapes.remove(this)},Xe.prototype.copy=function(){var t=null,t=(0==this.type?this.circle:this.polygon).__copy();this.zip_area_inertia?t.invalidate_area_inertia():(t.area=this.area,t.inertia=this.inertia),this.zip_sweepRadius?t.zip_sweepRadius=!0:(t.sweepRadius=this.sweepRadius,t.sweepCoef=this.sweepCoef),this.zip_angDrag?t.invalidate_angDrag():t.angDrag=this.angDrag,this.zip_aabb?(t.zip_aabb=!0,null!=t.body&&(t.body.zip_aabb=!0)):(t.aabb.minx=this.aabb.minx,t.aabb.miny=this.aabb.miny,t.aabb.maxx=this.aabb.maxx,t.aabb.maxy=this.aabb.maxy);var e=t.material;e.outer=null,e.next=Ue.zpp_pool,Ue.zpp_pool=e;e=t.filter;return e.outer=null,e.next=le.zpp_pool,le.zpp_pool=e,t.material=this.material,t.filter=this.filter,null!=this.fluidProperties&&(t.fluidProperties=this.fluidProperties),t.fluidEnabled=this.fluidEnabled,t.sensorEnabled=this.sensorEnabled,null!=this.userData&&(t.userData=l.copy(this.userData)),this.copyto(t.outer),t.outer},Xe.prototype.__class__=Xe;var Ve=zpp_nape.shape.ZPP_Circle=function(){this.radius=0,this.outer_zn=null,Xe.call(this,0),(this.circle=this).zip_localCOM=!1};Ve.__name__=["zpp_nape","shape","ZPP_Circle"],Ve.__super__=Xe,Ve.prototype=Object.create(Xe.prototype),Ve.prototype.outer_zn=null,Ve.prototype.radius=null,Ve.prototype.__clear=function(){},Ve.prototype.invalidate_radius=function(){this.invalidate_area_inertia(),this.invalidate_angDrag(),this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0),null!=this.body&&this.body.wake()},Ve.prototype.localCOM_validate=function(){this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy},Ve.prototype.localCOM_invalidate=function(t){this.localCOMx=t.x,this.localCOMy=t.y,this.invalidate_localCOM(),null!=this.body&&this.body.wake()},Ve.prototype.setupLocalCOM=function(){var t,e,i=this.localCOMx,n=this.localCOMy;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_localCOM=t,this.wrap_localCOM.zpp_inner._inuse=!0,this.wrap_localCOM.zpp_inner._validate=Z(this,this.localCOM_validate),this.wrap_localCOM.zpp_inner._invalidate=Z(this,this.localCOM_invalidate)},Ve.prototype.__validate_aabb=function(){if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var t=this.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y,t.localCOMx+=t.lverts.next.next.x,t.localCOMy+=t.lverts.next.next.y,t.localCOMx*=.5,t.localCOMy*=.5;else{t.localCOMx=0;var e=t.localCOMy=0,i=t.lverts.next,n=i,r=i=i.next;for(i=i.next;null!=i;){var s=i;e+=r.x*(s.y-n.y);var o=s.y*r.x-s.x*r.y;t.localCOMx+=(r.x+s.x)*o,t.localCOMy+=(r.y+s.y)*o,n=r,r=s,i=i.next}var a=i=t.lverts.next;e+=r.x*(a.y-n.y);var l=a.y*r.x-a.x*r.y;t.localCOMx+=(r.x+a.x)*l,t.localCOMy+=(r.y+a.y)*l,n=r;var p=i=i.next;e+=a.x*(p.y-n.y);l=p.y*a.x-p.x*a.y;t.localCOMx+=(a.x+p.x)*l,t.localCOMy+=(a.y+p.y)*l;p=e=1/(3*e);t.localCOMx*=p,t.localCOMy*=p}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}l=this.body;l.zip_axis&&(l.zip_axis=!1,l.axisx=Math.sin(l.rot),l.axisy=Math.cos(l.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}p=this.radius,l=this.radius;this.aabb.minx=this.worldCOMx-p,this.aabb.miny=this.worldCOMy-l,this.aabb.maxx=this.worldCOMx+p,this.aabb.maxy=this.worldCOMy+l},Ve.prototype._force_validate_aabb=function(){this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy),this.aabb.minx=this.worldCOMx-this.radius,this.aabb.miny=this.worldCOMy-this.radius,this.aabb.maxx=this.worldCOMx+this.radius,this.aabb.maxy=this.worldCOMy+this.radius},Ve.prototype.__validate_sweepRadius=function(){this.sweepCoef=Math.sqrt(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy),this.sweepRadius=this.sweepCoef+this.radius},Ve.prototype.__validate_area_inertia=function(){var t=this.radius*this.radius;this.area=t*Math.PI,this.inertia=.5*t+(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy)},Ve.prototype.__validate_angDrag=function(){var t=this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy,e=this.radius*this.radius;this.angDrag=(t+2*e)*(this.material.dynamicFriction*kr.fluidAngularDragFriction)+.5*kr.fluidAngularDrag*(1+kr.fluidVacuumDrag)*t,this.angDrag/=2*(t+.5*e)},Ve.prototype.__scale=function(t,e){var i=((t<0?-t:t)+(e<0?-e:e))/2;this.radius*=i<0?-i:i,this.invalidate_radius(),0<this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy&&(this.localCOMx*=t,this.localCOMy*=e,this.invalidate_localCOM())},Ve.prototype.__translate=function(t,e){this.localCOMx+=t,this.localCOMy+=e,this.invalidate_localCOM()},Ve.prototype.__rotate=function(t,e){var i,n;0<this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy&&(n=i=0,i=e*this.localCOMx-t*this.localCOMy,n=this.localCOMx*t+this.localCOMy*e,this.localCOMx=i,this.localCOMy=n,this.invalidate_localCOM())},Ve.prototype.__transform=function(t){var e=t.zpp_inner.a*t.zpp_inner.d-t.zpp_inner.b*t.zpp_inner.c;e<0&&(e=-e),this.radius*=Math.sqrt(e);e=t.zpp_inner.a*this.localCOMx+t.zpp_inner.b*this.localCOMy+t.zpp_inner.tx;this.localCOMy=t.zpp_inner.c*this.localCOMx+t.zpp_inner.d*this.localCOMy+t.zpp_inner.ty,this.localCOMx=e,this.invalidate_radius(),this.invalidate_localCOM()},Ve.prototype.__copy=function(){var t=new ut(this.radius).zpp_inner_zn;return t.localCOMx=this.localCOMx,t.localCOMy=this.localCOMy,t.zip_localCOM=!1,t},Ve.prototype.__class__=Ve;var We=zpp_nape.shape.ZPP_Edge=function(){this.tp1=0,this.tp0=0,this.gp1=null,this.lp1=null,this.gp0=null,this.lp0=null,this.gprojection=0,this.lprojection=0,this.length=0,this.wrap_gnorm=null,this.gnormy=0,this.gnormx=0,this.wrap_lnorm=null,this.lnormy=0,this.lnormx=0,this.outer=null,this.polygon=null,this.next=null,this.lnormx=0,this.lnormy=0,this.gnormx=0,this.gnormy=0,this.length=0,this.lprojection=0,this.gprojection=0};We.__name__=["zpp_nape","shape","ZPP_Edge"],We.prototype.next=null,We.prototype.free=function(){this.polygon=null},We.prototype.alloc=function(){},We.prototype.polygon=null,We.prototype.outer=null,We.prototype.wrapper=function(){return null==this.outer&&(We.internal=!0,this.outer=new ct,We.internal=!1,this.outer.zpp_inner=this),this.outer},We.prototype.lnormx=null,We.prototype.lnormy=null,We.prototype.wrap_lnorm=null,We.prototype.gnormx=null,We.prototype.gnormy=null,We.prototype.wrap_gnorm=null,We.prototype.length=null,We.prototype.lprojection=null,We.prototype.gprojection=null,We.prototype.lp0=null,We.prototype.gp0=null,We.prototype.lp1=null,We.prototype.gp1=null,We.prototype.tp0=null,We.prototype.tp1=null,We.prototype.lnorm_validate=function(){this.polygon.validate_laxi(),this.wrap_lnorm.zpp_inner.x=this.lnormx,this.wrap_lnorm.zpp_inner.y=this.lnormy},We.prototype.gnorm_validate=function(){var t=this.polygon;if(t.zip_gaxi&&null!=t.body){t.zip_gaxi=!1,t.validate_laxi();var e=t.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),t.zip_gverts&&null!=t.body){t.zip_gverts=!1,t.validate_lverts();var i=t.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var n=t.lverts.next,r=t.gverts.next;null!=r;){var s=r,o=n,n=n.next;s.x=t.body.posx+(t.body.axisy*o.x-t.body.axisx*o.y),s.y=t.body.posy+(o.x*t.body.axisx+o.y*t.body.axisy),r=r.next}}for(var a=t.edges.head,l=p=t.gverts.next,p=p.next;null!=p;){var h=p,u=a.elt,a=a.next;u.gp0=l,u.gp1=h,u.gnormx=t.body.axisy*u.lnormx-t.body.axisx*u.lnormy,u.gnormy=u.lnormx*t.body.axisx+u.lnormy*t.body.axisy,u.gprojection=t.body.posx*u.gnormx+t.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy,l=h,p=p.next}i=a.elt;i.gp0=l,i.gp1=t.gverts.next,i.gnormx=t.body.axisy*i.lnormx-t.body.axisx*i.lnormy,i.gnormy=i.lnormx*t.body.axisx+i.lnormy*t.body.axisy,i.gprojection=t.body.posx*i.gnormx+t.body.posy*i.gnormy+i.lprojection,null!=i.wrap_gnorm&&(i.wrap_gnorm.zpp_inner.x=i.gnormx,i.wrap_gnorm.zpp_inner.y=i.gnormy),i.tp0=i.gp0.y*i.gnormx-i.gp0.x*i.gnormy,i.tp1=i.gp1.y*i.gnormx-i.gp1.x*i.gnormy}this.wrap_gnorm.zpp_inner.x=this.gnormx,this.wrap_gnorm.zpp_inner.y=this.gnormy},We.prototype.getlnorm=function(){var t,e,i=this.lnormx,n=this.lnormy;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_lnorm=t,this.wrap_lnorm.zpp_inner._immutable=!0,this.wrap_lnorm.zpp_inner._validate=Z(this,this.lnorm_validate)},We.prototype.getgnorm=function(){var t,e,i=this.gnormx,n=this.gnormy;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_gnorm=t,this.wrap_gnorm.zpp_inner._immutable=!0,this.wrap_gnorm.zpp_inner._validate=Z(this,this.gnorm_validate)},We.prototype.__class__=We;var He=zpp_nape.shape.ZPP_Polygon=function(){this.zip_sanitation=!1,this.zip_valid=!1,this.zip_gaxi=!1,this.zip_gverts=!1,this.zip_laxi=!1,this.zip_lverts=!1,this.reverse_flag=!1,this.edgeCnt=0,this.wrap_edges=null,this.edges=null,this.wrap_gverts=null,this.gverts=null,this.wrap_lverts=null,this.lverts=null,this.outer_zn=null,Xe.call(this,1),(this.polygon=this).lverts=new Ir,this.gverts=new Ir,this.edges=new Oi,this.edgeCnt=0};He.__name__=["zpp_nape","shape","ZPP_Polygon"],He.__super__=Xe,He.prototype=Object.create(Xe.prototype),He.prototype.outer_zn=null,He.prototype.lverts=null,He.prototype.wrap_lverts=null,He.prototype.gverts=null,He.prototype.wrap_gverts=null,He.prototype.edges=null,He.prototype.wrap_edges=null,He.prototype.edgeCnt=null,He.prototype.reverse_flag=null,He.prototype.__clear=function(){},He.prototype.lverts_pa_invalidate=function(t){this.invalidate_lverts()},He.prototype.gverts_pa_validate=function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var t=this.body;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));for(var e=this.lverts.next,i=this.gverts.next;null!=i;){var n=i,r=e,e=e.next;n.x=this.body.posx+(this.body.axisy*r.x-this.body.axisx*r.y),n.y=this.body.posy+(r.x*this.body.axisx+r.y*this.body.axisy),i=i.next}}},He.prototype.lverts_post_adder=function(t){t.zpp_inner._invalidate=Z(this,this.lverts_pa_invalidate);for(var e=null,i=null,n=this.lverts.next;null!=n&&n!=t.zpp_inner;)e=(null==e?this.gverts:e).next,i=null==i?this.edges.head:i.next,n=n.next;null==Ir.zpp_pool?a=new Ir:(a=Ir.zpp_pool,Ir.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!0,a.x=0,a.y=0;var r,s,o,a=a;this.gverts.insert(e,a),null!=this.lverts.next.next&&(null==this.lverts.next.next.next?(null==We.zpp_pool?r=new We:(r=We.zpp_pool,We.zpp_pool=r.next,r.next=null),(r.polygon=this).edges.add(r),null==We.zpp_pool?s=new We:(s=We.zpp_pool,We.zpp_pool=s.next,s.next=null),(s.polygon=this).edges.add(s),this.edgeCnt+=2):(null==We.zpp_pool?o=new We:(o=We.zpp_pool,We.zpp_pool=o.next,o.next=null),(o.polygon=this).edges.insert(i,o),this.edgeCnt++)),a._validate=Z(this,this.gverts_pa_validate)},He.prototype.lverts_subber=function(t){this.cleanup_lvert(t.zpp_inner)},He.prototype.lverts_invalidate=function(t){this.invalidate_lverts()},He.prototype.lverts_validate=function(){this.validate_lverts()},He.prototype.gverts_validate=function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var t=this.body;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));for(var e=this.lverts.next,i=this.gverts.next;null!=i;){var n=i,r=e,e=e.next;n.x=this.body.posx+(this.body.axisy*r.x-this.body.axisx*r.y),n.y=this.body.posy+(r.x*this.body.axisx+r.y*this.body.axisy),i=i.next}}},He.prototype.edges_validate=function(){this.validate_lverts()},He.prototype.getlverts=function(){this.wrap_lverts=bn.get(this.lverts),this.wrap_lverts.zpp_inner.post_adder=Z(this,this.lverts_post_adder),this.wrap_lverts.zpp_inner.subber=Z(this,this.lverts_subber),this.wrap_lverts.zpp_inner._invalidate=Z(this,this.lverts_invalidate),this.wrap_lverts.zpp_inner._validate=Z(this,this.lverts_validate),this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag},He.prototype.getgverts=function(){this.wrap_gverts=bn.get(this.gverts,!0),this.wrap_gverts.zpp_inner.reverse_flag=this.reverse_flag,this.wrap_gverts.zpp_inner._validate=Z(this,this.gverts_validate)},He.prototype.getedges=function(){this.wrap_edges=En.get(this.edges,!0),this.wrap_edges.zpp_inner.reverse_flag=this.reverse_flag,this.wrap_edges.zpp_inner._validate=Z(this,this.edges_validate)},He.prototype.zip_lverts=null,He.prototype.invalidate_lverts=function(){this.invalidate_laxi(),this.invalidate_area_inertia(),this.invalidate_angDrag(),this.invalidate_localCOM(),this.invalidate_gverts(),this.zip_lverts=!0,this.zip_valid=!0,this.zip_sanitation=!0,null!=this.body&&this.body.wake()},He.prototype.zip_laxi=null,He.prototype.invalidate_laxi=function(){this.invalidate_gaxi(),this.zip_sweepRadius=!0,this.zip_laxi=!0},He.prototype.zip_gverts=null,He.prototype.invalidate_gverts=function(){this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0),this.zip_gverts=!0},He.prototype.zip_gaxi=null,He.prototype.invalidate_gaxi=function(){this.zip_gaxi=!0},He.prototype.zip_valid=null,He.prototype.validation=null,He.prototype.valid=function(){if(this.zip_valid){if(this.zip_valid=!1,this.zip_sanitation&&(this.zip_sanitation=!1,this.splice_collinear_real()),this.lverts.length<3)return null==Yn.ValidationResult_DEGENERATE&&(Yn.internal=!0,Yn.ValidationResult_DEGENERATE=new mt,Yn.internal=!1),this.validation=Yn.ValidationResult_DEGENERATE;if(this.validate_lverts(),this.validate_area_inertia(),this.area<kr.epsilon)return null==Yn.ValidationResult_DEGENERATE&&(Yn.internal=!0,Yn.ValidationResult_DEGENERATE=new mt,Yn.internal=!1),this.validation=Yn.ValidationResult_DEGENERATE;var t=!1,e=!1,i=!0,n=this.lverts.next,r=n,s=n=n.next;for(n=n.next;null!=n;){var o=n,a=o.x-s.x,l=o.y-s.y,p=s.x-r.x,l=(s.y-r.y)*a-p*l;if(l>kr.epsilon?e=!0:l<-kr.epsilon&&(t=!0),e&&t){i=!1;break}r=s,s=o,n=n.next}if(i){for(var h=n=this.lverts.next;;){var u=h.x-s.x,c=h.y-s.y,d=s.x-r.x,c=(s.y-r.y)*u-d*c;if(c>kr.epsilon?e=!0:c<-kr.epsilon&&(t=!0),e&&t){i=!1;break}break}if(i){r=s,s=h;for(var _=n=n.next;;){var y=_.x-h.x,f=_.y-h.y,m=h.x-r.x,f=(h.y-r.y)*y-m*f;if(f>kr.epsilon?e=!0:f<-kr.epsilon&&(t=!0),e&&t)break;break}}}if(e&&t)return null==Yn.ValidationResult_CONCAVE&&(Yn.internal=!0,Yn.ValidationResult_CONCAVE=new mt,Yn.internal=!1),this.validation=Yn.ValidationResult_CONCAVE;for(var x=!0,v=!0,g=b=this.lverts.next,b=b.next;null!=b;){var z=b;if(!x){v=!1;break}for(var w=!0,C=P=this.lverts.next,P=P.next;null!=P;){var T=P;if(g!=C&&g!=T&&z!=C&&z!=T){var S=g.x-C.x,M=g.y-C.y,A=0,O=z.x-g.x,k=0,E=0,I=(A=z.y-g.y)*(k=T.x-C.x)-O*(E=T.y-C.y);if(I*I>kr.epsilon){k=(E*S-k*M)*(I=1/I);if(k>kr.epsilon&&k<1-kr.epsilon){I=(A*S-O*M)*I;if(I>kr.epsilon&&I<1-kr.epsilon){w=x=!1;break}}}C=T,P=P.next}else C=T,P=P.next}if(w)for(;;){var D=this.lverts.next;if(g==C||g==D||z==C||z==D)break;var B=g.x-C.x,L=g.y-C.y,R=0,F=z.x-g.x,j=0,N=0,D=(R=z.y-g.y)*(j=D.x-C.x)-F*(N=D.y-C.y);if(D*D>kr.epsilon){j=(N*B-j*L)*(D=1/D);if(j>kr.epsilon&&j<1-kr.epsilon){D=(R*B-F*L)*D;if(D>kr.epsilon&&D<1-kr.epsilon){x=!1;break}}}break}g=z,b=b.next}if(v)for(;;){var G=this.lverts.next;if(!x)break;for(var U=!0,X=V=this.lverts.next,V=V.next;null!=V;){var W=V;if(g!=X&&g!=W&&G!=X&&G!=W){var H=g.x-X.x,q=g.y-X.y,Y=0,K=G.x-g.x,Z=0,J=0,Q=(Y=G.y-g.y)*(Z=W.x-X.x)-K*(J=W.y-X.y);if(Q*Q>kr.epsilon){Z=(J*H-Z*q)*(Q=1/Q);if(Z>kr.epsilon&&Z<1-kr.epsilon){Q=(Y*H-K*q)*Q;if(Q>kr.epsilon&&Q<1-kr.epsilon){U=x=!1;break}}}X=W,V=V.next}else X=W,V=V.next}if(U)for(;;){var $=this.lverts.next;if(g==X||g==$||G==X||G==$)break;var tt=g.x-X.x,et=g.y-X.y,it=0,nt=G.x-g.x,rt=0,st=0,$=(it=G.y-g.y)*(rt=$.x-X.x)-nt*(st=$.y-X.y);if($*$>kr.epsilon){rt=(st*tt-rt*et)*($=1/$);if(rt>kr.epsilon&&rt<1-kr.epsilon){$=(it*tt-nt*et)*$;if($>kr.epsilon&&$<1-kr.epsilon){x=!1;break}}}break}break}return x?(null==Yn.ValidationResult_VALID&&(Yn.internal=!0,Yn.ValidationResult_VALID=new mt,Yn.internal=!1),this.validation=Yn.ValidationResult_VALID):(null==Yn.ValidationResult_SELF_INTERSECTING&&(Yn.internal=!0,Yn.ValidationResult_SELF_INTERSECTING=new mt,Yn.internal=!1),this.validation=Yn.ValidationResult_SELF_INTERSECTING)}return this.validation},He.prototype.validate_lverts=function(){this.zip_lverts&&(this.zip_lverts=!1,2<this.lverts.length&&(this.validate_area_inertia(),this.area<0&&(this.reverse_vertices(),this.area=-this.area)))},He.prototype.cleanup_lvert=function(t){for(var e=null,i=null,n=this.lverts.next;null!=n&&n!=t;)e=(null==e?this.gverts:e).next,i=null==i?this.edges.head:i.next,n=n.next;var r=(null==e?this.gverts:e).next;this.gverts.erase(e);var s,r=r;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Ir.zpp_pool,Ir.zpp_pool=r,2==this.edgeCnt?((s=this.edges.pop_unsafe()).polygon=null,s.next=We.zpp_pool,We.zpp_pool=s,(s=this.edges.pop_unsafe()).polygon=null,s.next=We.zpp_pool,We.zpp_pool=s,this.edgeCnt=0):0!=this.edgeCnt&&(s=(null==i?this.edges.head:i.next).elt,this.edges.erase(i),(s=s).polygon=null,s.next=We.zpp_pool,We.zpp_pool=s,this.edgeCnt--)},He.prototype.zip_sanitation=null,He.prototype.splice_collinear=function(){this.zip_sanitation&&(this.zip_sanitation=!1,this.splice_collinear_real())},He.prototype.splice_collinear_real=function(){if(null!=this.lverts.next&&null!=this.lverts.next.next&&null!=this.lverts.next.next.next){for(var t,e=null,i=this.lverts.next;null!=i;)var n=(null==i.next?this.lverts:i).next,r=i.x,s=i.y,o=0,a=0,i=(o=r-n.x)*o+(a=s-n.y)*a<kr.epsilon*kr.epsilon?(this.cleanup_lvert(i),this.lverts.erase(e)):(e=i).next;if(null!=this.lverts.next)for(;;){t=!1;for(var l=this.lverts.next;null!=l;)var p=(null==l.next?this.lverts:l).next,h=(null==p.next?this.lverts:p).next,u=p.x-l.x,c=p.y-l.y,d=h.x-p.x,c=(h.y-p.y)*u-d*c,l=(c*c>=kr.epsilon*kr.epsilon||(this.cleanup_lvert(p),this.lverts.erase(null==l.next?null:l),t=!0),l.next);if(!t)break}}},He.prototype.reverse_vertices=function(){this.lverts.reverse(),this.gverts.reverse(),this.edges.reverse(),this.edges.insert(this.edges.iterator_at(this.edgeCnt-1),this.edges.pop_unsafe()),this.reverse_flag=!this.reverse_flag,null!=this.wrap_lverts&&(this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag),null!=this.wrap_gverts&&(this.wrap_gverts.zpp_inner.reverse_flag=this.reverse_flag),null!=this.wrap_edges&&(this.wrap_edges.zpp_inner.reverse_flag=this.reverse_flag)},He.prototype.validate_laxi=function(){if(this.zip_laxi){this.zip_laxi=!1,this.validate_lverts();for(var t=this.edges.head,e=i=this.lverts.next,i=i.next;null!=i;){var n=i,r=t.elt,t=t.next;r.lp0=e,r.lp1=n;var s=e.x-n.x,o=e.y-n.y,a=Math.sqrt(s*s+o*o),l=1/(r.length=a),a=s*=l;s=-(o*=l),o=a,r.lprojection=s*e.x+o*e.y,r.lnormx=s,r.lnormy=o,null!=r.wrap_lnorm&&(r.wrap_lnorm.zpp_inner.x=s,r.wrap_lnorm.zpp_inner.y=o),e=n,i=i.next}var p=this.lverts.next,h=t.elt;h.lp0=e,h.lp1=p;var u=e.x-p.x,c=e.y-p.y,d=Math.sqrt(u*u+c*c),p=1/(h.length=d),d=u*=p;u=-(c*=p),c=d,h.lprojection=u*e.x+c*e.y,h.lnormx=u,h.lnormy=c,null!=h.wrap_lnorm&&(h.wrap_lnorm.zpp_inner.x=u,h.wrap_lnorm.zpp_inner.y=c)}},He.prototype.validate_gverts=function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var t=this.body;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));for(var e=this.lverts.next,i=this.gverts.next;null!=i;){var n=i,r=e,e=e.next;n.x=this.body.posx+(this.body.axisy*r.x-this.body.axisx*r.y),n.y=this.body.posy+(r.x*this.body.axisx+r.y*this.body.axisy),i=i.next}}},He.prototype.validate_gaxi=function(){if(this.zip_gaxi&&null!=this.body){this.zip_gaxi=!1,this.validate_laxi();var t=this.body;if(t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var e=this.body;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));for(var i=this.lverts.next,n=this.gverts.next;null!=n;){var r=n,s=i,i=i.next;r.x=this.body.posx+(this.body.axisy*s.x-this.body.axisx*s.y),r.y=this.body.posy+(s.x*this.body.axisx+s.y*this.body.axisy),n=n.next}}for(var o=this.edges.head,a=l=this.gverts.next,l=l.next;null!=l;){var p=l,h=o.elt,o=o.next;h.gp0=a,h.gp1=p,h.gnormx=this.body.axisy*h.lnormx-this.body.axisx*h.lnormy,h.gnormy=h.lnormx*this.body.axisx+h.lnormy*this.body.axisy,h.gprojection=this.body.posx*h.gnormx+this.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,a=p,l=l.next}e=o.elt;e.gp0=a,e.gp1=this.gverts.next,e.gnormx=this.body.axisy*e.lnormx-this.body.axisx*e.lnormy,e.gnormy=e.lnormx*this.body.axisx+e.lnormy*this.body.axisy,e.gprojection=this.body.posx*e.gnormx+this.body.posy*e.gnormy+e.lprojection,null!=e.wrap_gnorm&&(e.wrap_gnorm.zpp_inner.x=e.gnormx,e.wrap_gnorm.zpp_inner.y=e.gnormy),e.tp0=e.gp0.y*e.gnormx-e.gp0.x*e.gnormy,e.tp1=e.gp1.y*e.gnormx-e.gp1.x*e.gnormy}},He.prototype.__validate_aabb=function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var t=this.body;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));for(var e=this.lverts.next,i=this.gverts.next;null!=i;){var n=i,r=e,e=e.next;n.x=this.body.posx+(this.body.axisy*r.x-this.body.axisx*r.y),n.y=this.body.posy+(r.x*this.body.axisx+r.y*this.body.axisy),i=i.next}}t=this.gverts.next;this.aabb.minx=t.x,this.aabb.miny=t.y,this.aabb.maxx=t.x,this.aabb.maxy=t.y;for(var s=this.gverts.next.next;null!=s;){var o=s;o.x<this.aabb.minx&&(this.aabb.minx=o.x),o.x>this.aabb.maxx&&(this.aabb.maxx=o.x),o.y<this.aabb.miny&&(this.aabb.miny=o.y),o.y>this.aabb.maxy&&(this.aabb.maxy=o.y),s=s.next}},He.prototype._force_validate_aabb=function(){var t=this.lverts.next,e=this.gverts.next,i=t;t=t.next,e.x=this.body.posx+(this.body.axisy*i.x-this.body.axisx*i.y),e.y=this.body.posy+(i.x*this.body.axisx+i.y*this.body.axisy),this.aabb.minx=e.x,this.aabb.miny=e.y,this.aabb.maxx=e.x,this.aabb.maxy=e.y;for(var n=this.gverts.next.next;null!=n;){var r=n,s=t,t=t.next;r.x=this.body.posx+(this.body.axisy*s.x-this.body.axisx*s.y),r.y=this.body.posy+(s.x*this.body.axisx+s.y*this.body.axisy),r.x<this.aabb.minx&&(this.aabb.minx=r.x),r.x>this.aabb.maxx&&(this.aabb.maxx=r.x),r.y<this.aabb.miny&&(this.aabb.miny=r.y),r.y>this.aabb.maxy&&(this.aabb.maxy=r.y),n=n.next}},He.prototype.__validate_sweepRadius=function(){var t=0,e=0;this.validate_laxi();for(var i=this.lverts.next;null!=i;){var n=i.x*i.x+i.y*i.y;t<n&&(t=n),i=i.next}for(var r=this.edges.head;null!=r;){var s=r.elt;if(s.lprojection<e&&(e=s.lprojection)<0)break;r=r.next}e<0&&(e=0),this.sweepRadius=Math.sqrt(t),this.sweepCoef=this.sweepRadius-e},He.prototype.__validate_area_inertia=function(){if(null==this.lverts.next||null==this.lverts.next.next||null==this.lverts.next.next.next)this.area=0,this.inertia=0;else{var t=this.area=0,e=0,i=this.lverts.next,n=i,r=i=i.next;for(i=i.next;null!=i;){var s=i,o=r.y*n.x-r.x*n.y;t+=o*(r.x*r.x+r.y*r.y+(r.x*n.x+r.y*n.y)+(n.x*n.x+n.y*n.y)),e+=o,this.area+=r.x*(s.y-n.y),n=r,r=s,i=i.next}var a=i=this.lverts.next,l=r.y*n.x-r.x*n.y;t+=l*(r.x*r.x+r.y*r.y+(r.x*n.x+r.y*n.y)+(n.x*n.x+n.y*n.y)),e+=l,this.area+=r.x*(a.y-n.y),n=r,i=i.next;l=a.y*n.x-a.x*n.y;t+=l*(a.x*a.x+a.y*a.y+(a.x*n.x+a.y*n.y)+(n.x*n.x+n.y*n.y)),e+=l,this.area+=a.x*(i.y-n.y),this.inertia=t/(6*e),this.area*=.5,this.area<0&&(this.area=-this.area,this.reverse_vertices())}},He.prototype.__validate_angDrag=function(){this.validate_area_inertia(),this.validate_laxi();for(var t=0,e=this.edges.head,i=0,n=this.lverts.next,r=n,s=n.next;null!=s;){var o=e.elt,e=e.next;i+=o.length;var a=s.x-r.x,l=s.y-r.y;t+=o.length*kr.fluidAngularDragFriction*this.material.dynamicFriction*o.lprojection*o.lprojection;var p,h,u,c,d=-(r.y*o.lnormx-r.x*o.lnormy)/(l*o.lnormx-a*o.lnormy);0<d&&(c=1<d?1:d,h=p=0,p=r.x,h=r.y,p+=a*c,h+=l*c,u=o.lnormy*r.x-o.lnormx*r.y,t+=((h=o.lnormy*p-o.lnormx*h)*h*h-u*u*u)/(3*(h-u))*c*o.length*kr.fluidAngularDrag),d<1&&(u=d<0?0:d,d=c=0,c=r.x,d=r.y,c+=a*u,d+=l*u,c=o.lnormy*c-o.lnormx*d,t+=((d=o.lnormy*s.x-o.lnormx*s.y)*d*d-c*c*c)/(3*(d-c))*kr.fluidVacuumDrag*(1-u)*o.length*kr.fluidAngularDrag),s=(r=s).next}for(;;){s=this.lverts.next;var _=e.elt;e=e.next,i+=_.length;var y=s.x-r.x,f=s.y-r.y;t+=_.length*kr.fluidAngularDragFriction*this.material.dynamicFriction*_.lprojection*_.lprojection;var m,x,v,g,b=-(r.y*_.lnormx-r.x*_.lnormy)/(f*_.lnormx-y*_.lnormy);0<b&&(g=1<b?1:b,x=m=0,m=r.x,x=r.y,m+=y*g,x+=f*g,v=_.lnormy*r.x-_.lnormx*r.y,t+=((x=_.lnormy*m-_.lnormx*x)*x*x-v*v*v)/(3*(x-v))*g*_.length*kr.fluidAngularDrag),b<1&&(v=b<0?0:b,b=g=0,g=r.x,b=r.y,g+=y*v,b+=f*v,g=_.lnormy*g-_.lnormx*b,t+=((b=_.lnormy*s.x-_.lnormx*s.y)*b*b-g*g*g)/(3*(b-g))*kr.fluidVacuumDrag*(1-v)*_.length*kr.fluidAngularDrag);break}this.angDrag=t/(this.inertia*i)},He.prototype.__validate_localCOM=function(){if(null==this.lverts.next.next)this.localCOMx=this.lverts.next.x,this.localCOMy=this.lverts.next.y;else if(null==this.lverts.next.next.next)this.localCOMx=this.lverts.next.x,this.localCOMy=this.lverts.next.y,this.localCOMx+=this.lverts.next.next.x,this.localCOMy+=this.lverts.next.next.y,this.localCOMx*=.5,this.localCOMy*=.5;else{this.localCOMx=0;var t=this.localCOMy=0,e=this.lverts.next,i=e,n=e=e.next;for(e=e.next;null!=e;){var r=e;t+=n.x*(r.y-i.y);var s=r.y*n.x-r.x*n.y;this.localCOMx+=(n.x+r.x)*s,this.localCOMy+=(n.y+r.y)*s,i=n,n=r,e=e.next}var o=e=this.lverts.next;t+=n.x*(o.y-i.y);var a=o.y*n.x-o.x*n.y;this.localCOMx+=(n.x+o.x)*a,this.localCOMy+=(n.y+o.y)*a,i=n;var l=e=e.next;t+=o.x*(l.y-i.y);a=l.y*o.x-l.x*o.y;this.localCOMx+=(o.x+l.x)*a,this.localCOMy+=(o.y+l.y)*a;a=t=1/(3*t);this.localCOMx*=a,this.localCOMy*=a}},He.prototype.localCOM_validate=function(){if(this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var t=this.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y,t.localCOMx+=t.lverts.next.next.x,t.localCOMy+=t.lverts.next.next.y,t.localCOMx*=.5,t.localCOMy*=.5;else{t.localCOMx=0;var e=t.localCOMy=0,i=t.lverts.next,n=i,r=i=i.next;for(i=i.next;null!=i;){var s=i;e+=r.x*(s.y-n.y);var o=s.y*r.x-s.x*r.y;t.localCOMx+=(r.x+s.x)*o,t.localCOMy+=(r.y+s.y)*o,n=r,r=s,i=i.next}var a=i=t.lverts.next;e+=r.x*(a.y-n.y);var l=a.y*r.x-a.x*r.y;t.localCOMx+=(r.x+a.x)*l,t.localCOMy+=(r.y+a.y)*l,n=r;var p=i=i.next;e+=a.x*(p.y-n.y);l=p.y*a.x-p.x*a.y;t.localCOMx+=(a.x+p.x)*l,t.localCOMy+=(a.y+p.y)*l;l=e=1/(3*e);t.localCOMx*=l,t.localCOMy*=l}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}},He.prototype.localCOM_invalidate=function(t){if(this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var e=this.polygon;if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y,e.localCOMx+=e.lverts.next.next.x,e.localCOMy+=e.lverts.next.next.y,e.localCOMx*=.5,e.localCOMy*=.5;else{e.localCOMx=0;var i=e.localCOMy=0,n=e.lverts.next,r=n,s=n=n.next;for(n=n.next;null!=n;){var o=n;i+=s.x*(o.y-r.y);var a=o.y*s.x-o.x*s.y;e.localCOMx+=(s.x+o.x)*a,e.localCOMy+=(s.y+o.y)*a,r=s,s=o,n=n.next}var l=n=e.lverts.next;i+=s.x*(l.y-r.y);var p=l.y*s.x-l.x*s.y;e.localCOMx+=(s.x+l.x)*p,e.localCOMy+=(s.y+l.y)*p,r=s;var h=n=n.next;i+=l.x*(h.y-r.y);p=h.y*l.x-h.x*l.y;e.localCOMx+=(l.x+h.x)*p,e.localCOMy+=(l.y+h.y)*p;p=i=1/(3*i);e.localCOMx*=p,e.localCOMy*=p}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}for(var u=t.x-this.localCOMx,c=t.y-this.localCOMy,d=this.lverts.next;null!=d;){var _=d;_.x+=u,_.y+=c,d=d.next}this.invalidate_lverts()},He.prototype.setupLocalCOM=function(){var t,e,i=this.localCOMx,n=this.localCOMy;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_localCOM=t,this.wrap_localCOM.zpp_inner._inuse=!0,this.wrap_localCOM.zpp_inner._validate=Z(this,this.localCOM_validate),this.wrap_localCOM.zpp_inner._invalidate=Z(this,this.localCOM_invalidate)},He.prototype.__translate=function(t,e){for(var i=this.lverts.next;null!=i;){var n=i;n.x+=t,n.y+=e,i=i.next}this.invalidate_lverts()},He.prototype.__scale=function(t,e){for(var i=this.lverts.next;null!=i;){var n=i;n.x*=t,n.y*=e,i=i.next}this.invalidate_lverts()},He.prototype.__rotate=function(t,e){for(var i=this.lverts.next;null!=i;){var n=i,r=e*n.x-t*n.y,s=n.x*t+n.y*e;n.x=r,n.y=s,i=i.next}this.invalidate_lverts()},He.prototype.__transform=function(t){for(var e=this.lverts.next;null!=e;){var i=e,n=t.zpp_inner.a*i.x+t.zpp_inner.b*i.y+t.zpp_inner.tx;i.y=t.zpp_inner.c*i.x+t.zpp_inner.d*i.y+t.zpp_inner.ty,i.x=n,e=e.next}this.invalidate_lverts()},He.prototype.__copy=function(){var t=this.outer_zn;return null==t.zpp_inner_zn.wrap_lverts&&t.zpp_inner_zn.getlverts(),new _t(t.zpp_inner_zn.wrap_lverts).zpp_inner_zn},He.prototype.__class__=He;var qe=zpp_nape.space.ZPP_Broadphase=function(){this.circShape=null,this.matrix=null,this.aabbShape=null,this.dynab=null,this.sweep=null,this.is_sweep=!1,this.space=null};qe.__name__=["zpp_nape","space","ZPP_Broadphase"],qe.prototype.space=null,qe.prototype.is_sweep=null,qe.prototype.sweep=null,qe.prototype.dynab=null,qe.prototype.insert=function(t){(this.is_sweep?this.sweep:this.dynab).__insert(t)},qe.prototype.remove=function(t){(this.is_sweep?this.sweep:this.dynab).__remove(t)},qe.prototype.sync=function(t){if(this.is_sweep){if(!this.sweep.space.continuous&&t.zip_aabb&&null!=t.body)if(t.zip_aabb=!1,0==t.type){var e=t.circle;if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,1==e.type){var i=e.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y,i.localCOMx+=i.lverts.next.next.x,i.localCOMy+=i.lverts.next.next.y,i.localCOMx*=.5,i.localCOMy*=.5;else{i.localCOMx=0;var n=i.localCOMy=0,r=i.lverts.next,s=r,o=r=r.next;for(r=r.next;null!=r;){var a=r;n+=o.x*(a.y-s.y);var l=a.y*o.x-a.x*o.y;i.localCOMx+=(o.x+a.x)*l,i.localCOMy+=(o.y+a.y)*l,s=o,o=a,r=r.next}var p=r=i.lverts.next;n+=o.x*(p.y-s.y);var h=p.y*o.x-p.x*o.y;i.localCOMx+=(o.x+p.x)*h,i.localCOMy+=(o.y+p.y)*h,s=o;var u=r=r.next;n+=p.x*(u.y-s.y);h=u.y*p.x-u.x*p.y;i.localCOMx+=(p.x+u.x)*h,i.localCOMy+=(p.y+u.y)*h;u=n=1/(3*n);i.localCOMx*=u,i.localCOMy*=u}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}h=e.body;h.zip_axis&&(h.zip_axis=!1,h.axisx=Math.sin(h.rot),h.axisy=Math.cos(h.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}u=e.radius,h=e.radius;e.aabb.minx=e.worldCOMx-u,e.aabb.miny=e.worldCOMy-h,e.aabb.maxx=e.worldCOMx+u,e.aabb.maxy=e.worldCOMy+h}else{var c=t.polygon;if(c.zip_gverts&&null!=c.body){c.zip_gverts=!1,c.validate_lverts();var d=c.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot));for(var _=c.lverts.next,y=c.gverts.next;null!=y;){var f=y,m=_,_=_.next;f.x=c.body.posx+(c.body.axisy*m.x-c.body.axisx*m.y),f.y=c.body.posy+(m.x*c.body.axisx+m.y*c.body.axisy),y=y.next}}var x=c.gverts.next;c.aabb.minx=x.x,c.aabb.miny=x.y,c.aabb.maxx=x.x,c.aabb.maxy=x.y;for(var v=c.gverts.next.next;null!=v;){var g=v;g.x<c.aabb.minx&&(c.aabb.minx=g.x),g.x>c.aabb.maxx&&(c.aabb.maxx=g.x),g.y<c.aabb.miny&&(c.aabb.miny=g.y),g.y>c.aabb.maxy&&(c.aabb.maxy=g.y),v=v.next}}}else{e=this.dynab,h=t.node;if(!h.synced){if(!e.space.continuous&&t.zip_aabb&&null!=t.body)if(t.zip_aabb=!1,0==t.type){d=t.circle;if(d.zip_worldCOM&&null!=d.body){if(d.zip_worldCOM=!1,d.zip_localCOM){if(d.zip_localCOM=!1,1==d.type){var b=d.polygon;if(null==b.lverts.next.next)b.localCOMx=b.lverts.next.x,b.localCOMy=b.lverts.next.y;else if(null==b.lverts.next.next.next)b.localCOMx=b.lverts.next.x,b.localCOMy=b.lverts.next.y,b.localCOMx+=b.lverts.next.next.x,b.localCOMy+=b.lverts.next.next.y,b.localCOMx*=.5,b.localCOMy*=.5;else{b.localCOMx=0;var z=b.localCOMy=0,w=b.lverts.next,C=w,P=w=w.next;for(w=w.next;null!=w;){var T=w;z+=P.x*(T.y-C.y);var S=T.y*P.x-T.x*P.y;b.localCOMx+=(P.x+T.x)*S,b.localCOMy+=(P.y+T.y)*S,C=P,P=T,w=w.next}x=w=b.lverts.next;z+=P.x*(x.y-C.y);var M=x.y*P.x-x.x*P.y;b.localCOMx+=(P.x+x.x)*M,b.localCOMy+=(P.y+x.y)*M,C=P;var A=w=w.next;z+=x.x*(A.y-C.y);M=A.y*x.x-A.x*x.y;b.localCOMx+=(x.x+A.x)*M,b.localCOMy+=(x.y+A.y)*M;A=z=1/(3*z);b.localCOMx*=A,b.localCOMy*=A}}null!=d.wrap_localCOM&&(d.wrap_localCOM.zpp_inner.x=d.localCOMx,d.wrap_localCOM.zpp_inner.y=d.localCOMy)}M=d.body;M.zip_axis&&(M.zip_axis=!1,M.axisx=Math.sin(M.rot),M.axisy=Math.cos(M.rot)),d.worldCOMx=d.body.posx+(d.body.axisy*d.localCOMx-d.body.axisx*d.localCOMy),d.worldCOMy=d.body.posy+(d.localCOMx*d.body.axisx+d.localCOMy*d.body.axisy)}A=d.radius,M=d.radius;d.aabb.minx=d.worldCOMx-A,d.aabb.miny=d.worldCOMy-M,d.aabb.maxx=d.worldCOMx+A,d.aabb.maxy=d.worldCOMy+M}else{var O=t.polygon;if(O.zip_gverts&&null!=O.body){O.zip_gverts=!1,O.validate_lverts();var k=O.body;k.zip_axis&&(k.zip_axis=!1,k.axisx=Math.sin(k.rot),k.axisy=Math.cos(k.rot));for(var E=O.lverts.next,I=O.gverts.next;null!=I;){var D=I,B=E,E=E.next;D.x=O.body.posx+(O.body.axisy*B.x-O.body.axisx*B.y),D.y=O.body.posy+(B.x*O.body.axisx+B.y*O.body.axisy),I=I.next}}var k=O.gverts.next;O.aabb.minx=k.x,O.aabb.miny=k.y,O.aabb.maxx=k.x,O.aabb.maxy=k.y;for(var L=O.gverts.next.next;null!=L;){var R=L;R.x<O.aabb.minx&&(O.aabb.minx=R.x),R.x>O.aabb.maxx&&(O.aabb.maxx=R.x),R.y<O.aabb.miny&&(O.aabb.miny=R.y),R.y>O.aabb.maxy&&(O.aabb.maxy=R.y),L=L.next}}(h.dyn!=(1!=t.body.type&&!t.body.component.sleeping)||(k=h.aabb,!((t=t.aabb).minx>=k.minx&&t.miny>=k.miny&&t.maxx<=k.maxx&&t.maxy<=k.maxy)))&&(h.synced=!0,h.snext=e.syncs,e.syncs=h)}}},qe.prototype.broadphase=function(t,e){},qe.prototype.clear=function(){},qe.prototype.shapesUnderPoint=function(t,e,i,n){return null},qe.prototype.bodiesUnderPoint=function(t,e,i,n){return null},qe.prototype.aabbShape=null,qe.prototype.matrix=null,qe.prototype.updateAABBShape=function(t){var e,i,n;null==this.aabbShape?(null==Yn.BodyType_STATIC&&(Yn.internal=!0,Yn.BodyType_STATIC=new et,Yn.internal=!1),i=new $(Yn.BodyType_STATIC).zpp_inner.wrap_shapes,n=this.aabbShape=new _t(_t.rect(t.minx,t.miny,t.maxx-t.minx,t.maxy-t.miny)),i.zpp_inner.reverse_flag?i.push(n):i.unshift(n)):(r=this.aabbShape.zpp_inner.aabb,e=(t.maxx-t.minx)/(r.maxx-r.minx),d=(t.maxy-t.miny)/(r.maxy-r.miny),null==this.matrix&&(this.matrix=new X),(i=this.matrix).zpp_inner.a=e,null!=(n=i.zpp_inner)._invalidate&&n._invalidate(),s=this.matrix,(i=this.matrix).zpp_inner.c=0,null!=(n=i.zpp_inner)._invalidate&&n._invalidate(),s.zpp_inner.b=i.zpp_inner.c,null!=(s=s.zpp_inner)._invalidate&&s._invalidate(),(s=this.matrix).zpp_inner.d=d,null!=(s=s.zpp_inner)._invalidate&&s._invalidate(),(s=this.matrix).zpp_inner.tx=t.minx-e*r.minx,null!=(s=s.zpp_inner)._invalidate&&s._invalidate(),(s=this.matrix).zpp_inner.ty=t.miny-d*r.miny,null!=(d=s.zpp_inner)._invalidate&&d._invalidate(),this.aabbShape.transform(this.matrix));var r=this.aabbShape.zpp_inner;if(r.zip_aabb&&null!=r.body)if(r.zip_aabb=!1,0==r.type){var s=r.circle;if(s.zip_worldCOM&&null!=s.body){if(s.zip_worldCOM=!1,s.zip_localCOM){if(s.zip_localCOM=!1,1==s.type){var o=s.polygon;if(null==o.lverts.next.next)o.localCOMx=o.lverts.next.x,o.localCOMy=o.lverts.next.y;else if(null==o.lverts.next.next.next)o.localCOMx=o.lverts.next.x,o.localCOMy=o.lverts.next.y,o.localCOMx+=o.lverts.next.next.x,o.localCOMy+=o.lverts.next.next.y,o.localCOMx*=.5,o.localCOMy*=.5;else{o.localCOMx=0;var a=o.localCOMy=0,l=o.lverts.next,p=l,h=l=l.next;for(l=l.next;null!=l;){var u=l;a+=h.x*(u.y-p.y);var c=u.y*h.x-u.x*h.y;o.localCOMx+=(h.x+u.x)*c,o.localCOMy+=(h.y+u.y)*c,p=h,h=u,l=l.next}var d=l=o.lverts.next;a+=h.x*(d.y-p.y);var _=d.y*h.x-d.x*h.y;o.localCOMx+=(h.x+d.x)*_,o.localCOMy+=(h.y+d.y)*_,p=h;var y=l=l.next;a+=d.x*(y.y-p.y);_=y.y*d.x-y.x*d.y;o.localCOMx+=(d.x+y.x)*_,o.localCOMy+=(d.y+y.y)*_;y=a=1/(3*a);o.localCOMx*=y,o.localCOMy*=y}}null!=s.wrap_localCOM&&(s.wrap_localCOM.zpp_inner.x=s.localCOMx,s.wrap_localCOM.zpp_inner.y=s.localCOMy)}_=s.body;_.zip_axis&&(_.zip_axis=!1,_.axisx=Math.sin(_.rot),_.axisy=Math.cos(_.rot)),s.worldCOMx=s.body.posx+(s.body.axisy*s.localCOMx-s.body.axisx*s.localCOMy),s.worldCOMy=s.body.posy+(s.localCOMx*s.body.axisx+s.localCOMy*s.body.axisy)}y=s.radius,_=s.radius;s.aabb.minx=s.worldCOMx-y,s.aabb.miny=s.worldCOMy-_,s.aabb.maxx=s.worldCOMx+y,s.aabb.maxy=s.worldCOMy+_}else{var f=r.polygon;if(f.zip_gverts&&null!=f.body){f.zip_gverts=!1,f.validate_lverts();var m=f.body;m.zip_axis&&(m.zip_axis=!1,m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot));for(var x=f.lverts.next,v=f.gverts.next;null!=v;){var g=v,b=x,x=x.next;g.x=f.body.posx+(f.body.axisy*b.x-f.body.axisx*b.y),g.y=f.body.posy+(b.x*f.body.axisx+b.y*f.body.axisy),v=v.next}}m=f.gverts.next;f.aabb.minx=m.x,f.aabb.miny=m.y,f.aabb.maxx=m.x,f.aabb.maxy=m.y;for(var z=f.gverts.next.next;null!=z;){var w=z;w.x<f.aabb.minx&&(f.aabb.minx=w.x),w.x>f.aabb.maxx&&(f.aabb.maxx=w.x),w.y<f.aabb.miny&&(f.aabb.miny=w.y),w.y>f.aabb.maxy&&(f.aabb.maxy=w.y),z=z.next}}var C=this.aabbShape.zpp_inner.polygon;if(C.zip_gaxi&&null!=C.body){C.zip_gaxi=!1,C.validate_laxi();m=C.body;if(m.zip_axis&&(m.zip_axis=!1,m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot)),C.zip_gverts&&null!=C.body){C.zip_gverts=!1,C.validate_lverts();var P=C.body;P.zip_axis&&(P.zip_axis=!1,P.axisx=Math.sin(P.rot),P.axisy=Math.cos(P.rot));for(var T=C.lverts.next,S=C.gverts.next;null!=S;){var M=S,A=T,T=T.next;M.x=C.body.posx+(C.body.axisy*A.x-C.body.axisx*A.y),M.y=C.body.posy+(A.x*C.body.axisx+A.y*C.body.axisy),S=S.next}}for(var O=C.edges.head,k=E=C.gverts.next,E=E.next;null!=E;){var I=E,D=O.elt,O=O.next;D.gp0=k,D.gp1=I,D.gnormx=C.body.axisy*D.lnormx-C.body.axisx*D.lnormy,D.gnormy=D.lnormx*C.body.axisx+D.lnormy*C.body.axisy,D.gprojection=C.body.posx*D.gnormx+C.body.posy*D.gnormy+D.lprojection,null!=D.wrap_gnorm&&(D.wrap_gnorm.zpp_inner.x=D.gnormx,D.wrap_gnorm.zpp_inner.y=D.gnormy),D.tp0=D.gp0.y*D.gnormx-D.gp0.x*D.gnormy,D.tp1=D.gp1.y*D.gnormx-D.gp1.x*D.gnormy,k=I,E=E.next}P=O.elt;P.gp0=k,P.gp1=C.gverts.next,P.gnormx=C.body.axisy*P.lnormx-C.body.axisx*P.lnormy,P.gnormy=P.lnormx*C.body.axisx+P.lnormy*C.body.axisy,P.gprojection=C.body.posx*P.gnormx+C.body.posy*P.gnormy+P.lprojection,null!=P.wrap_gnorm&&(P.wrap_gnorm.zpp_inner.x=P.gnormx,P.wrap_gnorm.zpp_inner.y=P.gnormy),P.tp0=P.gp0.y*P.gnormx-P.gp0.x*P.gnormy,P.tp1=P.gp1.y*P.gnormx-P.gp1.x*P.gnormy}},qe.prototype.shapesInAABB=function(t,e,i,n,r){return null},qe.prototype.bodiesInAABB=function(t,e,i,n,r){return null},qe.prototype.circShape=null,qe.prototype.updateCircShape=function(t,e,i){var n,r,s,o;null==this.circShape?(null==Yn.BodyType_STATIC&&(Yn.internal=!0,Yn.BodyType_STATIC=new et,Yn.internal=!1),n=new $(Yn.BodyType_STATIC).zpp_inner.wrap_shapes,null==Rn.poolVec2?o=new Ct:(o=Rn.poolVec2,Rn.poolVec2=o.zpp_pool,o.zpp_pool=null),null==o.zpp_inner?(null==Ir.zpp_pool?r=new Ir:(r=Ir.zpp_pool,Ir.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=t,r.y=e,o.zpp_inner=r,o.zpp_inner.outer=o):(null!=(r=o.zpp_inner)._validate&&r._validate(),o.zpp_inner.x==t&&(null!=(s=o.zpp_inner)._validate&&s._validate(),o.zpp_inner.y==e)||(o.zpp_inner.x=t,o.zpp_inner.y=e,null!=(s=o.zpp_inner)._invalidate&&s._invalidate(s))),o.zpp_inner.weak=!1,o=this.circShape=new ut(i,o),n.zpp_inner.reverse_flag?n.push(o):n.unshift(o)):(f=i/(a=this.circShape.zpp_inner.circle).radius,null==this.matrix&&(this.matrix=new X),o=this.matrix,(l=this.matrix).zpp_inner.d=f,null!=(i=l.zpp_inner)._invalidate&&i._invalidate(),o.zpp_inner.a=l.zpp_inner.d,null!=(i=o.zpp_inner)._invalidate&&i._invalidate(),l=this.matrix,(o=this.matrix).zpp_inner.c=0,null!=(i=o.zpp_inner)._invalidate&&i._invalidate(),l.zpp_inner.b=o.zpp_inner.c,null!=(l=l.zpp_inner)._invalidate&&l._invalidate(),(l=this.matrix).zpp_inner.tx=t-f*a.localCOMx,null!=(l=l.zpp_inner)._invalidate&&l._invalidate(),(l=this.matrix).zpp_inner.ty=e-f*a.localCOMy,null!=(f=l.zpp_inner)._invalidate&&f._invalidate(),this.circShape.transform(this.matrix));var a=this.circShape.zpp_inner;if(a.zip_aabb&&null!=a.body)if(a.zip_aabb=!1,0==a.type){var l=a.circle;if(l.zip_worldCOM&&null!=l.body){if(l.zip_worldCOM=!1,l.zip_localCOM){if(l.zip_localCOM=!1,1==l.type){var p=l.polygon;if(null==p.lverts.next.next)p.localCOMx=p.lverts.next.x,p.localCOMy=p.lverts.next.y;else if(null==p.lverts.next.next.next)p.localCOMx=p.lverts.next.x,p.localCOMy=p.lverts.next.y,p.localCOMx+=p.lverts.next.next.x,p.localCOMy+=p.lverts.next.next.y,p.localCOMx*=.5,p.localCOMy*=.5;else{p.localCOMx=0;var h=p.localCOMy=0,u=p.lverts.next,c=u,d=u=u.next;for(u=u.next;null!=u;){var _=u;h+=d.x*(_.y-c.y);var y=_.y*d.x-_.x*d.y;p.localCOMx+=(d.x+_.x)*y,p.localCOMy+=(d.y+_.y)*y,c=d,d=_,u=u.next}var f=u=p.lverts.next;h+=d.x*(f.y-c.y);var m=f.y*d.x-f.x*d.y;p.localCOMx+=(d.x+f.x)*m,p.localCOMy+=(d.y+f.y)*m,c=d;var x=u=u.next;h+=f.x*(x.y-c.y);m=x.y*f.x-x.x*f.y;p.localCOMx+=(f.x+x.x)*m,p.localCOMy+=(f.y+x.y)*m;x=h=1/(3*h);p.localCOMx*=x,p.localCOMy*=x}}null!=l.wrap_localCOM&&(l.wrap_localCOM.zpp_inner.x=l.localCOMx,l.wrap_localCOM.zpp_inner.y=l.localCOMy)}m=l.body;m.zip_axis&&(m.zip_axis=!1,m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot)),l.worldCOMx=l.body.posx+(l.body.axisy*l.localCOMx-l.body.axisx*l.localCOMy),l.worldCOMy=l.body.posy+(l.localCOMx*l.body.axisx+l.localCOMy*l.body.axisy)}x=l.radius,m=l.radius;l.aabb.minx=l.worldCOMx-x,l.aabb.miny=l.worldCOMy-m,l.aabb.maxx=l.worldCOMx+x,l.aabb.maxy=l.worldCOMy+m}else{var v=a.polygon;if(v.zip_gverts&&null!=v.body){v.zip_gverts=!1,v.validate_lverts();var g=v.body;g.zip_axis&&(g.zip_axis=!1,g.axisx=Math.sin(g.rot),g.axisy=Math.cos(g.rot));for(var b=v.lverts.next,z=v.gverts.next;null!=z;){var w=z,C=b,b=b.next;w.x=v.body.posx+(v.body.axisy*C.x-v.body.axisx*C.y),w.y=v.body.posy+(C.x*v.body.axisx+C.y*v.body.axisy),z=z.next}}g=v.gverts.next;v.aabb.minx=g.x,v.aabb.miny=g.y,v.aabb.maxx=g.x,v.aabb.maxy=g.y;for(var P=v.gverts.next.next;null!=P;){var T=P;T.x<v.aabb.minx&&(v.aabb.minx=T.x),T.x>v.aabb.maxx&&(v.aabb.maxx=T.x),T.y<v.aabb.miny&&(v.aabb.miny=T.y),T.y>v.aabb.maxy&&(v.aabb.maxy=T.y),P=P.next}}},qe.prototype.shapesInCircle=function(t,e,i,n,r,s){return null},qe.prototype.bodiesInCircle=function(t,e,i,n,r,s){return null},qe.prototype.validateShape=function(t){if(1==t.type){var e=t.polygon;if(e.zip_gaxi&&null!=e.body){e.zip_gaxi=!1,e.validate_laxi();var i=e.body;if(i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot)),e.zip_gverts&&null!=e.body){e.zip_gverts=!1,e.validate_lverts();var n=e.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var r=e.lverts.next,s=e.gverts.next;null!=s;){var o=s,a=r,r=r.next;o.x=e.body.posx+(e.body.axisy*a.x-e.body.axisx*a.y),o.y=e.body.posy+(a.x*e.body.axisx+a.y*e.body.axisy),s=s.next}}for(var l=e.edges.head,p=h=e.gverts.next,h=h.next;null!=h;){var u=h,c=l.elt,l=l.next;c.gp0=p,c.gp1=u,c.gnormx=e.body.axisy*c.lnormx-e.body.axisx*c.lnormy,c.gnormy=c.lnormx*e.body.axisx+c.lnormy*e.body.axisy,c.gprojection=e.body.posx*c.gnormx+e.body.posy*c.gnormy+c.lprojection,null!=c.wrap_gnorm&&(c.wrap_gnorm.zpp_inner.x=c.gnormx,c.wrap_gnorm.zpp_inner.y=c.gnormy),c.tp0=c.gp0.y*c.gnormx-c.gp0.x*c.gnormy,c.tp1=c.gp1.y*c.gnormx-c.gp1.x*c.gnormy,p=u,h=h.next}i=l.elt;i.gp0=p,i.gp1=e.gverts.next,i.gnormx=e.body.axisy*i.lnormx-e.body.axisx*i.lnormy,i.gnormy=i.lnormx*e.body.axisx+i.lnormy*e.body.axisy,i.gprojection=e.body.posx*i.gnormx+e.body.posy*i.gnormy+i.lprojection,null!=i.wrap_gnorm&&(i.wrap_gnorm.zpp_inner.x=i.gnormx,i.wrap_gnorm.zpp_inner.y=i.gnormy),i.tp0=i.gp0.y*i.gnormx-i.gp0.x*i.gnormy,i.tp1=i.gp1.y*i.gnormx-i.gp1.x*i.gnormy}}if(t.zip_aabb&&null!=t.body)if(t.zip_aabb=!1,0==t.type){n=t.circle;if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var d=n.polygon;if(null==d.lverts.next.next)d.localCOMx=d.lverts.next.x,d.localCOMy=d.lverts.next.y;else if(null==d.lverts.next.next.next)d.localCOMx=d.lverts.next.x,d.localCOMy=d.lverts.next.y,d.localCOMx+=d.lverts.next.next.x,d.localCOMy+=d.lverts.next.next.y,d.localCOMx*=.5,d.localCOMy*=.5;else{d.localCOMx=0;var _=d.localCOMy=0,y=d.lverts.next,f=y,m=y=y.next;for(y=y.next;null!=y;){var x=y;_+=m.x*(x.y-f.y);var v=x.y*m.x-x.x*m.y;d.localCOMx+=(m.x+x.x)*v,d.localCOMy+=(m.y+x.y)*v,f=m,m=x,y=y.next}i=y=d.lverts.next;_+=m.x*(i.y-f.y);var g=i.y*m.x-i.x*m.y;d.localCOMx+=(m.x+i.x)*g,d.localCOMy+=(m.y+i.y)*g,f=m;var b=y=y.next;_+=i.x*(b.y-f.y);g=b.y*i.x-b.x*i.y;d.localCOMx+=(i.x+b.x)*g,d.localCOMy+=(i.y+b.y)*g;b=_=1/(3*_);d.localCOMx*=b,d.localCOMy*=b}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}g=n.body;g.zip_axis&&(g.zip_axis=!1,g.axisx=Math.sin(g.rot),g.axisy=Math.cos(g.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}b=n.radius,g=n.radius;n.aabb.minx=n.worldCOMx-b,n.aabb.miny=n.worldCOMy-g,n.aabb.maxx=n.worldCOMx+b,n.aabb.maxy=n.worldCOMy+g}else{var z=t.polygon;if(z.zip_gverts&&null!=z.body){z.zip_gverts=!1,z.validate_lverts();var w=z.body;w.zip_axis&&(w.zip_axis=!1,w.axisx=Math.sin(w.rot),w.axisy=Math.cos(w.rot));for(var C=z.lverts.next,P=z.gverts.next;null!=P;){var T=P,S=C,C=C.next;T.x=z.body.posx+(z.body.axisy*S.x-z.body.axisx*S.y),T.y=z.body.posy+(S.x*z.body.axisx+S.y*z.body.axisy),P=P.next}}var M=z.gverts.next;z.aabb.minx=M.x,z.aabb.miny=M.y,z.aabb.maxx=M.x,z.aabb.maxy=M.y;for(var A=z.gverts.next.next;null!=A;){var O=A;O.x<z.aabb.minx&&(z.aabb.minx=O.x),O.x>z.aabb.maxx&&(z.aabb.maxx=O.x),O.y<z.aabb.miny&&(z.aabb.miny=O.y),O.y>z.aabb.maxy&&(z.aabb.maxy=O.y),A=A.next}}if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,1==t.type){var k=t.polygon;if(null==k.lverts.next.next)k.localCOMx=k.lverts.next.x,k.localCOMy=k.lverts.next.y;else if(null==k.lverts.next.next.next)k.localCOMx=k.lverts.next.x,k.localCOMy=k.lverts.next.y,k.localCOMx+=k.lverts.next.next.x,k.localCOMy+=k.lverts.next.next.y,k.localCOMx*=.5,k.localCOMy*=.5;else{k.localCOMx=0;var E=k.localCOMy=0,I=k.lverts.next,D=I,B=I=I.next;for(I=I.next;null!=I;){var L=I;E+=B.x*(L.y-D.y);var R=L.y*B.x-L.x*B.y;k.localCOMx+=(B.x+L.x)*R,k.localCOMy+=(B.y+L.y)*R,D=B,B=L,I=I.next}w=I=k.lverts.next;E+=B.x*(w.y-D.y);var F=w.y*B.x-w.x*B.y;k.localCOMx+=(B.x+w.x)*F,k.localCOMy+=(B.y+w.y)*F,D=B;M=I=I.next;E+=w.x*(M.y-D.y);F=M.y*w.x-M.x*w.y;k.localCOMx+=(w.x+M.x)*F,k.localCOMy+=(w.y+M.y)*F;F=E=1/(3*E);k.localCOMx*=F,k.localCOMy*=F}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}F=t.body;F.zip_axis&&(F.zip_axis=!1,F.axisx=Math.sin(F.rot),F.axisy=Math.cos(F.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}},qe.prototype.shapesInShape=function(t,e,i,n){return null},qe.prototype.bodiesInShape=function(t,e,i,n){return null},qe.prototype.rayCast=function(t,e,i){return null},qe.prototype.rayMultiCast=function(t,e,i,n){return null},qe.prototype.__class__=qe;var Ye=zpp_nape.space.ZPP_AABBNode=function(){this.first_sync=!1,this.synced=!1,this.snext=null,this.moved=!1,this.mnext=null,this.next=null,this.rayt=0,this.height=0,this.child2=null,this.child1=null,this.parent=null,this.dyn=!1,this.shape=null,this.aabb=null,this.height=-1};Ye.__name__=["zpp_nape","space","ZPP_AABBNode"],Ye.prototype.aabb=null,Ye.prototype.shape=null,Ye.prototype.dyn=null,Ye.prototype.parent=null,Ye.prototype.child1=null,Ye.prototype.child2=null,Ye.prototype.height=null,Ye.prototype.rayt=null,Ye.prototype.next=null,Ye.prototype.alloc=function(){null==Be.zpp_pool?this.aabb=new Be:(this.aabb=Be.zpp_pool,Be.zpp_pool=this.aabb.next,this.aabb.next=null),this.moved=!1,this.synced=!1,this.first_sync=!1},Ye.prototype.free=function(){this.height=-1;var t=this.aabb;null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t.wrap_min=t.wrap_max=null,t._invalidate=null,t._validate=null,t.next=Be.zpp_pool,Be.zpp_pool=t,this.child1=this.child2=this.parent=null,this.next=null,this.snext=null,this.mnext=null},Ye.prototype.mnext=null,Ye.prototype.moved=null,Ye.prototype.snext=null,Ye.prototype.synced=null,Ye.prototype.first_sync=null,Ye.prototype.isLeaf=function(){return null==this.child1},Ye.prototype.__class__=Ye;var Ke=zpp_nape.space.ZPP_AABBPair=function(){this.next=null,this.arb=null,this.di=0,this.id=0,this.sleeping=!1,this.first=!1,this.n2=null,this.n1=null};Ke.__name__=["zpp_nape","space","ZPP_AABBPair"],Ke.prototype.n1=null,Ke.prototype.n2=null,Ke.prototype.first=null,Ke.prototype.sleeping=null,Ke.prototype.id=null,Ke.prototype.di=null,Ke.prototype.arb=null,Ke.prototype.next=null,Ke.prototype.alloc=function(){},Ke.prototype.free=function(){this.n1=this.n2=null,this.sleeping=!1},Ke.prototype.__class__=Ke;var Ze=zpp_nape.space.ZPP_AABBTree=function(){this.root=null};Ze.__name__=["zpp_nape","space","ZPP_AABBTree"],Ze.prototype.root=null,Ze.prototype.clear=function(){if(null!=this.root){var t=null;for(this.root.next=t,t=this.root;null!=t;){var e=t,t=e.next;(e.next=null)==e.child1?(e.shape.node=null,e.shape.removedFromSpace(),e.shape=null):(null!=e.child1&&(e.child1.next=t,t=e.child1),null!=e.child2&&(e.child2.next=t,t=e.child2)),e.height=-1;var i=e.aabb;null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i.wrap_min=i.wrap_max=null,i._invalidate=null,i._validate=null,i.next=Be.zpp_pool,Be.zpp_pool=i,e.child1=e.child2=e.parent=null,e.next=null,e.snext=null,e.mnext=null,e.next=Ye.zpp_pool,Ye.zpp_pool=e}this.root=null}},Ze.prototype.insertLeaf=function(t){if(null==this.root)this.root=t,this.root.parent=null;else{for(var e=t.aabb,i=this.root;null!=i.child1;){var n=i.child1,r=i.child2,s=i.aabb,o=2*(s.maxx-s.minx+(s.maxy-s.miny)),a=Ze.tmpaabb,l=i.aabb;a.minx=(l.minx<e.minx?l:e).minx,a.miny=(l.miny<e.miny?l:e).miny,a.maxx=(l.maxx>e.maxx?l:e).maxx,a.maxy=(l.maxy>e.maxy?l:e).maxy;var p,s=Ze.tmpaabb,a=2*(s.maxx-s.minx+(s.maxy-s.miny)),l=2*a,s=2*(a-o),a=Ze.tmpaabb,o=n.aabb;a.minx=(e.minx<o.minx?e:o).minx,a.miny=(e.miny<o.miny?e:o).miny,a.maxx=(e.maxx>o.maxx?e:o).maxx,a.maxy=(e.maxy>o.maxy?e:o).maxy,p=null==n.child1?2*((o=Ze.tmpaabb).maxx-o.minx+(o.maxy-o.miny))+s:(c=2*((p=n.aabb).maxx-p.minx+(p.maxy-p.miny)),2*((u=Ze.tmpaabb).maxx-u.minx+(u.maxy-u.miny))-c+s);var h,u=Ze.tmpaabb,c=r.aabb;if(u.minx=(e.minx<c.minx?e:c).minx,u.miny=(e.miny<c.miny?e:c).miny,u.maxx=(e.maxx>c.maxx?e:c).maxx,u.maxy=(e.maxy>c.maxy?e:c).maxy,s=null==r.child1?2*((h=Ze.tmpaabb).maxx-h.minx+(h.maxy-h.miny))+s:(h=2*((c=r.aabb).maxx-c.minx+(c.maxy-c.miny)),2*((c=Ze.tmpaabb).maxx-c.minx+(c.maxy-c.miny))-h+s),l<p&&l<s)break;i=p<s?n:r}var d,_=i,y=_.parent;null==Ye.zpp_pool?d=new Ye:(d=Ye.zpp_pool,Ye.zpp_pool=d.next,d.next=null),null==Be.zpp_pool?d.aabb=new Be:(d.aabb=Be.zpp_pool,Be.zpp_pool=d.aabb.next,d.aabb.next=null),d.moved=!1,d.synced=!1,d.first_sync=!1,d.parent=y;var f,m,x,v,g,b,z,w,C,P,T=d.aabb,S=_.aabb;for(T.minx=(e.minx<S.minx?e:S).minx,T.miny=(e.miny<S.miny?e:S).miny,T.maxx=(e.maxx>S.maxx?e:S).maxx,T.maxy=(e.maxy>S.maxy?e:S).maxy,d.height=_.height+1,null!=y?(y.child1==_?y.child1=d:y.child2=d,d.child1=_,d.child2=t,_.parent=d,t.parent=d):(d.child1=_,d.child2=t,_.parent=d,t.parent=d,this.root=d),i=t.parent;null!=i;){null==i.child1||i.height<2||(k=i.child1,1<(C=(f=i.child2).height-k.height)?(m=f.child1,x=f.child2,f.child1=i,f.parent=i.parent,null!=(i.parent=f).parent?f.parent.child1==i?f.parent.child1=f:f.parent.child2=f:this.root=f,m.height>x.height?(f.child2=m,v=((i.child2=x).parent=i).aabb,g=k.aabb,b=x.aabb,v.minx=(g.minx<b.minx?g:b).minx,v.miny=(g.miny<b.miny?g:b).miny,v.maxx=(g.maxx>b.maxx?g:b).maxx,v.maxy=(g.maxy>b.maxy?g:b).maxy,v=f.aabb,g=i.aabb,b=m.aabb,v.minx=(g.minx<b.minx?g:b).minx,v.miny=(g.miny<b.miny?g:b).miny,v.maxx=(g.maxx>b.maxx?g:b).maxx,v.maxy=(g.maxy>b.maxy?g:b).maxy,g=k.height,b=x.height,i.height=1+(b<g?g:b),g=i.height,b=m.height,f.height=1+(b<g?g:b)):(f.child2=x,b=((i.child2=m).parent=i).aabb,z=k.aabb,w=m.aabb,b.minx=(z.minx<w.minx?z:w).minx,b.miny=(z.miny<w.miny?z:w).miny,b.maxx=(z.maxx>w.maxx?z:w).maxx,b.maxy=(z.maxy>w.maxy?z:w).maxy,b=f.aabb,z=i.aabb,w=x.aabb,b.minx=(z.minx<w.minx?z:w).minx,b.miny=(z.miny<w.miny?z:w).miny,b.maxx=(z.maxx>w.maxx?z:w).maxx,b.maxy=(z.maxy>w.maxy?z:w).maxy,z=k.height,w=m.height,i.height=1+(w<z?z:w),z=i.height,w=x.height,f.height=1+(w<z?z:w)),i=f):C<-1&&(z=k.child1,M=k.child2,k.child1=i,k.parent=i.parent,null!=(i.parent=k).parent?k.parent.child1==i?k.parent.child1=k:k.parent.child2=k:this.root=k,z.height>M.height?(k.child2=z,w=((i.child1=M).parent=i).aabb,C=f.aabb,P=M.aabb,w.minx=(C.minx<P.minx?C:P).minx,w.miny=(C.miny<P.miny?C:P).miny,w.maxx=(C.maxx>P.maxx?C:P).maxx,w.maxy=(C.maxy>P.maxy?C:P).maxy,w=k.aabb,C=i.aabb,P=z.aabb,w.minx=(C.minx<P.minx?C:P).minx,w.miny=(C.miny<P.miny?C:P).miny,w.maxx=(C.maxx>P.maxx?C:P).maxx,w.maxy=(C.maxy>P.maxy?C:P).maxy,C=f.height,P=M.height,i.height=1+(P<C?C:P),C=i.height,P=z.height,k.height=1+(P<C?C:P)):(k.child2=M,P=((i.child1=z).parent=i).aabb,A=f.aabb,O=z.aabb,P.minx=(A.minx<O.minx?A:O).minx,P.miny=(A.miny<O.miny?A:O).miny,P.maxx=(A.maxx>O.maxx?A:O).maxx,P.maxy=(A.maxy>O.maxy?A:O).maxy,P=k.aabb,A=i.aabb,O=M.aabb,P.minx=(A.minx<O.minx?A:O).minx,P.miny=(A.miny<O.miny?A:O).miny,P.maxx=(A.maxx>O.maxx?A:O).maxx,P.maxy=(A.maxy>O.maxy?A:O).maxy,A=f.height,O=z.height,i.height=1+(O<A?A:O),A=i.height,O=M.height,k.height=1+(O<A?A:O)),i=k));var M=i.child1,A=i.child2,O=M.height,k=A.height;i.height=1+(k<O?O:k);k=i.aabb,M=M.aabb,A=A.aabb;k.minx=(M.minx<A.minx?M:A).minx,k.miny=(M.miny<A.miny?M:A).miny,k.maxx=(M.maxx>A.maxx?M:A).maxx,k.maxy=(M.maxy>A.maxy?M:A).maxy,i=i.parent}}},Ze.prototype.inlined_insertLeaf=function(t){if(null==this.root)this.root=t,this.root.parent=null;else{for(var e=t.aabb,i=this.root;null!=i.child1;){var n=i.child1,r=i.child2,s=i.aabb,o=2*(s.maxx-s.minx+(s.maxy-s.miny)),a=Ze.tmpaabb,l=i.aabb;a.minx=(l.minx<e.minx?l:e).minx,a.miny=(l.miny<e.miny?l:e).miny,a.maxx=(l.maxx>e.maxx?l:e).maxx,a.maxy=(l.maxy>e.maxy?l:e).maxy;var p,s=Ze.tmpaabb,a=2*(s.maxx-s.minx+(s.maxy-s.miny)),l=2*a,s=2*(a-o),a=Ze.tmpaabb,o=n.aabb;a.minx=(e.minx<o.minx?e:o).minx,a.miny=(e.miny<o.miny?e:o).miny,a.maxx=(e.maxx>o.maxx?e:o).maxx,a.maxy=(e.maxy>o.maxy?e:o).maxy,p=null==n.child1?2*((o=Ze.tmpaabb).maxx-o.minx+(o.maxy-o.miny))+s:(c=2*((p=n.aabb).maxx-p.minx+(p.maxy-p.miny)),2*((u=Ze.tmpaabb).maxx-u.minx+(u.maxy-u.miny))-c+s);var h,u=Ze.tmpaabb,c=r.aabb;if(u.minx=(e.minx<c.minx?e:c).minx,u.miny=(e.miny<c.miny?e:c).miny,u.maxx=(e.maxx>c.maxx?e:c).maxx,u.maxy=(e.maxy>c.maxy?e:c).maxy,s=null==r.child1?2*((h=Ze.tmpaabb).maxx-h.minx+(h.maxy-h.miny))+s:(h=2*((c=r.aabb).maxx-c.minx+(c.maxy-c.miny)),2*((c=Ze.tmpaabb).maxx-c.minx+(c.maxy-c.miny))-h+s),l<p&&l<s)break;i=p<s?n:r}var d,_=i,y=_.parent;null==Ye.zpp_pool?d=new Ye:(d=Ye.zpp_pool,Ye.zpp_pool=d.next,d.next=null),null==Be.zpp_pool?d.aabb=new Be:(d.aabb=Be.zpp_pool,Be.zpp_pool=d.aabb.next,d.aabb.next=null),d.moved=!1,d.synced=!1,d.first_sync=!1,d.parent=y;var f,m,x,v,g,b,z,w,C,P,T=d.aabb,S=_.aabb;for(T.minx=(e.minx<S.minx?e:S).minx,T.miny=(e.miny<S.miny?e:S).miny,T.maxx=(e.maxx>S.maxx?e:S).maxx,T.maxy=(e.maxy>S.maxy?e:S).maxy,d.height=_.height+1,null!=y?(y.child1==_?y.child1=d:y.child2=d,d.child1=_,d.child2=t,_.parent=d,t.parent=d):(d.child1=_,d.child2=t,_.parent=d,t.parent=d,this.root=d),i=t.parent;null!=i;){null==i.child1||i.height<2||(k=i.child1,1<(C=(f=i.child2).height-k.height)?(m=f.child1,x=f.child2,f.child1=i,f.parent=i.parent,null!=(i.parent=f).parent?f.parent.child1==i?f.parent.child1=f:f.parent.child2=f:this.root=f,m.height>x.height?(f.child2=m,v=((i.child2=x).parent=i).aabb,g=k.aabb,b=x.aabb,v.minx=(g.minx<b.minx?g:b).minx,v.miny=(g.miny<b.miny?g:b).miny,v.maxx=(g.maxx>b.maxx?g:b).maxx,v.maxy=(g.maxy>b.maxy?g:b).maxy,v=f.aabb,g=i.aabb,b=m.aabb,v.minx=(g.minx<b.minx?g:b).minx,v.miny=(g.miny<b.miny?g:b).miny,v.maxx=(g.maxx>b.maxx?g:b).maxx,v.maxy=(g.maxy>b.maxy?g:b).maxy,g=k.height,b=x.height,i.height=1+(b<g?g:b),g=i.height,b=m.height,f.height=1+(b<g?g:b)):(f.child2=x,b=((i.child2=m).parent=i).aabb,z=k.aabb,w=m.aabb,b.minx=(z.minx<w.minx?z:w).minx,b.miny=(z.miny<w.miny?z:w).miny,b.maxx=(z.maxx>w.maxx?z:w).maxx,b.maxy=(z.maxy>w.maxy?z:w).maxy,b=f.aabb,z=i.aabb,w=x.aabb,b.minx=(z.minx<w.minx?z:w).minx,b.miny=(z.miny<w.miny?z:w).miny,b.maxx=(z.maxx>w.maxx?z:w).maxx,b.maxy=(z.maxy>w.maxy?z:w).maxy,z=k.height,w=m.height,i.height=1+(w<z?z:w),z=i.height,w=x.height,f.height=1+(w<z?z:w)),i=f):C<-1&&(z=k.child1,M=k.child2,k.child1=i,k.parent=i.parent,null!=(i.parent=k).parent?k.parent.child1==i?k.parent.child1=k:k.parent.child2=k:this.root=k,z.height>M.height?(k.child2=z,w=((i.child1=M).parent=i).aabb,C=f.aabb,P=M.aabb,w.minx=(C.minx<P.minx?C:P).minx,w.miny=(C.miny<P.miny?C:P).miny,w.maxx=(C.maxx>P.maxx?C:P).maxx,w.maxy=(C.maxy>P.maxy?C:P).maxy,w=k.aabb,C=i.aabb,P=z.aabb,w.minx=(C.minx<P.minx?C:P).minx,w.miny=(C.miny<P.miny?C:P).miny,w.maxx=(C.maxx>P.maxx?C:P).maxx,w.maxy=(C.maxy>P.maxy?C:P).maxy,C=f.height,P=M.height,i.height=1+(P<C?C:P),C=i.height,P=z.height,k.height=1+(P<C?C:P)):(k.child2=M,P=((i.child1=z).parent=i).aabb,A=f.aabb,O=z.aabb,P.minx=(A.minx<O.minx?A:O).minx,P.miny=(A.miny<O.miny?A:O).miny,P.maxx=(A.maxx>O.maxx?A:O).maxx,P.maxy=(A.maxy>O.maxy?A:O).maxy,P=k.aabb,A=i.aabb,O=M.aabb,P.minx=(A.minx<O.minx?A:O).minx,P.miny=(A.miny<O.miny?A:O).miny,P.maxx=(A.maxx>O.maxx?A:O).maxx,P.maxy=(A.maxy>O.maxy?A:O).maxy,A=f.height,O=z.height,i.height=1+(O<A?A:O),A=i.height,O=M.height,k.height=1+(O<A?A:O)),i=k));var M=i.child1,A=i.child2,O=M.height,k=A.height;i.height=1+(k<O?O:k);k=i.aabb,M=M.aabb,A=A.aabb;k.minx=(M.minx<A.minx?M:A).minx,k.miny=(M.miny<A.miny?M:A).miny,k.maxx=(M.maxx>A.maxx?M:A).maxx,k.maxy=(M.maxy>A.maxy?M:A).maxy,i=i.parent}}},Ze.prototype.removeLeaf=function(t){if(t==this.root)this.root=null;else{var e=t.parent,i=e.parent,n=e.child1==t?e.child2:e.child1;if(null!=i){i.child1==e?i.child1=n:i.child2=n,n.parent=i,e.height=-1;t=e.aabb;null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t.wrap_min=t.wrap_max=null,t._invalidate=null,t._validate=null,t.next=Be.zpp_pool,Be.zpp_pool=t,e.child1=e.child2=e.parent=null,e.next=null,e.snext=null,e.mnext=null,e.next=Ye.zpp_pool,Ye.zpp_pool=e;for(var r,s,o,a,l,p,h,u,c,d=i;null!=d;){null==d.child1||d.height<2||(x=d.child1,1<(c=(r=d.child2).height-x.height)?(s=r.child1,p=r.child2,r.child1=d,r.parent=d.parent,null!=(d.parent=r).parent?r.parent.child1==d?r.parent.child1=r:r.parent.child2=r:this.root=r,s.height>p.height?(r.child2=s,o=((d.child2=p).parent=d).aabb,a=x.aabb,l=p.aabb,o.minx=(a.minx<l.minx?a:l).minx,o.miny=(a.miny<l.miny?a:l).miny,o.maxx=(a.maxx>l.maxx?a:l).maxx,o.maxy=(a.maxy>l.maxy?a:l).maxy,o=r.aabb,a=d.aabb,l=s.aabb,o.minx=(a.minx<l.minx?a:l).minx,o.miny=(a.miny<l.miny?a:l).miny,o.maxx=(a.maxx>l.maxx?a:l).maxx,o.maxy=(a.maxy>l.maxy?a:l).maxy,a=x.height,l=p.height,d.height=1+(l<a?a:l),a=d.height,l=s.height,r.height=1+(l<a?a:l)):(r.child2=p,l=((d.child2=s).parent=d).aabb,h=x.aabb,u=s.aabb,l.minx=(h.minx<u.minx?h:u).minx,l.miny=(h.miny<u.miny?h:u).miny,l.maxx=(h.maxx>u.maxx?h:u).maxx,l.maxy=(h.maxy>u.maxy?h:u).maxy,l=r.aabb,h=d.aabb,u=p.aabb,l.minx=(h.minx<u.minx?h:u).minx,l.miny=(h.miny<u.miny?h:u).miny,l.maxx=(h.maxx>u.maxx?h:u).maxx,l.maxy=(h.maxy>u.maxy?h:u).maxy,h=x.height,u=s.height,d.height=1+(u<h?h:u),h=d.height,u=p.height,r.height=1+(u<h?h:u)),d=r):c<-1&&(p=x.child1,y=x.child2,x.child1=d,x.parent=d.parent,null!=(d.parent=x).parent?x.parent.child1==d?x.parent.child1=x:x.parent.child2=x:this.root=x,p.height>y.height?(x.child2=p,h=((d.child1=y).parent=d).aabb,u=r.aabb,c=y.aabb,h.minx=(u.minx<c.minx?u:c).minx,h.miny=(u.miny<c.miny?u:c).miny,h.maxx=(u.maxx>c.maxx?u:c).maxx,h.maxy=(u.maxy>c.maxy?u:c).maxy,h=x.aabb,u=d.aabb,c=p.aabb,h.minx=(u.minx<c.minx?u:c).minx,h.miny=(u.miny<c.miny?u:c).miny,h.maxx=(u.maxx>c.maxx?u:c).maxx,h.maxy=(u.maxy>c.maxy?u:c).maxy,u=r.height,c=y.height,d.height=1+(c<u?u:c),u=d.height,c=p.height,x.height=1+(c<u?u:c)):(x.child2=y,m=((d.child1=p).parent=d).aabb,_=r.aabb,f=p.aabb,m.minx=(_.minx<f.minx?_:f).minx,m.miny=(_.miny<f.miny?_:f).miny,m.maxx=(_.maxx>f.maxx?_:f).maxx,m.maxy=(_.maxy>f.maxy?_:f).maxy,m=x.aabb,_=d.aabb,f=y.aabb,m.minx=(_.minx<f.minx?_:f).minx,m.miny=(_.miny<f.miny?_:f).miny,m.maxx=(_.maxx>f.maxx?_:f).maxx,m.maxy=(_.maxy>f.maxy?_:f).maxy,m=r.height,_=p.height,d.height=1+(_<m?m:_),f=d.height,m=y.height,x.height=1+(m<f?f:m)),d=x));var _=d.child1,y=d.child2,f=d.aabb,m=_.aabb,x=y.aabb;f.minx=(m.minx<x.minx?m:x).minx,f.miny=(m.miny<x.miny?m:x).miny,f.maxx=(m.maxx>x.maxx?m:x).maxx,f.maxy=(m.maxy>x.maxy?m:x).maxy;_=_.height,y=y.height;d.height=1+(y<_?_:y),d=d.parent}}else{(this.root=n).parent=null,e.height=-1;n=e.aabb;null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n.wrap_min=n.wrap_max=null,n._invalidate=null,n._validate=null,n.next=Be.zpp_pool,Be.zpp_pool=n,e.child1=e.child2=e.parent=null,e.next=null,e.snext=null,e.mnext=null,e.next=Ye.zpp_pool,Ye.zpp_pool=e}}},Ze.prototype.inlined_removeLeaf=function(t){if(t==this.root)this.root=null;else{var e=t.parent,i=e.parent,n=e.child1==t?e.child2:e.child1;if(null!=i){i.child1==e?i.child1=n:i.child2=n,n.parent=i,e.height=-1;t=e.aabb;null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t.wrap_min=t.wrap_max=null,t._invalidate=null,t._validate=null,t.next=Be.zpp_pool,Be.zpp_pool=t,e.child1=e.child2=e.parent=null,e.next=null,e.snext=null,e.mnext=null,e.next=Ye.zpp_pool,Ye.zpp_pool=e;for(var r,s,o,a,l,p,h,u,c,d=i;null!=d;){null==d.child1||d.height<2||(x=d.child1,1<(c=(r=d.child2).height-x.height)?(s=r.child1,p=r.child2,r.child1=d,r.parent=d.parent,null!=(d.parent=r).parent?r.parent.child1==d?r.parent.child1=r:r.parent.child2=r:this.root=r,s.height>p.height?(r.child2=s,o=((d.child2=p).parent=d).aabb,a=x.aabb,l=p.aabb,o.minx=(a.minx<l.minx?a:l).minx,o.miny=(a.miny<l.miny?a:l).miny,o.maxx=(a.maxx>l.maxx?a:l).maxx,o.maxy=(a.maxy>l.maxy?a:l).maxy,o=r.aabb,a=d.aabb,l=s.aabb,o.minx=(a.minx<l.minx?a:l).minx,o.miny=(a.miny<l.miny?a:l).miny,o.maxx=(a.maxx>l.maxx?a:l).maxx,o.maxy=(a.maxy>l.maxy?a:l).maxy,a=x.height,l=p.height,d.height=1+(l<a?a:l),a=d.height,l=s.height,r.height=1+(l<a?a:l)):(r.child2=p,l=((d.child2=s).parent=d).aabb,h=x.aabb,u=s.aabb,l.minx=(h.minx<u.minx?h:u).minx,l.miny=(h.miny<u.miny?h:u).miny,l.maxx=(h.maxx>u.maxx?h:u).maxx,l.maxy=(h.maxy>u.maxy?h:u).maxy,l=r.aabb,h=d.aabb,u=p.aabb,l.minx=(h.minx<u.minx?h:u).minx,l.miny=(h.miny<u.miny?h:u).miny,l.maxx=(h.maxx>u.maxx?h:u).maxx,l.maxy=(h.maxy>u.maxy?h:u).maxy,h=x.height,u=s.height,d.height=1+(u<h?h:u),h=d.height,u=p.height,r.height=1+(u<h?h:u)),d=r):c<-1&&(p=x.child1,y=x.child2,x.child1=d,x.parent=d.parent,null!=(d.parent=x).parent?x.parent.child1==d?x.parent.child1=x:x.parent.child2=x:this.root=x,p.height>y.height?(x.child2=p,h=((d.child1=y).parent=d).aabb,u=r.aabb,c=y.aabb,h.minx=(u.minx<c.minx?u:c).minx,h.miny=(u.miny<c.miny?u:c).miny,h.maxx=(u.maxx>c.maxx?u:c).maxx,h.maxy=(u.maxy>c.maxy?u:c).maxy,h=x.aabb,u=d.aabb,c=p.aabb,h.minx=(u.minx<c.minx?u:c).minx,h.miny=(u.miny<c.miny?u:c).miny,h.maxx=(u.maxx>c.maxx?u:c).maxx,h.maxy=(u.maxy>c.maxy?u:c).maxy,u=r.height,c=y.height,d.height=1+(c<u?u:c),u=d.height,c=p.height,x.height=1+(c<u?u:c)):(x.child2=y,m=((d.child1=p).parent=d).aabb,_=r.aabb,f=p.aabb,m.minx=(_.minx<f.minx?_:f).minx,m.miny=(_.miny<f.miny?_:f).miny,m.maxx=(_.maxx>f.maxx?_:f).maxx,m.maxy=(_.maxy>f.maxy?_:f).maxy,m=x.aabb,_=d.aabb,f=y.aabb,m.minx=(_.minx<f.minx?_:f).minx,m.miny=(_.miny<f.miny?_:f).miny,m.maxx=(_.maxx>f.maxx?_:f).maxx,m.maxy=(_.maxy>f.maxy?_:f).maxy,m=r.height,_=p.height,d.height=1+(_<m?m:_),f=d.height,m=y.height,x.height=1+(m<f?f:m)),d=x));var _=d.child1,y=d.child2,f=d.aabb,m=_.aabb,x=y.aabb;f.minx=(m.minx<x.minx?m:x).minx,f.miny=(m.miny<x.miny?m:x).miny,f.maxx=(m.maxx>x.maxx?m:x).maxx,f.maxy=(m.maxy>x.maxy?m:x).maxy;_=_.height,y=y.height;d.height=1+(y<_?_:y),d=d.parent}}else{(this.root=n).parent=null,e.height=-1;n=e.aabb;null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n.wrap_min=n.wrap_max=null,n._invalidate=null,n._validate=null,n.next=Be.zpp_pool,Be.zpp_pool=n,e.child1=e.child2=e.parent=null,e.next=null,e.snext=null,e.mnext=null,e.next=Ye.zpp_pool,Ye.zpp_pool=e}}},Ze.prototype.balance=function(t){if(null==t.child1||t.height<2)return t;var e=t.child1,i=t.child2,n=i.height-e.height;if(1<n){var r,s,o,a=i.child1,l=i.child2;return i.child1=t,i.parent=t.parent,null!=(t.parent=i).parent?i.parent.child1==t?i.parent.child1=i:i.parent.child2=i:this.root=i,a.height>l.height?(i.child2=a,r=((t.child2=l).parent=t).aabb,s=e.aabb,o=l.aabb,r.minx=(s.minx<o.minx?s:o).minx,r.miny=(s.miny<o.miny?s:o).miny,r.maxx=(s.maxx>o.maxx?s:o).maxx,r.maxy=(s.maxy>o.maxy?s:o).maxy,r=i.aabb,s=t.aabb,o=a.aabb,r.minx=(s.minx<o.minx?s:o).minx,r.miny=(s.miny<o.miny?s:o).miny,r.maxx=(s.maxx>o.maxx?s:o).maxx,r.maxy=(s.maxy>o.maxy?s:o).maxy,s=e.height,o=l.height,t.height=1+(o<s?s:o),s=t.height,o=a.height,i.height=1+(o<s?s:o)):(i.child2=l,s=((t.child2=a).parent=t).aabb,o=e.aabb,c=a.aabb,s.minx=(o.minx<c.minx?o:c).minx,s.miny=(o.miny<c.miny?o:c).miny,s.maxx=(o.maxx>c.maxx?o:c).maxx,s.maxy=(o.maxy>c.maxy?o:c).maxy,s=i.aabb,o=t.aabb,c=l.aabb,s.minx=(o.minx<c.minx?o:c).minx,s.miny=(o.miny<c.miny?o:c).miny,s.maxx=(o.maxx>c.maxx?o:c).maxx,s.maxy=(o.maxy>c.maxy?o:c).maxy,o=e.height,c=a.height,t.height=1+(c<o?o:c),o=t.height,c=l.height,i.height=1+(c<o?o:c)),i}if(n<-1){var p,h,u,c=e.child1,n=e.child2;return e.child1=t,e.parent=t.parent,null!=(t.parent=e).parent?e.parent.child1==t?e.parent.child1=e:e.parent.child2=e:this.root=e,c.height>n.height?(e.child2=c,u=((t.child1=n).parent=t).aabb,p=i.aabb,h=n.aabb,u.minx=(p.minx<h.minx?p:h).minx,u.miny=(p.miny<h.miny?p:h).miny,u.maxx=(p.maxx>h.maxx?p:h).maxx,u.maxy=(p.maxy>h.maxy?p:h).maxy,u=e.aabb,p=t.aabb,h=c.aabb,u.minx=(p.minx<h.minx?p:h).minx,u.miny=(p.miny<h.miny?p:h).miny,u.maxx=(p.maxx>h.maxx?p:h).maxx,u.maxy=(p.maxy>h.maxy?p:h).maxy,u=i.height,p=n.height,t.height=1+(p<u?u:p),h=t.height,u=c.height,e.height=1+(u<h?h:u)):(e.child2=n,p=((t.child1=c).parent=t).aabb,h=i.aabb,u=c.aabb,p.minx=(h.minx<u.minx?h:u).minx,p.miny=(h.miny<u.miny?h:u).miny,p.maxx=(h.maxx>u.maxx?h:u).maxx,p.maxy=(h.maxy>u.maxy?h:u).maxy,p=e.aabb,h=t.aabb,u=n.aabb,p.minx=(h.minx<u.minx?h:u).minx,p.miny=(h.miny<u.miny?h:u).miny,p.maxx=(h.maxx>u.maxx?h:u).maxx,p.maxy=(h.maxy>u.maxy?h:u).maxy,i=i.height,c=c.height,t.height=1+(c<i?i:c),c=t.height,n=n.height,e.height=1+(n<c?c:n)),e}return t},Ze.prototype.__class__=Ze;var Je=zpp_nape.space.ZPP_DynAABBPhase=function(t){this.openlist=null,this.failed=null,this.treeStack2=null,this.treeStack=null,this.moves=null,this.syncs=null,this.pairs=null,this.dtree=null,this.stree=null,qe.call(this),this.space=t,this.is_sweep=!1,(this.dynab=this).stree=new Ze,this.dtree=new Ze};Je.__name__=["zpp_nape","space","ZPP_DynAABBPhase"],Je.__super__=qe,Je.prototype=Object.create(qe.prototype),Je.prototype.stree=null,Je.prototype.dtree=null,Je.prototype.pairs=null,Je.prototype.syncs=null,Je.prototype.moves=null,Je.prototype.dyn=function(t){return 1!=t.body.type&&!t.body.component.sleeping},Je.prototype.__insert=function(t){var e;null==Ye.zpp_pool?e=new Ye:(e=Ye.zpp_pool,Ye.zpp_pool=e.next,e.next=null),null==Be.zpp_pool?e.aabb=new Be:(e.aabb=Be.zpp_pool,Be.zpp_pool=e.aabb.next,e.aabb.next=null),e.moved=!1,e.synced=!1,e.first_sync=!1,((e.shape=t).node=e).synced=!0,e.first_sync=!0,e.snext=this.syncs,this.syncs=e},Je.prototype.__remove=function(t){var e=t.node;if(e.first_sync||(e.dyn?this.dtree:this.stree).removeLeaf(e),t.node=null,e.synced){for(var i=null,n=this.syncs;null!=n&&n!=e;)n=(i=n).snext;null==i?this.syncs=n.snext:i.snext=n.snext,n.snext=null,e.synced=!1}if(e.moved){for(var r=null,s=this.moves;null!=s&&s!=e;)s=(r=s).mnext;null==r?this.moves=s.mnext:r.mnext=s.mnext,s.mnext=null,e.moved=!1}for(var o=null,a=this.pairs;null!=a;){var l,p=a.next;a.n1!=e&&a.n2!=e?(o=a,a=p):(null==o?this.pairs=p:o.next=p,null!=a.arb&&(a.arb.pair=null),a.arb=null,a.n1.shape.pairs.remove(a),a.n2.shape.pairs.remove(a),(l=a).n1=l.n2=null,l.sleeping=!1,l.next=Ke.zpp_pool,Ke.zpp_pool=l,a=p)}for(;null!=t.pairs.head;){var h=t.pairs.pop_unsafe();(h.n1==e?h.n2:h.n1).shape.pairs.remove(h),null!=h.arb&&(h.arb.pair=null),h.arb=null,h.n1=h.n2=null,h.sleeping=!1,h.next=Ke.zpp_pool,Ke.zpp_pool=h}e.height=-1;var u=e.aabb;null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u.wrap_min=u.wrap_max=null,u._invalidate=null,u._validate=null,u.next=Be.zpp_pool,Be.zpp_pool=u,e.child1=e.child2=e.parent=null,e.next=null,e.snext=null,e.mnext=null,e.next=Ye.zpp_pool,Ye.zpp_pool=e},Je.prototype.__sync=function(t){var e=t.node;if(!e.synced){if(!this.space.continuous&&t.zip_aabb&&null!=t.body)if(t.zip_aabb=!1,0==t.type){var i=t.circle;if(i.zip_worldCOM&&null!=i.body){if(i.zip_worldCOM=!1,i.zip_localCOM){if(i.zip_localCOM=!1,1==i.type){var n=i.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y,n.localCOMx+=n.lverts.next.next.x,n.localCOMy+=n.lverts.next.next.y,n.localCOMx*=.5,n.localCOMy*=.5;else{n.localCOMx=0;var r=n.localCOMy=0,s=n.lverts.next,o=s,a=s=s.next;for(s=s.next;null!=s;){var l=s;r+=a.x*(l.y-o.y);var p=l.y*a.x-l.x*a.y;n.localCOMx+=(a.x+l.x)*p,n.localCOMy+=(a.y+l.y)*p,o=a,a=l,s=s.next}var h=s=n.lverts.next;r+=a.x*(h.y-o.y);var u=h.y*a.x-h.x*a.y;n.localCOMx+=(a.x+h.x)*u,n.localCOMy+=(a.y+h.y)*u,o=a;var c=s=s.next;r+=h.x*(c.y-o.y);u=c.y*h.x-c.x*h.y;n.localCOMx+=(h.x+c.x)*u,n.localCOMy+=(h.y+c.y)*u;c=r=1/(3*r);n.localCOMx*=c,n.localCOMy*=c}}null!=i.wrap_localCOM&&(i.wrap_localCOM.zpp_inner.x=i.localCOMx,i.wrap_localCOM.zpp_inner.y=i.localCOMy)}u=i.body;u.zip_axis&&(u.zip_axis=!1,u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot)),i.worldCOMx=i.body.posx+(i.body.axisy*i.localCOMx-i.body.axisx*i.localCOMy),i.worldCOMy=i.body.posy+(i.localCOMx*i.body.axisx+i.localCOMy*i.body.axisy)}c=i.radius,u=i.radius;i.aabb.minx=i.worldCOMx-c,i.aabb.miny=i.worldCOMy-u,i.aabb.maxx=i.worldCOMx+c,i.aabb.maxy=i.worldCOMy+u}else{var d=t.polygon;if(d.zip_gverts&&null!=d.body){d.zip_gverts=!1,d.validate_lverts();var _=d.body;_.zip_axis&&(_.zip_axis=!1,_.axisx=Math.sin(_.rot),_.axisy=Math.cos(_.rot));for(var y=d.lverts.next,f=d.gverts.next;null!=f;){var m=f,x=y,y=y.next;m.x=d.body.posx+(d.body.axisy*x.x-d.body.axisx*x.y),m.y=d.body.posy+(x.x*d.body.axisx+x.y*d.body.axisy),f=f.next}}var _=d.gverts.next;d.aabb.minx=_.x,d.aabb.miny=_.y,d.aabb.maxx=_.x,d.aabb.maxy=_.y;for(var v=d.gverts.next.next;null!=v;){var g=v;g.x<d.aabb.minx&&(d.aabb.minx=g.x),g.x>d.aabb.maxx&&(d.aabb.maxx=g.x),g.y<d.aabb.miny&&(d.aabb.miny=g.y),g.y>d.aabb.maxy&&(d.aabb.maxy=g.y),v=v.next}}(e.dyn!=(1!=t.body.type&&!t.body.component.sleeping)||(_=e.aabb,!((t=t.aabb).minx>=_.minx&&t.miny>=_.miny&&t.maxx<=_.maxx&&t.maxy<=_.maxy)))&&(e.synced=!0,e.snext=this.syncs,this.syncs=e)}},Je.prototype.sync_broadphase=function(){if(this.space.validation(),null!=this.syncs)if(null==this.moves){for(var t=this.syncs;null!=t;){var e=t.shape;if(t.first_sync)t.first_sync=!1;else{var i=t.dyn?this.dtree:this.stree;if(t==i.root)i.root=null;else{var n=t.parent,r=n.parent,s=n.child1==t?n.child2:n.child1;if(null!=r){r.child1==n?r.child1=s:r.child2=s,s.parent=r,n.height=-1;var o=n.aabb;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o.wrap_min=o.wrap_max=null,o._invalidate=null,o._validate=null,o.next=Be.zpp_pool,Be.zpp_pool=o,n.child1=n.child2=n.parent=null,n.next=null,n.snext=null,n.mnext=null,n.next=Ye.zpp_pool,Ye.zpp_pool=n;for(var a,l,p,h,u,c,d,_,y,f=r;null!=f;){null==f.child1||f.height<2||(b=f.child1,1<(y=(a=f.child2).height-b.height)?(l=a.child1,c=a.child2,a.child1=f,a.parent=f.parent,null!=(f.parent=a).parent?a.parent.child1==f?a.parent.child1=a:a.parent.child2=a:i.root=a,l.height>c.height?(a.child2=l,p=((f.child2=c).parent=f).aabb,h=b.aabb,u=c.aabb,p.minx=(h.minx<u.minx?h:u).minx,p.miny=(h.miny<u.miny?h:u).miny,p.maxx=(h.maxx>u.maxx?h:u).maxx,p.maxy=(h.maxy>u.maxy?h:u).maxy,p=a.aabb,h=f.aabb,u=l.aabb,p.minx=(h.minx<u.minx?h:u).minx,p.miny=(h.miny<u.miny?h:u).miny,p.maxx=(h.maxx>u.maxx?h:u).maxx,p.maxy=(h.maxy>u.maxy?h:u).maxy,h=b.height,u=c.height,f.height=1+(u<h?h:u),h=f.height,u=l.height,a.height=1+(u<h?h:u)):(a.child2=c,u=((f.child2=l).parent=f).aabb,d=b.aabb,_=l.aabb,u.minx=(d.minx<_.minx?d:_).minx,u.miny=(d.miny<_.miny?d:_).miny,u.maxx=(d.maxx>_.maxx?d:_).maxx,u.maxy=(d.maxy>_.maxy?d:_).maxy,u=a.aabb,d=f.aabb,_=c.aabb,u.minx=(d.minx<_.minx?d:_).minx,u.miny=(d.miny<_.miny?d:_).miny,u.maxx=(d.maxx>_.maxx?d:_).maxx,u.maxy=(d.maxy>_.maxy?d:_).maxy,d=b.height,_=l.height,f.height=1+(_<d?d:_),d=f.height,_=c.height,a.height=1+(_<d?d:_)),f=a):y<-1&&(c=b.child1,x=b.child2,b.child1=f,b.parent=f.parent,null!=(f.parent=b).parent?b.parent.child1==f?b.parent.child1=b:b.parent.child2=b:i.root=b,c.height>x.height?(b.child2=c,d=((f.child1=x).parent=f).aabb,_=a.aabb,y=x.aabb,d.minx=(_.minx<y.minx?_:y).minx,d.miny=(_.miny<y.miny?_:y).miny,d.maxx=(_.maxx>y.maxx?_:y).maxx,d.maxy=(_.maxy>y.maxy?_:y).maxy,d=b.aabb,_=f.aabb,y=c.aabb,d.minx=(_.minx<y.minx?_:y).minx,d.miny=(_.miny<y.miny?_:y).miny,d.maxx=(_.maxx>y.maxx?_:y).maxx,d.maxy=(_.maxy>y.maxy?_:y).maxy,_=a.height,y=x.height,f.height=1+(y<_?_:y),_=f.height,y=c.height,b.height=1+(y<_?_:y)):(b.child2=x,g=((f.child1=c).parent=f).aabb,m=a.aabb,v=c.aabb,g.minx=(m.minx<v.minx?m:v).minx,g.miny=(m.miny<v.miny?m:v).miny,g.maxx=(m.maxx>v.maxx?m:v).maxx,g.maxy=(m.maxy>v.maxy?m:v).maxy,g=b.aabb,m=f.aabb,v=x.aabb,g.minx=(m.minx<v.minx?m:v).minx,g.miny=(m.miny<v.miny?m:v).miny,g.maxx=(m.maxx>v.maxx?m:v).maxx,g.maxy=(m.maxy>v.maxy?m:v).maxy,g=a.height,m=c.height,f.height=1+(m<g?g:m),v=f.height,g=x.height,b.height=1+(g<v?v:g)),f=b));var m=f.child1,x=f.child2,v=f.aabb,g=m.aabb,b=x.aabb;v.minx=(g.minx<b.minx?g:b).minx,v.miny=(g.miny<b.miny?g:b).miny,v.maxx=(g.maxx>b.maxx?g:b).maxx,v.maxy=(g.maxy>b.maxy?g:b).maxy;m=m.height,x=x.height;f.height=1+(x<m?m:x),f=f.parent}}else{(i.root=s).parent=null,n.height=-1;var z=n.aabb;null!=z.outer&&(z.outer.zpp_inner=null,z.outer=null),z.wrap_min=z.wrap_max=null,z._invalidate=null,z._validate=null,z.next=Be.zpp_pool,Be.zpp_pool=z,n.child1=n.child2=n.parent=null,n.next=null,n.snext=null,n.mnext=null,n.next=Ye.zpp_pool,Ye.zpp_pool=n}}}s=t.aabb;if(!this.space.continuous&&e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,0==e.type){z=e.circle;if(z.zip_worldCOM&&null!=z.body){if(z.zip_worldCOM=!1,z.zip_localCOM){if(z.zip_localCOM=!1,1==z.type){var w=z.polygon;if(null==w.lverts.next.next)w.localCOMx=w.lverts.next.x,w.localCOMy=w.lverts.next.y;else if(null==w.lverts.next.next.next)w.localCOMx=w.lverts.next.x,w.localCOMy=w.lverts.next.y,w.localCOMx+=w.lverts.next.next.x,w.localCOMy+=w.lverts.next.next.y,w.localCOMx*=.5,w.localCOMy*=.5;else{w.localCOMx=0;var C=w.localCOMy=0,P=w.lverts.next,T=P,S=P=P.next;for(P=P.next;null!=P;){var M=P;C+=S.x*(M.y-T.y);var A=M.y*S.x-M.x*S.y;w.localCOMx+=(S.x+M.x)*A,w.localCOMy+=(S.y+M.y)*A,T=S,S=M,P=P.next}n=P=w.lverts.next;C+=S.x*(n.y-T.y);var O=n.y*S.x-n.x*S.y;w.localCOMx+=(S.x+n.x)*O,w.localCOMy+=(S.y+n.y)*O,T=S;var k=P=P.next;C+=n.x*(k.y-T.y);O=k.y*n.x-k.x*n.y;w.localCOMx+=(n.x+k.x)*O,w.localCOMy+=(n.y+k.y)*O;k=C=1/(3*C);w.localCOMx*=k,w.localCOMy*=k}}null!=z.wrap_localCOM&&(z.wrap_localCOM.zpp_inner.x=z.localCOMx,z.wrap_localCOM.zpp_inner.y=z.localCOMy)}O=z.body;O.zip_axis&&(O.zip_axis=!1,O.axisx=Math.sin(O.rot),O.axisy=Math.cos(O.rot)),z.worldCOMx=z.body.posx+(z.body.axisy*z.localCOMx-z.body.axisx*z.localCOMy),z.worldCOMy=z.body.posy+(z.localCOMx*z.body.axisx+z.localCOMy*z.body.axisy)}k=z.radius,O=z.radius;z.aabb.minx=z.worldCOMx-k,z.aabb.miny=z.worldCOMy-O,z.aabb.maxx=z.worldCOMx+k,z.aabb.maxy=z.worldCOMy+O}else{var E=e.polygon;if(E.zip_gverts&&null!=E.body){E.zip_gverts=!1,E.validate_lverts();var I=E.body;I.zip_axis&&(I.zip_axis=!1,I.axisx=Math.sin(I.rot),I.axisy=Math.cos(I.rot));for(var D=E.lverts.next,B=E.gverts.next;null!=B;){var L=B,R=D,D=D.next;L.x=E.body.posx+(E.body.axisy*R.x-E.body.axisx*R.y),L.y=E.body.posy+(R.x*E.body.axisx+R.y*E.body.axisy),B=B.next}}var F=E.gverts.next;E.aabb.minx=F.x,E.aabb.miny=F.y,E.aabb.maxx=F.x,E.aabb.maxy=F.y;for(var j=E.gverts.next.next;null!=j;){var N=j;N.x<E.aabb.minx&&(E.aabb.minx=N.x),N.x>E.aabb.maxx&&(E.aabb.maxx=N.x),N.y<E.aabb.miny&&(E.aabb.miny=N.y),N.y>E.aabb.maxy&&(E.aabb.maxy=N.y),j=j.next}}I=e.aabb;s.minx=I.minx-3,s.miny=I.miny-3,s.maxx=I.maxx+3,s.maxy=I.maxy+3;var G=(t.dyn=1!=e.body.type&&!e.body.component.sleeping)?this.dtree:this.stree;if(null==G.root)G.root=t,G.root.parent=null;else{for(var U=t.aabb,X=G.root;null!=X.child1;){var V=X.child1,W=X.child2,H=X.aabb,q=2*(H.maxx-H.minx+(H.maxy-H.miny)),Y=Ze.tmpaabb,K=X.aabb;Y.minx=(K.minx<U.minx?K:U).minx,Y.miny=(K.miny<U.miny?K:U).miny,Y.maxx=(K.maxx>U.maxx?K:U).maxx,Y.maxy=(K.maxy>U.maxy?K:U).maxy;var Z,H=Ze.tmpaabb,Y=2*(H.maxx-H.minx+(H.maxy-H.miny)),K=2*Y,H=2*(Y-q),Y=Ze.tmpaabb,q=V.aabb;Y.minx=(U.minx<q.minx?U:q).minx,Y.miny=(U.miny<q.miny?U:q).miny,Y.maxx=(U.maxx>q.maxx?U:q).maxx,Y.maxy=(U.maxy>q.maxy?U:q).maxy,Z=null==V.child1?2*((q=Ze.tmpaabb).maxx-q.minx+(q.maxy-q.miny))+H:($=2*((Z=V.aabb).maxx-Z.minx+(Z.maxy-Z.miny)),2*((Q=Ze.tmpaabb).maxx-Q.minx+(Q.maxy-Q.miny))-$+H);var J,Q=Ze.tmpaabb,$=W.aabb;if(Q.minx=(U.minx<$.minx?U:$).minx,Q.miny=(U.miny<$.miny?U:$).miny,Q.maxx=(U.maxx>$.maxx?U:$).maxx,Q.maxy=(U.maxy>$.maxy?U:$).maxy,H=null==W.child1?2*((J=Ze.tmpaabb).maxx-J.minx+(J.maxy-J.miny))+H:(J=2*(($=W.aabb).maxx-$.minx+($.maxy-$.miny)),2*(($=Ze.tmpaabb).maxx-$.minx+($.maxy-$.miny))-J+H),K<Z&&K<H)break;X=Z<H?V:W}var tt,F=X,s=F.parent;null==Ye.zpp_pool?tt=new Ye:(tt=Ye.zpp_pool,Ye.zpp_pool=tt.next,tt.next=null),null==Be.zpp_pool?tt.aabb=new Be:(tt.aabb=Be.zpp_pool,Be.zpp_pool=tt.aabb.next,tt.aabb.next=null),tt.moved=!1,tt.synced=!1,tt.first_sync=!1,tt.parent=s;var et,it,nt,rt,st,ot,at,lt,pt,ht,I=tt.aabb,e=F.aabb;for(I.minx=(U.minx<e.minx?U:e).minx,I.miny=(U.miny<e.miny?U:e).miny,I.maxx=(U.maxx>e.maxx?U:e).maxx,I.maxy=(U.maxy>e.maxy?U:e).maxy,tt.height=F.height+1,null!=s?(s.child1==F?s.child1=tt:s.child2=tt,tt.child1=F,tt.child2=t,F.parent=tt,t.parent=tt):(tt.child1=F,tt.child2=t,F.parent=tt,t.parent=tt,G.root=tt),X=t.parent;null!=X;){null==X.child1||X.height<2||(_t=X.child1,1<(pt=(et=X.child2).height-_t.height)?(it=et.child1,nt=et.child2,et.child1=X,et.parent=X.parent,null!=(X.parent=et).parent?et.parent.child1==X?et.parent.child1=et:et.parent.child2=et:G.root=et,it.height>nt.height?(et.child2=it,rt=((X.child2=nt).parent=X).aabb,st=_t.aabb,ot=nt.aabb,rt.minx=(st.minx<ot.minx?st:ot).minx,rt.miny=(st.miny<ot.miny?st:ot).miny,rt.maxx=(st.maxx>ot.maxx?st:ot).maxx,rt.maxy=(st.maxy>ot.maxy?st:ot).maxy,rt=et.aabb,st=X.aabb,ot=it.aabb,rt.minx=(st.minx<ot.minx?st:ot).minx,rt.miny=(st.miny<ot.miny?st:ot).miny,rt.maxx=(st.maxx>ot.maxx?st:ot).maxx,rt.maxy=(st.maxy>ot.maxy?st:ot).maxy,st=_t.height,ot=nt.height,X.height=1+(ot<st?st:ot),st=X.height,ot=it.height,et.height=1+(ot<st?st:ot)):(et.child2=nt,ot=((X.child2=it).parent=X).aabb,at=_t.aabb,lt=it.aabb,ot.minx=(at.minx<lt.minx?at:lt).minx,ot.miny=(at.miny<lt.miny?at:lt).miny,ot.maxx=(at.maxx>lt.maxx?at:lt).maxx,ot.maxy=(at.maxy>lt.maxy?at:lt).maxy,ot=et.aabb,at=X.aabb,lt=nt.aabb,ot.minx=(at.minx<lt.minx?at:lt).minx,ot.miny=(at.miny<lt.miny?at:lt).miny,ot.maxx=(at.maxx>lt.maxx?at:lt).maxx,ot.maxy=(at.maxy>lt.maxy?at:lt).maxy,at=_t.height,lt=it.height,X.height=1+(lt<at?at:lt),at=X.height,lt=nt.height,et.height=1+(lt<at?at:lt)),X=et):pt<-1&&(at=_t.child1,ut=_t.child2,_t.child1=X,_t.parent=X.parent,null!=(X.parent=_t).parent?_t.parent.child1==X?_t.parent.child1=_t:_t.parent.child2=_t:G.root=_t,at.height>ut.height?(_t.child2=at,lt=((X.child1=ut).parent=X).aabb,pt=et.aabb,ht=ut.aabb,lt.minx=(pt.minx<ht.minx?pt:ht).minx,lt.miny=(pt.miny<ht.miny?pt:ht).miny,lt.maxx=(pt.maxx>ht.maxx?pt:ht).maxx,lt.maxy=(pt.maxy>ht.maxy?pt:ht).maxy,lt=_t.aabb,pt=X.aabb,ht=at.aabb,lt.minx=(pt.minx<ht.minx?pt:ht).minx,lt.miny=(pt.miny<ht.miny?pt:ht).miny,lt.maxx=(pt.maxx>ht.maxx?pt:ht).maxx,lt.maxy=(pt.maxy>ht.maxy?pt:ht).maxy,pt=et.height,ht=ut.height,X.height=1+(ht<pt?pt:ht),pt=X.height,ht=at.height,_t.height=1+(ht<pt?pt:ht)):(_t.child2=ut,ht=((X.child1=at).parent=X).aabb,ct=et.aabb,dt=at.aabb,ht.minx=(ct.minx<dt.minx?ct:dt).minx,ht.miny=(ct.miny<dt.miny?ct:dt).miny,ht.maxx=(ct.maxx>dt.maxx?ct:dt).maxx,ht.maxy=(ct.maxy>dt.maxy?ct:dt).maxy,ht=_t.aabb,ct=X.aabb,dt=ut.aabb,ht.minx=(ct.minx<dt.minx?ct:dt).minx,ht.miny=(ct.miny<dt.miny?ct:dt).miny,ht.maxx=(ct.maxx>dt.maxx?ct:dt).maxx,ht.maxy=(ct.maxy>dt.maxy?ct:dt).maxy,ct=et.height,dt=at.height,X.height=1+(dt<ct?ct:dt),ct=X.height,dt=ut.height,_t.height=1+(dt<ct?ct:dt)),X=_t));var ut=X.child1,ct=X.child2,dt=ut.height,_t=ct.height;X.height=1+(_t<dt?dt:_t);_t=X.aabb,ut=ut.aabb,ct=ct.aabb;_t.minx=(ut.minx<ct.minx?ut:ct).minx,_t.miny=(ut.miny<ct.miny?ut:ct).miny,_t.maxx=(ut.maxx>ct.maxx?ut:ct).maxx,_t.maxy=(ut.maxy>ct.maxy?ut:ct).maxy,X=X.parent}}t.synced=!1,t.moved=!0,t.mnext=t.snext,t.snext=null,t=t.mnext}var yt=this.syncs;this.syncs=this.moves,this.moves=yt}else for(;null!=this.syncs;){var ft=this.syncs;this.syncs=ft.snext,ft.snext=null;var mt=ft.shape;if(ft.first_sync)ft.first_sync=!1;else{var xt=ft.dyn?this.dtree:this.stree;if(ft==xt.root)xt.root=null;else{var vt=ft.parent,gt=vt.parent,bt=vt.child1==ft?vt.child2:vt.child1;if(null!=gt){gt.child1==vt?gt.child1=bt:gt.child2=bt,bt.parent=gt,vt.height=-1;var zt=vt.aabb;null!=zt.outer&&(zt.outer.zpp_inner=null,zt.outer=null),zt.wrap_min=zt.wrap_max=null,zt._invalidate=null,zt._validate=null,zt.next=Be.zpp_pool,Be.zpp_pool=zt,vt.child1=vt.child2=vt.parent=null,vt.next=null,vt.snext=null,vt.mnext=null,vt.next=Ye.zpp_pool,Ye.zpp_pool=vt;for(var wt,Ct,Pt,Tt,St,Mt,At,Ot,kt,Et=gt;null!=Et;){null==Et.child1||Et.height<2||(Rt=Et.child1,1<(kt=(wt=Et.child2).height-Rt.height)?(Ct=wt.child1,Mt=wt.child2,wt.child1=Et,wt.parent=Et.parent,null!=(Et.parent=wt).parent?wt.parent.child1==Et?wt.parent.child1=wt:wt.parent.child2=wt:xt.root=wt,Ct.height>Mt.height?(wt.child2=Ct,Pt=((Et.child2=Mt).parent=Et).aabb,Tt=Rt.aabb,St=Mt.aabb,Pt.minx=(Tt.minx<St.minx?Tt:St).minx,Pt.miny=(Tt.miny<St.miny?Tt:St).miny,Pt.maxx=(Tt.maxx>St.maxx?Tt:St).maxx,Pt.maxy=(Tt.maxy>St.maxy?Tt:St).maxy,Pt=wt.aabb,Tt=Et.aabb,St=Ct.aabb,Pt.minx=(Tt.minx<St.minx?Tt:St).minx,Pt.miny=(Tt.miny<St.miny?Tt:St).miny,Pt.maxx=(Tt.maxx>St.maxx?Tt:St).maxx,Pt.maxy=(Tt.maxy>St.maxy?Tt:St).maxy,Tt=Rt.height,St=Mt.height,Et.height=1+(St<Tt?Tt:St),Tt=Et.height,St=Ct.height,wt.height=1+(St<Tt?Tt:St)):(wt.child2=Mt,St=((Et.child2=Ct).parent=Et).aabb,At=Rt.aabb,Ot=Ct.aabb,St.minx=(At.minx<Ot.minx?At:Ot).minx,St.miny=(At.miny<Ot.miny?At:Ot).miny,St.maxx=(At.maxx>Ot.maxx?At:Ot).maxx,St.maxy=(At.maxy>Ot.maxy?At:Ot).maxy,St=wt.aabb,At=Et.aabb,Ot=Mt.aabb,St.minx=(At.minx<Ot.minx?At:Ot).minx,St.miny=(At.miny<Ot.miny?At:Ot).miny,St.maxx=(At.maxx>Ot.maxx?At:Ot).maxx,St.maxy=(At.maxy>Ot.maxy?At:Ot).maxy,At=Rt.height,Ot=Ct.height,Et.height=1+(Ot<At?At:Ot),At=Et.height,Ot=Mt.height,wt.height=1+(Ot<At?At:Ot)),Et=wt):kt<-1&&(Mt=Rt.child1,Dt=Rt.child2,Rt.child1=Et,Rt.parent=Et.parent,null!=(Et.parent=Rt).parent?Rt.parent.child1==Et?Rt.parent.child1=Rt:Rt.parent.child2=Rt:xt.root=Rt,Mt.height>Dt.height?(Rt.child2=Mt,At=((Et.child1=Dt).parent=Et).aabb,Ot=wt.aabb,kt=Dt.aabb,At.minx=(Ot.minx<kt.minx?Ot:kt).minx,At.miny=(Ot.miny<kt.miny?Ot:kt).miny,At.maxx=(Ot.maxx>kt.maxx?Ot:kt).maxx,At.maxy=(Ot.maxy>kt.maxy?Ot:kt).maxy,At=Rt.aabb,Ot=Et.aabb,kt=Mt.aabb,At.minx=(Ot.minx<kt.minx?Ot:kt).minx,At.miny=(Ot.miny<kt.miny?Ot:kt).miny,At.maxx=(Ot.maxx>kt.maxx?Ot:kt).maxx,At.maxy=(Ot.maxy>kt.maxy?Ot:kt).maxy,Ot=wt.height,kt=Dt.height,Et.height=1+(kt<Ot?Ot:kt),Ot=Et.height,kt=Mt.height,Rt.height=1+(kt<Ot?Ot:kt)):(Rt.child2=Dt,Lt=((Et.child1=Mt).parent=Et).aabb,It=wt.aabb,Bt=Mt.aabb,Lt.minx=(It.minx<Bt.minx?It:Bt).minx,Lt.miny=(It.miny<Bt.miny?It:Bt).miny,Lt.maxx=(It.maxx>Bt.maxx?It:Bt).maxx,Lt.maxy=(It.maxy>Bt.maxy?It:Bt).maxy,Lt=Rt.aabb,It=Et.aabb,Bt=Dt.aabb,Lt.minx=(It.minx<Bt.minx?It:Bt).minx,Lt.miny=(It.miny<Bt.miny?It:Bt).miny,Lt.maxx=(It.maxx>Bt.maxx?It:Bt).maxx,Lt.maxy=(It.maxy>Bt.maxy?It:Bt).maxy,Lt=wt.height,It=Mt.height,Et.height=1+(It<Lt?Lt:It),Bt=Et.height,Lt=Dt.height,Rt.height=1+(Lt<Bt?Bt:Lt)),Et=Rt));var It=Et.child1,Dt=Et.child2,Bt=Et.aabb,Lt=It.aabb,Rt=Dt.aabb;Bt.minx=(Lt.minx<Rt.minx?Lt:Rt).minx,Bt.miny=(Lt.miny<Rt.miny?Lt:Rt).miny,Bt.maxx=(Lt.maxx>Rt.maxx?Lt:Rt).maxx,Bt.maxy=(Lt.maxy>Rt.maxy?Lt:Rt).maxy;It=It.height,Dt=Dt.height;Et.height=1+(Dt<It?It:Dt),Et=Et.parent}}else{(xt.root=bt).parent=null,vt.height=-1;var Ft=vt.aabb;null!=Ft.outer&&(Ft.outer.zpp_inner=null,Ft.outer=null),Ft.wrap_min=Ft.wrap_max=null,Ft._invalidate=null,Ft._validate=null,Ft.next=Be.zpp_pool,Be.zpp_pool=Ft,vt.child1=vt.child2=vt.parent=null,vt.next=null,vt.snext=null,vt.mnext=null,vt.next=Ye.zpp_pool,Ye.zpp_pool=vt}}}bt=ft.aabb;if(!this.space.continuous&&mt.zip_aabb&&null!=mt.body)if(mt.zip_aabb=!1,0==mt.type){Ft=mt.circle;if(Ft.zip_worldCOM&&null!=Ft.body){if(Ft.zip_worldCOM=!1,Ft.zip_localCOM){if(Ft.zip_localCOM=!1,1==Ft.type){var jt=Ft.polygon;if(null==jt.lverts.next.next)jt.localCOMx=jt.lverts.next.x,jt.localCOMy=jt.lverts.next.y;else if(null==jt.lverts.next.next.next)jt.localCOMx=jt.lverts.next.x,jt.localCOMy=jt.lverts.next.y,jt.localCOMx+=jt.lverts.next.next.x,jt.localCOMy+=jt.lverts.next.next.y,jt.localCOMx*=.5,jt.localCOMy*=.5;else{jt.localCOMx=0;var Nt=jt.localCOMy=0,Gt=jt.lverts.next,Ut=Gt,Xt=Gt=Gt.next;for(Gt=Gt.next;null!=Gt;){var Vt=Gt;Nt+=Xt.x*(Vt.y-Ut.y);var Wt=Vt.y*Xt.x-Vt.x*Xt.y;jt.localCOMx+=(Xt.x+Vt.x)*Wt,jt.localCOMy+=(Xt.y+Vt.y)*Wt,Ut=Xt,Xt=Vt,Gt=Gt.next}vt=Gt=jt.lverts.next;Nt+=Xt.x*(vt.y-Ut.y);var Ht=vt.y*Xt.x-vt.x*Xt.y;jt.localCOMx+=(Xt.x+vt.x)*Ht,jt.localCOMy+=(Xt.y+vt.y)*Ht,Ut=Xt;var qt=Gt=Gt.next;Nt+=vt.x*(qt.y-Ut.y);Ht=qt.y*vt.x-qt.x*vt.y;jt.localCOMx+=(vt.x+qt.x)*Ht,jt.localCOMy+=(vt.y+qt.y)*Ht;qt=Nt=1/(3*Nt);jt.localCOMx*=qt,jt.localCOMy*=qt}}null!=Ft.wrap_localCOM&&(Ft.wrap_localCOM.zpp_inner.x=Ft.localCOMx,Ft.wrap_localCOM.zpp_inner.y=Ft.localCOMy)}Ht=Ft.body;Ht.zip_axis&&(Ht.zip_axis=!1,Ht.axisx=Math.sin(Ht.rot),Ht.axisy=Math.cos(Ht.rot)),Ft.worldCOMx=Ft.body.posx+(Ft.body.axisy*Ft.localCOMx-Ft.body.axisx*Ft.localCOMy),Ft.worldCOMy=Ft.body.posy+(Ft.localCOMx*Ft.body.axisx+Ft.localCOMy*Ft.body.axisy)}qt=Ft.radius,Ht=Ft.radius;Ft.aabb.minx=Ft.worldCOMx-qt,Ft.aabb.miny=Ft.worldCOMy-Ht,Ft.aabb.maxx=Ft.worldCOMx+qt,Ft.aabb.maxy=Ft.worldCOMy+Ht}else{var Yt=mt.polygon;if(Yt.zip_gverts&&null!=Yt.body){Yt.zip_gverts=!1,Yt.validate_lverts();var Kt=Yt.body;Kt.zip_axis&&(Kt.zip_axis=!1,Kt.axisx=Math.sin(Kt.rot),Kt.axisy=Math.cos(Kt.rot));for(var Zt=Yt.lverts.next,Jt=Yt.gverts.next;null!=Jt;){var Qt=Jt,$t=Zt,Zt=Zt.next;Qt.x=Yt.body.posx+(Yt.body.axisy*$t.x-Yt.body.axisx*$t.y),Qt.y=Yt.body.posy+($t.x*Yt.body.axisx+$t.y*Yt.body.axisy),Jt=Jt.next}}var te=Yt.gverts.next;Yt.aabb.minx=te.x,Yt.aabb.miny=te.y,Yt.aabb.maxx=te.x,Yt.aabb.maxy=te.y;for(var ee=Yt.gverts.next.next;null!=ee;){var ie=ee;ie.x<Yt.aabb.minx&&(Yt.aabb.minx=ie.x),ie.x>Yt.aabb.maxx&&(Yt.aabb.maxx=ie.x),ie.y<Yt.aabb.miny&&(Yt.aabb.miny=ie.y),ie.y>Yt.aabb.maxy&&(Yt.aabb.maxy=ie.y),ee=ee.next}}Kt=mt.aabb;bt.minx=Kt.minx-3,bt.miny=Kt.miny-3,bt.maxx=Kt.maxx+3,bt.maxy=Kt.maxy+3;var ne=(ft.dyn=1!=mt.body.type&&!mt.body.component.sleeping)?this.dtree:this.stree;if(null==ne.root)ne.root=ft,ne.root.parent=null;else{for(var re=ft.aabb,se=ne.root;null!=se.child1;){var oe=se.child1,ae=se.child2,le=se.aabb,pe=2*(le.maxx-le.minx+(le.maxy-le.miny)),he=Ze.tmpaabb,ue=se.aabb;he.minx=(ue.minx<re.minx?ue:re).minx,he.miny=(ue.miny<re.miny?ue:re).miny,he.maxx=(ue.maxx>re.maxx?ue:re).maxx,he.maxy=(ue.maxy>re.maxy?ue:re).maxy;var ce,le=Ze.tmpaabb,he=2*(le.maxx-le.minx+(le.maxy-le.miny)),ue=2*he,le=2*(he-pe),he=Ze.tmpaabb,pe=oe.aabb;he.minx=(re.minx<pe.minx?re:pe).minx,he.miny=(re.miny<pe.miny?re:pe).miny,he.maxx=(re.maxx>pe.maxx?re:pe).maxx,he.maxy=(re.maxy>pe.maxy?re:pe).maxy,ce=null==oe.child1?2*((pe=Ze.tmpaabb).maxx-pe.minx+(pe.maxy-pe.miny))+le:(ye=2*((ce=oe.aabb).maxx-ce.minx+(ce.maxy-ce.miny)),2*((_e=Ze.tmpaabb).maxx-_e.minx+(_e.maxy-_e.miny))-ye+le);var de,_e=Ze.tmpaabb,ye=ae.aabb;if(_e.minx=(re.minx<ye.minx?re:ye).minx,_e.miny=(re.miny<ye.miny?re:ye).miny,_e.maxx=(re.maxx>ye.maxx?re:ye).maxx,_e.maxy=(re.maxy>ye.maxy?re:ye).maxy,le=null==ae.child1?2*((de=Ze.tmpaabb).maxx-de.minx+(de.maxy-de.miny))+le:(de=2*((ye=ae.aabb).maxx-ye.minx+(ye.maxy-ye.miny)),2*((ye=Ze.tmpaabb).maxx-ye.minx+(ye.maxy-ye.miny))-de+le),ue<ce&&ue<le)break;se=ce<le?oe:ae}var fe,te=se,bt=te.parent;null==Ye.zpp_pool?fe=new Ye:(fe=Ye.zpp_pool,Ye.zpp_pool=fe.next,fe.next=null),null==Be.zpp_pool?fe.aabb=new Be:(fe.aabb=Be.zpp_pool,Be.zpp_pool=fe.aabb.next,fe.aabb.next=null),fe.moved=!1,fe.synced=!1,fe.first_sync=!1,fe.parent=bt;var me,xe,ve,ge,be,ze,we,Ce,Pe,Te,Kt=fe.aabb,mt=te.aabb;for(Kt.minx=(re.minx<mt.minx?re:mt).minx,Kt.miny=(re.miny<mt.miny?re:mt).miny,Kt.maxx=(re.maxx>mt.maxx?re:mt).maxx,Kt.maxy=(re.maxy>mt.maxy?re:mt).maxy,fe.height=te.height+1,null!=bt?(bt.child1==te?bt.child1=fe:bt.child2=fe,fe.child1=te,fe.child2=ft,te.parent=fe,ft.parent=fe):(fe.child1=te,fe.child2=ft,te.parent=fe,ft.parent=fe,ne.root=fe),se=ft.parent;null!=se;){null==se.child1||se.height<2||(Oe=se.child1,1<(Pe=(me=se.child2).height-Oe.height)?(xe=me.child1,ve=me.child2,me.child1=se,me.parent=se.parent,null!=(se.parent=me).parent?me.parent.child1==se?me.parent.child1=me:me.parent.child2=me:ne.root=me,xe.height>ve.height?(me.child2=xe,ge=((se.child2=ve).parent=se).aabb,be=Oe.aabb,ze=ve.aabb,ge.minx=(be.minx<ze.minx?be:ze).minx,ge.miny=(be.miny<ze.miny?be:ze).miny,ge.maxx=(be.maxx>ze.maxx?be:ze).maxx,ge.maxy=(be.maxy>ze.maxy?be:ze).maxy,ge=me.aabb,be=se.aabb,ze=xe.aabb,ge.minx=(be.minx<ze.minx?be:ze).minx,ge.miny=(be.miny<ze.miny?be:ze).miny,ge.maxx=(be.maxx>ze.maxx?be:ze).maxx,ge.maxy=(be.maxy>ze.maxy?be:ze).maxy,be=Oe.height,ze=ve.height,se.height=1+(ze<be?be:ze),be=se.height,ze=xe.height,me.height=1+(ze<be?be:ze)):(me.child2=ve,ze=((se.child2=xe).parent=se).aabb,we=Oe.aabb,Ce=xe.aabb,ze.minx=(we.minx<Ce.minx?we:Ce).minx,ze.miny=(we.miny<Ce.miny?we:Ce).miny,ze.maxx=(we.maxx>Ce.maxx?we:Ce).maxx,ze.maxy=(we.maxy>Ce.maxy?we:Ce).maxy,ze=me.aabb,we=se.aabb,Ce=ve.aabb,ze.minx=(we.minx<Ce.minx?we:Ce).minx,ze.miny=(we.miny<Ce.miny?we:Ce).miny,ze.maxx=(we.maxx>Ce.maxx?we:Ce).maxx,ze.maxy=(we.maxy>Ce.maxy?we:Ce).maxy,we=Oe.height,Ce=xe.height,se.height=1+(Ce<we?we:Ce),we=se.height,Ce=ve.height,me.height=1+(Ce<we?we:Ce)),se=me):Pe<-1&&(we=Oe.child1,Se=Oe.child2,Oe.child1=se,Oe.parent=se.parent,null!=(se.parent=Oe).parent?Oe.parent.child1==se?Oe.parent.child1=Oe:Oe.parent.child2=Oe:ne.root=Oe,we.height>Se.height?(Oe.child2=we,Ce=((se.child1=Se).parent=se).aabb,Pe=me.aabb,Te=Se.aabb,Ce.minx=(Pe.minx<Te.minx?Pe:Te).minx,Ce.miny=(Pe.miny<Te.miny?Pe:Te).miny,Ce.maxx=(Pe.maxx>Te.maxx?Pe:Te).maxx,Ce.maxy=(Pe.maxy>Te.maxy?Pe:Te).maxy,Ce=Oe.aabb,Pe=se.aabb,Te=we.aabb,Ce.minx=(Pe.minx<Te.minx?Pe:Te).minx,Ce.miny=(Pe.miny<Te.miny?Pe:Te).miny,Ce.maxx=(Pe.maxx>Te.maxx?Pe:Te).maxx,Ce.maxy=(Pe.maxy>Te.maxy?Pe:Te).maxy,Pe=me.height,Te=Se.height,se.height=1+(Te<Pe?Pe:Te),Pe=se.height,Te=we.height,Oe.height=1+(Te<Pe?Pe:Te)):(Oe.child2=Se,Te=((se.child1=we).parent=se).aabb,Me=me.aabb,Ae=we.aabb,Te.minx=(Me.minx<Ae.minx?Me:Ae).minx,Te.miny=(Me.miny<Ae.miny?Me:Ae).miny,Te.maxx=(Me.maxx>Ae.maxx?Me:Ae).maxx,Te.maxy=(Me.maxy>Ae.maxy?Me:Ae).maxy,Te=Oe.aabb,Me=se.aabb,Ae=Se.aabb,Te.minx=(Me.minx<Ae.minx?Me:Ae).minx,Te.miny=(Me.miny<Ae.miny?Me:Ae).miny,Te.maxx=(Me.maxx>Ae.maxx?Me:Ae).maxx,Te.maxy=(Me.maxy>Ae.maxy?Me:Ae).maxy,Me=me.height,Ae=we.height,se.height=1+(Ae<Me?Me:Ae),Me=se.height,Ae=Se.height,Oe.height=1+(Ae<Me?Me:Ae)),se=Oe));var Se=se.child1,Me=se.child2,Ae=Se.height,Oe=Me.height;se.height=1+(Oe<Ae?Ae:Oe);Oe=se.aabb,Se=Se.aabb,Me=Me.aabb;Oe.minx=(Se.minx<Me.minx?Se:Me).minx,Oe.miny=(Se.miny<Me.miny?Se:Me).miny,Oe.maxx=(Se.maxx>Me.maxx?Se:Me).maxx,Oe.maxy=(Se.maxy>Me.maxy?Se:Me).maxy,se=se.parent}}ft.synced=!1,ft.moved||(ft.moved=!0,ft.mnext=this.moves,this.moves=ft)}},Je.prototype.broadphase=function(t,e){for(var i=this.syncs;null!=i;){var n=i.shape;if(i.first_sync)i.first_sync=!1;else{var r=i.dyn?this.dtree:this.stree;if(i==r.root)r.root=null;else{var s=i.parent,o=s.parent,a=s.child1==i?s.child2:s.child1;if(null!=o){o.child1==s?o.child1=a:o.child2=a,a.parent=o,s.height=-1;var l=s.aabb;null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l.wrap_min=l.wrap_max=null,l._invalidate=null,l._validate=null,l.next=Be.zpp_pool,Be.zpp_pool=l,s.child1=s.child2=s.parent=null,s.next=null,s.snext=null,s.mnext=null,s.next=Ye.zpp_pool,Ye.zpp_pool=s;for(var p,h,u,c,d,_,y,f,m,x=o;null!=x;){null==x.child1||x.height<2||(w=x.child1,1<(m=(p=x.child2).height-w.height)?(h=p.child1,_=p.child2,p.child1=x,p.parent=x.parent,null!=(x.parent=p).parent?p.parent.child1==x?p.parent.child1=p:p.parent.child2=p:r.root=p,h.height>_.height?(p.child2=h,u=((x.child2=_).parent=x).aabb,c=w.aabb,d=_.aabb,u.minx=(c.minx<d.minx?c:d).minx,u.miny=(c.miny<d.miny?c:d).miny,u.maxx=(c.maxx>d.maxx?c:d).maxx,u.maxy=(c.maxy>d.maxy?c:d).maxy,u=p.aabb,c=x.aabb,d=h.aabb,u.minx=(c.minx<d.minx?c:d).minx,u.miny=(c.miny<d.miny?c:d).miny,u.maxx=(c.maxx>d.maxx?c:d).maxx,u.maxy=(c.maxy>d.maxy?c:d).maxy,c=w.height,d=_.height,x.height=1+(d<c?c:d),c=x.height,d=h.height,p.height=1+(d<c?c:d)):(p.child2=_,d=((x.child2=h).parent=x).aabb,y=w.aabb,f=h.aabb,d.minx=(y.minx<f.minx?y:f).minx,d.miny=(y.miny<f.miny?y:f).miny,d.maxx=(y.maxx>f.maxx?y:f).maxx,d.maxy=(y.maxy>f.maxy?y:f).maxy,d=p.aabb,y=x.aabb,f=_.aabb,d.minx=(y.minx<f.minx?y:f).minx,d.miny=(y.miny<f.miny?y:f).miny,d.maxx=(y.maxx>f.maxx?y:f).maxx,d.maxy=(y.maxy>f.maxy?y:f).maxy,y=w.height,f=h.height,x.height=1+(f<y?y:f),y=x.height,f=_.height,p.height=1+(f<y?y:f)),x=p):m<-1&&(_=w.child1,g=w.child2,w.child1=x,w.parent=x.parent,null!=(x.parent=w).parent?w.parent.child1==x?w.parent.child1=w:w.parent.child2=w:r.root=w,_.height>g.height?(w.child2=_,y=((x.child1=g).parent=x).aabb,f=p.aabb,m=g.aabb,y.minx=(f.minx<m.minx?f:m).minx,y.miny=(f.miny<m.miny?f:m).miny,y.maxx=(f.maxx>m.maxx?f:m).maxx,y.maxy=(f.maxy>m.maxy?f:m).maxy,y=w.aabb,f=x.aabb,m=_.aabb,y.minx=(f.minx<m.minx?f:m).minx,y.miny=(f.miny<m.miny?f:m).miny,y.maxx=(f.maxx>m.maxx?f:m).maxx,y.maxy=(f.maxy>m.maxy?f:m).maxy,f=p.height,m=g.height,x.height=1+(m<f?f:m),f=x.height,m=_.height,w.height=1+(m<f?f:m)):(w.child2=g,z=((x.child1=_).parent=x).aabb,v=p.aabb,b=_.aabb,z.minx=(v.minx<b.minx?v:b).minx,z.miny=(v.miny<b.miny?v:b).miny,z.maxx=(v.maxx>b.maxx?v:b).maxx,z.maxy=(v.maxy>b.maxy?v:b).maxy,z=w.aabb,v=x.aabb,b=g.aabb,z.minx=(v.minx<b.minx?v:b).minx,z.miny=(v.miny<b.miny?v:b).miny,z.maxx=(v.maxx>b.maxx?v:b).maxx,z.maxy=(v.maxy>b.maxy?v:b).maxy,z=p.height,v=_.height,x.height=1+(v<z?z:v),b=x.height,z=g.height,w.height=1+(z<b?b:z)),x=w));var v=x.child1,g=x.child2,b=x.aabb,z=v.aabb,w=g.aabb;b.minx=(z.minx<w.minx?z:w).minx,b.miny=(z.miny<w.miny?z:w).miny,b.maxx=(z.maxx>w.maxx?z:w).maxx,b.maxy=(z.maxy>w.maxy?z:w).maxy;v=v.height,g=g.height;x.height=1+(g<v?v:g),x=x.parent}}else{(r.root=a).parent=null,s.height=-1;var C=s.aabb;null!=C.outer&&(C.outer.zpp_inner=null,C.outer=null),C.wrap_min=C.wrap_max=null,C._invalidate=null,C._validate=null,C.next=Be.zpp_pool,Be.zpp_pool=C,s.child1=s.child2=s.parent=null,s.next=null,s.snext=null,s.mnext=null,s.next=Ye.zpp_pool,Ye.zpp_pool=s}}}a=i.aabb;if(!t.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,0==n.type){C=n.circle;if(C.zip_worldCOM&&null!=C.body){if(C.zip_worldCOM=!1,C.zip_localCOM){if(C.zip_localCOM=!1,1==C.type){var P=C.polygon;if(null==P.lverts.next.next)P.localCOMx=P.lverts.next.x,P.localCOMy=P.lverts.next.y;else if(null==P.lverts.next.next.next)P.localCOMx=P.lverts.next.x,P.localCOMy=P.lverts.next.y,P.localCOMx+=P.lverts.next.next.x,P.localCOMy+=P.lverts.next.next.y,P.localCOMx*=.5,P.localCOMy*=.5;else{P.localCOMx=0;var T=P.localCOMy=0,S=P.lverts.next,M=S,A=S=S.next;for(S=S.next;null!=S;){var O=S;T+=A.x*(O.y-M.y);var k=O.y*A.x-O.x*A.y;P.localCOMx+=(A.x+O.x)*k,P.localCOMy+=(A.y+O.y)*k,M=A,A=O,S=S.next}s=S=P.lverts.next;T+=A.x*(s.y-M.y);var E=s.y*A.x-s.x*A.y;P.localCOMx+=(A.x+s.x)*E,P.localCOMy+=(A.y+s.y)*E,M=A;var I=S=S.next;T+=s.x*(I.y-M.y);E=I.y*s.x-I.x*s.y;P.localCOMx+=(s.x+I.x)*E,P.localCOMy+=(s.y+I.y)*E;I=T=1/(3*T);P.localCOMx*=I,P.localCOMy*=I}}null!=C.wrap_localCOM&&(C.wrap_localCOM.zpp_inner.x=C.localCOMx,C.wrap_localCOM.zpp_inner.y=C.localCOMy)}E=C.body;E.zip_axis&&(E.zip_axis=!1,E.axisx=Math.sin(E.rot),E.axisy=Math.cos(E.rot)),C.worldCOMx=C.body.posx+(C.body.axisy*C.localCOMx-C.body.axisx*C.localCOMy),C.worldCOMy=C.body.posy+(C.localCOMx*C.body.axisx+C.localCOMy*C.body.axisy)}I=C.radius,E=C.radius;C.aabb.minx=C.worldCOMx-I,C.aabb.miny=C.worldCOMy-E,C.aabb.maxx=C.worldCOMx+I,C.aabb.maxy=C.worldCOMy+E}else{var D=n.polygon;if(D.zip_gverts&&null!=D.body){D.zip_gverts=!1,D.validate_lverts();var B=D.body;B.zip_axis&&(B.zip_axis=!1,B.axisx=Math.sin(B.rot),B.axisy=Math.cos(B.rot));for(var L=D.lverts.next,R=D.gverts.next;null!=R;){var F=R,j=L,L=L.next;F.x=D.body.posx+(D.body.axisy*j.x-D.body.axisx*j.y),F.y=D.body.posy+(j.x*D.body.axisx+j.y*D.body.axisy),R=R.next}}var N=D.gverts.next;D.aabb.minx=N.x,D.aabb.miny=N.y,D.aabb.maxx=N.x,D.aabb.maxy=N.y;for(var G=D.gverts.next.next;null!=G;){var U=G;U.x<D.aabb.minx&&(D.aabb.minx=U.x),U.x>D.aabb.maxx&&(D.aabb.maxx=U.x),U.y<D.aabb.miny&&(D.aabb.miny=U.y),U.y>D.aabb.maxy&&(D.aabb.maxy=U.y),G=G.next}}B=n.aabb;a.minx=B.minx-3,a.miny=B.miny-3,a.maxx=B.maxx+3,a.maxy=B.maxy+3;var X=(i.dyn=1!=n.body.type&&!n.body.component.sleeping)?this.dtree:this.stree;if(null==X.root)X.root=i,X.root.parent=null;else{for(var V=i.aabb,W=X.root;null!=W.child1;){var H=W.child1,q=W.child2,Y=W.aabb,K=2*(Y.maxx-Y.minx+(Y.maxy-Y.miny)),Z=Ze.tmpaabb,J=W.aabb;Z.minx=(J.minx<V.minx?J:V).minx,Z.miny=(J.miny<V.miny?J:V).miny,Z.maxx=(J.maxx>V.maxx?J:V).maxx,Z.maxy=(J.maxy>V.maxy?J:V).maxy;var Q,Y=Ze.tmpaabb,Z=2*(Y.maxx-Y.minx+(Y.maxy-Y.miny)),J=2*Z,Y=2*(Z-K),Z=Ze.tmpaabb,K=H.aabb;Z.minx=(V.minx<K.minx?V:K).minx,Z.miny=(V.miny<K.miny?V:K).miny,Z.maxx=(V.maxx>K.maxx?V:K).maxx,Z.maxy=(V.maxy>K.maxy?V:K).maxy,Q=null==H.child1?2*((K=Ze.tmpaabb).maxx-K.minx+(K.maxy-K.miny))+Y:(et=2*((Q=H.aabb).maxx-Q.minx+(Q.maxy-Q.miny)),2*((tt=Ze.tmpaabb).maxx-tt.minx+(tt.maxy-tt.miny))-et+Y);var $,tt=Ze.tmpaabb,et=q.aabb;if(tt.minx=(V.minx<et.minx?V:et).minx,tt.miny=(V.miny<et.miny?V:et).miny,tt.maxx=(V.maxx>et.maxx?V:et).maxx,tt.maxy=(V.maxy>et.maxy?V:et).maxy,Y=null==q.child1?2*(($=Ze.tmpaabb).maxx-$.minx+($.maxy-$.miny))+Y:($=2*((et=q.aabb).maxx-et.minx+(et.maxy-et.miny)),2*((et=Ze.tmpaabb).maxx-et.minx+(et.maxy-et.miny))-$+Y),J<Q&&J<Y)break;W=Q<Y?H:q}var it,N=W,a=N.parent;null==Ye.zpp_pool?it=new Ye:(it=Ye.zpp_pool,Ye.zpp_pool=it.next,it.next=null),null==Be.zpp_pool?it.aabb=new Be:(it.aabb=Be.zpp_pool,Be.zpp_pool=it.aabb.next,it.aabb.next=null),it.moved=!1,it.synced=!1,it.first_sync=!1,it.parent=a;var nt,rt,st,ot,at,lt,pt,ht,ut,ct,B=it.aabb,n=N.aabb;for(B.minx=(V.minx<n.minx?V:n).minx,B.miny=(V.miny<n.miny?V:n).miny,B.maxx=(V.maxx>n.maxx?V:n).maxx,B.maxy=(V.maxy>n.maxy?V:n).maxy,it.height=N.height+1,null!=a?(a.child1==N?a.child1=it:a.child2=it,it.child1=N,it.child2=i,N.parent=it,i.parent=it):(it.child1=N,it.child2=i,N.parent=it,i.parent=it,X.root=it),W=i.parent;null!=W;){null==W.child1||W.height<2||(ft=W.child1,1<(ut=(nt=W.child2).height-ft.height)?(rt=nt.child1,st=nt.child2,nt.child1=W,nt.parent=W.parent,null!=(W.parent=nt).parent?nt.parent.child1==W?nt.parent.child1=nt:nt.parent.child2=nt:X.root=nt,rt.height>st.height?(nt.child2=rt,ot=((W.child2=st).parent=W).aabb,at=ft.aabb,lt=st.aabb,ot.minx=(at.minx<lt.minx?at:lt).minx,ot.miny=(at.miny<lt.miny?at:lt).miny,ot.maxx=(at.maxx>lt.maxx?at:lt).maxx,ot.maxy=(at.maxy>lt.maxy?at:lt).maxy,ot=nt.aabb,at=W.aabb,lt=rt.aabb,ot.minx=(at.minx<lt.minx?at:lt).minx,ot.miny=(at.miny<lt.miny?at:lt).miny,ot.maxx=(at.maxx>lt.maxx?at:lt).maxx,ot.maxy=(at.maxy>lt.maxy?at:lt).maxy,at=ft.height,lt=st.height,W.height=1+(lt<at?at:lt),at=W.height,lt=rt.height,nt.height=1+(lt<at?at:lt)):(nt.child2=st,lt=((W.child2=rt).parent=W).aabb,pt=ft.aabb,ht=rt.aabb,lt.minx=(pt.minx<ht.minx?pt:ht).minx,lt.miny=(pt.miny<ht.miny?pt:ht).miny,lt.maxx=(pt.maxx>ht.maxx?pt:ht).maxx,lt.maxy=(pt.maxy>ht.maxy?pt:ht).maxy,lt=nt.aabb,pt=W.aabb,ht=st.aabb,lt.minx=(pt.minx<ht.minx?pt:ht).minx,lt.miny=(pt.miny<ht.miny?pt:ht).miny,lt.maxx=(pt.maxx>ht.maxx?pt:ht).maxx,lt.maxy=(pt.maxy>ht.maxy?pt:ht).maxy,pt=ft.height,ht=rt.height,W.height=1+(ht<pt?pt:ht),pt=W.height,ht=st.height,nt.height=1+(ht<pt?pt:ht)),W=nt):ut<-1&&(pt=ft.child1,dt=ft.child2,ft.child1=W,ft.parent=W.parent,null!=(W.parent=ft).parent?ft.parent.child1==W?ft.parent.child1=ft:ft.parent.child2=ft:X.root=ft,pt.height>dt.height?(ft.child2=pt,ht=((W.child1=dt).parent=W).aabb,ut=nt.aabb,ct=dt.aabb,ht.minx=(ut.minx<ct.minx?ut:ct).minx,ht.miny=(ut.miny<ct.miny?ut:ct).miny,ht.maxx=(ut.maxx>ct.maxx?ut:ct).maxx,ht.maxy=(ut.maxy>ct.maxy?ut:ct).maxy,ht=ft.aabb,ut=W.aabb,ct=pt.aabb,ht.minx=(ut.minx<ct.minx?ut:ct).minx,ht.miny=(ut.miny<ct.miny?ut:ct).miny,ht.maxx=(ut.maxx>ct.maxx?ut:ct).maxx,ht.maxy=(ut.maxy>ct.maxy?ut:ct).maxy,ut=nt.height,ct=dt.height,W.height=1+(ct<ut?ut:ct),ut=W.height,ct=pt.height,ft.height=1+(ct<ut?ut:ct)):(ft.child2=dt,ct=((W.child1=pt).parent=W).aabb,_t=nt.aabb,yt=pt.aabb,ct.minx=(_t.minx<yt.minx?_t:yt).minx,ct.miny=(_t.miny<yt.miny?_t:yt).miny,ct.maxx=(_t.maxx>yt.maxx?_t:yt).maxx,ct.maxy=(_t.maxy>yt.maxy?_t:yt).maxy,ct=ft.aabb,_t=W.aabb,yt=dt.aabb,ct.minx=(_t.minx<yt.minx?_t:yt).minx,ct.miny=(_t.miny<yt.miny?_t:yt).miny,ct.maxx=(_t.maxx>yt.maxx?_t:yt).maxx,ct.maxy=(_t.maxy>yt.maxy?_t:yt).maxy,_t=nt.height,yt=pt.height,W.height=1+(yt<_t?_t:yt),_t=W.height,yt=dt.height,ft.height=1+(yt<_t?_t:yt)),W=ft));var dt=W.child1,_t=W.child2,yt=dt.height,ft=_t.height;W.height=1+(ft<yt?yt:ft);ft=W.aabb,dt=dt.aabb,_t=_t.aabb;ft.minx=(dt.minx<_t.minx?dt:_t).minx,ft.miny=(dt.miny<_t.miny?dt:_t).miny,ft.maxx=(dt.maxx>_t.maxx?dt:_t).maxx,ft.maxy=(dt.maxy>_t.maxy?dt:_t).maxy,W=W.parent}}i.synced=!1,i=i.snext}for(;null!=this.syncs;){var mt=this.syncs;if(this.syncs=mt.snext,mt.snext=null,!mt.moved){mt.moved=!1;var xt=mt.shape;if(!xt.body.component.sleeping){var vt=mt.aabb,gt=null;for(null!=this.dtree.root&&(this.dtree.root.next=gt,gt=this.dtree.root);null!=gt;){var bt=gt,gt=bt.next;if(bt.next=null,bt!=mt)if(null==bt.child1){var zt=bt.shape;if(zt.body!=xt.body&&(1!=zt.body.type||1!=xt.body.type)){var wt=bt.aabb;if(wt.miny<=vt.maxy&&vt.miny<=wt.maxy&&wt.minx<=vt.maxx&&vt.minx<=wt.maxx){for(var Ct,Pt,Tt,St=xt.id<zt.id?(Ct=xt.id,zt.id):(Ct=zt.id,xt.id),Mt=null,At=(xt.pairs.length<zt.pairs.length?xt:zt).pairs.head;null!=At;){var Ot=At.elt;if(Ot.id==Ct&&Ot.di==St){Mt=Ot;break}At=At.next}null==Mt?(null==Ke.zpp_pool?Mt=new Ke:(Mt=Ke.zpp_pool,Ke.zpp_pool=Mt.next,Mt.next=null),Mt.n1=mt,Mt.n2=bt,Mt.id=Ct,Mt.di=St,Mt.next=this.pairs,(this.pairs=Mt).first=!0,kt=xt.pairs,null==un.zpp_pool?Pt=new un:(Pt=un.zpp_pool,un.zpp_pool=Pt.next,Pt.next=null),Pt.elt=Mt,(wt=Pt).next=kt.head,kt.head=wt,kt.modified=!0,kt.length++,kt=zt.pairs,null==un.zpp_pool?Tt=new un:(Tt=un.zpp_pool,un.zpp_pool=Tt.next,Tt.next=null),Tt.elt=Mt,(zt=Tt).next=kt.head,kt.head=zt,kt.modified=!0,kt.length++):Mt.sleeping&&(Mt.sleeping=!1,Mt.next=this.pairs,(this.pairs=Mt).first=!0)}}}else{var kt=bt.aabb;kt.miny<=vt.maxy&&vt.miny<=kt.maxy&&kt.minx<=vt.maxx&&vt.minx<=kt.maxx&&(null!=bt.child1&&(bt.child1.next=gt,gt=bt.child1),null!=bt.child2&&(bt.child2.next=gt,gt=bt.child2))}}for(null!=this.stree.root&&(this.stree.root.next=gt,gt=this.stree.root);null!=gt;){var Et=gt;if(gt=Et.next,Et.next=null,Et!=mt)if(null==Et.child1){var It=Et.shape;if(It.body!=xt.body&&(1!=It.body.type||1!=xt.body.type)){var Dt=Et.aabb;if(Dt.miny<=vt.maxy&&vt.miny<=Dt.maxy&&Dt.minx<=vt.maxx&&vt.minx<=Dt.maxx){for(var Bt,Lt,Rt,Ft=xt.id<It.id?(Bt=xt.id,It.id):(Bt=It.id,xt.id),jt=null,Nt=(xt.pairs.length<It.pairs.length?xt:It).pairs.head;null!=Nt;){var Gt=Nt.elt;if(Gt.id==Bt&&Gt.di==Ft){jt=Gt;break}Nt=Nt.next}null==jt?(null==Ke.zpp_pool?jt=new Ke:(jt=Ke.zpp_pool,Ke.zpp_pool=jt.next,jt.next=null),jt.n1=mt,jt.n2=Et,jt.id=Bt,jt.di=Ft,jt.next=this.pairs,(this.pairs=jt).first=!0,Ut=xt.pairs,null==un.zpp_pool?Lt=new un:(Lt=un.zpp_pool,un.zpp_pool=Lt.next,Lt.next=null),Lt.elt=jt,(Dt=Lt).next=Ut.head,Ut.head=Dt,Ut.modified=!0,Ut.length++,Ut=It.pairs,null==un.zpp_pool?Rt=new un:(Rt=un.zpp_pool,un.zpp_pool=Rt.next,Rt.next=null),Rt.elt=jt,(It=Rt).next=Ut.head,Ut.head=It,Ut.modified=!0,Ut.length++):jt.sleeping&&(jt.sleeping=!1,jt.next=this.pairs,(this.pairs=jt).first=!0)}}}else{var Ut=Et.aabb;Ut.miny<=vt.maxy&&vt.miny<=Ut.maxy&&Ut.minx<=vt.maxx&&vt.minx<=Ut.maxx&&(null!=Et.child1&&(Et.child1.next=gt,gt=Et.child1),null!=Et.child2&&(Et.child2.next=gt,gt=Et.child2))}}}}}for(;null!=this.moves;){var Xt=this.moves;this.moves=Xt.mnext,Xt.mnext=null,Xt.moved=!1;var Vt=Xt.shape;if(!Vt.body.component.sleeping){var Wt=Xt.aabb,Ht=null;for(null!=this.dtree.root&&(this.dtree.root.next=Ht,Ht=this.dtree.root);null!=Ht;){var qt=Ht,Ht=qt.next;if(qt.next=null,qt!=Xt)if(null==qt.child1){var Yt=qt.shape;if(Yt.body!=Vt.body&&(1!=Yt.body.type||1!=Vt.body.type)){var Kt=qt.aabb;if(Kt.miny<=Wt.maxy&&Wt.miny<=Kt.maxy&&Kt.minx<=Wt.maxx&&Wt.minx<=Kt.maxx){for(var Zt,Jt,Qt,$t=Vt.id<Yt.id?(Zt=Vt.id,Yt.id):(Zt=Yt.id,Vt.id),te=null,ee=(Vt.pairs.length<Yt.pairs.length?Vt:Yt).pairs.head;null!=ee;){var ie=ee.elt;if(ie.id==Zt&&ie.di==$t){te=ie;break}ee=ee.next}null==te?(null==Ke.zpp_pool?te=new Ke:(te=Ke.zpp_pool,Ke.zpp_pool=te.next,te.next=null),te.n1=Xt,te.n2=qt,te.id=Zt,te.di=$t,te.next=this.pairs,(this.pairs=te).first=!0,ne=Vt.pairs,null==un.zpp_pool?Jt=new un:(Jt=un.zpp_pool,un.zpp_pool=Jt.next,Jt.next=null),Jt.elt=te,(Kt=Jt).next=ne.head,ne.head=Kt,ne.modified=!0,ne.length++,ne=Yt.pairs,null==un.zpp_pool?Qt=new un:(Qt=un.zpp_pool,un.zpp_pool=Qt.next,Qt.next=null),Qt.elt=te,(Yt=Qt).next=ne.head,ne.head=Yt,ne.modified=!0,ne.length++):te.sleeping&&(te.sleeping=!1,te.next=this.pairs,(this.pairs=te).first=!0)}}}else{var ne=qt.aabb;ne.miny<=Wt.maxy&&Wt.miny<=ne.maxy&&ne.minx<=Wt.maxx&&Wt.minx<=ne.maxx&&(null!=qt.child1&&(qt.child1.next=Ht,Ht=qt.child1),null!=qt.child2&&(qt.child2.next=Ht,Ht=qt.child2))}}for(null!=this.stree.root&&(this.stree.root.next=Ht,Ht=this.stree.root);null!=Ht;){var re=Ht;if(Ht=re.next,re.next=null,re!=Xt)if(null==re.child1){var se=re.shape;if(se.body!=Vt.body&&(1!=se.body.type||1!=Vt.body.type)){var oe=re.aabb;if(oe.miny<=Wt.maxy&&Wt.miny<=oe.maxy&&oe.minx<=Wt.maxx&&Wt.minx<=oe.maxx){for(var ae,le,pe,he=Vt.id<se.id?(ae=Vt.id,se.id):(ae=se.id,Vt.id),ue=null,ce=(Vt.pairs.length<se.pairs.length?Vt:se).pairs.head;null!=ce;){var de=ce.elt;if(de.id==ae&&de.di==he){ue=de;break}ce=ce.next}null==ue?(null==Ke.zpp_pool?ue=new Ke:(ue=Ke.zpp_pool,Ke.zpp_pool=ue.next,ue.next=null),ue.n1=Xt,ue.n2=re,ue.id=ae,ue.di=he,ue.next=this.pairs,(this.pairs=ue).first=!0,_e=Vt.pairs,null==un.zpp_pool?le=new un:(le=un.zpp_pool,un.zpp_pool=le.next,le.next=null),le.elt=ue,(oe=le).next=_e.head,_e.head=oe,_e.modified=!0,_e.length++,_e=se.pairs,null==un.zpp_pool?pe=new un:(pe=un.zpp_pool,un.zpp_pool=pe.next,pe.next=null),pe.elt=ue,(se=pe).next=_e.head,_e.head=se,_e.modified=!0,_e.length++):ue.sleeping&&(ue.sleeping=!1,ue.next=this.pairs,(this.pairs=ue).first=!0)}}}else{var _e=re.aabb;_e.miny<=Wt.maxy&&Wt.miny<=_e.maxy&&_e.minx<=Wt.maxx&&Wt.minx<=_e.maxx&&(null!=re.child1&&(re.child1.next=Ht,Ht=re.child1),null!=re.child2&&(re.child2.next=Ht,Ht=re.child2))}}}}for(var ye=null,fe=this.pairs;null!=fe;)if(!fe.first&&(Ie=fe.n1.aabb,!((De=fe.n2.aabb).miny<=Ie.maxy&&Ie.miny<=De.maxy&&De.minx<=Ie.maxx&&Ie.minx<=De.maxx))){null==ye?this.pairs=fe.next:ye.next=fe.next;for(var me,xe,ve=fe.n1.shape.pairs,ge=null,be=ve.head;null!=be;){if(be.elt==fe){null==ge?(xe=(me=ve.head).next,ve.head=xe,null==ve.head&&(ve.pushmod=!0)):(xe=(me=ge.next).next,null==(ge.next=xe)&&(ve.pushmod=!0));var ze=me;ze.elt=null,ze.next=un.zpp_pool,un.zpp_pool=ze,ve.modified=!0,ve.length--,ve.pushmod=!0;break}be=(ge=be).next}for(var we,Ce,Pe=fe.n2.shape.pairs,Te=null,Se=Pe.head;null!=Se;){if(Se.elt==fe){null==Te?(Ce=(we=Pe.head).next,Pe.head=Ce,null==Pe.head&&(Pe.pushmod=!0)):(Ce=(we=Te.next).next,null==(Te.next=Ce)&&(Pe.pushmod=!0));var Me=we;Me.elt=null,Me.next=un.zpp_pool,un.zpp_pool=Me,Pe.modified=!0,Pe.length--,Pe.pushmod=!0;break}Se=(Te=Se).next}var Ae=fe.next;null!=fe.arb&&(fe.arb.pair=null),fe.arb=null;var Oe=fe;Oe.n1=Oe.n2=null,Oe.sleeping=!1,Oe.next=Ke.zpp_pool,Ke.zpp_pool=Oe,fe=Ae}else var ke=fe.n1.shape,Ee=ke.body,Ie=fe.n2.shape,De=Ie.body,fe=fe.first||!Ee.component.sleeping&&1!=Ee.type||!De.component.sleeping&&1!=De.type?(fe.first=!1,Oe=ke.aabb,(Ae=Ie.aabb).miny<=Oe.maxy&&Oe.miny<=Ae.maxy&&Ae.minx<=Oe.maxx&&Oe.minx<=Ae.maxx&&(Ae=fe.arb,fe.arb=e?t.narrowPhase(ke,Ie,2!=Ee.type||2!=De.type,fe.arb,!1):t.continuousEvent(ke,Ie,2!=Ee.type||2!=De.type,fe.arb,!1),null==fe.arb?null!=Ae&&(Ae.pair=null):fe.arb.pair=fe),(ye=fe).next):(fe.sleeping=!0,null==ye?this.pairs=fe.next:ye.next=fe.next,fe.next)},Je.prototype.clear=function(){for(;null!=this.syncs;){var t=this.syncs.snext;this.syncs.snext=null,this.syncs.first_sync&&(this.syncs.shape.node=null,this.syncs.shape.removedFromSpace(),this.syncs.shape=null),this.syncs=t}for(;null!=this.moves;){var e=this.moves.mnext;this.moves.mnext=null,this.moves.first_sync&&(this.moves.shape.node=null,this.moves.shape.removedFromSpace(),this.moves.shape=null),this.moves=e}for(;null!=this.pairs;){var i=this.pairs.next;null!=this.pairs.arb&&(this.pairs.arb.pair=null),this.pairs.arb=null;for(var n,r,s=this.pairs.n1.shape.pairs,o=this.pairs,a=null,l=s.head;null!=l;){if(l.elt==o){null==a?(r=(n=s.head).next,s.head=r,null==s.head&&(s.pushmod=!0)):(r=(n=a.next).next,null==(a.next=r)&&(s.pushmod=!0));var p=n;p.elt=null,p.next=un.zpp_pool,un.zpp_pool=p,s.modified=!0,s.length--,s.pushmod=!0;break}l=(a=l).next}for(var h,u,c=this.pairs.n2.shape.pairs,d=this.pairs,_=null,y=c.head;null!=y;){if(y.elt==d){null==_?(u=(h=c.head).next,c.head=u,null==c.head&&(c.pushmod=!0)):(u=(h=_.next).next,null==(_.next=u)&&(c.pushmod=!0));var f=h;f.elt=null,f.next=un.zpp_pool,un.zpp_pool=f,c.modified=!0,c.length--,c.pushmod=!0;break}y=(_=y).next}var m=this.pairs;m.n1=m.n2=null,m.sleeping=!1,m.next=Ke.zpp_pool,Ke.zpp_pool=m,this.pairs=i}this.dtree.clear(),this.stree.clear()},Je.prototype.treeStack=null,Je.prototype.shapesUnderPoint=function(t,e,i,n){var r;this.sync_broadphase(),null==Ir.zpp_pool?r=new Ir:(r=Ir.zpp_pool,Ir.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=t,r.y=e;var s=r,o=null==n?new yt:n;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new ki),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var a=this.treeStack.pop_unsafe(),l=a.aabb;s.x>=l.minx&&s.x<=l.maxx&&s.y>=l.miny&&s.y<=l.maxy&&(null==a.child1?(null==i||0!=((l=a.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&l.collisionGroup))&&(0==a.shape.type?Er.circleContains(a.shape.circle,s)&&o.push(a.shape.outer):Er.polyContains(a.shape.polygon,s)&&o.push(a.shape.outer)):(null!=a.child1&&this.treeStack.add(a.child1),null!=a.child2&&this.treeStack.add(a.child2)))}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new ki),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var p=this.treeStack.pop_unsafe(),h=p.aabb;s.x>=h.minx&&s.x<=h.maxx&&s.y>=h.miny&&s.y<=h.maxy&&(null==p.child1?(null==i||0!=((h=p.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&h.collisionGroup))&&(0==p.shape.type?Er.circleContains(p.shape.circle,s)&&o.push(p.shape.outer):Er.polyContains(p.shape.polygon,s)&&o.push(p.shape.outer)):(null!=p.child1&&this.treeStack.add(p.child1),null!=p.child2&&this.treeStack.add(p.child2)))}return null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s,o},Je.prototype.bodiesUnderPoint=function(t,e,i,n){var r;this.sync_broadphase(),null==Ir.zpp_pool?r=new Ir:(r=Ir.zpp_pool,Ir.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=t,r.y=e;var s=r,o=null==n?new tt:n;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new ki),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var a,l=this.treeStack.pop_unsafe(),p=l.aabb;s.x>=p.minx&&s.x<=p.maxx&&s.y>=p.miny&&s.y<=p.maxy&&(null==l.child1?(a=l.shape.body.outer,o.has(a)||(null==i||0!=((p=l.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&p.collisionGroup))&&(0==l.shape.type?Er.circleContains(l.shape.circle,s)&&o.push(a):Er.polyContains(l.shape.polygon,s)&&o.push(a))):(null!=l.child1&&this.treeStack.add(l.child1),null!=l.child2&&this.treeStack.add(l.child2)))}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new ki),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var h,u=this.treeStack.pop_unsafe(),c=u.aabb;s.x>=c.minx&&s.x<=c.maxx&&s.y>=c.miny&&s.y<=c.maxy&&(null==u.child1?(h=u.shape.body.outer,o.has(h)||(null==i||0!=((c=u.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&c.collisionGroup))&&(0==u.shape.type?Er.circleContains(u.shape.circle,s)&&o.push(h):Er.polyContains(u.shape.polygon,s)&&o.push(h))):(null!=u.child1&&this.treeStack.add(u.child1),null!=u.child2&&this.treeStack.add(u.child2)))}return null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ir.zpp_pool,Ir.zpp_pool=s,o},Je.prototype.treeStack2=null,Je.prototype.shapesInAABB=function(t,e,i,n,r){this.sync_broadphase(),this.updateAABBShape(t);var s=this.aabbShape.zpp_inner.aabb,o=null==r?new yt:r;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new ki),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var a=this.treeStack.pop_unsafe(),l=a.aabb;if(l.minx>=s.minx&&l.miny>=s.miny&&l.maxx<=s.maxx&&l.maxy<=s.maxy)if(null==a.child1)(null==n||0!=((c=a.shape.filter).collisionMask&n.collisionGroup)&&0!=(n.collisionMask&c.collisionGroup))&&o.push(a.shape.outer);else for(null==this.treeStack2&&(this.treeStack2=new ki),this.treeStack2.add(a);null!=this.treeStack2.head;){var p,h=this.treeStack2.pop_unsafe();null==h.child1?(null==n||0!=((p=h.shape.filter).collisionMask&n.collisionGroup)&&0!=(n.collisionMask&p.collisionGroup))&&o.push(h.shape.outer):(null!=h.child1&&this.treeStack2.add(h.child1),null!=h.child2&&this.treeStack2.add(h.child2))}else{var u,c=a.aabb;s.miny<=c.maxy&&c.miny<=s.maxy&&s.minx<=c.maxx&&c.minx<=s.maxx&&(null==a.child1?(null==n||0!=((c=a.shape.filter).collisionMask&n.collisionGroup)&&0!=(n.collisionMask&c.collisionGroup))&&(e?i?Er.containTest(this.aabbShape.zpp_inner,a.shape)&&o.push(a.shape.outer):((u=a.shape.aabb).minx>=s.minx&&u.miny>=s.miny&&u.maxx<=s.maxx&&u.maxy<=s.maxy||Er.testCollide_safe(a.shape,this.aabbShape.zpp_inner))&&o.push(a.shape.outer):(!i||(u=a.shape.aabb).minx>=s.minx&&u.miny>=s.miny&&u.maxx<=s.maxx&&u.maxy<=s.maxy)&&o.push(a.shape.outer)):(null!=a.child1&&this.treeStack.add(a.child1),null!=a.child2&&this.treeStack.add(a.child2)))}}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new ki),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var d=this.treeStack.pop_unsafe(),_=d.aabb;if(_.minx>=s.minx&&_.miny>=s.miny&&_.maxx<=s.maxx&&_.maxy<=s.maxy)if(null==d.child1)(null==n||0!=((x=d.shape.filter).collisionMask&n.collisionGroup)&&0!=(n.collisionMask&x.collisionGroup))&&o.push(d.shape.outer);else for(null==this.treeStack2&&(this.treeStack2=new ki),this.treeStack2.add(d);null!=this.treeStack2.head;){var y,f=this.treeStack2.pop_unsafe();null==f.child1?(null==n||0!=((y=f.shape.filter).collisionMask&n.collisionGroup)&&0!=(n.collisionMask&y.collisionGroup))&&o.push(f.shape.outer):(null!=f.child1&&this.treeStack2.add(f.child1),null!=f.child2&&this.treeStack2.add(f.child2))}else{var m,x=d.aabb;s.miny<=x.maxy&&x.miny<=s.maxy&&s.minx<=x.maxx&&x.minx<=s.maxx&&(null==d.child1?(null==n||0!=((x=d.shape.filter).collisionMask&n.collisionGroup)&&0!=(n.collisionMask&x.collisionGroup))&&(e?i?Er.containTest(this.aabbShape.zpp_inner,d.shape)&&o.push(d.shape.outer):((m=d.shape.aabb).minx>=s.minx&&m.miny>=s.miny&&m.maxx<=s.maxx&&m.maxy<=s.maxy||Er.testCollide_safe(d.shape,this.aabbShape.zpp_inner))&&o.push(d.shape.outer):(!i||(m=d.shape.aabb).minx>=s.minx&&m.miny>=s.miny&&m.maxx<=s.maxx&&m.maxy<=s.maxy)&&o.push(d.shape.outer)):(null!=d.child1&&this.treeStack.add(d.child1),null!=d.child2&&this.treeStack.add(d.child2)))}}return o},Je.prototype.failed=null,Je.prototype.bodiesInAABB=function(t,e,i,n,r){this.sync_broadphase(),this.updateAABBShape(t);var s=this.aabbShape.zpp_inner.aabb,o=null==r?new tt:r;if(null==this.failed&&(this.failed=new tt),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new ki),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var a=this.treeStack.pop_unsafe(),l=a.aabb;if(l.minx>=s.minx&&l.miny>=s.miny&&l.maxx<=s.maxx&&l.maxy<=s.maxy)if(null==a.child1)(null==n||0!=((l=a.shape.filter).collisionMask&n.collisionGroup)&&0!=(n.collisionMask&l.collisionGroup))&&(d=a.shape.body.outer,o.has(d)||o.push(d));else for(null==this.treeStack2&&(this.treeStack2=new ki),this.treeStack2.add(a);null!=this.treeStack2.head;){var p,h=this.treeStack2.pop_unsafe();null==h.child1?(null==n||0!=((p=h.shape.filter).collisionMask&n.collisionGroup)&&0!=(n.collisionMask&p.collisionGroup))&&(p=h.shape.body.outer,o.has(p)||o.push(p)):(null!=h.child1&&this.treeStack2.add(h.child1),null!=h.child2&&this.treeStack2.add(h.child2))}else{var u,c,d=a.aabb;s.miny<=d.maxy&&d.miny<=s.maxy&&s.minx<=d.maxx&&d.minx<=s.maxx&&(null==a.child1?(d=a.shape.body.outer,(null==n||0!=((u=a.shape.filter).collisionMask&n.collisionGroup)&&0!=(n.collisionMask&u.collisionGroup))&&(e?i?this.failed.has(d)||(u=Er.containTest(this.aabbShape.zpp_inner,a.shape),!o.has(d)&&u?o.push(d):u||(o.remove(d),this.failed.push(d))):!o.has(d)&&Er.testCollide_safe(a.shape,this.aabbShape.zpp_inner)&&o.push(d):i?this.failed.has(d)||(c=(c=a.shape.aabb).minx>=s.minx&&c.miny>=s.miny&&c.maxx<=s.maxx&&c.maxy<=s.maxy,!o.has(d)&&c?o.push(d):c||(o.remove(d),this.failed.push(d))):!o.has(d)&&((c=a.shape.aabb).minx>=s.minx&&c.miny>=s.miny&&c.maxx<=s.maxx&&c.maxy<=s.maxy)&&o.push(d))):(null!=a.child1&&this.treeStack.add(a.child1),null!=a.child2&&this.treeStack.add(a.child2)))}}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new ki),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var _=this.treeStack.pop_unsafe(),y=_.aabb;if(y.minx>=s.minx&&y.miny>=s.miny&&y.maxx<=s.maxx&&y.maxy<=s.maxy)if(null==_.child1)(null==n||0!=((y=_.shape.filter).collisionMask&n.collisionGroup)&&0!=(n.collisionMask&y.collisionGroup))&&(g=_.shape.body.outer,o.has(g)||o.push(g));else for(null==this.treeStack2&&(this.treeStack2=new ki),this.treeStack2.add(_);null!=this.treeStack2.head;){var f,m=this.treeStack2.pop_unsafe();null==m.child1?(null==n||0!=((f=m.shape.filter).collisionMask&n.collisionGroup)&&0!=(n.collisionMask&f.collisionGroup))&&(f=m.shape.body.outer,o.has(f)||o.push(f)):(null!=m.child1&&this.treeStack2.add(m.child1),null!=m.child2&&this.treeStack2.add(m.child2))}else{var x,v,g=_.aabb;s.miny<=g.maxy&&g.miny<=s.maxy&&s.minx<=g.maxx&&g.minx<=s.maxx&&(null==_.child1?(g=_.shape.body.outer,(null==n||0!=((x=_.shape.filter).collisionMask&n.collisionGroup)&&0!=(n.collisionMask&x.collisionGroup))&&(e?i?this.failed.has(g)||(x=Er.containTest(this.aabbShape.zpp_inner,_.shape),!o.has(g)&&x?o.push(g):x||(o.remove(g),this.failed.push(g))):!o.has(g)&&Er.testCollide_safe(_.shape,this.aabbShape.zpp_inner)&&o.push(g):i?this.failed.has(g)||(v=(v=_.shape.aabb).minx>=s.minx&&v.miny>=s.miny&&v.maxx<=s.maxx&&v.maxy<=s.maxy,!o.has(g)&&v?o.push(g):v||(o.remove(g),this.failed.push(g))):!o.has(g)&&((v=_.shape.aabb).minx>=s.minx&&v.miny>=s.miny&&v.maxx<=s.maxx&&v.maxy<=s.maxy)&&o.push(g))):(null!=_.child1&&this.treeStack.add(_.child1),null!=_.child2&&this.treeStack.add(_.child2)))}}return this.failed.clear(),o},Je.prototype.shapesInCircle=function(t,e,i,n,r,s){this.sync_broadphase(),this.updateCircShape(t,e,i);var o=this.circShape.zpp_inner.aabb,a=null==s?new yt:s;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new ki),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var l=this.treeStack.pop_unsafe(),p=l.aabb;o.miny<=p.maxy&&p.miny<=o.maxy&&o.minx<=p.maxx&&p.minx<=o.maxx&&(null==l.child1?(null==r||0!=((p=l.shape.filter).collisionMask&r.collisionGroup)&&0!=(r.collisionMask&p.collisionGroup))&&(n?Er.containTest(this.circShape.zpp_inner,l.shape)&&a.push(l.shape.outer):Er.testCollide_safe(l.shape,this.circShape.zpp_inner)&&a.push(l.shape.outer)):(null!=l.child1&&this.treeStack.add(l.child1),null!=l.child2&&this.treeStack.add(l.child2)))}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new ki),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var h=this.treeStack.pop_unsafe(),u=h.aabb;o.miny<=u.maxy&&u.miny<=o.maxy&&o.minx<=u.maxx&&u.minx<=o.maxx&&(null==h.child1?(null==r||0!=((u=h.shape.filter).collisionMask&r.collisionGroup)&&0!=(r.collisionMask&u.collisionGroup))&&(n?Er.containTest(this.circShape.zpp_inner,h.shape)&&a.push(h.shape.outer):Er.testCollide_safe(h.shape,this.circShape.zpp_inner)&&a.push(h.shape.outer)):(null!=h.child1&&this.treeStack.add(h.child1),null!=h.child2&&this.treeStack.add(h.child2)))}return a},Je.prototype.bodiesInCircle=function(t,e,i,n,r,s){this.sync_broadphase(),this.updateCircShape(t,e,i);var o=this.circShape.zpp_inner.aabb,a=null==s?new tt:s;if(null==this.failed&&(this.failed=new tt),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new ki),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var l,p=this.treeStack.pop_unsafe(),h=p.aabb;o.miny<=h.maxy&&h.miny<=o.maxy&&o.minx<=h.maxx&&h.minx<=o.maxx&&(null==p.child1?(h=p.shape.body.outer,(null==r||0!=((l=p.shape.filter).collisionMask&r.collisionGroup)&&0!=(r.collisionMask&l.collisionGroup))&&(n?this.failed.has(h)||(l=Er.containTest(this.circShape.zpp_inner,p.shape),!a.has(h)&&l?a.push(h):l||(a.remove(h),this.failed.push(h))):!a.has(h)&&Er.testCollide_safe(p.shape,this.circShape.zpp_inner)&&a.push(h))):(null!=p.child1&&this.treeStack.add(p.child1),null!=p.child2&&this.treeStack.add(p.child2)))}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new ki),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var u,c=this.treeStack.pop_unsafe(),d=c.aabb;o.miny<=d.maxy&&d.miny<=o.maxy&&o.minx<=d.maxx&&d.minx<=o.maxx&&(null==c.child1?(d=c.shape.body.outer,(null==r||0!=((u=c.shape.filter).collisionMask&r.collisionGroup)&&0!=(r.collisionMask&u.collisionGroup))&&(n?this.failed.has(d)||(u=Er.containTest(this.circShape.zpp_inner,c.shape),!a.has(d)&&u?a.push(d):u||(a.remove(d),this.failed.push(d))):!a.has(d)&&Er.testCollide_safe(c.shape,this.circShape.zpp_inner)&&a.push(d))):(null!=c.child1&&this.treeStack.add(c.child1),null!=c.child2&&this.treeStack.add(c.child2)))}return this.failed.clear(),a},Je.prototype.shapesInShape=function(t,e,i,n){this.sync_broadphase(),this.validateShape(t);var r=t.aabb,s=null==n?new yt:n;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new ki),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var o=this.treeStack.pop_unsafe(),a=o.aabb;r.miny<=a.maxy&&a.miny<=r.maxy&&r.minx<=a.maxx&&a.minx<=r.maxx&&(null==o.child1?(null==i||0!=((a=o.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&a.collisionGroup))&&(e?Er.containTest(t,o.shape)&&s.push(o.shape.outer):Er.testCollide_safe(o.shape,t)&&s.push(o.shape.outer)):(null!=o.child1&&this.treeStack.add(o.child1),null!=o.child2&&this.treeStack.add(o.child2)))}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new ki),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var l=this.treeStack.pop_unsafe(),p=l.aabb;r.miny<=p.maxy&&p.miny<=r.maxy&&r.minx<=p.maxx&&p.minx<=r.maxx&&(null==l.child1?(null==i||0!=((p=l.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&p.collisionGroup))&&(e?Er.containTest(t,l.shape)&&s.push(l.shape.outer):Er.testCollide_safe(l.shape,t)&&s.push(l.shape.outer)):(null!=l.child1&&this.treeStack.add(l.child1),null!=l.child2&&this.treeStack.add(l.child2)))}return s},Je.prototype.bodiesInShape=function(t,e,i,n){this.sync_broadphase(),this.validateShape(t);var r=t.aabb,s=null==n?new tt:n;if(null==this.failed&&(this.failed=new tt),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new ki),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var o,a=this.treeStack.pop_unsafe(),l=a.aabb;r.miny<=l.maxy&&l.miny<=r.maxy&&r.minx<=l.maxx&&l.minx<=r.maxx&&(null==a.child1?(l=a.shape.body.outer,(null==i||0!=((o=a.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&o.collisionGroup))&&(e?this.failed.has(l)||(o=Er.containTest(t,a.shape),!s.has(l)&&o?s.push(l):o||(s.remove(l),this.failed.push(l))):!s.has(l)&&Er.testCollide_safe(a.shape,t)&&s.push(l))):(null!=a.child1&&this.treeStack.add(a.child1),null!=a.child2&&this.treeStack.add(a.child2)))}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new ki),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var p,h=this.treeStack.pop_unsafe(),u=h.aabb;r.miny<=u.maxy&&u.miny<=r.maxy&&r.minx<=u.maxx&&u.minx<=r.maxx&&(null==h.child1?(u=h.shape.body.outer,(null==i||0!=((p=h.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&p.collisionGroup))&&(e?this.failed.has(u)||(p=Er.containTest(t,h.shape),!s.has(u)&&p?s.push(u):p||(s.remove(u),this.failed.push(u))):!s.has(u)&&Er.testCollide_safe(h.shape,t)&&s.push(u))):(null!=h.child1&&this.treeStack.add(h.child1),null!=h.child2&&this.treeStack.add(h.child2)))}return this.failed.clear(),s},Je.prototype.openlist=null,Je.prototype.rayCast=function(t,e,i){null==this.openlist&&(this.openlist=new ki),this.sync_broadphase(),t.validate_dir();var n=t.maxdist;if(null!=this.dtree.root&&t.aabbtest(this.dtree.root.aabb)){var r=t.aabbsect(this.dtree.root.aabb);if(0<=r&&r<n){this.dtree.root.rayt=r;for(var s=null,o=this.openlist.head;null!=o&&!(this.dtree.root.rayt<o.elt.rayt);)o=(s=o).next;var a=this.openlist;null==dn.zpp_pool?l=new dn:(l=dn.zpp_pool,dn.zpp_pool=l.next,l.next=null),l.elt=this.dtree.root;var l=l;null==s?(l.next=a.head,a.head=l):(l.next=s.next,s.next=l),a.pushmod=a.modified=!0,a.length++}}if(null!=this.stree.root&&t.aabbtest(this.stree.root.aabb)){a=t.aabbsect(this.stree.root.aabb);if(0<=a&&a<n){this.stree.root.rayt=a;for(var p=null,h=this.openlist.head;null!=h&&!(this.stree.root.rayt<h.elt.rayt);)h=(p=h).next;a=this.openlist;null==dn.zpp_pool?u=new dn:(u=dn.zpp_pool,dn.zpp_pool=u.next,u.next=null),u.elt=this.stree.root;var u=u;null==p?(u.next=a.head,a.head=u):(u.next=p.next,p.next=u),a.pushmod=a.modified=!0,a.length++}}for(var c=null;null!=this.openlist.head;){var d=this.openlist.pop_unsafe();if(d.rayt>=n)break;if(null==d.child1){var _,y=d.shape;!(null==i||0!=((_=y.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&_.collisionGroup))||null!=(f=0==y.type?t.circlesect(y.circle,e,n):t.aabbtest(y.aabb)?t.polysect(y.polygon,e,n):null)&&(n=f.zpp_inner.toiDistance,null!=c&&c.zpp_inner.free(),c=f)}else{if(null!=d.child1&&t.aabbtest(d.child1.aabb)){var f=t.aabbsect(d.child1.aabb);if(0<=f&&f<n){d.child1.rayt=f;for(var m=null,x=this.openlist.head;null!=x&&!(d.child1.rayt<x.elt.rayt);)x=(m=x).next;var v,g=this.openlist;null==dn.zpp_pool?v=new dn:(v=dn.zpp_pool,dn.zpp_pool=v.next,v.next=null),v.elt=d.child1;var b=v;null==m?(b.next=g.head,g.head=b):(b.next=m.next,m.next=b),g.pushmod=g.modified=!0,g.length++}}if(null!=d.child2&&t.aabbtest(d.child2.aabb)){b=t.aabbsect(d.child2.aabb);if(0<=b&&b<n){d.child2.rayt=b;for(var z=null,w=this.openlist.head;null!=w&&!(d.child2.rayt<w.elt.rayt);)w=(z=w).next;var C,g=this.openlist;null==dn.zpp_pool?C=new dn:(C=dn.zpp_pool,dn.zpp_pool=C.next,C.next=null),C.elt=d.child2;b=C;null==z?(b.next=g.head,g.head=b):(b.next=z.next,z.next=b),g.pushmod=g.modified=!0,g.length++}}}}return this.openlist.clear(),c},Je.prototype.rayMultiCast=function(t,e,i,n){null==this.openlist&&(this.openlist=new ki),this.sync_broadphase(),t.validate_dir();var r,s=t.maxdist>=1/0,o=null==n?new q:n;for(null!=this.dtree.root&&t.aabbtest(this.dtree.root.aabb)&&(s||0<=(r=t.aabbsect(this.dtree.root.aabb))&&r<t.maxdist)&&this.openlist.add(this.dtree.root),null!=this.stree.root&&t.aabbtest(this.stree.root.aabb)&&(s||0<=(r=t.aabbsect(this.stree.root.aabb))&&r<t.maxdist)&&this.openlist.add(this.stree.root);null!=this.openlist.head;){var a,l,p,h=this.openlist.pop_unsafe();null==h.child1?(a=h.shape,(null==i||0!=((l=a.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&l.collisionGroup))&&(0==a.type?t.circlesect2(a.circle,e,o):t.aabbtest(a.aabb)&&t.polysect2(a.polygon,e,o))):(null!=h.child1&&t.aabbtest(h.child1.aabb)&&(s||0<=(p=t.aabbsect(h.child1.aabb))&&p<t.maxdist)&&this.openlist.add(h.child1),null!=h.child2&&t.aabbtest(h.child2.aabb)&&(s||0<=(p=t.aabbsect(h.child2.aabb))&&p<t.maxdist)&&this.openlist.add(h.child2))}return this.openlist.clear(),o},Je.prototype.__class__=Je;var $e=zpp_nape.space.ZPP_Island=function(){this.waket=0,this.sleep=!1,this.comps=null,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.comps=new Ei};$e.__name__=["zpp_nape","space","ZPP_Island"],$e.prototype.next=null,$e.prototype.elem=function(){return this},$e.prototype.begin=function(){return this.next},$e.prototype._inuse=null,$e.prototype.modified=null,$e.prototype.pushmod=null,$e.prototype.length=null,$e.prototype.setbegin=function(t){this.next=t,this.modified=!0,this.pushmod=!0},$e.prototype.add=function(t){return t._inuse=!0,t.next=this.next,this.next=t,this.modified=!0,this.length++,t},$e.prototype.inlined_add=function(t){return t._inuse=!0,t.next=this.next,this.next=t,this.modified=!0,this.length++,t},$e.prototype.addAll=function(t){for(var e=t.next;null!=e;)this.add(e),e=e.next},$e.prototype.insert=function(t,e){return e._inuse=!0,null==t?(e.next=this.next,this.next=e):(e.next=t.next,t.next=e),this.pushmod=this.modified=!0,this.length++,e},$e.prototype.inlined_insert=function(t,e){return e._inuse=!0,null==t?(e.next=this.next,this.next=e):(e.next=t.next,t.next=e),this.pushmod=this.modified=!0,this.length++,e},$e.prototype.pop=function(){var t=this.next;this.next=t.next,t._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},$e.prototype.inlined_pop=function(){var t=this.next;this.next=t.next,t._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},$e.prototype.pop_unsafe=function(){var t=this.next;return this.pop(),t},$e.prototype.inlined_pop_unsafe=function(){var t=this.next;return this.pop(),t},$e.prototype.remove=function(t){for(var e,i,n=null,r=this.next;null!=r;){if(r==t){null==n?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},$e.prototype.try_remove=function(t){for(var e=null,i=this.next,n=!1;null!=i;){if(i==t){this.erase(e),n=!0;break}i=(e=i).next}return n},$e.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.next;null!=r;){if(r==t){null==n?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},$e.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.next,s=!1;null!=r;){if(r==t){null==n?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},$e.prototype.erase=function(t){var e,i;return null==t?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=t.next).next,null==(t.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},$e.prototype.inlined_erase=function(t){var e,i;return null==t?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=t.next).next,null==(t.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},$e.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},$e.prototype.clear=function(){},$e.prototype.inlined_clear=function(){},$e.prototype.reverse=function(){for(var t=this.next,e=null;null!=t;){var i=t.next;t.next=e,e=this.next=t,t=i}this.modified=!0,this.pushmod=!0},$e.prototype.empty=function(){return null==this.next},$e.prototype.size=function(){return this.length},$e.prototype.has=function(t){for(var e=!1,i=this.next;null!=i;){if(i==t){e=!0;break}i=i.next}return e},$e.prototype.inlined_has=function(t){for(var e=!1,i=this.next;null!=i;){if(i==t){e=!0;break}i=i.next}return e},$e.prototype.front=function(){return this.next},$e.prototype.back=function(){for(var t=this.next,e=t;null!=e;)e=(t=e).next;return t},$e.prototype.iterator_at=function(t){for(var e=this.next;0<t--&&null!=e;)e=e.next;return e},$e.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t:null},$e.prototype.comps=null,$e.prototype.sleep=null,$e.prototype.waket=null,$e.prototype.free=function(){},$e.prototype.alloc=function(){this.waket=0},$e.prototype.__class__=$e;var ti=zpp_nape.space.ZPP_Component=function(){this.woken=!1,this.waket=0,this.sleeping=!1,this.island=null,this.constraint=null,this.body=null,this.isBody=!1,this.rank=0,this.parent=null,this.next=null,this.sleeping=!1,this.island=null,(this.parent=this).rank=0,this.woken=!1};ti.__name__=["zpp_nape","space","ZPP_Component"],ti.prototype.next=null,ti.prototype.parent=null,ti.prototype.rank=null,ti.prototype.isBody=null,ti.prototype.body=null,ti.prototype.constraint=null,ti.prototype.island=null,ti.prototype.sleeping=null,ti.prototype.waket=null,ti.prototype.woken=null,ti.prototype.free=function(){this.body=null,this.constraint=null},ti.prototype.alloc=function(){},ti.prototype.reset=function(){this.sleeping=!1,this.island=null,(this.parent=this).rank=0},ti.prototype.__class__=ti;var tr=zpp_nape.space.ZPP_CallbackSet=function(){this.lazydel=!1,this.freed=!1,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.int2=null,this.int1=null,this.di=0,this.id=0,this.arbiters=new vi};tr.__name__=["zpp_nape","space","ZPP_CallbackSet"],tr.get=function(t,e){var i;return null==tr.zpp_pool?i=new tr:(i=tr.zpp_pool,tr.zpp_pool=i.next,i.next=null),i.freed=!1,i.lazydel=!1,i.COLLISIONstate=1,i.COLLISIONstamp=0,i.SENSORstate=1,i.SENSORstamp=0,i.FLUIDstate=1,i.FLUIDstamp=0,t.id<e.id?(i.int1=t,i.int2=e):(i.int1=e,i.int2=t),i.id=i.int1.id,i.di=i.int2.id,i},tr.prototype.id=null,tr.prototype.di=null,tr.prototype.int1=null,tr.prototype.int2=null,tr.prototype.arbiters=null,tr.prototype.COLLISIONstate=null,tr.prototype.COLLISIONstamp=null,tr.prototype.SENSORstate=null,tr.prototype.SENSORstamp=null,tr.prototype.FLUIDstate=null,tr.prototype.FLUIDstamp=null,tr.prototype.next=null,tr.prototype.elem=function(){return this},tr.prototype.begin=function(){return this.next},tr.prototype._inuse=null,tr.prototype.modified=null,tr.prototype.pushmod=null,tr.prototype.length=null,tr.prototype.setbegin=function(t){this.next=t,this.modified=!0,this.pushmod=!0},tr.prototype.add=function(t){return t._inuse=!0,t.next=this.next,this.next=t,this.modified=!0,this.length++,t},tr.prototype.inlined_add=function(t){return t._inuse=!0,t.next=this.next,this.next=t,this.modified=!0,this.length++,t},tr.prototype.addAll=function(t){for(var e=t.next;null!=e;)this.add(e),e=e.next},tr.prototype.insert=function(t,e){return e._inuse=!0,null==t?(e.next=this.next,this.next=e):(e.next=t.next,t.next=e),this.pushmod=this.modified=!0,this.length++,e},tr.prototype.inlined_insert=function(t,e){return e._inuse=!0,null==t?(e.next=this.next,this.next=e):(e.next=t.next,t.next=e),this.pushmod=this.modified=!0,this.length++,e},tr.prototype.pop=function(){var t=this.next;this.next=t.next,t._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},tr.prototype.inlined_pop=function(){var t=this.next;this.next=t.next,t._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},tr.prototype.pop_unsafe=function(){var t=this.next;return this.pop(),t},tr.prototype.inlined_pop_unsafe=function(){var t=this.next;return this.pop(),t},tr.prototype.remove=function(t){for(var e,i,n=null,r=this.next;null!=r;){if(r==t){null==n?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},tr.prototype.try_remove=function(t){for(var e=null,i=this.next,n=!1;null!=i;){if(i==t){this.erase(e),n=!0;break}i=(e=i).next}return n},tr.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.next;null!=r;){if(r==t){null==n?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},tr.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.next,s=!1;null!=r;){if(r==t){null==n?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},tr.prototype.erase=function(t){var e,i;return null==t?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=t.next).next,null==(t.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},tr.prototype.inlined_erase=function(t){var e,i;return null==t?(i=(e=this.next).next,this.next=i,null==this.next&&(this.pushmod=!0)):(i=(e=t.next).next,null==(t.next=i)&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},tr.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},tr.prototype.clear=function(){},tr.prototype.inlined_clear=function(){},tr.prototype.reverse=function(){for(var t=this.next,e=null;null!=t;){var i=t.next;t.next=e,e=this.next=t,t=i}this.modified=!0,this.pushmod=!0},tr.prototype.empty=function(){return null==this.next},tr.prototype.size=function(){return this.length},tr.prototype.has=function(t){for(var e=!1,i=this.next;null!=i;){if(i==t){e=!0;break}i=i.next}return e},tr.prototype.inlined_has=function(t){for(var e=!1,i=this.next;null!=i;){if(i==t){e=!0;break}i=i.next}return e},tr.prototype.front=function(){return this.next},tr.prototype.back=function(){for(var t=this.next,e=t;null!=e;)e=(t=e).next;return t},tr.prototype.iterator_at=function(t){for(var e=this.next;0<t--&&null!=e;)e=e.next;return e},tr.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t:null},tr.prototype.freed=null,tr.prototype.lazydel=null,tr.prototype.free=function(){this.int1=this.int2=null,this.id=this.di=-1,this.freed=!0},tr.prototype.alloc=function(){this.freed=!1,this.lazydel=!1,this.COLLISIONstate=1,this.COLLISIONstamp=0,this.SENSORstate=1,this.SENSORstamp=0,this.FLUIDstate=1,this.FLUIDstamp=0},tr.prototype.add_arb=function(t){for(var e=!1,i=this.arbiters.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}if(e)return!1;var n=this.arbiters;null==er.zpp_pool?r=new er:(r=er.zpp_pool,er.zpp_pool=r.next,r.next=null),r.elt=t;var r=r;return r.next=n.head,n.head=r,n.modified=!0,n.length++,!0},tr.prototype.try_remove_arb=function(t){for(var e,i,n=this.arbiters,r=null,s=n.head,o=!1;null!=s;){if(s.elt==t){null==r?(i=(e=n.head).next,n.head=i,null==n.head&&(n.pushmod=!0)):(i=(e=r.next).next,null==(r.next=i)&&(n.pushmod=!0));var a=e;a.elt=null,a.next=er.zpp_pool,er.zpp_pool=a,n.modified=!0,n.length--,o=n.pushmod=!0;break}s=(r=s).next}return o},tr.prototype.remove_arb=function(t){for(var e,i,n=this.arbiters,r=null,s=n.head;null!=s;){if(s.elt==t){null==r?(i=(e=n.head).next,n.head=i,null==n.head&&(n.pushmod=!0)):(i=(e=r.next).next,null==(r.next=i)&&(n.pushmod=!0));var o=e;o.elt=null,o.next=er.zpp_pool,er.zpp_pool=o,n.modified=!0,n.length--,n.pushmod=!0;break}s=(r=s).next}},tr.prototype.empty_arb=function(t){for(var e=!0,i=this.arbiters.head;null!=i;){if(0!=(i.elt.type&t)){e=!1;break}i=i.next}return e},tr.prototype.really_empty=function(){return null==this.arbiters.head},tr.prototype.sleeping=function(){for(var t=!0,e=this.arbiters.head;null!=e;){if(!e.elt.sleeping){t=!1;break}e=e.next}return t},tr.prototype.__class__=tr;var ei=zpp_nape.space.ZPP_CbSetManager=function(t){this.space=null,(this.cbsets=null)==ar.zpp_pool?this.cbsets=new ar:(this.cbsets=ar.zpp_pool,ar.zpp_pool=this.cbsets.next,this.cbsets.next=null),this.cbsets.lt=Hn.setlt,this.space=t};ei.__name__=["zpp_nape","space","ZPP_CbSetManager"],ei.prototype.cbsets=null,ei.prototype.space=null,ei.prototype.get=function(t){if(null==t.head)return null;var e;null==Hn.zpp_pool?e=new Hn:(e=Hn.zpp_pool,Hn.zpp_pool=e.next,e.next=null);var i=e.cbTypes;e.cbTypes=t;var n=this.cbsets.find_weak(e),r=null!=n?n.data:(r=Hn.get(t),this.cbsets.insert(r),r.manager=this,r);e.cbTypes=i;var s=e;for(s.listeners.clear(),s.zip_listeners=!0,s.bodylisteners.clear(),s.zip_bodylisteners=!0,s.conlisteners.clear(),s.zip_conlisteners=!0;null!=s.cbTypes.head;)s.cbTypes.pop_unsafe().cbsets.remove(s);return s.next=Hn.zpp_pool,Hn.zpp_pool=s,r},ei.prototype.remove=function(t){for(this.cbsets.remove(t);null!=t.cbpairs.head;){var e=t.cbpairs.pop_unsafe();e.a!=e.b&&(t==e.a?e.b:e.a).cbpairs.remove(e),e.a=e.b=null,e.listeners.clear(),e.next=qn.zpp_pool,qn.zpp_pool=e}t.manager=null},ei.prototype.clear=function(){},ei.prototype.validate=function(){if(!this.cbsets.empty()){for(var t=this.cbsets.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(t.data.validate(),null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}},ei.prototype.pair=function(t,e){for(var i,n=null,r=(t.cbpairs.length<e.cbpairs.length?t:e).cbpairs.head;null!=r;){var s=r.elt;if(s.a==t&&s.b==e||s.a==e&&s.b==t){n=s;break}r=r.next}return null==n&&(null==qn.zpp_pool?i=new qn:(i=qn.zpp_pool,qn.zpp_pool=i.next,i.next=null),i.zip_listeners=!0,Hn.setlt(t,e)?(i.a=t,i.b=e):(i.a=e,i.b=t),n=i,t.cbpairs.add(n),e!=t&&e.cbpairs.add(n)),n.zip_listeners&&(n.zip_listeners=!1,n.__validate()),n},ei.prototype.valid_listener=function(t){return t.space==this.space},ei.prototype.__class__=ei;var ii=zpp_nape.space.ZPP_Space=function(t,e){this.prelisteners=null,this.precb=null,this.continuous=!1,this.toiEvents=null,this.pre_dt=0,this.convexShapeList=null,this.cbsets=null,this.callbackset_list=null,this.callbacks=null,this.wrap_listeners=null,this.listeners=null,this.islands=null,this.staticsleep=null,this.wrap_livecon=null,this.live_constraints=null,this.wrap_live=null,this.live=null,this.wrap_arbiters=null,this.s_arbiters=null,this.f_arbiters=null,this.c_arbiters_false=null,this.c_arbiters_true=null,this.sortcontacts=!1,this.time=0,this.midstep=!1,this.stamp=0,this.global_ang_drag=0,this.global_lin_drag=0,this.__static=null,this.bphase=null,this.kinematics=null,this.wrap_constraints=null,this.constraints=null,this.wrap_compounds=null,this.compounds=null,this.wrap_bodies=null,this.bodies=null,this.wrap_gravity=null,this.gravityy=0,this.gravityx=0,this.userData=null,this.outer=null,this.toiEvents=new Fi,this.global_lin_drag=.015,this.global_ang_drag=.015,this.precb=new g,this.precb.zpp_inner=new re,this.sortcontacts=!0,this.pre_dt=0,null==e||(null==Yn.Broadphase_DYNAMIC_AABB_TREE&&(Yn.internal=!0,Yn.Broadphase_DYNAMIC_AABB_TREE=new xt,Yn.internal=!1),e==Yn.Broadphase_DYNAMIC_AABB_TREE)?this.bphase=new Je(this):(null==Yn.Broadphase_SWEEP_AND_PRUNE&&(Yn.internal=!0,Yn.Broadphase_SWEEP_AND_PRUNE=new xt,Yn.internal=!1),e==Yn.Broadphase_SWEEP_AND_PRUNE&&(this.bphase=new ri(this))),this.time=0,null!=t?(this.gravityx=t.x,this.gravityy=t.y):(this.gravityx=0,this.gravityy=0),this.bodies=new mi,this.wrap_bodies=wn.get(this.bodies),this.wrap_bodies.zpp_inner.adder=Z(this,this.bodies_adder),this.wrap_bodies.zpp_inner.subber=Z(this,this.bodies_subber),this.compounds=new xi,this.wrap_compounds=Pn.get(this.compounds),this.wrap_compounds.zpp_inner.adder=Z(this,this.compounds_adder),this.wrap_compounds.zpp_inner.subber=Z(this,this.compounds_subber),this.kinematics=new mi,this.c_arbiters_true=new Li,this.c_arbiters_false=new Li,this.f_arbiters=new Ii,this.s_arbiters=new Di,this.islands=new $e,this.live=new mi,this.wrap_live=wn.get(this.live,!0),this.staticsleep=new mi,this.constraints=new Pt,this.wrap_constraints=zn.get(this.constraints),this.wrap_constraints.zpp_inner.adder=Z(this,this.constraints_adder),this.wrap_constraints.zpp_inner.subber=Z(this,this.constraints_subber),this.live_constraints=new Pt,this.wrap_livecon=zn.get(this.live_constraints,!0),this.__static=je.__static(),(this.__static.zpp_inner.space=this).callbacks=new re,this.midstep=!1,this.listeners=new Bi,this.wrap_listeners=Tn.get(this.listeners),this.wrap_listeners.zpp_inner.adder=Z(this,this.listeners_adder),this.wrap_listeners.zpp_inner.subber=Z(this,this.listeners_subber),this.callbackset_list=new tr,this.mrca1=new Tt,this.mrca2=new Tt,this.prelisteners=new gt,this.cbsets=new ei(this)};ii.__name__=["zpp_nape","space","ZPP_Space"],ii.prototype.outer=null,ii.prototype.userData=null,ii.prototype.gravityx=null,ii.prototype.gravityy=null,ii.prototype.wrap_gravity=null,ii.prototype.getgravity=function(){var t,e,i=this.gravityx,n=this.gravityy;null==Rn.poolVec2?t=new Ct:(t=Rn.poolVec2,Rn.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ir.zpp_pool?e=new Ir:(e=Ir.zpp_pool,Ir.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=i,e.y=n,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==i&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==n)||(t.zpp_inner.x=i,t.zpp_inner.y=n,null!=(n=t.zpp_inner)._invalidate&&n._invalidate(n))),t.zpp_inner.weak=!1,this.wrap_gravity=t,this.wrap_gravity.zpp_inner._inuse=!0,this.wrap_gravity.zpp_inner._invalidate=Z(this,this.gravity_invalidate),this.wrap_gravity.zpp_inner._validate=Z(this,this.gravity_validate)},ii.prototype.gravity_invalidate=function(t){this.gravityx=t.x,this.gravityy=t.y;for(var e=new xi,i=this.bodies.head;null!=i;){var n=i.elt;n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!1)),i=i.next}for(var r=this.compounds.head;null!=r;)e.add(r.elt),r=r.next;for(;null!=e.head;){for(var s=e.pop_unsafe(),o=s.bodies.head;null!=o;){var a=o.elt;a.world||(a.component.waket=this.stamp+(this.midstep?0:1),3==a.type&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,!1)),o=o.next}for(var l=s.compounds.head;null!=l;)e.add(l.elt),l=l.next}},ii.prototype.gravity_validate=function(){this.wrap_gravity.zpp_inner.x=this.gravityx,this.wrap_gravity.zpp_inner.y=this.gravityy},ii.prototype.bodies=null,ii.prototype.wrap_bodies=null,ii.prototype.compounds=null,ii.prototype.wrap_compounds=null,ii.prototype.constraints=null,ii.prototype.wrap_constraints=null,ii.prototype.kinematics=null,ii.prototype.bphase=null,ii.prototype.__static=null,ii.prototype.global_lin_drag=null,ii.prototype.global_ang_drag=null,ii.prototype.stamp=null,ii.prototype.midstep=null,ii.prototype.time=null,ii.prototype.sortcontacts=null,ii.prototype.c_arbiters_true=null,ii.prototype.c_arbiters_false=null,ii.prototype.f_arbiters=null,ii.prototype.s_arbiters=null,ii.prototype.wrap_arbiters=null,ii.prototype.live=null,ii.prototype.wrap_live=null,ii.prototype.live_constraints=null,ii.prototype.wrap_livecon=null,ii.prototype.staticsleep=null,ii.prototype.islands=null,ii.prototype.listeners=null,ii.prototype.wrap_listeners=null,ii.prototype.callbacks=null,ii.prototype.callbackset_list=null,ii.prototype.cbsets=null,ii.prototype.clear=function(){for(;null!=this.listeners.head;)this.remListener(this.listeners.pop_unsafe());for(;null!=this.callbackset_list.next;){var t=this.callbackset_list.pop_unsafe();t.arbiters.clear(),t.int1=t.int2=null,t.id=t.di=-1,t.freed=!0,t.next=tr.zpp_pool,tr.zpp_pool=t}for(;null!=this.c_arbiters_true.head;){var e=this.c_arbiters_true.pop_unsafe();if(!e.cleared){for(var i,n,r=e.b1.arbiters,s=null,o=r.head;null!=o;){if(o.elt==e){null==s?(n=(i=r.head).next,r.head=n,null==r.head&&(r.pushmod=!0)):(n=(i=s.next).next,null==(s.next=n)&&(r.pushmod=!0));var a=i;a.elt=null,a.next=er.zpp_pool,er.zpp_pool=a,r.modified=!0,r.length--,r.pushmod=!0;break}o=(s=o).next}for(var l,p,h=e.b2.arbiters,u=null,c=h.head;null!=c;){if(c.elt==e){null==u?(p=(l=h.head).next,h.head=p,null==h.head&&(h.pushmod=!0)):(p=(l=u.next).next,null==(u.next=p)&&(h.pushmod=!0));var d=l;d.elt=null,d.next=er.zpp_pool,er.zpp_pool=d,h.modified=!0,h.length--,h.pushmod=!0;break}c=(u=c).next}null!=e.pair&&(e.pair.arb=null,e.pair=null)}for(e.b1=e.b2=null,e.active=!1,e.intchange=!1;null!=e.contacts.next;){var _=e.contacts,y=_.next;_.pop(),y.arbiter=null,y.next=Qn.zpp_pool,Qn.zpp_pool=y;_=e.innards,y=_.next;_.next=y.next,y._inuse=!1,null==_.next&&(_.pushmod=!0),_.modified=!0,_.length--}e.userdef_dyn_fric=!1,e.userdef_stat_fric=!1,e.userdef_restitution=!1,e.userdef_rfric=!1,e.__ref_edge1=e.__ref_edge2=null,e.next=Jn.zpp_pool,(Jn.zpp_pool=e).pre_dt=-1}for(;null!=this.c_arbiters_false.head;){var f=this.c_arbiters_false.pop_unsafe();if(!f.cleared){for(var m,x,v=f.b1.arbiters,g=null,b=v.head;null!=b;){if(b.elt==f){null==g?(x=(m=v.head).next,v.head=x,null==v.head&&(v.pushmod=!0)):(x=(m=g.next).next,null==(g.next=x)&&(v.pushmod=!0));var z=m;z.elt=null,z.next=er.zpp_pool,er.zpp_pool=z,v.modified=!0,v.length--,v.pushmod=!0;break}b=(g=b).next}for(var w,C,P=f.b2.arbiters,T=null,S=P.head;null!=S;){if(S.elt==f){null==T?(C=(w=P.head).next,P.head=C,null==P.head&&(P.pushmod=!0)):(C=(w=T.next).next,null==(T.next=C)&&(P.pushmod=!0));var M=w;M.elt=null,M.next=er.zpp_pool,er.zpp_pool=M,P.modified=!0,P.length--,P.pushmod=!0;break}S=(T=S).next}null!=f.pair&&(f.pair.arb=null,f.pair=null)}for(f.b1=f.b2=null,f.active=!1,f.intchange=!1;null!=f.contacts.next;){var A=f.contacts,O=A.next;A.pop(),O.arbiter=null,O.next=Qn.zpp_pool,Qn.zpp_pool=O;A=f.innards,O=A.next;A.next=O.next,O._inuse=!1,null==A.next&&(A.pushmod=!0),A.modified=!0,A.length--}f.userdef_dyn_fric=!1,f.userdef_stat_fric=!1,f.userdef_restitution=!1,f.userdef_rfric=!1,f.__ref_edge1=f.__ref_edge2=null,f.next=Jn.zpp_pool,(Jn.zpp_pool=f).pre_dt=-1}for(;null!=this.s_arbiters.head;){var k=this.s_arbiters.pop_unsafe();if(!k.cleared){for(var E,I,D=k.b1.arbiters,B=null,L=D.head;null!=L;){if(L.elt==k){null==B?(I=(E=D.head).next,D.head=I,null==D.head&&(D.pushmod=!0)):(I=(E=B.next).next,null==(B.next=I)&&(D.pushmod=!0));var R=E;R.elt=null,R.next=er.zpp_pool,er.zpp_pool=R,D.modified=!0,D.length--,D.pushmod=!0;break}L=(B=L).next}for(var F,j,N=k.b2.arbiters,G=null,U=N.head;null!=U;){if(U.elt==k){null==G?(j=(F=N.head).next,N.head=j,null==N.head&&(N.pushmod=!0)):(j=(F=G.next).next,null==(G.next=j)&&(N.pushmod=!0));var X=F;X.elt=null,X.next=er.zpp_pool,er.zpp_pool=X,N.modified=!0,N.length--,N.pushmod=!0;break}U=(G=U).next}null!=k.pair&&(k.pair.arb=null,k.pair=null)}k.b1=k.b2=null,k.active=!1,k.intchange=!1,k.next=Kn.zpp_pool,Kn.zpp_pool=k}for(;null!=this.f_arbiters.head;){var V=this.f_arbiters.pop_unsafe();if(!V.cleared){for(var W,H,q=V.b1.arbiters,Y=null,K=q.head;null!=K;){if(K.elt==V){null==Y?(H=(W=q.head).next,q.head=H,null==q.head&&(q.pushmod=!0)):(H=(W=Y.next).next,null==(Y.next=H)&&(q.pushmod=!0));var Z=W;Z.elt=null,Z.next=er.zpp_pool,er.zpp_pool=Z,q.modified=!0,q.length--,q.pushmod=!0;break}K=(Y=K).next}for(var J,Q,$=V.b2.arbiters,tt=null,et=$.head;null!=et;){if(et.elt==V){null==tt?(Q=(J=$.head).next,$.head=Q,null==$.head&&($.pushmod=!0)):(Q=(J=tt.next).next,null==(tt.next=Q)&&($.pushmod=!0));var it=J;it.elt=null,it.next=er.zpp_pool,er.zpp_pool=it,$.modified=!0,$.length--,$.pushmod=!0;break}et=(tt=et).next}null!=V.pair&&(V.pair.arb=null,V.pair=null)}V.b1=V.b2=null,V.active=!1,V.intchange=!1,V.next=Zn.zpp_pool,(Zn.zpp_pool=V).pre_dt=-1}for(this.bphase.clear();null!=this.bodies.head;){var nt=this.bodies.pop_unsafe();if(null!=nt.component){var rt=nt.component.island;if(null!=rt){for(;null!=rt.comps.head;){var st=rt.comps.pop_unsafe();st.sleeping=!1,st.island=null,(st.parent=st).rank=0}rt.next=$e.zpp_pool,$e.zpp_pool=rt}}nt.removedFromSpace(),nt.space=null}for(;null!=this.constraints.head;){var ot=this.constraints.pop_unsafe();if(null!=ot.component){var at=ot.component.island;if(null!=at){for(;null!=at.comps.head;){var lt=at.comps.pop_unsafe();lt.sleeping=!1,lt.island=null,(lt.parent=lt).rank=0}at.next=$e.zpp_pool,$e.zpp_pool=at}}ot.removedFromSpace(),ot.space=null}this.kinematics.clear();for(var pt=new xi;null!=this.compounds.head;)pt.add(this.compounds.pop_unsafe());for(;null!=pt.head;){var ht=pt.pop_unsafe();ht.removedFromSpace(),ht.space=null;for(var ut=ht.bodies.head;null!=ut;){var ct=ut.elt;if(null!=ct.component){var dt=ct.component.island;if(null!=dt){for(;null!=dt.comps.head;){var _t=dt.comps.pop_unsafe();_t.sleeping=!1,_t.island=null,(_t.parent=_t).rank=0}dt.next=$e.zpp_pool,$e.zpp_pool=dt}}ct.removedFromSpace(),ct.space=null,ut=ut.next}for(var yt=ht.constraints.head;null!=yt;){var ft=yt.elt;if(null!=ft.component){var mt=ft.component.island;if(null!=mt){for(;null!=mt.comps.head;){var xt=mt.comps.pop_unsafe();xt.sleeping=!1,xt.island=null,(xt.parent=xt).rank=0}mt.next=$e.zpp_pool,$e.zpp_pool=mt}}ft.removedFromSpace(),ft.space=null,yt=yt.next}for(var vt=ht.compounds.head;null!=vt;)pt.add(vt.elt),vt=vt.next}this.staticsleep.clear(),this.live.clear(),this.live_constraints.clear(),this.stamp=0,this.time=0,this.mrca1.clear(),this.mrca2.clear(),this.prelisteners.clear(),this.cbsets.clear()},ii.prototype.bodies_adder=function(t){return t.zpp_inner.space!=this&&(null!=t.zpp_inner.space&&t.zpp_inner.space.outer.zpp_inner.wrap_bodies.remove(t),this.addBody(t.zpp_inner),!0)},ii.prototype.bodies_subber=function(t){this.remBody(t.zpp_inner)},ii.prototype.compounds_adder=function(t){return t.zpp_inner.space!=this&&(null!=t.zpp_inner.space&&t.zpp_inner.space.wrap_compounds.remove(t),this.addCompound(t.zpp_inner),!0)},ii.prototype.compounds_subber=function(t){this.remCompound(t.zpp_inner)},ii.prototype.constraints_adder=function(t){return t.zpp_inner.space!=this&&(null!=t.zpp_inner.space&&t.zpp_inner.space.outer.zpp_inner.wrap_constraints.remove(t),this.addConstraint(t.zpp_inner),!0)},ii.prototype.constraints_subber=function(t){this.remConstraint(t.zpp_inner)},ii.prototype.listeners_adder=function(t){return t.zpp_inner.space!=this&&(null!=t.zpp_inner.space&&t.zpp_inner.space.outer.zpp_inner.wrap_listeners.remove(t),this.addListener(t.zpp_inner),!0)},ii.prototype.listeners_subber=function(t){this.remListener(t.zpp_inner)},ii.prototype.revoke_listener=function(t){},ii.prototype.unrevoke_listener=function(t){},ii.prototype.addListener=function(t){t.space=this,t.addedToSpace()},ii.prototype.remListener=function(t){t.removedFromSpace(),t.space=null},ii.prototype.add_callbackset=function(t){var e=t.int1.cbsets;null==Xi.zpp_pool?i=new Xi:(i=Xi.zpp_pool,Xi.zpp_pool=i.next,i.next=null),i.elt=t;var i=i;i.next=e.head,e.head=i,e.modified=!0,e.length++;e=t.int2.cbsets;null==Xi.zpp_pool?n=new Xi:(n=Xi.zpp_pool,Xi.zpp_pool=n.next,n.next=null),n.elt=t;var n=n;n.next=e.head,e.head=n,e.modified=!0,e.length++;e=this.callbackset_list;t._inuse=!0,t.next=e.next,e.next=t,e.modified=!0,e.length++},ii.prototype.remove_callbackset=function(t){t.lazydel=!0;for(var e,i,n=t.int1.cbsets,r=null,s=n.head;null!=s;){if(s.elt==t){null==r?(i=(e=n.head).next,n.head=i,null==n.head&&(n.pushmod=!0)):(i=(e=r.next).next,null==(r.next=i)&&(n.pushmod=!0));var o=e;o.elt=null,o.next=Xi.zpp_pool,Xi.zpp_pool=o,n.modified=!0,n.length--,n.pushmod=!0;break}s=(r=s).next}for(var a,l,p=t.int2.cbsets,h=null,u=p.head;null!=u;){if(u.elt==t){null==h?(l=(a=p.head).next,p.head=l,null==p.head&&(p.pushmod=!0)):(l=(a=h.next).next,null==(h.next=l)&&(p.pushmod=!0));var c=a;c.elt=null,c.next=Xi.zpp_pool,Xi.zpp_pool=c,p.modified=!0,p.length--,p.pushmod=!0;break}u=(h=u).next}},ii.prototype.transmitType=function(t,e){t.world||(t.component.waket=this.stamp+(this.midstep?0:1),3==t.type&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,!1)),2==t.type?this.live.remove(t):3==t.type?(this.kinematics.remove(t),this.staticsleep.remove(t)):1==t.type&&this.staticsleep.remove(t),t.type=e,3==t.type&&this.kinematics.add(t),1==t.type&&this.static_validation(t),t.component.sleeping=!0,t.world||(t.component.waket=this.stamp+(this.midstep?0:1),3==t.type&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,!0))},ii.prototype.added_shape=function(t,e){null==e&&(e=!1),e||((e=t.body).world||(e.component.waket=this.stamp+(this.midstep?0:1),3==e.type&&(e.kinematicDelaySleep=!0),e.component.sleeping&&this.really_wake(e,!1))),this.bphase.insert(t),t.addedToSpace()},ii.prototype.removed_shape=function(t,e){null==e&&(e=!1);var i=t.body;e||i.wake();for(var n=null,r=i.arbiters.head;null!=r;){var s,o=r.elt;if(o.ws1!=t&&o.ws2!=t)r=(n=r).next;else{if(0!=o.present){this.MRCA_chains(o.ws1,o.ws2);for(var a=this.mrca1.head;null!=a;){for(var l=a.elt,p=this.mrca2.head;null!=p;){var h=p.elt,u=l.cbSet,c=h.cbSet;u.validate(),c.validate();for(var d,_=null,y=(u.cbpairs.length<c.cbpairs.length?u:c).cbpairs.head;null!=y;){var f=y.elt;if(f.a==u&&f.b==c||f.a==c&&f.b==u){_=f;break}y=y.next}if(null==_&&(null==qn.zpp_pool?d=new qn:(d=qn.zpp_pool,qn.zpp_pool=d.next,d.next=null),d.zip_listeners=!0,Hn.setlt(u,c)?(d.a=u,d.b=c):(d.a=c,d.b=u),_=d,u.cbpairs.add(_),c!=u&&c.cbpairs.add(_)),_.zip_listeners&&(_.zip_listeners=!1,_.__validate()),null!=_.listeners.head){var m=$n.get(l,h);m.remove_arb(o),o.present--;for(var x,v=null,g=(u.cbpairs.length<c.cbpairs.length?u:c).cbpairs.head;null!=g;){var b=g.elt;if(b.a==u&&b.b==c||b.a==c&&b.b==u){v=b;break}g=g.next}null==v&&(null==qn.zpp_pool?x=new qn:(x=qn.zpp_pool,qn.zpp_pool=x.next,x.next=null),x.zip_listeners=!0,Hn.setlt(u,c)?(x.a=u,x.b=c):(x.a=c,x.b=u),v=x,u.cbpairs.add(v),c!=u&&c.cbpairs.add(v)),v.zip_listeners&&(v.zip_listeners=!1,v.__validate());for(var z=v.listeners.head;null!=z;){var w,C,P,T,S,M=z.elt;1==M.event&&0!=(M.itype&o.type)&&m.empty_arb(M.itype)&&((w=this.push_callback(M)).event=1,C=m.int1,P=m.int2,S=M.options1,T=C.cbTypes,!(!S.nonemptyintersection(T,S.includes)||S.nonemptyintersection(T,S.excludes))&&(S=M.options2,M=P.cbTypes,!!S.nonemptyintersection(M,S.includes)&&!S.nonemptyintersection(M,S.excludes))?(w.int1=C,w.int2=P):(w.int1=P,w.int2=C),w.set=m),z=z.next}null==m.arbiters.head&&this.remove_callbackset(m),p=p.next}else p=p.next}a=a.next}}if(o.b1!=i&&2==o.b1.type&&((s=o.b1).world||(s.component.waket=this.stamp+(this.midstep?0:1),3==s.type&&(s.kinematicDelaySleep=!0),s.component.sleeping&&this.really_wake(s,!1))),o.b2!=i&&2==o.b2.type&&((s=o.b2).world||(s.component.waket=this.stamp+(this.midstep?0:1),3==s.type&&(s.kinematicDelaySleep=!0),s.component.sleeping&&this.really_wake(s,!1))),o.cleared=!0,null==i||o.b2==i)for(var A,O,k=o.b1.arbiters,E=null,I=k.head;null!=I;){if(I.elt==o){null==E?(O=(A=k.head).next,k.head=O,null==k.head&&(k.pushmod=!0)):(O=(A=E.next).next,null==(E.next=O)&&(k.pushmod=!0));var D=A;D.elt=null,D.next=er.zpp_pool,er.zpp_pool=D,k.modified=!0,k.length--,k.pushmod=!0;break}I=(E=I).next}if(null==i||o.b1==i)for(var B,L,R=o.b2.arbiters,F=null,j=R.head;null!=j;){if(j.elt==o){null==F?(L=(B=R.head).next,R.head=L,null==R.head&&(R.pushmod=!0)):(L=(B=F.next).next,null==(F.next=L)&&(R.pushmod=!0));var N=B;N.elt=null,N.next=er.zpp_pool,er.zpp_pool=N,R.modified=!0,R.length--,R.pushmod=!0;break}j=(F=j).next}null!=o.pair&&(o.pair.arb=null,o.pair=null),o.active=!1,this.f_arbiters.modified=!0,r=i.arbiters.erase(n)}}this.bphase.remove(t),t.removedFromSpace()},ii.prototype.addConstraint=function(t){t.space=this,t.addedToSpace(),t.active&&(t.component.sleeping=!0,this.wake_constraint(t,!0))},ii.prototype.remConstraint=function(t){t.active&&(this.wake_constraint(t,!0),this.live_constraints.remove(t)),t.removedFromSpace(),t.space=null},ii.prototype.addCompound=function(t){t.space=this,t.addedToSpace();for(var e=t.bodies.head;null!=e;)this.addBody(e.elt),e=e.next;for(var i=t.constraints.head;null!=i;)this.addConstraint(i.elt),i=i.next;for(var n=t.compounds.head;null!=n;)this.addCompound(n.elt),n=n.next},ii.prototype.remCompound=function(t){for(var e=t.bodies.head;null!=e;)this.remBody(e.elt),e=e.next;for(var i=t.constraints.head;null!=i;)this.remConstraint(i.elt),i=i.next;for(var n=t.compounds.head;null!=n;)this.remCompound(n.elt),n=n.next;t.removedFromSpace(),t.space=null},ii.prototype.addBody=function(t,e){null==e&&(e=-1),t.space=this,t.addedToSpace(),t.component.sleeping=!0,t.world||(t.component.waket=this.stamp+(this.midstep?0:1),3==t.type&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,!0));for(var i=t.shapes.head;null!=i;){var n=i.elt;this.bphase.insert(n),n.addedToSpace(),i=i.next}1==t.type?this.static_validation(t):2!=t.type&&3!=e&&this.kinematics.add(t)},ii.prototype.remBody=function(t,e){null==e&&(e=-1),1==t.type?(t.world||(t.component.waket=this.stamp+(this.midstep?0:1),3==t.type&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,!0)),this.staticsleep.remove(t)):2==t.type?(t.world||(t.component.waket=this.stamp+(this.midstep?0:1),3==t.type&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,!0)),this.live.remove(t)):(3!=e&&this.kinematics.remove(t),t.world||(t.component.waket=this.stamp+(this.midstep?0:1),3==t.type&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,!0)),this.staticsleep.remove(t));for(var i=t.shapes.head;null!=i;)this.removed_shape(i.elt,!0),i=i.next;t.removedFromSpace(),t.space=null},ii.prototype.shapesUnderPoint=function(t,e,i,n){return this.bphase.shapesUnderPoint(t,e,i,n)},ii.prototype.bodiesUnderPoint=function(t,e,i,n){return this.bphase.bodiesUnderPoint(t,e,i,n)},ii.prototype.shapesInAABB=function(t,e,i,n,r){return this.bphase.shapesInAABB(t.zpp_inner,e,i,n,r)},ii.prototype.bodiesInAABB=function(t,e,i,n,r){return this.bphase.bodiesInAABB(t.zpp_inner,e,i,n,r)},ii.prototype.shapesInCircle=function(t,e,i,n,r){var s=t.zpp_inner;null!=s._validate&&s._validate();var o=t.zpp_inner.x,s=t.zpp_inner;return null!=s._validate&&s._validate(),this.bphase.shapesInCircle(o,t.zpp_inner.y,e,i,n,r)},ii.prototype.bodiesInCircle=function(t,e,i,n,r){var s=t.zpp_inner;null!=s._validate&&s._validate();var o=t.zpp_inner.x,s=t.zpp_inner;return null!=s._validate&&s._validate(),this.bphase.bodiesInCircle(o,t.zpp_inner.y,e,i,n,r)},ii.prototype.shapesInShape=function(t,e,i,n){return this.bphase.shapesInShape(t,e,i,n)},ii.prototype.bodiesInShape=function(t,e,i,n){return this.bphase.bodiesInShape(t,e,i,n)},ii.prototype.rayCast=function(t,e,i){return this.bphase.rayCast(t.zpp_inner,e,null==i?null:i.zpp_inner)},ii.prototype.rayMultiCast=function(t,e,i,n){return this.bphase.rayMultiCast(t.zpp_inner,e,null==i?null:i.zpp_inner,n)},ii.prototype.convexShapeList=null,ii.prototype.convexCast=function(t,e,i,n){var r;if(null==Ee.zpp_pool?r=new Ee:(r=Ee.zpp_pool,Ee.zpp_pool=r.next,r.next=null),r.failed=!1,r.s1=r.s2=null,r.arbiter=null,0==t.type){var s=t.circle;if(s.zip_worldCOM&&null!=s.body){if(s.zip_worldCOM=!1,s.zip_localCOM){if(s.zip_localCOM=!1,1==s.type){var o=s.polygon;if(null==o.lverts.next.next)o.localCOMx=o.lverts.next.x,o.localCOMy=o.lverts.next.y;else if(null==o.lverts.next.next.next)o.localCOMx=o.lverts.next.x,o.localCOMy=o.lverts.next.y,o.localCOMx+=o.lverts.next.next.x,o.localCOMy+=o.lverts.next.next.y,o.localCOMx*=.5,o.localCOMy*=.5;else{o.localCOMx=0;var a=o.localCOMy=0,l=o.lverts.next,p=l,h=l=l.next;for(l=l.next;null!=l;){var u=l;a+=h.x*(u.y-p.y);var c=u.y*h.x-u.x*h.y;o.localCOMx+=(h.x+u.x)*c,o.localCOMy+=(h.y+u.y)*c,p=h,h=u,l=l.next}var d=l=o.lverts.next;a+=h.x*(d.y-p.y);var _=d.y*h.x-d.x*h.y;o.localCOMx+=(h.x+d.x)*_,o.localCOMy+=(h.y+d.y)*_,p=h;var y=l=l.next;a+=d.x*(y.y-p.y);_=y.y*d.x-y.x*d.y;o.localCOMx+=(d.x+y.x)*_,o.localCOMy+=(d.y+y.y)*_;_=a=1/(3*a);o.localCOMx*=_,o.localCOMy*=_}}null!=s.wrap_localCOM&&(s.wrap_localCOM.zpp_inner.x=s.localCOMx,s.wrap_localCOM.zpp_inner.y=s.localCOMy)}_=s.body;_.zip_axis&&(_.zip_axis=!1,_.axisx=Math.sin(_.rot),_.axisy=Math.cos(_.rot)),s.worldCOMx=s.body.posx+(s.body.axisy*s.localCOMx-s.body.axisx*s.localCOMy),s.worldCOMy=s.body.posy+(s.localCOMx*s.body.axisx+s.localCOMy*s.body.axisy)}}else{var f=t.polygon;if(f.zip_gaxi&&null!=f.body){f.zip_gaxi=!1,f.validate_laxi();var m=f.body;if(m.zip_axis&&(m.zip_axis=!1,m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot)),f.zip_gverts&&null!=f.body){f.zip_gverts=!1,f.validate_lverts();var x=f.body;x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot));for(var v=f.lverts.next,g=f.gverts.next;null!=g;){var b=g,z=v,v=v.next;b.x=f.body.posx+(f.body.axisy*z.x-f.body.axisx*z.y),b.y=f.body.posy+(z.x*f.body.axisx+z.y*f.body.axisy),g=g.next}}for(var w=f.edges.head,C=P=f.gverts.next,P=P.next;null!=P;){var T=P,S=w.elt,w=w.next;S.gp0=C,S.gp1=T,S.gnormx=f.body.axisy*S.lnormx-f.body.axisx*S.lnormy,S.gnormy=S.lnormx*f.body.axisx+S.lnormy*f.body.axisy,S.gprojection=f.body.posx*S.gnormx+f.body.posy*S.gnormy+S.lprojection,null!=S.wrap_gnorm&&(S.wrap_gnorm.zpp_inner.x=S.gnormx,S.wrap_gnorm.zpp_inner.y=S.gnormy),S.tp0=S.gp0.y*S.gnormx-S.gp0.x*S.gnormy,S.tp1=S.gp1.y*S.gnormx-S.gp1.x*S.gnormy,C=T,P=P.next}var M=w.elt;M.gp0=C,M.gp1=f.gverts.next,M.gnormx=f.body.axisy*M.lnormx-f.body.axisx*M.lnormy,M.gnormy=M.lnormx*f.body.axisx+M.lnormy*f.body.axisy,M.gprojection=f.body.posx*M.gnormx+f.body.posy*M.gnormy+M.lprojection,null!=M.wrap_gnorm&&(M.wrap_gnorm.zpp_inner.x=M.gnormx,M.wrap_gnorm.zpp_inner.y=M.gnormy),M.tp0=M.gp0.y*M.gnormx-M.gp0.x*M.gnormy,M.tp1=M.gp1.y*M.gnormx-M.gp1.x*M.gnormy}}var A=t.body,m=A.posx,x=A.posy;A.sweepTime=0,A.sweep_angvel=A.angvel;M=e-A.sweepTime;0!=M&&(A.sweepTime=e,A.posx+=A.velx*M,A.posy+=A.vely*M,0!=A.angvel&&(O=A.sweep_angvel*M,A.rot+=O,1e-4<O*O?(A.axisx=Math.sin(A.rot),A.axisy=Math.cos(A.rot)):(k=1-(E=O*O)*E/8,E=((M=1-.5*E)*A.axisx+O*A.axisy)*k,A.axisy=(M*A.axisy-O*A.axisx)*k,A.axisx=E)));var O=A.posx,k=A.posy;t.validate_sweepRadius();var E=t.sweepRadius;null==Be.zpp_pool?it=new Be:(it=Be.zpp_pool,Be.zpp_pool=it.next,it.next=null),it.minx=(m<O?m:O)-E,it.maxx=(O<m?m:O)+E,it.miny=(x<k?x:k)-E,it.maxy=(k<x?x:k)+E;k=this.convexShapeList=this.bphase.shapesInAABB(it,!1,!1,null==i?null:i.zpp_inner,this.convexShapeList),E=it;null!=E.outer&&(E.outer.zpp_inner=null,E.outer=null),E.wrap_min=E.wrap_max=null,E._invalidate=null,E._validate=null,E.next=Be.zpp_pool,Be.zpp_pool=E;var I=0,D=0,I=0,D=0,B=0,L=0,B=0,L=0,R=null,F=e+1;k.zpp_inner.valmod();for(var j=ne.get(k);;){j.zpp_inner.zpp_inner.valmod();var N=j.zpp_inner;N.zpp_inner.valmod(),N.zpp_inner.zip_length&&(N.zpp_inner.zip_length=!1,N.zpp_inner.user_length=N.zpp_inner.inner.length);var G=N.zpp_inner.user_length;if(j.zpp_critical=!0,!(j.zpp_i<G||(j.zpp_next=ne.zpp_pool,(ne.zpp_pool=j).zpp_inner=null,!1)))break;j.zpp_critical=!1;var U=j.zpp_inner.at(j.zpp_i++);if(U!=t.outer&&(null!=U.zpp_inner.body?U.zpp_inner.body.outer:null)!=A.outer){if(r.s1=t,r.s2=U.zpp_inner,n){U.zpp_inner.validate_sweepRadius(),(null!=U.zpp_inner.body?U.zpp_inner.body.outer:null).zpp_inner.sweep_angvel=(null!=U.zpp_inner.body?U.zpp_inner.body.outer:null).zpp_inner.angvel,(null!=U.zpp_inner.body?U.zpp_inner.body.outer:null).zpp_inner.sweepTime=0,Ie.dynamicSweep(r,e,0,0,!0);var X=(null!=U.zpp_inner.body?U.zpp_inner.body.outer:null).zpp_inner,V=0-X.sweepTime;0!=V&&(X.sweepTime=0,X.posx+=X.velx*V,X.posy+=X.vely*V,0!=X.angvel&&(N=X.sweep_angvel*V,X.rot+=N,1e-4<N*N?(X.axisx=Math.sin(X.rot),X.axisy=Math.cos(X.rot)):(G=1-(H=N*N)*H/8,H=((V=1-.5*H)*X.axisx+N*X.axisy)*G,X.axisy=(V*X.axisy-N*X.axisx)*G,X.axisx=H)));var W=(null!=U.zpp_inner.body?U.zpp_inner.body.outer:null).zpp_inner,X=U.zpp_inner;if(0==X.type)X.worldCOMx=W.posx+(W.axisy*X.localCOMx-W.axisx*X.localCOMy),X.worldCOMy=W.posy+(X.localCOMx*W.axisx+X.localCOMy*W.axisy);else{for(var H=X.polygon,q=H.lverts.next,Y=H.gverts.next;null!=Y;){var K=Y,Z=q,q=q.next;K.x=W.posx+(W.axisy*Z.x-W.axisx*Z.y),K.y=W.posy+(Z.x*W.axisx+Z.y*W.axisy),Y=Y.next}for(var J=H.edges.head,Q=$=H.gverts.next,$=$.next;null!=$;){var tt=$,et=J.elt,J=J.next;et.gnormx=W.axisy*et.lnormx-W.axisx*et.lnormy,et.gnormy=et.lnormx*W.axisx+et.lnormy*W.axisy,et.gprojection=W.posx*et.gnormx+W.posy*et.gnormy+et.lprojection,et.tp0=Q.y*et.gnormx-Q.x*et.gnormy,et.tp1=tt.y*et.gnormx-tt.x*et.gnormy,Q=tt,$=$.next}X=H.gverts.next,H=J.elt;H.gnormx=W.axisy*H.lnormx-W.axisx*H.lnormy,H.gnormy=H.lnormx*W.axisx+H.lnormy*W.axisy,H.gprojection=W.posx*H.gnormx+W.posy*H.gnormy+H.lprojection,H.tp0=Q.y*H.gnormx-Q.x*H.gnormy,H.tp1=X.y*H.gnormx-X.x*H.gnormy}}else Ie.staticSweep(r,e,0,0);r.toi*=e,0<r.toi&&r.toi<F&&(F=r.toi,I=r.axis.x,D=r.axis.y,B=r.c2.x,L=r.c2.y,R=U)}}k.clear();i=r;i.next=Ee.zpp_pool,Ee.zpp_pool=i;var it=0-A.sweepTime;if(0!=it&&(A.sweepTime=0,A.posx+=A.velx*it,A.posy+=A.vely*it,0!=A.angvel&&(E=A.sweep_angvel*it,A.rot+=E,1e-4<E*E?(A.axisx=Math.sin(A.rot),A.axisy=Math.cos(A.rot)):(i=1-(k=E*E)*k/8,k=((it=1-.5*k)*A.axisx+E*A.axisy)*i,A.axisy=(it*A.axisy-E*A.axisx)*i,A.axisx=k))),0==t.type)t.worldCOMx=A.posx+(A.axisy*t.localCOMx-A.axisx*t.localCOMy),t.worldCOMy=A.posy+(t.localCOMx*A.axisx+t.localCOMy*A.axisy);else{for(var nt=t.polygon,rt=nt.lverts.next,st=nt.gverts.next;null!=st;){var ot=st,at=rt,rt=rt.next;ot.x=A.posx+(A.axisy*at.x-A.axisx*at.y),ot.y=A.posy+(at.x*A.axisx+at.y*A.axisy),st=st.next}for(var lt=nt.edges.head,pt=ht=nt.gverts.next,ht=ht.next;null!=ht;){var ut=ht,ct=lt.elt,lt=lt.next;ct.gnormx=A.axisy*ct.lnormx-A.axisx*ct.lnormy,ct.gnormy=ct.lnormx*A.axisx+ct.lnormy*A.axisy,ct.gprojection=A.posx*ct.gnormx+A.posy*ct.gnormy+ct.lprojection,ct.tp0=pt.y*ct.gnormx-pt.x*ct.gnormy,ct.tp1=ut.y*ct.gnormx-ut.x*ct.gnormy,pt=ut,ht=ht.next}var dt=nt.gverts.next,nt=lt.elt;nt.gnormx=A.axisy*nt.lnormx-A.axisx*nt.lnormy,nt.gnormy=nt.lnormx*A.axisx+nt.lnormy*A.axisy,nt.gprojection=A.posx*nt.gnormx+A.posy*nt.gnormy+nt.lprojection,nt.tp0=pt.y*nt.gnormx-pt.x*nt.gnormy,nt.tp1=dt.y*nt.gnormx-dt.x*nt.gnormy}if(F<=e){var _t,dt=-I,nt=-D;null==Rn.poolVec2?xt=new Ct:(xt=Rn.poolVec2,Rn.poolVec2=xt.zpp_pool,xt.zpp_pool=null),null==xt.zpp_inner?(null==Ir.zpp_pool?_t=new Ir:(_t=Ir.zpp_pool,Ir.zpp_pool=_t.next,_t.next=null),_t.weak=!1,_t._immutable=!1,_t.x=dt,_t.y=nt,xt.zpp_inner=_t,xt.zpp_inner.outer=xt):(null!=(_t=xt.zpp_inner)._validate&&_t._validate(),xt.zpp_inner.x==dt&&(null!=(_t=xt.zpp_inner)._validate&&_t._validate(),xt.zpp_inner.y==nt)||(xt.zpp_inner.x=dt,xt.zpp_inner.y=nt,null!=(nt=xt.zpp_inner)._invalidate&&nt._invalidate(nt))),xt.zpp_inner.weak=!1;var yt,ft,mt,xt=xt;return null==Rn.poolVec2?yt=new Ct:(yt=Rn.poolVec2,Rn.poolVec2=yt.zpp_pool,yt.zpp_pool=null),null==yt.zpp_inner?(null==Ir.zpp_pool?ft=new Ir:(ft=Ir.zpp_pool,Ir.zpp_pool=ft.next,ft.next=null),ft.weak=!1,ft._immutable=!1,ft.x=B,ft.y=L,yt.zpp_inner=ft,yt.zpp_inner.outer=yt):(null!=(ft=yt.zpp_inner)._validate&&ft._validate(),yt.zpp_inner.x==B&&(null!=(mt=yt.zpp_inner)._validate&&mt._validate(),yt.zpp_inner.y==L)||(yt.zpp_inner.x=B,yt.zpp_inner.y=L,null!=(mt=yt.zpp_inner)._invalidate&&mt._invalidate(mt))),yt.zpp_inner.weak=!1,de.getConvex(xt,yt,F,R)}return null},ii.prototype.prepareCast=function(t){if(0==t.type){var e=t.circle;if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,1==e.type){var i=e.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y,i.localCOMx+=i.lverts.next.next.x,i.localCOMy+=i.lverts.next.next.y,i.localCOMx*=.5,i.localCOMy*=.5;else{i.localCOMx=0;var n=i.localCOMy=0,r=i.lverts.next,s=r,o=r=r.next;for(r=r.next;null!=r;){var a=r;n+=o.x*(a.y-s.y);var l=a.y*o.x-a.x*o.y;i.localCOMx+=(o.x+a.x)*l,i.localCOMy+=(o.y+a.y)*l,s=o,o=a,r=r.next}var p=r=i.lverts.next;n+=o.x*(p.y-s.y);var h=p.y*o.x-p.x*o.y;i.localCOMx+=(o.x+p.x)*h,i.localCOMy+=(o.y+p.y)*h,s=o;var u=r=r.next;n+=p.x*(u.y-s.y);h=u.y*p.x-u.x*p.y;i.localCOMx+=(p.x+u.x)*h,i.localCOMy+=(p.y+u.y)*h;h=n=1/(3*n);i.localCOMx*=h,i.localCOMy*=h}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}h=e.body;h.zip_axis&&(h.zip_axis=!1,h.axisx=Math.sin(h.rot),h.axisy=Math.cos(h.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}}else{var c=t.polygon;if(c.zip_gaxi&&null!=c.body){c.zip_gaxi=!1,c.validate_laxi();t=c.body;if(t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),c.zip_gverts&&null!=c.body){c.zip_gverts=!1,c.validate_lverts();var d=c.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot));for(var _=c.lverts.next,y=c.gverts.next;null!=y;){var f=y,m=_,_=_.next;f.x=c.body.posx+(c.body.axisy*m.x-c.body.axisx*m.y),f.y=c.body.posy+(m.x*c.body.axisx+m.y*c.body.axisy),y=y.next}}for(var x=c.edges.head,v=g=c.gverts.next,g=g.next;null!=g;){var b=g,z=x.elt,x=x.next;z.gp0=v,z.gp1=b,z.gnormx=c.body.axisy*z.lnormx-c.body.axisx*z.lnormy,z.gnormy=z.lnormx*c.body.axisx+z.lnormy*c.body.axisy,z.gprojection=c.body.posx*z.gnormx+c.body.posy*z.gnormy+z.lprojection,null!=z.wrap_gnorm&&(z.wrap_gnorm.zpp_inner.x=z.gnormx,z.wrap_gnorm.zpp_inner.y=z.gnormy),z.tp0=z.gp0.y*z.gnormx-z.gp0.x*z.gnormy,z.tp1=z.gp1.y*z.gnormx-z.gp1.x*z.gnormy,v=b,g=g.next}d=x.elt;d.gp0=v,d.gp1=c.gverts.next,d.gnormx=c.body.axisy*d.lnormx-c.body.axisx*d.lnormy,d.gnormy=d.lnormx*c.body.axisx+d.lnormy*c.body.axisy,d.gprojection=c.body.posx*d.gnormx+c.body.posy*d.gnormy+d.lprojection,null!=d.wrap_gnorm&&(d.wrap_gnorm.zpp_inner.x=d.gnormx,d.wrap_gnorm.zpp_inner.y=d.gnormy),d.tp0=d.gp0.y*d.gnormx-d.gp0.x*d.gnormy,d.tp1=d.gp1.y*d.gnormx-d.gp1.x*d.gnormy}}},ii.prototype.convexMultiCast=function(t,e,i,n,r){var s;if(null==Ee.zpp_pool?s=new Ee:(s=Ee.zpp_pool,Ee.zpp_pool=s.next,s.next=null),s.failed=!1,s.s1=s.s2=null,s.arbiter=null,0==t.type){var o=t.circle;if(o.zip_worldCOM&&null!=o.body){if(o.zip_worldCOM=!1,o.zip_localCOM){if(o.zip_localCOM=!1,1==o.type){var a=o.polygon;if(null==a.lverts.next.next)a.localCOMx=a.lverts.next.x,a.localCOMy=a.lverts.next.y;else if(null==a.lverts.next.next.next)a.localCOMx=a.lverts.next.x,a.localCOMy=a.lverts.next.y,a.localCOMx+=a.lverts.next.next.x,a.localCOMy+=a.lverts.next.next.y,a.localCOMx*=.5,a.localCOMy*=.5;else{a.localCOMx=0;var l=a.localCOMy=0,p=a.lverts.next,h=p,u=p=p.next;for(p=p.next;null!=p;){var c=p;l+=u.x*(c.y-h.y);var d=c.y*u.x-c.x*u.y;a.localCOMx+=(u.x+c.x)*d,a.localCOMy+=(u.y+c.y)*d,h=u,u=c,p=p.next}var _=p=a.lverts.next;l+=u.x*(_.y-h.y);var y=_.y*u.x-_.x*u.y;a.localCOMx+=(u.x+_.x)*y,a.localCOMy+=(u.y+_.y)*y,h=u;var f=p=p.next;l+=_.x*(f.y-h.y);y=f.y*_.x-f.x*_.y;a.localCOMx+=(_.x+f.x)*y,a.localCOMy+=(_.y+f.y)*y;y=l=1/(3*l);a.localCOMx*=y,a.localCOMy*=y}}null!=o.wrap_localCOM&&(o.wrap_localCOM.zpp_inner.x=o.localCOMx,o.wrap_localCOM.zpp_inner.y=o.localCOMy)}y=o.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot)),o.worldCOMx=o.body.posx+(o.body.axisy*o.localCOMx-o.body.axisx*o.localCOMy),o.worldCOMy=o.body.posy+(o.localCOMx*o.body.axisx+o.localCOMy*o.body.axisy)}}else{var m=t.polygon;if(m.zip_gaxi&&null!=m.body){m.zip_gaxi=!1,m.validate_laxi();var x=m.body;if(x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot)),m.zip_gverts&&null!=m.body){m.zip_gverts=!1,m.validate_lverts();var v=m.body;v.zip_axis&&(v.zip_axis=!1,v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot));for(var g=m.lverts.next,b=m.gverts.next;null!=b;){var z=b,w=g,g=g.next;z.x=m.body.posx+(m.body.axisy*w.x-m.body.axisx*w.y),z.y=m.body.posy+(w.x*m.body.axisx+w.y*m.body.axisy),b=b.next}}for(var C=m.edges.head,P=T=m.gverts.next,T=T.next;null!=T;){var S=T,M=C.elt,C=C.next;M.gp0=P,M.gp1=S,M.gnormx=m.body.axisy*M.lnormx-m.body.axisx*M.lnormy,M.gnormy=M.lnormx*m.body.axisx+M.lnormy*m.body.axisy,M.gprojection=m.body.posx*M.gnormx+m.body.posy*M.gnormy+M.lprojection,null!=M.wrap_gnorm&&(M.wrap_gnorm.zpp_inner.x=M.gnormx,M.wrap_gnorm.zpp_inner.y=M.gnormy),M.tp0=M.gp0.y*M.gnormx-M.gp0.x*M.gnormy,M.tp1=M.gp1.y*M.gnormx-M.gp1.x*M.gnormy,P=S,T=T.next}var A=C.elt;A.gp0=P,A.gp1=m.gverts.next,A.gnormx=m.body.axisy*A.lnormx-m.body.axisx*A.lnormy,A.gnormy=A.lnormx*m.body.axisx+A.lnormy*m.body.axisy,A.gprojection=m.body.posx*A.gnormx+m.body.posy*A.gnormy+A.lprojection,null!=A.wrap_gnorm&&(A.wrap_gnorm.zpp_inner.x=A.gnormx,A.wrap_gnorm.zpp_inner.y=A.gnormy),A.tp0=A.gp0.y*A.gnormx-A.gp0.x*A.gnormy,A.tp1=A.gp1.y*A.gnormx-A.gp1.x*A.gnormy}}var O=t.body,x=O.posx,v=O.posy;O.sweepTime=0,O.sweep_angvel=O.angvel;A=e-O.sweepTime;0!=A&&(O.sweepTime=e,O.posx+=O.velx*A,O.posy+=O.vely*A,0!=O.angvel&&(k=O.sweep_angvel*A,O.rot+=k,1e-4<k*k?(O.axisx=Math.sin(O.rot),O.axisy=Math.cos(O.rot)):(E=1-(I=k*k)*I/8,I=((A=1-.5*I)*O.axisx+k*O.axisy)*E,O.axisy=(A*O.axisy-k*O.axisx)*E,O.axisx=I)));var k=O.posx,E=O.posy;t.validate_sweepRadius();var I=t.sweepRadius;null==Be.zpp_pool?D=new Be:(D=Be.zpp_pool,Be.zpp_pool=D.next,D.next=null),D.minx=(x<k?x:k)-I,D.maxx=(k<x?x:k)+I,D.miny=(v<E?v:E)-I,D.maxy=(E<v?v:E)+I;var i=this.convexShapeList=this.bphase.shapesInAABB(D,!1,!1,null==i?null:i.zpp_inner,this.convexShapeList),D=D;null!=D.outer&&(D.outer.zpp_inner=null,D.outer=null),D.wrap_min=D.wrap_max=null,D._invalidate=null,D._validate=null,D.next=Be.zpp_pool,Be.zpp_pool=D;var B=null==r?new wt:r;i.zpp_inner.valmod();for(var L=ne.get(i);;){L.zpp_inner.zpp_inner.valmod();var R=L.zpp_inner;R.zpp_inner.valmod(),R.zpp_inner.zip_length&&(R.zpp_inner.zip_length=!1,R.zpp_inner.user_length=R.zpp_inner.inner.length);var F=R.zpp_inner.user_length;if(L.zpp_critical=!0,!(L.zpp_i<F||(L.zpp_next=ne.zpp_pool,(ne.zpp_pool=L).zpp_inner=null,!1)))break;L.zpp_critical=!1;var j=L.zpp_inner.at(L.zpp_i++);if(j!=t.outer&&(null!=j.zpp_inner.body?j.zpp_inner.body.outer:null)!=O.outer){if(s.s1=t,s.s2=j.zpp_inner,n){j.zpp_inner.validate_sweepRadius(),(null!=j.zpp_inner.body?j.zpp_inner.body.outer:null).zpp_inner.sweep_angvel=(null!=j.zpp_inner.body?j.zpp_inner.body.outer:null).zpp_inner.angvel,(null!=j.zpp_inner.body?j.zpp_inner.body.outer:null).zpp_inner.sweepTime=0,Ie.dynamicSweep(s,e,0,0,!0);var N=(null!=j.zpp_inner.body?j.zpp_inner.body.outer:null).zpp_inner,G=0-N.sweepTime;0!=G&&(N.sweepTime=0,N.posx+=N.velx*G,N.posy+=N.vely*G,0!=N.angvel&&(R=N.sweep_angvel*G,N.rot+=R,1e-4<R*R?(N.axisx=Math.sin(N.rot),N.axisy=Math.cos(N.rot)):(F=1-(X=R*R)*X/8,X=((G=1-.5*X)*N.axisx+R*N.axisy)*F,N.axisy=(G*N.axisy-R*N.axisx)*F,N.axisx=X)));var U=(null!=j.zpp_inner.body?j.zpp_inner.body.outer:null).zpp_inner,X=j.zpp_inner;if(0==X.type)X.worldCOMx=U.posx+(U.axisy*X.localCOMx-U.axisx*X.localCOMy),X.worldCOMy=U.posy+(X.localCOMx*U.axisx+X.localCOMy*U.axisy);else{for(var V=X.polygon,W=V.lverts.next,H=V.gverts.next;null!=H;){var q=H,Y=W,W=W.next;q.x=U.posx+(U.axisy*Y.x-U.axisx*Y.y),q.y=U.posy+(Y.x*U.axisx+Y.y*U.axisy),H=H.next}for(var K=V.edges.head,Z=J=V.gverts.next,J=J.next;null!=J;){var Q=J,$=K.elt,K=K.next;$.gnormx=U.axisy*$.lnormx-U.axisx*$.lnormy,$.gnormy=$.lnormx*U.axisx+$.lnormy*U.axisy,$.gprojection=U.posx*$.gnormx+U.posy*$.gnormy+$.lprojection,$.tp0=Z.y*$.gnormx-Z.x*$.gnormy,$.tp1=Q.y*$.gnormx-Q.x*$.gnormy,Z=Q,J=J.next}var tt=V.gverts.next,et=K.elt;et.gnormx=U.axisy*et.lnormx-U.axisx*et.lnormy,et.gnormy=et.lnormx*U.axisx+et.lnormy*U.axisy,et.gprojection=U.posx*et.gnormx+U.posy*et.gnormy+et.lprojection,et.tp0=Z.y*et.gnormx-Z.x*et.gnormy,et.tp1=tt.y*et.gnormx-tt.x*et.gnormy}}else Ie.staticSweep(s,e,0,0);if(s.toi*=e,0<s.toi){var it,nt,V=-s.axis.x,tt=-s.axis.y;null==Rn.poolVec2?it=new Ct:(it=Rn.poolVec2,Rn.poolVec2=it.zpp_pool,it.zpp_pool=null),null==it.zpp_inner?(null==Ir.zpp_pool?nt=new Ir:(nt=Ir.zpp_pool,Ir.zpp_pool=nt.next,nt.next=null),nt.weak=!1,nt._immutable=!1,nt.x=V,nt.y=tt,it.zpp_inner=nt,it.zpp_inner.outer=it):(null!=(et=it.zpp_inner)._validate&&et._validate(),it.zpp_inner.x==V&&(null!=(at=it.zpp_inner)._validate&&at._validate(),it.zpp_inner.y==tt)||(it.zpp_inner.x=V,it.zpp_inner.y=tt,null!=(ot=it.zpp_inner)._invalidate&&ot._invalidate(ot))),it.zpp_inner.weak=!1;var rt,st,ot,at=it,V=s.c2.x,tt=s.c2.y;null==Rn.poolVec2?rt=new Ct:(rt=Rn.poolVec2,Rn.poolVec2=rt.zpp_pool,rt.zpp_pool=null),null==rt.zpp_inner?(null==Ir.zpp_pool?st=new Ir:(st=Ir.zpp_pool,Ir.zpp_pool=st.next,st.next=null),st.weak=!1,st._immutable=!1,st.x=V,st.y=tt,rt.zpp_inner=st,rt.zpp_inner.outer=rt):(null!=(ot=rt.zpp_inner)._validate&&ot._validate(),rt.zpp_inner.x==V&&(null!=(ot=rt.zpp_inner)._validate&&ot._validate(),rt.zpp_inner.y==tt)||(rt.zpp_inner.x=V,rt.zpp_inner.y=tt,null!=(tt=rt.zpp_inner)._invalidate&&tt._invalidate(tt))),rt.zpp_inner.weak=!1;for(var lt=de.getConvex(at,rt,s.toi,j),pt=null,ht=B.zpp_inner.inner.head;null!=ht&&!(lt.zpp_inner.toiDistance<ht.elt.zpp_inner.toiDistance);)ht=(pt=ht).next;var ut,at=B.zpp_inner.inner;null==xn.zpp_pool?ut=new xn:(ut=xn.zpp_pool,xn.zpp_pool=ut.next,ut.next=null),ut.elt=lt;j=ut;null==pt?(j.next=at.head,at.head=j):(j.next=pt.next,pt.next=j),at.pushmod=at.modified=!0,at.length++}}}i.clear();r=s;r.next=Ee.zpp_pool,Ee.zpp_pool=r;i=0-O.sweepTime;if(0!=i&&(O.sweepTime=0,O.posx+=O.velx*i,O.posy+=O.vely*i,0!=O.angvel&&(r=O.sweep_angvel*i,O.rot+=r,1e-4<r*r?(O.axisx=Math.sin(O.rot),O.axisy=Math.cos(O.rot)):(ct=1-(zt=r*r)*zt/8,zt=((i=1-.5*zt)*O.axisx+r*O.axisy)*ct,O.axisy=(i*O.axisy-r*O.axisx)*ct,O.axisx=zt))),0==t.type)t.worldCOMx=O.posx+(O.axisy*t.localCOMx-O.axisx*t.localCOMy),t.worldCOMy=O.posy+(t.localCOMx*O.axisx+t.localCOMy*O.axisy);else{for(var ct=t.polygon,dt=ct.lverts.next,_t=ct.gverts.next;null!=_t;){var yt=_t,ft=dt,dt=dt.next;yt.x=O.posx+(O.axisy*ft.x-O.axisx*ft.y),yt.y=O.posy+(ft.x*O.axisx+ft.y*O.axisy),_t=_t.next}for(var mt=ct.edges.head,xt=vt=ct.gverts.next,vt=vt.next;null!=vt;){var gt=vt,bt=mt.elt,mt=mt.next;bt.gnormx=O.axisy*bt.lnormx-O.axisx*bt.lnormy,bt.gnormy=bt.lnormx*O.axisx+bt.lnormy*O.axisy,bt.gprojection=O.posx*bt.gnormx+O.posy*bt.gnormy+bt.lprojection,bt.tp0=xt.y*bt.gnormx-xt.x*bt.gnormy,bt.tp1=gt.y*bt.gnormx-gt.x*bt.gnormy,xt=gt,vt=vt.next}var zt=ct.gverts.next,ct=mt.elt;ct.gnormx=O.axisy*ct.lnormx-O.axisx*ct.lnormy,ct.gnormy=ct.lnormx*O.axisx+ct.lnormy*O.axisy,ct.gprojection=O.posx*ct.gnormx+O.posy*ct.gnormy+ct.lprojection,ct.tp0=xt.y*ct.gnormx-xt.x*ct.gnormy,ct.tp1=zt.y*ct.gnormx-zt.x*ct.gnormy}return B},ii.prototype.push_callback=function(t){var e;return null==re.zpp_pool?e=new re:(e=re.zpp_pool,re.zpp_pool=e.next,e.next=null),this.callbacks.push(e),e.listener=t,e},ii.prototype.pre_dt=null,ii.prototype.step=function(t,e,i){if(this.time+=t,this.pre_dt=t,this.midstep=!0,this.stamp++,this.validation(),this.bphase.broadphase(this,!0),this.prestep(t),this.sortcontacts){var n=this.c_arbiters_false;if(null!=n.head&&null!=n.head.next){for(var r,s,o,a=n.head,l=null,p=null,h=null,u=null,c=1;;){for(r=0,p=a,l=a=null;null!=p;){for(++r,h=p,s=0,o=c;null!=h&&s<c;)++s,h=h.next;for(;0<s||0<o&&null!=h;)0!=s&&(0==o||null==h||!p.elt.active||!h.elt.active||p.elt.oc1.dist<h.elt.oc1.dist)?(p=(u=p).next,--s):(h=(u=h).next,--o),null!=l?l.next=u:a=u,l=u;p=h}if(l.next=null,c<<=1,!(1<r))break}n.head=a,n.modified=!0,n.pushmod=!0}}this.updateVel(t),this.warmStart(),this.iterateVel(e);for(var d=this.kinematics.head;null!=d;){var _=d.elt;_.pre_posx=_.posx,_.pre_posy=_.posy,_.pre_rot=_.rot,d=d.next}for(var y=this.live.head;null!=y;){var f=y.elt;f.pre_posx=f.posx,f.pre_posy=f.posy,f.pre_rot=f.rot,y=y.next}this.updatePos(t),this.continuous=!0,this.continuousCollisions(t),this.continuous=!1,this.iteratePos(i);for(var m=this.kinematics.head;null!=m;){var x=m.elt,v=!(x.posx==x.pre_posx&&x.posy==x.pre_posy),g=x.pre_rot!=x.rot;if(v){for(var b=x.shapes.head;null!=b;){var z=b.elt;1==z.type&&(z.polygon.invalidate_gverts(),z.polygon.invalidate_gaxi()),z.invalidate_worldCOM(),b=b.next}x.zip_worldCOM=!0}if(g){x.zip_axis=!0;for(var w=x.shapes.head;null!=w;){var C=w.elt;1==C.type&&(C.polygon.invalidate_gverts(),C.polygon.invalidate_gaxi()),C.invalidate_worldCOM(),w=w.next}x.zip_worldCOM=!0}m=m.next}for(var P=this.live.head;null!=P;){var T=P.elt,S=!(T.posx==T.pre_posx&&T.posy==T.pre_posy),M=T.pre_rot!=T.rot;if(S){for(var A=T.shapes.head;null!=A;){var O=A.elt;1==O.type&&(O.polygon.invalidate_gverts(),O.polygon.invalidate_gaxi()),O.invalidate_worldCOM(),A=A.next}T.zip_worldCOM=!0}if(M){T.zip_axis=!0;for(var k=T.shapes.head;null!=k;){var E=k.elt;1==E.type&&(E.polygon.invalidate_gverts(),E.polygon.invalidate_gaxi()),E.invalidate_worldCOM(),k=k.next}T.zip_worldCOM=!0}P=P.next}for(var I=null,D=this.staticsleep.head;null!=D;){var B,L,R,F=D.elt;3!=F.type||0==F.velx&&0==F.vely&&0==F.angvel?F.kinematicDelaySleep?(F.kinematicDelaySleep=!1,D=D.next):(F.component.sleeping=!0,B=this.staticsleep,null==I?(R=(L=B.head).next,B.head=R,null==B.head&&(B.pushmod=!0)):(R=(L=I.next).next,null==(I.next=R)&&(B.pushmod=!0)),(F=L).elt=null,F.next=Wi.zpp_pool,Wi.zpp_pool=F,B.modified=!0,B.length--,B.pushmod=!0,D=R):D=(I=D).next}this.doForests(t),this.sleepArbiters(),this.midstep=!1;for(var j=null,N=this.callbackset_list.next;null!=N;){var G=N;if(null!=G.arbiters.head){for(var U=!0,X=G.arbiters.head;null!=X;){if(!X.elt.sleeping){U=!1;break}X=X.next}for(var V,W=U,H=G.int1.cbSet,q=G.int2.cbSet,Y=null,K=(H.cbpairs.length<q.cbpairs.length?H:q).cbpairs.head;null!=K;){var Z=K.elt;if(Z.a==H&&Z.b==q||Z.a==q&&Z.b==H){Y=Z;break}K=K.next}null==Y&&(null==qn.zpp_pool?V=new qn:(V=qn.zpp_pool,qn.zpp_pool=V.next,V.next=null),V.zip_listeners=!0,Hn.setlt(H,q)?(V.a=H,V.b=q):(V.a=q,V.b=H),Y=V,H.cbpairs.add(Y),q!=H&&q.cbpairs.add(Y)),Y.zip_listeners&&(Y.zip_listeners=!1,Y.__validate());for(var J=Y.listeners.head;null!=J;){var Q,$,tt,et,it,nt=J.elt;6==nt.event&&(W&&!nt.allowSleepingCallbacks||G.empty_arb(nt.itype)||((Q=this.push_callback(nt)).event=6,$=G.int1,tt=G.int2,it=nt.options1,et=$.cbTypes,!(!it.nonemptyintersection(et,it.includes)||it.nonemptyintersection(et,it.excludes))&&(it=nt.options2,nt=tt.cbTypes,!!it.nonemptyintersection(nt,it.includes)&&!it.nonemptyintersection(nt,it.excludes))?(Q.int1=$,Q.int2=tt):(Q.int1=tt,Q.int2=$),Q.set=G)),J=J.next}N=(j=N).next}else{var rt,st,ot=this.callbackset_list;null==j?(st=(rt=ot.next).next,ot.next=st,null==ot.next&&(ot.pushmod=!0)):(st=(rt=j.next).next,null==(j.next=st)&&(ot.pushmod=!0)),rt._inuse=!1,ot.modified=!0,ot.length--,ot.pushmod=!0,N=st,G.int1=G.int2=null,G.id=G.di=-1,G.freed=!0,G.next=tr.zpp_pool,tr.zpp_pool=G}}for(;!this.callbacks.empty();){var at=this.callbacks.pop();0==at.listener.type?at.listener.body.handler(at.wrapper_body()):1==at.listener.type?at.listener.constraint.handler(at.wrapper_con()):2==at.listener.type&&at.listener.interaction.handleri(at.wrapper_int()),at.int1=at.int2=null,at.body=null,at.constraint=null,(at.listener=null)!=at.wrap_arbiters&&(at.wrap_arbiters.zpp_inner.inner=null),at.set=null,at.next=re.zpp_pool,re.zpp_pool=at}},ii.prototype.toiEvents=null,ii.prototype.continuousCollisions=function(t){var e=2*Math.PI/t;this.bphase.broadphase(this,!1);for(var i=0;i<1&&null!=this.toiEvents.head;){for(var n=null,r=2,s=!1,o=null,a=null,l=this.toiEvents.head;null!=l;){var p=l.elt,h=p.s1.body,u=p.s2.body;if(h.sweepFrozen&&u.sweepFrozen){if(0==p.toi||!Er.testCollide_safe(p.s1,p.s2)){l=this.toiEvents.erase(a),p.next=Ee.zpp_pool,Ee.zpp_pool=p;continue}p.toi=0}if(p.frozen1!=h.sweepFrozen||p.frozen2!=u.sweepFrozen){if(p.kinematic){l=this.toiEvents.erase(a),p.next=Ee.zpp_pool,Ee.zpp_pool=p;continue}if(p.frozen1=h.sweepFrozen,p.frozen2=u.sweepFrozen,p.frozen1&&(u=p.s1,p.s1=p.s2,p.s2=u,p.frozen1=!1,p.frozen2=!0),Ie.staticSweep(p,t,0,kr.collisionSlopCCD),p.toi<0){l=this.toiEvents.erase(a),p.next=Ee.zpp_pool,Ee.zpp_pool=p;continue}}0<=p.toi&&(p.toi<r||!s&&p.kinematic)&&(r=(n=p).toi,s=p.kinematic,o=a),l=(a=l).next}if(null==n)break;this.toiEvents.erase(o),i=n.toi;var c=n.s1.body,d=n.s2.body;if(!c.sweepFrozen){var _,y=i*t,f=y-c.sweepTime;0!=f&&(c.sweepTime=y,c.posx+=c.velx*f,c.posy+=c.vely*f,0!=c.angvel&&(_=c.sweep_angvel*f,c.rot+=_,1e-4<_*_?(c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot)):(y=1-(m=_*_)*m/8,m=((f=1-.5*m)*c.axisx+_*c.axisy)*y,c.axisy=(f*c.axisy-_*c.axisx)*y,c.axisx=m)));var m=n.s1;if(0==m.type)m.worldCOMx=c.posx+(c.axisy*m.localCOMx-c.axisx*m.localCOMy),m.worldCOMy=c.posy+(m.localCOMx*c.axisx+m.localCOMy*c.axisy);else{for(var x=m.polygon,v=x.lverts.next,g=x.gverts.next;null!=g;){var b=g,z=v,v=v.next;b.x=c.posx+(c.axisy*z.x-c.axisx*z.y),b.y=c.posy+(z.x*c.axisx+z.y*c.axisy),g=g.next}for(var w=x.edges.head,C=P=x.gverts.next,P=P.next;null!=P;){var T=P,S=w.elt,w=w.next;S.gnormx=c.axisy*S.lnormx-c.axisx*S.lnormy,S.gnormy=S.lnormx*c.axisx+S.lnormy*c.axisy,S.gprojection=c.posx*S.gnormx+c.posy*S.gnormy+S.lprojection,S.tp0=C.y*S.gnormx-C.x*S.gnormy,S.tp1=T.y*S.gnormx-T.x*S.gnormy,C=T,P=P.next}var M=x.gverts.next,x=w.elt;x.gnormx=c.axisy*x.lnormx-c.axisx*x.lnormy,x.gnormy=x.lnormx*c.axisx+x.lnormy*c.axisy,x.gprojection=c.posx*x.gnormx+c.posy*x.gnormy+x.lprojection,x.tp0=C.y*x.gnormx-C.x*x.gnormy,x.tp1=M.y*x.gnormx-M.x*x.gnormy}}if(!d.sweepFrozen){M=i*t,x=M-d.sweepTime;0!=x&&(d.sweepTime=M,d.posx+=d.velx*x,d.posy+=d.vely*x,0!=d.angvel&&(A=d.sweep_angvel*x,d.rot+=A,1e-4<A*A?(d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot)):(st=1-(X=A*A)*X/8,X=((x=1-.5*X)*d.axisx+A*d.axisy)*st,d.axisy=(x*d.axisy-A*d.axisx)*st,d.axisx=X)));var A=n.s2;if(0==A.type)A.worldCOMx=d.posx+(d.axisy*A.localCOMx-d.axisx*A.localCOMy),A.worldCOMy=d.posy+(A.localCOMx*d.axisx+A.localCOMy*d.axisy);else{for(var O=A.polygon,k=O.lverts.next,E=O.gverts.next;null!=E;){var I=E,D=k,k=k.next;I.x=d.posx+(d.axisy*D.x-d.axisx*D.y),I.y=d.posy+(D.x*d.axisx+D.y*d.axisy),E=E.next}for(var B=O.edges.head,L=R=O.gverts.next,R=R.next;null!=R;){var F=R,j=B.elt,B=B.next;j.gnormx=d.axisy*j.lnormx-d.axisx*j.lnormy,j.gnormy=j.lnormx*d.axisx+j.lnormy*d.axisy,j.gprojection=d.posx*j.gnormx+d.posy*j.gnormy+j.lprojection,j.tp0=L.y*j.gnormx-L.x*j.gnormy,j.tp1=F.y*j.gnormx-F.x*j.gnormy,L=F,R=R.next}var N=O.gverts.next,G=B.elt;G.gnormx=d.axisy*G.lnormx-d.axisx*G.lnormy,G.gnormy=G.lnormx*d.axisx+G.lnormy*d.axisy,G.gprojection=d.posx*G.gnormx+d.posy*G.gnormy+G.lprojection,G.tp0=L.y*G.gnormx-L.x*G.gnormy,G.tp1=N.y*G.gnormx-N.x*G.gnormy}}var U,X,V,W,H,q,Y,K,Z,J,Q,$,tt,et,it,nt,rt,st=this.narrowPhase(n.s1,n.s2,!0,n.arbiter,!0);null==st?null!=n.arbiter&&null!=n.arbiter.pair&&(n.arbiter.pair.arb=null,n.arbiter.pair=null):this.presteparb(st,t,!0)||st.type==Qe.COL&&st.active&&0!=(1&st.immState)&&(A=(X=st.colarb).nx*X.c1.jnAcc-X.ny*X.c1.jtAcc,O=X.ny*X.c1.jnAcc+X.nx*X.c1.jtAcc,N=X.b1.imass,X.b1.velx-=A*N,X.b1.vely-=O*N,X.b1.angvel-=X.b1.iinertia*(O*X.c1.r1x-A*X.c1.r1y),G=X.b2.imass,X.b2.velx+=A*G,X.b2.vely+=O*G,X.b2.angvel+=X.b2.iinertia*(O*X.c1.r2x-A*X.c1.r2y),X.hc2&&(U=X.nx*X.c2.jnAcc-X.ny*X.c2.jtAcc,W=X.ny*X.c2.jnAcc+X.nx*X.c2.jtAcc,tt=X.b1.imass,X.b1.velx-=U*tt,X.b1.vely-=W*tt,X.b1.angvel-=X.b1.iinertia*(W*X.c2.r1x-U*X.c2.r1y),V=X.b2.imass,X.b2.velx+=U*V,X.b2.vely+=W*V,X.b2.angvel+=X.b2.iinertia*(W*X.c2.r2x-U*X.c2.r2y)),X.b2.angvel+=X.jrAcc*X.b2.iinertia,X.b1.angvel-=X.jrAcc*X.b1.iinertia,G=(N=st.colarb).k1x+N.b2.velx-N.c1.r2y*N.b2.angvel-(N.b1.velx-N.c1.r1y*N.b1.angvel),A=((O=N.k1y+N.b2.vely+N.c1.r2x*N.b2.angvel-(N.b1.vely+N.c1.r1x*N.b1.angvel))*N.nx-G*N.ny+N.surfacex)*N.c1.tMass,(tt=N.c1.friction*N.c1.jnAcc)<(W=(V=N.c1.jtAcc)-A)?W=tt:W<-tt&&(W=-tt),A=W-V,N.c1.jtAcc=W,U=-N.ny*A,X=N.nx*A,N.b2.velx+=U*N.b2.imass,N.b2.vely+=X*N.b2.imass,N.b1.velx-=U*N.b1.imass,N.b1.vely-=X*N.b1.imass,N.b2.angvel+=N.rt1b*A*N.b2.iinertia,N.b1.angvel-=N.rt1a*A*N.b1.iinertia,N.hc2?(it=N.k2x+N.b2.velx-N.c2.r2y*N.b2.angvel-(N.b1.velx-N.c2.r1y*N.b1.angvel),A=((q=N.k2y+N.b2.vely+N.c2.r2x*N.b2.angvel-(N.b1.vely+N.c2.r1x*N.b1.angvel))*N.nx-it*N.ny+N.surfacex)*N.c2.tMass,(tt=N.c2.friction*N.c2.jnAcc)<(W=(V=N.c2.jtAcc)-A)?W=tt:W<-tt&&(W=-tt),A=W-V,N.c2.jtAcc=W,U=-N.ny*A,X=N.nx*A,N.b2.velx+=U*N.b2.imass,N.b2.vely+=X*N.b2.imass,N.b1.velx-=U*N.b1.imass,N.b1.vely-=X*N.b1.imass,N.b2.angvel+=N.rt2b*A*N.b2.iinertia,N.b1.angvel-=N.rt2a*A*N.b1.iinertia,G=N.k1x+N.b2.velx-N.c1.r2y*N.b2.angvel-(N.b1.velx-N.c1.r1y*N.b1.angvel),O=N.k1y+N.b2.vely+N.c1.r2x*N.b2.angvel-(N.b1.vely+N.c1.r1x*N.b1.angvel),it=N.k2x+N.b2.velx-N.c2.r2y*N.b2.angvel-(N.b1.velx-N.c2.r1y*N.b1.angvel),q=N.k2y+N.b2.vely+N.c2.r2x*N.b2.angvel-(N.b1.vely+N.c2.r1x*N.b1.angvel),Y=N.c1.jnAcc,et=N.c2.jnAcc,rt=G*N.nx+O*N.ny+N.surfacey+N.c1.bounce-(N.Ka*Y+N.Kb*et),nt=it*N.nx+q*N.ny+N.surfacey+N.c2.bounce-(N.Kb*Y+N.Kc*et),it=-(N.kMassa*rt+N.kMassb*nt),q=-(N.kMassb*rt+N.kMassc*nt),0<=it&&0<=q?(rt=it-Y,nt=q-et,N.c1.jnAcc=it,N.c2.jnAcc=q):0<=(it=-N.c1.nMass*rt)&&0<=N.Kb*it+nt?(rt=it-Y,nt=-et,N.c1.jnAcc=it,N.c2.jnAcc=0):0<=(q=-N.c2.nMass*nt)&&0<=N.Kb*q+rt?(rt=-Y,nt=q-et,N.c1.jnAcc=0,N.c2.jnAcc=q):0<=rt&&0<=nt?(rt=-Y,nt=-et,N.c1.jnAcc=N.c2.jnAcc=0):nt=rt=0,A=rt+nt,U=N.nx*A,X=N.ny*A,N.b2.velx+=U*N.b2.imass,N.b2.vely+=X*N.b2.imass,N.b1.velx-=U*N.b1.imass,N.b1.vely-=X*N.b1.imass,N.b2.angvel+=(N.rn1b*rt+N.rn2b*nt)*N.b2.iinertia,N.b1.angvel-=(N.rn1a*rt+N.rn2a*nt)*N.b1.iinertia):(0!=N.radius&&(A=(N.b2.angvel-N.b1.angvel)*N.rMass,tt=N.rfric*N.c1.jnAcc,V=N.jrAcc,N.jrAcc-=A,N.jrAcc>tt?N.jrAcc=tt:N.jrAcc<-tt&&(N.jrAcc=-tt),A=N.jrAcc-V,N.b2.angvel+=A*N.b2.iinertia,N.b1.angvel-=A*N.b1.iinertia),G=N.k1x+N.b2.velx-N.c1.r2y*N.b2.angvel-(N.b1.velx-N.c1.r1y*N.b1.angvel),O=N.k1y+N.b2.vely+N.c1.r2x*N.b2.angvel-(N.b1.vely+N.c1.r1x*N.b1.angvel),A=(N.c1.bounce+(N.nx*G+N.ny*O)+N.surfacey)*N.c1.nMass,(W=(V=N.c1.jnAcc)-A)<0&&(W=0),A=W-V,N.c1.jnAcc=W,U=N.nx*A,X=N.ny*A,N.b2.velx+=U*N.b2.imass,N.b2.vely+=X*N.b2.imass,N.b1.velx-=U*N.b1.imass,N.b1.vely-=X*N.b1.imass,N.b2.angvel+=N.rn1b*A*N.b2.iinertia,N.b1.angvel-=N.rn1a*A*N.b1.iinertia),q=(it=st.colarb).k1x+it.b2.velx-it.c1.r2y*it.b2.angvel-(it.b1.velx-it.c1.r1y*it.b1.angvel),et=((Y=it.k1y+it.b2.vely+it.c1.r2x*it.b2.angvel-(it.b1.vely+it.c1.r1x*it.b1.angvel))*it.nx-q*it.ny+it.surfacex)*it.c1.tMass,(rt=it.c1.friction*it.c1.jnAcc)<(tt=(nt=it.c1.jtAcc)-et)?tt=rt:tt<-rt&&(tt=-rt),et=tt-nt,it.c1.jtAcc=tt,G=-it.ny*et,O=it.nx*et,it.b2.velx+=G*it.b2.imass,it.b2.vely+=O*it.b2.imass,it.b1.velx-=G*it.b1.imass,it.b1.vely-=O*it.b1.imass,it.b2.angvel+=it.rt1b*et*it.b2.iinertia,it.b1.angvel-=it.rt1a*et*it.b1.iinertia,it.hc2?(V=it.k2x+it.b2.velx-it.c2.r2y*it.b2.angvel-(it.b1.velx-it.c2.r1y*it.b1.angvel),et=((W=it.k2y+it.b2.vely+it.c2.r2x*it.b2.angvel-(it.b1.vely+it.c2.r1x*it.b1.angvel))*it.nx-V*it.ny+it.surfacex)*it.c2.tMass,(rt=it.c2.friction*it.c2.jnAcc)<(tt=(nt=it.c2.jtAcc)-et)?tt=rt:tt<-rt&&(tt=-rt),et=tt-nt,it.c2.jtAcc=tt,G=-it.ny*et,O=it.nx*et,it.b2.velx+=G*it.b2.imass,it.b2.vely+=O*it.b2.imass,it.b1.velx-=G*it.b1.imass,it.b1.vely-=O*it.b1.imass,it.b2.angvel+=it.rt2b*et*it.b2.iinertia,it.b1.angvel-=it.rt2a*et*it.b1.iinertia,q=it.k1x+it.b2.velx-it.c1.r2y*it.b2.angvel-(it.b1.velx-it.c1.r1y*it.b1.angvel),Y=it.k1y+it.b2.vely+it.c1.r2x*it.b2.angvel-(it.b1.vely+it.c1.r1x*it.b1.angvel),V=it.k2x+it.b2.velx-it.c2.r2y*it.b2.angvel-(it.b1.velx-it.c2.r1y*it.b1.angvel),W=it.k2y+it.b2.vely+it.c2.r2x*it.b2.angvel-(it.b1.vely+it.c2.r1x*it.b1.angvel),U=it.c1.jnAcc,X=it.c2.jnAcc,A=q*it.nx+Y*it.ny+it.surfacey+it.c1.bounce-(it.Ka*U+it.Kb*X),N=V*it.nx+W*it.ny+it.surfacey+it.c2.bounce-(it.Kb*U+it.Kc*X),V=-(it.kMassa*A+it.kMassb*N),W=-(it.kMassb*A+it.kMassc*N),0<=V&&0<=W?(A=V-U,N=W-X,it.c1.jnAcc=V,it.c2.jnAcc=W):0<=(V=-it.c1.nMass*A)&&0<=it.Kb*V+N?(A=V-U,N=-X,it.c1.jnAcc=V,it.c2.jnAcc=0):0<=(W=-it.c2.nMass*N)&&0<=it.Kb*W+A?(A=-U,N=W-X,it.c1.jnAcc=0,it.c2.jnAcc=W):0<=A&&0<=N?(A=-U,N=-X,it.c1.jnAcc=it.c2.jnAcc=0):N=A=0,et=A+N,G=it.nx*et,O=it.ny*et,it.b2.velx+=G*it.b2.imass,it.b2.vely+=O*it.b2.imass,it.b1.velx-=G*it.b1.imass,it.b1.vely-=O*it.b1.imass,it.b2.angvel+=(it.rn1b*A+it.rn2b*N)*it.b2.iinertia,it.b1.angvel-=(it.rn1a*A+it.rn2a*N)*it.b1.iinertia):(0!=it.radius&&(et=(it.b2.angvel-it.b1.angvel)*it.rMass,rt=it.rfric*it.c1.jnAcc,nt=it.jrAcc,it.jrAcc-=et,it.jrAcc>rt?it.jrAcc=rt:it.jrAcc<-rt&&(it.jrAcc=-rt),et=it.jrAcc-nt,it.b2.angvel+=et*it.b2.iinertia,it.b1.angvel-=et*it.b1.iinertia),q=it.k1x+it.b2.velx-it.c1.r2y*it.b2.angvel-(it.b1.velx-it.c1.r1y*it.b1.angvel),Y=it.k1y+it.b2.vely+it.c1.r2x*it.b2.angvel-(it.b1.vely+it.c1.r1x*it.b1.angvel),et=(it.c1.bounce+(it.nx*q+it.ny*Y)+it.surfacey)*it.c1.nMass,(tt=(nt=it.c1.jnAcc)-et)<0&&(tt=0),et=tt-nt,it.c1.jnAcc=tt,G=it.nx*et,O=it.ny*et,it.b2.velx+=G*it.b2.imass,it.b2.vely+=O*it.b2.imass,it.b1.velx-=G*it.b1.imass,it.b1.vely-=O*it.b1.imass,it.b2.angvel+=it.rn1b*et*it.b2.iinertia,it.b1.angvel-=it.rn1a*et*it.b1.iinertia),q=(rt=st.colarb).k1x+rt.b2.velx-rt.c1.r2y*rt.b2.angvel-(rt.b1.velx-rt.c1.r1y*rt.b1.angvel),nt=((Y=rt.k1y+rt.b2.vely+rt.c1.r2x*rt.b2.angvel-(rt.b1.vely+rt.c1.r1x*rt.b1.angvel))*rt.nx-q*rt.ny+rt.surfacex)*rt.c1.tMass,(tt=rt.c1.friction*rt.c1.jnAcc)<(O=(G=rt.c1.jtAcc)-nt)?O=tt:O<-tt&&(O=-tt),nt=O-G,rt.c1.jtAcc=O,et=-rt.ny*nt,it=rt.nx*nt,rt.b2.velx+=et*rt.b2.imass,rt.b2.vely+=it*rt.b2.imass,rt.b1.velx-=et*rt.b1.imass,rt.b1.vely-=it*rt.b1.imass,rt.b2.angvel+=rt.rt1b*nt*rt.b2.iinertia,rt.b1.angvel-=rt.rt1a*nt*rt.b1.iinertia,rt.hc2?(H=rt.k2x+rt.b2.velx-rt.c2.r2y*rt.b2.angvel-(rt.b1.velx-rt.c2.r1y*rt.b1.angvel),nt=((K=rt.k2y+rt.b2.vely+rt.c2.r2x*rt.b2.angvel-(rt.b1.vely+rt.c2.r1x*rt.b1.angvel))*rt.nx-H*rt.ny+rt.surfacex)*rt.c2.tMass,(tt=rt.c2.friction*rt.c2.jnAcc)<(O=(G=rt.c2.jtAcc)-nt)?O=tt:O<-tt&&(O=-tt),nt=O-G,rt.c2.jtAcc=O,et=-rt.ny*nt,it=rt.nx*nt,rt.b2.velx+=et*rt.b2.imass,rt.b2.vely+=it*rt.b2.imass,rt.b1.velx-=et*rt.b1.imass,rt.b1.vely-=it*rt.b1.imass,rt.b2.angvel+=rt.rt2b*nt*rt.b2.iinertia,rt.b1.angvel-=rt.rt2a*nt*rt.b1.iinertia,q=rt.k1x+rt.b2.velx-rt.c1.r2y*rt.b2.angvel-(rt.b1.velx-rt.c1.r1y*rt.b1.angvel),Y=rt.k1y+rt.b2.vely+rt.c1.r2x*rt.b2.angvel-(rt.b1.vely+rt.c1.r1x*rt.b1.angvel),H=rt.k2x+rt.b2.velx-rt.c2.r2y*rt.b2.angvel-(rt.b1.velx-rt.c2.r1y*rt.b1.angvel),K=rt.k2y+rt.b2.vely+rt.c2.r2x*rt.b2.angvel-(rt.b1.vely+rt.c2.r1x*rt.b1.angvel),Z=rt.c1.jnAcc,J=rt.c2.jnAcc,Q=q*rt.nx+Y*rt.ny+rt.surfacey+rt.c1.bounce-(rt.Ka*Z+rt.Kb*J),$=H*rt.nx+K*rt.ny+rt.surfacey+rt.c2.bounce-(rt.Kb*Z+rt.Kc*J),H=-(rt.kMassa*Q+rt.kMassb*$),K=-(rt.kMassb*Q+rt.kMassc*$),0<=H&&0<=K?(Q=H-Z,$=K-J,rt.c1.jnAcc=H,rt.c2.jnAcc=K):0<=(H=-rt.c1.nMass*Q)&&0<=rt.Kb*H+$?(Q=H-Z,$=-J,rt.c1.jnAcc=H,rt.c2.jnAcc=0):0<=(K=-rt.c2.nMass*$)&&0<=rt.Kb*K+Q?(Q=-Z,$=K-J,rt.c1.jnAcc=0,rt.c2.jnAcc=K):0<=Q&&0<=$?(Q=-Z,$=-J,rt.c1.jnAcc=rt.c2.jnAcc=0):$=Q=0,nt=Q+$,et=rt.nx*nt,it=rt.ny*nt,rt.b2.velx+=et*rt.b2.imass,rt.b2.vely+=it*rt.b2.imass,rt.b1.velx-=et*rt.b1.imass,rt.b1.vely-=it*rt.b1.imass,rt.b2.angvel+=(rt.rn1b*Q+rt.rn2b*$)*rt.b2.iinertia,rt.b1.angvel-=(rt.rn1a*Q+rt.rn2a*$)*rt.b1.iinertia):(0!=rt.radius&&(nt=(rt.b2.angvel-rt.b1.angvel)*rt.rMass,tt=rt.rfric*rt.c1.jnAcc,G=rt.jrAcc,rt.jrAcc-=nt,rt.jrAcc>tt?rt.jrAcc=tt:rt.jrAcc<-tt&&(rt.jrAcc=-tt),nt=rt.jrAcc-G,rt.b2.angvel+=nt*rt.b2.iinertia,rt.b1.angvel-=nt*rt.b1.iinertia),q=rt.k1x+rt.b2.velx-rt.c1.r2y*rt.b2.angvel-(rt.b1.velx-rt.c1.r1y*rt.b1.angvel),Y=rt.k1y+rt.b2.vely+rt.c1.r2x*rt.b2.angvel-(rt.b1.vely+rt.c1.r1x*rt.b1.angvel),nt=(rt.c1.bounce+(rt.nx*q+rt.ny*Y)+rt.surfacey)*rt.c1.nMass,(O=(G=rt.c1.jnAcc)-nt)<0&&(O=0),nt=O-G,rt.c1.jnAcc=O,et=rt.nx*nt,it=rt.ny*nt,rt.b2.velx+=et*rt.b2.imass,rt.b2.vely+=it*rt.b2.imass,rt.b1.velx-=et*rt.b1.imass,rt.b1.vely-=it*rt.b1.imass,rt.b2.angvel+=rt.rn1b*nt*rt.b2.iinertia,rt.b1.angvel-=rt.rn1a*nt*rt.b1.iinertia),K=(H=st.colarb).k1x+H.b2.velx-H.c1.r2y*H.b2.angvel-(H.b1.velx-H.c1.r1y*H.b1.angvel),J=((Z=H.k1y+H.b2.vely+H.c1.r2x*H.b2.angvel-(H.b1.vely+H.c1.r1x*H.b1.angvel))*H.nx-K*H.ny+H.surfacex)*H.c1.tMass,(Q=H.c1.friction*H.c1.jnAcc)<(tt=($=H.c1.jtAcc)-J)?tt=Q:tt<-Q&&(tt=-Q),J=tt-$,H.c1.jtAcc=tt,q=-H.ny*J,Y=H.nx*J,H.b2.velx+=q*H.b2.imass,H.b2.vely+=Y*H.b2.imass,H.b1.velx-=q*H.b1.imass,H.b1.vely-=Y*H.b1.imass,H.b2.angvel+=H.rt1b*J*H.b2.iinertia,H.b1.angvel-=H.rt1a*J*H.b1.iinertia,H.hc2?(G=H.k2x+H.b2.velx-H.c2.r2y*H.b2.angvel-(H.b1.velx-H.c2.r1y*H.b1.angvel),J=((O=H.k2y+H.b2.vely+H.c2.r2x*H.b2.angvel-(H.b1.vely+H.c2.r1x*H.b1.angvel))*H.nx-G*H.ny+H.surfacex)*H.c2.tMass,(Q=H.c2.friction*H.c2.jnAcc)<(tt=($=H.c2.jtAcc)-J)?tt=Q:tt<-Q&&(tt=-Q),J=tt-$,H.c2.jtAcc=tt,q=-H.ny*J,Y=H.nx*J,H.b2.velx+=q*H.b2.imass,H.b2.vely+=Y*H.b2.imass,H.b1.velx-=q*H.b1.imass,H.b1.vely-=Y*H.b1.imass,H.b2.angvel+=H.rt2b*J*H.b2.iinertia,H.b1.angvel-=H.rt2a*J*H.b1.iinertia,K=H.k1x+H.b2.velx-H.c1.r2y*H.b2.angvel-(H.b1.velx-H.c1.r1y*H.b1.angvel),Z=H.k1y+H.b2.vely+H.c1.r2x*H.b2.angvel-(H.b1.vely+H.c1.r1x*H.b1.angvel),G=H.k2x+H.b2.velx-H.c2.r2y*H.b2.angvel-(H.b1.velx-H.c2.r1y*H.b1.angvel),O=H.k2y+H.b2.vely+H.c2.r2x*H.b2.angvel-(H.b1.vely+H.c2.r1x*H.b1.angvel),et=H.c1.jnAcc,it=H.c2.jnAcc,nt=K*H.nx+Z*H.ny+H.surfacey+H.c1.bounce-(H.Ka*et+H.Kb*it),rt=G*H.nx+O*H.ny+H.surfacey+H.c2.bounce-(H.Kb*et+H.Kc*it),G=-(H.kMassa*nt+H.kMassb*rt),O=-(H.kMassb*nt+H.kMassc*rt),0<=G&&0<=O?(nt=G-et,rt=O-it,H.c1.jnAcc=G,H.c2.jnAcc=O):0<=(G=-H.c1.nMass*nt)&&0<=H.Kb*G+rt?(nt=G-et,rt=-it,H.c1.jnAcc=G,H.c2.jnAcc=0):0<=(O=-H.c2.nMass*rt)&&0<=H.Kb*O+nt?(nt=-et,rt=O-it,H.c1.jnAcc=0,H.c2.jnAcc=O):0<=nt&&0<=rt?(nt=-et,rt=-it,H.c1.jnAcc=H.c2.jnAcc=0):rt=nt=0,J=nt+rt,q=H.nx*J,Y=H.ny*J,H.b2.velx+=q*H.b2.imass,H.b2.vely+=Y*H.b2.imass,H.b1.velx-=q*H.b1.imass,H.b1.vely-=Y*H.b1.imass,H.b2.angvel+=(H.rn1b*nt+H.rn2b*rt)*H.b2.iinertia,H.b1.angvel-=(H.rn1a*nt+H.rn2a*rt)*H.b1.iinertia):(0!=H.radius&&(J=(H.b2.angvel-H.b1.angvel)*H.rMass,Q=H.rfric*H.c1.jnAcc,$=H.jrAcc,H.jrAcc-=J,H.jrAcc>Q?H.jrAcc=Q:H.jrAcc<-Q&&(H.jrAcc=-Q),J=H.jrAcc-$,H.b2.angvel+=J*H.b2.iinertia,H.b1.angvel-=J*H.b1.iinertia),K=H.k1x+H.b2.velx-H.c1.r2y*H.b2.angvel-(H.b1.velx-H.c1.r1y*H.b1.angvel),Z=H.k1y+H.b2.vely+H.c1.r2x*H.b2.angvel-(H.b1.vely+H.c1.r1x*H.b1.angvel),J=(H.c1.bounce+(H.nx*K+H.ny*Z)+H.surfacey)*H.c1.nMass,(tt=($=H.c1.jnAcc)-J)<0&&(tt=0),J=tt-$,H.c1.jnAcc=tt,q=H.nx*J,Y=H.ny*J,H.b2.velx+=q*H.b2.imass,H.b2.vely+=Y*H.b2.imass,H.b1.velx-=q*H.b1.imass,H.b1.vely-=Y*H.b1.imass,H.b2.angvel+=H.rn1b*J*H.b2.iinertia,H.b1.angvel-=H.rn1a*J*H.b1.iinertia),c.sweep_angvel=c.angvel%e,d.sweep_angvel=d.angvel%e),null!=st&&st.active&&0!=(1&st.immState)&&st.type==Qe.COL&&(c.sweepFrozen||3==c.type||(c.sweepFrozen=!0,n.failed?c.angvel=c.sweep_angvel=0:n.slipped?c.angvel=c.sweep_angvel*=kr.angularCCDSlipScale:c.angvel=c.sweep_angvel),d.sweepFrozen||3==d.type||(d.sweepFrozen=!0,n.failed?d.angvel=d.sweep_angvel=0:n.slipped?d.angvel=d.sweep_angvel*=kr.angularCCDSlipScale:d.angvel=d.sweep_angvel));st=n;st.next=Ee.zpp_pool,Ee.zpp_pool=st}for(;null!=this.toiEvents.head;){var ot=this.toiEvents.pop_unsafe();ot.next=Ee.zpp_pool,Ee.zpp_pool=ot}for(var at=this.kinematics.head;null!=at;){var lt,pt,ht,ut=at.elt,ct=t-ut.sweepTime;0!=ct&&(ut.sweepTime=t,ut.posx+=ut.velx*ct,ut.posy+=ut.vely*ct,0!=ut.angvel&&(lt=ut.sweep_angvel*ct,ut.rot+=lt,1e-4<lt*lt?(ut.axisx=Math.sin(ut.rot),ut.axisy=Math.cos(ut.rot)):(pt=1-(ht=lt*lt)*ht/8,ht=((ct=1-.5*ht)*ut.axisx+lt*ut.axisy)*pt,ut.axisy=(ct*ut.axisy-lt*ut.axisx)*pt,ut.axisx=ht))),ut.sweepTime=0,at=at.next}for(var dt=this.live.head;null!=dt;){var _t,yt,ft,mt,xt=dt.elt;xt.sweepFrozen||0!=(yt=t-xt.sweepTime)&&(xt.sweepTime=t,xt.posx+=xt.velx*yt,xt.posy+=xt.vely*yt,0!=xt.angvel&&(_t=xt.sweep_angvel*yt,xt.rot+=_t,1e-4<_t*_t?(xt.axisx=Math.sin(xt.rot),xt.axisy=Math.cos(xt.rot)):(ft=1-(mt=_t*_t)*mt/8,mt=((yt=1-.5*mt)*xt.axisx+_t*xt.axisy)*ft,xt.axisy=(yt*xt.axisy-_t*xt.axisx)*ft,xt.axisx=mt))),xt.sweepTime=0,dt=dt.next}},ii.prototype.continuousEvent=function(t,e,i,n,r){if(t.body.sweepFrozen&&e.body.sweepFrozen)return n;if(t.body.disableCCD||e.body.disableCCD)return n;if(null==n||null!=n.colarb){for(var s,o,a,l=t.body,p=e.body,h=!1,u=l.constraints.head;null!=u;){var c=u.elt;if(c.ignore&&c.pair_exists(l.id,p.id)){h=!0;break}u=u.next}if(h)s=!1;else{for(var d=t;null!=d&&null==d.group;)d=null!=d.ishape?d.ishape.body:(null!=d.icompound?d.icompound:d.ibody).compound;var _,y=null==d?null:d.group;if(null==y)_=!1;else{for(var f=e;null!=f&&null==f.group;)f=null!=f.ishape?f.ishape.body:(null!=f.icompound?f.icompound:f.ibody).compound;var m=null==f?null:f.group;if(null==m)_=!1;else{for(var x=!1;null!=y&&null!=m;){if(y==m){x=y.ignore;break}y.depth<m.depth?m=m.group:y=y.group}_=x}}s=!_}b=(s?!(!t.sensorEnabled&&!e.sensorEnabled)&&(a=t.filter,o=e.filter,0!=(a.sensorMask&o.sensorGroup)&&0!=(o.sensorMask&a.sensorGroup))?2:!!(!(!t.fluidEnabled&&!e.fluidEnabled)&&(o=t.filter,a=e.filter,0!=(o.fluidMask&a.fluidGroup)&&0!=(a.fluidMask&o.fluidGroup)))&&!(0==l.imass&&0==p.imass&&0==l.iinertia&&0==p.iinertia)?0:(g=t.filter,b=e.filter,0!=(g.collisionMask&b.collisionGroup)&&0!=(b.collisionMask&g.collisionGroup)&&!(0==l.imass&&0==p.imass&&0==l.iinertia&&0==p.iinertia)?1:-1):-1)<=0}else b=!0;if(b)return n;var v,g=t.body,b=e.body;return(i||g.bullet||b.bullet)&&(null==Ee.zpp_pool?v=new Ee:(v=Ee.zpp_pool,Ee.zpp_pool=v.next,v.next=null),v.failed=!1,v.s1=v.s2=null,v.arbiter=null,b=3==g.type||3==b.type,i&&!b?(2!=t.body.type?(v.s2=t,v.s1=e):(v.s1=t,v.s2=e),v.kinematic=!1,Ie.staticSweep(v,this.pre_dt,0,kr.collisionSlopCCD)):(v.s1=t,v.s2=e,v.kinematic=b,v.s1.body.sweepFrozen||v.s2.body.sweepFrozen?(v.s1.body.sweepFrozen&&(b=v.s1,v.s1=v.s2,v.s2=b,v.frozen1=!1,v.frozen2=!0),Ie.staticSweep(v,this.pre_dt,0,kr.collisionSlopCCD)):Ie.dynamicSweep(v,this.pre_dt,0,kr.collisionSlopCCD)),i&&v.toi<0||v.failed?((i=v).next=Ee.zpp_pool,Ee.zpp_pool=i):(this.toiEvents.add(v),v.frozen1=v.s1.body.sweepFrozen,v.frozen2=v.s2.body.sweepFrozen,v.arbiter=null!=n?n.colarb:null)),n},ii.prototype.bodyCbWake=function(t){if(2==t.type&&null!=t.cbSet)if(this.midstep)for(var e=t.cbSet.bodylisteners.head;null!=e;){var i=e.elt;2==i.event?((i=this.push_callback(i)).event=2,i.body=t,e=e.next):e=e.next}else t.component.woken=!0},ii.prototype.bodyCbSleep=function(t){if(2==t.type&&null!=t.cbSet)for(var e=t.cbSet.bodylisteners.head;null!=e;){var i=e.elt;3==i.event?((i=this.push_callback(i)).event=3,i.body=t,e=e.next):e=e.next}},ii.prototype.constraintCbWake=function(t){if(null!=t.cbSet)if(this.midstep)for(var e=t.cbSet.conlisteners.head;null!=e;){var i=e.elt;2==i.event?((i=this.push_callback(i)).event=2,i.constraint=t,e=e.next):e=e.next}else t.component.woken=!0},ii.prototype.constraintCbSleep=function(t){if(null!=t.cbSet)for(var e=t.cbSet.conlisteners.head;null!=e;){var i=e.elt;3==i.event?((i=this.push_callback(i)).event=3,i.constraint=t,e=e.next):e=e.next}},ii.prototype.constraintCbBreak=function(t){if(null!=t.cbSet)for(var e=t.cbSet.conlisteners.head;null!=e;){var i=e.elt;4==i.event?((i=this.push_callback(i)).event=4,i.constraint=t,e=e.next):e=e.next}},ii.prototype.nullListenerType=function(t,e){for(var i=new Tt,n=t.interactors.head;null!=n;)i.add(n.elt),n=n.next;if(t!=e)for(var r=e.interactors.head;null!=r;)i.add(r.elt),r=r.next;for(;null!=i.head;){var s=i.pop_unsafe();if(null!=s.icompound){for(var o=s.icompound,a=o.bodies.head;null!=a;)i.add(a.elt),a=a.next;for(var l=o.compounds.head;null!=l;)i.add(l.elt),l=l.next}else for(var o=null!=s.ibody?s.ibody:s.ishape.body,p=null!=s.ishape?s.ishape:null,h=o.arbiters.head;null!=h;){var u=h.elt;if(0!=u.present)if(null==p||u.ws1==p||u.ws2==p){this.MRCA_chains(u.ws1,u.ws2);for(var c=this.mrca1.head;null!=c;){var d=c.elt;if(d.cbSet==t||d.cbSet==e){for(var _=this.mrca2.head;null!=_;){var y=_.elt;if(d.cbSet==t&&y.cbSet!=e||d.cbSet==e&&y.cbSet!=t)_=_.next;else{var f=$n.get(d,y);if(null!=f){for(;null!=f.arbiters.head;)f.arbiters.pop_unsafe().present--;this.remove_callbackset(f)}_=_.next}}c=c.next}else c=c.next}h=h.next}else h=h.next;else h=h.next}}},ii.prototype.nullInteractorType=function(t,e){if(null==e&&(e=t),null!=t.icompound){for(var i=t.icompound,n=i.bodies.head;null!=n;)this.nullInteractorType(n.elt,e),n=n.next;for(var r=i.compounds.head;null!=r;)this.nullInteractorType(r.elt,e),r=r.next}else for(var i=null!=t.ibody?t.ibody:t.ishape.body,s=null!=t.ishape?t.ishape:null,o=i.arbiters.head;null!=o;){var a=o.elt;if(0!=a.present)if(null==s||a.ws1==s||a.ws2==s){this.MRCA_chains(a.ws1,a.ws2);for(var l=this.mrca1.head;null!=l;){for(var p=l.elt,h=this.mrca2.head;null!=h;){var u=h.elt;p==e||u==e?(null!=(u=$n.get(p,u))&&(a.present--,u.remove_arb(a),null==u.arbiters.head&&this.remove_callbackset(u)),h=h.next):h=h.next}l=l.next}o=o.next}else o=o.next;else o=o.next}},ii.prototype.freshListenerType=function(t,e){for(var i=new Tt,n=t.interactors.head;null!=n;)i.add(n.elt),n=n.next;if(t!=e)for(var r=e.interactors.head;null!=r;)i.add(r.elt),r=r.next;for(;null!=i.head;){var s=i.pop_unsafe();if(null!=s.icompound){for(var o=s.icompound,a=o.bodies.head;null!=a;)i.add(a.elt),a=a.next;for(var l=o.compounds.head;null!=l;)i.add(l.elt),l=l.next}else for(var o=null!=s.ibody?s.ibody:s.ishape.body,p=null!=s.ishape?s.ishape:null,h=o.arbiters.head;null!=h;){var u=h.elt;if(u.presentable)if(null==p||u.ws1==p||u.ws2==p){this.MRCA_chains(u.ws1,u.ws2);for(var c=this.mrca1.head;null!=c;){var d=c.elt;if(d.cbSet==t||d.cbSet==e){for(var _=this.mrca2.head;null!=_;){var y=_.elt;if(d.cbSet==t&&y.cbSet!=e||d.cbSet==e&&y.cbSet!=t)_=_.next;else{var f,m=$n.get(d,y);null==m&&(m=tr.get(d,y),this.add_callbackset(m)),f=!1;for(var x,v=m.arbiters.head;null!=v;){if(v.elt==u){f=!0;break}v=v.next}!f&&(y=m.arbiters,null==er.zpp_pool?x=new er:(x=er.zpp_pool,er.zpp_pool=x.next,x.next=null),x.elt=u,(m=x).next=y.head,y.head=m,y.modified=!0,y.length++,!0)&&u.present++,_=_.next}}c=c.next}else c=c.next}h=h.next}else h=h.next;else h=h.next}}},ii.prototype.freshInteractorType=function(t,e){if(null==e&&(e=t),null!=t.icompound){for(var i=t.icompound,n=i.bodies.head;null!=n;)this.freshInteractorType(n.elt,e),n=n.next;for(var r=i.compounds.head;null!=r;)this.freshInteractorType(r.elt,e),r=r.next}else for(var i=null!=t.ibody?t.ibody:t.ishape.body,s=null!=t.ishape?t.ishape:null,o=i.arbiters.head;null!=o;){var a=o.elt;if(a.presentable)if(null==s||a.ws1==s||a.ws2==s){this.MRCA_chains(a.ws1,a.ws2);for(var l=this.mrca1.head;null!=l;){for(var p=l.elt,h=this.mrca2.head;null!=h;){var u=h.elt;if(p==e||u==e){var c=p.cbSet,d=u.cbSet;c.validate(),d.validate();for(var _,y=null,f=(c.cbpairs.length<d.cbpairs.length?c:d).cbpairs.head;null!=f;){var m=f.elt;if(m.a==c&&m.b==d||m.a==d&&m.b==c){y=m;break}f=f.next}if(null==y&&(null==qn.zpp_pool?_=new qn:(_=qn.zpp_pool,qn.zpp_pool=_.next,_.next=null),_.zip_listeners=!0,Hn.setlt(c,d)?(_.a=c,_.b=d):(_.a=d,_.b=c),y=_,c.cbpairs.add(y),d!=c&&d.cbpairs.add(y)),y.zip_listeners&&(y.zip_listeners=!1,y.__validate()),null!=y.listeners.head){var x,v=$n.get(p,u);null==v&&(v=tr.get(p,u),this.add_callbackset(v)),x=!1;for(var g,b=v.arbiters.head;null!=b;){if(b.elt==a){x=!0;break}b=b.next}!x&&(u=v.arbiters,null==er.zpp_pool?g=new er:(g=er.zpp_pool,er.zpp_pool=g.next,g.next=null),g.elt=a,(v=g).next=u.head,u.head=v,u.modified=!0,u.length++,!0)&&a.present++}h=h.next}else h=h.next}l=l.next}o=o.next}else o=o.next;else o=o.next}},ii.prototype.wakeCompound=function(t){for(var e=t.bodies.head;null!=e;){var i=e.elt;i.world||(i.component.waket=this.stamp+(this.midstep?0:1),3==i.type&&(i.kinematicDelaySleep=!0),i.component.sleeping&&this.really_wake(i,!1)),e=e.next}for(var n=t.constraints.head;null!=n;)this.wake_constraint(n.elt),n=n.next;for(var r=t.compounds.head;null!=r;)this.wakeCompound(r.elt),r=r.next},ii.prototype.wakeIsland=function(t){for(;null!=t.comps.head;){var e=t.comps.pop_unsafe();if(e.waket=this.stamp+(this.midstep?0:1),e.isBody){var i=e.body;this.live.add(i);for(var n=i.arbiters.head;null!=n;){var r,s,o,a,l,p,h,u,c,d=n.elt;d.sleeping&&(d.sleeping=!1,d.up_stamp+=this.stamp-d.sleep_stamp,d.type==Qe.COL?(l=d.colarb).stat?(r=this.c_arbiters_true,null==or.zpp_pool?s=new or:(s=or.zpp_pool,or.zpp_pool=s.next,s.next=null),s.elt=l,(o=s).next=r.head,r.head=o,r.modified=!0,r.length++):(h=this.c_arbiters_false,null==or.zpp_pool?a=new or:(a=or.zpp_pool,or.zpp_pool=a.next,a.next=null),a.elt=l,(l=a).next=h.head,h.head=l,h.modified=!0,h.length++):d.type==Qe.FLUID?(u=this.f_arbiters,h=d.fluidarb,null==rr.zpp_pool?p=new rr:(p=rr.zpp_pool,rr.zpp_pool=p.next,p.next=null),p.elt=h,(h=p).next=u.head,u.head=h,u.modified=!0,u.length++):(u=this.s_arbiters,d=d.sensorarb,null==sr.zpp_pool?c=new sr:(c=sr.zpp_pool,sr.zpp_pool=c.next,c.next=null),c.elt=d,(d=c).next=u.head,u.head=d,u.modified=!0,u.length++)),n=n.next}if(this.bodyCbWake(i),e.sleeping=!1,e.island=null,(e.parent=e).rank=0,1!=i.type)for(var _=i.shapes.head;null!=_;){var y=_.elt;null!=y.node&&this.bphase.sync(y),_=_.next}}else{var f,m=e.constraint,x=this.live_constraints;null==Hi.zpp_pool?f=new Hi:(f=Hi.zpp_pool,Hi.zpp_pool=f.next,f.next=null),f.elt=m;i=f;i.next=x.head,x.head=i,x.modified=!0,x.length++,this.constraintCbWake(m),e.sleeping=!1,e.island=null,(e.parent=e).rank=0}}t.next=$e.zpp_pool,$e.zpp_pool=t},ii.prototype.non_inlined_wake=function(t,e){null==e&&(e=!1),t.world||(t.component.waket=this.stamp+(this.midstep?0:1),3==t.type&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,e))},ii.prototype.really_wake=function(t,e){if(null==e&&(e=!1),null==t.component.island){var i,n,r;t.component.sleeping=!1,3==t.type||1==t.type?(n=this.staticsleep,null==Wi.zpp_pool?i=new Wi:(i=Wi.zpp_pool,Wi.zpp_pool=i.next,i.next=null),i.elt=t,(i=i).next=n.head,n.head=i,n.modified=!0,n.length++):(n=this.live,null==Wi.zpp_pool?r=new Wi:(r=Wi.zpp_pool,Wi.zpp_pool=r.next,r.next=null),r.elt=t,(r=r).next=n.head,n.head=r,n.modified=!0,n.length++);for(var s=t.constraints.head;null!=s;){var o=s.elt;o.space==this&&this.wake_constraint(o),s=s.next}for(var a=t.arbiters.head;null!=a;){var l,p,h,u,c,d,_,y,f,m,x=a.elt;x.sleeping&&(x.sleeping=!1,x.up_stamp+=this.stamp+(this.midstep?0:1)-x.sleep_stamp,x.type==Qe.COL?(c=x.colarb).stat?(l=this.c_arbiters_true,null==or.zpp_pool?p=new or:(p=or.zpp_pool,or.zpp_pool=p.next,p.next=null),p.elt=c,(h=p).next=l.head,l.head=h,l.modified=!0,l.length++):(_=this.c_arbiters_false,null==or.zpp_pool?u=new or:(u=or.zpp_pool,or.zpp_pool=u.next,u.next=null),u.elt=c,(c=u).next=_.head,_.head=c,_.modified=!0,_.length++):x.type==Qe.FLUID?(f=this.f_arbiters,_=x.fluidarb,null==rr.zpp_pool?d=new rr:(d=rr.zpp_pool,rr.zpp_pool=d.next,d.next=null),d.elt=_,(_=d).next=f.head,f.head=_,f.modified=!0,f.length++):(m=this.s_arbiters,f=x.sensorarb,null==sr.zpp_pool?y=new sr:(y=sr.zpp_pool,sr.zpp_pool=y.next,y.next=null),y.elt=f,(f=y).next=m.head,m.head=f,m.modified=!0,m.length++)),x.type!=Qe.SENSOR&&!x.cleared&&x.up_stamp>=this.stamp&&0!=(1&x.immState)&&(2==x.b1.type&&x.b1.component.sleeping&&((m=x.b1).world||(m.component.waket=this.stamp+(this.midstep?0:1),3==m.type&&(m.kinematicDelaySleep=!0),m.component.sleeping&&this.really_wake(m,!1))),2==x.b2.type&&x.b2.component.sleeping&&((x=x.b2).world||(x.component.waket=this.stamp+(this.midstep?0:1),3==x.type&&(x.kinematicDelaySleep=!0),x.component.sleeping&&this.really_wake(x,!1)))),a=a.next}if(e||2!=t.type||this.bodyCbWake(t),!e&&!this.bphase.is_sweep&&1!=t.type)for(var v=t.shapes.head;null!=v;){var g=v.elt;null!=g.node&&this.bphase.sync(g),v=v.next}}else this.wakeIsland(t.component.island)},ii.prototype.wake_constraint=function(t,e){var i,n;return null==e&&(e=!1),!!t.active&&(t.component.waket=this.stamp+(this.midstep?0:1),!!t.component.sleeping&&(null==t.component.island?(t.component.sleeping=!1,i=this.live_constraints,null==Hi.zpp_pool?n=new Hi:(n=Hi.zpp_pool,Hi.zpp_pool=n.next,n.next=null),n.elt=t,(n=n).next=i.head,i.head=n,i.modified=!0,i.length++,t.wake_connected(),e||this.constraintCbWake(t)):this.wakeIsland(t.component.island),!0))},ii.prototype.doForests=function(t){for(var e=this.c_arbiters_false.head;null!=e;){var i,n,r=e.elt;if(!r.cleared&&r.up_stamp==this.stamp&&0!=(1&r.immState)&&2==r.b1.type&&2==r.b2.type){if(r.b1.component==r.b1.component.parent)i=r.b1.component;else{for(var s=r.b1.component,o=null;s!=s.parent;){var a=s.parent;s.parent=o,o=s,s=a}for(;null!=o;){var l=o.parent;o.parent=s,o=l}i=s}if(r.b2.component==r.b2.component.parent)n=r.b2.component;else{for(var p=r.b2.component,h=null;p!=p.parent;){var u=p.parent;p.parent=h,h=p,p=u}for(;null!=h;){var c=h.parent;h.parent=p,h=c}n=p}i!=n&&(i.rank<n.rank?i.parent=n:i.rank>n.rank?n.parent=i:(n.parent=i).rank++)}e=e.next}for(var d=this.f_arbiters.head;null!=d;){var _,y,f=d.elt;if(!f.cleared&&f.up_stamp==this.stamp&&0!=(1&f.immState)&&2==f.b1.type&&2==f.b2.type){if(f.b1.component==f.b1.component.parent)_=f.b1.component;else{for(var m=f.b1.component,x=null;m!=m.parent;){var v=m.parent;m.parent=x,x=m,m=v}for(;null!=x;){var g=x.parent;x.parent=m,x=g}_=m}if(f.b2.component==f.b2.component.parent)y=f.b2.component;else{for(var b=f.b2.component,z=null;b!=b.parent;){var w=b.parent;b.parent=z,z=b,b=w}for(;null!=z;){var C=z.parent;z.parent=b,z=C}y=b}_!=y&&(_.rank<y.rank?_.parent=y:_.rank>y.rank?y.parent=_:(y.parent=_).rank++)}d=d.next}for(var P=this.live_constraints.head;null!=P;)P.elt.forest(),P=P.next;for(;null!=this.live.head;){var T=this.live,S=T.head.elt;T.pop();var M,T=S.component;if(T==T.parent)M=T;else{for(var A=T,O=null;A!=A.parent;){var k=A.parent;A.parent=O,O=A,A=k}for(;null!=O;){var E=O.parent;O.parent=A,O=E}M=A}null==M.island&&(null==$e.zpp_pool?M.island=new $e:(M.island=$e.zpp_pool,$e.zpp_pool=M.island.next,M.island.next=null),M.island.waket=0,B=this.islands,(D=M.island)._inuse=!0,D.next=B.next,B.next=D,B.modified=!0,B.length++,M.island.sleep=!0),T.island=M.island;var I,D=T.island.comps;null==_n.zpp_pool?I=new _n:(I=_n.zpp_pool,_n.zpp_pool=I.next,I.next=null),I.elt=T;var B=I;B.next=D.head,D.head=B,D.modified=!0,D.length++;S=S.atRest(t);T.island.sleep=T.island.sleep&&S,T.waket>T.island.waket&&(T.island.waket=T.waket)}for(;null!=this.live_constraints.head;){var L=this.live_constraints,R=L.head.elt;L.pop();var F,j=R.component;if(j==j.parent)F=j;else{for(var N=j,G=null;N!=N.parent;){var U=N.parent;N.parent=G,G=N,N=U}for(;null!=G;){var X=G.parent;G.parent=N,G=X}F=N}j.island=F.island;var V,L=j.island.comps;null==_n.zpp_pool?V=new _n:(V=_n.zpp_pool,_n.zpp_pool=V.next,V.next=null),V.elt=j;R=V;R.next=L.head,L.head=R,L.modified=!0,L.length++,j.waket>j.island.waket&&(j.island.waket=j.waket)}for(;null!=this.islands.next;){var W=this.islands,H=W.next;if(W.pop(),H.sleep)for(var q=H.comps.head;null!=q;){var Y=q.elt;if(Y.isBody){var K=Y.body;K.velx=0,K.vely=0,K.angvel=0,Y.sleeping=!0;for(var Z=K.shapes.head;null!=Z;)this.bphase.sync(Z.elt),Z=Z.next;this.bodyCbSleep(K)}else this.constraintCbSleep(Y.constraint),Y.sleeping=!0;q=q.next}else{for(;null!=H.comps.head;){var J,Q,$,tt,et=H.comps,it=et.head.elt;et.pop(),it.waket=H.waket,it.isBody?(tt=this.live,Q=it.body,null==Wi.zpp_pool?J=new Wi:(J=Wi.zpp_pool,Wi.zpp_pool=J.next,J.next=null),J.elt=Q,(Q=J).next=tt.head,tt.head=Q,tt.modified=!0,tt.length++):(Q=this.live_constraints,tt=it.constraint,null==Hi.zpp_pool?$=new Hi:($=Hi.zpp_pool,Hi.zpp_pool=$.next,$.next=null),$.elt=tt,(tt=$).next=Q.head,Q.head=tt,Q.modified=!0,Q.length++),it.sleeping=!1,it.island=null,(it.parent=it).rank=0}H.next=$e.zpp_pool,$e.zpp_pool=H}}},ii.prototype.sleepArbiters=function(){var t=null,e=this.c_arbiters_true,i=e.head,n=null!=this.c_arbiters_false;for(n&&null==i&&(n=!1,i=this.c_arbiters_false.head,e=this.c_arbiters_false,t=null);null!=i;){var r,s,o=i.elt;o.b1.component.sleeping&&o.b2.component.sleeping?(o.sleep_stamp=this.stamp,o.sleeping=!0,null==t?(s=(r=e.head).next,e.head=s,null==e.head&&(e.pushmod=!0)):(s=(r=t.next).next,null==(t.next=s)&&(e.pushmod=!0)),(o=r).elt=null,o.next=or.zpp_pool,or.zpp_pool=o,e.modified=!0,e.length--,e.pushmod=!0,i=s,n&&null==i&&(n=!1,i=this.c_arbiters_false.head,e=this.c_arbiters_false,t=null)):(i=(t=i).next,n&&null==i&&(n=!1,i=this.c_arbiters_false.head,e=this.c_arbiters_false,t=null))}for(var a=null,l=this.f_arbiters,p=l.head;null!=p;){var h,u,c=p.elt;c.b1.component.sleeping&&c.b2.component.sleeping?(c.sleep_stamp=this.stamp,c.sleeping=!0,null==a?(u=(h=l.head).next,l.head=u,null==l.head&&(l.pushmod=!0)):(u=(h=a.next).next,null==(a.next=u)&&(l.pushmod=!0)),(c=h).elt=null,c.next=rr.zpp_pool,rr.zpp_pool=c,l.modified=!0,l.length--,l.pushmod=!0,p=u):p=(a=p).next}for(var d=null,_=this.s_arbiters,y=_.head;null!=y;){var f,m,x=y.elt;x.b1.component.sleeping&&x.b2.component.sleeping?(x.sleep_stamp=this.stamp,x.sleeping=!0,null==d?(m=(f=_.head).next,_.head=m,null==_.head&&(_.pushmod=!0)):(m=(f=d.next).next,null==(d.next=m)&&(_.pushmod=!0)),(x=f).elt=null,x.next=sr.zpp_pool,sr.zpp_pool=x,_.modified=!0,_.length--,_.pushmod=!0,y=m):y=(d=y).next}},ii.prototype.static_validation=function(t){if(null!=t.shapes.head&&t.zip_aabb){t.zip_aabb=!1,t.aabb.minx=1/0,t.aabb.miny=1/0,t.aabb.maxx=-1/0,t.aabb.maxy=-1/0;for(var e=t.shapes.head;null!=e;){var i=e.elt;if(i.zip_aabb&&null!=i.body)if(i.zip_aabb=!1,0==i.type){var n=i.circle;if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var r=n.polygon;if(null==r.lverts.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y;else if(null==r.lverts.next.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y,r.localCOMx+=r.lverts.next.next.x,r.localCOMy+=r.lverts.next.next.y,r.localCOMx*=.5,r.localCOMy*=.5;else{r.localCOMx=0;var s=r.localCOMy=0,o=r.lverts.next,a=o,l=o=o.next;for(o=o.next;null!=o;){var p=o;s+=l.x*(p.y-a.y);var h=p.y*l.x-p.x*l.y;r.localCOMx+=(l.x+p.x)*h,r.localCOMy+=(l.y+p.y)*h,a=l,l=p,o=o.next}var u=o=r.lverts.next;s+=l.x*(u.y-a.y);var c=u.y*l.x-u.x*l.y;r.localCOMx+=(l.x+u.x)*c,r.localCOMy+=(l.y+u.y)*c,a=l;var d=o=o.next;s+=u.x*(d.y-a.y);c=d.y*u.x-d.x*u.y;r.localCOMx+=(u.x+d.x)*c,r.localCOMy+=(u.y+d.y)*c;d=s=1/(3*s);r.localCOMx*=d,r.localCOMy*=d}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}c=n.body;c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}d=n.radius,c=n.radius;n.aabb.minx=n.worldCOMx-d,n.aabb.miny=n.worldCOMy-c,n.aabb.maxx=n.worldCOMx+d,n.aabb.maxy=n.worldCOMy+c}else{var _=i.polygon;if(_.zip_gverts&&null!=_.body){_.zip_gverts=!1,_.validate_lverts();var y=_.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot));for(var f=_.lverts.next,m=_.gverts.next;null!=m;){var x=m,v=f,f=f.next;x.x=_.body.posx+(_.body.axisy*v.x-_.body.axisx*v.y),x.y=_.body.posy+(v.x*_.body.axisx+v.y*_.body.axisy),m=m.next}}y=_.gverts.next;_.aabb.minx=y.x,_.aabb.miny=y.y,_.aabb.maxx=y.x,_.aabb.maxy=y.y;for(var g=_.gverts.next.next;null!=g;){var b=g;b.x<_.aabb.minx&&(_.aabb.minx=b.x),b.x>_.aabb.maxx&&(_.aabb.maxx=b.x),b.y<_.aabb.miny&&(_.aabb.miny=b.y),b.y>_.aabb.maxy&&(_.aabb.maxy=b.y),g=g.next}}y=t.aabb,i=i.aabb;i.minx<y.minx&&(y.minx=i.minx),i.maxx>y.maxx&&(y.maxx=i.maxx),i.miny<y.miny&&(y.miny=i.miny),i.maxy>y.maxy&&(y.maxy=i.maxy),e=e.next}}t.validate_mass(),t.validate_inertia();for(var z=t.shapes.head;null!=z;){var w=z.elt;if(1==w.type){var C=w.polygon;C.zip_sanitation&&(C.zip_sanitation=!1,C.splice_collinear_real());var P=w.polygon;if(P.zip_gaxi&&null!=P.body){P.zip_gaxi=!1,P.validate_laxi();w=P.body;if(w.zip_axis&&(w.zip_axis=!1,w.axisx=Math.sin(w.rot),w.axisy=Math.cos(w.rot)),P.zip_gverts&&null!=P.body){P.zip_gverts=!1,P.validate_lverts();var T=P.body;T.zip_axis&&(T.zip_axis=!1,T.axisx=Math.sin(T.rot),T.axisy=Math.cos(T.rot));for(var S=P.lverts.next,M=P.gverts.next;null!=M;){var A=M,O=S,S=S.next;A.x=P.body.posx+(P.body.axisy*O.x-P.body.axisx*O.y),A.y=P.body.posy+(O.x*P.body.axisx+O.y*P.body.axisy),M=M.next}}for(var k=P.edges.head,E=I=P.gverts.next,I=I.next;null!=I;){var D=I,B=k.elt,k=k.next;B.gp0=E,B.gp1=D,B.gnormx=P.body.axisy*B.lnormx-P.body.axisx*B.lnormy,B.gnormy=B.lnormx*P.body.axisx+B.lnormy*P.body.axisy,B.gprojection=P.body.posx*B.gnormx+P.body.posy*B.gnormy+B.lprojection,null!=B.wrap_gnorm&&(B.wrap_gnorm.zpp_inner.x=B.gnormx,B.wrap_gnorm.zpp_inner.y=B.gnormy),B.tp0=B.gp0.y*B.gnormx-B.gp0.x*B.gnormy,B.tp1=B.gp1.y*B.gnormx-B.gp1.x*B.gnormy,E=D,I=I.next}T=k.elt;T.gp0=E,T.gp1=P.gverts.next,T.gnormx=P.body.axisy*T.lnormx-P.body.axisx*T.lnormy,T.gnormy=T.lnormx*P.body.axisx+T.lnormy*P.body.axisy,T.gprojection=P.body.posx*T.gnormx+P.body.posy*T.gnormy+T.lprojection,null!=T.wrap_gnorm&&(T.wrap_gnorm.zpp_inner.x=T.gnormx,T.wrap_gnorm.zpp_inner.y=T.gnormy),T.tp0=T.gp0.y*T.gnormx-T.gp0.x*T.gnormy,T.tp1=T.gp1.y*T.gnormx-T.gp1.x*T.gnormy}}z=z.next}t.sweepFrozen=!0},ii.prototype.validation=function(){var t=this.cbsets;if(!t.cbsets.empty()){for(var e=t.cbsets.parent;null!=e.prev;)e=e.prev;for(;null!=e;)if(e.data.validate(),null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}for(var i=this.live.head;null!=i;){var n=i.elt;n.sweepRadius=0;for(var r=n.shapes.head;null!=r;){var s=r.elt;if(1==s.type){var o=s.polygon;o.zip_sanitation&&(o.zip_sanitation=!1,o.splice_collinear_real());var a=s.polygon;if(a.zip_gaxi&&null!=a.body){a.zip_gaxi=!1,a.validate_laxi();o=a.body;if(o.zip_axis&&(o.zip_axis=!1,o.axisx=Math.sin(o.rot),o.axisy=Math.cos(o.rot)),a.zip_gverts&&null!=a.body){a.zip_gverts=!1,a.validate_lverts();var l=a.body;l.zip_axis&&(l.zip_axis=!1,l.axisx=Math.sin(l.rot),l.axisy=Math.cos(l.rot));for(var p=a.lverts.next,h=a.gverts.next;null!=h;){var u=h,c=p,p=p.next;u.x=a.body.posx+(a.body.axisy*c.x-a.body.axisx*c.y),u.y=a.body.posy+(c.x*a.body.axisx+c.y*a.body.axisy),h=h.next}}for(var d=a.edges.head,_=y=a.gverts.next,y=y.next;null!=y;){var f=y,m=d.elt,d=d.next;m.gp0=_,m.gp1=f,m.gnormx=a.body.axisy*m.lnormx-a.body.axisx*m.lnormy,m.gnormy=m.lnormx*a.body.axisx+m.lnormy*a.body.axisy,m.gprojection=a.body.posx*m.gnormx+a.body.posy*m.gnormy+m.lprojection,null!=m.wrap_gnorm&&(m.wrap_gnorm.zpp_inner.x=m.gnormx,m.wrap_gnorm.zpp_inner.y=m.gnormy),m.tp0=m.gp0.y*m.gnormx-m.gp0.x*m.gnormy,m.tp1=m.gp1.y*m.gnormx-m.gp1.x*m.gnormy,_=f,y=y.next}l=d.elt;l.gp0=_,l.gp1=a.gverts.next,l.gnormx=a.body.axisy*l.lnormx-a.body.axisx*l.lnormy,l.gnormy=l.lnormx*a.body.axisx+l.lnormy*a.body.axisy,l.gprojection=a.body.posx*l.gnormx+a.body.posy*l.gnormy+l.lprojection,null!=l.wrap_gnorm&&(l.wrap_gnorm.zpp_inner.x=l.gnormx,l.wrap_gnorm.zpp_inner.y=l.gnormy),l.tp0=l.gp0.y*l.gnormx-l.gp0.x*l.gnormy,l.tp1=l.gp1.y*l.gnormx-l.gp1.x*l.gnormy}}s.validate_sweepRadius(),s.sweepRadius>n.sweepRadius&&(n.sweepRadius=s.sweepRadius),r=r.next}if(n.validate_mass(),n.validate_inertia(),null!=n.shapes.head){if(n.zip_aabb){n.zip_aabb=!1,n.aabb.minx=1/0,n.aabb.miny=1/0,n.aabb.maxx=-1/0,n.aabb.maxy=-1/0;for(var x=n.shapes.head;null!=x;){var v=x.elt;if(v.zip_aabb&&null!=v.body)if(v.zip_aabb=!1,0==v.type){var g=v.circle;if(g.zip_worldCOM&&null!=g.body){if(g.zip_worldCOM=!1,g.zip_localCOM){if(g.zip_localCOM=!1,1==g.type){var b=g.polygon;if(null==b.lverts.next.next)b.localCOMx=b.lverts.next.x,b.localCOMy=b.lverts.next.y;else if(null==b.lverts.next.next.next)b.localCOMx=b.lverts.next.x,b.localCOMy=b.lverts.next.y,b.localCOMx+=b.lverts.next.next.x,b.localCOMy+=b.lverts.next.next.y,b.localCOMx*=.5,b.localCOMy*=.5;else{b.localCOMx=0;var z=b.localCOMy=0,w=b.lverts.next,C=w,P=w=w.next;for(w=w.next;null!=w;){var T=w;z+=P.x*(T.y-C.y);var S=T.y*P.x-T.x*P.y;b.localCOMx+=(P.x+T.x)*S,b.localCOMy+=(P.y+T.y)*S,C=P,P=T,w=w.next}var M=w=b.lverts.next;z+=P.x*(M.y-C.y);var A=M.y*P.x-M.x*P.y;b.localCOMx+=(P.x+M.x)*A,b.localCOMy+=(P.y+M.y)*A,C=P;var O=w=w.next;z+=M.x*(O.y-C.y);A=O.y*M.x-O.x*M.y;b.localCOMx+=(M.x+O.x)*A,b.localCOMy+=(M.y+O.y)*A;O=z=1/(3*z);b.localCOMx*=O,b.localCOMy*=O}}null!=g.wrap_localCOM&&(g.wrap_localCOM.zpp_inner.x=g.localCOMx,g.wrap_localCOM.zpp_inner.y=g.localCOMy)}A=g.body;A.zip_axis&&(A.zip_axis=!1,A.axisx=Math.sin(A.rot),A.axisy=Math.cos(A.rot)),g.worldCOMx=g.body.posx+(g.body.axisy*g.localCOMx-g.body.axisx*g.localCOMy),g.worldCOMy=g.body.posy+(g.localCOMx*g.body.axisx+g.localCOMy*g.body.axisy)}O=g.radius,A=g.radius;g.aabb.minx=g.worldCOMx-O,g.aabb.miny=g.worldCOMy-A,g.aabb.maxx=g.worldCOMx+O,g.aabb.maxy=g.worldCOMy+A}else{var k=v.polygon;if(k.zip_gverts&&null!=k.body){k.zip_gverts=!1,k.validate_lverts();var E=k.body;E.zip_axis&&(E.zip_axis=!1,E.axisx=Math.sin(E.rot),E.axisy=Math.cos(E.rot));for(var I=k.lverts.next,D=k.gverts.next;null!=D;){var B=D,L=I,I=I.next;B.x=k.body.posx+(k.body.axisy*L.x-k.body.axisx*L.y),B.y=k.body.posy+(L.x*k.body.axisx+L.y*k.body.axisy),D=D.next}}E=k.gverts.next;k.aabb.minx=E.x,k.aabb.miny=E.y,k.aabb.maxx=E.x,k.aabb.maxy=E.y;for(var R=k.gverts.next.next;null!=R;){var F=R;F.x<k.aabb.minx&&(k.aabb.minx=F.x),F.x>k.aabb.maxx&&(k.aabb.maxx=F.x),F.y<k.aabb.miny&&(k.aabb.miny=F.y),F.y>k.aabb.maxy&&(k.aabb.maxy=F.y),R=R.next}}E=n.aabb,v=v.aabb;v.minx<E.minx&&(E.minx=v.minx),v.maxx>E.maxx&&(E.maxx=v.maxx),v.miny<E.miny&&(E.miny=v.miny),v.maxy>E.maxy&&(E.maxy=v.maxy),x=x.next}}n.validate_worldCOM()}if(n.validate_gravMass(),n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot)),n.component.woken&&null!=n.cbSet)for(var j=n.cbSet.bodylisteners.head;null!=j;){var N=j.elt;2==N.event?((N=this.push_callback(N)).event=2,N.body=n,j=j.next):j=j.next}n.component.woken=!1;for(var G=n.shapes.head;null!=G;)this.bphase.sync(G.elt),G=G.next;i=i.next}for(var U=this.kinematics.head;null!=U;){var X=U.elt;X.sweepRadius=0;for(var V=X.shapes.head;null!=V;){var W=V.elt;if(1==W.type){var H=W.polygon;H.zip_sanitation&&(H.zip_sanitation=!1,H.splice_collinear_real());var q=W.polygon;if(q.zip_gaxi&&null!=q.body){q.zip_gaxi=!1,q.validate_laxi();H=q.body;if(H.zip_axis&&(H.zip_axis=!1,H.axisx=Math.sin(H.rot),H.axisy=Math.cos(H.rot)),q.zip_gverts&&null!=q.body){q.zip_gverts=!1,q.validate_lverts();var Y=q.body;Y.zip_axis&&(Y.zip_axis=!1,Y.axisx=Math.sin(Y.rot),Y.axisy=Math.cos(Y.rot));for(var K=q.lverts.next,Z=q.gverts.next;null!=Z;){var J=Z,Q=K,K=K.next;J.x=q.body.posx+(q.body.axisy*Q.x-q.body.axisx*Q.y),J.y=q.body.posy+(Q.x*q.body.axisx+Q.y*q.body.axisy),Z=Z.next}}for(var $=q.edges.head,tt=et=q.gverts.next,et=et.next;null!=et;){var it=et,nt=$.elt,$=$.next;nt.gp0=tt,nt.gp1=it,nt.gnormx=q.body.axisy*nt.lnormx-q.body.axisx*nt.lnormy,nt.gnormy=nt.lnormx*q.body.axisx+nt.lnormy*q.body.axisy,nt.gprojection=q.body.posx*nt.gnormx+q.body.posy*nt.gnormy+nt.lprojection,null!=nt.wrap_gnorm&&(nt.wrap_gnorm.zpp_inner.x=nt.gnormx,nt.wrap_gnorm.zpp_inner.y=nt.gnormy),nt.tp0=nt.gp0.y*nt.gnormx-nt.gp0.x*nt.gnormy,nt.tp1=nt.gp1.y*nt.gnormx-nt.gp1.x*nt.gnormy,tt=it,et=et.next}Y=$.elt;Y.gp0=tt,Y.gp1=q.gverts.next,Y.gnormx=q.body.axisy*Y.lnormx-q.body.axisx*Y.lnormy,Y.gnormy=Y.lnormx*q.body.axisx+Y.lnormy*q.body.axisy,Y.gprojection=q.body.posx*Y.gnormx+q.body.posy*Y.gnormy+Y.lprojection,null!=Y.wrap_gnorm&&(Y.wrap_gnorm.zpp_inner.x=Y.gnormx,Y.wrap_gnorm.zpp_inner.y=Y.gnormy),Y.tp0=Y.gp0.y*Y.gnormx-Y.gp0.x*Y.gnormy,Y.tp1=Y.gp1.y*Y.gnormx-Y.gp1.x*Y.gnormy}}W.validate_sweepRadius(),W.sweepRadius>X.sweepRadius&&(X.sweepRadius=W.sweepRadius),V=V.next}if(X.validate_mass(),X.validate_inertia(),null!=X.shapes.head){if(X.zip_aabb){X.zip_aabb=!1,X.aabb.minx=1/0,X.aabb.miny=1/0,X.aabb.maxx=-1/0,X.aabb.maxy=-1/0;for(var rt=X.shapes.head;null!=rt;){var st=rt.elt;if(st.zip_aabb&&null!=st.body)if(st.zip_aabb=!1,0==st.type){var ot=st.circle;if(ot.zip_worldCOM&&null!=ot.body){if(ot.zip_worldCOM=!1,ot.zip_localCOM){if(ot.zip_localCOM=!1,1==ot.type){var at=ot.polygon;if(null==at.lverts.next.next)at.localCOMx=at.lverts.next.x,at.localCOMy=at.lverts.next.y;else if(null==at.lverts.next.next.next)at.localCOMx=at.lverts.next.x,at.localCOMy=at.lverts.next.y,at.localCOMx+=at.lverts.next.next.x,at.localCOMy+=at.lverts.next.next.y,at.localCOMx*=.5,at.localCOMy*=.5;else{at.localCOMx=0;var lt=at.localCOMy=0,pt=at.lverts.next,ht=pt,ut=pt=pt.next;for(pt=pt.next;null!=pt;){var ct=pt;lt+=ut.x*(ct.y-ht.y);var dt=ct.y*ut.x-ct.x*ut.y;at.localCOMx+=(ut.x+ct.x)*dt,at.localCOMy+=(ut.y+ct.y)*dt,ht=ut,ut=ct,pt=pt.next}var _t=pt=at.lverts.next;lt+=ut.x*(_t.y-ht.y);var yt=_t.y*ut.x-_t.x*ut.y;at.localCOMx+=(ut.x+_t.x)*yt,at.localCOMy+=(ut.y+_t.y)*yt,ht=ut;var ft=pt=pt.next;lt+=_t.x*(ft.y-ht.y);yt=ft.y*_t.x-ft.x*_t.y;at.localCOMx+=(_t.x+ft.x)*yt,at.localCOMy+=(_t.y+ft.y)*yt;ft=lt=1/(3*lt);at.localCOMx*=ft,at.localCOMy*=ft}}null!=ot.wrap_localCOM&&(ot.wrap_localCOM.zpp_inner.x=ot.localCOMx,ot.wrap_localCOM.zpp_inner.y=ot.localCOMy)}yt=ot.body;yt.zip_axis&&(yt.zip_axis=!1,yt.axisx=Math.sin(yt.rot),yt.axisy=Math.cos(yt.rot)),ot.worldCOMx=ot.body.posx+(ot.body.axisy*ot.localCOMx-ot.body.axisx*ot.localCOMy),ot.worldCOMy=ot.body.posy+(ot.localCOMx*ot.body.axisx+ot.localCOMy*ot.body.axisy)}ft=ot.radius,yt=ot.radius;ot.aabb.minx=ot.worldCOMx-ft,ot.aabb.miny=ot.worldCOMy-yt,ot.aabb.maxx=ot.worldCOMx+ft,ot.aabb.maxy=ot.worldCOMy+yt}else{var mt=st.polygon;if(mt.zip_gverts&&null!=mt.body){mt.zip_gverts=!1,mt.validate_lverts();var xt=mt.body;xt.zip_axis&&(xt.zip_axis=!1,xt.axisx=Math.sin(xt.rot),xt.axisy=Math.cos(xt.rot));for(var vt=mt.lverts.next,gt=mt.gverts.next;null!=gt;){var bt=gt,zt=vt,vt=vt.next;bt.x=mt.body.posx+(mt.body.axisy*zt.x-mt.body.axisx*zt.y),bt.y=mt.body.posy+(zt.x*mt.body.axisx+zt.y*mt.body.axisy),gt=gt.next}}xt=mt.gverts.next;mt.aabb.minx=xt.x,mt.aabb.miny=xt.y,mt.aabb.maxx=xt.x,mt.aabb.maxy=xt.y;for(var wt=mt.gverts.next.next;null!=wt;){var Ct=wt;Ct.x<mt.aabb.minx&&(mt.aabb.minx=Ct.x),Ct.x>mt.aabb.maxx&&(mt.aabb.maxx=Ct.x),Ct.y<mt.aabb.miny&&(mt.aabb.miny=Ct.y),Ct.y>mt.aabb.maxy&&(mt.aabb.maxy=Ct.y),wt=wt.next}}xt=X.aabb,st=st.aabb;st.minx<xt.minx&&(xt.minx=st.minx),st.maxx>xt.maxx&&(xt.maxx=st.maxx),st.miny<xt.miny&&(xt.miny=st.miny),st.maxy>xt.maxy&&(xt.maxy=st.maxy),rt=rt.next}}X.validate_worldCOM()}X.validate_gravMass(),X.zip_axis&&(X.zip_axis=!1,X.axisx=Math.sin(X.rot),X.axisy=Math.cos(X.rot));for(var Pt=X.shapes.head;null!=Pt;)this.bphase.sync(Pt.elt),Pt=Pt.next;U=U.next}for(var Tt=this.live_constraints.head;null!=Tt;){var St=Tt.elt;if(St.active){if(St.component.woken&&null!=St.cbSet)for(var Mt=St.cbSet.conlisteners.head;null!=Mt;){var At=Mt.elt;2==At.event?((At=this.push_callback(At)).event=2,At.constraint=St,Mt=Mt.next):Mt=Mt.next}St.component.woken=!1}Tt=Tt.next}},ii.prototype.updateVel=function(t){for(var e=1-t*this.global_lin_drag,i=1-t*this.global_ang_drag,n=this.live.head;null!=n;){var r,s,o=n.elt;0!=o.smass&&(s=t*o.imass,o.velx=e*o.velx+(o.forcex+this.gravityx*o.gravMass)*s,o.vely=e*o.vely+(o.forcey+this.gravityy*o.gravMass)*s),0!=o.sinertia&&(s=r=0,r=o.worldCOMx-o.posx,s=o.worldCOMy-o.posy,o.angvel=i*o.angvel+(o.torque+(this.gravityy*r-this.gravityx*s)*o.gravMass)*t*o.iinertia),n=n.next}},ii.prototype.updatePos=function(t){for(var e=2*Math.PI/t,i=this.live.head;null!=i;){var n=i.elt;n.pre_posx=n.posx,n.pre_posy=n.posy,n.pre_rot=n.rot,n.sweepTime=0,n.sweep_angvel=n.angvel%e;var r,s=t-n.sweepTime;if(0!=s&&(n.sweepTime=t,n.posx+=n.velx*s,n.posy+=n.vely*s,0!=n.angvel&&(r=n.sweep_angvel*s,n.rot+=r,1e-4<r*r?(n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot)):(o=1-(a=r*r)*a/8,a=((s=1-.5*a)*n.axisx+r*n.axisy)*o,n.axisy=(s*n.axisy-r*n.axisx)*o,n.axisx=a))),n.disableCCD)n.sweepFrozen=!0,n.bullet=!1;else{var o=kr.staticCCDLinearThreshold*n.sweepRadius,a=kr.staticCCDAngularThreshold;if((n.velx*n.velx+n.vely*n.vely)*t*t>o*o||n.angvel*n.angvel*t*t>a*a||3==n.type){var l=n.sweep_angvel;l<0&&(l=-l);for(var p=1/l,h=n.shapes.head;null!=h;){var u=h.elt,c=u.aabb,d=c.minx,_=c.miny,y=c.maxx,f=c.maxy,m=l*t*u.sweepCoef*.008333333333333333|0;8<m&&(m=8);var x,v,g=l*t/m,b=t-n.sweepTime;if(0!=b&&(n.sweepTime=t,n.posx+=n.velx*b,n.posy+=n.vely*b,0!=n.angvel&&(x=n.sweep_angvel*b,n.rot+=x,1e-4<x*x?(n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot)):(v=1-(P=x*x)*P/8,P=((b=1-.5*P)*n.axisx+x*n.axisy)*v,n.axisy=(b*n.axisy-x*n.axisx)*v,n.axisx=P))),0==u.type){var z=u.circle;z.worldCOMx=z.body.posx+(z.body.axisy*z.localCOMx-z.body.axisx*z.localCOMy),z.worldCOMy=z.body.posy+(z.localCOMx*z.body.axisx+z.localCOMy*z.body.axisy),z.aabb.minx=z.worldCOMx-z.radius,z.aabb.miny=z.worldCOMy-z.radius,z.aabb.maxx=z.worldCOMx+z.radius,z.aabb.maxy=z.worldCOMy+z.radius}else{var w=u.polygon,C=w.lverts.next,P=w.gverts.next,z=C;C=C.next,P.x=w.body.posx+(w.body.axisy*z.x-w.body.axisx*z.y),P.y=w.body.posy+(z.x*w.body.axisx+z.y*w.body.axisy),w.aabb.minx=P.x,w.aabb.miny=P.y,w.aabb.maxx=P.x,w.aabb.maxy=P.y;for(var T=w.gverts.next.next;null!=T;){var S=T,M=C,C=C.next;S.x=w.body.posx+(w.body.axisy*M.x-w.body.axisx*M.y),S.y=w.body.posy+(M.x*w.body.axisx+M.y*w.body.axisy),S.x<w.aabb.minx&&(w.aabb.minx=S.x),S.x>w.aabb.maxx&&(w.aabb.maxx=S.x),S.y<w.aabb.miny&&(w.aabb.miny=S.y),S.y>w.aabb.maxy&&(w.aabb.maxy=S.y),T=T.next}}d<c.minx?c.minx=d:d=c.minx,_<c.miny?c.miny=_:_=c.miny,y>c.maxx?c.maxx=y:y=c.maxx,f>c.maxy?c.maxy=f:f=c.maxy;for(var A=1,O=m;A<O;){var k,E=g*A++*p,I=E-n.sweepTime;if(0!=I&&(n.sweepTime=E,n.posx+=n.velx*I,n.posy+=n.vely*I,0!=n.angvel&&(k=n.sweep_angvel*I,n.rot+=k,1e-4<k*k?(n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot)):(E=1-(R=k*k)*R/8,R=((I=1-.5*R)*n.axisx+k*n.axisy)*E,n.axisy=(I*n.axisy-k*n.axisx)*E,n.axisx=R))),0==u.type){var D=u.circle;D.worldCOMx=D.body.posx+(D.body.axisy*D.localCOMx-D.body.axisx*D.localCOMy),D.worldCOMy=D.body.posy+(D.localCOMx*D.body.axisx+D.localCOMy*D.body.axisy),D.aabb.minx=D.worldCOMx-D.radius,D.aabb.miny=D.worldCOMy-D.radius,D.aabb.maxx=D.worldCOMx+D.radius,D.aabb.maxy=D.worldCOMy+D.radius}else{var B=u.polygon,L=B.lverts.next,R=B.gverts.next,D=L;L=L.next,R.x=B.body.posx+(B.body.axisy*D.x-B.body.axisx*D.y),R.y=B.body.posy+(D.x*B.body.axisx+D.y*B.body.axisy),B.aabb.minx=R.x,B.aabb.miny=R.y,B.aabb.maxx=R.x,B.aabb.maxy=R.y;for(var F=B.gverts.next.next;null!=F;){var j=F,N=L,L=L.next;j.x=B.body.posx+(B.body.axisy*N.x-B.body.axisx*N.y),j.y=B.body.posy+(N.x*B.body.axisx+N.y*B.body.axisy),j.x<B.aabb.minx&&(B.aabb.minx=j.x),j.x>B.aabb.maxx&&(B.aabb.maxx=j.x),j.y<B.aabb.miny&&(B.aabb.miny=j.y),j.y>B.aabb.maxy&&(B.aabb.maxy=j.y),F=F.next}}d<c.minx?c.minx=d:d=c.minx,_<c.miny?c.miny=_:_=c.miny,y>c.maxx?c.maxx=y:y=c.maxx,f>c.maxy?c.maxy=f:f=c.maxy}this.bphase.sync(u),h=h.next}n.sweepFrozen=!1,2==n.type&&n.bulletEnabled&&(o=kr.bulletCCDLinearThreshold*n.sweepRadius,a=kr.bulletCCDAngularThreshold,((n.velx*n.velx+n.vely*n.vely)*t*t>o*o||n.angvel*n.angvel*t*t>a*a)&&(n.bullet=!0))}else n.sweepFrozen=!0,n.bullet=!1}i=i.next}for(var G=this.kinematics.head;null!=G;){var U=G.elt;U.pre_posx=U.posx,U.pre_posy=U.posy,U.pre_rot=U.rot,U.sweepTime=0,U.sweep_angvel=U.angvel%e;var X,V=t-U.sweepTime;if(0!=V&&(U.sweepTime=t,U.posx+=U.velx*V,U.posy+=U.vely*V,0!=U.angvel&&(X=U.sweep_angvel*V,U.rot+=X,1e-4<X*X?(U.axisx=Math.sin(U.rot),U.axisy=Math.cos(U.rot)):(W=1-(H=X*X)*H/8,H=((V=1-.5*H)*U.axisx+X*U.axisy)*W,U.axisy=(V*U.axisy-X*U.axisx)*W,U.axisx=H))),U.disableCCD)U.sweepFrozen=!0,U.bullet=!1;else{var W=kr.staticCCDLinearThreshold*U.sweepRadius,H=kr.staticCCDAngularThreshold;if((U.velx*U.velx+U.vely*U.vely)*t*t>W*W||U.angvel*U.angvel*t*t>H*H||3==U.type){var q=U.sweep_angvel;q<0&&(q=-q);for(var Y=1/q,K=U.shapes.head;null!=K;){var Z=K.elt,J=Z.aabb,Q=J.minx,$=J.miny,tt=J.maxx,et=J.maxy,it=q*t*Z.sweepCoef*.008333333333333333|0;8<it&&(it=8);var nt,rt,st=q*t/it,ot=t-U.sweepTime;if(0!=ot&&(U.sweepTime=t,U.posx+=U.velx*ot,U.posy+=U.vely*ot,0!=U.angvel&&(nt=U.sweep_angvel*ot,U.rot+=nt,1e-4<nt*nt?(U.axisx=Math.sin(U.rot),U.axisy=Math.cos(U.rot)):(rt=1-(ht=nt*nt)*ht/8,ht=((ot=1-.5*ht)*U.axisx+nt*U.axisy)*rt,U.axisy=(ot*U.axisy-nt*U.axisx)*rt,U.axisx=ht))),0==Z.type){var at=Z.circle;at.worldCOMx=at.body.posx+(at.body.axisy*at.localCOMx-at.body.axisx*at.localCOMy),at.worldCOMy=at.body.posy+(at.localCOMx*at.body.axisx+at.localCOMy*at.body.axisy),at.aabb.minx=at.worldCOMx-at.radius,at.aabb.miny=at.worldCOMy-at.radius,at.aabb.maxx=at.worldCOMx+at.radius,at.aabb.maxy=at.worldCOMy+at.radius}else{var lt=Z.polygon,pt=lt.lverts.next,ht=lt.gverts.next,at=pt;pt=pt.next,ht.x=lt.body.posx+(lt.body.axisy*at.x-lt.body.axisx*at.y),ht.y=lt.body.posy+(at.x*lt.body.axisx+at.y*lt.body.axisy),lt.aabb.minx=ht.x,lt.aabb.miny=ht.y,lt.aabb.maxx=ht.x,lt.aabb.maxy=ht.y;for(var ut=lt.gverts.next.next;null!=ut;){var ct=ut,dt=pt,pt=pt.next;ct.x=lt.body.posx+(lt.body.axisy*dt.x-lt.body.axisx*dt.y),ct.y=lt.body.posy+(dt.x*lt.body.axisx+dt.y*lt.body.axisy),ct.x<lt.aabb.minx&&(lt.aabb.minx=ct.x),ct.x>lt.aabb.maxx&&(lt.aabb.maxx=ct.x),ct.y<lt.aabb.miny&&(lt.aabb.miny=ct.y),ct.y>lt.aabb.maxy&&(lt.aabb.maxy=ct.y),ut=ut.next}}Q<J.minx?J.minx=Q:Q=J.minx,$<J.miny?J.miny=$:$=J.miny,tt>J.maxx?J.maxx=tt:tt=J.maxx,et>J.maxy?J.maxy=et:et=J.maxy;for(var _t=1,yt=it;_t<yt;){var ft,mt=st*_t++*Y,xt=mt-U.sweepTime;if(0!=xt&&(U.sweepTime=mt,U.posx+=U.velx*xt,U.posy+=U.vely*xt,0!=U.angvel&&(ft=U.sweep_angvel*xt,U.rot+=ft,1e-4<ft*ft?(U.axisx=Math.sin(U.rot),U.axisy=Math.cos(U.rot)):(mt=1-(zt=ft*ft)*zt/8,zt=((xt=1-.5*zt)*U.axisx+ft*U.axisy)*mt,U.axisy=(xt*U.axisy-ft*U.axisx)*mt,U.axisx=zt))),0==Z.type){var vt=Z.circle;vt.worldCOMx=vt.body.posx+(vt.body.axisy*vt.localCOMx-vt.body.axisx*vt.localCOMy),vt.worldCOMy=vt.body.posy+(vt.localCOMx*vt.body.axisx+vt.localCOMy*vt.body.axisy),vt.aabb.minx=vt.worldCOMx-vt.radius,vt.aabb.miny=vt.worldCOMy-vt.radius,vt.aabb.maxx=vt.worldCOMx+vt.radius,vt.aabb.maxy=vt.worldCOMy+vt.radius}else{var gt=Z.polygon,bt=gt.lverts.next,zt=gt.gverts.next,vt=bt;bt=bt.next,zt.x=gt.body.posx+(gt.body.axisy*vt.x-gt.body.axisx*vt.y),zt.y=gt.body.posy+(vt.x*gt.body.axisx+vt.y*gt.body.axisy),gt.aabb.minx=zt.x,gt.aabb.miny=zt.y,gt.aabb.maxx=zt.x,gt.aabb.maxy=zt.y;for(var wt=gt.gverts.next.next;null!=wt;){var Ct=wt,Pt=bt,bt=bt.next;Ct.x=gt.body.posx+(gt.body.axisy*Pt.x-gt.body.axisx*Pt.y),Ct.y=gt.body.posy+(Pt.x*gt.body.axisx+Pt.y*gt.body.axisy),Ct.x<gt.aabb.minx&&(gt.aabb.minx=Ct.x),Ct.x>gt.aabb.maxx&&(gt.aabb.maxx=Ct.x),Ct.y<gt.aabb.miny&&(gt.aabb.miny=Ct.y),Ct.y>gt.aabb.maxy&&(gt.aabb.maxy=Ct.y),wt=wt.next}}Q<J.minx?J.minx=Q:Q=J.minx,$<J.miny?J.miny=$:$=J.miny,tt>J.maxx?J.maxx=tt:tt=J.maxx,et>J.maxy?J.maxy=et:et=J.maxy}this.bphase.sync(Z),K=K.next}U.sweepFrozen=!1,2==U.type&&U.bulletEnabled&&(W=kr.bulletCCDLinearThreshold*U.sweepRadius,H=kr.bulletCCDAngularThreshold,((U.velx*U.velx+U.vely*U.vely)*t*t>W*W||U.angvel*U.angvel*t*t>H*H)&&(U.bullet=!0))}else U.sweepFrozen=!0,U.bullet=!1}G=G.next}},ii.prototype.continuous=null,ii.prototype.presteparb=function(t,e,i){null==i&&(i=!1);if(!t.cleared&&t.b1.component.sleeping&&t.b2.component.sleeping)return t.sleep_stamp=this.stamp,t.sleeping=!0;if(!t.cleared||0!=t.present||t.intchange){var i=!i&&t.up_stamp==this.stamp-1&&!t.cleared&&!t.intchange,n=t.fresh&&!t.cleared&&!t.intchange;if(i&&(t.endGenerated=this.stamp),n||i||t.cleared||t.intchange){for(var r=t.ws1,s=t.ws2,o=this.mrca1;null!=o.head;){var a=o.head;o.head=a.next,a.elt=null,a.next=nr.zpp_pool,nr.zpp_pool=a,null==o.head&&(o.pushmod=!0),o.modified=!0,o.length--}o.pushmod=!0;for(var l,p,h,u,c,d=this.mrca2;null!=d.head;){var _=d.head;d.head=_.next,_.elt=null,_.next=nr.zpp_pool,nr.zpp_pool=_,null==d.head&&(d.pushmod=!0),d.modified=!0,d.length--}d.pushmod=!0,null!=r.cbSet&&(p=this.mrca1,null==nr.zpp_pool?l=new nr:(l=nr.zpp_pool,nr.zpp_pool=l.next,l.next=null),l.elt=r,(l=l).next=p.head,p.head=l,p.modified=!0,p.length++),null!=r.body.cbSet&&(u=this.mrca1,p=r.body,null==nr.zpp_pool?h=new nr:(h=nr.zpp_pool,nr.zpp_pool=h.next,h.next=null),h.elt=p,(h=h).next=u.head,u.head=h,u.modified=!0,u.length++),null!=s.cbSet&&(u=this.mrca2,null==nr.zpp_pool?c=new nr:(c=nr.zpp_pool,nr.zpp_pool=c.next,c.next=null),c.elt=s,(c=c).next=u.head,u.head=c,u.modified=!0,u.length++),null!=s.body.cbSet&&(ve=this.mrca2,xe=s.body,null==nr.zpp_pool?Wt=new nr:(Wt=nr.zpp_pool,nr.zpp_pool=Wt.next,Wt.next=null),Wt.elt=xe,(xe=Wt).next=ve.head,ve.head=xe,ve.modified=!0,ve.length++);for(var y,f,m,x,v=r.body.compound,g=s.body.compound;v!=g;)(null==v?0:v.depth)<(null==g?0:g.depth)?(null!=g.cbSet&&(x=this.mrca2,null==nr.zpp_pool?y=new nr:(y=nr.zpp_pool,nr.zpp_pool=y.next,y.next=null),y.elt=g,(f=y).next=x.head,x.head=f,x.modified=!0,x.length++),g=g.compound):(null!=v.cbSet&&(f=this.mrca1,null==nr.zpp_pool?m=new nr:(m=nr.zpp_pool,nr.zpp_pool=m.next,m.next=null),m.elt=v,(x=m).next=f.head,f.head=x,f.modified=!0,f.length++),v=v.compound);for(var b=this.mrca1.head;null!=b;){for(var z=b.elt,w=this.mrca2.head;null!=w;){for(var C,P=w.elt,T=z.cbSet,S=P.cbSet,M=null,A=(T.cbpairs.length<S.cbpairs.length?T:S).cbpairs.head;null!=A;){var O=A.elt;if(O.a==T&&O.b==S||O.a==S&&O.b==T){M=O;break}A=A.next}if(null==M&&(null==qn.zpp_pool?C=new qn:(C=qn.zpp_pool,qn.zpp_pool=C.next,C.next=null),C.zip_listeners=!0,Hn.setlt(T,S)?(C.a=T,C.b=S):(C.a=S,C.b=T),M=C,T.cbpairs.add(M),S!=T&&S.cbpairs.add(M)),M.zip_listeners&&(M.zip_listeners=!1,M.__validate()),null!=M.listeners.head){var k=$n.get(z,P);if(n||t.intchange){null==k&&(k=tr.get(z,P),this.add_callbackset(k));for(var E,I=null,D=(T.cbpairs.length<S.cbpairs.length?T:S).cbpairs.head;null!=D;){var B=D.elt;if(B.a==T&&B.b==S||B.a==S&&B.b==T){I=B;break}D=D.next}null==I&&(null==qn.zpp_pool?E=new qn:(E=qn.zpp_pool,qn.zpp_pool=E.next,E.next=null),E.zip_listeners=!0,Hn.setlt(T,S)?(E.a=T,E.b=S):(E.a=S,E.b=T),I=E,T.cbpairs.add(I),S!=T&&S.cbpairs.add(I)),I.zip_listeners&&(I.zip_listeners=!1,I.__validate());for(var L,R=I.listeners.head;null!=R;){var F,j,N,G,U,X=R.elt;0==X.event&&0!=(X.itype&t.type)&&k.empty_arb(X.itype)&&((F=this.push_callback(X)).event=0,j=k.int1,N=k.int2,U=X.options1,G=j.cbTypes,!(!U.nonemptyintersection(G,U.includes)||U.nonemptyintersection(G,U.excludes))&&(U=X.options2,X=N.cbTypes,!!U.nonemptyintersection(X,U.includes)&&!U.nonemptyintersection(X,U.excludes))?(F.int1=j,F.int2=N):(F.int1=N,F.int2=j),F.set=k),R=R.next}L=!1;for(var V,W,H=k.arbiters.head;null!=H;){if(H.elt==t){L=!0;break}H=H.next}!L&&(V=k.arbiters,null==er.zpp_pool?W=new er:(W=er.zpp_pool,er.zpp_pool=W.next,W.next=null),W.elt=t,(P=W).next=V.head,V.head=P,V.modified=!0,V.length++,!0)&&t.present++}else{t.present--,k.remove_arb(t);for(var q,Y=null,K=(T.cbpairs.length<S.cbpairs.length?T:S).cbpairs.head;null!=K;){var Z=K.elt;if(Z.a==T&&Z.b==S||Z.a==S&&Z.b==T){Y=Z;break}K=K.next}null==Y&&(null==qn.zpp_pool?q=new qn:(q=qn.zpp_pool,qn.zpp_pool=q.next,q.next=null),q.zip_listeners=!0,Hn.setlt(T,S)?(q.a=T,q.b=S):(q.a=S,q.b=T),Y=q,T.cbpairs.add(Y),S!=T&&S.cbpairs.add(Y)),Y.zip_listeners&&(Y.zip_listeners=!1,Y.__validate());for(var J=Y.listeners.head;null!=J;){var Q,$,tt,et,it,nt=J.elt;1==nt.event&&0!=(nt.itype&t.type)&&k.empty_arb(nt.itype)&&((Q=this.push_callback(nt)).event=1,$=k.int1,tt=k.int2,it=nt.options1,et=$.cbTypes,!(!it.nonemptyintersection(et,it.includes)||it.nonemptyintersection(et,it.excludes))&&(it=nt.options2,nt=tt.cbTypes,!!it.nonemptyintersection(nt,it.includes)&&!it.nonemptyintersection(nt,it.excludes))?(Q.int1=$,Q.int2=tt):(Q.int1=tt,Q.int2=$),Q.set=k),J=J.next}null==k.arbiters.head&&this.remove_callbackset(k)}w=w.next}else w=w.next}b=b.next}}t.fresh=!1,t.intchange=!1}if(t.cleared||t.up_stamp+(t.type==Qe.COL?kr.arbiterExpirationDelay:0)<this.stamp){if(t.type==Qe.SENSOR){var rt=t.sensorarb;if(!rt.cleared){for(var st,ot,at=rt.b1.arbiters,lt=null,pt=at.head;null!=pt;){if(pt.elt==rt){null==lt?(ot=(st=at.head).next,at.head=ot,null==at.head&&(at.pushmod=!0)):(ot=(st=lt.next).next,null==(lt.next=ot)&&(at.pushmod=!0));var ht=st;ht.elt=null,ht.next=er.zpp_pool,er.zpp_pool=ht,at.modified=!0,at.length--,at.pushmod=!0;break}pt=(lt=pt).next}for(var ut,ct,dt=rt.b2.arbiters,_t=null,yt=dt.head;null!=yt;){if(yt.elt==rt){null==_t?(ct=(ut=dt.head).next,dt.head=ct,null==dt.head&&(dt.pushmod=!0)):(ct=(ut=_t.next).next,null==(_t.next=ct)&&(dt.pushmod=!0));var ft=ut;ft.elt=null,ft.next=er.zpp_pool,er.zpp_pool=ft,dt.modified=!0,dt.length--,dt.pushmod=!0;break}yt=(_t=yt).next}null!=rt.pair&&(rt.pair.arb=null,rt.pair=null)}rt.b1=rt.b2=null,rt.active=!1,rt.intchange=!1,rt.next=Kn.zpp_pool,Kn.zpp_pool=rt}else if(t.type==Qe.FLUID){var mt=t.fluidarb;if(!mt.cleared){for(var xt,vt,gt=mt.b1.arbiters,bt=null,zt=gt.head;null!=zt;){if(zt.elt==mt){null==bt?(vt=(xt=gt.head).next,gt.head=vt,null==gt.head&&(gt.pushmod=!0)):(vt=(xt=bt.next).next,null==(bt.next=vt)&&(gt.pushmod=!0));var wt=xt;wt.elt=null,wt.next=er.zpp_pool,er.zpp_pool=wt,gt.modified=!0,gt.length--,gt.pushmod=!0;break}zt=(bt=zt).next}for(var Ct,Pt,Tt=mt.b2.arbiters,St=null,Mt=Tt.head;null!=Mt;){if(Mt.elt==mt){null==St?(Pt=(Ct=Tt.head).next,Tt.head=Pt,null==Tt.head&&(Tt.pushmod=!0)):(Pt=(Ct=St.next).next,null==(St.next=Pt)&&(Tt.pushmod=!0));var At=Ct;At.elt=null,At.next=er.zpp_pool,er.zpp_pool=At,Tt.modified=!0,Tt.length--,Tt.pushmod=!0;break}Mt=(St=Mt).next}null!=mt.pair&&(mt.pair.arb=null,mt.pair=null)}mt.b1=mt.b2=null,mt.active=!1,mt.intchange=!1,mt.next=Zn.zpp_pool,(Zn.zpp_pool=mt).pre_dt=-1}else{var Ot=t.colarb;if(!Ot.cleared){for(var kt,Et,It=Ot.b1.arbiters,Dt=null,Bt=It.head;null!=Bt;){if(Bt.elt==Ot){null==Dt?(Et=(kt=It.head).next,It.head=Et,null==It.head&&(It.pushmod=!0)):(Et=(kt=Dt.next).next,null==(Dt.next=Et)&&(It.pushmod=!0));var Lt=kt;Lt.elt=null,Lt.next=er.zpp_pool,er.zpp_pool=Lt,It.modified=!0,It.length--,It.pushmod=!0;break}Bt=(Dt=Bt).next}for(var Rt,Ft,jt=Ot.b2.arbiters,Nt=null,Gt=jt.head;null!=Gt;){if(Gt.elt==Ot){null==Nt?(Ft=(Rt=jt.head).next,jt.head=Ft,null==jt.head&&(jt.pushmod=!0)):(Ft=(Rt=Nt.next).next,null==(Nt.next=Ft)&&(jt.pushmod=!0));var Ut=Rt;Ut.elt=null,Ut.next=er.zpp_pool,er.zpp_pool=Ut,jt.modified=!0,jt.length--,jt.pushmod=!0;break}Gt=(Nt=Gt).next}null!=Ot.pair&&(Ot.pair.arb=null,Ot.pair=null)}for(Ot.b1=Ot.b2=null,Ot.active=!1,Ot.intchange=!1;null!=Ot.contacts.next;){var Xt=Ot.contacts,Vt=Xt.next;Xt.pop(),Vt.arbiter=null,Vt.next=Qn.zpp_pool,Qn.zpp_pool=Vt;Xt=Ot.innards,Vt=Xt.next;Xt.next=Vt.next,Vt._inuse=!1,null==Xt.next&&(Xt.pushmod=!0),Xt.modified=!0,Xt.length--}Ot.userdef_dyn_fric=!1,Ot.userdef_stat_fric=!1,Ot.userdef_restitution=!1,Ot.userdef_rfric=!1,Ot.__ref_edge1=Ot.__ref_edge2=null,Ot.next=Jn.zpp_pool,(Jn.zpp_pool=Ot).pre_dt=-1}return!0}var Wt=t.active;if(t.active=t.presentable=t.up_stamp==this.stamp,0!=(1&t.immState)){if(t.active&&t.type!=Qe.SENSOR)if(null!=t.colarb){var Ht=t.colarb;Ht.invalidated&&(Ht.invalidated=!1,Ht.userdef_restitution||(Ht.s1.material.elasticity<=-1/0||Ht.s2.material.elasticity<=-1/0?Ht.restitution=0:Ht.s1.material.elasticity>=1/0||Ht.s2.material.elasticity>=1/0?Ht.restitution=1:Ht.restitution=(Ht.s1.material.elasticity+Ht.s2.material.elasticity)/2,Ht.restitution<0&&(Ht.restitution=0),1<Ht.restitution&&(Ht.restitution=1)),Ht.userdef_dyn_fric||(Ht.dyn_fric=Math.sqrt(Ht.s1.material.dynamicFriction*Ht.s2.material.dynamicFriction)),Ht.userdef_stat_fric||(Ht.stat_fric=Math.sqrt(Ht.s1.material.staticFriction*Ht.s2.material.staticFriction)),Ht.userdef_rfric||(Ht.rfric=Math.sqrt(Ht.s1.material.rollingFriction*Ht.s2.material.rollingFriction))),-1==Ht.pre_dt&&(Ht.pre_dt=e);var qt=e/Ht.pre_dt;Ht.pre_dt=e;var Yt=Ht.b1.smass+Ht.b2.smass,Kt=!(Ht.hc2=!1);Ht.biasCoef=2!=Ht.b1.type||2!=Ht.b2.type?Ht.continuous?kr.contactContinuousStaticBiasCoef:kr.contactStaticBiasCoef:Ht.continuous?kr.contactContinuousBiasCoef:kr.contactBiasCoef,Ht.continuous=!1;for(var Zt=null,Jt=null,Qt=Ht.innards.next,$t=Ht.contacts.next;null!=$t;){var te,ee,ie,ne,re,se,oe,ae,le,pe=$t;pe.stamp+kr.arbiterExpirationDelay<Ht.stamp?(oe=Ht.contacts,null==Zt?(ee=(te=oe.next).next,oe.next=ee,null==oe.next&&(oe.pushmod=!0)):(ee=(te=Zt.next).next,null==(Zt.next=ee)&&(oe.pushmod=!0)),te._inuse=!1,oe.modified=!0,oe.length--,oe.pushmod=!0,$t=ee,ae=Ht.innards,null==Jt?(ne=(ie=ae.next).next,ae.next=ne,null==ae.next&&(ae.pushmod=!0)):(ne=(ie=Jt.next).next,null==(Jt.next=ne)&&(ae.pushmod=!0)),ie._inuse=!1,ae.modified=!0,ae.length--,ae.pushmod=!0,Qt=ne,pe.arbiter=null,pe.next=Qn.zpp_pool,Qn.zpp_pool=pe):(re=pe.inner,se=pe.active,pe.active=pe.stamp==Ht.stamp,pe.active&&(Kt?(Kt=!1,Ht.c1=re,Ht.oc1=pe):(Ht.hc2=!0,Ht.c2=re,Ht.oc2=pe),re.r2x=pe.px-Ht.b2.posx,re.r2y=pe.py-Ht.b2.posy,re.r1x=pe.px-Ht.b1.posx,re.r1y=pe.py-Ht.b1.posy,le=re.r2x*Ht.nx+re.r2y*Ht.ny,oe=Yt+Ht.b2.sinertia*(le*le),ae=re.r1x*Ht.nx+re.r1y*Ht.ny,oe+=Ht.b1.sinertia*(ae*ae),re.tMass=oe<kr.epsilon*kr.epsilon?0:1/oe,le=Ht.ny*re.r2x-Ht.nx*re.r2y,ae=Yt+Ht.b2.sinertia*(le*le),oe=Ht.ny*re.r1x-Ht.nx*re.r1y,ae+=Ht.b1.sinertia*(oe*oe),re.nMass=ae<kr.epsilon*kr.epsilon?0:1/ae,oe=le=0,ae=Ht.b2.angvel+Ht.b2.kinangvel,le=Ht.b2.velx+Ht.b2.kinvelx-re.r2y*ae,oe=Ht.b2.vely+Ht.b2.kinvely+re.r2x*ae,ae=Ht.b1.angvel+Ht.b1.kinangvel,le-=Ht.b1.velx+Ht.b1.kinvelx-re.r1y*ae,oe-=Ht.b1.vely+Ht.b1.kinvely+re.r1x*ae,ae=Ht.nx*le+Ht.ny*oe,pe.elasticity=Ht.restitution,re.bounce=ae*pe.elasticity,re.bounce>-kr.elasticThreshold&&(re.bounce=0),ae=oe*Ht.nx-le*Ht.ny,le=kr.staticFrictionThreshold,re.friction=le*le<ae*ae?Ht.dyn_fric:Ht.stat_fric,re.jnAcc*=qt,re.jtAcc*=qt),se!=pe.active&&(Ht.contacts.modified=!0),Zt=$t,Qt=(Jt=Qt).next,$t=$t.next)}Ht.hc2?(Ht.hpc2=!0,Ht.oc1.posOnly?(ge=Ht.c1,Ht.c1=Ht.c2,Ht.c2=ge,be=Ht.oc1,Ht.oc1=Ht.oc2,Ht.oc2=be,Ht.hc2=!1):Ht.oc2.posOnly&&(Ht.hc2=!1),Ht.oc1.posOnly&&(Kt=!0)):Ht.hpc2=!1,Ht.jrAcc*=qt,Kt||(Ht.rn1a=Ht.ny*Ht.c1.r1x-Ht.nx*Ht.c1.r1y,Ht.rt1a=Ht.c1.r1x*Ht.nx+Ht.c1.r1y*Ht.ny,Ht.rn1b=Ht.ny*Ht.c1.r2x-Ht.nx*Ht.c1.r2y,Ht.rt1b=Ht.c1.r2x*Ht.nx+Ht.c1.r2y*Ht.ny,Ht.k1x=Ht.b2.kinvelx-Ht.c1.r2y*Ht.b2.kinangvel-(Ht.b1.kinvelx-Ht.c1.r1y*Ht.b1.kinangvel),Ht.k1y=Ht.b2.kinvely+Ht.c1.r2x*Ht.b2.kinangvel-(Ht.b1.kinvely+Ht.c1.r1x*Ht.b1.kinangvel)),Ht.hc2&&(Ht.rn2a=Ht.ny*Ht.c2.r1x-Ht.nx*Ht.c2.r1y,Ht.rt2a=Ht.c2.r1x*Ht.nx+Ht.c2.r1y*Ht.ny,Ht.rn2b=Ht.ny*Ht.c2.r2x-Ht.nx*Ht.c2.r2y,Ht.rt2b=Ht.c2.r2x*Ht.nx+Ht.c2.r2y*Ht.ny,Ht.k2x=Ht.b2.kinvelx-Ht.c2.r2y*Ht.b2.kinangvel-(Ht.b1.kinvelx-Ht.c2.r1y*Ht.b1.kinangvel),Ht.k2y=Ht.b2.kinvely+Ht.c2.r2x*Ht.b2.kinangvel-(Ht.b1.kinvely+Ht.c2.r1x*Ht.b1.kinangvel),Ht.kMassa=Yt+Ht.b1.sinertia*Ht.rn1a*Ht.rn1a+Ht.b2.sinertia*Ht.rn1b*Ht.rn1b,Ht.kMassb=Yt+Ht.b1.sinertia*Ht.rn1a*Ht.rn2a+Ht.b2.sinertia*Ht.rn1b*Ht.rn2b,Ht.kMassc=Yt+Ht.b1.sinertia*Ht.rn2a*Ht.rn2a+Ht.b2.sinertia*Ht.rn2b*Ht.rn2b,Ht.kMassa*Ht.kMassa+2*Ht.kMassb*Ht.kMassb+Ht.kMassc*Ht.kMassc<kr.illConditionedThreshold*(Ht.kMassa*Ht.kMassc-Ht.kMassb*Ht.kMassb)?(Ht.Ka=Ht.kMassa,Ht.Kb=Ht.kMassb,Ht.Kc=Ht.kMassc,(_e=Ht.kMassa*Ht.kMassc-Ht.kMassb*Ht.kMassb)!=_e?Ht.kMassa=Ht.kMassb=Ht.kMassc=0:0==_e?(0!=Ht.kMassa?Ht.kMassa=1/Ht.kMassa:Ht.kMassa=0,0!=Ht.kMassc?Ht.kMassc=1/Ht.kMassc:Ht.kMassc=0,Ht.kMassb=0):(_e=1/_e,ce=Ht.kMassc*_e,Ht.kMassc=Ht.kMassa*_e,Ht.kMassa=ce,Ht.kMassb*=-_e)):(Ht.hc2=!1,Ht.oc2.dist<Ht.oc1.dist&&(ye=Ht.c1,Ht.c1=Ht.c2,Ht.c2=ye),Ht.oc2.active=!1,Ht.contacts.modified=!0)),Ht.surfacex=Ht.b2.svelx,Ht.surfacey=Ht.b2.svely,Ht.surfacex+=Ht.b1.svelx,Ht.surfacey+=Ht.b1.svely,Ht.surfacex=-Ht.surfacex,Ht.surfacey=-Ht.surfacey,Ht.rMass=Ht.b1.sinertia+Ht.b2.sinertia,0!=Ht.rMass&&(Ht.rMass=1/Ht.rMass),Kt&&(t.active=!1)}else{var he=t.fluidarb;-1==he.pre_dt&&(he.pre_dt=e);var ue=e/he.pre_dt;he.pre_dt=e,he.r1x=he.centroidx-he.b1.posx,he.r1y=he.centroidy-he.b1.posy,he.r2x=he.centroidx-he.b2.posx,he.r2y=he.centroidy-he.b2.posy;var ce,de,_e,ye,fe,me,xe=0,ve=0,ve=he.ws1.fluidEnabled&&null!=he.ws1.fluidProperties.wrap_gravity?(xe=he.ws1.fluidProperties.gravityx,he.ws1.fluidProperties.gravityy):(xe=this.gravityx,this.gravityy),r=0,s=0,s=he.ws2.fluidEnabled&&null!=he.ws2.fluidProperties.wrap_gravity?(r=he.ws2.fluidProperties.gravityx,he.ws2.fluidProperties.gravityy):(r=this.gravityx,this.gravityy),ge=0,be=0;if(he.ws1.fluidEnabled&&he.ws2.fluidEnabled?(ce=he.overlap*he.ws1.fluidProperties.density,(_e=he.overlap*he.ws2.fluidProperties.density)<ce?(ge-=xe*(fe=ce+_e),be-=ve*fe):ce<_e?(ge+=r*(de=ce+_e),be+=s*de):(fe=ye=0,ye=xe+r,fe=ve+s,ye*=.5,fe*=.5,he.ws1.worldCOMx*ye+he.ws1.worldCOMy*fe>he.ws2.worldCOMx*ye+he.ws2.worldCOMy*fe?(ge-=ye*(de=ce+_e),be-=fe*de):(ge+=ye*(_e=ce+_e),be+=fe*_e))):he.ws1.fluidEnabled?(ge-=xe*(xe=he.overlap*he.ws1.fluidProperties.density),be-=ve*xe):he.ws2.fluidEnabled&&(ge+=r*(me=he.overlap*he.ws2.fluidProperties.density),be+=s*me),ge*=e,be*=e,he.buoyx=ge,he.buoyy=be,2==he.b1.type&&(me=he.b1.imass,he.b1.velx-=ge*me,he.b1.vely-=be*me,he.b1.angvel-=(be*he.r1x-ge*he.r1y)*he.b1.iinertia),2==he.b2.type&&(ze=he.b2.imass,he.b2.velx+=ge*ze,he.b2.vely+=be*ze,he.b2.angvel+=(be*he.r2x-ge*he.r2y)*he.b2.iinertia),he.ws1.fluidEnabled&&0!=he.ws1.fluidProperties.viscosity||he.ws2.fluidEnabled&&0!=he.ws2.fluidProperties.viscosity){he.nodrag=!1;var ze=0;he.ws1.fluidEnabled&&(he.ws2.validate_angDrag(),ze=he.ws1.fluidProperties.viscosity*he.ws2.angDrag*he.overlap/he.ws2.area),he.ws2.fluidEnabled&&(he.ws1.validate_angDrag(),ze+=he.ws2.fluidProperties.viscosity*he.ws1.angDrag*he.overlap/he.ws1.area),0!=ze?(Me=he.b1.sinertia+he.b2.sinertia,he.wMass=0!=Me?1/Me:0,ze*=4e-4,Ce=2*Math.PI*ze,he.agamma=1/(e*Ce*(2+Ce*e)),Se=1/(1+he.agamma),he.agamma*=Se,he.wMass*=Se):(he.wMass=0,he.agamma=0);be=he.b2.velx+he.b2.kinvelx-he.r2y*(he.b2.angvel+he.b2.kinangvel)-(he.b1.velx+he.b1.kinvelx-he.r1y*(he.b2.angvel+he.b2.kinangvel)),ge=he.b2.vely+he.b2.kinvely+he.r2x*(he.b2.angvel+he.b2.kinangvel)-(he.b1.vely+he.b1.kinvely+he.r1x*(he.b1.angvel+he.b1.kinangvel));be*be+ge*ge<kr.epsilon*kr.epsilon||(be*=we=1/Math.sqrt(be*be+ge*ge),ge*=we,he.nx=be,he.ny=ge);var we,Ce,Pe,Te,Se,Me=0;if(he.ws1.fluidEnabled){var Ae=-he.ws1.fluidProperties.viscosity*he.overlap/he.ws2.area;if(0==he.ws2.type)Me=0-Ae*he.ws2.circle.radius*kr.fluidLinearDrag/(2*he.ws2.circle.radius*Math.PI);else{for(var Oe=0,ke=0,Ee=he.ws2.polygon.edges.head;null!=Ee;){var Ie=Ee.elt;Oe+=Ie.length;Ie=Ae*Ie.length*(Ie.gnormx*he.nx+Ie.gnormy*he.ny);0<Ie&&(Ie*=-kr.fluidVacuumDrag),ke-=.5*Ie*kr.fluidLinearDrag,Ee=Ee.next}Me=ke/Oe}}if(he.ws2.fluidEnabled){var De=-he.ws2.fluidProperties.viscosity*he.overlap/he.ws1.area;if(0==he.ws1.type)Me-=De*he.ws1.circle.radius*kr.fluidLinearDrag/(2*he.ws1.circle.radius*Math.PI);else{for(var Be=0,Le=0,Re=he.ws1.polygon.edges.head;null!=Re;){var Fe=Re.elt;Be+=Fe.length;Fe=De*Fe.length*(Fe.gnormx*he.nx+Fe.gnormy*he.ny);0<Fe&&(Fe*=-kr.fluidVacuumDrag),Le-=.5*Fe*kr.fluidLinearDrag,Re=Re.next}Me+=Le/Be}}0!=Me?(Se=Ce=ze=0,Se=ze=we=he.b1.smass+he.b2.smass,(Ce=0)!=he.b1.sinertia&&(be=he.r1x*he.b1.sinertia,ze=we+(ge=he.r1y*he.b1.sinertia)*he.r1y,Ce+=-ge*he.r1x,Se=we+be*he.r1x),0!=he.b2.sinertia&&(Te=he.r2x*he.b2.sinertia,ze+=(Pe=he.r2y*he.b2.sinertia)*he.r2y,Ce+=-Pe*he.r2x,Se+=Te*he.r2x),(Pe=ze*Se-Ce*Ce)!=Pe?ze=Ce=Se=0:0==Pe?(ze=0!=ze?1/ze:0,Se=0!=Se?1/Se:0,Ce=0):(Te=Se*(Pe=1/Pe),Se=ze*Pe,ze=Te,Ce*=-Pe),he.vMassa=ze,he.vMassb=Ce,he.vMassc=Se,Me=2*Math.PI*Me,he.lgamma=1/(e*Me*(2+Me*e)),e=1/(1+he.lgamma),he.lgamma*=e,he.vMassa*=e,he.vMassb*=e,he.vMassc*=e):(he.vMassa=0,he.vMassb=0,he.vMassc=0,he.lgamma=0)}else he.nodrag=!0,he.dampx=0,he.dampy=0,he.adamp=0;he.dampx*=ue,he.dampy*=ue,he.adamp*=ue}}else if(null!=t.colarb){var je=t.colarb,Ne=!0,Ge=null,Ue=null,Xe=je.innards.next;je.hc2=!1;for(var Ve=je.contacts.next;null!=Ve;){var We,He,qe,Ye,Ke,Ze,Je=Ve;Je.stamp+kr.arbiterExpirationDelay<je.stamp?(Ke=je.contacts,null==Ge?(He=(We=Ke.next).next,Ke.next=He,null==Ke.next&&(Ke.pushmod=!0)):(He=(We=Ge.next).next,null==(Ge.next=He)&&(Ke.pushmod=!0)),We._inuse=!1,Ke.modified=!0,Ke.length--,Ke.pushmod=!0,Ve=He,Ze=je.innards,null==Ue?(Ye=(qe=Ze.next).next,Ze.next=Ye,null==Ze.next&&(Ze.pushmod=!0)):(Ye=(qe=Ue.next).next,null==(Ue.next=Ye)&&(Ze.pushmod=!0)),qe._inuse=!1,Ze.modified=!0,Ze.length--,Ze.pushmod=!0,Xe=Ye,Je.arbiter=null,Je.next=Qn.zpp_pool,Qn.zpp_pool=Je):(Ke=Je.inner,Ze=Je.active,Je.active=Je.stamp==je.stamp,Je.active&&(Ne?(Ne=!1,je.c1=Ke,je.oc1=Je):(je.hc2=!0,je.c2=Ke,je.oc2=Je)),Ze!=Je.active&&(je.contacts.modified=!0),Ge=Ve,Xe=(Ue=Xe).next,Ve=Ve.next)}je.hc2?(je.hpc2=!0,je.oc1.posOnly?(ue=je.c1,je.c1=je.c2,je.c2=ue,ue=je.oc1,je.oc1=je.oc2,je.oc2=ue,je.hc2=!1):je.oc2.posOnly&&(je.hc2=!1),je.oc1.posOnly&&(Ne=!0)):je.hpc2=!1,Ne&&(t.active=!1)}return Wt!=t.active&&(t.b1.arbiters.modified=!0,t.b2.arbiters.modified=!0,this.c_arbiters_true.modified=this.c_arbiters_false.modified=!0,this.s_arbiters.modified=this.f_arbiters.modified=!0),!1},ii.prototype.prestep=function(t){for(var e=null,i=this.live_constraints.head;null!=i;){var n=i.elt;n.preStep(t)?(i=this.live_constraints.erase(e),n.broken(),this.constraintCbBreak(n),n.removeOnBreak?(n.component.sleeping=!0,this.midstep=!1,(null!=n.compound?n.compound:this).wrap_constraints.remove(n.outer),this.midstep=!0):n.active=!1,n.clearcache()):i=(e=i).next}var r,s,o,a=null,l=this.c_arbiters_true,p=l.head,h=null!=this.c_arbiters_false;for(h&&null==p&&(h=!1,p=this.c_arbiters_false.head,l=this.c_arbiters_false,a=null);null!=p;)this.presteparb(p.elt,t)?(null==a?(s=(r=l.head).next,l.head=s,null==l.head&&(l.pushmod=!0)):(s=(r=a.next).next,null==(a.next=s)&&(l.pushmod=!0)),(o=r).elt=null,o.next=or.zpp_pool,or.zpp_pool=o,l.modified=!0,l.length--,l.pushmod=!0,p=s,h&&null==p&&(h=!1,p=this.c_arbiters_false.head,l=this.c_arbiters_false,a=null)):(p=(a=p).next,h&&null==p&&(h=!1,p=this.c_arbiters_false.head,l=this.c_arbiters_false,a=null));for(var u,c,d,_=null,y=this.f_arbiters,f=y.head;null!=f;)this.presteparb(f.elt,t)?(null==_?(c=(u=y.head).next,y.head=c,null==y.head&&(y.pushmod=!0)):(c=(u=_.next).next,null==(_.next=c)&&(y.pushmod=!0)),(d=u).elt=null,d.next=rr.zpp_pool,rr.zpp_pool=d,y.modified=!0,y.length--,y.pushmod=!0,f=c):f=(_=f).next;for(var m,x,v,g=null,b=this.s_arbiters,z=b.head;null!=z;)this.presteparb(z.elt,t)?(null==g?(x=(m=b.head).next,b.head=x,null==b.head&&(b.pushmod=!0)):(x=(m=g.next).next,null==(g.next=x)&&(b.pushmod=!0)),(v=m).elt=null,v.next=sr.zpp_pool,sr.zpp_pool=v,b.modified=!0,b.length--,b.pushmod=!0,z=x):z=(g=z).next},ii.prototype.warmStart=function(){for(var t=this.f_arbiters.head;null!=t;){var e,i=t.elt;i.active&&0!=(1&i.immState)&&(e=i.b1.imass,i.b1.velx-=i.dampx*e,i.b1.vely-=i.dampy*e,e=i.b2.imass,i.b2.velx+=i.dampx*e,i.b2.vely+=i.dampy*e,i.b1.angvel-=i.b1.iinertia*(i.dampy*i.r1x-i.dampx*i.r1y),i.b2.angvel+=i.b2.iinertia*(i.dampy*i.r2x-i.dampx*i.r2y),i.b1.angvel-=i.adamp*i.b1.iinertia,i.b2.angvel+=i.adamp*i.b2.iinertia),t=t.next}var n=this.c_arbiters_false.head,r=!0;for(null==n&&(n=this.c_arbiters_true.head,r=!1);null!=n;){var s,o,a,l=n.elt;l.active&&0!=(1&l.immState)&&(a=l.nx*l.c1.jnAcc-l.ny*l.c1.jtAcc,o=l.ny*l.c1.jnAcc+l.nx*l.c1.jtAcc,s=l.b1.imass,l.b1.velx-=a*s,l.b1.vely-=o*s,l.b1.angvel-=l.b1.iinertia*(o*l.c1.r1x-a*l.c1.r1y),s=l.b2.imass,l.b2.velx+=a*s,l.b2.vely+=o*s,l.b2.angvel+=l.b2.iinertia*(o*l.c1.r2x-a*l.c1.r2y),l.hc2&&(s=l.nx*l.c2.jnAcc-l.ny*l.c2.jtAcc,o=l.ny*l.c2.jnAcc+l.nx*l.c2.jtAcc,a=l.b1.imass,l.b1.velx-=s*a,l.b1.vely-=o*a,l.b1.angvel-=l.b1.iinertia*(o*l.c2.r1x-s*l.c2.r1y),a=l.b2.imass,l.b2.velx+=s*a,l.b2.vely+=o*a,l.b2.angvel+=l.b2.iinertia*(o*l.c2.r2x-s*l.c2.r2y)),l.b2.angvel+=l.jrAcc*l.b2.iinertia,l.b1.angvel-=l.jrAcc*l.b1.iinertia),n=n.next,r&&null==n&&(n=this.c_arbiters_true.head,r=!1)}for(var p=this.live_constraints.head;null!=p;)p.elt.warmStart(),p=p.next},ii.prototype.iterateVel=function(t){for(var e=0;e<t;){++e;for(var i=this.f_arbiters.head;null!=i;){var n,r,s,o,a,l=i.elt;l.active&&0!=(1&l.immState)&&(l.nodrag||(n=l.b1.angvel+l.b1.kinangvel,a=l.b2.angvel+l.b2.kinangvel,s=l.b1.velx+l.b1.kinvelx-l.r1y*n-(l.b2.velx+l.b2.kinvelx-l.r2y*a),r=l.b1.vely+l.b1.kinvely+l.r1x*n-(l.b2.vely+l.b2.kinvely+l.r2x*a),o=l.vMassa*s+l.vMassb*r,r=l.vMassb*s+l.vMassc*r,s=o,o=l.lgamma,s-=l.dampx*o,r-=l.dampy*o,l.dampx+=s,l.dampy+=r,o=l.b1.imass,l.b1.velx-=s*o,l.b1.vely-=r*o,o=l.b2.imass,l.b2.velx+=s*o,l.b2.vely+=r*o,l.b1.angvel-=l.b1.iinertia*(r*l.r1x-s*l.r1y),l.b2.angvel+=l.b2.iinertia*(r*l.r2x-s*l.r2y),a=(n-a)*l.wMass-l.adamp*l.agamma,l.adamp+=a,l.b1.angvel-=a*l.b1.iinertia,l.b2.angvel+=a*l.b2.iinertia)),i=i.next}for(var p=null,h=this.live_constraints.head;null!=h;){var u=h.elt;u.applyImpulseVel()?(h=this.live_constraints.erase(p),u.broken(),this.constraintCbBreak(u),u.removeOnBreak?(u.component.sleeping=!0,this.midstep=!1,(null!=u.compound?u.compound:this).wrap_constraints.remove(u.outer),this.midstep=!0):u.active=!1,u.clearcache()):h=(p=h).next}var c=this.c_arbiters_false.head,d=!0;for(null==c&&(c=this.c_arbiters_true.head,d=!1);null!=c;){var _,y,f,m,x,v,g,b,z,w,C,P,T,S,M=c.elt;M.active&&0!=(1&M.immState)&&(f=M.k1x+M.b2.velx-M.c1.r2y*M.b2.angvel-(M.b1.velx-M.c1.r1y*M.b1.angvel),x=((m=M.k1y+M.b2.vely+M.c1.r2x*M.b2.angvel-(M.b1.vely+M.c1.r1x*M.b1.angvel))*M.nx-f*M.ny+M.surfacex)*M.c1.tMass,(v=M.c1.friction*M.c1.jnAcc)<(b=(g=M.c1.jtAcc)-x)?b=v:b<-v&&(b=-v),x=b-g,M.c1.jtAcc=b,_=-M.ny*x,y=M.nx*x,M.b2.velx+=_*M.b2.imass,M.b2.vely+=y*M.b2.imass,M.b1.velx-=_*M.b1.imass,M.b1.vely-=y*M.b1.imass,M.b2.angvel+=M.rt1b*x*M.b2.iinertia,M.b1.angvel-=M.rt1a*x*M.b1.iinertia,M.hc2?(T=M.k2x+M.b2.velx-M.c2.r2y*M.b2.angvel-(M.b1.velx-M.c2.r1y*M.b1.angvel),x=((S=M.k2y+M.b2.vely+M.c2.r2x*M.b2.angvel-(M.b1.vely+M.c2.r1x*M.b1.angvel))*M.nx-T*M.ny+M.surfacex)*M.c2.tMass,(v=M.c2.friction*M.c2.jnAcc)<(b=(g=M.c2.jtAcc)-x)?b=v:b<-v&&(b=-v),x=b-g,M.c2.jtAcc=b,_=-M.ny*x,y=M.nx*x,M.b2.velx+=_*M.b2.imass,M.b2.vely+=y*M.b2.imass,M.b1.velx-=_*M.b1.imass,M.b1.vely-=y*M.b1.imass,M.b2.angvel+=M.rt2b*x*M.b2.iinertia,M.b1.angvel-=M.rt2a*x*M.b1.iinertia,f=M.k1x+M.b2.velx-M.c1.r2y*M.b2.angvel-(M.b1.velx-M.c1.r1y*M.b1.angvel),m=M.k1y+M.b2.vely+M.c1.r2x*M.b2.angvel-(M.b1.vely+M.c1.r1x*M.b1.angvel),T=M.k2x+M.b2.velx-M.c2.r2y*M.b2.angvel-(M.b1.velx-M.c2.r1y*M.b1.angvel),S=M.k2y+M.b2.vely+M.c2.r2x*M.b2.angvel-(M.b1.vely+M.c2.r1x*M.b1.angvel),z=M.c1.jnAcc,w=M.c2.jnAcc,C=f*M.nx+m*M.ny+M.surfacey+M.c1.bounce-(M.Ka*z+M.Kb*w),P=T*M.nx+S*M.ny+M.surfacey+M.c2.bounce-(M.Kb*z+M.Kc*w),T=-(M.kMassa*C+M.kMassb*P),S=-(M.kMassb*C+M.kMassc*P),0<=T&&0<=S?(C=T-z,P=S-w,M.c1.jnAcc=T,M.c2.jnAcc=S):0<=(T=-M.c1.nMass*C)&&0<=M.Kb*T+P?(C=T-z,P=-w,M.c1.jnAcc=T,M.c2.jnAcc=0):0<=(S=-M.c2.nMass*P)&&0<=M.Kb*S+C?(C=-z,P=S-w,M.c1.jnAcc=0,M.c2.jnAcc=S):0<=C&&0<=P?(C=-z,P=-w,M.c1.jnAcc=M.c2.jnAcc=0):P=C=0,x=C+P,_=M.nx*x,y=M.ny*x,M.b2.velx+=_*M.b2.imass,M.b2.vely+=y*M.b2.imass,M.b1.velx-=_*M.b1.imass,M.b1.vely-=y*M.b1.imass,M.b2.angvel+=(M.rn1b*C+M.rn2b*P)*M.b2.iinertia,M.b1.angvel-=(M.rn1a*C+M.rn2a*P)*M.b1.iinertia):(0!=M.radius&&(x=(M.b2.angvel-M.b1.angvel)*M.rMass,v=M.rfric*M.c1.jnAcc,g=M.jrAcc,M.jrAcc-=x,M.jrAcc>v?M.jrAcc=v:M.jrAcc<-v&&(M.jrAcc=-v),x=M.jrAcc-g,M.b2.angvel+=x*M.b2.iinertia,M.b1.angvel-=x*M.b1.iinertia),f=M.k1x+M.b2.velx-M.c1.r2y*M.b2.angvel-(M.b1.velx-M.c1.r1y*M.b1.angvel),m=M.k1y+M.b2.vely+M.c1.r2x*M.b2.angvel-(M.b1.vely+M.c1.r1x*M.b1.angvel),x=(M.c1.bounce+(M.nx*f+M.ny*m)+M.surfacey)*M.c1.nMass,(b=(g=M.c1.jnAcc)-x)<0&&(b=0),x=b-g,M.c1.jnAcc=b,_=M.nx*x,y=M.ny*x,M.b2.velx+=_*M.b2.imass,M.b2.vely+=y*M.b2.imass,M.b1.velx-=_*M.b1.imass,M.b1.vely-=y*M.b1.imass,M.b2.angvel+=M.rn1b*x*M.b2.iinertia,M.b1.angvel-=M.rn1a*x*M.b1.iinertia)),c=c.next,d&&null==c&&(c=this.c_arbiters_true.head,d=!1)}}},ii.prototype.iteratePos=function(t){for(var e=0;e<t;){++e;for(var i=null,n=this.live_constraints.head;null!=n;){var r=n.elt;!r.__velocity&&r.stiff&&r.applyImpulsePos()?(n=this.live_constraints.erase(i),r.broken(),this.constraintCbBreak(r),r.removeOnBreak?(r.component.sleeping=!0,this.midstep=!1,(null!=r.compound?r.compound:this).wrap_constraints.remove(r.outer),this.midstep=!0):r.active=!1,r.clearcache()):n=(i=n).next}var s=this.c_arbiters_false.head,o=!0;for(null==s&&(s=this.c_arbiters_true.head,o=!1);null!=s;){var a=s.elt;if(a.active&&0!=(1&a.immState))if(2==a.ptype){var l=a.c1,p=0,h=0;p=a.b2.axisy*l.lr2x-a.b2.axisx*l.lr2y,h=l.lr2x*a.b2.axisx+l.lr2y*a.b2.axisy,p+=a.b2.posx,h+=a.b2.posy;var u=0,c=0;u=a.b1.axisy*l.lr1x-a.b1.axisx*l.lr1y,c=l.lr1x*a.b1.axisx+l.lr1y*a.b1.axisy;var d=0,_=0,d=p-(u+=a.b1.posx),_=h-(c+=a.b1.posy),y=Math.sqrt(d*d+_*_),f=a.radius-kr.collisionSlop,l=y-f;d*a.nx+_*a.ny<0&&(d=-d,_=-_,l-=a.radius),l<0&&(y<kr.epsilon?0!=a.b1.smass?a.b1.posx+=10*kr.epsilon:a.b2.posx+=10*kr.epsilon:(d*=l=1/y,z=.5*(c+h),f=y-f,c=(_*=l)*(u=(l=.5*(u+p))-a.b1.posx)-d*(c=z-a.b1.posy),z=_*(p=l-a.b2.posx)-d*(h=z-a.b2.posy),0!=(h=a.b2.smass+z*z*a.b2.sinertia+a.b1.smass+c*c*a.b1.sinertia)&&(g=T=0,T=d*(w=-a.biasCoef*f/h),g=_*w,h=a.b1.imass,a.b1.posx-=T*h,a.b1.posy-=g*h,b=a.b1,_=-c*a.b1.iinertia*w,b.rot+=_,1e-4<_*_?(b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot)):(h=1-(M=_*_)*M/8,M=((c=1-.5*M)*b.axisx+_*b.axisy)*h,b.axisy=(c*b.axisy-_*b.axisx)*h,b.axisx=M),b=a.b2.imass,a.b2.posx+=T*b,a.b2.posy+=g*b,M=a.b2,T=z*a.b2.iinertia*w,M.rot+=T,1e-4<T*T?(M.axisx=Math.sin(M.rot),M.axisy=Math.cos(M.rot)):(S=1-(C=T*T)*C/8,A=((P=1-.5*C)*M.axisx+T*M.axisy)*S,M.axisy=(P*M.axisy-T*M.axisx)*S,M.axisx=A))))}else{var m,x=0,v=0,g=0,b=0,z=0,w=0;0==a.ptype?(x=a.b1.axisy*a.lnormx-a.b1.axisx*a.lnormy,v=a.lnormx*a.b1.axisx+a.lnormy*a.b1.axisy,m=a.lproj+(x*a.b1.posx+v*a.b1.posy),g=a.b2.axisy*a.c1.lr1x-a.b2.axisx*a.c1.lr1y,b=a.c1.lr1x*a.b2.axisx+a.c1.lr1y*a.b2.axisy,g+=a.b2.posx,b+=a.b2.posy,a.hpc2&&(z=a.b2.axisy*a.c2.lr1x-a.b2.axisx*a.c2.lr1y,w=a.c2.lr1x*a.b2.axisx+a.c2.lr1y*a.b2.axisy,z+=a.b2.posx,w+=a.b2.posy)):(x=a.b2.axisy*a.lnormx-a.b2.axisx*a.lnormy,v=a.lnormx*a.b2.axisx+a.lnormy*a.b2.axisy,m=a.lproj+(x*a.b2.posx+v*a.b2.posy),g=a.b1.axisy*a.c1.lr1x-a.b1.axisx*a.c1.lr1y,b=a.c1.lr1x*a.b1.axisx+a.c1.lr1y*a.b1.axisy,g+=a.b1.posx,b+=a.b1.posy,a.hpc2&&(z=a.b1.axisy*a.c2.lr1x-a.b1.axisx*a.c2.lr1y,w=a.c2.lr1x*a.b1.axisx+a.c2.lr1y*a.b1.axisy,z+=a.b1.posx,w+=a.b1.posy));var C=g*x+b*v-m-a.radius;C+=kr.collisionSlop;var P=0;if(a.hpc2&&(P=z*x+w*v-m-a.radius,P+=kr.collisionSlop),C<0||P<0){a.rev&&(x=-x,v=-v);var T=0,S=0,T=g-a.b1.posx,S=b-a.b1.posy,M=0,A=0,M=g-a.b2.posx,A=b-a.b2.posy;if(a.hpc2){var O=v*T-x*S,k=v*M-x*A,E=v*(z-a.b1.posx)-x*(w-a.b1.posy),I=v*(z-a.b2.posx)-x*(w-a.b2.posy),D=a.b1.smass+a.b2.smass;a.kMassa=D+a.b1.sinertia*O*O+a.b2.sinertia*k*k,a.kMassb=D+a.b1.sinertia*O*E+a.b2.sinertia*k*I,a.kMassc=D+a.b1.sinertia*E*E+a.b2.sinertia*I*I;for(var B=a.kMassa,L=a.kMassb,R=a.kMassc,F=C*a.biasCoef,j=P*a.biasCoef;;){var N=0,G=0;N=-(N=F),G=-(G=j);var U=a.kMassa*a.kMassc-a.kMassb*a.kMassb;if(U!=U?N=G=0:0==U?(0!=a.kMassa?N/=a.kMassa:N=0,0!=a.kMassc?G/=a.kMassc:G=0):(V=(U=1/U)*(a.kMassc*N-a.kMassb*G),G=U*(a.kMassa*G-a.kMassb*N),N=V),0<=N&&0<=G){var X=(N+G)*a.b1.imass;a.b1.posx-=x*X,a.b1.posy-=v*X;var U=a.b1,V=-a.b1.iinertia*(O*N+E*G);U.rot+=V,1e-4<V*V?(U.axisx=Math.sin(U.rot),U.axisy=Math.cos(U.rot)):(H=1-(W=V*V)*W/8,W=((X=1-.5*W)*U.axisx+V*U.axisy)*H,U.axisy=(X*U.axisy-V*U.axisx)*H,U.axisx=W);V=(N+G)*a.b2.imass;a.b2.posx+=x*V,a.b2.posy+=v*V;var W,H=a.b2,U=a.b2.iinertia*(k*N+I*G);H.rot+=U,1e-4<U*U?(H.axisx=Math.sin(H.rot),H.axisy=Math.cos(H.rot)):(W=1-(Y=U*U)*Y/8,Y=((V=1-.5*Y)*H.axisx+U*H.axisy)*W,H.axisy=(V*H.axisy-U*H.axisx)*W,H.axisx=Y);break}if((G=0)<=(N=-F/B)&&0<=L*N+j){H=(N+G)*a.b1.imass;a.b1.posx-=x*H,a.b1.posy-=v*H;var q=a.b1,Y=-a.b1.iinertia*(O*N+E*G);q.rot+=Y,1e-4<Y*Y?(q.axisx=Math.sin(q.rot),q.axisy=Math.cos(q.rot)):(K=1-(Z=Y*Y)*Z/8,Z=((H=1-.5*Z)*q.axisx+Y*q.axisy)*K,q.axisy=(H*q.axisy-Y*q.axisx)*K,q.axisx=Z);var K=(N+G)*a.b2.imass;a.b2.posx+=x*K,a.b2.posy+=v*K;var q=a.b2,Z=a.b2.iinertia*(k*N+I*G);q.rot+=Z,1e-4<Z*Z?(q.axisx=Math.sin(q.rot),q.axisy=Math.cos(q.rot)):(J=1-(Q=Z*Z)*Q/8,Q=((K=1-.5*Q)*q.axisx+Z*q.axisy)*J,q.axisy=(K*q.axisy-Z*q.axisx)*J,q.axisx=Q);break}if((N=0)<=(G=-j/R)&&0<=L*G+F){var J=(N+G)*a.b1.imass;a.b1.posx-=x*J,a.b1.posy-=v*J;var q=a.b1,Q=-a.b1.iinertia*(O*N+E*G);q.rot+=Q,1e-4<Q*Q?(q.axisx=Math.sin(q.rot),q.axisy=Math.cos(q.rot)):($=1-(tt=Q*Q)*tt/8,tt=((J=1-.5*tt)*q.axisx+Q*q.axisy)*$,q.axisy=(J*q.axisy-Q*q.axisx)*$,q.axisx=tt);var $=(N+G)*a.b2.imass;a.b2.posx+=x*$,a.b2.posy+=v*$;var q=a.b2,tt=a.b2.iinertia*(k*N+I*G);q.rot+=tt,1e-4<tt*tt?(q.axisx=Math.sin(q.rot),q.axisy=Math.cos(q.rot)):(N=1-($=tt*tt)*$/8,$=((G=1-.5*$)*q.axisx+tt*q.axisy)*N,q.axisy=(G*q.axisy-tt*q.axisx)*N,q.axisx=$);break}break}}else{var et,w=v*T-x*S,D=v*M-x*A,P=a.b2.smass+D*D*a.b2.sinertia+a.b1.smass+w*w*a.b1.sinertia;0!=P&&(S=T=0,T=x*(M=-a.biasCoef*C/P),S=v*M,A=a.b1.imass,a.b1.posx-=T*A,a.b1.posy-=S*A,C=a.b1,P=-w*a.b1.iinertia*M,C.rot+=P,1e-4<P*P?(C.axisx=Math.sin(C.rot),C.axisy=Math.cos(C.rot)):(A=1-(et=P*P)*et/8,et=((w=1-.5*et)*C.axisx+P*C.axisy)*A,C.axisy=(w*C.axisy-P*C.axisx)*A,C.axisx=et),et=a.b2.imass,a.b2.posx+=T*et,a.b2.posy+=S*et,T=a.b2,S=D*a.b2.iinertia*M,T.rot+=S,1e-4<S*S?(T.axisx=Math.sin(T.rot),T.axisy=Math.cos(T.rot)):(D=1-(et=S*S)*et/8,et=((M=1-.5*et)*T.axisx+S*T.axisy)*D,T.axisy=(M*T.axisy-S*T.axisx)*D,T.axisx=et))}}}s=s.next,o&&null==s&&(s=this.c_arbiters_true.head,o=!1)}}},ii.prototype.group_ignore=function(t,e){for(var i=t;null!=i&&null==i.group;)i=null!=i.ishape?i.ishape.body:(null!=i.icompound?i.icompound:i.ibody).compound;var n=null==i?null:i.group;if(null==n)return!1;for(var r=e;null!=r&&null==r.group;)r=null!=r.ishape?r.ishape.body:(null!=r.icompound?r.icompound:r.ibody).compound;var s=null==r?null:r.group;if(null==s)return!1;for(var o=!1;null!=n&&null!=s;){if(n==s){o=n.ignore;break}n.depth<s.depth?s=s.group:n=n.group}return o},ii.prototype.interactionType=function(t,e,i,n){for(var r,s,o,a=!1,l=i.constraints.head;null!=l;){var p=l.elt;if(p.ignore&&p.pair_exists(i.id,n.id)){a=!0;break}l=l.next}if(a)r=!1;else{for(var h=t;null!=h&&null==h.group;)h=null!=h.ishape?h.ishape.body:(null!=h.icompound?h.icompound:h.ibody).compound;var u,c=null==h?null:h.group;if(null==c)u=!1;else{for(var d=e;null!=d&&null==d.group;)d=null!=d.ishape?d.ishape.body:(null!=d.icompound?d.icompound:d.ibody).compound;var _=null==d?null:d.group;if(null==_)u=!1;else{for(var y=!1;null!=c&&null!=_;){if(c==_){y=c.ignore;break}c.depth<_.depth?_=_.group:c=c.group}u=y}}r=!u}if(r){if(!(!t.sensorEnabled&&!e.sensorEnabled)&&(o=t.filter,s=e.filter,0!=(o.sensorMask&s.sensorGroup)&&0!=(s.sensorMask&o.sensorGroup)))return 2;if(!!(!(!t.fluidEnabled&&!e.fluidEnabled)&&(s=t.filter,o=e.filter,0!=(s.fluidMask&o.fluidGroup)&&0!=(o.fluidMask&s.fluidGroup)))&&!(0==i.imass&&0==n.imass&&0==i.iinertia&&0==n.iinertia))return 0;var t=t.filter,e=e.filter,t=0!=(t.collisionMask&e.collisionGroup)&&0!=(e.collisionMask&t.collisionGroup)&&!(0==i.imass&&0==n.imass&&0==i.iinertia&&0==n.iinertia);return t?1:-1}return-1},ii.prototype.precb=null,ii.prototype.prelisteners=null,ii.prototype.narrowPhase=function(t,e,i,n,r){for(var s,o,a,l=null,p=t.body,h=e.body,u=!1,c=p.constraints.head;null!=c;){var d=c.elt;if(d.ignore&&d.pair_exists(p.id,h.id)){u=!0;break}c=c.next}if(u)s=!1;else{for(var _=t;null!=_&&null==_.group;)_=null!=_.ishape?_.ishape.body:(null!=_.icompound?_.icompound:_.ibody).compound;var y,f=null==_?null:_.group;if(null==f)y=!1;else{for(var m=e;null!=m&&null==m.group;)m=null!=m.ishape?m.ishape.body:(null!=m.icompound?m.icompound:m.ibody).compound;var x=null==m?null:m.group;if(null==x)y=!1;else{for(var v=!1;null!=f&&null!=x;){if(f==x){v=f.ignore;break}f.depth<x.depth?x=x.group:f=f.group}y=v}}s=!y}if(-1!=(ie=s?!(!t.sensorEnabled&&!e.sensorEnabled)&&(ie=t.filter,s=e.filter,0!=(ie.sensorMask&s.sensorGroup)&&0!=(s.sensorMask&ie.sensorGroup))?2:!!(!(!t.fluidEnabled&&!e.fluidEnabled)&&(I=t.filter,z=e.filter,0!=(I.fluidMask&z.fluidGroup)&&0!=(z.fluidMask&I.fluidGroup)))&&!(0==p.imass&&0==h.imass&&0==p.iinertia&&0==h.iinertia)?0:(S=t.filter,D=e.filter,0!=(S.collisionMask&D.collisionGroup)&&0!=(D.collisionMask&S.collisionGroup)&&!(0==p.imass&&0==h.imass&&0==p.iinertia&&0==h.iinertia)?1:-1):-1)){t.type>e.type?(o=e,a=t):t.type!=e.type||t.id<e.id?(o=t,a=e):(a=t,o=e);var g,b,z=o==e;if(0==ie){if(null==n){for(var w=null,C=(p.arbiters.length<h.arbiters.length?p:h).arbiters.head;null!=C;){var P=C.elt;if(P.id==o.id&&P.di==a.id){w=P;break}C=C.next}g=w}else g=n;var T,S,M,A,O,k,E,I=null==g,D=!1;if(I)null==Zn.zpp_pool?T=new Zn:(T=Zn.zpp_pool,Zn.zpp_pool=T.next,T.next=null);else if(null==g.fluidarb){g.cleared=!0;for(var B,L,R=g.b1.arbiters,F=null,j=R.head;null!=j;){if(j.elt==g){null==F?(L=(B=R.head).next,R.head=L,null==R.head&&(R.pushmod=!0)):(L=(B=F.next).next,null==(F.next=L)&&(R.pushmod=!0));var N=B;N.elt=null,N.next=er.zpp_pool,er.zpp_pool=N,R.modified=!0,R.length--,R.pushmod=!0;break}j=(F=j).next}for(var G,U,X=g.b2.arbiters,V=null,W=X.head;null!=W;){if(W.elt==g){null==V?(U=(G=X.head).next,X.head=U,null==X.head&&(X.pushmod=!0)):(U=(G=V.next).next,null==(V.next=U)&&(X.pushmod=!0));var H=G;H.elt=null,H.next=er.zpp_pool,er.zpp_pool=H,X.modified=!0,X.length--,X.pushmod=!0;break}W=(V=W).next}null!=g.pair&&(g.pair.arb=null,g.pair=null),g.active=!1,this.f_arbiters.modified=!0,null==Zn.zpp_pool?T=new Zn:(T=Zn.zpp_pool,Zn.zpp_pool=T.next,T.next=null),D=I=T.intchange=!0}else T=g.fluidarb;if(I||T.stamp!=this.stamp||r)if(T.stamp=this.stamp,Er.flowCollide(o,a,T)){if(I?(S=o.id,Y=a.id,T.b1=t.body,T.ws1=t,T.b2=e.body,T.ws2=e,T.id=S,T.di=Y,Y=T.b1.arbiters,null==er.zpp_pool?M=new er:(M=er.zpp_pool,er.zpp_pool=M.next,M.next=null),M.elt=T,(M=M).next=Y.head,Y.head=M,Y.modified=!0,Y.length++,Y=T.b2.arbiters,null==er.zpp_pool?A=new er:(A=er.zpp_pool,er.zpp_pool=A.next,A.next=null),A.elt=T,(A=A).next=Y.head,Y.head=A,Y.modified=!0,Y.length++,T.active=!0,T.present=0,T.cleared=!1,T.sleeping=!1,T.fresh=!1,T.presentable=!1,T.nx=0,T.ny=1,T.dampx=0,T.dampy=0,T.adamp=0,Y=this.f_arbiters,null==rr.zpp_pool?O=new rr:(O=rr.zpp_pool,rr.zpp_pool=O.next,O.next=null),O.elt=T,(O=O).next=Y.head,Y.head=O,Y.modified=!0,Y.length++,T.fresh=!D):T.fresh=T.up_stamp<this.stamp-1||T.endGenerated==this.stamp&&r,T.up_stamp=T.stamp,T.fresh||0==(4&T.immState)){for(var q=!(T.immState=1),Y=T.ws1.id>T.ws2.id?T.ws2:T.ws1,D=T.ws1.id>T.ws2.id?T.ws1:T.ws2,K=this.mrca1;null!=K.head;){var Z=K.head;K.head=Z.next,Z.elt=null,Z.next=nr.zpp_pool,nr.zpp_pool=Z,null==K.head&&(K.pushmod=!0),K.modified=!0,K.length--}K.pushmod=!0;for(var J,Q,$,tt,et,it,nt=this.mrca2;null!=nt.head;){var rt=nt.head;nt.head=rt.next,rt.elt=null,rt.next=nr.zpp_pool,nr.zpp_pool=rt,null==nt.head&&(nt.pushmod=!0),nt.modified=!0,nt.length--}nt.pushmod=!0,null!=Y.cbSet&&(Q=this.mrca1,null==nr.zpp_pool?J=new nr:(J=nr.zpp_pool,nr.zpp_pool=J.next,J.next=null),J.elt=Y,(J=J).next=Q.head,Q.head=J,Q.modified=!0,Q.length++),null!=Y.body.cbSet&&(J=this.mrca1,Q=Y.body,null==nr.zpp_pool?$=new nr:($=nr.zpp_pool,nr.zpp_pool=$.next,$.next=null),$.elt=Q,($=$).next=J.head,J.head=$,J.modified=!0,J.length++),null!=D.cbSet&&(et=this.mrca2,null==nr.zpp_pool?tt=new nr:(tt=nr.zpp_pool,nr.zpp_pool=tt.next,tt.next=null),tt.elt=D,(tt=tt).next=et.head,et.head=tt,et.modified=!0,et.length++),null!=D.body.cbSet&&(tt=this.mrca2,et=D.body,null==nr.zpp_pool?it=new nr:(it=nr.zpp_pool,nr.zpp_pool=it.next,it.next=null),it.elt=et,(it=it).next=tt.head,tt.head=it,tt.modified=!0,tt.length++);for(var st,ot,at,lt,pt=Y.body.compound,ht=D.body.compound;pt!=ht;)(null==pt?0:pt.depth)<(null==ht?0:ht.depth)?(null!=ht.cbSet&&(lt=this.mrca2,null==nr.zpp_pool?st=new nr:(st=nr.zpp_pool,nr.zpp_pool=st.next,st.next=null),st.elt=ht,(ot=st).next=lt.head,lt.head=ot,lt.modified=!0,lt.length++),ht=ht.compound):(null!=pt.cbSet&&(ot=this.mrca1,null==nr.zpp_pool?at=new nr:(at=nr.zpp_pool,nr.zpp_pool=at.next,at.next=null),at.elt=pt,(lt=at).next=ot.head,ot.head=lt,ot.modified=!0,ot.length++),pt=pt.compound);for(var ut,ct=this.mrca1.head;null!=ct;){for(var dt=ct.elt,_t=this.mrca2.head;null!=_t;){for(var yt,ft=_t.elt,mt=dt.cbSet,xt=ft.cbSet,vt=null,gt=(mt.cbpairs.length<xt.cbpairs.length?mt:xt).cbpairs.head;null!=gt;){var bt=gt.elt;if(bt.a==mt&&bt.b==xt||bt.a==xt&&bt.b==mt){vt=bt;break}gt=gt.next}if(null==vt&&(null==qn.zpp_pool?yt=new qn:(yt=qn.zpp_pool,qn.zpp_pool=yt.next,yt.next=null),yt.zip_listeners=!0,Hn.setlt(mt,xt)?(yt.a=mt,yt.b=xt):(yt.a=xt,yt.b=mt),vt=yt,mt.cbpairs.add(vt),xt!=mt&&xt.cbpairs.add(vt)),vt.zip_listeners&&(vt.zip_listeners=!1,vt.__validate()),null!=vt.listeners.head){for(var zt=null,wt=null,Ct=this.prelisteners;null!=Ct.head;){var Pt=Ct.head;Ct.head=Pt.next,Pt.elt=null,Pt.next=ir.zpp_pool,ir.zpp_pool=Pt,null==Ct.head&&(Ct.pushmod=!0),Ct.modified=!0,Ct.length--}Ct.pushmod=!0;for(var Tt,St=null,Mt=null,At=(mt.cbpairs.length<xt.cbpairs.length?mt:xt).cbpairs.head;null!=At;){var Ot=At.elt;if(Ot.a==mt&&Ot.b==xt||Ot.a==xt&&Ot.b==mt){Mt=Ot;break}At=At.next}null==Mt&&(null==qn.zpp_pool?Tt=new qn:(Tt=qn.zpp_pool,qn.zpp_pool=Tt.next,Tt.next=null),Tt.zip_listeners=!0,Hn.setlt(mt,xt)?(Tt.a=mt,Tt.b=xt):(Tt.a=xt,Tt.b=mt),Mt=Tt,mt.cbpairs.add(Mt),xt!=mt&&xt.cbpairs.add(Mt)),Mt.zip_listeners&&(Mt.zip_listeners=!1,Mt.__validate());for(var kt=Mt.listeners.head;null!=kt;){var Et,It,Dt,Bt=kt.elt;5==Bt.event&&0!=(4&Bt.itype)&&(Et=this.prelisteners,null==ir.zpp_pool?It=new ir:(It=ir.zpp_pool,ir.zpp_pool=It.next,It.next=null),It.elt=Bt,Dt=It,null==St?(Dt.next=Et.head,Et.head=Dt):(Dt.next=St.next,St.next=Dt),Et.pushmod=Et.modified=!0,Et.length++,St=Dt,q=!!q||!Bt.pure),kt=kt.next}if(null!=this.prelisteners.head){if(null==(zt=$n.get(dt,ft))&&(wt=tr.get(dt,ft),this.add_callbackset(wt)),null==zt||(zt.FLUIDstamp!=this.stamp||r)&&0==(4&zt.FLUIDstate)){if(null!=wt&&(zt=wt),null!=zt)for(var Lt=this.prelisteners.head;null!=Lt;)7==Lt.elt.itype&&(zt.COLLISIONstamp=this.stamp,zt.SENSORstamp=this.stamp),zt.FLUIDstamp=this.stamp,Lt=Lt.next;wt=T.active;T.active=!0,this.precb.zpp_inner.pre_arbiter=T,this.precb.zpp_inner.set=zt;for(var Rt=this.prelisteners.head;null!=Rt;){var Ft=Rt.elt;this.precb.zpp_inner.listener=Ft;var jt=this.precb.zpp_inner,Nt=zt.int1,Gt=zt.int2,Ut=Ft.options1,Xt=Nt.cbTypes;!(!Ut.nonemptyintersection(Xt,Ut.includes)||Ut.nonemptyintersection(Xt,Ut.excludes))&&(Xt=Ft.options2,Ut=Gt.cbTypes,!!Xt.nonemptyintersection(Ut,Xt.includes)&&!Xt.nonemptyintersection(Ut,Xt.excludes))?(jt.int1=Nt,jt.int2=Gt):(jt.int1=Gt,jt.int2=Nt),this.precb.zpp_inner.pre_swapped=dt!=this.precb.zpp_inner.int1;Ft=Ft.handlerp(this.precb);null!=Ft&&(null==Yn.PreFlag_ACCEPT&&(Yn.internal=!0,Yn.PreFlag_ACCEPT=new Wn,Yn.internal=!1),Ft=Ft==Yn.PreFlag_ACCEPT?5:(null==Yn.PreFlag_ACCEPT_ONCE&&(Yn.internal=!0,Yn.PreFlag_ACCEPT_ONCE=new Wn,Yn.internal=!1),Ft==Yn.PreFlag_ACCEPT_ONCE?1:(null==Yn.PreFlag_IGNORE&&(Yn.internal=!0,Yn.PreFlag_IGNORE=new Wn,Yn.internal=!1),Ft==Yn.PreFlag_IGNORE?6:2)),T.immState=Ft),Rt=Rt.next}if(T.active=wt,null!=zt)for(var Vt=this.prelisteners.head;null!=Vt;)7==Vt.elt.itype&&(zt.COLLISIONstate=T.immState,zt.SENSORstate=T.immState),zt.FLUIDstate=T.immState,Vt=Vt.next}else null==zt?0==(4&T.immState)&&(T.immState=1):T.immState=zt.FLUIDstate;_t=_t.next}else _t=_t.next}else _t=_t.next}ct=ct.next}q&&0==(4&T.immState)&&(2==T.b1.type&&((D=T.b1).world||(D.component.waket=this.stamp+(this.midstep?0:1),3==D.type&&(D.kinematicDelaySleep=!0),D.component.sleeping&&this.really_wake(D,!1))),2==T.b1.type&&((ut=T.b2).world||(ut.component.waket=this.stamp+(this.midstep?0:1),3==ut.type&&(ut.kinematicDelaySleep=!0),ut.component.sleeping&&this.really_wake(ut,!1))))}0!=(1&T.immState)&&(2==T.b1.type&&T.b1.component.sleeping&&((ut=T.b1).world||(ut.component.waket=this.stamp+(this.midstep?0:1),3==ut.type&&(ut.kinematicDelaySleep=!0),ut.component.sleeping&&this.really_wake(ut,!1))),2==T.b2.type&&T.b2.component.sleeping&&((k=T.b2).world||(k.component.waket=this.stamp+(this.midstep?0:1),3==k.type&&(k.kinematicDelaySleep=!0),k.component.sleeping&&this.really_wake(k,!1)))),T.sleeping&&(T.sleeping=!1,k=this.f_arbiters,null==rr.zpp_pool?E=new rr:(E=rr.zpp_pool,rr.zpp_pool=E.next,E.next=null),E.elt=T,(E=E).next=k.head,k.head=E,k.modified=!0,k.length++),l=T}else l=I?((Ht=T).next=Zn.zpp_pool,Zn.zpp_pool=Ht,null):T;else l=T}else if(1==ie){var Wt,Ht=i?this.c_arbiters_true:this.c_arbiters_false;if(null==n){for(var qt=null,Yt=(p.arbiters.length<h.arbiters.length?p:h).arbiters.head;null!=Yt;){var Kt=Yt.elt;if(Kt.id==o.id&&Kt.di==a.id){qt=Kt;break}Yt=Yt.next}Wt=qt}else Wt=n;var Zt,Jt,Qt,$t,te,ee=null==Wt,ie=!1;if(ee)null==Jn.zpp_pool?Zt=new Jn:(Zt=Jn.zpp_pool,Jn.zpp_pool=Zt.next,Zt.next=null),Zt.stat=i;else if(null==Wt.colarb){Wt.cleared=!0;for(var ne,re,se=Wt.b1.arbiters,oe=null,ae=se.head;null!=ae;){if(ae.elt==Wt){null==oe?(re=(ne=se.head).next,se.head=re,null==se.head&&(se.pushmod=!0)):(re=(ne=oe.next).next,null==(oe.next=re)&&(se.pushmod=!0));var le=ne;le.elt=null,le.next=er.zpp_pool,er.zpp_pool=le,se.modified=!0,se.length--,se.pushmod=!0;break}ae=(oe=ae).next}for(var pe,he,ue=Wt.b2.arbiters,ce=null,de=ue.head;null!=de;){if(de.elt==Wt){null==ce?(he=(pe=ue.head).next,ue.head=he,null==ue.head&&(ue.pushmod=!0)):(he=(pe=ce.next).next,null==(ce.next=he)&&(ue.pushmod=!0));var _e=pe;_e.elt=null,_e.next=er.zpp_pool,er.zpp_pool=_e,ue.modified=!0,ue.length--,ue.pushmod=!0;break}de=(ce=de).next}null!=Wt.pair&&(Wt.pair.arb=null,Wt.pair=null),Wt.active=!1,this.f_arbiters.modified=!0,null==Jn.zpp_pool?Zt=new Jn:(Zt=Jn.zpp_pool,Jn.zpp_pool=Zt.next,Zt.next=null),Zt.intchange=!0,Zt.stat=i,ie=ee=!0}else z=o!=(Zt=Wt.colarb).s1,Zt.stat!=i&&(Zt.stat=i,Zt.sleeping||((i?this.c_arbiters_false:this.c_arbiters_true).remove(Zt),Ht.add(Zt)));if(ee||Zt.stamp!=this.stamp||r)if(Zt.stamp=this.stamp,Er.contactCollide(o,a,Zt,z)){if(ee?(i=o.id,z=a.id,Zt.b1=t.body,Zt.ws1=t,Zt.b2=e.body,Zt.ws2=e,Zt.id=i,Zt.di=z,z=Zt.b1.arbiters,null==er.zpp_pool?Jt=new er:(Jt=er.zpp_pool,er.zpp_pool=Jt.next,Jt.next=null),Jt.elt=Zt,(Jt=Jt).next=z.head,z.head=Jt,z.modified=!0,z.length++,z=Zt.b2.arbiters,null==er.zpp_pool?Qt=new er:(Qt=er.zpp_pool,er.zpp_pool=Qt.next,Qt.next=null),Qt.elt=Zt,(Qt=Qt).next=z.head,z.head=Qt,z.modified=!0,z.length++,Zt.active=!0,Zt.present=0,Zt.cleared=!1,Zt.sleeping=!1,Zt.fresh=!1,Zt.presentable=!1,Zt.s1=t,Zt.s2=e,Zt.userdef_restitution||(Zt.s1.material.elasticity<=-1/0||Zt.s2.material.elasticity<=-1/0?Zt.restitution=0:Zt.s1.material.elasticity>=1/0||Zt.s2.material.elasticity>=1/0?Zt.restitution=1:Zt.restitution=(Zt.s1.material.elasticity+Zt.s2.material.elasticity)/2,Zt.restitution<0&&(Zt.restitution=0),1<Zt.restitution&&(Zt.restitution=1)),Zt.userdef_dyn_fric||(Zt.dyn_fric=Math.sqrt(Zt.s1.material.dynamicFriction*Zt.s2.material.dynamicFriction)),Zt.userdef_stat_fric||(Zt.stat_fric=Math.sqrt(Zt.s1.material.staticFriction*Zt.s2.material.staticFriction)),Zt.userdef_rfric||(Zt.rfric=Math.sqrt(Zt.s1.material.rollingFriction*Zt.s2.material.rollingFriction)),null==or.zpp_pool?fe=new or:(fe=or.zpp_pool,or.zpp_pool=fe.next,fe.next=null),fe.elt=Zt,(fe=fe).next=Ht.head,Ht.head=fe,Ht.modified=!0,Ht.length++,Zt.fresh=!ie):Zt.fresh=Zt.up_stamp<this.stamp-1||Zt.endGenerated==this.stamp&&r,Zt.up_stamp=Zt.stamp,Zt.fresh||0==(4&Zt.immState)){for(var ye=!(Zt.immState=1),fe=Zt.ws1.id>Zt.ws2.id?Zt.ws2:Zt.ws1,ie=Zt.ws1.id>Zt.ws2.id?Zt.ws1:Zt.ws2,me=this.mrca1;null!=me.head;){var xe=me.head;me.head=xe.next,xe.elt=null,xe.next=nr.zpp_pool,nr.zpp_pool=xe,null==me.head&&(me.pushmod=!0),me.modified=!0,me.length--}me.pushmod=!0;for(var ve,ge,be,ze,we,Ce,Pe=this.mrca2;null!=Pe.head;){var Te=Pe.head;Pe.head=Te.next,Te.elt=null,Te.next=nr.zpp_pool,nr.zpp_pool=Te,null==Pe.head&&(Pe.pushmod=!0),Pe.modified=!0,Pe.length--}Pe.pushmod=!0,null!=fe.cbSet&&(ge=this.mrca1,null==nr.zpp_pool?ve=new nr:(ve=nr.zpp_pool,nr.zpp_pool=ve.next,ve.next=null),ve.elt=fe,(ve=ve).next=ge.head,ge.head=ve,ge.modified=!0,ge.length++),null!=fe.body.cbSet&&(ve=this.mrca1,ge=fe.body,null==nr.zpp_pool?be=new nr:(be=nr.zpp_pool,nr.zpp_pool=be.next,be.next=null),be.elt=ge,(be=be).next=ve.head,ve.head=be,ve.modified=!0,ve.length++),null!=ie.cbSet&&(we=this.mrca2,null==nr.zpp_pool?ze=new nr:(ze=nr.zpp_pool,nr.zpp_pool=ze.next,ze.next=null),ze.elt=ie,(ze=ze).next=we.head,we.head=ze,we.modified=!0,we.length++),null!=ie.body.cbSet&&(ze=this.mrca2,we=ie.body,null==nr.zpp_pool?Ce=new nr:(Ce=nr.zpp_pool,nr.zpp_pool=Ce.next,Ce.next=null),Ce.elt=we,(Ce=Ce).next=ze.head,ze.head=Ce,ze.modified=!0,ze.length++);for(var Se,Me,Ae,Oe,ke=fe.body.compound,Ee=ie.body.compound;ke!=Ee;)(null==ke?0:ke.depth)<(null==Ee?0:Ee.depth)?(null!=Ee.cbSet&&(Oe=this.mrca2,null==nr.zpp_pool?Se=new nr:(Se=nr.zpp_pool,nr.zpp_pool=Se.next,Se.next=null),Se.elt=Ee,(Me=Se).next=Oe.head,Oe.head=Me,Oe.modified=!0,Oe.length++),Ee=Ee.compound):(null!=ke.cbSet&&(Me=this.mrca1,null==nr.zpp_pool?Ae=new nr:(Ae=nr.zpp_pool,nr.zpp_pool=Ae.next,Ae.next=null),Ae.elt=ke,(Oe=Ae).next=Me.head,Me.head=Oe,Me.modified=!0,Me.length++),ke=ke.compound);for(var Ie,De=this.mrca1.head;null!=De;){for(var Be=De.elt,Le=this.mrca2.head;null!=Le;){for(var Re,Fe=Le.elt,je=Be.cbSet,Ne=Fe.cbSet,Ge=null,Ue=(je.cbpairs.length<Ne.cbpairs.length?je:Ne).cbpairs.head;null!=Ue;){var Xe=Ue.elt;if(Xe.a==je&&Xe.b==Ne||Xe.a==Ne&&Xe.b==je){Ge=Xe;break}Ue=Ue.next}if(null==Ge&&(null==qn.zpp_pool?Re=new qn:(Re=qn.zpp_pool,qn.zpp_pool=Re.next,Re.next=null),Re.zip_listeners=!0,Hn.setlt(je,Ne)?(Re.a=je,Re.b=Ne):(Re.a=Ne,Re.b=je),Ge=Re,je.cbpairs.add(Ge),Ne!=je&&Ne.cbpairs.add(Ge)),Ge.zip_listeners&&(Ge.zip_listeners=!1,Ge.__validate()),null!=Ge.listeners.head){for(var Ve=null,We=null,He=this.prelisteners;null!=He.head;){var qe=He.head;He.head=qe.next,qe.elt=null,qe.next=ir.zpp_pool,ir.zpp_pool=qe,null==He.head&&(He.pushmod=!0),He.modified=!0,He.length--}He.pushmod=!0;for(var Ye,Ke=null,Ze=null,Je=(je.cbpairs.length<Ne.cbpairs.length?je:Ne).cbpairs.head;null!=Je;){var Qe=Je.elt;if(Qe.a==je&&Qe.b==Ne||Qe.a==Ne&&Qe.b==je){Ze=Qe;break}Je=Je.next}null==Ze&&(null==qn.zpp_pool?Ye=new qn:(Ye=qn.zpp_pool,qn.zpp_pool=Ye.next,Ye.next=null),Ye.zip_listeners=!0,Hn.setlt(je,Ne)?(Ye.a=je,Ye.b=Ne):(Ye.a=Ne,Ye.b=je),Ze=Ye,je.cbpairs.add(Ze),Ne!=je&&Ne.cbpairs.add(Ze)),Ze.zip_listeners&&(Ze.zip_listeners=!1,Ze.__validate());for(var $e=Ze.listeners.head;null!=$e;){var ti,ei,ii,ni=$e.elt;5==ni.event&&0!=(1&ni.itype)&&(ti=this.prelisteners,null==ir.zpp_pool?ei=new ir:(ei=ir.zpp_pool,ir.zpp_pool=ei.next,ei.next=null),ei.elt=ni,ii=ei,null==Ke?(ii.next=ti.head,ti.head=ii):(ii.next=Ke.next,Ke.next=ii),ti.pushmod=ti.modified=!0,ti.length++,Ke=ii,ye=!!ye||!ni.pure),$e=$e.next}if(null!=this.prelisteners.head){if(null==(Ve=$n.get(Be,Fe))&&(We=tr.get(Be,Fe),this.add_callbackset(We)),null==Ve||(Ve.COLLISIONstamp!=this.stamp||r)&&0==(4&Ve.COLLISIONstate)){if(null!=We&&(Ve=We),null!=Ve)for(var ri=this.prelisteners.head;null!=ri;)7==ri.elt.itype?(Ve.COLLISIONstamp=this.stamp,Ve.SENSORstamp=this.stamp,Ve.FLUIDstamp=this.stamp):Ve.COLLISIONstamp=this.stamp,ri=ri.next;var Fe=Zt.active,si=Zt.active=!0,oi=null,ai=null,li=Zt.innards.next;Zt.hc2=!1;for(var pi=Zt.contacts.next;null!=pi;){var hi,ui,ci,di,_i,yi,fi=pi;fi.stamp+kr.arbiterExpirationDelay<Zt.stamp?(_i=Zt.contacts,null==oi?(ui=(hi=_i.next).next,_i.next=ui,null==_i.next&&(_i.pushmod=!0)):(ui=(hi=oi.next).next,null==(oi.next=ui)&&(_i.pushmod=!0)),hi._inuse=!1,_i.modified=!0,_i.length--,_i.pushmod=!0,pi=ui,yi=Zt.innards,null==ai?(di=(ci=yi.next).next,yi.next=di,null==yi.next&&(yi.pushmod=!0)):(di=(ci=ai.next).next,null==(ai.next=di)&&(yi.pushmod=!0)),ci._inuse=!1,yi.modified=!0,yi.length--,yi.pushmod=!0,li=di,fi.arbiter=null,fi.next=Qn.zpp_pool,Qn.zpp_pool=fi):(_i=fi.inner,yi=fi.active,fi.active=fi.stamp==Zt.stamp,fi.active&&(si?(si=!1,Zt.c1=_i,Zt.oc1=fi):(Zt.hc2=!0,Zt.c2=_i,Zt.oc2=fi)),yi!=fi.active&&(Zt.contacts.modified=!0),oi=pi,li=(ai=li).next,pi=pi.next)}Zt.hc2?(Zt.hpc2=!0,Zt.oc1.posOnly?(We=Zt.c1,Zt.c1=Zt.c2,Zt.c2=We,We=Zt.oc1,Zt.oc1=Zt.oc2,Zt.oc2=We,Zt.hc2=!1):Zt.oc2.posOnly&&(Zt.hc2=!1)):Zt.hpc2=!1,this.precb.zpp_inner.pre_arbiter=Zt,this.precb.zpp_inner.set=Ve;for(var mi=this.prelisteners.head;null!=mi;){var xi=mi.elt;this.precb.zpp_inner.listener=xi;var vi=this.precb.zpp_inner,gi=Ve.int1,bi=Ve.int2,zi=xi.options1,wi=gi.cbTypes;!(!zi.nonemptyintersection(wi,zi.includes)||zi.nonemptyintersection(wi,zi.excludes))&&(wi=xi.options2,zi=bi.cbTypes,!!wi.nonemptyintersection(zi,wi.includes)&&!wi.nonemptyintersection(zi,wi.excludes))?(vi.int1=gi,vi.int2=bi):(vi.int1=bi,vi.int2=gi),this.precb.zpp_inner.pre_swapped=Be!=this.precb.zpp_inner.int1;xi=xi.handlerp(this.precb);null!=xi&&(null==Yn.PreFlag_ACCEPT&&(Yn.internal=!0,Yn.PreFlag_ACCEPT=new Wn,Yn.internal=!1),xi=xi==Yn.PreFlag_ACCEPT?5:(null==Yn.PreFlag_ACCEPT_ONCE&&(Yn.internal=!0,Yn.PreFlag_ACCEPT_ONCE=new Wn,Yn.internal=!1),xi==Yn.PreFlag_ACCEPT_ONCE?1:(null==Yn.PreFlag_IGNORE&&(Yn.internal=!0,Yn.PreFlag_IGNORE=new Wn,Yn.internal=!1),xi==Yn.PreFlag_IGNORE?6:2)),Zt.immState=xi),mi=mi.next}if(Zt.active=Fe,null!=Ve)for(var Ci=this.prelisteners.head;null!=Ci;)7==Ci.elt.itype?(Ve.COLLISIONstate=Zt.immState,Ve.SENSORstate=Zt.immState,Ve.FLUIDstate=Zt.immState):Ve.COLLISIONstate=Zt.immState,Ci=Ci.next}else null==Ve?0==(4&Zt.immState)&&(Zt.immState=1):Zt.immState=Ve.COLLISIONstate;Le=Le.next}else Le=Le.next}else Le=Le.next}De=De.next}ye&&0==(4&Zt.immState)&&(2==Zt.b1.type&&((Ie=Zt.b1).world||(Ie.component.waket=this.stamp+(this.midstep?0:1),3==Ie.type&&(Ie.kinematicDelaySleep=!0),Ie.component.sleeping&&this.really_wake(Ie,!1))),2==Zt.b1.type&&((Ie=Zt.b2).world||(Ie.component.waket=this.stamp+(this.midstep?0:1),3==Ie.type&&(Ie.kinematicDelaySleep=!0),Ie.component.sleeping&&this.really_wake(Ie,!1))))}0!=(1&Zt.immState)&&(2==Zt.b1.type&&Zt.b1.component.sleeping&&(($t=Zt.b1).world||($t.component.waket=this.stamp+(this.midstep?0:1),3==$t.type&&($t.kinematicDelaySleep=!0),$t.component.sleeping&&this.really_wake($t,!1))),2==Zt.b2.type&&Zt.b2.component.sleeping&&(($t=Zt.b2).world||($t.component.waket=this.stamp+(this.midstep?0:1),3==$t.type&&($t.kinematicDelaySleep=!0),$t.component.sleeping&&this.really_wake($t,!1)))),Zt.sleeping&&(Zt.sleeping=!1,null==or.zpp_pool?te=new or:(te=or.zpp_pool,or.zpp_pool=te.next,te.next=null),te.elt=Zt,(te=te).next=Ht.head,Ht.head=te,Ht.modified=!0,Ht.length++),l=Zt}else l=ee?((Ii=Zt).userdef_dyn_fric=!1,Ii.userdef_stat_fric=!1,Ii.userdef_restitution=!1,Ii.userdef_rfric=!1,Ii.__ref_edge1=Ii.__ref_edge2=null,Ii.next=Jn.zpp_pool,Jn.zpp_pool=Ii,null):Zt;else l=Zt}else{if(null==n){for(var Pi=null,Ti=(p.arbiters.length<h.arbiters.length?p:h).arbiters.head;null!=Ti;){var Si=Ti.elt;if(Si.id==o.id&&Si.di==a.id){Pi=Si;break}Ti=Ti.next}b=Pi}else b=n;var Mi,Ai,Oi,ki,Ei,ee=null==b,Ii=!1;if(ee)null==Kn.zpp_pool?Mi=new Kn:(Mi=Kn.zpp_pool,Kn.zpp_pool=Mi.next,Mi.next=null);else if(null==b.sensorarb){b.cleared=!0;for(var Di,Bi,Li=b.b1.arbiters,Ri=null,Fi=Li.head;null!=Fi;){if(Fi.elt==b){null==Ri?(Bi=(Di=Li.head).next,Li.head=Bi,null==Li.head&&(Li.pushmod=!0)):(Bi=(Di=Ri.next).next,null==(Ri.next=Bi)&&(Li.pushmod=!0));var ji=Di;ji.elt=null,ji.next=er.zpp_pool,er.zpp_pool=ji,Li.modified=!0,Li.length--,Li.pushmod=!0;break}Fi=(Ri=Fi).next}for(var Ni,Gi,Ui=b.b2.arbiters,Xi=null,Vi=Ui.head;null!=Vi;){if(Vi.elt==b){null==Xi?(Gi=(Ni=Ui.head).next,Ui.head=Gi,null==Ui.head&&(Ui.pushmod=!0)):(Gi=(Ni=Xi.next).next,null==(Xi.next=Gi)&&(Ui.pushmod=!0));var Wi=Ni;Wi.elt=null,Wi.next=er.zpp_pool,er.zpp_pool=Wi,Ui.modified=!0,Ui.length--,Ui.pushmod=!0;break}Vi=(Xi=Vi).next}null!=b.pair&&(b.pair.arb=null,b.pair=null),b.active=!1,this.f_arbiters.modified=!0,null==Kn.zpp_pool?Mi=new Kn:(Mi=Kn.zpp_pool,Kn.zpp_pool=Mi.next,Mi.next=null),Ii=ee=Mi.intchange=!0}else Mi=b.sensorarb;if(ee||Mi.stamp!=this.stamp||r)if(Mi.stamp=this.stamp,Er.testCollide(o,a)){if(ee?(n=o.id,qi=a.id,Mi.b1=t.body,Mi.ws1=t,Mi.b2=e.body,Mi.ws2=e,Mi.id=n,Mi.di=qi,qi=Mi.b1.arbiters,null==er.zpp_pool?Ai=new er:(Ai=er.zpp_pool,er.zpp_pool=Ai.next,Ai.next=null),Ai.elt=Mi,(Ai=Ai).next=qi.head,qi.head=Ai,qi.modified=!0,qi.length++,qi=Mi.b2.arbiters,null==er.zpp_pool?Oi=new er:(Oi=er.zpp_pool,er.zpp_pool=Oi.next,Oi.next=null),Oi.elt=Mi,(Oi=Oi).next=qi.head,qi.head=Oi,qi.modified=!0,qi.length++,Mi.active=!0,Mi.present=0,Mi.cleared=!1,Mi.sleeping=!1,Mi.fresh=!1,Mi.presentable=!1,qi=this.s_arbiters,null==sr.zpp_pool?ki=new sr:(ki=sr.zpp_pool,sr.zpp_pool=ki.next,ki.next=null),ki.elt=Mi,(ki=ki).next=qi.head,qi.head=ki,qi.modified=!0,qi.length++,Mi.fresh=!Ii):Mi.fresh=Mi.up_stamp<this.stamp-1||Mi.endGenerated==this.stamp&&r,Mi.up_stamp=Mi.stamp,Mi.fresh||0==(4&Mi.immState)){for(var Hi=!(Mi.immState=1),qi=Mi.ws1.id>Mi.ws2.id?Mi.ws2:Mi.ws1,Ii=Mi.ws1.id>Mi.ws2.id?Mi.ws1:Mi.ws2,Yi=this.mrca1;null!=Yi.head;){var Ki=Yi.head;Yi.head=Ki.next,Ki.elt=null,Ki.next=nr.zpp_pool,nr.zpp_pool=Ki,null==Yi.head&&(Yi.pushmod=!0),Yi.modified=!0,Yi.length--}Yi.pushmod=!0;for(var Zi,Ji,Qi,$i,tn,en,nn=this.mrca2;null!=nn.head;){var rn=nn.head;nn.head=rn.next,rn.elt=null,rn.next=nr.zpp_pool,nr.zpp_pool=rn,null==nn.head&&(nn.pushmod=!0),nn.modified=!0,nn.length--}nn.pushmod=!0,null!=qi.cbSet&&(Ji=this.mrca1,null==nr.zpp_pool?Zi=new nr:(Zi=nr.zpp_pool,nr.zpp_pool=Zi.next,Zi.next=null),Zi.elt=qi,(Zi=Zi).next=Ji.head,Ji.head=Zi,Ji.modified=!0,Ji.length++),null!=qi.body.cbSet&&(Zi=this.mrca1,Ji=qi.body,null==nr.zpp_pool?Qi=new nr:(Qi=nr.zpp_pool,nr.zpp_pool=Qi.next,Qi.next=null),Qi.elt=Ji,(Qi=Qi).next=Zi.head,Zi.head=Qi,Zi.modified=!0,Zi.length++),null!=Ii.cbSet&&(tn=this.mrca2,null==nr.zpp_pool?$i=new nr:($i=nr.zpp_pool,nr.zpp_pool=$i.next,$i.next=null),$i.elt=Ii,($i=$i).next=tn.head,tn.head=$i,tn.modified=!0,tn.length++),null!=Ii.body.cbSet&&($i=this.mrca2,tn=Ii.body,null==nr.zpp_pool?en=new nr:(en=nr.zpp_pool,nr.zpp_pool=en.next,en.next=null),en.elt=tn,(en=en).next=$i.head,$i.head=en,$i.modified=!0,$i.length++);for(var sn,on,an,ln,pn=qi.body.compound,hn=Ii.body.compound;pn!=hn;)(null==pn?0:pn.depth)<(null==hn?0:hn.depth)?(null!=hn.cbSet&&(ln=this.mrca2,null==nr.zpp_pool?sn=new nr:(sn=nr.zpp_pool,nr.zpp_pool=sn.next,sn.next=null),sn.elt=hn,(on=sn).next=ln.head,ln.head=on,ln.modified=!0,ln.length++),hn=hn.compound):(null!=pn.cbSet&&(on=this.mrca1,null==nr.zpp_pool?an=new nr:(an=nr.zpp_pool,nr.zpp_pool=an.next,an.next=null),an.elt=pn,(ln=an).next=on.head,on.head=ln,on.modified=!0,on.length++),pn=pn.compound);for(var un,cn=this.mrca1.head;null!=cn;){for(var dn=cn.elt,_n=this.mrca2.head;null!=_n;){for(var yn,fn=_n.elt,mn=dn.cbSet,xn=fn.cbSet,vn=null,gn=(mn.cbpairs.length<xn.cbpairs.length?mn:xn).cbpairs.head;null!=gn;){var bn=gn.elt;if(bn.a==mn&&bn.b==xn||bn.a==xn&&bn.b==mn){vn=bn;break}gn=gn.next}if(null==vn&&(null==qn.zpp_pool?yn=new qn:(yn=qn.zpp_pool,qn.zpp_pool=yn.next,yn.next=null),yn.zip_listeners=!0,Hn.setlt(mn,xn)?(yn.a=mn,yn.b=xn):(yn.a=xn,yn.b=mn),vn=yn,mn.cbpairs.add(vn),xn!=mn&&xn.cbpairs.add(vn)),vn.zip_listeners&&(vn.zip_listeners=!1,vn.__validate()),null!=vn.listeners.head){for(var zn=null,wn=null,Cn=this.prelisteners;null!=Cn.head;){var Pn=Cn.head;Cn.head=Pn.next,Pn.elt=null,Pn.next=ir.zpp_pool,ir.zpp_pool=Pn,null==Cn.head&&(Cn.pushmod=!0),Cn.modified=!0,Cn.length--}Cn.pushmod=!0;for(var Tn,Sn=null,Mn=null,An=(mn.cbpairs.length<xn.cbpairs.length?mn:xn).cbpairs.head;null!=An;){var On=An.elt;if(On.a==mn&&On.b==xn||On.a==xn&&On.b==mn){Mn=On;break}An=An.next}null==Mn&&(null==qn.zpp_pool?Tn=new qn:(Tn=qn.zpp_pool,qn.zpp_pool=Tn.next,Tn.next=null),Tn.zip_listeners=!0,Hn.setlt(mn,xn)?(Tn.a=mn,Tn.b=xn):(Tn.a=xn,Tn.b=mn),Mn=Tn,mn.cbpairs.add(Mn),xn!=mn&&xn.cbpairs.add(Mn)),Mn.zip_listeners&&(Mn.zip_listeners=!1,Mn.__validate());for(var kn=Mn.listeners.head;null!=kn;){var En,In,Dn,Bn=kn.elt;5==Bn.event&&0!=(2&Bn.itype)&&(En=this.prelisteners,null==ir.zpp_pool?In=new ir:(In=ir.zpp_pool,ir.zpp_pool=In.next,In.next=null),In.elt=Bn,Dn=In,null==Sn?(Dn.next=En.head,En.head=Dn):(Dn.next=Sn.next,Sn.next=Dn),En.pushmod=En.modified=!0,En.length++,Sn=Dn,Hi=!!Hi||!Bn.pure),kn=kn.next}if(null!=this.prelisteners.head){if(null==(zn=$n.get(dn,fn))&&(wn=tr.get(dn,fn),this.add_callbackset(wn)),null==zn||(zn.SENSORstamp!=this.stamp||r)&&0==(4&zn.SENSORstate)){if(null!=wn&&(zn=wn),null!=zn)for(var Ln=this.prelisteners.head;null!=Ln;)7==Ln.elt.itype?(zn.COLLISIONstamp=this.stamp,zn.SENSORstamp=this.stamp,zn.FLUIDstamp=this.stamp):zn.SENSORstamp=this.stamp,Ln=Ln.next;wn=Mi.active;Mi.active=!0,this.precb.zpp_inner.pre_arbiter=Mi,this.precb.zpp_inner.set=zn;for(var Rn=this.prelisteners.head;null!=Rn;){var Fn=Rn.elt;this.precb.zpp_inner.listener=Fn;var jn=this.precb.zpp_inner,Nn=zn.int1,Gn=zn.int2,Un=Fn.options1,Xn=Nn.cbTypes;!(!Un.nonemptyintersection(Xn,Un.includes)||Un.nonemptyintersection(Xn,Un.excludes))&&(Xn=Fn.options2,Un=Gn.cbTypes,!!Xn.nonemptyintersection(Un,Xn.includes)&&!Xn.nonemptyintersection(Un,Xn.excludes))?(jn.int1=Nn,jn.int2=Gn):(jn.int1=Gn,jn.int2=Nn),this.precb.zpp_inner.pre_swapped=dn!=this.precb.zpp_inner.int1;Fn=Fn.handlerp(this.precb);null!=Fn&&(null==Yn.PreFlag_ACCEPT&&(Yn.internal=!0,Yn.PreFlag_ACCEPT=new Wn,Yn.internal=!1),Fn=Fn==Yn.PreFlag_ACCEPT?5:(null==Yn.PreFlag_ACCEPT_ONCE&&(Yn.internal=!0,Yn.PreFlag_ACCEPT_ONCE=new Wn,Yn.internal=!1),Fn==Yn.PreFlag_ACCEPT_ONCE?1:(null==Yn.PreFlag_IGNORE&&(Yn.internal=!0,Yn.PreFlag_IGNORE=new Wn,Yn.internal=!1),Fn==Yn.PreFlag_IGNORE?6:2)),Mi.immState=Fn),Rn=Rn.next}if(Mi.active=wn,null!=zn)for(var Vn=this.prelisteners.head;null!=Vn;)7==Vn.elt.itype?(zn.COLLISIONstate=Mi.immState,zn.SENSORstate=Mi.immState,zn.FLUIDstate=Mi.immState):zn.SENSORstate=Mi.immState,Vn=Vn.next}else null==zn?0==(4&Mi.immState)&&(Mi.immState=1):Mi.immState=zn.SENSORstate;_n=_n.next}else _n=_n.next}else _n=_n.next}cn=cn.next}Hi&&0==(4&Mi.immState)&&(1!=Mi.b1.type&&((Ii=Mi.b1).world||(Ii.component.waket=this.stamp+(this.midstep?0:1),3==Ii.type&&(Ii.kinematicDelaySleep=!0),Ii.component.sleeping&&this.really_wake(Ii,!1))),1!=Mi.b2.type&&((un=Mi.b2).world||(un.component.waket=this.stamp+(this.midstep?0:1),3==un.type&&(un.kinematicDelaySleep=!0),un.component.sleeping&&this.really_wake(un,!1))))}Mi.sleeping&&(Mi.sleeping=!1,un=this.s_arbiters,null==sr.zpp_pool?Ei=new sr:(Ei=sr.zpp_pool,sr.zpp_pool=Ei.next,Ei.next=null),Ei.elt=Mi,(Ei=Ei).next=un.head,un.head=Ei,un.modified=!0,un.length++),l=Mi}else l=ee?((ee=Mi).next=Kn.zpp_pool,Kn.zpp_pool=ee,null):Mi;else l=Mi}}return l},ii.prototype.mrca1=null,ii.prototype.mrca2=null,ii.prototype.MRCA_chains=function(t,e){for(var i=this.mrca1;null!=i.head;){var n=i.head;i.head=n.next,n.elt=null,n.next=nr.zpp_pool,nr.zpp_pool=n,null==i.head&&(i.pushmod=!0),i.modified=!0,i.length--}i.pushmod=!0;for(var r,s,o,a,l,p,h=this.mrca2;null!=h.head;){var u=h.head;h.head=u.next,u.elt=null,u.next=nr.zpp_pool,nr.zpp_pool=u,null==h.head&&(h.pushmod=!0),h.modified=!0,h.length--}h.pushmod=!0,null!=t.cbSet&&(s=this.mrca1,null==nr.zpp_pool?r=new nr:(r=nr.zpp_pool,nr.zpp_pool=r.next,r.next=null),r.elt=t,(r=r).next=s.head,s.head=r,s.modified=!0,s.length++),null!=t.body.cbSet&&(r=this.mrca1,s=t.body,null==nr.zpp_pool?o=new nr:(o=nr.zpp_pool,nr.zpp_pool=o.next,o.next=null),o.elt=s,(o=o).next=r.head,r.head=o,r.modified=!0,r.length++),null!=e.cbSet&&(l=this.mrca2,null==nr.zpp_pool?a=new nr:(a=nr.zpp_pool,nr.zpp_pool=a.next,a.next=null),a.elt=e,(a=a).next=l.head,l.head=a,l.modified=!0,l.length++),null!=e.body.cbSet&&(a=this.mrca2,l=e.body,null==nr.zpp_pool?p=new nr:(p=nr.zpp_pool,nr.zpp_pool=p.next,p.next=null),p.elt=l,(p=p).next=a.head,a.head=p,a.modified=!0,a.length++);for(var c,d,_,y,f=t.body.compound,m=e.body.compound;f!=m;)(null==f?0:f.depth)<(null==m?0:m.depth)?(null!=m.cbSet&&(y=this.mrca2,null==nr.zpp_pool?c=new nr:(c=nr.zpp_pool,nr.zpp_pool=c.next,c.next=null),c.elt=m,(d=c).next=y.head,y.head=d,y.modified=!0,y.length++),m=m.compound):(null!=f.cbSet&&(d=this.mrca1,null==nr.zpp_pool?_=new nr:(_=nr.zpp_pool,nr.zpp_pool=_.next,_.next=null),_.elt=f,(y=_).next=d.head,d.head=y,d.modified=!0,d.length++),f=f.compound)},ii.prototype.inlined_MRCA_chains=function(t,e){for(var i=this.mrca1;null!=i.head;){var n=i.head;i.head=n.next,n.elt=null,n.next=nr.zpp_pool,nr.zpp_pool=n,null==i.head&&(i.pushmod=!0),i.modified=!0,i.length--}i.pushmod=!0;for(var r,s,o,a,l,p,h=this.mrca2;null!=h.head;){var u=h.head;h.head=u.next,u.elt=null,u.next=nr.zpp_pool,nr.zpp_pool=u,null==h.head&&(h.pushmod=!0),h.modified=!0,h.length--}h.pushmod=!0,null!=t.cbSet&&(s=this.mrca1,null==nr.zpp_pool?r=new nr:(r=nr.zpp_pool,nr.zpp_pool=r.next,r.next=null),r.elt=t,(r=r).next=s.head,s.head=r,s.modified=!0,s.length++),null!=t.body.cbSet&&(r=this.mrca1,s=t.body,null==nr.zpp_pool?o=new nr:(o=nr.zpp_pool,nr.zpp_pool=o.next,o.next=null),o.elt=s,(o=o).next=r.head,r.head=o,r.modified=!0,r.length++),null!=e.cbSet&&(l=this.mrca2,null==nr.zpp_pool?a=new nr:(a=nr.zpp_pool,nr.zpp_pool=a.next,a.next=null),a.elt=e,(a=a).next=l.head,l.head=a,l.modified=!0,l.length++),null!=e.body.cbSet&&(a=this.mrca2,l=e.body,null==nr.zpp_pool?p=new nr:(p=nr.zpp_pool,nr.zpp_pool=p.next,p.next=null),p.elt=l,(p=p).next=a.head,a.head=p,a.modified=!0,a.length++);for(var c,d,_,y,f=t.body.compound,m=e.body.compound;f!=m;)(null==f?0:f.depth)<(null==m?0:m.depth)?(null!=m.cbSet&&(y=this.mrca2,null==nr.zpp_pool?c=new nr:(c=nr.zpp_pool,nr.zpp_pool=c.next,c.next=null),c.elt=m,(d=c).next=y.head,y.head=d,y.modified=!0,y.length++),m=m.compound):(null!=f.cbSet&&(d=this.mrca1,null==nr.zpp_pool?_=new nr:(_=nr.zpp_pool,nr.zpp_pool=_.next,_.next=null),_.elt=f,(y=_).next=d.head,d.head=y,d.modified=!0,d.length++),f=f.compound)},ii.prototype.__class__=ii;var ni=zpp_nape.space.ZPP_SweepData=function(){this.aabb=null,this.shape=null,this.prev=null,this.next=null};ni.__name__=["zpp_nape","space","ZPP_SweepData"],ni.prototype.next=null,ni.prototype.prev=null,ni.prototype.shape=null,ni.prototype.aabb=null,ni.prototype.free=function(){this.prev=null,this.shape=null,this.aabb=null},ni.prototype.alloc=function(){},ni.prototype.gt=function(t){return this.aabb.minx>t.aabb.minx},ni.prototype.__class__=ni;var ri=zpp_nape.space.ZPP_SweepPhase=function(t){this.failed=null,this.list=null,qe.call(this),this.space=t,this.is_sweep=!0,this.sweep=this};ri.__name__=["zpp_nape","space","ZPP_SweepPhase"],ri.__super__=qe,ri.prototype=Object.create(qe.prototype),ri.prototype.list=null,ri.prototype.__insert=function(t){var e;null==ni.zpp_pool?e=new ni:(e=ni.zpp_pool,ni.zpp_pool=e.next,e.next=null),(t.sweep=e).shape=t,e.aabb=t.aabb,e.next=this.list,null!=this.list&&(this.list.prev=e),this.list=e},ri.prototype.__remove=function(t){var e=t.sweep;null==e.prev?this.list=e.next:e.prev.next=e.next,null!=e.next&&(e.next.prev=e.prev),t.sweep=null,e.prev=null,e.shape=null,e.aabb=null,e.next=ni.zpp_pool,ni.zpp_pool=e},ri.prototype.__sync=function(t){if(!this.space.continuous&&t.zip_aabb&&null!=t.body)if(t.zip_aabb=!1,0==t.type){var e=t.circle;if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,1==e.type){var i=e.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y,i.localCOMx+=i.lverts.next.next.x,i.localCOMy+=i.lverts.next.next.y,i.localCOMx*=.5,i.localCOMy*=.5;else{i.localCOMx=0;var n=i.localCOMy=0,r=i.lverts.next,s=r,o=r=r.next;for(r=r.next;null!=r;){var a=r;n+=o.x*(a.y-s.y);var l=a.y*o.x-a.x*o.y;i.localCOMx+=(o.x+a.x)*l,i.localCOMy+=(o.y+a.y)*l,s=o,o=a,r=r.next}var p=r=i.lverts.next;n+=o.x*(p.y-s.y);var h=p.y*o.x-p.x*o.y;i.localCOMx+=(o.x+p.x)*h,i.localCOMy+=(o.y+p.y)*h,s=o;var u=r=r.next;n+=p.x*(u.y-s.y);h=u.y*p.x-u.x*p.y;i.localCOMx+=(p.x+u.x)*h,i.localCOMy+=(p.y+u.y)*h;u=n=1/(3*n);i.localCOMx*=u,i.localCOMy*=u}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}h=e.body;h.zip_axis&&(h.zip_axis=!1,h.axisx=Math.sin(h.rot),h.axisy=Math.cos(h.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}u=e.radius,h=e.radius;e.aabb.minx=e.worldCOMx-u,e.aabb.miny=e.worldCOMy-h,e.aabb.maxx=e.worldCOMx+u,e.aabb.maxy=e.worldCOMy+h}else{var c=t.polygon;if(c.zip_gverts&&null!=c.body){c.zip_gverts=!1,c.validate_lverts();var d=c.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot));for(var _=c.lverts.next,y=c.gverts.next;null!=y;){var f=y,m=_,_=_.next;f.x=c.body.posx+(c.body.axisy*m.x-c.body.axisx*m.y),f.y=c.body.posy+(m.x*c.body.axisx+m.y*c.body.axisy),y=y.next}}d=c.gverts.next;c.aabb.minx=d.x,c.aabb.miny=d.y,c.aabb.maxx=d.x,c.aabb.maxy=d.y;for(var x=c.gverts.next.next;null!=x;){var v=x;v.x<c.aabb.minx&&(c.aabb.minx=v.x),v.x>c.aabb.maxx&&(c.aabb.maxx=v.x),v.y<c.aabb.miny&&(c.aabb.miny=v.y),v.y>c.aabb.maxy&&(c.aabb.maxy=v.y),x=x.next}}},ri.prototype.sync_broadphase=function(){if(this.space.validation(),null!=this.list)for(var t=this.list.next;null!=t;){var e=t.next,i=t.prev;if(t.aabb.minx>i.aabb.minx)t=e;else{for(;null!=i.prev&&i.prev.aabb.minx>t.aabb.minx;)i=i.prev;var n=t.prev;n.next=t.next,null!=t.next&&(t.next.prev=n),null==i.prev?(t.prev=null,((this.list=t).next=i).prev=t):(t.prev=i.prev,((i.prev=t).prev.next=t).next=i),t=e}}},ri.prototype.sync_broadphase_fast=function(){for(var t=this.list.next;null!=t;){var e=t.next,i=t.prev;if(t.aabb.minx>i.aabb.minx)t=e;else{for(;null!=i.prev&&i.prev.aabb.minx>t.aabb.minx;)i=i.prev;var n=t.prev;n.next=t.next,null!=t.next&&(t.next.prev=n),null==i.prev?(t.prev=null,((this.list=t).next=i).prev=t):(t.prev=i.prev,((i.prev=t).prev.next=t).next=i),t=e}}},ri.prototype.broadphase=function(t,e){if(null!=this.list){for(var i=this.list.next;null!=i;){var n=i.next,r=i.prev;if(i.aabb.minx>r.aabb.minx)i=n;else{for(;null!=r.prev&&r.prev.aabb.minx>i.aabb.minx;)r=r.prev;var s=i.prev;s.next=i.next,null!=i.next&&(i.next.prev=s),null==r.prev?(i.prev=null,((this.list=i).next=r).prev=i):(i.prev=r.prev,((r.prev=i).prev.next=i).next=r),i=n}}for(var o=this.list;null!=o;){for(var a=o.next,l=o.shape,p=l.body,h=o.aabb.maxx;null!=a&&!(a.aabb.minx>h);){var u,c,d=a.shape,_=d.body;a=(_!=p&&(1==p.type&&1==_.type||p.component.sleeping&&_.component.sleeping||(u=l.aabb,(c=d.aabb).miny>u.maxy||u.miny>c.maxy||(e?t.narrowPhase(l,d,2!=p.type||2!=_.type,null,!1):t.continuousEvent(l,d,2!=p.type||2!=_.type,null,!1)))),a.next)}o=o.next}}},ri.prototype.clear=function(){for(;null!=this.list;)this.list.shape.removedFromSpace(),this.__remove(this.list.shape)},ri.prototype.shapesUnderPoint=function(t,e,i,n){var r;this.sync_broadphase(),null==Ir.zpp_pool?r=new Ir:(r=Ir.zpp_pool,Ir.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=t,r.y=e;for(var s,o,a=r,l=null==n?new yt:n,p=this.list;null!=p&&p.aabb.minx>t;)p=p.next;for(;null!=p&&p.aabb.minx<=t;)p.aabb.maxx>=t&&p.aabb.miny<=e&&p.aabb.maxy>=e&&(s=p.shape,(null==i||0!=((o=s.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&o.collisionGroup))&&(0==s.type?Er.circleContains(s.circle,a)&&l.push(s.outer):Er.polyContains(s.polygon,a)&&l.push(s.outer))),p=p.next;return null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ir.zpp_pool,Ir.zpp_pool=a,l},ri.prototype.bodiesUnderPoint=function(t,e,i,n){var r;this.sync_broadphase(),null==Ir.zpp_pool?r=new Ir:(r=Ir.zpp_pool,Ir.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=t,r.y=e;for(var s,o,a,l=r,p=null==n?new tt:n,h=this.list;null!=h&&h.aabb.minx>t;)h=h.next;for(;null!=h&&h.aabb.minx<=t;)h.aabb.maxx>=t&&h.aabb.miny<=e&&h.aabb.maxy>=e&&(o=(s=h.shape).body.outer,p.has(o)||(null==i||0!=((a=s.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&a.collisionGroup))&&(0==s.type?Er.circleContains(s.circle,l)&&p.push(o):Er.polyContains(s.polygon,l)&&p.push(o))),h=h.next;return null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ir.zpp_pool,Ir.zpp_pool=l,p},ri.prototype.shapesInAABB=function(t,e,i,n,r){this.sync_broadphase(),this.updateAABBShape(t);for(var s=this.aabbShape.zpp_inner.aabb,o=null==r?new yt:r,a=this.list;null!=a&&a.aabb.maxx<s.minx;)a=a.next;for(;null!=a&&a.aabb.minx<=s.maxx;){var l,p,h=a.shape;(null==n||0!=((l=h.filter).collisionMask&n.collisionGroup)&&0!=(n.collisionMask&l.collisionGroup))&&(e?i?Er.containTest(this.aabbShape.zpp_inner,h)&&o.push(h.outer):(l=a.aabb).minx>=s.minx&&l.miny>=s.miny&&l.maxx<=s.maxx&&l.maxy<=s.maxy?o.push(h.outer):(l=a.aabb,s.miny<=l.maxy&&l.miny<=s.maxy&&s.minx<=l.maxx&&l.minx<=s.maxx&&Er.testCollide_safe(h,this.aabbShape.zpp_inner)&&o.push(h.outer)):(i?(p=a.aabb).minx>=s.minx&&p.miny>=s.miny&&p.maxx<=s.maxx&&p.maxy<=s.maxy:(p=a.aabb,s.miny<=p.maxy&&p.miny<=s.maxy&&s.minx<=p.maxx&&p.minx<=s.maxx))&&o.push(h.outer)),a=a.next}return o},ri.prototype.failed=null,ri.prototype.bodiesInAABB=function(t,e,i,n,r){this.sync_broadphase(),this.updateAABBShape(t);var s=this.aabbShape.zpp_inner.aabb,o=null==r?new tt:r;null==this.failed&&(this.failed=new tt);for(var a=this.list;null!=a&&a.aabb.maxx<s.minx;)a=a.next;for(;null!=a&&a.aabb.minx<=s.maxx;){var l,p=a.shape,h=p.body.outer,u=a.aabb;s.miny<=u.maxy&&u.miny<=s.maxy&&s.minx<=u.maxx&&u.minx<=s.maxx&&(null==n||0!=((u=p.filter).collisionMask&n.collisionGroup)&&0!=(n.collisionMask&u.collisionGroup))&&(e?i?this.failed.has(h)||(l=Er.containTest(this.aabbShape.zpp_inner,p),!o.has(h)&&l?o.push(h):l||(o.remove(h),this.failed.push(h))):!o.has(h)&&Er.testCollide_safe(p,this.aabbShape.zpp_inner)&&o.push(h):i?this.failed.has(h)||(l=(l=p.aabb).minx>=s.minx&&l.miny>=s.miny&&l.maxx<=s.maxx&&l.maxy<=s.maxy,!o.has(h)&&l?o.push(h):l||(o.remove(h),this.failed.push(h))):!o.has(h)&&((p=p.aabb).minx>=s.minx&&p.miny>=s.miny&&p.maxx<=s.maxx&&p.maxy<=s.maxy)&&o.push(h)),a=a.next}return this.failed.clear(),o},ri.prototype.shapesInCircle=function(t,e,i,n,r,s){this.sync_broadphase(),this.updateCircShape(t,e,i);for(var o=this.circShape.zpp_inner.aabb,a=null==s?new yt:s,l=this.list;null!=l&&l.aabb.maxx<o.minx;)l=l.next;for(;null!=l&&l.aabb.minx<=o.maxx;){var p,h=l.aabb;o.miny<=h.maxy&&h.miny<=o.maxy&&o.minx<=h.maxx&&h.minx<=o.maxx&&(p=l.shape,(null==r||0!=((h=p.filter).collisionMask&r.collisionGroup)&&0!=(r.collisionMask&h.collisionGroup))&&(n?Er.containTest(this.circShape.zpp_inner,p)&&a.push(p.outer):Er.testCollide_safe(p,this.circShape.zpp_inner)&&a.push(p.outer))),l=l.next}return a},ri.prototype.bodiesInCircle=function(t,e,i,n,r,s){this.sync_broadphase(),this.updateCircShape(t,e,i);var o=this.circShape.zpp_inner.aabb,a=null==s?new tt:s;null==this.failed&&(this.failed=new tt);for(var l=this.list;null!=l&&l.aabb.maxx<o.minx;)l=l.next;for(;null!=l&&l.aabb.minx<=o.maxx;){var p,h,u=l.aabb;o.miny<=u.maxy&&u.miny<=o.maxy&&o.minx<=u.maxx&&u.minx<=o.maxx&&(u=(p=l.shape).body.outer,(null==r||0!=((h=p.filter).collisionMask&r.collisionGroup)&&0!=(r.collisionMask&h.collisionGroup))&&(n?this.failed.has(u)||(h=Er.containTest(this.circShape.zpp_inner,p),!a.has(u)&&h?a.push(u):h||(a.remove(u),this.failed.push(u))):!a.has(u)&&Er.testCollide_safe(p,this.circShape.zpp_inner)&&a.push(u))),l=l.next}return this.failed.clear(),a},ri.prototype.shapesInShape=function(t,e,i,n){this.sync_broadphase(),this.validateShape(t);for(var r=t.aabb,s=null==n?new yt:n,o=this.list;null!=o&&o.aabb.maxx<r.minx;)o=o.next;for(;null!=o&&o.aabb.minx<=r.maxx;){var a,l=o.aabb;r.miny<=l.maxy&&l.miny<=r.maxy&&r.minx<=l.maxx&&l.minx<=r.maxx&&(a=o.shape,(null==i||0!=((l=a.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&l.collisionGroup))&&(e?Er.containTest(t,a)&&s.push(a.outer):Er.testCollide_safe(a,t)&&s.push(a.outer))),o=o.next}return s},ri.prototype.bodiesInShape=function(t,e,i,n){this.sync_broadphase(),this.validateShape(t);var r=t.aabb,s=null==n?new tt:n;null==this.failed&&(this.failed=new tt);for(var o=this.list;null!=o&&o.aabb.maxx<r.minx;)o=o.next;for(;null!=o&&o.aabb.minx<=r.maxx;){var a,l,p=o.aabb;r.miny<=p.maxy&&p.miny<=r.maxy&&r.minx<=p.maxx&&p.minx<=r.maxx&&(p=(a=o.shape).body.outer,(null==i||0!=((l=a.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&l.collisionGroup))&&(e?this.failed.has(p)||(l=Er.containTest(t,a),!s.has(p)&&l?s.push(p):l||(s.remove(p),this.failed.push(p))):!s.has(p)&&Er.testCollide_safe(t,a)&&s.push(p))),o=o.next}return this.failed.clear(),s},ri.prototype.rayCast=function(t,e,i){this.sync_broadphase(),t.validate_dir();var n=t.rayAABB(),r=t.maxdist,s=null;if(0==t.dirx)for(var o=this.list;null!=o&&o.aabb.minx<=n.minx;){var a,l=o.aabb;!(n.miny<=l.maxy&&l.miny<=n.maxy&&n.minx<=l.maxx&&l.minx<=n.maxx&&(null==i||0!=((a=o.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&a.collisionGroup)))||0<=(a=t.aabbsect(o.aabb))&&a<r&&(null!=(a=0==o.shape.type?t.circlesect(o.shape.circle,e,r):t.polysect(o.shape.polygon,e,r))&&(r=a.zpp_inner.toiDistance,null!=s&&s.zpp_inner.free(),s=a)),o=o.next}else if(t.dirx<0){for(var p=this.list,h=null;null!=p&&p.aabb.minx<=n.maxx;)p=(h=p).next;for(p=h;null!=p;){var u,c=p.aabb;!(n.miny<=c.maxy&&c.miny<=n.maxy&&n.minx<=c.maxx&&c.minx<=n.maxx&&(null==i||0!=((u=p.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&u.collisionGroup)))||0<=(u=t.aabbsect(p.aabb))&&u<r&&(null!=(u=0==p.shape.type?t.circlesect(p.shape.circle,e,r):t.polysect(p.shape.polygon,e,r))&&(r=u.zpp_inner.toiDistance,null!=s&&s.zpp_inner.free(),s=u)),p=p.prev}}else for(var d=this.list;null!=d&&d.aabb.minx<=n.maxx&&d.aabb.minx<t.originx+t.dirx*r;){var _,y=d.aabb;!(n.miny<=y.maxy&&y.miny<=n.maxy&&n.minx<=y.maxx&&y.minx<=n.maxx&&(null==i||0!=((_=d.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&_.collisionGroup)))||0<=(_=t.aabbsect(d.aabb))&&_<r&&(null!=(_=0==d.shape.type?t.circlesect(d.shape.circle,e,r):t.polysect(d.shape.polygon,e,r))&&(r=_.zpp_inner.toiDistance,null!=s&&s.zpp_inner.free(),s=_)),d=d.next}return null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n.wrap_min=n.wrap_max=null,n._invalidate=null,n._validate=null,n.next=Be.zpp_pool,Be.zpp_pool=n,s},ri.prototype.rayMultiCast=function(t,e,i,n){this.sync_broadphase(),t.validate_dir();var r=t.rayAABB(),s=null==n?new q:n;if(0==t.dirx)for(var o=this.list;null!=o&&o.aabb.minx<=r.minx;){var a=o.aabb;r.miny<=a.maxy&&a.miny<=r.maxy&&r.minx<=a.maxx&&a.minx<=r.maxx&&(null==i||0!=((a=o.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&a.collisionGroup))&&0<=t.aabbsect(o.aabb)&&(0==o.shape.type?t.circlesect2(o.shape.circle,e,s):t.polysect2(o.shape.polygon,e,s)),o=o.next}else if(t.dirx<0){for(var l=this.list,p=null;null!=l&&l.aabb.minx<=r.maxx;)l=(p=l).next;for(l=p;null!=l;){var h=l.aabb;r.miny<=h.maxy&&h.miny<=r.maxy&&r.minx<=h.maxx&&h.minx<=r.maxx&&(null==i||0!=((h=l.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&h.collisionGroup))&&0<=t.aabbsect(l.aabb)&&(0==l.shape.type?t.circlesect2(l.shape.circle,e,s):t.polysect2(l.shape.polygon,e,s)),l=l.prev}}else for(var u=this.list;null!=u&&u.aabb.minx<=r.maxx;){var c=u.aabb;r.miny<=c.maxy&&c.miny<=r.maxy&&r.minx<=c.maxx&&c.minx<=r.maxx&&(null==i||0!=((c=u.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&c.collisionGroup))&&0<=t.aabbsect(u.aabb)&&(0==u.shape.type?t.circlesect2(u.shape.circle,e,s):t.polysect2(u.shape.polygon,e,s)),u=u.next}return null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r.wrap_min=r.wrap_max=null,r._invalidate=null,r._validate=null,r.next=Be.zpp_pool,Be.zpp_pool=r,s},ri.prototype.__class__=ri;var si=zpp_nape.util.ZNPArray2_Float=function(t,e){this.width=0,this.list=null,this.width=t,this.list=[]};si.__name__=["zpp_nape","util","ZNPArray2_Float"],si.prototype.list=null,si.prototype.width=null,si.prototype.resize=function(t,e,i){for(var n=0,r=(this.width=t)*e;n<r;)this.list[n++]=i},si.prototype.get=function(t,e){return this.list[e*this.width+t]},si.prototype.set=function(t,e,i){return this.list[e*this.width+t]=i},si.prototype.__class__=si;var oi=zpp_nape.util.ZNPArray2_ZPP_GeomVert=function(t,e){this.width=0,this.list=null,this.width=t,this.list=[]};oi.__name__=["zpp_nape","util","ZNPArray2_ZPP_GeomVert"],oi.prototype.list=null,oi.prototype.width=null,oi.prototype.resize=function(t,e,i){for(var n=0,r=(this.width=t)*e;n<r;)this.list[n++]=i},oi.prototype.get=function(t,e){return this.list[e*this.width+t]},oi.prototype.set=function(t,e,i){return this.list[e*this.width+t]=i},oi.prototype.__class__=oi;var ai=zpp_nape.util.ZNPArray2_ZPP_MarchPair=function(t,e){this.width=0,this.list=null,this.width=t,this.list=[]};ai.__name__=["zpp_nape","util","ZNPArray2_ZPP_MarchPair"],ai.prototype.list=null,ai.prototype.width=null,ai.prototype.resize=function(t,e,i){for(var n=0,r=(this.width=t)*e;n<r;)this.list[n++]=i},ai.prototype.get=function(t,e){return this.list[e*this.width+t]},ai.prototype.set=function(t,e,i){return this.list[e*this.width+t]=i},ai.prototype.__class__=ai;var li=zpp_nape.util.Hashable2_Boolfalse=function(){this.di=0,this.id=0,this.hnext=null,this.next=null,this.value=!1};li.__name__=["zpp_nape","util","Hashable2_Boolfalse"],li.get=function(t,e,i){null==li.zpp_pool?n=new li:(n=li.zpp_pool,li.zpp_pool=n.next,n.next=null),n.id=t,n.di=e;var n=n;return n.value=i,n},li.getpersist=function(t,e){var i;return null==li.zpp_pool?i=new li:(i=li.zpp_pool,li.zpp_pool=i.next,i.next=null),i.id=t,i.di=e,i},li.ordered_get=function(t,e,i){if(t<=e){null==li.zpp_pool?n=new li:(n=li.zpp_pool,li.zpp_pool=n.next,n.next=null),n.id=t,n.di=e;var n=n;return n.value=i,n}null==li.zpp_pool?r=new li:(r=li.zpp_pool,li.zpp_pool=r.next,r.next=null),r.id=e,r.di=t;var r=r;return r.value=i,r},li.ordered_get_persist=function(t,e){var i,n;return t<=e?(null==li.zpp_pool?i=new li:(i=li.zpp_pool,li.zpp_pool=i.next,i.next=null),i.id=t,i.di=e,i):(null==li.zpp_pool?n=new li:(n=li.zpp_pool,li.zpp_pool=n.next,n.next=null),n.id=e,n.di=t,n)},li.prototype.value=null,li.prototype.next=null,li.prototype.hnext=null,li.prototype.id=null,li.prototype.di=null,li.prototype.free=function(){},li.prototype.alloc=function(){},li.prototype.__class__=li;var pi=zpp_nape.util.FastHash2_Hashable2_Boolfalse=function(){this.cnt=0,this.table=null,this.cnt=0,this.table=[];for(var t=0;t<1048576;)++t,this.table.push(null)};pi.__name__=["zpp_nape","util","FastHash2_Hashable2_Boolfalse"],pi.prototype.table=null,pi.prototype.cnt=null,pi.prototype.empty=function(){return 0==this.cnt},pi.prototype.clear=function(){for(var t=0,e=this.table.length;t<e;){var i=t++,n=this.table[i];if(null!=n){for(;null!=n;){var r=n.hnext;n.hnext=null,n=r}this.table[i]=null}}},pi.prototype.get=function(t,e){var i=this.table[106039*t+e&1048575];if(null==i)return null;if(i.id==t&&i.di==e)return i;for(;null!=(i=i.hnext)&&(i.id!=t||i.di!=e););return i},pi.prototype.ordered_get=function(t,e){var i;e<t&&(i=t,t=e,e=i);var n=this.table[106039*t+e&1048575];if(null==n)return null;if(n.id==t&&n.di==e)return n;for(;null!=(n=n.hnext)&&(n.id!=t||n.di!=e););return n},pi.prototype.has=function(t,e){var i=this.table[106039*t+e&1048575];if(null==i)return!1;if(i.id==t&&i.di==e)return!0;for(;null!=(i=i.hnext)&&(i.id!=t||i.di!=e););return null!=i},pi.prototype.maybeAdd=function(t){var e=106039*t.id+t.di&1048575,i=this.table[e];null==i?(this.table[e]=t).hnext=null:(t.hnext=i.hnext,i.hnext=t),this.cnt++},pi.prototype.add=function(t){var e=106039*t.id+t.di&1048575,i=this.table[e];null==i?(this.table[e]=t).hnext=null:(t.hnext=i.hnext,i.hnext=t),this.cnt++},pi.prototype.remove=function(t){var e,i=106039*t.id+t.di&1048575,n=this.table[i];if(n==t)this.table[i]=n.hnext;else if(null!=n){for(;null!=(n=(e=n).hnext)&&n!=t;);e.hnext=n.hnext}t.hnext=null,this.cnt--},pi.prototype.hash=function(t,e){return 106039*t+e&1048575},pi.prototype.__class__=pi;var hi=zpp_nape.util.ZNPList_ZPP_CallbackSet=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};hi.__name__=["zpp_nape","util","ZNPList_ZPP_CallbackSet"],hi.prototype.head=null,hi.prototype.begin=function(){return this.head},hi.prototype.modified=null,hi.prototype.pushmod=null,hi.prototype.length=null,hi.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},hi.prototype.add=function(t){null==Xi.zpp_pool?e=new Xi:(e=Xi.zpp_pool,Xi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},hi.prototype.inlined_add=function(t){null==Xi.zpp_pool?e=new Xi:(e=Xi.zpp_pool,Xi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},hi.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},hi.prototype.insert=function(t,e){null==Xi.zpp_pool?i=new Xi:(i=Xi.zpp_pool,Xi.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},hi.prototype.inlined_insert=function(t,e){null==Xi.zpp_pool?i=new Xi:(i=Xi.zpp_pool,Xi.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},hi.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=Xi.zpp_pool,Xi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},hi.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=Xi.zpp_pool,Xi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},hi.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},hi.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},hi.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=Xi.zpp_pool,Xi.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},hi.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},hi.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=Xi.zpp_pool,Xi.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},hi.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=Xi.zpp_pool,Xi.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},hi.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=Xi.zpp_pool,Xi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},hi.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=Xi.zpp_pool,Xi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},hi.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},hi.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=Xi.zpp_pool,Xi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},hi.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=Xi.zpp_pool,Xi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},hi.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},hi.prototype.empty=function(){return null==this.head},hi.prototype.size=function(){return this.length},hi.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},hi.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},hi.prototype.front=function(){return this.head.elt},hi.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},hi.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},hi.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},hi.prototype.__class__=hi;var ui=zpp_nape.util.ZNPList_ZPP_Shape=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ui.__name__=["zpp_nape","util","ZNPList_ZPP_Shape"],ui.prototype.head=null,ui.prototype.begin=function(){return this.head},ui.prototype.modified=null,ui.prototype.pushmod=null,ui.prototype.length=null,ui.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},ui.prototype.add=function(t){null==Vi.zpp_pool?e=new Vi:(e=Vi.zpp_pool,Vi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},ui.prototype.inlined_add=function(t){null==Vi.zpp_pool?e=new Vi:(e=Vi.zpp_pool,Vi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},ui.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},ui.prototype.insert=function(t,e){null==Vi.zpp_pool?i=new Vi:(i=Vi.zpp_pool,Vi.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},ui.prototype.inlined_insert=function(t,e){null==Vi.zpp_pool?i=new Vi:(i=Vi.zpp_pool,Vi.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},ui.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=Vi.zpp_pool,Vi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ui.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=Vi.zpp_pool,Vi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ui.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},ui.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},ui.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=Vi.zpp_pool,Vi.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},ui.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},ui.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=Vi.zpp_pool,Vi.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},ui.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=Vi.zpp_pool,Vi.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},ui.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=Vi.zpp_pool,Vi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},ui.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=Vi.zpp_pool,Vi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},ui.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},ui.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=Vi.zpp_pool,Vi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ui.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=Vi.zpp_pool,Vi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ui.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},ui.prototype.empty=function(){return null==this.head},ui.prototype.size=function(){return this.length},ui.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},ui.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},ui.prototype.front=function(){return this.head.elt},ui.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},ui.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},ui.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},ui.prototype.__class__=ui;var mi=zpp_nape.util.ZNPList_ZPP_Body=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};mi.__name__=["zpp_nape","util","ZNPList_ZPP_Body"],mi.prototype.head=null,mi.prototype.begin=function(){return this.head},mi.prototype.modified=null,mi.prototype.pushmod=null,mi.prototype.length=null,mi.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},mi.prototype.add=function(t){null==Wi.zpp_pool?e=new Wi:(e=Wi.zpp_pool,Wi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},mi.prototype.inlined_add=function(t){null==Wi.zpp_pool?e=new Wi:(e=Wi.zpp_pool,Wi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},mi.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},mi.prototype.insert=function(t,e){null==Wi.zpp_pool?i=new Wi:(i=Wi.zpp_pool,Wi.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},mi.prototype.inlined_insert=function(t,e){null==Wi.zpp_pool?i=new Wi:(i=Wi.zpp_pool,Wi.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},mi.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=Wi.zpp_pool,Wi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},mi.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=Wi.zpp_pool,Wi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},mi.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},mi.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},mi.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=Wi.zpp_pool,Wi.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},mi.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},mi.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=Wi.zpp_pool,Wi.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},mi.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=Wi.zpp_pool,Wi.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},mi.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=Wi.zpp_pool,Wi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},mi.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=Wi.zpp_pool,Wi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},mi.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},mi.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=Wi.zpp_pool,Wi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},mi.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=Wi.zpp_pool,Wi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},mi.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},mi.prototype.empty=function(){return null==this.head},mi.prototype.size=function(){return this.length},mi.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},mi.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},mi.prototype.front=function(){return this.head.elt},mi.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},mi.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},mi.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},mi.prototype.__class__=mi;var xi=zpp_nape.util.ZNPList_ZPP_Compound=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};xi.__name__=["zpp_nape","util","ZNPList_ZPP_Compound"],xi.prototype.head=null,xi.prototype.begin=function(){return this.head},xi.prototype.modified=null,xi.prototype.pushmod=null,xi.prototype.length=null,xi.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},xi.prototype.add=function(t){null==qi.zpp_pool?e=new qi:(e=qi.zpp_pool,qi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},xi.prototype.inlined_add=function(t){null==qi.zpp_pool?e=new qi:(e=qi.zpp_pool,qi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},xi.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},xi.prototype.insert=function(t,e){null==qi.zpp_pool?i=new qi:(i=qi.zpp_pool,qi.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},xi.prototype.inlined_insert=function(t,e){null==qi.zpp_pool?i=new qi:(i=qi.zpp_pool,qi.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},xi.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=qi.zpp_pool,qi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},xi.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=qi.zpp_pool,qi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},xi.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},xi.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},xi.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=qi.zpp_pool,qi.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},xi.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},xi.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=qi.zpp_pool,qi.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},xi.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=qi.zpp_pool,qi.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},xi.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=qi.zpp_pool,qi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},xi.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=qi.zpp_pool,qi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},xi.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},xi.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=qi.zpp_pool,qi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},xi.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=qi.zpp_pool,qi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},xi.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},xi.prototype.empty=function(){return null==this.head},xi.prototype.size=function(){return this.length},xi.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},xi.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},xi.prototype.front=function(){return this.head.elt},xi.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},xi.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},xi.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},xi.prototype.__class__=xi;var vi=zpp_nape.util.ZNPList_ZPP_Arbiter=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};vi.__name__=["zpp_nape","util","ZNPList_ZPP_Arbiter"],vi.prototype.head=null,vi.prototype.begin=function(){return this.head},vi.prototype.modified=null,vi.prototype.pushmod=null,vi.prototype.length=null,vi.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},vi.prototype.add=function(t){null==er.zpp_pool?e=new er:(e=er.zpp_pool,er.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},vi.prototype.inlined_add=function(t){null==er.zpp_pool?e=new er:(e=er.zpp_pool,er.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},vi.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},vi.prototype.insert=function(t,e){null==er.zpp_pool?i=new er:(i=er.zpp_pool,er.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},vi.prototype.inlined_insert=function(t,e){null==er.zpp_pool?i=new er:(i=er.zpp_pool,er.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},vi.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=er.zpp_pool,er.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},vi.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=er.zpp_pool,er.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},vi.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},vi.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},vi.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=er.zpp_pool,er.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},vi.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},vi.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=er.zpp_pool,er.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},vi.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=er.zpp_pool,er.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},vi.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=er.zpp_pool,er.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},vi.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=er.zpp_pool,er.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},vi.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},vi.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=er.zpp_pool,er.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},vi.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=er.zpp_pool,er.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},vi.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},vi.prototype.empty=function(){return null==this.head},vi.prototype.size=function(){return this.length},vi.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},vi.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},vi.prototype.front=function(){return this.head.elt},vi.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},vi.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},vi.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},vi.prototype.__class__=vi;var gi=zpp_nape.util.ZNPList_ZPP_CbSetPair=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};gi.__name__=["zpp_nape","util","ZNPList_ZPP_CbSetPair"],gi.prototype.head=null,gi.prototype.begin=function(){return this.head},gi.prototype.modified=null,gi.prototype.pushmod=null,gi.prototype.length=null,gi.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},gi.prototype.add=function(t){null==Zi.zpp_pool?e=new Zi:(e=Zi.zpp_pool,Zi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},gi.prototype.inlined_add=function(t){null==Zi.zpp_pool?e=new Zi:(e=Zi.zpp_pool,Zi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},gi.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},gi.prototype.insert=function(t,e){null==Zi.zpp_pool?i=new Zi:(i=Zi.zpp_pool,Zi.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},gi.prototype.inlined_insert=function(t,e){null==Zi.zpp_pool?i=new Zi:(i=Zi.zpp_pool,Zi.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},gi.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=Zi.zpp_pool,Zi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},gi.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=Zi.zpp_pool,Zi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},gi.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},gi.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},gi.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=Zi.zpp_pool,Zi.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},gi.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},gi.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=Zi.zpp_pool,Zi.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},gi.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=Zi.zpp_pool,Zi.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},gi.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=Zi.zpp_pool,Zi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},gi.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=Zi.zpp_pool,Zi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},gi.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},gi.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=Zi.zpp_pool,Zi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},gi.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=Zi.zpp_pool,Zi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},gi.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},gi.prototype.empty=function(){return null==this.head},gi.prototype.size=function(){return this.length},gi.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},gi.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},gi.prototype.front=function(){return this.head.elt},gi.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},gi.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},gi.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},gi.prototype.__class__=gi;var bi=zpp_nape.util.ZNPList_ZPP_CutInt=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};bi.__name__=["zpp_nape","util","ZNPList_ZPP_CutInt"],bi.prototype.head=null,bi.prototype.begin=function(){return this.head},bi.prototype.modified=null,bi.prototype.pushmod=null,bi.prototype.length=null,bi.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},bi.prototype.add=function(t){null==Qi.zpp_pool?e=new Qi:(e=Qi.zpp_pool,Qi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},bi.prototype.inlined_add=function(t){null==Qi.zpp_pool?e=new Qi:(e=Qi.zpp_pool,Qi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},bi.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},bi.prototype.insert=function(t,e){null==Qi.zpp_pool?i=new Qi:(i=Qi.zpp_pool,Qi.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},bi.prototype.inlined_insert=function(t,e){null==Qi.zpp_pool?i=new Qi:(i=Qi.zpp_pool,Qi.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},bi.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=Qi.zpp_pool,Qi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},bi.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=Qi.zpp_pool,Qi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},bi.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},bi.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},bi.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=Qi.zpp_pool,Qi.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},bi.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},bi.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=Qi.zpp_pool,Qi.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},bi.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=Qi.zpp_pool,Qi.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},bi.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=Qi.zpp_pool,Qi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},bi.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=Qi.zpp_pool,Qi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},bi.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},bi.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=Qi.zpp_pool,Qi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},bi.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=Qi.zpp_pool,Qi.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},bi.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},bi.prototype.empty=function(){return null==this.head},bi.prototype.size=function(){return this.length},bi.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},bi.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},bi.prototype.front=function(){return this.head.elt},bi.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},bi.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},bi.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},bi.prototype.__class__=bi;var zi=zpp_nape.util.ZNPList_ZPP_CutVert=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};zi.__name__=["zpp_nape","util","ZNPList_ZPP_CutVert"],zi.prototype.head=null,zi.prototype.begin=function(){return this.head},zi.prototype.modified=null,zi.prototype.pushmod=null,zi.prototype.length=null,zi.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},zi.prototype.add=function(t){null==$i.zpp_pool?e=new $i:(e=$i.zpp_pool,$i.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},zi.prototype.inlined_add=function(t){null==$i.zpp_pool?e=new $i:(e=$i.zpp_pool,$i.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},zi.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},zi.prototype.insert=function(t,e){null==$i.zpp_pool?i=new $i:(i=$i.zpp_pool,$i.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},zi.prototype.inlined_insert=function(t,e){null==$i.zpp_pool?i=new $i:(i=$i.zpp_pool,$i.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},zi.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=$i.zpp_pool,$i.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},zi.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=$i.zpp_pool,$i.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},zi.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},zi.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},zi.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=$i.zpp_pool,$i.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},zi.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},zi.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=$i.zpp_pool,$i.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},zi.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=$i.zpp_pool,$i.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},zi.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=$i.zpp_pool,$i.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},zi.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=$i.zpp_pool,$i.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},zi.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},zi.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=$i.zpp_pool,$i.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},zi.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=$i.zpp_pool,$i.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},zi.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},zi.prototype.empty=function(){return null==this.head},zi.prototype.size=function(){return this.length},zi.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},zi.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},zi.prototype.front=function(){return this.head.elt},zi.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},zi.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},zi.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},zi.prototype.__class__=zi;var wi=zpp_nape.util.ZNPList_ZPP_PartitionVertex=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};wi.__name__=["zpp_nape","util","ZNPList_ZPP_PartitionVertex"],wi.prototype.head=null,wi.prototype.begin=function(){return this.head},wi.prototype.modified=null,wi.prototype.pushmod=null,wi.prototype.length=null,wi.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},wi.prototype.add=function(t){null==tn.zpp_pool?e=new tn:(e=tn.zpp_pool,tn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},wi.prototype.inlined_add=function(t){null==tn.zpp_pool?e=new tn:(e=tn.zpp_pool,tn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},wi.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},wi.prototype.insert=function(t,e){null==tn.zpp_pool?i=new tn:(i=tn.zpp_pool,tn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},wi.prototype.inlined_insert=function(t,e){null==tn.zpp_pool?i=new tn:(i=tn.zpp_pool,tn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},wi.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=tn.zpp_pool,tn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},wi.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=tn.zpp_pool,tn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},wi.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},wi.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},wi.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=tn.zpp_pool,tn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},wi.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},wi.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=tn.zpp_pool,tn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},wi.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=tn.zpp_pool,tn.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},wi.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=tn.zpp_pool,tn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},wi.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=tn.zpp_pool,tn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},wi.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},wi.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=tn.zpp_pool,tn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},wi.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=tn.zpp_pool,tn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},wi.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},wi.prototype.empty=function(){return null==this.head},wi.prototype.size=function(){return this.length},wi.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},wi.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},wi.prototype.front=function(){return this.head.elt},wi.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},wi.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},wi.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},wi.prototype.__class__=wi;var Ci=zpp_nape.util.ZNPList_ZPP_SimplifyP=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ci.__name__=["zpp_nape","util","ZNPList_ZPP_SimplifyP"],Ci.prototype.head=null,Ci.prototype.begin=function(){return this.head},Ci.prototype.modified=null,Ci.prototype.pushmod=null,Ci.prototype.length=null,Ci.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},Ci.prototype.add=function(t){null==en.zpp_pool?e=new en:(e=en.zpp_pool,en.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Ci.prototype.inlined_add=function(t){null==en.zpp_pool?e=new en:(e=en.zpp_pool,en.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Ci.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},Ci.prototype.insert=function(t,e){null==en.zpp_pool?i=new en:(i=en.zpp_pool,en.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Ci.prototype.inlined_insert=function(t,e){null==en.zpp_pool?i=new en:(i=en.zpp_pool,en.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Ci.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=en.zpp_pool,en.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ci.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=en.zpp_pool,en.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ci.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Ci.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Ci.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=en.zpp_pool,en.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Ci.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Ci.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=en.zpp_pool,en.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Ci.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=en.zpp_pool,en.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Ci.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=en.zpp_pool,en.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ci.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=en.zpp_pool,en.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ci.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Ci.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=en.zpp_pool,en.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ci.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=en.zpp_pool,en.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ci.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},Ci.prototype.empty=function(){return null==this.head},Ci.prototype.size=function(){return this.length},Ci.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Ci.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Ci.prototype.front=function(){return this.head.elt},Ci.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},Ci.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},Ci.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},Ci.prototype.__class__=Ci;var Pi=zpp_nape.util.ZNPList_ZPP_PartitionedPoly=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Pi.__name__=["zpp_nape","util","ZNPList_ZPP_PartitionedPoly"],Pi.prototype.head=null,Pi.prototype.begin=function(){return this.head},Pi.prototype.modified=null,Pi.prototype.pushmod=null,Pi.prototype.length=null,Pi.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},Pi.prototype.add=function(t){null==on.zpp_pool?e=new on:(e=on.zpp_pool,on.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Pi.prototype.inlined_add=function(t){null==on.zpp_pool?e=new on:(e=on.zpp_pool,on.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Pi.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},Pi.prototype.insert=function(t,e){null==on.zpp_pool?i=new on:(i=on.zpp_pool,on.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Pi.prototype.inlined_insert=function(t,e){null==on.zpp_pool?i=new on:(i=on.zpp_pool,on.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Pi.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=on.zpp_pool,on.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Pi.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=on.zpp_pool,on.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Pi.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Pi.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Pi.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=on.zpp_pool,on.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Pi.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Pi.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=on.zpp_pool,on.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Pi.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=on.zpp_pool,on.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Pi.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=on.zpp_pool,on.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Pi.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=on.zpp_pool,on.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Pi.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Pi.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=on.zpp_pool,on.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Pi.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=on.zpp_pool,on.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Pi.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},Pi.prototype.empty=function(){return null==this.head},Pi.prototype.size=function(){return this.length},Pi.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Pi.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Pi.prototype.front=function(){return this.head.elt},Pi.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},Pi.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},Pi.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},Pi.prototype.__class__=Pi;var Ti=zpp_nape.util.ZNPList_ZPP_GeomVert=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ti.__name__=["zpp_nape","util","ZNPList_ZPP_GeomVert"],Ti.prototype.head=null,Ti.prototype.begin=function(){return this.head},Ti.prototype.modified=null,Ti.prototype.pushmod=null,Ti.prototype.length=null,Ti.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},Ti.prototype.add=function(t){null==an.zpp_pool?e=new an:(e=an.zpp_pool,an.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Ti.prototype.inlined_add=function(t){null==an.zpp_pool?e=new an:(e=an.zpp_pool,an.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Ti.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},Ti.prototype.insert=function(t,e){null==an.zpp_pool?i=new an:(i=an.zpp_pool,an.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Ti.prototype.inlined_insert=function(t,e){null==an.zpp_pool?i=new an:(i=an.zpp_pool,an.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Ti.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=an.zpp_pool,an.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ti.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=an.zpp_pool,an.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ti.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Ti.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Ti.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=an.zpp_pool,an.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Ti.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Ti.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=an.zpp_pool,an.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Ti.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=an.zpp_pool,an.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Ti.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=an.zpp_pool,an.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ti.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=an.zpp_pool,an.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ti.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Ti.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=an.zpp_pool,an.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ti.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=an.zpp_pool,an.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ti.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},Ti.prototype.empty=function(){return null==this.head},Ti.prototype.size=function(){return this.length},Ti.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Ti.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Ti.prototype.front=function(){return this.head.elt},Ti.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},Ti.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},Ti.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},Ti.prototype.__class__=Ti;var Si=zpp_nape.util.ZNPList_ZPP_SimpleVert=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Si.__name__=["zpp_nape","util","ZNPList_ZPP_SimpleVert"],Si.prototype.head=null,Si.prototype.begin=function(){return this.head},Si.prototype.modified=null,Si.prototype.pushmod=null,Si.prototype.length=null,Si.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},Si.prototype.add=function(t){null==ln.zpp_pool?e=new ln:(e=ln.zpp_pool,ln.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Si.prototype.inlined_add=function(t){null==ln.zpp_pool?e=new ln:(e=ln.zpp_pool,ln.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Si.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},Si.prototype.insert=function(t,e){null==ln.zpp_pool?i=new ln:(i=ln.zpp_pool,ln.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Si.prototype.inlined_insert=function(t,e){null==ln.zpp_pool?i=new ln:(i=ln.zpp_pool,ln.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Si.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=ln.zpp_pool,ln.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Si.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=ln.zpp_pool,ln.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Si.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Si.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Si.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=ln.zpp_pool,ln.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Si.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Si.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=ln.zpp_pool,ln.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Si.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=ln.zpp_pool,ln.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Si.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=ln.zpp_pool,ln.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Si.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=ln.zpp_pool,ln.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Si.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Si.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=ln.zpp_pool,ln.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Si.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=ln.zpp_pool,ln.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Si.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},Si.prototype.empty=function(){return null==this.head},Si.prototype.size=function(){return this.length},Si.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Si.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Si.prototype.front=function(){return this.head.elt},Si.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},Si.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},Si.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},Si.prototype.__class__=Si;var Mi=zpp_nape.util.ZNPList_ZPP_SimpleEvent=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Mi.__name__=["zpp_nape","util","ZNPList_ZPP_SimpleEvent"],Mi.prototype.head=null,Mi.prototype.begin=function(){return this.head},Mi.prototype.modified=null,Mi.prototype.pushmod=null,Mi.prototype.length=null,Mi.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},Mi.prototype.add=function(t){null==pn.zpp_pool?e=new pn:(e=pn.zpp_pool,pn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Mi.prototype.inlined_add=function(t){null==pn.zpp_pool?e=new pn:(e=pn.zpp_pool,pn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Mi.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},Mi.prototype.insert=function(t,e){null==pn.zpp_pool?i=new pn:(i=pn.zpp_pool,pn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Mi.prototype.inlined_insert=function(t,e){null==pn.zpp_pool?i=new pn:(i=pn.zpp_pool,pn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Mi.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=pn.zpp_pool,pn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Mi.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=pn.zpp_pool,pn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Mi.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Mi.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Mi.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=pn.zpp_pool,pn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Mi.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Mi.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=pn.zpp_pool,pn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Mi.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=pn.zpp_pool,pn.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Mi.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=pn.zpp_pool,pn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Mi.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=pn.zpp_pool,pn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Mi.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Mi.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=pn.zpp_pool,pn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Mi.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=pn.zpp_pool,pn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Mi.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},Mi.prototype.empty=function(){return null==this.head},Mi.prototype.size=function(){return this.length},Mi.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Mi.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Mi.prototype.front=function(){return this.head.elt},Mi.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},Mi.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},Mi.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},Mi.prototype.__class__=Mi;var Ai=zpp_nape.util.ZNPList_ZPP_AABBPair=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ai.__name__=["zpp_nape","util","ZNPList_ZPP_AABBPair"],Ai.prototype.head=null,Ai.prototype.begin=function(){return this.head},Ai.prototype.modified=null,Ai.prototype.pushmod=null,Ai.prototype.length=null,Ai.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},Ai.prototype.add=function(t){null==un.zpp_pool?e=new un:(e=un.zpp_pool,un.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Ai.prototype.inlined_add=function(t){null==un.zpp_pool?e=new un:(e=un.zpp_pool,un.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Ai.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},Ai.prototype.insert=function(t,e){null==un.zpp_pool?i=new un:(i=un.zpp_pool,un.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Ai.prototype.inlined_insert=function(t,e){null==un.zpp_pool?i=new un:(i=un.zpp_pool,un.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Ai.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=un.zpp_pool,un.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ai.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=un.zpp_pool,un.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ai.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Ai.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Ai.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=un.zpp_pool,un.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Ai.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Ai.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=un.zpp_pool,un.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Ai.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=un.zpp_pool,un.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Ai.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=un.zpp_pool,un.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ai.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=un.zpp_pool,un.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ai.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Ai.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=un.zpp_pool,un.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ai.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=un.zpp_pool,un.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ai.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},Ai.prototype.empty=function(){return null==this.head},Ai.prototype.size=function(){return this.length},Ai.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Ai.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Ai.prototype.front=function(){return this.head.elt},Ai.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},Ai.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},Ai.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},Ai.prototype.__class__=Ai;var Oi=zpp_nape.util.ZNPList_ZPP_Edge=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Oi.__name__=["zpp_nape","util","ZNPList_ZPP_Edge"],Oi.prototype.head=null,Oi.prototype.begin=function(){return this.head},Oi.prototype.modified=null,Oi.prototype.pushmod=null,Oi.prototype.length=null,Oi.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},Oi.prototype.add=function(t){null==cn.zpp_pool?e=new cn:(e=cn.zpp_pool,cn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Oi.prototype.inlined_add=function(t){null==cn.zpp_pool?e=new cn:(e=cn.zpp_pool,cn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Oi.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},Oi.prototype.insert=function(t,e){null==cn.zpp_pool?i=new cn:(i=cn.zpp_pool,cn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Oi.prototype.inlined_insert=function(t,e){null==cn.zpp_pool?i=new cn:(i=cn.zpp_pool,cn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Oi.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=cn.zpp_pool,cn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Oi.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=cn.zpp_pool,cn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Oi.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Oi.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Oi.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=cn.zpp_pool,cn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Oi.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Oi.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=cn.zpp_pool,cn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Oi.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=cn.zpp_pool,cn.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Oi.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=cn.zpp_pool,cn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Oi.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=cn.zpp_pool,cn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Oi.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Oi.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=cn.zpp_pool,cn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Oi.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=cn.zpp_pool,cn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Oi.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},Oi.prototype.empty=function(){return null==this.head},Oi.prototype.size=function(){return this.length},Oi.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Oi.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Oi.prototype.front=function(){return this.head.elt},Oi.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},Oi.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},Oi.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},Oi.prototype.__class__=Oi;var ki=zpp_nape.util.ZNPList_ZPP_AABBNode=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ki.__name__=["zpp_nape","util","ZNPList_ZPP_AABBNode"],ki.prototype.head=null,ki.prototype.begin=function(){return this.head},ki.prototype.modified=null,ki.prototype.pushmod=null,ki.prototype.length=null,ki.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},ki.prototype.add=function(t){null==dn.zpp_pool?e=new dn:(e=dn.zpp_pool,dn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},ki.prototype.inlined_add=function(t){null==dn.zpp_pool?e=new dn:(e=dn.zpp_pool,dn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},ki.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},ki.prototype.insert=function(t,e){null==dn.zpp_pool?i=new dn:(i=dn.zpp_pool,dn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},ki.prototype.inlined_insert=function(t,e){null==dn.zpp_pool?i=new dn:(i=dn.zpp_pool,dn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},ki.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=dn.zpp_pool,dn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ki.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=dn.zpp_pool,dn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ki.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},ki.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},ki.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=dn.zpp_pool,dn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},ki.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},ki.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=dn.zpp_pool,dn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},ki.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=dn.zpp_pool,dn.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},ki.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=dn.zpp_pool,dn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},ki.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=dn.zpp_pool,dn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},ki.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},ki.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=dn.zpp_pool,dn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ki.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=dn.zpp_pool,dn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ki.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},ki.prototype.empty=function(){return null==this.head},ki.prototype.size=function(){return this.length},ki.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},ki.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},ki.prototype.front=function(){return this.head.elt},ki.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},ki.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},ki.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},ki.prototype.__class__=ki;var Ei=zpp_nape.util.ZNPList_ZPP_Component=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ei.__name__=["zpp_nape","util","ZNPList_ZPP_Component"],Ei.prototype.head=null,Ei.prototype.begin=function(){return this.head},Ei.prototype.modified=null,Ei.prototype.pushmod=null,Ei.prototype.length=null,Ei.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},Ei.prototype.add=function(t){null==_n.zpp_pool?e=new _n:(e=_n.zpp_pool,_n.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Ei.prototype.inlined_add=function(t){null==_n.zpp_pool?e=new _n:(e=_n.zpp_pool,_n.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Ei.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},Ei.prototype.insert=function(t,e){null==_n.zpp_pool?i=new _n:(i=_n.zpp_pool,_n.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Ei.prototype.inlined_insert=function(t,e){null==_n.zpp_pool?i=new _n:(i=_n.zpp_pool,_n.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Ei.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=_n.zpp_pool,_n.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ei.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=_n.zpp_pool,_n.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ei.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Ei.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Ei.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=_n.zpp_pool,_n.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Ei.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Ei.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=_n.zpp_pool,_n.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Ei.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=_n.zpp_pool,_n.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Ei.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=_n.zpp_pool,_n.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ei.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=_n.zpp_pool,_n.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ei.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Ei.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=_n.zpp_pool,_n.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ei.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=_n.zpp_pool,_n.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ei.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},Ei.prototype.empty=function(){return null==this.head},Ei.prototype.size=function(){return this.length},Ei.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Ei.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Ei.prototype.front=function(){return this.head.elt},Ei.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},Ei.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},Ei.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},Ei.prototype.__class__=Ei;var Ii=zpp_nape.util.ZNPList_ZPP_FluidArbiter=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ii.__name__=["zpp_nape","util","ZNPList_ZPP_FluidArbiter"],Ii.prototype.head=null,Ii.prototype.begin=function(){return this.head},Ii.prototype.modified=null,Ii.prototype.pushmod=null,Ii.prototype.length=null,Ii.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},Ii.prototype.add=function(t){null==rr.zpp_pool?e=new rr:(e=rr.zpp_pool,rr.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Ii.prototype.inlined_add=function(t){null==rr.zpp_pool?e=new rr:(e=rr.zpp_pool,rr.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Ii.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},Ii.prototype.insert=function(t,e){null==rr.zpp_pool?i=new rr:(i=rr.zpp_pool,rr.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Ii.prototype.inlined_insert=function(t,e){null==rr.zpp_pool?i=new rr:(i=rr.zpp_pool,rr.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Ii.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=rr.zpp_pool,rr.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ii.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=rr.zpp_pool,rr.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ii.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Ii.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Ii.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=rr.zpp_pool,rr.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Ii.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Ii.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=rr.zpp_pool,rr.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Ii.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=rr.zpp_pool,rr.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Ii.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=rr.zpp_pool,rr.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ii.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=rr.zpp_pool,rr.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ii.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Ii.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=rr.zpp_pool,rr.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ii.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=rr.zpp_pool,rr.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ii.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},Ii.prototype.empty=function(){return null==this.head},Ii.prototype.size=function(){return this.length},Ii.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Ii.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Ii.prototype.front=function(){return this.head.elt},Ii.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},Ii.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},Ii.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},Ii.prototype.__class__=Ii;var Di=zpp_nape.util.ZNPList_ZPP_SensorArbiter=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Di.__name__=["zpp_nape","util","ZNPList_ZPP_SensorArbiter"],Di.prototype.head=null,Di.prototype.begin=function(){return this.head},Di.prototype.modified=null,Di.prototype.pushmod=null,Di.prototype.length=null,Di.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},Di.prototype.add=function(t){null==sr.zpp_pool?e=new sr:(e=sr.zpp_pool,sr.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Di.prototype.inlined_add=function(t){null==sr.zpp_pool?e=new sr:(e=sr.zpp_pool,sr.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Di.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},Di.prototype.insert=function(t,e){null==sr.zpp_pool?i=new sr:(i=sr.zpp_pool,sr.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Di.prototype.inlined_insert=function(t,e){null==sr.zpp_pool?i=new sr:(i=sr.zpp_pool,sr.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Di.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=sr.zpp_pool,sr.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Di.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=sr.zpp_pool,sr.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Di.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Di.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Di.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=sr.zpp_pool,sr.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Di.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Di.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=sr.zpp_pool,sr.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Di.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=sr.zpp_pool,sr.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Di.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=sr.zpp_pool,sr.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Di.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=sr.zpp_pool,sr.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Di.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Di.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=sr.zpp_pool,sr.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Di.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=sr.zpp_pool,sr.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Di.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},Di.prototype.empty=function(){return null==this.head},Di.prototype.size=function(){return this.length},Di.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Di.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Di.prototype.front=function(){return this.head.elt},Di.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},Di.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},Di.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},Di.prototype.__class__=Di;var Bi=zpp_nape.util.ZNPList_ZPP_Listener=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Bi.__name__=["zpp_nape","util","ZNPList_ZPP_Listener"],Bi.prototype.head=null,Bi.prototype.begin=function(){return this.head},Bi.prototype.modified=null,Bi.prototype.pushmod=null,Bi.prototype.length=null,Bi.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},Bi.prototype.add=function(t){null==yn.zpp_pool?e=new yn:(e=yn.zpp_pool,yn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Bi.prototype.inlined_add=function(t){null==yn.zpp_pool?e=new yn:(e=yn.zpp_pool,yn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Bi.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},Bi.prototype.insert=function(t,e){null==yn.zpp_pool?i=new yn:(i=yn.zpp_pool,yn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Bi.prototype.inlined_insert=function(t,e){null==yn.zpp_pool?i=new yn:(i=yn.zpp_pool,yn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Bi.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=yn.zpp_pool,yn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Bi.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=yn.zpp_pool,yn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Bi.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Bi.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Bi.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=yn.zpp_pool,yn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Bi.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Bi.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=yn.zpp_pool,yn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Bi.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=yn.zpp_pool,yn.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Bi.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=yn.zpp_pool,yn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Bi.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=yn.zpp_pool,yn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Bi.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Bi.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=yn.zpp_pool,yn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Bi.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=yn.zpp_pool,yn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Bi.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},Bi.prototype.empty=function(){return null==this.head},Bi.prototype.size=function(){return this.length},Bi.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Bi.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Bi.prototype.front=function(){return this.head.elt},Bi.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},Bi.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},Bi.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},Bi.prototype.__class__=Bi;var Li=zpp_nape.util.ZNPList_ZPP_ColArbiter=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Li.__name__=["zpp_nape","util","ZNPList_ZPP_ColArbiter"],Li.prototype.head=null,Li.prototype.begin=function(){return this.head},Li.prototype.modified=null,Li.prototype.pushmod=null,Li.prototype.length=null,Li.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},Li.prototype.add=function(t){null==or.zpp_pool?e=new or:(e=or.zpp_pool,or.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Li.prototype.inlined_add=function(t){null==or.zpp_pool?e=new or:(e=or.zpp_pool,or.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Li.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},Li.prototype.insert=function(t,e){null==or.zpp_pool?i=new or:(i=or.zpp_pool,or.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Li.prototype.inlined_insert=function(t,e){null==or.zpp_pool?i=new or:(i=or.zpp_pool,or.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Li.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=or.zpp_pool,or.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Li.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=or.zpp_pool,or.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Li.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Li.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Li.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=or.zpp_pool,or.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Li.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Li.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=or.zpp_pool,or.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Li.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=or.zpp_pool,or.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Li.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=or.zpp_pool,or.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Li.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=or.zpp_pool,or.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Li.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Li.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=or.zpp_pool,or.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Li.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=or.zpp_pool,or.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Li.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},Li.prototype.empty=function(){return null==this.head},Li.prototype.size=function(){return this.length},Li.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Li.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Li.prototype.front=function(){return this.head.elt},Li.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},Li.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},Li.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},Li.prototype.__class__=Li;var Ri=zpp_nape.util.ZNPList_ZPP_InteractionGroup=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ri.__name__=["zpp_nape","util","ZNPList_ZPP_InteractionGroup"],Ri.prototype.head=null,Ri.prototype.begin=function(){return this.head},Ri.prototype.modified=null,Ri.prototype.pushmod=null,Ri.prototype.length=null,Ri.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},Ri.prototype.add=function(t){null==fn.zpp_pool?e=new fn:(e=fn.zpp_pool,fn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Ri.prototype.inlined_add=function(t){null==fn.zpp_pool?e=new fn:(e=fn.zpp_pool,fn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Ri.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},Ri.prototype.insert=function(t,e){null==fn.zpp_pool?i=new fn:(i=fn.zpp_pool,fn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Ri.prototype.inlined_insert=function(t,e){null==fn.zpp_pool?i=new fn:(i=fn.zpp_pool,fn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Ri.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=fn.zpp_pool,fn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ri.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=fn.zpp_pool,fn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ri.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Ri.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Ri.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=fn.zpp_pool,fn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Ri.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Ri.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=fn.zpp_pool,fn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Ri.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=fn.zpp_pool,fn.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Ri.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=fn.zpp_pool,fn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ri.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=fn.zpp_pool,fn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ri.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Ri.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=fn.zpp_pool,fn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ri.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=fn.zpp_pool,fn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ri.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},Ri.prototype.empty=function(){return null==this.head},Ri.prototype.size=function(){return this.length},Ri.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Ri.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Ri.prototype.front=function(){return this.head.elt},Ri.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},Ri.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},Ri.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},Ri.prototype.__class__=Ri;var Fi=zpp_nape.util.ZNPList_ZPP_ToiEvent=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Fi.__name__=["zpp_nape","util","ZNPList_ZPP_ToiEvent"],Fi.prototype.head=null,Fi.prototype.begin=function(){return this.head},Fi.prototype.modified=null,Fi.prototype.pushmod=null,Fi.prototype.length=null,Fi.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},Fi.prototype.add=function(t){null==mn.zpp_pool?e=new mn:(e=mn.zpp_pool,mn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Fi.prototype.inlined_add=function(t){null==mn.zpp_pool?e=new mn:(e=mn.zpp_pool,mn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Fi.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},Fi.prototype.insert=function(t,e){null==mn.zpp_pool?i=new mn:(i=mn.zpp_pool,mn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Fi.prototype.inlined_insert=function(t,e){null==mn.zpp_pool?i=new mn:(i=mn.zpp_pool,mn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Fi.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=mn.zpp_pool,mn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Fi.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=mn.zpp_pool,mn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Fi.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Fi.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Fi.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=mn.zpp_pool,mn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Fi.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Fi.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=mn.zpp_pool,mn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Fi.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=mn.zpp_pool,mn.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Fi.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=mn.zpp_pool,mn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Fi.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=mn.zpp_pool,mn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Fi.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Fi.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=mn.zpp_pool,mn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Fi.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=mn.zpp_pool,mn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Fi.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},Fi.prototype.empty=function(){return null==this.head},Fi.prototype.size=function(){return this.length},Fi.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Fi.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Fi.prototype.front=function(){return this.head.elt},Fi.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},Fi.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},Fi.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},Fi.prototype.__class__=Fi;var ji=zpp_nape.util.ZNPList_ConvexResult=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ji.__name__=["zpp_nape","util","ZNPList_ConvexResult"],ji.prototype.head=null,ji.prototype.begin=function(){return this.head},ji.prototype.modified=null,ji.prototype.pushmod=null,ji.prototype.length=null,ji.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},ji.prototype.add=function(t){null==xn.zpp_pool?e=new xn:(e=xn.zpp_pool,xn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},ji.prototype.inlined_add=function(t){null==xn.zpp_pool?e=new xn:(e=xn.zpp_pool,xn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},ji.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},ji.prototype.insert=function(t,e){null==xn.zpp_pool?i=new xn:(i=xn.zpp_pool,xn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},ji.prototype.inlined_insert=function(t,e){null==xn.zpp_pool?i=new xn:(i=xn.zpp_pool,xn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},ji.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=xn.zpp_pool,xn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ji.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=xn.zpp_pool,xn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ji.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},ji.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},ji.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=xn.zpp_pool,xn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},ji.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},ji.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=xn.zpp_pool,xn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},ji.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=xn.zpp_pool,xn.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},ji.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=xn.zpp_pool,xn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},ji.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=xn.zpp_pool,xn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},ji.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},ji.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=xn.zpp_pool,xn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ji.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=xn.zpp_pool,xn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ji.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},ji.prototype.empty=function(){return null==this.head},ji.prototype.size=function(){return this.length},ji.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},ji.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},ji.prototype.front=function(){return this.head.elt},ji.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},ji.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},ji.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},ji.prototype.__class__=ji;var Ni=zpp_nape.util.ZNPList_ZPP_GeomPoly=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ni.__name__=["zpp_nape","util","ZNPList_ZPP_GeomPoly"],Ni.prototype.head=null,Ni.prototype.begin=function(){return this.head},Ni.prototype.modified=null,Ni.prototype.pushmod=null,Ni.prototype.length=null,Ni.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},Ni.prototype.add=function(t){null==vn.zpp_pool?e=new vn:(e=vn.zpp_pool,vn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Ni.prototype.inlined_add=function(t){null==vn.zpp_pool?e=new vn:(e=vn.zpp_pool,vn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Ni.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},Ni.prototype.insert=function(t,e){null==vn.zpp_pool?i=new vn:(i=vn.zpp_pool,vn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Ni.prototype.inlined_insert=function(t,e){null==vn.zpp_pool?i=new vn:(i=vn.zpp_pool,vn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Ni.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=vn.zpp_pool,vn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ni.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=vn.zpp_pool,vn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ni.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Ni.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Ni.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=vn.zpp_pool,vn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Ni.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Ni.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=vn.zpp_pool,vn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Ni.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=vn.zpp_pool,vn.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Ni.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=vn.zpp_pool,vn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ni.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=vn.zpp_pool,vn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Ni.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Ni.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=vn.zpp_pool,vn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ni.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=vn.zpp_pool,vn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ni.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},Ni.prototype.empty=function(){return null==this.head},Ni.prototype.size=function(){return this.length},Ni.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Ni.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Ni.prototype.front=function(){return this.head.elt},Ni.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},Ni.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},Ni.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},Ni.prototype.__class__=Ni;var Gi=zpp_nape.util.ZNPList_RayResult=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Gi.__name__=["zpp_nape","util","ZNPList_RayResult"],Gi.prototype.head=null,Gi.prototype.begin=function(){return this.head},Gi.prototype.modified=null,Gi.prototype.pushmod=null,Gi.prototype.length=null,Gi.prototype.setbegin=function(t){this.head=t,this.modified=!0,this.pushmod=!0},Gi.prototype.add=function(t){null==gn.zpp_pool?e=new gn:(e=gn.zpp_pool,gn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Gi.prototype.inlined_add=function(t){null==gn.zpp_pool?e=new gn:(e=gn.zpp_pool,gn.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return e.next=this.head,this.head=e,this.modified=!0,this.length++,t},Gi.prototype.addAll=function(t){for(var e=t.head;null!=e;)this.add(e.elt),e=e.next},Gi.prototype.insert=function(t,e){null==gn.zpp_pool?i=new gn:(i=gn.zpp_pool,gn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Gi.prototype.inlined_insert=function(t,e){null==gn.zpp_pool?i=new gn:(i=gn.zpp_pool,gn.zpp_pool=i.next,i.next=null),i.elt=e;var i=i;return null==t?(i.next=this.head,this.head=i):(i.next=t.next,t.next=i),this.pushmod=this.modified=!0,this.length++,i},Gi.prototype.pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=gn.zpp_pool,gn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Gi.prototype.inlined_pop=function(){var t=this.head;this.head=t.next,t.elt=null,t.next=gn.zpp_pool,gn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Gi.prototype.pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Gi.prototype.inlined_pop_unsafe=function(){var t=this.head.elt;return this.pop(),t},Gi.prototype.remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=gn.zpp_pool,gn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Gi.prototype.try_remove=function(t){for(var e=null,i=this.head,n=!1;null!=i;){if(i.elt==t){this.erase(e),n=!0;break}i=(e=i).next}return n},Gi.prototype.inlined_remove=function(t){for(var e,i,n=null,r=this.head;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var s=e;s.elt=null,s.next=gn.zpp_pool,gn.zpp_pool=s,this.modified=!0,this.length--,this.pushmod=!0;break}r=(n=r).next}},Gi.prototype.inlined_try_remove=function(t){for(var e,i,n=null,r=this.head,s=!1;null!=r;){if(r.elt==t){null==n?(i=(e=this.head).next,this.head=i,null==this.head&&(this.pushmod=!0)):(i=(e=n.next).next,null==(n.next=i)&&(this.pushmod=!0));var o=e;o.elt=null,o.next=gn.zpp_pool,gn.zpp_pool=o,this.modified=!0,this.length--,s=this.pushmod=!0;break}r=(n=r).next}return s},Gi.prototype.erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=gn.zpp_pool,gn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Gi.prototype.inlined_erase=function(t){var e;null==t?(e=(i=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(i=t.next).next,null==(t.next=e)&&(this.pushmod=!0));var i=i;return i.elt=null,i.next=gn.zpp_pool,gn.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,e},Gi.prototype.splice=function(t,e){for(;0<e--&&null!=t.next;)this.erase(t);return t.next},Gi.prototype.clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=gn.zpp_pool,gn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Gi.prototype.inlined_clear=function(){for(;null!=this.head;){var t=this.head;this.head=t.next,t.elt=null,t.next=gn.zpp_pool,gn.zpp_pool=t,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Gi.prototype.reverse=function(){for(var t=this.head,e=null;null!=t;){var i=t.next;t.next=e,e=this.head=t,t=i}this.modified=!0,this.pushmod=!0},Gi.prototype.empty=function(){return null==this.head},Gi.prototype.size=function(){return this.length},Gi.prototype.has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Gi.prototype.inlined_has=function(t){for(var e=!1,i=this.head;null!=i;){if(i.elt==t){e=!0;break}i=i.next}return e},Gi.prototype.front=function(){return this.head.elt},Gi.prototype.back=function(){for(var t=this.head,e=t;null!=e;)e=(t=e).next;return t.elt},Gi.prototype.iterator_at=function(t){for(var e=this.head;0<t--&&null!=e;)e=e.next;return e},Gi.prototype.at=function(t){t=this.iterator_at(t);return null!=t?t.elt:null},Gi.prototype.__class__=Gi;var Ui=zpp_nape.util.ZNPNode_ZPP_CbType=function(){this.elt=null,this.next=null};Ui.__name__=["zpp_nape","util","ZNPNode_ZPP_CbType"],Ui.prototype.next=null,Ui.prototype.alloc=function(){},Ui.prototype.free=function(){this.elt=null},Ui.prototype.elt=null,Ui.prototype.elem=function(){return this.elt},Ui.prototype.__class__=Ui;var Xi=zpp_nape.util.ZNPNode_ZPP_CallbackSet=function(){this.elt=null,this.next=null};Xi.__name__=["zpp_nape","util","ZNPNode_ZPP_CallbackSet"],Xi.prototype.next=null,Xi.prototype.alloc=function(){},Xi.prototype.free=function(){this.elt=null},Xi.prototype.elt=null,Xi.prototype.elem=function(){return this.elt},Xi.prototype.__class__=Xi;var Vi=zpp_nape.util.ZNPNode_ZPP_Shape=function(){this.elt=null,this.next=null};Vi.__name__=["zpp_nape","util","ZNPNode_ZPP_Shape"],Vi.prototype.next=null,Vi.prototype.alloc=function(){},Vi.prototype.free=function(){this.elt=null},Vi.prototype.elt=null,Vi.prototype.elem=function(){return this.elt},Vi.prototype.__class__=Vi;var Wi=zpp_nape.util.ZNPNode_ZPP_Body=function(){this.elt=null,this.next=null};Wi.__name__=["zpp_nape","util","ZNPNode_ZPP_Body"],Wi.prototype.next=null,Wi.prototype.alloc=function(){},Wi.prototype.free=function(){this.elt=null},Wi.prototype.elt=null,Wi.prototype.elem=function(){return this.elt},Wi.prototype.__class__=Wi;var Hi=zpp_nape.util.ZNPNode_ZPP_Constraint=function(){this.elt=null,this.next=null};Hi.__name__=["zpp_nape","util","ZNPNode_ZPP_Constraint"],Hi.prototype.next=null,Hi.prototype.alloc=function(){},Hi.prototype.free=function(){this.elt=null},Hi.prototype.elt=null,Hi.prototype.elem=function(){return this.elt},Hi.prototype.__class__=Hi;var qi=zpp_nape.util.ZNPNode_ZPP_Compound=function(){this.elt=null,this.next=null};qi.__name__=["zpp_nape","util","ZNPNode_ZPP_Compound"],qi.prototype.next=null,qi.prototype.alloc=function(){},qi.prototype.free=function(){this.elt=null},qi.prototype.elt=null,qi.prototype.elem=function(){return this.elt},qi.prototype.__class__=qi;var er=zpp_nape.util.ZNPNode_ZPP_Arbiter=function(){this.elt=null,this.next=null};er.__name__=["zpp_nape","util","ZNPNode_ZPP_Arbiter"],er.prototype.next=null,er.prototype.alloc=function(){},er.prototype.free=function(){this.elt=null},er.prototype.elt=null,er.prototype.elem=function(){return this.elt},er.prototype.__class__=er;var ir=zpp_nape.util.ZNPNode_ZPP_InteractionListener=function(){this.elt=null,this.next=null};ir.__name__=["zpp_nape","util","ZNPNode_ZPP_InteractionListener"],ir.prototype.next=null,ir.prototype.alloc=function(){},ir.prototype.free=function(){this.elt=null},ir.prototype.elt=null,ir.prototype.elem=function(){return this.elt},ir.prototype.__class__=ir;var Yi=zpp_nape.util.ZNPNode_ZPP_CbSet=function(){this.elt=null,this.next=null};Yi.__name__=["zpp_nape","util","ZNPNode_ZPP_CbSet"],Yi.prototype.next=null,Yi.prototype.alloc=function(){},Yi.prototype.free=function(){this.elt=null},Yi.prototype.elt=null,Yi.prototype.elem=function(){return this.elt},Yi.prototype.__class__=Yi;var nr=zpp_nape.util.ZNPNode_ZPP_Interactor=function(){this.elt=null,this.next=null};nr.__name__=["zpp_nape","util","ZNPNode_ZPP_Interactor"],nr.prototype.next=null,nr.prototype.alloc=function(){},nr.prototype.free=function(){this.elt=null},nr.prototype.elt=null,nr.prototype.elem=function(){return this.elt},nr.prototype.__class__=nr;var Ki=zpp_nape.util.ZNPNode_ZPP_BodyListener=function(){this.elt=null,this.next=null};Ki.__name__=["zpp_nape","util","ZNPNode_ZPP_BodyListener"],Ki.prototype.next=null,Ki.prototype.alloc=function(){},Ki.prototype.free=function(){this.elt=null},Ki.prototype.elt=null,Ki.prototype.elem=function(){return this.elt},Ki.prototype.__class__=Ki;var Zi=zpp_nape.util.ZNPNode_ZPP_CbSetPair=function(){this.elt=null,this.next=null};Zi.__name__=["zpp_nape","util","ZNPNode_ZPP_CbSetPair"],Zi.prototype.next=null,Zi.prototype.alloc=function(){},Zi.prototype.free=function(){this.elt=null},Zi.prototype.elt=null,Zi.prototype.elem=function(){return this.elt},Zi.prototype.__class__=Zi;var Ji=zpp_nape.util.ZNPNode_ZPP_ConstraintListener=function(){this.elt=null,this.next=null};Ji.__name__=["zpp_nape","util","ZNPNode_ZPP_ConstraintListener"],Ji.prototype.next=null,Ji.prototype.alloc=function(){},Ji.prototype.free=function(){this.elt=null},Ji.prototype.elt=null,Ji.prototype.elem=function(){return this.elt},Ji.prototype.__class__=Ji;var Qi=zpp_nape.util.ZNPNode_ZPP_CutInt=function(){this.elt=null,this.next=null};Qi.__name__=["zpp_nape","util","ZNPNode_ZPP_CutInt"],Qi.prototype.next=null,Qi.prototype.alloc=function(){},Qi.prototype.free=function(){this.elt=null},Qi.prototype.elt=null,Qi.prototype.elem=function(){return this.elt},Qi.prototype.__class__=Qi;var $i=zpp_nape.util.ZNPNode_ZPP_CutVert=function(){this.elt=null,this.next=null};$i.__name__=["zpp_nape","util","ZNPNode_ZPP_CutVert"],$i.prototype.next=null,$i.prototype.alloc=function(){},$i.prototype.free=function(){this.elt=null},$i.prototype.elt=null,$i.prototype.elem=function(){return this.elt},$i.prototype.__class__=$i;var tn=zpp_nape.util.ZNPNode_ZPP_PartitionVertex=function(){this.elt=null,this.next=null};tn.__name__=["zpp_nape","util","ZNPNode_ZPP_PartitionVertex"],tn.prototype.next=null,tn.prototype.alloc=function(){},tn.prototype.free=function(){this.elt=null},tn.prototype.elt=null,tn.prototype.elem=function(){return this.elt},tn.prototype.__class__=tn;var en=zpp_nape.util.ZNPNode_ZPP_SimplifyP=function(){this.elt=null,this.next=null};en.__name__=["zpp_nape","util","ZNPNode_ZPP_SimplifyP"],en.prototype.next=null,en.prototype.alloc=function(){},en.prototype.free=function(){this.elt=null},en.prototype.elt=null,en.prototype.elem=function(){return this.elt},en.prototype.__class__=en;var on=zpp_nape.util.ZNPNode_ZPP_PartitionedPoly=function(){this.elt=null,this.next=null};on.__name__=["zpp_nape","util","ZNPNode_ZPP_PartitionedPoly"],on.prototype.next=null,on.prototype.alloc=function(){},on.prototype.free=function(){this.elt=null},on.prototype.elt=null,on.prototype.elem=function(){return this.elt},on.prototype.__class__=on;var an=zpp_nape.util.ZNPNode_ZPP_GeomVert=function(){this.elt=null,this.next=null};an.__name__=["zpp_nape","util","ZNPNode_ZPP_GeomVert"],an.prototype.next=null,an.prototype.alloc=function(){},an.prototype.free=function(){this.elt=null},an.prototype.elt=null,an.prototype.elem=function(){return this.elt},an.prototype.__class__=an;var ln=zpp_nape.util.ZNPNode_ZPP_SimpleVert=function(){this.elt=null,this.next=null};ln.__name__=["zpp_nape","util","ZNPNode_ZPP_SimpleVert"],ln.prototype.next=null,ln.prototype.alloc=function(){},ln.prototype.free=function(){this.elt=null},ln.prototype.elt=null,ln.prototype.elem=function(){return this.elt},ln.prototype.__class__=ln;var pn=zpp_nape.util.ZNPNode_ZPP_SimpleEvent=function(){this.elt=null,this.next=null};pn.__name__=["zpp_nape","util","ZNPNode_ZPP_SimpleEvent"],pn.prototype.next=null,pn.prototype.alloc=function(){},pn.prototype.free=function(){this.elt=null},pn.prototype.elt=null,pn.prototype.elem=function(){return this.elt},pn.prototype.__class__=pn;var hn=zpp_nape.util.ZNPNode_ZPP_Vec2=function(){this.elt=null,this.next=null};hn.__name__=["zpp_nape","util","ZNPNode_ZPP_Vec2"],hn.prototype.next=null,hn.prototype.alloc=function(){},hn.prototype.free=function(){this.elt=null},hn.prototype.elt=null,hn.prototype.elem=function(){return this.elt},hn.prototype.__class__=hn;var un=zpp_nape.util.ZNPNode_ZPP_AABBPair=function(){this.elt=null,this.next=null};un.__name__=["zpp_nape","util","ZNPNode_ZPP_AABBPair"],un.prototype.next=null,un.prototype.alloc=function(){},un.prototype.free=function(){this.elt=null},un.prototype.elt=null,un.prototype.elem=function(){return this.elt},un.prototype.__class__=un;var cn=zpp_nape.util.ZNPNode_ZPP_Edge=function(){this.elt=null,this.next=null};cn.__name__=["zpp_nape","util","ZNPNode_ZPP_Edge"],cn.prototype.next=null,cn.prototype.alloc=function(){},cn.prototype.free=function(){this.elt=null},cn.prototype.elt=null,cn.prototype.elem=function(){return this.elt},cn.prototype.__class__=cn;var dn=zpp_nape.util.ZNPNode_ZPP_AABBNode=function(){this.elt=null,this.next=null};dn.__name__=["zpp_nape","util","ZNPNode_ZPP_AABBNode"],dn.prototype.next=null,dn.prototype.alloc=function(){},dn.prototype.free=function(){this.elt=null},dn.prototype.elt=null,dn.prototype.elem=function(){return this.elt},dn.prototype.__class__=dn;var _n=zpp_nape.util.ZNPNode_ZPP_Component=function(){this.elt=null,this.next=null};_n.__name__=["zpp_nape","util","ZNPNode_ZPP_Component"],_n.prototype.next=null,_n.prototype.alloc=function(){},_n.prototype.free=function(){this.elt=null},_n.prototype.elt=null,_n.prototype.elem=function(){return this.elt},_n.prototype.__class__=_n;var rr=zpp_nape.util.ZNPNode_ZPP_FluidArbiter=function(){this.elt=null,this.next=null};rr.__name__=["zpp_nape","util","ZNPNode_ZPP_FluidArbiter"],rr.prototype.next=null,rr.prototype.alloc=function(){},rr.prototype.free=function(){this.elt=null},rr.prototype.elt=null,rr.prototype.elem=function(){return this.elt},rr.prototype.__class__=rr;var sr=zpp_nape.util.ZNPNode_ZPP_SensorArbiter=function(){this.elt=null,this.next=null};sr.__name__=["zpp_nape","util","ZNPNode_ZPP_SensorArbiter"],sr.prototype.next=null,sr.prototype.alloc=function(){},sr.prototype.free=function(){this.elt=null},sr.prototype.elt=null,sr.prototype.elem=function(){return this.elt},sr.prototype.__class__=sr;var yn=zpp_nape.util.ZNPNode_ZPP_Listener=function(){this.elt=null,this.next=null};yn.__name__=["zpp_nape","util","ZNPNode_ZPP_Listener"],yn.prototype.next=null,yn.prototype.alloc=function(){},yn.prototype.free=function(){this.elt=null},yn.prototype.elt=null,yn.prototype.elem=function(){return this.elt},yn.prototype.__class__=yn;var or=zpp_nape.util.ZNPNode_ZPP_ColArbiter=function(){this.elt=null,this.next=null};or.__name__=["zpp_nape","util","ZNPNode_ZPP_ColArbiter"],or.prototype.next=null,or.prototype.alloc=function(){},or.prototype.free=function(){this.elt=null},or.prototype.elt=null,or.prototype.elem=function(){return this.elt},or.prototype.__class__=or;var fn=zpp_nape.util.ZNPNode_ZPP_InteractionGroup=function(){this.elt=null,this.next=null};fn.__name__=["zpp_nape","util","ZNPNode_ZPP_InteractionGroup"],fn.prototype.next=null,fn.prototype.alloc=function(){},fn.prototype.free=function(){this.elt=null},fn.prototype.elt=null,fn.prototype.elem=function(){return this.elt},fn.prototype.__class__=fn;var mn=zpp_nape.util.ZNPNode_ZPP_ToiEvent=function(){this.elt=null,this.next=null};mn.__name__=["zpp_nape","util","ZNPNode_ZPP_ToiEvent"],mn.prototype.next=null,mn.prototype.alloc=function(){},mn.prototype.free=function(){this.elt=null},mn.prototype.elt=null,mn.prototype.elem=function(){return this.elt},mn.prototype.__class__=mn;var xn=zpp_nape.util.ZNPNode_ConvexResult=function(){this.elt=null,this.next=null};xn.__name__=["zpp_nape","util","ZNPNode_ConvexResult"],xn.prototype.next=null,xn.prototype.alloc=function(){},xn.prototype.free=function(){this.elt=null},xn.prototype.elt=null,xn.prototype.elem=function(){return this.elt},xn.prototype.__class__=xn;var vn=zpp_nape.util.ZNPNode_ZPP_GeomPoly=function(){this.elt=null,this.next=null};vn.__name__=["zpp_nape","util","ZNPNode_ZPP_GeomPoly"],vn.prototype.next=null,vn.prototype.alloc=function(){},vn.prototype.free=function(){this.elt=null},vn.prototype.elt=null,vn.prototype.elem=function(){return this.elt},vn.prototype.__class__=vn;var gn=zpp_nape.util.ZNPNode_RayResult=function(){this.elt=null,this.next=null};gn.__name__=["zpp_nape","util","ZNPNode_RayResult"],gn.prototype.next=null,gn.prototype.alloc=function(){},gn.prototype.free=function(){this.elt=null},gn.prototype.elt=null,gn.prototype.elem=function(){return this.elt},gn.prototype.__class__=gn;var bn=zpp_nape.util.ZPP_MixVec2List=function(){this.at_index=0,this.at_ite=null,this.zip_length=!1,this._length=0,this.inner=null,Y.call(this),this.at_ite=null,this.at_index=0,this.zip_length=!0,this._length=0};bn.__name__=["zpp_nape","util","ZPP_MixVec2List"],bn.__super__=Y,bn.prototype=Object.create(Y.prototype),bn.get=function(t,e){null==e&&(e=!1);var i=new bn;return i.inner=t,i.zpp_inner.immutable=e,i},bn.prototype.inner=null,bn.prototype._length=null,bn.prototype.zip_length=null,bn.prototype.at_ite=null,bn.prototype.at_index=null,bn.prototype.zpp_gl=function(){if(this.zpp_vm(),this.zip_length){this._length=0;for(var t=this.inner.next;null!=t;)this._length++,t=t.next;this.zip_length=!1}return this._length},bn.prototype.zpp_vm=function(){this.zpp_inner.validate(),this.inner.modified&&(this.zip_length=!0,this._length=0,this.at_ite=null)},bn.prototype.at=function(t){for(this.zpp_vm(),this.zpp_inner.reverse_flag&&(t=this.zpp_gl()-1-t),(t<this.at_index||null==this.at_ite)&&(this.at_index=0,this.at_ite=this.inner.next);this.at_index!=t;)this.at_index++,this.at_ite=this.at_ite.next;var e,i=this.at_ite;return null==i.outer&&(i.outer=new Ct,null!=(e=i.outer.zpp_inner).outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ir.zpp_pool,Ir.zpp_pool=e,i.outer.zpp_inner=i),i.outer},bn.prototype.push=function(t){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return e&&(this.zpp_inner.reverse_flag?this.inner.add(t.zpp_inner):this.inner.insert(this.inner.iterator_at(this.zpp_gl()-1),t.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),e},bn.prototype.unshift=function(t){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(t);return e&&(this.zpp_inner.reverse_flag?this.inner.insert(this.inner.iterator_at(this.zpp_gl()-1),t.zpp_inner):this.inner.add(t.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(t)),e},bn.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_vm();var t,e,i,n=null;return this.zpp_inner.reverse_flag?(null==(n=this.inner.next).outer&&(n.outer=new Ct,null!=(t=n.outer.zpp_inner).outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ir.zpp_pool,Ir.zpp_pool=t,n.outer.zpp_inner=n),t=n.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.inner.pop()):(null!=this.at_ite&&null==this.at_ite.next&&(this.at_ite=null),null==(n=(null==(i=1==this.zpp_gl()?null:this.inner.iterator_at(this.zpp_gl()-2))?this.inner:i).next).outer&&(n.outer=new Ct,null!=(e=n.outer.zpp_inner).outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ir.zpp_pool,Ir.zpp_pool=e,n.outer.zpp_inner=n),e=n.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.inner.erase(i)),this.zpp_inner.invalidate(),null==n.outer&&(n.outer=new Ct,null!=(i=n.outer.zpp_inner).outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ir.zpp_pool,Ir.zpp_pool=i,n.outer.zpp_inner=n),n.outer},bn.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_vm();var t,e,i,n=null;return this.zpp_inner.reverse_flag?(null!=this.at_ite&&null==this.at_ite.next&&(this.at_ite=null),null==(n=(null==(t=1==this.zpp_gl()?null:this.inner.iterator_at(this.zpp_gl()-2))?this.inner:t).next).outer&&(n.outer=new Ct,null!=(e=n.outer.zpp_inner).outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ir.zpp_pool,Ir.zpp_pool=e,n.outer.zpp_inner=n),e=n.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.inner.erase(t)):(null==(n=this.inner.next).outer&&(n.outer=new Ct,null!=(i=n.outer.zpp_inner).outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ir.zpp_pool,Ir.zpp_pool=i,n.outer.zpp_inner=n),i=n.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.inner.pop()),this.zpp_inner.invalidate(),null==n.outer&&(n.outer=new Ct,null!=(i=n.outer.zpp_inner).outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ir.zpp_pool,Ir.zpp_pool=i,n.outer.zpp_inner=n),n.outer},bn.prototype.remove=function(t){var e;this.zpp_inner.modify_test(),this.zpp_vm(),e=!1;for(var i=this.inner.next;null!=i;){if(t.zpp_inner==i){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.inner.remove(t.zpp_inner),this.zpp_inner.invalidate()),e},bn.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},bn.prototype.__class__=bn;var zn=zpp_nape.util.ZPP_ConstraintList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Pt,this._invalidated=!0};zn.__name__=["zpp_nape","util","ZPP_ConstraintList"],zn.get=function(t,e){null==e&&(e=!1);var i=new w;return i.zpp_inner.inner=t,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},zn.prototype.outer=null,zn.prototype.inner=null,zn.prototype.immutable=null,zn.prototype._invalidated=null,zn.prototype._invalidate=null,zn.prototype._validate=null,zn.prototype._modifiable=null,zn.prototype.adder=null,zn.prototype.post_adder=null,zn.prototype.subber=null,zn.prototype.dontremove=null,zn.prototype.reverse_flag=null,zn.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},zn.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},zn.prototype.modify_test=function(){},zn.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},zn.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},zn.prototype.at_index=null,zn.prototype.at_ite=null,zn.prototype.push_ite=null,zn.prototype.zip_length=null,zn.prototype.user_length=null,zn.prototype.__class__=zn;var wn=zpp_nape.util.ZPP_BodyList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new mi,this._invalidated=!0};wn.__name__=["zpp_nape","util","ZPP_BodyList"],wn.get=function(t,e){null==e&&(e=!1);var i=new tt;return i.zpp_inner.inner=t,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},wn.prototype.outer=null,wn.prototype.inner=null,wn.prototype.immutable=null,wn.prototype._invalidated=null,wn.prototype._invalidate=null,wn.prototype._validate=null,wn.prototype._modifiable=null,wn.prototype.adder=null,wn.prototype.post_adder=null,wn.prototype.subber=null,wn.prototype.dontremove=null,wn.prototype.reverse_flag=null,wn.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},wn.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},wn.prototype.modify_test=function(){},wn.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},wn.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},wn.prototype.at_index=null,wn.prototype.at_ite=null,wn.prototype.push_ite=null,wn.prototype.zip_length=null,wn.prototype.user_length=null,wn.prototype.__class__=wn;var Cn=zpp_nape.util.ZPP_InteractorList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Tt,this._invalidated=!0};Cn.__name__=["zpp_nape","util","ZPP_InteractorList"],Cn.get=function(t,e){null==e&&(e=!1);var i=new at;return i.zpp_inner.inner=t,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},Cn.prototype.outer=null,Cn.prototype.inner=null,Cn.prototype.immutable=null,Cn.prototype._invalidated=null,Cn.prototype._invalidate=null,Cn.prototype._validate=null,Cn.prototype._modifiable=null,Cn.prototype.adder=null,Cn.prototype.post_adder=null,Cn.prototype.subber=null,Cn.prototype.dontremove=null,Cn.prototype.reverse_flag=null,Cn.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Cn.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Cn.prototype.modify_test=function(){},Cn.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Cn.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Cn.prototype.at_index=null,Cn.prototype.at_ite=null,Cn.prototype.push_ite=null,Cn.prototype.zip_length=null,Cn.prototype.user_length=null,Cn.prototype.__class__=Cn;var Pn=zpp_nape.util.ZPP_CompoundList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new xi,this._invalidated=!0};Pn.__name__=["zpp_nape","util","ZPP_CompoundList"],Pn.get=function(t,e){null==e&&(e=!1);var i=new nt;return i.zpp_inner.inner=t,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},Pn.prototype.outer=null,Pn.prototype.inner=null,Pn.prototype.immutable=null,Pn.prototype._invalidated=null,Pn.prototype._invalidate=null,Pn.prototype._validate=null,Pn.prototype._modifiable=null,Pn.prototype.adder=null,Pn.prototype.post_adder=null,Pn.prototype.subber=null,Pn.prototype.dontremove=null,Pn.prototype.reverse_flag=null,Pn.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Pn.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Pn.prototype.modify_test=function(){},Pn.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Pn.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Pn.prototype.at_index=null,Pn.prototype.at_ite=null,Pn.prototype.push_ite=null,Pn.prototype.zip_length=null,Pn.prototype.user_length=null,Pn.prototype.__class__=Pn;var Tn=zpp_nape.util.ZPP_ListenerList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Bi,this._invalidated=!0};Tn.__name__=["zpp_nape","util","ZPP_ListenerList"],Tn.get=function(t,e){null==e&&(e=!1);var i=new m;return i.zpp_inner.inner=t,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},Tn.prototype.outer=null,Tn.prototype.inner=null,Tn.prototype.immutable=null,Tn.prototype._invalidated=null,Tn.prototype._invalidate=null,Tn.prototype._validate=null,Tn.prototype._modifiable=null,Tn.prototype.adder=null,Tn.prototype.post_adder=null,Tn.prototype.subber=null,Tn.prototype.dontremove=null,Tn.prototype.reverse_flag=null,Tn.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Tn.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Tn.prototype.modify_test=function(){},Tn.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Tn.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Tn.prototype.at_index=null,Tn.prototype.at_ite=null,Tn.prototype.push_ite=null,Tn.prototype.zip_length=null,Tn.prototype.user_length=null,Tn.prototype.__class__=Tn;var Sn=zpp_nape.util.ZPP_CbTypeList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Et,this._invalidated=!0};Sn.__name__=["zpp_nape","util","ZPP_CbTypeList"],Sn.get=function(t,e){null==e&&(e=!1);var i=new c;return i.zpp_inner.inner=t,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},Sn.prototype.outer=null,Sn.prototype.inner=null,Sn.prototype.immutable=null,Sn.prototype._invalidated=null,Sn.prototype._invalidate=null,Sn.prototype._validate=null,Sn.prototype._modifiable=null,Sn.prototype.adder=null,Sn.prototype.post_adder=null,Sn.prototype.subber=null,Sn.prototype.dontremove=null,Sn.prototype.reverse_flag=null,Sn.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Sn.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Sn.prototype.modify_test=function(){},Sn.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Sn.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Sn.prototype.at_index=null,Sn.prototype.at_ite=null,Sn.prototype.push_ite=null,Sn.prototype.zip_length=null,Sn.prototype.user_length=null,Sn.prototype.__class__=Sn;var Mn=zpp_nape.util.ZPP_Vec2List=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ue,this._invalidated=!0};Mn.__name__=["zpp_nape","util","ZPP_Vec2List"],Mn.get=function(t,e){null==e&&(e=!1);var i=new Y;return i.zpp_inner.inner=t,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},Mn.prototype.outer=null,Mn.prototype.inner=null,Mn.prototype.immutable=null,Mn.prototype._invalidated=null,Mn.prototype._invalidate=null,Mn.prototype._validate=null,Mn.prototype._modifiable=null,Mn.prototype.adder=null,Mn.prototype.post_adder=null,Mn.prototype.subber=null,Mn.prototype.dontremove=null,Mn.prototype.reverse_flag=null,Mn.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Mn.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Mn.prototype.modify_test=function(){},Mn.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Mn.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Mn.prototype.at_index=null,Mn.prototype.at_ite=null,Mn.prototype.push_ite=null,Mn.prototype.zip_length=null,Mn.prototype.user_length=null,Mn.prototype.__class__=Mn;var An=zpp_nape.util.ZPP_GeomPolyList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Ni,this._invalidated=!0};An.__name__=["zpp_nape","util","ZPP_GeomPolyList"],An.get=function(t,e){null==e&&(e=!1);var i=new di;return i.zpp_inner.inner=t,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},An.prototype.outer=null,An.prototype.inner=null,An.prototype.immutable=null,An.prototype._invalidated=null,An.prototype._invalidate=null,An.prototype._validate=null,An.prototype._modifiable=null,An.prototype.adder=null,An.prototype.post_adder=null,An.prototype.subber=null,An.prototype.dontremove=null,An.prototype.reverse_flag=null,An.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},An.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},An.prototype.modify_test=function(){},An.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},An.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},An.prototype.at_index=null,An.prototype.at_ite=null,An.prototype.push_ite=null,An.prototype.zip_length=null,An.prototype.user_length=null,An.prototype.__class__=An;var On=zpp_nape.util.ZPP_RayResultList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Gi,this._invalidated=!0};On.__name__=["zpp_nape","util","ZPP_RayResultList"],On.get=function(t,e){null==e&&(e=!1);var i=new q;return i.zpp_inner.inner=t,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},On.prototype.outer=null,On.prototype.inner=null,On.prototype.immutable=null,On.prototype._invalidated=null,On.prototype._invalidate=null,On.prototype._validate=null,On.prototype._modifiable=null,On.prototype.adder=null,On.prototype.post_adder=null,On.prototype.subber=null,On.prototype.dontremove=null,On.prototype.reverse_flag=null,On.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},On.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},On.prototype.modify_test=function(){},On.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},On.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},On.prototype.at_index=null,On.prototype.at_ite=null,On.prototype.push_ite=null,On.prototype.zip_length=null,On.prototype.user_length=null,On.prototype.__class__=On;var kn=zpp_nape.util.ZPP_ConvexResultList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ji,this._invalidated=!0};kn.__name__=["zpp_nape","util","ZPP_ConvexResultList"],kn.get=function(t,e){null==e&&(e=!1);var i=new wt;return i.zpp_inner.inner=t,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},kn.prototype.outer=null,kn.prototype.inner=null,kn.prototype.immutable=null,kn.prototype._invalidated=null,kn.prototype._invalidate=null,kn.prototype._validate=null,kn.prototype._modifiable=null,kn.prototype.adder=null,kn.prototype.post_adder=null,kn.prototype.subber=null,kn.prototype.dontremove=null,kn.prototype.reverse_flag=null,kn.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},kn.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},kn.prototype.modify_test=function(){},kn.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},kn.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},kn.prototype.at_index=null,kn.prototype.at_ite=null,kn.prototype.push_ite=null,kn.prototype.zip_length=null,kn.prototype.user_length=null,kn.prototype.__class__=kn;var En=zpp_nape.util.ZPP_EdgeList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Oi,this._invalidated=!0};En.__name__=["zpp_nape","util","ZPP_EdgeList"],En.get=function(t,e){null==e&&(e=!1);var i=new dt;return i.zpp_inner.inner=t,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},En.prototype.outer=null,En.prototype.inner=null,En.prototype.immutable=null,En.prototype._invalidated=null,En.prototype._invalidate=null,En.prototype._validate=null,En.prototype._modifiable=null,En.prototype.adder=null,En.prototype.post_adder=null,En.prototype.subber=null,En.prototype.dontremove=null,En.prototype.reverse_flag=null,En.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},En.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},En.prototype.modify_test=function(){},En.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},En.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},En.prototype.at_index=null,En.prototype.at_ite=null,En.prototype.push_ite=null,En.prototype.zip_length=null,En.prototype.user_length=null,En.prototype.__class__=En;var In=zpp_nape.util.ZPP_ShapeList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ui,this._invalidated=!0};In.__name__=["zpp_nape","util","ZPP_ShapeList"],In.get=function(t,e){null==e&&(e=!1);var i=new yt;return i.zpp_inner.inner=t,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},In.prototype.outer=null,In.prototype.inner=null,In.prototype.immutable=null,In.prototype._invalidated=null,In.prototype._invalidate=null,In.prototype._validate=null,In.prototype._modifiable=null,In.prototype.adder=null,In.prototype.post_adder=null,In.prototype.subber=null,In.prototype.dontremove=null,In.prototype.reverse_flag=null,In.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},In.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},In.prototype.modify_test=function(){},In.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},In.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},In.prototype.at_index=null,In.prototype.at_ite=null,In.prototype.push_ite=null,In.prototype.zip_length=null,In.prototype.user_length=null,In.prototype.__class__=In;var Dn=zpp_nape.util.ZPP_InteractionGroupList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Ri,this._invalidated=!0};Dn.__name__=["zpp_nape","util","ZPP_InteractionGroupList"],Dn.get=function(t,e){null==e&&(e=!1);var i=new j;return i.zpp_inner.inner=t,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},Dn.prototype.outer=null,Dn.prototype.inner=null,Dn.prototype.immutable=null,Dn.prototype._invalidated=null,Dn.prototype._invalidate=null,Dn.prototype._validate=null,Dn.prototype._modifiable=null,Dn.prototype.adder=null,Dn.prototype.post_adder=null,Dn.prototype.subber=null,Dn.prototype.dontremove=null,Dn.prototype.reverse_flag=null,Dn.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Dn.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Dn.prototype.modify_test=function(){},Dn.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Dn.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Dn.prototype.at_index=null,Dn.prototype.at_ite=null,Dn.prototype.push_ite=null,Dn.prototype.zip_length=null,Dn.prototype.user_length=null,Dn.prototype.__class__=Dn;var Bn=zpp_nape.util.ZPP_ArbiterList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new vi,this._invalidated=!0};Bn.__name__=["zpp_nape","util","ZPP_ArbiterList"],Bn.get=function(t,e){null==e&&(e=!1);var i=new k;return i.zpp_inner.inner=t,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},Bn.prototype.outer=null,Bn.prototype.inner=null,Bn.prototype.immutable=null,Bn.prototype._invalidated=null,Bn.prototype._invalidate=null,Bn.prototype._validate=null,Bn.prototype._modifiable=null,Bn.prototype.adder=null,Bn.prototype.post_adder=null,Bn.prototype.subber=null,Bn.prototype.dontremove=null,Bn.prototype.reverse_flag=null,Bn.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Bn.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Bn.prototype.modify_test=function(){},Bn.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Bn.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Bn.prototype.at_index=null,Bn.prototype.at_ite=null,Bn.prototype.push_ite=null,Bn.prototype.zip_length=null,Bn.prototype.user_length=null,Bn.prototype.__class__=Bn;var Ln=zpp_nape.util.ZPP_ContactList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Qn,this._invalidated=!0};Ln.__name__=["zpp_nape","util","ZPP_ContactList"],Ln.get=function(t,e){null==e&&(e=!1);var i=new B;return i.zpp_inner.inner=t,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},Ln.prototype.outer=null,Ln.prototype.inner=null,Ln.prototype.immutable=null,Ln.prototype._invalidated=null,Ln.prototype._invalidate=null,Ln.prototype._validate=null,Ln.prototype._modifiable=null,Ln.prototype.adder=null,Ln.prototype.post_adder=null,Ln.prototype.subber=null,Ln.prototype.dontremove=null,Ln.prototype.reverse_flag=null,Ln.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Ln.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Ln.prototype.modify_test=function(){},Ln.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Ln.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Ln.prototype.at_index=null,Ln.prototype.at_ite=null,Ln.prototype.push_ite=null,Ln.prototype.zip_length=null,Ln.prototype.user_length=null,Ln.prototype.__class__=Ln,(s=zpp_nape.util.ZPP_Math=function(){}).__name__=["zpp_nape","util","ZPP_Math"],s.sqrt=function(t){return Math.sqrt(t)},s.invsqrt=function(t){return 1/Math.sqrt(t)},s.sqr=function(t){return t*t},s.clamp2=function(t,e){var i=-e;return t<i?i:e<t?e:t},s.clamp=function(t,e,i){return t<e?e:i<t?i:t},s.prototype.__class__=s;var Rn=zpp_nape.util.ZPP_PubPool=function(){};Rn.__name__=["zpp_nape","util","ZPP_PubPool"],Rn.prototype.__class__=Rn;var Fn=zpp_nape.util.ZPP_Set_ZPP_Body=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};Fn.__name__=["zpp_nape","util","ZPP_Set_ZPP_Body"],Fn.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},Fn.prototype.alloc=function(){},Fn.prototype.lt=null,Fn.prototype.swapped=null,Fn.prototype.data=null,Fn.prototype.prev=null,Fn.prototype.next=null,Fn.prototype.parent=null,Fn.prototype.colour=null,Fn.prototype.verify=function(){if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var e=t.data,i=!0;if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var r=n.data;if(i){if(e==r)i=!1;else if(!this.lt(r,e)&&this.lt(e,r))return!1}else if(!this.lt(e,r)&&this.lt(r,e))return!1;if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return!0},Fn.prototype.empty=function(){return null==this.parent},Fn.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},Fn.prototype.size=function(){var t=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;)if(++t,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}return t},Fn.prototype.has=function(t){return null!=this.find(t)},Fn.prototype.find=function(t){for(var e=this.parent;null!=e&&e.data!=t;)e=this.lt(t,e.data)?e.prev:e.next;return e},Fn.prototype.has_weak=function(t){return null!=this.find_weak(t)},Fn.prototype.find_weak=function(t){for(var e=this.parent;null!=e;)if(this.lt(t,e.data))e=e.prev;else{if(!this.lt(e.data,t))break;e=e.next}return e},Fn.prototype.lower_bound=function(t){var e=null;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var n=i.data;if(!this.lt(n,t)){e=n;break}if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}return e},Fn.prototype.first=function(){for(var t=this.parent;null!=t.prev;)t=t.prev;return t.data},Fn.prototype.pop_front=function(){for(var t=this.parent;null!=t.prev;)t=t.prev;var e=t.data;return this.remove_node(t),e},Fn.prototype.remove=function(t){this.remove_node(this.find(t))},Fn.prototype.successor_node=function(t){if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{var e=t;for(t=t.parent;null!=t&&t.prev!=e;)t=(e=t).parent}return t},Fn.prototype.predecessor_node=function(t){if(null!=t.prev)for(t=t.prev;null!=t.next;)t=t.next;else{var e=t;for(t=t.parent;null!=t&&t.next!=e;)t=(e=t).parent}return t},Fn.prototype.successor=function(t){t=this.successor_node(this.find(t));return null==t?null:t.data},Fn.prototype.predecessor=function(t){t=this.predecessor_node(this.find(t));return null==t?null:t.data},Fn.prototype.remove_node=function(t){if(null!=t.next&&null!=t.prev){for(var e=t.next;null!=e.prev;)e=e.prev;var i=t.data;t.data=e.data,e.data=i,null!=this.swapped&&this.swapped(t.data,e.data),t=e}var n=null==t.prev?t.next:t.prev;if(1==t.colour)if(null!=t.prev||null!=t.next)n.colour=1;else if(null!=t.parent)for(var r=t.parent;;){r.colour++,r.prev.colour--,r.next.colour--;var s=r.prev;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}s=r.next;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}if(2==r.colour){if(null!=r.parent){r=r.parent;continue}r.colour=1}break}i=t.parent;null==i?this.parent=n:i.prev==t?i.prev=n:i.next=n,null!=n&&(n.parent=i),t.parent=t.prev=t.next=null;t.data=null,t.lt=null,t.swapped=null,t.next=Fn.zpp_pool,Fn.zpp_pool=t},Fn.prototype.clear=function(){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;)i=null!=i.prev?i.prev:null!=i.next?i.next:(null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=Fn.zpp_pool,Fn.zpp_pool=e,t);this.parent=null}},Fn.prototype.clear_with=function(t){if(null!=this.parent){for(var e,i,n=this.parent;null!=n;)n=null!=n.prev?n.prev:null!=n.next?n.next:(t(n.data),null!=(e=n.parent)&&(n==e.prev?e.prev=null:e.next=null,n.parent=null),(i=n).data=null,i.lt=null,i.swapped=null,i.next=Fn.zpp_pool,Fn.zpp_pool=i,e);this.parent=null}},Fn.prototype.clear_node=function(t,e){e(t.data);e=t.parent;return null!=e&&(t==e.prev?e.prev=null:e.next=null,t.parent=null),t.data=null,t.lt=null,t.swapped=null,t.next=Fn.zpp_pool,Fn.zpp_pool=t,e},Fn.prototype.__fix_neg_red=function(t){var e,i,n,r,s=t.parent,o=s.prev==t?(r=t.prev,e=(n=t.next).prev,i=n.next,r.colour=0,t.colour=s.colour=1,null!=(t.next=e)&&(e.parent=t),e=s.data,s.data=n.data,n.data=e,null!=this.swapped&&this.swapped(s.data,n.data),null!=(n.prev=i)&&(i.parent=n),n.next=s.next,null!=s.next&&(s.next.parent=n),null!=(s.next=n)&&(n.parent=s),r):(o=t.next,n=(i=t.prev).next,r=i.prev,o.colour=0,t.colour=s.colour=1,null!=(t.prev=n)&&(n.parent=t),t=s.data,s.data=i.data,i.data=t,null!=this.swapped&&this.swapped(s.data,i.data),null!=(i.next=r)&&(r.parent=i),i.prev=s.prev,null!=s.prev&&(s.prev.parent=i),null!=(s.prev=i)&&(i.parent=s),o);null!=o.prev&&0==o.prev.colour?this.__fix_dbl_red(o.prev):null!=o.next&&0==o.next.colour&&this.__fix_dbl_red(o.next)},Fn.prototype.__fix_dbl_red=function(t){for(;;){var e,i,n,r,s,o,a,l=t.parent,p=l.parent;if(null==p){l.colour=1;break}l==p.prev?(a=(n=p).next,o=t==l.prev?(i=l,r=(e=t).prev,s=t.next,l.next):(i=t,r=(e=l).prev,s=t.prev,t.next)):(r=(e=p).prev,a=t==l.prev?(n=l,s=(i=t).prev,o=t.next,l.next):(n=t,s=(i=l).prev,o=t.prev,t.next));l=p.parent;if(null==l?this.parent=i:l.prev==p?l.prev=i:l.next=i,null!=i&&(i.parent=l),null!=(e.prev=r)&&(r.parent=e),null!=(e.next=s)&&(s.parent=e),null!=(i.prev=e)&&(e.parent=i),null!=(i.next=n)&&(n.parent=i),null!=(n.prev=o)&&(o.parent=n),null!=(n.next=a)&&(a.parent=n),i.colour=p.colour-1,e.colour=1,n.colour=1,i==this.parent)this.parent.colour=1;else if(0==i.colour&&0==i.parent.colour){t=i;continue}break}},Fn.prototype.try_insert_bool=function(t){var e=null,i=null;if(null==this.parent)null==Fn.zpp_pool?e=new Fn:(e=Fn.zpp_pool,Fn.zpp_pool=e.next,e.next=null),e.data=t,this.parent=e;else for(i=this.parent;;)if(this.lt(t,i.data)){if(null==i.prev){null==Fn.zpp_pool?e=new Fn:(e=Fn.zpp_pool,Fn.zpp_pool=e.next,e.next=null),e.data=t,(i.prev=e).parent=i;break}i=i.prev}else{if(!this.lt(i.data,t))break;if(null==i.next){null==Fn.zpp_pool?e=new Fn:(e=Fn.zpp_pool,Fn.zpp_pool=e.next,e.next=null),e.data=t,(i.next=e).parent=i;break}i=i.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),!0)},Fn.prototype.try_insert=function(t){var e=null,i=null;if(null==this.parent)null==Fn.zpp_pool?e=new Fn:(e=Fn.zpp_pool,Fn.zpp_pool=e.next,e.next=null),e.data=t,this.parent=e;else for(i=this.parent;;)if(this.lt(t,i.data)){if(null==i.prev){null==Fn.zpp_pool?e=new Fn:(e=Fn.zpp_pool,Fn.zpp_pool=e.next,e.next=null),e.data=t,(i.prev=e).parent=i;break}i=i.prev}else{if(!this.lt(i.data,t))break;if(null==i.next){null==Fn.zpp_pool?e=new Fn:(e=Fn.zpp_pool,Fn.zpp_pool=e.next,e.next=null),e.data=t,(i.next=e).parent=i;break}i=i.next}return null==e?i:(null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),e)},Fn.prototype.insert=function(t){var e;if(null==Fn.zpp_pool?e=new Fn:(e=Fn.zpp_pool,Fn.zpp_pool=e.next,e.next=null),e.data=t,null==this.parent)this.parent=e;else for(var i=this.parent;;)if(this.lt(e.data,i.data)){if(null==i.prev){(i.prev=e).parent=i;break}i=i.prev}else{if(null==i.next){(i.next=e).parent=i;break}i=i.next}return null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),e},Fn.prototype.__class__=Fn;var jn=zpp_nape.util.ZPP_Set_ZPP_CbSetPair=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};jn.__name__=["zpp_nape","util","ZPP_Set_ZPP_CbSetPair"],jn.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},jn.prototype.alloc=function(){},jn.prototype.lt=null,jn.prototype.swapped=null,jn.prototype.data=null,jn.prototype.prev=null,jn.prototype.next=null,jn.prototype.parent=null,jn.prototype.colour=null,jn.prototype.verify=function(){if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var e=t.data,i=!0;if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var r=n.data;if(i){if(e==r)i=!1;else if(!this.lt(r,e)&&this.lt(e,r))return!1}else if(!this.lt(e,r)&&this.lt(r,e))return!1;if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return!0},jn.prototype.empty=function(){return null==this.parent},jn.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},jn.prototype.size=function(){var t=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;)if(++t,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}return t},jn.prototype.has=function(t){return null!=this.find(t)},jn.prototype.find=function(t){for(var e=this.parent;null!=e&&e.data!=t;)e=this.lt(t,e.data)?e.prev:e.next;return e},jn.prototype.has_weak=function(t){return null!=this.find_weak(t)},jn.prototype.find_weak=function(t){for(var e=this.parent;null!=e;)if(this.lt(t,e.data))e=e.prev;else{if(!this.lt(e.data,t))break;e=e.next}return e},jn.prototype.lower_bound=function(t){var e=null;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var n=i.data;if(!this.lt(n,t)){e=n;break}if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}return e},jn.prototype.first=function(){for(var t=this.parent;null!=t.prev;)t=t.prev;return t.data},jn.prototype.pop_front=function(){for(var t=this.parent;null!=t.prev;)t=t.prev;var e=t.data;return this.remove_node(t),e},jn.prototype.remove=function(t){this.remove_node(this.find(t))},jn.prototype.successor_node=function(t){if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{var e=t;for(t=t.parent;null!=t&&t.prev!=e;)t=(e=t).parent}return t},jn.prototype.predecessor_node=function(t){if(null!=t.prev)for(t=t.prev;null!=t.next;)t=t.next;else{var e=t;for(t=t.parent;null!=t&&t.next!=e;)t=(e=t).parent}return t},jn.prototype.successor=function(t){t=this.successor_node(this.find(t));return null==t?null:t.data},jn.prototype.predecessor=function(t){t=this.predecessor_node(this.find(t));return null==t?null:t.data},jn.prototype.remove_node=function(t){if(null!=t.next&&null!=t.prev){for(var e=t.next;null!=e.prev;)e=e.prev;var i=t.data;t.data=e.data,e.data=i,null!=this.swapped&&this.swapped(t.data,e.data),t=e}var n=null==t.prev?t.next:t.prev;if(1==t.colour)if(null!=t.prev||null!=t.next)n.colour=1;else if(null!=t.parent)for(var r=t.parent;;){r.colour++,r.prev.colour--,r.next.colour--;var s=r.prev;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}s=r.next;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}if(2==r.colour){if(null!=r.parent){r=r.parent;continue}r.colour=1}break}i=t.parent;null==i?this.parent=n:i.prev==t?i.prev=n:i.next=n,null!=n&&(n.parent=i),t.parent=t.prev=t.next=null;t.data=null,t.lt=null,t.swapped=null,t.next=jn.zpp_pool,jn.zpp_pool=t},jn.prototype.clear=function(){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;)i=null!=i.prev?i.prev:null!=i.next?i.next:(null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=jn.zpp_pool,jn.zpp_pool=e,t);this.parent=null}},jn.prototype.clear_with=function(t){if(null!=this.parent){for(var e,i,n=this.parent;null!=n;)n=null!=n.prev?n.prev:null!=n.next?n.next:(t(n.data),null!=(e=n.parent)&&(n==e.prev?e.prev=null:e.next=null,n.parent=null),(i=n).data=null,i.lt=null,i.swapped=null,i.next=jn.zpp_pool,jn.zpp_pool=i,e);this.parent=null}},jn.prototype.clear_node=function(t,e){e(t.data);e=t.parent;return null!=e&&(t==e.prev?e.prev=null:e.next=null,t.parent=null),t.data=null,t.lt=null,t.swapped=null,t.next=jn.zpp_pool,jn.zpp_pool=t,e},jn.prototype.__fix_neg_red=function(t){var e,i,n,r,s=t.parent,o=s.prev==t?(r=t.prev,e=(n=t.next).prev,i=n.next,r.colour=0,t.colour=s.colour=1,null!=(t.next=e)&&(e.parent=t),e=s.data,s.data=n.data,n.data=e,null!=this.swapped&&this.swapped(s.data,n.data),null!=(n.prev=i)&&(i.parent=n),n.next=s.next,null!=s.next&&(s.next.parent=n),null!=(s.next=n)&&(n.parent=s),r):(o=t.next,n=(i=t.prev).next,r=i.prev,o.colour=0,t.colour=s.colour=1,null!=(t.prev=n)&&(n.parent=t),t=s.data,s.data=i.data,i.data=t,null!=this.swapped&&this.swapped(s.data,i.data),null!=(i.next=r)&&(r.parent=i),i.prev=s.prev,null!=s.prev&&(s.prev.parent=i),null!=(s.prev=i)&&(i.parent=s),o);null!=o.prev&&0==o.prev.colour?this.__fix_dbl_red(o.prev):null!=o.next&&0==o.next.colour&&this.__fix_dbl_red(o.next)},jn.prototype.__fix_dbl_red=function(t){for(;;){var e,i,n,r,s,o,a,l=t.parent,p=l.parent;if(null==p){l.colour=1;break}l==p.prev?(a=(n=p).next,o=t==l.prev?(i=l,r=(e=t).prev,s=t.next,l.next):(i=t,r=(e=l).prev,s=t.prev,t.next)):(r=(e=p).prev,a=t==l.prev?(n=l,s=(i=t).prev,o=t.next,l.next):(n=t,s=(i=l).prev,o=t.prev,t.next));l=p.parent;if(null==l?this.parent=i:l.prev==p?l.prev=i:l.next=i,null!=i&&(i.parent=l),null!=(e.prev=r)&&(r.parent=e),null!=(e.next=s)&&(s.parent=e),null!=(i.prev=e)&&(e.parent=i),null!=(i.next=n)&&(n.parent=i),null!=(n.prev=o)&&(o.parent=n),null!=(n.next=a)&&(a.parent=n),i.colour=p.colour-1,e.colour=1,n.colour=1,i==this.parent)this.parent.colour=1;else if(0==i.colour&&0==i.parent.colour){t=i;continue}break}},jn.prototype.try_insert_bool=function(t){var e=null,i=null;if(null==this.parent)null==jn.zpp_pool?e=new jn:(e=jn.zpp_pool,jn.zpp_pool=e.next,e.next=null),e.data=t,this.parent=e;else for(i=this.parent;;)if(this.lt(t,i.data)){if(null==i.prev){null==jn.zpp_pool?e=new jn:(e=jn.zpp_pool,jn.zpp_pool=e.next,e.next=null),e.data=t,(i.prev=e).parent=i;break}i=i.prev}else{if(!this.lt(i.data,t))break;if(null==i.next){null==jn.zpp_pool?e=new jn:(e=jn.zpp_pool,jn.zpp_pool=e.next,e.next=null),e.data=t,(i.next=e).parent=i;break}i=i.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),!0)},jn.prototype.try_insert=function(t){var e=null,i=null;if(null==this.parent)null==jn.zpp_pool?e=new jn:(e=jn.zpp_pool,jn.zpp_pool=e.next,e.next=null),e.data=t,this.parent=e;else for(i=this.parent;;)if(this.lt(t,i.data)){if(null==i.prev){null==jn.zpp_pool?e=new jn:(e=jn.zpp_pool,jn.zpp_pool=e.next,e.next=null),e.data=t,(i.prev=e).parent=i;break}i=i.prev}else{if(!this.lt(i.data,t))break;if(null==i.next){null==jn.zpp_pool?e=new jn:(e=jn.zpp_pool,jn.zpp_pool=e.next,e.next=null),e.data=t,(i.next=e).parent=i;break}i=i.next}return null==e?i:(null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),e)},jn.prototype.insert=function(t){var e;if(null==jn.zpp_pool?e=new jn:(e=jn.zpp_pool,jn.zpp_pool=e.next,e.next=null),e.data=t,null==this.parent)this.parent=e;else for(var i=this.parent;;)if(this.lt(e.data,i.data)){if(null==i.prev){(i.prev=e).parent=i;break}i=i.prev}else{if(null==i.next){(i.next=e).parent=i;break}i=i.next}return null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),e},jn.prototype.__class__=jn;var Nn=zpp_nape.util.ZPP_Set_ZPP_PartitionVertex=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};Nn.__name__=["zpp_nape","util","ZPP_Set_ZPP_PartitionVertex"],Nn.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},Nn.prototype.alloc=function(){},Nn.prototype.lt=null,Nn.prototype.swapped=null,Nn.prototype.data=null,Nn.prototype.prev=null,Nn.prototype.next=null,Nn.prototype.parent=null,Nn.prototype.colour=null,Nn.prototype.verify=function(){if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var e=t.data,i=!0;if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var r=n.data;if(i){if(e==r)i=!1;else if(!this.lt(r,e)&&this.lt(e,r))return!1}else if(!this.lt(e,r)&&this.lt(r,e))return!1;if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return!0},Nn.prototype.empty=function(){return null==this.parent},Nn.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},Nn.prototype.size=function(){var t=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;)if(++t,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}return t},Nn.prototype.has=function(t){return null!=this.find(t)},Nn.prototype.find=function(t){for(var e=this.parent;null!=e&&e.data!=t;)e=this.lt(t,e.data)?e.prev:e.next;return e},Nn.prototype.has_weak=function(t){return null!=this.find_weak(t)},Nn.prototype.find_weak=function(t){for(var e=this.parent;null!=e;)if(this.lt(t,e.data))e=e.prev;else{if(!this.lt(e.data,t))break;e=e.next}return e},Nn.prototype.lower_bound=function(t){var e=null;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var n=i.data;if(!this.lt(n,t)){e=n;break}if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}return e},Nn.prototype.first=function(){for(var t=this.parent;null!=t.prev;)t=t.prev;return t.data},Nn.prototype.pop_front=function(){for(var t=this.parent;null!=t.prev;)t=t.prev;var e=t.data;return this.remove_node(t),e},Nn.prototype.remove=function(t){this.remove_node(this.find(t))},Nn.prototype.successor_node=function(t){if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{var e=t;for(t=t.parent;null!=t&&t.prev!=e;)t=(e=t).parent}return t},Nn.prototype.predecessor_node=function(t){if(null!=t.prev)for(t=t.prev;null!=t.next;)t=t.next;else{var e=t;for(t=t.parent;null!=t&&t.next!=e;)t=(e=t).parent}return t},Nn.prototype.successor=function(t){t=this.successor_node(this.find(t));return null==t?null:t.data},Nn.prototype.predecessor=function(t){t=this.predecessor_node(this.find(t));return null==t?null:t.data},Nn.prototype.remove_node=function(t){if(null!=t.next&&null!=t.prev){for(var e=t.next;null!=e.prev;)e=e.prev;var i=t.data;t.data=e.data,e.data=i,null!=this.swapped&&this.swapped(t.data,e.data),t=e}var n=null==t.prev?t.next:t.prev;if(1==t.colour)if(null!=t.prev||null!=t.next)n.colour=1;else if(null!=t.parent)for(var r=t.parent;;){r.colour++,r.prev.colour--,r.next.colour--;var s=r.prev;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}s=r.next;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}if(2==r.colour){if(null!=r.parent){r=r.parent;continue}r.colour=1}break}i=t.parent;null==i?this.parent=n:i.prev==t?i.prev=n:i.next=n,null!=n&&(n.parent=i),t.parent=t.prev=t.next=null;t.data=null,t.lt=null,t.swapped=null,t.next=Nn.zpp_pool,Nn.zpp_pool=t},Nn.prototype.clear=function(){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;)i=null!=i.prev?i.prev:null!=i.next?i.next:(null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=Nn.zpp_pool,Nn.zpp_pool=e,t);this.parent=null}},Nn.prototype.clear_with=function(t){if(null!=this.parent){for(var e,i,n=this.parent;null!=n;)n=null!=n.prev?n.prev:null!=n.next?n.next:(t(n.data),null!=(e=n.parent)&&(n==e.prev?e.prev=null:e.next=null,n.parent=null),(i=n).data=null,i.lt=null,i.swapped=null,i.next=Nn.zpp_pool,Nn.zpp_pool=i,e);this.parent=null}},Nn.prototype.clear_node=function(t,e){e(t.data);e=t.parent;return null!=e&&(t==e.prev?e.prev=null:e.next=null,t.parent=null),t.data=null,t.lt=null,t.swapped=null,t.next=Nn.zpp_pool,Nn.zpp_pool=t,e},Nn.prototype.__fix_neg_red=function(t){var e,i,n,r,s=t.parent,o=s.prev==t?(r=t.prev,e=(n=t.next).prev,i=n.next,r.colour=0,t.colour=s.colour=1,null!=(t.next=e)&&(e.parent=t),e=s.data,s.data=n.data,n.data=e,null!=this.swapped&&this.swapped(s.data,n.data),null!=(n.prev=i)&&(i.parent=n),n.next=s.next,null!=s.next&&(s.next.parent=n),null!=(s.next=n)&&(n.parent=s),r):(o=t.next,n=(i=t.prev).next,r=i.prev,o.colour=0,t.colour=s.colour=1,null!=(t.prev=n)&&(n.parent=t),t=s.data,s.data=i.data,i.data=t,null!=this.swapped&&this.swapped(s.data,i.data),null!=(i.next=r)&&(r.parent=i),i.prev=s.prev,null!=s.prev&&(s.prev.parent=i),null!=(s.prev=i)&&(i.parent=s),o);null!=o.prev&&0==o.prev.colour?this.__fix_dbl_red(o.prev):null!=o.next&&0==o.next.colour&&this.__fix_dbl_red(o.next)},Nn.prototype.__fix_dbl_red=function(t){for(;;){var e,i,n,r,s,o,a,l=t.parent,p=l.parent;if(null==p){l.colour=1;break}l==p.prev?(a=(n=p).next,o=t==l.prev?(i=l,r=(e=t).prev,s=t.next,l.next):(i=t,r=(e=l).prev,s=t.prev,t.next)):(r=(e=p).prev,a=t==l.prev?(n=l,s=(i=t).prev,o=t.next,l.next):(n=t,s=(i=l).prev,o=t.prev,t.next));l=p.parent;if(null==l?this.parent=i:l.prev==p?l.prev=i:l.next=i,null!=i&&(i.parent=l),null!=(e.prev=r)&&(r.parent=e),null!=(e.next=s)&&(s.parent=e),null!=(i.prev=e)&&(e.parent=i),null!=(i.next=n)&&(n.parent=i),null!=(n.prev=o)&&(o.parent=n),null!=(n.next=a)&&(a.parent=n),i.colour=p.colour-1,e.colour=1,n.colour=1,i==this.parent)this.parent.colour=1;else if(0==i.colour&&0==i.parent.colour){t=i;continue}break}},Nn.prototype.try_insert_bool=function(t){var e=null,i=null;if(null==this.parent)null==Nn.zpp_pool?e=new Nn:(e=Nn.zpp_pool,Nn.zpp_pool=e.next,e.next=null),e.data=t,this.parent=e;else for(i=this.parent;;)if(this.lt(t,i.data)){if(null==i.prev){null==Nn.zpp_pool?e=new Nn:(e=Nn.zpp_pool,Nn.zpp_pool=e.next,e.next=null),e.data=t,(i.prev=e).parent=i;break}i=i.prev}else{if(!this.lt(i.data,t))break;if(null==i.next){null==Nn.zpp_pool?e=new Nn:(e=Nn.zpp_pool,Nn.zpp_pool=e.next,e.next=null),e.data=t,(i.next=e).parent=i;break}i=i.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),!0)},Nn.prototype.try_insert=function(t){var e=null,i=null;if(null==this.parent)null==Nn.zpp_pool?e=new Nn:(e=Nn.zpp_pool,Nn.zpp_pool=e.next,e.next=null),e.data=t,this.parent=e;else for(i=this.parent;;)if(this.lt(t,i.data)){if(null==i.prev){null==Nn.zpp_pool?e=new Nn:(e=Nn.zpp_pool,Nn.zpp_pool=e.next,e.next=null),e.data=t,(i.prev=e).parent=i;break}i=i.prev}else{if(!this.lt(i.data,t))break;if(null==i.next){null==Nn.zpp_pool?e=new Nn:(e=Nn.zpp_pool,Nn.zpp_pool=e.next,e.next=null),e.data=t,(i.next=e).parent=i;break}i=i.next}return null==e?i:(null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),e)},Nn.prototype.insert=function(t){var e;if(null==Nn.zpp_pool?e=new Nn:(e=Nn.zpp_pool,Nn.zpp_pool=e.next,e.next=null),e.data=t,null==this.parent)this.parent=e;else for(var i=this.parent;;)if(this.lt(e.data,i.data)){if(null==i.prev){(i.prev=e).parent=i;break}i=i.prev}else{if(null==i.next){(i.next=e).parent=i;break}i=i.next}return null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),e},Nn.prototype.__class__=Nn;var Gn=zpp_nape.util.ZPP_Set_ZPP_PartitionPair=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};Gn.__name__=["zpp_nape","util","ZPP_Set_ZPP_PartitionPair"],Gn.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},Gn.prototype.alloc=function(){},Gn.prototype.lt=null,Gn.prototype.swapped=null,Gn.prototype.data=null,Gn.prototype.prev=null,Gn.prototype.next=null,Gn.prototype.parent=null,Gn.prototype.colour=null,Gn.prototype.verify=function(){if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var e=t.data,i=!0;if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var r=n.data;if(i){if(e==r)i=!1;else if(!this.lt(r,e)&&this.lt(e,r))return!1}else if(!this.lt(e,r)&&this.lt(r,e))return!1;if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return!0},Gn.prototype.empty=function(){return null==this.parent},Gn.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},Gn.prototype.size=function(){var t=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;)if(++t,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}return t},Gn.prototype.has=function(t){return null!=this.find(t)},Gn.prototype.find=function(t){for(var e=this.parent;null!=e&&e.data!=t;)e=this.lt(t,e.data)?e.prev:e.next;return e},Gn.prototype.has_weak=function(t){return null!=this.find_weak(t)},Gn.prototype.find_weak=function(t){for(var e=this.parent;null!=e;)if(this.lt(t,e.data))e=e.prev;else{if(!this.lt(e.data,t))break;e=e.next}return e},Gn.prototype.lower_bound=function(t){var e=null;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var n=i.data;if(!this.lt(n,t)){e=n;break}if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}return e},Gn.prototype.first=function(){for(var t=this.parent;null!=t.prev;)t=t.prev;return t.data},Gn.prototype.pop_front=function(){for(var t=this.parent;null!=t.prev;)t=t.prev;var e=t.data;return this.remove_node(t),e},Gn.prototype.remove=function(t){this.remove_node(this.find(t))},Gn.prototype.successor_node=function(t){if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{var e=t;for(t=t.parent;null!=t&&t.prev!=e;)t=(e=t).parent}return t},Gn.prototype.predecessor_node=function(t){if(null!=t.prev)for(t=t.prev;null!=t.next;)t=t.next;else{var e=t;for(t=t.parent;null!=t&&t.next!=e;)t=(e=t).parent}return t},Gn.prototype.successor=function(t){t=this.successor_node(this.find(t));return null==t?null:t.data},Gn.prototype.predecessor=function(t){t=this.predecessor_node(this.find(t));return null==t?null:t.data},Gn.prototype.remove_node=function(t){if(null!=t.next&&null!=t.prev){for(var e=t.next;null!=e.prev;)e=e.prev;var i=t.data;t.data=e.data,e.data=i,null!=this.swapped&&this.swapped(t.data,e.data),t=e}var n=null==t.prev?t.next:t.prev;if(1==t.colour)if(null!=t.prev||null!=t.next)n.colour=1;else if(null!=t.parent)for(var r=t.parent;;){r.colour++,r.prev.colour--,r.next.colour--;var s=r.prev;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}s=r.next;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}if(2==r.colour){if(null!=r.parent){r=r.parent;continue}r.colour=1}break}i=t.parent;null==i?this.parent=n:i.prev==t?i.prev=n:i.next=n,null!=n&&(n.parent=i),t.parent=t.prev=t.next=null;t.data=null,t.lt=null,t.swapped=null,t.next=Gn.zpp_pool,Gn.zpp_pool=t},Gn.prototype.clear=function(){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;)i=null!=i.prev?i.prev:null!=i.next?i.next:(null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=Gn.zpp_pool,Gn.zpp_pool=e,t);this.parent=null}},Gn.prototype.clear_with=function(t){if(null!=this.parent){for(var e,i,n=this.parent;null!=n;)n=null!=n.prev?n.prev:null!=n.next?n.next:(t(n.data),null!=(e=n.parent)&&(n==e.prev?e.prev=null:e.next=null,n.parent=null),(i=n).data=null,i.lt=null,i.swapped=null,i.next=Gn.zpp_pool,Gn.zpp_pool=i,e);this.parent=null}},Gn.prototype.clear_node=function(t,e){e(t.data);e=t.parent;return null!=e&&(t==e.prev?e.prev=null:e.next=null,t.parent=null),t.data=null,t.lt=null,t.swapped=null,t.next=Gn.zpp_pool,Gn.zpp_pool=t,e},Gn.prototype.__fix_neg_red=function(t){var e,i,n,r,s=t.parent,o=s.prev==t?(r=t.prev,e=(n=t.next).prev,i=n.next,r.colour=0,t.colour=s.colour=1,null!=(t.next=e)&&(e.parent=t),e=s.data,s.data=n.data,n.data=e,null!=this.swapped&&this.swapped(s.data,n.data),null!=(n.prev=i)&&(i.parent=n),n.next=s.next,null!=s.next&&(s.next.parent=n),null!=(s.next=n)&&(n.parent=s),r):(o=t.next,n=(i=t.prev).next,r=i.prev,o.colour=0,t.colour=s.colour=1,null!=(t.prev=n)&&(n.parent=t),t=s.data,s.data=i.data,i.data=t,null!=this.swapped&&this.swapped(s.data,i.data),null!=(i.next=r)&&(r.parent=i),i.prev=s.prev,null!=s.prev&&(s.prev.parent=i),null!=(s.prev=i)&&(i.parent=s),o);null!=o.prev&&0==o.prev.colour?this.__fix_dbl_red(o.prev):null!=o.next&&0==o.next.colour&&this.__fix_dbl_red(o.next)},Gn.prototype.__fix_dbl_red=function(t){for(;;){var e,i,n,r,s,o,a,l=t.parent,p=l.parent;if(null==p){l.colour=1;break}l==p.prev?(a=(n=p).next,o=t==l.prev?(i=l,r=(e=t).prev,s=t.next,l.next):(i=t,r=(e=l).prev,s=t.prev,t.next)):(r=(e=p).prev,a=t==l.prev?(n=l,s=(i=t).prev,o=t.next,l.next):(n=t,s=(i=l).prev,o=t.prev,t.next));l=p.parent;if(null==l?this.parent=i:l.prev==p?l.prev=i:l.next=i,null!=i&&(i.parent=l),null!=(e.prev=r)&&(r.parent=e),null!=(e.next=s)&&(s.parent=e),null!=(i.prev=e)&&(e.parent=i),null!=(i.next=n)&&(n.parent=i),null!=(n.prev=o)&&(o.parent=n),null!=(n.next=a)&&(a.parent=n),i.colour=p.colour-1,e.colour=1,n.colour=1,i==this.parent)this.parent.colour=1;else if(0==i.colour&&0==i.parent.colour){t=i;continue}break}},Gn.prototype.try_insert_bool=function(t){var e=null,i=null;if(null==this.parent)null==Gn.zpp_pool?e=new Gn:(e=Gn.zpp_pool,Gn.zpp_pool=e.next,e.next=null),e.data=t,this.parent=e;else for(i=this.parent;;)if(this.lt(t,i.data)){if(null==i.prev){null==Gn.zpp_pool?e=new Gn:(e=Gn.zpp_pool,Gn.zpp_pool=e.next,e.next=null),e.data=t,(i.prev=e).parent=i;break}i=i.prev}else{if(!this.lt(i.data,t))break;if(null==i.next){null==Gn.zpp_pool?e=new Gn:(e=Gn.zpp_pool,Gn.zpp_pool=e.next,e.next=null),e.data=t,(i.next=e).parent=i;break}i=i.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),!0)},Gn.prototype.try_insert=function(t){var e=null,i=null;if(null==this.parent)null==Gn.zpp_pool?e=new Gn:(e=Gn.zpp_pool,Gn.zpp_pool=e.next,e.next=null),e.data=t,this.parent=e;else for(i=this.parent;;)if(this.lt(t,i.data)){if(null==i.prev){null==Gn.zpp_pool?e=new Gn:(e=Gn.zpp_pool,Gn.zpp_pool=e.next,e.next=null),e.data=t,(i.prev=e).parent=i;break}i=i.prev}else{if(!this.lt(i.data,t))break;if(null==i.next){null==Gn.zpp_pool?e=new Gn:(e=Gn.zpp_pool,Gn.zpp_pool=e.next,e.next=null),e.data=t,(i.next=e).parent=i;break}i=i.next}return null==e?i:(null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),e)},Gn.prototype.insert=function(t){var e;if(null==Gn.zpp_pool?e=new Gn:(e=Gn.zpp_pool,Gn.zpp_pool=e.next,e.next=null),e.data=t,null==this.parent)this.parent=e;else for(var i=this.parent;;)if(this.lt(e.data,i.data)){if(null==i.prev){(i.prev=e).parent=i;break}i=i.prev}else{if(null==i.next){(i.next=e).parent=i;break}i=i.next}return null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),e},Gn.prototype.__class__=Gn;var Un=zpp_nape.util.ZPP_Set_ZPP_SimpleVert=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};Un.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleVert"],Un.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},Un.prototype.alloc=function(){},Un.prototype.lt=null,Un.prototype.swapped=null,Un.prototype.data=null,Un.prototype.prev=null,Un.prototype.next=null,Un.prototype.parent=null,Un.prototype.colour=null,Un.prototype.verify=function(){if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var e=t.data,i=!0;if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var r=n.data;if(i){if(e==r)i=!1;else if(!this.lt(r,e)&&this.lt(e,r))return!1}else if(!this.lt(e,r)&&this.lt(r,e))return!1;if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return!0},Un.prototype.empty=function(){return null==this.parent},Un.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},Un.prototype.size=function(){var t=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;)if(++t,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}return t},Un.prototype.has=function(t){return null!=this.find(t)},Un.prototype.find=function(t){for(var e=this.parent;null!=e&&e.data!=t;)e=this.lt(t,e.data)?e.prev:e.next;return e},Un.prototype.has_weak=function(t){return null!=this.find_weak(t)},Un.prototype.find_weak=function(t){for(var e=this.parent;null!=e;)if(this.lt(t,e.data))e=e.prev;else{if(!this.lt(e.data,t))break;e=e.next}return e},Un.prototype.lower_bound=function(t){var e=null;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var n=i.data;if(!this.lt(n,t)){e=n;break}if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}return e},Un.prototype.first=function(){for(var t=this.parent;null!=t.prev;)t=t.prev;return t.data},Un.prototype.pop_front=function(){for(var t=this.parent;null!=t.prev;)t=t.prev;var e=t.data;return this.remove_node(t),e},Un.prototype.remove=function(t){this.remove_node(this.find(t))},Un.prototype.successor_node=function(t){if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{var e=t;for(t=t.parent;null!=t&&t.prev!=e;)t=(e=t).parent}return t},Un.prototype.predecessor_node=function(t){if(null!=t.prev)for(t=t.prev;null!=t.next;)t=t.next;else{var e=t;for(t=t.parent;null!=t&&t.next!=e;)t=(e=t).parent}return t},Un.prototype.successor=function(t){t=this.successor_node(this.find(t));return null==t?null:t.data},Un.prototype.predecessor=function(t){t=this.predecessor_node(this.find(t));return null==t?null:t.data},Un.prototype.remove_node=function(t){if(null!=t.next&&null!=t.prev){for(var e=t.next;null!=e.prev;)e=e.prev;var i=t.data;t.data=e.data,e.data=i,null!=this.swapped&&this.swapped(t.data,e.data),t=e}var n=null==t.prev?t.next:t.prev;if(1==t.colour)if(null!=t.prev||null!=t.next)n.colour=1;else if(null!=t.parent)for(var r=t.parent;;){r.colour++,r.prev.colour--,r.next.colour--;var s=r.prev;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}s=r.next;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}if(2==r.colour){if(null!=r.parent){r=r.parent;continue}r.colour=1}break}i=t.parent;null==i?this.parent=n:i.prev==t?i.prev=n:i.next=n,null!=n&&(n.parent=i),t.parent=t.prev=t.next=null;t.data=null,t.lt=null,t.swapped=null,t.next=Un.zpp_pool,Un.zpp_pool=t},Un.prototype.clear=function(){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;)i=null!=i.prev?i.prev:null!=i.next?i.next:(null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=Un.zpp_pool,Un.zpp_pool=e,t);this.parent=null}},Un.prototype.clear_with=function(t){if(null!=this.parent){for(var e,i,n=this.parent;null!=n;)n=null!=n.prev?n.prev:null!=n.next?n.next:(t(n.data),null!=(e=n.parent)&&(n==e.prev?e.prev=null:e.next=null,n.parent=null),(i=n).data=null,i.lt=null,i.swapped=null,i.next=Un.zpp_pool,Un.zpp_pool=i,e);this.parent=null}},Un.prototype.clear_node=function(t,e){e(t.data);e=t.parent;return null!=e&&(t==e.prev?e.prev=null:e.next=null,t.parent=null),t.data=null,t.lt=null,t.swapped=null,t.next=Un.zpp_pool,Un.zpp_pool=t,e},Un.prototype.__fix_neg_red=function(t){var e,i,n,r,s=t.parent,o=s.prev==t?(r=t.prev,e=(n=t.next).prev,i=n.next,r.colour=0,t.colour=s.colour=1,null!=(t.next=e)&&(e.parent=t),e=s.data,s.data=n.data,n.data=e,null!=this.swapped&&this.swapped(s.data,n.data),null!=(n.prev=i)&&(i.parent=n),n.next=s.next,null!=s.next&&(s.next.parent=n),null!=(s.next=n)&&(n.parent=s),r):(o=t.next,n=(i=t.prev).next,r=i.prev,o.colour=0,t.colour=s.colour=1,null!=(t.prev=n)&&(n.parent=t),t=s.data,s.data=i.data,i.data=t,null!=this.swapped&&this.swapped(s.data,i.data),null!=(i.next=r)&&(r.parent=i),i.prev=s.prev,null!=s.prev&&(s.prev.parent=i),null!=(s.prev=i)&&(i.parent=s),o);null!=o.prev&&0==o.prev.colour?this.__fix_dbl_red(o.prev):null!=o.next&&0==o.next.colour&&this.__fix_dbl_red(o.next)},Un.prototype.__fix_dbl_red=function(t){for(;;){var e,i,n,r,s,o,a,l=t.parent,p=l.parent;if(null==p){l.colour=1;break}l==p.prev?(a=(n=p).next,o=t==l.prev?(i=l,r=(e=t).prev,s=t.next,l.next):(i=t,r=(e=l).prev,s=t.prev,t.next)):(r=(e=p).prev,a=t==l.prev?(n=l,s=(i=t).prev,o=t.next,l.next):(n=t,s=(i=l).prev,o=t.prev,t.next));l=p.parent;if(null==l?this.parent=i:l.prev==p?l.prev=i:l.next=i,null!=i&&(i.parent=l),null!=(e.prev=r)&&(r.parent=e),null!=(e.next=s)&&(s.parent=e),null!=(i.prev=e)&&(e.parent=i),null!=(i.next=n)&&(n.parent=i),null!=(n.prev=o)&&(o.parent=n),null!=(n.next=a)&&(a.parent=n),i.colour=p.colour-1,e.colour=1,n.colour=1,i==this.parent)this.parent.colour=1;else if(0==i.colour&&0==i.parent.colour){t=i;continue}break}},Un.prototype.try_insert_bool=function(t){var e=null,i=null;if(null==this.parent)null==Un.zpp_pool?e=new Un:(e=Un.zpp_pool,Un.zpp_pool=e.next,e.next=null),e.data=t,this.parent=e;else for(i=this.parent;;)if(this.lt(t,i.data)){if(null==i.prev){null==Un.zpp_pool?e=new Un:(e=Un.zpp_pool,Un.zpp_pool=e.next,e.next=null),e.data=t,(i.prev=e).parent=i;break}i=i.prev}else{if(!this.lt(i.data,t))break;if(null==i.next){null==Un.zpp_pool?e=new Un:(e=Un.zpp_pool,Un.zpp_pool=e.next,e.next=null),e.data=t,(i.next=e).parent=i;break}i=i.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),!0)},Un.prototype.try_insert=function(t){var e=null,i=null;if(null==this.parent)null==Un.zpp_pool?e=new Un:(e=Un.zpp_pool,Un.zpp_pool=e.next,e.next=null),e.data=t,this.parent=e;else for(i=this.parent;;)if(this.lt(t,i.data)){if(null==i.prev){null==Un.zpp_pool?e=new Un:(e=Un.zpp_pool,Un.zpp_pool=e.next,e.next=null),e.data=t,(i.prev=e).parent=i;break}i=i.prev}else{if(!this.lt(i.data,t))break;if(null==i.next){null==Un.zpp_pool?e=new Un:(e=Un.zpp_pool,Un.zpp_pool=e.next,e.next=null),e.data=t,(i.next=e).parent=i;break}i=i.next}return null==e?i:(null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),e)},Un.prototype.insert=function(t){var e;if(null==Un.zpp_pool?e=new Un:(e=Un.zpp_pool,Un.zpp_pool=e.next,e.next=null),e.data=t,null==this.parent)this.parent=e;else for(var i=this.parent;;)if(this.lt(e.data,i.data)){if(null==i.prev){(i.prev=e).parent=i;break}i=i.prev}else{if(null==i.next){(i.next=e).parent=i;break}i=i.next}return null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),e},Un.prototype.__class__=Un;var Xn=zpp_nape.util.ZPP_Set_ZPP_SimpleSeg=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};Xn.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleSeg"],Xn.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},Xn.prototype.alloc=function(){},Xn.prototype.lt=null,Xn.prototype.swapped=null,Xn.prototype.data=null,Xn.prototype.prev=null,Xn.prototype.next=null,Xn.prototype.parent=null,Xn.prototype.colour=null,Xn.prototype.verify=function(){if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var e=t.data,i=!0;if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var r=n.data;if(i){if(e==r)i=!1;else if(!this.lt(r,e)&&this.lt(e,r))return!1}else if(!this.lt(e,r)&&this.lt(r,e))return!1;if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return!0},Xn.prototype.empty=function(){return null==this.parent},Xn.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},Xn.prototype.size=function(){var t=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;)if(++t,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}return t},Xn.prototype.has=function(t){return null!=this.find(t)},Xn.prototype.find=function(t){for(var e=this.parent;null!=e&&e.data!=t;)e=this.lt(t,e.data)?e.prev:e.next;return e},Xn.prototype.has_weak=function(t){return null!=this.find_weak(t)},Xn.prototype.find_weak=function(t){for(var e=this.parent;null!=e;)if(this.lt(t,e.data))e=e.prev;else{if(!this.lt(e.data,t))break;e=e.next}return e},Xn.prototype.lower_bound=function(t){var e=null;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var n=i.data;if(!this.lt(n,t)){e=n;break}if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}return e},Xn.prototype.first=function(){for(var t=this.parent;null!=t.prev;)t=t.prev;return t.data},Xn.prototype.pop_front=function(){for(var t=this.parent;null!=t.prev;)t=t.prev;var e=t.data;return this.remove_node(t),e},Xn.prototype.remove=function(t){this.remove_node(this.find(t))},Xn.prototype.successor_node=function(t){if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{var e=t;for(t=t.parent;null!=t&&t.prev!=e;)t=(e=t).parent}return t},Xn.prototype.predecessor_node=function(t){if(null!=t.prev)for(t=t.prev;null!=t.next;)t=t.next;else{var e=t;for(t=t.parent;null!=t&&t.next!=e;)t=(e=t).parent}return t},Xn.prototype.successor=function(t){t=this.successor_node(this.find(t));return null==t?null:t.data},Xn.prototype.predecessor=function(t){t=this.predecessor_node(this.find(t));return null==t?null:t.data},Xn.prototype.remove_node=function(t){if(null!=t.next&&null!=t.prev){for(var e=t.next;null!=e.prev;)e=e.prev;var i=t.data;t.data=e.data,e.data=i,null!=this.swapped&&this.swapped(t.data,e.data),t=e}var n=null==t.prev?t.next:t.prev;if(1==t.colour)if(null!=t.prev||null!=t.next)n.colour=1;else if(null!=t.parent)for(var r=t.parent;;){r.colour++,r.prev.colour--,r.next.colour--;var s=r.prev;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}s=r.next;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}if(2==r.colour){if(null!=r.parent){r=r.parent;continue}r.colour=1}break}i=t.parent;null==i?this.parent=n:i.prev==t?i.prev=n:i.next=n,null!=n&&(n.parent=i),t.parent=t.prev=t.next=null;t.data=null,t.lt=null,t.swapped=null,t.next=Xn.zpp_pool,Xn.zpp_pool=t},Xn.prototype.clear=function(){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;)i=null!=i.prev?i.prev:null!=i.next?i.next:(null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=Xn.zpp_pool,Xn.zpp_pool=e,t);this.parent=null}},Xn.prototype.clear_with=function(t){if(null!=this.parent){for(var e,i,n=this.parent;null!=n;)n=null!=n.prev?n.prev:null!=n.next?n.next:(t(n.data),null!=(e=n.parent)&&(n==e.prev?e.prev=null:e.next=null,n.parent=null),(i=n).data=null,i.lt=null,i.swapped=null,i.next=Xn.zpp_pool,Xn.zpp_pool=i,e);this.parent=null}},Xn.prototype.clear_node=function(t,e){e(t.data);e=t.parent;return null!=e&&(t==e.prev?e.prev=null:e.next=null,t.parent=null),t.data=null,t.lt=null,t.swapped=null,t.next=Xn.zpp_pool,Xn.zpp_pool=t,e},Xn.prototype.__fix_neg_red=function(t){var e,i,n,r,s=t.parent,o=s.prev==t?(r=t.prev,e=(n=t.next).prev,i=n.next,r.colour=0,t.colour=s.colour=1,null!=(t.next=e)&&(e.parent=t),e=s.data,s.data=n.data,n.data=e,null!=this.swapped&&this.swapped(s.data,n.data),null!=(n.prev=i)&&(i.parent=n),n.next=s.next,null!=s.next&&(s.next.parent=n),null!=(s.next=n)&&(n.parent=s),r):(o=t.next,n=(i=t.prev).next,r=i.prev,o.colour=0,t.colour=s.colour=1,null!=(t.prev=n)&&(n.parent=t),t=s.data,s.data=i.data,i.data=t,null!=this.swapped&&this.swapped(s.data,i.data),null!=(i.next=r)&&(r.parent=i),i.prev=s.prev,null!=s.prev&&(s.prev.parent=i),null!=(s.prev=i)&&(i.parent=s),o);null!=o.prev&&0==o.prev.colour?this.__fix_dbl_red(o.prev):null!=o.next&&0==o.next.colour&&this.__fix_dbl_red(o.next)},Xn.prototype.__fix_dbl_red=function(t){for(;;){var e,i,n,r,s,o,a,l=t.parent,p=l.parent;if(null==p){l.colour=1;break}l==p.prev?(a=(n=p).next,o=t==l.prev?(i=l,r=(e=t).prev,s=t.next,l.next):(i=t,r=(e=l).prev,s=t.prev,t.next)):(r=(e=p).prev,a=t==l.prev?(n=l,s=(i=t).prev,o=t.next,l.next):(n=t,s=(i=l).prev,o=t.prev,t.next));l=p.parent;if(null==l?this.parent=i:l.prev==p?l.prev=i:l.next=i,null!=i&&(i.parent=l),null!=(e.prev=r)&&(r.parent=e),null!=(e.next=s)&&(s.parent=e),null!=(i.prev=e)&&(e.parent=i),null!=(i.next=n)&&(n.parent=i),null!=(n.prev=o)&&(o.parent=n),null!=(n.next=a)&&(a.parent=n),i.colour=p.colour-1,e.colour=1,n.colour=1,i==this.parent)this.parent.colour=1;else if(0==i.colour&&0==i.parent.colour){t=i;continue}break}},Xn.prototype.try_insert_bool=function(t){var e=null,i=null;if(null==this.parent)null==Xn.zpp_pool?e=new Xn:(e=Xn.zpp_pool,Xn.zpp_pool=e.next,e.next=null),e.data=t,this.parent=e;else for(i=this.parent;;)if(this.lt(t,i.data)){if(null==i.prev){null==Xn.zpp_pool?e=new Xn:(e=Xn.zpp_pool,Xn.zpp_pool=e.next,e.next=null),e.data=t,(i.prev=e).parent=i;break}i=i.prev}else{if(!this.lt(i.data,t))break;if(null==i.next){null==Xn.zpp_pool?e=new Xn:(e=Xn.zpp_pool,Xn.zpp_pool=e.next,e.next=null),e.data=t,(i.next=e).parent=i;break}i=i.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),!0)},Xn.prototype.try_insert=function(t){var e=null,i=null;if(null==this.parent)null==Xn.zpp_pool?e=new Xn:(e=Xn.zpp_pool,Xn.zpp_pool=e.next,e.next=null),e.data=t,this.parent=e;else for(i=this.parent;;)if(this.lt(t,i.data)){if(null==i.prev){null==Xn.zpp_pool?e=new Xn:(e=Xn.zpp_pool,Xn.zpp_pool=e.next,e.next=null),e.data=t,(i.prev=e).parent=i;break}i=i.prev}else{if(!this.lt(i.data,t))break;if(null==i.next){null==Xn.zpp_pool?e=new Xn:(e=Xn.zpp_pool,Xn.zpp_pool=e.next,e.next=null),e.data=t,(i.next=e).parent=i;break}i=i.next}return null==e?i:(null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),e)},Xn.prototype.insert=function(t){var e;if(null==Xn.zpp_pool?e=new Xn:(e=Xn.zpp_pool,Xn.zpp_pool=e.next,e.next=null),e.data=t,null==this.parent)this.parent=e;else for(var i=this.parent;;)if(this.lt(e.data,i.data)){if(null==i.prev){(i.prev=e).parent=i;break}i=i.prev}else{if(null==i.next){(i.next=e).parent=i;break}i=i.next}return null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),e},Xn.prototype.__class__=Xn;var Vn=zpp_nape.util.ZPP_Set_ZPP_SimpleEvent=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};Vn.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleEvent"],Vn.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},Vn.prototype.alloc=function(){},Vn.prototype.lt=null,Vn.prototype.swapped=null,Vn.prototype.data=null,Vn.prototype.prev=null,Vn.prototype.next=null,Vn.prototype.parent=null,Vn.prototype.colour=null,Vn.prototype.verify=function(){if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var e=t.data,i=!0;if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var r=n.data;if(i){if(e==r)i=!1;else if(!this.lt(r,e)&&this.lt(e,r))return!1}else if(!this.lt(e,r)&&this.lt(r,e))return!1;if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return!0},Vn.prototype.empty=function(){return null==this.parent},Vn.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},Vn.prototype.size=function(){var t=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;)if(++t,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}return t},Vn.prototype.has=function(t){return null!=this.find(t)},Vn.prototype.find=function(t){for(var e=this.parent;null!=e&&e.data!=t;)e=this.lt(t,e.data)?e.prev:e.next;return e},Vn.prototype.has_weak=function(t){return null!=this.find_weak(t)},Vn.prototype.find_weak=function(t){for(var e=this.parent;null!=e;)if(this.lt(t,e.data))e=e.prev;else{if(!this.lt(e.data,t))break;e=e.next}return e},Vn.prototype.lower_bound=function(t){var e=null;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var n=i.data;if(!this.lt(n,t)){e=n;break}if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}return e},Vn.prototype.first=function(){for(var t=this.parent;null!=t.prev;)t=t.prev;return t.data},Vn.prototype.pop_front=function(){for(var t=this.parent;null!=t.prev;)t=t.prev;var e=t.data;return this.remove_node(t),e},Vn.prototype.remove=function(t){this.remove_node(this.find(t))},Vn.prototype.successor_node=function(t){if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{var e=t;for(t=t.parent;null!=t&&t.prev!=e;)t=(e=t).parent}return t},Vn.prototype.predecessor_node=function(t){if(null!=t.prev)for(t=t.prev;null!=t.next;)t=t.next;else{var e=t;for(t=t.parent;null!=t&&t.next!=e;)t=(e=t).parent}return t},Vn.prototype.successor=function(t){t=this.successor_node(this.find(t));return null==t?null:t.data},Vn.prototype.predecessor=function(t){t=this.predecessor_node(this.find(t));return null==t?null:t.data},Vn.prototype.remove_node=function(t){if(null!=t.next&&null!=t.prev){for(var e=t.next;null!=e.prev;)e=e.prev;var i=t.data;t.data=e.data,e.data=i,null!=this.swapped&&this.swapped(t.data,e.data),t=e}var n=null==t.prev?t.next:t.prev;if(1==t.colour)if(null!=t.prev||null!=t.next)n.colour=1;else if(null!=t.parent)for(var r=t.parent;;){r.colour++,r.prev.colour--,r.next.colour--;var s=r.prev;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}s=r.next;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}if(2==r.colour){if(null!=r.parent){r=r.parent;continue}r.colour=1}break}i=t.parent;null==i?this.parent=n:i.prev==t?i.prev=n:i.next=n,null!=n&&(n.parent=i),t.parent=t.prev=t.next=null;t.data=null,t.lt=null,t.swapped=null,t.next=Vn.zpp_pool,Vn.zpp_pool=t},Vn.prototype.clear=function(){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;)i=null!=i.prev?i.prev:null!=i.next?i.next:(null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=Vn.zpp_pool,Vn.zpp_pool=e,t);this.parent=null}},Vn.prototype.clear_with=function(t){if(null!=this.parent){for(var e,i,n=this.parent;null!=n;)n=null!=n.prev?n.prev:null!=n.next?n.next:(t(n.data),null!=(e=n.parent)&&(n==e.prev?e.prev=null:e.next=null,n.parent=null),(i=n).data=null,i.lt=null,i.swapped=null,i.next=Vn.zpp_pool,Vn.zpp_pool=i,e);this.parent=null}},Vn.prototype.clear_node=function(t,e){e(t.data);e=t.parent;return null!=e&&(t==e.prev?e.prev=null:e.next=null,t.parent=null),t.data=null,t.lt=null,t.swapped=null,t.next=Vn.zpp_pool,Vn.zpp_pool=t,e},Vn.prototype.__fix_neg_red=function(t){var e,i,n,r,s=t.parent,o=s.prev==t?(r=t.prev,e=(n=t.next).prev,i=n.next,r.colour=0,t.colour=s.colour=1,null!=(t.next=e)&&(e.parent=t),e=s.data,s.data=n.data,n.data=e,null!=this.swapped&&this.swapped(s.data,n.data),null!=(n.prev=i)&&(i.parent=n),n.next=s.next,null!=s.next&&(s.next.parent=n),null!=(s.next=n)&&(n.parent=s),r):(o=t.next,n=(i=t.prev).next,r=i.prev,o.colour=0,t.colour=s.colour=1,null!=(t.prev=n)&&(n.parent=t),t=s.data,s.data=i.data,i.data=t,null!=this.swapped&&this.swapped(s.data,i.data),null!=(i.next=r)&&(r.parent=i),i.prev=s.prev,null!=s.prev&&(s.prev.parent=i),null!=(s.prev=i)&&(i.parent=s),o);null!=o.prev&&0==o.prev.colour?this.__fix_dbl_red(o.prev):null!=o.next&&0==o.next.colour&&this.__fix_dbl_red(o.next)},Vn.prototype.__fix_dbl_red=function(t){for(;;){var e,i,n,r,s,o,a,l=t.parent,p=l.parent;if(null==p){l.colour=1;break}l==p.prev?(a=(n=p).next,o=t==l.prev?(i=l,r=(e=t).prev,s=t.next,l.next):(i=t,r=(e=l).prev,s=t.prev,t.next)):(r=(e=p).prev,a=t==l.prev?(n=l,s=(i=t).prev,o=t.next,l.next):(n=t,s=(i=l).prev,o=t.prev,t.next));l=p.parent;if(null==l?this.parent=i:l.prev==p?l.prev=i:l.next=i,null!=i&&(i.parent=l),null!=(e.prev=r)&&(r.parent=e),null!=(e.next=s)&&(s.parent=e),null!=(i.prev=e)&&(e.parent=i),null!=(i.next=n)&&(n.parent=i),null!=(n.prev=o)&&(o.parent=n),null!=(n.next=a)&&(a.parent=n),i.colour=p.colour-1,e.colour=1,n.colour=1,i==this.parent)this.parent.colour=1;else if(0==i.colour&&0==i.parent.colour){t=i;continue}break}},Vn.prototype.try_insert_bool=function(t){var e=null,i=null;if(null==this.parent)null==Vn.zpp_pool?e=new Vn:(e=Vn.zpp_pool,Vn.zpp_pool=e.next,e.next=null),e.data=t,this.parent=e;else for(i=this.parent;;)if(this.lt(t,i.data)){if(null==i.prev){null==Vn.zpp_pool?e=new Vn:(e=Vn.zpp_pool,Vn.zpp_pool=e.next,e.next=null),e.data=t,(i.prev=e).parent=i;break}i=i.prev}else{if(!this.lt(i.data,t))break;if(null==i.next){null==Vn.zpp_pool?e=new Vn:(e=Vn.zpp_pool,Vn.zpp_pool=e.next,e.next=null),e.data=t,(i.next=e).parent=i;break}i=i.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),!0)},Vn.prototype.try_insert=function(t){var e=null,i=null;if(null==this.parent)null==Vn.zpp_pool?e=new Vn:(e=Vn.zpp_pool,Vn.zpp_pool=e.next,e.next=null),e.data=t,this.parent=e;else for(i=this.parent;;)if(this.lt(t,i.data)){if(null==i.prev){null==Vn.zpp_pool?e=new Vn:(e=Vn.zpp_pool,Vn.zpp_pool=e.next,e.next=null),e.data=t,(i.prev=e).parent=i;break}i=i.prev}else{if(!this.lt(i.data,t))break;if(null==i.next){null==Vn.zpp_pool?e=new Vn:(e=Vn.zpp_pool,Vn.zpp_pool=e.next,e.next=null),e.data=t,(i.next=e).parent=i;break}i=i.next}return null==e?i:(null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),e)},Vn.prototype.insert=function(t){var e;if(null==Vn.zpp_pool?e=new Vn:(e=Vn.zpp_pool,Vn.zpp_pool=e.next,e.next=null),e.data=t,null==this.parent)this.parent=e;else for(var i=this.parent;;)if(this.lt(e.data,i.data)){if(null==i.prev){(i.prev=e).parent=i;break}i=i.prev}else{if(null==i.next){(i.next=e).parent=i;break}i=i.next}return null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),e},Vn.prototype.__class__=Vn;var ar=zpp_nape.util.ZPP_Set_ZPP_CbSet=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};ar.__name__=["zpp_nape","util","ZPP_Set_ZPP_CbSet"],ar.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},ar.prototype.alloc=function(){},ar.prototype.lt=null,ar.prototype.swapped=null,ar.prototype.data=null,ar.prototype.prev=null,ar.prototype.next=null,ar.prototype.parent=null,ar.prototype.colour=null,ar.prototype.verify=function(){if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var e=t.data,i=!0;if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var r=n.data;if(i){if(e==r)i=!1;else if(!this.lt(r,e)&&this.lt(e,r))return!1}else if(!this.lt(e,r)&&this.lt(r,e))return!1;if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return!0},ar.prototype.empty=function(){return null==this.parent},ar.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},ar.prototype.size=function(){var t=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;)if(++t,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}return t},ar.prototype.has=function(t){return null!=this.find(t)},ar.prototype.find=function(t){for(var e=this.parent;null!=e&&e.data!=t;)e=this.lt(t,e.data)?e.prev:e.next;return e},ar.prototype.has_weak=function(t){return null!=this.find_weak(t)},ar.prototype.find_weak=function(t){for(var e=this.parent;null!=e;)if(this.lt(t,e.data))e=e.prev;else{if(!this.lt(e.data,t))break;e=e.next}return e},ar.prototype.lower_bound=function(t){var e=null;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var n=i.data;if(!this.lt(n,t)){e=n;break}if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}return e},ar.prototype.first=function(){for(var t=this.parent;null!=t.prev;)t=t.prev;return t.data},ar.prototype.pop_front=function(){for(var t=this.parent;null!=t.prev;)t=t.prev;var e=t.data;return this.remove_node(t),e},ar.prototype.remove=function(t){this.remove_node(this.find(t))},ar.prototype.successor_node=function(t){if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{var e=t;for(t=t.parent;null!=t&&t.prev!=e;)t=(e=t).parent}return t},ar.prototype.predecessor_node=function(t){if(null!=t.prev)for(t=t.prev;null!=t.next;)t=t.next;else{var e=t;for(t=t.parent;null!=t&&t.next!=e;)t=(e=t).parent}return t},ar.prototype.successor=function(t){t=this.successor_node(this.find(t));return null==t?null:t.data},ar.prototype.predecessor=function(t){t=this.predecessor_node(this.find(t));return null==t?null:t.data},ar.prototype.remove_node=function(t){if(null!=t.next&&null!=t.prev){for(var e=t.next;null!=e.prev;)e=e.prev;var i=t.data;t.data=e.data,e.data=i,null!=this.swapped&&this.swapped(t.data,e.data),t=e}var n=null==t.prev?t.next:t.prev;if(1==t.colour)if(null!=t.prev||null!=t.next)n.colour=1;else if(null!=t.parent)for(var r=t.parent;;){r.colour++,r.prev.colour--,r.next.colour--;var s=r.prev;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}s=r.next;if(-1==s.colour){this.__fix_neg_red(s);break}if(0==s.colour){if(null!=s.prev&&0==s.prev.colour){this.__fix_dbl_red(s.prev);break}if(null!=s.next&&0==s.next.colour){this.__fix_dbl_red(s.next);break}}if(2==r.colour){if(null!=r.parent){r=r.parent;continue}r.colour=1}break}i=t.parent;null==i?this.parent=n:i.prev==t?i.prev=n:i.next=n,null!=n&&(n.parent=i),t.parent=t.prev=t.next=null;t.data=null,t.lt=null,t.swapped=null,t.next=ar.zpp_pool,ar.zpp_pool=t},ar.prototype.clear=function(){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;)i=null!=i.prev?i.prev:null!=i.next?i.next:(null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=ar.zpp_pool,ar.zpp_pool=e,t);this.parent=null}},ar.prototype.clear_with=function(t){if(null!=this.parent){for(var e,i,n=this.parent;null!=n;)n=null!=n.prev?n.prev:null!=n.next?n.next:(t(n.data),null!=(e=n.parent)&&(n==e.prev?e.prev=null:e.next=null,n.parent=null),(i=n).data=null,i.lt=null,i.swapped=null,i.next=ar.zpp_pool,ar.zpp_pool=i,e);this.parent=null}},ar.prototype.clear_node=function(t,e){e(t.data);e=t.parent;return null!=e&&(t==e.prev?e.prev=null:e.next=null,t.parent=null),t.data=null,t.lt=null,t.swapped=null,t.next=ar.zpp_pool,ar.zpp_pool=t,e},ar.prototype.__fix_neg_red=function(t){var e,i,n,r,s=t.parent,o=s.prev==t?(r=t.prev,e=(n=t.next).prev,i=n.next,r.colour=0,t.colour=s.colour=1,null!=(t.next=e)&&(e.parent=t),e=s.data,s.data=n.data,n.data=e,null!=this.swapped&&this.swapped(s.data,n.data),null!=(n.prev=i)&&(i.parent=n),n.next=s.next,null!=s.next&&(s.next.parent=n),null!=(s.next=n)&&(n.parent=s),r):(o=t.next,n=(i=t.prev).next,r=i.prev,o.colour=0,t.colour=s.colour=1,null!=(t.prev=n)&&(n.parent=t),t=s.data,s.data=i.data,i.data=t,null!=this.swapped&&this.swapped(s.data,i.data),null!=(i.next=r)&&(r.parent=i),i.prev=s.prev,null!=s.prev&&(s.prev.parent=i),null!=(s.prev=i)&&(i.parent=s),o);null!=o.prev&&0==o.prev.colour?this.__fix_dbl_red(o.prev):null!=o.next&&0==o.next.colour&&this.__fix_dbl_red(o.next)},ar.prototype.__fix_dbl_red=function(t){for(;;){var e,i,n,r,s,o,a,l=t.parent,p=l.parent;if(null==p){l.colour=1;break}l==p.prev?(a=(n=p).next,o=t==l.prev?(i=l,r=(e=t).prev,s=t.next,l.next):(i=t,r=(e=l).prev,s=t.prev,t.next)):(r=(e=p).prev,a=t==l.prev?(n=l,s=(i=t).prev,o=t.next,l.next):(n=t,s=(i=l).prev,o=t.prev,t.next));l=p.parent;if(null==l?this.parent=i:l.prev==p?l.prev=i:l.next=i,null!=i&&(i.parent=l),null!=(e.prev=r)&&(r.parent=e),null!=(e.next=s)&&(s.parent=e),null!=(i.prev=e)&&(e.parent=i),null!=(i.next=n)&&(n.parent=i),null!=(n.prev=o)&&(o.parent=n),null!=(n.next=a)&&(a.parent=n),i.colour=p.colour-1,e.colour=1,n.colour=1,i==this.parent)this.parent.colour=1;else if(0==i.colour&&0==i.parent.colour){t=i;continue}break}},ar.prototype.try_insert_bool=function(t){var e=null,i=null;if(null==this.parent)null==ar.zpp_pool?e=new ar:(e=ar.zpp_pool,ar.zpp_pool=e.next,e.next=null),e.data=t,this.parent=e;else for(i=this.parent;;)if(this.lt(t,i.data)){if(null==i.prev){null==ar.zpp_pool?e=new ar:(e=ar.zpp_pool,ar.zpp_pool=e.next,e.next=null),e.data=t,(i.prev=e).parent=i;break}i=i.prev}else{if(!this.lt(i.data,t))break;if(null==i.next){null==ar.zpp_pool?e=new ar:(e=ar.zpp_pool,ar.zpp_pool=e.next,e.next=null),e.data=t,(i.next=e).parent=i;break}i=i.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),!0)},ar.prototype.try_insert=function(t){var e=null,i=null;if(null==this.parent)null==ar.zpp_pool?e=new ar:(e=ar.zpp_pool,ar.zpp_pool=e.next,e.next=null),e.data=t,this.parent=e;else for(i=this.parent;;)if(this.lt(t,i.data)){if(null==i.prev){null==ar.zpp_pool?e=new ar:(e=ar.zpp_pool,ar.zpp_pool=e.next,e.next=null),e.data=t,(i.prev=e).parent=i;break}i=i.prev}else{if(!this.lt(i.data,t))break;if(null==i.next){null==ar.zpp_pool?e=new ar:(e=ar.zpp_pool,ar.zpp_pool=e.next,e.next=null),e.data=t,(i.next=e).parent=i;break}i=i.next}return null==e?i:(null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),e)},ar.prototype.insert=function(t){var e;if(null==ar.zpp_pool?e=new ar:(e=ar.zpp_pool,ar.zpp_pool=e.next,e.next=null),e.data=t,null==this.parent)this.parent=e;else for(var i=this.parent;;)if(this.lt(e.data,i.data)){if(null==i.prev){(i.prev=e).parent=i;break}i=i.prev}else{if(null==i.next){(i.next=e).parent=i;break}i=i.next}return null==e.parent?e.colour=1:(e.colour=0)==e.parent.colour&&this.__fix_dbl_red(e),e},ar.prototype.__class__=ar,String.prototype.__class__=String,String.__name__=!0,Array.__name__=!0;var lr={__name__:["Int"]},pr={__name__:["Dynamic"]},hr=Number;hr.__name__=["Float"];var ur=Boolean;ur.__ename__=["Bool"];var cr={__name__:["Class"]},dr={};F.__toStr={}.toString,kr.epsilon=1e-8,kr.fluidAngularDragFriction=2.5,kr.fluidAngularDrag=100,kr.fluidVacuumDrag=.5,kr.fluidLinearDrag=.5,kr.collisionSlop=.2,kr.collisionSlopCCD=.5,kr.distanceThresholdCCD=.05,kr.staticCCDLinearThreshold=.05,kr.staticCCDAngularThreshold=.005,kr.bulletCCDLinearThreshold=.125,kr.bulletCCDAngularThreshold=.0125,kr.dynamicSweepLinearThreshold=17,kr.dynamicSweepAngularThreshold=.6,kr.angularCCDSlipScale=.75,kr.arbiterExpirationDelay=6,kr.staticFrictionThreshold=2,kr.elasticThreshold=20,kr.sleepDelay=60,kr.linearSleepThreshold=.2,kr.angularSleepThreshold=.4,kr.contactBiasCoef=.3,kr.contactStaticBiasCoef=.6,kr.contactContinuousBiasCoef=.4,kr.contactContinuousStaticBiasCoef=.5,kr.constraintLinearSlop=.1,kr.constraintAngularSlop=.001,kr.illConditionedThreshold=2e8,Xt.zpp_pool=null,Vt.zpp_pool=null,Wt.zpp_pool=null,Ht.zpp_pool=null,qt.zpp_pool=null,Yt.zpp_pool=null,Kt.zpp_pool=null,Zt.zpp_pool=null,Jt.zpp_pool=null,Qt.zpp_pool=null,$t.zpp_pool=null,te.zpp_pool=null,ee.zpp_pool=null,ie.zpp_pool=null,ne.zpp_pool=null,y.FMAX=1e100,vt._Constraint=0,vt._Interactor=0,vt._CbType=0,vt._CbSet=0,vt._Listener=0,vt._ZPP_SimpleVert=0,vt._ZPP_SimpleSeg=0,vt._Space=0,vt._InteractionGroup=0,re.zpp_pool=null,Hn.zpp_pool=null,qn.zpp_pool=null,Mt.ANY_SHAPE=new u,Mt.ANY_BODY=new u,Mt.ANY_COMPOUND=new u,Mt.ANY_CONSTRAINT=new u,Yn.internal=!1,Yn.id_ImmState_ACCEPT=1,Yn.id_ImmState_IGNORE=2,Yn.id_ImmState_ALWAYS=4,Yn.id_GravMassMode_DEFAULT=0,Yn.id_GravMassMode_FIXED=1,Yn.id_GravMassMode_SCALED=2,Yn.id_InertiaMode_DEFAULT=0,Yn.id_InertiaMode_FIXED=1,Yn.id_MassMode_DEFAULT=0,Yn.id_MassMode_FIXED=1,Yn.id_BodyType_STATIC=1,Yn.id_BodyType_DYNAMIC=2,Yn.id_BodyType_KINEMATIC=3,Yn.id_ListenerType_BODY=0,Yn.id_PreFlag_ACCEPT=1,Yn.id_ListenerType_CONSTRAINT=1,Yn.id_PreFlag_IGNORE=2,Yn.id_ListenerType_INTERACTION=2,Yn.id_PreFlag_ACCEPT_ONCE=3,Yn.id_ListenerType_PRE=3,Yn.id_PreFlag_IGNORE_ONCE=4,Yn.id_CbEvent_BEGIN=0,Yn.id_InteractionType_COLLISION=1,Yn.id_CbEvent_ONGOING=6,Yn.id_InteractionType_SENSOR=2,Yn.id_CbEvent_END=1,Yn.id_InteractionType_FLUID=4,Yn.id_CbEvent_WAKE=2,Yn.id_InteractionType_ANY=7,Yn.id_CbEvent_SLEEP=3,Yn.id_CbEvent_BREAK=4,Yn.id_CbEvent_PRE=5,Yn.id_Winding_UNDEFINED=0,Yn.id_Winding_CLOCKWISE=1,Yn.id_Winding_ANTICLOCKWISE=2,Yn.id_ValidationResult_VALID=0,Yn.id_ValidationResult_DEGENERATE=1,Yn.id_ValidationResult_CONCAVE=2,Yn.id_ValidationResult_SELF_INTERSECTING=3,Yn.id_ShapeType_CIRCLE=0,Yn.id_ShapeType_POLYGON=1,Yn.id_Broadphase_DYNAMIC_AABB_TREE=0,Yn.id_Broadphase_SWEEP_AND_PRUNE=1,Yn.id_ArbiterType_COLLISION=1,Yn.id_ArbiterType_SENSOR=2,Yn.id_ArbiterType_FLUID=4,At.types=function(){null==Yn.ListenerType_BODY&&(Yn.internal=!0,Yn.ListenerType_BODY=new x,Yn.internal=!1);var t=Yn.ListenerType_BODY;null==Yn.ListenerType_CONSTRAINT&&(Yn.internal=!0,Yn.ListenerType_CONSTRAINT=new x,Yn.internal=!1);var e=Yn.ListenerType_CONSTRAINT;null==Yn.ListenerType_INTERACTION&&(Yn.internal=!0,Yn.ListenerType_INTERACTION=new x,Yn.internal=!1);var i=Yn.ListenerType_INTERACTION;return null==Yn.ListenerType_PRE&&(Yn.internal=!0,Yn.ListenerType_PRE=new x,Yn.internal=!1),[t,e,i,Yn.ListenerType_PRE]}(),At.events=function(){null==Yn.CbEvent_BEGIN&&(Yn.internal=!0,Yn.CbEvent_BEGIN=new h,Yn.internal=!1);var t=Yn.CbEvent_BEGIN;null==Yn.CbEvent_END&&(Yn.internal=!0,Yn.CbEvent_END=new h,Yn.internal=!1);var e=Yn.CbEvent_END;null==Yn.CbEvent_WAKE&&(Yn.internal=!0,Yn.CbEvent_WAKE=new h,Yn.internal=!1);var i=Yn.CbEvent_WAKE;null==Yn.CbEvent_SLEEP&&(Yn.internal=!0,Yn.CbEvent_SLEEP=new h,Yn.internal=!1);var n=Yn.CbEvent_SLEEP;null==Yn.CbEvent_BREAK&&(Yn.internal=!0,Yn.CbEvent_BREAK=new h,Yn.internal=!1);var r=Yn.CbEvent_BREAK;null==Yn.CbEvent_PRE&&(Yn.internal=!0,Yn.CbEvent_PRE=new h,Yn.internal=!1);var s=Yn.CbEvent_PRE;return null==Yn.CbEvent_ONGOING&&(Yn.internal=!0,Yn.CbEvent_ONGOING=new h,Yn.internal=!1),[t,e,i,n,r,s,Yn.CbEvent_ONGOING]}(),Re.UCbSet=new St,Re.VCbSet=new St,Re.WCbSet=new St,Re.UCbType=new Et,Re.VCbType=new Et,Re.WCbType=new Et,Qe.internal=!1,Qe.COL=1,Qe.FLUID=4,Qe.SENSOR=2,Qe.types=function(){null==Yn.ArbiterType_COLLISION&&(Yn.internal=!0,Yn.ArbiterType_COLLISION=new E,Yn.internal=!1);var t=Yn.ArbiterType_COLLISION;null==Yn.ArbiterType_SENSOR&&(Yn.internal=!0,Yn.ArbiterType_SENSOR=new E,Yn.internal=!1);var e=Yn.ArbiterType_SENSOR;return null==Yn.ArbiterType_FLUID&&(Yn.internal=!0,Yn.ArbiterType_FLUID=new E,Yn.internal=!1),[null,t,e,null,Yn.ArbiterType_FLUID]}(),Kn.zpp_pool=null,Zn.zpp_pool=null,Jn.FACE1=0,Jn.FACE2=1,Jn.CIRCLE=2,Jn.zpp_pool=null,Qn.internal=!1,Qn.zpp_pool=null,le.zpp_pool=null,pe.SHAPE=1,pe.BODY=2,Be.zpp_pool=null,Er.flowpoly=new ue,Er.flowsegs=new ue,de.convexPool=null,de.rayPool=null,de.internal=!1,_i.zpp_pool=null,yi.zpp_pool=null,fi.ints=null,fi.paths=null,nn.zpp_pool=null,fe.zpp_pool=null,me.zpp_pool=null,rn.zpp_pool=null,sn.me=new sn,sn.look_march=[-1,224,56,216,14,-1,54,214,131,99,-1,91,141,109,181,85],xe.zpp_pool=null,ge.queue=null,ge.edges=null,be.nextId=0,be.zpp_pool=null,ze.zpp_pool=null,Ce.zpp_pool=null,Pe.zpp_pool=null,Te.zpp_pool=null,Me.sweep=null,Me.inthash=null,Me.vertices=null,Me.queue=null,Me.ints=null,Me.list_vertices=null,Me.list_queue=null,Ae.zpp_pool=null,Oe.zpp_pool=null,ke.stack=null,Ee.zpp_pool=null,De.zpp_pool=null,Le.queue=null,Le.stack=null,Le.edgeSet=null,Ir.zpp_pool=null,je.types=function(){null==Yn.BodyType_STATIC&&(Yn.internal=!0,Yn.BodyType_STATIC=new et,Yn.internal=!1);var t=Yn.BodyType_STATIC;null==Yn.BodyType_DYNAMIC&&(Yn.internal=!0,Yn.BodyType_DYNAMIC=new et,Yn.internal=!1);var e=Yn.BodyType_DYNAMIC;return null==Yn.BodyType_KINEMATIC&&(Yn.internal=!0,Yn.BodyType_KINEMATIC=new et,Yn.internal=!1),[null,t,e,Yn.BodyType_KINEMATIC]}(),je.bodystack=null,je.bodyset=null,je.cur_graph_depth=0,Ge.zpp_pool=null,Ue.zpp_pool=null,Ue.WAKE=1,Ue.PROPS=2,Ue.ANGDRAG=4,Ue.ARBITERS=8,Xe.types=function(){null==Yn.ShapeType_CIRCLE&&(Yn.internal=!0,Yn.ShapeType_CIRCLE=new ft,Yn.internal=!1);var t=Yn.ShapeType_CIRCLE;return null==Yn.ShapeType_POLYGON&&(Yn.internal=!0,Yn.ShapeType_POLYGON=new ft,Yn.internal=!1),[t,Yn.ShapeType_POLYGON]}(),We.zpp_pool=null,We.internal=!1,Ye.zpp_pool=null,Ke.zpp_pool=null,Ze.tmpaabb=new Be,Je.FATTEN=3,Je.VEL_STEPS=2,$e.zpp_pool=null,ti.zpp_pool=null,tr.zpp_pool=null,ni.zpp_pool=null,li.zpp_pool=null,Ui.zpp_pool=null,Xi.zpp_pool=null,Vi.zpp_pool=null,Wi.zpp_pool=null,Hi.zpp_pool=null,qi.zpp_pool=null,er.zpp_pool=null,ir.zpp_pool=null,Yi.zpp_pool=null,nr.zpp_pool=null,Ki.zpp_pool=null,Zi.zpp_pool=null,Ji.zpp_pool=null,Qi.zpp_pool=null,$i.zpp_pool=null,tn.zpp_pool=null,en.zpp_pool=null,on.zpp_pool=null,an.zpp_pool=null,ln.zpp_pool=null,pn.zpp_pool=null,hn.zpp_pool=null,un.zpp_pool=null,cn.zpp_pool=null,dn.zpp_pool=null,_n.zpp_pool=null,rr.zpp_pool=null,sr.zpp_pool=null,yn.zpp_pool=null,or.zpp_pool=null,fn.zpp_pool=null,mn.zpp_pool=null,xn.zpp_pool=null,vn.zpp_pool=null,gn.zpp_pool=null,zn.internal=!1,wn.internal=!1,Cn.internal=!1,Pn.internal=!1,Tn.internal=!1,Sn.internal=!1,Mn.internal=!1,An.internal=!1,On.internal=!1,kn.internal=!1,En.internal=!1,In.internal=!1,Dn.internal=!1,Bn.internal=!1,Ln.internal=!1,Rn.poolGeomPoly=null,Rn.poolVec2=null,Rn.poolVec3=null,Fn.zpp_pool=null,jn.zpp_pool=null,Nn.zpp_pool=null,Gn.zpp_pool=null,Un.zpp_pool=null,Xn.zpp_pool=null,Vn.zpp_pool=null,ar.zpp_pool=null,d.main()}(),function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,function(z,t){"use strict";var e=[],w=z.document,i=Object.getPrototypeOf,a=e.slice,y=e.concat,l=e.push,r=e.indexOf,n={},s=n.toString,_=n.hasOwnProperty,o=_.toString,p=o.call(Object),f={};function m(t,e){var i=(e=e||w).createElement("script");i.text=t,e.head.appendChild(i).parentNode.removeChild(i)}function h(t,e){return e.toUpperCase()}var C=function(t,e){return new C.fn.init(t,e)},u=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,c=/^-ms-/,d=/-([a-z])/g;function x(t){var e=!!t&&"length"in t&&t.length,i=C.type(t);return"function"!==i&&!C.isWindow(t)&&("array"===i||0===e||"number"==typeof e&&0<e&&e-1 in t)}C.fn=C.prototype={jquery:"3.1.1",constructor:C,length:0,toArray:function(){return a.call(this)},get:function(t){return null==t?a.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){t=C.merge(this.constructor(),t);return t.prevObject=this,t},each:function(t){return C.each(this,t)},map:function(i){return this.pushStack(C.map(this,function(t,e){return i.call(t,e,t)}))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,t=+t+(t<0?e:0);return this.pushStack(0<=t&&t<e?[this[t]]:[])},end:function(){return this.prevObject||this.constructor()},push:l,sort:e.sort,splice:e.splice},C.extend=C.fn.extend=function(){var t,e,i,n,r,s=arguments[0]||{},o=1,a=arguments.length,l=!1;for("boolean"==typeof s&&(l=s,s=arguments[o]||{},o++),"object"==typeof s||C.isFunction(s)||(s={}),o===a&&(s=this,o--);o<a;o++)if(null!=(t=arguments[o]))for(e in t)r=s[e],i=t[e],s!==i&&(l&&i&&(C.isPlainObject(i)||(n=C.isArray(i)))?(r=n?(n=!1,r&&C.isArray(r)?r:[]):r&&C.isPlainObject(r)?r:{},s[e]=C.extend(l,r,i)):void 0!==i&&(s[e]=i));return s},C.extend({expando:"jQuery"+("3.1.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isFunction:function(t){return"function"===C.type(t)},isArray:Array.isArray,isWindow:function(t){return null!=t&&t===t.window},isNumeric:function(t){var e=C.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},isPlainObject:function(t){return!(!t||"[object Object]"!==s.call(t)||(t=i(t))&&("function"!=typeof(t=_.call(t,"constructor")&&t.constructor)||o.call(t)!==p))},isEmptyObject:function(t){for(var e in t)return!1;return!0},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?n[s.call(t)]||"object":typeof t},globalEval:function(t){m(t)},camelCase:function(t){return t.replace(c,"ms-").replace(d,h)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e){var i,n=0;if(x(t))for(i=t.length;n<i&&!1!==e.call(t[n],n,t[n]);n++);else for(n in t)if(!1===e.call(t[n],n,t[n]))break;return t},trim:function(t){return null==t?"":(t+"").replace(u,"")},makeArray:function(t,e){e=e||[];return null!=t&&(x(Object(t))?C.merge(e,"string"==typeof t?[t]:t):l.call(e,t)),e},inArray:function(t,e,i){return null==e?-1:r.call(e,t,i)},merge:function(t,e){for(var i=+e.length,n=0,r=t.length;n<i;n++)t[r++]=e[n];return t.length=r,t},grep:function(t,e,i){for(var n=[],r=0,s=t.length,o=!i;r<s;r++)!e(t[r],r)!=o&&n.push(t[r]);return n},map:function(t,e,i){var n,r,s=0,o=[];if(x(t))for(n=t.length;s<n;s++)null!=(r=e(t[s],s,i))&&o.push(r);else for(s in t)r=e(t[s],s,i),null!=r&&o.push(r);return y.apply([],o)},guid:1,proxy:function(t,e){var i,n;if("string"==typeof e&&(n=t[e],e=t,t=n),C.isFunction(t))return i=a.call(arguments,2),(n=function(){return t.apply(e||this,i.concat(a.call(arguments)))}).guid=t.guid=t.guid||C.guid++,n},now:Date.now,support:f}),"function"==typeof Symbol&&(C.fn[Symbol.iterator]=e[Symbol.iterator]),C.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(t,e){n["[object "+e+"]"]=e.toLowerCase()});var v=function(i){function u(t,e,i){var n="0x"+e-65536;return n!=n||i?e:n<0?String.fromCharCode(65536+n):String.fromCharCode(n>>10|55296,1023&n|56320)}function n(){z()}var t,d,g,s,r,_,c,y,b,l,p,z,w,o,C,f,a,h,m,P="sizzle"+ +new Date,x=i.document,T=0,v=0,S=ot(),M=ot(),A=ot(),O=function(t,e){return t===e&&(p=!0),0},k={}.hasOwnProperty,e=[],E=e.pop,I=e.push,D=e.push,B=e.slice,L=function(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",F="[\\x20\\t\\r\\n\\f]",j="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",N="\\["+F+"*("+j+")(?:"+F+"*([*^$|!~]?=)"+F+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+j+"))|)"+F+"*\\]",G=":("+j+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+N+")*)|.*)\\)|)",U=new RegExp(F+"+","g"),X=new RegExp("^"+F+"+|((?:^|[^\\\\])(?:\\\\.)*)"+F+"+$","g"),V=new RegExp("^"+F+"*,"+F+"*"),W=new RegExp("^"+F+"*([>+~]|"+F+")"+F+"*"),H=new RegExp("="+F+"*([^\\]'\"]*?)"+F+"*\\]","g"),q=new RegExp(G),Y=new RegExp("^"+j+"$"),K={ID:new RegExp("^#("+j+")"),CLASS:new RegExp("^\\.("+j+")"),TAG:new RegExp("^("+j+"|[*])"),ATTR:new RegExp("^"+N),PSEUDO:new RegExp("^"+G),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+F+"*(even|odd|(([+-]|)(\\d*)n|)"+F+"*(?:([+-]|)"+F+"*(\\d+)|))"+F+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+F+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+F+"*((?:-\\d)?\\d*)"+F+"*\\)|)(?=[^-]|$)","i")},Z=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,Q=/^[^{]+\{\s*\[native \w/,$=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,tt=/[+~]/,et=new RegExp("\\\\([\\da-f]{1,6}"+F+"?|("+F+")|.)","ig"),it=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,nt=function(t,e){return e?"\0"===t?"ï¿½":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t},rt=ft(function(t){return!0===t.disabled&&("form"in t||"label"in t)},{dir:"parentNode",next:"legend"});try{D.apply(e=B.call(x.childNodes),x.childNodes),e[x.childNodes.length].nodeType}catch(t){D={apply:e.length?function(t,e){I.apply(t,B.call(e))}:function(t,e){for(var i=t.length,n=0;t[i++]=e[n++];);t.length=i-1}}}function st(t,e,i,n){var r,s,o,a,l,p,h,u=e&&e.ownerDocument,c=e?e.nodeType:9;if(i=i||[],"string"!=typeof t||!t||1!==c&&9!==c&&11!==c)return i;if(!n&&((e?e.ownerDocument||e:x)!==w&&z(e),e=e||w,C)){if(11!==c&&(l=$.exec(t)))if(r=l[1]){if(9===c){if(!(o=e.getElementById(r)))return i;if(o.id===r)return i.push(o),i}else if(u&&(o=u.getElementById(r))&&m(e,o)&&o.id===r)return i.push(o),i}else{if(l[2])return D.apply(i,e.getElementsByTagName(t)),i;if((r=l[3])&&d.getElementsByClassName&&e.getElementsByClassName)return D.apply(i,e.getElementsByClassName(r)),i}if(d.qsa&&!A[t+" "]&&(!f||!f.test(t))){if(1!==c)u=e,h=t;else if("object"!==e.nodeName.toLowerCase()){for((a=e.getAttribute("id"))?a=a.replace(it,nt):e.setAttribute("id",a=P),s=(p=_(t)).length;s--;)p[s]="#"+a+" "+yt(p[s]);h=p.join(","),u=tt.test(t)&&dt(e.parentNode)||e}if(h)try{return D.apply(i,u.querySelectorAll(h)),i}catch(t){}finally{a===P&&e.removeAttribute("id")}}}return y(t.replace(X,"$1"),e,i,n)}function ot(){var i=[];function n(t,e){return i.push(t+" ")>g.cacheLength&&delete n[i.shift()],n[t+" "]=e}return n}function at(t){return t[P]=!0,t}function lt(t){var e=w.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function pt(t,e){for(var i=t.split("|"),n=i.length;n--;)g.attrHandle[i[n]]=e}function ht(t,e){var i=e&&t,n=i&&1===t.nodeType&&1===e.nodeType&&t.sourceIndex-e.sourceIndex;if(n)return n;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function ut(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&rt(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function ct(o){return at(function(s){return s=+s,at(function(t,e){for(var i,n=o([],t.length,s),r=n.length;r--;)t[i=n[r]]&&(t[i]=!(e[i]=t[i]))})})}function dt(t){return t&&void 0!==t.getElementsByTagName&&t}for(t in d=st.support={},r=st.isXML=function(t){t=t&&(t.ownerDocument||t).documentElement;return!!t&&"HTML"!==t.nodeName},z=st.setDocument=function(t){var e,t=t?t.ownerDocument||t:x;return t!==w&&9===t.nodeType&&t.documentElement&&(o=(w=t).documentElement,C=!r(w),x!==w&&(e=w.defaultView)&&e.top!==e&&(e.addEventListener?e.addEventListener("unload",n,!1):e.attachEvent&&e.attachEvent("onunload",n)),d.attributes=lt(function(t){return t.className="i",!t.getAttribute("className")}),d.getElementsByTagName=lt(function(t){return t.appendChild(w.createComment("")),!t.getElementsByTagName("*").length}),d.getElementsByClassName=Q.test(w.getElementsByClassName),d.getById=lt(function(t){return o.appendChild(t).id=P,!w.getElementsByName||!w.getElementsByName(P).length}),d.getById?(g.filter.ID=function(t){var e=t.replace(et,u);return function(t){return t.getAttribute("id")===e}},g.find.ID=function(t,e){if(void 0!==e.getElementById&&C){t=e.getElementById(t);return t?[t]:[]}}):(g.filter.ID=function(t){var e=t.replace(et,u);return function(t){t=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return t&&t.value===e}},g.find.ID=function(t,e){if(void 0!==e.getElementById&&C){var i,n,r,s=e.getElementById(t);if(s){if((i=s.getAttributeNode("id"))&&i.value===t)return[s];for(r=e.getElementsByName(t),n=0;s=r[n++];)if((i=s.getAttributeNode("id"))&&i.value===t)return[s]}return[]}}),g.find.TAG=d.getElementsByTagName?function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):d.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,n=[],r=0,s=e.getElementsByTagName(t);if("*"!==t)return s;for(;i=s[r++];)1===i.nodeType&&n.push(i);return n},g.find.CLASS=d.getElementsByClassName&&function(t,e){if(void 0!==e.getElementsByClassName&&C)return e.getElementsByClassName(t)},a=[],f=[],(d.qsa=Q.test(w.querySelectorAll))&&(lt(function(t){o.appendChild(t).innerHTML="<a id='"+P+"'></a><select id='"+P+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&f.push("[*^$]="+F+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||f.push("\\["+F+"*(?:value|"+R+")"),t.querySelectorAll("[id~="+P+"-]").length||f.push("~="),t.querySelectorAll(":checked").length||f.push(":checked"),t.querySelectorAll("a#"+P+"+*").length||f.push(".#.+[+~]")}),lt(function(t){t.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var e=w.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&f.push("name"+F+"*[*^$|!~]?="),2!==t.querySelectorAll(":enabled").length&&f.push(":enabled",":disabled"),o.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&f.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),f.push(",.*:")})),(d.matchesSelector=Q.test(h=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&lt(function(t){d.disconnectedMatch=h.call(t,"*"),h.call(t,"[s!='']:x"),a.push("!=",G)}),f=f.length&&new RegExp(f.join("|")),a=a.length&&new RegExp(a.join("|")),e=Q.test(o.compareDocumentPosition),m=e||Q.test(o.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,e=e&&e.parentNode;return t===e||!(!e||1!==e.nodeType||!(i.contains?i.contains(e):t.compareDocumentPosition&&16&t.compareDocumentPosition(e)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},O=e?function(t,e){if(t===e)return p=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i||(1&(i=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!d.sortDetached&&e.compareDocumentPosition(t)===i?t===w||t.ownerDocument===x&&m(x,t)?-1:e===w||e.ownerDocument===x&&m(x,e)?1:l?L(l,t)-L(l,e):0:4&i?-1:1)}:function(t,e){if(t===e)return p=!0,0;var i,n=0,r=t.parentNode,s=e.parentNode,o=[t],a=[e];if(!r||!s)return t===w?-1:e===w?1:r?-1:s?1:l?L(l,t)-L(l,e):0;if(r===s)return ht(t,e);for(i=t;i=i.parentNode;)o.unshift(i);for(i=e;i=i.parentNode;)a.unshift(i);for(;o[n]===a[n];)n++;return n?ht(o[n],a[n]):o[n]===x?-1:a[n]===x?1:0}),w},st.matches=function(t,e){return st(t,null,null,e)},st.matchesSelector=function(t,e){if((t.ownerDocument||t)!==w&&z(t),e=e.replace(H,"='$1']"),d.matchesSelector&&C&&!A[e+" "]&&(!a||!a.test(e))&&(!f||!f.test(e)))try{var i=h.call(t,e);if(i||d.disconnectedMatch||t.document&&11!==t.document.nodeType)return i}catch(t){}return 0<st(e,w,null,[t]).length},st.contains=function(t,e){return(t.ownerDocument||t)!==w&&z(t),m(t,e)},st.attr=function(t,e){(t.ownerDocument||t)!==w&&z(t);var i=g.attrHandle[e.toLowerCase()],i=i&&k.call(g.attrHandle,e.toLowerCase())?i(t,e,!C):void 0;return void 0!==i?i:d.attributes||!C?t.getAttribute(e):(i=t.getAttributeNode(e))&&i.specified?i.value:null},st.escape=function(t){return(t+"").replace(it,nt)},st.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},st.uniqueSort=function(t){var e,i=[],n=0,r=0;if(p=!d.detectDuplicates,l=!d.sortStable&&t.slice(0),t.sort(O),p){for(;e=t[r++];)e===t[r]&&(n=i.push(r));for(;n--;)t.splice(i[n],1)}return l=null,t},s=st.getText=function(t){var e,i="",n=0,r=t.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=s(t)}else if(3===r||4===r)return t.nodeValue}else for(;e=t[n++];)i+=s(e);return i},(g=st.selectors={cacheLength:50,createPseudo:at,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(et,u),t[3]=(t[3]||t[4]||t[5]||"").replace(et,u),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||st.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&st.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return K.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&q.test(i)&&(e=_(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(et,u).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=S[t+" "];return e||(e=new RegExp("(^|"+F+")"+t+"("+F+"|$)"))&&S(t,function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")})},ATTR:function(e,i,n){return function(t){t=st.attr(t,e);return null==t?"!="===i:!i||(t+="","="===i?t===n:"!="===i?t!==n:"^="===i?n&&0===t.indexOf(n):"*="===i?n&&-1<t.indexOf(n):"$="===i?n&&t.slice(-n.length)===n:"~="===i?-1<(" "+t.replace(U," ")+" ").indexOf(n):"|="===i&&(t===n||t.slice(0,n.length+1)===n+"-"))}},CHILD:function(_,t,e,y,f){var m="nth"!==_.slice(0,3),x="last"!==_.slice(-4),v="of-type"===t;return 1===y&&0===f?function(t){return!!t.parentNode}:function(t,e,i){var n,r,s,o,a,l,p=m!=x?"nextSibling":"previousSibling",h=t.parentNode,u=v&&t.nodeName.toLowerCase(),c=!i&&!v,d=!1;if(h){if(m){for(;p;){for(o=t;o=o[p];)if(v?o.nodeName.toLowerCase()===u:1===o.nodeType)return!1;l=p="only"===_&&!l&&"nextSibling"}return!0}if(l=[x?h.firstChild:h.lastChild],x&&c){for(d=(a=(n=(r=(s=(o=h)[P]||(o[P]={}))[o.uniqueID]||(s[o.uniqueID]={}))[_]||[])[0]===T&&n[1])&&n[2],o=a&&h.childNodes[a];o=++a&&o&&o[p]||(d=a=0)||l.pop();)if(1===o.nodeType&&++d&&o===t){r[_]=[T,a,d];break}}else if(c&&(d=a=(n=(r=(s=(o=t)[P]||(o[P]={}))[o.uniqueID]||(s[o.uniqueID]={}))[_]||[])[0]===T&&n[1]),!1===d)for(;(o=++a&&o&&o[p]||(d=a=0)||l.pop())&&((v?o.nodeName.toLowerCase()!==u:1!==o.nodeType)||!++d||(c&&((r=(s=o[P]||(o[P]={}))[o.uniqueID]||(s[o.uniqueID]={}))[_]=[T,d]),o!==t)););return(d-=f)===y||d%y==0&&0<=d/y}}},PSEUDO:function(t,s){var e,o=g.pseudos[t]||g.setFilters[t.toLowerCase()]||st.error("unsupported pseudo: "+t);return o[P]?o(s):1<o.length?(e=[t,t,"",s],g.setFilters.hasOwnProperty(t.toLowerCase())?at(function(t,e){for(var i,n=o(t,s),r=n.length;r--;)t[i=L(t,n[r])]=!(e[i]=n[r])}):function(t){return o(t,0,e)}):o}},pseudos:{not:at(function(t){var n=[],r=[],a=c(t.replace(X,"$1"));return a[P]?at(function(t,e,i,n){for(var r,s=a(t,null,n,[]),o=t.length;o--;)(r=s[o])&&(t[o]=!(e[o]=r))}):function(t,e,i){return n[0]=t,a(n,null,i,r),n[0]=null,!r.pop()}}),has:at(function(e){return function(t){return 0<st(e,t).length}}),contains:at(function(e){return e=e.replace(et,u),function(t){return-1<(t.textContent||t.innerText||s(t)).indexOf(e)}}),lang:at(function(i){return Y.test(i||"")||st.error("unsupported lang: "+i),i=i.replace(et,u).toLowerCase(),function(t){var e;do{if(e=C?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(e=e.toLowerCase())===i||0===e.indexOf(i+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var e=i.location&&i.location.hash;return e&&e.slice(1)===t.id},root:function(t){return t===o},focus:function(t){return t===w.activeElement&&(!w.hasFocus||w.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:ut(!1),disabled:ut(!0),checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!g.pseudos.empty(t)},header:function(t){return J.test(t.nodeName)},input:function(t){return Z.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(t=t.getAttribute("type"))||"text"===t.toLowerCase())},first:ct(function(){return[0]}),last:ct(function(t,e){return[e-1]}),eq:ct(function(t,e,i){return[i<0?i+e:i]}),even:ct(function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t}),odd:ct(function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t}),lt:ct(function(t,e,i){for(var n=i<0?i+e:i;0<=--n;)t.push(n);return t}),gt:ct(function(t,e,i){for(var n=i<0?i+e:i;++n<e;)t.push(n);return t})}}).pseudos.nth=g.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})g.pseudos[t]=function(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}(t);for(t in{submit:!0,reset:!0})g.pseudos[t]=function(i){return function(t){var e=t.nodeName.toLowerCase();return("input"===e||"button"===e)&&t.type===i}}(t);function _t(){}function yt(t){for(var e=0,i=t.length,n="";e<i;e++)n+=t[e].value;return n}function ft(o,t,e){var a=t.dir,l=t.next,p=l||a,h=e&&"parentNode"===p,u=v++;return t.first?function(t,e,i){for(;t=t[a];)if(1===t.nodeType||h)return o(t,e,i);return!1}:function(t,e,i){var n,r,s=[T,u];if(i){for(;t=t[a];)if((1===t.nodeType||h)&&o(t,e,i))return!0}else for(;t=t[a];)if(1===t.nodeType||h)if(n=(r=t[P]||(t[P]={}))[t.uniqueID]||(r[t.uniqueID]={}),l&&l===t.nodeName.toLowerCase())t=t[a]||t;else{if((r=n[p])&&r[0]===T&&r[1]===u)return s[2]=r[2];if((n[p]=s)[2]=o(t,e,i))return!0}return!1}}function mt(r){return 1<r.length?function(t,e,i){for(var n=r.length;n--;)if(!r[n](t,e,i))return!1;return!0}:r[0]}function xt(t,e,i,n,r){for(var s,o=[],a=0,l=t.length,p=null!=e;a<l;a++)(s=t[a])&&(i&&!i(s,n,r)||(o.push(s),p&&e.push(a)));return o}function vt(d,_,y,f,m,t){return f&&!f[P]&&(f=vt(f)),m&&!m[P]&&(m=vt(m,t)),at(function(t,e,i,n){var r,s,o,a=[],l=[],p=e.length,h=t||function(t,e,i){for(var n=0,r=e.length;n<r;n++)st(t,e[n],i);return i}(_||"*",i.nodeType?[i]:i,[]),u=!d||!t&&_?h:xt(h,a,d,i,n),c=y?m||(t?d:p||f)?[]:e:u;if(y&&y(u,c,i,n),f)for(r=xt(c,l),f(r,[],i,n),s=r.length;s--;)(o=r[s])&&(c[l[s]]=!(u[l[s]]=o));if(t){if(m||d){if(m){for(r=[],s=c.length;s--;)(o=c[s])&&r.push(u[s]=o);m(null,c=[],r,n)}for(s=c.length;s--;)(o=c[s])&&-1<(r=m?L(t,o):a[s])&&(t[r]=!(e[r]=o))}}else c=xt(c===e?c.splice(p,c.length):c),m?m(null,e,c,n):D.apply(e,c)})}function gt(f,m){function t(t,e,i,n,r){var s,o,a,l=0,p="0",h=t&&[],u=[],c=b,d=t||v&&g.find.TAG("*",r),_=T+=null==c?1:Math.random()||.1,y=d.length;for(r&&(b=e===w||e||r);p!==y&&null!=(s=d[p]);p++){if(v&&s){for(o=0,e||s.ownerDocument===w||(z(s),i=!C);a=f[o++];)if(a(s,e||w,i)){n.push(s);break}r&&(T=_)}x&&((s=!a&&s)&&l--,t&&h.push(s))}if(l+=p,x&&p!==l){for(o=0;a=m[o++];)a(h,u,e,i);if(t){if(0<l)for(;p--;)h[p]||u[p]||(u[p]=E.call(n));u=xt(u)}D.apply(n,u),r&&!t&&0<u.length&&1<l+m.length&&st.uniqueSort(n)}return r&&(T=_,b=c),h}var x=0<m.length,v=0<f.length;return x?at(t):t}return _t.prototype=g.filters=g.pseudos,g.setFilters=new _t,_=st.tokenize=function(t,e){var i,n,r,s,o,a,l,p=M[t+" "];if(p)return e?0:p.slice(0);for(o=t,a=[],l=g.preFilter;o;){for(s in i&&!(n=V.exec(o))||(n&&(o=o.slice(n[0].length)||o),a.push(r=[])),i=!1,(n=W.exec(o))&&(i=n.shift(),r.push({value:i,type:n[0].replace(X," ")}),o=o.slice(i.length)),g.filter)!(n=K[s].exec(o))||l[s]&&!(n=l[s](n))||(i=n.shift(),r.push({value:i,type:s,matches:n}),o=o.slice(i.length));if(!i)break}return e?o.length:o?st.error(t):M(t,a).slice(0)},c=st.compile=function(t,e){var i,n=[],r=[],s=A[t+" "];if(!s){for(i=(e=e||_(t)).length;i--;)((s=function t(e){for(var n,i,r,s=e.length,o=g.relative[e[0].type],a=o||g.relative[" "],l=o?1:0,p=ft(function(t){return t===n},a,!0),h=ft(function(t){return-1<L(n,t)},a,!0),u=[function(t,e,i){return i=!o&&(i||e!==b)||((n=e).nodeType?p:h)(t,e,i),n=null,i}];l<s;l++)if(i=g.relative[e[l].type])u=[ft(mt(u),i)];else{if((i=g.filter[e[l].type].apply(null,e[l].matches))[P]){for(r=++l;r<s&&!g.relative[e[r].type];r++);return vt(1<l&&mt(u),1<l&&yt(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace(X,"$1"),i,l<r&&t(e.slice(l,r)),r<s&&t(e=e.slice(r)),r<s&&yt(e))}u.push(i)}return mt(u)}(e[i]))[P]?n:r).push(s);(s=A(t,gt(r,n))).selector=t}return s},y=st.select=function(t,e,i,n){var r,s,o,a,l,p="function"==typeof t&&t,h=!n&&_(t=p.selector||t);if(i=i||[],1===h.length){if(2<(s=h[0]=h[0].slice(0)).length&&"ID"===(o=s[0]).type&&9===e.nodeType&&C&&g.relative[s[1].type]){if(!(e=(g.find.ID(o.matches[0].replace(et,u),e)||[])[0]))return i;p&&(e=e.parentNode),t=t.slice(s.shift().value.length)}for(r=K.needsContext.test(t)?0:s.length;r--&&(o=s[r],!g.relative[a=o.type]);)if((l=g.find[a])&&(n=l(o.matches[0].replace(et,u),tt.test(s[0].type)&&dt(e.parentNode)||e))){if(s.splice(r,1),!(t=n.length&&yt(s)))return D.apply(i,n),i;break}}return(p||c(t,h))(n,e,!C,i,!e||tt.test(t)&&dt(e.parentNode)||e),i},d.sortStable=P.split("").sort(O).join("")===P,d.detectDuplicates=!!p,z(),d.sortDetached=lt(function(t){return 1&t.compareDocumentPosition(w.createElement("fieldset"))}),lt(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||pt("type|href|height|width",function(t,e,i){if(!i)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),d.attributes&&lt(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||pt("value",function(t,e,i){if(!i&&"input"===t.nodeName.toLowerCase())return t.defaultValue}),lt(function(t){return null==t.getAttribute("disabled")})||pt(R,function(t,e,i){if(!i)return!0===t[e]?e.toLowerCase():(e=t.getAttributeNode(e))&&e.specified?e.value:null}),st}(z);C.find=v,C.expr=v.selectors,C.expr[":"]=C.expr.pseudos,C.uniqueSort=C.unique=v.uniqueSort,C.text=v.getText,C.isXMLDoc=v.isXML,C.contains=v.contains,C.escapeSelector=v.escape;function g(t,e,i){for(var n=[],r=void 0!==i;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(r&&C(t).is(i))break;n.push(t)}return n}function b(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i}var P=C.expr.match.needsContext,T=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,S=/^.[^:#\[\.,]*$/;function M(t,i,n){return C.isFunction(i)?C.grep(t,function(t,e){return!!i.call(t,e,t)!==n}):i.nodeType?C.grep(t,function(t){return t===i!==n}):"string"!=typeof i?C.grep(t,function(t){return-1<r.call(i,t)!==n}):S.test(i)?C.filter(i,t,n):(i=C.filter(i,t),C.grep(t,function(t){return-1<r.call(i,t)!==n&&1===t.nodeType}))}C.filter=function(t,e,i){var n=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===n.nodeType?C.find.matchesSelector(n,t)?[n]:[]:C.find.matches(t,C.grep(e,function(t){return 1===t.nodeType}))},C.fn.extend({find:function(t){var e,i,n=this.length,r=this;if("string"!=typeof t)return this.pushStack(C(t).filter(function(){for(e=0;e<n;e++)if(C.contains(r[e],this))return!0}));for(i=this.pushStack([]),e=0;e<n;e++)C.find(t,r[e],i);return 1<n?C.uniqueSort(i):i},filter:function(t){return this.pushStack(M(this,t||[],!1))},not:function(t){return this.pushStack(M(this,t||[],!0))},is:function(t){return!!M(this,"string"==typeof t&&P.test(t)?C(t):t||[],!1).length}});var A,O=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(C.fn.init=function(t,e,i){if(!t)return this;if(i=i||A,"string"!=typeof t)return t.nodeType?(this[0]=t,this.length=1,this):C.isFunction(t)?void 0!==i.ready?i.ready(t):t(C):C.makeArray(t,this);if(!(n="<"===t[0]&&">"===t[t.length-1]&&3<=t.length?[null,t,null]:O.exec(t))||!n[1]&&e)return(!e||e.jquery?e||i:this.constructor(e)).find(t);if(n[1]){if(e=e instanceof C?e[0]:e,C.merge(this,C.parseHTML(n[1],e&&e.nodeType?e.ownerDocument||e:w,!0)),T.test(n[1])&&C.isPlainObject(e))for(var n in e)C.isFunction(this[n])?this[n](e[n]):this.attr(n,e[n]);return this}return(t=w.getElementById(n[2]))&&(this[0]=t,this.length=1),this}).prototype=C.fn,A=C(w);var k=/^(?:parents|prev(?:Until|All))/,E={children:!0,contents:!0,next:!0,prev:!0};function I(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}C.fn.extend({has:function(t){var e=C(t,this),i=e.length;return this.filter(function(){for(var t=0;t<i;t++)if(C.contains(this,e[t]))return!0})},closest:function(t,e){var i,n=0,r=this.length,s=[],o="string"!=typeof t&&C(t);if(!P.test(t))for(;n<r;n++)for(i=this[n];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(o?-1<o.index(i):1===i.nodeType&&C.find.matchesSelector(i,t))){s.push(i);break}return this.pushStack(1<s.length?C.uniqueSort(s):s)},index:function(t){return t?"string"==typeof t?r.call(C(t),this[0]):r.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(C.uniqueSort(C.merge(this.get(),C(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),C.each({parent:function(t){t=t.parentNode;return t&&11!==t.nodeType?t:null},parents:function(t){return g(t,"parentNode")},parentsUntil:function(t,e,i){return g(t,"parentNode",i)},next:function(t){return I(t,"nextSibling")},prev:function(t){return I(t,"previousSibling")},nextAll:function(t){return g(t,"nextSibling")},prevAll:function(t){return g(t,"previousSibling")},nextUntil:function(t,e,i){return g(t,"nextSibling",i)},prevUntil:function(t,e,i){return g(t,"previousSibling",i)},siblings:function(t){return b((t.parentNode||{}).firstChild,t)},children:function(t){return b(t.firstChild)},contents:function(t){return t.contentDocument||C.merge([],t.childNodes)}},function(n,r){C.fn[n]=function(t,e){var i=C.map(this,r,t);return"Until"!==n.slice(-5)&&(e=t),e&&"string"==typeof e&&(i=C.filter(e,i)),1<this.length&&(E[n]||C.uniqueSort(i),k.test(n)&&i.reverse()),this.pushStack(i)}});var D=/[^\x20\t\r\n\f]+/g;function B(t){return t}function L(t){throw t}function R(t,e,i){var n;try{t&&C.isFunction(n=t.promise)?n.call(t).done(e).fail(i):t&&C.isFunction(n=t.then)?n.call(t,e,i):e.call(void 0,t)}catch(t){i.call(void 0,t)}}C.Callbacks=function(n){var t,i;n="string"==typeof n?(t=n,i={},C.each(t.match(D)||[],function(t,e){i[e]=!0}),i):C.extend({},n);function r(){for(a=n.once,o=s=!0;p.length;h=-1)for(e=p.shift();++h<l.length;)!1===l[h].apply(e[0],e[1])&&n.stopOnFalse&&(h=l.length,e=!1);n.memory||(e=!1),s=!1,a&&(l=e?[]:"")}var s,e,o,a,l=[],p=[],h=-1,u={add:function(){return l&&(e&&!s&&(h=l.length-1,p.push(e)),function i(t){C.each(t,function(t,e){C.isFunction(e)?n.unique&&u.has(e)||l.push(e):e&&e.length&&"string"!==C.type(e)&&i(e)})}(arguments),e&&!s&&r()),this},remove:function(){return C.each(arguments,function(t,e){for(var i;-1<(i=C.inArray(e,l,i));)l.splice(i,1),i<=h&&h--}),this},has:function(t){return t?-1<C.inArray(t,l):0<l.length},empty:function(){return l=l&&[],this},disable:function(){return a=p=[],l=e="",this},disabled:function(){return!l},lock:function(){return a=p=[],e||s||(l=e=""),this},locked:function(){return!!a},fireWith:function(t,e){return a||(e=[t,(e=e||[]).slice?e.slice():e],p.push(e),s||r()),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!o}};return u},C.extend({Deferred:function(t){var s=[["notify","progress",C.Callbacks("memory"),C.Callbacks("memory"),2],["resolve","done",C.Callbacks("once memory"),C.Callbacks("once memory"),0,"resolved"],["reject","fail",C.Callbacks("once memory"),C.Callbacks("once memory"),1,"rejected"]],r="pending",o={state:function(){return r},always:function(){return a.done(arguments).fail(arguments),this},catch:function(t){return o.then(null,t)},pipe:function(){var r=arguments;return C.Deferred(function(n){C.each(s,function(t,e){var i=C.isFunction(r[e[4]])&&r[e[4]];a[e[1]](function(){var t=i&&i.apply(this,arguments);t&&C.isFunction(t.promise)?t.promise().progress(n.notify).done(n.resolve).fail(n.reject):n[e[0]+"With"](this,i?[t]:arguments)})}),r=null}).promise()},then:function(e,i,n){var l=0;function p(r,s,o,a){return function(){function t(){var t,e;if(!(r<l)){if((t=o.apply(i,n))===s.promise())throw new TypeError("Thenable self-resolution");e=t&&("object"==typeof t||"function"==typeof t)&&t.then,C.isFunction(e)?a?e.call(t,p(l,s,B,a),p(l,s,L,a)):(l++,e.call(t,p(l,s,B,a),p(l,s,L,a),p(l,s,B,s.notifyWith))):(o!==B&&(i=void 0,n=[t]),(a||s.resolveWith)(i,n))}}var i=this,n=arguments,e=a?t:function(){try{t()}catch(t){C.Deferred.exceptionHook&&C.Deferred.exceptionHook(t,e.stackTrace),l<=r+1&&(o!==L&&(i=void 0,n=[t]),s.rejectWith(i,n))}};r?e():(C.Deferred.getStackHook&&(e.stackTrace=C.Deferred.getStackHook()),z.setTimeout(e))}}return C.Deferred(function(t){s[0][3].add(p(0,t,C.isFunction(n)?n:B,t.notifyWith)),s[1][3].add(p(0,t,C.isFunction(e)?e:B)),s[2][3].add(p(0,t,C.isFunction(i)?i:L))}).promise()},promise:function(t){return null!=t?C.extend(t,o):o}},a={};return C.each(s,function(t,e){var i=e[2],n=e[5];o[e[1]]=i.add,n&&i.add(function(){r=n},s[3-t][2].disable,s[0][2].lock),i.add(e[3].fire),a[e[0]]=function(){return a[e[0]+"With"](this===a?void 0:this,arguments),this},a[e[0]+"With"]=i.fireWith}),o.promise(a),t&&t.call(a,a),a},when:function(t){function e(e){return function(t){r[e]=this,s[e]=1<arguments.length?a.call(arguments):t,--i||o.resolveWith(r,s)}}var i=arguments.length,n=i,r=Array(n),s=a.call(arguments),o=C.Deferred();if(i<=1&&(R(t,o.done(e(n)).resolve,o.reject),"pending"===o.state()||C.isFunction(s[n]&&s[n].then)))return o.then();for(;n--;)R(s[n],e(n),o.reject);return o.promise()}});var F=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;C.Deferred.exceptionHook=function(t,e){z.console&&z.console.warn&&t&&F.test(t.name)&&z.console.warn("jQuery.Deferred exception: "+t.message,t.stack,e)},C.readyException=function(t){z.setTimeout(function(){throw t})};var j=C.Deferred();function N(){w.removeEventListener("DOMContentLoaded",N),z.removeEventListener("load",N),C.ready()}C.fn.ready=function(t){return j.then(t).catch(function(t){C.readyException(t)}),this},C.extend({isReady:!1,readyWait:1,holdReady:function(t){t?C.readyWait++:C.ready(!0)},ready:function(t){(!0===t?--C.readyWait:C.isReady)||((C.isReady=!0)!==t&&0<--C.readyWait||j.resolveWith(w,[C]))}}),C.ready.then=j.then,"complete"===w.readyState||"loading"!==w.readyState&&!w.documentElement.doScroll?z.setTimeout(C.ready):(w.addEventListener("DOMContentLoaded",N),z.addEventListener("load",N));function G(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType}var U=function(t,e,i,n,r,s,o){var a=0,l=t.length,p=null==i;if("object"===C.type(i))for(a in r=!0,i)U(t,e,a,i[a],!0,s,o);else if(void 0!==n&&(r=!0,C.isFunction(n)||(o=!0),p&&(e=o?(e.call(t,n),null):(p=e,function(t,e,i){return p.call(C(t),i)})),e))for(;a<l;a++)e(t[a],i,o?n:n.call(t[a],a,e(t[a],i)));return r?t:p?e.call(t):l?e(t[0],i):s};function X(){this.expando=C.expando+X.uid++}X.uid=1,X.prototype={cache:function(t){var e=t[this.expando];return e||(e={},G(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var n,r=this.cache(t);if("string"==typeof e)r[C.camelCase(e)]=i;else for(n in e)r[C.camelCase(n)]=e[n];return r},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][C.camelCase(e)]},access:function(t,e,i){return void 0===e||e&&"string"==typeof e&&void 0===i?this.get(t,e):(this.set(t,e,i),void 0!==i?i:e)},remove:function(t,e){var i,n=t[this.expando];if(void 0!==n){if(void 0!==e){i=(e=C.isArray(e)?e.map(C.camelCase):(e=C.camelCase(e))in n?[e]:e.match(D)||[]).length;for(;i--;)delete n[e[i]]}void 0!==e&&!C.isEmptyObject(n)||(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){t=t[this.expando];return void 0!==t&&!C.isEmptyObject(t)}};var V=new X,W=new X,H=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,q=/[A-Z]/g;function Y(t,e,i){var n,r;if(void 0===i&&1===t.nodeType)if(n="data-"+e.replace(q,"-$&").toLowerCase(),"string"==typeof(i=t.getAttribute(n))){try{i="true"===(r=i)||"false"!==r&&("null"===r?null:r===+r+""?+r:H.test(r)?JSON.parse(r):r)}catch(t){}W.set(t,e,i)}else i=void 0;return i}C.extend({hasData:function(t){return W.hasData(t)||V.hasData(t)},data:function(t,e,i){return W.access(t,e,i)},removeData:function(t,e){W.remove(t,e)},_data:function(t,e,i){return V.access(t,e,i)},_removeData:function(t,e){V.remove(t,e)}}),C.fn.extend({data:function(i,t){var e,n,r,s=this[0],o=s&&s.attributes;if(void 0!==i)return"object"==typeof i?this.each(function(){W.set(this,i)}):U(this,function(t){var e;return s&&void 0===t?void 0!==(e=W.get(s,i))||void 0!==(e=Y(s,i))?e:void 0:void this.each(function(){W.set(this,i,t)})},null,t,1<arguments.length,null,!0);if(this.length&&(r=W.get(s),1===s.nodeType&&!V.get(s,"hasDataAttrs"))){for(e=o.length;e--;)o[e]&&(0===(n=o[e].name).indexOf("data-")&&(n=C.camelCase(n.slice(5)),Y(s,n,r[n])));V.set(s,"hasDataAttrs",!0)}return r},removeData:function(t){return this.each(function(){W.remove(this,t)})}}),C.extend({queue:function(t,e,i){var n;if(t)return e=(e||"fx")+"queue",n=V.get(t,e),i&&(!n||C.isArray(i)?n=V.access(t,e,C.makeArray(i)):n.push(i)),n||[]},dequeue:function(t,e){e=e||"fx";var i=C.queue(t,e),n=i.length,r=i.shift(),s=C._queueHooks(t,e);"inprogress"===r&&(r=i.shift(),n--),r&&("fx"===e&&i.unshift("inprogress"),delete s.stop,r.call(t,function(){C.dequeue(t,e)},s)),!n&&s&&s.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return V.get(t,i)||V.access(t,i,{empty:C.Callbacks("once memory").add(function(){V.remove(t,[e+"queue",i])})})}}),C.fn.extend({queue:function(e,i){var t=2;return"string"!=typeof e&&(i=e,e="fx",t--),arguments.length<t?C.queue(this[0],e):void 0===i?this:this.each(function(){var t=C.queue(this,e,i);C._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&C.dequeue(this,e)})},dequeue:function(t){return this.each(function(){C.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){function i(){--r||s.resolveWith(o,[o])}var n,r=1,s=C.Deferred(),o=this,a=this.length;for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";a--;)(n=V.get(o[a],t+"queueHooks"))&&n.empty&&(r++,n.empty.add(i));return i(),s.promise(e)}});function K(t,e,i,n){var r,s={};for(r in e)s[r]=t.style[r],t.style[r]=e[r];for(r in n=i.apply(t,n||[]),e)t.style[r]=s[r];return n}var Z=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,J=new RegExp("^(?:([+-])=|)("+Z+")([a-z%]*)$","i"),Q=["Top","Right","Bottom","Left"],$=function(t,e){return"none"===(t=e||t).style.display||""===t.style.display&&C.contains(t.ownerDocument,t)&&"none"===C.css(t,"display")};function tt(t,e,i,n){var r,s=1,o=20,a=n?function(){return n.cur()}:function(){return C.css(t,e,"")},l=a(),p=i&&i[3]||(C.cssNumber[e]?"":"px"),h=(C.cssNumber[e]||"px"!==p&&+l)&&J.exec(C.css(t,e));if(h&&h[3]!==p)for(p=p||h[3],i=i||[],h=+l||1;s=s||".5",h/=s,C.style(t,e,h+p),s!==(s=a()/l)&&1!==s&&--o;);return i&&(h=+h||+l||0,r=i[1]?h+(i[1]+1)*i[2]:+i[2],n&&(n.unit=p,n.start=h,n.end=r)),r}var et={};function it(t,e){for(var i,n,r,s,o,a=[],l=0,p=t.length;l<p;l++)(n=t[l]).style&&(i=n.style.display,e?("none"===i&&(a[l]=V.get(n,"display")||null,a[l]||(n.style.display="")),""===n.style.display&&$(n)&&(a[l]=(o=s=void 0,s=(r=n).ownerDocument,o=r.nodeName,(r=et[o])||(s=s.body.appendChild(s.createElement(o)),r=C.css(s,"display"),s.parentNode.removeChild(s),"none"===r&&(r="block"),et[o]=r)))):"none"!==i&&(a[l]="none",V.set(n,"display",i)));for(l=0;l<p;l++)null!=a[l]&&(t[l].style.display=a[l]);return t}C.fn.extend({show:function(){return it(this,!0)},hide:function(){return it(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){$(this)?C(this).show():C(this).hide()})}});var nt=/^(?:checkbox|radio)$/i,rt=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,st=/^$|\/(?:java|ecma)script/i,ot={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function at(t,e){var i=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[];return void 0===e||e&&C.nodeName(t,e)?C.merge([t],i):i}function lt(t,e){for(var i=0,n=t.length;i<n;i++)V.set(t[i],"globalEval",!e||V.get(e[i],"globalEval"))}ot.optgroup=ot.option,ot.tbody=ot.tfoot=ot.colgroup=ot.caption=ot.thead,ot.th=ot.td;var pt=/<|&#?\w+;/;function ht(t,e,i,n,r){for(var s,o,a,l,p,h=e.createDocumentFragment(),u=[],c=0,d=t.length;c<d;c++)if((s=t[c])||0===s)if("object"===C.type(s))C.merge(u,s.nodeType?[s]:s);else if(pt.test(s)){for(o=o||h.appendChild(e.createElement("div")),a=(rt.exec(s)||["",""])[1].toLowerCase(),a=ot[a]||ot._default,o.innerHTML=a[1]+C.htmlPrefilter(s)+a[2],p=a[0];p--;)o=o.lastChild;C.merge(u,o.childNodes),(o=h.firstChild).textContent=""}else u.push(e.createTextNode(s));for(h.textContent="",c=0;s=u[c++];)if(n&&-1<C.inArray(s,n))r&&r.push(s);else if(l=C.contains(s.ownerDocument,s),o=at(h.appendChild(s),"script"),l&&lt(o),i)for(p=0;s=o[p++];)st.test(s.type||"")&&i.push(s);return h}e=w.createDocumentFragment().appendChild(w.createElement("div")),(v=w.createElement("input")).setAttribute("type","radio"),v.setAttribute("checked","checked"),v.setAttribute("name","t"),e.appendChild(v),f.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",f.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue;var ut=w.documentElement,ct=/^key/,dt=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,_t=/^([^.]*)(?:\.(.+)|)/;function yt(){return!0}function ft(){return!1}function mt(){try{return w.activeElement}catch(t){}}function xt(t,e,i,n,r,s){var o,a;if("object"==typeof e){for(a in"string"!=typeof i&&(n=n||i,i=void 0),e)xt(t,a,i,n,e[a],s);return t}if(null==n&&null==r?(r=i,n=i=void 0):null==r&&("string"==typeof i?(r=n,n=void 0):(r=n,n=i,i=void 0)),!1===r)r=ft;else if(!r)return t;return 1===s&&(o=r,(r=function(t){return C().off(t),o.apply(this,arguments)}).guid=o.guid||(o.guid=C.guid++)),t.each(function(){C.event.add(this,e,r,n,i)})}C.event={global:{},add:function(e,t,i,n,r){var s,o,a,l,p,h,u,c,d,_=V.get(e);if(_)for(i.handler&&(i=(s=i).handler,r=s.selector),r&&C.find.matchesSelector(ut,r),i.guid||(i.guid=C.guid++),(a=_.events)||(a=_.events={}),(o=_.handle)||(o=_.handle=function(t){return void 0!==C&&C.event.triggered!==t.type?C.event.dispatch.apply(e,arguments):void 0}),l=(t=(t||"").match(D)||[""]).length;l--;)u=d=(p=_t.exec(t[l])||[])[1],c=(p[2]||"").split(".").sort(),u&&(h=C.event.special[u]||{},u=(r?h.delegateType:h.bindType)||u,h=C.event.special[u]||{},p=C.extend({type:u,origType:d,data:n,handler:i,guid:i.guid,selector:r,needsContext:r&&C.expr.match.needsContext.test(r),namespace:c.join(".")},s),(d=a[u])||((d=a[u]=[]).delegateCount=0,h.setup&&!1!==h.setup.call(e,n,c,o)||e.addEventListener&&e.addEventListener(u,o)),h.add&&(h.add.call(e,p),p.handler.guid||(p.handler.guid=i.guid)),r?d.splice(d.delegateCount++,0,p):d.push(p),C.event.global[u]=!0)},remove:function(t,e,i,n,r){var s,o,a,l,p,h,u,c,d,_,y,f=V.hasData(t)&&V.get(t);if(f&&(l=f.events)){for(p=(e=(e||"").match(D)||[""]).length;p--;)if(d=y=(a=_t.exec(e[p])||[])[1],_=(a[2]||"").split(".").sort(),d){for(u=C.event.special[d]||{},c=l[d=(n?u.delegateType:u.bindType)||d]||[],a=a[2]&&new RegExp("(^|\\.)"+_.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=s=c.length;s--;)h=c[s],!r&&y!==h.origType||i&&i.guid!==h.guid||a&&!a.test(h.namespace)||n&&n!==h.selector&&("**"!==n||!h.selector)||(c.splice(s,1),h.selector&&c.delegateCount--,u.remove&&u.remove.call(t,h));o&&!c.length&&(u.teardown&&!1!==u.teardown.call(t,_,f.handle)||C.removeEvent(t,d,f.handle),delete l[d])}else for(d in l)C.event.remove(t,d+e[p],i,n,!0);C.isEmptyObject(l)&&V.remove(t,"handle events")}},dispatch:function(t){var e,i,n,r,s,o=C.event.fix(t),a=new Array(arguments.length),l=(V.get(this,"events")||{})[o.type]||[],t=C.event.special[o.type]||{};for(a[0]=o,e=1;e<arguments.length;e++)a[e]=arguments[e];if(o.delegateTarget=this,!t.preDispatch||!1!==t.preDispatch.call(this,o)){for(s=C.event.handlers.call(this,o,l),e=0;(n=s[e++])&&!o.isPropagationStopped();)for(o.currentTarget=n.elem,i=0;(r=n.handlers[i++])&&!o.isImmediatePropagationStopped();)o.rnamespace&&!o.rnamespace.test(r.namespace)||(o.handleObj=r,o.data=r.data,void 0!==(r=((C.event.special[r.origType]||{}).handle||r.handler).apply(n.elem,a))&&!1===(o.result=r)&&(o.preventDefault(),o.stopPropagation()));return t.postDispatch&&t.postDispatch.call(this,o),o.result}},handlers:function(t,e){var i,n,r,s,o,a=[],l=e.delegateCount,p=t.target;if(l&&p.nodeType&&!("click"===t.type&&1<=t.button))for(;p!==this;p=p.parentNode||this)if(1===p.nodeType&&("click"!==t.type||!0!==p.disabled)){for(s=[],o={},i=0;i<l;i++)void 0===o[r=(n=e[i]).selector+" "]&&(o[r]=n.needsContext?-1<C(r,this).index(p):C.find(r,this,null,[p]).length),o[r]&&s.push(n);s.length&&a.push({elem:p,handlers:s})}return p=this,l<e.length&&a.push({elem:p,handlers:e.slice(l)}),a},addProp:function(e,t){Object.defineProperty(C.Event.prototype,e,{enumerable:!0,configurable:!0,get:C.isFunction(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(t){return t[C.expando]?t:new C.Event(t)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==mt()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===mt()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&C.nodeName(this,"input"))return this.click(),!1},_default:function(t){return C.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},C.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},C.Event=function(t,e){return this instanceof C.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?yt:ft,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&C.extend(this,e),this.timeStamp=t&&t.timeStamp||C.now(),void(this[C.expando]=!0)):new C.Event(t,e)},C.Event.prototype={constructor:C.Event,isDefaultPrevented:ft,isPropagationStopped:ft,isImmediatePropagationStopped:ft,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=yt,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=yt,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=yt,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},C.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(t){var e=t.button;return null==t.which&&ct.test(t.type)?null!=t.charCode?t.charCode:t.keyCode:!t.which&&void 0!==e&&dt.test(t.type)?1&e?1:2&e?3:4&e?2:0:t.which}},C.event.addProp),C.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,r){C.event.special[t]={delegateType:r,bindType:r,handle:function(t){var e,i=t.relatedTarget,n=t.handleObj;return i&&(i===this||C.contains(this,i))||(t.type=n.origType,e=n.handler.apply(this,arguments),t.type=r),e}}}),C.fn.extend({on:function(t,e,i,n){return xt(this,t,e,i,n)},one:function(t,e,i,n){return xt(this,t,e,i,n,1)},off:function(t,e,i){var n,r;if(t&&t.preventDefault&&t.handleObj)return n=t.handleObj,C(t.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"!=typeof t)return!1!==e&&"function"!=typeof e||(i=e,e=void 0),!1===i&&(i=ft),this.each(function(){C.event.remove(this,t,i,e)});for(r in t)this.off(r,e,t[r]);return this}});var vt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,gt=/<script|<style|<link/i,bt=/checked\s*(?:[^=]|=\s*.checked.)/i,zt=/^true\/(.*)/,wt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Ct(t,e){return C.nodeName(t,"table")&&C.nodeName(11!==e.nodeType?e:e.firstChild,"tr")&&t.getElementsByTagName("tbody")[0]||t}function Pt(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function Tt(t){var e=zt.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function St(t,e){var i,n,r,s,o,a;if(1===e.nodeType){if(V.hasData(t)&&(s=V.access(t),o=V.set(e,s),a=s.events))for(r in delete o.handle,o.events={},a)for(i=0,n=a[r].length;i<n;i++)C.event.add(e,r,a[r][i]);W.hasData(t)&&(t=W.access(t),t=C.extend({},t),W.set(e,t))}}function Mt(i,n,r,s){n=y.apply([],n);var t,e,o,a,l,p,h=0,u=i.length,c=u-1,d=n[0],_=C.isFunction(d);if(_||1<u&&"string"==typeof d&&!f.checkClone&&bt.test(d))return i.each(function(t){var e=i.eq(t);_&&(n[0]=d.call(this,t,e.html())),Mt(e,n,r,s)});if(u&&(e=(t=ht(n,i[0].ownerDocument,!1,i,s)).firstChild,1===t.childNodes.length&&(t=e),e||s)){for(a=(o=C.map(at(t,"script"),Pt)).length;h<u;h++)l=t,h!==c&&(l=C.clone(l,!0,!0),a&&C.merge(o,at(l,"script"))),r.call(i[h],l,h);if(a)for(p=o[o.length-1].ownerDocument,C.map(o,Tt),h=0;h<a;h++)l=o[h],st.test(l.type||"")&&!V.access(l,"globalEval")&&C.contains(p,l)&&(l.src?C._evalUrl&&C._evalUrl(l.src):m(l.textContent.replace(wt,""),p))}return i}function At(t,e,i){for(var n,r=e?C.filter(e,t):t,s=0;null!=(n=r[s]);s++)i||1!==n.nodeType||C.cleanData(at(n)),n.parentNode&&(i&&C.contains(n.ownerDocument,n)&&lt(at(n,"script")),n.parentNode.removeChild(n));return t}C.extend({htmlPrefilter:function(t){return t.replace(vt,"<$1></$2>")},clone:function(t,e,i){var n,r,s,o,a,l,p,h=t.cloneNode(!0),u=C.contains(t.ownerDocument,t);if(!(f.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||C.isXMLDoc(t)))for(o=at(h),n=0,r=(s=at(t)).length;n<r;n++)a=s[n],l=o[n],p=void 0,"input"===(p=l.nodeName.toLowerCase())&&nt.test(a.type)?l.checked=a.checked:"input"!==p&&"textarea"!==p||(l.defaultValue=a.defaultValue);if(e)if(i)for(s=s||at(t),o=o||at(h),n=0,r=s.length;n<r;n++)St(s[n],o[n]);else St(t,h);return 0<(o=at(h,"script")).length&&lt(o,!u&&at(t,"script")),h},cleanData:function(t){for(var e,i,n,r=C.event.special,s=0;void 0!==(i=t[s]);s++)if(G(i)){if(e=i[V.expando]){if(e.events)for(n in e.events)r[n]?C.event.remove(i,n):C.removeEvent(i,n,e.handle);i[V.expando]=void 0}i[W.expando]&&(i[W.expando]=void 0)}}}),C.fn.extend({detach:function(t){return At(this,t,!0)},remove:function(t){return At(this,t)},text:function(t){return U(this,function(t){return void 0===t?C.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)})},null,t,arguments.length)},append:function(){return Mt(this,arguments,function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Ct(this,t).appendChild(t)})},prepend:function(){return Mt(this,arguments,function(t){var e;1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(e=Ct(this,t)).insertBefore(t,e.firstChild)})},before:function(){return Mt(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return Mt(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(C.cleanData(at(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map(function(){return C.clone(this,t,e)})},html:function(t){return U(this,function(t){var e=this[0]||{},i=0,n=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!gt.test(t)&&!ot[(rt.exec(t)||["",""])[1].toLowerCase()]){t=C.htmlPrefilter(t);try{for(;i<n;i++)1===(e=this[i]||{}).nodeType&&(C.cleanData(at(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var i=[];return Mt(this,arguments,function(t){var e=this.parentNode;C.inArray(this,i)<0&&(C.cleanData(at(this)),e&&e.replaceChild(t,this))},i)}}),C.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,o){C.fn[t]=function(t){for(var e,i=[],n=C(t),r=n.length-1,s=0;s<=r;s++)e=s===r?this:this.clone(!0),C(n[s])[o](e),l.apply(i,e.get());return this.pushStack(i)}});var Ot,kt,Et,It,Dt,Bt,Lt=/^margin/,Rt=new RegExp("^("+Z+")(?!px)[a-z%]+$","i"),Ft=function(t){var e=t.ownerDocument.defaultView;return e&&e.opener||(e=z),e.getComputedStyle(t)};function jt(){var t;Bt&&(Bt.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",Bt.innerHTML="",ut.appendChild(Dt),t=z.getComputedStyle(Bt),Ot="1%"!==t.top,It="2px"===t.marginLeft,kt="4px"===t.width,Bt.style.marginRight="50%",Et="4px"===t.marginRight,ut.removeChild(Dt),Bt=null)}function Nt(t,e,i){var n,r,s=t.style;return(i=i||Ft(t))&&(""!==(r=i.getPropertyValue(e)||i[e])||C.contains(t.ownerDocument,t)||(r=C.style(t,e)),!f.pixelMarginRight()&&Rt.test(r)&&Lt.test(e)&&(n=s.width,t=s.minWidth,e=s.maxWidth,s.minWidth=s.maxWidth=s.width=r,r=i.width,s.width=n,s.minWidth=t,s.maxWidth=e)),void 0!==r?r+"":r}function Gt(t,e){return{get:function(){return t()?void delete this.get:(this.get=e).apply(this,arguments)}}}Dt=w.createElement("div"),(Bt=w.createElement("div")).style&&(Bt.style.backgroundClip="content-box",Bt.cloneNode(!0).style.backgroundClip="",f.clearCloneStyle="content-box"===Bt.style.backgroundClip,Dt.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",Dt.appendChild(Bt),C.extend(f,{pixelPosition:function(){return jt(),Ot},boxSizingReliable:function(){return jt(),kt},pixelMarginRight:function(){return jt(),Et},reliableMarginLeft:function(){return jt(),It}}));var Ut=/^(none|table(?!-c[ea]).+)/,Xt={position:"absolute",visibility:"hidden",display:"block"},Vt={letterSpacing:"0",fontWeight:"400"},Wt=["Webkit","Moz","ms"],Ht=w.createElement("div").style;function qt(t){if(t in Ht)return t;for(var e=t[0].toUpperCase()+t.slice(1),i=Wt.length;i--;)if((t=Wt[i]+e)in Ht)return t}function Yt(t,e,i){var n=J.exec(e);return n?Math.max(0,n[2]-(i||0))+(n[3]||"px"):e}function Kt(t,e,i,n,r){for(var s=0,o=i===(n?"border":"content")?4:"width"===e?1:0;o<4;o+=2)"margin"===i&&(s+=C.css(t,i+Q[o],!0,r)),n?("content"===i&&(s-=C.css(t,"padding"+Q[o],!0,r)),"margin"!==i&&(s-=C.css(t,"border"+Q[o]+"Width",!0,r))):(s+=C.css(t,"padding"+Q[o],!0,r),"padding"!==i&&(s+=C.css(t,"border"+Q[o]+"Width",!0,r)));return s}function Zt(t,e,i){var n,r=!0,s=Ft(t),o="border-box"===C.css(t,"boxSizing",!1,s);if(t.getClientRects().length&&(n=t.getBoundingClientRect()[e]),n<=0||null==n){if(((n=Nt(t,e,s))<0||null==n)&&(n=t.style[e]),Rt.test(n))return n;r=o&&(f.boxSizingReliable()||n===t.style[e]),n=parseFloat(n)||0}return n+Kt(t,e,i||(o?"border":"content"),r,s)+"px"}function Jt(t,e,i,n,r){return new Jt.prototype.init(t,e,i,n,r)}C.extend({cssHooks:{opacity:{get:function(t,e){if(e){t=Nt(t,"opacity");return""===t?"1":t}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(t,e,i,n){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var r,s,o,a=C.camelCase(e),l=t.style;return e=C.cssProps[a]||(C.cssProps[a]=qt(a)||a),o=C.cssHooks[e]||C.cssHooks[a],void 0===i?o&&"get"in o&&void 0!==(r=o.get(t,!1,n))?r:l[e]:("string"===(s=typeof i)&&(r=J.exec(i))&&r[1]&&(i=tt(t,e,r),s="number"),void(null!=i&&i==i&&("number"===s&&(i+=r&&r[3]||(C.cssNumber[a]?"":"px")),f.clearCloneStyle||""!==i||0!==e.indexOf("background")||(l[e]="inherit"),o&&"set"in o&&void 0===(i=o.set(t,i,n))||(l[e]=i))))}},css:function(t,e,i,n){var r,s=C.camelCase(e);return e=C.cssProps[s]||(C.cssProps[s]=qt(s)||s),(s=C.cssHooks[e]||C.cssHooks[s])&&"get"in s&&(r=s.get(t,!0,i)),void 0===r&&(r=Nt(t,e,n)),"normal"===r&&e in Vt&&(r=Vt[e]),""===i||i?(e=parseFloat(r),!0===i||isFinite(e)?e||0:r):r}}),C.each(["height","width"],function(t,s){C.cssHooks[s]={get:function(t,e,i){if(e)return!Ut.test(C.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?Zt(t,s,i):K(t,Xt,function(){return Zt(t,s,i)})},set:function(t,e,i){var n,r=i&&Ft(t),r=i&&Kt(t,s,i,"border-box"===C.css(t,"boxSizing",!1,r),r);return r&&(n=J.exec(e))&&"px"!==(n[3]||"px")&&(t.style[s]=e,e=C.css(t,s)),Yt(0,e,r)}}}),C.cssHooks.marginLeft=Gt(f.reliableMarginLeft,function(t,e){if(e)return(parseFloat(Nt(t,"marginLeft"))||t.getBoundingClientRect().left-K(t,{marginLeft:0},function(){return t.getBoundingClientRect().left}))+"px"}),C.each({margin:"",padding:"",border:"Width"},function(r,s){C.cssHooks[r+s]={expand:function(t){for(var e=0,i={},n="string"==typeof t?t.split(" "):[t];e<4;e++)i[r+Q[e]+s]=n[e]||n[e-2]||n[0];return i}},Lt.test(r)||(C.cssHooks[r+s].set=Yt)}),C.fn.extend({css:function(t,e){return U(this,function(t,e,i){var n,r,s={},o=0;if(C.isArray(e)){for(n=Ft(t),r=e.length;o<r;o++)s[e[o]]=C.css(t,e[o],!1,n);return s}return void 0!==i?C.style(t,e,i):C.css(t,e)},t,e,1<arguments.length)}}),(C.Tween=Jt).prototype={constructor:Jt,init:function(t,e,i,n,r,s){this.elem=t,this.prop=i,this.easing=r||C.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=n,this.unit=s||(C.cssNumber[i]?"":"px")},cur:function(){var t=Jt.propHooks[this.prop];return(t&&t.get?t:Jt.propHooks._default).get(this)},run:function(t){var e,i=Jt.propHooks[this.prop];return this.options.duration?this.pos=e=C.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),(i&&i.set?i:Jt.propHooks._default).set(this),this}},Jt.prototype.init.prototype=Jt.prototype,Jt.propHooks={_default:{get:function(t){return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(t=C.css(t.elem,t.prop,""))&&"auto"!==t?t:0},set:function(t){C.fx.step[t.prop]?C.fx.step[t.prop](t):1!==t.elem.nodeType||null==t.elem.style[C.cssProps[t.prop]]&&!C.cssHooks[t.prop]?t.elem[t.prop]=t.now:C.style(t.elem,t.prop,t.now+t.unit)}}},Jt.propHooks.scrollTop=Jt.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},C.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},C.fx=Jt.prototype.init,C.fx.step={};var Qt,$t,te=/^(?:toggle|show|hide)$/,ee=/queueHooks$/;function ie(){$t&&(z.requestAnimationFrame(ie),C.fx.tick())}function ne(){return z.setTimeout(function(){Qt=void 0}),Qt=C.now()}function re(t,e){var i,n=0,r={height:t};for(e=e?1:0;n<4;n+=2-e)r["margin"+(i=Q[n])]=r["padding"+i]=t;return e&&(r.opacity=r.width=t),r}function se(t,e,i){for(var n,r=(oe.tweeners[e]||[]).concat(oe.tweeners["*"]),s=0,o=r.length;s<o;s++)if(n=r[s].call(i,e,t))return n}function oe(r,t,e){var i,s,n=0,o=oe.prefilters.length,a=C.Deferred().always(function(){delete l.elem}),l=function(){if(s)return!1;for(var t=Qt||ne(),t=Math.max(0,p.startTime+p.duration-t),e=1-(t/p.duration||0),i=0,n=p.tweens.length;i<n;i++)p.tweens[i].run(e);return a.notifyWith(r,[p,e,t]),e<1&&n?t:(a.resolveWith(r,[p]),!1)},p=a.promise({elem:r,props:C.extend({},t),opts:C.extend(!0,{specialEasing:{},easing:C.easing._default},e),originalProperties:t,originalOptions:e,startTime:Qt||ne(),duration:e.duration,tweens:[],createTween:function(t,e){t=C.Tween(r,p.opts,t,e,p.opts.specialEasing[t]||p.opts.easing);return p.tweens.push(t),t},stop:function(t){var e=0,i=t?p.tweens.length:0;if(s)return this;for(s=!0;e<i;e++)p.tweens[e].run(1);return t?(a.notifyWith(r,[p,1,0]),a.resolveWith(r,[p,t])):a.rejectWith(r,[p,t]),this}}),h=p.props;for(function(t,e){var i,n,r,s,o;for(i in t)if(n=C.camelCase(i),r=e[n],s=t[i],C.isArray(s)&&(r=s[1],s=t[i]=s[0]),i!==n&&(t[n]=s,delete t[i]),o=C.cssHooks[n],o&&"expand"in o)for(i in s=o.expand(s),delete t[n],s)i in t||(t[i]=s[i],e[i]=r);else e[n]=r}(h,p.opts.specialEasing);n<o;n++)if(i=oe.prefilters[n].call(p,r,h,p.opts))return C.isFunction(i.stop)&&(C._queueHooks(p.elem,p.opts.queue).stop=C.proxy(i.stop,i)),i;return C.map(h,se,p),C.isFunction(p.opts.start)&&p.opts.start.call(r,p),C.fx.timer(C.extend(l,{elem:r,anim:p,queue:p.opts.queue})),p.progress(p.opts.progress).done(p.opts.done,p.opts.complete).fail(p.opts.fail).always(p.opts.always)}C.Animation=C.extend(oe,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return tt(i.elem,t,J.exec(e),i),i}]},tweener:function(t,e){for(var i,n=0,r=(t=C.isFunction(t)?(e=t,["*"]):t.match(D)).length;n<r;n++)i=t[n],oe.tweeners[i]=oe.tweeners[i]||[],oe.tweeners[i].unshift(e)},prefilters:[function(t,e,i){var n,r,s,o,a,l,p,h="width"in e||"height"in e,u=this,c={},d=t.style,_=t.nodeType&&$(t),y=V.get(t,"fxshow");for(n in i.queue||(null==(o=C._queueHooks(t,"fx")).unqueued&&(o.unqueued=0,a=o.empty.fire,o.empty.fire=function(){o.unqueued||a()}),o.unqueued++,u.always(function(){u.always(function(){o.unqueued--,C.queue(t,"fx").length||o.empty.fire()})})),e)if(r=e[n],te.test(r)){if(delete e[n],s=s||"toggle"===r,r===(_?"hide":"show")){if("show"!==r||!y||void 0===y[n])continue;_=!0}c[n]=y&&y[n]||C.style(t,n)}if((l=!C.isEmptyObject(e))||!C.isEmptyObject(c))for(n in h&&1===t.nodeType&&(i.overflow=[d.overflow,d.overflowX,d.overflowY],null==(p=y&&y.display)&&(p=V.get(t,"display")),"none"===(h=C.css(t,"display"))&&(p?h=p:(it([t],!0),p=t.style.display||p,h=C.css(t,"display"),it([t]))),("inline"===h||"inline-block"===h&&null!=p)&&"none"===C.css(t,"float")&&(l||(u.done(function(){d.display=p}),null==p&&(h=d.display,p="none"===h?"":h)),d.display="inline-block")),i.overflow&&(d.overflow="hidden",u.always(function(){d.overflow=i.overflow[0],d.overflowX=i.overflow[1],d.overflowY=i.overflow[2]})),l=!1,c)l||(y?"hidden"in y&&(_=y.hidden):y=V.access(t,"fxshow",{display:p}),s&&(y.hidden=!_),_&&it([t],!0),u.done(function(){for(n in _||it([t]),V.remove(t,"fxshow"),c)C.style(t,n,c[n])})),l=se(_?y[n]:0,n,u),n in y||(y[n]=l.start,_&&(l.end=l.start,l.start=0))}],prefilter:function(t,e){e?oe.prefilters.unshift(t):oe.prefilters.push(t)}}),C.speed=function(t,e,i){var n=t&&"object"==typeof t?C.extend({},t):{complete:i||!i&&e||C.isFunction(t)&&t,duration:t,easing:i&&e||e&&!C.isFunction(e)&&e};return C.fx.off||w.hidden?n.duration=0:"number"!=typeof n.duration&&(n.duration in C.fx.speeds?n.duration=C.fx.speeds[n.duration]:n.duration=C.fx.speeds._default),null!=n.queue&&!0!==n.queue||(n.queue="fx"),n.old=n.complete,n.complete=function(){C.isFunction(n.old)&&n.old.call(this),n.queue&&C.dequeue(this,n.queue)},n},C.fn.extend({fadeTo:function(t,e,i,n){return this.filter($).css("opacity",0).show().end().animate({opacity:e},t,i,n)},animate:function(e,t,i,n){var r=C.isEmptyObject(e),s=C.speed(t,i,n),n=function(){var t=oe(this,C.extend({},e),s);(r||V.get(this,"finish"))&&t.stop(!0)};return n.finish=n,r||!1===s.queue?this.each(n):this.queue(s.queue,n)},stop:function(r,t,s){function o(t){var e=t.stop;delete t.stop,e(s)}return"string"!=typeof r&&(s=t,t=r,r=void 0),t&&!1!==r&&this.queue(r||"fx",[]),this.each(function(){var t=!0,e=null!=r&&r+"queueHooks",i=C.timers,n=V.get(this);if(e)n[e]&&n[e].stop&&o(n[e]);else for(e in n)n[e]&&n[e].stop&&ee.test(e)&&o(n[e]);for(e=i.length;e--;)i[e].elem!==this||null!=r&&i[e].queue!==r||(i[e].anim.stop(s),t=!1,i.splice(e,1));!t&&s||C.dequeue(this,r)})},finish:function(o){return!1!==o&&(o=o||"fx"),this.each(function(){var t,e=V.get(this),i=e[o+"queue"],n=e[o+"queueHooks"],r=C.timers,s=i?i.length:0;for(e.finish=!0,C.queue(this,o,[]),n&&n.stop&&n.stop.call(this,!0),t=r.length;t--;)r[t].elem===this&&r[t].queue===o&&(r[t].anim.stop(!0),r.splice(t,1));for(t=0;t<s;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete e.finish})}}),C.each(["toggle","show","hide"],function(t,n){var r=C.fn[n];C.fn[n]=function(t,e,i){return null==t||"boolean"==typeof t?r.apply(this,arguments):this.animate(re(n,!0),t,e,i)}}),C.each({slideDown:re("show"),slideUp:re("hide"),slideToggle:re("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,n){C.fn[t]=function(t,e,i){return this.animate(n,t,e,i)}}),C.timers=[],C.fx.tick=function(){var t,e=0,i=C.timers;for(Qt=C.now();e<i.length;e++)(t=i[e])()||i[e]!==t||i.splice(e--,1);i.length||C.fx.stop(),Qt=void 0},C.fx.timer=function(t){C.timers.push(t),t()?C.fx.start():C.timers.pop()},C.fx.interval=13,C.fx.start=function(){$t=$t||(z.requestAnimationFrame?z.requestAnimationFrame(ie):z.setInterval(C.fx.tick,C.fx.interval))},C.fx.stop=function(){z.cancelAnimationFrame?z.cancelAnimationFrame($t):z.clearInterval($t),$t=null},C.fx.speeds={slow:600,fast:200,_default:400},C.fn.delay=function(n,t){return n=C.fx&&C.fx.speeds[n]||n,t=t||"fx",this.queue(t,function(t,e){var i=z.setTimeout(t,n);e.stop=function(){z.clearTimeout(i)}})},e=w.createElement("input"),Z=w.createElement("select").appendChild(w.createElement("option")),e.type="checkbox",f.checkOn=""!==e.value,f.optSelected=Z.selected,(e=w.createElement("input")).value="t",e.type="radio",f.radioValue="t"===e.value;var ae,le=C.expr.attrHandle;C.fn.extend({attr:function(t,e){return U(this,C.attr,t,e,1<arguments.length)},removeAttr:function(t){return this.each(function(){C.removeAttr(this,t)})}}),C.extend({attr:function(t,e,i){var n,r,s=t.nodeType;if(3!==s&&8!==s&&2!==s)return void 0===t.getAttribute?C.prop(t,e,i):(1===s&&C.isXMLDoc(t)||(r=C.attrHooks[e.toLowerCase()]||(C.expr.match.bool.test(e)?ae:void 0)),void 0!==i?null===i?void C.removeAttr(t,e):r&&"set"in r&&void 0!==(n=r.set(t,i,e))?n:(t.setAttribute(e,i+""),i):r&&"get"in r&&null!==(n=r.get(t,e))?n:null==(n=C.find.attr(t,e))?void 0:n)},attrHooks:{type:{set:function(t,e){if(!f.radioValue&&"radio"===e&&C.nodeName(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,n=0,r=e&&e.match(D);if(r&&1===t.nodeType)for(;i=r[n++];)t.removeAttribute(i)}}),ae={set:function(t,e,i){return!1===e?C.removeAttr(t,i):t.setAttribute(i,i),i}},C.each(C.expr.match.bool.source.match(/\w+/g),function(t,e){var o=le[e]||C.find.attr;le[e]=function(t,e,i){var n,r,s=e.toLowerCase();return i||(r=le[s],le[s]=n,n=null!=o(t,e,i)?s:null,le[s]=r),n}});var pe=/^(?:input|select|textarea|button)$/i,he=/^(?:a|area)$/i;function ue(t){return(t.match(D)||[]).join(" ")}function ce(t){return t.getAttribute&&t.getAttribute("class")||""}C.fn.extend({prop:function(t,e){return U(this,C.prop,t,e,1<arguments.length)},removeProp:function(t){return this.each(function(){delete this[C.propFix[t]||t]})}}),C.extend({prop:function(t,e,i){var n,r,s=t.nodeType;if(3!==s&&8!==s&&2!==s)return 1===s&&C.isXMLDoc(t)||(e=C.propFix[e]||e,r=C.propHooks[e]),void 0!==i?r&&"set"in r&&void 0!==(n=r.set(t,i,e))?n:t[e]=i:r&&"get"in r&&null!==(n=r.get(t,e))?n:t[e]},propHooks:{tabIndex:{get:function(t){var e=C.find.attr(t,"tabindex");return e?parseInt(e,10):pe.test(t.nodeName)||he.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),f.optSelected||(C.propHooks.selected={get:function(t){t=t.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(t){t=t.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),C.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){C.propFix[this.toLowerCase()]=this}),C.fn.extend({addClass:function(e){var t,i,n,r,s,o,a=0;if(C.isFunction(e))return this.each(function(t){C(this).addClass(e.call(this,t,ce(this)))});if("string"==typeof e&&e)for(t=e.match(D)||[];i=this[a++];)if(o=ce(i),n=1===i.nodeType&&" "+ue(o)+" "){for(s=0;r=t[s++];)n.indexOf(" "+r+" ")<0&&(n+=r+" ");o!==(o=ue(n))&&i.setAttribute("class",o)}return this},removeClass:function(e){var t,i,n,r,s,o,a=0;if(C.isFunction(e))return this.each(function(t){C(this).removeClass(e.call(this,t,ce(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(D)||[];i=this[a++];)if(o=ce(i),n=1===i.nodeType&&" "+ue(o)+" "){for(s=0;r=t[s++];)for(;-1<n.indexOf(" "+r+" ");)n=n.replace(" "+r+" "," ");o!==(o=ue(n))&&i.setAttribute("class",o)}return this},toggleClass:function(r,e){var s=typeof r;return"boolean"==typeof e&&"string"==s?e?this.addClass(r):this.removeClass(r):C.isFunction(r)?this.each(function(t){C(this).toggleClass(r.call(this,t,ce(this),e),e)}):this.each(function(){var t,e,i,n;if("string"==s)for(e=0,i=C(this),n=r.match(D)||[];t=n[e++];)i.hasClass(t)?i.removeClass(t):i.addClass(t);else void 0!==r&&"boolean"!=s||((t=ce(this))&&V.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",!t&&!1!==r&&V.get(this,"__className__")||""))})},hasClass:function(t){for(var e,i=0,n=" "+t+" ";e=this[i++];)if(1===e.nodeType&&-1<(" "+ue(ce(e))+" ").indexOf(n))return!0;return!1}});var de=/\r/g;C.fn.extend({val:function(e){var i,t,n,r=this[0];return arguments.length?(n=C.isFunction(e),this.each(function(t){1===this.nodeType&&(null==(t=n?e.call(this,t,C(this).val()):e)?t="":"number"==typeof t?t+="":C.isArray(t)&&(t=C.map(t,function(t){return null==t?"":t+""})),(i=C.valHooks[this.type]||C.valHooks[this.nodeName.toLowerCase()])&&"set"in i&&void 0!==i.set(this,t,"value")||(this.value=t))})):r?(i=C.valHooks[r.type]||C.valHooks[r.nodeName.toLowerCase()])&&"get"in i&&void 0!==(t=i.get(r,"value"))?t:"string"==typeof(t=r.value)?t.replace(de,""):null==t?"":t:void 0}}),C.extend({valHooks:{option:{get:function(t){var e=C.find.attr(t,"value");return null!=e?e:ue(C.text(t))}},select:{get:function(t){for(var e,i=t.options,n=t.selectedIndex,r="select-one"===t.type,s=r?null:[],o=r?n+1:i.length,a=n<0?o:r?n:0;a<o;a++)if(((e=i[a]).selected||a===n)&&!e.disabled&&(!e.parentNode.disabled||!C.nodeName(e.parentNode,"optgroup"))){if(e=C(e).val(),r)return e;s.push(e)}return s},set:function(t,e){for(var i,n,r=t.options,s=C.makeArray(e),o=r.length;o--;)((n=r[o]).selected=-1<C.inArray(C.valHooks.option.get(n),s))&&(i=!0);return i||(t.selectedIndex=-1),s}}}}),C.each(["radio","checkbox"],function(){C.valHooks[this]={set:function(t,e){if(C.isArray(e))return t.checked=-1<C.inArray(C(t).val(),e)}},f.checkOn||(C.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})});var _e=/^(?:focusinfocus|focusoutblur)$/;C.extend(C.event,{trigger:function(t,e,i,n){var r,s,o,a,l,p,h=[i||w],u=_.call(t,"type")?t.type:t,c=_.call(t,"namespace")?t.namespace.split("."):[],d=s=i=i||w;if(3!==i.nodeType&&8!==i.nodeType&&!_e.test(u+C.event.triggered)&&(-1<u.indexOf(".")&&(u=(c=u.split(".")).shift(),c.sort()),a=u.indexOf(":")<0&&"on"+u,(t=t[C.expando]?t:new C.Event(u,"object"==typeof t&&t)).isTrigger=n?2:3,t.namespace=c.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+c.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=i),e=null==e?[t]:C.makeArray(e,[t]),p=C.event.special[u]||{},n||!p.trigger||!1!==p.trigger.apply(i,e))){if(!n&&!p.noBubble&&!C.isWindow(i)){for(o=p.delegateType||u,_e.test(o+u)||(d=d.parentNode);d;d=d.parentNode)h.push(d),s=d;s===(i.ownerDocument||w)&&h.push(s.defaultView||s.parentWindow||z)}for(r=0;(d=h[r++])&&!t.isPropagationStopped();)t.type=1<r?o:p.bindType||u,(l=(V.get(d,"events")||{})[t.type]&&V.get(d,"handle"))&&l.apply(d,e),(l=a&&d[a])&&l.apply&&G(d)&&(t.result=l.apply(d,e),!1===t.result&&t.preventDefault());return t.type=u,n||t.isDefaultPrevented()||p._default&&!1!==p._default.apply(h.pop(),e)||!G(i)||a&&C.isFunction(i[u])&&!C.isWindow(i)&&((s=i[a])&&(i[a]=null),i[C.event.triggered=u](),C.event.triggered=void 0,s&&(i[a]=s)),t.result}},simulate:function(t,e,i){t=C.extend(new C.Event,i,{type:t,isSimulated:!0});C.event.trigger(t,null,e)}}),C.fn.extend({trigger:function(t,e){return this.each(function(){C.event.trigger(t,e,this)})},triggerHandler:function(t,e){var i=this[0];if(i)return C.event.trigger(t,e,i,!0)}}),C.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(t,i){C.fn[i]=function(t,e){return 0<arguments.length?this.on(i,null,t,e):this.trigger(i)}}),C.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),f.focusin="onfocusin"in z,f.focusin||C.each({focus:"focusin",blur:"focusout"},function(i,n){function r(t){C.event.simulate(n,t.target,C.event.fix(t))}C.event.special[n]={setup:function(){var t=this.ownerDocument||this,e=V.access(t,n);e||t.addEventListener(i,r,!0),V.access(t,n,(e||0)+1)},teardown:function(){var t=this.ownerDocument||this,e=V.access(t,n)-1;e?V.access(t,n,e):(t.removeEventListener(i,r,!0),V.remove(t,n))}}});var ye=z.location,fe=C.now(),me=/\?/;C.parseXML=function(t){var e;if(!t||"string"!=typeof t)return null;try{e=(new z.DOMParser).parseFromString(t,"text/xml")}catch(t){e=void 0}return e&&!e.getElementsByTagName("parsererror").length||C.error("Invalid XML: "+t),e};var xe=/\[\]$/,ve=/\r?\n/g,ge=/^(?:submit|button|image|reset|file)$/i,be=/^(?:input|select|textarea|keygen)/i;C.param=function(t,e){function i(t,e){e=C.isFunction(e)?e():e,r[r.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==e?"":e)}var n,r=[];if(C.isArray(t)||t.jquery&&!C.isPlainObject(t))C.each(t,function(){i(this.name,this.value)});else for(n in t)!function i(n,t,r,s){if(C.isArray(t))C.each(t,function(t,e){r||xe.test(n)?s(n,e):i(n+"["+("object"==typeof e&&null!=e?t:"")+"]",e,r,s)});else if(r||"object"!==C.type(t))s(n,t);else for(var e in t)i(n+"["+e+"]",t[e],r,s)}(n,t[n],e,i);return r.join("&")},C.fn.extend({serialize:function(){return C.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=C.prop(this,"elements");return t?C.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!C(this).is(":disabled")&&be.test(this.nodeName)&&!ge.test(t)&&(this.checked||!nt.test(t))}).map(function(t,e){var i=C(this).val();return null==i?null:C.isArray(i)?C.map(i,function(t){return{name:e.name,value:t.replace(ve,"\r\n")}}):{name:e.name,value:i.replace(ve,"\r\n")}}).get()}});var ze=/%20/g,we=/#.*$/,Ce=/([?&])_=[^&]*/,Pe=/^(.*?):[ \t]*([^\r\n]*)$/gm,Te=/^(?:GET|HEAD)$/,Se=/^\/\//,Me={},Ae={},Oe="*/".concat("*"),ke=w.createElement("a");function Ee(s){return function(t,e){"string"!=typeof t&&(e=t,t="*");var i,n=0,r=t.toLowerCase().match(D)||[];if(C.isFunction(e))for(;i=r[n++];)"+"===i[0]?(i=i.slice(1)||"*",(s[i]=s[i]||[]).unshift(e)):(s[i]=s[i]||[]).push(e)}}function Ie(e,n,r,s){var o={},a=e===Ae;function l(t){var i;return o[t]=!0,C.each(e[t]||[],function(t,e){e=e(n,r,s);return"string"!=typeof e||a||o[e]?a?!(i=e):void 0:(n.dataTypes.unshift(e),l(e),!1)}),i}return l(n.dataTypes[0])||!o["*"]&&l("*")}function De(t,e){var i,n,r=C.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((r[i]?t:n=n||{})[i]=e[i]);return n&&C.extend(!0,t,n),t}ke.href=ye.href,C.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ye.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(ye.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Oe,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":C.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?De(De(t,C.ajaxSettings),e):De(C.ajaxSettings,t)},ajaxPrefilter:Ee(Me),ajaxTransport:Ee(Ae),ajax:function(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var l,p,h,i,u,n,c,d,r,_=C.ajaxSetup({},e),y=_.context||_,f=_.context&&(y.nodeType||y.jquery)?C(y):C.event,m=C.Deferred(),x=C.Callbacks("once memory"),v=_.statusCode||{},s={},o={},a="canceled",g={readyState:0,getResponseHeader:function(t){var e;if(c){if(!i)for(i={};e=Pe.exec(h);)i[e[1].toLowerCase()]=e[2];e=i[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return c?h:null},setRequestHeader:function(t,e){return null==c&&(t=o[t.toLowerCase()]=o[t.toLowerCase()]||t,s[t]=e),this},overrideMimeType:function(t){return null==c&&(_.mimeType=t),this},statusCode:function(t){if(t)if(c)g.always(t[g.status]);else for(var e in t)v[e]=[v[e],t[e]];return this},abort:function(t){t=t||a;return l&&l.abort(t),b(0,t),this}};if(m.promise(g),_.url=((t||_.url||ye.href)+"").replace(Se,ye.protocol+"//"),_.type=e.method||e.type||_.method||_.type,_.dataTypes=(_.dataType||"*").toLowerCase().match(D)||[""],null==_.crossDomain){n=w.createElement("a");try{n.href=_.url,n.href=n.href,_.crossDomain=ke.protocol+"//"+ke.host!=n.protocol+"//"+n.host}catch(t){_.crossDomain=!0}}if(_.data&&_.processData&&"string"!=typeof _.data&&(_.data=C.param(_.data,_.traditional)),Ie(Me,_,e,g),c)return g;for(r in(d=C.event&&_.global)&&0==C.active++&&C.event.trigger("ajaxStart"),_.type=_.type.toUpperCase(),_.hasContent=!Te.test(_.type),p=_.url.replace(we,""),_.hasContent?_.data&&_.processData&&0===(_.contentType||"").indexOf("application/x-www-form-urlencoded")&&(_.data=_.data.replace(ze,"+")):(t=_.url.slice(p.length),_.data&&(p+=(me.test(p)?"&":"?")+_.data,delete _.data),!1===_.cache&&(p=p.replace(Ce,"$1"),t=(me.test(p)?"&":"?")+"_="+fe+++t),_.url=p+t),_.ifModified&&(C.lastModified[p]&&g.setRequestHeader("If-Modified-Since",C.lastModified[p]),C.etag[p]&&g.setRequestHeader("If-None-Match",C.etag[p])),(_.data&&_.hasContent&&!1!==_.contentType||e.contentType)&&g.setRequestHeader("Content-Type",_.contentType),g.setRequestHeader("Accept",_.dataTypes[0]&&_.accepts[_.dataTypes[0]]?_.accepts[_.dataTypes[0]]+("*"!==_.dataTypes[0]?", "+Oe+"; q=0.01":""):_.accepts["*"]),_.headers)g.setRequestHeader(r,_.headers[r]);if(_.beforeSend&&(!1===_.beforeSend.call(y,g,_)||c))return g.abort();if(a="abort",x.add(_.complete),g.done(_.success),g.fail(_.error),l=Ie(Ae,_,e,g)){if(g.readyState=1,d&&f.trigger("ajaxSend",[g,_]),c)return g;_.async&&0<_.timeout&&(u=z.setTimeout(function(){g.abort("timeout")},_.timeout));try{c=!1,l.send(s,b)}catch(t){if(c)throw t;b(-1,t)}}else b(-1,"No Transport");function b(t,e,i,n){var r,s,o,a=e;c||(c=!0,u&&z.clearTimeout(u),l=void 0,h=n||"",g.readyState=0<t?4:0,n=200<=t&&t<300||304===t,i&&(o=function(t,e,i){for(var n,r,s,o,a=t.contents,l=t.dataTypes;"*"===l[0];)l.shift(),void 0===n&&(n=t.mimeType||e.getResponseHeader("Content-Type"));if(n)for(r in a)if(a[r]&&a[r].test(n)){l.unshift(r);break}if(l[0]in i)s=l[0];else{for(r in i){if(!l[0]||t.converters[r+" "+l[0]]){s=r;break}o=o||r}s=s||o}if(s)return s!==l[0]&&l.unshift(s),i[s]}(_,g,i)),o=function(t,e,i,n){var r,s,o,a,l,p={},h=t.dataTypes.slice();if(h[1])for(o in t.converters)p[o.toLowerCase()]=t.converters[o];for(s=h.shift();s;)if(t.responseFields[s]&&(i[t.responseFields[s]]=e),!l&&n&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=s,s=h.shift())if("*"===s)s=l;else if("*"!==l&&l!==s){if(!(o=p[l+" "+s]||p["* "+s]))for(r in p)if(a=r.split(" "),a[1]===s&&(o=p[l+" "+a[0]]||p["* "+a[0]])){!0===o?o=p[r]:!0!==p[r]&&(s=a[0],h.unshift(a[1]));break}if(!0!==o)if(o&&t.throws)e=o(e);else try{e=o(e)}catch(t){return{state:"parsererror",error:o?t:"No conversion from "+l+" to "+s}}}return{state:"success",data:e}}(_,o,g,n),n?(_.ifModified&&((i=g.getResponseHeader("Last-Modified"))&&(C.lastModified[p]=i),(i=g.getResponseHeader("etag"))&&(C.etag[p]=i)),204===t||"HEAD"===_.type?a="nocontent":304===t?a="notmodified":(a=o.state,r=o.data,n=!(s=o.error))):(s=a,!t&&a||(a="error",t<0&&(t=0))),g.status=t,g.statusText=(e||a)+"",n?m.resolveWith(y,[r,a,g]):m.rejectWith(y,[g,a,s]),g.statusCode(v),v=void 0,d&&f.trigger(n?"ajaxSuccess":"ajaxError",[g,_,n?r:s]),x.fireWith(y,[g,a]),d&&(f.trigger("ajaxComplete",[g,_]),--C.active||C.event.trigger("ajaxStop")))}return g},getJSON:function(t,e,i){return C.get(t,e,i,"json")},getScript:function(t,e){return C.get(t,void 0,e,"script")}}),C.each(["get","post"],function(t,r){C[r]=function(t,e,i,n){return C.isFunction(e)&&(n=n||i,i=e,e=void 0),C.ajax(C.extend({url:t,type:r,dataType:n,data:e,success:i},C.isPlainObject(t)&&t))}}),C._evalUrl=function(t){return C.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},C.fn.extend({wrapAll:function(t){return this[0]&&(C.isFunction(t)&&(t=t.call(this[0])),t=C(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t}).append(this)),this},wrapInner:function(i){return C.isFunction(i)?this.each(function(t){C(this).wrapInner(i.call(this,t))}):this.each(function(){var t=C(this),e=t.contents();e.length?e.wrapAll(i):t.append(i)})},wrap:function(e){var i=C.isFunction(e);return this.each(function(t){C(this).wrapAll(i?e.call(this,t):e)})},unwrap:function(t){return this.parent(t).not("body").each(function(){C(this).replaceWith(this.childNodes)}),this}}),C.expr.pseudos.hidden=function(t){return!C.expr.pseudos.visible(t)},C.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},C.ajaxSettings.xhr=function(){try{return new z.XMLHttpRequest}catch(t){}};var Be={0:200,1223:204},Le=C.ajaxSettings.xhr();f.cors=!!Le&&"withCredentials"in Le,f.ajax=Le=!!Le,C.ajaxTransport(function(r){var s,o;if(f.cors||Le&&!r.crossDomain)return{send:function(t,e){var i,n=r.xhr();if(n.open(r.type,r.url,r.async,r.username,r.password),r.xhrFields)for(i in r.xhrFields)n[i]=r.xhrFields[i];for(i in r.mimeType&&n.overrideMimeType&&n.overrideMimeType(r.mimeType),r.crossDomain||t["X-Requested-With"]||(t["X-Requested-With"]="XMLHttpRequest"),t)n.setRequestHeader(i,t[i]);s=function(t){return function(){s&&(s=o=n.onload=n.onerror=n.onabort=n.onreadystatechange=null,"abort"===t?n.abort():"error"===t?"number"!=typeof n.status?e(0,"error"):e(n.status,n.statusText):e(Be[n.status]||n.status,n.statusText,"text"!==(n.responseType||"text")||"string"!=typeof n.responseText?{binary:n.response}:{text:n.responseText},n.getAllResponseHeaders()))}},n.onload=s(),o=n.onerror=s("error"),void 0!==n.onabort?n.onabort=o:n.onreadystatechange=function(){4===n.readyState&&z.setTimeout(function(){s&&o()})},s=s("abort");try{n.send(r.hasContent&&r.data||null)}catch(t){if(s)throw t}},abort:function(){s&&s()}}}),C.ajaxPrefilter(function(t){t.crossDomain&&(t.contents.script=!1)}),C.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return C.globalEval(t),t}}}),C.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),C.ajaxTransport("script",function(i){var n,r;if(i.crossDomain)return{send:function(t,e){n=C("<script>").prop({charset:i.scriptCharset,src:i.url}).on("load error",r=function(t){n.remove(),r=null,t&&e("error"===t.type?404:200,t.type)}),w.head.appendChild(n[0])},abort:function(){r&&r()}}});var Re=[],Fe=/(=)\?(?=&|$)|\?\?/;function je(t){return C.isWindow(t)?t:9===t.nodeType&&t.defaultView}C.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Re.pop()||C.expando+"_"+fe++;return this[t]=!0,t}}),C.ajaxPrefilter("json jsonp",function(t,e,i){var n,r,s,o=!1!==t.jsonp&&(Fe.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Fe.test(t.data)&&"data");if(o||"jsonp"===t.dataTypes[0])return n=t.jsonpCallback=C.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,o?t[o]=t[o].replace(Fe,"$1"+n):!1!==t.jsonp&&(t.url+=(me.test(t.url)?"&":"?")+t.jsonp+"="+n),t.converters["script json"]=function(){return s||C.error(n+" was not called"),s[0]},t.dataTypes[0]="json",r=z[n],z[n]=function(){s=arguments},i.always(function(){void 0===r?C(z).removeProp(n):z[n]=r,t[n]&&(t.jsonpCallback=e.jsonpCallback,Re.push(n)),s&&C.isFunction(r)&&r(s[0]),s=r=void 0}),"script"}),f.createHTMLDocument=((e=w.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===e.childNodes.length),C.parseHTML=function(t,e,i){return"string"!=typeof t?[]:("boolean"==typeof e&&(i=e,e=!1),e||(f.createHTMLDocument?((n=(e=w.implementation.createHTMLDocument("")).createElement("base")).href=w.location.href,e.head.appendChild(n)):e=w),n=!i&&[],(i=T.exec(t))?[e.createElement(i[1])]:(i=ht([t],e,n),n&&n.length&&C(n).remove(),C.merge([],i.childNodes)));var n},C.fn.load=function(t,e,i){var n,r,s,o=this,a=t.indexOf(" ");return-1<a&&(n=ue(t.slice(a)),t=t.slice(0,a)),C.isFunction(e)?(i=e,e=void 0):e&&"object"==typeof e&&(r="POST"),0<o.length&&C.ajax({url:t,type:r||"GET",dataType:"html",data:e}).done(function(t){s=arguments,o.html(n?C("<div>").append(C.parseHTML(t)).find(n):t)}).always(i&&function(t,e){o.each(function(){i.apply(this,s||[t.responseText,e,t])})}),this},C.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){C.fn[e]=function(t){return this.on(e,t)}}),C.expr.pseudos.animated=function(e){return C.grep(C.timers,function(t){return e===t.elem}).length},C.offset={setOffset:function(t,e,i){var n,r,s,o,a=C.css(t,"position"),l=C(t),p={};"static"===a&&(t.style.position="relative"),s=l.offset(),n=C.css(t,"top"),o=C.css(t,"left"),o=("absolute"===a||"fixed"===a)&&-1<(n+o).indexOf("auto")?(r=(a=l.position()).top,a.left):(r=parseFloat(n)||0,parseFloat(o)||0),C.isFunction(e)&&(e=e.call(t,i,C.extend({},s))),null!=e.top&&(p.top=e.top-s.top+r),null!=e.left&&(p.left=e.left-s.left+o),"using"in e?e.using.call(t,p):l.css(p)}},C.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){C.offset.setOffset(this,e,t)});var t,i,n=this[0];return n?n.getClientRects().length?(t=n.getBoundingClientRect()).width||t.height?(n=je(i=n.ownerDocument),i=i.documentElement,{top:t.top+n.pageYOffset-i.clientTop,left:t.left+n.pageXOffset-i.clientLeft}):t:{top:0,left:0}:void 0},position:function(){if(this[0]){var t,e,i=this[0],n={top:0,left:0};return"fixed"===C.css(i,"position")?e=i.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),C.nodeName(t[0],"html")||(n=t.offset()),n={top:n.top+C.css(t[0],"borderTopWidth",!0),left:n.left+C.css(t[0],"borderLeftWidth",!0)}),{top:e.top-n.top-C.css(i,"marginTop",!0),left:e.left-n.left-C.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent;t&&"static"===C.css(t,"position");)t=t.offsetParent;return t||ut})}}),C.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,r){var s="pageYOffset"===r;C.fn[e]=function(t){return U(this,function(t,e,i){var n=je(t);return void 0===i?n?n[r]:t[e]:void(n?n.scrollTo(s?n.pageXOffset:i,s?i:n.pageYOffset):t[e]=i)},e,t,arguments.length)}}),C.each(["top","left"],function(t,i){C.cssHooks[i]=Gt(f.pixelPosition,function(t,e){if(e)return e=Nt(t,i),Rt.test(e)?C(t).position()[i]+"px":e})}),C.each({Height:"height",Width:"width"},function(o,a){C.each({padding:"inner"+o,content:a,"":"outer"+o},function(n,s){C.fn[s]=function(t,e){var i=arguments.length&&(n||"boolean"!=typeof t),r=n||(!0===t||!0===e?"margin":"border");return U(this,function(t,e,i){var n;return C.isWindow(t)?0===s.indexOf("outer")?t["inner"+o]:t.document.documentElement["client"+o]:9===t.nodeType?(n=t.documentElement,Math.max(t.body["scroll"+o],n["scroll"+o],t.body["offset"+o],n["offset"+o],n["client"+o])):void 0===i?C.css(t,e,r):C.style(t,e,i,r)},a,i?t:void 0,i)}})}),C.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,n){return this.on(e,t,i,n)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)}}),C.parseJSON=JSON.parse,"function"==typeof define&&define.amd&&define("jquery",[],function(){return C});var Ne=z.jQuery,Ge=z.$;return C.noConflict=function(t){return z.$===C&&(z.$=Ge),t&&z.jQuery===C&&(z.jQuery=Ne),C},t||(z.jQuery=z.$=C),C}),this.createjs=this.createjs||{},createjs.extend=function(t,e){"use strict";function i(){this.constructor=t}return i.prototype=e.prototype,t.prototype=new i},this.createjs=this.createjs||{},createjs.promote=function(t,e){"use strict";var i=t.prototype,n=Object.getPrototypeOf&&Object.getPrototypeOf(i)||i.__proto__;if(n)for(var r in i[(e+="_")+"constructor"]=n.constructor,n)i.hasOwnProperty(r)&&"function"==typeof n[r]&&(i[e+r]=n[r]);return t},this.createjs=this.createjs||{},createjs.indexOf=function(t,e){"use strict";for(var i=0,n=t.length;i<n;i++)if(e===t[i])return i;return-1},this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i){this.type=t,this.target=null,this.currentTarget=null,this.eventPhase=0,this.bubbles=!!e,this.cancelable=!!i,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1}var e=t.prototype;e.preventDefault=function(){this.defaultPrevented=this.cancelable&&!0},e.stopPropagation=function(){this.propagationStopped=!0},e.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},e.remove=function(){this.removed=!0},e.clone=function(){return new t(this.type,this.bubbles,this.cancelable)},e.set=function(t){for(var e in t)this[e]=t[e];return this},e.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(){this._listeners=null,this._captureListeners=null}var e=t.prototype;t.initialize=function(t){t.addEventListener=e.addEventListener,t.on=e.on,t.removeEventListener=t.off=e.removeEventListener,t.removeAllEventListeners=e.removeAllEventListeners,t.hasEventListener=e.hasEventListener,t.dispatchEvent=e.dispatchEvent,t._dispatchEvent=e._dispatchEvent,t.willTrigger=e.willTrigger},e.addEventListener=function(t,e,i){var n=i?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{},r=n[t];return r&&this.removeEventListener(t,e,i),(r=n[t])?r.push(e):n[t]=[e],e},e.on=function(t,e,i,n,r,s){return e.handleEvent&&(i=i||e,e=e.handleEvent),i=i||this,this.addEventListener(t,function(t){e.call(i,t,r),n&&t.remove()},s)},e.removeEventListener=function(t,e,i){var n=i?this._captureListeners:this._listeners;if(n){var r=n[t];if(r)for(var s=0,o=r.length;s<o;s++)if(r[s]==e){1==o?delete n[t]:r.splice(s,1);break}}},e.off=e.removeEventListener,e.removeAllEventListeners=function(t){t?(this._listeners&&delete this._listeners[t],this._captureListeners&&delete this._captureListeners[t]):this._listeners=this._captureListeners=null},e.dispatchEvent=function(t,e,i){if("string"==typeof t){var n=this._listeners;if(!(e||n&&n[t]))return!0;t=new createjs.Event(t,e,i)}else t.target&&t.clone&&(t=t.clone());try{t.target=this}catch(t){}if(t.bubbles&&this.parent){for(var r=this,s=[r];r.parent;)s.push(r=r.parent);for(var o=s.length,a=o-1;0<=a&&!t.propagationStopped;a--)s[a]._dispatchEvent(t,1+(0==a));for(a=1;a<o&&!t.propagationStopped;a++)s[a]._dispatchEvent(t,3)}else this._dispatchEvent(t,2);return!t.defaultPrevented},e.hasEventListener=function(t){var e=this._listeners,i=this._captureListeners;return!!(e&&e[t]||i&&i[t])},e.willTrigger=function(t){for(var e=this;e;){if(e.hasEventListener(t))return!0;e=e.parent}return!1},e.toString=function(){return"[EventDispatcher]"},e._dispatchEvent=function(t,e){var i,n=1==e?this._captureListeners:this._listeners;if(t&&n){var r=n[t.type];if(r&&(i=r.length)){try{t.currentTarget=this}catch(t){}try{t.eventPhase=e}catch(t){}t.removed=!1,r=r.slice();for(var s=0;s<i&&!t.immediatePropagationStopped;s++){var o=r[s];o.handleEvent?o.handleEvent(t):o(t),t.removed&&(this.off(t.type,o,1==e),t.removed=!1)}}}},createjs.EventDispatcher=t}(),this.createjs=this.createjs||{},function(){"use strict";function s(){throw"Ticker cannot be instantiated."}s.RAF_SYNCHED="synched",s.RAF="raf",s.TIMEOUT="timeout",s.useRAF=!1,s.timingMode=null,s.maxDelta=0,s.paused=!1,s.removeEventListener=null,s.removeAllEventListeners=null,s.dispatchEvent=null,s.hasEventListener=null,s._listeners=null,createjs.EventDispatcher.initialize(s),s._addEventListener=s.addEventListener,s.addEventListener=function(){return s._inited||s.init(),s._addEventListener.apply(s,arguments)},s._inited=!1,s._startTime=0,s._pausedTime=0,s._ticks=0,s._pausedTicks=0,s._interval=50,s._lastTime=0,s._times=null,s._tickTimes=null,s._timerId=null,s._raf=!0,s.setInterval=function(t){s._interval=t,s._inited&&s._setupTick()},s.getInterval=function(){return s._interval},s.setFPS=function(t){s.setInterval(1e3/t)},s.getFPS=function(){return 1e3/s._interval};try{Object.defineProperties(s,{interval:{get:s.getInterval,set:s.setInterval},framerate:{get:s.getFPS,set:s.setFPS}})}catch(t){console.log(t)}s.init=function(){s._inited||(s._inited=!0,s._times=[],s._tickTimes=[],s._startTime=s._getTime(),s._times.push(s._lastTime=0),s.interval=s._interval)},s.reset=function(){var t;s._raf?(t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame)&&t(s._timerId):clearTimeout(s._timerId),s.removeAllEventListeners("tick"),s._timerId=s._times=s._tickTimes=null,s._startTime=s._lastTime=s._ticks=0,s._inited=!1},s.getMeasuredTickTime=function(t){var e=0,i=s._tickTimes;if(!i||i.length<1)return-1;t=Math.min(i.length,t||0|s.getFPS());for(var n=0;n<t;n++)e+=i[n];return e/t},s.getMeasuredFPS=function(t){var e=s._times;return!e||e.length<2?-1:(t=Math.min(e.length-1,t||0|s.getFPS()),1e3/((e[0]-e[t])/t))},s.setPaused=function(t){s.paused=t},s.getPaused=function(){return s.paused},s.getTime=function(t){return s._startTime?s._getTime()-(t?s._pausedTime:0):-1},s.getEventTime=function(t){return s._startTime?(s._lastTime||s._startTime)-(t?s._pausedTime:0):-1},s.getTicks=function(t){return s._ticks-(t?s._pausedTicks:0)},s._handleSynch=function(){s._timerId=null,s._setupTick(),s._getTime()-s._lastTime>=.97*(s._interval-1)&&s._tick()},s._handleRAF=function(){s._timerId=null,s._setupTick(),s._tick()},s._handleTimeout=function(){s._timerId=null,s._setupTick(),s._tick()},s._setupTick=function(){if(null==s._timerId){var t=s.timingMode||s.useRAF&&s.RAF_SYNCHED;if(t==s.RAF_SYNCHED||t==s.RAF){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(e)return s._timerId=e(t==s.RAF?s._handleRAF:s._handleSynch),void(s._raf=!0)}s._raf=!1,s._timerId=setTimeout(s._handleTimeout,s._interval)}},s._tick=function(){var t,e,i=s.paused,n=s._getTime(),r=n-s._lastTime;for(s._lastTime=n,s._ticks++,i&&(s._pausedTicks++,s._pausedTime+=r),s.hasEventListener("tick")&&(t=new createjs.Event("tick"),e=s.maxDelta,t.delta=e&&e<r?e:r,t.paused=i,t.time=n,t.runTime=n-s._pausedTime,s.dispatchEvent(t)),s._tickTimes.unshift(s._getTime()-n);100<s._tickTimes.length;)s._tickTimes.pop();for(s._times.unshift(n);100<s._times.length;)s._times.pop()};var t=window.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow);s._getTime=function(){return(t&&t.call(performance)||(new Date).getTime())-s._startTime},createjs.Ticker=s}(),this.createjs=this.createjs||{},function(){"use strict";function t(){throw"UID cannot be instantiated"}t._nextID=0,t.get=function(){return t._nextID++},createjs.UID=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i,n,r,s,o,a,l,p,h){this.Event_constructor(t,e,i),this.stageX=n,this.stageY=r,this.rawX=null==l?n:l,this.rawY=null==p?r:p,this.nativeEvent=s,this.pointerID=o,this.primary=!!a,this.relatedTarget=h}var e=createjs.extend(t,createjs.Event);e._get_localX=function(){return this.currentTarget.globalToLocal(this.rawX,this.rawY).x},e._get_localY=function(){return this.currentTarget.globalToLocal(this.rawX,this.rawY).y},e._get_isTouch=function(){return-1!==this.pointerID};try{Object.defineProperties(e,{localX:{get:e._get_localX},localY:{get:e._get_localY},isTouch:{get:e._get_isTouch}})}catch(t){}e.clone=function(){return new t(this.type,this.bubbles,this.cancelable,this.stageX,this.stageY,this.nativeEvent,this.pointerID,this.primary,this.rawX,this.rawY)},e.toString=function(){return"[MouseEvent (type="+this.type+" stageX="+this.stageX+" stageY="+this.stageY+")]"},createjs.MouseEvent=createjs.promote(t,"Event")}(),this.createjs=this.createjs||{},function(){"use strict";function u(t,e,i,n,r,s){this.setValues(t,e,i,n,r,s)}var t=u.prototype;u.DEG_TO_RAD=Math.PI/180,u.identity=null,t.setValues=function(t,e,i,n,r,s){return this.a=null==t?1:t,this.b=e||0,this.c=i||0,this.d=null==n?1:n,this.tx=r||0,this.ty=s||0,this},t.append=function(t,e,i,n,r,s){var o=this.a,a=this.b,l=this.c,p=this.d;return 1==t&&0==e&&0==i&&1==n||(this.a=o*t+l*e,this.b=a*t+p*e,this.c=o*i+l*n,this.d=a*i+p*n),this.tx=o*r+l*s+this.tx,this.ty=a*r+p*s+this.ty,this},t.prepend=function(t,e,i,n,r,s){var o=this.a,a=this.c,l=this.tx;return this.a=t*o+i*this.b,this.b=e*o+n*this.b,this.c=t*a+i*this.d,this.d=e*a+n*this.d,this.tx=t*l+i*this.ty+r,this.ty=e*l+n*this.ty+s,this},t.appendMatrix=function(t){return this.append(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prependMatrix=function(t){return this.prepend(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.appendTransform=function(t,e,i,n,r,s,o,a,l){var p,h=r%360?(h=r*u.DEG_TO_RAD,p=Math.cos(h),Math.sin(h)):(p=1,0);return s||o?(s*=u.DEG_TO_RAD,o*=u.DEG_TO_RAD,this.append(Math.cos(o),Math.sin(o),-Math.sin(s),Math.cos(s),t,e),this.append(p*i,h*i,-h*n,p*n,0,0)):this.append(p*i,h*i,-h*n,p*n,t,e),(a||l)&&(this.tx-=a*this.a+l*this.c,this.ty-=a*this.b+l*this.d),this},t.prependTransform=function(t,e,i,n,r,s,o,a,l){var p,h=r%360?(h=r*u.DEG_TO_RAD,p=Math.cos(h),Math.sin(h)):(p=1,0);return(a||l)&&(this.tx-=a,this.ty-=l),s||o?(s*=u.DEG_TO_RAD,o*=u.DEG_TO_RAD,this.prepend(p*i,h*i,-h*n,p*n,0,0),this.prepend(Math.cos(o),Math.sin(o),-Math.sin(s),Math.cos(s),t,e)):this.prepend(p*i,h*i,-h*n,p*n,t,e),this},t.rotate=function(t){t*=u.DEG_TO_RAD;var e=Math.cos(t),i=Math.sin(t),n=this.a,t=this.b;return this.a=n*e+this.c*i,this.b=t*e+this.d*i,this.c=-n*i+this.c*e,this.d=-t*i+this.d*e,this},t.skew=function(t,e){return t*=u.DEG_TO_RAD,e*=u.DEG_TO_RAD,this.append(Math.cos(e),Math.sin(e),-Math.sin(t),Math.cos(t),0,0),this},t.scale=function(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this},t.translate=function(t,e){return this.tx+=this.a*t+this.c*e,this.ty+=this.b*t+this.d*e,this},t.identity=function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},t.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,r=this.tx,s=t*n-e*i;return this.a=n/s,this.b=-e/s,this.c=-i/s,this.d=t/s,this.tx=(i*this.ty-n*r)/s,this.ty=-(t*this.ty-e*r)/s,this},t.isIdentity=function(){return 0===this.tx&&0===this.ty&&1===this.a&&0===this.b&&0===this.c&&1===this.d},t.equals=function(t){return this.tx===t.tx&&this.ty===t.ty&&this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d},t.transformPoint=function(t,e,i){return(i=i||{}).x=t*this.a+e*this.c+this.tx,i.y=t*this.b+e*this.d+this.ty,i},t.decompose=function(t){null==t&&(t={}),t.x=this.tx,t.y=this.ty,t.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),t.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var e=Math.atan2(-this.c,this.d),i=Math.atan2(this.b,this.a);return Math.abs(1-e/i)<1e-5?(t.rotation=i/u.DEG_TO_RAD,this.a<0&&0<=this.d&&(t.rotation+=t.rotation<=0?180:-180),t.skewX=t.skewY=0):(t.skewX=e/u.DEG_TO_RAD,t.skewY=i/u.DEG_TO_RAD),t},t.copy=function(t){return this.setValues(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.clone=function(){return new u(this.a,this.b,this.c,this.d,this.tx,this.ty)},t.toString=function(){return"[Matrix2D (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"},u.identity=new u,createjs.Matrix2D=u}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i,n,r){this.setValues(t,e,i,n,r)}var e=t.prototype;e.setValues=function(t,e,i,n,r){return this.visible=null==t||!!t,this.alpha=null==e?1:e,this.shadow=i,this.compositeOperation=n,this.matrix=r||this.matrix&&this.matrix.identity()||new createjs.Matrix2D,this},e.append=function(t,e,i,n,r){return this.alpha*=e,this.shadow=i||this.shadow,this.compositeOperation=n||this.compositeOperation,this.visible=this.visible&&t,r&&this.matrix.appendMatrix(r),this},e.prepend=function(t,e,i,n,r){return this.alpha*=e,this.shadow=this.shadow||i,this.compositeOperation=this.compositeOperation||n,this.visible=this.visible&&t,r&&this.matrix.prependMatrix(r),this},e.identity=function(){return this.visible=!0,this.alpha=1,this.shadow=this.compositeOperation=null,this.matrix.identity(),this},e.clone=function(){return new t(this.alpha,this.shadow,this.compositeOperation,this.visible,this.matrix.clone())},createjs.DisplayProps=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e){this.setValues(t,e)}var e=t.prototype;e.setValues=function(t,e){return this.x=t||0,this.y=e||0,this},e.copy=function(t){return this.x=t.x,this.y=t.y,this},e.clone=function(){return new t(this.x,this.y)},e.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"},createjs.Point=t}(),this.createjs=this.createjs||{},function(){"use strict";function r(t,e,i,n){this.setValues(t,e,i,n)}var t=r.prototype;t.setValues=function(t,e,i,n){return this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0,this},t.extend=function(t,e,i,n){return n=n||0,t+(i=i||0)>this.x+this.width&&(this.width=t+i-this.x),e+n>this.y+this.height&&(this.height=e+n-this.y),t<this.x&&(this.width+=this.x-t,this.x=t),e<this.y&&(this.height+=this.y-e,this.y=e),this},t.pad=function(t,e,i,n){return this.x-=e,this.y-=t,this.width+=e+n,this.height+=t+i,this},t.copy=function(t){return this.setValues(t.x,t.y,t.width,t.height)},t.contains=function(t,e,i,n){return i=i||0,n=n||0,t>=this.x&&t+i<=this.x+this.width&&e>=this.y&&e+n<=this.y+this.height},t.union=function(t){return this.clone().extend(t.x,t.y,t.width,t.height)},t.intersection=function(t){var e=t.x,i=t.y,n=e+t.width,t=i+t.height;return this.x>e&&(e=this.x),this.y>i&&(i=this.y),this.x+this.width<n&&(n=this.x+this.width),this.y+this.height<t&&(t=this.y+this.height),n<=e||t<=i?null:new r(e,i,n-e,t-i)},t.intersects=function(t){return t.x<=this.x+this.width&&this.x<=t.x+t.width&&t.y<=this.y+this.height&&this.y<=t.y+t.height},t.isEmpty=function(){return this.width<=0||this.height<=0},t.clone=function(){return new r(this.x,this.y,this.width,this.height)},t.toString=function(){return"[Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")]"},createjs.Rectangle=r}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i,n,r,s,o){t.addEventListener&&(this.target=t,this.overLabel=null==i?"over":i,this.outLabel=null==e?"out":e,this.downLabel=null==n?"down":n,this.play=r,this._isPressed=!1,this._isOver=!1,this._enabled=!1,t.mouseChildren=!1,this.enabled=!0,this.handleEvent({}),s&&(o&&(s.actionsEnabled=!1,s.gotoAndStop&&s.gotoAndStop(o)),t.hitArea=s))}var e=t.prototype;e.setEnabled=function(t){var e;t!=this._enabled&&(e=this.target,(this._enabled=t)?(e.cursor="pointer",e.addEventListener("rollover",this),e.addEventListener("rollout",this),e.addEventListener("mousedown",this),e.addEventListener("pressup",this),e._reset&&(e.__reset=e._reset,e._reset=this._reset)):(e.cursor=null,e.removeEventListener("rollover",this),e.removeEventListener("rollout",this),e.removeEventListener("mousedown",this),e.removeEventListener("pressup",this),e.__reset&&(e._reset=e.__reset,delete e.__reset)))},e.getEnabled=function(){return this._enabled};try{Object.defineProperties(e,{enabled:{get:e.getEnabled,set:e.setEnabled}})}catch(t){}e.toString=function(){return"[ButtonHelper]"},e.handleEvent=function(t){var e=this.target,t=t.type,t="mousedown"==t?(this._isPressed=!0,this.downLabel):"pressup"==t?(this._isPressed=!1,this._isOver?this.overLabel:this.outLabel):"rollover"==t?(this._isOver=!0,this._isPressed?this.downLabel:this.overLabel):(this._isOver=!1,this._isPressed?this.overLabel:this.outLabel);this.play?e.gotoAndPlay&&e.gotoAndPlay(t):e.gotoAndStop&&e.gotoAndStop(t)},e._reset=function(){var t=this.paused;this.__reset(),this.paused=t},createjs.ButtonHelper=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i,n){this.color=t||"black",this.offsetX=e||0,this.offsetY=i||0,this.blur=n||0}var e=t.prototype;t.identity=new t("transparent",0,0,0),e.toString=function(){return"[Shadow]"},e.clone=function(){return new t(this.color,this.offsetX,this.offsetY,this.blur)},createjs.Shadow=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(t){this.EventDispatcher_constructor(),this.complete=!0,this.framerate=0,this._animations=null,this._frames=null,this._images=null,this._data=null,this._loadCount=0,this._frameHeight=0,this._frameWidth=0,this._numFrames=0,this._regX=0,this._regY=0,this._spacing=0,this._margin=0,this._parseData(t)}var e=createjs.extend(t,createjs.EventDispatcher);e.getAnimations=function(){return this._animations.slice()};try{Object.defineProperties(e,{animations:{get:e.getAnimations}})}catch(t){}e.getNumFrames=function(t){if(null==t)return this._frames?this._frames.length:this._numFrames||0;t=this._data[t];return null==t?0:t.frames.length},e.getAnimation=function(t){return this._data[t]},e.getFrame=function(t){var e;return this._frames&&(e=this._frames[t])?e:null},e.getFrameBounds=function(t,e){t=this.getFrame(t);return t?(e||new createjs.Rectangle).setValues(-t.regX,-t.regY,t.rect.width,t.rect.height):null},e.toString=function(){return"[SpriteSheet]"},e.clone=function(){throw"SpriteSheet cannot be cloned."},e._parseData=function(t){var e,i,n,r;if(null!=t){if(this.framerate=t.framerate||0,t.images&&0<(i=t.images.length))for(u=this._images=[],e=0;e<i;e++){var s,o=t.images[e];"string"==typeof o&&(s=o,(o=document.createElement("img")).src=s),u.push(o),o.getContext||o.naturalWidth||(this._loadCount++,this.complete=!1,function(t,e){o.onload=function(){t._handleImageLoad(e)}}(this,s),function(t,e){o.onerror=function(){t._handleImageError(e)}}(this,s))}if(null!=t.frames)if(Array.isArray(t.frames))for(this._frames=[],e=0,i=(u=t.frames).length;e<i;e++){var a=u[e];this._frames.push({image:this._images[a[4]||0],rect:new createjs.Rectangle(a[0],a[1],a[2],a[3]),regX:a[5]||0,regY:a[6]||0})}else n=t.frames,this._frameWidth=n.width,this._frameHeight=n.height,this._regX=n.regX||0,this._regY=n.regY||0,this._spacing=n.spacing||0,this._margin=n.margin||0,this._numFrames=n.count,0==this._loadCount&&this._calculateFrames();if(this._animations=[],null!=(n=t.animations))for(r in this._data={},n){var l={name:r},p=n[r];if("number"==typeof p)u=l.frames=[p];else if(Array.isArray(p))if(1==p.length)l.frames=[p[0]];else for(l.speed=p[3],l.next=p[2],u=l.frames=[],e=p[0];e<=p[1];e++)u.push(e);else{l.speed=p.speed,l.next=p.next;var h=p.frames,u=l.frames="number"==typeof h?[h]:h.slice(0)}!0!==l.next&&void 0!==l.next||(l.next=r),(!1===l.next||u.length<2&&l.next==r)&&(l.next=null),l.speed||(l.speed=1),this._animations.push(r),this._data[r]=l}}},e._handleImageLoad=function(t){0==--this._loadCount&&(this._calculateFrames(),this.complete=!0,this.dispatchEvent("complete"))},e._handleImageError=function(t){var e=new createjs.Event("error");e.src=t,this.dispatchEvent(e),0==--this._loadCount&&this.dispatchEvent("complete")},e._calculateFrames=function(){if(!this._frames&&0!=this._frameWidth){this._frames=[];var t=this._numFrames||1e5,e=0,i=this._frameWidth,n=this._frameHeight,r=this._spacing,s=this._margin;t:for(var o=0,a=this._images;o<a.length;o++)for(var l=a[o],p=l.width,h=l.height,u=s;u<=h-s-n;){for(var c=s;c<=p-s-i;){if(t<=e)break t;e++,this._frames.push({image:l,rect:new createjs.Rectangle(c,u,i,n),regX:this._regX,regY:this._regY}),c+=i+r}u+=n+r}this._numFrames=e}},createjs.SpriteSheet=createjs.promote(t,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function x(){this.command=null,this._stroke=null,this._strokeStyle=null,this._oldStrokeStyle=null,this._strokeDash=null,this._oldStrokeDash=null,this._strokeIgnoreScale=!1,this._fill=null,this._instructions=[],this._commitIndex=0,this._activeInstructions=[],this._dirty=!1,this._storeIndex=0,this.clear()}var t=x.prototype,l=x;x.getRGB=function(t,e,i,n){return null!=t&&null==i&&(n=e,i=255&t,e=t>>8&255,t=t>>16&255),null==n?"rgb("+t+","+e+","+i+")":"rgba("+t+","+e+","+i+","+n+")"},x.getHSL=function(t,e,i,n){return null==n?"hsl("+t%360+","+e+"%,"+i+"%)":"hsla("+t%360+","+e+"%,"+i+"%,"+n+")"},x.BASE_64={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63},x.STROKE_CAPS_MAP=["butt","round","square"],x.STROKE_JOINTS_MAP=["miter","round","bevel"];var e=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");e.getContext&&(x._ctx=e.getContext("2d"),e.width=e.height=1),t.getInstructions=function(){return this._updateInstructions(),this._instructions};try{Object.defineProperties(t,{instructions:{get:t.getInstructions}})}catch(t){}t.isEmpty=function(){return!(this._instructions.length||this._activeInstructions.length)},t.draw=function(t,e){this._updateInstructions();for(var i=this._instructions,n=this._storeIndex,r=i.length;n<r;n++)i[n].exec(t,e)},t.drawAsPath=function(t){this._updateInstructions();for(var e,i=this._instructions,n=this._storeIndex,r=i.length;n<r;n++)!1!==(e=i[n]).path&&e.exec(t)},t.moveTo=function(t,e){return this.append(new l.MoveTo(t,e),!0)},t.lineTo=function(t,e){return this.append(new l.LineTo(t,e))},t.arcTo=function(t,e,i,n,r){return this.append(new l.ArcTo(t,e,i,n,r))},t.arc=function(t,e,i,n,r,s){return this.append(new l.Arc(t,e,i,n,r,s))},t.quadraticCurveTo=function(t,e,i,n){return this.append(new l.QuadraticCurveTo(t,e,i,n))},t.bezierCurveTo=function(t,e,i,n,r,s){return this.append(new l.BezierCurveTo(t,e,i,n,r,s))},t.rect=function(t,e,i,n){return this.append(new l.Rect(t,e,i,n))},t.closePath=function(){return this._activeInstructions.length?this.append(new l.ClosePath):this},t.clear=function(){return this._instructions.length=this._activeInstructions.length=this._commitIndex=0,this._strokeStyle=this._oldStrokeStyle=this._stroke=this._fill=this._strokeDash=this._oldStrokeDash=null,this._dirty=this._strokeIgnoreScale=!1,this},t.beginFill=function(t){return this._setFill(t?new l.Fill(t):null)},t.beginLinearGradientFill=function(t,e,i,n,r,s){return this._setFill((new l.Fill).linearGradient(t,e,i,n,r,s))},t.beginRadialGradientFill=function(t,e,i,n,r,s,o,a){return this._setFill((new l.Fill).radialGradient(t,e,i,n,r,s,o,a))},t.beginBitmapFill=function(t,e,i){return this._setFill(new l.Fill(null,i).bitmap(t,e))},t.endFill=function(){return this.beginFill()},t.setStrokeStyle=function(t,e,i,n,r){return this._updateInstructions(!0),this._strokeStyle=this.command=new l.StrokeStyle(t,e,i,n,r),this._stroke&&(this._stroke.ignoreScale=r),this._strokeIgnoreScale=r,this},t.setStrokeDash=function(t,e){return this._updateInstructions(!0),this._strokeDash=this.command=new l.StrokeDash(t,e),this},t.beginStroke=function(t){return this._setStroke(t?new l.Stroke(t):null)},t.beginLinearGradientStroke=function(t,e,i,n,r,s){return this._setStroke((new l.Stroke).linearGradient(t,e,i,n,r,s))},t.beginRadialGradientStroke=function(t,e,i,n,r,s,o,a){return this._setStroke((new l.Stroke).radialGradient(t,e,i,n,r,s,o,a))},t.beginBitmapStroke=function(t,e){return this._setStroke((new l.Stroke).bitmap(t,e))},t.endStroke=function(){return this.beginStroke()},t.curveTo=t.quadraticCurveTo,t.drawRect=t.rect,t.drawRoundRect=function(t,e,i,n,r){return this.drawRoundRectComplex(t,e,i,n,r,r,r,r)},t.drawRoundRectComplex=function(t,e,i,n,r,s,o,a){return this.append(new l.RoundRect(t,e,i,n,r,s,o,a))},t.drawCircle=function(t,e,i){return this.append(new l.Circle(t,e,i))},t.drawEllipse=function(t,e,i,n){return this.append(new l.Ellipse(t,e,i,n))},t.drawPolyStar=function(t,e,i,n,r,s){return this.append(new l.PolyStar(t,e,i,n,r,s))},t.append=function(t,e){return this._activeInstructions.push(t),this.command=t,e||(this._dirty=!0),this},t.decodePath=function(t){for(var e=[this.moveTo,this.lineTo,this.quadraticCurveTo,this.bezierCurveTo,this.closePath],i=[2,2,4,6,0],n=0,r=t.length,s=[],o=0,a=0,l=x.BASE_64;n<r;){var p=t.charAt(n),h=l[p],u=h>>3,c=e[u];if(!c||3&h)throw"bad path data (@"+n+"): "+p;var d=i[u];u||(o=a=0),n++;for(var _=2+(h>>2&1),y=s.length=0;y<d;y++){var f=(m=l[t.charAt(n)])>>5?-1:1,m=(31&m)<<6|l[t.charAt(n+1)];3==_&&(m=m<<6|l[t.charAt(n+2)]),m=f*m/10,y%2?o=m+=o:a=m+=a,s[y]=m,n+=_}c.apply(this,s)}return this},t.store=function(){return this._updateInstructions(!0),this._storeIndex=this._instructions.length,this},t.unstore=function(){return this._storeIndex=0,this},t.clone=function(){var t=new x;return t.command=this.command,t._stroke=this._stroke,t._strokeStyle=this._strokeStyle,t._strokeDash=this._strokeDash,t._strokeIgnoreScale=this._strokeIgnoreScale,t._fill=this._fill,t._instructions=this._instructions.slice(),t._commitIndex=this._commitIndex,t._activeInstructions=this._activeInstructions.slice(),t._dirty=this._dirty,t._storeIndex=this._storeIndex,t},t.toString=function(){return"[Graphics]"},t.mt=t.moveTo,t.lt=t.lineTo,t.at=t.arcTo,t.bt=t.bezierCurveTo,t.qt=t.quadraticCurveTo,t.a=t.arc,t.r=t.rect,t.cp=t.closePath,t.c=t.clear,t.f=t.beginFill,t.lf=t.beginLinearGradientFill,t.rf=t.beginRadialGradientFill,t.bf=t.beginBitmapFill,t.ef=t.endFill,t.ss=t.setStrokeStyle,t.sd=t.setStrokeDash,t.s=t.beginStroke,t.ls=t.beginLinearGradientStroke,t.rs=t.beginRadialGradientStroke,t.bs=t.beginBitmapStroke,t.es=t.endStroke,t.dr=t.drawRect,t.rr=t.drawRoundRect,t.rc=t.drawRoundRectComplex,t.dc=t.drawCircle,t.de=t.drawEllipse,t.dp=t.drawPolyStar,t.p=t.decodePath,t._updateInstructions=function(t){var e=this._instructions,i=this._activeInstructions,n=this._commitIndex;if(this._dirty&&i.length){e.length=n,e.push(x.beginCmd);var r=i.length,s=e.length;e.length=s+r;for(var o=0;o<r;o++)e[o+s]=i[o];this._fill&&e.push(this._fill),this._stroke&&(this._strokeDash!==this._oldStrokeDash&&(this._oldStrokeDash=this._strokeDash,e.push(this._strokeDash)),this._strokeStyle!==this._oldStrokeStyle&&(this._oldStrokeStyle=this._strokeStyle,e.push(this._strokeStyle)),e.push(this._stroke)),this._dirty=!1}t&&(i.length=0,this._commitIndex=e.length)},t._setFill=function(t){return this._updateInstructions(!0),this.command=this._fill=t,this},t._setStroke=function(t){return this._updateInstructions(!0),(this.command=this._stroke=t)&&(t.ignoreScale=this._strokeIgnoreScale),this},(l.LineTo=function(t,e){this.x=t,this.y=e}).prototype.exec=function(t){t.lineTo(this.x,this.y)},(l.MoveTo=function(t,e){this.x=t,this.y=e}).prototype.exec=function(t){t.moveTo(this.x,this.y)},(l.ArcTo=function(t,e,i,n,r){this.x1=t,this.y1=e,this.x2=i,this.y2=n,this.radius=r}).prototype.exec=function(t){t.arcTo(this.x1,this.y1,this.x2,this.y2,this.radius)},(l.Arc=function(t,e,i,n,r,s){this.x=t,this.y=e,this.radius=i,this.startAngle=n,this.endAngle=r,this.anticlockwise=!!s}).prototype.exec=function(t){t.arc(this.x,this.y,this.radius,this.startAngle,this.endAngle,this.anticlockwise)},(l.QuadraticCurveTo=function(t,e,i,n){this.cpx=t,this.cpy=e,this.x=i,this.y=n}).prototype.exec=function(t){t.quadraticCurveTo(this.cpx,this.cpy,this.x,this.y)},(l.BezierCurveTo=function(t,e,i,n,r,s){this.cp1x=t,this.cp1y=e,this.cp2x=i,this.cp2y=n,this.x=r,this.y=s}).prototype.exec=function(t){t.bezierCurveTo(this.cp1x,this.cp1y,this.cp2x,this.cp2y,this.x,this.y)},(l.Rect=function(t,e,i,n){this.x=t,this.y=e,this.w=i,this.h=n}).prototype.exec=function(t){t.rect(this.x,this.y,this.w,this.h)},(l.ClosePath=function(){}).prototype.exec=function(t){t.closePath()},(l.BeginPath=function(){}).prototype.exec=function(t){t.beginPath()},(t=(l.Fill=function(t,e){this.style=t,this.matrix=e}).prototype).exec=function(t){var e;this.style&&(t.fillStyle=this.style,(e=this.matrix)&&(t.save(),t.transform(e.a,e.b,e.c,e.d,e.tx,e.ty)),t.fill(),e&&t.restore())},t.linearGradient=function(t,e,i,n,r,s){for(var o=this.style=x._ctx.createLinearGradient(i,n,r,s),a=0,l=t.length;a<l;a++)o.addColorStop(e[a],t[a]);return o.props={colors:t,ratios:e,x0:i,y0:n,x1:r,y1:s,type:"linear"},this},t.radialGradient=function(t,e,i,n,r,s,o,a){for(var l=this.style=x._ctx.createRadialGradient(i,n,r,s,o,a),p=0,h=t.length;p<h;p++)l.addColorStop(e[p],t[p]);return l.props={colors:t,ratios:e,x0:i,y0:n,r0:r,x1:s,y1:o,r1:a,type:"radial"},this},t.bitmap=function(t,e){return(t.naturalWidth||t.getContext||2<=t.readyState)&&((this.style=x._ctx.createPattern(t,e||"")).props={image:t,repetition:e,type:"bitmap"}),this},t.path=!1,(t=(l.Stroke=function(t,e){this.style=t,this.ignoreScale=e}).prototype).exec=function(t){this.style&&(t.strokeStyle=this.style,this.ignoreScale&&(t.save(),t.setTransform(1,0,0,1,0,0)),t.stroke(),this.ignoreScale&&t.restore())},t.linearGradient=l.Fill.prototype.linearGradient,t.radialGradient=l.Fill.prototype.radialGradient,t.bitmap=l.Fill.prototype.bitmap,t.path=!1,(t=(l.StrokeStyle=function(t,e,i,n,r){this.width=t,this.caps=e,this.joints=i,this.miterLimit=n,this.ignoreScale=r}).prototype).exec=function(t){t.lineWidth=null==this.width?"1":this.width,t.lineCap=null==this.caps?"butt":isNaN(this.caps)?this.caps:x.STROKE_CAPS_MAP[this.caps],t.lineJoin=null==this.joints?"miter":isNaN(this.joints)?this.joints:x.STROKE_JOINTS_MAP[this.joints],t.miterLimit=null==this.miterLimit?"10":this.miterLimit,t.ignoreScale=null!=this.ignoreScale&&this.ignoreScale},t.path=!1,(l.StrokeDash=function(t,e){this.segments=t,this.offset=e||0}).prototype.exec=function(t){t.setLineDash&&(t.setLineDash(this.segments||l.StrokeDash.EMPTY_SEGMENTS),t.lineDashOffset=this.offset||0)},l.StrokeDash.EMPTY_SEGMENTS=[],(l.RoundRect=function(t,e,i,n,r,s,o,a){this.x=t,this.y=e,this.w=i,this.h=n,this.radiusTL=r,this.radiusTR=s,this.radiusBR=o,this.radiusBL=a}).prototype.exec=function(t){var e=(l<p?l:p)/2,i=0,n=0,r=0,s=0,o=this.x,a=this.y,l=this.w,p=this.h,h=this.radiusTL,u=this.radiusTR,c=this.radiusBR,d=this.radiusBL;h<0&&(h*=i=-1),e<h&&(h=e),u<0&&(u*=n=-1),e<u&&(u=e),c<0&&(c*=r=-1),e<c&&(c=e),d<0&&(d*=s=-1),e<d&&(d=e),t.moveTo(o+l-u,a),t.arcTo(o+l+u*n,a-u*n,o+l,a+u,u),t.lineTo(o+l,a+p-c),t.arcTo(o+l+c*r,a+p+c*r,o+l-c,a+p,c),t.lineTo(o+d,a+p),t.arcTo(o-d*s,a+p+d*s,o,a+p-d,d),t.lineTo(o,a+h),t.arcTo(o-h*i,a-h*i,o+h,a,h),t.closePath()},(l.Circle=function(t,e,i){this.x=t,this.y=e,this.radius=i}).prototype.exec=function(t){t.arc(this.x,this.y,this.radius,0,2*Math.PI)},(l.Ellipse=function(t,e,i,n){this.x=t,this.y=e,this.w=i,this.h=n}).prototype.exec=function(t){var e=this.x,i=this.y,n=this.w,r=this.h,s=n/2*.5522848,o=r/2*.5522848,a=e+n,l=i+r,n=e+n/2,r=i+r/2;t.moveTo(e,r),t.bezierCurveTo(e,r-o,n-s,i,n,i),t.bezierCurveTo(n+s,i,a,r-o,a,r),t.bezierCurveTo(a,r+o,n+s,l,n,l),t.bezierCurveTo(n-s,l,e,r+o,e,r)},(l.PolyStar=function(t,e,i,n,r,s){this.x=t,this.y=e,this.radius=i,this.sides=n,this.pointSize=r,this.angle=s}).prototype.exec=function(t){var e=this.x,i=this.y,n=this.radius,r=(this.angle||0)/180*Math.PI,s=this.sides,o=1-(this.pointSize||0),a=Math.PI/s;t.moveTo(e+Math.cos(r)*n,i+Math.sin(r)*n);for(var l=0;l<s;l++)r+=a,1!=o&&t.lineTo(e+Math.cos(r)*n*o,i+Math.sin(r)*n*o),r+=a,t.lineTo(e+Math.cos(r)*n,i+Math.sin(r)*n);t.closePath()},x.beginCmd=new l.BeginPath,createjs.Graphics=x}(),this.createjs=this.createjs||{},function(){"use strict";function p(){this.EventDispatcher_constructor(),this.alpha=1,this.cacheCanvas=null,this.cacheID=0,this.id=createjs.UID.get(),this.mouseEnabled=!0,this.tickEnabled=!0,this.name=null,this.parent=null,this.regX=0,this.regY=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.skewX=0,this.skewY=0,this.shadow=null,this.visible=!0,this.x=0,this.y=0,this.transformMatrix=null,this.compositeOperation=null,this.snapToPixel=!0,this.filters=null,this.mask=null,this.hitArea=null,this.cursor=null,this._cacheOffsetX=0,this._cacheOffsetY=0,this._filterOffsetX=0,this._filterOffsetY=0,this._cacheScale=1,this._cacheDataURLID=0,this._cacheDataURL=null,this._props=new createjs.DisplayProps,this._rectangle=new createjs.Rectangle,this._bounds=null}var t=createjs.extend(p,createjs.EventDispatcher);p._MOUSE_EVENTS=["click","dblclick","mousedown","mouseout","mouseover","pressmove","pressup","rollout","rollover"],p.suppressCrossDomainErrors=!1,p._snapToPixelEnabled=!1;var e=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");e.getContext&&(p._hitTestCanvas=e,p._hitTestContext=e.getContext("2d"),e.width=e.height=1),p._nextCacheID=1,t.getStage=function(){for(var t=this,e=createjs.Stage;t.parent;)t=t.parent;return t instanceof e?t:null};try{Object.defineProperties(t,{stage:{get:t.getStage}})}catch(t){}t.isVisible=function(){return!!(this.visible&&0<this.alpha&&0!=this.scaleX&&0!=this.scaleY)},t.draw=function(t,e){var i=this.cacheCanvas;if(e||!i)return!1;e=this._cacheScale;return t.drawImage(i,this._cacheOffsetX+this._filterOffsetX,this._cacheOffsetY+this._filterOffsetY,i.width/e,i.height/e),!0},t.updateContext=function(t){var e=this.mask,i=this._props.matrix;e&&e.graphics&&!e.graphics.isEmpty()&&(e.getMatrix(i),t.transform(i.a,i.b,i.c,i.d,i.tx,i.ty),e.graphics.drawAsPath(t),t.clip(),i.invert(),t.transform(i.a,i.b,i.c,i.d,i.tx,i.ty)),this.getMatrix(i);var n=i.tx,e=i.ty;p._snapToPixelEnabled&&this.snapToPixel&&(n=n+(n<0?-.5:.5)|0,e=e+(e<0?-.5:.5)|0),t.transform(i.a,i.b,i.c,i.d,n,e),t.globalAlpha*=this.alpha,this.compositeOperation&&(t.globalCompositeOperation=this.compositeOperation),this.shadow&&this._applyShadow(t,this.shadow)},t.cache=function(t,e,i,n,r){r=r||1,this.cacheCanvas||(this.cacheCanvas=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),this._cacheWidth=i,this._cacheHeight=n,this._cacheOffsetX=t,this._cacheOffsetY=e,this._cacheScale=r,this.updateCache()},t.updateCache=function(t){var e=this.cacheCanvas;if(!e)throw"cache() must be called before updateCache()";var i=this._cacheScale,n=this._cacheOffsetX*i,r=this._cacheOffsetY*i,s=this._cacheWidth,o=this._cacheHeight,a=e.getContext("2d"),l=this._getFilterBounds();n+=this._filterOffsetX=l.x,r+=this._filterOffsetY=l.y,s=Math.ceil(s*i)+l.width,o=Math.ceil(o*i)+l.height,s!=e.width||o!=e.height?(e.width=s,e.height=o):t||a.clearRect(0,0,s+1,o+1),a.save(),a.globalCompositeOperation=t,a.setTransform(i,0,0,i,-n,-r),this.draw(a,!0),this._applyFilters(),a.restore(),this.cacheID=p._nextCacheID++},t.uncache=function(){this._cacheDataURL=this.cacheCanvas=null,this.cacheID=this._cacheOffsetX=this._cacheOffsetY=this._filterOffsetX=this._filterOffsetY=0,this._cacheScale=1},t.getCacheDataURL=function(){return this.cacheCanvas?(this.cacheID!=this._cacheDataURLID&&(this._cacheDataURL=this.cacheCanvas.toDataURL()),this._cacheDataURL):null},t.localToGlobal=function(t,e,i){return this.getConcatenatedMatrix(this._props.matrix).transformPoint(t,e,i||new createjs.Point)},t.globalToLocal=function(t,e,i){return this.getConcatenatedMatrix(this._props.matrix).invert().transformPoint(t,e,i||new createjs.Point)},t.localToLocal=function(t,e,i,n){return n=this.localToGlobal(t,e,n),i.globalToLocal(n.x,n.y,n)},t.setTransform=function(t,e,i,n,r,s,o,a,l){return this.x=t||0,this.y=e||0,this.scaleX=null==i?1:i,this.scaleY=null==n?1:n,this.rotation=r||0,this.skewX=s||0,this.skewY=o||0,this.regX=a||0,this.regY=l||0,this},t.getMatrix=function(t){var e=this,t=t&&t.identity()||new createjs.Matrix2D;return e.transformMatrix?t.copy(e.transformMatrix):t.appendTransform(e.x,e.y,e.scaleX,e.scaleY,e.rotation,e.skewX,e.skewY,e.regX,e.regY)},t.getConcatenatedMatrix=function(t){for(var e=this,i=this.getMatrix(t);e=e.parent;)i.prependMatrix(e.getMatrix(e._props.matrix));return i},t.getConcatenatedDisplayProps=function(t){t=t?t.identity():new createjs.DisplayProps;for(var e=this,i=e.getMatrix(t.matrix);t.prepend(e.visible,e.alpha,e.shadow,e.compositeOperation),e!=this&&i.prependMatrix(e.getMatrix(e._props.matrix)),e=e.parent;);return t},t.hitTest=function(t,e){var i=p._hitTestContext;i.setTransform(1,0,0,1,-t,-e),this.draw(i);e=this._testHit(i);return i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,2,2),e},t.set=function(t){for(var e in t)this[e]=t[e];return this},t.getBounds=function(){if(this._bounds)return this._rectangle.copy(this._bounds);var t=this.cacheCanvas;if(t){var e=this._cacheScale;return this._rectangle.setValues(this._cacheOffsetX,this._cacheOffsetY,t.width/e,t.height/e)}return null},t.getTransformedBounds=function(){return this._getBounds()},t.setBounds=function(t,e,i,n){null==t&&(this._bounds=t),this._bounds=(this._bounds||new createjs.Rectangle).setValues(t,e,i,n)},t.clone=function(){return this._cloneProps(new p)},t.toString=function(){return"[DisplayObject (name="+this.name+")]"},t._cloneProps=function(t){return t.alpha=this.alpha,t.mouseEnabled=this.mouseEnabled,t.tickEnabled=this.tickEnabled,t.name=this.name,t.regX=this.regX,t.regY=this.regY,t.rotation=this.rotation,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.shadow=this.shadow,t.skewX=this.skewX,t.skewY=this.skewY,t.visible=this.visible,t.x=this.x,t.y=this.y,t.compositeOperation=this.compositeOperation,t.snapToPixel=this.snapToPixel,t.filters=null==this.filters?null:this.filters.slice(0),t.mask=this.mask,t.hitArea=this.hitArea,t.cursor=this.cursor,t._bounds=this._bounds,t},t._applyShadow=function(t,e){e=e||Shadow.identity,t.shadowColor=e.color,t.shadowOffsetX=e.offsetX,t.shadowOffsetY=e.offsetY,t.shadowBlur=e.blur},t._tick=function(t){var e=this._listeners;e&&e.tick&&(t.target=null,t.propagationStopped=t.immediatePropagationStopped=!1,this.dispatchEvent(t))},t._testHit=function(t){try{var e=1<t.getImageData(0,0,1,1).data[3]}catch(t){if(!p.suppressCrossDomainErrors)throw"An error has occurred. This is most likely due to security restrictions on reading canvas pixel data with local or cross-domain images."}return e},t._applyFilters=function(){if(this.filters&&0!=this.filters.length&&this.cacheCanvas)for(var t=this.filters.length,e=this.cacheCanvas.getContext("2d"),i=this.cacheCanvas.width,n=this.cacheCanvas.height,r=0;r<t;r++)this.filters[r].applyFilter(e,0,0,i,n)},t._getFilterBounds=function(t){var e,i=this.filters,n=this._rectangle.setValues(0,0,0,0);if(!i||!(e=i.length))return n;for(var r=0;r<e;r++){var s=this.filters[r];s.getBounds&&s.getBounds(n)}return n},t._getBounds=function(t,e){return this._transformBounds(this.getBounds(),t,e)},t._transformBounds=function(t,e,i){if(!t)return t;var n=t.x,r=t.y,s=t.width,o=t.height,a=this._props.matrix,a=i?a.identity():this.getMatrix(a);(n||r)&&a.appendTransform(0,0,1,1,0,0,0,-n,-r),e&&a.prependMatrix(e);var l=s*a.a,p=s*a.b,h=o*a.c,u=o*a.d,c=a.tx,i=a.ty,e=c,s=c,o=i,a=i;return(n=l+c)<e?e=n:s<n&&(s=n),(n=l+h+c)<e?e=n:s<n&&(s=n),(n=h+c)<e?e=n:s<n&&(s=n),(r=p+i)<o?o=r:a<r&&(a=r),(r=p+u+i)<o?o=r:a<r&&(a=r),(r=u+i)<o?o=r:a<r&&(a=r),t.setValues(e,o,s-e,a-o)},t._hasMouseEventListener=function(){for(var t=p._MOUSE_EVENTS,e=0,i=t.length;e<i;e++)if(this.hasEventListener(t[e]))return!0;return!!this.cursor},createjs.DisplayObject=createjs.promote(p,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function d(){this.DisplayObject_constructor(),this.children=[],this.mouseChildren=!0,this.tickChildren=!0}var t=createjs.extend(d,createjs.DisplayObject);t.getNumChildren=function(){return this.children.length};try{Object.defineProperties(t,{numChildren:{get:t.getNumChildren}})}catch(t){}t.initialize=d,t.isVisible=function(){var t=this.cacheCanvas||this.children.length;return!!(this.visible&&0<this.alpha&&0!=this.scaleX&&0!=this.scaleY&&t)},t.draw=function(t,e){if(this.DisplayObject_draw(t,e))return!0;for(var i=this.children.slice(),n=0,r=i.length;n<r;n++){var s=i[n];s.isVisible()&&(t.save(),s.updateContext(t),s.draw(t),t.restore())}return!0},t.addChild=function(t){if(null==t)return t;var e=arguments.length;if(1<e){for(var i=0;i<e;i++)this.addChild(arguments[i]);return arguments[e-1]}return t.parent&&t.parent.removeChild(t),(t.parent=this).children.push(t),t.dispatchEvent("added"),t},t.addChildAt=function(t,e){var i=arguments.length,n=arguments[i-1];if(n<0||n>this.children.length)return arguments[i-2];if(2<i){for(var r=0;r<i-1;r++)this.addChildAt(arguments[r],n+r);return arguments[i-2]}return t.parent&&t.parent.removeChild(t),(t.parent=this).children.splice(e,0,t),t.dispatchEvent("added"),t},t.removeChild=function(t){var e=arguments.length;if(1<e){for(var i=!0,n=0;n<e;n++)i=i&&this.removeChild(arguments[n]);return i}return this.removeChildAt(createjs.indexOf(this.children,t))},t.removeChildAt=function(t){var e=arguments.length;if(1<e){for(var i=[],n=0;n<e;n++)i[n]=arguments[n];i.sort(function(t,e){return e-t});for(var r=!0,n=0;n<e;n++)r=r&&this.removeChildAt(i[n]);return r}if(t<0||t>this.children.length-1)return!1;var s=this.children[t];return s&&(s.parent=null),this.children.splice(t,1),s.dispatchEvent("removed"),!0},t.removeAllChildren=function(){for(var t=this.children;t.length;)this.removeChildAt(0)},t.getChildAt=function(t){return this.children[t]},t.getChildByName=function(t){for(var e=this.children,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},t.sortChildren=function(t){this.children.sort(t)},t.getChildIndex=function(t){return createjs.indexOf(this.children,t)},t.swapChildrenAt=function(t,e){var i=this.children,n=i[t],r=i[e];n&&r&&(i[t]=r,i[e]=n)},t.swapChildren=function(t,e){for(var i,n,r=this.children,s=0,o=r.length;s<o&&(r[s]==t&&(i=s),r[s]==e&&(n=s),null==i||null==n);s++);s!=o&&(r[i]=e,r[n]=t)},t.setChildIndex=function(t,e){var i=this.children,n=i.length;if(!(t.parent!=this||e<0||n<=e)){for(var r=0;r<n&&i[r]!=t;r++);r!=n&&r!=e&&(i.splice(r,1),i.splice(e,0,t))}},t.contains=function(t){for(;t;){if(t==this)return!0;t=t.parent}return!1},t.hitTest=function(t,e){return null!=this.getObjectUnderPoint(t,e)},t.getObjectsUnderPoint=function(t,e,i){var n=[],e=this.localToGlobal(t,e);return this._getObjectsUnderPoint(e.x,e.y,n,0<i,1==i),n},t.getObjectUnderPoint=function(t,e,i){e=this.localToGlobal(t,e);return this._getObjectsUnderPoint(e.x,e.y,null,0<i,1==i)},t.getBounds=function(){return this._getBounds(null,!0)},t.getTransformedBounds=function(){return this._getBounds()},t.clone=function(t){var e=this._cloneProps(new d);return t&&this._cloneChildren(e),e},t.toString=function(){return"[Container (name="+this.name+")]"},t._tick=function(t){if(this.tickChildren)for(var e=this.children.length-1;0<=e;e--){var i=this.children[e];i.tickEnabled&&i._tick&&i._tick(t)}this.DisplayObject__tick(t)},t._cloneChildren=function(t){t.children.length&&t.removeAllChildren();for(var e=t.children,i=0,n=this.children.length;i<n;i++){var r=this.children[i].clone(!0);r.parent=t,e.push(r)}},t._getObjectsUnderPoint=function(t,e,i,n,r,s){if(!(s=s||0)&&!this._testMask(this,t,e))return null;var o=createjs.DisplayObject._hitTestContext;r=r||n&&this._hasMouseEventListener();for(var a=this.children,l=a.length-1;0<=l;l--){var p=a[l],h=p.hitArea;if(p.visible&&(h||p.isVisible())&&(!n||p.mouseEnabled)&&(h||this._testMask(p,t,e)))if(!h&&p instanceof d){var u=p._getObjectsUnderPoint(t,e,i,n,r,s+1);if(!i&&u)return n&&!this.mouseChildren?this:u}else if(!n||r||p._hasMouseEventListener()){var c=p.getConcatenatedDisplayProps(p._props),u=c.matrix;if(h&&(u.appendMatrix(h.getMatrix(h._props.matrix)),c.alpha=h.alpha),o.globalAlpha=c.alpha,o.setTransform(u.a,u.b,u.c,u.d,u.tx-t,u.ty-e),(h||p).draw(o),this._testHit(o)){if(o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,2,2),!i)return n&&!this.mouseChildren?this:p;i.push(p)}}}return null},t._testMask=function(t,e,i){var n=t.mask;if(!n||!n.graphics||n.graphics.isEmpty())return!0;var r=this._props.matrix,t=t.parent,r=t?t.getConcatenatedMatrix(r):r.identity();r=n.getMatrix(n._props.matrix).prependMatrix(r);t=createjs.DisplayObject._hitTestContext;return t.setTransform(r.a,r.b,r.c,r.d,r.tx-e,r.ty-i),n.graphics.drawAsPath(t),t.fillStyle="#000",t.fill(),!!this._testHit(t)&&(t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,2,2),!0)},t._getBounds=function(t,e){var i=this.DisplayObject_getBounds();if(i)return this._transformBounds(i,t,e);var n=this._props.matrix,n=e?n.identity():this.getMatrix(n);t&&n.prependMatrix(t);for(var r=this.children.length,s=null,o=0;o<r;o++){var a=this.children[o];a.visible&&(i=a._getBounds(n))&&(s?s.extend(i.x,i.y,i.width,i.height):s=i.clone())}return s},createjs.Container=createjs.promote(d,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t){this.Container_constructor(),this.autoClear=!0,this.canvas="string"==typeof t?document.getElementById(t):t,this.mouseX=0,this.mouseY=0,this.drawRect=null,this.snapToPixelEnabled=!1,this.mouseInBounds=!1,this.tickOnUpdate=!0,this.mouseMoveOutside=!1,this.preventSelection=!0,this._pointerData={},this._pointerCount=0,this._primaryPointerID=null,this._mouseOverIntervalID=null,this._nextStage=null,this._prevStage=null,this.enableDOMEvents(!0)}var e=createjs.extend(t,createjs.Container);e._get_nextStage=function(){return this._nextStage},e._set_nextStage=function(t){this._nextStage&&(this._nextStage._prevStage=null),t&&(t._prevStage=this),this._nextStage=t};try{Object.defineProperties(e,{nextStage:{get:e._get_nextStage,set:e._set_nextStage}})}catch(t){}e.update=function(t){var e;this.canvas&&(this.tickOnUpdate&&this.tick(t),!1!==this.dispatchEvent("drawstart",!1,!0)&&(createjs.DisplayObject._snapToPixelEnabled=this.snapToPixelEnabled,e=this.drawRect,(t=this.canvas.getContext("2d")).setTransform(1,0,0,1,0,0),this.autoClear&&(e?t.clearRect(e.x,e.y,e.width,e.height):t.clearRect(0,0,this.canvas.width+1,this.canvas.height+1)),t.save(),this.drawRect&&(t.beginPath(),t.rect(e.x,e.y,e.width,e.height),t.clip()),this.updateContext(t),this.draw(t,!1),t.restore(),this.dispatchEvent("drawend")))},e.tick=function(t){if(this.tickEnabled&&!1!==this.dispatchEvent("tickstart",!1,!0)){var e=new createjs.Event("tick");if(t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);this._tick(e),this.dispatchEvent("tickend")}},e.handleEvent=function(t){"tick"==t.type&&this.update(t)},e.clear=function(){var t;this.canvas&&((t=this.canvas.getContext("2d")).setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.canvas.width+1,this.canvas.height+1))},e.toDataURL=function(t,e){var i,n,r=this.canvas.getContext("2d"),s=this.canvas.width,o=this.canvas.height;t&&(i=r.getImageData(0,0,s,o),n=r.globalCompositeOperation,r.globalCompositeOperation="destination-over",r.fillStyle=t,r.fillRect(0,0,s,o));e=this.canvas.toDataURL(e||"image/png");return t&&(r.putImageData(i,0,0),r.globalCompositeOperation=n),e},e.enableMouseOver=function(t){if(this._mouseOverIntervalID&&(clearInterval(this._mouseOverIntervalID),this._mouseOverIntervalID=null,0==t&&this._testMouseOver(!0)),null==t)t=20;else if(t<=0)return;var e=this;this._mouseOverIntervalID=setInterval(function(){e._testMouseOver()},1e3/Math.min(50,t))},e.enableDOMEvents=function(t){null==t&&(t=!0);var e,i,n=this._eventListeners;if(!t&&n){for(e in n)(i=n[e]).t.removeEventListener(e,i.f,!1);this._eventListeners=null}else if(t&&!n&&this.canvas){var t=window.addEventListener?window:document,r=this;for(e in(n=this._eventListeners={}).mouseup={t:t,f:function(t){r._handleMouseUp(t)}},n.mousemove={t:t,f:function(t){r._handleMouseMove(t)}},n.dblclick={t:this.canvas,f:function(t){r._handleDoubleClick(t)}},n.mousedown={t:this.canvas,f:function(t){r._handleMouseDown(t)}},n)(i=n[e]).t.addEventListener(e,i.f,!1)}},e.clone=function(){throw"Stage cannot be cloned."},e.toString=function(){return"[Stage (name="+this.name+")]"},e._getElementRect=function(e){var i;try{i=e.getBoundingClientRect()}catch(t){i={top:e.offsetTop,left:e.offsetLeft,width:e.offsetWidth,height:e.offsetHeight}}var t=(window.pageXOffset||document.scrollLeft||0)-(document.clientLeft||document.body.clientLeft||0),n=(window.pageYOffset||document.scrollTop||0)-(document.clientTop||document.body.clientTop||0),r=window.getComputedStyle?getComputedStyle(e,null):e.currentStyle,s=parseInt(r.paddingLeft)+parseInt(r.borderLeftWidth),o=parseInt(r.paddingTop)+parseInt(r.borderTopWidth),a=parseInt(r.paddingRight)+parseInt(r.borderRightWidth),r=parseInt(r.paddingBottom)+parseInt(r.borderBottomWidth);return{left:i.left+t+s,right:i.right+t-a,top:i.top+n+o,bottom:i.bottom+n-r}},e._getPointerData=function(t){return this._pointerData[t]||(this._pointerData[t]={x:0,y:0})},e._handleMouseMove=function(t){t=t||window.event,this._handlePointerMove(-1,t,t.pageX,t.pageY)},e._handlePointerMove=function(t,e,i,n,r){var s,o;this._prevStage&&void 0===r||this.canvas&&(s=this._nextStage,r=(o=this._getPointerData(t)).inBounds,this._updatePointerPosition(t,e,i,n),(r||o.inBounds||this.mouseMoveOutside)&&(-1===t&&o.inBounds==!r&&this._dispatchMouseEvent(this,r?"mouseleave":"mouseenter",!1,t,o,e),this._dispatchMouseEvent(this,"stagemousemove",!1,t,o,e),this._dispatchMouseEvent(o.target,"pressmove",!0,t,o,e)),s&&s._handlePointerMove(t,e,i,n,null))},e._updatePointerPosition=function(t,e,i,n){var r=this._getElementRect(this.canvas);i-=r.left,n-=r.top;var s=this.canvas.width,o=this.canvas.height;i/=(r.right-r.left)/s,n/=(r.bottom-r.top)/o;r=this._getPointerData(t);(r.inBounds=0<=i&&0<=n&&i<=s-1&&n<=o-1)?(r.x=i,r.y=n):this.mouseMoveOutside&&(r.x=i<0?0:s-1<i?s-1:i,r.y=n<0?0:o-1<n?o-1:n),r.posEvtObj=e,r.rawX=i,r.rawY=n,t!==this._primaryPointerID&&-1!==t||(this.mouseX=r.x,this.mouseY=r.y,this.mouseInBounds=r.inBounds)},e._handleMouseUp=function(t){this._handlePointerUp(-1,t,!1)},e._handlePointerUp=function(t,e,i,n){var r,s,o=this._nextStage,a=this._getPointerData(t);this._prevStage&&void 0===n||(r=null,s=a.target,n||!s&&!o||(r=this._getObjectsUnderPoint(a.x,a.y,null,!0)),a.down&&(this._dispatchMouseEvent(this,"stagemouseup",!1,t,a,e,r),a.down=!1),r==s&&this._dispatchMouseEvent(s,"click",!0,t,a,e),this._dispatchMouseEvent(s,"pressup",!0,t,a,e),i?(t==this._primaryPointerID&&(this._primaryPointerID=null),delete this._pointerData[t]):a.target=null,o&&o._handlePointerUp(t,e,i,n||r&&this))},e._handleMouseDown=function(t){this._handlePointerDown(-1,t,t.pageX,t.pageY)},e._handlePointerDown=function(t,e,i,n,r){this.preventSelection&&e.preventDefault(),null!=this._primaryPointerID&&-1!==t||(this._primaryPointerID=t),null!=n&&this._updatePointerPosition(t,e,i,n);var s=null,o=this._nextStage,a=this._getPointerData(t);r||(s=a.target=this._getObjectsUnderPoint(a.x,a.y,null,!0)),a.inBounds&&(this._dispatchMouseEvent(this,"stagemousedown",!1,t,a,e,s),a.down=!0),this._dispatchMouseEvent(s,"mousedown",!0,t,a,e),o&&o._handlePointerDown(t,e,i,n,r||s&&this)},e._testMouseOver=function(t,e,i){if(!this._prevStage||void 0!==e){var n=this._nextStage;if(this._mouseOverIntervalID){var r=this._getPointerData(-1);if(r&&(t||this.mouseX!=this._mouseOverX||this.mouseY!=this._mouseOverY||!this.mouseInBounds)){var s,o,a=r.posEvtObj,l=i||a&&a.target==this.canvas,p=null,h=-1,u="";!e&&(t||this.mouseInBounds&&l)&&(p=this._getObjectsUnderPoint(this.mouseX,this.mouseY,null,!0),this._mouseOverX=this.mouseX,this._mouseOverY=this.mouseY);for(var c=this._mouseOverTarget||[],d=c[c.length-1],_=this._mouseOverTarget=[],y=p;y;)_.unshift(y),u=u||y.cursor,y=y.parent;for(this.canvas.style.cursor=u,!e&&i&&(i.canvas.style.cursor=u),s=0,o=_.length;s<o&&_[s]==c[s];s++)h=s;for(d!=p&&this._dispatchMouseEvent(d,"mouseout",!0,-1,r,a,p),s=c.length-1;h<s;s--)this._dispatchMouseEvent(c[s],"rollout",!1,-1,r,a,p);for(s=_.length-1;h<s;s--)this._dispatchMouseEvent(_[s],"rollover",!1,-1,r,a,d);d!=p&&this._dispatchMouseEvent(p,"mouseover",!0,-1,r,a,d),n&&n._testMouseOver(t,e||p&&this,i||l&&this)}}else n&&n._testMouseOver(t,e,i)}},e._handleDoubleClick=function(t,e){var i=null,n=this._nextStage,r=this._getPointerData(-1);e||(i=this._getObjectsUnderPoint(r.x,r.y,null,!0),this._dispatchMouseEvent(i,"dblclick",!0,-1,r,t)),n&&n._handleDoubleClick(t,e||i&&this)},e._dispatchMouseEvent=function(t,e,i,n,r,s,o){t&&(i||t.hasEventListener(e))&&(o=new createjs.MouseEvent(e,i,!1,r.x,r.y,s,n,n===this._primaryPointerID||-1===n,r.rawX,r.rawY,o),t.dispatchEvent(o))},createjs.Stage=createjs.promote(t,"Container")}(),this.createjs=this.createjs||{},function(){function e(t){this.DisplayObject_constructor(),"string"==typeof t?(this.image=document.createElement("img"),this.image.src=t):this.image=t,this.sourceRect=null}var t=createjs.extend(e,createjs.DisplayObject);t.initialize=e,t.isVisible=function(){var t=this.image,t=this.cacheCanvas||t&&(t.naturalWidth||t.getContext||2<=t.readyState);return!!(this.visible&&0<this.alpha&&0!=this.scaleX&&0!=this.scaleY&&t)},t.draw=function(t,e){if(this.DisplayObject_draw(t,e)||!this.image)return!0;var i,n,r,s,o,a=this.image,l=this.sourceRect;return l?(i=l.x,n=l.y,r=i+l.width,s=n+l.height,i<(e=o=0)&&(o-=i,i=0),(l=a.width)<r&&(r=l),n<0&&(e-=n,n=0),(l=a.height)<s&&(s=l),t.drawImage(a,i,n,r-i,s-n,o,e,r-i,s-n)):t.drawImage(a,0,0),!0},t.getBounds=function(){var t=this.DisplayObject_getBounds();if(t)return t;var e=this.image,t=this.sourceRect||e;return e&&(e.naturalWidth||e.getContext||2<=e.readyState)?this._rectangle.setValues(0,0,t.width,t.height):null},t.clone=function(){var t=new e(this.image);return this.sourceRect&&(t.sourceRect=this.sourceRect.clone()),this._cloneProps(t),t},t.toString=function(){return"[Bitmap (name="+this.name+")]"},createjs.Bitmap=createjs.promote(e,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e){this.DisplayObject_constructor(),this.currentFrame=0,this.currentAnimation=null,this.paused=!0,this.spriteSheet=t,this.currentAnimationFrame=0,this.framerate=0,this._animation=null,this._currentFrame=null,this._skipAdvance=!1,null!=e&&this.gotoAndPlay(e)}var e=createjs.extend(t,createjs.DisplayObject);e.initialize=t,e.isVisible=function(){var t=this.cacheCanvas||this.spriteSheet.complete;return!!(this.visible&&0<this.alpha&&0!=this.scaleX&&0!=this.scaleY&&t)},e.draw=function(t,e){if(this.DisplayObject_draw(t,e))return!0;this._normalizeFrame();var i=this.spriteSheet.getFrame(0|this._currentFrame);if(!i)return!1;e=i.rect;return e.width&&e.height&&t.drawImage(i.image,e.x,e.y,e.width,e.height,-i.regX,-i.regY,e.width,e.height),!0},e.play=function(){this.paused=!1},e.stop=function(){this.paused=!0},e.gotoAndPlay=function(t){this.paused=!1,this._skipAdvance=!0,this._goto(t)},e.gotoAndStop=function(t){this.paused=!0,this._goto(t)},e.advance=function(t){var e=this.framerate||this.spriteSheet.framerate,e=e&&null!=t?t/(1e3/e):1;this._normalizeFrame(e)},e.getBounds=function(){return this.DisplayObject_getBounds()||this.spriteSheet.getFrameBounds(this.currentFrame,this._rectangle)},e.clone=function(){return this._cloneProps(new t(this.spriteSheet))},e.toString=function(){return"[Sprite (name="+this.name+")]"},e._cloneProps=function(t){return this.DisplayObject__cloneProps(t),t.currentFrame=this.currentFrame,t.currentAnimation=this.currentAnimation,t.paused=this.paused,t.currentAnimationFrame=this.currentAnimationFrame,t.framerate=this.framerate,t._animation=this._animation,t._currentFrame=this._currentFrame,t._skipAdvance=this._skipAdvance,t},e._tick=function(t){this.paused||(this._skipAdvance||this.advance(t&&t.delta),this._skipAdvance=!1),this.DisplayObject__tick(t)},e._normalizeFrame=function(t){t=t||0;var e=this._animation,i=this.paused,n=this._currentFrame;if(e){var r,s=e.speed||1,o=this.currentAnimationFrame;if((r=e.frames.length)<=o+t*s){var a=e.next;if(this._dispatchAnimationEnd(e,n,i,a,r-1))return;if(a)return this._goto(a,t-(r-o)/s);this.paused=!0,o=e.frames.length-1}else o+=t*s;this.currentAnimationFrame=o,this._currentFrame=e.frames[0|o]}else if(n=this._currentFrame+=t,r=this.spriteSheet.getNumFrames(),r<=n&&0<r&&!this._dispatchAnimationEnd(e,n,i,r-1)&&(this._currentFrame-=r)>=r)return this._normalizeFrame();n=0|this._currentFrame,this.currentFrame!=n&&(this.currentFrame=n,this.dispatchEvent("change"))},e._dispatchAnimationEnd=function(t,e,i,n,r){var s,o=t?t.name:null;this.hasEventListener("animationend")&&((s=new createjs.Event("animationend")).name=o,s.next=n,this.dispatchEvent(s));e=this._animation!=t||this._currentFrame!=e;return e||i||!this.paused||(this.currentAnimationFrame=r,e=!0),e},e._goto=function(t,e){var i;this.currentAnimationFrame=0,isNaN(t)?(i=this.spriteSheet.getAnimation(t))&&(this._animation=i,this.currentAnimation=t,this._normalizeFrame(e)):(this.currentAnimation=this._animation=null,this._currentFrame=t,this._normalizeFrame())},createjs.Sprite=createjs.promote(t,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function e(t){this.DisplayObject_constructor(),this.graphics=t||new createjs.Graphics}var t=createjs.extend(e,createjs.DisplayObject);t.isVisible=function(){var t=this.cacheCanvas||this.graphics&&!this.graphics.isEmpty();return!!(this.visible&&0<this.alpha&&0!=this.scaleX&&0!=this.scaleY&&t)},t.draw=function(t,e){return this.DisplayObject_draw(t,e)||this.graphics.draw(t,this),!0},t.clone=function(t){t=t&&this.graphics?this.graphics.clone():this.graphics;return this._cloneProps(new e(t))},t.toString=function(){return"[Shape (name="+this.name+")]"},createjs.Shape=createjs.promote(e,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function f(t,e,i){this.DisplayObject_constructor(),this.text=t,this.font=e,this.color=i,this.textAlign="left",this.textBaseline="top",this.maxWidth=null,this.outline=0,this.lineHeight=0,this.lineWidth=null}var t=createjs.extend(f,createjs.DisplayObject),e=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");e.getContext&&(f._workingContext=e.getContext("2d"),e.width=e.height=1),f.H_OFFSETS={start:0,left:0,center:-.5,end:-1,right:-1},f.V_OFFSETS={top:0,hanging:-.01,middle:-.4,alphabetic:-.8,ideographic:-.85,bottom:-1},t.isVisible=function(){var t=this.cacheCanvas||null!=this.text&&""!==this.text;return!!(this.visible&&0<this.alpha&&0!=this.scaleX&&0!=this.scaleY&&t)},t.draw=function(t,e){if(this.DisplayObject_draw(t,e))return!0;e=this.color||"#000";return this.outline?(t.strokeStyle=e,t.lineWidth=+this.outline):t.fillStyle=e,this._drawText(this._prepContext(t)),!0},t.getMeasuredWidth=function(){return this._getMeasuredWidth(this.text)},t.getMeasuredLineHeight=function(){return 1.2*this._getMeasuredWidth("M")},t.getMeasuredHeight=function(){return this._drawText(null,{}).height},t.getBounds=function(){var t=this.DisplayObject_getBounds();if(t)return t;if(null==this.text||""===this.text)return null;var e=this._drawText(null,{}),i=this.maxWidth&&this.maxWidth<e.width?this.maxWidth:e.width,n=i*f.H_OFFSETS[this.textAlign||"left"],t=(this.lineHeight||this.getMeasuredLineHeight())*f.V_OFFSETS[this.textBaseline||"top"];return this._rectangle.setValues(n,t,i,e.height)},t.getMetrics=function(){var t={lines:[]};return t.lineHeight=this.lineHeight||this.getMeasuredLineHeight(),t.vOffset=t.lineHeight*f.V_OFFSETS[this.textBaseline||"top"],this._drawText(null,t,t.lines)},t.clone=function(){return this._cloneProps(new f(this.text,this.font,this.color))},t.toString=function(){return"[Text (text="+(20<this.text.length?this.text.substr(0,17)+"...":this.text)+")]"},t._cloneProps=function(t){return this.DisplayObject__cloneProps(t),t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,t.maxWidth=this.maxWidth,t.outline=this.outline,t.lineHeight=this.lineHeight,t.lineWidth=this.lineWidth,t},t._prepContext=function(t){return t.font=this.font||"10px sans-serif",t.textAlign=this.textAlign||"left",t.textBaseline=this.textBaseline||"top",t},t._drawText=function(t,e,i){var n=!!t;n||((t=f._workingContext).save(),this._prepContext(t));for(var r=this.lineHeight||this.getMeasuredLineHeight(),s=0,o=0,a=String(this.text).split(/(?:\r\n|\r|\n)/),l=0,p=a.length;l<p;l++){var h=a[l],u=null;if(null!=this.lineWidth&&(u=t.measureText(h).width)>this.lineWidth)for(var c=h.split(/(\s)/),h=c[0],u=t.measureText(h).width,d=1,_=c.length;d<_;d+=2){var y=t.measureText(c[d]+c[d+1]).width;u+y>this.lineWidth?(n&&this._drawTextLine(t,h,o*r),i&&i.push(h),s<u&&(s=u),h=c[d+1],u=t.measureText(h).width,o++):(h+=c[d]+c[d+1],u+=y)}n&&this._drawTextLine(t,h,o*r),i&&i.push(h),e&&null==u&&(u=t.measureText(h).width),s<u&&(s=u),o++}return e&&(e.width=s,e.height=o*r),n||t.restore(),e},t._drawTextLine=function(t,e,i){this.outline?t.strokeText(e,0,i,this.maxWidth||65535):t.fillText(e,0,i,this.maxWidth||65535)},t._getMeasuredWidth=function(t){var e=f._workingContext;e.save();t=this._prepContext(e).measureText(t).width;return e.restore(),t},createjs.Text=createjs.promote(f,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function x(t,e){this.Container_constructor(),this.text=t||"",this.spriteSheet=e,this.lineHeight=0,this.letterSpacing=0,this.spaceWidth=0,this._oldProps={text:0,spriteSheet:0,lineHeight:0,letterSpacing:0,spaceWidth:0}}var t=createjs.extend(x,createjs.Container);x.maxPoolSize=100,x._spritePool=[],t.draw=function(t,e){this.DisplayObject_draw(t,e)||(this._updateText(),this.Container_draw(t,e))},t.getBounds=function(){return this._updateText(),this.Container_getBounds()},t.isVisible=function(){var t=this.cacheCanvas||this.spriteSheet&&this.spriteSheet.complete&&this.text;return!!(this.visible&&0<this.alpha&&0!==this.scaleX&&0!==this.scaleY&&t)},t.clone=function(){return this._cloneProps(new x(this.text,this.spriteSheet))},t.addChild=t.addChildAt=t.removeChild=t.removeChildAt=t.removeAllChildren=function(){},t._cloneProps=function(t){return this.Container__cloneProps(t),t.lineHeight=this.lineHeight,t.letterSpacing=this.letterSpacing,t.spaceWidth=this.spaceWidth,t},t._getFrameIndex=function(t,e){var i,n=e.getAnimation(t);return n||(t!=(i=t.toUpperCase())||t!=(i=t.toLowerCase())||(i=null),i&&(n=e.getAnimation(i))),n&&n.frames[0]},t._getFrame=function(t,e){t=this._getFrameIndex(t,e);return null==t?t:e.getFrame(t)},t._getLineHeight=function(t){t=this._getFrame("1",t)||this._getFrame("T",t)||this._getFrame("L",t)||t.getFrame(0);return t?t.rect.height:1},t._getSpaceWidth=function(t){t=this._getFrame("1",t)||this._getFrame("l",t)||this._getFrame("e",t)||this._getFrame("a",t)||t.getFrame(0);return t?t.rect.width:1},t._updateText=function(){var t,e,i=0,n=0,r=this._oldProps,s=!1,o=this.spaceWidth,a=this.lineHeight,l=this.spriteSheet,p=x._spritePool,h=this.children,u=0,c=h.length;for(e in r)r[e]!=this[e]&&(r[e]=this[e],s=!0);if(s){var d=!!this._getFrame(" ",l);d||o||(o=this._getSpaceWidth(l)),a=a||this._getLineHeight(l);for(var _=0,y=this.text.length;_<y;_++){var f,m=this.text.charAt(_);" "!=m||d?"\n"!=m&&"\r"!=m?null!=(f=this._getFrameIndex(m,l))&&(u<c?t=h[u]:(h.push(t=p.length?p.pop():new createjs.Sprite),t.parent=this,c++),t.spriteSheet=l,t.gotoAndStop(f),t.x=i,t.y=n,u++,i+=t.getBounds().width+this.letterSpacing):("\r"==m&&"\n"==this.text.charAt(_+1)&&_++,i=0,n+=a):i+=o}for(;u<c;)p.push(t=h.pop()),t.parent=null,c--;p.length>x.maxPoolSize&&(p.length=x.maxPoolSize)}},createjs.BitmapText=createjs.promote(x,"Container")}(),this.createjs=this.createjs||{},function(){"use strict";function u(t,e,i,n){this.Container_constructor(),u.inited||u.init(),this.mode=t||u.INDEPENDENT,this.startPosition=e||0,this.loop=i,this.currentFrame=0,this.timeline=new createjs.Timeline(null,n,{paused:!0,position:e,useTicks:!0}),this.paused=!1,this.actionsEnabled=!0,this.autoReset=!0,this.frameBounds=this.frameBounds||null,this.framerate=null,this._synchOffset=0,this._prevPos=-1,this._prevPosition=0,this._t=0,this._managed={}}var t=createjs.extend(u,createjs.Container);u.INDEPENDENT="independent",u.SINGLE_FRAME="single",u.SYNCHED="synched",u.inited=!1,u.init=function(){u.inited||(e.install(),u.inited=!0)},t.getLabels=function(){return this.timeline.getLabels()},t.getCurrentLabel=function(){return this._updateTimeline(),this.timeline.getCurrentLabel()},t.getDuration=function(){return this.timeline.duration};try{Object.defineProperties(t,{labels:{get:t.getLabels},currentLabel:{get:t.getCurrentLabel},totalFrames:{get:t.getDuration},duration:{get:t.getDuration}})}catch(t){}function e(){throw"MovieClipPlugin cannot be instantiated."}t.initialize=u,t.isVisible=function(){return!!(this.visible&&0<this.alpha&&0!=this.scaleX&&0!=this.scaleY)},t.draw=function(t,e){return this.DisplayObject_draw(t,e)||(this._updateTimeline(),this.Container_draw(t,e)),!0},t.play=function(){this.paused=!1},t.stop=function(){this.paused=!0},t.gotoAndPlay=function(t){this.paused=!1,this._goto(t)},t.gotoAndStop=function(t){this.paused=!0,this._goto(t)},t.advance=function(t){var e=u.INDEPENDENT;if(this.mode==e){for(var i=this,n=i.framerate;(i=i.parent)&&null==n;)i.mode==e&&(n=i._framerate);var t=null!=(this._framerate=n)&&-1!=n&&null!=t?t/(1e3/n)+this._t:1,r=0|t;for(this._t=t-r;!this.paused&&r--;)this._prevPosition=this._prevPos<0?0:this._prevPosition+1,this._updateTimeline()}},t.clone=function(){throw"MovieClip cannot be cloned."},t.toString=function(){return"[MovieClip (name="+this.name+")]"},t._tick=function(t){this.advance(t&&t.delta),this.Container__tick(t)},t._goto=function(t){t=this.timeline.resolve(t);null!=t&&(-1==this._prevPos&&(this._prevPos=NaN),this._prevPosition=t,this._t=0,this._updateTimeline())},t._reset=function(){this._prevPos=-1,this._t=this.currentFrame=0,this.paused=!1},t._updateTimeline=function(){var t=this.timeline,e=this.mode!=u.INDEPENDENT;t.loop=null==this.loop||this.loop;var i=e?this.startPosition+(this.mode==u.SINGLE_FRAME?0:this._synchOffset):this._prevPos<0?0:this._prevPosition,e=e||!this.actionsEnabled?createjs.Tween.NONE:null;if(this.currentFrame=t._calcPosition(i),t.setPosition(i,e),this._prevPosition=t._prevPosition,this._prevPos!=t._prevPos){for(var n in this.currentFrame=this._prevPos=t._prevPos,this._managed)this._managed[n]=1;for(var r=t._tweens,s=0,o=r.length;s<o;s++){var a=r[s],l=a._target;l==this||a.passive||(a=a._stepPosition,l instanceof createjs.DisplayObject?this._addManagedChild(l,a):this._setState(l.state,a))}for(var p=this.children,s=p.length-1;0<=s;s--){var h=p[s].id;1==this._managed[h]&&(this.removeChildAt(s),delete this._managed[h])}}},t._setState=function(t,e){if(t)for(var i=t.length-1;0<=i;i--){var n,r=t[i],s=r.t,o=r.p;for(n in o)s[n]=o[n];this._addManagedChild(s,e)}},t._addManagedChild=function(t,e){t._off||(this.addChildAt(t,0),t instanceof u&&(t._synchOffset=e,t.mode==u.INDEPENDENT&&t.autoReset&&!this._managed[t.id]&&t._reset()),this._managed[t.id]=2)},t._getBounds=function(t,e){var i=this.DisplayObject_getBounds();return i||(this._updateTimeline(),this.frameBounds&&(i=this._rectangle.copy(this.frameBounds[this.currentFrame]))),i?this._transformBounds(i,t,e):this.Container__getBounds(t,e)},createjs.MovieClip=createjs.promote(u,"Container"),e.priority=100,e.install=function(){createjs.Tween.installPlugin(e,["startPosition"])},e.init=function(t,e,i){return i},e.step=function(){},e.tween=function(t,e,i,n,r,s,o,a){return t.target instanceof u?(1==s?r:n)[e]:i}}(),this.createjs=this.createjs||{},function(){"use strict";function w(){throw"SpriteSheetUtils cannot be instantiated"}var t=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");t.getContext&&(w._workingCanvas=t,w._workingContext=t.getContext("2d"),t.width=t.height=1),w.addFlippedFrames=function(t,e,i,n){var r;(e||i||n)&&(r=0,e&&w._flip(t,++r,!0,!1),i&&w._flip(t,++r,!1,!0),n&&w._flip(t,++r,!0,!0))},w.extractFrame=function(t,e){isNaN(e)&&(e=t.getAnimation(e).frames[0]);var i=t.getFrame(e);if(!i)return null;t=i.rect,e=w._workingCanvas;e.width=t.width,e.height=t.height,w._workingContext.drawImage(i.image,t.x,t.y,t.width,t.height,0,0,t.width,t.height);t=document.createElement("img");return t.src=e.toDataURL("image/png"),t},w.mergeAlpha=function(t,e,i){(i=i||(createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"))).width=Math.max(e.width,t.width),i.height=Math.max(e.height,t.height);var n=i.getContext("2d");return n.save(),n.drawImage(t,0,0),n.globalCompositeOperation="destination-in",n.drawImage(e,0,0),n.restore(),i},w._flip=function(t,e,i,n){for(var r=t._images,s=w._workingCanvas,o=w._workingContext,a=r.length/e,l=0;l<a;l++){var p=r[l];p.__tmp=l,o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,s.width+1,s.height+1),s.width=p.width,s.height=p.height,o.setTransform(i?-1:1,0,0,n?-1:1,i?p.width:0,n?p.height:0),o.drawImage(p,0,0);var h=document.createElement("img");h.src=s.toDataURL("image/png"),h.width=p.width,h.height=p.height,r.push(h)}for(var u=t._frames,c=u.length/e,l=0;l<c;l++){var d=(p=u[l]).rect.clone(),_={image:h=r[p.image.__tmp+a*e],rect:d,regX:p.regX,regY:p.regY};i&&(d.x=h.width-d.x-d.width,_.regX=d.width-p.regX),n&&(d.y=h.height-d.y-d.height,_.regY=d.height-p.regY),u.push(_)}var y="_"+(i?"h":"")+(n?"v":""),f=t._animations,m=t._data,x=f.length/e;for(l=0;l<x;l++){var v=f[l],g={name:v+y,speed:(p=m[v]).speed,next:p.next,frames:[]};p.next&&(g.next+=y);for(var b=0,z=(u=p.frames).length;b<z;b++)g.frames.push(u[b]+c*e);m[g.name]=g,f.push(g.name)}},createjs.SpriteSheetUtils=w}(),this.createjs=this.createjs||{},function(){"use strict";function b(t){this.EventDispatcher_constructor(),this.maxWidth=2048,this.maxHeight=2048,this.spriteSheet=null,this.scale=1,this.padding=1,this.timeSlice=.3,this.progress=-1,this.framerate=t||0,this._frames=[],this._animations={},this._data=null,this._nextFrameIndex=0,this._index=0,this._timerID=null,this._scale=1}var t=createjs.extend(b,createjs.EventDispatcher);b.ERR_DIMENSIONS="frame dimensions exceed max spritesheet dimensions",b.ERR_RUNNING="a build is already running",t.addFrame=function(t,e,i,n,r){if(this._data)throw b.ERR_RUNNING;e=e||t.bounds||t.nominalBounds;return!e&&t.getBounds&&(e=t.getBounds()),e?(i=i||1,this._frames.push({source:t,sourceRect:e,scale:i,funct:n,data:r,index:this._frames.length,height:e.height*i})-1):null},t.addAnimation=function(t,e,i,n){if(this._data)throw b.ERR_RUNNING;this._animations[t]={frames:e,next:i,speed:n}},t.addMovieClip=function(t,e,i,n,r,s){if(this._data)throw b.ERR_RUNNING;var o=t.frameBounds,a=e||t.bounds||t.nominalBounds;if(!a&&t.getBounds&&(a=t.getBounds()),a||o){for(var l,p=this._frames.length,h=t.timeline.duration,u=0;u<h;u++){var c=o&&o[u]?o[u]:a;this.addFrame(t,c,i,this._setupMovieClipFrame,{i:u,f:n,d:r})}var d,_=t.timeline._labels,y=[];for(d in _)y.push({index:_[d],label:d});if(y.length)for(y.sort(function(t,e){return t.index-e.index}),u=0,l=y.length;u<l;u++){for(var f=y[u].label,m=p+y[u].index,x=p+(u==l-1?h:y[u+1].index),v=[],g=m;g<x;g++)v.push(g);s&&!(f=s(f,t,m,x))||this.addAnimation(f,v,!0)}}},t.build=function(){if(this._data)throw b.ERR_RUNNING;for(this._startBuild();this._drawNext(););return this._endBuild(),this.spriteSheet},t.buildAsync=function(t){if(this._data)throw b.ERR_RUNNING;this.timeSlice=t,this._startBuild();var e=this;this._timerID=setTimeout(function(){e._run()},50-50*Math.max(.01,Math.min(.99,this.timeSlice||.3)))},t.stopAsync=function(){clearTimeout(this._timerID),this._data=null},t.clone=function(){throw"SpriteSheetBuilder cannot be cloned."},t.toString=function(){return"[SpriteSheetBuilder]"},t._startBuild=function(){var t=this.padding||0;this.progress=0,this.spriteSheet=null,this._index=0,this._scale=this.scale;var e=[];this._data={images:[],frames:e,framerate:this.framerate,animations:this._animations};var i=this._frames.slice();if(i.sort(function(t,e){return t.height<=e.height?-1:1}),i[i.length-1].height+2*t>this.maxHeight)throw b.ERR_DIMENSIONS;for(var n=0,r=0,s=0;i.length;){var o,a=this._fillRow(i,n,s,e,t);a.w>r&&(r=a.w),n+=a.h,a.h&&i.length||((o=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")).width=this._getSize(r,this.maxWidth),o.height=this._getSize(n,this.maxHeight),this._data.images[s]=o,a.h||(r=n=0,s++))}},t._setupMovieClipFrame=function(t,e){var i=t.actionsEnabled;t.actionsEnabled=!1,t.gotoAndStop(e.i),t.actionsEnabled=i,e.f&&e.f(t,e.d,e.i)},t._getSize=function(t,e){for(var i=4;Math.pow(2,++i)<t;);return Math.min(e,Math.pow(2,i))},t._fillRow=function(t,e,i,n,r){for(var s=this.maxWidth,o=this.maxHeight-(e+=r),a=r,l=0,p=t.length-1;0<=p;p--){var h=t[p],u=this._scale*h.scale,c=h.sourceRect,d=h.source,_=Math.floor(u*c.x-r),y=Math.floor(u*c.y-r),f=Math.ceil(u*c.height+2*r),c=Math.ceil(u*c.width+2*r);if(s<c)throw b.ERR_DIMENSIONS;o<f||s<a+c||(h.img=i,h.rect=new createjs.Rectangle(a,e,c,f),l=l||f,t.splice(p,1),n[h.index]=[a,e,c,f,i,Math.round(-_+u*d.regX-r),Math.round(-y+u*d.regY-r)],a+=c)}return{w:a,h:l}},t._endBuild=function(){this.spriteSheet=new createjs.SpriteSheet(this._data),this._data=null,this.progress=1,this.dispatchEvent("complete")},t._run=function(){for(var t,e=50*Math.max(.01,Math.min(.99,this.timeSlice||.3)),i=(new Date).getTime()+e,n=!1;i>(new Date).getTime();)if(!this._drawNext()){n=!0;break}n?this._endBuild():(t=this)._timerID=setTimeout(function(){t._run()},50-e);var r=this.progress=this._index/this._frames.length;this.hasEventListener("progress")&&((e=new createjs.Event("progress")).progress=r,this.dispatchEvent(e))},t._drawNext=function(){var t=this._frames[this._index],e=t.scale*this._scale,i=t.rect,n=t.sourceRect,r=this._data.images[t.img].getContext("2d");return t.funct&&t.funct(t.source,t.data),r.save(),r.beginPath(),r.rect(i.x,i.y,i.width,i.height),r.clip(),r.translate(Math.ceil(i.x-n.x*e),Math.ceil(i.y-n.y*e)),r.scale(e,e),t.source.draw(r),r.restore(),++this._index<this._frames.length},createjs.SpriteSheetBuilder=createjs.promote(b,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t){this.DisplayObject_constructor(),"string"==typeof t&&(t=document.getElementById(t)),this.mouseEnabled=!1;var e=t.style;e.position="absolute",e.transformOrigin=e.WebkitTransformOrigin=e.msTransformOrigin=e.MozTransformOrigin=e.OTransformOrigin="0% 0%",this.htmlElement=t,this._oldProps=null}var e=createjs.extend(t,createjs.DisplayObject);e.isVisible=function(){return null!=this.htmlElement},e.draw=function(t,e){return!0},e.cache=function(){},e.uncache=function(){},e.updateCache=function(){},e.hitTest=function(){},e.localToGlobal=function(){},e.globalToLocal=function(){},e.localToLocal=function(){},e.clone=function(){throw"DOMElement cannot be cloned."},e.toString=function(){return"[DOMElement (name="+this.name+")]"},e._tick=function(t){var e=this.getStage();e&&e.on("drawend",this._handleDrawEnd,this,!0),this.DisplayObject__tick(t)},e._handleDrawEnd=function(t){var e,i,n,r,s=this.htmlElement;s&&(e=s.style,n=(i=this.getConcatenatedDisplayProps(this._props)).matrix,(r=i.visible?"visible":"hidden")!=e.visibility&&(e.visibility=r),i.visible&&((r=(s=this._oldProps)&&s.matrix)&&r.equals(n)||(r="matrix("+(1e4*n.a|0)/1e4+","+(1e4*n.b|0)/1e4+","+(1e4*n.c|0)/1e4+","+(1e4*n.d|0)/1e4+","+(n.tx+.5|0),e.transform=e.WebkitTransform=e.OTransform=e.msTransform=r+","+(n.ty+.5|0)+")",e.MozTransform=r+"px,"+(n.ty+.5|0)+"px)",(s=s||(this._oldProps=new createjs.DisplayProps(!0,NaN))).matrix.copy(n)),s.alpha!=i.alpha&&(e.opacity=""+(1e4*i.alpha|0)/1e4,s.alpha=i.alpha)))},createjs.DOMElement=createjs.promote(t,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function t(){}var e=t.prototype;e.getBounds=function(t){return t},e.applyFilter=function(t,e,i,n,r,s,o,a){s=s||t,null==o&&(o=e),null==a&&(a=i);try{var l=t.getImageData(e,i,n,r)}catch(t){return!1}return!!this._applyFilter(l)&&(s.putImageData(l,o,a),!0)},e.toString=function(){return"[Filter]"},e.clone=function(){return new t},e._applyFilter=function(t){return!0},createjs.Filter=t}(),this.createjs=this.createjs||{},function(){"use strict";function j(t,e,i){(isNaN(t)||t<0)&&(t=0),(isNaN(e)||e<0)&&(e=0),(isNaN(i)||i<1)&&(i=1),this.blurX=0|t,this.blurY=0|e,this.quality=0|i}var t=createjs.extend(j,createjs.Filter);j.MUL_TABLE=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265,497,469,443,421,25,191,365,349,335,161,155,149,9,278,269,261,505,245,475,231,449,437,213,415,405,395,193,377,369,361,353,345,169,331,325,319,313,307,301,37,145,285,281,69,271,267,263,259,509,501,493,243,479,118,465,459,113,446,55,435,429,423,209,413,51,403,199,393,97,3,379,375,371,367,363,359,355,351,347,43,85,337,333,165,327,323,5,317,157,311,77,305,303,75,297,294,73,289,287,71,141,279,277,275,68,135,67,133,33,262,260,129,511,507,503,499,495,491,61,121,481,477,237,235,467,232,115,457,227,451,7,445,221,439,218,433,215,427,425,211,419,417,207,411,409,203,202,401,399,396,197,49,389,387,385,383,95,189,47,187,93,185,23,183,91,181,45,179,89,177,11,175,87,173,345,343,341,339,337,21,167,83,331,329,327,163,81,323,321,319,159,79,315,313,39,155,309,307,153,305,303,151,75,299,149,37,295,147,73,291,145,289,287,143,285,71,141,281,35,279,139,69,275,137,273,17,271,135,269,267,133,265,33,263,131,261,130,259,129,257,1],j.SHG_TABLE=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13,14,14,14,14,10,13,14,14,14,13,13,13,9,14,14,14,15,14,15,14,15,15,14,15,15,15,14,15,15,15,15,15,14,15,15,15,15,15,15,12,14,15,15,13,15,15,15,15,16,16,16,15,16,14,16,16,14,16,13,16,16,16,15,16,13,16,15,16,14,9,16,16,16,16,16,16,16,16,16,13,14,16,16,15,16,16,10,16,15,16,14,16,16,14,16,16,14,16,16,14,15,16,16,16,14,15,14,15,13,16,16,15,17,17,17,17,17,17,14,15,17,17,16,16,17,16,15,17,16,17,11,17,16,17,16,17,16,17,17,16,17,17,16,17,17,16,16,17,17,17,16,14,17,17,17,17,15,16,14,16,15,16,13,16,15,16,14,16,15,16,12,16,15,16,17,17,17,17,17,13,16,15,17,17,17,16,15,17,17,17,16,15,17,17,14,16,17,17,16,17,17,16,15,17,16,14,17,16,15,17,16,17,17,16,17,15,16,17,14,17,16,15,17,16,17,13,17,16,17,17,16,17,14,17,16,17,16,17,16,17,9],t.getBounds=function(t){var e=0|this.blurX,i=0|this.blurY;if(e<=0&&i<=0)return t;var n=Math.pow(this.quality,.2);return(t||new createjs.Rectangle).pad(e*n+1,i*n+1,e*n+1,i*n+1)},t.clone=function(){return new j(this.blurX,this.blurY,this.quality)},t.toString=function(){return"[BlurFilter]"},t._applyFilter=function(t){var e=this.blurX>>1;if(isNaN(e)||e<0)return!1;var i=this.blurY>>1;if(isNaN(i)||i<0)return!1;if(0==e&&0==i)return!1;var n=this.quality;(isNaN(n)||n<1)&&(n=1),3<(n|=0)&&(n=3),n<1&&(n=1);for(var r=t.data,s=0,o=0,a=0,l=0,p=0,h=0,u=0,c=0,d=0,_=0,y=0,f=0,m=0,x=0,v=0,g=e+e+1|0,b=i+i+1|0,z=0|t.width,w=0|t.height,C=z-1|0,P=w-1|0,T=1+e|0,S=1+i|0,M={r:0,b:0,g:0,a:0},A=M,a=1;a<g;a++)A=A.n={r:0,b:0,g:0,a:0};A.n=M;var O={r:0,b:0,g:0,a:0},k=O;for(a=1;a<b;a++)k=k.n={r:0,b:0,g:0,a:0};k.n=O;for(var E=null,I=0|j.MUL_TABLE[e],D=0|j.SHG_TABLE[e],B=0|j.MUL_TABLE[i],L=0|j.SHG_TABLE[i];0<n--;){u=h=0;for(var R=I,F=D,o=w;-1<--o;){for(c=T*(f=r[0|h]),d=T*(m=r[h+1|0]),_=T*(x=r[h+2|0]),y=T*(v=r[h+3|0]),A=M,a=T;-1<--a;)A.r=f,A.g=m,A.b=x,A.a=v,A=A.n;for(a=1;a<T;a++)l=h+((C<a?C:a)<<2)|0,c+=A.r=r[l],d+=A.g=r[l+1],_+=A.b=r[l+2],y+=A.a=r[l+3],A=A.n;for(E=M,s=0;s<z;s++)r[h++]=c*R>>>F,r[h++]=d*R>>>F,r[h++]=_*R>>>F,r[h++]=y*R>>>F,l=u+((l=s+e+1)<C?l:C)<<2,c-=E.r-(E.r=r[l]),d-=E.g-(E.g=r[l+1]),_-=E.b-(E.b=r[l+2]),y-=E.a-(E.a=r[l+3]),E=E.n;u+=z}for(R=B,F=L,s=0;s<z;s++){for(c=S*(f=r[h=s<<2|0])|0,d=S*(m=r[h+1|0])|0,_=S*(x=r[h+2|0])|0,y=S*(v=r[h+3|0])|0,k=O,a=0;a<S;a++)k.r=f,k.g=m,k.b=x,k.a=v,k=k.n;for(p=z,a=1;a<=i;a++)h=p+s<<2,c+=k.r=r[h],d+=k.g=r[h+1],_+=k.b=r[h+2],y+=k.a=r[h+3],k=k.n,a<P&&(p+=z);if(h=s,E=O,0<n)for(o=0;o<w;o++)r[(l=h<<2)+3]=v=y*R>>>F,0<v?(r[l]=c*R>>>F,r[l+1]=d*R>>>F,r[l+2]=_*R>>>F):r[l]=r[l+1]=r[l+2]=0,l=s+((l=o+S)<P?l:P)*z<<2,c-=E.r-(E.r=r[l]),d-=E.g-(E.g=r[l+1]),_-=E.b-(E.b=r[l+2]),y-=E.a-(E.a=r[l+3]),E=E.n,h+=z;else for(o=0;o<w;o++)r[(l=h<<2)+3]=v=y*R>>>F,0<v?(v=255/v,r[l]=(c*R>>>F)*v,r[l+1]=(d*R>>>F)*v,r[l+2]=(_*R>>>F)*v):r[l]=r[l+1]=r[l+2]=0,l=s+((l=o+S)<P?l:P)*z<<2,c-=E.r-(E.r=r[l]),d-=E.g-(E.g=r[l+1]),_-=E.b-(E.b=r[l+2]),y-=E.a-(E.a=r[l+3]),E=E.n,h+=z}}return!0},createjs.BlurFilter=createjs.promote(j,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function e(t){this.alphaMap=t,this._alphaMap=null,this._mapData=null}var t=createjs.extend(e,createjs.Filter);t.clone=function(){var t=new e(this.alphaMap);return t._alphaMap=this._alphaMap,t._mapData=this._mapData,t},t.toString=function(){return"[AlphaMapFilter]"},t._applyFilter=function(t){if(!this.alphaMap)return!0;if(!this._prepAlphaMap())return!1;for(var e=t.data,i=this._mapData,n=0,r=e.length;n<r;n+=4)e[n+3]=i[n]||0;return!0},t._prepAlphaMap=function(){if(!this.alphaMap)return!1;if(this.alphaMap==this._alphaMap&&this._mapData)return!0;this._mapData=null;var t,e=this._alphaMap=this.alphaMap,i=e;e instanceof HTMLCanvasElement?t=i.getContext("2d"):((i=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")).width=e.width,i.height=e.height,(t=i.getContext("2d")).drawImage(e,0,0));try{var n=t.getImageData(0,0,e.width,e.height)}catch(t){return!1}return this._mapData=n.data,!0},createjs.AlphaMapFilter=createjs.promote(e,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t){this.mask=t}var e=createjs.extend(t,createjs.Filter);e.applyFilter=function(t,e,i,n,r,s,o,a){return!this.mask||(null==o&&(o=e),null==a&&(a=i),(s=s||t).save(),t==s&&(s.globalCompositeOperation="destination-in",s.drawImage(this.mask,o,a),s.restore(),!0))},e.clone=function(){return new t(this.mask)},e.toString=function(){return"[AlphaMaskFilter]"},createjs.AlphaMaskFilter=createjs.promote(t,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i,n,r,s,o,a){this.redMultiplier=null!=t?t:1,this.greenMultiplier=null!=e?e:1,this.blueMultiplier=null!=i?i:1,this.alphaMultiplier=null!=n?n:1,this.redOffset=r||0,this.greenOffset=s||0,this.blueOffset=o||0,this.alphaOffset=a||0}var e=createjs.extend(t,createjs.Filter);e.toString=function(){return"[ColorFilter]"},e.clone=function(){return new t(this.redMultiplier,this.greenMultiplier,this.blueMultiplier,this.alphaMultiplier,this.redOffset,this.greenOffset,this.blueOffset,this.alphaOffset)},e._applyFilter=function(t){for(var e=t.data,i=e.length,n=0;n<i;n+=4)e[n]=e[n]*this.redMultiplier+this.redOffset,e[n+1]=e[n+1]*this.greenMultiplier+this.greenOffset,e[n+2]=e[n+2]*this.blueMultiplier+this.blueOffset,e[n+3]=e[n+3]*this.alphaMultiplier+this.alphaOffset;return!0},createjs.ColorFilter=createjs.promote(t,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function n(t,e,i,n){this.setColor(t,e,i,n)}var t=n.prototype;n.DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],n.LENGTH=(n.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]).length,t.setColor=function(t,e,i,n){return this.reset().adjustColor(t,e,i,n)},t.reset=function(){return this.copy(n.IDENTITY_MATRIX)},t.adjustColor=function(t,e,i,n){return this.adjustHue(n),this.adjustContrast(e),this.adjustBrightness(t),this.adjustSaturation(i)},t.adjustBrightness=function(t){return 0==t||isNaN(t)||(t=this._cleanValue(t,255),this._multiplyMatrix([1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0,0,0,0,0,1])),this},t.adjustContrast=function(t){return 0==t||isNaN(t)||(e=(t=this._cleanValue(t,100))<0?127+t/100*127:127*(e=0==(e=t%1)?n.DELTA_INDEX[t]:n.DELTA_INDEX[t<<0]*(1-e)+n.DELTA_INDEX[1+(t<<0)]*e)+127,this._multiplyMatrix([e/127,0,0,0,.5*(127-e),0,e/127,0,0,.5*(127-e),0,0,e/127,0,.5*(127-e),0,0,0,1,0,0,0,0,0,1])),this;var e},t.adjustSaturation=function(t){if(0==t||isNaN(t))return this;t=1+(0<(t=this._cleanValue(t,100))?3*t/100:t/100);return this._multiplyMatrix([.3086*(1-t)+t,.6094*(1-t),.082*(1-t),0,0,.3086*(1-t),.6094*(1-t)+t,.082*(1-t),0,0,.3086*(1-t),.6094*(1-t),.082*(1-t)+t,0,0,0,0,0,1,0,0,0,0,0,1]),this},t.adjustHue=function(t){if(0==t||isNaN(t))return this;t=this._cleanValue(t,180)/180*Math.PI;var e=Math.cos(t),t=Math.sin(t);return this._multiplyMatrix([.213+.787*e+-.213*t,.715+-.715*e+-.715*t,.072+-.072*e+.928*t,0,0,.213+-.213*e+.143*t,.715+e*(1-.715)+.14*t,.072+-.072*e+-.283*t,0,0,.213+-.213*e+-.787*t,.715+-.715*e+.715*t,.072+.928*e+.072*t,0,0,0,0,0,1,0,0,0,0,0,1]),this},t.concat=function(t){return(t=this._fixMatrix(t)).length!=n.LENGTH||this._multiplyMatrix(t),this},t.clone=function(){return(new n).copy(this)},t.toArray=function(){for(var t=[],e=0,i=n.LENGTH;e<i;e++)t[e]=this[e];return t},t.copy=function(t){for(var e=n.LENGTH,i=0;i<e;i++)this[i]=t[i];return this},t.toString=function(){return"[ColorMatrix]"},t._multiplyMatrix=function(t){for(var e,i=[],n=0;n<5;n++){for(e=0;e<5;e++)i[e]=this[e+5*n];for(e=0;e<5;e++){for(var r=0,s=0;s<5;s++)r+=t[e+5*s]*i[s];this[e+5*n]=r}}},t._cleanValue=function(t,e){return Math.min(e,Math.max(-e,t))},t._fixMatrix=function(t){return t instanceof n&&(t=t.toArray()),t.length<n.LENGTH?t=t.slice(0,t.length).concat(n.IDENTITY_MATRIX.slice(t.length,n.LENGTH)):t.length>n.LENGTH&&(t=t.slice(0,n.LENGTH)),t},createjs.ColorMatrix=n}(),this.createjs=this.createjs||{},function(){"use strict";function t(t){this.matrix=t}var e=createjs.extend(t,createjs.Filter);e.toString=function(){return"[ColorMatrixFilter]"},e.clone=function(){return new t(this.matrix)},e._applyFilter=function(t){for(var e,i,n,r,s=t.data,o=s.length,t=this.matrix,a=t[0],l=t[1],p=t[2],h=t[3],u=t[4],c=t[5],d=t[6],_=t[7],y=t[8],f=t[9],m=t[10],x=t[11],v=t[12],g=t[13],b=t[14],z=t[15],w=t[16],C=t[17],P=t[18],T=t[19],S=0;S<o;S+=4)e=s[S],i=s[S+1],n=s[S+2],r=s[S+3],s[S]=e*a+i*l+n*p+r*h+u,s[S+1]=e*c+i*d+n*_+r*y+f,s[S+2]=e*m+i*x+n*v+r*g+b,s[S+3]=e*z+i*w+n*C+r*P+T;return!0},createjs.ColorMatrixFilter=createjs.promote(t,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function n(){throw"Touch cannot be instantiated"}n.isSupported=function(){return!!("ontouchstart"in window||window.navigator.msPointerEnabled&&0<window.navigator.msMaxTouchPoints||window.navigator.pointerEnabled&&0<window.navigator.maxTouchPoints)},n.enable=function(t,e,i){return!!(t&&t.canvas&&n.isSupported())&&(t.__touch||(t.__touch={pointers:{},multitouch:!e,preventDefault:!i,count:0},"ontouchstart"in window?n._IOS_enable(t):(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&n._IE_enable(t)),!0)},n.disable=function(t){t&&("ontouchstart"in window?n._IOS_disable(t):(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&n._IE_disable(t),delete t.__touch)},n._IOS_enable=function(e){var t=e.canvas,i=e.__touch.f=function(t){n._IOS_handleEvent(e,t)};t.addEventListener("touchstart",i,!1),t.addEventListener("touchmove",i,!1),t.addEventListener("touchend",i,!1),t.addEventListener("touchcancel",i,!1)},n._IOS_disable=function(t){var e=t.canvas;e&&(t=t.__touch.f,e.removeEventListener("touchstart",t,!1),e.removeEventListener("touchmove",t,!1),e.removeEventListener("touchend",t,!1),e.removeEventListener("touchcancel",t,!1))},n._IOS_handleEvent=function(t,e){if(t){t.__touch.preventDefault&&e.preventDefault&&e.preventDefault();for(var i=e.changedTouches,n=e.type,r=0,s=i.length;r<s;r++){var o=i[r],a=o.identifier;o.target==t.canvas&&("touchstart"==n?this._handleStart(t,a,e,o.pageX,o.pageY):"touchmove"==n?this._handleMove(t,a,e,o.pageX,o.pageY):"touchend"!=n&&"touchcancel"!=n||this._handleEnd(t,a,e))}}},n._IE_enable=function(e){var t=e.canvas,i=e.__touch.f=function(t){n._IE_handleEvent(e,t)};void 0===window.navigator.pointerEnabled?(t.addEventListener("MSPointerDown",i,!1),window.addEventListener("MSPointerMove",i,!1),window.addEventListener("MSPointerUp",i,!1),window.addEventListener("MSPointerCancel",i,!1),e.__touch.preventDefault&&(t.style.msTouchAction="none")):(t.addEventListener("pointerdown",i,!1),window.addEventListener("pointermove",i,!1),window.addEventListener("pointerup",i,!1),window.addEventListener("pointercancel",i,!1),e.__touch.preventDefault&&(t.style.touchAction="none")),e.__touch.activeIDs={}},n._IE_disable=function(t){var e=t.__touch.f;void 0===window.navigator.pointerEnabled?(window.removeEventListener("MSPointerMove",e,!1),window.removeEventListener("MSPointerUp",e,!1),window.removeEventListener("MSPointerCancel",e,!1),t.canvas&&t.canvas.removeEventListener("MSPointerDown",e,!1)):(window.removeEventListener("pointermove",e,!1),window.removeEventListener("pointerup",e,!1),window.removeEventListener("pointercancel",e,!1),t.canvas&&t.canvas.removeEventListener("pointerdown",e,!1))},n._IE_handleEvent=function(t,e){var i,n,r;t&&(t.__touch.preventDefault&&e.preventDefault&&e.preventDefault(),i=e.type,n=e.pointerId,r=t.__touch.activeIDs,"MSPointerDown"==i||"pointerdown"==i?e.srcElement==t.canvas&&(r[n]=!0,this._handleStart(t,n,e,e.pageX,e.pageY)):r[n]&&("MSPointerMove"==i||"pointermove"==i?this._handleMove(t,n,e,e.pageX,e.pageY):"MSPointerUp"!=i&&"MSPointerCancel"!=i&&"pointerup"!=i&&"pointercancel"!=i||(delete r[n],this._handleEnd(t,n,e))))},n._handleStart=function(t,e,i,n,r){var s,o=t.__touch;!o.multitouch&&o.count||((s=o.pointers)[e]||(s[e]=!0,o.count++,t._handlePointerDown(e,i,n,r)))},n._handleMove=function(t,e,i,n,r){t.__touch.pointers[e]&&t._handlePointerMove(e,i,n,r)},n._handleEnd=function(t,e,i){var n=t.__touch,r=n.pointers;r[e]&&(n.count--,t._handlePointerUp(e,i,!0),delete r[e])},createjs.Touch=n}(),this.createjs=this.createjs||{},function(){"use strict";var t=createjs.EaselJS=createjs.EaselJS||{};t.version="0.8.2",t.buildDate="Thu, 26 Nov 2015 20:44:34 GMT"}(),function(t){var e;"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.Promise=t())}(function(){return function n(r,s,o){function a(i,t){if(!s[i]){if(!r[i]){var e="function"==typeof _dereq_&&_dereq_;if(!t&&e)return e(i,!0);if(l)return l(i,!0);e=new Error("Cannot find module '"+i+"'");throw e.code="MODULE_NOT_FOUND",e}e=s[i]={exports:{}};r[i][0].call(e.exports,function(t){var e=r[i][1][t];return a(e||t)},e,e.exports,n,r,s,o)}return s[i].exports}for(var l="function"==typeof _dereq_&&_dereq_,t=0;t<o.length;t++)a(o[t]);return a}({1:[function(t,e,i){"use strict";e.exports=function(t){function e(t){var e=new i(t),t=e.promise();return e.setHowMany(1),e.setUnwrap(),e.init(),t}var i=t._SomePromiseArray;t.any=e,t.prototype.any=function(){return e(this)}}},{}],2:[function(t,e,i){"use strict";function n(){this._isTickUsed=!1,this._lateQueue=new p(16),this._normalQueue=new p(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=l}function r(t,e,i){this._lateQueue.push(t,e,i),this._queueTick()}function s(t,e,i){this._normalQueue.push(t,e,i),this._queueTick()}function o(t){this._normalQueue._pushOne(t),this._queueTick()}var a;try{throw new Error}catch(t){a=t}var l=t("./schedule"),p=t("./queue"),h=t("./util");n.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},n.prototype.disableTrampolineIfNecessary=function(){h.hasDevTools&&(this._trampolineEnabled=!1)},n.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},n.prototype.fatalError=function(t,e){e?(process.stderr.write("Fatal "+(t instanceof Error?t.stack:t)+"\n"),process.exit(2)):this.throwLater(t)},n.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout(function(){t(e)},0);else try{this._schedule(function(){t(e)})}catch(t){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},h.hasDevTools?(n.prototype.invokeLater=function(t,e,i){this._trampolineEnabled?r.call(this,t,e,i):this._schedule(function(){setTimeout(function(){t.call(e,i)},100)})},n.prototype.invoke=function(t,e,i){this._trampolineEnabled?s.call(this,t,e,i):this._schedule(function(){t.call(e,i)})},n.prototype.settlePromises=function(t){this._trampolineEnabled?o.call(this,t):this._schedule(function(){t._settlePromises()})}):(n.prototype.invokeLater=r,n.prototype.invoke=s,n.prototype.settlePromises=o),n.prototype.invokeFirst=function(t,e,i){this._normalQueue.unshift(t,e,i),this._queueTick()},n.prototype._drainQueue=function(t){for(;0<t.length();){var e,i,n=t.shift();"function"==typeof n?(e=t.shift(),i=t.shift(),n.call(e,i)):n._settlePromises()}},n.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},n.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},n.prototype._reset=function(){this._isTickUsed=!1},e.exports=n,e.exports.firstLineError=a},{"./queue":26,"./schedule":29,"./util":36}],3:[function(t,e,i){"use strict";e.exports=function(r,s,o,a){function i(t,e){this._reject(e)}function l(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(i,i,null,this,t)}function p(t,e){0==(50397184&this._bitField)&&this._resolveCallback(e.target)}function h(t,e){e.promiseRejectionQueued||this._reject(t)}var u=!1;r.prototype.bind=function(t){u||(u=!0,r.prototype._propagateFrom=a.propagateFromFunction(),r.prototype._boundValue=a.boundValueFunction());var e=o(t),i=new r(s);i._propagateFrom(this,1);var n=this._target();return i._setBoundTo(e),e instanceof r?(t={promiseRejectionQueued:!1,promise:i,target:n,bindingPromise:e},n._then(s,l,void 0,i,t),e._then(p,h,void 0,i,t),i._setOnCancel(e)):i._resolveCallback(n),i},r.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=2097152|this._bitField,this._boundTo=t):this._bitField=-2097153&this._bitField},r.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},r.bind=function(t,e){return r.resolve(e).bind(t)}}},{}],4:[function(t,e,i){"use strict";var n;"undefined"!=typeof Promise&&(n=Promise);var r=t("./promise")();r.noConflict=function(){try{Promise===r&&(Promise=n)}catch(t){}return r},e.exports=r},{"./promise":22}],5:[function(t,e,i){"use strict";var n,r=Object.create;r&&(n=r(null),r=r(null),n[" size"]=r[" size"]=0),e.exports=function(n){function i(t){return function(t,e){var i;if(null!=t&&(i=t[e]),"function"==typeof i)return i;throw e="Object "+o.classString(t)+" has no method '"+o.toString(e)+"'",new n.TypeError(e)}(t,this.pop()).apply(t,this)}function r(t){return t[this]}function s(t){var e=+this;return e<0&&(e=Math.max(0,e+t.length)),t[e]}var o=t("./util"),a=o.canEvaluate;o.isIdentifier,n.prototype.call=function(t){var e=[].slice.call(arguments,1);return e.push(t),this._then(i,void 0,void 0,e,void 0)},n.prototype.get=function(t){var e;return e="number"==typeof t?s:a&&null!==(e=(void 0)(t))?e:r,this._then(e,void 0,void 0,t,void 0)}}},{"./util":36}],6:[function(l,t,e){"use strict";t.exports=function(t,e,i,n){var r=l("./util"),s=r.tryCatch,o=r.errorObj,a=t._async;t.prototype.break=t.prototype.cancel=function(){if(!n.cancellation())return this._warn("cancellation is disabled");for(var t=this,e=t;t.isCancellable();){if(!t._cancelBy(e)){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}var i=t._cancellationParent;if(null==i||!i.isCancellable()){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}t._isFollowing()&&t._followee().cancel(),e=t,t=i}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(t){return t===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this.isCancellable()&&(this._setCancelled(),a.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){0<this._length()&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(t,e){var i;if(r.isArray(t))for(var n=0;n<t.length;++n)this._doInvokeOnCancel(t[n],e);else void 0!==t&&("function"==typeof t?e||(i=s(t).call(this._boundValue()))===o&&(this._attachExtraTrace(i.e),a.throwLater(i.e)):t._resultCancelled(this))},t.prototype._invokeOnCancel=function(){var t=this._onCancel();this._unsetOnCancel(),a.invoke(this._doInvokeOnCancel,this,t)},t.prototype._invokeInternalOnCancel=function(){this.isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(t,e,i){"use strict";e.exports=function(u){var c=t("./util"),d=t("./es5").keys,_=c.tryCatch,y=c.errorObj;return function(l,p,h){return function(t){var e=h._boundValue();t:for(var i=0;i<l.length;++i){var n=l[i];if(n===Error||null!=n&&n.prototype instanceof Error){if(t instanceof n)return _(p).call(e,t)}else if("function"==typeof n){var r=_(n).call(e,t);if(r===y)return r;if(r)return _(p).call(e,t)}else if(c.isObject(t)){for(var s=d(n),o=0;o<s.length;++o){var a=s[o];if(n[a]!=t[a])continue t}return _(p).call(e,t)}}return u}}}},{"./es5":13,"./util":36}],8:[function(t,e,i){"use strict";e.exports=function(s){function o(){this._trace=new o.CapturedTrace(a())}function a(){var t=i.length-1;return 0<=t?i[t]:void 0}var l=!1,i=[];return s.prototype._promiseCreated=function(){},s.prototype._pushContext=function(){},s.prototype._popContext=function(){return null},s._peekContext=s.prototype._peekContext=function(){},o.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,i.push(this._trace))},o.prototype._popContext=function(){if(void 0===this._trace)return null;var t=i.pop(),e=t._promiseCreated;return t._promiseCreated=null,e},o.CapturedTrace=null,o.create=function(){return l?new o:void 0},o.deactivateLongStackTraces=function(){},o.activateLongStackTraces=function(){var t=s.prototype._pushContext,e=s.prototype._popContext,i=s._peekContext,n=s.prototype._peekContext,r=s.prototype._promiseCreated;o.deactivateLongStackTraces=function(){s.prototype._pushContext=t,s.prototype._popContext=e,s._peekContext=i,s.prototype._peekContext=n,s.prototype._promiseCreated=r,l=!1},l=!0,s.prototype._pushContext=o.prototype._pushContext,s.prototype._popContext=o.prototype._popContext,s._peekContext=s.prototype._peekContext=a,s.prototype._promiseCreated=function(){var t=this._peekContext();t&&null==t._promiseCreated&&(t._promiseCreated=this)}},o}},{}],9:[function(q,t,e){"use strict";t.exports=function(r,i){function t(t,e){return{promise:e}}function n(){return!1}function s(t,e,i){var n=this;try{t(e,i,function(t){if("function"!=typeof t)throw new TypeError("onCancel must be a function, got: "+M.toString(t));n._attachCancellationCallback(t)})}catch(t){return t}}function o(t){if(!this.isCancellable())return this;var e=this._onCancel();void 0!==e?M.isArray(e)?e.push(t):this._setOnCancel([e,t]):this._setOnCancel(t)}function a(){return this._onCancelField}function l(t){this._onCancelField=t}function p(){this._cancellationParent=void 0,this._onCancelField=void 0}function h(t,e){var i;0!=(1&e)&&(void 0===(i=(this._cancellationParent=t)._branchesRemainingToCancel)&&(i=0),t._branchesRemainingToCancel=i+1),0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}function e(){var t=this._boundTo;return void 0!==t&&t instanceof r?t.isFulfilled()?t.value():void 0:t}function u(){this._trace=new b(this._peekContext())}function c(t,e){var i;A(t)&&(void 0!==(i=this._trace)&&e&&(i=i._parent),void 0!==i?i.attachExtraTrace(t):t.__stackCleaned__||(i=y(t),M.notEnumerableProp(t,"stack",i.message+"\n"+i.stack.join("\n")),M.notEnumerableProp(t,"__stackCleaned__",!0)))}function d(t,e,i){var n;H.warnings&&(t=new S(t),e?i._attachExtraTrace(t):H.longStackTraces&&(n=r._peekContext())?n.attachExtraTrace(t):(n=y(t),t.stack=n.message+"\n"+n.stack.join("\n")),G("warning",t)||f(t,"",!0))}function _(t){for(var e=[],i=0;i<t.length;++i){var n=t[i],r="    (No stack trace)"===n||k.test(n),s=r&&X(n);r&&!s&&(I&&" "!==n.charAt(0)&&(n="    "+n),e.push(n))}return e}function y(t){var e=t.stack;return{message:t.toString(),stack:_(e="string"==typeof e&&0<e.length?function(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),i=0;i<e.length;++i){var n=e[i];if("    (No stack trace)"===n||k.test(n))break}return 0<i&&(e=e.slice(i)),e}(t):["    (No stack trace)"])}}function f(t,e,i){var n;"undefined"!=typeof console&&(t=M.isObject(t)?(n=t.stack,e+E(n,t)):e+String(t),"function"==typeof C?C(t,i):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(t))}function m(t,e,i,n){var r=!1;try{"function"==typeof e&&(r=!0,"rejectionHandled"===t?e(n):e(i,n))}catch(t){T.throwLater(t)}"unhandledRejection"===t?G(t,i,n)||r||f(i,"Unhandled rejection "):G(t,n)}function x(t){var e;if("function"==typeof t)i="[function "+(t.name||"anonymous")+"]";else{i=t&&"function"==typeof t.toString?t.toString():M.toString(t);if(/\[object [a-zA-Z0-9$_]+\]/.test(i))try{var i=JSON.stringify(t)}catch(t){}0===i.length&&(i="(empty array)")}return"(<"+((e=i).length<41?e:e.substr(0,38)+"...")+">, no stack trace)"}function v(){return"function"==typeof W}function g(t){t=t.match(V);return t?{fileName:t[1],line:parseInt(t[2],10)}:void 0}function b(t){this._parent=t,this._promisesCreated=0;t=this._length=1+(void 0===t?0:t._length);W(this,b),32<t&&this.uncycle()}var z,w,C,P=r._getDomain,T=r._async,S=q("./errors").Warning,M=q("./util"),A=M.canAttachTrace,O=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,k=null,E=null,I=!1,D=!(0==M.env("BLUEBIRD_DEBUG")||!M.env("BLUEBIRD_DEBUG")&&"development"!==M.env("NODE_ENV")),B=!(0==M.env("BLUEBIRD_WARNINGS")||!D&&!M.env("BLUEBIRD_WARNINGS")),D=!(0==M.env("BLUEBIRD_LONG_STACK_TRACES")||!D&&!M.env("BLUEBIRD_LONG_STACK_TRACES")),L=0!=M.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(B||!!M.env("BLUEBIRD_W_FORGOTTEN_RETURN"));r.prototype.suppressUnhandledRejections=function(){var t=this._target();t._bitField=-1048577&t._bitField|524288},r.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),T.invokeLater(this._notifyUnhandledRejection,this,void 0))},r.prototype._notifyUnhandledRejectionIsHandled=function(){m("rejectionHandled",z,void 0,this)},r.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},r.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},r.prototype._notifyUnhandledRejection=function(){var t;this._isRejectionUnhandled()&&(t=this._settledValue(),this._setUnhandledRejectionIsNotified(),m("unhandledRejection",w,t,this))},r.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},r.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},r.prototype._isUnhandledRejectionNotified=function(){return 0<(262144&this._bitField)},r.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},r.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},r.prototype._isRejectionUnhandled=function(){return 0<(1048576&this._bitField)},r.prototype._warn=function(t,e,i){return d(t,e,i||this)},r.onPossiblyUnhandledRejection=function(t){var e=P();w="function"==typeof t?null===e?t:e.bind(t):void 0},r.onUnhandledRejectionHandled=function(t){var e=P();z="function"==typeof t?null===e?t:e.bind(t):void 0};var R=function(){};r.longStackTraces=function(){if(T.haveItemsQueued()&&!H.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");var t,e;!H.longStackTraces&&v()&&(t=r.prototype._captureStackTrace,e=r.prototype._attachExtraTrace,H.longStackTraces=!0,R=function(){if(T.haveItemsQueued()&&!H.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");r.prototype._captureStackTrace=t,r.prototype._attachExtraTrace=e,i.deactivateLongStackTraces(),T.enableTrampoline(),H.longStackTraces=!1},r.prototype._captureStackTrace=u,r.prototype._attachExtraTrace=c,i.activateLongStackTraces(),T.disableTrampolineIfNecessary())},r.hasLongStackTraces=function(){return H.longStackTraces&&v()};var F=function(){try{var t=document.createEvent("CustomEvent");return t.initCustomEvent("testingtheevent",!1,!0,{}),M.global.dispatchEvent(t),function(t,e){var i=document.createEvent("CustomEvent");return i.initCustomEvent(t.toLowerCase(),!1,!0,e),!M.global.dispatchEvent(i)}}catch(t){}return function(){return!1}}(),j=M.isNode?function(){return process.emit.apply(process,arguments)}:M.global?function(t){t="on"+t.toLowerCase(),t=M.global[t];return!!t&&(t.apply(M.global,[].slice.call(arguments,1)),!0)}:function(){return!1},N={promiseCreated:t,promiseFulfilled:t,promiseRejected:t,promiseResolved:t,promiseCancelled:t,promiseChained:function(t,e,i){return{promise:e,child:i}},warning:function(t,e){return{warning:e}},unhandledRejection:function(t,e,i){return{reason:e,promise:i}},rejectionHandled:t},G=function(t){var e=!1;try{e=j.apply(null,arguments)}catch(t){T.throwLater(t),e=!0}var i=!1;try{i=F(t,N[t].apply(null,arguments))}catch(t){T.throwLater(t),i=!0}return i||e};r.config=function(t){var e;if("longStackTraces"in(t=Object(t))&&(t.longStackTraces?r.longStackTraces():!t.longStackTraces&&r.hasLongStackTraces()&&R()),"warnings"in t&&(e=t.warnings,H.warnings=!!e,L=H.warnings,M.isObject(e)&&"wForgottenReturn"in e&&(L=!!e.wForgottenReturn)),"cancellation"in t&&t.cancellation&&!H.cancellation){if(T.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");r.prototype._clearCancellationData=p,r.prototype._propagateFrom=h,r.prototype._onCancel=a,r.prototype._setOnCancel=l,r.prototype._attachCancellationCallback=o,r.prototype._execute=s,U=h,H.cancellation=!0}"monitoring"in t&&(t.monitoring&&!H.monitoring?(H.monitoring=!0,r.prototype._fireEvent=G):!t.monitoring&&H.monitoring&&(H.monitoring=!1,r.prototype._fireEvent=n))},r.prototype._fireEvent=n,r.prototype._execute=function(t,e,i){try{t(e,i)}catch(t){return t}},r.prototype._onCancel=function(){},r.prototype._setOnCancel=function(t){},r.prototype._attachCancellationCallback=function(t){},r.prototype._captureStackTrace=function(){},r.prototype._attachExtraTrace=function(){},r.prototype._clearCancellationData=function(){},r.prototype._propagateFrom=function(t,e){};var U=function(t,e){0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)},X=function(){return!1},V=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;M.inherits(b,Error),(i.CapturedTrace=b).prototype.uncycle=function(){var t=this._length;if(!(t<2)){for(var e=[],i={},n=0,r=this;void 0!==r;++n)e.push(r),r=r._parent;for(n=(t=this._length=n)-1;0<=n;--n){var s=e[n].stack;void 0===i[s]&&(i[s]=n)}for(n=0;n<t;++n){var o=i[e[n].stack];if(void 0!==o&&o!==n){0<o&&(e[o-1]._parent=void 0,e[o-1]._length=1),e[n]._parent=void 0,e[n]._length=1;var a=0<n?e[n-1]:this;o<t-1?(a._parent=e[o+1],a._parent.uncycle(),a._length=a._parent._length+1):(a._parent=void 0,a._length=1);for(var l=a._length+1,p=n-2;0<=p;--p)e[p]._length=l,l++;return}}}},b.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=y(t),i=e.message,n=[e.stack],r=this;void 0!==r;)n.push(_(r.stack.split("\n"))),r=r._parent;(function(t){for(var e=t[0],i=1;i<t.length;++i){for(var n=t[i],r=e.length-1,s=e[r],o=-1,a=n.length-1;0<=a;--a)if(n[a]===s){o=a;break}for(a=o;0<=a;--a){var l=n[a];if(e[r]!==l)break;e.pop(),r--}e=n}})(n),function(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}(n),M.notEnumerableProp(t,"stack",function(t,e){for(var i=0;i<e.length-1;++i)e[i].push("From previous event:"),e[i]=e[i].join("\n");return i<e.length&&(e[i]=e[i].join("\n")),t+"\n"+e.join("\n")}(i,n)),M.notEnumerableProp(t,"__stackCleaned__",!0)}};var W=function(){function t(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():x(e)}var e=/^\s*at\s*/;if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,k=e,E=t;var i=Error.captureStackTrace;return X=function(t){return O.test(t)},function(t,e){Error.stackTraceLimit+=6,i(t,e),Error.stackTraceLimit-=6}}var n,r=new Error;if("string"==typeof r.stack&&0<=r.stack.split("\n")[0].indexOf("stackDetection@"))return k=/@/,E=t,I=!0,function(t){t.stack=(new Error).stack};try{throw new Error}catch(t){n="stack"in t}return"stack"in r||!n||"number"!=typeof Error.stackTraceLimit?(E=function(t,e){return"string"==typeof t?t:"object"!=typeof e&&"function"!=typeof e||void 0===e.name||void 0===e.message?x(e):e.toString()},null):(k=e,E=t,function(e){Error.stackTraceLimit+=6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(C=function(t){console.warn(t)},M.isNode&&process.stderr.isTTY?C=function(t,e){e=e?"[33m":"[31m";console.warn(e+t+"[0m\n")}:M.isNode||"string"!=typeof(new Error).stack||(C=function(t,e){console.warn("%c"+t,e?"color: darkorange":"color: red")}));var H={warnings:B,longStackTraces:!1,cancellation:!1,monitoring:!1};return D&&r.longStackTraces(),{longStackTraces:function(){return H.longStackTraces},warnings:function(){return H.warnings},cancellation:function(){return H.cancellation},monitoring:function(){return H.monitoring},propagateFromFunction:function(){return U},boundValueFunction:function(){return e},checkForgottenReturns:function(t,e,i,n,r){void 0===t&&null!==e&&L&&(void 0!==r&&r._returnedNonUndefined()||0!=(65535&n._bitField)&&(i&&(i+=" "),i="a promise was created in a "+i+"handler but was not returned from it",n._warn(i,!0,e)))},setBounds:function(t,e){if(v()){for(var i,n,r=t.stack.split("\n"),s=e.stack.split("\n"),o=-1,a=-1,l=0;l<r.length;++l)if(p=g(r[l])){i=p.fileName,o=p.line;break}for(var p,l=0;l<s.length;++l)if(p=g(s[l])){n=p.fileName,a=p.line;break}o<0||a<0||!i||!n||i!==n||a<=o||(X=function(t){if(O.test(t))return!0;t=g(t);return!!(t&&t.fileName===i&&o<=t.line&&t.line<=a)})}},warn:d,deprecated:function(t,e){return t+=" is deprecated and will be removed in a future version.",e&&(t+=" Use "+e+" instead."),d(t)},CapturedTrace:b,fireDomEvent:F,fireGlobalEvent:j}}},{"./errors":12,"./util":36}],10:[function(t,e,i){"use strict";e.exports=function(i){function n(){return this.value}function r(){throw this.reason}i.prototype.return=i.prototype.thenReturn=function(t){return t instanceof i&&t.suppressUnhandledRejections(),this._then(n,void 0,void 0,{value:t},void 0)},i.prototype.throw=i.prototype.thenThrow=function(t){return this._then(r,void 0,void 0,{reason:t},void 0)},i.prototype.catchThrow=function(t){if(arguments.length<=1)return this._then(void 0,r,void 0,{reason:t},void 0);var e=arguments[1];return this.caught(t,function(){throw e})},i.prototype.catchReturn=function(t){if(arguments.length<=1)return t instanceof i&&t.suppressUnhandledRejections(),this._then(void 0,n,void 0,{value:t},void 0);var e=arguments[1];e instanceof i&&e.suppressUnhandledRejections();return this.caught(t,function(){return e})}}},{}],11:[function(t,e,i){"use strict";e.exports=function(t,i){function n(){return e(this)}function r(t,e){return s(t,e,i,i)}var s=t.reduce,e=t.all;t.prototype.each=function(t){return this.mapSeries(t)._then(n,void 0,void 0,this,void 0)},t.prototype.mapSeries=function(t){return s(this,t,i,i)},t.each=function(t,e){return r(t,e)._then(n,void 0,void 0,t,void 0)},t.mapSeries=r}},{}],12:[function(t,e,i){"use strict";function n(e,i){function n(t){return this instanceof n?(u(this,"message","string"==typeof t?t:i),u(this,"name",e),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new n(t)}return h(n,Error),n}function r(t){return this instanceof r?(u(this,"name","OperationalError"),u(this,"message",t),this.cause=t,this.isOperational=!0,void(t instanceof Error?(u(this,"message",t.message),u(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new r(t)}var s,o,a=t("./es5"),l=a.freeze,p=t("./util"),h=p.inherits,u=p.notEnumerableProp,c=n("Warning","warning"),d=n("CancellationError","cancellation error"),t=n("TimeoutError","timeout error"),_=n("AggregateError","aggregate error");try{s=TypeError,o=RangeError}catch(t){s=n("TypeError","type error"),o=n("RangeError","range error")}for(var y="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),f=0;f<y.length;++f)"function"==typeof Array.prototype[y[f]]&&(_.prototype[y[f]]=Array.prototype[y[f]]);a.defineProperty(_.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),_.prototype.isOperational=!0;var m=0;_.prototype.toString=function(){var t=Array(4*m+1).join(" "),e="\n"+t+"AggregateError of:\n";m++,t=Array(4*m+1).join(" ");for(var i=0;i<this.length;++i){for(var n=this[i]===this?"[Circular AggregateError]":this[i]+"",r=n.split("\n"),s=0;s<r.length;++s)r[s]=t+r[s];e+=(n=r.join("\n"))+"\n"}return m--,e},h(r,Error);p=Error.__BluebirdErrorTypes__;p||(p=l({CancellationError:d,TimeoutError:t,OperationalError:r,RejectionError:r,AggregateError:_}),a.defineProperty(Error,"__BluebirdErrorTypes__",{value:p,writable:!1,enumerable:!1,configurable:!1})),e.exports={Error:Error,TypeError:s,RangeError:o,CancellationError:p.CancellationError,OperationalError:p.OperationalError,TimeoutError:p.TimeoutError,AggregateError:p.AggregateError,Warning:c}},{"./es5":13,"./util":36}],13:[function(t,e,i){var n,r,s,o,a=function(){"use strict";return void 0===this}();a?e.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:a,propertyIsWritable:function(t,e){e=Object.getOwnPropertyDescriptor(t,e);return!(e&&!e.writable&&!e.set)}}:(n={}.hasOwnProperty,r={}.toString,s={}.constructor.prototype,o=function(t){var e,i=[];for(e in t)n.call(t,e)&&i.push(e);return i},e.exports={isArray:function(t){try{return"[object Array]"===r.call(t)}catch(t){return!1}},keys:o,names:o,defineProperty:function(t,e,i){return t[e]=i.value,t},getDescriptor:function(t,e){return{value:t[e]}},freeze:function(t){return t},getPrototypeOf:function(t){try{return Object(t).constructor.prototype}catch(t){return s}},isES5:a,propertyIsWritable:function(){return!0}})},{}],14:[function(t,e,i){"use strict";e.exports=function(t,n){var r=t.map;t.prototype.filter=function(t,e){return r(this,t,e,n)},t.filter=function(t,e,i){return r(t,e,i,n)}}},{}],15:[function(i,t,e){"use strict";t.exports=function(r,s){function o(t,e,i){this.promise=t,this.type=e,this.handler=i,this.called=!1,this.cancelPromise=null}function a(t){this.finallyHandler=t}function l(t,e){return null!=t.cancelPromise&&(1<arguments.length?t.cancelPromise._reject(e):t.cancelPromise._cancel(),t.cancelPromise=null,1)}function p(){return e.call(this,this.promise._target()._settledValue())}function h(t){return l(this,t)?void 0:(c.e=t,c)}function e(t){var e=this.promise,i=this.handler;if(!this.called){this.called=!0;var n=this.isFinallyHandler()?i.call(e._boundValue()):i.call(e._boundValue(),t);if(void 0!==n){e._setReturnedNonUndefined();i=s(n,e);if(i instanceof r){if(null!=this.cancelPromise){if(i.isCancelled()){n=new u("late cancellation observer");return e._attachExtraTrace(n),c.e=n,c}i.isPending()&&i._attachCancellationCallback(new a(this))}return i._then(p,h,void 0,this,void 0)}}}return e.isRejected()?(l(this),c.e=t,c):(l(this),t)}var t=i("./util"),u=r.CancellationError,c=t.errorObj;return o.prototype.isFinallyHandler=function(){return 0===this.type},a.prototype._resultCancelled=function(){l(this.finallyHandler)},r.prototype._passThrough=function(t,e,i,n){return"function"!=typeof t?this.then():this._then(i,n,void 0,new o(this,e,t),void 0)},r.prototype.lastly=r.prototype.finally=function(t){return this._passThrough(t,0,e,e)},r.prototype.tap=function(t){return this._passThrough(t,1,e)},o}},{"./util":36}],16:[function(r,t,e){"use strict";t.exports=function(o,i,s,a,t,n){function l(t,e,i,n){var r=this._promise=new o(s);r._captureStackTrace(),r._setOnCancel(this),this._stack=n,this._generatorFunction=t,this._receiver=e,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(c):c,this._yieldedPromise=null}var p=r("./errors").TypeError,e=r("./util"),h=e.errorObj,u=e.tryCatch,c=[];e.inherits(l,t),l.prototype._isResolved=function(){return null===this._promise},l.prototype._cleanup=function(){this._promise=this._generator=null},l.prototype._promiseCancelled=function(){var t,e;this._isResolved()||(void 0!==this._generator.return?(this._promise._pushContext(),t=u(this._generator.return).call(this._generator,void 0),this._promise._popContext()):(e=new o.CancellationError("generator .return() sentinel"),o.coroutine.returnSentinel=e,this._promise._attachExtraTrace(e),this._promise._pushContext(),t=u(this._generator.throw).call(this._generator,e),this._promise._popContext(),t===h&&t.e===e&&(t=null)),e=this._promise,this._cleanup(),t===h?e._rejectCallback(t.e,!1):e.cancel())},l.prototype._promiseFulfilled=function(t){this._yieldedPromise=null,this._promise._pushContext();t=u(this._generator.next).call(this._generator,t);this._promise._popContext(),this._continue(t)},l.prototype._promiseRejected=function(t){this._yieldedPromise=null,this._promise._attachExtraTrace(t),this._promise._pushContext();t=u(this._generator.throw).call(this._generator,t);this._promise._popContext(),this._continue(t)},l.prototype._resultCancelled=function(){var t;this._yieldedPromise instanceof o&&(t=this._yieldedPromise,this._yieldedPromise=null,this._promiseCancelled(),t.cancel())},l.prototype.promise=function(){return this._promise},l.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},l.prototype._continue=function(t){var e=this._promise;if(t===h)return this._cleanup(),e._rejectCallback(t.e,!1);var i=t.value;if(!0===t.done)return this._cleanup(),e._resolveCallback(i);t=a(i,this._promise);t instanceof o||null!==(t=function(t,e,i){for(var n=0;n<e.length;++n){i._pushContext();var r=u(e[n])(t);if(i._popContext(),r===h){i._pushContext();var s=o.reject(h.e);return i._popContext(),s}r=a(r,i);if(r instanceof o)return r}return null}(t,this._yieldHandlers,this._promise))?0==(50397184&(e=(t=t._target())._bitField))?(this._yieldedPromise=t)._proxy(this,null):0!=(33554432&e)?this._promiseFulfilled(t._value()):0!=(16777216&e)?this._promiseRejected(t._reason()):this._promiseCancelled():this._promiseRejected(new p("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",i)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},o.coroutine=function(n,t){if("function"!=typeof n)throw new p("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=Object(t).yieldHandler,s=l,o=(new Error).stack;return function(){var t=n.apply(this,arguments),e=new s(void 0,void 0,r,o),i=e.promise();return e._generator=t,e._promiseFulfilled(void 0),i}},o.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new p("expecting a function but got "+e.classString(t));c.push(t)},o.spawn=function(t){if(n.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof t)return i("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var e=new l(t,this),t=e.promise();return e._run(o.spawn),t}}},{"./errors":12,"./util":36}],17:[function(s,t,e){"use strict";t.exports=function(t,i,e,n){var r=s("./util");r.canEvaluate,r.tryCatch,r.errorObj,t.join=function(){var t,e=arguments.length-1;0<e&&"function"==typeof arguments[e]&&(t=arguments[e]);var e=[].slice.call(arguments);t&&e.pop();e=new i(e).promise();return void 0!==t?e.spread(t):e}}},{"./util":36}],18:[function(e,t,i){"use strict";t.exports=function(p,t,r,h,s,u){function o(t,e,i,n){this.constructor$(t),this._promise._captureStackTrace();t=a();this._callback=null===t?e:t.bind(e),this._preservedValues=n===s?new Array(this.length()):null,this._limit=i,this._inFlight=0,this._queue=1<=i?[]:_,this._init$(void 0,-2)}function i(t,e,i,n){if("function"!=typeof e)return r("expecting a function but got "+l.classString(e));i="object"==typeof i&&null!==i?i.concurrency:0;return new o(t,e,i="number"==typeof i&&isFinite(i)&&1<=i?i:0,n).promise()}var a=p._getDomain,l=e("./util"),c=l.tryCatch,d=l.errorObj,_=[];l.inherits(o,t),o.prototype._init=function(){},o.prototype._promiseFulfilled=function(t,e){var i=this._values,n=this.length(),r=this._preservedValues,s=this._limit;if(e<0){if(i[e=-1*e-1]=t,1<=s&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(1<=s&&this._inFlight>=s)return i[e]=t,this._queue.push(e),!1;null!==r&&(r[e]=t);var o=this._promise,a=this._callback,l=o._boundValue();o._pushContext();l=c(a).call(l,t,e,n),t=o._popContext();if(u.checkForgottenReturns(l,t,null!==r?"Promise.filter":"Promise.map",o),l===d)return this._reject(l.e),!0;t=h(l,this._promise);if(t instanceof p){o=(t=t._target())._bitField;if(0==(50397184&o))return 1<=s&&this._inFlight++,(i[e]=t)._proxy(this,-1*(e+1)),!1;if(0==(33554432&o))return 0!=(16777216&o)?this._reject(t._reason()):this._cancel(),!0;l=t._value()}i[e]=l}return n<=++this._totalResolved&&(null!==r?this._filter(i,r):this._resolve(i),!0)},o.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,i=this._values;0<t.length&&this._inFlight<e;){if(this._isResolved())return;var n=t.pop();this._promiseFulfilled(i[n],n)}},o.prototype._filter=function(t,e){for(var i=e.length,n=new Array(i),r=0,s=0;s<i;++s)t[s]&&(n[r++]=e[s]);n.length=r,this._resolve(n)},o.prototype.preservedValues=function(){return this._preservedValues},p.prototype.map=function(t,e){return i(this,t,e,null)},p.map=i}},{"./util":36}],19:[function(e,t,i){"use strict";t.exports=function(r,s,t,o,a){var l=e("./util"),p=l.tryCatch;r.method=function(n){if("function"!=typeof n)throw new r.TypeError("expecting a function but got "+l.classString(n));return function(){var t=new r(s);t._captureStackTrace(),t._pushContext();var e=p(n).apply(this,arguments),i=t._popContext();return a.checkForgottenReturns(e,i,"Promise.method",t),t._resolveFromSyncValue(e),t}},r.attempt=r.try=function(t){if("function"!=typeof t)return o("expecting a function but got "+l.classString(t));var e,i,n=new r(s);n._captureStackTrace(),n._pushContext(),i=1<arguments.length?(a.deprecated("calling Promise.try with more than 1 argument"),i=arguments[1],e=arguments[2],l.isArray(i)?p(t).apply(e,i):p(t).call(e,i)):p(t)();t=n._popContext();return a.checkForgottenReturns(i,t,"Promise.try",n),n._resolveFromSyncValue(i),n},r.prototype._resolveFromSyncValue=function(t){t===l.errorObj?this._rejectCallback(t.e,!1):this._resolveCallback(t,!0)}}},{"./util":36}],20:[function(t,e,i){"use strict";function s(t){var e,i;if((i=t)instanceof Error&&p.getPrototypeOf(i)===Error.prototype){(e=new l(t)).name=t.name,e.message=t.message,e.stack=t.stack;for(var n=p.keys(t),r=0;r<n.length;++r){var s=n[r];h.test(s)||(e[s]=t[s])}return e}return o.markAsOriginatingFromRejection(t),t}var o=t("./util"),a=o.maybeWrapAsError,l=t("./errors").OperationalError,p=t("./es5"),h=/^(?:name|message|stack|cause)$/;e.exports=function(n,r){return function(t,e){var i;null!==n&&(t?(i=s(a(t)),n._attachExtraTrace(i),n._reject(i)):r?(i=[].slice.call(arguments,1),n._fulfill(i)):n._fulfill(e),n=null)}}},{"./errors":12,"./es5":13,"./util":36}],21:[function(e,t,i){"use strict";t.exports=function(t){function n(t,e){if(!i.isArray(t))return r.call(this,t,e);t=a(e).apply(this._boundValue(),[null].concat(t));t===l&&o.throwLater(t.e)}function r(t,e){var i=this._boundValue(),t=void 0===t?a(e).call(i,null):a(e).call(i,null,t);t===l&&o.throwLater(t.e)}function s(t,e){var i;t||((i=new Error(t+"")).cause=t,t=i);t=a(e).call(this._boundValue(),t);t===l&&o.throwLater(t.e)}var i=e("./util"),o=t._async,a=i.tryCatch,l=i.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(t,e){var i;return"function"==typeof t&&(i=r,void 0!==e&&Object(e).spread&&(i=n),this._then(i,s,void 0,this,t)),this}}},{"./util":36}],22:[function(M,t,e){"use strict";t.exports=function(){function a(){}function u(t){this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,t!==m&&(function(t,e){if("function"!=typeof e)throw new y("expecting a function but got "+h.classString(e));if(t.constructor!==u)throw new y("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n")}(this,t),this._resolveFromExecutor(t)),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function t(t){this.promise._resolveCallback(t)}function e(t){this.promise._rejectCallback(t,!1)}function i(t){var e=new u(m);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._promise0=t,e._receiver0=t}function o(){return new y("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")}function l(){return new u.PromiseInspection(this._target())}function p(t){return u.reject(new y(t))}var s={},h=M("./util"),c=h.isNode?function(){var t=process.domain;return void 0===t&&(t=null),t}:function(){return null};h.notEnumerableProp(u,"_getDomain",c);var n=M("./es5"),r=M("./async"),d=new r;n.defineProperty(u,"_async",{value:d});var _=M("./errors"),y=u.TypeError=_.TypeError;u.RangeError=_.RangeError;var f=u.CancellationError=_.CancellationError;u.TimeoutError=_.TimeoutError,u.OperationalError=_.OperationalError,u.RejectionError=_.OperationalError,u.AggregateError=_.AggregateError;var m=function(){},x={},v={},g=M("./thenables")(u,m),b=M("./promise_array")(u,m,g,p,a),n=M("./context")(u),_=n.create,z=M("./debuggability")(u,n),w=(z.CapturedTrace,M("./finally")(u,g)),C=M("./catch_filter")(v),P=M("./nodeback"),T=h.errorObj,S=h.tryCatch;return u.prototype.toString=function(){return"[object Promise]"},u.prototype.caught=u.prototype.catch=function(t){var e=arguments.length;if(1<e){for(var i=new Array(e-1),n=0,r=0;r<e-1;++r){var s=arguments[r];if(!h.isObject(s))return p("expecting an object but got "+h.classString(s));i[n++]=s}return i.length=n,t=arguments[r],this.then(void 0,C(i,t,this))}return this.then(void 0,t)},u.prototype.reflect=function(){return this._then(l,l,void 0,this,void 0)},u.prototype.then=function(t,e){var i;return z.warnings()&&0<arguments.length&&"function"!=typeof t&&"function"!=typeof e&&(i=".then() only accepts functions but was passed: "+h.classString(t),1<arguments.length&&(i+=", "+h.classString(e)),this._warn(i)),this._then(t,e,void 0,void 0,void 0)},u.prototype.done=function(t,e){this._then(t,e,void 0,void 0,void 0)._setIsFinal()},u.prototype.spread=function(t){return"function"!=typeof t?p("expecting a function but got "+h.classString(t)):this.all()._then(t,void 0,void 0,x,void 0)},u.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},u.prototype.all=function(){return 0<arguments.length&&this._warn(".all() was passed arguments but it does not take any"),new b(this).promise()},u.prototype.error=function(t){return this.caught(h.originatesFromRejection,t)},u.is=function(t){return t instanceof u},u.fromNode=u.fromCallback=function(t){var e=new u(m);e._captureStackTrace();var i=1<arguments.length&&!!Object(arguments[1]).multiArgs,i=S(t)(P(e,i));return i===T&&e._rejectCallback(i.e,!0),e._isFateSealed()||e._setAsyncGuaranteed(),e},u.all=function(t){return new b(t).promise()},u.resolve=u.fulfilled=u.cast=function(t){var e=g(t);return e instanceof u||((e=new u(m))._captureStackTrace(),e._setFulfilled(),e._rejectionHandler0=t),e},u.reject=u.rejected=function(t){var e=new u(m);return e._captureStackTrace(),e._rejectCallback(t,!0),e},u.setScheduler=function(t){if("function"!=typeof t)throw new y("expecting a function but got "+h.classString(t));var e=d._schedule;return d._schedule=t,e},u.prototype._then=function(t,e,i,n,r){var s=void 0!==r,o=s?r:new u(m),a=this._target(),l=a._bitField;s||(o._propagateFrom(this,3),o._captureStackTrace(),void 0===n&&0!=(2097152&this._bitField)&&(n=0!=(50397184&l)?this._boundValue():a===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,o));var p,h,r=c();return 0!=(50397184&l)?(s=a._settlePromiseCtx,0!=(33554432&l)?(h=a._rejectionHandler0,p=t):0!=(16777216&l)?(h=a._fulfillmentHandler0,p=e,a._unsetRejectionIsUnhandled()):(s=a._settlePromiseLateCancellationObserver,h=new f("late cancellation observer"),a._attachExtraTrace(h),p=e),d.invoke(s,a,{handler:null===r?p:"function"==typeof p&&r.bind(p),promise:o,receiver:n,value:h})):a._addCallbacks(t,e,o,n,r),o},u.prototype._length=function(){return 65535&this._bitField},u.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},u.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},u.prototype._setLength=function(t){this._bitField=-65536&this._bitField|65535&t},u.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},u.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},u.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},u.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},u.prototype._isFinal=function(){return 0<(4194304&this._bitField)},u.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},u.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},u.prototype._setAsyncGuaranteed=function(){this._bitField=134217728|this._bitField},u.prototype._receiverAt=function(t){t=0===t?this._receiver0:this[4*t-4+3];return t===s?void 0:void 0===t&&this._isBound()?this._boundValue():t},u.prototype._promiseAt=function(t){return this[4*t-4+2]},u.prototype._fulfillmentHandlerAt=function(t){return this[4*t-4]},u.prototype._rejectionHandlerAt=function(t){return this[4*t-4+1]},u.prototype._boundValue=function(){},u.prototype._migrateCallback0=function(t){var e=(t._bitField,t._fulfillmentHandler0),i=t._rejectionHandler0,n=t._promise0,t=t._receiverAt(0);void 0===t&&(t=s),this._addCallbacks(e,i,n,t,null)},u.prototype._migrateCallbackAt=function(t,e){var i=t._fulfillmentHandlerAt(e),n=t._rejectionHandlerAt(e),r=t._promiseAt(e),e=t._receiverAt(e);void 0===e&&(e=s),this._addCallbacks(i,n,r,e,null)},u.prototype._addCallbacks=function(t,e,i,n,r){var s,o=this._length();return 65531<=o&&(o=0,this._setLength(0)),0===o?(this._promise0=i,this._receiver0=n,"function"==typeof t&&(this._fulfillmentHandler0=null===r?t:r.bind(t)),"function"==typeof e&&(this._rejectionHandler0=null===r?e:r.bind(e))):(this[2+(s=4*o-4)]=i,this[3+s]=n,"function"==typeof t&&(this[s]=null===r?t:r.bind(t)),"function"==typeof e&&(this[1+s]=null===r?e:r.bind(e))),this._setLength(o+1),o},u.prototype._proxy=function(t,e){this._addCallbacks(void 0,void 0,e,t,null)},u.prototype._resolveCallback=function(t,e){if(0==(117506048&this._bitField)){if(t===this)return this._rejectCallback(o(),!1);var i=g(t,this);if(!(i instanceof u))return this._fulfill(t);e&&this._propagateFrom(i,2);var n=i._target();if(n!==this){i=n._bitField;if(0==(50397184&i)){var r=this._length();0<r&&n._migrateCallback0(this);for(var s=1;s<r;++s)n._migrateCallbackAt(this,s);this._setFollowing(),this._setLength(0),this._setFollowee(n)}else 0!=(33554432&i)?this._fulfill(n._value()):0!=(16777216&i)?this._reject(n._reason()):(i=new f("late cancellation observer"),n._attachExtraTrace(i),this._reject(i))}else this._reject(o())}},u.prototype._rejectCallback=function(t,e,i){var n=h.ensureErrorObject(t),r=n===t;r||i||!z.warnings()||(i="a promise was rejected with a non-error: "+h.classString(t),this._warn(i,!0)),this._attachExtraTrace(n,!!e&&r),this._reject(t)},u.prototype._resolveFromExecutor=function(t){var e=this;this._captureStackTrace(),this._pushContext();var i=!0,t=this._execute(t,function(t){e._resolveCallback(t)},function(t){e._rejectCallback(t,i)}),i=!1;this._popContext(),void 0!==t&&e._rejectCallback(t,!0)},u.prototype._settlePromiseFromHandler=function(t,e,i,n){var r;0==(65536&n._bitField)&&(n._pushContext(),e===x?i&&"number"==typeof i.length?r=S(t).apply(this._boundValue(),i):(r=T).e=new y("cannot .spread() a non-array: "+h.classString(i)):r=S(t).call(e,i),e=n._popContext(),0==(65536&n._bitField)&&(r===v?n._reject(i):r===T?n._rejectCallback(r.e,!1):(z.checkForgottenReturns(r,e,"",n,this),n._resolveCallback(r))))},u.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},u.prototype._followee=function(){return this._rejectionHandler0},u.prototype._setFollowee=function(t){this._rejectionHandler0=t},u.prototype._settlePromise=function(t,e,i,n){var r=t instanceof u,s=this._bitField,o=0!=(134217728&s);0!=(65536&s)?(r&&t._invokeInternalOnCancel(),i instanceof w&&i.isFinallyHandler()?(i.cancelPromise=t,S(e).call(i,n)===T&&t._reject(T.e)):e===l?t._fulfill(l.call(i)):i instanceof a?i._promiseCancelled(t):r||t instanceof b?t._cancel():i.cancel()):"function"==typeof e?r?(o&&t._setAsyncGuaranteed(),this._settlePromiseFromHandler(e,i,n,t)):e.call(i,n,t):i instanceof a?i._isResolved()||(0!=(33554432&s)?i._promiseFulfilled(n,t):i._promiseRejected(n,t)):r&&(o&&t._setAsyncGuaranteed(),0!=(33554432&s)?t._fulfill(n):t._reject(n))},u.prototype._settlePromiseLateCancellationObserver=function(t){var e=t.handler,i=t.promise,n=t.receiver,t=t.value;"function"==typeof e?i instanceof u?this._settlePromiseFromHandler(e,n,t,i):e.call(n,t,i):i instanceof u&&i._reject(t)},u.prototype._settlePromiseCtx=function(t){this._settlePromise(t.promise,t.handler,t.receiver,t.value)},u.prototype._settlePromise0=function(t,e,i){var n=this._promise0,r=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(n,t,r,e)},u.prototype._clearCallbackDataAtIndex=function(t){t=4*t-4;this[2+t]=this[3+t]=this[t]=this[1+t]=void 0},u.prototype._fulfill=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(t===this){var i=o();return this._attachExtraTrace(i),this._reject(i)}this._setFulfilled(),this._rejectionHandler0=t,0<(65535&e)&&(0!=(134217728&e)?this._settlePromises():d.settlePromises(this))}},u.prototype._reject=function(t){var e=this._bitField;if(!((117506048&e)>>>16))return this._setRejected(),this._fulfillmentHandler0=t,this._isFinal()?d.fatalError(t,h.isNode):void(0<(65535&e)?d.settlePromises(this):this._ensurePossibleRejectionHandled())},u.prototype._fulfillPromises=function(t,e){for(var i=1;i<t;i++){var n=this._fulfillmentHandlerAt(i),r=this._promiseAt(i),s=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(r,n,s,e)}},u.prototype._rejectPromises=function(t,e){for(var i=1;i<t;i++){var n=this._rejectionHandlerAt(i),r=this._promiseAt(i),s=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(r,n,s,e)}},u.prototype._settlePromises=function(){var t,e=this._bitField,i=65535&e;0<i&&(0!=(16842752&e)?(t=this._fulfillmentHandler0,this._settlePromise0(this._rejectionHandler0,t,e),this._rejectPromises(i,t)):(t=this._rejectionHandler0,this._settlePromise0(this._fulfillmentHandler0,t,e),this._fulfillPromises(i,t)),this._setLength(0)),this._clearCancellationData()},u.prototype._settledValue=function(){var t=this._bitField;return 0!=(33554432&t)?this._rejectionHandler0:0!=(16777216&t)?this._fulfillmentHandler0:void 0},u.defer=u.pending=function(){return z.deprecated("Promise.defer","new Promise"),{promise:new u(m),resolve:t,reject:e}},h.notEnumerableProp(u,"_makeSelfResolutionError",o),M("./method")(u,m,g,p,z),M("./bind")(u,m,g,z),M("./cancel")(u,b,p,z),M("./direct_resolve")(u),M("./synchronous_inspection")(u),M("./join")(u,b,g,m,z),u.Promise=u,M("./map.js")(u,b,p,g,m,z),M("./using.js")(u,p,g,_,m,z),M("./timers.js")(u,m,z),M("./generators.js")(u,p,m,g,a,z),M("./nodeify.js")(u),M("./call_get.js")(u),M("./props.js")(u,b,g,p),M("./race.js")(u,m,g,p),M("./reduce.js")(u,b,p,g,m,z),M("./settle.js")(u,b,z),M("./some.js")(u,b,p),M("./promisify.js")(u,m),M("./any.js")(u),M("./each.js")(u,m),M("./filter.js")(u,m),h.toFastProperties(u),h.toFastProperties(u.prototype),i({a:1}),i({b:2}),i({c:3}),i(1),i(function(){}),i(void 0),i(!1),i(new u(m)),z.setBounds(r.firstLineError,h.lastLineError),u}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(n,t,e){"use strict";t.exports=function(a,i,l,s,t){function e(t){var e=this._promise=new a(i);t instanceof a&&e._propagateFrom(t,3),e._setOnCancel(this),this._values=t,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var o=n("./util");return o.isArray,o.inherits(e,t),e.prototype.length=function(){return this._length},e.prototype.promise=function(){return this._promise},e.prototype._init=function t(e,i){var n=l(this._values,this._promise);if(n instanceof a){var r=(n=n._target())._bitField;if(this._values=n,0==(50397184&r))return this._promise._setAsyncGuaranteed(),n._then(t,this._reject,void 0,this,i);if(0==(33554432&r))return 0!=(16777216&r)?this._reject(n._reason()):this._cancel();n=n._value()}if(null!==(n=o.asArray(n)))return 0===n.length?void(-5===i?this._resolveEmptyArray():this._resolve(function(t){switch(t){case-2:return[];case-3:return{}}}(i))):void this._iterate(n);n=s("expecting an array or an iterable object but got "+o.classString(n)).reason();this._promise._rejectCallback(n,!1)},e.prototype._iterate=function(t){var e=this.getActualLength(t.length);this._length=e,this._values=this.shouldCopyValues()?new Array(e):this._values;for(var i=this._promise,n=!1,r=null,s=0;s<e;++s){var o=l(t[s],i),r=o instanceof a?(o=o._target())._bitField:null;n?null!==r&&o.suppressUnhandledRejections():null!==r?0==(50397184&r)?(o._proxy(this,s),this._values[s]=o):n=0!=(33554432&r)?this._promiseFulfilled(o._value(),s):0!=(16777216&r)?this._promiseRejected(o._reason(),s):this._promiseCancelled(s):n=this._promiseFulfilled(o,s)}n||i._setAsyncGuaranteed()},e.prototype._isResolved=function(){return null===this._values},e.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},e.prototype._cancel=function(){!this._isResolved()&&this._promise.isCancellable()&&(this._values=null,this._promise._cancel())},e.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1)},e.prototype._promiseFulfilled=function(t,e){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},e.prototype._promiseCancelled=function(){return this._cancel(),!0},e.prototype._promiseRejected=function(t){return this._totalResolved++,this._reject(t),!0},e.prototype._resultCancelled=function(){if(!this._isResolved()){var t=this._values;if(this._cancel(),t instanceof a)t.cancel();else for(var e=0;e<t.length;++e)t[e]instanceof a&&t[e].cancel()}},e.prototype.shouldCopyValues=function(){return!0},e.prototype.getActualLength=function(t){return t},e}},{"./util":36}],24:[function(i,t,e){"use strict";t.exports=function(p,h){function r(t){return!e.test(t)}function d(t){try{return!0===t.__isPromisified__}catch(t){return!1}}function _(t,e,i,n){for(var r,s,o,a=f.inheritedDataKeys(t),l=[],p=0;p<a.length;++p){var h=a[p],u=t[h],c=n===b||b(h,u,t);"function"!=typeof u||d(u)||(r=t,s=h,o=e,(o=f.getDataPropertyOrDefault(r,s+o,g))&&d(o))||!n(h,u,t,c)||l.push(h,u)}return function(t,e,i){for(var n=0;n<t.length;n+=2){var r=t[n];if(i.test(r))for(var s=r.replace(i,""),o=0;o<t.length;o+=2)if(t[o]===s)throw new v("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",e))}}(l,e,i),l}function u(t,e,i,n,r){for(var s=new RegExp(z(e)+"$"),o=_(t,e,s,i),a=0,l=o.length;a<l;a+=2){var p,h=o[a],u=o[a+1],c=h+e;n===w?t[c]=w(h,y,h,u,e,r):(p=n(u,function(){return w(h,y,h,u,e,r)}),f.notEnumerableProp(p,"__isPromisified__",!0),t[c]=p)}return f.toFastProperties(t),t}var y={},f=i("./util"),c=i("./nodeback"),m=f.withAppended,x=f.maybeWrapAsError,t=f.canEvaluate,v=i("./errors").TypeError,g={__isPromisified__:!0},e=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),b=function(t){return f.isIdentifier(t)&&"_"!==t.charAt(0)&&"constructor"!==t},z=function(t){return t.replace(/([$])/,"\\$")},w=t?void 0:function(r,s,t,e,i,o){function n(){var t=s;s===y&&(t=this);var e=new p(h);e._captureStackTrace();var i="string"==typeof l&&this!==a?this[l]:r,n=c(e,o);try{i.apply(t,m(arguments,n))}catch(t){e._rejectCallback(x(t),!0,!0)}return e._isFateSealed()||e._setAsyncGuaranteed(),e}var a=function(){return this}(),l=r;return"string"==typeof l&&(r=e),f.notEnumerableProp(n,"__isPromisified__",!0),n};p.promisify=function(t,e){if("function"!=typeof t)throw new v("expecting a function but got "+f.classString(t));if(d(t))return t;var i=void 0===(e=Object(e)).context?y:e.context,n=!!e.multiArgs,n=w(e=t,i,void 0,e,null,n);return f.copyDescriptors(t,n,r),n},p.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!=typeof t)throw new v("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var i=!!(e=Object(e)).multiArgs,n=e.suffix;"string"!=typeof n&&(n="Async");var r=e.filter;"function"!=typeof r&&(r=b);var s=e.promisifier;if("function"!=typeof s&&(s=w),!f.isIdentifier(n))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var o=f.inheritedDataKeys(t),a=0;a<o.length;++a){var l=t[o[a]];"constructor"!==o[a]&&f.isClass(l)&&(u(l.prototype,n,r,s,i),u(l,n,r,s,i))}return u(t,n,r,s,i)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(_,t,e){"use strict";t.exports=function(i,t,n,r){function s(t){var e=!1;if(void 0!==a&&t instanceof a)r=c(t),e=!0;else for(var i=p.keys(t),n=i.length,r=new Array(2*n),s=0;s<n;++s){var o=i[s];r[s]=t[o],r[s+n]=o}this.constructor$(r),this._isMap=e,this._init$(void 0,-3)}function e(t){var e=n(t);return l(e)?(t=e instanceof i?e._then(i.props,void 0,void 0,void 0,void 0):new s(e).promise(),e instanceof i&&t._propagateFrom(e,2),t):r("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var a,o=_("./util"),l=o.isObject,p=_("./es5");"function"==typeof Map&&(a=Map);var h,u,c=(u=0,function(t){h=t.size,u=0;var e=new Array(2*t.size);return t.forEach(d,e),e});function d(t,e){this[u]=t,this[u+h]=e,u++}o.inherits(s,t),s.prototype._init=function(){},s.prototype._promiseFulfilled=function(t,e){var i;if(this._values[e]=t,++this._totalResolved>=this._length){if(this._isMap)i=function(t){for(var e=new a,i=t.length/2|0,n=0;n<i;++n){var r=t[i+n],s=t[n];e.set(r,s)}return e}(this._values);else{i={};for(var n=this.length(),r=0,s=this.length();r<s;++r)i[this._values[r+n]]=this._values[r]}return this._resolve(i),!0}return!1},s.prototype.shouldCopyValues=function(){return!1},s.prototype.getActualLength=function(t){return t>>1},i.prototype.props=function(){return e(this)},i.props=e}},{"./es5":13,"./util":36}],26:[function(t,e,i){"use strict";function n(t){this._capacity=t,this._length=0,this._front=0}n.prototype._willBeOverCapacity=function(t){return this._capacity<t},n.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1),this[this._front+e&this._capacity-1]=t,this._length=e+1},n.prototype._unshiftOne=function(t){var e=this._capacity;this._checkCapacity(this.length()+1);e=(this._front-1&e-1^e)-e;this[e]=t,this._front=e,this._length=this.length()+1},n.prototype.unshift=function(t,e,i){this._unshiftOne(i),this._unshiftOne(e),this._unshiftOne(t)},n.prototype.push=function(t,e,i){var n=this.length()+3;if(this._willBeOverCapacity(n))return this._pushOne(t),this._pushOne(e),void this._pushOne(i);var r=this._front+n-3;this._checkCapacity(n);var s=this._capacity-1;this[r&s]=t,this[1+r&s]=e,this[2+r&s]=i,this._length=n},n.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},n.prototype.length=function(){return this._length},n.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},n.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t,function(t,e,i,n,r){for(var s=0;s<r;++s)i[s+n]=t[s+e],t[s+e]=void 0}(this,0,this,e,this._front+this._length&e-1)},e.exports=n},{}],27:[function(t,e,i){"use strict";e.exports=function(p,h,u,c){function i(t,e){var i=u(t);if(i instanceof p)return _(i);if(null===(t=d.asArray(t)))return c("expecting an array or an iterable object but got "+d.classString(t));var n=new p(h);void 0!==e&&n._propagateFrom(e,3);for(var r=n._fulfill,s=n._reject,o=0,a=t.length;o<a;++o){var l=t[o];(void 0!==l||o in t)&&p.cast(l)._then(r,s,void 0,n,null)}return n}var d=t("./util"),_=function(e){return e.then(function(t){return i(t,e)})};p.race=function(t){return i(t,void 0)},p.prototype.race=function(){return i(this,void 0)}}},{"./util":36}],28:[function(_,t,e){"use strict";t.exports=function(s,t,r,e,o,a){function l(t,e,i,n){this.constructor$(t);t=u();this._fn=null===t?e:t.bind(e),void 0!==i&&(i=s.resolve(i))._attachCancellationCallback(this),this._initialValue=i,this._currentCancellable=null,this._eachValues=n===o?[]:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function p(t,e){this.isFulfilled()?e._resolve(t):e._reject(t)}function i(t,e,i,n){return"function"!=typeof e?r("expecting a function but got "+c.classString(e)):new l(t,e,i,n).promise()}function h(t){this.accum=t,this.array._gotAccum(t);t=e(this.value,this.array._promise);return t instanceof s?(this.array._currentCancellable=t)._then(n,void 0,void 0,this,void 0):n.call(this,t)}function n(t){var e=this.array,i=e._promise,n=d(e._fn);i._pushContext(),(n=void 0!==e._eachValues?n.call(i._boundValue(),t,this.index,this.length):n.call(i._boundValue(),this.accum,t,this.index,this.length))instanceof s&&(e._currentCancellable=n);t=i._popContext();return a.checkForgottenReturns(n,t,void 0!==e._eachValues?"Promise.each":"Promise.reduce",i),n}var u=s._getDomain,c=_("./util"),d=c.tryCatch;c.inherits(l,t),l.prototype._gotAccum=function(t){void 0!==this._eachValues&&t!==o&&this._eachValues.push(t)},l.prototype._eachComplete=function(t){return this._eachValues.push(t),this._eachValues},l.prototype._init=function(){},l.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},l.prototype.shouldCopyValues=function(){return!1},l.prototype._resolve=function(t){this._promise._resolveCallback(t),this._values=null},l.prototype._resultCancelled=function(t){return t===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof s&&this._currentCancellable.cancel(),this._initialValue instanceof s&&this._initialValue.cancel()))},l.prototype._iterate=function(t){var e=(this._values=t).length,i=void 0!==this._initialValue?(r=this._initialValue,0):(r=s.resolve(t[0]),1);if(!(this._currentCancellable=r).isRejected())for(;i<e;++i)var n={accum:null,value:t[i],index:i,length:e,array:this},r=r._then(h,void 0,void 0,n,void 0);void 0!==this._eachValues&&(r=r._then(this._eachComplete,void 0,void 0,this,void 0)),r._then(p,p,void 0,r,this)},s.prototype.reduce=function(t,e){return i(this,t,e,null)},s.reduce=i}},{"./util":36}],29:[function(t,e,i){"use strict";var n,r,t=t("./util");t=t.isNode&&"undefined"==typeof MutationObserver?(n=global.setImmediate,r=process.nextTick,t.isRecentNode?function(t){n.call(global,t)}:function(t){r.call(process,t)}):"undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&window.navigator.standalone?"undefined"!=typeof setImmediate?function(t){setImmediate(t)}:"undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}:function(){var i=document.createElement("div"),n={attributes:!0},r=!1,s=document.createElement("div");new MutationObserver(function(){i.classList.toggle("foo"),r=!1}).observe(s,n);return function(t){var e=new MutationObserver(function(){e.disconnect(),t()});e.observe(i,n),r||(r=!0,s.classList.toggle("foo"))}}(),e.exports=t},{"./util":36}],30:[function(s,t,e){"use strict";t.exports=function(t,e,i){function n(t){this.constructor$(t)}var r=t.PromiseInspection;s("./util").inherits(n,e),n.prototype._promiseResolved=function(t,e){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},n.prototype._promiseFulfilled=function(t,e){var i=new r;return i._bitField=33554432,i._settledValueField=t,this._promiseResolved(e,i)},n.prototype._promiseRejected=function(t,e){var i=new r;return i._bitField=16777216,i._settledValueField=t,this._promiseResolved(e,i)},t.settle=function(t){return i.deprecated(".settle()",".reflect()"),new n(t).promise()},t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(h,t,e){"use strict";t.exports=function(t,e,n){function r(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function i(t,e){if((0|e)!==e||e<0)return n("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var i=new r(t),t=i.promise();return i.setHowMany(e),i.init(),t}var s=h("./util"),o=h("./errors").RangeError,a=h("./errors").AggregateError,l=s.isArray,p={};s.inherits(r,e),r.prototype._init=function(){var t;this._initialized&&(0!==this._howMany?(this._init$(void 0,-5),t=l(this._values),!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))):this._resolve([]))},r.prototype.init=function(){this._initialized=!0,this._init()},r.prototype.setUnwrap=function(){this._unwrap=!0},r.prototype.howMany=function(){return this._howMany},r.prototype.setHowMany=function(t){this._howMany=t},r.prototype._promiseFulfilled=function(t){return this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},r.prototype._promiseRejected=function(t){return this._addRejected(t),this._checkOutcome()},r.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(p),this._checkOutcome())},r.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new a,e=this.length();e<this._values.length;++e)this._values[e]!==p&&t.push(this._values[e]);return 0<t.length?this._reject(t):this._cancel(),!0}return!1},r.prototype._fulfilled=function(){return this._totalResolved},r.prototype._rejected=function(){return this._values.length-this.length()},r.prototype._addRejected=function(t){this._values.push(t)},r.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},r.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},r.prototype._getRangeError=function(t){t="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new o(t)},r.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=i,t.prototype.some=function(t){return i(this,t)},t._SomePromiseArray=r}},{"./errors":12,"./util":36}],32:[function(t,e,i){"use strict";e.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,this._settledValueField=t._isFateSealed()?t._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}e.prototype._settledValue=function(){return this._settledValueField};var i=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},n=e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=e.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},s=e.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},o=e.prototype.isPending=function(){return 0==(50397184&this._bitField)},a=e.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};e.prototype.isCancelled=t.prototype._isCancelled=function(){return 65536==(65536&this._bitField)},t.prototype.isCancelled=function(){return this._target()._isCancelled()},t.prototype.isPending=function(){return o.call(this._target())},t.prototype.isRejected=function(){return s.call(this._target())},t.prototype.isFulfilled=function(){return r.call(this._target())},t.prototype.isResolved=function(){return a.call(this._target())},t.prototype.value=function(){return i.call(this._target())},t.prototype.reason=function(){var t=this._target();return t._unsetRejectionIsUnhandled(),n.call(t)},t.prototype._value=function(){return this._settledValue()},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},t.PromiseInspection=e}},{}],33:[function(t,e,i){"use strict";e.exports=function(o,a){var l=t("./util"),p=l.errorObj,s=l.isObject,h={}.hasOwnProperty;return function(t,e){if(s(t)){if(t instanceof o)return t;var i=function(t){try{return t.then}catch(t){return p.e=t,p}}(t);if(i===p){e&&e._pushContext();var n=o.reject(i.e);return e&&e._popContext(),n}if("function"==typeof i){if(r=t,h.call(r,"_promise0")){n=new o(a);return t._then(n._fulfill,n._reject,void 0,n,null),n}return function(t,e,i){var n=new o(a),r=n;i&&i._pushContext(),n._captureStackTrace(),i&&i._popContext();var s=!0,t=l.tryCatch(e).call(t,function(t){n&&(n._resolveCallback(t),n=null)},function(t){n&&(n._rejectCallback(t,s,!0),n=null)});return s=!1,n&&t===p&&(n._rejectCallback(t.e,!0,!0),n=null),r}(t,i,e)}}var r;return t}}},{"./util":36}],34:[function(t,e,i){"use strict";e.exports=function(n,r,o){function a(t){this.handle=t}function e(t){return clearTimeout(this.handle),t}function i(t){throw clearTimeout(this.handle),t}var l=t("./util"),p=n.TimeoutError;a.prototype._resultCancelled=function(){clearTimeout(this.handle)};function s(t){return h(+this).thenReturn(t)}var h=n.delay=function(t,e){var i;return void 0!==e?(i=n.resolve(e)._then(s,null,null,t,void 0),o.cancellation()&&e instanceof n&&i._setOnCancel(e)):(i=new n(r),t=setTimeout(function(){i._fulfill()},+t),o.cancellation()&&i._setOnCancel(new a(t))),i._setAsyncGuaranteed(),i};n.prototype.delay=function(t){return h(t,this)};n.prototype.timeout=function(t,n){t=+t;var r,s,t=new a(setTimeout(function(){var t,e,i;r.isPending()&&(t=r,i=s,e="string"!=typeof(e=n)?e instanceof Error?e:new p("operation timed out"):new p(e),l.markAsOriginatingFromRejection(e),t._attachExtraTrace(e),t._reject(e),null!=i&&i.cancel())},t));return o.cancellation()?(s=this.then(),(r=s._then(e,i,void 0,t,void 0))._setOnCancel(t)):r=this._then(e,i,void 0,t,void 0),r}}},{"./util":36}],35:[function(s,t,e){"use strict";t.exports=function(u,c,d,e,t,_){function p(t){setTimeout(function(){throw t},0)}function y(r,s){var o=0,a=r.length,l=new u(t);return function t(){if(a<=o)return l._fulfill();var e,i,n=(e=r[o++],(i=d(e))!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&i._setDisposable(e._getDisposer()),i);if(n instanceof u&&n._isDisposable()){try{n=d(n._getDisposer().tryDispose(s),r.promise)}catch(t){return p(t)}if(n instanceof u)return n._then(t,p,null,null,null)}t()}(),l}function f(t,e,i){this._data=t,this._promise=e,this._context=i}function i(t,e,i){this.constructor$(t,e,i)}function m(t){return f.isDisposer(t)?(this.resources[this.index]._setDisposable(t),t.promise()):t}function x(t){this.length=t,this.promise=null,this[t-1]=null}var v=s("./util"),n=s("./errors").TypeError,r=s("./util").inherits,g=v.errorObj,b=v.tryCatch;f.prototype.data=function(){return this._data},f.prototype.promise=function(){return this._promise},f.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},f.prototype.tryDispose=function(t){var e=this.resource(),i=this._context;void 0!==i&&i._pushContext();t=null!==e?this.doDispose(e,t):null;return void 0!==i&&i._popContext(),this._promise._unsetDisposable(),this._data=null,t},f.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},r(i,f),i.prototype.doDispose=function(t,e){return this.data().call(t,t,e)},x.prototype._resultCancelled=function(){for(var t=this.length,e=0;e<t;++e){var i=this[e];i instanceof u&&i.cancel()}},u.using=function(){var t=arguments.length;if(t<2)return c("you must pass at least 2 arguments to Promise.using");var s=arguments[t-1];if("function"!=typeof s)return c("expecting a function but got "+v.classString(s));var e,o=!0;2===t&&Array.isArray(arguments[0])?(t=(e=arguments[0]).length,o=!1):(e=arguments,t--);for(var i=new x(t),n=0;n<t;++n){var r,a=e[n];f.isDisposer(a)?(a=(r=a).promise())._setDisposable(r):(r=d(a))instanceof u&&(a=r._then(m,null,null,{resources:i,index:n},void 0)),i[n]=a}for(var l=new Array(i.length),n=0;n<l.length;++n)l[n]=u.resolve(i[n]).reflect();var p=u.all(l).then(function(t){for(var e=0;e<t.length;++e){var i=t[e];if(i.isRejected())return g.e=i.error(),g;if(!i.isFulfilled())return void p.cancel();t[e]=i.value()}h._pushContext(),s=b(s);var n=o?s.apply(void 0,t):s(t),r=h._popContext();return _.checkForgottenReturns(n,r,"Promise.using",h),n}),h=p.lastly(function(){var t=new u.PromiseInspection(p);return y(i,t)});return(i.promise=h)._setOnCancel(i),h},u.prototype._setDisposable=function(t){this._bitField=131072|this._bitField,this._disposer=t},u.prototype._isDisposable=function(){return 0<(131072&this._bitField)},u.prototype._getDisposer=function(){return this._disposer},u.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},u.prototype.disposer=function(t){if("function"==typeof t)return new i(t,this,e());throw new n}}},{"./errors":12,"./util":36}],36:[function(t,e,i){"use strict";function n(){try{var t=h;return h=null,t.apply(this,arguments)}catch(t){return _.e=t,_}}function r(t){return null==t||!0===t||!1===t||"string"==typeof t||"number"==typeof t}function s(t,e,i){if(r(t))return t;i={value:i,configurable:!0,enumerable:!1,writable:!0};return c.defineProperty(t,e,i),t}function o(t){try{return t+""}catch(t){return"[no string representation]"}}function a(t){return null!==t&&"object"==typeof t&&"string"==typeof t.message&&"string"==typeof t.name}function l(t){return a(t)&&c.propertyIsWritable(t,"stack")}function p(t){return{}.toString.call(t)}var h,u,c=t("./es5"),d="undefined"==typeof navigator,_={e:{}},y="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0!==this?this:null,f=function(){function a(t){for(var e=0;e<r.length;++e)if(r[e]===t)return 1}var r=[Array.prototype,Object.prototype,Function.prototype];if(c.isES5){var l=Object.getOwnPropertyNames;return function(t){for(var e,i=[],n=Object.create(null);null!=t&&!a(t);){try{e=l(t)}catch(t){return i}for(var r=0;r<e.length;++r){var s,o=e[r];n[o]||(n[o]=!0,null!=(s=Object.getOwnPropertyDescriptor(t,o))&&null==s.get&&null==s.set&&i.push(o))}t=c.getPrototypeOf(t)}return i}}var s={}.hasOwnProperty;return function(t){if(a(t))return[];var e=[];t:for(var i in t)if(s.call(t,i))e.push(i);else{for(var n=0;n<r.length;++n)if(s.call(r[n],i))continue t;e.push(i)}return e}}(),m=/this\s*\.\s*\S+\s*=/,x=/^[a-z$_][a-z$_0-9]*$/i,v="stack"in new Error?function(t){return l(t)?t:new Error(o(t))}:function(t){if(l(t))return t;try{throw new Error(o(t))}catch(t){return t}},t=function(t){return c.isArray(t)?t:null};"undefined"!=typeof Symbol&&Symbol.iterator&&(u="function"==typeof Array.from?function(t){return Array.from(t)}:function(t){for(var e,i=[],n=t[Symbol.iterator]();!(e=n.next()).done;)i.push(e.value);return i},t=function(t){return c.isArray(t)?t:null!=t&&"function"==typeof t[Symbol.iterator]?u(t):null});var g="undefined"!=typeof process&&"[object process]"===p(process).toLowerCase(),v={isClass:function(t){try{if("function"==typeof t){var e=c.names(t.prototype),i=c.isES5&&1<e.length,n=0<e.length&&!(1===e.length&&"constructor"===e[0]),e=m.test(t+"")&&0<c.names(t).length;if(i||n||e)return!0}return!1}catch(t){return!1}},isIdentifier:function(t){return x.test(t)},inheritedDataKeys:f,getDataPropertyOrDefault:function(t,e,i){return c.isES5?null!=(e=Object.getOwnPropertyDescriptor(t,e))?null==e.get&&null==e.set?e.value:i:void 0:{}.hasOwnProperty.call(t,e)?t[e]:void 0},thrower:function(t){throw t},isArray:c.isArray,asArray:t,notEnumerableProp:s,isPrimitive:r,isObject:function(t){return"function"==typeof t||"object"==typeof t&&null!==t},isError:a,canEvaluate:d,errorObj:_,tryCatch:function(t){return h=t,n},inherits:function(e,i){function t(){for(var t in this.constructor=e,(this.constructor$=i).prototype)n.call(i.prototype,t)&&"$"!==t.charAt(t.length-1)&&(this[t+"$"]=i.prototype[t])}var n={}.hasOwnProperty;return t.prototype=i.prototype,e.prototype=new t,e.prototype},withAppended:function(t,e){for(var i=t.length,n=new Array(i+1),r=0;r<i;++r)n[r]=t[r];return n[r]=e,n},maybeWrapAsError:function(t){return r(t)?new Error(o(t)):t},toFastProperties:function(t){for(var e=8;e--;);return t},filledRange:function(t,e,i){for(var n=new Array(t),r=0;r<t;++r)n[r]=e+r+i;return n},toString:o,canAttachTrace:l,ensureErrorObject:v,originatesFromRejection:function(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===t.isOperational)},markAsOriginatingFromRejection:function(t){try{s(t,"isOperational",!0)}catch(t){}},classString:p,copyDescriptors:function(t,e,i){for(var n=c.names(t),r=0;r<n.length;++r){var s=n[r];if(i(s))try{c.defineProperty(e,s,c.getDescriptor(t,s))}catch(t){}}},hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:g,env:function(t,e){return g?process.env[t]:e},global:y};v.isRecentNode=v.isNode&&(0===(y=process.versions.node.split(".").map(Number))[0]&&10<y[1]||0<y[0]),v.isNode&&v.toFastProperties(process);try{throw new Error}catch(t){v.lastLineError=t}e.exports=v},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise),function(t){var e;"object"==typeof exports?module.exports=t():("undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.p2=t())}(function(){return function n(r,s,o){function a(i,t){if(!s[i]){if(!r[i]){var e="function"==typeof require&&require;if(!t&&e)return e(i,!0);if(l)return l(i,!0);throw new Error("Cannot find module '"+i+"'")}e=s[i]={exports:{}};r[i][0].call(e.exports,function(t){var e=r[i][1][t];return a(e||t)},e,e.exports,n,r,s,o)}return s[i].exports}for(var l="function"==typeof require&&require,t=0;t<o.length;t++)a(o[t]);return a}({1:[function(t,e,i){function n(){}var p=t("./Scalar");(e.exports=n).lineInt=function(t,e,i){i=i||0;var n=[0,0],r=t[1][1]-t[0][1],s=t[0][0]-t[1][0],o=r*t[0][0]+s*t[0][1],a=e[1][1]-e[0][1],l=e[0][0]-e[1][0],t=a*e[0][0]+l*e[0][1],e=r*l-a*s;return p.eq(e,0,i)||(n[0]=(l*o-s*t)/e,n[1]=(r*t-a*o)/e),n},n.segmentsIntersect=function(t,e,i,n){var r=e[0]-t[0],s=e[1]-t[1],o=n[0]-i[0],e=n[1]-i[1];if(o*s-e*r==0)return!1;n=(r*(i[1]-t[1])+s*(t[0]-i[0]))/(o*s-e*r),s=(o*(t[1]-i[1])+e*(i[0]-t[0]))/(e*r-o*s);return 0<=n&&n<=1&&0<=s&&s<=1}},{"./Scalar":4}],2:[function(t,e,i){function a(){}(e.exports=a).area=function(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])},a.left=function(t,e,i){return 0<a.area(t,e,i)},a.leftOn=function(t,e,i){return 0<=a.area(t,e,i)},a.right=function(t,e,i){return a.area(t,e,i)<0},a.rightOn=function(t,e,i){return a.area(t,e,i)<=0};var l=[],p=[];a.collinear=function(t,e,i,n){if(n){var r=l,s=p;r[0]=e[0]-t[0],r[1]=e[1]-t[1],s[0]=i[0]-e[0],s[1]=i[1]-e[1];var o=r[0]*s[0]+r[1]*s[1],r=Math.sqrt(r[0]*r[0]+r[1]*r[1]),s=Math.sqrt(s[0]*s[0]+s[1]*s[1]);return Math.acos(o/(r*s))<n}return 0==a.area(t,e,i)},a.sqdist=function(t,e){var i=e[0]-t[0],t=e[1]-t[1];return i*i+t*t}},{}],3:[function(t,e,i){function z(){this.vertices=[]}function w(t,e,i,n,r){r=r||0;var s=e[1]-t[1],o=t[0]-e[0],a=s*t[0]+o*t[1],e=n[1]-i[1],t=i[0]-n[0],n=e*i[0]+t*i[1],i=s*t-e*o;return l.eq(i,0,r)?[0,0]:[(t*a-o*n)/i,(s*n-e*a)/i]}var a=t("./Line"),C=t("./Point"),l=t("./Scalar");(e.exports=z).prototype.at=function(t){var e=this.vertices,i=e.length;return e[t<0?t%i+i:t%i]},z.prototype.first=function(){return this.vertices[0]},z.prototype.last=function(){return this.vertices[this.vertices.length-1]},z.prototype.clear=function(){this.vertices.length=0},z.prototype.append=function(t,e,i){if(void 0===e)throw new Error("From is not given!");if(void 0===i)throw new Error("To is not given!");if(i-1<e)throw new Error("lol1");if(i>t.vertices.length)throw new Error("lol2");if(e<0)throw new Error("lol3");for(var n=e;n<i;n++)this.vertices.push(t.vertices[n])},z.prototype.makeCCW=function(){for(var t=0,e=this.vertices,i=1;i<this.vertices.length;++i)(e[i][1]<e[t][1]||e[i][1]==e[t][1]&&e[i][0]>e[t][0])&&(t=i);C.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},z.prototype.reverse=function(){for(var t=[],e=0,i=this.vertices.length;e!==i;e++)t.push(this.vertices.pop());this.vertices=t},z.prototype.isReflex=function(t){return C.right(this.at(t-1),this.at(t),this.at(t+1))};var p=[],h=[];z.prototype.canSee=function(t,e){var i,n,r=p,s=h;if(C.leftOn(this.at(t+1),this.at(t),this.at(e))&&C.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;n=C.sqdist(this.at(t),this.at(e));for(var o=0;o!==this.vertices.length;++o)if((o+1)%this.vertices.length!==t&&o!==t&&C.leftOn(this.at(t),this.at(e),this.at(o+1))&&C.rightOn(this.at(t),this.at(e),this.at(o))&&(r[0]=this.at(t),r[1]=this.at(e),s[0]=this.at(o),s[1]=this.at(o+1),i=a.lineInt(r,s),C.sqdist(this.at(t),i)<n))return!1;return!0},z.prototype.copy=function(t,e,i){var n=i||new z;if(n.clear(),t<e)for(var r=t;r<=e;r++)n.vertices.push(this.vertices[r]);else{for(r=0;r<=e;r++)n.vertices.push(this.vertices[r]);for(r=t;r<this.vertices.length;r++)n.vertices.push(this.vertices[r])}return n},z.prototype.getCutEdges=function(){for(var t,e=[],i=[],n=new z,r=Number.MAX_VALUE,s=0;s<this.vertices.length;++s)if(this.isReflex(s))for(var o=0;o<this.vertices.length;++o)if(this.canSee(s,o)){i=this.copy(s,o,n).getCutEdges(),t=this.copy(o,s,n).getCutEdges();for(var a=0;a<t.length;a++)i.push(t[a]);i.length<r&&(r=(e=i).length,e.push([this.at(s),this.at(o)]))}return e},z.prototype.decomp=function(){var t=this.getCutEdges();return 0<t.length?this.slice(t):[this]},z.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],i=0;i<t.length;i++)for(var n=t[i],r=0;r<e.length;r++){var s=e[r].slice(n);if(s){e.splice(r,1),e.push(s[0],s[1]);break}}return e}n=t,i=this.vertices.indexOf(n[0]),r=this.vertices.indexOf(n[1]);return-1!=i&&-1!=r&&[this.copy(i,r),this.copy(r,i)]},z.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var i=0;i<e-1;i++)if(a.segmentsIntersect(t[e],t[e+1],t[i],t[i+1]))return!1;for(e=1;e<t.length-2;e++)if(a.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},z.prototype.quickDecomp=function(t,e,i,n,r,s){r=r||100,s=s||0,n=n||25,t=void 0!==t?t:[],e=e||[],i=i||[];var o=[0,0],a=[0,0],l=[0,0],p=0,h=0,u=0,c=0,d=0,_=0,y=0,f=new z,m=new z,x=this,v=this.vertices;if(v.length<3)return t;if(r<++s)return console.warn("quickDecomp: max level ("+r+") reached."),t;for(var g=0;g<this.vertices.length;++g)if(x.isReflex(g)){e.push(x.vertices[g]),p=h=Number.MAX_VALUE;for(var b=0;b<this.vertices.length;++b)C.left(x.at(g-1),x.at(g),x.at(b))&&C.rightOn(x.at(g-1),x.at(g),x.at(b-1))&&(l=w(x.at(g-1),x.at(g),x.at(b),x.at(b-1)),C.right(x.at(g+1),x.at(g),l)&&((u=C.sqdist(x.vertices[g],l))<h&&(h=u,a=l,_=b))),C.left(x.at(g+1),x.at(g),x.at(b+1))&&C.rightOn(x.at(g+1),x.at(g),x.at(b))&&(l=w(x.at(g+1),x.at(g),x.at(b),x.at(b+1)),C.left(x.at(g-1),x.at(g),l)&&((u=C.sqdist(x.vertices[g],l))<p&&(p=u,o=l,d=b)));if(_==(d+1)%this.vertices.length)l[0]=(a[0]+o[0])/2,l[1]=(a[1]+o[1])/2,i.push(l),g<d?(f.append(x,g,d+1),f.vertices.push(l),m.vertices.push(l),0!=_&&m.append(x,_,x.vertices.length),m.append(x,0,g+1)):(0!=g&&f.append(x,g,x.vertices.length),f.append(x,0,d+1),f.vertices.push(l),m.vertices.push(l),m.append(x,_,g+1));else{if(d<_&&(d+=this.vertices.length),c=Number.MAX_VALUE,d<_)return t;for(b=_;b<=d;++b)C.leftOn(x.at(g-1),x.at(g),x.at(b))&&C.rightOn(x.at(g+1),x.at(g),x.at(b))&&((u=C.sqdist(x.at(g),x.at(b)))<c&&(c=u,y=b%this.vertices.length));g<y?(f.append(x,g,y+1),0!=y&&m.append(x,y,v.length),m.append(x,0,g+1)):(0!=g&&f.append(x,g,v.length),f.append(x,0,y+1),m.append(x,y,g+1))}return f.vertices.length<m.vertices.length?(f.quickDecomp(t,e,i,n,r,s),m.quickDecomp(t,e,i,n,r,s)):(m.quickDecomp(t,e,i,n,r,s),f.quickDecomp(t,e,i,n,r,s)),t}return t.push(this),t},z.prototype.removeCollinearPoints=function(t){for(var e=0,i=this.vertices.length-1;3<this.vertices.length&&0<=i;--i)C.collinear(this.at(i-1),this.at(i),this.at(i+1),t)&&(this.vertices.splice(i%this.vertices.length,1),i--,e++);return e}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(t,e,i){function n(){}(e.exports=n).eq=function(t,e,i){return i=i||0,Math.abs(t-e)<i}},{}],5:[function(t,e,i){e.exports={Polygon:t("./Polygon"),Point:t("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(t,e,i){e.exports={name:"p2",version:"0.7.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{}],7:[function(t,e,i){function n(t){this.lowerBound=d.create(),t&&t.lowerBound&&d.copy(this.lowerBound,t.lowerBound),this.upperBound=d.create(),t&&t.upperBound&&d.copy(this.upperBound,t.upperBound)}var d=t("../math/vec2");t("../utils/Utils"),e.exports=n;var _=d.create();n.prototype.setFromPoints=function(t,e,i,n){var r=this.lowerBound,s=this.upperBound;"number"!=typeof i&&(i=0),0!==i?d.rotate(r,t[0],i):d.copy(r,t[0]),d.copy(s,r);for(var o=Math.cos(i),a=Math.sin(i),l=1;l<t.length;l++){var p,h,u=t[l];0!==i&&(p=u[0],h=u[1],_[0]=o*p-a*h,_[1]=a*p+o*h,u=_);for(var c=0;c<2;c++)u[c]>s[c]&&(s[c]=u[c]),u[c]<r[c]&&(r[c]=u[c])}e&&(d.add(this.lowerBound,this.lowerBound,e),d.add(this.upperBound,this.upperBound,e)),n&&(this.lowerBound[0]-=n,this.lowerBound[1]-=n,this.upperBound[0]+=n,this.upperBound[1]+=n)},n.prototype.copy=function(t){d.copy(this.lowerBound,t.lowerBound),d.copy(this.upperBound,t.upperBound)},n.prototype.extend=function(t){for(var e=2;e--;){var i=t.lowerBound[e];this.lowerBound[e]>i&&(this.lowerBound[e]=i);i=t.upperBound[e];this.upperBound[e]<i&&(this.upperBound[e]=i)}},n.prototype.overlaps=function(t){var e=this.lowerBound,i=this.upperBound,n=t.lowerBound,t=t.upperBound;return(n[0]<=i[0]&&i[0]<=t[0]||e[0]<=t[0]&&t[0]<=i[0])&&(n[1]<=i[1]&&i[1]<=t[1]||e[1]<=t[1]&&t[1]<=i[1])},n.prototype.containsPoint=function(t){var e=this.lowerBound,i=this.upperBound;return e[0]<=t[0]&&t[0]<=i[0]&&e[1]<=t[1]&&t[1]<=i[1]},n.prototype.overlapsRay=function(t){var e=1/t.direction[0],i=1/t.direction[1],n=(this.lowerBound[0]-t.from[0])*e,r=(this.upperBound[0]-t.from[0])*e,e=(this.lowerBound[1]-t.from[1])*i,t=(this.upperBound[1]-t.from[1])*i,i=Math.max(Math.max(Math.min(n,r),Math.min(e,t))),t=Math.min(Math.min(Math.max(n,r),Math.max(e,t)));return t<0||t<i?-1:i}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(t,e,i){function n(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=n.AABB}var r=t("../math/vec2"),s=t("../objects/Body");(e.exports=n).AABB=1,n.BOUNDING_CIRCLE=2,n.prototype.setWorld=function(t){this.world=t},n.prototype.getCollisionPairs=function(t){};var o=r.create();n.boundingRadiusCheck=function(t,e){r.sub(o,t.position,e.position);var i=r.squaredLength(o),e=t.boundingRadius+e.boundingRadius;return i<=e*e},n.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())},n.prototype.boundingVolumeCheck=function(t,e){var i;switch(this.boundingVolumeType){case n.BOUNDING_CIRCLE:i=n.boundingRadiusCheck(t,e);break;case n.AABB:i=n.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return i},n.canCollide=function(t,e){var i=s.KINEMATIC,n=s.STATIC;return!(t.type===n&&e.type===n||t.type===i&&e.type===n||t.type===n&&e.type===i||t.type===i&&e.type===i||t.sleepState===s.SLEEPING&&e.sleepState===s.SLEEPING||t.sleepState===s.SLEEPING&&e.type===n||e.sleepState===s.SLEEPING&&t.type===n)},n.NAIVE=1,n.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(t,e,i){function n(){l.call(this,l.NAIVE)}var l=(t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Shape"),t("../shapes/Particle"),t("../collision/Broadphase"));t("../math/vec2"),(((e.exports=n).prototype=new l).constructor=n).prototype.getCollisionPairs=function(t){for(var e=t.bodies,i=this.result,n=i.length=0,r=e.length;n!==r;n++)for(var s=e[n],o=0;o<n;o++){var a=e[o];l.canCollide(s,a)&&this.boundingVolumeCheck(s,a)&&i.push(s,a)}return i},n.prototype.aabbQuery=function(t,e,i){i=i||[];for(var n=t.bodies,r=0;r<n.length;r++){var s=n[r];s.aabbNeedsUpdate&&s.updateAABB(),s.aabb.overlaps(e)&&i.push(s)}return i}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(t,e,i){function N(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new n({size:32}),this.frictionEquationPool=new r({size:64}),this.restitution=0,this.stiffness=o.DEFAULT_STIFFNESS,this.relaxation=o.DEFAULT_RELAXATION,this.frictionStiffness=o.DEFAULT_STIFFNESS,this.frictionRelaxation=o.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new s,this.contactSkinSize=.01}function x(t,e){G.set(t.vertices[0],.5*-e.length,-e.radius),G.set(t.vertices[1],.5*e.length,-e.radius),G.set(t.vertices[2],.5*e.length,e.radius),G.set(t.vertices[3],.5*-e.length,e.radius)}function A(t,e,i,n){for(var r=_,s=y,o=f,a=m,l=t,p=e.vertices,h=null,u=0;u!==p.length+1;u++){var c=p[u%p.length],d=p[(u+1)%p.length];G.rotate(r,c,n),G.rotate(s,d,n),X(r,r,i),X(s,s,i),U(o,r,l),U(a,s,l);d=G.crossLength(o,a);if(null===h&&(h=d),d*h<=0)return;h=d}return 1}var G=t("../math/vec2"),U=G.sub,X=G.add,V=G.dot,n=(t("../utils/Utils"),t("../utils/ContactEquationPool")),r=t("../utils/FrictionEquationPool"),s=t("../utils/TupleDictionary"),o=t("../equations/Equation"),a=(t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("../shapes/Circle")),l=t("../shapes/Convex"),p=t("../shapes/Shape"),w=(t("../objects/Body"),t("../shapes/Box"));e.exports=N;var C=G.fromValues(0,1),W=G.fromValues(0,0),H=G.fromValues(0,0),q=G.fromValues(0,0),Y=G.fromValues(0,0),K=G.fromValues(0,0),O=G.fromValues(0,0),Z=G.fromValues(0,0),J=G.fromValues(0,0),Q=G.fromValues(0,0),k=G.fromValues(0,0),E=G.fromValues(0,0),I=G.fromValues(0,0),D=G.fromValues(0,0),B=G.fromValues(0,0),L=G.fromValues(0,0),R=G.fromValues(0,0),T=G.fromValues(0,0),S=G.fromValues(0,0),F=[],h=G.create(),u=G.create();N.prototype.bodiesOverlap=function(t,e){for(var i=h,n=u,r=0,s=t.shapes.length;r!==s;r++){var o=t.shapes[r];t.toWorldFrame(i,o.position);for(var a=0,l=e.shapes.length;a!==l;a++){var p=e.shapes[a];if(e.toWorldFrame(n,p.position),this[o.type|p.type](t,o,i,o.angle+t.angle,e,p,n,p.angle+e.angle,!0))return!0}}return!1},N.prototype.collidedLastStep=function(t,e){t=0|t.id,e=0|e.id;return!!this.collidingBodiesLastStep.get(t,e)},N.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var i=t[e],n=i.bodyA.id,i=i.bodyB.id;this.collidingBodiesLastStep.set(n,i,!0)}for(var r=this.contactEquations,s=this.frictionEquations,o=0;o<r.length;o++)this.contactEquationPool.release(r[o]);for(o=0;o<s.length;o++)this.frictionEquationPool.release(s[o]);this.contactEquations.length=this.frictionEquations.length=0},N.prototype.createContactEquation=function(t,e,i,n){var r=this.contactEquationPool.get();return r.bodyA=t,r.bodyB=e,r.shapeA=i,r.shapeB=n,r.restitution=this.restitution,r.firstImpact=!this.collidedLastStep(t,e),r.stiffness=this.stiffness,r.relaxation=this.relaxation,r.needsUpdate=!0,r.enabled=this.enabledEquations,r.offset=this.contactSkinSize,r},N.prototype.createFrictionEquation=function(t,e,i,n){var r=this.frictionEquationPool.get();return r.bodyA=t,r.bodyB=e,r.shapeA=i,r.shapeB=n,r.setSlipForce(this.slipForce),r.frictionCoefficient=this.frictionCoefficient,r.relativeVelocity=this.surfaceVelocity,r.enabled=this.enabledEquations,r.needsUpdate=!0,r.stiffness=this.frictionStiffness,r.relaxation=this.frictionRelaxation,r.contactEquations.length=0,r},N.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return G.copy(e.contactPointA,t.contactPointA),G.copy(e.contactPointB,t.contactPointB),G.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},N.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1],i=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),n=e.bodyA;e.bodyB,G.set(i.contactPointA,0,0),G.set(i.contactPointB,0,0),G.set(i.t,0,0);for(var r=0;r!==t;r++)(e=this.contactEquations[this.contactEquations.length-1-r]).bodyA===n?(G.add(i.t,i.t,e.normalA),G.add(i.contactPointA,i.contactPointA,e.contactPointA),G.add(i.contactPointB,i.contactPointB,e.contactPointB)):(G.sub(i.t,i.t,e.normalA),G.add(i.contactPointA,i.contactPointA,e.contactPointB),G.add(i.contactPointB,i.contactPointB,e.contactPointA)),i.contactEquations.push(e);var s=1/t;return G.scale(i.contactPointA,i.contactPointA,s),G.scale(i.contactPointB,i.contactPointB,s),G.normalize(i.t,i.t),G.rotate90cw(i.t,i.t),i},N.prototype[p.LINE|p.CONVEX]=N.prototype.convexLine=function(t,e,i,n,r,s,o,a,l){return!l&&0},N.prototype[p.LINE|p.BOX]=N.prototype.lineBox=function(t,e,i,n,r,s,o,a,l){return!l&&0};var c=new w({width:1,height:1}),d=G.create();N.prototype[p.CAPSULE|p.CONVEX]=N.prototype[p.CAPSULE|p.BOX]=N.prototype.convexCapsule=function(t,e,i,n,r,s,o,a,l){var p=d;G.set(p,s.length/2,0),G.rotate(p,p,a),G.add(p,p,o);var h=this.circleConvex(r,s,p,a,t,e,i,n,l,s.radius);G.set(p,-s.length/2,0),G.rotate(p,p,a),G.add(p,p,o);var u=this.circleConvex(r,s,p,a,t,e,i,n,l,s.radius);if(l&&(h||u))return!0;p=c;return x(p,s),this.convexConvex(t,e,i,n,r,p,o,a,l)+h+u},N.prototype[p.CAPSULE|p.LINE]=N.prototype.lineCapsule=function(t,e,i,n,r,s,o,a,l){return!l&&0};var v=G.create(),g=G.create(),b=new w({width:1,height:1});N.prototype[p.CAPSULE|p.CAPSULE]=N.prototype.capsuleCapsule=function(t,e,i,n,r,s,o,a,l){for(var p=v,h=g,u=0,c=0;c<2;c++){G.set(p,(0===c?-1:1)*e.length/2,0),G.rotate(p,p,n),G.add(p,p,i);for(var d=0;d<2;d++){G.set(h,(0===d?-1:1)*s.length/2,0),G.rotate(h,h,a),G.add(h,h,o),this.enableFrictionReduction&&(f=this.enableFriction,this.enableFriction=!1);var _=this.circleCircle(t,e,p,n,r,s,h,a,l,e.radius,s.radius);if(this.enableFrictionReduction&&(this.enableFriction=f),l&&_)return!0;u+=_}}this.enableFrictionReduction&&(f=this.enableFriction,this.enableFriction=!1);var y=b;x(y,e);var f,m=this.convexCapsule(t,y,i,n,r,s,o,a,l);if(this.enableFrictionReduction&&(this.enableFriction=f),l&&m)return!0;u+=m,this.enableFrictionReduction&&(f=this.enableFriction,this.enableFriction=!1),x(y,s);y=this.convexCapsule(r,y,o,a,t,e,i,n,l);return this.enableFrictionReduction&&(this.enableFriction=f),!(!l||!y)||(u+=y,this.enableFrictionReduction&&u&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(u)),u)},N.prototype[p.LINE|p.LINE]=N.prototype.lineLine=function(t,e,i,n,r,s,o,a,l){return!l&&0},N.prototype[p.PLANE|p.LINE]=N.prototype.planeLine=function(t,e,i,n,r,s,o,a,l){var p=W,h=H,u=q,c=Y,d=K,_=O,y=Z,f=J,m=Q,x=F,v=0;G.set(p,-s.length/2,0),G.set(h,s.length/2,0),G.rotate(u,p,a),G.rotate(c,h,a),X(u,u,o),X(c,c,o),G.copy(p,u),G.copy(h,c),U(d,h,p),G.normalize(_,d),G.rotate90cw(m,_),G.rotate(f,C,n),x[0]=p,x[1]=h;for(var g=0;g<x.length;g++){var b=x[g];U(y,b,i);var z=V(y,f);if(z<0){if(l)return!0;var w=this.createContactEquation(t,r,e,s);v++,G.copy(w.normalA,f),G.normalize(w.normalA,w.normalA),G.scale(y,f,z),U(w.contactPointA,b,y),U(w.contactPointA,w.contactPointA,t.position),U(w.contactPointB,b,o),X(w.contactPointB,w.contactPointB,o),U(w.contactPointB,w.contactPointB,r.position),this.contactEquations.push(w),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(w))}}return!l&&(this.enableFrictionReduction||v&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(v)),v)},N.prototype[p.PARTICLE|p.CAPSULE]=N.prototype.particleCapsule=function(t,e,i,n,r,s,o,a,l){return this.circleLine(t,e,i,n,r,s,o,a,l,s.radius,0)},N.prototype[p.CIRCLE|p.LINE]=N.prototype.circleLine=function(t,e,i,n,r,s,o,a,l,p,h){var p=p||0,h=void 0!==h?h:e.radius,u=W,c=H,d=q,_=Y,y=K,f=O,m=Z,x=J,v=Q,g=k,b=E,z=I,w=D,C=B,P=F;G.set(x,-s.length/2,0),G.set(v,s.length/2,0),G.rotate(g,x,a),G.rotate(b,v,a),X(g,g,o),X(b,b,o),G.copy(x,g),G.copy(v,b),U(f,v,x),G.normalize(m,f),G.rotate90cw(y,m),U(z,i,x);f=V(z,y);U(_,x,o),U(w,i,o);var T=h+p;if(Math.abs(f)<T){G.scale(u,y,f),U(d,i,u),G.scale(c,y,V(y,w)),G.normalize(c,c),G.scale(c,c,p),X(d,d,c);w=V(m,d),c=V(m,x),m=V(m,v);if(c<w&&w<m){if(l)return!0;var S=this.createContactEquation(t,r,e,s);return G.scale(S.normalA,u,-1),G.normalize(S.normalA,S.normalA),G.scale(S.contactPointA,S.normalA,h),X(S.contactPointA,S.contactPointA,i),U(S.contactPointA,S.contactPointA,t.position),U(S.contactPointB,d,o),X(S.contactPointB,S.contactPointB,o),U(S.contactPointB,S.contactPointB,r.position),this.contactEquations.push(S),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(S)),1}}P[0]=x,P[1]=v;for(var M=0;M<P.length;M++){var A=P[M];if(U(z,A,i),G.squaredLength(z)<Math.pow(T,2)){if(l)return!0;S=this.createContactEquation(t,r,e,s);return G.copy(S.normalA,z),G.normalize(S.normalA,S.normalA),G.scale(S.contactPointA,S.normalA,h),X(S.contactPointA,S.contactPointA,i),U(S.contactPointA,S.contactPointA,t.position),U(S.contactPointB,A,o),G.scale(C,S.normalA,-p),X(S.contactPointB,S.contactPointB,C),X(S.contactPointB,S.contactPointB,o),U(S.contactPointB,S.contactPointB,r.position),this.contactEquations.push(S),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(S)),1}}return 0},N.prototype[p.CIRCLE|p.CAPSULE]=N.prototype.circleCapsule=function(t,e,i,n,r,s,o,a,l){return this.circleLine(t,e,i,n,r,s,o,a,l,s.radius)},N.prototype[p.CIRCLE|p.CONVEX]=N.prototype[p.CIRCLE|p.BOX]=N.prototype.circleConvex=function(t,e,i,n,r,s,o,a,l,p){for(var p="number"==typeof p?p:e.radius,h=W,u=H,c=q,d=Y,_=K,y=k,f=E,m=D,x=B,v=L,g=R,b=!1,z=Number.MAX_VALUE,w=s.vertices,C=0;C!==w.length+1;C++){var P=w[C%w.length],T=w[(C+1)%w.length];G.rotate(h,P,a),G.rotate(u,T,a),X(h,h,o),X(u,u,o),U(c,u,h),G.normalize(d,c),G.rotate90cw(_,d),G.scale(x,_,-e.radius),X(x,x,i),A(x,s,o,a)&&(G.sub(v,h,x),(T=Math.abs(G.dot(v,_)))<z&&(G.copy(g,x),z=T,G.scale(m,_,T),G.add(m,m,x),b=!0))}if(b){if(l)return!0;var S=this.createContactEquation(t,r,e,s);return G.sub(S.normalA,g,i),G.normalize(S.normalA,S.normalA),G.scale(S.contactPointA,S.normalA,p),X(S.contactPointA,S.contactPointA,i),U(S.contactPointA,S.contactPointA,t.position),U(S.contactPointB,m,o),X(S.contactPointB,S.contactPointB,o),U(S.contactPointB,S.contactPointB,r.position),this.contactEquations.push(S),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(S)),1}if(0<p)for(C=0;C<w.length;C++){var M=w[C];if(G.rotate(f,M,a),X(f,f,o),U(y,f,i),G.squaredLength(y)<Math.pow(p,2)){if(l)return!0;S=this.createContactEquation(t,r,e,s);return G.copy(S.normalA,y),G.normalize(S.normalA,S.normalA),G.scale(S.contactPointA,S.normalA,p),X(S.contactPointA,S.contactPointA,i),U(S.contactPointA,S.contactPointA,t.position),U(S.contactPointB,f,o),X(S.contactPointB,S.contactPointB,o),U(S.contactPointB,S.contactPointB,r.position),this.contactEquations.push(S),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(S)),1}}return 0};var _=G.create(),y=G.create(),f=G.create(),m=G.create();N.prototype[p.PARTICLE|p.CONVEX]=N.prototype[p.PARTICLE|p.BOX]=N.prototype.particleConvex=function(t,e,i,n,r,s,o,a,l){var p=W,h=H,u=q,c=Y,d=K,_=O,y=Z,f=k,m=D,x=T,v=S,g=Number.MAX_VALUE,b=!1,z=s.vertices;if(!A(i,s,o,a))return 0;if(l)return!0;for(var w=0;w!==z.length+1;w++){var C=z[w%z.length],P=z[(w+1)%z.length];G.rotate(p,C,a),G.rotate(h,P,a),X(p,p,o),X(h,h,o),U(u,h,p),G.normalize(c,u),G.rotate90cw(d,c),U(f,i,p),V(f,d),U(_,p,o),U(y,i,o),G.sub(x,p,i);P=Math.abs(G.dot(x,d));P<g&&(g=P,G.scale(m,d,P),G.add(m,m,i),G.copy(v,d),b=!0)}if(b){s=this.createContactEquation(t,r,e,s);return G.scale(s.normalA,v,-1),G.normalize(s.normalA,s.normalA),G.set(s.contactPointA,0,0),X(s.contactPointA,s.contactPointA,i),U(s.contactPointA,s.contactPointA,t.position),U(s.contactPointB,m,o),X(s.contactPointB,s.contactPointB,o),U(s.contactPointB,s.contactPointB,r.position),this.contactEquations.push(s),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(s)),1}return 0},N.prototype[p.CIRCLE]=N.prototype.circleCircle=function(t,e,i,n,r,s,o,a,l,p,h){var u=W,p=p||e.radius,h=h||s.radius;U(u,i,o);var c=p+h;if(G.squaredLength(u)>Math.pow(c,2))return 0;if(l)return!0;s=this.createContactEquation(t,r,e,s);return U(s.normalA,o,i),G.normalize(s.normalA,s.normalA),G.scale(s.contactPointA,s.normalA,p),G.scale(s.contactPointB,s.normalA,-h),X(s.contactPointA,s.contactPointA,i),U(s.contactPointA,s.contactPointA,t.position),X(s.contactPointB,s.contactPointB,o),U(s.contactPointB,s.contactPointB,r.position),this.contactEquations.push(s),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(s)),1},N.prototype[p.PLANE|p.CONVEX]=N.prototype[p.PLANE|p.BOX]=N.prototype.planeConvex=function(t,e,i,n,r,s,o,a,l){var p=W,h=H,u=q,c=0;G.rotate(h,C,n);for(var d=0;d!==s.vertices.length;d++){var _=s.vertices[d];if(G.rotate(p,_,a),X(p,p,o),U(u,p,i),V(u,h)<=0){if(l)return!0;c++;var y=this.createContactEquation(t,r,e,s);U(u,p,i),G.copy(y.normalA,h);_=V(u,y.normalA);G.scale(u,y.normalA,_),U(y.contactPointB,p,r.position),U(y.contactPointA,p,u),U(y.contactPointA,y.contactPointA,t.position),this.contactEquations.push(y),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(y))}}return this.enableFrictionReduction&&this.enableFriction&&c&&this.frictionEquations.push(this.createFrictionFromAverage(c)),c},N.prototype[p.PARTICLE|p.PLANE]=N.prototype.particlePlane=function(t,e,i,n,r,s,o,a,l){var p=W,h=H;a=a||0,U(p,i,o),G.rotate(h,C,a);a=V(p,h);if(0<a)return 0;if(l)return!0;e=this.createContactEquation(r,t,s,e);return G.copy(e.normalA,h),G.scale(p,e.normalA,a),U(e.contactPointA,i,p),U(e.contactPointA,e.contactPointA,r.position),U(e.contactPointB,i,t.position),this.contactEquations.push(e),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(e)),1},N.prototype[p.CIRCLE|p.PARTICLE]=N.prototype.circleParticle=function(t,e,i,n,r,s,o,a,l){var p=W;if(U(p,o,i),G.squaredLength(p)>Math.pow(e.radius,2))return 0;if(l)return!0;s=this.createContactEquation(t,r,e,s);return G.copy(s.normalA,p),G.normalize(s.normalA,s.normalA),G.scale(s.contactPointA,s.normalA,e.radius),X(s.contactPointA,s.contactPointA,i),U(s.contactPointA,s.contactPointA,t.position),U(s.contactPointB,o,r.position),this.contactEquations.push(s),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(s)),1};var z=new a({radius:1}),P=G.create(),M=G.create();G.create(),N.prototype[p.PLANE|p.CAPSULE]=N.prototype.planeCapsule=function(t,e,i,n,r,s,o,a,l){var p,h=P,u=M,c=z;G.set(h,-s.length/2,0),G.rotate(h,h,a),X(h,h,o),G.set(u,s.length/2,0),G.rotate(u,u,a),X(u,u,o),c.radius=s.radius,this.enableFrictionReduction&&(p=this.enableFriction,this.enableFriction=!1);h=this.circlePlane(r,c,h,0,t,e,i,n,l),n=this.circlePlane(r,c,u,0,t,e,i,n,l);if(this.enableFrictionReduction&&(this.enableFriction=p),l)return h||n;n=h+n;return this.enableFrictionReduction&&n&&this.frictionEquations.push(this.createFrictionFromAverage(n)),n},N.prototype[p.CIRCLE|p.PLANE]=N.prototype.circlePlane=function(t,e,i,n,r,s,o,a,l){var p=t,h=e,u=i,c=r,t=o,i=(i=a)||0,r=W,o=H,a=q;U(r,u,t),G.rotate(o,C,i);i=V(o,r);if(i>h.radius)return 0;if(l)return!0;e=this.createContactEquation(c,p,s,e);return G.copy(e.normalA,o),G.scale(e.contactPointB,e.normalA,-h.radius),X(e.contactPointB,e.contactPointB,u),U(e.contactPointB,e.contactPointB,p.position),G.scale(a,e.normalA,i),U(e.contactPointA,r,a),X(e.contactPointA,e.contactPointA,t),U(e.contactPointA,e.contactPointA,c.position),this.contactEquations.push(e),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(e)),1},N.prototype[p.CONVEX]=N.prototype[p.CONVEX|p.BOX]=N.prototype[p.BOX]=N.prototype.convexConvex=function(t,e,i,n,r,s,o,a,l,p){var h=W,u=H,c=q,d=Y,_=K,y=Z,f=J,m=Q,x=0,p="number"==typeof p?p:0;if(!N.findSeparatingAxis(e,i,n,s,o,a,h))return 0;U(f,o,i),0<V(h,f)&&G.scale(h,h,-1);var v=N.getClosestEdge(e,n,h,!0),g=N.getClosestEdge(s,a,h);if(-1===v||-1===g)return 0;for(var b=0;b<2;b++){var z,w=v,C=g,P=e,T=s,S=i,M=o,A=n,O=a,k=t,E=r;0===b&&(z=w,w=C,C=z,z=P,P=T,T=z,z=S,S=M,M=z,z=A,A=O,O=z,z=k,k=E,E=z);for(var I=C;I<C+2;I++){var D=T.vertices[(I+T.vertices.length)%T.vertices.length];G.rotate(u,D,O),X(u,u,M);for(var B=0,L=w-1;L<w+2;L++){var R=P.vertices[(L+P.vertices.length)%P.vertices.length],F=P.vertices[(L+1+P.vertices.length)%P.vertices.length];G.rotate(c,R,A),G.rotate(d,F,A),X(c,c,S),X(d,d,S),U(_,d,c),G.rotate90cw(m,_),G.normalize(m,m),U(f,u,c);var j=V(m,f);(L===w&&j<=p||L!==w&&j<=0)&&B++}if(3<=B){if(l)return!0;D=this.createContactEquation(k,E,P,T);x++;R=P.vertices[w%P.vertices.length],F=P.vertices[(w+1)%P.vertices.length];G.rotate(c,R,A),G.rotate(d,F,A),X(c,c,S),X(d,d,S),U(_,d,c),G.rotate90cw(D.normalA,_),G.normalize(D.normalA,D.normalA),U(f,u,c);j=V(D.normalA,f);G.scale(y,D.normalA,j),U(D.contactPointA,u,S),U(D.contactPointA,D.contactPointA,y),X(D.contactPointA,D.contactPointA,S),U(D.contactPointA,D.contactPointA,k.position),U(D.contactPointB,u,M),X(D.contactPointB,D.contactPointB,M),U(D.contactPointB,D.contactPointB,E.position),this.contactEquations.push(D),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(D))}}}return this.enableFrictionReduction&&this.enableFriction&&x&&this.frictionEquations.push(this.createFrictionFromAverage(x)),x};var j=G.fromValues(0,0);N.projectConvexOntoAxis=function(t,e,i,n,r){var s,o=null,a=null,l=j;G.rotate(l,n,-i);for(var p=0;p<t.vertices.length;p++)s=t.vertices[p],s=V(s,l),(null===o||o<s)&&(o=s),(null===a||s<a)&&(a=s);o<a&&(i=a,a=o,o=i);n=V(e,n);G.set(r,a+n,o+n)};var $=G.fromValues(0,0),tt=G.fromValues(0,0),et=G.fromValues(0,0),it=G.fromValues(0,0),nt=G.fromValues(0,0),rt=G.fromValues(0,0);N.findSeparatingAxis=function(t,e,i,n,r,s,o){var a=null,l=!1,p=!1,h=$,u=tt,c=et,d=it,_=nt,y=rt;if(t instanceof w&&n instanceof w)for(var f=0;2!==f;f++){var m=t,x=i;1===f&&(m=n,x=s);for(var v=0;2!==v;v++){0===v?G.set(d,0,1):1===v&&G.set(d,1,0),0!==x&&G.rotate(d,d,x),N.projectConvexOntoAxis(t,e,i,d,_),N.projectConvexOntoAxis(n,r,s,d,y);var g=_,b=y;_[0]>y[0]&&(b=_,g=y,0);l=(z=b[0]-g[1])<=0;(null===a||a<z)&&(G.copy(o,d),a=z,p=l)}}else for(f=0;2!==f;f++){m=t,x=i;1===f&&(m=n,x=s);for(v=0;v!==m.vertices.length;v++){G.rotate(u,m.vertices[v],x),G.rotate(c,m.vertices[(v+1)%m.vertices.length],x),U(h,c,u),G.rotate90cw(d,h),G.normalize(d,d),N.projectConvexOntoAxis(t,e,i,d,_),N.projectConvexOntoAxis(n,r,s,d,y);var z,g=_,b=y;_[0]>y[0]&&(b=_,g=y,0),l=(z=b[0]-g[1])<=0,(null===a||a<z)&&(G.copy(o,d),a=z,p=l)}}return p};var st=G.fromValues(0,0),ot=G.fromValues(0,0),at=G.fromValues(0,0);N.getClosestEdge=function(t,e,i,n){var r=st,s=ot,o=at;G.rotate(r,i,-e),n&&G.scale(r,r,-1);for(var a=-1,l=t.vertices.length,p=-1,h=0;h!==l;h++){U(s,t.vertices[(h+1)%l],t.vertices[h%l]),G.rotate90cw(o,s),G.normalize(o,o);var u=V(o,r);(-1===a||p<u)&&(a=h%l,p=u)}return a};var lt=G.create(),pt=G.create(),ht=G.create(),ut=G.create(),ct=G.create(),dt=G.create(),_t=G.create();N.prototype[p.CIRCLE|p.HEIGHTFIELD]=N.prototype.circleHeightfield=function(t,e,i,n,r,s,o,a,l,p){var h=s.heights,p=p||e.radius,u=s.elementWidth,c=pt,d=lt,_=ct,y=_t,f=dt,m=ht,x=ut,v=Math.floor((i[0]-p-o[0])/u),g=Math.ceil((i[0]+p-o[0])/u);v<0&&(v=0),g>=h.length&&(g=h.length-1);for(var b=h[v],z=h[g],w=v;w<g;w++)h[w]<z&&(z=h[w]),h[w]>b&&(b=h[w]);if(i[1]-p>b)return!l&&0;for(var C=!1,w=v;w<g;w++){G.set(m,w*u,h[w]),G.set(x,(w+1)*u,h[w+1]),G.add(m,m,o),G.add(x,x,o),G.sub(f,x,m),G.rotate(f,f,Math.PI/2),G.normalize(f,f),G.scale(d,f,-p),G.add(d,d,i),G.sub(c,d,m);var P=G.dot(c,f);if(d[0]>=m[0]&&d[0]<x[0]&&P<=0){if(l)return!0;C=!0,G.scale(c,f,-P),G.add(_,d,c),G.copy(y,f);var T=this.createContactEquation(r,t,s,e);G.copy(T.normalA,y),G.scale(T.contactPointB,T.normalA,-p),X(T.contactPointB,T.contactPointB,i),U(T.contactPointB,T.contactPointB,t.position),G.copy(T.contactPointA,_),G.sub(T.contactPointA,T.contactPointA,r.position),this.contactEquations.push(T),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(T))}}if(C=!1,0<p)for(w=v;w<=g;w++)if(G.set(m,w*u,h[w]),G.add(m,m,o),G.sub(c,i,m),G.squaredLength(c)<Math.pow(p,2)){if(l)return!0;C=!0;T=this.createContactEquation(r,t,s,e);G.copy(T.normalA,c),G.normalize(T.normalA,T.normalA),G.scale(T.contactPointB,T.normalA,-p),X(T.contactPointB,T.contactPointB,i),U(T.contactPointB,T.contactPointB,t.position),U(T.contactPointA,m,o),X(T.contactPointA,T.contactPointA,o),U(T.contactPointA,T.contactPointA,r.position),this.contactEquations.push(T),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(T))}return C?1:0};var yt=G.create(),ft=G.create(),mt=G.create(),xt=new l({vertices:[G.create(),G.create(),G.create(),G.create()]});N.prototype[p.BOX|p.HEIGHTFIELD]=N.prototype[p.CONVEX|p.HEIGHTFIELD]=N.prototype.convexHeightfield=function(t,e,i,n,r,s,o,a,l){var p=s.heights,h=s.elementWidth,u=yt,c=ft,d=mt,_=xt,s=Math.floor((t.aabb.lowerBound[0]-o[0])/h),y=Math.ceil((t.aabb.upperBound[0]-o[0])/h);s<0&&(s=0),y>=p.length&&(y=p.length-1);for(var f=p[s],m=p[y],x=s;x<y;x++)p[x]<m&&(m=p[x]),p[x]>f&&(f=p[x]);if(t.aabb.lowerBound[1]>f)return!l&&0;for(var v=0,x=s;x<y;x++){G.set(u,x*h,p[x]),G.set(c,(x+1)*h,p[x+1]),G.add(u,u,o),G.add(c,c,o);G.set(d,.5*(c[0]+u[0]),.5*(c[1]+u[1]-100)),G.sub(_.vertices[0],c,d),G.sub(_.vertices[1],u,d),G.copy(_.vertices[2],_.vertices[1]),G.copy(_.vertices[3],_.vertices[0]),_.vertices[2][1]-=100,_.vertices[3][1]-=100,v+=this.convexConvex(t,e,i,n,r,_,d,0,l)}return v}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(t,e,i){function o(t){t=t||{},this.from=t.from?l.fromValues(t.from[0],t.from[1]):l.create(),this.to=t.to?l.fromValues(t.to[0],t.to[1]):l.create(),this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,this.skipBackfaces=!!t.skipBackfaces,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:-1,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:-1,this.mode=void 0!==t.mode?t.mode:o.ANY,this.callback=t.callback||function(t){},this.direction=l.create(),this.length=1,this.update()}e.exports=o;var l=t("../math/vec2");t("../collision/RaycastResult"),t("../shapes/Shape"),t("../collision/AABB"),(o.prototype.constructor=o).CLOSEST=1,o.ANY=2,o.ALL=4,o.prototype.update=function(){var t=this.direction;l.sub(t,this.to,this.from),this.length=l.length(t),l.normalize(t,t)},o.prototype.intersectBodies=function(t,e){for(var i=0,n=e.length;!t.shouldStop(this)&&i<n;i++){var r=e[i],s=r.getAABB();(0<=s.overlapsRay(this)||s.containsPoint(this.from))&&this.intersectBody(t,r)}};var p=l.create();o.prototype.intersectBody=function(t,e){var i=this.checkCollisionResponse;if(!i||e.collisionResponse)for(var n=p,r=0,s=e.shapes.length;r<s;r++){var o=e.shapes[r];if((!i||o.collisionResponse)&&0!=(this.collisionGroup&o.collisionMask)&&0!=(o.collisionGroup&this.collisionMask)){l.rotate(n,o.position,e.angle),l.add(n,n,e.position);var a=o.angle+e.angle;if(this.intersectShape(t,o,a,n,e),t.shouldStop(this))break}}},o.prototype.intersectShape=function(t,e,i,n,r){(function(t,e,i){l.sub(s,i,t);var n=l.dot(s,e);return l.scale(a,e,n),l.add(a,a,t),l.squaredDistance(i,a)})(this.from,this.direction,n)>e.boundingRadius*e.boundingRadius||(this._currentBody=r,(this._currentShape=e).raycast(t,this,n,i),this._currentBody=this._currentShape=null)},o.prototype.getAABB=function(t){var e=this.to,i=this.from;l.set(t.lowerBound,Math.min(e[0],i[0]),Math.min(e[1],i[1])),l.set(t.upperBound,Math.max(e[0],i[0]),Math.max(e[1],i[1]))},l.create(),o.prototype.reportIntersection=function(t,e,i,n){var r=(this.from,this.to,this._currentShape),s=this._currentBody;if(!(this.skipBackfaces&&0<l.dot(i,this.direction)))switch(this.mode){case o.ALL:t.set(i,r,s,e,n),this.callback(t);break;case o.CLOSEST:(e<t.fraction||!t.hasHit())&&t.set(i,r,s,e,n);break;case o.ANY:t.set(i,r,s,e,n)}};var s=l.create(),a=l.create()},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(t,e,i){function n(){this.normal=s.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}var s=t("../math/vec2"),r=t("../collision/Ray");(e.exports=n).prototype.reset=function(){s.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},n.prototype.getHitDistance=function(t){return s.distance(t.from,t.to)*this.fraction},n.prototype.hasHit=function(){return-1!==this.fraction},n.prototype.getHitPoint=function(t,e){s.lerp(t,e.from,e.to,this.fraction)},n.prototype.stop=function(){this.isStopped=!0},n.prototype.shouldStop=function(t){return this.isStopped||-1!==this.fraction&&t.mode===r.ANY},n.prototype.set=function(t,e,i,n,r){s.copy(this.normal,t),this.shape=e,this.body=i,this.fraction=n,this.faceIndex=r}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(t,e,i){function n(){u.call(this,u.SAP),this.axisList=[],this.axisIndex=0;var e=this;this._addBodyHandler=function(t){e.axisList.push(t.body)},this._removeBodyHandler=function(t){t=e.axisList.indexOf(t.body);-1!==t&&e.axisList.splice(t,1)}}var r=t("../utils/Utils"),u=t("../collision/Broadphase");(((e.exports=n).prototype=new u).constructor=n).prototype.setWorld=function(t){this.axisList.length=0,r.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},n.sortAxisList=function(t,e){e|=0;for(var i=1,n=t.length;i<n;i++){for(var r=t[i],s=i-1;0<=s&&!(t[s].aabb.lowerBound[e]<=r.aabb.lowerBound[e]);s--)t[s+1]=t[s];t[s+1]=r}return t},n.prototype.sortList=function(){var t=this.axisList,e=this.axisIndex;n.sortAxisList(t,e)},n.prototype.getCollisionPairs=function(t){var e=this.axisList,i=this.result,n=this.axisIndex;i.length=0;for(var r=e.length;r--;){var s=e[r];s.aabbNeedsUpdate&&s.updateAABB()}this.sortList();for(var o=0,a=0|e.length;o!==a;o++)for(var l=e[o],p=o+1;p<a;p++){var h=e[p];if(!(h.aabb.lowerBound[n]<=l.aabb.upperBound[n]))break;u.canCollide(l,h)&&this.boundingVolumeCheck(l,h)&&i.push(l,h)}return i},n.prototype.aabbQuery=function(t,e,i){i=i||[],this.sortList();for(var n=this.axisIndex,n=2===n?"z":1===n?"y":"x",r=this.axisList,s=(e.lowerBound[n],e.upperBound[n],0);s<r.length;s++){var o=r[s];o.aabbNeedsUpdate&&o.updateAABB(),o.aabb.overlaps(e)&&i.push(o)}return i}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(t,e,i){function n(t,e,i,n){this.type=i,n=r.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}e.exports=n;var r=t("../utils/Utils");n.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},n.DISTANCE=1,n.GEAR=2,n.LOCK=3,n.PRISMATIC=4,n.REVOLUTE=5,n.prototype.setStiffness=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var n=e[i];n.stiffness=t,n.needsUpdate=!0}},n.prototype.setRelaxation=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var n=e[i];n.relaxation=t,n.needsUpdate=!0}}},{"../utils/Utils":57}],15:[function(t,e,i){function n(t,e,i){i=_.defaults(i,{localAnchorA:[0,0],localAnchorB:[0,0]}),u.call(this,t,e,u.DISTANCE,i),this.localAnchorA=d.fromValues(i.localAnchorA[0],i.localAnchorA[1]),this.localAnchorB=d.fromValues(i.localAnchorB[0],i.localAnchorB[1]);var n,r,s=this.localAnchorA,o=this.localAnchorB;this.distance=0,"number"==typeof i.distance?this.distance=i.distance:(n=d.create(),r=d.create(),a=d.create(),d.rotate(n,s,t.angle),d.rotate(r,o,e.angle),d.add(a,e.position,r),d.sub(a,a,n),d.sub(a,a,t.position),this.distance=d.length(a)),i=void 0===i.maxForce?Number.MAX_VALUE:i.maxForce;e=new c(t,e,-i,i);this.equations=[e],this.maxForce=i;var a=d.create(),l=d.create(),p=d.create(),h=this;e.computeGq=function(){var t=this.bodyA,e=this.bodyB,i=t.position,n=e.position;return d.rotate(l,s,t.angle),d.rotate(p,o,e.angle),d.add(a,n,p),d.sub(a,a,l),d.sub(a,a,i),d.length(a)-h.distance},this.setMaxForce(i),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var u=t("./Constraint"),c=t("../equations/Equation"),d=t("../math/vec2"),_=t("../utils/Utils");((e.exports=n).prototype=new u).constructor=n;var o=d.create(),a=d.create(),l=d.create();n.prototype.update=function(){var t=this.equations[0],e=this.bodyA,i=this.bodyB,n=(this.distance,e.position),r=i.position,s=this.equations[0],t=t.G;d.rotate(a,this.localAnchorA,e.angle),d.rotate(l,this.localAnchorB,i.angle),d.add(o,r,l),d.sub(o,o,a),d.sub(o,o,n),this.position=d.length(o);r=!1;this.upperLimitEnabled&&this.position>this.upperLimit&&(s.maxForce=0,s.minForce=-this.maxForce,this.distance=this.upperLimit,r=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(s.maxForce=this.maxForce,s.minForce=0,this.distance=this.lowerLimit,r=!0),!this.lowerLimitEnabled&&!this.upperLimitEnabled||r?(s.enabled=!0,d.normalize(o,o),n=d.crossLength(a,o),r=d.crossLength(l,o),t[0]=-o[0],t[1]=-o[1],t[2]=-n,t[3]=o[0],t[4]=o[1],t[5]=r):s.enabled=!1},n.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},n.prototype.getMaxForce=function(){return this.equations[0].maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,r.GEAR,i),this.ratio=void 0!==i.ratio?i.ratio:1,this.angle=void 0!==i.angle?i.angle:e.angle-this.ratio*t.angle,i.angle=this.angle,i.ratio=this.ratio,this.equations=[new s(t,e,i)],void 0!==i.maxTorque&&this.setMaxTorque(i.maxTorque)}var r=t("./Constraint"),s=(t("../equations/Equation"),t("../equations/AngleLockEquation"));t("../math/vec2"),(((e.exports=n).prototype=new r).constructor=n).prototype.update=function(){var t=this.equations[0];t.ratio!==this.ratio&&t.setRatio(this.ratio),t.angle=this.angle},n.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},n.prototype.getMaxTorque=function(t){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(t,e,i){function n(t,e,i){i=i||{},c.call(this,t,e,c.LOCK,i);var n=void 0===i.maxForce?Number.MAX_VALUE:i.maxForce,r=(i.localAngleB,new _(t,e,-n,n)),s=new _(t,e,-n,n),o=new _(t,e,-n,n),a=d.create(),l=d.create(),p=this;r.computeGq=function(){return d.rotate(a,p.localOffsetB,t.angle),d.sub(l,e.position,t.position),d.sub(l,l,a),l[0]},s.computeGq=function(){return d.rotate(a,p.localOffsetB,t.angle),d.sub(l,e.position,t.position),d.sub(l,l,a),l[1]};var h=d.create(),u=d.create();o.computeGq=function(){return d.rotate(h,p.localOffsetB,e.angle-p.localAngleB),d.scale(h,h,-1),d.sub(l,t.position,e.position),d.add(l,l,h),d.rotate(u,h,-Math.PI/2),d.normalize(u,u),d.dot(l,u)},this.localOffsetB=d.create(),i.localOffsetB?d.copy(this.localOffsetB,i.localOffsetB):(d.sub(this.localOffsetB,e.position,t.position),d.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,"number"==typeof i.localAngleB?this.localAngleB=i.localAngleB:this.localAngleB=e.angle-t.angle,this.equations.push(r,s,o),this.setMaxForce(n)}var c=t("./Constraint"),d=t("../math/vec2"),_=t("../equations/Equation");(((e.exports=n).prototype=new c).constructor=n).prototype.setMaxForce=function(t){for(var e=this.equations,i=0;i<this.equations.length;i++)e[i].maxForce=t,e[i].minForce=-t},n.prototype.getMaxForce=function(){return this.equations[0].maxForce};var s=d.create(),o=d.create(),a=d.create(),l=d.fromValues(1,0),p=d.fromValues(0,1);n.prototype.update=function(){var t=this.equations[0],e=this.equations[1],i=this.equations[2],n=this.bodyA,r=this.bodyB;d.rotate(s,this.localOffsetB,n.angle),d.rotate(o,this.localOffsetB,r.angle-this.localAngleB),d.scale(o,o,-1),d.rotate(a,o,Math.PI/2),d.normalize(a,a),t.G[0]=-1,t.G[1]=0,t.G[2]=-d.crossLength(s,l),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-d.crossLength(s,p),e.G[4]=1,i.G[0]=-a[0],i.G[1]=-a[1],i.G[3]=a[0],i.G[4]=a[1],i.G[5]=d.crossLength(o,a)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(t,e,i){function n(n,r,t){t=t||{},d.call(this,n,r,d.PRISMATIC,t);var s=f.fromValues(0,0),o=f.fromValues(1,0),a=f.fromValues(0,0);t.localAnchorA&&f.copy(s,t.localAnchorA),t.localAxisA&&f.copy(o,t.localAxisA),t.localAnchorB&&f.copy(a,t.localAnchorB),this.localAnchorA=s,this.localAnchorB=a,this.localAxisA=o;var e=this.maxForce=void 0!==t.maxForce?t.maxForce:Number.MAX_VALUE,i=new y(n,r,-e,e),l=new f.create,p=new f.create,h=new f.create,u=new f.create;i.computeGq=function(){return f.dot(h,u)},i.updateJacobian=function(){var t=this.G,e=n.position,i=r.position;f.rotate(l,s,n.angle),f.rotate(p,a,r.angle),f.add(h,i,p),f.sub(h,h,e),f.sub(h,h,l),f.rotate(u,o,n.angle+Math.PI/2),t[0]=-u[0],t[1]=-u[1],t[2]=-f.crossLength(l,u)+f.crossLength(u,h),t[3]=u[0],t[4]=u[1],t[5]=f.crossLength(p,u)},this.equations.push(i),t.disableRotationalLock||(i=new m(n,r,-e,e),this.equations.push(i)),this.position=0,this.velocity=0,this.lowerLimitEnabled=void 0!==t.lowerLimit,this.upperLimitEnabled=void 0!==t.upperLimit,this.lowerLimit=void 0!==t.lowerLimit?t.lowerLimit:0,this.upperLimit=void 0!==t.upperLimit?t.upperLimit:1,this.upperLimitEquation=new _(n,r),this.lowerLimitEquation=new _(n,r),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=e,this.motorEquation=new y(n,r),this.motorEnabled=!1,this.motorSpeed=0;var c=this,e=this.motorEquation;e.computeGW,e.computeGq=function(){return 0},e.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,n=e.velocity,r=i.velocity,e=e.angularVelocity,i=i.angularVelocity;return this.gmult(t,n,e,r,i)+c.motorSpeed}}var d=t("./Constraint"),_=t("../equations/ContactEquation"),y=t("../equations/Equation"),f=t("../math/vec2"),m=t("../equations/RotationalLockEquation");((e.exports=n).prototype=new d).constructor=n;var c=f.create(),x=f.create(),v=f.create(),g=f.create(),b=f.create(),z=f.create();n.prototype.update=function(){var t=this.equations,e=t[0],i=this.upperLimit,n=this.lowerLimit,r=this.upperLimitEquation,s=this.lowerLimitEquation,o=this.bodyA,a=this.bodyB,l=this.localAxisA,p=this.localAnchorA,h=this.localAnchorB;e.updateJacobian(),f.rotate(c,l,o.angle),f.rotate(g,p,o.angle),f.add(x,g,o.position),f.rotate(b,h,a.angle),f.add(v,b,a.position);var u,p=this.position=f.dot(v,c)-f.dot(x,c);this.motorEnabled&&((h=this.motorEquation.G)[0]=c[0],h[1]=c[1],h[2]=f.crossLength(c,b),h[3]=-c[0],h[4]=-c[1],h[5]=-f.crossLength(c,g)),this.upperLimitEnabled&&i<p?(f.scale(r.normalA,c,-1),f.sub(r.contactPointA,x,o.position),f.sub(r.contactPointB,v,a.position),f.scale(z,c,i),f.add(r.contactPointA,r.contactPointA,z),-1===t.indexOf(r)&&t.push(r)):-1!==(u=t.indexOf(r))&&t.splice(u,1),this.lowerLimitEnabled&&p<n?(f.scale(s.normalA,c,1),f.sub(s.contactPointA,x,o.position),f.sub(s.contactPointB,v,a.position),f.scale(z,c,n),f.sub(s.contactPointB,s.contactPointB,z),-1===t.indexOf(s)&&t.push(s)):-1!==(u=t.indexOf(s))&&t.splice(u,1)},n.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},n.prototype.disableMotor=function(){var t;this.motorEnabled&&(t=this.equations.indexOf(this.motorEquation),this.equations.splice(t,1),this.motorEnabled=!1)},n.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(t,e,i){function n(t,e,i){i=i||{},o.call(this,t,e,o.REVOLUTE,i);var n=this.maxForce=void 0!==i.maxForce?i.maxForce:Number.MAX_VALUE;this.pivotA=d.create(),this.pivotB=d.create(),i.worldPivot?(d.sub(this.pivotA,i.worldPivot,t.position),d.sub(this.pivotB,i.worldPivot,e.position),d.rotate(this.pivotA,this.pivotA,-t.angle),d.rotate(this.pivotB,this.pivotB,-e.angle)):(d.copy(this.pivotA,i.localPivotA),d.copy(this.pivotB,i.localPivotB));var r=this.equations=[new a(t,e,-n,n),new a(t,e,-n,n)],i=r[0],r=r[1],s=this;i.computeGq=function(){return d.rotate(_,s.pivotA,t.angle),d.rotate(y,s.pivotB,e.angle),d.add(h,e.position,y),d.sub(h,h,t.position),d.sub(h,h,_),d.dot(h,f)},r.computeGq=function(){return d.rotate(_,s.pivotA,t.angle),d.rotate(y,s.pivotB,e.angle),d.add(h,e.position,y),d.sub(h,h,t.position),d.sub(h,h,_),d.dot(h,m)},r.minForce=i.minForce=-n,r.maxForce=i.maxForce=n,this.motorEquation=new l(t,e),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new p(t,e),this.lowerLimitEquation=new p(t,e),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var o=t("./Constraint"),a=t("../equations/Equation"),l=t("../equations/RotationalVelocityEquation"),p=t("../equations/RotationalLockEquation"),d=t("../math/vec2");e.exports=n;var _=d.create(),y=d.create(),f=d.fromValues(1,0),m=d.fromValues(0,1),h=d.create();((n.prototype=new o).constructor=n).prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)},n.prototype.update=function(){var t,e=this.bodyA,i=this.bodyB,n=this.pivotA,r=this.pivotB,s=this.equations,o=(s[0],s[1],s[0]),a=s[1],l=this.upperLimit,p=this.lowerLimit,h=this.upperLimitEquation,u=this.lowerLimitEquation,c=this.angle=i.angle-e.angle;this.upperLimitEnabled&&l<c?(h.angle=l,-1===s.indexOf(h)&&s.push(h)):-1!==(t=s.indexOf(h))&&s.splice(t,1),this.lowerLimitEnabled&&c<p?(u.angle=p,-1===s.indexOf(u)&&s.push(u)):-1!==(t=s.indexOf(u))&&s.splice(t,1),d.rotate(_,n,e.angle),d.rotate(y,r,i.angle),o.G[0]=-1,o.G[1]=0,o.G[2]=-d.crossLength(_,f),o.G[3]=1,o.G[4]=0,o.G[5]=d.crossLength(y,f),a.G[0]=0,a.G[1]=-1,a.G[2]=-d.crossLength(_,m),a.G[3]=0,a.G[4]=1,a.G[5]=d.crossLength(y,m)},n.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},n.prototype.disableMotor=function(){var t;this.motorEnabled&&(t=this.equations.indexOf(this.motorEquation),this.equations.splice(t,1),this.motorEnabled=!1)},n.prototype.motorIsEnabled=function(){return!!this.motorEnabled},n.prototype.setMotorSpeed=function(t){var e;this.motorEnabled&&(e=this.equations.indexOf(this.motorEquation),this.equations[e].relativeVelocity=t)},n.prototype.getMotorSpeed=function(){return!!this.motorEnabled&&this.motorEquation.relativeVelocity}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0,this.ratio="number"==typeof i.ratio?i.ratio:1,this.setRatio(this.ratio)}var r=t("./Equation");t("../math/vec2"),(((e.exports=n).prototype=new r).constructor=n).prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},n.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},n.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}},{"../math/vec2":30,"./Equation":22}],21:[function(t,e,i){function n(t,e){r.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=d.create(),this.penetrationVec=d.create(),this.contactPointB=d.create(),this.normalA=d.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var r=t("./Equation"),d=t("../math/vec2");(((e.exports=n).prototype=new r).constructor=n).prototype.computeB=function(t,e,i){var n,r=this.bodyA,s=this.bodyB,o=this.contactPointA,a=this.contactPointB,l=r.position,p=s.position,h=this.penetrationVec,u=this.normalA,c=this.G,r=d.crossLength(o,u),s=d.crossLength(a,u);return c[0]=-u[0],c[1]=-u[1],c[2]=-r,c[3]=u[0],c[4]=u[1],c[5]=s,d.add(h,p,a),d.sub(h,h,l),d.sub(h,h,o),h=this.firstImpact&&0!==this.restitution?(n=0,1/e*(1+this.restitution)*this.computeGW()):(n=d.dot(u,h)+this.offset,this.computeGW()),-n*t-h*e-i*this.computeGiMf()}},{"../math/vec2":30,"./Equation":22}],22:[function(t,e,i){function s(t,e,i,n){this.minForce=void 0===i?-Number.MAX_VALUE:i,this.maxForce=void 0===n?Number.MAX_VALUE:n,this.bodyA=t,this.bodyB=e,this.stiffness=s.DEFAULT_STIFFNESS,this.relaxation=s.DEFAULT_RELAXATION,this.G=new o.ARRAY_TYPE(6);for(var r=0;r<6;r++)this.G[r]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}e.exports=s;var u=t("../math/vec2"),o=t("../utils/Utils");t("../objects/Body"),(s.prototype.constructor=s).DEFAULT_STIFFNESS=1e6,s.DEFAULT_RELAXATION=4,s.prototype.update=function(){var t=this.stiffness,e=this.relaxation,i=this.timeStep;this.a=4/(i*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(i*i*t*(1+4*e)),this.needsUpdate=!1},s.prototype.gmult=function(t,e,i,n,r){return t[0]*e[0]+t[1]*e[1]+t[2]*i+t[3]*n[0]+t[4]*n[1]+t[5]*r},s.prototype.computeB=function(t,e,i){var n=this.computeGW();return-this.computeGq()*t-n*e-this.computeGiMf()*i};var n=u.create(),r=u.create();s.prototype.computeGq=function(){var t=this.G,e=this.bodyA,i=this.bodyB,e=(e.position,i.position,e.angle),i=i.angle;return this.gmult(t,n,e,r,i)+this.offset},s.prototype.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,n=e.velocity,r=i.velocity,e=e.angularVelocity,i=i.angularVelocity;return this.gmult(t,n,e,r,i)+this.relativeVelocity},s.prototype.computeGWlambda=function(){var t=this.G,e=this.bodyA,i=this.bodyB,n=e.vlambda,r=i.vlambda,e=e.wlambda,i=i.wlambda;return this.gmult(t,n,e,r,i)};var c=u.create(),d=u.create();s.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,i=t.force,n=t.angularForce,r=e.force,s=e.angularForce,o=t.invMassSolve,a=e.invMassSolve,l=t.invInertiaSolve,p=e.invInertiaSolve,h=this.G;return u.scale(c,i,o),u.multiply(c,t.massMultiplier,c),u.scale(d,r,a),u.multiply(d,e.massMultiplier,d),this.gmult(h,c,n*l,d,s*p)},s.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,i=t.invMassSolve,n=e.invMassSolve,r=t.invInertiaSolve,s=e.invInertiaSolve,o=this.G;return o[0]*o[0]*i*t.massMultiplier[0]+o[1]*o[1]*i*t.massMultiplier[1]+o[2]*o[2]*r+o[3]*o[3]*n*e.massMultiplier[0]+o[4]*o[4]*n*e.massMultiplier[1]+o[5]*o[5]*s};var _=u.create(),y=u.create(),f=u.create();u.create(),u.create(),u.create(),s.prototype.addToWlambda=function(t){var e=this.bodyA,i=this.bodyB,n=_,r=y,s=f,o=e.invMassSolve,a=i.invMassSolve,l=e.invInertiaSolve,p=i.invInertiaSolve,h=this.G;r[0]=h[0],r[1]=h[1],s[0]=h[3],s[1]=h[4],u.scale(n,r,o*t),u.multiply(n,n,e.massMultiplier),u.add(e.vlambda,e.vlambda,n),e.wlambda+=l*h[2]*t,u.scale(n,s,a*t),u.multiply(n,n,i.massMultiplier),u.add(i.vlambda,i.vlambda,n),i.wlambda+=p*h[5]*t},s.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(t,e,i){function n(t,e,i){r.call(this,t,e,-i,i),this.contactPointA=a.create(),this.contactPointB=a.create(),this.t=a.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var a=t("../math/vec2"),r=t("./Equation");t("../utils/Utils"),(((e.exports=n).prototype=new r).constructor=n).prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},n.prototype.getSlipForce=function(){return this.maxForce},n.prototype.computeB=function(t,e,i){var n=(this.bodyA,this.bodyB,this.contactPointA),r=this.contactPointB,s=this.t,o=this.G;return o[0]=-s[0],o[1]=-s[1],o[2]=-a.crossLength(n,s),o[3]=s[0],o[4]=s[1],o[5]=a.crossLength(r,s),-this.computeGW()*e-i*this.computeGiMf()}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0;i=this.G;i[2]=1,i[5]=-1}var r=t("./Equation"),s=t("../math/vec2");((e.exports=n).prototype=new r).constructor=n;var o=s.create(),a=s.create(),l=s.fromValues(1,0),p=s.fromValues(0,1);n.prototype.computeGq=function(){return s.rotate(o,l,this.bodyA.angle+this.angle),s.rotate(a,p,this.bodyB.angle),s.dot(o,a)}},{"../math/vec2":30,"./Equation":22}],25:[function(t,e,i){function n(t,e){r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var r=t("./Equation");t("../math/vec2"),(((e.exports=n).prototype=new r).constructor=n).prototype.computeB=function(t,e,i){var n=this.G;n[2]=-1,n[5]=this.ratio;n=this.computeGiMf();return-this.computeGW()*e-i*n}},{"../math/vec2":30,"./Equation":22}],26:[function(t,e,i){function n(){}(e.exports=n).prototype={constructor:n,on:function(t,e,i){e.context=i||this,void 0===this._listeners&&(this._listeners={});i=this._listeners;return void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;if(e){if(void 0!==i[t]&&-1!==i[t].indexOf(e))return!0}else if(void 0!==i[t])return!0;return!1},off:function(t,e){if(void 0===this._listeners)return this;var i=this._listeners,e=i[t].indexOf(e);return-1!==e&&i[t].splice(e,1),this},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var i=0,n=e.length;i<n;i++){var r=e[i];r.call(r.context,t)}}return this}}},{}],27:[function(t,e,i){function n(t,e,i){if(i=i||{},!(t instanceof r&&e instanceof r))throw new Error("First two arguments must be Material instances.");this.id=n.idCounter++,this.materialA=t,this.materialB=e,this.friction=void 0!==i.friction?Number(i.friction):.3,this.restitution=void 0!==i.restitution?Number(i.restitution):0,this.stiffness=void 0!==i.stiffness?Number(i.stiffness):s.DEFAULT_STIFFNESS,this.relaxation=void 0!==i.relaxation?Number(i.relaxation):s.DEFAULT_RELAXATION,this.frictionStiffness=void 0!==i.frictionStiffness?Number(i.frictionStiffness):s.DEFAULT_STIFFNESS,this.frictionRelaxation=void 0!==i.frictionRelaxation?Number(i.frictionRelaxation):s.DEFAULT_RELAXATION,this.surfaceVelocity=void 0!==i.surfaceVelocity?Number(i.surfaceVelocity):0,this.contactSkinSize=.005}var r=t("./Material"),s=t("../equations/Equation");(e.exports=n).idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(t,e,i){function n(t){this.id=t||n.idCounter++}(e.exports=n).idCounter=0},{}],29:[function(t,e,i){var x={GetArea:function(t){if(t.length<6)return 0;for(var e=t.length-2,i=0,n=0;n<e;n+=2)i+=(t[n+2]-t[n])*(t[n+1]+t[n+3]);return.5*-(i+=(t[0]-t[e])*(t[1+e]+t[1]))},Triangulate:function(t){var e=t.length>>1;if(e<3)return[];for(var i=[],n=[],r=0;r<e;r++)n.push(r);for(var r=0,s=e;3<s;){var o=n[(r+0)%s],a=n[(r+1)%s],l=n[(r+2)%s],p=t[2*o],h=t[2*o+1],u=t[2*a],c=t[2*a+1],d=t[2*l],_=t[2*l+1],y=!1;if(x._convex(p,h,u,c,d,_)){y=!0;for(var f=0;f<s;f++){var m=n[f];if(m!=o&&m!=a&&m!=l&&x._PointInTriangle(t[2*m],t[2*m+1],p,h,u,c,d,_)){y=!1;break}}}if(y)i.push(o,a,l),n.splice((r+1)%s,1),s--,r=0;else if(r++>3*s)break}return i.push(n[0],n[1],n[2]),i},_PointInTriangle:function(t,e,i,n,r,s,o,a){o-=i,a-=n,r-=i,s-=n,t-=i,i=e-n,e=o*o+a*a,n=o*r+a*s,o=o*t+a*i,a=r*r+s*s,s=r*t+s*i,i=1/(e*a-n*n),a=(a*o-n*s)*i,i*=e*s-n*o;return 0<=a&&0<=i&&a+i<1},_convex:function(t,e,i,n,r,s){return 0<=(e-n)*(r-i)+(i-t)*(s-n)}};e.exports=x},{}],30:[function(t,e,i){var s=e.exports={},n=t("../utils/Utils");s.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},s.crossVZ=function(t,e,i){return s.rotate(t,e,-Math.PI/2),s.scale(t,t,i),t},s.crossZV=function(t,e,i){return s.rotate(t,i,Math.PI/2),s.scale(t,t,e),t},s.rotate=function(t,e,i){var n,r,s;0!==i?(n=Math.cos(i),r=Math.sin(i),s=e[0],i=e[1],t[0]=n*s-r*i,t[1]=r*s+n*i):(t[0]=e[0],t[1]=e[1])},s.rotate90cw=function(t,e){var i=e[0],e=e[1];t[0]=e,t[1]=-i},s.toLocalFrame=function(t,e,i,n){s.copy(t,e),s.sub(t,t,i),s.rotate(t,t,-n)},s.toGlobalFrame=function(t,e,i,n){s.copy(t,e),s.rotate(t,t,n),s.add(t,t,i)},s.vectorToLocalFrame=function(t,e,i){s.rotate(t,e,-i)},s.vectorToGlobalFrame=function(t,e,i){s.rotate(t,e,i)},s.centroid=function(t,e,i,n){return s.add(t,e,i),s.add(t,t,n),s.scale(t,t,1/3),t},s.create=function(){var t=new n.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},s.clone=function(t){var e=new n.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},s.fromValues=function(t,e){var i=new n.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},s.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},s.set=function(t,e,i){return t[0]=e,t[1]=i,t},s.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},s.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},s.sub=s.subtract,s.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},s.mul=s.multiply,s.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},s.div=s.divide,s.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},s.distance=function(t,e){var i=e[0]-t[0],t=e[1]-t[1];return Math.sqrt(i*i+t*t)},s.dist=s.distance,s.squaredDistance=function(t,e){var i=e[0]-t[0],t=e[1]-t[1];return i*i+t*t},s.sqrDist=s.squaredDistance,s.length=function(t){var e=t[0],t=t[1];return Math.sqrt(e*e+t*t)},s.len=s.length,s.squaredLength=function(t){var e=t[0],t=t[1];return e*e+t*t},s.sqrLen=s.squaredLength,s.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},s.normalize=function(t,e){var i=e[0],n=e[1],n=i*i+n*n;return 0<n&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},s.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},s.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},s.lerp=function(t,e,i,n){var r=e[0],e=e[1];return t[0]=r+n*(i[0]-r),t[1]=e+n*(i[1]-e),t},s.reflect=function(t,e,i){var n=e[0]*i[0]+e[1]*i[1];t[0]=e[0]-2*i[0]*n,t[1]=e[1]-2*i[1]*n},s.getLineSegmentsIntersection=function(t,e,i,n,r){r=s.getLineSegmentsIntersectionFraction(e,i,n,r);return!(r<0||(t[0]=e[0]+r*(i[0]-e[0]),t[1]=e[1]+r*(i[1]-e[1]),0))},s.getLineSegmentsIntersectionFraction=function(t,e,i,n){var r=e[0]-t[0],s=e[1]-t[1],o=n[0]-i[0],e=n[1]-i[1],n=(-s*(t[0]-i[0])+r*(t[1]-i[1]))/(-o*s+r*e),e=(o*(t[1]-i[1])-e*(t[0]-i[0]))/(-o*s+r*e);return 0<=n&&n<=1&&0<=e&&e<=1?e:-1}},{"../utils/Utils":57}],31:[function(t,e,i){function a(t){t=t||{},o.call(this),this.id=t.id||++a._idCounter,this.world=null,this.shapes=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation,this.fixedX=!!t.fixedX,this.fixedY=!!t.fixedY,this.massMultiplier=u.create(),this.position=u.fromValues(0,0),t.position&&u.copy(this.position,t.position),this.interpolatedPosition=u.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=u.fromValues(0,0),this.previousAngle=0,this.velocity=u.fromValues(0,0),t.velocity&&u.copy(this.velocity,t.velocity),this.vlambda=u.fromValues(0,0),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=u.create(),t.force&&u.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.damping="number"==typeof t.damping?t.damping:.1,this.angularDamping="number"==typeof t.angularDamping?t.angularDamping:.1,this.type=a.STATIC,void 0!==t.type?this.type=t.type:t.mass?this.type=a.DYNAMIC:this.type=a.STATIC,this.boundingRadius=0,this.aabb=new s,this.aabbNeedsUpdate=!0,this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.wantsToSleep=!1,this.sleepState=a.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.gravityScale=void 0!==t.gravityScale?t.gravityScale:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==t.ccdSpeedThreshold?t.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==t.ccdIterations?t.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var u=t("../math/vec2"),p=t("poly-decomp"),h=t("../shapes/Convex"),n=t("../collision/RaycastResult"),r=t("../collision/Ray"),s=t("../collision/AABB"),o=t("../events/EventEmitter");(e.exports=a).prototype=new o,(a.prototype.constructor=a)._idCounter=0,a.prototype.updateSolveMassProperties=function(){this.sleepState===a.SLEEPING||this.type===a.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},a.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},a.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},a.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var l=new s,c=u.create();a.prototype.updateAABB=function(){for(var t=this.shapes,e=t.length,i=c,n=this.angle,r=0;r!==e;r++){var s=t[r],o=s.angle+n;u.rotate(i,s.position,n),u.add(i,i,this.position),s.computeAABB(l,i,o),0===r?this.aabb.copy(l):this.aabb.extend(l)}this.aabbNeedsUpdate=!1},a.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=t.length,i=0,n=0;n!==e;n++){var r=t[n],s=u.length(r.position),r=r.boundingRadius;i<s+r&&(i=s+r)}this.boundingRadius=i},a.prototype.addShape=function(t,e,i){if(t.body)throw new Error("A shape can only be added to one body.");t.body=this,e?u.copy(t.position,e):u.set(t.position,0,0),t.angle=i||0,this.shapes.push(t),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},a.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);return-1!==e&&(this.shapes.splice(e,1),this.aabbNeedsUpdate=!0,!(t.body=null))},a.prototype.updateMassProperties=function(){if(this.type===a.STATIC||this.type===a.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,i=this.mass/e,n=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var r=0;r<e;r++){var s=t[r],o=u.squaredLength(s.position);n+=s.computeMomentOfInertia(i)+i*o}this.inertia=n,this.invInertia=0<n?1/n:0}this.invMass=1/this.mass,u.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}},u.create(),a.prototype.applyForce=function(t,e){u.add(this.force,this.force,t),e&&(t=u.crossLength(e,t),this.angularForce+=t)};var d=u.create(),_=u.create(),y=u.create();a.prototype.applyForceLocal=function(t,e){e=e||y;var i=d,n=_;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(n,e),this.applyForce(i,n)};var f=u.create();a.prototype.applyImpulse=function(t,e){var i;this.type===a.DYNAMIC&&(i=f,u.scale(i,t,this.invMass),u.multiply(i,this.massMultiplier,i),u.add(this.velocity,i,this.velocity),e&&(t=u.crossLength(e,t),t*=this.invInertia,this.angularVelocity+=t))};var m=u.create(),x=u.create(),v=u.create();a.prototype.applyImpulseLocal=function(t,e){e=e||v;var i=m,n=x;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(n,e),this.applyImpulse(i,n)},a.prototype.toLocalFrame=function(t,e){u.toLocalFrame(t,e,this.position,this.angle)},a.prototype.toWorldFrame=function(t,e){u.toGlobalFrame(t,e,this.position,this.angle)},a.prototype.vectorToLocalFrame=function(t,e){u.vectorToLocalFrame(t,e,this.angle)},a.prototype.vectorToWorldFrame=function(t,e){u.vectorToGlobalFrame(t,e,this.angle)},a.prototype.fromPolygon=function(t,e){e=e||{};for(var i=this.shapes.length;0<=i;--i)this.removeShape(this.shapes[i]);var n=new p.Polygon;if(n.vertices=t,n.makeCCW(),"number"==typeof e.removeCollinearPoints&&n.removeCollinearPoints(e.removeCollinearPoints),void 0===e.skipSimpleCheck&&!n.isSimple())return!1;this.concavePath=n.vertices.slice(0);for(var r,i=0;i<this.concavePath.length;i++){var s=[0,0];u.copy(s,this.concavePath[i]),this.concavePath[i]=s}r=e.optimalDecomp?n.decomp():n.quickDecomp();for(var o=u.create(),i=0;i!==r.length;i++){for(var a=new h({vertices:r[i].vertices}),l=0;l!==a.vertices.length;l++){s=a.vertices[l];u.sub(s,s,a.centerOfMass)}u.scale(o,a.centerOfMass,1),a.updateTriangles(),a.updateCenterOfMass(),a.updateBoundingRadius(),this.addShape(a,o)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0};var g=(u.fromValues(0,0),u.fromValues(0,0)),b=u.fromValues(0,0),z=u.fromValues(0,0);a.prototype.adjustCenterOfMass=function(){var t=g,e=b,i=z,n=0;u.set(e,0,0);for(var r=0;r!==this.shapes.length;r++){var s=this.shapes[r];u.scale(t,s.position,s.area),u.add(e,e,t),n+=s.area}u.scale(i,e,1/n);for(r=0;r!==this.shapes.length;r++){s=this.shapes[r];u.sub(s.position,s.position,i)}u.add(this.position,this.position,i);for(r=0;this.concavePath&&r<this.concavePath.length;r++)u.sub(this.concavePath[r],this.concavePath[r],i);this.updateMassProperties(),this.updateBoundingRadius()},a.prototype.setZeroForce=function(){u.set(this.force,0,0),this.angularForce=0},a.prototype.resetConstraintVelocity=function(){var t=this.vlambda;u.set(t,0,0),this.wlambda=0},a.prototype.addConstraintVelocity=function(){var t=this.velocity;u.add(t,t,this.vlambda),this.angularVelocity+=this.wlambda},a.prototype.applyDamping=function(t){var e;this.type===a.DYNAMIC&&(e=this.velocity,u.scale(e,e,Math.pow(1-this.damping,t)),this.angularVelocity*=Math.pow(1-this.angularDamping,t))},a.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=a.AWAKE,this.idleTime=0,t!==a.AWAKE&&this.emit(a.wakeUpEvent)},a.prototype.sleep=function(){this.sleepState=a.SLEEPING,this.angularVelocity=0,this.angularForce=0,u.set(this.velocity,0,0),u.set(this.force,0,0),this.emit(a.sleepEvent)},a.prototype.sleepTick=function(t,e,i){var n;this.allowSleep&&this.type!==a.SLEEPING&&(this.wantsToSleep=!1,this.sleepState,n=u.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2),Math.pow(this.sleepSpeedLimit,2)<=n?(this.idleTime=0,this.sleepState=a.AWAKE):(this.idleTime+=i,this.sleepState=a.SLEEPY),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep()))},a.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var w=u.create(),C=u.create();a.prototype.integrate=function(t){var e=this.invMass,i=this.force,n=this.position,r=this.velocity;u.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*t),u.scale(w,i,t*e),u.multiply(w,this.massMultiplier,w),u.add(r,w,r),this.integrateToTimeOfImpact(t)||(u.scale(C,r,t),u.add(n,n,C),this.fixedRotation||(this.angle+=this.angularVelocity*t)),this.aabbNeedsUpdate=!0};var P=new n,T=new r({mode:r.ALL}),S=u.create(),M=u.create(),A=u.create(),O=u.create();a.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||u.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;u.normalize(S,this.velocity),u.scale(M,this.velocity,t),u.add(M,M,this.position),u.sub(A,M,this.position);var e,i=this.angularVelocity*t,n=u.length(A),r=1,s=this;if(P.reset(),T.callback=function(t){t.body!==s&&(e=t.body,t.getHitPoint(M,T),u.sub(A,M,s.position),r=u.length(A)/n,t.stop())},u.copy(T.from,this.position),u.copy(T.to,M),T.update(),this.world.raycast(P,T),!e)return!1;var o=this.angle;u.copy(O,this.position);for(var a=0,l=0,p=0,h=r;l<=h&&a<this.ccdIterations;)a++,p=(h-l)/2,u.scale(C,A,r),u.add(this.position,O,C),this.angle=o+i*r,this.updateAABB(),this.aabb.overlaps(e.aabb)&&this.world.narrowphase.bodiesOverlap(this,e)?l=p:h=p;return r=p,u.copy(this.position,O),this.angle=o,u.scale(C,A,r),u.add(this.position,this.position,C),this.fixedRotation||(this.angle+=i*r),!0},a.prototype.getVelocityAtPoint=function(t,e){return u.crossVZ(t,e,this.angularVelocity),u.subtract(t,this.velocity,t),t},a.sleepyEvent={type:"sleepy"},a.sleepEvent={type:"sleep"},a.wakeUpEvent={type:"wakeup"},a.DYNAMIC=1,a.STATIC=2,a.KINEMATIC=4,a.AWAKE=0,a.SLEEPY=1,a.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,i),this.localAnchorA=_.fromValues(0,0),this.localAnchorB=_.fromValues(0,0),i.localAnchorA&&_.copy(this.localAnchorA,i.localAnchorA),i.localAnchorB&&_.copy(this.localAnchorB,i.localAnchorB),i.worldAnchorA&&this.setWorldAnchorA(i.worldAnchorA),i.worldAnchorB&&this.setWorldAnchorB(i.worldAnchorB);t=_.create(),e=_.create();this.getWorldAnchorA(t),this.getWorldAnchorB(e);e=_.distance(t,e);this.restLength="number"==typeof i.restLength?i.restLength:e}var _=t("../math/vec2"),r=t("./Spring");t("../utils/Utils"),(((e.exports=n).prototype=new r).constructor=n).prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},n.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},n.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},n.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var y=_.create(),f=_.create(),m=_.create(),x=_.create(),v=_.create(),g=_.create(),b=_.create(),z=_.create(),w=_.create();n.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restLength,n=this.bodyA,r=this.bodyB,s=y,o=f,a=m,l=x,p=w,h=v,u=g,c=b,d=z;this.getWorldAnchorA(h),this.getWorldAnchorB(u),_.sub(c,h,n.position),_.sub(d,u,r.position),_.sub(s,u,h);h=_.len(s);_.normalize(o,s),_.sub(a,r.velocity,n.velocity),_.crossZV(p,r.angularVelocity,d),_.add(a,a,p),_.crossZV(p,n.angularVelocity,c),_.sub(a,a,p),_.scale(l,o,-t*(h-i)-e*_.dot(a,o)),_.sub(n.force,n.force,l),_.add(r.force,r.force,l);c=_.crossLength(c,l),l=_.crossLength(d,l);n.angularForce-=c,r.angularForce+=l}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,i),this.restAngle="number"==typeof i.restAngle?i.restAngle:e.angle-t.angle}var r=(t("../math/vec2"),t("./Spring"));(((e.exports=n).prototype=new r).constructor=n).prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restAngle,n=this.bodyA,r=this.bodyB,e=-t*(r.angle-n.angle-i)-e*(r.angularVelocity-n.angularVelocity)*0;n.angularForce-=e,r.angularForce+=e}},{"../math/vec2":30,"./Spring":34}],34:[function(t,e,i){function n(t,e,i){i=r.defaults(i,{stiffness:100,damping:1}),this.stiffness=i.stiffness,this.damping=i.damping,this.bodyA=t,this.bodyB=e}var r=(t("../math/vec2"),t("../utils/Utils"));(e.exports=n).prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(t,e,i){function n(t,e){this.chassisBody=t,this.wheels=[],this.groundBody=new l({mass:0}),this.world=null;var i=this;this.preStepCallback=function(){i.update()}}function r(t,e){e=e||{},this.vehicle=t,this.forwardEquation=new a(t.chassisBody,t.groundBody),this.sideEquation=new a(t.chassisBody,t.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==e.sideFriction?e.sideFriction:5),this.localForwardVector=s.fromValues(0,1),e.localForwardVector&&s.copy(this.localForwardVector,e.localForwardVector),this.localPosition=s.fromValues(0,0),e.localPosition&&s.copy(this.localPosition,e.localPosition),o.apply(this,t.chassisBody,t.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}var s=t("../math/vec2"),o=(t("../utils/Utils"),t("../constraints/Constraint")),a=t("../equations/FrictionEquation"),l=t("../objects/Body");(e.exports=n).prototype.addToWorld=function(t){(this.world=t).addBody(this.groundBody),t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.addConstraint(i)}},n.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody),t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.removeConstraint(i)}this.world=null},n.prototype.addWheel=function(t){t=new r(this,t);return this.wheels.push(t),t},n.prototype.update=function(){for(var t=0;t<this.wheels.length;t++)this.wheels[t].update()},(r.prototype=new o).setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)},r.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var p=s.create(),h=s.create();r.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(h,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(p,h),s.dot(p,h)};var u=s.create();r.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),s.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),s.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),s.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),s.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),s.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),s.normalize(u,this.forwardEquation.t),s.scale(u,u,this.engineForce),this.vehicle.chassisBody.applyForce(u,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(t,e,i){t=e.exports={AABB:t("./collision/AABB"),AngleLockEquation:t("./equations/AngleLockEquation"),Body:t("./objects/Body"),Broadphase:t("./collision/Broadphase"),Capsule:t("./shapes/Capsule"),Circle:t("./shapes/Circle"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),ContactEquationPool:t("./utils/ContactEquationPool"),ContactMaterial:t("./material/ContactMaterial"),Convex:t("./shapes/Convex"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventEmitter:t("./events/EventEmitter"),FrictionEquation:t("./equations/FrictionEquation"),FrictionEquationPool:t("./utils/FrictionEquationPool"),GearConstraint:t("./constraints/GearConstraint"),GSSolver:t("./solver/GSSolver"),Heightfield:t("./shapes/Heightfield"),Line:t("./shapes/Line"),LockConstraint:t("./constraints/LockConstraint"),Material:t("./material/Material"),Narrowphase:t("./collision/Narrowphase"),NaiveBroadphase:t("./collision/NaiveBroadphase"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),Pool:t("./utils/Pool"),RevoluteConstraint:t("./constraints/RevoluteConstraint"),PrismaticConstraint:t("./constraints/PrismaticConstraint"),Ray:t("./collision/Ray"),RaycastResult:t("./collision/RaycastResult"),Box:t("./shapes/Box"),RotationalVelocityEquation:t("./equations/RotationalVelocityEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Spring:t("./objects/Spring"),TopDownVehicle:t("./objects/TopDownVehicle"),LinearSpring:t("./objects/LinearSpring"),RotationalSpring:t("./objects/RotationalSpring"),Utils:t("./utils/Utils"),World:t("./world/World"),vec2:t("./math/vec2"),version:t("../package.json").version};Object.defineProperty(t,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(t,e,i){function n(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")),t=t||{};var e=this.width=t.width||1,i=this.height=t.height||1,e=[r.fromValues(-e/2,-i/2),r.fromValues(e/2,-i/2),r.fromValues(e/2,i/2),r.fromValues(-e/2,i/2)],i=[r.fromValues(1,0),r.fromValues(0,1)];t.vertices=e,t.axes=i,t.type=s.BOX,o.call(this,t)}var r=t("../math/vec2"),s=t("./Shape"),o=t("./Convex");(((e.exports=n).prototype=new o).constructor=n).prototype.computeMomentOfInertia=function(t){var e=this.width,i=this.height;return t*(i*i+e*e)/12},n.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2},r.create(),r.create(),r.create(),r.create(),n.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)},n.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(t,e,i){function n(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),t=t||{},this.length=t.length||1,this.radius=t.radius||1,t.type=r.CAPSULE,r.call(this,t)}var r=t("./Shape"),v=t("../math/vec2");(((e.exports=n).prototype=new r).constructor=n).prototype.computeMomentOfInertia=function(t){var e=this.radius,i=this.length+e,e=2*e;return t*(e*e+i*i)/12},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},n.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var s=v.create();n.prototype.computeAABB=function(t,e,i){var n=this.radius;v.set(s,this.length/2,0),0!==i&&v.rotate(s,s,i),v.set(t.upperBound,Math.max(s[0]+n,-s[0]+n),Math.max(s[1]+n,-s[1]+n)),v.set(t.lowerBound,Math.min(s[0]-n,-s[0]-n),Math.min(s[1]-n,-s[1]-n)),v.add(t.lowerBound,t.lowerBound,e),v.add(t.upperBound,t.upperBound,e)};var g=v.create(),b=v.create(),z=v.create(),w=v.create(),C=v.fromValues(0,1);n.prototype.raycast=function(t,e,i,n){for(var r=e.from,s=e.to,o=(e.direction,g),a=b,l=z,p=w,h=this.length/2,u=0;u<2;u++){var c=this.radius*(2*u-1);if(v.set(l,-h,c),v.set(p,h,c),v.toGlobalFrame(l,l,i,n),v.toGlobalFrame(p,p,i,n),0<=(_=v.getLineSegmentsIntersectionFraction(r,s,l,p))&&(v.rotate(a,C,n),v.scale(a,a,2*u-1),e.reportIntersection(t,_,a,-1),t.shouldStop(e)))return}for(var d=Math.pow(this.radius,2)+Math.pow(h,2),u=0;u<2;u++){v.set(l,h*(2*u-1),0),v.toGlobalFrame(l,l,i,n);var _,y=Math.pow(s[0]-r[0],2)+Math.pow(s[1]-r[1],2),f=2*((s[0]-r[0])*(r[0]-l[0])+(s[1]-r[1])*(r[1]-l[1])),m=Math.pow(r[0]-l[0],2)+Math.pow(r[1]-l[1],2)-Math.pow(this.radius,2);if(!((_=Math.pow(f,2)-4*y*m)<0))if(0===_){if(v.lerp(o,r,s,_),v.squaredDistance(o,i)>d&&(v.sub(a,o,l),v.normalize(a,a),e.reportIntersection(t,_,a,-1),t.shouldStop(e)))return}else{var x=Math.sqrt(_),m=1/(2*y),y=(-f-x)*m,m=(-f+x)*m;if(0<=y&&y<=1&&(v.lerp(o,r,s,y),v.squaredDistance(o,i)>d&&(v.sub(a,o,l),v.normalize(a,a),e.reportIntersection(t,y,a,-1),t.shouldStop(e))))return;if(0<=m&&m<=1&&(v.lerp(o,r,s,m),v.squaredDistance(o,i)>d&&(v.sub(a,o,l),v.normalize(a,a),e.reportIntersection(t,m,a,-1),t.shouldStop(e))))return}}}},{"../math/vec2":30,"./Shape":45}],39:[function(t,e,i){function n(t){"number"==typeof arguments[0]&&(t={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),t=t||{},this.radius=t.radius||1,t.type=r.CIRCLE,r.call(this,t)}var r=t("./Shape"),c=t("../math/vec2");(((e.exports=n).prototype=new r).constructor=n).prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},n.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},n.prototype.computeAABB=function(t,e,i){var n=this.radius;c.set(t.upperBound,n,n),c.set(t.lowerBound,-n,-n),e&&(c.add(t.lowerBound,t.lowerBound,e),c.add(t.upperBound,t.upperBound,e))};var d=c.create(),_=c.create();n.prototype.raycast=function(t,e,i,n){var r=e.from,s=e.to,o=this.radius,a=Math.pow(s[0]-r[0],2)+Math.pow(s[1]-r[1],2),l=2*((s[0]-r[0])*(r[0]-i[0])+(s[1]-r[1])*(r[1]-i[1])),p=Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2)-Math.pow(o,2),h=Math.pow(l,2)-4*a*p,u=d,o=_;h<0||(0==h?(c.lerp(u,r,s,h),c.sub(o,u,i),c.normalize(o,o),e.reportIntersection(t,h,o,-1)):(a=(-l+(p=Math.sqrt(h)))*(h=1/(2*a)),0<=(h=(-l-p)*h)&&h<=1&&(c.lerp(u,r,s,h),c.sub(o,u,i),c.normalize(o,o),e.reportIntersection(t,h,o,-1),t.shouldStop(e))||0<=a&&a<=1&&(c.lerp(u,r,s,a),c.sub(o,u,i),c.normalize(o,o),e.reportIntersection(t,a,o,-1))))}},{"../math/vec2":30,"./Shape":45}],40:[function(t,e,i){function u(t){Array.isArray(arguments[0])&&(t={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),t=t||{},this.vertices=[];for(var e=void 0!==t.vertices?t.vertices:[],i=0;i<e.length;i++){var n=d.create();d.copy(n,e[i]),this.vertices.push(n)}if(this.axes=[],t.axes)for(i=0;i<t.axes.length;i++){var r=d.create();d.copy(r,t.axes[i]),this.axes.push(r)}else for(i=0;i<this.vertices.length;i++){var s=this.vertices[i],o=this.vertices[(i+1)%this.vertices.length],a=d.create();d.sub(a,o,s),d.rotate90cw(a,a),d.normalize(a,a),this.axes.push(a)}if(this.centerOfMass=d.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,t.type=l.CONVEX,l.call(this,t),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var l=t("./Shape"),d=t("../math/vec2"),a=t("../math/polyk");t("poly-decomp"),((e.exports=u).prototype=new l).constructor=u;var p=d.create(),s=d.create();u.prototype.projectOntoLocalAxis=function(t,e){for(var i,n,r=null,s=null,t=p,o=0;o<this.vertices.length;o++)i=this.vertices[o],i=d.dot(i,t),(null===r||r<i)&&(r=i),(null===s||i<s)&&(s=i);r<s&&(n=s,s=r,r=n),d.set(e,s,r)},u.prototype.projectOntoWorldAxis=function(t,e,i,n){var r=s;this.projectOntoLocalAxis(t,n),0!==i?d.rotate(r,t,i):r=t;r=d.dot(e,r);d.set(n,n[0]+r,n[1]+r)},u.prototype.updateTriangles=function(){for(var t=[],e=this.triangles.length=0;e<this.vertices.length;e++){var i=this.vertices[e];t.push(i[0],i[1])}for(var n=a.Triangulate(t),e=0;e<n.length;e+=3){var r=n[e],s=n[e+1],o=n[e+2];this.triangles.push([r,s,o])}};var c=d.create(),_=d.create();d.create(),d.create(),d.create();d.create(),d.create(),d.create(),d.create(),u.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,i=this.centerOfMass,n=c,r=_;d.set(i,0,0);for(var s=0,o=0;o!==t.length;o++){var a=t[o],l=e[a[0]],p=e[a[1]],h=e[a[2]];d.centroid(n,l,p,h);a=u.triangleArea(l,p,h);s+=a,d.scale(r,n,a),d.add(i,i,r)}d.scale(i,i,1/s)},u.prototype.computeMomentOfInertia=function(t){for(var e=0,i=0,n=this.vertices.length,r=n-1,s=0;s<n;r=s,s++){var o=this.vertices[r],a=this.vertices[s],l=Math.abs(d.crossLength(o,a));e+=l*(d.dot(a,a)+d.dot(a,o)+d.dot(o,o)),i+=l}return t/6*(e/i)},u.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,i=0;i!==t.length;i++){var n=d.squaredLength(t[i]);e<n&&(e=n)}this.boundingRadius=Math.sqrt(e)},u.triangleArea=function(t,e,i){return.5*((e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1]))},u.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,i=0;i!==t.length;i++){var n=t[i],r=e[n[0]],s=e[n[1]],n=e[n[2]],n=u.triangleArea(r,s,n);this.area+=n}},u.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)};var y=d.create(),f=d.create(),m=d.create();u.prototype.raycast=function(t,e,i,n){var r=y,s=f,o=m,a=this.vertices;d.toLocalFrame(r,e.from,i,n),d.toLocalFrame(s,e.to,i,n);for(var l=a.length,p=0;p<l&&!t.shouldStop(e);p++){var h=a[p],u=a[(p+1)%l],c=d.getLineSegmentsIntersectionFraction(r,s,h,u);0<=c&&(d.sub(o,u,h),d.rotate(o,o,-Math.PI/2+n),d.normalize(o,o),e.reportIntersection(t,c,o,p))}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(t,e,i){function n(t){if(Array.isArray(arguments[0])){if(t={heights:arguments[0]},"object"==typeof arguments[1])for(var e in arguments[1])t[e]=arguments[1][e];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}t=t||{},this.heights=t.heights?t.heights.slice(0):[],this.maxValue=t.maxValue||null,this.minValue=t.minValue||null,this.elementWidth=t.elementWidth||.1,void 0!==t.maxValue&&void 0!==t.minValue||this.updateMaxMinValues(),t.type=r.HEIGHTFIELD,r.call(this,t)}var r=t("./Shape"),d=t("../math/vec2");t("../utils/Utils"),(((e.exports=n).prototype=new r).constructor=n).prototype.updateMaxMinValues=function(){for(var t=this.heights,e=t[0],i=t[0],n=0;n!==t.length;n++){var r=t[n];e<r&&(e=r),r<i&&(i=r)}this.maxValue=e,this.minValue=i},n.prototype.computeMomentOfInertia=function(t){return Number.MAX_VALUE},n.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},n.prototype.updateArea=function(){for(var t=this.heights,e=0,i=0;i<t.length-1;i++)e+=(t[i]+t[i+1])/2*this.elementWidth;this.area=e};var s=[d.create(),d.create(),d.create(),d.create()];n.prototype.computeAABB=function(t,e,i){d.set(s[0],0,this.maxValue),d.set(s[1],this.elementWidth*this.heights.length,this.maxValue),d.set(s[2],this.elementWidth*this.heights.length,this.minValue),d.set(s[3],0,this.minValue),t.setFromPoints(s,e,i)},n.prototype.getLineSegment=function(t,e,i){var n=this.heights,r=this.elementWidth;d.set(t,i*r,n[i]),d.set(e,(i+1)*r,n[i+1])},n.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)},n.prototype.getClampedSegmentIndex=function(t){t=this.getSegmentIndex(t);return Math.min(this.heights.length,Math.max(t,0))};var _=(d.create(),d.create()),y=d.create(),f=d.create(),m=d.create(),x=d.create();d.fromValues(0,1),n.prototype.raycast=function(t,e,i,n){var r=e.from,s=e.to,o=(e.direction,_),a=y,l=f,p=m,h=x;d.toLocalFrame(p,r,i,n),d.toLocalFrame(h,s,i,n);r=this.getClampedSegmentIndex(p),s=this.getClampedSegmentIndex(h);s<r&&(i=r,r=s,s=i);for(var u=0;u<this.heights.length-1;u++){this.getLineSegment(a,l,u);var c=d.getLineSegmentsIntersectionFraction(p,h,a,l);if(0<=c&&(d.sub(o,l,a),d.rotate(o,o,n+Math.PI/2),d.normalize(o,o),e.reportIntersection(t,c,o,-1),t.shouldStop(e)))return}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(t,e,i){function n(t){"number"==typeof arguments[0]&&(t={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),t=t||{},this.length=t.length||1,t.type=r.LINE,r.call(this,t)}var r=t("./Shape"),p=t("../math/vec2");(((e.exports=n).prototype=new r).constructor=n).prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var s=[p.create(),p.create()];n.prototype.computeAABB=function(t,e,i){var n=this.length/2;p.set(s[0],-n,0),p.set(s[1],n,0),t.setFromPoints(s,e,i,0)};var h=(p.create(),p.create()),u=p.create(),c=p.create(),d=p.fromValues(0,1);n.prototype.raycast=function(t,e,i,n){var r=e.from,s=e.to,o=u,a=c,l=this.length/2;p.set(o,-l,0),p.set(a,l,0),p.toGlobalFrame(o,o,i,n),p.toGlobalFrame(a,a,i,n);r=p.getLineSegmentsIntersectionFraction(o,a,r,s);0<=r&&(s=h,p.rotate(s,d,n),e.reportIntersection(t,r,s,-1))}},{"../math/vec2":30,"./Shape":45}],43:[function(t,e,i){function n(t){(t=t||{}).type=r.PARTICLE,r.call(this,t)}var r=t("./Shape"),s=t("../math/vec2");(((e.exports=n).prototype=new r).constructor=n).prototype.computeMomentOfInertia=function(t){return 0},n.prototype.updateBoundingRadius=function(){this.boundingRadius=0},n.prototype.computeAABB=function(t,e,i){s.copy(t.lowerBound,e),s.copy(t.upperBound,e)}},{"../math/vec2":30,"./Shape":45}],44:[function(t,e,i){function n(t){(t=t||{}).type=r.PLANE,r.call(this,t)}var r=t("./Shape"),h=t("../math/vec2");t("../utils/Utils"),(((e.exports=n).prototype=new r).constructor=n).prototype.computeMomentOfInertia=function(t){return 0},n.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},n.prototype.computeAABB=function(t,e,i){var n=i%(2*Math.PI),r=h.set,s=Number.MAX_VALUE,i=t.lowerBound,t=t.upperBound;0==n?(r(i,-s,-s),r(t,s,0)):n==Math.PI/2?(r(i,0,-s),r(t,s,s)):n===Math.PI?(r(i,-s,0),r(t,s,s)):n==3*Math.PI/2?(r(i,-s,-s),r(t,0,s)):(r(i,-s,-s),r(t,s,s)),h.add(i,i,e),h.add(t,t,e)},n.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var u=h.create(),c=(h.create(),h.create(),h.create()),d=h.create();n.prototype.raycast=function(t,e,i,n){var r=e.from,s=e.to,o=e.direction,a=u,l=c,p=d;h.set(l,0,1),h.rotate(l,l,n),h.sub(p,r,i);n=h.dot(p,l);h.sub(p,s,i),0<n*h.dot(p,l)||h.squaredDistance(r,s)<n*n||(o=h.dot(l,o),h.sub(a,r,i),o=-h.dot(l,a)/o/e.length,e.reportIntersection(t,o,l,-1))}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(t,e,i){function n(t){t=t||{},this.body=null,this.position=r.fromValues(0,0),t.position&&r.copy(this.position,t.position),this.angle=t.angle||0,this.type=t.type||0,this.id=n.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:1,this.material=t.material||null,this.area=0,this.sensor=void 0!==t.sensor&&t.sensor,this.type&&this.updateBoundingRadius(),this.updateArea()}e.exports=n;var r=t("../math/vec2");n.idCounter=0,n.CIRCLE=1,n.PARTICLE=2,n.PLANE=4,n.CONVEX=8,n.LINE=16,n.BOX=32,Object.defineProperty(n,"RECTANGLE",{get:function(){return console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead."),n.BOX}}),n.CAPSULE=64,n.HEIGHTFIELD=128,n.prototype.computeMomentOfInertia=function(t){},n.prototype.updateBoundingRadius=function(){},n.prototype.updateArea=function(){},n.prototype.computeAABB=function(t,e,i){},n.prototype.raycast=function(t,e,i,n){}},{"../math/vec2":30}],46:[function(t,e,i){function z(t){n.call(this,t,n.GS),t=t||{},this.iterations=t.iterations||10,this.tolerance=t.tolerance||1e-7,this.arrayStep=30,this.lambda=new C.ARRAY_TYPE(this.arrayStep),this.Bs=new C.ARRAY_TYPE(this.arrayStep),this.invCs=new C.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=0,this.usedIterations=0}var w=t("../math/vec2"),n=t("./Solver"),C=t("../utils/Utils"),P=t("../equations/FrictionEquation");(((e.exports=z).prototype=new n).constructor=z).prototype.solve=function(t,e){this.sortEquations();var i=0,n=this.iterations,r=this.frictionIterations,s=this.equations,o=s.length,a=Math.pow(this.tolerance*o,2),l=e.bodies,p=e.bodies.length,h=(w.add,w.set,this.useZeroRHS),u=this.lambda;if(this.usedIterations=0,o)for(var c=0;c!==p;c++)l[c].updateSolveMassProperties();u.length<o&&(u=this.lambda=new C.ARRAY_TYPE(o+this.arrayStep),this.Bs=new C.ARRAY_TYPE(o+this.arrayStep),this.invCs=new C.ARRAY_TYPE(o+this.arrayStep)),function(t){for(var e=t.length;e--;)t[e]=0}(u);for(var d,_,y,f=this.invCs,m=this.Bs,u=this.lambda,c=0;c!==s.length;c++)(d=s[c]).timeStep===t&&!d.needsUpdate||(d.timeStep=t,d.update()),m[c]=d.computeB(d.a,d.b,t),f[c]=d.computeInvC(d.epsilon);if(0!==o){for(c=0;c!==p;c++)l[c].resetConstraintVelocity();if(r){for(i=0;i!==r;i++){for(y=_=0;y!==o;y++){d=s[y];var x=z.iterateEquation(y,d,d.epsilon,m,f,u,h,t,i);_+=Math.abs(x)}if(this.usedIterations++,_*_<=a)break}for(z.updateMultipliers(s,u,1/t),y=0;y!==o;y++){var v=s[y];if(v instanceof P){for(var g=0,b=0;b!==v.contactEquations.length;b++)g+=v.contactEquations[b].multiplier;g*=v.frictionCoefficient/v.contactEquations.length,v.maxForce=g,v.minForce=-g}}}for(i=0;i!==n;i++){for(y=_=0;y!==o;y++){d=s[y];x=z.iterateEquation(y,d,d.epsilon,m,f,u,h,t,i);_+=Math.abs(x)}if(this.usedIterations++,_*_<=a)break}for(c=0;c!==p;c++)l[c].addConstraintVelocity();z.updateMultipliers(s,u,1/t)}},z.updateMultipliers=function(t,e,i){for(var n=t.length;n--;)t[n].multiplier=e[n]*i},z.iterateEquation=function(t,e,i,n,r,s,o,a,l){var p=n[t],h=r[t],u=s[t],c=e.computeGWlambda(),n=e.maxForce,r=e.minForce;o&&(p=0);c=h*(p-c-i*u),i=u+c;return i<r*a?c=r*a-u:n*a<i&&(c=n*a-u),s[t]+=c,e.addToWlambda(c),c}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(t,e,i){function n(t,e){t=t||{},r.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}var r=(t("../utils/Utils"),t("../events/EventEmitter"));(((e.exports=n).prototype=new r).constructor=n).prototype.solve=function(t,e){throw new Error("Solver.solve should be implemented by subclasses!")};var s={bodies:[]};n.prototype.solveIsland=function(t,e){this.removeAllEquations(),e.equations.length&&(this.addEquations(e.equations),s.bodies.length=0,e.getBodies(s.bodies),s.bodies.length&&this.solve(t,s))},n.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},n.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},n.prototype.addEquations=function(t){for(var e=0,i=t.length;e!==i;e++){var n=t[e];n.enabled&&this.equations.push(n)}},n.prototype.removeEquation=function(t){t=this.equations.indexOf(t);-1!==t&&this.equations.splice(t,1)},n.prototype.removeAllEquations=function(){this.equations.length=0},n.GS=1,n.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(t,e,i){function n(){s.apply(this,arguments)}var r=t("../equations/ContactEquation"),s=t("./Pool");(((e.exports=n).prototype=new s).constructor=n).prototype.create=function(){return new r},n.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(t,e,i){function n(){s.apply(this,arguments)}var r=t("../equations/FrictionEquation"),s=t("./Pool");(((e.exports=n).prototype=new s).constructor=n).prototype.create=function(){return new r},n.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(t,e,i){function n(){s.apply(this,arguments)}var r=t("../world/IslandNode"),s=t("./Pool");(((e.exports=n).prototype=new s).constructor=n).prototype.create=function(){return new r},n.prototype.destroy=function(t){return t.reset(),this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(t,e,i){function n(){s.apply(this,arguments)}var r=t("../world/Island"),s=t("./Pool");(((e.exports=n).prototype=new s).constructor=n).prototype.create=function(){return new r},n.prototype.destroy=function(t){return t.reset(),this}},{"../world/Island":58,"./Pool":55}],52:[function(t,e,i){function n(){this.overlappingShapesLastState=new r,this.overlappingShapesCurrentState=new r,this.recordPool=new s({size:16}),this.tmpDict=new r,this.tmpArray1=[]}var r=t("./TupleDictionary"),s=(t("./OverlapKeeperRecord"),t("./OverlapKeeperRecordPool"));t("./Utils"),(e.exports=n).prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,i=t.keys.length;i--;){var n=t.keys[i],r=t.getByKey(n);e.getByKey(n),r&&this.recordPool.release(r)}t.reset(),t.copy(e),e.reset()},n.prototype.setOverlapping=function(t,e,i,n){var r,s=(this.overlappingShapesLastState,this.overlappingShapesCurrentState);s.get(e.id,n.id)||((r=this.recordPool.get()).set(t,e,i,n),s.set(e.id,n.id,r))},n.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},n.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},n.prototype.bodiesAreOverlapping=function(t,e){for(var i=this.overlappingShapesCurrentState,n=i.keys.length;n--;){var r=i.keys[n],r=i.data[r];if(r.bodyA===t&&r.bodyB===e||r.bodyA===e&&r.bodyB===t)return!0}return!1},n.prototype.getDiff=function(t,e,i){var n=t,r=e;(i=i||[]).length=0;for(var s=r.keys.length;s--;){var o=r.keys[s],a=r.data[o];if(!a)throw new Error("Key "+o+" had no data!");n.data[o]||i.push(a)}return i},n.prototype.isNewOverlap=function(t,e){var i=0|t.id,n=0|e.id,t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState;return!t.get(i,n)&&!!e.get(i,n)},n.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},n.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},n.prototype.getBodyDiff=function(t,e){e=e||[];for(var i=this.tmpDict,n=t.length;n--;){var r=t[n];i.set(0|r.bodyA.id,0|r.bodyB.id,r)}for(n=i.keys.length;n--;)(r=i.getByKey(i.keys[n]))&&e.push(r.bodyA,r.bodyB);return i.reset(),e}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(t,e,i){function r(t,e,i,n){this.shapeA=e,this.shapeB=n,this.bodyA=t,this.bodyB=i}(e.exports=r).prototype.set=function(t,e,i,n){r.call(this,t,e,i,n)}},{}],54:[function(t,e,i){function n(){s.apply(this,arguments)}var r=t("./OverlapKeeperRecord"),s=t("./Pool");(((e.exports=n).prototype=new s).constructor=n).prototype.create=function(){return new r},n.prototype.destroy=function(t){return t.bodyA=t.bodyB=t.shapeA=t.shapeB=null,this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(t,e,i){function n(t){t=t||{},this.objects=[],void 0!==t.size&&this.resize(t.size)}(e.exports=n).prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.create());return this},n.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()},n.prototype.release=function(t){return this.destroy(t),this.objects.push(t),this}},{}],56:[function(t,e,i){function n(){this.data={},this.keys=[]}var r=t("./Utils");(e.exports=n).prototype.getKey=function(t,e){return(0|(t|=0))==(0|(e|=0))?-1:0|((0|e)<(0|t)?t<<16|65535&e:e<<16|65535&t)},n.prototype.getByKey=function(t){return t|=0,this.data[t]},n.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},n.prototype.set=function(t,e,i){if(!i)throw new Error("No data!");e=this.getKey(t,e);return this.data[e]||this.keys.push(e),this.data[e]=i,e},n.prototype.reset=function(){for(var t=this.data,e=this.keys,i=e.length;i--;)delete t[e[i]];e.length=0},n.prototype.copy=function(t){this.reset(),r.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var i=t.keys[e];this.data[i]=t.data[i]}}},{"./Utils":57}],57:[function(t,e,i){function n(){}(e.exports=n).appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var i=0,n=e.length;i!==n;++i)t.push(e[i])},n.splice=function(t,e,i){i=i||1;for(var n=e,r=t.length-i;n<r;n++)t[n]=t[n+i];t.length=r},"undefined"!=typeof P2_ARRAY_TYPE?n.ARRAY_TYPE=P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?n.ARRAY_TYPE=Float32Array:n.ARRAY_TYPE=Array,n.extend=function(t,e){for(var i in e)t[i]=e[i]},n.defaults=function(t,e){for(var i in t=t||{},e)i in t||(t[i]=e[i]);return t}},{}],58:[function(t,e,i){function n(){this.equations=[],this.bodies=[]}var r=t("../objects/Body");(e.exports=n).prototype.reset=function(){this.equations.length=this.bodies.length=0};var s=[];n.prototype.getBodies=function(t){for(var e=t||[],i=this.equations,n=s.length=0;n!==i.length;n++){var r=i[n];-1===s.indexOf(r.bodyA.id)&&(e.push(r.bodyA),s.push(r.bodyA.id)),-1===s.indexOf(r.bodyB.id)&&(e.push(r.bodyB),s.push(r.bodyB.id))}return e},n.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===r.DYNAMIC&&!e.wantsToSleep)return!1}return!0},n.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++)this.bodies[t].sleep();return!0}},{"../objects/Body":31}],59:[function(t,e,i){function d(t){this.nodePool=new n({size:16}),this.islandPool=new r({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}var n=(t("../math/vec2"),t("./Island"),t("./IslandNode"),t("./../utils/IslandNodePool")),r=t("./../utils/IslandPool"),o=t("../objects/Body");(e.exports=d).getUnvisitedNode=function(t){for(var e=t.length,i=0;i!==e;i++){var n=t[i];if(!n.visited&&n.body.type===o.DYNAMIC)return n}return!1},d.prototype.visit=function(t,e,i){e.push(t.body);for(var n=t.equations.length,r=0;r!==n;r++){var s=t.equations[r];-1===i.indexOf(s)&&i.push(s)}},d.prototype.bfs=function(t,e,i){var n=this.queue;for(n.length=0,n.push(t),t.visited=!0,this.visit(t,e,i);n.length;)for(var r,s=n.pop();r=d.getUnvisitedNode(s.neighbors);)r.visited=!0,this.visit(r,e,i),r.body.type===o.DYNAMIC&&n.push(r)},d.prototype.split=function(t){for(var e=t.bodies,i=this.nodes,n=this.equations;i.length;)this.nodePool.release(i.pop());for(var r=0;r!==e.length;r++){var s=this.nodePool.get();s.body=e[r],i.push(s)}for(var o=0;o!==n.length;o++){var a=n[o],r=e.indexOf(a.bodyA),l=e.indexOf(a.bodyB),p=i[r],l=i[l];p.neighbors.push(l),l.neighbors.push(p),p.equations.push(a),l.equations.push(a)}for(var h,u=this.islands,r=0;r<u.length;r++)this.islandPool.release(u[r]);for(u.length=0;h=d.getUnvisitedNode(i);){var c=this.islandPool.get();this.bfs(h,c.bodies,c.equations),u.push(c)}return u}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(t,e,i){function n(t){this.body=t,this.neighbors=[],this.equations=[],this.visited=!1}(e.exports=n).prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],61:[function(t,e,i){function V(t){r.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new n,this.narrowphase=new p(this),this.islandManager=new u,this.gravity=W.fromValues(0,-9.78),t.gravity&&W.copy(this.gravity,t.gravity),this.frictionGravity=W.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=t.broadphase||new l,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new s,this.defaultContactMaterial=new o(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit=void 0===t.islandSplit||!!t.islandSplit,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=V.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new h}var n=t("../solver/GSSolver"),W=(t("../solver/Solver"),t("../collision/Ray"),t("../math/vec2")),m=t("../shapes/Circle"),x=t("../shapes/Convex"),v=(t("../shapes/Line"),t("../shapes/Plane")),g=t("../shapes/Capsule"),b=t("../shapes/Particle"),r=t("../events/EventEmitter"),H=t("../objects/Body"),s=(t("../shapes/Shape"),t("../objects/LinearSpring"),t("../material/Material")),o=t("../material/ContactMaterial"),a=(t("../constraints/DistanceConstraint"),t("../constraints/Constraint"),t("../constraints/LockConstraint"),t("../constraints/RevoluteConstraint"),t("../constraints/PrismaticConstraint"),t("../constraints/GearConstraint"),t("../../package.json"),t("../collision/Broadphase"),t("../collision/AABB")),l=t("../collision/SAPBroadphase"),p=t("../collision/Narrowphase"),q=t("../utils/Utils"),h=t("../utils/OverlapKeeper"),u=t("./IslandManager");t("../objects/RotationalSpring"),(((e.exports=V).prototype=new Object(r.prototype)).constructor=V).NO_SLEEPING=1,V.BODY_SLEEPING=2,V.ISLAND_SLEEPING=4,V.prototype.addConstraint=function(t){this.constraints.push(t)},V.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},V.prototype.removeContactMaterial=function(t){t=this.contactMaterials.indexOf(t);-1!==t&&q.splice(this.contactMaterials,t,1)},V.prototype.getContactMaterial=function(t,e){for(var i=this.contactMaterials,n=0,r=i.length;n!==r;n++){var s=i[n];if(s.materialA.id===t.id&&s.materialB.id===e.id||s.materialA.id===e.id&&s.materialB.id===t.id)return s}return!1},V.prototype.removeConstraint=function(t){t=this.constraints.indexOf(t);-1!==t&&q.splice(this.constraints,t,1)};var Y=(W.create(),W.create(),W.create(),W.create(),W.create(),W.create(),W.create()),f=W.fromValues(0,0),z=W.fromValues(0,0);W.fromValues(0,0),W.fromValues(0,0),V.prototype.step=function(t,e,i){if(i=i||10,0===(e=e||0))this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var n=0;this.accumulator>=t&&n<i;)this.internalStep(t),this.time+=t,this.accumulator-=t,n++;for(var r=this.accumulator%t/t,s=0;s!==this.bodies.length;s++){var o=this.bodies[s];W.lerp(o.interpolatedPosition,o.previousPosition,o.position,r),o.interpolatedAngle=o.previousAngle+r*(o.angle-o.previousAngle)}}};var K=[];V.prototype.internalStep=function(t){this.stepping=!0;var e,i=this.springs.length,n=this.springs,r=this.bodies,s=this.gravity,o=this.solver,a=this.bodies.length,l=this.broadphase,p=this.narrowphase,h=this.constraints,u=Y,c=(W.scale,W.add),d=(W.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=t,this.useWorldGravityAsFrictionGravity&&(0===(e=W.length(this.gravity))&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=e)),this.applyGravity)for(var _=0;_!==a;_++){var y,f=(y=r[_]).force;y.type===H.DYNAMIC&&y.sleepState!==H.SLEEPING&&(W.scale(u,s,y.mass*y.gravityScale),c(f,f,u))}if(this.applySpringForces)for(_=0;_!==i;_++)n[_].applyForce();if(this.applyDamping)for(_=0;_!==a;_++)(y=r[_]).type===H.DYNAMIC&&y.applyDamping(t);for(var m=l.getCollisionPairs(this),x=this.disabledBodyCollisionPairs,_=x.length-2;0<=_;_-=2)for(var v=m.length-2;0<=v;v-=2)(x[_]===m[v]&&x[_+1]===m[v+1]||x[_+1]===m[v]&&x[_]===m[v+1])&&m.splice(v,2);var g=h.length;for(_=0;_!==g;_++){var b=h[_];if(!b.collideConnected)for(v=m.length-2;0<=v;v-=2)(b.bodyA===m[v]&&b.bodyB===m[v+1]||b.bodyB===m[v]&&b.bodyA===m[v+1])&&m.splice(v,2)}this.postBroadphaseEvent.pairs=m,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,p.reset(this);for(var _=0,z=m.length;_!==z;_+=2)for(var w=m[_],C=m[_+1],P=0,T=w.shapes.length;P!==T;P++)for(var S=w.shapes[P],M=S.position,A=S.angle,O=0,k=C.shapes.length;O!==k;O++){var E,I=C.shapes[O],D=I.position,B=I.angle,L=this.defaultContactMaterial;S.material&&I.material&&((E=this.getContactMaterial(S.material,I.material))&&(L=E)),this.runNarrowphase(p,w,S,M,A,C,I,D,B,L,this.frictionGravity)}for(_=0;_!==a;_++)(j=r[_])._wakeUpAfterNarrowphase&&(j.wakeUp(),j._wakeUpAfterNarrowphase=!1);if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(K);for(var R=this.endContactEvent,O=K.length;O--;){var F=K[O];R.shapeA=F.shapeA,R.shapeB=F.shapeB,R.bodyA=F.bodyA,R.bodyB=F.bodyB,this.emit(R)}K.length=0}l=this.preSolveEvent;l.contactEquations=p.contactEquations,l.frictionEquations=p.frictionEquations,this.emit(l),l.contactEquations=l.frictionEquations=null;g=h.length;for(_=0;_!==g;_++)h[_].update();if(p.contactEquations.length||p.frictionEquations.length||g)if(this.islandSplit){for(d.equations.length=0,q.appendArray(d.equations,p.contactEquations),q.appendArray(d.equations,p.frictionEquations),_=0;_!==g;_++)q.appendArray(d.equations,h[_].equations);d.split(this);for(_=0;_!==d.islands.length;_++)(U=d.islands[_]).equations.length&&o.solveIsland(t,U)}else{for(o.addEquations(p.contactEquations),o.addEquations(p.frictionEquations),_=0;_!==g;_++)o.addEquations(h[_].equations);this.solveConstraints&&o.solve(t,this),o.removeAllEquations()}for(var j,_=0;_!==a;_++)(j=r[_]).integrate(t);for(_=0;_!==a;_++)r[_].setZeroForce();if(this.emitImpactEvent&&this.has("impact"))for(var N=this.impactEvent,_=0;_!==p.contactEquations.length;_++){var G=p.contactEquations[_];G.firstImpact&&(N.bodyA=G.bodyA,N.bodyB=G.bodyB,N.shapeA=G.shapeA,N.shapeB=G.shapeB,N.contactEquation=G,this.emit(N))}if(this.sleepMode===V.BODY_SLEEPING)for(_=0;_!==a;_++)r[_].sleepTick(this.time,!1,t);else if(this.sleepMode===V.ISLAND_SLEEPING&&this.islandSplit){for(_=0;_!==a;_++)r[_].sleepTick(this.time,!0,t);for(var U,_=0;_<this.islandManager.islands.length;_++)(U=this.islandManager.islands[_]).wantsToSleep()&&U.sleep()}this.stepping=!1;for(var X=this.bodiesToBeRemoved,_=0;_!==X.length;_++)this.removeBody(X[_]);X.length=0,this.emit(this.postStepEvent)},V.prototype.runNarrowphase=function(t,e,i,n,r,s,o,a,l,p,h){if(0!=(i.collisionGroup&o.collisionMask)&&0!=(o.collisionGroup&i.collisionMask)){W.rotate(f,n,e.angle),W.rotate(z,a,s.angle),W.add(f,f,e.position),W.add(z,z,s.position);n=r+e.angle,a=l+s.angle;t.enableFriction=0<p.friction,t.frictionCoefficient=p.friction,r=e.type===H.STATIC||e.type===H.KINEMATIC?s.mass:s.type===H.STATIC||s.type===H.KINEMATIC?e.mass:e.mass*s.mass/(e.mass+s.mass),t.slipForce=p.friction*h*r,t.restitution=p.restitution,t.surfaceVelocity=p.surfaceVelocity,t.frictionStiffness=p.frictionStiffness,t.frictionRelaxation=p.frictionRelaxation,t.stiffness=p.stiffness,t.relaxation=p.relaxation,t.contactSkinSize=p.contactSkinSize,t.enabledEquations=e.collisionResponse&&s.collisionResponse&&i.collisionResponse&&o.collisionResponse;l=t[i.type|o.type],h=0;if(l){var u,r=i.sensor||o.sensor,p=t.frictionEquations.length,h=i.type<o.type?l.call(t,e,i,f,n,s,o,z,a,r):l.call(t,s,o,z,a,e,i,f,n,r),c=t.frictionEquations.length-p;if(h){if(e.allowSleep&&e.type===H.DYNAMIC&&e.sleepState===H.SLEEPING&&s.sleepState===H.AWAKE&&s.type!==H.STATIC&&(u=W.squaredLength(s.velocity)+Math.pow(s.angularVelocity,2),2*Math.pow(s.sleepSpeedLimit,2)<=u&&(e._wakeUpAfterNarrowphase=!0)),s.allowSleep&&s.type===H.DYNAMIC&&s.sleepState===H.SLEEPING&&e.sleepState===H.AWAKE&&e.type!==H.STATIC&&(u=W.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2),2*Math.pow(e.sleepSpeedLimit,2)<=u&&(s._wakeUpAfterNarrowphase=!0)),this.overlapKeeper.setOverlapping(e,i,s,o),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(i,o)){var d=this.beginContactEvent;if(d.shapeA=i,d.shapeB=o,d.bodyA=e,d.bodyB=s,d.contactEquations.length=0,"number"==typeof h)for(var _=t.contactEquations.length-h;_<t.contactEquations.length;_++)d.contactEquations.push(t.contactEquations[_]);this.emit(d)}if("number"==typeof h&&1<c)for(_=t.frictionEquations.length-c;_<t.frictionEquations.length;_++){var y=t.frictionEquations[_];y.setSlipForce(y.getSlipForce()/c)}}}}},V.prototype.addSpring=function(t){this.springs.push(t);var e=this.addSpringEvent;e.spring=t,this.emit(e),e.spring=null},V.prototype.removeSpring=function(t){t=this.springs.indexOf(t);-1!==t&&q.splice(this.springs,t,1)},V.prototype.addBody=function(t){var e;-1===this.bodies.indexOf(t)&&(this.bodies.push(t),(e=(t.world=this).addBodyEvent).body=t,this.emit(e),e.body=null)},V.prototype.removeBody=function(t){var e;this.stepping?this.bodiesToBeRemoved.push(t):(t.world=null,-1!==(e=this.bodies.indexOf(t))&&(q.splice(this.bodies,e,1),(this.removeBodyEvent.body=t).resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null))},V.prototype.getBodyById=function(t){for(var e=this.bodies,i=0;i<e.length;i++){var n=e[i];if(n.id===t)return n}return!1},V.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},V.prototype.enableBodyCollision=function(t,e){for(var i=this.disabledBodyCollisionPairs,n=0;n<i.length;n+=2)if(i[n]===t&&i[n+1]===e||i[n+1]===t&&i[n]===e)return void i.splice(n,2)},V.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var t=this.constraints,e=t.length-1;0<=e;e--)this.removeConstraint(t[e]);for(var i=this.bodies,e=i.length-1;0<=e;e--)this.removeBody(i[e]);for(var n=this.springs,e=n.length-1;0<=e;e--)this.removeSpring(n[e]);for(var r=this.contactMaterials,e=r.length-1;0<=e;e--)this.removeContactMaterial(r[e]);V.apply(this)};var w=W.create(),C=(W.fromValues(0,0),W.fromValues(0,0));V.prototype.hitTest=function(t,e,i){i=i||0;var n=new H({position:t}),r=new b,s=t,o=w,a=C;n.addShape(r);for(var l=this.narrowphase,p=[],h=0,u=e.length;h!==u;h++)for(var c=e[h],d=0,_=c.shapes.length;d!==_;d++){var y=c.shapes[d];W.rotate(o,y.position,c.angle),W.add(o,o,c.position);var f=y.angle+c.angle;(y instanceof m&&l.circleParticle(c,y,o,f,n,r,s,0,!0)||y instanceof x&&l.particleConvex(n,r,s,0,c,y,o,f,!0)||y instanceof v&&l.particlePlane(n,r,s,0,c,y,o,f,!0)||y instanceof g&&l.particleCapsule(n,r,s,0,c,y,o,f,!0)||y instanceof b&&W.squaredLength(W.sub(a,o,t))<i*i)&&p.push(c)}return p},V.prototype.setGlobalStiffness=function(t){for(var e=this.constraints,i=0;i!==e.length;i++)for(var n=e[i],r=0;r!==n.equations.length;r++){var s=n.equations[r];s.stiffness=t,s.needsUpdate=!0}for(var o=this.contactMaterials,i=0;i!==o.length;i++)(n=o[i]).stiffness=n.frictionStiffness=t;(n=this.defaultContactMaterial).stiffness=n.frictionStiffness=t},V.prototype.setGlobalRelaxation=function(t){for(var e=0;e!==this.constraints.length;e++)for(var i=this.constraints[e],n=0;n!==i.equations.length;n++){var r=i.equations[n];r.relaxation=t,r.needsUpdate=!0}for(e=0;e!==this.contactMaterials.length;e++)(i=this.contactMaterials[e]).relaxation=i.frictionRelaxation=t;(i=this.defaultContactMaterial).relaxation=i.frictionRelaxation=t};var c=new a,d=[];V.prototype.raycast=function(t,e){return e.getAABB(c),this.broadphase.aabbQuery(this,c,d),e.intersectBodies(t,d),d.length=0,t.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)}),function(){var t=this,T=T||{};return T.game=null,T.WEBGL_RENDERER=0,T.CANVAS_RENDERER=1,T.VERSION="v2.2.9",T._UID=0,"undefined"!=typeof Float32Array?(T.Float32Array=Float32Array,T.Uint16Array=Uint16Array,T.Uint32Array=Uint32Array,T.ArrayBuffer=ArrayBuffer):(T.Float32Array=Array,T.Uint16Array=Array),T.PI_2=2*Math.PI,T.RAD_TO_DEG=180/Math.PI,T.DEG_TO_RAD=Math.PI/180,T.RETINA_PREFIX="@2x",T.DisplayObject=function(){this.position=new T.Point(0,0),this.scale=new T.Point(1,1),this.pivot=new T.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.renderable=!1,this.parent=null,this.worldAlpha=1,this.worldTransform=new T.Matrix,this.worldPosition=new T.Point(0,0),this.worldScale=new T.Point(1,1),this.worldRotation=0,this.filterArea=null,this._sr=0,this._cr=1,this._bounds=new T.Rectangle(0,0,0,0),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},T.DisplayObject.prototype.constructor=T.DisplayObject,T.DisplayObject.prototype={destroy:function(){if(this.children){for(var t=this.children.length;t--;)this.children[t].destroy();this.children=[]}this.hitArea=null,this.parent=null,this.worldTransform=null,this.filterArea=null,this.renderable=!1,this._bounds=null,this._currentBounds=null,this._mask=null,this._destroyCachedSprite()},updateTransform:function(t){if(!t&&!this.parent&&!this.game)return this;var e=this.parent;t?e=t:this.parent||(e=this.game.world);var i,n,r,s,o,a=e.worldTransform,l=this.worldTransform;return this.rotation%T.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),i=this._cr*this.scale.x,n=this._sr*this.scale.x,t=-this._sr*this.scale.y,r=this._cr*this.scale.y,s=this.position.x,o=this.position.y,(this.pivot.x||this.pivot.y)&&(s-=this.pivot.x*i+this.pivot.y*t,o-=this.pivot.x*n+this.pivot.y*r),l.a=i*a.a+n*a.c,l.b=i*a.b+n*a.d,l.c=t*a.a+r*a.c,l.d=t*a.b+r*a.d):(i=this.scale.x,r=this.scale.y,s=this.position.x-this.pivot.x*i,o=this.position.y-this.pivot.y*r,l.a=i*a.a,l.b=i*a.b,l.c=r*a.c,l.d=r*a.d),l.tx=s*a.a+o*a.c+a.tx,l.ty=s*a.b+o*a.d+a.ty,this.worldAlpha=this.alpha*e.worldAlpha,this.worldPosition.set(l.tx,l.ty),this.worldScale.set(this.scale.x*Math.sqrt(l.a*l.a+l.c*l.c),this.scale.y*Math.sqrt(l.b*l.b+l.d*l.d)),this.worldRotation=Math.atan2(-l.c,l.d),this._currentBounds=null,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,l,a),this},preUpdate:function(){},generateTexture:function(t,e,i){var n=this.getLocalBounds(),t=new T.RenderTexture(0|n.width,0|n.height,i,e,t);return T.DisplayObject._tempMatrix.tx=-n.x,T.DisplayObject._tempMatrix.ty=-n.y,t.render(this,T.DisplayObject._tempMatrix),t},updateCache:function(){return this._generateCachedSprite(),this},toGlobal:function(t){return this.updateTransform(),this.worldTransform.apply(t)},toLocal:function(t,e){return e&&(t=e.toGlobal(t)),this.updateTransform(),this.worldTransform.applyInverse(t)},_renderCachedSprite:function(t){this._cachedSprite.worldAlpha=this.worldAlpha,(t.gl?T.Sprite.prototype._renderWebGL:T.Sprite.prototype._renderCanvas).call(this._cachedSprite,t)},_generateCachedSprite:function(){this._cacheAsBitmap=!1;var t=this.getLocalBounds();t.width=Math.max(1,Math.ceil(t.width)),t.height=Math.max(1,Math.ceil(t.height)),this.updateTransform(),this._cachedSprite?this._cachedSprite.texture.resize(t.width,t.height):(e=new T.RenderTexture(t.width,t.height),this._cachedSprite=new T.Sprite(e),this._cachedSprite.worldTransform=this.worldTransform);var e=this._filters;this._filters=null,this._cachedSprite.filters=e,T.DisplayObject._tempMatrix.tx=-t.x,T.DisplayObject._tempMatrix.ty=-t.y,this._cachedSprite.texture.render(this,T.DisplayObject._tempMatrix,!0),this._cachedSprite.anchor.x=-(t.x/t.width),this._cachedSprite.anchor.y=-(t.y/t.height),this._filters=e,this._cacheAsBitmap=!0},_destroyCachedSprite:function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)}},T.DisplayObject.prototype.displayObjectUpdateTransform=T.DisplayObject.prototype.updateTransform,Object.defineProperties(T.DisplayObject.prototype,{x:{get:function(){return this.position.x},set:function(t){this.position.x=t}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t}},worldVisible:{get:function(){if(this.visible){var t=this.parent;if(!t)return this.visible;do{if(!t.visible)return!1}while(t=t.parent);return!0}return!1}},mask:{get:function(){return this._mask},set:function(t){this._mask&&(this._mask.isMask=!1),(this._mask=t)&&(this._mask.isMask=!0)}},filters:{get:function(){return this._filters},set:function(t){if(Array.isArray(t)){for(var e=[],i=0;i<t.length;i++)for(var n=t[i].passes,r=0;r<n.length;r++)e.push(n[r]);this._filterBlock={target:this,filterPasses:e}}this._filters=t,this.blendMode&&this.blendMode===T.blendModes.MULTIPLY&&(this.blendMode=T.blendModes.NORMAL)}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap!==t&&(t?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=t)}}}),T.DisplayObjectContainer=function(){T.DisplayObject.call(this),this.children=[],this.ignoreChildInput=!1},T.DisplayObjectContainer.prototype=Object.create(T.DisplayObject.prototype),T.DisplayObjectContainer.prototype.constructor=T.DisplayObjectContainer,T.DisplayObjectContainer.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)},T.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(0<=e&&e<=this.children.length)return t.parent&&t.parent.removeChild(t),(t.parent=this).children.splice(e,0,t),t;throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)},T.DisplayObjectContainer.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),n=this.getChildIndex(e);if(i<0||n<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=e,this.children[n]=t}},T.DisplayObjectContainer.prototype.getChildIndex=function(t){t=this.children.indexOf(t);if(-1===t)throw new Error("The supplied DisplayObject must be a child of the caller");return t},T.DisplayObjectContainer.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(t);this.children.splice(i,1),this.children.splice(e,0,t)},T.DisplayObjectContainer.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[t]},T.DisplayObjectContainer.prototype.removeChild=function(t){t=this.children.indexOf(t);if(-1!==t)return this.removeChildAt(t)},T.DisplayObjectContainer.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e&&(e.parent=void 0,this.children.splice(t,1)),e},T.DisplayObjectContainer.prototype.removeChildren=function(t,e){void 0===t&&(t=0),void 0===e&&(e=this.children.length);t=e-t;if(0<t&&t<=e){for(var i=this.children.splice(begin,t),n=0;n<i.length;n++)i[n].parent=void 0;return i}if(0==t&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},T.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var t=0;t<this.children.length;t++)this.children[t].updateTransform()},T.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=T.DisplayObjectContainer.prototype.updateTransform,T.DisplayObjectContainer.prototype.getBounds=function(t){var e=t&&t instanceof T.DisplayObject,i=!0;if(e?i=t instanceof T.DisplayObjectContainer&&t.contains(this):t=this,e){var n=t.worldTransform;for(t.worldTransform=T.identityMatrix,u=0;u<t.children.length;u++)t.children[u].updateTransform()}for(var r,s,o=1/0,a=1/0,l=-1/0,p=-1/0,h=!1,u=0;u<this.children.length;u++)this.children[u].visible&&(h=!0,o=o<(s=this.children[u].getBounds()).x?o:s.x,a=a<s.y?a:s.y,l=(r=s.width+s.x)<l?l:r,p=(s=s.height+s.y)<p?p:s);var c,d,_,y,f,m,x,v,g,b,z,w,C,P=this._bounds;if(h||(g=(P=new T.Rectangle).x,c=P.width+P.x,z=P.y,d=P.height+P.y,_=(C=this.worldTransform).a,y=C.b,m=C.c,f=C.d,o=(w=_*c+m*z+(x=C.tx))<(o=(b=_*g+m*z+x)<(o=(v=_*g+m*d+x)<(o=m=_*c+m*d+x)?v:o)?b:o)?w:o,a=(C=f*z+y*c+(x=C.ty))<(a=(z=f*z+y*g+x)<(a=(g=f*d+y*g+x)<(a=x=f*d+y*c+x)?g:a)?z:a)?C:a,l=(l=(l=(l=m)<v?v:l)<b?b:l)<w?w:l,p=(p=(p=(p=x)<g?g:p)<z?z:p)<C?C:p),P.x=o,P.y=a,P.width=l-o,P.height=p-a,e)for(t.worldTransform=n,u=0;u<t.children.length;u++)t.children[u].updateTransform();return i||(i=t.getBounds(),P.x-=i.x,P.y-=i.y),P},T.DisplayObjectContainer.prototype.getLocalBounds=function(){return this.getBounds(this)},T.DisplayObjectContainer.prototype.contains=function(t){return!!t&&(t===this||this.contains(t.parent))},T.DisplayObjectContainer.prototype._renderWebGL=function(t){var e;if(this.visible&&!(this.alpha<=0))if(this._cacheAsBitmap)this._renderCachedSprite(t);else if(this._mask||this._filters){for(this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),t.spriteBatch.start()}else for(e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t)},T.DisplayObjectContainer.prototype._renderCanvas=function(t){if(!1!==this.visible&&0!==this.alpha)if(this._cacheAsBitmap)this._renderCachedSprite(t);else{this._mask&&t.maskManager.pushMask(this._mask,t);for(var e=0;e<this.children.length;e++)this.children[e]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},Object.defineProperty(T.DisplayObjectContainer.prototype,"width",{get:function(){return this.getLocalBounds().width*this.scale.x},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}}),Object.defineProperty(T.DisplayObjectContainer.prototype,"height",{get:function(){return this.getLocalBounds().height*this.scale.y},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}}),T.Sprite=function(t){T.DisplayObjectContainer.call(this),this.anchor=new T.Point,this.texture=t||T.Texture.emptyTexture,this._width=0,this._height=0,this.tint=16777215,this.cachedTint=-1,this.tintedTexture=null,this.blendMode=T.blendModes.NORMAL,this.shader=null,this.exists=!0,this.texture.baseTexture.hasLoaded&&this.onTextureUpdate(),this.renderable=!0},T.Sprite.prototype=Object.create(T.DisplayObjectContainer.prototype),T.Sprite.prototype.constructor=T.Sprite,Object.defineProperty(T.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(T.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),T.Sprite.prototype.setTexture=function(t,e){void 0!==e&&this.texture.baseTexture.destroy(),this.texture.baseTexture.skipRender=!1,this.texture=t,this.texture.valid=!0,this.cachedTint=-1},T.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},T.Sprite.prototype.getBounds=function(t){var e,i=this.texture.frame.width,n=this.texture.frame.height,r=i*(1-this.anchor.x),s=i*-this.anchor.x,o=n*(1-this.anchor.y),a=n*-this.anchor.y,l=t||this.worldTransform,p=l.a,h=l.b,u=l.c,c=l.d,d=l.tx,_=l.ty,y=-1/0,f=-1/0,i=1/0,n=1/0,f=0===h&&0===u?(p<0&&(p*=-1,e=r,r=-s,s=-e),c<0&&(c*=-1,e=o,o=-a,a=-e),i=p*s+d,y=p*r+d,n=c*a+_,c*o+_):(i=(t=p*s+u*o+d)<(i=(l=p*r+u*o+d)<(i=(e=p*r+u*a+d)<(i=(d=p*s+u*a+d)<i?d:i)?e:i)?l:i)?t:i,n=(m=c*o+h*s+_)<(n=(o=c*o+h*r+_)<(n=(r=c*a+h*r+_)<(n=(_=c*a+h*s+_)<n?_:n)?r:n)?o:n)?m:n,y=(y=(y=(y=y<d?d:y)<e?e:y)<l?l:y)<t?t:y,(f=(f=(f=f<_?_:f)<r?r:f)<o?o:f)<m?m:f),m=this._bounds;return m.x=i,m.width=y-i,m.y=n,m.height=f-n,this._currentBounds=m},T.Sprite.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=T.identityMatrix;for(var e=0;e<this.children.length;e++)this.children[e].updateTransform();var i=this.getBounds();for(this.worldTransform=t,e=0;e<this.children.length;e++)this.children[e].updateTransform();return i},T.Sprite.prototype._renderWebGL=function(t,e){if(this.visible&&!(this.alpha<=0)&&this.renderable){var i=this.worldTransform;if(e&&(i=e),this._mask||this._filters){e=t.spriteBatch;this._filters&&(e.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(e.stop(),t.maskManager.pushMask(this.mask,t),e.start()),e.render(this);for(var n=0;n<this.children.length;n++)this.children[n]._renderWebGL(t);e.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),e.start()}else{t.spriteBatch.render(this);for(n=0;n<this.children.length;n++)this.children[n]._renderWebGL(t,i)}}},T.Sprite.prototype._renderCanvas=function(t,e){if(!(!this.visible||0===this.alpha||!this.renderable||this.texture.crop.width<=0||this.texture.crop.height<=0)){var i,n,r,s,o,a=this.worldTransform;e&&(a=e),this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=T.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),this.texture.valid&&(i=this.texture.baseTexture.resolution/t.resolution,t.context.globalAlpha=this.worldAlpha,t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode&&(t.scaleMode=this.texture.baseTexture.scaleMode,t.context[t.smoothProperty]=t.scaleMode===T.scaleModes.LINEAR),n=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,r=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height,s=a.tx*t.resolution+t.shakeX,o=a.ty*t.resolution+t.shakeY,t.roundPixels?(t.context.setTransform(a.a,a.b,a.c,a.d,0|s,0|o),n|=0,r|=0):t.context.setTransform(a.a,a.b,a.c,a.d,s,o),e=this.texture.crop.width,a=this.texture.crop.height,n/=i,r/=i,16777215!==this.tint?(!this.texture.requiresReTint&&this.cachedTint===this.tint||(this.tintedTexture=T.CanvasTinter.getTintedTexture(this,this.tint),this.cachedTint=this.tint,this.texture.requiresReTint=!1),t.context.drawImage(this.tintedTexture,0,0,e,a,n,r,e/i,a/i)):(s=this.texture.crop.x,o=this.texture.crop.y,t.context.drawImage(this.texture.baseTexture.source,s,o,e,a,n,r,e/i,a/i)));for(var l=0;l<this.children.length;l++)this.children[l]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},T.SpriteBatch=function(t){T.DisplayObjectContainer.call(this),this.textureThing=t,this.ready=!1},T.SpriteBatch.prototype=Object.create(T.DisplayObjectContainer.prototype),T.SpriteBatch.prototype.constructor=T.SpriteBatch,T.SpriteBatch.prototype.initWebGL=function(t){this.fastSpriteBatch=new T.WebGLFastSpriteBatch(t),this.ready=!0},T.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},T.SpriteBatch.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(t.gl),this.fastSpriteBatch.gl!==t.gl&&this.fastSpriteBatch.setContext(t.gl),t.spriteBatch.stop(),t.shaderManager.setShader(t.shaderManager.fastShader),this.fastSpriteBatch.begin(this,t),this.fastSpriteBatch.render(this),t.spriteBatch.start())},T.SpriteBatch.prototype._renderCanvas=function(t){if(this.visible&&!(this.alpha<=0)&&this.children.length){var e=t.context;e.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var i=this.worldTransform,n=!0,r=0;r<this.children.length;r++){var s,o,a,l,p,h=this.children[r];h.visible&&(o=(s=h.texture).frame,e.globalAlpha=this.worldAlpha*h.alpha,h.rotation%(2*Math.PI)==0?(n&&(e.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),n=!1),e.drawImage(s.baseTexture.source,o.x,o.y,o.width,o.height,h.anchor.x*(-o.width*h.scale.x)+h.position.x+.5+t.shakeX|0,h.anchor.y*(-o.height*h.scale.y)+h.position.y+.5+t.shakeY|0,o.width*h.scale.x,o.height*h.scale.y)):(n=n||!0,h.displayObjectUpdateTransform(),l=(a=h.worldTransform).tx*t.resolution+t.shakeX,p=a.ty*t.resolution+t.shakeY,t.roundPixels?e.setTransform(a.a,a.b,a.c,a.d,0|l,0|p):e.setTransform(a.a,a.b,a.c,a.d,l,p),e.drawImage(s.baseTexture.source,o.x,o.y,o.width,o.height,h.anchor.x*-o.width+.5|0,h.anchor.y*-o.height+.5|0,o.width,o.height)))}}},T.hex2rgb=function(t){return[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]},T.rgb2hex=function(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]},T.canUseNewCanvasBlendModes=function(){if(void 0===document)return!1;var t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/",e="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==",i=new Image;i.src=t+"AP804Oa6"+e;var n=new Image;n.src=t+"/wCKxvRF"+e;e=T.CanvasPool.create(this,6,1).getContext("2d");if(e.globalCompositeOperation="multiply",e.drawImage(i,0,0),e.drawImage(n,2,0),!e.getImageData(2,0,1,1))return!1;e=e.getImageData(2,0,1,1).data;return T.CanvasPool.remove(this),255===e[0]&&0===e[1]&&0===e[2]},T.getNextPowerOfTwo=function(t){if(0<t&&0==(t&t-1))return t;for(var e=1;e<t;)e<<=1;return e},T.isPowerOfTwo=function(t,e){return 0<t&&0==(t&t-1)&&0<e&&0==(e&e-1)},T.CanvasPool={create:function(t,e,i){var n,r=T.CanvasPool.getFirst(),r=-1===r?(n={parent:t,canvas:document.createElement("canvas")},T.CanvasPool.pool.push(n),n.canvas):(T.CanvasPool.pool[r].parent=t,T.CanvasPool.pool[r].canvas);return void 0!==e&&(r.width=e,r.height=i),r},getFirst:function(){for(var t=T.CanvasPool.pool,e=0;e<t.length;e++)if(!t[e].parent)return e;return-1},remove:function(t){for(var e=T.CanvasPool.pool,i=0;i<e.length;i++)e[i].parent===t&&(e[i].parent=null,e[i].canvas.width=1,e[i].canvas.height=1)},removeByCanvas:function(t){for(var e=T.CanvasPool.pool,i=0;i<e.length;i++)e[i].canvas===t&&(e[i].parent=null,e[i].canvas.width=1,e[i].canvas.height=1)},getTotal:function(){for(var t=T.CanvasPool.pool,e=0,i=0;i<t.length;i++)t[i].parent&&e++;return e},getFree:function(){for(var t=T.CanvasPool.pool,e=0,i=0;i<t.length;i++)t[i].parent||e++;return e}},T.CanvasPool.pool=[],T.initDefaultShaders=function(){},T.CompileVertexShader=function(t,e){return T._CompileShader(t,e,t.VERTEX_SHADER)},T.CompileFragmentShader=function(t,e){return T._CompileShader(t,e,t.FRAGMENT_SHADER)},T._CompileShader=function(t,e,i){var n=e;Array.isArray(e)&&(n=e.join("\n"));i=t.createShader(i);return t.shaderSource(i,n),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(window.console.log(t.getShaderInfoLog(i)),null)},T.compileProgram=function(t,e,i){var n=T.CompileFragmentShader(t,i),i=T.CompileVertexShader(t,e),e=t.createProgram();return t.attachShader(e,i),t.attachShader(e,n),t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS)||(window.console.log(t.getProgramInfoLog(e)),window.console.log("Could not initialise shaders")),e},T.PixiShader=function(t){this._UID=T._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()},T.PixiShader.prototype.constructor=T.PixiShader,T.PixiShader.prototype.init=function(){var t,e=this.gl,i=T.compileProgram(e,this.vertexSrc||T.PixiShader.defaultVertexSrc,this.fragmentSrc);for(t in e.useProgram(i),this.uSampler=e.getUniformLocation(i,"uSampler"),this.projectionVector=e.getUniformLocation(i,"projectionVector"),this.offsetVector=e.getUniformLocation(i,"offsetVector"),this.dimensions=e.getUniformLocation(i,"dimensions"),this.aVertexPosition=e.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute],this.uniforms)this.uniforms[t].uniformLocation=e.getUniformLocation(i,t);this.initUniforms(),this.program=i},T.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var t,e,i=this.gl;for(e in this.uniforms){var n=(t=this.uniforms[e]).type;"sampler2D"===n?(t._init=!1,null!==t.value&&this.initSampler2D(t)):"mat2"===n||"mat3"===n||"mat4"===n?(t.glMatrix=!0,t.glValueLength=1,"mat2"===n?t.glFunc=i.uniformMatrix2fv:"mat3"===n?t.glFunc=i.uniformMatrix3fv:"mat4"===n&&(t.glFunc=i.uniformMatrix4fv)):(t.glFunc=i["uniform"+n],t.glValueLength="2f"===n||"2i"===n?2:"3f"===n||"3i"===n?3:"4f"===n||"4i"===n?4:1)}},T.PixiShader.prototype.initSampler2D=function(t){var e,i,n,r,s,o,a,l,p;t.value&&t.value.baseTexture&&t.value.baseTexture.hasLoaded&&((e=this.gl).activeTexture(e["TEXTURE"+this.textureCount]),e.bindTexture(e.TEXTURE_2D,t.value.baseTexture._glTextures[e.id]),t.textureData&&(i=(p=t.textureData).magFilter||e.LINEAR,n=p.minFilter||e.LINEAR,r=p.wrapS||e.CLAMP_TO_EDGE,s=p.wrapT||e.CLAMP_TO_EDGE,o=p.luminance?e.LUMINANCE:e.RGBA,p.repeat&&(r=e.REPEAT,s=e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!p.flipY),p.width?(a=p.width||512,l=p.height||2,p=p.border||0,e.texImage2D(e.TEXTURE_2D,0,o,a,l,p,o,e.UNSIGNED_BYTE,null)):e.texImage2D(e.TEXTURE_2D,0,o,e.RGBA,e.UNSIGNED_BYTE,t.value.baseTexture.source),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,s)),e.uniform1i(t.uniformLocation,this.textureCount),t._init=!0,this.textureCount++)},T.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var t,e,i=this.gl;for(e in this.uniforms)t=this.uniforms[e],1===t.glValueLength?!0===t.glMatrix?t.glFunc.call(i,t.uniformLocation,t.transpose,t.value):t.glFunc.call(i,t.uniformLocation,t.value):2===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y):3===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z):4===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w):"sampler2D"===t.type&&(t._init?(i.activeTexture(i["TEXTURE"+this.textureCount]),t.value.baseTexture._dirty[i.id]?T.instances[i.id].updateTexture(t.value.baseTexture):i.bindTexture(i.TEXTURE_2D,t.value.baseTexture._glTextures[i.id]),i.uniform1i(t.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(t))},T.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},T.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],T.PixiFastShader=function(t){this._UID=T._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},T.PixiFastShader.prototype.constructor=T.PixiFastShader,T.PixiFastShader.prototype.init=function(){var t=this.gl,e=T.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e),this.uSampler=t.getUniformLocation(e,"uSampler"),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.dimensions=t.getUniformLocation(e,"dimensions"),this.uMatrix=t.getUniformLocation(e,"uMatrix"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.aPositionCoord=t.getAttribLocation(e,"aPositionCoord"),this.aScale=t.getAttribLocation(e,"aScale"),this.aRotation=t.getAttribLocation(e,"aRotation"),this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(e,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=e},T.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},T.StripShader=function(t){this._UID=T._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},T.StripShader.prototype.constructor=T.StripShader,T.StripShader.prototype.init=function(){var t=this.gl,e=T.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e),this.uSampler=t.getUniformLocation(e,"uSampler"),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.colorAttribute=t.getAttribLocation(e,"aColor"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=t.getUniformLocation(e,"translationMatrix"),this.alpha=t.getUniformLocation(e,"alpha"),this.program=e},T.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},T.PrimitiveShader=function(t){this._UID=T._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},T.PrimitiveShader.prototype.constructor=T.PrimitiveShader,T.PrimitiveShader.prototype.init=function(){var t=this.gl,e=T.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.tintColor=t.getUniformLocation(e,"tint"),this.flipY=t.getUniformLocation(e,"flipY"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.colorAttribute=t.getAttribLocation(e,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(e,"translationMatrix"),this.alpha=t.getUniformLocation(e,"alpha"),this.program=e},T.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},T.ComplexPrimitiveShader=function(t){this._UID=T._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},T.ComplexPrimitiveShader.prototype.constructor=T.ComplexPrimitiveShader,T.ComplexPrimitiveShader.prototype.init=function(){var t=this.gl,e=T.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.tintColor=t.getUniformLocation(e,"tint"),this.color=t.getUniformLocation(e,"color"),this.flipY=t.getUniformLocation(e,"flipY"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(e,"translationMatrix"),this.alpha=t.getUniformLocation(e,"alpha"),this.program=e},T.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},T.glContexts=[],T.instances=[],T.WebGLRenderer=function(t){this.game=t,T.defaultRenderer||(T.defaultRenderer=this),this.type=T.WEBGL_RENDERER,this.resolution=t.resolution,this.transparent=t.transparent,this.autoResize=!1,this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.clearBeforeRender=t.clearBeforeRender,this.width=t.width,this.height=t.height,this.view=t.canvas,this._contextOptions={alpha:this.transparent,antialias:t.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:this.preserveDrawingBuffer},this.projection=new T.Point,this.offset=new T.Point,this.shaderManager=new T.WebGLShaderManager,this.spriteBatch=new T.WebGLSpriteBatch,this.maskManager=new T.WebGLMaskManager,this.filterManager=new T.WebGLFilterManager,this.stencilManager=new T.WebGLStencilManager,this.blendModeManager=new T.WebGLBlendModeManager,this.renderSession={},this.renderSession.game=this.game,this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,(this.renderSession.renderer=this).renderSession.resolution=this.resolution,this.initContext(),this.mapBlendModes()},T.WebGLRenderer.prototype.constructor=T.WebGLRenderer,T.WebGLRenderer.prototype.initContext=function(){var t=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(!(this.gl=t))throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=t.id=T.WebGLRenderer.glContextId++,T.glContexts[this.glContextId]=t,T.instances[this.glContextId]=this,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.enable(t.BLEND),this.shaderManager.setContext(t),this.spriteBatch.setContext(t),this.maskManager.setContext(t),this.filterManager.setContext(t),this.blendModeManager.setContext(t),this.stencilManager.setContext(t),this.renderSession.gl=this.gl,this.resize(this.width,this.height)},T.WebGLRenderer.prototype.render=function(t){var e;this.contextLost||((e=this.gl).viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,null),this.game.clearBeforeRender&&(e.clearColor(t._bgColor.r,t._bgColor.g,t._bgColor.b,t._bgColor.a),e.clear(e.COLOR_BUFFER_BIT)),this.offset.x=this.game.camera._shake.x,this.offset.y=this.game.camera._shake.y,this.renderDisplayObject(t,this.projection))},T.WebGLRenderer.prototype.renderDisplayObject=function(t,e,i,n){this.renderSession.blendModeManager.setBlendMode(T.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.flipY=i?-1:1,this.renderSession.projection=e,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,i),t._renderWebGL(this.renderSession,n),this.spriteBatch.end()},T.WebGLRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},T.WebGLRenderer.prototype.updateTexture=function(t){if(!t.hasLoaded)return!1;var e=this.gl;return t._glTextures[e.id]||(t._glTextures[e.id]=e.createTexture()),e.bindTexture(e.TEXTURE_2D,t._glTextures[e.id]),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.source),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t.scaleMode===T.scaleModes.LINEAR?e.LINEAR:e.NEAREST),t.mipmap&&T.isPowerOfTwo(t.width,t.height)?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===T.scaleModes.LINEAR?e.LINEAR_MIPMAP_LINEAR:e.NEAREST_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D)):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===T.scaleModes.LINEAR?e.LINEAR:e.NEAREST),t._powerOf2?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),!(t._dirty[e.id]=!1)},T.WebGLRenderer.prototype.destroy=function(){T.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null,T.CanvasPool.remove(this),T.instances[this.glContextId]=null,T.WebGLRenderer.glContextId--},T.WebGLRenderer.prototype.mapBlendModes=function(){var t,e,i=this.gl;T.blendModesWebGL||((t=[])[(e=T.blendModes).NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.ADD]=[i.SRC_ALPHA,i.DST_ALPHA],t[e.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA],t[e.SCREEN]=[i.SRC_ALPHA,i.ONE],t[e.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],T.blendModesWebGL=t)},T.WebGLRenderer.glContextId=0,T.WebGLBlendModeManager=function(){this.currentBlendMode=99999},T.WebGLBlendModeManager.prototype.constructor=T.WebGLBlendModeManager,T.WebGLBlendModeManager.prototype.setContext=function(t){this.gl=t},T.WebGLBlendModeManager.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;t=T.blendModesWebGL[this.currentBlendMode];return t&&this.gl.blendFunc(t[0],t[1]),!0},T.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},T.WebGLMaskManager=function(){},T.WebGLMaskManager.prototype.constructor=T.WebGLMaskManager,T.WebGLMaskManager.prototype.setContext=function(t){this.gl=t},T.WebGLMaskManager.prototype.pushMask=function(t,e){var i=e.gl;t.dirty&&T.WebGLGraphics.updateGraphics(t,i),void 0!==t._webGL[i.id]&&void 0!==t._webGL[i.id].data&&0!==t._webGL[i.id].data.length&&e.stencilManager.pushStencil(t,t._webGL[i.id].data[0],e)},T.WebGLMaskManager.prototype.popMask=function(t,e){var i=this.gl;void 0!==t._webGL[i.id]&&void 0!==t._webGL[i.id].data&&0!==t._webGL[i.id].data.length&&e.stencilManager.popStencil(t,t._webGL[i.id].data[0],e)},T.WebGLMaskManager.prototype.destroy=function(){this.gl=null},T.WebGLStencilManager=function(){this.stencilStack=[],this.reverse=!0,this.count=0},T.WebGLStencilManager.prototype.setContext=function(t){this.gl=t},T.WebGLStencilManager.prototype.pushStencil=function(t,e,i){var n=this.gl;this.bindGraphics(t,e,i),0===this.stencilStack.length&&(n.enable(n.STENCIL_TEST),n.clear(n.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(e);i=this.count;n.colorMask(!1,!1,!1,!1),n.stencilFunc(n.ALWAYS,0,255),n.stencilOp(n.KEEP,n.KEEP,n.INVERT),1===e.mode?(n.drawElements(n.TRIANGLE_FAN,e.indices.length-4,n.UNSIGNED_SHORT,0),this.reverse?(n.stencilFunc(n.EQUAL,255-i,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)):(n.stencilFunc(n.EQUAL,i,255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)),n.drawElements(n.TRIANGLE_FAN,4,n.UNSIGNED_SHORT,2*(e.indices.length-4)),this.reverse?n.stencilFunc(n.EQUAL,255-(i+1),255):n.stencilFunc(n.EQUAL,i+1,255),this.reverse=!this.reverse):(this.reverse?(n.stencilFunc(n.EQUAL,i,255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)):(n.stencilFunc(n.EQUAL,255-i,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)),n.drawElements(n.TRIANGLE_STRIP,e.indices.length,n.UNSIGNED_SHORT,0),this.reverse?n.stencilFunc(n.EQUAL,i+1,255):n.stencilFunc(n.EQUAL,255-(i+1),255)),n.colorMask(!0,!0,!0,!0),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),this.count++},T.WebGLStencilManager.prototype.bindGraphics=function(t,e,i){this._currentGraphics=t;var n,r=this.gl,s=i.projection,o=i.offset;1===e.mode?(n=i.shaderManager.complexPrimitiveShader,i.shaderManager.setShader(n),r.uniform1f(n.flipY,i.flipY),r.uniformMatrix3fv(n.translationMatrix,!1,t.worldTransform.toArray(!0)),r.uniform2f(n.projectionVector,s.x,-s.y),r.uniform2f(n.offsetVector,-o.x,-o.y),r.uniform3fv(n.tintColor,T.hex2rgb(t.tint)),r.uniform3fv(n.color,e.color),r.uniform1f(n.alpha,t.worldAlpha*e.alpha),r.bindBuffer(r.ARRAY_BUFFER,e.buffer),r.vertexAttribPointer(n.aVertexPosition,2,r.FLOAT,!1,8,0)):(n=i.shaderManager.primitiveShader,i.shaderManager.setShader(n),r.uniformMatrix3fv(n.translationMatrix,!1,t.worldTransform.toArray(!0)),r.uniform1f(n.flipY,i.flipY),r.uniform2f(n.projectionVector,s.x,-s.y),r.uniform2f(n.offsetVector,-o.x,-o.y),r.uniform3fv(n.tintColor,T.hex2rgb(t.tint)),r.uniform1f(n.alpha,t.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,e.buffer),r.vertexAttribPointer(n.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(n.colorAttribute,4,r.FLOAT,!1,24,8)),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.indexBuffer)},T.WebGLStencilManager.prototype.popStencil=function(t,e,i){var n,r=this.gl;this.stencilStack.pop(),this.count--,0===this.stencilStack.length?r.disable(r.STENCIL_TEST):(n=this.count,this.bindGraphics(t,e,i),r.colorMask(!1,!1,!1,!1),1===e.mode?(this.reverse=!this.reverse,this.reverse?(r.stencilFunc(r.EQUAL,255-(n+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,n+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(e.indices.length-4)),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),r.drawElements(r.TRIANGLE_FAN,e.indices.length-4,r.UNSIGNED_SHORT,0)):(this.reverse?(r.stencilFunc(r.EQUAL,n+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,255-(n+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_STRIP,e.indices.length,r.UNSIGNED_SHORT,0)),this.reverse?r.stencilFunc(r.EQUAL,n,255):r.stencilFunc(r.EQUAL,255-n,255),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP))},T.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null,this.gl=null},T.WebGLShaderManager=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.stack=[]},T.WebGLShaderManager.prototype.constructor=T.WebGLShaderManager,T.WebGLShaderManager.prototype.setContext=function(t){this.gl=t,this.primitiveShader=new T.PrimitiveShader(t),this.complexPrimitiveShader=new T.ComplexPrimitiveShader(t),this.defaultShader=new T.PixiShader(t),this.fastShader=new T.PixiFastShader(t),this.stripShader=new T.StripShader(t),this.setShader(this.defaultShader)},T.WebGLShaderManager.prototype.setAttribs=function(t){for(var e=0;e<this.tempAttribState.length;e++)this.tempAttribState[e]=!1;for(e=0;e<t.length;e++){var i=t[e];this.tempAttribState[i]=!0}var n=this.gl;for(e=0;e<this.attribState.length;e++)this.attribState[e]!==this.tempAttribState[e]&&(this.attribState[e]=this.tempAttribState[e],this.tempAttribState[e]?n.enableVertexAttribArray(e):n.disableVertexAttribArray(e))},T.WebGLShaderManager.prototype.setShader=function(t){return this._currentId!==t._UID&&(this._currentId=t._UID,this.currentShader=t,this.gl.useProgram(t.program),this.setAttribs(t.attributes),!0)},T.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},T.WebGLSpriteBatch=function(){this.vertSize=5,this.size=2e3;var t=4*this.size*4*this.vertSize,e=6*this.size;this.vertices=new T.ArrayBuffer(t),this.positions=new T.Float32Array(this.vertices),this.colors=new T.Uint32Array(this.vertices),this.indices=new T.Uint16Array(e);for(var i=this.lastIndexCount=0,n=0;i<e;i+=6,n+=4)this.indices[i+0]=n+0,this.indices[i+1]=n+1,this.indices[i+2]=n+2,this.indices[i+3]=n+0,this.indices[i+4]=n+2,this.indices[i+5]=n+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=new T.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])},T.WebGLSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),this.currentBlendMode=99999;var e=new T.PixiShader(t);e.fragmentSrc=this.defaultShader.fragmentSrc,e.uniforms={},e.init(),this.defaultShader.shaders[t.id]=e},T.WebGLSpriteBatch.prototype.begin=function(t){this.renderSession=t,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},T.WebGLSpriteBatch.prototype.end=function(){this.flush()},T.WebGLSpriteBatch.prototype.render=function(t,e){var i=t.texture,n=t.worldTransform;e&&(n=e),this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=i.baseTexture);var r,s,o,a,l,p,h,u,c,d,_=i._uvs;_&&(u=t.anchor.x,c=t.anchor.y,i.trim?(s=(r=(h=i.trim).x-u*h.width)+i.crop.width,a=(o=h.y-c*h.height)+i.crop.height):(s=i.frame.width*(1-u),r=i.frame.width*-u,a=i.frame.height*(1-c),o=i.frame.height*-c),l=4*this.currentBatchSize*this.vertSize,d=i.baseTexture.resolution,p=n.a/d,e=n.b/d,h=n.c/d,u=n.d/d,c=n.tx,i=n.ty,d=this.colors,n=this.positions,this.renderSession.roundPixels?(n[l]=p*r+h*o+c|0,n[1+l]=u*o+e*r+i|0,n[5+l]=p*s+h*o+c|0,n[6+l]=u*o+e*s+i|0,n[10+l]=p*s+h*a+c|0,n[11+l]=u*a+e*s+i|0,n[15+l]=p*r+h*a+c|0,n[16+l]=u*a+e*r+i|0):(n[l]=p*r+h*o+c,n[1+l]=u*o+e*r+i,n[5+l]=p*s+h*o+c,n[6+l]=u*o+e*s+i,n[10+l]=p*s+h*a+c,n[11+l]=u*a+e*s+i,n[15+l]=p*r+h*a+c,n[16+l]=u*a+e*r+i),n[2+l]=_.x0,n[3+l]=_.y0,n[7+l]=_.x1,n[8+l]=_.y1,n[12+l]=_.x2,n[13+l]=_.y2,n[17+l]=_.x3,n[18+l]=_.y3,_=t.tint,d[4+l]=d[9+l]=d[14+l]=d[19+l]=(_>>16)+(65280&_)+((255&_)<<16)+(255*t.worldAlpha<<24),this.sprites[this.currentBatchSize++]=t)},T.WebGLSpriteBatch.prototype.renderTilingSprite=function(t){var e=t.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=e.baseTexture),t._uvs||(t._uvs=new T.TextureUvs);var i=t._uvs,n=e.baseTexture.width,r=e.baseTexture.height;t.tilePosition.x%=n*t.tileScaleOffset.x,t.tilePosition.y%=r*t.tileScaleOffset.y;var s=t.tilePosition.x/(n*t.tileScaleOffset.x),o=t.tilePosition.y/(r*t.tileScaleOffset.y),a=t.width/n/(t.tileScale.x*t.tileScaleOffset.x),l=t.height/r/(t.tileScale.y*t.tileScaleOffset.y);i.x0=0-s,i.y0=0-o,i.x1=a-s,i.y1=0-o,i.x2=a-s,i.y2=l-o,i.x3=0-s,i.y3=l-o;var p=t.tint,h=(p>>16)+(65280&p)+((255&p)<<16)+(255*t.worldAlpha<<24),u=this.positions,c=this.colors,d=t.width,_=t.height,y=t.anchor.x,n=t.anchor.y,r=d*(1-y),a=d*-y,s=_*(1-n),l=_*-n,o=4*this.currentBatchSize*this.vertSize,p=e.baseTexture.resolution,d=t.worldTransform,y=d.a/p,_=d.b/p,n=d.c/p,e=d.d/p,p=d.tx,d=d.ty;u[o++]=y*a+n*l+p,u[o++]=e*l+_*a+d,u[o++]=i.x0,u[o++]=i.y0,c[o++]=h,u[o++]=y*r+n*l+p,u[o++]=e*l+_*r+d,u[o++]=i.x1,u[o++]=i.y1,c[o++]=h,u[o++]=y*r+n*s+p,u[o++]=e*s+_*r+d,u[o++]=i.x2,u[o++]=i.y2,c[o++]=h,u[o++]=y*a+n*s+p,u[o++]=e*s+_*a+d,u[o++]=i.x3,u[o++]=i.y3,c[+o]=h,this.sprites[this.currentBatchSize++]=t},T.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t,e,i=this.gl;this.dirty&&(this.dirty=!1,i.activeTexture(i.TEXTURE0),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t=this.defaultShader.shaders[i.id],e=4*this.vertSize,i.vertexAttribPointer(t.aVertexPosition,2,i.FLOAT,!1,e,0),i.vertexAttribPointer(t.aTextureCoord,2,i.FLOAT,!1,e,8),i.vertexAttribPointer(t.colorAttribute,4,i.UNSIGNED_BYTE,!0,e,16)),this.currentBatchSize>.5*this.size?i.bufferSubData(i.ARRAY_BUFFER,0,this.vertices):(e=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize),i.bufferSubData(i.ARRAY_BUFFER,0,e));for(var n,r,s,o,a,l=0,p=0,h=null,u=this.renderSession.blendModeManager.currentBlendMode,c=null,d=0,_=this.currentBatchSize;d<_;d++){n=((s=this.sprites[d]).tilingTexture||s.texture).baseTexture,o=u!==(r=s.blendMode),a=c!==(y=s.shader||this.defaultShader);var y,f=n.skipRender;f&&0<s.children.length&&(f=!1),(h!==n&&!f||o||a)&&(this.renderBatch(h,l,p),p=d,l=0,h=n,o&&(u=r,this.renderSession.blendModeManager.setBlendMode(u)),a)&&((t=(c=y).shaders[i.id])||((t=new T.PixiShader(i)).fragmentSrc=c.fragmentSrc,t.uniforms=c.uniforms,t.init(),c.shaders[i.id]=t),this.renderSession.shaderManager.setShader(t),t.dirty&&t.syncUniforms(),y=this.renderSession.projection,i.uniform2f(t.projectionVector,y.x,y.y),y=this.renderSession.offset,i.uniform2f(t.offsetVector,y.x,y.y)),l++}this.renderBatch(h,l,p),this.currentBatchSize=0}},T.WebGLSpriteBatch.prototype.renderBatch=function(t,e,i){if(0!==e){var n=this.gl;if(t._dirty[n.id]){if(!this.renderSession.renderer.updateTexture(t))return}else n.bindTexture(n.TEXTURE_2D,t._glTextures[n.id]);n.drawElements(n.TRIANGLES,6*e,n.UNSIGNED_SHORT,6*i*2),this.renderSession.drawCount++}},T.WebGLSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},T.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},T.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},T.WebGLFastSpriteBatch=function(t){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var e=4*this.size*this.vertSize,i=6*this.maxSize;this.vertices=new T.Float32Array(e),this.indices=new T.Uint16Array(i),this.vertexBuffer=null,this.indexBuffer=null;for(var n=this.lastIndexCount=0,r=0;n<i;n+=6,r+=4)this.indices[n+0]=r+0,this.indices[n+1]=r+1,this.indices[n+2]=r+2,this.indices[n+3]=r+0,this.indices[n+4]=r+2,this.indices[n+5]=r+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(t)},T.WebGLFastSpriteBatch.prototype.constructor=T.WebGLFastSpriteBatch,T.WebGLFastSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW)},T.WebGLFastSpriteBatch.prototype.begin=function(t,e){this.renderSession=e,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=t.worldTransform.toArray(!0),this.start()},T.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},T.WebGLFastSpriteBatch.prototype.render=function(t){var e=t.children,t=e[0];if(t.texture._uvs){this.currentBaseTexture=t.texture.baseTexture,t.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(t.blendMode));for(var i=0,n=e.length;i<n;i++)this.renderSprite(e[i]);this.flush()}},T.WebGLFastSpriteBatch.prototype.renderSprite=function(t){var e,i,n,r,s,o,a;t.visible&&(t.texture.baseTexture===this.currentBaseTexture||t.texture.baseTexture.skipRender||(this.flush(),this.currentBaseTexture=t.texture.baseTexture,t.texture._uvs))&&(e=this.vertices,a=t.texture._uvs,t.texture.frame.width,t.texture.frame.height,t.texture.trim?(r=(n=(i=t.texture.trim).x-t.anchor.x*i.width)+t.texture.crop.width,o=(s=i.y-t.anchor.y*i.height)+t.texture.crop.height):(r=t.texture.frame.width*(1-t.anchor.x),n=t.texture.frame.width*-t.anchor.x,o=t.texture.frame.height*(1-t.anchor.y),s=t.texture.frame.height*-t.anchor.y),i=4*this.currentBatchSize*this.vertSize,e[i++]=n,e[i++]=s,e[i++]=t.position.x,e[i++]=t.position.y,e[i++]=t.scale.x,e[i++]=t.scale.y,e[i++]=t.rotation,e[i++]=a.x0,e[i++]=a.y1,e[i++]=t.alpha,e[i++]=r,e[i++]=s,e[i++]=t.position.x,e[i++]=t.position.y,e[i++]=t.scale.x,e[i++]=t.scale.y,e[i++]=t.rotation,e[i++]=a.x1,e[i++]=a.y1,e[i++]=t.alpha,e[i++]=r,e[i++]=o,e[i++]=t.position.x,e[i++]=t.position.y,e[i++]=t.scale.x,e[i++]=t.scale.y,e[i++]=t.rotation,e[i++]=a.x2,e[i++]=a.y2,e[i++]=t.alpha,e[i++]=n,e[i++]=o,e[i++]=t.position.x,e[i++]=t.position.y,e[i++]=t.scale.x,e[i++]=t.scale.y,e[i++]=t.rotation,e[i++]=a.x3,e[i++]=a.y3,e[i++]=t.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush())},T.WebGLFastSpriteBatch.prototype.flush=function(){var t,e;0!==this.currentBatchSize&&(t=this.gl,this.currentBaseTexture._glTextures[t.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,t),t.bindTexture(t.TEXTURE_2D,this.currentBaseTexture._glTextures[t.id]),this.currentBatchSize>.5*this.size?t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices):(e=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize),t.bufferSubData(t.ARRAY_BUFFER,0,e)),t.drawElements(t.TRIANGLES,6*this.currentBatchSize,t.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++)},T.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},T.WebGLFastSpriteBatch.prototype.start=function(){var t=this.gl;t.activeTexture(t.TEXTURE0),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.renderSession.projection;t.uniform2f(this.shader.projectionVector,e.x,e.y),t.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);e=4*this.vertSize;t.vertexAttribPointer(this.shader.aVertexPosition,2,t.FLOAT,!1,e,0),t.vertexAttribPointer(this.shader.aPositionCoord,2,t.FLOAT,!1,e,8),t.vertexAttribPointer(this.shader.aScale,2,t.FLOAT,!1,e,16),t.vertexAttribPointer(this.shader.aRotation,1,t.FLOAT,!1,e,24),t.vertexAttribPointer(this.shader.aTextureCoord,2,t.FLOAT,!1,e,28),t.vertexAttribPointer(this.shader.colorAttribute,1,t.FLOAT,!1,e,36)},T.WebGLFilterManager=function(){this.filterStack=[],this.offsetX=0,this.offsetY=0},T.WebGLFilterManager.prototype.constructor=T.WebGLFilterManager,T.WebGLFilterManager.prototype.setContext=function(t){this.gl=t,this.texturePool=[],this.initShaderBuffers()},T.WebGLFilterManager.prototype.begin=function(t,e){this.renderSession=t,this.defaultShader=t.shaderManager.defaultShader;t=this.renderSession.projection;this.width=2*t.x,this.height=2*-t.y,this.buffer=e},T.WebGLFilterManager.prototype.pushFilter=function(t){var e=this.gl,i=this.renderSession.projection,n=this.renderSession.offset;t._filterArea=t.target.filterArea||t.target.getBounds(),t._previous_stencil_mgr=this.renderSession.stencilManager,this.renderSession.stencilManager=new T.WebGLStencilManager,this.renderSession.stencilManager.setContext(e),e.disable(e.STENCIL_TEST),this.filterStack.push(t);var r=t.filterPasses[0];this.offsetX+=t._filterArea.x,this.offsetY+=t._filterArea.y;var s=this.texturePool.pop();s?s.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution):s=new T.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),e.bindTexture(e.TEXTURE_2D,s.texture);var o=t._filterArea,r=r.padding;o.x-=r,o.y-=r,o.width+=2*r,o.height+=2*r,o.x<0&&(o.x=0),o.width>this.width&&(o.width=this.width),o.y<0&&(o.y=0),o.height>this.height&&(o.height=this.height),e.bindFramebuffer(e.FRAMEBUFFER,s.frameBuffer),e.viewport(0,0,o.width*this.renderSession.resolution,o.height*this.renderSession.resolution),i.x=o.width/2,i.y=-o.height/2,n.x=-o.x,n.y=-o.y,e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),t._glFilterTexture=s},T.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl,e=this.filterStack.pop(),i=e._filterArea,n=e._glFilterTexture,r=this.renderSession.projection,s=this.renderSession.offset;if(1<e.filterPasses.length){t.viewport(0,0,i.width*this.renderSession.resolution,i.height*this.renderSession.resolution),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=i.height,this.vertexArray[2]=i.width,this.vertexArray[3]=i.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=i.width,this.vertexArray[7]=0,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=i.width/this.width,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);var o=n;(p=(p=this.texturePool.pop())||new T.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)).resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),t.bindFramebuffer(t.FRAMEBUFFER,p.frameBuffer),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.BLEND);for(var a=0;a<e.filterPasses.length-1;a++){var l=e.filterPasses[a];t.bindFramebuffer(t.FRAMEBUFFER,p.frameBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,o.texture),this.applyFilterPass(l,i,i.width,i.height);var l=o,o=p,p=l}t.enable(t.BLEND),n=o,this.texturePool.push(p)}var h=e.filterPasses[e.filterPasses.length-1];this.offsetX-=i.x,this.offsetY-=i.y;var u,c=this.width,d=this.height,_=0,y=0,f=this.buffer;0===this.filterStack.length?t.colorMask(!0,!0,!0,!0):(c=(i=(u=this.filterStack[this.filterStack.length-1])._filterArea).width,d=i.height,_=i.x,y=i.y,f=u._glFilterTexture.frameBuffer),r.x=c/2,r.y=-d/2,s.x=_,s.y=y;_=(i=e._filterArea).x-_,y=i.y-y;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=_,this.vertexArray[1]=y+i.height,this.vertexArray[2]=_+i.width,this.vertexArray[3]=y+i.height,this.vertexArray[4]=_,this.vertexArray[5]=y,this.vertexArray[6]=_+i.width,this.vertexArray[7]=y,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=i.width/this.width,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),t.viewport(0,0,c*this.renderSession.resolution,d*this.renderSession.resolution),t.bindFramebuffer(t.FRAMEBUFFER,f),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,n.texture),this.renderSession.stencilManager&&this.renderSession.stencilManager.destroy(),this.renderSession.stencilManager=e._previous_stencil_mgr,e._previous_stencil_mgr=null,0<this.renderSession.stencilManager.count?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.applyFilterPass(h,i,c,d),this.texturePool.push(n),e._glFilterTexture=null},T.WebGLFilterManager.prototype.applyFilterPass=function(t,e,i,n){var r=this.gl,s=t.shaders[r.id];s||((s=new T.PixiShader(r)).fragmentSrc=t.fragmentSrc,s.uniforms=t.uniforms,s.init(),t.shaders[r.id]=s),this.renderSession.shaderManager.setShader(s),r.uniform2f(s.projectionVector,i/2,-n/2),r.uniform2f(s.offsetVector,0,0),t.uniforms.dimensions&&(t.uniforms.dimensions.value[0]=this.width,t.uniforms.dimensions.value[1]=this.height,t.uniforms.dimensions.value[2]=this.vertexArray[0],t.uniforms.dimensions.value[3]=this.vertexArray[5]),s.syncUniforms(),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),r.vertexAttribPointer(s.aVertexPosition,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this.uvBuffer),r.vertexAttribPointer(s.aTextureCoord,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this.colorBuffer),r.vertexAttribPointer(s.colorAttribute,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer),r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0),this.renderSession.drawCount++},T.WebGLFilterManager.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.vertexArray=new T.Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW),this.uvArray=new T.Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW),this.colorArray=new T.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)},T.WebGLFilterManager.prototype.destroy=function(){var t=this.gl;this.filterStack=null,this.offsetX=0;for(var e=this.offsetY=0;e<this.texturePool.length;e++)this.texturePool[e].destroy();this.texturePool=null,t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.uvBuffer),t.deleteBuffer(this.colorBuffer),t.deleteBuffer(this.indexBuffer)},T.FilterTexture=function(t,e,i,n){this.gl=t,this.frameBuffer=t.createFramebuffer(),this.texture=t.createTexture(),n=n||T.scaleModes.DEFAULT,t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,n===T.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n===T.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0),this.renderBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.renderBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderBuffer),this.resize(e,i)},T.FilterTexture.prototype.constructor=T.FilterTexture,T.FilterTexture.prototype.clear=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},T.FilterTexture.prototype.resize=function(t,e){var i;this.width===t&&this.height===e||(this.width=t,this.height=e,(i=this.gl).bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,e))},T.FilterTexture.prototype.destroy=function(){var t=this.gl;t.deleteFramebuffer(this.frameBuffer),t.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},T.CanvasBuffer=function(t,e){this.width=t,this.height=e,this.canvas=T.CanvasPool.create(this,this.width,this.height),this.context=this.canvas.getContext("2d"),this.canvas.width=t,this.canvas.height=e},T.CanvasBuffer.prototype.constructor=T.CanvasBuffer,T.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height)},T.CanvasBuffer.prototype.resize=function(t,e){this.width=this.canvas.width=t,this.height=this.canvas.height=e},T.CanvasBuffer.prototype.destroy=function(){T.CanvasPool.remove(this)},T.CanvasMaskManager=function(){},T.CanvasMaskManager.prototype.constructor=T.CanvasMaskManager,T.CanvasMaskManager.prototype.pushMask=function(t,e){var i=e.context;i.save();var n=t.alpha,r=t.worldTransform,e=e.resolution;i.setTransform(r.a*e,r.b*e,r.c*e,r.d*e,r.tx*e,r.ty*e),T.CanvasGraphics.renderGraphicsMask(t,i),i.clip(),t.worldAlpha=n},T.CanvasMaskManager.prototype.popMask=function(t){t.context.restore()},T.CanvasTinter=function(){},T.CanvasTinter.getTintedTexture=function(t,e){var i=t.tintedTexture||T.CanvasPool.create(this);return T.CanvasTinter.tintMethod(t.texture,e,i),i},T.CanvasTinter.tintWithMultiply=function(t,e,i){var n=i.getContext("2d"),r=t.crop;i.width===r.width&&i.height===r.height||(i.width=r.width,i.height=r.height),n.clearRect(0,0,r.width,r.height),n.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),n.fillRect(0,0,r.width,r.height),n.globalCompositeOperation="multiply",n.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height),n.globalCompositeOperation="destination-atop",n.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)},T.CanvasTinter.tintWithPerPixel=function(t,e,i){var n=i.getContext("2d"),r=t.crop;i.width=r.width,i.height=r.height,n.globalCompositeOperation="copy",n.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height);for(var s,e=T.hex2rgb(e),o=e[0],a=e[1],l=e[2],r=n.getImageData(0,0,r.width,r.height),p=r.data,h=0;h<p.length;h+=4)p[h+0]*=o,p[h+1]*=a,p[h+2]*=l,T.CanvasTinter.canHandleAlpha||(s=p[h+3],p[h+0]/=255/s,p[h+1]/=255/s,p[h+2]/=255/s);n.putImageData(r,0,0)},T.CanvasTinter.checkInverseAlpha=function(){var t=new T.CanvasBuffer(2,1);t.context.fillStyle="rgba(10, 20, 30, 0.5)",t.context.fillRect(0,0,1,1);var e=t.context.getImageData(0,0,1,1);if(null===e)return!1;t.context.putImageData(e,1,0);t=t.context.getImageData(1,0,1,1);return t.data[0]===e.data[0]&&t.data[1]===e.data[1]&&t.data[2]===e.data[2]&&t.data[3]===e.data[3]},T.CanvasTinter.canHandleAlpha=T.CanvasTinter.checkInverseAlpha(),T.CanvasTinter.canUseMultiply=T.canUseNewCanvasBlendModes(),T.CanvasTinter.tintMethod=T.CanvasTinter.canUseMultiply?T.CanvasTinter.tintWithMultiply:T.CanvasTinter.tintWithPerPixel,T.CanvasRenderer=function(t){this.game=t,T.defaultRenderer||(T.defaultRenderer=this),this.type=T.CANVAS_RENDERER,this.resolution=t.resolution,this.clearBeforeRender=t.clearBeforeRender,this.transparent=t.transparent,this.autoResize=!1,this.width=t.width*this.resolution,this.height=t.height*this.resolution,this.view=t.canvas,this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.count=0,this.maskManager=new T.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:Phaser.Canvas.getSmoothingPrefix(this.context),roundPixels:!1},this.mapBlendModes(),this.resize(this.width,this.height)},T.CanvasRenderer.prototype.constructor=T.CanvasRenderer,T.CanvasRenderer.prototype.render=function(t){this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=0,this.renderSession.shakeX=this.game.camera._shake.x,this.renderSession.shakeY=this.game.camera._shake.y,this.context.globalCompositeOperation="source-over",navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):t._bgColor&&(this.context.fillStyle=t._bgColor.rgba,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(t)},T.CanvasRenderer.prototype.destroy=function(t){void 0===t&&(t=!0),t&&this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.context=null,this.maskManager=null,this.renderSession=null},T.CanvasRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.renderSession.smoothProperty&&(this.context[this.renderSession.smoothProperty]=this.renderSession.scaleMode===T.scaleModes.LINEAR)},T.CanvasRenderer.prototype.renderDisplayObject=function(t,e,i){this.renderSession.context=e||this.context,this.renderSession.resolution=this.resolution,t._renderCanvas(this.renderSession,i)},T.CanvasRenderer.prototype.mapBlendModes=function(){var t,e,i;T.blendModesCanvas||(t=[],e=T.blendModes,i=T.canUseNewCanvasBlendModes(),t[e.NORMAL]="source-over",t[e.ADD]="lighter",t[e.MULTIPLY]=i?"multiply":"source-over",t[e.SCREEN]=i?"screen":"source-over",t[e.OVERLAY]=i?"overlay":"source-over",t[e.DARKEN]=i?"darken":"source-over",t[e.LIGHTEN]=i?"lighten":"source-over",t[e.COLOR_DODGE]=i?"color-dodge":"source-over",t[e.COLOR_BURN]=i?"color-burn":"source-over",t[e.HARD_LIGHT]=i?"hard-light":"source-over",t[e.SOFT_LIGHT]=i?"soft-light":"source-over",t[e.DIFFERENCE]=i?"difference":"source-over",t[e.EXCLUSION]=i?"exclusion":"source-over",t[e.HUE]=i?"hue":"source-over",t[e.SATURATION]=i?"saturation":"source-over",t[e.COLOR]=i?"color":"source-over",t[e.LUMINOSITY]=i?"luminosity":"source-over",T.blendModesCanvas=t)},T.BaseTexture=function(t,e){this.resolution=1,this.width=100,this.height=100,this.scaleMode=e||T.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=t,this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this._dirty=[!0,!0,!0,!0],t&&((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height&&(this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty()),this.skipRender=!1,this._powerOf2=!1)},T.BaseTexture.prototype.constructor=T.BaseTexture,T.BaseTexture.prototype.forceLoaded=function(t,e){this.hasLoaded=!0,this.width=t,this.height=e,this.dirty()},T.BaseTexture.prototype.destroy=function(){this.source&&T.CanvasPool.removeByCanvas(this.source),this.source=null,this.unloadFromGPU()},T.BaseTexture.prototype.updateSourceImage=function(t){console.warn("PIXI.BaseTexture.updateSourceImage is deprecated. Use Phaser.Sprite.loadTexture instead.")},T.BaseTexture.prototype.dirty=function(){for(var t=0;t<this._glTextures.length;t++)this._dirty[t]=!0},T.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var t=this._glTextures.length-1;0<=t;t--){var e=this._glTextures[t],i=T.glContexts[t];i&&e&&i.deleteTexture(e)}this._glTextures.length=0,this.dirty()},T.BaseTexture.fromCanvas=function(t,e){return 0===t.width&&(t.width=1),0===t.height&&(t.height=1),new T.BaseTexture(t,e)},T.TextureSilentFail=!1,T.Texture=function(t,e,i,n){this.noFrame=!1,e||(this.noFrame=!0,e=new T.Rectangle(0,0,1,1)),t instanceof T.Texture&&(t=t.baseTexture),this.baseTexture=t,this.frame=e,this.trim=n,this.valid=!1,this.isTiling=!1,this.requiresUpdate=!1,this.requiresReTint=!1,this._uvs=null,this.width=0,this.height=0,this.crop=i||new T.Rectangle(0,0,1,1),t.hasLoaded&&(this.noFrame&&(e=new T.Rectangle(0,0,t.width,t.height)),this.setFrame(e))},T.Texture.prototype.constructor=T.Texture,T.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;this.noFrame&&(this.frame=new T.Rectangle(0,0,t.width,t.height)),this.setFrame(this.frame)},T.Texture.prototype.destroy=function(t){t&&this.baseTexture.destroy(),this.valid=!1},T.Texture.prototype.setFrame=function(t){if(this.noFrame=!1,this.frame=t,this.width=t.width,this.height=t.height,this.crop.x=t.x,this.crop.y=t.y,this.crop.width=t.width,this.crop.height=t.height,this.trim||!(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height))this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs();else{if(!T.TextureSilentFail)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=!1}},T.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new T.TextureUvs);var t=this.crop,e=this.baseTexture.width,i=this.baseTexture.height;this._uvs.x0=t.x/e,this._uvs.y0=t.y/i,this._uvs.x1=(t.x+t.width)/e,this._uvs.y1=t.y/i,this._uvs.x2=(t.x+t.width)/e,this._uvs.y2=(t.y+t.height)/i,this._uvs.x3=t.x/e,this._uvs.y3=(t.y+t.height)/i},T.Texture.fromCanvas=function(t,e){e=T.BaseTexture.fromCanvas(t,e);return new T.Texture(e)},T.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},T.RenderTexture=function(t,e,i,n,r){this.width=t||100,this.height=e||100,this.resolution=r||1,this.frame=new T.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new T.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new T.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=n||T.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,T.Texture.call(this,this.baseTexture,new T.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution)),this.renderer=i||T.defaultRenderer,this.renderer.type===T.WEBGL_RENDERER?(i=this.renderer.gl,this.baseTexture._dirty[i.id]=!1,this.textureBuffer=new T.FilterTexture(i,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[i.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new T.Point(.5*this.width,.5*-this.height)):(this.render=this.renderCanvas,this.textureBuffer=new T.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas),this.valid=!0,this.tempMatrix=new Phaser.Matrix,this._updateUvs()},T.RenderTexture.prototype=Object.create(T.Texture.prototype),T.RenderTexture.prototype.constructor=T.RenderTexture,T.RenderTexture.prototype.resize=function(t,e,i){t===this.width&&e===this.height||(this.valid=0<t&&0<e,this.width=t,this.height=e,this.frame.width=this.crop.width=t*this.resolution,this.frame.height=this.crop.height=e*this.resolution,i&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===T.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width,this.height))},T.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===T.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},T.RenderTexture.prototype.renderWebGL=function(t,e,i){if(this.valid&&0!==t.alpha){var n=t.worldTransform;n.identity(),n.translate(0,2*this.projection.y),e&&n.append(e),n.scale(1,-1);for(var r=0;r<t.children.length;r++)t.children[r].updateTransform();n=this.renderer.gl;n.viewport(0,0,this.width*this.resolution,this.height*this.resolution),n.bindFramebuffer(n.FRAMEBUFFER,this.textureBuffer.frameBuffer),i&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer,e),this.renderer.spriteBatch.dirty=!0}},T.RenderTexture.prototype.renderCanvas=function(t,e,i){if(this.valid&&0!==t.alpha){var n=t.worldTransform;n.identity(),e&&n.append(e);for(var r=0;r<t.children.length;r++)t.children[r].updateTransform();i&&this.textureBuffer.clear();i=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(t,this.textureBuffer.context,e),this.renderer.resolution=i}},T.RenderTexture.prototype.getImage=function(){var t=new Image;return t.src=this.getBase64(),t},T.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},T.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type!==T.WEBGL_RENDERER)return this.textureBuffer.canvas;var t=this.renderer.gl,e=this.textureBuffer.width,i=this.textureBuffer.height,n=new Uint8Array(4*e*i);t.bindFramebuffer(t.FRAMEBUFFER,this.textureBuffer.frameBuffer),t.readPixels(0,0,e,i,t.RGBA,t.UNSIGNED_BYTE,n),t.bindFramebuffer(t.FRAMEBUFFER,null);t=new T.CanvasBuffer(e,i),i=t.context.getImageData(0,0,e,i);return i.data.set(n),t.context.putImageData(i,0,0),t.canvas},T.AbstractFilter=function(t,e){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=e||{},this.fragmentSrc=t||[]},T.AbstractFilter.prototype.constructor=T.AbstractFilter,T.AbstractFilter.prototype.syncUniforms=function(){for(var t=0,e=this.shaders.length;t<e;t++)this.shaders[t].dirty=!0},T.Strip=function(t){T.DisplayObjectContainer.call(this),this.texture=t,this.uvs=new T.Float32Array([0,1,1,1,1,0,0,1]),this.vertices=new T.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new T.Float32Array([1,1,1,1]),this.indices=new T.Uint16Array([0,1,2,3]),this.dirty=!0,this.blendMode=T.blendModes.NORMAL,this.canvasPadding=0,this.drawMode=T.Strip.DrawModes.TRIANGLE_STRIP},T.Strip.prototype=Object.create(T.DisplayObjectContainer.prototype),T.Strip.prototype.constructor=T.Strip,T.Strip.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||(t.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(t),t.shaderManager.setShader(t.shaderManager.stripShader),this._renderStrip(t),t.spriteBatch.start())},T.Strip.prototype._initWebGL=function(t){t=t.gl;this._vertexBuffer=t.createBuffer(),this._indexBuffer=t.createBuffer(),this._uvBuffer=t.createBuffer(),this._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvs,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW)},T.Strip.prototype._renderStrip=function(t){var e=t.gl,i=t.projection,n=t.offset,r=t.shaderManager.stripShader,s=this.drawMode===T.Strip.DrawModes.TRIANGLE_STRIP?e.TRIANGLE_STRIP:e.TRIANGLES;t.blendModeManager.setBlendMode(this.blendMode),e.uniformMatrix3fv(r.translationMatrix,!1,this.worldTransform.toArray(!0)),e.uniform2f(r.projectionVector,i.x,-i.y),e.uniform2f(r.offsetVector,-n.x,-n.y),e.uniform1f(r.alpha,this.worldAlpha),this.dirty?(this.dirty=!1,e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.STATIC_DRAW),e.vertexAttribPointer(r.aVertexPosition,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW),e.vertexAttribPointer(r.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),this.texture.baseTexture._dirty[e.id]?t.renderer.updateTexture(this.texture.baseTexture):e.bindTexture(e.TEXTURE_2D,this.texture.baseTexture._glTextures[e.id]),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)):(e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices),e.vertexAttribPointer(r.aVertexPosition,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer),e.vertexAttribPointer(r.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),this.texture.baseTexture._dirty[e.id]?t.renderer.updateTexture(this.texture.baseTexture):e.bindTexture(e.TEXTURE_2D,this.texture.baseTexture._glTextures[e.id]),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),e.drawElements(s,this.indices.length,e.UNSIGNED_SHORT,0)},T.Strip.prototype._renderCanvas=function(t){var e=t.context,i=this.worldTransform,n=i.tx*t.resolution+t.shakeX,r=i.ty*t.resolution+t.shakeY;t.roundPixels?e.setTransform(i.a,i.b,i.c,i.d,0|n,0|r):e.setTransform(i.a,i.b,i.c,i.d,n,r),this.drawMode===T.Strip.DrawModes.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(e):this._renderCanvasTriangles(e)},T.Strip.prototype._renderCanvasTriangleStrip=function(t){var e=this.vertices,i=this.uvs,n=e.length/2;this.count++;for(var r=0;r<n-2;r++){var s=2*r;this._renderCanvasDrawTriangle(t,e,i,s,2+s,4+s)}},T.Strip.prototype._renderCanvasTriangles=function(t){var e=this.vertices,i=this.uvs,n=this.indices,r=n.length;this.count++;for(var s=0;s<r;s+=3){var o=2*n[s],a=2*n[s+1],l=2*n[s+2];this._renderCanvasDrawTriangle(t,e,i,o,a,l)}},T.Strip.prototype._renderCanvasDrawTriangle=function(t,e,i,n,r,s){var o=this.texture.baseTexture.source,a=this.texture.width,l=this.texture.height,p=e[n],h=e[r],u=e[s],c=e[n+1],d=e[r+1],_=e[s+1],y=i[n]*a,f=i[r]*a,m=i[s]*a,e=i[n+1]*l,a=i[r+1]*l,n=i[s+1]*l;0<this.canvasPadding&&(r=this.canvasPadding/this.worldTransform.a,g=this.canvasPadding/this.worldTransform.d,x=c-(i=(c+d+_)/3),p=(s=(p+h+u)/3)+(l=p-s)/(v=Math.sqrt(l*l+x*x))*(v+r),c=i+x/v*(v+g),x=d-i,h=s+(l=h-s)/(v=Math.sqrt(l*l+x*x))*(v+r),d=i+x/v*(v+g),x=_-i,u=s+(l=u-s)/(v=Math.sqrt(l*l+x*x))*(v+r),_=i+x/v*(v+g)),t.save(),t.beginPath(),t.moveTo(p,c),t.lineTo(h,d),t.lineTo(u,_),t.closePath(),t.clip();var x=y*a+e*m+f*n-a*m-e*f-y*n,v=p*a+e*u+h*n-a*u-e*h-p*n,g=y*h+p*m+f*u-h*m-p*f-y*u,p=y*a*u+e*h*m+p*f*n-p*a*m-e*f*u-y*h*n,u=c*a+e*_+d*n-a*_-e*d-c*n,h=y*d+c*m+f*_-d*m-c*f-y*_,n=y*a*_+e*d*m+c*f*n-c*a*m-e*f*_-y*d*n;t.transform(v/x,u/x,g/x,h/x,p/x,n/x),t.drawImage(o,0,0),t.restore()},T.Strip.prototype.renderStripFlat=function(t){var e=this.context,i=t.vertices,n=i.length/2;this.count++,e.beginPath();for(var r=1;r<n-2;r++){var s=2*r,o=i[s],a=i[2+s],l=i[4+s],p=i[1+s],h=i[3+s],s=i[5+s];e.moveTo(o,p),e.lineTo(a,h),e.lineTo(l,s)}e.fillStyle="#FF0000",e.fill(),e.closePath()},T.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},T.Strip.prototype.getBounds=function(t){for(var t=t||this.worldTransform,e=t.a,i=t.b,n=t.c,r=t.d,s=t.tx,o=t.ty,a=-1/0,l=-1/0,p=1/0,h=1/0,u=this.vertices,c=0,d=u.length;c<d;c+=2)var _=u[c],y=u[c+1],f=e*_+n*y+s,_=r*y+i*_+o,p=f<p?f:p,h=_<h?_:h,a=a<f?f:a,l=l<_?_:l;if(p===-1/0||l===1/0)return T.EmptyRectangle;t=this._bounds;return t.x=p,t.width=a-p,t.y=h,t.height=l-h,this._currentBounds=t},T.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1},T.Rope=function(t,e){T.Strip.call(this,t),this.points=e,this.vertices=new T.Float32Array(4*e.length),this.uvs=new T.Float32Array(4*e.length),this.colors=new T.Float32Array(2*e.length),this.indices=new T.Uint16Array(2*e.length),this.refresh()},T.Rope.prototype=Object.create(T.Strip.prototype),T.Rope.prototype.constructor=T.Rope,T.Rope.prototype.refresh=function(){var t=this.points;if(!(t.length<1)){var e=this.uvs,i=(t[0],this.indices),n=this.colors;this.count-=.2,e[0]=0,e[1]=0,e[2]=0,e[3]=1,n[0]=1,n[1]=1,i[0]=0,i[1]=1;for(var r,s,o=t.length,a=1;a<o;a++)t[a],s=a/(o-1),e[r=4*a]=s,e[r+1]=0,e[r+2]=s,e[r+3]=1,n[r=2*a]=1,n[r+1]=1,i[r=2*a]=r,i[r+1]=r+1,0}},T.Rope.prototype.updateTransform=function(){var t=this.points;if(!(t.length<1)){var e=t[0],i={x:0,y:0};this.count-=.2;for(var n,r,s,o,a=this.vertices,l=t.length,p=0;p<l;p++)n=t[p],r=4*p,o=p<t.length-1?t[p+1]:n,i.y=-(o.x-e.x),i.x=o.y-e.y,s=Math.sqrt(i.x*i.x+i.y*i.y),o=this.texture.height/2,i.x/=s,i.y/=s,i.x*=o,i.y*=o,a[r]=n.x+i.x,a[1+r]=n.y+i.y,a[2+r]=n.x-i.x,a[3+r]=n.y-i.y,e=n;T.DisplayObjectContainer.prototype.updateTransform.call(this)}},T.Rope.prototype.setTexture=function(t){this.texture=t},T.TilingSprite=function(t,e,i){T.Sprite.call(this,t),this._width=e||128,this._height=i||128,this.tileScale=new T.Point(1,1),this.tileScaleOffset=new T.Point(1,1),this.tilePosition=new T.Point,this.renderable=!0,this.tint=16777215,this.textureDebug=!1,this.blendMode=T.blendModes.NORMAL,this.canvasBuffer=null,this.tilingTexture=null,this.tilePattern=null,this.refreshTexture=!0,this.frameWidth=0,this.frameHeight=0},T.TilingSprite.prototype=Object.create(T.Sprite.prototype),T.TilingSprite.prototype.constructor=T.TilingSprite,T.TilingSprite.prototype.setTexture=function(t){this.texture!==t&&(this.texture=t,this.refreshTexture=!0,this.cachedTint=16777215)},T.TilingSprite.prototype._renderWebGL=function(t){if(this.visible&&this.renderable&&0!==this.alpha){if(this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this.refreshTexture){if(this.generateTilingTexture(!0,t),!this.tilingTexture)return;this.tilingTexture.needsUpdate&&(t.renderer.updateTexture(this.tilingTexture.baseTexture),this.tilingTexture.needsUpdate=!1)}t.spriteBatch.renderTilingSprite(this);for(var e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this._mask,t),t.spriteBatch.start()}},T.TilingSprite.prototype._renderCanvas=function(t){if(this.visible&&this.renderable&&0!==this.alpha){var e=t.context;this._mask&&t.maskManager.pushMask(this._mask,t),e.globalAlpha=this.worldAlpha;var i=this.worldTransform,n=t.resolution,r=i.tx*n+t.shakeX,s=i.ty*n+t.shakeY;if(e.setTransform(i.a*n,i.b*n,i.c*n,i.d*n,r,s),this.refreshTexture){if(this.generateTilingTexture(!1,t),!this.tilingTexture)return;this.tilePattern=e.createPattern(this.tilingTexture.baseTexture.source,"repeat")}var o=t.currentBlendMode;this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,e.globalCompositeOperation=T.blendModesCanvas[t.currentBlendMode]);var a=this.tilePosition,l=this.tileScale;a.x%=this.tilingTexture.baseTexture.width,a.y%=this.tilingTexture.baseTexture.height,e.scale(l.x,l.y),e.translate(a.x+this.anchor.x*-this._width,a.y+this.anchor.y*-this._height),e.fillStyle=this.tilePattern;r=-a.x,s=-a.y,i=this._width/l.x,n=this._height/l.y;t.roundPixels&&(r|=0,s|=0,i|=0,n|=0),e.fillRect(r,s,i,n),e.scale(1/l.x,1/l.y),e.translate(-a.x+this.anchor.x*this._width,-a.y+this.anchor.y*this._height),this._mask&&t.maskManager.popMask(t);for(var p=0;p<this.children.length;p++)this.children[p]._renderCanvas(t);o!==this.blendMode&&(t.currentBlendMode=o,e.globalCompositeOperation=T.blendModesCanvas[o])}},T.TilingSprite.prototype.onTextureUpdate=function(){},T.TilingSprite.prototype.generateTilingTexture=function(t,e){var i,n,r,s,o,a,l;this.texture.baseTexture.hasLoaded&&(n=(i=this.texture).frame,r=this._frame.sourceSizeW||this._frame.width,s=this._frame.sourceSizeH||this._frame.height,a=o=0,this._frame.trimmed&&(o=this._frame.spriteSourceSizeX,a=this._frame.spriteSourceSizeY),t&&(r=T.getNextPowerOfTwo(r),s=T.getNextPowerOfTwo(s)),this.canvasBuffer?(this.canvasBuffer.resize(r,s),this.tilingTexture.baseTexture.width=r,this.tilingTexture.baseTexture.height=s):(this.canvasBuffer=new T.CanvasBuffer(r,s),this.tilingTexture=T.Texture.fromCanvas(this.canvasBuffer.canvas),this.tilingTexture.isTiling=!0),this.tilingTexture.needsUpdate=!0,this.textureDebug&&(this.canvasBuffer.context.strokeStyle="#00ff00",this.canvasBuffer.context.strokeRect(0,0,r,s)),l=i.crop.width,t=i.crop.height,l===r&&t===s||(l=r,t=s),this.canvasBuffer.context.drawImage(i.baseTexture.source,i.crop.x,i.crop.y,i.crop.width,i.crop.height,o,a,l,t),this.tileScaleOffset.x=n.width/r,this.tileScaleOffset.y=n.height/s,this.refreshTexture=!1,this.tilingTexture.baseTexture._powerOf2=!0)},T.TilingSprite.prototype.getBounds=function(){var t=this._width,e=this._height,i=t*(1-this.anchor.x),n=t*-this.anchor.x,r=e*(1-this.anchor.y),s=e*-this.anchor.y,o=this.worldTransform,a=o.a,l=o.b,p=o.c,h=o.d,u=o.tx,c=o.ty,d=a*n+p*s+u,t=h*s+l*n+c,e=a*i+p*s+u,o=h*s+l*i+c,s=a*i+p*r+u,i=h*r+l*i+c,u=a*n+p*r+u,h=h*r+l*n+c,r=-1/0,l=-1/0,n=1/0,c=1/0;n=u<(n=s<(n=e<(n=d<n?d:n)?e:n)?s:n)?u:n,c=h<(c=i<(c=o<(c=t<c?t:c)?o:c)?i:c)?h:c,r=(r=(r=(r=r<d?d:r)<e?e:r)<s?s:r)<u?u:r,l=(l=(l=(l=l<t?t:l)<o?o:l)<i?i:l)<h?h:l;h=this._bounds;return h.x=n,h.width=r-n,h.y=c,h.height=l-c,this._currentBounds=h},T.TilingSprite.prototype.destroy=function(){T.Sprite.prototype.destroy.call(this),this.canvasBuffer&&(this.canvasBuffer.destroy(),this.canvasBuffer=null),this.tileScale=null,this.tileScaleOffset=null,this.tilePosition=null,this.tilingTexture&&(this.tilingTexture.destroy(!0),this.tilingTexture=null)},Object.defineProperty(T.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}}),Object.defineProperty(T.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=T),exports.PIXI=T):"undefined"!=typeof define&&define.amd?define("PIXI",t.PIXI=T):t.PIXI=T,T}.call(this),function(){function n(t,e){this._scaleFactor=t,this._deltaMode=e,this.originalEvent=null}var t,s,e,i,r=this,U=U||{VERSION:"2.6.2",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,CREATURE:27,VIDEO:28,PENDING_ATLAS:-1,HORIZONTAL:0,VERTICAL:1,LANDSCAPE:0,PORTRAIT:1,ANGLE_UP:270,ANGLE_DOWN:90,ANGLE_LEFT:180,ANGLE_RIGHT:0,ANGLE_NORTH_EAST:315,ANGLE_NORTH_WEST:225,ANGLE_SOUTH_EAST:45,ANGLE_SOUTH_WEST:135,TOP_LEFT:0,TOP_CENTER:1,TOP_RIGHT:2,LEFT_TOP:3,LEFT_CENTER:4,LEFT_BOTTOM:5,CENTER:6,RIGHT_TOP:7,RIGHT_CENTER:8,RIGHT_BOTTOM:9,BOTTOM_LEFT:10,BOTTOM_CENTER:11,BOTTOM_RIGHT:12,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1},PIXI:PIXI||{}};for(e in Math.trunc||(Math.trunc=function(t){return t<0?Math.ceil(t):Math.floor(t)}),Function.prototype.bind||(Function.prototype.bind=(s=Array.prototype.slice,function(e){function i(){var t=r.concat(s.call(arguments));n.apply(this instanceof i?this:e,t)}var n=this,r=s.call(arguments,1);if("function"!=typeof n)throw new TypeError;return i.prototype=function t(e){if(e&&(t.prototype=e),!(this instanceof t))return new t}(n.prototype),i})),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.forEach||(Array.prototype.forEach=function(t){"use strict";if(null==this)throw new TypeError;var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var n=2<=arguments.length?arguments[1]:void 0,r=0;r<i;r++)r in e&&t.call(n,e[r],r,e)}),"function"!=typeof window.Uint32Array&&"object"!=typeof window.Uint32Array&&((t=function(t){var e=new Array;window[t]=function(t){if("number"==typeof t){Array.call(this,t),this.length=t;for(var e=0;e<this.length;e++)this[e]=0}else{Array.call(this,t.length),this.length=t.length;for(e=0;e<this.length;e++)this[e]=t[e]}},window[t].prototype=e,window[t].constructor=window[t]})("Uint32Array"),t("Int16Array")),window.console||(window.console={},window.console.log=window.console.assert=function(){},window.console.warn=window.console.assert=function(){}),U.Utils={reverseString:function(t){return t.split("").reverse().join("")},getProperty:function(t,e){for(var i=e.split("."),e=i.pop(),n=i.length,r=1,s=i[0];r<n&&(t=t[s]);)s=i[r],r++;return t?t[e]:null},setProperty:function(t,e,i){for(var n=e.split("."),e=n.pop(),r=n.length,s=1,o=n[0];s<r&&(t=t[o]);)o=n[s],s++;return t&&(t[e]=i),t},chanceRoll:function(t){return void 0===t&&(t=50),0<t&&100*Math.random()<=t},randomChoice:function(t,e){return Math.random()<.5?t:e},parseDimension:function(t,e){var i;return"string"==typeof t?"%"===t.substr(-1)?(i=parseInt(t,10)/100,0===e?window.innerWidth*i:window.innerHeight*i):parseInt(t,10):t},pad:function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=" "),void 0===n&&(n=3);var r;if(e+1>=(t=t.toString()).length)switch(n){case 1:t=new Array(e+1-t.length).join(i)+t;break;case 3:var s=Math.ceil((r=e-t.length)/2);t=new Array(1+(r-s)).join(i)+t+new Array(s+1).join(i);break;default:t+=new Array(e+1-t.length).join(i)}return t},isPlainObject:function(t){if("object"!=typeof t||t.nodeType||t===t.window)return!1;try{if(t.constructor&&!{}.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},extend:function(){var t,e,i,n,r,s=arguments[0]||{},o=1,a=arguments.length,l=!1;for("boolean"==typeof s&&(l=s,s=arguments[1]||{},o=2),a===o&&(s=this,--o);o<a;o++)if(null!=(t=arguments[o]))for(e in t)r=s[e],i=t[e],s!==i&&(l&&i&&(U.Utils.isPlainObject(i)||(n=Array.isArray(i)))?(r=n?(n=!1,r&&Array.isArray(r)?r:[]):r&&U.Utils.isPlainObject(r)?r:{},s[e]=U.Utils.extend(l,r,i)):void 0!==i&&(s[e]=i));return s},mixinPrototype:function(t,e,i){void 0===i&&(i=!1);for(var n=Object.keys(e),r=0;r<n.length;r++){var s=n[r],o=e[s];!i&&s in t||(!o||"function"!=typeof o.get&&"function"!=typeof o.set?t[s]=o:"function"==typeof o.clone?t[s]=o.clone():Object.defineProperty(t,s,o))}},mixin:function(t,e){if(!t||"object"!=typeof t)return e;for(var i in t){var n,r=t[i];r.childNodes||r.cloneNode||(n=typeof t[i],t[i]&&"object"==n?typeof e[i]==n?e[i]=U.Utils.mixin(t[i],e[i]):e[i]=U.Utils.mixin(t[i],new r.constructor):e[i]=t[i])}return e}},U.Circle=function(t,e,i){t=t||0,e=e||0,i=i||0,this.x=t,this.y=e,this._diameter=i,(this._radius=0)<i&&(this._radius=.5*i),this.type=U.CIRCLE},U.Circle.prototype={circumference:function(){return Math.PI*this._radius*2},random:function(t){void 0===t&&(t=new U.Point);var e=2*Math.PI*Math.random(),i=Math.random()+Math.random(),n=1<i?2-i:i,i=n*Math.cos(e),e=n*Math.sin(e);return t.x=this.x+i*this.radius,t.y=this.y+e*this.radius,t},getBounds:function(){return new U.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(t,e,i){return this.x=t,this.y=e,this._diameter=i,this._radius=.5*i,this},copyFrom:function(t){return this.setTo(t.x,t.y,t.diameter)},copyTo:function(t){return t.x=this.x,t.y=this.y,t.diameter=this._diameter,t},distance:function(t,e){t=U.Math.distance(this.x,this.y,t.x,t.y);return e?Math.round(t):t},clone:function(t){return null==t?t=new U.Circle(this.x,this.y,this.diameter):t.setTo(this.x,this.y,this.diameter),t},contains:function(t,e){return U.Circle.contains(this,t,e)},circumferencePoint:function(t,e,i){return U.Circle.circumferencePoint(this,t,e,i)},offset:function(t,e){return this.x+=t,this.y+=e,this},offsetPoint:function(t){return this.offset(t.x,t.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}},U.Circle.prototype.constructor=U.Circle,Object.defineProperty(U.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(t){0<t&&(this._diameter=t,this._radius=.5*t)}}),Object.defineProperty(U.Circle.prototype,"radius",{get:function(){return this._radius},set:function(t){0<t&&(this._radius=t,this._diameter=2*t)}}),Object.defineProperty(U.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(t){t>this.x?(this._radius=0,this._diameter=0):this.radius=this.x-t}}),Object.defineProperty(U.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(t){t<this.x?(this._radius=0,this._diameter=0):this.radius=t-this.x}}),Object.defineProperty(U.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(t){t>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-t}}),Object.defineProperty(U.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(t){t<this.y?(this._radius=0,this._diameter=0):this.radius=t-this.y}}),Object.defineProperty(U.Circle.prototype,"area",{get:function(){return 0<this._radius?Math.PI*this._radius*this._radius:0}}),Object.defineProperty(U.Circle.prototype,"empty",{get:function(){return 0===this._diameter},set:function(t){!0===t&&this.setTo(0,0,0)}}),U.Circle.contains=function(t,e,i){return 0<t.radius&&e>=t.left&&e<=t.right&&i>=t.top&&i<=t.bottom&&(t.x-e)*(t.x-e)+(t.y-i)*(t.y-i)<=t.radius*t.radius},U.Circle.equals=function(t,e){return t.x===e.x&&t.y===e.y&&t.diameter===e.diameter},U.Circle.intersects=function(t,e){return U.Math.distance(t.x,t.y,e.x,e.y)<=t.radius+e.radius},U.Circle.circumferencePoint=function(t,e,i,n){return void 0===i&&(i=!1),void 0===n&&(n=new U.Point),!0===i&&(e=U.Math.degToRad(e)),n.x=t.x+t.radius*Math.cos(e),n.y=t.y+t.radius*Math.sin(e),n},U.Circle.intersectsRectangle=function(t,e){var i=Math.abs(t.x-e.x-e.halfWidth);if(e.halfWidth+t.radius<i)return!1;var n=Math.abs(t.y-e.y-e.halfHeight);if(e.halfHeight+t.radius<n)return!1;if(i<=e.halfWidth||n<=e.halfHeight)return!0;i-=e.halfWidth,e=n-e.halfHeight;return i*i+e*e<=t.radius*t.radius},PIXI.Circle=U.Circle,U.Ellipse=function(t,e,i,n){t=t||0,e=e||0,i=i||0,n=n||0,this.x=t,this.y=e,this.width=i,this.height=n,this.type=U.ELLIPSE},U.Ellipse.prototype={setTo:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},getBounds:function(){return new U.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(t){return this.setTo(t.x,t.y,t.width,t.height)},copyTo:function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},clone:function(t){return null==t?t=new U.Ellipse(this.x,this.y,this.width,this.height):t.setTo(this.x,this.y,this.width,this.height),t},contains:function(t,e){return U.Ellipse.contains(this,t,e)},random:function(t){void 0===t&&(t=new U.Point);var e=Math.random()*Math.PI*2,i=Math.random();return t.x=Math.sqrt(i)*Math.cos(e),t.y=Math.sqrt(i)*Math.sin(e),t.x=this.x+t.x*this.width/2,t.y=this.y+t.y*this.height/2,t},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}},U.Ellipse.prototype.constructor=U.Ellipse,Object.defineProperty(U.Ellipse.prototype,"left",{get:function(){return this.x},set:function(t){this.x=t}}),Object.defineProperty(U.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(t){t<this.x?this.width=0:this.width=t-this.x}}),Object.defineProperty(U.Ellipse.prototype,"top",{get:function(){return this.y},set:function(t){this.y=t}}),Object.defineProperty(U.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){t<this.y?this.height=0:this.height=t-this.y}}),Object.defineProperty(U.Ellipse.prototype,"empty",{get:function(){return 0===this.width||0===this.height},set:function(t){!0===t&&this.setTo(0,0,0,0)}}),U.Ellipse.contains=function(t,e,i){if(t.width<=0||t.height<=0)return!1;e=(e-t.x)/t.width-.5,t=(i-t.y)/t.height-.5;return(e*=e)+(t*=t)<.25},PIXI.Ellipse=U.Ellipse,U.Line=function(t,e,i,n){t=t||0,e=e||0,i=i||0,n=n||0,this.start=new U.Point(t,e),this.end=new U.Point(i,n),this.type=U.LINE},U.Line.prototype={setTo:function(t,e,i,n){return this.start.setTo(t,e),this.end.setTo(i,n),this},fromSprite:function(t,e,i){return void 0===i&&(i=!1),i?this.setTo(t.center.x,t.center.y,e.center.x,e.center.y):this.setTo(t.x,t.y,e.x,e.y)},fromAngle:function(t,e,i,n){return this.start.setTo(t,e),this.end.setTo(t+Math.cos(i)*n,e+Math.sin(i)*n),this},rotate:function(t,e){var i=(this.start.x+this.end.x)/2,n=(this.start.y+this.end.y)/2;return this.start.rotate(i,n,t,e),this.end.rotate(i,n,t,e),this},rotateAround:function(t,e,i,n){return this.start.rotate(t,e,i,n),this.end.rotate(t,e,i,n),this},intersects:function(t,e,i){return U.Line.intersectsPoints(this.start,this.end,t.start,t.end,e,i)},reflect:function(t){return U.Line.reflect(this,t)},midPoint:function(t){return void 0===t&&(t=new U.Point),t.x=(this.start.x+this.end.x)/2,t.y=(this.start.y+this.end.y)/2,t},centerOn:function(t,e){t-=(this.start.x+this.end.x)/2,e-=(this.start.y+this.end.y)/2;this.start.add(t,e),this.end.add(t,e)},pointOnLine:function(t,e){return(t-this.start.x)*(this.end.y-this.start.y)==(this.end.x-this.start.x)*(e-this.start.y)},pointOnSegment:function(t,e){var i=Math.min(this.start.x,this.end.x),n=Math.max(this.start.x,this.end.x),r=Math.min(this.start.y,this.end.y),s=Math.max(this.start.y,this.end.y);return this.pointOnLine(t,e)&&i<=t&&t<=n&&r<=e&&e<=s},random:function(t){void 0===t&&(t=new U.Point);var e=Math.random();return t.x=this.start.x+e*(this.end.x-this.start.x),t.y=this.start.y+e*(this.end.y-this.start.y),t},coordinatesOnLine:function(t,e){void 0===t&&(t=1),void 0===e&&(e=[]);var i=Math.round(this.start.x),n=Math.round(this.start.y),r=Math.round(this.end.x),s=Math.round(this.end.y),o=Math.abs(r-i),a=Math.abs(s-n),l=i<r?1:-1,p=n<s?1:-1,h=o-a;e.push([i,n]);for(var u=1;i!==r||n!==s;){var c=h<<1;-a<c&&(h-=a,i+=l),c<o&&(h+=o,n+=p),u%t==0&&e.push([i,n]),u++}return e},clone:function(t){return null==t?t=new U.Line(this.start.x,this.start.y,this.end.x,this.end.y):t.setTo(this.start.x,this.start.y,this.end.x,this.end.y),t}},Object.defineProperty(U.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}}),Object.defineProperty(U.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}}),Object.defineProperty(U.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}}),Object.defineProperty(U.Line.prototype,"perpSlope",{get:function(){return-((this.end.x-this.start.x)/(this.end.y-this.start.y))}}),Object.defineProperty(U.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(U.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(U.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(U.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}}),Object.defineProperty(U.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(U.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}}),Object.defineProperty(U.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}}),Object.defineProperty(U.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}}),Object.defineProperty(U.Line.prototype,"normalX",{get:function(){return Math.cos(this.angle-1.5707963267948966)}}),Object.defineProperty(U.Line.prototype,"normalY",{get:function(){return Math.sin(this.angle-1.5707963267948966)}}),Object.defineProperty(U.Line.prototype,"normalAngle",{get:function(){return U.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}}),U.Line.intersectsPoints=function(t,e,i,n,r,s){void 0===r&&(r=!0),void 0===s&&(s=new U.Point);var o=e.y-t.y,a=n.y-i.y,l=t.x-e.x,p=i.x-n.x,h=e.x*t.y-t.x*e.y,u=n.x*i.y-i.x*n.y,c=o*p-a*l;if(0==c)return null;if(s.x=(l*u-p*h)/c,s.y=(a*h-o*u)/c,r){r=(n.y-i.y)*(e.x-t.x)-(n.x-i.x)*(e.y-t.y),n=((n.x-i.x)*(t.y-i.y)-(n.y-i.y)*(t.x-i.x))/r,r=((e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x))/r;return 0<=n&&n<=1&&0<=r&&r<=1?s:null}return s},U.Line.intersects=function(t,e,i,n){return U.Line.intersectsPoints(t.start,t.end,e.start,e.end,i,n)},U.Line.intersectsRectangle=function(t,e){if(!U.Rectangle.intersects(t,e))return!1;var i=t.start.x,n=t.start.y,r=t.end.x,s=t.end.y,o=e.x,a=e.y,l=e.right,t=e.bottom,e=0;if(o<=i&&i<=l&&a<=n&&n<=t||o<=r&&r<=l&&a<=s&&s<=t)return!0;if(i<o&&o<=r){if(a<(e=n+(s-n)*(o-i)/(r-i))&&e<=t)return!0}else if(l<i&&r<=l&&(a<=(e=n+(s-n)*(l-i)/(r-i))&&e<=t))return!0;if(n<a&&a<=s){if(o<=(e=i+(r-i)*(a-n)/(s-n))&&e<=l)return!0}else if(t<n&&s<=t&&(o<=(e=i+(r-i)*(t-n)/(s-n))&&e<=l))return!0;return!1},U.Line.reflect=function(t,e){return 2*e.normalAngle-3.141592653589793-t.angle},U.Matrix=function(t,e,i,n,r,s){null!=t||(t=1),null!=e||(e=0),null!=i||(i=0),null!=n||(n=1),null!=r||(r=0),null!=s||(s=0),this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s,this.type=U.MATRIX},U.Matrix.prototype={fromArray:function(t){return this.setTo(t[0],t[1],t[3],t[4],t[2],t[5])},setTo:function(t,e,i,n,r,s){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s,this},clone:function(t){return null==t?t=new U.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty):(t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty),t},copyTo:function(t){return t.copyFrom(this),t},copyFrom:function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},toArray:function(t,e){return void 0===e&&(e=new PIXI.Float32Array(9)),t?(e[0]=this.a,e[1]=this.b,e[2]=0,e[3]=this.c,e[4]=this.d,e[5]=0,e[6]=this.tx,e[7]=this.ty):(e[0]=this.a,e[1]=this.c,e[2]=this.tx,e[3]=this.b,e[4]=this.d,e[5]=this.ty,e[6]=0,e[7]=0),e[8]=1,e},apply:function(t,e){return void 0===e&&(e=new U.Point),e.x=this.a*t.x+this.c*t.y+this.tx,e.y=this.b*t.x+this.d*t.y+this.ty,e},applyInverse:function(t,e){void 0===e&&(e=new U.Point);var i=1/(this.a*this.d+this.c*-this.b),n=t.x,t=t.y;return e.x=this.d*i*n+-this.c*i*t+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*t+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,e},translate:function(t,e){return this.tx+=t,this.ty+=e,this},scale:function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,t=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=t*e-this.ty*i,this.ty=t*i+this.ty*e,this},append:function(t){var e=this.a,i=this.b,n=this.c,r=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*r,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*r,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*r+this.ty,this},identity:function(){return this.setTo(1,0,0,1,0,0)}},U.identityMatrix=new U.Matrix,PIXI.Matrix=U.Matrix,PIXI.identityMatrix=U.identityMatrix,U.Point=function(t,e){t=t||0,e=e||0,this.x=t,this.y=e,this.type=U.POINT},U.Point.prototype={copyFrom:function(t){return this.setTo(t.x,t.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(t,e){return this.x=t||0,this.y=e||(0!==e?this.x:0),this},set:function(t,e){return this.x=t||0,this.y=e||(0!==e?this.x:0),this},add:function(t,e){return this.x+=t,this.y+=e,this},subtract:function(t,e){return this.x-=t,this.y-=e,this},multiply:function(t,e){return this.x*=t,this.y*=e,this},divide:function(t,e){return this.x/=t,this.y/=e,this},clampX:function(t,e){return this.x=U.Math.clamp(this.x,t,e),this},clampY:function(t,e){return this.y=U.Math.clamp(this.y,t,e),this},clamp:function(t,e){return this.x=U.Math.clamp(this.x,t,e),this.y=U.Math.clamp(this.y,t,e),this},clone:function(t){return null==t?t=new U.Point(this.x,this.y):t.setTo(this.x,this.y),t},copyTo:function(t){return t.x=this.x,t.y=this.y,t},distance:function(t,e){return U.Point.distance(this,t,e)},equals:function(t){return t.x===this.x&&t.y===this.y},angle:function(t,e){return void 0===e&&(e=!1),e?U.Math.radToDeg(Math.atan2(t.y-this.y,t.x-this.x)):Math.atan2(t.y-this.y,t.x-this.x)},rotate:function(t,e,i,n,r){return U.Point.rotate(this,t,e,i,n,r)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(t){return this.normalize().multiply(t,t)},normalize:function(){var t;return this.isZero()||(t=this.getMagnitude(),this.x/=t,this.y/=t),this},isZero:function(){return 0===this.x&&0===this.y},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(-1*this.y,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}},U.Point.prototype.constructor=U.Point,U.Point.add=function(t,e,i){return void 0===i&&(i=new U.Point),i.x=t.x+e.x,i.y=t.y+e.y,i},U.Point.subtract=function(t,e,i){return void 0===i&&(i=new U.Point),i.x=t.x-e.x,i.y=t.y-e.y,i},U.Point.multiply=function(t,e,i){return void 0===i&&(i=new U.Point),i.x=t.x*e.x,i.y=t.y*e.y,i},U.Point.divide=function(t,e,i){return void 0===i&&(i=new U.Point),i.x=t.x/e.x,i.y=t.y/e.y,i},U.Point.equals=function(t,e){return t.x===e.x&&t.y===e.y},U.Point.angle=function(t,e){return Math.atan2(t.y-e.y,t.x-e.x)},U.Point.negative=function(t,e){return void 0===e&&(e=new U.Point),e.setTo(-t.x,-t.y)},U.Point.multiplyAdd=function(t,e,i,n){return void 0===n&&(n=new U.Point),n.setTo(t.x+e.x*i,t.y+e.y*i)},U.Point.interpolate=function(t,e,i,n){return void 0===n&&(n=new U.Point),n.setTo(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i)},U.Point.perp=function(t,e){return void 0===e&&(e=new U.Point),e.setTo(-t.y,t.x)},U.Point.rperp=function(t,e){return void 0===e&&(e=new U.Point),e.setTo(t.y,-t.x)},U.Point.distance=function(t,e,i){e=U.Math.distance(t.x,t.y,e.x,e.y);return i?Math.round(e):e},U.Point.project=function(t,e,i){void 0===i&&(i=new U.Point);t=t.dot(e)/e.getMagnitudeSq();return 0!=t&&i.setTo(t*e.x,t*e.y),i},U.Point.projectUnit=function(t,e,i){void 0===i&&(i=new U.Point);t=t.dot(e);return 0!==t&&i.setTo(t*e.x,t*e.y),i},U.Point.normalRightHand=function(t,e){return void 0===e&&(e=new U.Point),e.setTo(-1*t.y,t.x)},U.Point.normalize=function(t,e){void 0===e&&(e=new U.Point);var i=t.getMagnitude();return 0!==i&&e.setTo(t.x/i,t.y/i),e},U.Point.rotate=function(t,e,i,n,r,s){var o,a;return r&&(n=U.Math.degToRad(n)),void 0===s?(t.subtract(e,i),o=Math.sin(n),r=(a=Math.cos(n))*t.x-o*t.y,a=o*t.x+a*t.y,t.x=r+e,t.y=a+i):(n=n+Math.atan2(t.y-i,t.x-e),t.x=e+s*Math.cos(n),t.y=i+s*Math.sin(n)),t},U.Point.centroid=function(t,e){if(void 0===e&&(e=new U.Point),"[object Array]"!==Object.prototype.toString.call(t))throw new Error("Phaser.Point. Parameter 'points' must be an array");var i=t.length;if(i<1)throw new Error("Phaser.Point. Parameter 'points' array must not be empty");if(1===i)return e.copyFrom(t[0]),e;for(var n=0;n<i;n++)U.Point.add(e,t[n],e);return e.divide(i,i),e},U.Point.parse=function(t,e,i){e=e||"x",i=i||"y";var n=new U.Point;return t[e]&&(n.x=parseInt(t[e],10)),t[i]&&(n.y=parseInt(t[i],10)),n},PIXI.Point=U.Point,U.Polygon=function(){this.area=0,this._points=[],0<arguments.length&&this.setTo.apply(this,arguments),this.closed=!0,this.flattened=!1,this.type=U.POLYGON},U.Polygon.prototype={toNumberArray:function(t){void 0===t&&(t=[]);for(var e=0;e<this._points.length;e++)"number"==typeof this._points[e]?(t.push(this._points[e]),t.push(this._points[e+1]),e++):(t.push(this._points[e].x),t.push(this._points[e].y));return t},flatten:function(){return this._points=this.toNumberArray(),this.flattened=!0,this},clone:function(t){var e=this._points.slice();return null==t?t=new U.Polygon(e):t.setTo(e),t},contains:function(t,e){var i=!1;if(this.flattened)for(var n=-2,r=this._points.length-2;(n+=2)<this._points.length;r=n){var s=this._points[n],o=this._points[n+1],a=this._points[r],l=this._points[r+1];(o<=e&&e<l||l<=e&&e<o)&&t<(a-s)*(e-o)/(l-o)+s&&(i=!i)}else for(n=-1,r=this._points.length-1;++n<this._points.length;r=n){s=this._points[n].x,o=this._points[n].y,a=this._points[r].x,l=this._points[r].y;(o<=e&&e<l||l<=e&&e<o)&&t<(a-s)*(e-o)/(l-o)+s&&(i=!i)}return i},setTo:function(t){if(this.area=0,this._points=[],0<arguments.length){Array.isArray(t)||(t=Array.prototype.slice.call(arguments));for(var e,i=Number.MAX_VALUE,n=0,r=t.length;n<r;n++)"number"==typeof t[n]?(e=new PIXI.Point(t[n],t[n+1]),n++):e=Array.isArray(t[n])?new PIXI.Point(t[n][0],t[n][1]):new PIXI.Point(t[n].x,t[n].y),this._points.push(e),e.y<i&&(i=e.y);this.calculateArea(i)}return this},calculateArea:function(t){for(var e,i,n,r=0,s=this._points.length;r<s;r++)e=this._points[r],n=r===s-1?this._points[0]:this._points[r+1],i=(e.y-t+(n.y-t))/2,n=e.x-n.x,this.area+=i*n;return this.area}},U.Polygon.prototype.constructor=U.Polygon,Object.defineProperty(U.Polygon.prototype,"points",{get:function(){return this._points},set:function(t){null!=t?this.setTo(t):this.setTo()}}),PIXI.Polygon=U.Polygon,U.Rectangle=function(t,e,i,n){t=t||0,e=e||0,i=i||0,n=n||0,this.x=t,this.y=e,this.width=i,this.height=n,this.type=U.RECTANGLE},U.Rectangle.prototype={offset:function(t,e){return this.x+=t,this.y+=e,this},offsetPoint:function(t){return this.offset(t.x,t.y)},setTo:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},scale:function(t,e){return void 0===e&&(e=t),this.width*=t,this.height*=e,this},centerOn:function(t,e){return this.centerX=t,this.centerY=e,this},floor:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.width=Math.floor(this.width),this.height=Math.floor(this.height)},ceil:function(){this.x=Math.ceil(this.x),this.y=Math.ceil(this.y)},ceilAll:function(){this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.width=Math.ceil(this.width),this.height=Math.ceil(this.height)},copyFrom:function(t){return this.setTo(t.x,t.y,t.width,t.height)},copyTo:function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},inflate:function(t,e){return U.Rectangle.inflate(this,t,e)},size:function(t){return U.Rectangle.size(this,t)},resize:function(t,e){return this.width=t,this.height=e,this},clone:function(t){return U.Rectangle.clone(this,t)},contains:function(t,e){return U.Rectangle.contains(this,t,e)},containsRect:function(t){return U.Rectangle.containsRect(t,this)},equals:function(t){return U.Rectangle.equals(this,t)},intersection:function(t,e){return U.Rectangle.intersection(this,t,e)},intersects:function(t){return U.Rectangle.intersects(this,t)},intersectsRaw:function(t,e,i,n,r){return U.Rectangle.intersectsRaw(this,t,e,i,n,r)},union:function(t,e){return U.Rectangle.union(this,t,e)},random:function(t){return void 0===t&&(t=new U.Point),t.x=this.randomX,t.y=this.randomY,t},getPoint:function(t,e){switch(void 0===e&&(e=new U.Point),t){default:case U.TOP_LEFT:return e.set(this.x,this.y);case U.TOP_CENTER:return e.set(this.centerX,this.y);case U.TOP_RIGHT:return e.set(this.right,this.y);case U.LEFT_CENTER:return e.set(this.x,this.centerY);case U.CENTER:return e.set(this.centerX,this.centerY);case U.RIGHT_CENTER:return e.set(this.right,this.centerY);case U.BOTTOM_LEFT:return e.set(this.x,this.bottom);case U.BOTTOM_CENTER:return e.set(this.centerX,this.bottom);case U.BOTTOM_RIGHT:return e.set(this.right,this.bottom)}},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}},Object.defineProperty(U.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}}),Object.defineProperty(U.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}}),Object.defineProperty(U.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){t<=this.y?this.height=0:this.height=t-this.y}}),Object.defineProperty(U.Rectangle.prototype,"bottomLeft",{get:function(){return new U.Point(this.x,this.bottom)},set:function(t){this.x=t.x,this.bottom=t.y}}),Object.defineProperty(U.Rectangle.prototype,"bottomRight",{get:function(){return new U.Point(this.right,this.bottom)},set:function(t){this.right=t.x,this.bottom=t.y}}),Object.defineProperty(U.Rectangle.prototype,"left",{get:function(){return this.x},set:function(t){t>=this.right?this.width=0:this.width=this.right-t,this.x=t}}),Object.defineProperty(U.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(t){t<=this.x?this.width=0:this.width=t-this.x}}),Object.defineProperty(U.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}}),Object.defineProperty(U.Rectangle.prototype,"perimeter",{get:function(){return 2*this.width+2*this.height}}),Object.defineProperty(U.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(t){this.x=t-this.halfWidth}}),Object.defineProperty(U.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(t){this.y=t-this.halfHeight}}),Object.defineProperty(U.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*this.width}}),Object.defineProperty(U.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}}),Object.defineProperty(U.Rectangle.prototype,"top",{get:function(){return this.y},set:function(t){t>=this.bottom?(this.height=0,this.y=t):this.height=this.bottom-t}}),Object.defineProperty(U.Rectangle.prototype,"topLeft",{get:function(){return new U.Point(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y}}),Object.defineProperty(U.Rectangle.prototype,"topRight",{get:function(){return new U.Point(this.x+this.width,this.y)},set:function(t){this.right=t.x,this.y=t.y}}),Object.defineProperty(U.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(t){!0===t&&this.setTo(0,0,0,0)}}),U.Rectangle.prototype.constructor=U.Rectangle,U.Rectangle.inflate=function(t,e,i){return t.x-=e,t.width+=2*e,t.y-=i,t.height+=2*i,t},U.Rectangle.inflatePoint=function(t,e){return U.Rectangle.inflate(t,e.x,e.y)},U.Rectangle.size=function(t,e){return null==e?e=new U.Point(t.width,t.height):e.setTo(t.width,t.height),e},U.Rectangle.clone=function(t,e){return null==e?e=new U.Rectangle(t.x,t.y,t.width,t.height):e.setTo(t.x,t.y,t.width,t.height),e},U.Rectangle.contains=function(t,e,i){return!(t.width<=0||t.height<=0)&&e>=t.x&&e<t.right&&i>=t.y&&i<t.bottom},U.Rectangle.containsRaw=function(t,e,i,n,r,s){return t<=r&&r<t+i&&e<=s&&s<e+n},U.Rectangle.containsPoint=function(t,e){return U.Rectangle.contains(t,e.x,e.y)},U.Rectangle.containsRect=function(t,e){return!(t.volume>e.volume)&&t.x>=e.x&&t.y>=e.y&&t.right<e.right&&t.bottom<e.bottom},U.Rectangle.equals=function(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},U.Rectangle.sameDimensions=function(t,e){return t.width===e.width&&t.height===e.height},U.Rectangle.intersection=function(t,e,i){return void 0===i&&(i=new U.Rectangle),U.Rectangle.intersects(t,e)&&(i.x=Math.max(t.x,e.x),i.y=Math.max(t.y,e.y),i.width=Math.min(t.right,e.right)-i.x,i.height=Math.min(t.bottom,e.bottom)-i.y),i},U.Rectangle.intersects=function(t,e){return!(t.width<=0||t.height<=0||e.width<=0||e.height<=0||t.right<e.x||t.bottom<e.y||t.x>e.right||t.y>e.bottom)},U.Rectangle.intersectsRaw=function(t,e,i,n,r,s){return void 0===s&&(s=0),!(e>t.right+s||i<t.left-s||n>t.bottom+s||r<t.top-s)},U.Rectangle.union=function(t,e,i){return void 0===i&&(i=new U.Rectangle),i.setTo(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.max(t.right,e.right)-Math.min(t.left,e.left),Math.max(t.bottom,e.bottom)-Math.min(t.top,e.top))},U.Rectangle.aabb=function(t,e){void 0===e&&(e=new U.Rectangle);var i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;return t.forEach(function(t){t.x>i&&(i=t.x),t.x<n&&(n=t.x),t.y>r&&(r=t.y),t.y<s&&(s=t.y)}),e.setTo(n,s,i-n,r-s),e},PIXI.Rectangle=U.Rectangle,PIXI.EmptyRectangle=new U.Rectangle(0,0,0,0),U.RoundedRectangle=function(t,e,i,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=20),this.x=t,this.y=e,this.width=i,this.height=n,this.radius=r||20,this.type=U.ROUNDEDRECTANGLE},U.RoundedRectangle.prototype={clone:function(){return new U.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},contains:function(t,e){if(this.width<=0||this.height<=0)return!1;var i=this.x;if(i<=t&&t<=i+this.width){i=this.y;if(i<=e&&e<=i+this.height)return!0}return!1}},U.RoundedRectangle.prototype.constructor=U.RoundedRectangle,PIXI.RoundedRectangle=U.RoundedRectangle,U.Camera=function(t,e,i,n,r,s){this.game=t,this.world=t.world,this.id=0,this.view=new U.Rectangle(i,n,r,s),this.bounds=new U.Rectangle(i,n,r,s),this.deadzone=null,this.visible=!0,this.roundPx=!0,this.atLimit={x:!1,y:!1},this.target=null,this.displayObject=null,this.scale=null,this.totalInView=0,this.lerp=new U.Point(1,1),this.onShakeComplete=new U.Signal,this.onFlashComplete=new U.Signal,this.onFadeComplete=new U.Signal,this.fx=null,this._targetPosition=new U.Point,this._edge=0,this._position=new U.Point,this._shake={intensity:0,duration:0,horizontal:!1,vertical:!1,shakeBounds:!0,x:0,y:0},this._fxDuration=0,this._fxType=0},U.Camera.FOLLOW_LOCKON=0,U.Camera.FOLLOW_PLATFORMER=1,U.Camera.FOLLOW_TOPDOWN=2,U.Camera.FOLLOW_TOPDOWN_TIGHT=3,U.Camera.SHAKE_BOTH=4,U.Camera.SHAKE_HORIZONTAL=5,U.Camera.SHAKE_VERTICAL=6,U.Camera.ENABLE_FX=!0,U.Camera.prototype={boot:function(){this.displayObject=this.game.world,this.scale=this.game.world.scale,this.game.camera=this,U.Graphics&&U.Camera.ENABLE_FX&&(this.fx=new U.Graphics(this.game),this.game.stage.addChild(this.fx))},preUpdate:function(){this.totalInView=0},follow:function(t,e,i,n){var r;switch(void 0===e&&(e=U.Camera.FOLLOW_LOCKON),void 0===i&&(i=1),void 0===n&&(n=1),this.target=t,this.lerp.set(i,n),e){case U.Camera.FOLLOW_PLATFORMER:var s=this.width/8,o=this.height/3;this.deadzone=new U.Rectangle((this.width-s)/2,(this.height-o)/2-.25*o,s,o);break;case U.Camera.FOLLOW_TOPDOWN:r=Math.max(this.width,this.height)/4,this.deadzone=new U.Rectangle((this.width-r)/2,(this.height-r)/2,r,r);break;case U.Camera.FOLLOW_TOPDOWN_TIGHT:r=Math.max(this.width,this.height)/8,this.deadzone=new U.Rectangle((this.width-r)/2,(this.height-r)/2,r,r);break;case U.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null}},unfollow:function(){this.target=null},focusOn:function(t){this.setPosition(Math.round(t.x-this.view.halfWidth),Math.round(t.y-this.view.halfHeight))},focusOnXY:function(t,e){this.setPosition(Math.round(t-this.view.halfWidth),Math.round(e-this.view.halfHeight))},shake:function(t,e,i,n,r){return void 0===t&&(t=.05),void 0===e&&(e=500),void 0===i&&(i=!0),void 0===n&&(n=U.Camera.SHAKE_BOTH),void 0===r&&(r=!0),!(!i&&0<this._shake.duration||(this._shake.intensity=t,this._shake.duration=e,this._shake.shakeBounds=r,this._shake.x=0,this._shake.y=0,this._shake.horizontal=n===U.Camera.SHAKE_BOTH||n===U.Camera.SHAKE_HORIZONTAL,this._shake.vertical=n===U.Camera.SHAKE_BOTH||n===U.Camera.SHAKE_VERTICAL,0))},flash:function(t,e,i){return void 0===t&&(t=16777215),void 0===e&&(e=500),void 0===i&&(i=!1),!(!this.fx||!i&&0<this._fxDuration||(this.fx.clear(),this.fx.beginFill(t),this.fx.drawRect(0,0,this.width,this.height),this.fx.endFill(),this.fx.alpha=1,this._fxDuration=e,this._fxType=0))},fade:function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=500),void 0===i&&(i=!1),!(!this.fx||!i&&0<this._fxDuration||(this.fx.clear(),this.fx.beginFill(t),this.fx.drawRect(0,0,this.width,this.height),this.fx.endFill(),this.fx.alpha=0,this._fxDuration=e,this._fxType=1,0))},update:function(){0<this._fxDuration&&this.updateFX(),0<this._shake.duration&&this.updateShake(),this.bounds&&this.checkBounds(),this.roundPx&&(this.view.floor(),this._shake.x=Math.floor(this._shake.x),this._shake.y=Math.floor(this._shake.y)),this.displayObject.position.x=-this.view.x,this.displayObject.position.y=-this.view.y},updateFX:function(){0===this._fxType?(this.fx.alpha-=this.game.time.elapsedMS/this._fxDuration,this.fx.alpha<=0&&(this._fxDuration=0,this.fx.alpha=0,this.onFlashComplete.dispatch())):(this.fx.alpha+=this.game.time.elapsedMS/this._fxDuration,1<=this.fx.alpha&&(this._fxDuration=0,this.fx.alpha=1,this.onFadeComplete.dispatch()))},updateShake:function(){this._shake.duration-=this.game.time.elapsedMS,this._shake.duration<=0?(this.onShakeComplete.dispatch(),this._shake.x=0,this._shake.y=0):(this._shake.horizontal&&(this._shake.x=this.game.rnd.frac()*this._shake.intensity*this.view.width*2-this._shake.intensity*this.view.width),this._shake.vertical&&(this._shake.y=this.game.rnd.frac()*this._shake.intensity*this.view.height*2-this._shake.intensity*this.view.height))},updateTarget:function(){this._targetPosition.x=this.view.x+this.target.worldPosition.x,this._targetPosition.y=this.view.y+this.target.worldPosition.y,this.deadzone?(this._edge=this._targetPosition.x-this.view.x,this._edge<this.deadzone.left?this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.left,this.lerp.x):this._edge>this.deadzone.right&&(this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.right,this.lerp.x)),this._edge=this._targetPosition.y-this.view.y,this._edge<this.deadzone.top?this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.top,this.lerp.y):this._edge>this.deadzone.bottom&&(this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.bottom,this.lerp.y))):(this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.view.halfWidth,this.lerp.x),this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.view.halfHeight,this.lerp.y)),this.bounds&&this.checkBounds(),this.roundPx&&this.view.floor(),this.displayObject.position.x=-this.view.x,this.displayObject.position.y=-this.view.y},setBoundsToWorld:function(){this.bounds&&this.bounds.copyFrom(this.game.world.bounds)},checkBounds:function(){this.atLimit.x=!1,this.atLimit.y=!1;var t=this.view.x+this._shake.x,e=this.view.right+this._shake.x,i=this.view.y+this._shake.y,n=this.view.bottom+this._shake.y;t<=this.bounds.x*this.scale.x&&(this.atLimit.x=!0,this.view.x=this.bounds.x*this.scale.x,this._shake.shakeBounds||(this._shake.x=0)),e>=this.bounds.right*this.scale.x&&(this.atLimit.x=!0,this.view.x=this.bounds.right*this.scale.x-this.width,this._shake.shakeBounds||(this._shake.x=0)),i<=this.bounds.top*this.scale.y&&(this.atLimit.y=!0,this.view.y=this.bounds.top*this.scale.y,this._shake.shakeBounds||(this._shake.y=0)),n>=this.bounds.bottom*this.scale.y&&(this.atLimit.y=!0,this.view.y=this.bounds.bottom*this.scale.y-this.height,this._shake.shakeBounds||(this._shake.y=0))},setPosition:function(t,e){this.view.x=t,this.view.y=e,this.bounds&&this.checkBounds()},setSize:function(t,e){this.view.width=t,this.view.height=e},reset:function(){this.target=null,this.view.x=0,this.view.y=0,this._shake.duration=0,this.resetFX()},resetFX:function(){this.fx.clear(),this.fx.alpha=0,this._fxDuration=0}},U.Camera.prototype.constructor=U.Camera,Object.defineProperty(U.Camera.prototype,"x",{get:function(){return this.view.x},set:function(t){this.view.x=t,this.bounds&&this.checkBounds()}}),Object.defineProperty(U.Camera.prototype,"y",{get:function(){return this.view.y},set:function(t){this.view.y=t,this.bounds&&this.checkBounds()}}),Object.defineProperty(U.Camera.prototype,"position",{get:function(){return this._position.set(this.view.x,this.view.y),this._position},set:function(t){void 0!==t.x&&(this.view.x=t.x),void 0!==t.y&&(this.view.y=t.y),this.bounds&&this.checkBounds()}}),Object.defineProperty(U.Camera.prototype,"width",{get:function(){return this.view.width},set:function(t){this.view.width=t}}),Object.defineProperty(U.Camera.prototype,"height",{get:function(){return this.view.height},set:function(t){this.view.height=t}}),Object.defineProperty(U.Camera.prototype,"shakeIntensity",{get:function(){return this._shake.intensity},set:function(t){this._shake.intensity=t}}),U.State=function(){this.game=null,this.key="",this.add=null,this.make=null,this.camera=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.sound=null,this.scale=null,this.stage=null,this.state=null,this.time=null,this.tweens=null,this.world=null,this.particles=null,this.physics=null,this.rnd=null},U.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},preRender:function(){},render:function(){},resize:function(){},paused:function(){},resumed:function(){},pauseUpdate:function(){},shutdown:function(){}},U.State.prototype.constructor=U.State,U.StateManager=function(t,e){this.game=t,this.states={},(this._pendingState=null)!=e&&(this._pendingState=e),this._clearWorld=!1,this._clearCache=!1,this._created=!1,this._args=[],this.current="",this.onStateChange=new U.Signal,this.onInitCallback=null,this.onPreloadCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPreRenderCallback=null,this.onLoadUpdateCallback=null,this.onLoadRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.onShutDownCallback=null},U.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this),this.game.onResume.add(this.resume,this),null!==this._pendingState&&"string"!=typeof this._pendingState&&this.add("default",this._pendingState,!0)},add:function(t,e,i){var n;return void 0===i&&(i=!1),e instanceof U.State?n=e:"object"==typeof e?(n=e).game=this.game:"function"==typeof e&&(n=new e(this.game)),this.states[t]=n,i&&(this.game.isBooted?this.start(t):this._pendingState=t),n},remove:function(t){this.current===t&&(this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onPreRenderCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null),delete this.states[t]},start:function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),this.checkState(t)&&(this._pendingState=t,this._clearWorld=e,this._clearCache=i,3<arguments.length&&(this._args=Array.prototype.splice.call(arguments,3)))},restart:function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),this._pendingState=this.current,this._clearWorld=t,this._clearCache=e,2<arguments.length&&(this._args=Array.prototype.slice.call(arguments,2))},dummy:function(){},preUpdate:function(){var t;this._pendingState&&this.game.isBooted&&(t=this.current,this.clearCurrentState(),this.setCurrentState(this._pendingState),this.onStateChange.dispatch(this.current,t),this.current===this._pendingState&&(this._pendingState=null,this.onPreloadCallback?(this.game.load.reset(!0),this.onPreloadCallback.call(this.callbackContext,this.game),0===this.game.load.totalQueuedFiles()&&0===this.game.load.totalQueuedPacks()?this.loadComplete():this.game.load.start()):this.loadComplete()))},clearCurrentState:function(){this.current&&(this.onShutDownCallback&&this.onShutDownCallback.call(this.callbackContext,this.game),this.game.tweens.removeAll(),this.game.camera.reset(),this.game.input.reset(!0),this.game.physics.clear(),this.game.time.removeAll(),this.game.scale.reset(this._clearWorld),this.game.debug&&this.game.debug.reset(),this._clearWorld&&(this.game.world.shutdown(),this._clearCache&&this.game.cache.destroy()))},checkState:function(t){return this.states[t]?!!(this.states[t].preload||this.states[t].create||this.states[t].update||this.states[t].render)||(console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render"),!1):(console.warn("Phaser.StateManager - No state found with the key: "+t),!1)},link:function(t){this.states[t].game=this.game,this.states[t].add=this.game.add,this.states[t].make=this.game.make,this.states[t].camera=this.game.camera,this.states[t].cache=this.game.cache,this.states[t].input=this.game.input,this.states[t].load=this.game.load,this.states[t].math=this.game.math,this.states[t].sound=this.game.sound,this.states[t].scale=this.game.scale,(this.states[t].state=this).states[t].stage=this.game.stage,this.states[t].time=this.game.time,this.states[t].tweens=this.game.tweens,this.states[t].world=this.game.world,this.states[t].particles=this.game.particles,this.states[t].rnd=this.game.rnd,this.states[t].physics=this.game.physics,this.states[t].key=t},unlink:function(t){this.states[t]&&(this.states[t].game=null,this.states[t].add=null,this.states[t].make=null,this.states[t].camera=null,this.states[t].cache=null,this.states[t].input=null,this.states[t].load=null,this.states[t].math=null,this.states[t].sound=null,this.states[t].scale=null,this.states[t].state=null,this.states[t].stage=null,this.states[t].time=null,this.states[t].tweens=null,this.states[t].world=null,this.states[t].particles=null,this.states[t].rnd=null,this.states[t].physics=null)},setCurrentState:function(t){this.callbackContext=this.states[t],this.link(t),this.onInitCallback=this.states[t].init||this.dummy,this.onPreloadCallback=this.states[t].preload||null,this.onLoadRenderCallback=this.states[t].loadRender||null,this.onLoadUpdateCallback=this.states[t].loadUpdate||null,this.onCreateCallback=this.states[t].create||null,this.onUpdateCallback=this.states[t].update||null,this.onPreRenderCallback=this.states[t].preRender||null,this.onRenderCallback=this.states[t].render||null,this.onResizeCallback=this.states[t].resize||null,this.onPausedCallback=this.states[t].paused||null,this.onResumedCallback=this.states[t].resumed||null,this.onPauseUpdateCallback=this.states[t].pauseUpdate||null,this.onShutDownCallback=this.states[t].shutdown||this.dummy,""!==this.current&&this.game.physics.reset(),this.current=t,this._created=!1,this.onInitCallback.apply(this.callbackContext,this._args),t===this._pendingState&&(this._args=[]),this.game._kickstart=!0},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){!1===this._created&&this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game),!1===this._created&&this.onCreateCallback?(this._created=!0,this.onCreateCallback.call(this.callbackContext,this.game)):this._created=!0},pause:function(){this._created&&this.onPausedCallback&&this.onPausedCallback.call(this.callbackContext,this.game)},resume:function(){this._created&&this.onResumedCallback&&this.onResumedCallback.call(this.callbackContext,this.game)},update:function(){this._created?this.onUpdateCallback&&this.onUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},pauseUpdate:function(){this._created?this.onPauseUpdateCallback&&this.onPauseUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},preRender:function(t){this._created&&this.onPreRenderCallback&&this.onPreRenderCallback.call(this.callbackContext,this.game,t)},resize:function(t,e){this.onResizeCallback&&this.onResizeCallback.call(this.callbackContext,t,e)},render:function(){this._created?this.onRenderCallback&&(this.game.renderType===U.CANVAS?(this.game.context.save(),this.game.context.setTransform(1,0,0,1,0,0),this.onRenderCallback.call(this.callbackContext,this.game),this.game.context.restore()):this.onRenderCallback.call(this.callbackContext,this.game)):this.onLoadRenderCallback&&this.onLoadRenderCallback.call(this.callbackContext,this.game)},destroy:function(){this._clearWorld=!0,this._clearCache=!0,this.clearCurrentState(),this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.game=null,this.states={},this._pendingState=null,this.current=""}},U.StateManager.prototype.constructor=U.StateManager,Object.defineProperty(U.StateManager.prototype,"created",{get:function(){return this._created}}),U.Signal=function(){},U.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!1,validateListener:function(t,e){if("function"!=typeof t)throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))},_registerListener:function(t,e,i,n,r){var s,o=this._indexOfListener(t,i);if(-1!==o){if((s=this._bindings[o]).isOnce()!==e)throw new Error("You cannot add"+(e?"":"Once")+"() then add"+(e?"Once":"")+"() the same listener without removing the relationship first.")}else s=new U.SignalBinding(this,t,e,i,n,r),this._addBinding(s);return this.memorize&&this._prevParams&&s.execute(this._prevParams),s},_addBinding:function(t){this._bindings||(this._bindings=[]);for(var e=this._bindings.length;e--,this._bindings[e]&&t._priority<=this._bindings[e]._priority;);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){if(!this._bindings)return-1;void 0===e&&(e=null);for(var i,n=this._bindings.length;n--;)if((i=this._bindings[n])._listener===t&&i.context===e)return n;return-1},has:function(t,e){return-1!==this._indexOfListener(t,e)},add:function(t,e,i){this.validateListener(t,"add");var n=[];if(3<arguments.length)for(var r=3;r<arguments.length;r++)n.push(arguments[r]);return this._registerListener(t,!1,e,i,n)},addOnce:function(t,e,i){this.validateListener(t,"addOnce");var n=[];if(3<arguments.length)for(var r=3;r<arguments.length;r++)n.push(arguments[r]);return this._registerListener(t,!0,e,i,n)},remove:function(t,e){this.validateListener(t,"remove");e=this._indexOfListener(t,e);return-1!==e&&(this._bindings[e]._destroy(),this._bindings.splice(e,1)),t},removeAll:function(t){if(void 0===t&&(t=null),this._bindings){for(var e=this._bindings.length;e--;)t?this._bindings[e].context===t&&(this._bindings[e]._destroy(),this._bindings.splice(e,1)):this._bindings[e]._destroy();t||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var t,e=Array.prototype.slice.call(arguments),i=this._bindings.length;if(this.memorize&&(this._prevParams=e),i)for(t=this._bindings.slice(),this._shouldPropagate=!0;i--,t[i]&&this._shouldPropagate&&!1!==t[i].execute(e););}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(U.Signal.prototype,"boundDispatch",{get:function(){var t=this;return this._boundDispatch||(this._boundDispatch=function(){return t.dispatch.apply(t,arguments)})}}),U.Signal.prototype.constructor=U.Signal,U.SignalBinding=function(t,e,i,n,r,s){this._listener=e,i&&(this._isOnce=!0),null!=n&&(this.context=n),this._signal=t,r&&(this._priority=r),s&&s.length&&(this._args=s)},U.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(t){var e;return this.active&&this._listener&&(e=this.params?this.params.concat(t):t,this._args&&(e=e.concat(this._args)),e=this._listener.apply(this.context,e),this.callCount++,this._isOnce&&this.detach()),e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},U.SignalBinding.prototype.constructor=U.SignalBinding,U.Filter=function(t,e,i){this.game=t,this.type=U.WEBGL_FILTER,this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.prevPoint=new U.Point;t=new Date;if(this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,y:0}},date:{type:"4fv",value:[t.getFullYear(),t.getMonth(),t.getDate(),60*t.getHours()*60+60*t.getMinutes()+t.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:!0}}},e)for(var n in e)this.uniforms[n]=e[n];this.fragmentSrc=i||""},U.Filter.prototype={init:function(){},setResolution:function(t,e){this.uniforms.resolution.value.x=t,this.uniforms.resolution.value.y=e},update:function(t){var e;void 0!==t&&(e=t.x/this.game.width,t=1-t.y/this.game.height,e===this.prevPoint.x&&t===this.prevPoint.y||(this.uniforms.mouse.value.x=e.toFixed(2),this.uniforms.mouse.value.y=t.toFixed(2),this.prevPoint.set(e,t))),this.uniforms.time.value=this.game.time.totalElapsedSeconds()},addToWorld:function(t,e,i,n,r,s){void 0===r&&(r=0),void 0===s&&(s=0),null!=i?this.width=i:i=this.width,null!=n?this.height=n:n=this.height;e=this.game.add.image(t,e,"__default");return e.width=i,e.height=n,e.anchor.set(r,s),e.filters=[this],e},destroy:function(){this.game=null}},U.Filter.prototype.constructor=U.Filter,Object.defineProperty(U.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(t){this.uniforms.resolution.value.x=t}}),Object.defineProperty(U.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(t){this.uniforms.resolution.value.y=t}}),U.Plugin=function(t,e){void 0===e&&(e=null),this.game=t,this.parent=e,this.active=!1,this.visible=!1,this.hasPreUpdate=!1,this.hasUpdate=!1,this.hasPostUpdate=!1,this.hasRender=!1,this.hasPostRender=!1},U.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null,this.parent=null,this.active=!1,this.visible=!1}},U.Plugin.prototype.constructor=U.Plugin,U.PluginManager=function(t){this.game=t,this.plugins=[],this._len=0,this._i=0},U.PluginManager.prototype={add:function(t){var e=Array.prototype.slice.call(arguments,1),i=!1;return"function"==typeof t?t=new t(this.game,this):(t.game=this.game,t.parent=this),"function"==typeof t.preUpdate&&(i=t.hasPreUpdate=!0),"function"==typeof t.update&&(i=t.hasUpdate=!0),"function"==typeof t.postUpdate&&(i=t.hasPostUpdate=!0),"function"==typeof t.render&&(i=t.hasRender=!0),"function"==typeof t.postRender&&(i=t.hasPostRender=!0),i?((t.hasPreUpdate||t.hasUpdate||t.hasPostUpdate)&&(t.active=!0),(t.hasRender||t.hasPostRender)&&(t.visible=!0),this._len=this.plugins.push(t),"function"==typeof t.init&&t.init.apply(t,e),t):null},remove:function(t,e){for(void 0===e&&(e=!0),this._i=this._len;this._i--;)if(this.plugins[this._i]===t)return e&&t.destroy(),this.plugins.splice(this._i,1),void this._len--},removeAll:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].destroy();this.plugins.length=0,this._len=0},preUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate&&this.plugins[this._i].preUpdate()},update:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasUpdate&&this.plugins[this._i].update()},postUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate&&this.plugins[this._i].postUpdate()},render:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasRender&&this.plugins[this._i].render()},postRender:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender&&this.plugins[this._i].postRender()},destroy:function(){this.removeAll(),this.game=null}},U.PluginManager.prototype.constructor=U.PluginManager,U.Stage=function(t){this.game=t,PIXI.DisplayObjectContainer.call(this),this.name="_stage_root",this.disableVisibilityChange=!1,this.exists=!0,this.worldTransform=new PIXI.Matrix,(this.stage=this).currentRenderOrderID=0,this._hiddenVar="hidden",this._onChange=null,this._bgColor={r:0,g:0,b:0,a:0,color:0,rgba:"#000000"},this.game.transparent||(this._bgColor.a=1),t.config&&this.parseConfig(t.config)},U.Stage.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),U.Stage.prototype.constructor=U.Stage,U.Stage.prototype.parseConfig=function(t){t.disableVisibilityChange&&(this.disableVisibilityChange=t.disableVisibilityChange),t.backgroundColor&&this.setBackgroundColor(t.backgroundColor)},U.Stage.prototype.boot=function(){U.DOM.getOffset(this.game.canvas,this.offset),U.Canvas.setUserSelect(this.game.canvas,"none"),U.Canvas.setTouchAction(this.game.canvas,"none"),this.checkVisibility()},U.Stage.prototype.preUpdate=function(){for(var t=this.currentRenderOrderID=0;t<this.children.length;t++)this.children[t].preUpdate()},U.Stage.prototype.update=function(){for(var t=this.children.length;t--;)this.children[t].update()},U.Stage.prototype.postUpdate=function(){this.game.camera.update(),this.game.camera.target&&(this.game.camera.target.postUpdate(),this.updateTransform(),this.game.camera.updateTarget());for(var t=0;t<this.children.length;t++)this.children[t].postUpdate();this.updateTransform()},U.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0;t<this.children.length;t++)this.children[t].updateTransform()},U.Stage.prototype.checkVisibility=function(){void 0!==document.hidden?this._hiddenVar="visibilitychange":void 0!==document.webkitHidden?this._hiddenVar="webkitvisibilitychange":void 0!==document.mozHidden?this._hiddenVar="mozvisibilitychange":void 0!==document.msHidden?this._hiddenVar="msvisibilitychange":this._hiddenVar=null;var e=this;this._onChange=function(t){return e.visibilityChange(t)},this._hiddenVar&&document.addEventListener(this._hiddenVar,this._onChange,!1),window.onblur=this._onChange,window.onfocus=this._onChange,window.onpagehide=this._onChange,window.onpageshow=this._onChange,this.game.device.cocoonJSApp&&(CocoonJS.App.onSuspended.addEventListener(function(){U.Stage.prototype.visibilityChange.call(e,{type:"pause"})}),CocoonJS.App.onActivated.addEventListener(function(){U.Stage.prototype.visibilityChange.call(e,{type:"resume"})}))},U.Stage.prototype.visibilityChange=function(t){return"pagehide"===t.type||"blur"===t.type||"pageshow"===t.type||"focus"===t.type?void("pagehide"===t.type||"blur"===t.type?this.game.focusLoss(t):"pageshow"!==t.type&&"focus"!==t.type||this.game.focusGain(t)):void(this.disableVisibilityChange||(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||"pause"===t.type?this.game.gamePaused(t):this.game.gameResumed(t)))},U.Stage.prototype.setBackgroundColor=function(t){this.game.transparent||(U.Color.valueToColor(t,this._bgColor),U.Color.updateColor(this._bgColor),this._bgColor.r/=255,this._bgColor.g/=255,this._bgColor.b/=255,this._bgColor.a=1)},U.Stage.prototype.destroy=function(){this._hiddenVar&&document.removeEventListener(this._hiddenVar,this._onChange,!1),window.onpagehide=null,window.onpageshow=null,window.onblur=null,window.onfocus=null},Object.defineProperty(U.Stage.prototype,"backgroundColor",{get:function(){return this._bgColor.color},set:function(t){this.setBackgroundColor(t)}}),Object.defineProperty(U.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(t){PIXI.scaleModes.DEFAULT=t?PIXI.scaleModes.LINEAR:PIXI.scaleModes.NEAREST}}),U.Group=function(t,e,i,n,r,s){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===s&&(s=U.Physics.ARCADE),this.game=t,void 0===e&&(e=t.world),this.name=i||"group",this.z=0,PIXI.DisplayObjectContainer.call(this),n?(this.game.stage.addChild(this),this.z=this.game.stage.children.length):e&&(e.addChild(this),this.z=e.children.length),this.type=U.GROUP,this.physicsType=U.GROUP,this.alive=!0,this.exists=!0,this.ignoreDestroy=!1,this.pendingDestroy=!1,this.classType=U.Sprite,this.cursor=null,this.inputEnableChildren=!1,this.onChildInputDown=new U.Signal,this.onChildInputUp=new U.Signal,this.onChildInputOver=new U.Signal,this.onChildInputOut=new U.Signal,this.enableBody=r,this.enableBodyDebug=!1,this.physicsBodyType=s,this.physicsSortDirection=null,this.onDestroy=new U.Signal,this.cursorIndex=0,this.fixedToCamera=!1,this.cameraOffset=new U.Point,this.hash=[],this._sortProperty="z"},U.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),U.Group.prototype.constructor=U.Group,U.Group.RETURN_NONE=0,U.Group.RETURN_TOTAL=1,U.Group.RETURN_CHILD=2,U.Group.RETURN_ALL=3,U.Group.SORT_ASCENDING=-1,U.Group.SORT_DESCENDING=1,U.Group.prototype.add=function(t,e,i){return void 0===e&&(e=!1),t.parent===this||(t.body&&t.parent&&t.parent.hash&&t.parent.removeFromHash(t),void 0===i?(t.z=this.children.length,this.addChild(t)):(this.addChildAt(t,i),this.updateZ()),this.enableBody&&t.hasOwnProperty("body")&&null===t.body?this.game.physics.enable(t,this.physicsBodyType):t.body&&this.addToHash(t),!this.inputEnableChildren||t.input&&!t.inputEnabled||(t.inputEnabled=!0),!e&&t.events&&t.events.onAddedToGroup$dispatch(t,this),null===this.cursor&&(this.cursor=t)),t},U.Group.prototype.addAt=function(t,e,i){this.add(t,i,e)},U.Group.prototype.addToHash=function(t){if(t.parent===this&&-1===this.hash.indexOf(t))return this.hash.push(t),!0;return!1},U.Group.prototype.removeFromHash=function(t){if(t){t=this.hash.indexOf(t);if(-1!==t)return this.hash.splice(t,1),!0}return!1},U.Group.prototype.addMultiple=function(t,e){if(t instanceof U.Group)t.moveAll(this,e);else if(Array.isArray(t))for(var i=0;i<t.length;i++)this.add(t[i],e);return t},U.Group.prototype.getAt=function(t){return t<0||t>=this.children.length?-1:this.getChildAt(t)},U.Group.prototype.create=function(t,e,i,n,r,s){void 0===r&&(r=!0);n=new this.classType(this.game,t,e,i,n);return n.exists=r,n.visible=r,n.alive=r,this.add(n,!1,s)},U.Group.prototype.createMultiple=function(n,t,e,r){void 0===e&&(e=0),void 0===r&&(r=!1),Array.isArray(t)||(t=[t]),Array.isArray(e)||(e=[e]);var s=this,o=[];return t.forEach(function(i){e.forEach(function(t){for(var e=0;e<n;e++)o.push(s.create(0,0,i,t,r))})}),o},U.Group.prototype.updateZ=function(){for(var t=this.children.length;t--;)this.children[t].z=t},U.Group.prototype.align=function(t,e,i,n,r,s){if(void 0===r&&(r=U.TOP_LEFT),void 0===s&&(s=0),0===this.children.length||s>this.children.length||-1===t&&-1===e)return!1;for(var o=new U.Rectangle(0,0,i,n),a=t*i,l=e*n,p=s;p<this.children.length;p++){var h=this.children[p];if(h.alignIn)if(h.alignIn(o,r),-1===t)o.y+=n,o.y===l&&(o.x+=i,o.y=0);else if(-1===e)o.x+=i,o.x===a&&(o.x=0,o.y+=n);else if(o.x+=i,o.x===a&&(o.x=0,o.y+=n,o.y===l))return!0}return!0},U.Group.prototype.resetCursor=function(t){if(void 0===t&&(t=0),t>this.children.length-1&&(t=0),this.cursor)return this.cursorIndex=t,this.cursor=this.children[this.cursorIndex],this.cursor},U.Group.prototype.next=function(){if(this.cursor)return this.cursorIndex>=this.children.length-1?this.cursorIndex=0:this.cursorIndex++,this.cursor=this.children[this.cursorIndex],this.cursor},U.Group.prototype.previous=function(){if(this.cursor)return 0===this.cursorIndex?this.cursorIndex=this.children.length-1:this.cursorIndex--,this.cursor=this.children[this.cursorIndex],this.cursor},U.Group.prototype.swap=function(t,e){this.swapChildren(t,e),this.updateZ()},U.Group.prototype.bringToTop=function(t){return t.parent===this&&this.getIndex(t)<this.children.length&&(this.remove(t,!1,!0),this.add(t,!0)),t},U.Group.prototype.sendToBack=function(t){return t.parent===this&&0<this.getIndex(t)&&(this.remove(t,!1,!0),this.addAt(t,0,!0)),t},U.Group.prototype.moveUp=function(t){var e;return t.parent===this&&this.getIndex(t)<this.children.length-1&&(e=this.getIndex(t),(e=this.getAt(e+1))&&this.swap(t,e)),t},U.Group.prototype.moveDown=function(t){var e;return t.parent===this&&0<this.getIndex(t)&&(e=this.getIndex(t),(e=this.getAt(e-1))&&this.swap(t,e)),t},U.Group.prototype.xy=function(t,e,i){return t<0||t>this.children.length?-1:(this.getChildAt(t).x=e,void(this.getChildAt(t).y=i))},U.Group.prototype.reverse=function(){this.children.reverse(),this.updateZ()},U.Group.prototype.getIndex=function(t){return this.children.indexOf(t)},U.Group.prototype.getByName=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].name===t)return this.children[e];return null},U.Group.prototype.replace=function(t,e){var i=this.getIndex(t);if(-1!==i)return e.parent&&(e.parent instanceof U.Group?e.parent.remove(e):e.parent.removeChild(e)),this.remove(t),this.addAt(e,i),t},U.Group.prototype.hasProperty=function(t,e){var i=e.length;return 1===i&&e[0]in t||2===i&&e[0]in t&&e[1]in t[e[0]]||3===i&&e[0]in t&&e[1]in t[e[0]]&&e[2]in t[e[0]][e[1]]||4===i&&e[0]in t&&e[1]in t[e[0]]&&e[2]in t[e[0]][e[1]]&&e[3]in t[e[0]][e[1]][e[2]]},U.Group.prototype.setProperty=function(t,e,i,n,r){if(void 0===r&&(r=!1),n=n||0,!this.hasProperty(t,e)&&(!r||0<n))return!1;r=e.length;return 1===r?0===n?t[e[0]]=i:1===n?t[e[0]]+=i:2===n?t[e[0]]-=i:3===n?t[e[0]]*=i:4===n&&(t[e[0]]/=i):2===r?0===n?t[e[0]][e[1]]=i:1===n?t[e[0]][e[1]]+=i:2===n?t[e[0]][e[1]]-=i:3===n?t[e[0]][e[1]]*=i:4===n&&(t[e[0]][e[1]]/=i):3===r?0===n?t[e[0]][e[1]][e[2]]=i:1===n?t[e[0]][e[1]][e[2]]+=i:2===n?t[e[0]][e[1]][e[2]]-=i:3===n?t[e[0]][e[1]][e[2]]*=i:4===n&&(t[e[0]][e[1]][e[2]]/=i):4===r&&(0===n?t[e[0]][e[1]][e[2]][e[3]]=i:1===n?t[e[0]][e[1]][e[2]][e[3]]+=i:2===n?t[e[0]][e[1]][e[2]][e[3]]-=i:3===n?t[e[0]][e[1]][e[2]][e[3]]*=i:4===n&&(t[e[0]][e[1]][e[2]][e[3]]/=i)),!0},U.Group.prototype.checkProperty=function(t,e,i,n){return void 0===n&&(n=!1),!(!U.Utils.getProperty(t,e)&&n)&&U.Utils.getProperty(t,e)===i},U.Group.prototype.set=function(t,e,i,n,r,s,o){if(void 0===o&&(o=!1),e=e.split("."),void 0===n&&(n=!1),void 0===r&&(r=!1),(!1===n||n&&t.alive)&&(!1===r||r&&t.visible))return this.setProperty(t,e,i,s,o)},U.Group.prototype.setAll=function(t,e,i,n,r,s){void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===s&&(s=!1),t=t.split("."),r=r||0;for(var o=0;o<this.children.length;o++)(!i||i&&this.children[o].alive)&&(!n||n&&this.children[o].visible)&&this.setProperty(this.children[o],t,e,r,s)},U.Group.prototype.setAllChildren=function(t,e,i,n,r,s){void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===s&&(s=!1),r=r||0;for(var o=0;o<this.children.length;o++)(!i||i&&this.children[o].alive)&&(!n||n&&this.children[o].visible)&&(this.children[o]instanceof U.Group?this.children[o].setAllChildren(t,e,i,n,r,s):this.setProperty(this.children[o],t.split("."),e,r,s))},U.Group.prototype.checkAll=function(t,e,i,n,r){void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===r&&(r=!1);for(var s=0;s<this.children.length;s++)if((!i||i&&this.children[s].alive)&&(!n||n&&this.children[s].visible)&&!this.checkProperty(this.children[s],t,e,r))return!1;return!0},U.Group.prototype.addAll=function(t,e,i,n){this.setAll(t,e,i,n,1)},U.Group.prototype.subAll=function(t,e,i,n){this.setAll(t,e,i,n,2)},U.Group.prototype.multiplyAll=function(t,e,i,n){this.setAll(t,e,i,n,3)},U.Group.prototype.divideAll=function(t,e,i,n){this.setAll(t,e,i,n,4)},U.Group.prototype.callAllExists=function(t,e){var i;if(2<arguments.length){i=[];for(var n=2;n<arguments.length;n++)i.push(arguments[n])}for(n=0;n<this.children.length;n++)this.children[n].exists===e&&this.children[n][t]&&this.children[n][t].apply(this.children[n],i)},U.Group.prototype.callbackFromArray=function(t,e,i){if(1===i){if(t[e[0]])return t[e[0]]}else if(2===i){if(t[e[0]][e[1]])return t[e[0]][e[1]]}else if(3===i){if(t[e[0]][e[1]][e[2]])return t[e[0]][e[1]][e[2]]}else if(4===i){if(t[e[0]][e[1]][e[2]][e[3]])return t[e[0]][e[1]][e[2]][e[3]]}else if(t[e])return t[e];return!1},U.Group.prototype.callAll=function(t,e){if(void 0!==t){var i,n,r=(t=t.split(".")).length;if(null==e||""===e?e=null:"string"==typeof e&&(i=(e=e.split(".")).length),2<arguments.length){n=[];for(var s=2;s<arguments.length;s++)n.push(arguments[s])}for(var o,a=null,s=0;s<this.children.length;s++)a=this.callbackFromArray(this.children[s],t,r),e&&a?(o=this.callbackFromArray(this.children[s],e,i),a&&a.apply(o,n)):a&&a.apply(this.children[s],n)}},U.Group.prototype.preUpdate=function(){if(this.pendingDestroy)return this.destroy(),!1;if(!this.exists||!this.parent.exists)return!(this.renderOrderID=-1);for(var t=0;t<this.children.length;t++)this.children[t].preUpdate();return!0},U.Group.prototype.update=function(){for(var t=this.children.length;t--;)this.children[t].update()},U.Group.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);for(var t=0;t<this.children.length;t++)this.children[t].postUpdate()},U.Group.prototype.filter=function(t,e){for(var i=-1,n=this.children.length,r=[];++i<n;){var s=this.children[i];(!e||e&&s.exists)&&t(s,i,this.children)&&r.push(s)}return new U.ArraySet(r)},U.Group.prototype.forEach=function(t,e,i){if(void 0===i&&(i=!1),arguments.length<=3)for(var n=0;n<this.children.length;n++)(!i||i&&this.children[n].exists)&&t.call(e,this.children[n]);else{for(var r=[null],n=3;n<arguments.length;n++)r.push(arguments[n]);for(n=0;n<this.children.length;n++)(!i||i&&this.children[n].exists)&&(r[0]=this.children[n],t.apply(e,r))}},U.Group.prototype.forEachExists=function(t,e){var i;if(2<arguments.length){i=[null];for(var n=2;n<arguments.length;n++)i.push(arguments[n])}this.iterate("exists",!0,U.Group.RETURN_TOTAL,t,e,i)},U.Group.prototype.forEachAlive=function(t,e){var i;if(2<arguments.length){i=[null];for(var n=2;n<arguments.length;n++)i.push(arguments[n])}this.iterate("alive",!0,U.Group.RETURN_TOTAL,t,e,i)},U.Group.prototype.forEachDead=function(t,e){var i;if(2<arguments.length){i=[null];for(var n=2;n<arguments.length;n++)i.push(arguments[n])}this.iterate("alive",!1,U.Group.RETURN_TOTAL,t,e,i)},U.Group.prototype.sort=function(t,e){this.children.length<2||(void 0===t&&(t="z"),void 0===e&&(e=U.Group.SORT_ASCENDING),this._sortProperty=t,e===U.Group.SORT_ASCENDING?this.children.sort(this.ascendingSortHandler.bind(this)):this.children.sort(this.descendingSortHandler.bind(this)),this.updateZ())},U.Group.prototype.customSort=function(t,e){this.children.length<2||(this.children.sort(t.bind(e)),this.updateZ())},U.Group.prototype.ascendingSortHandler=function(t,e){return t[this._sortProperty]<e[this._sortProperty]||!(t[this._sortProperty]>e[this._sortProperty])&&t.z<e.z?-1:1},U.Group.prototype.descendingSortHandler=function(t,e){return t[this._sortProperty]<e[this._sortProperty]?1:t[this._sortProperty]>e[this._sortProperty]?-1:0},U.Group.prototype.iterate=function(t,e,i,n,r,s){if(0===this.children.length){if(i===U.Group.RETURN_TOTAL)return 0;if(i===U.Group.RETURN_ALL)return[]}var o,a=0;i===U.Group.RETURN_ALL&&(o=[]);for(var l=0;l<this.children.length;l++)if(this.children[l][t]===e){if(a++,n&&(s?(s[0]=this.children[l],n.apply(r,s)):n.call(r,this.children[l])),i===U.Group.RETURN_CHILD)return this.children[l];i===U.Group.RETURN_ALL&&o.push(this.children[l])}return i===U.Group.RETURN_TOTAL?a:i===U.Group.RETURN_ALL?o:null},U.Group.prototype.getFirstExists=function(t,e,i,n,r,s){void 0===e&&(e=!1),"boolean"!=typeof t&&(t=!0);t=this.iterate("exists",t,U.Group.RETURN_CHILD);return null===t&&e?this.create(i,n,r,s):this.resetChild(t,i,n,r,s)},U.Group.prototype.getFirstAlive=function(t,e,i,n,r){void 0===t&&(t=!1);var s=this.iterate("alive",!0,U.Group.RETURN_CHILD);return null===s&&t?this.create(e,i,n,r):this.resetChild(s,e,i,n,r)},U.Group.prototype.getFirstDead=function(t,e,i,n,r){void 0===t&&(t=!1);var s=this.iterate("alive",!1,U.Group.RETURN_CHILD);return null===s&&t?this.create(e,i,n,r):this.resetChild(s,e,i,n,r)},U.Group.prototype.resetChild=function(t,e,i,n,r){return null===t?null:(void 0===e&&(e=null),void 0===i&&(i=null),null!==e&&null!==i&&t.reset(e,i),void 0!==n&&t.loadTexture(n,r),t)},U.Group.prototype.getTop=function(){if(0<this.children.length)return this.children[this.children.length-1]},U.Group.prototype.getBottom=function(){if(0<this.children.length)return this.children[0]},U.Group.prototype.getClosestTo=function(t,e,i){for(var n,r=Number.MAX_VALUE,s=null,o=0;o<this.children.length;o++){var a=this.children[o];a.exists&&((n=Math.abs(U.Point.distance(t,a)))<r&&(!e||e.call(i,a,n))&&(r=n,s=a))}return s},U.Group.prototype.getFurthestFrom=function(t,e,i){for(var n,r=0,s=null,o=0;o<this.children.length;o++){var a=this.children[o];a.exists&&(r<(n=Math.abs(U.Point.distance(t,a)))&&(!e||e.call(i,a,n))&&(r=n,s=a))}return s},U.Group.prototype.countLiving=function(){return this.iterate("alive",!0,U.Group.RETURN_TOTAL)},U.Group.prototype.countDead=function(){return this.iterate("alive",!1,U.Group.RETURN_TOTAL)},U.Group.prototype.getRandom=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.children.length),0===e?null:U.ArrayUtils.getRandomItem(this.children,t,e)},U.Group.prototype.getRandomExists=function(t,e){e=this.getAll("exists",!0,t,e);return this.game.rnd.pick(e)},U.Group.prototype.getAll=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=this.children.length);for(var r=[],s=i;s<n;s++){var o=this.children[s];t&&o[t]===e&&r.push(o)}return r},U.Group.prototype.remove=function(t,e,i){if(void 0===e&&(e=!1),void 0===i&&(i=!1),0===this.children.length||-1===this.children.indexOf(t))return!1;i||!t.events||t.destroyPhase||t.events.onRemovedFromGroup$dispatch(t,this);i=this.removeChild(t);return this.removeFromHash(t),this.updateZ(),this.cursor===t&&this.next(),e&&i&&i.destroy(!0),!0},U.Group.prototype.moveAll=function(t,e){if(void 0===e&&(e=!1),0<this.children.length&&t instanceof U.Group){for(;t.add(this.children[0],e),0<this.children.length;);this.hash=[],this.cursor=null}return t},U.Group.prototype.removeAll=function(t,e,i){if(void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===i&&(i=!1),0!==this.children.length){do{!e&&this.children[0].events&&this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this);var n=this.removeChild(this.children[0])}while(this.removeFromHash(n),t&&n&&n.destroy(!0,i),0<this.children.length);this.hash=[],this.cursor=null}},U.Group.prototype.removeBetween=function(t,e,i,n){if(void 0===e&&(e=this.children.length-1),void 0===i&&(i=!1),void 0===n&&(n=!1),0!==this.children.length){if(e<t||t<0||e>this.children.length)return!1;for(var r=e;t<=r;){!n&&this.children[r].events&&this.children[r].events.onRemovedFromGroup$dispatch(this.children[r],this);var s=this.removeChild(this.children[r]);this.removeFromHash(s),i&&s&&s.destroy(!0),this.cursor===this.children[r]&&(this.cursor=null),r--}this.updateZ()}},U.Group.prototype.destroy=function(t,e){null===this.game||this.ignoreDestroy||(void 0===t&&(t=!0),void 0===e&&(e=!1),this.onDestroy.dispatch(this,t,e),this.removeAll(t),this.cursor=null,this.filters=null,this.pendingDestroy=!1,e||(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1))},Object.defineProperty(U.Group.prototype,"total",{get:function(){return this.iterate("exists",!0,U.Group.RETURN_TOTAL)}}),Object.defineProperty(U.Group.prototype,"length",{get:function(){return this.children.length}}),Object.defineProperty(U.Group.prototype,"angle",{get:function(){return U.Math.radToDeg(this.rotation)},set:function(t){this.rotation=U.Math.degToRad(t)}}),Object.defineProperty(U.Group.prototype,"centerX",{get:function(){return this.getBounds(this.parent).centerX},set:function(t){var e=this.getBounds(this.parent),i=this.x-e.x;this.x=t+i-e.halfWidth}}),Object.defineProperty(U.Group.prototype,"centerY",{get:function(){return this.getBounds(this.parent).centerY},set:function(t){var e=this.getBounds(this.parent),i=this.y-e.y;this.y=t+i-e.halfHeight}}),Object.defineProperty(U.Group.prototype,"left",{get:function(){return this.getBounds(this.parent).left},set:function(t){var e=this.getBounds(this.parent),e=this.x-e.x;this.x=t+e}}),Object.defineProperty(U.Group.prototype,"right",{get:function(){return this.getBounds(this.parent).right},set:function(t){var e=this.getBounds(this.parent),i=this.x-e.x;this.x=t+i-e.width}}),Object.defineProperty(U.Group.prototype,"top",{get:function(){return this.getBounds(this.parent).top},set:function(t){var e=this.getBounds(this.parent),e=this.y-e.y;this.y=t+e}}),Object.defineProperty(U.Group.prototype,"bottom",{get:function(){return this.getBounds(this.parent).bottom},set:function(t){var e=this.getBounds(this.parent),i=this.y-e.y;this.y=t+i-e.height}}),U.World=function(t){U.Group.call(this,t,null,"__world",!1),this.bounds=new U.Rectangle(0,0,t.width,t.height),this.camera=null,this._definedSize=!1,this._width=t.width,this._height=t.height,this.game.state.onStateChange.add(this.stateChange,this)},U.World.prototype=Object.create(U.Group.prototype),U.World.prototype.constructor=U.World,U.World.prototype.boot=function(){this.camera=new U.Camera(this.game,0,0,0,this.game.width,this.game.height),this.game.stage.addChild(this),this.camera.boot()},U.World.prototype.stateChange=function(){this.x=0,this.y=0,this.camera.reset()},U.World.prototype.setBounds=function(t,e,i,n){this._definedSize=!0,this._width=i,this._height=n,this.bounds.setTo(t,e,i,n),this.x=t,this.y=e,this.camera.bounds&&this.camera.bounds.setTo(t,e,Math.max(i,this.game.width),Math.max(n,this.game.height)),this.game.physics.setBoundsToWorld()},U.World.prototype.resize=function(t,e){this._definedSize&&(t<this._width&&(t=this._width),e<this._height&&(e=this._height)),this.bounds.width=t,this.bounds.height=e,this.game.camera.setBoundsToWorld(),this.game.physics.setBoundsToWorld()},U.World.prototype.shutdown=function(){this.destroy(!0,!0)},U.World.prototype.wrap=function(t,e,i,n,r){void 0===e&&(e=0),void 0===i&&(i=!1),void 0===n&&(n=!0),void 0===r&&(r=!0),i?(t.getBounds(),n&&(t.x+t._currentBounds.width<this.bounds.x?t.x=this.bounds.right:t.x>this.bounds.right&&(t.x=this.bounds.left)),r&&(t.y+t._currentBounds.height<this.bounds.top?t.y=this.bounds.bottom:t.y>this.bounds.bottom&&(t.y=this.bounds.top))):(n&&t.x+e<this.bounds.x?t.x=this.bounds.right+e:n&&t.x-e>this.bounds.right&&(t.x=this.bounds.left-e),r&&t.y+e<this.bounds.top?t.y=this.bounds.bottom+e:r&&t.y-e>this.bounds.bottom&&(t.y=this.bounds.top-e))},Object.defineProperty(U.World.prototype,"width",{get:function(){return this.bounds.width},set:function(t){t<this.game.width&&(t=this.game.width),this.bounds.width=t,this._width=t,this._definedSize=!0}}),Object.defineProperty(U.World.prototype,"height",{get:function(){return this.bounds.height},set:function(t){t<this.game.height&&(t=this.game.height),this.bounds.height=t,this._height=t,this._definedSize=!0}}),Object.defineProperty(U.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth+this.bounds.x}}),Object.defineProperty(U.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight+this.bounds.y}}),Object.defineProperty(U.World.prototype,"randomX",{get:function(){return this.bounds.x<0?this.game.rnd.between(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x)):this.game.rnd.between(this.bounds.x,this.bounds.width)}}),Object.defineProperty(U.World.prototype,"randomY",{get:function(){return this.bounds.y<0?this.game.rnd.between(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y)):this.game.rnd.between(this.bounds.y,this.bounds.height)}}),U.Game=function(t,e,i,n,r,s,o,a){return this.id=U.GAMES.push(this)-1,this.config=null,this.physicsConfig=a,this.parent="",this.width=800,this.height=600,this.resolution=1,this._width=800,this._height=600,this.transparent=!1,this.antialias=!0,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!0,this.renderer=null,this.renderType=U.AUTO,this.state=null,this.isBooted=!1,this.isRunning=!1,this.raf=null,this.add=null,this.make=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.net=null,this.scale=null,this.sound=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.physics=null,this.plugins=null,this.rnd=null,this.device=U.Device,this.camera=null,this.canvas=null,this.context=null,this.debug=null,this.particles=null,this.create=null,this.lockRender=!1,this.stepping=!1,this.pendingStep=!1,this.stepCount=0,this.onPause=null,this.onResume=null,this.onBlur=null,this.onFocus=null,this._paused=!1,this._codePaused=!1,this.currentUpdateID=0,this.updatesThisFrame=1,this._deltaTime=0,this._lastCount=0,this._spiraling=0,this._kickstart=!0,this.fpsProblemNotifier=new U.Signal,this.forceSingleUpdate=!0,this._nextFpsNotification=0,1===arguments.length&&"object"==typeof t?this.parseConfig(t):(this.config={enableDebug:!0},void 0!==t&&(this._width=t),void 0!==e&&(this._height=e),void 0!==i&&(this.renderType=i),void 0!==n&&(this.parent=n),void 0!==s&&(this.transparent=s),void 0!==o&&(this.antialias=o),this.rnd=new U.RandomDataGenerator([(Date.now()*Math.random()).toString()]),this.state=new U.StateManager(this,r)),this.device.whenReady(this.boot,this),this},U.Game.prototype={parseConfig:function(t){void 0===(this.config=t).enableDebug&&(this.config.enableDebug=!0),t.width&&(this._width=t.width),t.height&&(this._height=t.height),t.renderer&&(this.renderType=t.renderer),t.parent&&(this.parent=t.parent),void 0!==t.transparent&&(this.transparent=t.transparent),void 0!==t.antialias&&(this.antialias=t.antialias),t.resolution&&(this.resolution=t.resolution),void 0!==t.preserveDrawingBuffer&&(this.preserveDrawingBuffer=t.preserveDrawingBuffer),t.physicsConfig&&(this.physicsConfig=t.physicsConfig);var e=[(Date.now()*Math.random()).toString()];t.seed&&(e=t.seed),this.rnd=new U.RandomDataGenerator(e);e=null;t.state&&(e=t.state),this.state=new U.StateManager(this,e)},boot:function(){this.isBooted||(this.onPause=new U.Signal,this.onResume=new U.Signal,this.onBlur=new U.Signal,this.onFocus=new U.Signal,this.isBooted=!0,(PIXI.game=this).math=U.Math,this.scale=new U.ScaleManager(this,this._width,this._height),this.stage=new U.Stage(this),this.setUpRenderer(),this.world=new U.World(this),this.add=new U.GameObjectFactory(this),this.make=new U.GameObjectCreator(this),this.cache=new U.Cache(this),this.load=new U.Loader(this),this.time=new U.Time(this),this.tweens=new U.TweenManager(this),this.input=new U.Input(this),this.sound=new U.SoundManager(this),this.physics=new U.Physics(this,this.physicsConfig),this.particles=new U.Particles(this),this.create=new U.Create(this),this.plugins=new U.PluginManager(this),this.net=new U.Net(this),this.time.boot(),this.stage.boot(),this.world.boot(),this.scale.boot(),this.input.boot(),this.sound.boot(),this.state.boot(),this.config.enableDebug?(this.debug=new U.Utils.Debug(this),this.debug.boot()):this.debug={preUpdate:function(){},update:function(){},reset:function(){}},this.showDebugHeader(),this.isRunning=!0,this.config&&this.config.forceSetTimeOut?this.raf=new U.RequestAnimationFrame(this,this.config.forceSetTimeOut):this.raf=new U.RequestAnimationFrame(this,!1),this._kickstart=!0,window.focus&&(!window.PhaserGlobal||window.PhaserGlobal&&!window.PhaserGlobal.stopFocus)&&window.focus(),this.raf.start())},showDebugHeader:function(){if(!window.PhaserGlobal||!window.PhaserGlobal.hideBanner){var t=U.VERSION,e="Canvas",i="HTML Audio",n=1;if(this.renderType===U.WEBGL?(e="WebGL",n++):this.renderType===U.HEADLESS&&(e="Headless"),this.device.webAudio&&(i="WebAudio",n++),this.device.chrome){for(var r=["%c %c %c Phaser v"+t+" | Pixi.js | "+e+" | "+i+"  %c %c %c http://phaser.io %câ™¥%câ™¥%câ™¥","background: #fb8cb3","background: #d44a52","color: #ffffff; background: #871905;","background: #d44a52","background: #fb8cb3","background: #ffffff"],s=0;s<3;s++)s<n?r.push("color: #ff2424; background: #fff"):r.push("color: #959595; background: #fff");console.log.apply(console,r)}else window.console&&console.log("Phaser v"+t+" | Pixi.js "+PIXI.VERSION+" | "+e+" | "+i+" | http://phaser.io")}},setUpRenderer:function(){if(this.config.canvas?this.canvas=this.config.canvas:this.canvas=U.Canvas.create(this,this.width,this.height,this.config.canvasID,!0),this.config.canvasStyle?this.canvas.style=this.config.canvasStyle:this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%",this.renderType===U.HEADLESS||this.renderType===U.CANVAS||this.renderType===U.AUTO&&!this.device.webGL){if(!this.device.canvas)throw new Error("Phaser.Game - Cannot create Canvas or WebGL context, aborting.");this.renderType=U.CANVAS,this.renderer=new PIXI.CanvasRenderer(this),this.context=this.renderer.context}else this.renderType=U.WEBGL,this.renderer=new PIXI.WebGLRenderer(this),this.context=null,this.canvas.addEventListener("webglcontextlost",this.contextLost.bind(this),!1),this.canvas.addEventListener("webglcontextrestored",this.contextRestored.bind(this),!1);this.device.cocoonJS&&(this.canvas.screencanvas=this.renderType===U.CANVAS),this.renderType!==U.HEADLESS&&(this.stage.smoothed=this.antialias,U.Canvas.addToDOM(this.canvas,this.parent,!1),U.Canvas.setTouchAction(this.canvas))},contextLost:function(t){t.preventDefault(),this.renderer.contextLost=!0},contextRestored:function(){this.renderer.initContext(),this.cache.clearGLTextures(),this.renderer.contextLost=!1},update:function(t){if(this.time.update(t),this._kickstart)return this.updateLogic(this.time.desiredFpsMult),this.updateRender(this.time.slowMotion*this.time.desiredFps),void(this._kickstart=!1);if(1<this._spiraling&&!this.forceSingleUpdate)this.time.time>this._nextFpsNotification&&(this._nextFpsNotification=this.time.time+1e4,this.fpsProblemNotifier.dispatch()),this._deltaTime=0,this._spiraling=0,this.updateRender(this.time.slowMotion*this.time.desiredFps);else{var e=1e3*this.time.slowMotion/this.time.desiredFps;this._deltaTime+=Math.max(Math.min(3*e,this.time.elapsed),0);var i=0;for(this.updatesThisFrame=Math.floor(this._deltaTime/e),this.forceSingleUpdate&&(this.updatesThisFrame=Math.min(1,this.updatesThisFrame));this._deltaTime>=e&&(this._deltaTime-=e,this.currentUpdateID=i,this.updateLogic(this.time.desiredFpsMult),i++,!this.forceSingleUpdate||1!==i);)this.time.refresh();i>this._lastCount?this._spiraling++:i<this._lastCount&&(this._spiraling=0),this._lastCount=i,this.updateRender(this._deltaTime/e)}},updateLogic:function(t){this._paused||this.pendingStep?(this.scale.pauseUpdate(),this.state.pauseUpdate(),this.debug.preUpdate()):(this.stepping&&(this.pendingStep=!0),this.scale.preUpdate(),this.debug.preUpdate(),this.camera.preUpdate(),this.physics.preUpdate(),this.state.preUpdate(t),this.plugins.preUpdate(t),this.stage.preUpdate(),this.state.update(),this.stage.update(),this.tweens.update(),this.sound.update(),this.input.update(),this.physics.update(),this.particles.update(),this.plugins.update(),this.stage.postUpdate(),this.plugins.postUpdate()),this.stage.updateTransform()},updateRender:function(t){this.lockRender||(this.state.preRender(t),this.renderType!==U.HEADLESS&&(this.renderer.render(this.stage),this.plugins.render(t),this.state.render(t)),this.plugins.postRender(t))},enableStep:function(){this.stepping=!0,this.pendingStep=!1,this.stepCount=0},disableStep:function(){this.stepping=!1,this.pendingStep=!1},step:function(){this.pendingStep=!1,this.stepCount++},destroy:function(){this.raf.stop(),this.state.destroy(),this.sound.destroy(),this.scale.destroy(),this.stage.destroy(),this.input.destroy(),this.physics.destroy(),this.plugins.destroy(),this.state=null,this.sound=null,this.scale=null,this.stage=null,this.input=null,this.physics=null,this.plugins=null,this.cache=null,this.load=null,this.time=null,this.world=null,this.isBooted=!1,this.renderer.destroy(!1),U.Canvas.removeFromDOM(this.canvas),PIXI.defaultRenderer=null,U.GAMES[this.id]=null},gamePaused:function(t){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.muteOnPause&&this.sound.setMute(),this.onPause.dispatch(t),this.device.cordova&&this.device.iOS&&(this.lockRender=!0))},gameResumed:function(t){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.muteOnPause&&this.sound.unsetMute(),this.onResume.dispatch(t),this.device.cordova&&this.device.iOS&&(this.lockRender=!1))},focusLoss:function(t){this.onBlur.dispatch(t),this.stage.disableVisibilityChange||this.gamePaused(t)},focusGain:function(t){this.onFocus.dispatch(t),this.stage.disableVisibilityChange||this.gameResumed(t)}},U.Game.prototype.constructor=U.Game,Object.defineProperty(U.Game.prototype,"paused",{get:function(){return this._paused},set:function(t){!0===t?(!1===this._paused&&(this._paused=!0,this.sound.setMute(),this.time.gamePaused(),this.onPause.dispatch(this)),this._codePaused=!0):(this._paused&&(this._paused=!1,this.input.reset(),this.sound.unsetMute(),this.time.gameResumed(),this.onResume.dispatch(this)),this._codePaused=!1)}}),U.Input=function(t){this.game=t,this.hitCanvas=null,this.hitContext=null,this.moveCallbacks=[],this.customCandidateHandler=null,this.customCandidateHandlerContext=null,this.pollRate=0,this.enabled=!0,this.multiInputOverride=U.Input.MOUSE_TOUCH_COMBINE,this.position=null,this.speed=null,this.circle=null,this.scale=null,this.maxPointers=-1,this.tapRate=200,this.doubleTapRate=300,this.holdRate=2e3,this.justPressedRate=200,this.justReleasedRate=200,this.recordPointerHistory=!1,this.recordRate=100,this.recordLimit=100,this.pointer1=null,this.pointer2=null,this.pointer3=null,this.pointer4=null,this.pointer5=null,this.pointer6=null,this.pointer7=null,this.pointer8=null,this.pointer9=null,this.pointer10=null,this.pointers=[],this.activePointer=null,this.mousePointer=null,this.mouse=null,this.keyboard=null,this.touch=null,this.mspointer=null,this.gamepad=null,this.resetLocked=!1,this.onDown=null,this.onUp=null,this.onTap=null,this.onHold=null,this.minPriorityID=0,this.interactiveItems=new U.ArraySet,this._localPoint=new U.Point,this._pollCounter=0,this._oldPosition=null,this._x=0,this._y=0},U.Input.MOUSE_OVERRIDES_TOUCH=0,U.Input.TOUCH_OVERRIDES_MOUSE=1,U.Input.MOUSE_TOUCH_COMBINE=2,U.Input.MAX_POINTERS=10,U.Input.prototype={boot:function(){this.mousePointer=new U.Pointer(this.game,0,U.PointerMode.CURSOR),this.addPointer(),this.addPointer(),this.mouse=new U.Mouse(this.game),this.touch=new U.Touch(this.game),this.mspointer=new U.MSPointer(this.game),U.Keyboard&&(this.keyboard=new U.Keyboard(this.game)),U.Gamepad&&(this.gamepad=new U.Gamepad(this.game)),this.onDown=new U.Signal,this.onUp=new U.Signal,this.onTap=new U.Signal,this.onHold=new U.Signal,this.scale=new U.Point(1,1),this.speed=new U.Point,this.position=new U.Point,this._oldPosition=new U.Point,this.circle=new U.Circle(0,0,44),this.activePointer=this.mousePointer,this.hitCanvas=PIXI.CanvasPool.create(this,1,1),this.hitContext=this.hitCanvas.getContext("2d"),this.mouse.start(),this.touch.start(),this.mspointer.start(),this.mousePointer.active=!0,this.keyboard&&this.keyboard.start();var e=this;this._onClickTrampoline=function(t){e.onClickTrampoline(t)},this.game.canvas.addEventListener("click",this._onClickTrampoline,!1)},destroy:function(){this.mouse.stop(),this.touch.stop(),this.mspointer.stop(),this.keyboard&&this.keyboard.stop(),this.gamepad&&this.gamepad.stop(),this.moveCallbacks=[],PIXI.CanvasPool.remove(this),this.game.canvas.removeEventListener("click",this._onClickTrampoline)},setInteractiveCandidateHandler:function(t,e){this.customCandidateHandler=t,this.customCandidateHandlerContext=e},addMoveCallback:function(t,e){this.moveCallbacks.push({callback:t,context:e})},deleteMoveCallback:function(t,e){for(var i=this.moveCallbacks.length;i--;)if(this.moveCallbacks[i].callback===t&&this.moveCallbacks[i].context===e)return void this.moveCallbacks.splice(i,1)},addPointer:function(){if(this.pointers.length>=U.Input.MAX_POINTERS)return console.warn("Phaser.Input.addPointer: Maximum limit of "+U.Input.MAX_POINTERS+" pointers reached."),null;var t=this.pointers.length+1,e=new U.Pointer(this.game,t,U.PointerMode.TOUCH);return this.pointers.push(e),this["pointer"+t]=e},update:function(){if(this.keyboard&&this.keyboard.update(),0<this.pollRate&&this._pollCounter<this.pollRate)this._pollCounter++;else{this.speed.x=this.position.x-this._oldPosition.x,this.speed.y=this.position.y-this._oldPosition.y,this._oldPosition.copyFrom(this.position),this.mousePointer.update(),this.gamepad&&this.gamepad.active&&this.gamepad.update();for(var t=0;t<this.pointers.length;t++)this.pointers[t].update();this._pollCounter=0}},reset:function(t){if(this.game.isBooted&&!this.resetLocked){void 0===t&&(t=!1),this.mousePointer.reset(),this.keyboard&&this.keyboard.reset(t),this.gamepad&&this.gamepad.reset();for(var e=0;e<this.pointers.length;e++)this.pointers[e].reset();"none"!==this.game.canvas.style.cursor&&(this.game.canvas.style.cursor="inherit"),t&&(this.onDown.dispose(),this.onUp.dispose(),this.onTap.dispose(),this.onHold.dispose(),this.onDown=new U.Signal,this.onUp=new U.Signal,this.onTap=new U.Signal,this.onHold=new U.Signal,this.moveCallbacks=[]),this._pollCounter=0}},resetSpeed:function(t,e){this._oldPosition.setTo(t,e),this.speed.setTo(0,0)},startPointer:function(t){if(0<=this.maxPointers&&this.countActivePointers(this.maxPointers)>=this.maxPointers)return null;if(!this.pointer1.active)return this.pointer1.start(t);if(!this.pointer2.active)return this.pointer2.start(t);for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(!i.active)return i.start(t)}return null},updatePointer:function(t){if(this.pointer1.active&&this.pointer1.identifier===t.identifier)return this.pointer1.move(t);if(this.pointer2.active&&this.pointer2.identifier===t.identifier)return this.pointer2.move(t);for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active&&i.identifier===t.identifier)return i.move(t)}return null},stopPointer:function(t){if(this.pointer1.active&&this.pointer1.identifier===t.identifier)return this.pointer1.stop(t);if(this.pointer2.active&&this.pointer2.identifier===t.identifier)return this.pointer2.stop(t);for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active&&i.identifier===t.identifier)return i.stop(t)}return null},countActivePointers:function(t){void 0===t&&(t=this.pointers.length);for(var e=t,i=0;i<this.pointers.length&&0<e;i++)this.pointers[i].active&&e--;return t-e},getPointer:function(t){void 0===t&&(t=!1);for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active===t)return i}return null},getPointerFromIdentifier:function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.identifier===t)return i}return null},getPointerFromId:function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.pointerId===t)return i}return null},getLocalPosition:function(t,e,i){void 0===i&&(i=new U.Point);var n=t.worldTransform,t=1/(n.a*n.d+n.c*-n.b);return i.setTo(n.d*t*e.x+-n.c*t*e.y+(n.ty*n.c-n.tx*n.d)*t,n.a*t*e.y+-n.b*t*e.x+(-n.ty*n.a+n.tx*n.b)*t)},hitTest:function(t,e,i){if(!t.worldVisible)return!1;if(this.getLocalPosition(t,e,this._localPoint),i.copyFrom(this._localPoint),t.hitArea&&t.hitArea.contains)return t.hitArea.contains(this._localPoint.x,this._localPoint.y);if(t instanceof U.TileSprite){var n=t.width,r=t.height,s=-n*t.anchor.x;if(this._localPoint.x>=s&&this._localPoint.x<s+n){var o=-r*t.anchor.y;if(this._localPoint.y>=o&&this._localPoint.y<o+r)return!0}}else if(t instanceof PIXI.Sprite){n=t.texture.frame.width,r=t.texture.frame.height,s=-n*t.anchor.x;if(this._localPoint.x>=s&&this._localPoint.x<s+n){o=-r*t.anchor.y;if(this._localPoint.y>=o&&this._localPoint.y<o+r)return!0}}else if(t instanceof U.Graphics)for(var a=0;a<t.graphicsData.length;a++){var l=t.graphicsData[a];if(l.fill&&l.shape&&l.shape.contains(this._localPoint.x,this._localPoint.y))return!0}for(a=0;a<t.children.length;a++)if(this.hitTest(t.children[a],e,i))return!0;return!1},onClickTrampoline:function(){this.activePointer.processClickTrampolines()}},U.Input.prototype.constructor=U.Input,Object.defineProperty(U.Input.prototype,"x",{get:function(){return this._x},set:function(t){this._x=Math.floor(t)}}),Object.defineProperty(U.Input.prototype,"y",{get:function(){return this._y},set:function(t){this._y=Math.floor(t)}}),Object.defineProperty(U.Input.prototype,"pollLocked",{get:function(){return 0<this.pollRate&&this._pollCounter<this.pollRate}}),Object.defineProperty(U.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-this.countActivePointers()}}),Object.defineProperty(U.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}}),Object.defineProperty(U.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}}),Object.defineProperty(U.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}}),U.Mouse=function(t){this.game=t,this.input=t.input,this.callbackContext=this.game,this.mouseDownCallback=null,this.mouseUpCallback=null,this.mouseOutCallback=null,this.mouseOverCallback=null,this.mouseWheelCallback=null,this.capture=!1,this.button=-1,this.wheelDelta=0,this.enabled=!0,this.locked=!1,this.stopOnGameOut=!1,this.pointerLock=new U.Signal,this.event=null,this._onMouseDown=null,this._onMouseMove=null,this._onMouseUp=null,this._onMouseOut=null,this._onMouseOver=null,this._onMouseWheel=null,this._wheelEvent=null},U.Mouse.NO_BUTTON=-1,U.Mouse.LEFT_BUTTON=0,U.Mouse.MIDDLE_BUTTON=1,U.Mouse.RIGHT_BUTTON=2,U.Mouse.BACK_BUTTON=3,U.Mouse.FORWARD_BUTTON=4,U.Mouse.WHEEL_UP=1,U.Mouse.WHEEL_DOWN=-1,U.Mouse.prototype={start:function(){var e,t,i;this.game.device.android&&!1===this.game.device.chrome||null!==this._onMouseDown||((e=this)._onMouseDown=function(t){return e.onMouseDown(t)},this._onMouseMove=function(t){return e.onMouseMove(t)},this._onMouseUp=function(t){return e.onMouseUp(t)},this._onMouseUpGlobal=function(t){return e.onMouseUpGlobal(t)},this._onMouseOutGlobal=function(t){return e.onMouseOutGlobal(t)},this._onMouseOut=function(t){return e.onMouseOut(t)},this._onMouseOver=function(t){return e.onMouseOver(t)},this._onMouseWheel=function(t){return e.onMouseWheel(t)},(t=this.game.canvas).addEventListener("mousedown",this._onMouseDown,!0),t.addEventListener("mousemove",this._onMouseMove,!0),t.addEventListener("mouseup",this._onMouseUp,!0),this.game.device.cocoonJS||(window.addEventListener("mouseup",this._onMouseUpGlobal,!0),window.addEventListener("mouseout",this._onMouseOutGlobal,!0),t.addEventListener("mouseover",this._onMouseOver,!0),t.addEventListener("mouseout",this._onMouseOut,!0)),(i=this.game.device.wheelEvent)&&(t.addEventListener(i,this._onMouseWheel,!0),"mousewheel"===i?this._wheelEvent=new n(-.025,1):"DOMMouseScroll"===i&&(this._wheelEvent=new n(1,1))))},onMouseDown:function(t){this.event=t,this.capture&&t.preventDefault(),this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=0,this.input.mousePointer.start(t))},onMouseMove:function(t){this.event=t,this.capture&&t.preventDefault(),this.mouseMoveCallback&&this.mouseMoveCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=0,this.input.mousePointer.move(t))},onMouseUp:function(t){this.event=t,this.capture&&t.preventDefault(),this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=0,this.input.mousePointer.stop(t))},onMouseUpGlobal:function(t){this.input.mousePointer.withinGame||(this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,t),t.identifier=0,this.input.mousePointer.stop(t))},onMouseOutGlobal:function(t){this.event=t,this.capture&&t.preventDefault(),this.input.mousePointer.withinGame=!1,this.input.enabled&&this.enabled&&(this.input.mousePointer.stop(t),this.input.mousePointer.leftButton.stop(t),this.input.mousePointer.rightButton.stop(t))},onMouseOut:function(t){this.event=t,this.capture&&t.preventDefault(),this.input.mousePointer.withinGame=!1,this.mouseOutCallback&&this.mouseOutCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&this.stopOnGameOut&&(t.identifier=0,this.input.mousePointer.stop(t))},onMouseOver:function(t){this.event=t,this.capture&&t.preventDefault(),this.input.mousePointer.withinGame=!0,this.mouseOverCallback&&this.mouseOverCallback.call(this.callbackContext,t)},onMouseWheel:function(t){this._wheelEvent&&(t=this._wheelEvent.bindEvent(t)),this.event=t,this.capture&&t.preventDefault(),this.wheelDelta=U.Math.clamp(-t.deltaY,-1,1),this.mouseWheelCallback&&this.mouseWheelCallback.call(this.callbackContext,t)},requestPointerLock:function(){var t,e;this.game.device.pointerLock&&((t=this.game.canvas).requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock,t.requestPointerLock(),(e=this)._pointerLockChange=function(t){return e.pointerLockChange(t)},document.addEventListener("pointerlockchange",this._pointerLockChange,!0),document.addEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.addEventListener("webkitpointerlockchange",this._pointerLockChange,!0))},pointerLockChange:function(t){var e=this.game.canvas;document.pointerLockElement===e||document.mozPointerLockElement===e||document.webkitPointerLockElement===e?(this.locked=!0,this.pointerLock.dispatch(!0,t)):(this.locked=!1,this.pointerLock.dispatch(!1,t))},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock(),document.removeEventListener("pointerlockchange",this._pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)},stop:function(){var t=this.game.canvas;t.removeEventListener("mousedown",this._onMouseDown,!0),t.removeEventListener("mousemove",this._onMouseMove,!0),t.removeEventListener("mouseup",this._onMouseUp,!0),t.removeEventListener("mouseover",this._onMouseOver,!0),t.removeEventListener("mouseout",this._onMouseOut,!0);var e=this.game.device.wheelEvent;e&&t.removeEventListener(e,this._onMouseWheel,!0),window.removeEventListener("mouseup",this._onMouseUpGlobal,!0),window.removeEventListener("mouseout",this._onMouseOutGlobal,!0),document.removeEventListener("pointerlockchange",this._pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},U.Mouse.prototype.constructor=U.Mouse,((n.prototype={}).constructor=n).prototype.bindEvent=function(t){if(!n._stubsGenerated&&t){for(var e in t)e in n.prototype||Object.defineProperty(n.prototype,e,{get:function(e){return function(){var t=this.originalEvent[e];return"function"!=typeof t?t:t.bind(this.originalEvent)}}(e)});n._stubsGenerated=!0}return this.originalEvent=t,this},Object.defineProperties(n.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*this.originalEvent.wheelDeltaX||0}},deltaZ:{value:0}}),U.MSPointer=function(t){this.game=t,this.input=t.input,this.callbackContext=this.game,this.pointerDownCallback=null,this.pointerMoveCallback=null,this.pointerUpCallback=null,this.capture=!0,this.button=-1,this.event=null,this.enabled=!0,this._onMSPointerDown=null,this._onMSPointerMove=null,this._onMSPointerUp=null,this._onMSPointerUpGlobal=null,this._onMSPointerOut=null,this._onMSPointerOver=null},U.MSPointer.prototype={start:function(){var e,t;null!==this._onMSPointerDown||(e=this).game.device.mspointer&&(this._onMSPointerDown=function(t){return e.onPointerDown(t)},this._onMSPointerMove=function(t){return e.onPointerMove(t)},this._onMSPointerUp=function(t){return e.onPointerUp(t)},this._onMSPointerUpGlobal=function(t){return e.onPointerUpGlobal(t)},this._onMSPointerOut=function(t){return e.onPointerOut(t)},this._onMSPointerOver=function(t){return e.onPointerOver(t)},(t=this.game.canvas).addEventListener("MSPointerDown",this._onMSPointerDown,!1),t.addEventListener("MSPointerMove",this._onMSPointerMove,!1),t.addEventListener("MSPointerUp",this._onMSPointerUp,!1),t.addEventListener("pointerdown",this._onMSPointerDown,!1),t.addEventListener("pointermove",this._onMSPointerMove,!1),t.addEventListener("pointerup",this._onMSPointerUp,!1),t.style["-ms-content-zooming"]="none",t.style["-ms-touch-action"]="none",this.game.device.cocoonJS||(window.addEventListener("MSPointerUp",this._onMSPointerUpGlobal,!0),t.addEventListener("MSPointerOver",this._onMSPointerOver,!0),t.addEventListener("MSPointerOut",this._onMSPointerOut,!0),window.addEventListener("pointerup",this._onMSPointerUpGlobal,!0),t.addEventListener("pointerover",this._onMSPointerOver,!0),t.addEventListener("pointerout",this._onMSPointerOut,!0)))},onPointerDown:function(t){this.event=t,this.capture&&t.preventDefault(),this.pointerDownCallback&&this.pointerDownCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=t.pointerId,"mouse"===t.pointerType||4===t.pointerType?this.input.mousePointer.start(t):this.input.startPointer(t))},onPointerMove:function(t){this.event=t,this.capture&&t.preventDefault(),this.pointerMoveCallback&&this.pointerMoveCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=t.pointerId,"mouse"===t.pointerType||4===t.pointerType?this.input.mousePointer.move(t):this.input.updatePointer(t))},onPointerUp:function(t){this.event=t,this.capture&&t.preventDefault(),this.pointerUpCallback&&this.pointerUpCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=t.pointerId,"mouse"===t.pointerType||4===t.pointerType?this.input.mousePointer.stop(t):this.input.stopPointer(t))},onPointerUpGlobal:function(t){var e;(!("mouse"!==t.pointerType&&4!==t.pointerType||this.input.mousePointer.withinGame)||(e=this.input.getPointerFromIdentifier(t.identifier))&&e.withinGame)&&this.onPointerUp(t)},onPointerOut:function(t){var e;this.event=t,this.capture&&t.preventDefault(),"mouse"===t.pointerType||4===t.pointerType?this.input.mousePointer.withinGame=!1:(e=this.input.getPointerFromIdentifier(t.identifier))&&(e.withinGame=!1),this.input.mouse.mouseOutCallback&&this.input.mouse.mouseOutCallback.call(this.input.mouse.callbackContext,t),this.input.enabled&&this.enabled&&this.input.mouse.stopOnGameOut&&(t.identifier=0,(e||this.input.mousePointer).stop(t))},onPointerOver:function(t){var e;this.event=t,this.capture&&t.preventDefault(),"mouse"===t.pointerType||4===t.pointerType?this.input.mousePointer.withinGame=!0:(e=this.input.getPointerFromIdentifier(t.identifier))&&(e.withinGame=!0),this.input.mouse.mouseOverCallback&&this.input.mouse.mouseOverCallback.call(this.input.mouse.callbackContext,t)},stop:function(){var t=this.game.canvas;t.removeEventListener("MSPointerDown",this._onMSPointerDown,!1),t.removeEventListener("MSPointerMove",this._onMSPointerMove,!1),t.removeEventListener("MSPointerUp",this._onMSPointerUp,!1),t.removeEventListener("pointerdown",this._onMSPointerDown,!1),t.removeEventListener("pointermove",this._onMSPointerMove,!1),t.removeEventListener("pointerup",this._onMSPointerUp,!1),window.removeEventListener("MSPointerUp",this._onMSPointerUpGlobal,!0),t.removeEventListener("MSPointerOver",this._onMSPointerOver,!0),t.removeEventListener("MSPointerOut",this._onMSPointerOut,!0),window.removeEventListener("pointerup",this._onMSPointerUpGlobal,!0),t.removeEventListener("pointerover",this._onMSPointerOver,!0),t.removeEventListener("pointerout",this._onMSPointerOut,!0)}},U.MSPointer.prototype.constructor=U.MSPointer,U.DeviceButton=function(t,e){this.parent=t,this.game=t.game,this.event=null,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.repeats=0,this.altKey=!1,this.shiftKey=!1,this.ctrlKey=!1,this.value=0,this.buttonCode=e,this.onDown=new U.Signal,this.onUp=new U.Signal,this.onFloat=new U.Signal},U.DeviceButton.prototype={start:function(t,e){this.isDown||(this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.repeats=0,this.event=t,this.value=e,t&&(this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.ctrlKey=t.ctrlKey),this.onDown.dispatch(this,e))},stop:function(t,e){this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.event=t,this.value=e,t&&(this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.ctrlKey=t.ctrlKey),this.onUp.dispatch(this,e))},padFloat:function(t){this.value=t,this.onFloat.dispatch(this,t)},justPressed:function(t){return t=t||250,this.isDown&&this.timeDown+t>this.game.time.time},justReleased:function(t){return t=t||250,this.isUp&&this.timeUp+t>this.game.time.time},reset:function(){this.isDown=!1,this.isUp=!0,this.timeDown=this.game.time.time,this.repeats=0,this.altKey=!1,this.shiftKey=!1,this.ctrlKey=!1},destroy:function(){this.onDown.dispose(),this.onUp.dispose(),this.onFloat.dispose(),this.parent=null,this.game=null}},U.DeviceButton.prototype.constructor=U.DeviceButton,Object.defineProperty(U.DeviceButton.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}}),U.Pointer=function(t,e,i){this.game=t,this.id=e,this.type=U.POINTER,this.exists=!0,this.identifier=0,this.pointerId=null,this.pointerMode=i||U.PointerMode.CURSOR|U.PointerMode.CONTACT,this.target=null,this.button=null,this.leftButton=new U.DeviceButton(this,U.Pointer.LEFT_BUTTON),this.middleButton=new U.DeviceButton(this,U.Pointer.MIDDLE_BUTTON),this.rightButton=new U.DeviceButton(this,U.Pointer.RIGHT_BUTTON),this.backButton=new U.DeviceButton(this,U.Pointer.BACK_BUTTON),this.forwardButton=new U.DeviceButton(this,U.Pointer.FORWARD_BUTTON),this.eraserButton=new U.DeviceButton(this,U.Pointer.ERASER_BUTTON),this._holdSent=!1,this._history=[],this._nextDrop=0,this._stateReset=!1,this.withinGame=!1,this.clientX=-1,this.clientY=-1,this.pageX=-1,this.pageY=-1,this.screenX=-1,this.screenY=-1,this.rawMovementX=0,this.rawMovementY=0,this.movementX=0,this.movementY=0,this.x=-1,this.y=-1,this.isMouse=0===e,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.previousTapTime=0,this.totalTouches=0,this.msSinceLastClick=Number.MAX_VALUE,this.targetObject=null,this.interactiveCandidates=[],this.active=!1,this.dirty=!1,this.position=new U.Point,this.positionDown=new U.Point,this.positionUp=new U.Point,this.circle=new U.Circle(0,0,44),this._clickTrampolines=null,this._trampolineTargetObject=null},U.Pointer.NO_BUTTON=0,U.Pointer.LEFT_BUTTON=1,U.Pointer.RIGHT_BUTTON=2,U.Pointer.MIDDLE_BUTTON=4,U.Pointer.BACK_BUTTON=8,U.Pointer.FORWARD_BUTTON=16,U.Pointer.ERASER_BUTTON=32,U.Pointer.prototype={resetButtons:function(){this.isDown=!1,this.isUp=!0,this.isMouse&&(this.leftButton.reset(),this.middleButton.reset(),this.rightButton.reset(),this.backButton.reset(),this.forwardButton.reset(),this.eraserButton.reset())},processButtonsDown:function(t,e){U.Pointer.LEFT_BUTTON&t&&this.leftButton.start(e),U.Pointer.RIGHT_BUTTON&t&&this.rightButton.start(e),U.Pointer.MIDDLE_BUTTON&t&&this.middleButton.start(e),U.Pointer.BACK_BUTTON&t&&this.backButton.start(e),U.Pointer.FORWARD_BUTTON&t&&this.forwardButton.start(e),U.Pointer.ERASER_BUTTON&t&&this.eraserButton.start(e)},processButtonsUp:function(t,e){t===U.Mouse.LEFT_BUTTON&&this.leftButton.stop(e),t===U.Mouse.RIGHT_BUTTON&&this.rightButton.stop(e),t===U.Mouse.MIDDLE_BUTTON&&this.middleButton.stop(e),t===U.Mouse.BACK_BUTTON&&this.backButton.stop(e),t===U.Mouse.FORWARD_BUTTON&&this.forwardButton.stop(e),5===t&&this.eraserButton.stop(e)},updateButtons:function(t){this.button=t.button;var e="down"===t.type.toLowerCase().substr(-4);void 0!==t.buttons?e?this.processButtonsDown(t.buttons,t):this.processButtonsUp(t.button,t):e?this.leftButton.start(t):(this.leftButton.stop(t),this.rightButton.stop(t)),1===t.buttons&&t.ctrlKey&&this.leftButton.isDown&&(this.leftButton.stop(t),this.rightButton.start(t)),this.isUp=!0,this.isDown=!1,(this.leftButton.isDown||this.rightButton.isDown||this.middleButton.isDown||this.backButton.isDown||this.forwardButton.isDown||this.eraserButton.isDown)&&(this.isUp=!1,this.isDown=!0)},start:function(t){var e=this.game.input;return t.pointerId&&(this.pointerId=t.pointerId),this.identifier=t.identifier,this.target=t.target,this.isMouse?this.updateButtons(t):(this.isDown=!0,this.isUp=!1),this.active=!0,this.withinGame=!0,this.dirty=!1,this._history=[],this._clickTrampolines=null,this._trampolineTargetObject=null,this.msSinceLastClick=this.game.time.time-this.timeDown,this.timeDown=this.game.time.time,this._holdSent=!1,this.move(t,!0),this.positionDown.setTo(this.x,this.y),(e.multiInputOverride===U.Input.MOUSE_OVERRIDES_TOUCH||e.multiInputOverride===U.Input.MOUSE_TOUCH_COMBINE||e.multiInputOverride===U.Input.TOUCH_OVERRIDES_MOUSE&&0===e.totalActivePointers)&&(e.x=this.x,e.y=this.y,e.position.setTo(this.x,this.y),e.onDown.dispatch(this,t),e.resetSpeed(this.x,this.y)),this._stateReset=!1,this.totalTouches++,null!==this.targetObject&&this.targetObject._touchedHandler(this),this},update:function(){var t=this.game.input;this.active&&(this.dirty&&(0<t.interactiveItems.total&&this.processInteractiveObjects(!1),this.dirty=!1),!1===this._holdSent&&this.duration>=t.holdRate&&((t.multiInputOverride===U.Input.MOUSE_OVERRIDES_TOUCH||t.multiInputOverride===U.Input.MOUSE_TOUCH_COMBINE||t.multiInputOverride===U.Input.TOUCH_OVERRIDES_MOUSE&&0===t.totalActivePointers)&&t.onHold.dispatch(this),this._holdSent=!0),t.recordPointerHistory&&this.game.time.time>=this._nextDrop&&(this._nextDrop=this.game.time.time+t.recordRate,this._history.push({x:this.position.x,y:this.position.y}),this._history.length>t.recordLimit&&this._history.shift()))},move:function(t,e){var i=this.game.input;if(!i.pollLocked){if(void 0===e&&(e=!1),void 0!==t.button&&(this.button=t.button),e&&this.isMouse&&this.updateButtons(t),this.clientX=t.clientX,this.clientY=t.clientY,this.pageX=t.pageX,this.pageY=t.pageY,this.screenX=t.screenX,this.screenY=t.screenY,this.isMouse&&i.mouse.locked&&!e&&(this.rawMovementX=t.movementX||t.mozMovementX||t.webkitMovementX||0,this.rawMovementY=t.movementY||t.mozMovementY||t.webkitMovementY||0,this.movementX+=this.rawMovementX,this.movementY+=this.rawMovementY),this.x=(this.pageX-this.game.scale.offset.x)*i.scale.x,this.y=(this.pageY-this.game.scale.offset.y)*i.scale.y,this.position.setTo(this.x,this.y),this.circle.x=this.x,this.circle.y=this.y,(i.multiInputOverride===U.Input.MOUSE_OVERRIDES_TOUCH||i.multiInputOverride===U.Input.MOUSE_TOUCH_COMBINE||i.multiInputOverride===U.Input.TOUCH_OVERRIDES_MOUSE&&0===i.totalActivePointers)&&(i.activePointer=this,i.x=this.x,i.y=this.y,i.position.setTo(i.x,i.y),i.circle.x=i.x,i.circle.y=i.y),this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY),this.game.paused)return this;for(var n=i.moveCallbacks.length;n--;)i.moveCallbacks[n].callback.call(i.moveCallbacks[n].context,this,this.x,this.y,e);return null!==this.targetObject&&!0===this.targetObject.isDragged?!1===this.targetObject.update(this)&&(this.targetObject=null):0<i.interactiveItems.total&&this.processInteractiveObjects(e),this}},processInteractiveObjects:function(t){var e=0,i=-1,n=null,r=this.game.input.interactiveItems.first;for(this.interactiveCandidates=[];r;)r.checked=!1,r.validForInput(i,e,!1)&&(r.checked=!0,(t&&r.checkPointerDown(this,!0)||!t&&r.checkPointerOver(this,!0))&&(e=r.sprite.renderOrderID,i=r.priorityID,n=r,this.interactiveCandidates.push(r))),r=this.game.input.interactiveItems.next;for(r=this.game.input.interactiveItems.first;r;)!r.checked&&r.validForInput(i,e,!0)&&(t&&r.checkPointerDown(this,!1)||!t&&r.checkPointerOver(this,!1))&&(e=r.sprite.renderOrderID,i=r.priorityID,n=r,this.interactiveCandidates.push(r)),r=this.game.input.interactiveItems.next;return this.game.input.customCandidateHandler&&(n=this.game.input.customCandidateHandler.call(this.game.input.customCandidateHandlerContext,this,this.interactiveCandidates,n)),this.swapTarget(n,!1),null!==this.targetObject},swapTarget:function(t,e){void 0===e&&(e=!1),null===t?this.targetObject&&(this.targetObject._pointerOutHandler(this,e),this.targetObject=null):null===this.targetObject?(this.targetObject=t)._pointerOverHandler(this,e):this.targetObject===t?!1===t.update(this)&&(this.targetObject=null):(this.targetObject._pointerOutHandler(this,e),this.targetObject=t,this.targetObject._pointerOverHandler(this,e))},leave:function(t){this.withinGame=!1,this.move(t,!1)},stop:function(t){var e=this.game.input;return this._stateReset&&this.withinGame?void t.preventDefault():(this.timeUp=this.game.time.time,(e.multiInputOverride===U.Input.MOUSE_OVERRIDES_TOUCH||e.multiInputOverride===U.Input.MOUSE_TOUCH_COMBINE||e.multiInputOverride===U.Input.TOUCH_OVERRIDES_MOUSE&&0===e.totalActivePointers)&&(e.onUp.dispatch(this,t),0<=this.duration&&this.duration<=e.tapRate&&(this.timeUp-this.previousTapTime<e.doubleTapRate?e.onTap.dispatch(this,!0):e.onTap.dispatch(this,!1),this.previousTapTime=this.timeUp)),this.isMouse?this.updateButtons(t):(this.isDown=!1,this.isUp=!0),0<this.id&&(this.active=!1),this.withinGame=this.game.scale.bounds.contains(t.pageX,t.pageY),this.pointerId=null,this.identifier=null,this.positionUp.setTo(this.x,this.y),!1===this.isMouse&&e.currentPointers--,e.interactiveItems.callAll("_releasedHandler",this),this._clickTrampolines&&(this._trampolineTargetObject=this.targetObject),this.targetObject=null,this)},justPressed:function(t){return t=t||this.game.input.justPressedRate,!0===this.isDown&&this.timeDown+t>this.game.time.time},justReleased:function(t){return t=t||this.game.input.justReleasedRate,this.isUp&&this.timeUp+t>this.game.time.time},addClickTrampoline:function(t,e,i,n){if(this.isDown){for(var r=this._clickTrampolines=this._clickTrampolines||[],s=0;s<r.length;s++)if(r[s].name===t){r.splice(s,1);break}r.push({name:t,targetObject:this.targetObject,callback:e,callbackContext:i,callbackArgs:n})}},processClickTrampolines:function(){var t=this._clickTrampolines;if(t){for(var e=0;e<t.length;e++){var i=t[e];i.targetObject===this._trampolineTargetObject&&i.callback.apply(i.callbackContext,i.callbackArgs)}this._clickTrampolines=null,this._trampolineTargetObject=null}},reset:function(){!1===this.isMouse&&(this.active=!1),this.pointerId=null,this.identifier=null,this.dirty=!1,this.totalTouches=0,this._holdSent=!1,this._history.length=0,this._stateReset=!0,this.resetButtons(),this.targetObject&&this.targetObject._releasedHandler(this),this.targetObject=null},resetMovement:function(){this.movementX=0,this.movementY=0}},U.Pointer.prototype.constructor=U.Pointer,Object.defineProperty(U.Pointer.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}}),Object.defineProperty(U.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}}),Object.defineProperty(U.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}}),U.PointerMode={CURSOR:1,CONTACT:2},U.Touch=function(t){this.game=t,this.enabled=!0,this.touchLockCallbacks=[],this.callbackContext=this.game,this.touchStartCallback=null,this.touchMoveCallback=null,this.touchEndCallback=null,this.touchEnterCallback=null,this.touchLeaveCallback=null,this.touchCancelCallback=null,this.preventDefault=!0,this.event=null,this._onTouchStart=null,this._onTouchMove=null,this._onTouchEnd=null,this._onTouchEnter=null,this._onTouchLeave=null,this._onTouchCancel=null,this._onTouchMove=null},U.Touch.prototype={start:function(){var e;null!==this._onTouchStart||(e=this).game.device.touch&&(this._onTouchStart=function(t){return e.onTouchStart(t)},this._onTouchMove=function(t){return e.onTouchMove(t)},this._onTouchEnd=function(t){return e.onTouchEnd(t)},this._onTouchEnter=function(t){return e.onTouchEnter(t)},this._onTouchLeave=function(t){return e.onTouchLeave(t)},this._onTouchCancel=function(t){return e.onTouchCancel(t)},this.game.canvas.addEventListener("touchstart",this._onTouchStart,!1),this.game.canvas.addEventListener("touchmove",this._onTouchMove,!1),this.game.canvas.addEventListener("touchend",this._onTouchEnd,!1),this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,!1),this.game.device.cocoonJS||(this.game.canvas.addEventListener("touchenter",this._onTouchEnter,!1),this.game.canvas.addEventListener("touchleave",this._onTouchLeave,!1)))},consumeDocumentTouches:function(){this._documentTouchMove=function(t){t.preventDefault()},document.addEventListener("touchmove",this._documentTouchMove,!1)},addTouchLockCallback:function(t,e,i){void 0===i&&(i=!1),this.touchLockCallbacks.push({callback:t,context:e,onEnd:i})},removeTouchLockCallback:function(t,e){for(var i=this.touchLockCallbacks.length;i--;)if(this.touchLockCallbacks[i].callback===t&&this.touchLockCallbacks[i].context===e)return this.touchLockCallbacks.splice(i,1),!0;return!1},onTouchStart:function(t){for(var e=this.touchLockCallbacks.length;e--;){var i=this.touchLockCallbacks[e];!i.onEnd&&i.callback.call(i.context,this,t)&&this.touchLockCallbacks.splice(e,1)}if(this.event=t,this.game.input.enabled&&this.enabled){this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,t),this.preventDefault&&t.preventDefault();for(e=0;e<t.changedTouches.length;e++)this.game.input.startPointer(t.changedTouches[e])}},onTouchCancel:function(t){if(this.event=t,this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,t),this.game.input.enabled&&this.enabled){this.preventDefault&&t.preventDefault();for(var e=0;e<t.changedTouches.length;e++)this.game.input.stopPointer(t.changedTouches[e])}},onTouchEnter:function(t){this.event=t,this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,t),this.game.input.enabled&&this.enabled&&this.preventDefault&&t.preventDefault()},onTouchLeave:function(t){this.event=t,this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,t),this.preventDefault&&t.preventDefault()},onTouchMove:function(t){this.event=t,this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,t),this.preventDefault&&t.preventDefault();for(var e=0;e<t.changedTouches.length;e++)this.game.input.updatePointer(t.changedTouches[e])},onTouchEnd:function(t){for(var e=this.touchLockCallbacks.length;e--;){var i=this.touchLockCallbacks[e];i.onEnd&&i.callback.call(i.context,this,t)&&this.touchLockCallbacks.splice(e,1)}this.event=t,this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,t),this.preventDefault&&t.preventDefault();for(e=0;e<t.changedTouches.length;e++)this.game.input.stopPointer(t.changedTouches[e])},stop:function(){this.game.device.touch&&(this.game.canvas.removeEventListener("touchstart",this._onTouchStart),this.game.canvas.removeEventListener("touchmove",this._onTouchMove),this.game.canvas.removeEventListener("touchend",this._onTouchEnd),this.game.canvas.removeEventListener("touchenter",this._onTouchEnter),this.game.canvas.removeEventListener("touchleave",this._onTouchLeave),this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel))}},U.Touch.prototype.constructor=U.Touch,U.InputHandler=function(t){this.sprite=t,this.game=t.game,this.enabled=!1,this.checked=!1,this.priorityID=0,this.useHandCursor=!1,this._setHandCursor=!1,this.isDragged=!1,this.allowHorizontalDrag=!0,this.allowVerticalDrag=!0,this.bringToTop=!1,this.snapOffset=null,this.snapOnDrag=!1,this.snapOnRelease=!1,this.snapX=0,this.snapY=0,this.snapOffsetX=0,this.snapOffsetY=0,this.pixelPerfectOver=!1,this.pixelPerfectClick=!1,this.pixelPerfectAlpha=255,this.draggable=!1,this.boundsRect=null,this.boundsSprite=null,this.scaleLayer=!1,this.dragOffset=new U.Point,this.dragFromCenter=!1,this.dragStopBlocksInputUp=!1,this.dragStartPoint=new U.Point,this.dragDistanceThreshold=0,this.dragTimeThreshold=0,this.downPoint=new U.Point,this.snapPoint=new U.Point,this._dragPoint=new U.Point,this._dragPhase=!1,this._pendingDrag=!1,this._dragTimePass=!1,this._dragDistancePass=!1,this._wasEnabled=!1,this._tempPoint=new U.Point,this._pointerData=[],this._pointerData.push({id:0,x:0,y:0,camX:0,camY:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1})},U.InputHandler.prototype={start:function(t,e){if(t=t||0,void 0===e&&(e=!1),!1===this.enabled){this.game.input.interactiveItems.add(this),this.useHandCursor=e,this.priorityID=t;for(var i=0;i<10;i++)this._pointerData[i]={id:i,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1};this.snapOffset=new U.Point,this.enabled=!0,this._wasEnabled=!0}return this.sprite.events.onAddedToGroup.add(this.addedToGroup,this),this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this),this.sprite},addedToGroup:function(){this._dragPhase||this._wasEnabled&&!this.enabled&&this.start()},removedFromGroup:function(){this._dragPhase||(this.enabled?(this._wasEnabled=!0,this.stop()):this._wasEnabled=!1)},reset:function(){this.enabled=!1;for(var t=0;t<10;t++)this._pointerData[t]={id:t,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1}},stop:function(){!1!==this.enabled&&(this.enabled=!1,this.game.input.interactiveItems.remove(this))},destroy:function(){this.sprite&&(this._setHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.enabled=!1,this.game.input.interactiveItems.remove(this),this._pointerData.length=0,this.boundsRect=null,this.boundsSprite=null,this.sprite=null)},validForInput:function(t,e,i){return void 0===i&&(i=!0),!(!this.enabled||0===this.sprite.scale.x||0===this.sprite.scale.y||this.priorityID<this.game.input.minPriorityID||this.sprite.parent&&this.sprite.parent.ignoreChildInput||!i&&(this.pixelPerfectClick||this.pixelPerfectOver)||!(this.priorityID>t||this.priorityID===t&&this.sprite.renderOrderID>e))},isPixelPerfect:function(){return this.pixelPerfectClick||this.pixelPerfectOver},pointerX:function(t){return t=t||0,this._pointerData[t].x},pointerY:function(t){return t=t||0,this._pointerData[t].y},pointerDown:function(t){return t=t||0,this._pointerData[t].isDown},pointerUp:function(t){return t=t||0,this._pointerData[t].isUp},pointerTimeDown:function(t){return t=t||0,this._pointerData[t].timeDown},pointerTimeUp:function(t){return t=t||0,this._pointerData[t].timeUp},pointerOver:function(t){if(!this.enabled)return!1;if(void 0!==t)return this._pointerData[t].isOver;for(var e=0;e<10;e++)if(this._pointerData[e].isOver)return!0;return!1},pointerOut:function(t){if(!this.enabled)return!1;if(void 0!==t)return this._pointerData[t].isOut;for(var e=0;e<10;e++)if(this._pointerData[e].isOut)return!0},pointerTimeOver:function(t){return t=t||0,this._pointerData[t].timeOver},pointerTimeOut:function(t){return t=t||0,this._pointerData[t].timeOut},pointerDragged:function(t){return t=t||0,this._pointerData[t].isDragged},checkPointerDown:function(t,e){return!!(t.isDown&&this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&0!==this.sprite.worldScale.x&&0!==this.sprite.worldScale.y)&&!!this.game.input.hitTest(this.sprite,t,this._tempPoint)&&(void 0===e&&(e=!1),!(!e&&this.pixelPerfectClick)||this.checkPixel(this._tempPoint.x,this._tempPoint.y))},checkPointerOver:function(t,e){return!!(this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&0!==this.sprite.worldScale.x&&0!==this.sprite.worldScale.y)&&!!this.game.input.hitTest(this.sprite,t,this._tempPoint)&&(void 0===e&&(e=!1),!(!e&&this.pixelPerfectOver)||this.checkPixel(this._tempPoint.x,this._tempPoint.y))},checkPixel:function(t,e,i){if(this.sprite.texture.baseTexture.source){if(null===t&&null===e&&(this.game.input.getLocalPosition(this.sprite,i,this._tempPoint),t=this._tempPoint.x,e=this._tempPoint.y),0!==this.sprite.anchor.x&&(t-=-this.sprite.texture.frame.width*this.sprite.anchor.x),0!==this.sprite.anchor.y&&(e-=-this.sprite.texture.frame.height*this.sprite.anchor.y),t+=this.sprite.texture.frame.x,e+=this.sprite.texture.frame.y,this.sprite.texture.trim&&(t-=this.sprite.texture.trim.x,e-=this.sprite.texture.trim.y,t<this.sprite.texture.crop.x||t>this.sprite.texture.crop.right||e<this.sprite.texture.crop.y||e>this.sprite.texture.crop.bottom))return this._dx=t,this._dy=e,!1;if(this._dx=t,this._dy=e,this.game.input.hitContext.clearRect(0,0,1,1),this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,t,e,1,1,0,0,1,1),this.game.input.hitContext.getImageData(0,0,1,1).data[3]>=this.pixelPerfectAlpha)return!0}return!1},update:function(t){if(null!==this.sprite&&void 0!==this.sprite.parent)return this.enabled&&this.sprite.visible&&this.sprite.parent.visible?this._pendingDrag?(this._dragDistancePass||(this._dragDistancePass=U.Math.distance(t.x,t.y,this.downPoint.x,this.downPoint.y)>=this.dragDistanceThreshold),this._dragDistancePass&&this._dragTimePass&&this.startDrag(t),!0):this.draggable&&this._draggedPointerID===t.id?this.updateDrag(t,!1):this._pointerData[t.id].isOver?this.checkPointerOver(t)?(this._pointerData[t.id].x=t.x-this.sprite.x,this._pointerData[t.id].y=t.y-this.sprite.y,!0):(this._pointerOutHandler(t),!1):void 0:(this._pointerOutHandler(t),!1)},_pointerOverHandler:function(t,e){var i,n;null!==this.sprite&&(!1!==(i=this._pointerData[t.id]).isOver&&!t.dirty||(n=!1===i.isOver,i.isOver=!0,i.isOut=!1,i.timeOver=this.game.time.time,i.x=t.x-this.sprite.x,i.y=t.y-this.sprite.y,this.useHandCursor&&!1===i.isDragged&&(this.game.canvas.style.cursor="pointer",this._setHandCursor=!0),!e&&n&&this.sprite&&this.sprite.events&&this.sprite.events.onInputOver$dispatch(this.sprite,t),this.sprite.parent&&this.sprite.parent.type===U.GROUP&&this.sprite.parent.onChildInputOver.dispatch(this.sprite,t)))},_pointerOutHandler:function(t,e){var i;null!==this.sprite&&((i=this._pointerData[t.id]).isOver=!1,i.isOut=!0,i.timeOut=this.game.time.time,this.useHandCursor&&!1===i.isDragged&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),!e&&this.sprite&&this.sprite.events&&(this.sprite.events.onInputOut$dispatch(this.sprite,t),this.sprite&&this.sprite.parent&&this.sprite.parent.type===U.GROUP&&this.sprite.parent.onChildInputOut.dispatch(this.sprite,t)))},_touchedHandler:function(t){var e;null===this.sprite||!(e=this._pointerData[t.id]).isDown&&e.isOver&&(this.pixelPerfectClick&&!this.checkPixel(null,null,t)||(e.isDown=!0,e.isUp=!1,e.timeDown=this.game.time.time,this.downPoint.set(t.x,t.y),t.dirty=!0,this.sprite&&this.sprite.events&&(this.sprite.events.onInputDown$dispatch(this.sprite,t),this.sprite&&this.sprite.parent&&this.sprite.parent.type===U.GROUP&&this.sprite.parent.onChildInputDown.dispatch(this.sprite,t),null===this.sprite)||(this.draggable&&!1===this.isDragged&&(0===this.dragTimeThreshold&&0===this.dragDistanceThreshold?this.startDrag(t):(this._pendingDrag=!0,this._dragDistancePass=0===this.dragDistanceThreshold,0<this.dragTimeThreshold?(this._dragTimePass=!1,this.game.time.events.add(this.dragTimeThreshold,this.dragTimeElapsed,this,t)):this._dragTimePass=!0)),this.bringToTop&&this.sprite.bringToTop())))},dragTimeElapsed:function(t){this._dragTimePass=!0,this._pendingDrag&&this.sprite&&this._dragDistancePass&&this.startDrag(t)},_releasedHandler:function(t){var e,i;null===this.sprite||(e=this._pointerData[t.id]).isDown&&t.isUp&&(e.isDown=!1,e.isUp=!0,e.timeUp=this.game.time.time,e.downDuration=e.timeUp-e.timeDown,i=this.checkPointerOver(t),this.sprite&&this.sprite.events&&(this.dragStopBlocksInputUp&&(!this.dragStopBlocksInputUp||this.draggable&&this.isDragged&&this._draggedPointerID===t.id)||this.sprite.events.onInputUp$dispatch(this.sprite,t,i),this.sprite&&this.sprite.parent&&this.sprite.parent.type===U.GROUP&&this.sprite.parent.onChildInputUp.dispatch(this.sprite,t,i),i=i&&this.checkPointerOver(t)),!(e.isOver=i)&&this.useHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),t.dirty=!0,this._pendingDrag=!1,this.draggable&&this.isDragged&&this._draggedPointerID===t.id&&this.stopDrag(t))},updateDrag:function(t,e){if(void 0===e&&(e=!1),t.isUp)return this.stopDrag(t),!1;var i,n,r=this.globalToLocalX(t.x)+this._dragPoint.x+this.dragOffset.x,s=this.globalToLocalY(t.y)+this._dragPoint.y+this.dragOffset.y;return this.sprite.fixedToCamera?(this.allowHorizontalDrag&&(this.sprite.cameraOffset.x=r),this.allowVerticalDrag&&(this.sprite.cameraOffset.y=s),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY,this.snapPoint.set(this.sprite.cameraOffset.x,this.sprite.cameraOffset.y))):(i=this.game.camera.x-this._pointerData[t.id].camX,n=this.game.camera.y-this._pointerData[t.id].camY,this.allowHorizontalDrag&&(this.sprite.x=r+i),this.allowVerticalDrag&&(this.sprite.y=s+n),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY,this.snapPoint.set(this.sprite.x,this.sprite.y))),this.sprite.events.onDragUpdate.dispatch(this.sprite,t,r,s,this.snapPoint,e),!0},justOver:function(t,e){return t=t||0,e=e||500,this._pointerData[t].isOver&&this.overDuration(t)<e},justOut:function(t,e){return t=t||0,e=e||500,this._pointerData[t].isOut&&this.game.time.time-this._pointerData[t].timeOut<e},justPressed:function(t,e){return t=t||0,e=e||500,this._pointerData[t].isDown&&this.downDuration(t)<e},justReleased:function(t,e){return t=t||0,e=e||500,this._pointerData[t].isUp&&this.game.time.time-this._pointerData[t].timeUp<e},overDuration:function(t){return t=t||0,this._pointerData[t].isOver?this.game.time.time-this._pointerData[t].timeOver:-1},downDuration:function(t){return t=t||0,this._pointerData[t].isDown?this.game.time.time-this._pointerData[t].timeDown:-1},enableDrag:function(t,e,i,n,r,s){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===n&&(n=255),void 0===r&&(r=null),void 0===s&&(s=null),this._dragPoint=new U.Point,this.draggable=!0,this.bringToTop=e,this.dragOffset=new U.Point,this.dragFromCenter=t,this.pixelPerfectClick=i,this.pixelPerfectAlpha=n,r&&(this.boundsRect=r),s&&(this.boundsSprite=s)},disableDrag:function(){if(this._pointerData)for(var t=0;t<10;t++)this._pointerData[t].isDragged=!1;this.draggable=!1,this.isDragged=!1,this._draggedPointerID=-1,this._pendingDrag=!1},startDrag:function(t){var e,i=this.sprite.x,n=this.sprite.y;this.isDragged=!0,this._draggedPointerID=t.id,this._pointerData[t.id].camX=this.game.camera.x,this._pointerData[t.id].camY=this.game.camera.y,this._pointerData[t.id].isDragged=!0,this.sprite.fixedToCamera?(this.dragFromCenter&&(e=this.sprite.getBounds(),this.sprite.cameraOffset.x=this.globalToLocalX(t.x)+(this.sprite.cameraOffset.x-e.centerX),this.sprite.cameraOffset.y=this.globalToLocalY(t.y)+(this.sprite.cameraOffset.y-e.centerY)),this._dragPoint.setTo(this.sprite.cameraOffset.x-t.x,this.sprite.cameraOffset.y-t.y)):(this.dragFromCenter&&(e=this.sprite.getBounds(),this.sprite.x=this.globalToLocalX(t.x)+(this.sprite.x-e.centerX),this.sprite.y=this.globalToLocalY(t.y)+(this.sprite.y-e.centerY)),this._dragPoint.setTo(this.sprite.x-this.globalToLocalX(t.x),this.sprite.y-this.globalToLocalY(t.y))),this.updateDrag(t,!0),this.bringToTop&&(this._dragPhase=!0,this.sprite.bringToTop()),this.dragStartPoint.set(i,n),this.sprite.events.onDragStart$dispatch(this.sprite,t,i,n),this._pendingDrag=!1},globalToLocalX:function(t){return this.scaleLayer&&(t-=this.game.scale.grid.boundsFluid.x,t*=this.game.scale.grid.scaleFluidInversed.x),t},globalToLocalY:function(t){return this.scaleLayer&&(t-=this.game.scale.grid.boundsFluid.y,t*=this.game.scale.grid.scaleFluidInversed.y),t},stopDrag:function(t){this.isDragged=!1,this._draggedPointerID=-1,this._pointerData[t.id].isDragged=!1,this._dragPhase=!1,this._pendingDrag=!1,this.snapOnRelease&&(this.sprite.fixedToCamera?(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY):(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)),this.sprite.events.onDragStop$dispatch(this.sprite,t),!1===this.checkPointerOver(t)&&this._pointerOutHandler(t)},setDragLock:function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0),this.allowHorizontalDrag=t,this.allowVerticalDrag=e},enableSnap:function(t,e,i,n,r,s){void 0===i&&(i=!0),void 0===n&&(n=!1),void 0===r&&(r=0),void 0===s&&(s=0),this.snapX=t,this.snapY=e,this.snapOffsetX=r,this.snapOffsetY=s,this.snapOnDrag=i,this.snapOnRelease=n},disableSnap:function(){this.snapOnDrag=!1,this.snapOnRelease=!1},checkBoundsRect:function(){this.sprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsRect.left?this.sprite.cameraOffset.x=this.boundsRect.left:this.sprite.cameraOffset.x+this.sprite.width>this.boundsRect.right&&(this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width),this.sprite.cameraOffset.y<this.boundsRect.top?this.sprite.cameraOffset.y=this.boundsRect.top:this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height)):(this.sprite.left<this.boundsRect.left?this.sprite.x=this.boundsRect.x+this.sprite.offsetX:this.sprite.right>this.boundsRect.right&&(this.sprite.x=this.boundsRect.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsRect.top?this.sprite.y=this.boundsRect.top+this.sprite.offsetY:this.sprite.bottom>this.boundsRect.bottom&&(this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)))},checkBoundsSprite:function(){this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x?this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x:this.sprite.cameraOffset.x+this.sprite.width>this.boundsSprite.cameraOffset.x+this.boundsSprite.width&&(this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x+this.boundsSprite.width-this.sprite.width),this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y?this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y:this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.cameraOffset.y+this.boundsSprite.height&&(this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y+this.boundsSprite.height-this.sprite.height)):(this.sprite.left<this.boundsSprite.left?this.sprite.x=this.boundsSprite.left+this.sprite.offsetX:this.sprite.right>this.boundsSprite.right&&(this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsSprite.top?this.sprite.y=this.boundsSprite.top+this.sprite.offsetY:this.sprite.bottom>this.boundsSprite.bottom&&(this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)))}},U.InputHandler.prototype.constructor=U.InputHandler,U.Gamepad=function(t){this.game=t,this._gamepadIndexMap={},this._rawPads=[],this._active=!1,this.enabled=!0,this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||-1!==navigator.userAgent.indexOf("Firefox/")||!!navigator.getGamepads,this._prevRawGamepadTypes=[],this._prevTimestamps=[],(this.callbackContext=this).onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this._ongamepadconnected=null,this._gamepaddisconnected=null,this._gamepads=[new U.SinglePad(t,this),new U.SinglePad(t,this),new U.SinglePad(t,this),new U.SinglePad(t,this)]},U.Gamepad.prototype={addCallbacks:function(t,e){void 0!==e&&(this.onConnectCallback="function"==typeof e.onConnect?e.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof e.onDisconnect?e.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof e.onDown?e.onDown:this.onDownCallback,this.onUpCallback="function"==typeof e.onUp?e.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof e.onAxis?e.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof e.onFloat?e.onFloat:this.onFloatCallback,this.callbackContext=t)},start:function(){var e;this._active||(this._active=!0,(e=this)._onGamepadConnected=function(t){return e.onGamepadConnected(t)},this._onGamepadDisconnected=function(t){return e.onGamepadDisconnected(t)},window.addEventListener("gamepadconnected",this._onGamepadConnected,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,!1))},onGamepadConnected:function(t){t=t.gamepad;this._rawPads.push(t),this._gamepads[t.index].connect(t)},onGamepadDisconnected:function(t){var e,i=t.gamepad;for(e in this._rawPads)this._rawPads[e].index===i.index&&this._rawPads.splice(e,1);this._gamepads[i.index].disconnect()},update:function(){this._pollGamepads(),this.pad1.pollStatus(),this.pad2.pollStatus(),this.pad3.pollStatus(),this.pad4.pollStatus()},_pollGamepads:function(){var t;if(this._active&&(navigator.getGamepads?t=navigator.getGamepads():navigator.webkitGetGamepads?t=navigator.webkitGetGamepads():navigator.webkitGamepads&&(t=navigator.webkitGamepads()),t)){for(var e=!(this._rawPads=[]),i=0;i<t.length&&(typeof t[i]!==this._prevRawGamepadTypes[i]&&(e=!0,this._prevRawGamepadTypes[i]=typeof t[i]),t[i]&&this._rawPads.push(t[i]),3!==i);i++);for(var n=0;n<this._gamepads.length;n++)this._gamepads[n]._rawPad=this._rawPads[n];if(e){for(var r,s={rawIndices:{},padIndices:{}},o=0;o<this._gamepads.length;o++)if((r=this._gamepads[o]).connected)for(var a=0;a<this._rawPads.length;a++)this._rawPads[a].index===r.index&&(s.rawIndices[r.index]=!0,s.padIndices[o]=!0);for(var l=0;l<this._gamepads.length;l++)if(r=this._gamepads[l],!s.padIndices[l]){this._rawPads.length<1&&r.disconnect();for(var p=0;p<this._rawPads.length&&!s.padIndices[l];p++){var h=this._rawPads[p];!h||s.rawIndices[h.index]?r.disconnect():(r.connect(h),s.rawIndices[h.index]=!0,s.padIndices[l]=!0)}}}}},setDeadZones:function(t){for(var e=0;e<this._gamepads.length;e++)this._gamepads[e].deadZone=t},stop:function(){this._active=!1,window.removeEventListener("gamepadconnected",this._onGamepadConnected),window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},reset:function(){this.update();for(var t=0;t<this._gamepads.length;t++)this._gamepads[t].reset()},justPressed:function(t,e){for(var i=0;i<this._gamepads.length;i++)if(!0===this._gamepads[i].justPressed(t,e))return!0;return!1},justReleased:function(t,e){for(var i=0;i<this._gamepads.length;i++)if(!0===this._gamepads[i].justReleased(t,e))return!0;return!1},isDown:function(t){for(var e=0;e<this._gamepads.length;e++)if(!0===this._gamepads[e].isDown(t))return!0;return!1},destroy:function(){this.stop();for(var t=0;t<this._gamepads.length;t++)this._gamepads[t].destroy()}},U.Gamepad.prototype.constructor=U.Gamepad,Object.defineProperty(U.Gamepad.prototype,"active",{get:function(){return this._active}}),Object.defineProperty(U.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}}),Object.defineProperty(U.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}}),Object.defineProperty(U.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}}),Object.defineProperty(U.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}}),Object.defineProperty(U.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}}),Object.defineProperty(U.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}}),U.Gamepad.BUTTON_0=0,U.Gamepad.BUTTON_1=1,U.Gamepad.BUTTON_2=2,U.Gamepad.BUTTON_3=3,U.Gamepad.BUTTON_4=4,U.Gamepad.BUTTON_5=5,U.Gamepad.BUTTON_6=6,U.Gamepad.BUTTON_7=7,U.Gamepad.BUTTON_8=8,U.Gamepad.BUTTON_9=9,U.Gamepad.BUTTON_10=10,U.Gamepad.BUTTON_11=11,U.Gamepad.BUTTON_12=12,U.Gamepad.BUTTON_13=13,U.Gamepad.BUTTON_14=14,U.Gamepad.BUTTON_15=15,U.Gamepad.AXIS_0=0,U.Gamepad.AXIS_1=1,U.Gamepad.AXIS_2=2,U.Gamepad.AXIS_3=3,U.Gamepad.AXIS_4=4,U.Gamepad.AXIS_5=5,U.Gamepad.AXIS_6=6,U.Gamepad.AXIS_7=7,U.Gamepad.AXIS_8=8,U.Gamepad.AXIS_9=9,U.Gamepad.XBOX360_A=0,U.Gamepad.XBOX360_B=1,U.Gamepad.XBOX360_X=2,U.Gamepad.XBOX360_Y=3,U.Gamepad.XBOX360_LEFT_BUMPER=4,U.Gamepad.XBOX360_RIGHT_BUMPER=5,U.Gamepad.XBOX360_LEFT_TRIGGER=6,U.Gamepad.XBOX360_RIGHT_TRIGGER=7,U.Gamepad.XBOX360_BACK=8,U.Gamepad.XBOX360_START=9,U.Gamepad.XBOX360_STICK_LEFT_BUTTON=10,U.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11,U.Gamepad.XBOX360_DPAD_LEFT=14,U.Gamepad.XBOX360_DPAD_RIGHT=15,U.Gamepad.XBOX360_DPAD_UP=12,U.Gamepad.XBOX360_DPAD_DOWN=13,U.Gamepad.XBOX360_STICK_LEFT_X=0,U.Gamepad.XBOX360_STICK_LEFT_Y=1,U.Gamepad.XBOX360_STICK_RIGHT_X=2,U.Gamepad.XBOX360_STICK_RIGHT_Y=3,U.Gamepad.PS3XC_X=0,U.Gamepad.PS3XC_CIRCLE=1,U.Gamepad.PS3XC_SQUARE=2,U.Gamepad.PS3XC_TRIANGLE=3,U.Gamepad.PS3XC_L1=4,U.Gamepad.PS3XC_R1=5,U.Gamepad.PS3XC_L2=6,U.Gamepad.PS3XC_R2=7,U.Gamepad.PS3XC_SELECT=8,U.Gamepad.PS3XC_START=9,U.Gamepad.PS3XC_STICK_LEFT_BUTTON=10,U.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11,U.Gamepad.PS3XC_DPAD_UP=12,U.Gamepad.PS3XC_DPAD_DOWN=13,U.Gamepad.PS3XC_DPAD_LEFT=14,U.Gamepad.PS3XC_DPAD_RIGHT=15,U.Gamepad.PS3XC_STICK_LEFT_X=0,U.Gamepad.PS3XC_STICK_LEFT_Y=1,U.Gamepad.PS3XC_STICK_RIGHT_X=2,U.Gamepad.PS3XC_STICK_RIGHT_Y=3,U.SinglePad=function(t,e){this.game=t,this.index=null,this.connected=!1,(this.callbackContext=this).onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this.deadZone=.26,this._padParent=e,this._rawPad=null,this._prevTimestamp=null,this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0},U.SinglePad.prototype={addCallbacks:function(t,e){void 0!==e&&(this.onConnectCallback="function"==typeof e.onConnect?e.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof e.onDisconnect?e.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof e.onDown?e.onDown:this.onDownCallback,this.onUpCallback="function"==typeof e.onUp?e.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof e.onAxis?e.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof e.onFloat?e.onFloat:this.onFloatCallback,this.callbackContext=t)},getButton:function(t){return this._buttons[t]||null},pollStatus:function(){if(this.connected&&this.game.input.enabled&&this.game.input.gamepad.enabled&&(!this._rawPad.timestamp||this._rawPad.timestamp!==this._prevTimestamp)){for(var t=0;t<this._buttonsLen;t++){var e=isNaN(this._rawPad.buttons[t])?this._rawPad.buttons[t].value:this._rawPad.buttons[t];e!==this._buttons[t].value&&(1===e?this.processButtonDown(t,e):0===e?this.processButtonUp(t,e):this.processButtonFloat(t,e))}for(var i=0;i<this._axesLen;i++){var n=this._rawPad.axes[i];0<n&&n>this.deadZone||n<0&&n<-this.deadZone?this.processAxisChange(i,n):this.processAxisChange(i,0)}this._prevTimestamp=this._rawPad.timestamp}},connect:function(t){var e=!this.connected;this.connected=!0,this.index=t.index,this._rawPad=t,this._buttons=[],this._buttonsLen=t.buttons.length,this._axes=[],this._axesLen=t.axes.length;for(var i,n=0;n<this._axesLen;n++)this._axes[n]=t.axes[n];for(i in t.buttons)i=parseInt(i,10),this._buttons[i]=new U.DeviceButton(this,i);e&&this._padParent.onConnectCallback&&this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index),e&&this.onConnectCallback&&this.onConnectCallback.call(this.callbackContext)},disconnect:function(){var t=this.connected,e=this.index;this.connected=!1,this.index=null,this._rawPad=void 0;for(var i=0;i<this._buttonsLen;i++)this._buttons[i].destroy();this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0,t&&this._padParent.onDisconnectCallback&&this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,e),t&&this.onDisconnectCallback&&this.onDisconnectCallback.call(this.callbackContext)},destroy:function(){this._rawPad=void 0;for(var t=0;t<this._buttonsLen;t++)this._buttons[t].destroy();this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null},processAxisChange:function(t,e){this._axes[t]!==e&&(this._axes[t]=e,this._padParent.onAxisCallback&&this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,t,e),this.onAxisCallback&&this.onAxisCallback.call(this.callbackContext,this,t,e))},processButtonDown:function(t,e){this._buttons[t]&&this._buttons[t].start(null,e),this._padParent.onDownCallback&&this._padParent.onDownCallback.call(this._padParent.callbackContext,t,e,this.index),this.onDownCallback&&this.onDownCallback.call(this.callbackContext,t,e)},processButtonUp:function(t,e){this._padParent.onUpCallback&&this._padParent.onUpCallback.call(this._padParent.callbackContext,t,e,this.index),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,t,e),this._buttons[t]&&this._buttons[t].stop(null,e)},processButtonFloat:function(t,e){this._padParent.onFloatCallback&&this._padParent.onFloatCallback.call(this._padParent.callbackContext,t,e,this.index),this.onFloatCallback&&this.onFloatCallback.call(this.callbackContext,t,e),this._buttons[t]&&this._buttons[t].padFloat(e)},axis:function(t){return!!this._axes[t]&&this._axes[t]},isDown:function(t){return!!this._buttons[t]&&this._buttons[t].isDown},isUp:function(t){return!!this._buttons[t]&&this._buttons[t].isUp},justReleased:function(t,e){if(this._buttons[t])return this._buttons[t].justReleased(e)},justPressed:function(t,e){if(this._buttons[t])return this._buttons[t].justPressed(e)},buttonValue:function(t){return this._buttons[t]?this._buttons[t].value:null},reset:function(){for(var t=0;t<this._axes.length;t++)this._axes[t]=0}},U.SinglePad.prototype.constructor=U.SinglePad,U.Key=function(t,e){this.game=t,this._enabled=!0,this.event=null,this.isDown=!1,this.isUp=!0,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.timeDown=0,this.duration=0,this.timeUp=-2500,this.repeats=0,this.keyCode=e,this.onDown=new U.Signal,this.onHoldCallback=null,this.onHoldContext=null,this.onUp=new U.Signal,this._justDown=!1,this._justUp=!1},U.Key.prototype={update:function(){this._enabled&&this.isDown&&(this.duration=this.game.time.time-this.timeDown,this.repeats++,this.onHoldCallback&&this.onHoldCallback.call(this.onHoldContext,this))},processKeyDown:function(t){this._enabled&&(this.event=t,this.isDown||(this.altKey=t.altKey,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.duration=0,this.repeats=0,this._justDown=!0,this.onDown.dispatch(this)))},processKeyUp:function(t){this._enabled&&(this.event=t,this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=this.game.time.time-this.timeDown,this._justUp=!0,this.onUp.dispatch(this)))},reset:function(t){void 0===t&&(t=!0),this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=0,this._enabled=!0,this._justDown=!1,this._justUp=!1,t&&(this.onDown.removeAll(),this.onUp.removeAll(),this.onHoldCallback=null,this.onHoldContext=null)},downDuration:function(t){return void 0===t&&(t=50),this.isDown&&this.duration<t},upDuration:function(t){return void 0===t&&(t=50),!this.isDown&&this.game.time.time-this.timeUp<t}},Object.defineProperty(U.Key.prototype,"justDown",{get:function(){var t=this._justDown;return this._justDown=!1,t}}),Object.defineProperty(U.Key.prototype,"justUp",{get:function(){var t=this._justUp;return this._justUp=!1,t}}),Object.defineProperty(U.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(t){(t=!!t)!==this._enabled&&(t||this.reset(!1),this._enabled=t)}}),U.Key.prototype.constructor=U.Key,U.Keyboard=function(t){this.game=t,this.enabled=!0,this.event=null,this.pressEvent=null,(this.callbackContext=this).onDownCallback=null,this.onPressCallback=null,this.onUpCallback=null,this._keys=[],this._capture=[],this._onKeyDown=null,this._onKeyPress=null,this._onKeyUp=null,this._i=0,this._k=0},U.Keyboard.prototype={addCallbacks:function(t,e,i,n){this.callbackContext=t,null!=e&&(this.onDownCallback=e),null!=i&&(this.onUpCallback=i),null!=n&&(this.onPressCallback=n)},addKey:function(t){return this._keys[t]||(this._keys[t]=new U.Key(this.game,t),this.addKeyCapture(t)),this._keys[t]},addKeys:function(t){var e,i={};for(e in t)i[e]=this.addKey(t[e]);return i},removeKey:function(t){this._keys[t]&&(this._keys[t]=null,this.removeKeyCapture(t))},createCursorKeys:function(){return this.addKeys({up:U.KeyCode.UP,down:U.KeyCode.DOWN,left:U.KeyCode.LEFT,right:U.KeyCode.RIGHT})},start:function(){var e;this.game.device.cocoonJS||null!==this._onKeyDown||((e=this)._onKeyDown=function(t){return e.processKeyDown(t)},this._onKeyUp=function(t){return e.processKeyUp(t)},this._onKeyPress=function(t){return e.processKeyPress(t)},window.addEventListener("keydown",this._onKeyDown,!1),window.addEventListener("keyup",this._onKeyUp,!1),window.addEventListener("keypress",this._onKeyPress,!1))},stop:function(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),window.removeEventListener("keypress",this._onKeyPress),this._onKeyDown=null,this._onKeyUp=null,this._onKeyPress=null},destroy:function(){this.stop(),this.clearCaptures(),this._keys.length=0,this._i=0},addKeyCapture:function(t){if("object"==typeof t)for(var e in t)this._capture[t[e]]=!0;else this._capture[t]=!0},removeKeyCapture:function(t){delete this._capture[t]},clearCaptures:function(){this._capture={}},update:function(){for(this._i=this._keys.length;this._i--;)this._keys[this._i]&&this._keys[this._i].update()},processKeyDown:function(t){var e;this.event=t,this.game.input.enabled&&this.enabled&&(e=t.keyCode,this._capture[e]&&t.preventDefault(),this._keys[e]||(this._keys[e]=new U.Key(this.game,e)),this._keys[e].processKeyDown(t),this._k=e,this.onDownCallback&&this.onDownCallback.call(this.callbackContext,t))},processKeyPress:function(t){this.pressEvent=t,this.game.input.enabled&&this.enabled&&this.onPressCallback&&this.onPressCallback.call(this.callbackContext,String.fromCharCode(t.charCode),t)},processKeyUp:function(t){var e;this.event=t,this.game.input.enabled&&this.enabled&&(e=t.keyCode,this._capture[e]&&t.preventDefault(),this._keys[e]||(this._keys[e]=new U.Key(this.game,e)),this._keys[e].processKeyUp(t),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,t))},reset:function(t){void 0===t&&(t=!0),this.event=null;for(var e=this._keys.length;e--;)this._keys[e]&&this._keys[e].reset(t)},downDuration:function(t,e){return this._keys[t]?this._keys[t].downDuration(e):null},upDuration:function(t,e){return this._keys[t]?this._keys[t].upDuration(e):null},isDown:function(t){return this._keys[t]?this._keys[t].isDown:null}},Object.defineProperty(U.Keyboard.prototype,"lastChar",{get:function(){return 32===this.event.charCode?"":String.fromCharCode(this.pressEvent.charCode)}}),Object.defineProperty(U.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}}),U.Keyboard.prototype.constructor=U.Keyboard,U.KeyCode={A:"A".charCodeAt(0),B:"B".charCodeAt(0),C:"C".charCodeAt(0),D:"D".charCodeAt(0),E:"E".charCodeAt(0),F:"F".charCodeAt(0),G:"G".charCodeAt(0),H:"H".charCodeAt(0),I:"I".charCodeAt(0),J:"J".charCodeAt(0),K:"K".charCodeAt(0),L:"L".charCodeAt(0),M:"M".charCodeAt(0),N:"N".charCodeAt(0),O:"O".charCodeAt(0),P:"P".charCodeAt(0),Q:"Q".charCodeAt(0),R:"R".charCodeAt(0),S:"S".charCodeAt(0),T:"T".charCodeAt(0),U:"U".charCodeAt(0),V:"V".charCodeAt(0),W:"W".charCodeAt(0),X:"X".charCodeAt(0),Y:"Y".charCodeAt(0),Z:"Z".charCodeAt(0),ZERO:"0".charCodeAt(0),ONE:"1".charCodeAt(0),TWO:"2".charCodeAt(0),THREE:"3".charCodeAt(0),FOUR:"4".charCodeAt(0),FIVE:"5".charCodeAt(0),SIX:"6".charCodeAt(0),SEVEN:"7".charCodeAt(0),EIGHT:"8".charCodeAt(0),NINE:"9".charCodeAt(0),NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:108,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,COLON:186,EQUALS:187,COMMA:188,UNDERSCORE:189,PERIOD:190,QUESTION_MARK:191,TILDE:192,OPEN_BRACKET:219,BACKWARD_SLASH:220,CLOSED_BRACKET:221,QUOTES:222,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PLUS:43,MINUS:44,INSERT:45,DELETE:46,HELP:47,NUM_LOCK:144},U.KeyCode)U.KeyCode.hasOwnProperty(e)&&!e.match(/[a-z]/)&&(U.Keyboard[e]=U.KeyCode[e]);for(i in U.Component=function(){},U.Component.Angle=function(){},U.Component.Angle.prototype={angle:{get:function(){return U.Math.wrapAngle(U.Math.radToDeg(this.rotation))},set:function(t){this.rotation=U.Math.degToRad(U.Math.wrapAngle(t))}}},U.Component.Animation=function(){},U.Component.Animation.prototype={play:function(t,e,i,n){if(this.animations)return this.animations.play(t,e,i,n)}},U.Component.AutoCull=function(){},U.Component.AutoCull.prototype={autoCull:!1,inCamera:{get:function(){return this.autoCull||this.checkWorldBounds||(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y),this.game.world.camera.view.intersects(this._bounds)}}},U.Component.Bounds=function(){},U.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},centerX:{get:function(){return this.x-this.offsetX+.5*this.width},set:function(t){this.x=t+this.offsetX-.5*this.width}},centerY:{get:function(){return this.y-this.offsetY+.5*this.height},set:function(t){this.y=t+this.offsetY-.5*this.height}},left:{get:function(){return this.x-this.offsetX},set:function(t){this.x=t+this.offsetX}},right:{get:function(){return this.x+this.width-this.offsetX},set:function(t){this.x=t-this.width+this.offsetX}},top:{get:function(){return this.y-this.offsetY},set:function(t){this.y=t+this.offsetY}},bottom:{get:function(){return this.y+this.height-this.offsetY},set:function(t){this.y=t-this.height+this.offsetY}},alignIn:function(t,e,i,n){switch(void 0===i&&(i=0),void 0===n&&(n=0),e){default:case U.TOP_LEFT:this.left=t.left-i,this.top=t.top-n;break;case U.TOP_CENTER:this.centerX=t.centerX+i,this.top=t.top-n;break;case U.TOP_RIGHT:this.right=t.right+i,this.top=t.top-n;break;case U.LEFT_CENTER:this.left=t.left-i,this.centerY=t.centerY+n;break;case U.CENTER:this.centerX=t.centerX+i,this.centerY=t.centerY+n;break;case U.RIGHT_CENTER:this.right=t.right+i,this.centerY=t.centerY+n;break;case U.BOTTOM_LEFT:this.left=t.left-i,this.bottom=t.bottom+n;break;case U.BOTTOM_CENTER:this.centerX=t.centerX+i,this.bottom=t.bottom+n;break;case U.BOTTOM_RIGHT:this.right=t.right+i,this.bottom=t.bottom+n}return this},alignTo:function(t,e,i,n){switch(void 0===i&&(i=0),void 0===n&&(n=0),e){default:case U.TOP_LEFT:this.left=t.left-i,this.bottom=t.top-n;break;case U.TOP_CENTER:this.centerX=t.centerX+i,this.bottom=t.top-n;break;case U.TOP_RIGHT:this.right=t.right+i,this.bottom=t.top-n;break;case U.LEFT_TOP:this.right=t.left-i,this.top=t.top-n;break;case U.LEFT_CENTER:this.right=t.left-i,this.centerY=t.centerY+n;break;case U.LEFT_BOTTOM:this.right=t.left-i,this.bottom=t.bottom+n;break;case U.RIGHT_TOP:this.left=t.right+i,this.top=t.top-n;break;case U.RIGHT_CENTER:this.left=t.right+i,this.centerY=t.centerY+n;break;case U.RIGHT_BOTTOM:this.left=t.right+i,this.bottom=t.bottom+n;break;case U.BOTTOM_LEFT:this.left=t.left-i,this.top=t.bottom+n;break;case U.BOTTOM_CENTER:this.centerX=t.centerX+i,this.top=t.bottom+n;break;case U.BOTTOM_RIGHT:this.right=t.right+i,this.top=t.bottom+n}return this}},U.Group.prototype.alignIn=U.Component.Bounds.prototype.alignIn,U.Group.prototype.alignTo=U.Component.Bounds.prototype.alignTo,U.Component.BringToTop=function(){},U.Component.BringToTop.prototype.bringToTop=function(){return this.parent&&this.parent.bringToTop(this),this},U.Component.BringToTop.prototype.sendToBack=function(){return this.parent&&this.parent.sendToBack(this),this},U.Component.BringToTop.prototype.moveUp=function(){return this.parent&&this.parent.moveUp(this),this},U.Component.BringToTop.prototype.moveDown=function(){return this.parent&&this.parent.moveDown(this),this},U.Component.Core=function(){},U.Component.Core.install=function(t){U.Utils.mixinPrototype(this,U.Component.Core.prototype),this.components={};for(var e=0;e<t.length;e++){var i=t[e],n="Destroy"===i?!0:!1;U.Utils.mixinPrototype(this,U.Component[i].prototype,n),this.components[i]=!0}},U.Component.Core.init=function(t,e,i,n,r){this.game=t,this.key=n,this.data={},this.position.set(e,i),this.world=new U.Point(e,i),this.previousPosition=new U.Point(e,i),this.events=new U.Events(this),this._bounds=new U.Rectangle,this.components.PhysicsBody&&(this.body=this.body),this.components.Animation&&(this.animations=new U.AnimationManager(this)),this.components.LoadTexture&&null!==n&&this.loadTexture(n,r),this.components.FixedToCamera&&(this.cameraOffset=new U.Point(e,i))},U.Component.Core.preUpdate=function(){if(!this.pendingDestroy){if(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,!this.exists||!this.parent.exists)return!(this.renderOrderID=-1);this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this.renderOrderID=this.game.stage.currentRenderOrderID++),this.animations&&this.animations.update(),this.body&&this.body.preUpdate();for(var t=0;t<this.children.length;t++)this.children[t].preUpdate();return!0}this.destroy()},U.Component.Core.prototype={game:null,name:"",data:{},components:{},z:0,events:void 0,animations:void 0,key:"",world:null,debug:!1,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:!0,pendingDestroy:!1,_bounds:null,_exists:!0,exists:{get:function(){return this._exists},set:function(t){t?(this._exists=!0,this.body&&this.body.type===U.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._exists=!1,this.body&&this.body.type===U.Physics.P2JS&&this.body.removeFromWorld(),this.visible=!1)}},update:function(){},postUpdate:function(){this.customRender&&this.key.render(),this.components.PhysicsBody&&U.Component.PhysicsBody.postUpdate.call(this),this.components.FixedToCamera&&U.Component.FixedToCamera.postUpdate.call(this);for(var t=0;t<this.children.length;t++)this.children[t].postUpdate()}},U.Component.Crop=function(){},U.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(t,e){void 0===e&&(e=!1),t?(e&&null!==this.cropRect?this.cropRect.setTo(t.x,t.y,t.width,t.height):e&&null===this.cropRect?this.cropRect=new U.Rectangle(t.x,t.y,t.width,t.height):this.cropRect=t,this.updateCrop()):(this._crop=null,this.cropRect=null,this.resetFrame())},updateCrop:function(){var t,e,i,n,r,s,o,a;this.cropRect&&(t=this.texture.crop.x,e=this.texture.crop.y,i=this.texture.crop.width,n=this.texture.crop.height,this._crop=U.Rectangle.clone(this.cropRect,this._crop),this._crop.x+=this._frame.x,this._crop.y+=this._frame.y,r=Math.max(this._frame.x,this._crop.x),s=Math.max(this._frame.y,this._crop.y),o=Math.min(this._frame.right,this._crop.right)-r,a=Math.min(this._frame.bottom,this._crop.bottom)-s,this.texture.crop.x=r,this.texture.crop.y=s,this.texture.crop.width=o,this.texture.crop.height=a,this.texture.frame.width=Math.min(o,this.cropRect.width),this.texture.frame.height=Math.min(a,this.cropRect.height),this.texture.width=this.texture.frame.width,this.texture.height=this.texture.frame.height,this.texture._updateUvs(),16777215===this.tint||t===r&&e===s&&i===o&&n===a||(this.texture.requiresReTint=!0))}},U.Component.Delta=function(){},U.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-this.previousRotation}}},U.Component.Destroy=function(){},U.Component.Destroy.prototype={destroyPhase:!1,destroy:function(t,e){if(null!==this.game&&!this.destroyPhase){void 0===t&&(t=!0),void 0===e&&(e=!1),this.destroyPhase=!0,this.events&&this.events.onDestroy$dispatch(this),this.parent&&(this.parent instanceof U.Group?this.parent.remove(this):this.parent.removeChild(this)),this.input&&this.input.destroy(),this.animations&&this.animations.destroy(),this.body&&this.body.destroy(),this.events&&this.events.destroy(),this.game.tweens.removeFrom(this);var i=this.children.length;if(t)for(;i--;)this.children[i].destroy(t);else for(;i--;)this.removeChild(this.children[i]);this._crop&&(this._crop=null,this.cropRect=null),this._frame&&(this._frame=null),U.Video&&this.key instanceof U.Video&&this.key.onChangeSource.remove(this.resizeFrame,this),U.BitmapText&&this._glyphs&&(this._glyphs=[]),this.alive=!1,this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this.data={},this.renderable=!1,this.transformCallback&&(this.transformCallback=null,this.transformCallbackContext=null),this.hitArea=null,this.parent=null,this.stage=null,this.worldTransform=null,this.filterArea=null,this._bounds=null,this._currentBounds=null,this._mask=null,this._destroyCachedSprite(),e&&this.texture.destroy(!0),this.destroyPhase=!1,this.pendingDestroy=!1}}},U.Events=function(t){this.parent=t},U.Events.prototype={destroy:function(){this._parent=null,this._onDestroy&&this._onDestroy.dispose(),this._onAddedToGroup&&this._onAddedToGroup.dispose(),this._onRemovedFromGroup&&this._onRemovedFromGroup.dispose(),this._onRemovedFromWorld&&this._onRemovedFromWorld.dispose(),this._onKilled&&this._onKilled.dispose(),this._onRevived&&this._onRevived.dispose(),this._onEnterBounds&&this._onEnterBounds.dispose(),this._onOutOfBounds&&this._onOutOfBounds.dispose(),this._onInputOver&&this._onInputOver.dispose(),this._onInputOut&&this._onInputOut.dispose(),this._onInputDown&&this._onInputDown.dispose(),this._onInputUp&&this._onInputUp.dispose(),this._onDragStart&&this._onDragStart.dispose(),this._onDragUpdate&&this._onDragUpdate.dispose(),this._onDragStop&&this._onDragStop.dispose(),this._onAnimationStart&&this._onAnimationStart.dispose(),this._onAnimationComplete&&this._onAnimationComplete.dispose(),this._onAnimationLoop&&this._onAnimationLoop.dispose()},onAddedToGroup:null,onRemovedFromGroup:null,onRemovedFromWorld:null,onDestroy:null,onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragUpdate:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null},U.Events.prototype.constructor=U.Events,U.Events.prototype)U.Events.prototype.hasOwnProperty(i)&&0===i.indexOf("on")&&null===U.Events.prototype[i]&&function(t,e){"use strict";Object.defineProperty(U.Events.prototype,t,{get:function(){return this[e]||(this[e]=new U.Signal)}}),U.Events.prototype[t+"$dispatch"]=function(){return this[e]?this[e].dispatch.apply(this[e],arguments):null}}(i,"_"+i);U.Component.FixedToCamera=function(){},U.Component.FixedToCamera.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)},U.Component.FixedToCamera.prototype={_fixedToCamera:!1,fixedToCamera:{get:function(){return this._fixedToCamera},set:function(t){t?(this._fixedToCamera=!0,this.cameraOffset.set(this.x,this.y)):this._fixedToCamera=!1}},cameraOffset:new U.Point},U.Component.Health=function(){},U.Component.Health.prototype={health:1,maxHealth:100,damage:function(t){return this.alive&&(this.health-=t,this.health<=0&&this.kill()),this},setHealth:function(t){return this.health=t,this.health>this.maxHealth&&(this.health=this.maxHealth),this},heal:function(t){return this.alive&&(this.health+=t,this.health>this.maxHealth&&(this.health=this.maxHealth)),this}},U.Component.InCamera=function(){},U.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}},U.Component.InputEnabled=function(){},U.Component.InputEnabled.prototype={input:null,inputEnabled:{get:function(){return this.input&&this.input.enabled},set:function(t){t?null===this.input?(this.input=new U.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}},U.Component.InWorld=function(){},U.Component.InWorld.preUpdate=function(){if(this.autoCull||this.checkWorldBounds){if(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y,this.autoCull)if(this.game.world.camera.view.intersects(this._bounds))this.renderable=!0,this.game.world.camera.totalInView++;else if(this.renderable=!1,this.outOfCameraBoundsKill)return this.kill(),!1;if(this.checkWorldBounds)if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds))this._outOfBoundsFired=!1,this.events.onEnterBounds$dispatch(this);else if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)&&(this._outOfBoundsFired=!0,this.events.onOutOfBounds$dispatch(this),this.outOfBoundsKill))return this.kill(),!1}return!0},U.Component.InWorld.prototype={checkWorldBounds:!1,outOfBoundsKill:!1,outOfCameraBoundsKill:!1,_outOfBoundsFired:!1,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}},U.Component.LifeSpan=function(){},U.Component.LifeSpan.preUpdate=function(){return!(0<this.lifespan&&(this.lifespan-=this.game.time.physicsElapsedMS,this.lifespan<=0)&&(this.kill(),1))},U.Component.LifeSpan.prototype={alive:!0,lifespan:0,revive:function(t){return void 0===t&&(t=100),this.alive=!0,this.exists=!0,this.visible=!0,"function"==typeof this.setHealth&&this.setHealth(t),this.events&&this.events.onRevived$dispatch(this),this},kill:function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.events&&this.events.onKilled$dispatch(this),this}},U.Component.LoadTexture=function(){},U.Component.LoadTexture.prototype={customRender:!1,_frame:null,loadTexture:function(t,e,i){e=t===U.PENDING_ATLAS?(t=e,0):e||0,(i||void 0===i)&&this.animations&&this.animations.stop(),this.key=t,this.customRender=!1;var n=this.game.cache,r=!0,s=!this.texture.baseTexture.scaleMode;U.RenderTexture&&t instanceof U.RenderTexture?(this.key=t.key,this.setTexture(t)):U.BitmapData&&t instanceof U.BitmapData?(this.customRender=!0,this.setTexture(t.texture),r=n.hasFrameData(t.key,U.Cache.BITMAPDATA)?!this.animations.loadFrameData(n.getFrameData(t.key,U.Cache.BITMAPDATA),e):!this.animations.loadFrameData(t.frameData,0)):U.Video&&t instanceof U.Video?(this.customRender=!0,i=t.texture.valid,this.setTexture(t.texture),this.setFrame(t.texture.frame.clone()),t.onChangeSource.add(this.resizeFrame,this),this.texture.valid=i):U.Tilemap&&t instanceof U.TilemapLayer?this.setTexture(PIXI.Texture.fromCanvas(t.canvas)):t instanceof PIXI.Texture?this.setTexture(t):(n=n.getImage(t,!0),this.key=n.key,this.setTexture(new PIXI.Texture(n.base)),this.texture.baseTexture.skipRender="__default"===t,r=!this.animations.loadFrameData(n.frameData,e)),r&&(this._frame=U.Rectangle.clone(this.texture.frame)),s||(this.texture.baseTexture.scaleMode=1)},setFrame:function(t){this._frame=t,this.texture.frame.x=t.x,this.texture.frame.y=t.y,this.texture.frame.width=t.width,this.texture.frame.height=t.height,this.texture.crop.x=t.x,this.texture.crop.y=t.y,this.texture.crop.width=t.width,this.texture.crop.height=t.height,t.trimmed?(this.texture.trim?(this.texture.trim.x=t.spriteSourceSizeX,this.texture.trim.y=t.spriteSourceSizeY,this.texture.trim.width=t.sourceSizeW,this.texture.trim.height=t.sourceSizeH):this.texture.trim={x:t.spriteSourceSizeX,y:t.spriteSourceSizeY,width:t.sourceSizeW,height:t.sourceSizeH},this.texture.width=t.sourceSizeW,this.texture.height=t.sourceSizeH,this.texture.frame.width=t.sourceSizeW,this.texture.frame.height=t.sourceSizeH):!t.trimmed&&this.texture.trim&&(this.texture.trim=null),this.cropRect&&this.updateCrop(),this.texture.requiresReTint=!0,this.texture._updateUvs(),this.tilingTexture&&(this.refreshTexture=!0)},resizeFrame:function(t,e,i){this.texture.frame.resize(e,i),this.texture.setFrame(this.texture.frame)},resetFrame:function(){this._frame&&this.setFrame(this._frame)},frame:{get:function(){return this.animations.frame},set:function(t){this.animations.frame=t}},frameName:{get:function(){return this.animations.frameName},set:function(t){this.animations.frameName=t}}},U.Component.Overlap=function(){},U.Component.Overlap.prototype={overlap:function(t){return U.Rectangle.intersects(this.getBounds(),t.getBounds())}},U.Component.PhysicsBody=function(){},U.Component.PhysicsBody.preUpdate=function(){return this.fresh&&this.exists?(this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.body&&this.body.preUpdate(),this.fresh=!1):(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,!(!this._exists||!this.parent.exists)||!(this.renderOrderID=-1))},U.Component.PhysicsBody.postUpdate=function(){this.exists&&this.body&&this.body.postUpdate()},U.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(t){this.position.x=t,this.body&&!this.body.dirty&&(this.body._reset=!0)}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t,this.body&&!this.body.dirty&&(this.body._reset=!0)}}},U.Component.Reset=function(){},U.Component.Reset.prototype.reset=function(t,e,i){return void 0===i&&(i=1),this.world.set(t,e),this.position.set(t,e),this.fresh=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this.components.InWorld&&(this._outOfBoundsFired=!1),this.components.LifeSpan&&(this.alive=!0,this.health=i),this.components.PhysicsBody&&this.body&&this.body.reset(t,e,!1,!1),this},U.Component.ScaleMinMax=function(){},U.Component.ScaleMinMax.prototype={transformCallback:null,transformCallbackContext:this,scaleMin:null,scaleMax:null,checkTransform:function(t){this.scaleMin&&(t.a<this.scaleMin.x&&(t.a=this.scaleMin.x),t.d<this.scaleMin.y&&(t.d=this.scaleMin.y)),this.scaleMax&&(t.a>this.scaleMax.x&&(t.a=this.scaleMax.x),t.d>this.scaleMax.y&&(t.d=this.scaleMax.y))},setScaleMinMax:function(t,e,i,n){void 0===e?e=i=n=t:void 0===i&&(i=n=e,e=t),null===t?this.scaleMin=null:this.scaleMin?this.scaleMin.set(t,e):this.scaleMin=new U.Point(t,e),null===i?this.scaleMax=null:this.scaleMax?this.scaleMax.set(i,n):this.scaleMax=new U.Point(i,n),null===this.scaleMin?this.transformCallback=null:(this.transformCallback=this.checkTransform,this.transformCallbackContext=this)}},U.Component.Smoothed=function(){},U.Component.Smoothed.prototype={smoothed:{get:function(){return!this.texture.baseTexture.scaleMode},set:function(t){t?this.texture&&(this.texture.baseTexture.scaleMode=0):this.texture&&(this.texture.baseTexture.scaleMode=1)}}},U.GameObjectFactory=function(t){this.game=t,this.world=this.game.world},U.GameObjectFactory.prototype={existing:function(t){return this.world.add(t)},weapon:function(t,e,i,n){var r=this.game.plugins.add(U.Weapon);return r.createBullets(t,e,i,n),r},image:function(t,e,i,n,r){return void 0===r&&(r=this.world),r.add(new U.Image(this.game,t,e,i,n))},sprite:function(t,e,i,n,r){return void 0===r&&(r=this.world),r.create(t,e,i,n)},creature:function(t,e,i,n,r){void 0===r&&(r=this.world);n=new U.Creature(this.game,t,e,i,n);return r.add(n),n},tween:function(t){return this.game.tweens.create(t)},group:function(t,e,i,n,r){return new U.Group(this.game,t,e,i,n,r)},physicsGroup:function(t,e,i,n){return new U.Group(this.game,e,i,n,!0,t)},spriteBatch:function(t,e,i){return void 0===t&&(t=null),void 0===e&&(e="group"),void 0===i&&(i=!1),new U.SpriteBatch(this.game,t,e,i)},audio:function(t,e,i,n){return this.game.sound.add(t,e,i,n)},sound:function(t,e,i,n){return this.game.sound.add(t,e,i,n)},audioSprite:function(t){return this.game.sound.addSprite(t)},tileSprite:function(t,e,i,n,r,s,o){return void 0===o&&(o=this.world),o.add(new U.TileSprite(this.game,t,e,i,n,r,s))},rope:function(t,e,i,n,r,s){return void 0===s&&(s=this.world),s.add(new U.Rope(this.game,t,e,i,n,r))},text:function(t,e,i,n,r){return void 0===r&&(r=this.world),r.add(new U.Text(this.game,t,e,i,n))},button:function(t,e,i,n,r,s,o,a,l,p){return void 0===p&&(p=this.world),p.add(new U.Button(this.game,t,e,i,n,r,s,o,a,l))},graphics:function(t,e,i){return void 0===i&&(i=this.world),i.add(new U.Graphics(this.game,t,e))},emitter:function(t,e,i){return this.game.particles.add(new U.Particles.Arcade.Emitter(this.game,t,e,i))},retroFont:function(t,e,i,n,r,s,o,a,l){return new U.RetroFont(this.game,t,e,i,n,r,s,o,a,l)},bitmapText:function(t,e,i,n,r,s){return void 0===s&&(s=this.world),s.add(new U.BitmapText(this.game,t,e,i,n,r))},tilemap:function(t,e,i,n,r){return new U.Tilemap(this.game,t,e,i,n,r)},renderTexture:function(t,e,i,n){void 0!==i&&""!==i||(i=this.game.rnd.uuid()),void 0===n&&(n=!1);e=new U.RenderTexture(this.game,t,e,i);return n&&this.game.cache.addRenderTexture(i,e),e},video:function(t,e){return new U.Video(this.game,t,e)},bitmapData:function(t,e,i,n){void 0===n&&(n=!1),void 0!==i&&""!==i||(i=this.game.rnd.uuid());e=new U.BitmapData(this.game,i,t,e);return n&&this.game.cache.addBitmapData(i,e),e},filter:function(t){var e=Array.prototype.slice.call(arguments,1);return(t=new U.Filter[t](this.game)).init.apply(t,e),t},plugin:function(t){return this.game.plugins.add(t)}},U.GameObjectFactory.prototype.constructor=U.GameObjectFactory,U.GameObjectCreator=function(t){this.game=t,this.world=this.game.world},U.GameObjectCreator.prototype={image:function(t,e,i,n){return new U.Image(this.game,t,e,i,n)},sprite:function(t,e,i,n){return new U.Sprite(this.game,t,e,i,n)},tween:function(t){return new U.Tween(t,this.game,this.game.tweens)},group:function(t,e,i,n,r){return new U.Group(this.game,t,e,i,n,r)},spriteBatch:function(t,e,i){return void 0===e&&(e="group"),void 0===i&&(i=!1),new U.SpriteBatch(this.game,t,e,i)},audio:function(t,e,i,n){return this.game.sound.add(t,e,i,n)},audioSprite:function(t){return this.game.sound.addSprite(t)},sound:function(t,e,i,n){return this.game.sound.add(t,e,i,n)},tileSprite:function(t,e,i,n,r,s){return new U.TileSprite(this.game,t,e,i,n,r,s)},rope:function(t,e,i,n,r){return new U.Rope(this.game,t,e,i,n,r)},text:function(t,e,i,n){return new U.Text(this.game,t,e,i,n)},button:function(t,e,i,n,r,s,o,a,l){return new U.Button(this.game,t,e,i,n,r,s,o,a,l)},graphics:function(t,e){return new U.Graphics(this.game,t,e)},emitter:function(t,e,i){return new U.Particles.Arcade.Emitter(this.game,t,e,i)},retroFont:function(t,e,i,n,r,s,o,a,l){return new U.RetroFont(this.game,t,e,i,n,r,s,o,a,l)},bitmapText:function(t,e,i,n,r,s){return new U.BitmapText(this.game,t,e,i,n,r,s)},tilemap:function(t,e,i,n,r){return new U.Tilemap(this.game,t,e,i,n,r)},renderTexture:function(t,e,i,n){void 0!==i&&""!==i||(i=this.game.rnd.uuid()),void 0===n&&(n=!1);e=new U.RenderTexture(this.game,t,e,i);return n&&this.game.cache.addRenderTexture(i,e),e},bitmapData:function(t,e,i,n){void 0===n&&(n=!1),void 0!==i&&""!==i||(i=this.game.rnd.uuid());e=new U.BitmapData(this.game,i,t,e);return n&&this.game.cache.addBitmapData(i,e),e},filter:function(t){var e=Array.prototype.slice.call(arguments,1);return(t=new U.Filter[t](this.game)).init.apply(t,e),t}},U.GameObjectCreator.prototype.constructor=U.GameObjectCreator,U.Sprite=function(t,e,i,n,r){e=e||0,i=i||0,n=n||null,r=r||null,this.type=U.SPRITE,this.physicsType=U.SPRITE,PIXI.Sprite.call(this,U.Cache.DEFAULT),U.Component.Core.init.call(this,t,e,i,n,r)},U.Sprite.prototype=Object.create(PIXI.Sprite.prototype),U.Sprite.prototype.constructor=U.Sprite,U.Component.Core.install.call(U.Sprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]),U.Sprite.prototype.preUpdatePhysics=U.Component.PhysicsBody.preUpdate,U.Sprite.prototype.preUpdateLifeSpan=U.Component.LifeSpan.preUpdate,U.Sprite.prototype.preUpdateInWorld=U.Component.InWorld.preUpdate,U.Sprite.prototype.preUpdateCore=U.Component.Core.preUpdate,U.Sprite.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},U.Image=function(t,e,i,n,r){e=e||0,i=i||0,n=n||null,r=r||null,this.type=U.IMAGE,PIXI.Sprite.call(this,U.Cache.DEFAULT),U.Component.Core.init.call(this,t,e,i,n,r)},U.Image.prototype=Object.create(PIXI.Sprite.prototype),U.Image.prototype.constructor=U.Image,U.Component.Core.install.call(U.Image.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Destroy","FixedToCamera","InputEnabled","LifeSpan","LoadTexture","Overlap","Reset","ScaleMinMax","Smoothed"]),U.Image.prototype.preUpdateInWorld=U.Component.InWorld.preUpdate,U.Image.prototype.preUpdateCore=U.Component.Core.preUpdate,U.Image.prototype.preUpdate=function(){return!!this.preUpdateInWorld()&&this.preUpdateCore()},U.Button=function(t,e,i,n,r,s,o,a,l,p){e=e||0,i=i||0,n=n||null,r=r||null,s=s||this,U.Image.call(this,t,e,i,n,a),this.type=U.BUTTON,this.physicsType=U.SPRITE,this._onOverFrame=null,this._onOutFrame=null,this._onDownFrame=null,this._onUpFrame=null,this.onOverSound=null,this.onOutSound=null,this.onDownSound=null,this.onUpSound=null,this.onOverSoundMarker="",this.onOutSoundMarker="",this.onDownSoundMarker="",this.onUpSoundMarker="",this.onInputOver=new U.Signal,this.onInputOut=new U.Signal,this.onInputDown=new U.Signal,this.onInputUp=new U.Signal,this.onOverMouseOnly=!0,this.justReleasedPreventsOver=U.PointerMode.TOUCH,this.freezeFrames=!1,this.forceOut=!1,this.inputEnabled=!0,this.input.start(0,!0),this.input.useHandCursor=!0,this.setFrames(o,a,l,p),null!==r&&this.onInputUp.add(r,s),this.events.onInputOver.add(this.onInputOverHandler,this),this.events.onInputOut.add(this.onInputOutHandler,this),this.events.onInputDown.add(this.onInputDownHandler,this),this.events.onInputUp.add(this.onInputUpHandler,this),this.events.onRemovedFromWorld.add(this.removedFromWorld,this)},U.Button.prototype=Object.create(U.Image.prototype),U.Button.prototype.constructor=U.Button;var l="Over",p="Out",h="Down";U.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)},U.Button.prototype.removedFromWorld=function(){this.inputEnabled=!1},U.Button.prototype.setStateFrame=function(t,e,i){var n="_on"+t+"Frame";null!==e?(this[n]=e,i&&this.changeStateFrame(t)):this[n]=null},U.Button.prototype.changeStateFrame=function(t){if(this.freezeFrames)return!1;t=this["_on"+t+"Frame"];return"string"==typeof t?(this.frameName=t,!0):"number"==typeof t&&(this.frame=t,!0)},U.Button.prototype.setFrames=function(t,e,i,n){this.setStateFrame(l,t,this.input.pointerOver()),this.setStateFrame(p,e,!this.input.pointerOver()),this.setStateFrame(h,i,this.input.pointerDown()),this.setStateFrame("Up",n,this.input.pointerUp())},U.Button.prototype.setStateSound=function(t,e,i){var n="on"+t+"Sound",t="on"+t+"SoundMarker";e instanceof U.Sound||e instanceof U.AudioSprite?(this[n]=e,this[t]="string"==typeof i?i:""):(this[n]=null,this[t]="")},U.Button.prototype.playStateSound=function(t){var e=this["on"+t+"Sound"];if(e){t=this["on"+t+"SoundMarker"];return e.play(t),!0}return!1},U.Button.prototype.setSounds=function(t,e,i,n,r,s,o,a){this.setStateSound(l,t,e),this.setStateSound(p,r,s),this.setStateSound(h,i,n),this.setStateSound("Up",o,a)},U.Button.prototype.setOverSound=function(t,e){this.setStateSound(l,t,e)},U.Button.prototype.setOutSound=function(t,e){this.setStateSound(p,t,e)},U.Button.prototype.setDownSound=function(t,e){this.setStateSound(h,t,e)},U.Button.prototype.setUpSound=function(t,e){this.setStateSound("Up",t,e)},U.Button.prototype.onInputOverHandler=function(t,e){e.justReleased()&&(this.justReleasedPreventsOver&e.pointerMode)===e.pointerMode||(this.changeStateFrame(l),this.onOverMouseOnly&&!e.isMouse||(this.playStateSound(l),this.onInputOver&&this.onInputOver.dispatch(this,e)))},U.Button.prototype.onInputOutHandler=function(t,e){this.changeStateFrame(p),this.playStateSound(p),this.onInputOut&&this.onInputOut.dispatch(this,e)},U.Button.prototype.onInputDownHandler=function(t,e){this.changeStateFrame(h),this.playStateSound(h),this.onInputDown&&this.onInputDown.dispatch(this,e)},U.Button.prototype.onInputUpHandler=function(t,e,i){this.playStateSound("Up"),this.onInputUp&&this.onInputUp.dispatch(this,e,i),this.freezeFrames||(!0===this.forceOut||(this.forceOut&e.pointerMode)===e.pointerMode?this.changeStateFrame(p):this.changeStateFrame("Up")||(i?this.changeStateFrame(l):this.changeStateFrame(p)))},U.SpriteBatch=function(t,e,i,n){null!=e||(e=t.world),PIXI.SpriteBatch.call(this),U.Group.call(this,t,e,i,n),this.type=U.SPRITEBATCH},U.SpriteBatch.prototype=U.Utils.extend(!0,U.SpriteBatch.prototype,PIXI.SpriteBatch.prototype,U.Group.prototype),U.SpriteBatch.prototype.constructor=U.SpriteBatch,U.BitmapData=function(t,e,i,n,r){void 0!==i&&0!==i||(i=256),void 0!==n&&0!==n||(n=256),void 0===r&&(r=!1),this.game=t,this.key=e,this.width=i,this.height=n,this.canvas=U.Canvas.create(this,i,n,null,r),this.context=this.canvas.getContext("2d",{alpha:!0}),this.ctx=this.context,this.smoothProperty=t.renderType===U.CANVAS?t.renderer.renderSession.smoothProperty:U.Canvas.getSmoothingPrefix(this.context),this.imageData=this.context.getImageData(0,0,i,n),this.data=null,this.imageData&&(this.data=this.imageData.data),this.pixels=null,this.data&&(this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data),this.baseTexture=new PIXI.BaseTexture(this.canvas),this.texture=new PIXI.Texture(this.baseTexture),this.frameData=new U.FrameData,this.textureFrame=this.frameData.addFrame(new U.Frame(0,0,0,i,n,"bitmapData")),this.texture.frame=this.textureFrame,this.type=U.BITMAPDATA,this.disableTextureUpload=!1,this.dirty=!1,this.cls=this.clear,this._image=null,this._pos=new U.Point,this._size=new U.Point,this._scale=new U.Point,this._rotate=0,this._alpha={prev:1,current:1},this._anchor=new U.Point,this._tempR=0,this._tempG=0,this._tempB=0,this._circle=new U.Circle,this._swapCanvas=void 0},U.BitmapData.prototype={move:function(t,e,i){return 0!==t&&this.moveH(t,i),0!==e&&this.moveV(e,i),this},moveH:function(t,e){void 0===e&&(e=!0),void 0===this._swapCanvas&&(this._swapCanvas=PIXI.CanvasPool.create(this,this.width,this.height));var i,n=this._swapCanvas.getContext("2d"),r=this.height,s=this.canvas;return n.clearRect(0,0,this.width,this.height),t<0?(t=Math.abs(t),i=this.width-t,e&&n.drawImage(s,0,0,t,r,i,0,t,r),n.drawImage(s,t,0,i,r,0,0,i,r)):(i=this.width-t,e&&n.drawImage(s,i,0,t,r,0,0,t,r),n.drawImage(s,0,0,i,r,t,0,i,r)),this.clear(),this.copy(this._swapCanvas)},moveV:function(t,e){void 0===e&&(e=!0),void 0===this._swapCanvas&&(this._swapCanvas=PIXI.CanvasPool.create(this,this.width,this.height));var i,n=this._swapCanvas.getContext("2d"),r=this.width,s=this.canvas;return n.clearRect(0,0,this.width,this.height),t<0?(t=Math.abs(t),i=this.height-t,e&&n.drawImage(s,0,0,r,t,0,i,r,t),n.drawImage(s,0,t,r,i,0,0,r,i)):(i=this.height-t,e&&n.drawImage(s,0,i,r,t,0,0,r,t),n.drawImage(s,0,0,r,i,0,t,r,i)),this.clear(),this.copy(this._swapCanvas)},add:function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)t[e].loadTexture&&t[e].loadTexture(this);else t.loadTexture(this);return this},load:function(t){if("string"==typeof t&&(t=this.game.cache.getImage(t)),t)return this.resize(t.width,t.height),this.cls(),this.draw(t),this.update(),this},clear:function(t,e,i,n){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=this.width),void 0===n&&(n=this.height),this.context.clearRect(t,e,i,n),this.dirty=!0,this},fill:function(t,e,i,n){return void 0===n&&(n=1),this.context.fillStyle="rgba("+t+","+e+","+i+","+n+")",this.context.fillRect(0,0,this.width,this.height),this.dirty=!0,this},generateTexture:function(t){var e=new Image;e.src=this.canvas.toDataURL("image/png");e=this.game.cache.addImage(t,"",e);return new PIXI.Texture(e.base)},resize:function(t,e){return t===this.width&&e===this.height||(this.width=t,this.height=e,this.canvas.width=t,this.canvas.height=e,void 0!==this._swapCanvas&&(this._swapCanvas.width=t,this._swapCanvas.height=e),this.baseTexture.width=t,this.baseTexture.height=e,this.textureFrame.width=t,this.textureFrame.height=e,this.texture.width=t,this.texture.height=e,this.texture.crop.width=t,this.texture.crop.height=e,this.update(),this.dirty=!0),this},update:function(t,e,i,n){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=Math.max(1,this.width)),void 0===n&&(n=Math.max(1,this.height)),this.imageData=this.context.getImageData(t,e,i,n),this.data=this.imageData.data,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data,this},processPixelRGB:function(t,e,i,n,r,s){void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=this.width),void 0===s&&(s=this.height);for(var o,a=i+r,l=n+s,p=U.Color.createColor(),h=!1,u=n;u<l;u++)for(var c=i;c<a;c++)U.Color.unpackPixel(this.getPixel32(c,u),p),!1!==(o=t.call(e,p,c,u))&&null!=o&&(this.setPixel32(c,u,o.r,o.g,o.b,o.a,!1),h=!0);return h&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},processPixel:function(t,e,i,n,r,s){void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=this.width),void 0===s&&(s=this.height);for(var o,a,l=i+r,p=n+s,h=!1,u=n;u<p;u++)for(var c=i;c<l;c++)o=this.getPixel32(c,u),(a=t.call(e,o,c,u))!==o&&(this.pixels[u*this.width+c]=a,h=!0);return h&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},replaceRGB:function(t,e,i,n,r,s,o,a,l){var p=0,h=0,u=this.width,c=this.height,d=U.Color.packPixel(t,e,i,n);void 0!==l&&l instanceof U.Rectangle&&(p=l.x,h=l.y,u=l.width,c=l.height);for(var _=0;_<c;_++)for(var y=0;y<u;y++)this.getPixel32(p+y,h+_)===d&&this.setPixel32(p+y,h+_,r,s,o,a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this},setHSL:function(t,e,i,n){var r=t||0===t,s=e||0===e,o=i||0===i;if(r||s||o){void 0===n&&(n=new U.Rectangle(0,0,this.width,this.height));for(var a=U.Color.createColor(),l=n.y;l<n.bottom;l++)for(var p=n.x;p<n.right;p++)U.Color.unpackPixel(this.getPixel32(p,l),a,!0),r&&(a.h=t),s&&(a.s=e),o&&(a.l=i),U.Color.HSLtoRGB(a.h,a.s,a.l,a),this.setPixel32(p,l,a.r,a.g,a.b,a.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},shiftHSL:function(t,e,i,n){if(null!=t||(t=!1),null!=e||(e=!1),null!=i||(i=!1),t||e||i){void 0===n&&(n=new U.Rectangle(0,0,this.width,this.height));for(var r=U.Color.createColor(),s=n.y;s<n.bottom;s++)for(var o=n.x;o<n.right;o++)U.Color.unpackPixel(this.getPixel32(o,s),r,!0),t&&(r.h=this.game.math.wrap(r.h+t,0,1)),e&&(r.s=this.game.math.clamp(r.s+e,0,1)),i&&(r.l=this.game.math.clamp(r.l+i,0,1)),U.Color.HSLtoRGB(r.h,r.s,r.l,r),this.setPixel32(o,s,r.r,r.g,r.b,r.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},setPixel32:function(t,e,i,n,r,s,o){return void 0===o&&(o=!0),0<=t&&t<=this.width&&0<=e&&e<=this.height&&(U.Device.LITTLE_ENDIAN?this.pixels[e*this.width+t]=s<<24|r<<16|n<<8|i:this.pixels[e*this.width+t]=i<<24|n<<16|r<<8|s,o&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0)),this},setPixel:function(t,e,i,n,r,s){return this.setPixel32(t,e,i,n,r,255,s)},getPixel:function(t,e,i){i=i||U.Color.createColor();e=~~(t+e*this.width);return e*=4,i.r=this.data[e],i.g=this.data[++e],i.b=this.data[++e],i.a=this.data[++e],i},getPixel32:function(t,e){if(0<=t&&t<=this.width&&0<=e&&e<=this.height)return this.pixels[e*this.width+t]},getPixelRGB:function(t,e,i,n,r){return U.Color.unpackPixel(this.getPixel32(t,e),i,n,r)},getPixels:function(t){return this.context.getImageData(t.x,t.y,t.width,t.height)},getFirstPixel:function(t){void 0===t&&(t=0);var e=U.Color.createColor(),i=0,n=0,r=1,s=!1;for(1===t?(r=-1,n=this.height):3===t&&(r=-1,i=this.width);U.Color.unpackPixel(this.getPixel32(i,n),e),0===t||1===t?(i++,i===this.width&&(i=0,n+=r,(n>=this.height||n<=0)&&(s=!0))):2!==t&&3!==t||(n++,n===this.height&&(n=0,i+=r,(i>=this.width||i<=0)&&(s=!0))),0===e.a&&!s;);return e.x=i,e.y=n,e},getBounds:function(t){return void 0===t&&(t=new U.Rectangle),t.x=this.getFirstPixel(2).x,t.x===this.width?t.setTo(0,0,0,0):(t.y=this.getFirstPixel(0).y,t.width=this.getFirstPixel(3).x-t.x+1,t.height=this.getFirstPixel(1).y-t.y+1,t)},addToWorld:function(t,e,i,n,r,s){r=r||1,s=s||1;e=this.game.add.image(t,e,this);return e.anchor.set(i,n),e.scale.set(r,s),e},copy:function(t,e,i,n,r,s,o,a,l,p,h,u,c,d,_,y,f){if(null!=t||(t=this),(t instanceof U.RenderTexture||t instanceof PIXI.RenderTexture)&&(t=t.getCanvas()),(this._image=t)instanceof U.Sprite||t instanceof U.Image||t instanceof U.Text||t instanceof PIXI.Sprite)this._pos.set(t.texture.crop.x,t.texture.crop.y),this._size.set(t.texture.crop.width,t.texture.crop.height),this._scale.set(t.scale.x,t.scale.y),this._anchor.set(t.anchor.x,t.anchor.y),this._rotate=t.rotation,this._alpha.current=t.alpha,t.texture instanceof U.RenderTexture||t.texture instanceof PIXI.RenderTexture?this._image=t.texture.getCanvas():this._image=t.texture.baseTexture.source,null!=s||(s=t.x),null!=o||(o=t.y),t.texture.trim&&(s+=t.texture.trim.x-t.anchor.x*t.texture.trim.width,o+=t.texture.trim.y-t.anchor.y*t.texture.trim.height),16777215!==t.tint&&(t.cachedTint!==t.tint&&(t.cachedTint=t.tint,t.tintedTexture=PIXI.CanvasTinter.getTintedTexture(t,t.tint)),this._image=t.tintedTexture,this._pos.set(0));else{if(this._pos.set(0),this._scale.set(1),this._anchor.set(0),this._rotate=0,this._alpha.current=1,t instanceof U.BitmapData)this._image=t.canvas;else if("string"==typeof t){if(null===(t=this.game.cache.getImage(t)))return;this._image=t}this._size.set(this._image.width,this._image.height)}if(null!=e||(e=0),null!=i||(i=0),n&&(this._size.x=n),r&&(this._size.y=r),null!=s||(s=e),null!=o||(o=i),null!=a||(a=this._size.x),null!=l||(l=this._size.y),"number"==typeof p&&(this._rotate=p),"number"==typeof h&&(this._anchor.x=h),"number"==typeof u&&(this._anchor.y=u),"number"==typeof c&&(this._scale.x=c),"number"==typeof d&&(this._scale.y=d),"number"==typeof _&&(this._alpha.current=_),void 0===y&&(y=null),void 0===f&&(f=!1),!(this._alpha.current<=0||0===this._scale.x||0===this._scale.y||0===this._size.x||0===this._size.y)){_=this.context;return this._alpha.prev=_.globalAlpha,_.save(),_.globalAlpha=this._alpha.current,y&&(this.op=y),f&&(s|=0,o|=0),_.translate(s,o),_.scale(this._scale.x,this._scale.y),_.rotate(this._rotate),_.drawImage(this._image,this._pos.x+e,this._pos.y+i,this._size.x,this._size.y,-a*this._anchor.x,-l*this._anchor.y,a,l),_.restore(),_.globalAlpha=this._alpha.prev,this.dirty=!0,this}},copyTransform:function(t,e,i){if(void 0===e&&(e=null),void 0===i&&(i=!1),!t.hasOwnProperty("worldTransform")||!t.worldVisible||0===t.worldAlpha)return this;var n=t.worldTransform;if(this._pos.set(t.texture.crop.x,t.texture.crop.y),this._size.set(t.texture.crop.width,t.texture.crop.height),0===n.a||0===n.d||0===this._size.x||0===this._size.y)return this;t.texture instanceof U.RenderTexture||t.texture instanceof PIXI.RenderTexture?this._image=t.texture.getCanvas():this._image=t.texture.baseTexture.source;var r=n.tx,s=n.ty;t.texture.trim&&(r+=t.texture.trim.x-t.anchor.x*t.texture.trim.width,s+=t.texture.trim.y-t.anchor.y*t.texture.trim.height),16777215!==t.tint&&(t.cachedTint!==t.tint&&(t.cachedTint=t.tint,t.tintedTexture=PIXI.CanvasTinter.getTintedTexture(t,t.tint)),this._image=t.tintedTexture,this._pos.set(0)),i&&(r|=0,s|=0);i=this.context;return this._alpha.prev=i.globalAlpha,i.save(),i.globalAlpha=this._alpha.current,e&&(this.op=e),i[this.smoothProperty]=t.texture.baseTexture.scaleMode===PIXI.scaleModes.LINEAR,i.setTransform(n.a,n.b,n.c,n.d,r,s),i.drawImage(this._image,this._pos.x,this._pos.y,this._size.x,this._size.y,-this._size.x*t.anchor.x,-this._size.y*t.anchor.y,this._size.x,this._size.y),i.restore(),i.globalAlpha=this._alpha.prev,this.dirty=!0,this},copyRect:function(t,e,i,n,r,s,o){return this.copy(t,e.x,e.y,e.width,e.height,i,n,e.width,e.height,0,0,0,1,1,r,s,o)},draw:function(t,e,i,n,r,s,o){return this.copy(t,null,null,null,null,e,i,n,r,null,null,null,null,null,null,s,o)},drawGroup:function(t,e,i){return 0<t.total&&t.forEachExists(this.drawGroupProxy,this,e,i),this},drawGroupProxy:function(t,e,i){if(t.hasOwnProperty("texture")&&this.copyTransform(t,e,i),t.type===U.GROUP&&t.exists)this.drawGroup(t,e,i);else if(t.hasOwnProperty("children")&&0<t.children.length)for(var n=0;n<t.children.length;n++)t.children[n].exists&&this.copyTransform(t.children[n],e,i)},drawFull:function(t,e,i){if(!1===t.worldVisible||0===t.worldAlpha||t.hasOwnProperty("exists")&&!1===t.exists)return this;var n;if(t.type!==U.GROUP&&t.type!==U.EMITTER&&t.type!==U.BITMAPTEXT&&(t.type===U.GRAPHICS?(n=t.getBounds(),this.ctx.save(),this.ctx.translate(n.x,n.y),PIXI.CanvasGraphics.renderGraphics(t,this.ctx),this.ctx.restore()):this.copy(t,null,null,null,null,t.worldPosition.x,t.worldPosition.y,null,null,t.worldRotation,null,null,t.worldScale.x,t.worldScale.y,t.worldAlpha,e,i)),t.children)for(var r=0;r<t.children.length;r++)this.drawFull(t.children[r],e,i);return this},shadow:function(t,e,i,n){var r=this.context;return null==t?r.shadowColor="rgba(0,0,0,0)":(r.shadowColor=t,r.shadowBlur=e||5,r.shadowOffsetX=i||10,r.shadowOffsetY=n||10),this},alphaMask:function(t,e,i,n){return(null==n?this.draw(e):this.draw(e,n.x,n.y,n.width,n.height)).blendSourceAtop(),(null==i?this.draw(t):this.draw(t,i.x,i.y,i.width,i.height)).blendReset(),this},extract:function(n,r,s,o,a,t,l,p,h){return void 0===a&&(a=255),void 0===t&&(t=!1),void 0===l&&(l=r),void 0===p&&(p=s),void 0===h&&(h=o),t&&n.resize(this.width,this.height),this.processPixelRGB(function(t,e,i){return t.r===r&&t.g===s&&t.b===o&&n.setPixel32(e,i,l,p,h,a,!1),!1},this),n.context.putImageData(n.imageData,0,0),n.dirty=!0,n},rect:function(t,e,i,n,r){return void 0!==r&&(this.context.fillStyle=r),this.context.fillRect(t,e,i,n),this},text:function(t,e,i,n,r,s){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n="14px Courier"),void 0===r&&(r="rgb(255,255,255)"),void 0===s&&(s=!0);var o=this.context,a=o.font;return o.font=n,s&&(o.fillStyle="rgb(0,0,0)",o.fillText(t,e+1,i+1)),o.fillStyle=r,o.fillText(t,e,i),o.font=a,this},circle:function(t,e,i,n){var r=this.context;return void 0!==n&&(r.fillStyle=n),r.beginPath(),r.arc(t,e,i,0,2*Math.PI,!1),r.closePath(),r.fill(),this},line:function(t,e,i,n,r,s){void 0===r&&(r="#fff"),void 0===s&&(s=1);var o=this.context;return o.beginPath(),o.moveTo(t,e),o.lineTo(i,n),o.lineWidth=s,o.strokeStyle=r,o.stroke(),o.closePath(),this},textureLine:function(t,e,i){if(void 0===i&&(i="repeat-x"),"string"!=typeof e||(e=this.game.cache.getImage(e))){var n=t.length;"no-repeat"===i&&n>e.width&&(n=e.width);var r=this.context;return r.fillStyle=r.createPattern(e,i),this._circle=new U.Circle(t.start.x,t.start.y,e.height),this._circle.circumferencePoint(t.angle-1.5707963267948966,!1,this._pos),r.save(),r.translate(this._pos.x,this._pos.y),r.rotate(t.angle),r.fillRect(0,0,n,e.height),r.restore(),this.dirty=!0,this}},render:function(){return!this.disableTextureUpload&&this.dirty&&(this.baseTexture.dirty(),this.dirty=!1),this},destroy:function(){this.frameData.destroy(),this.texture.destroy(!0),PIXI.CanvasPool.remove(this)},blendReset:function(){return this.op="source-over",this},blendSourceOver:function(){return this.op="source-over",this},blendSourceIn:function(){return this.op="source-in",this},blendSourceOut:function(){return this.op="source-out",this},blendSourceAtop:function(){return this.op="source-atop",this},blendDestinationOver:function(){return this.op="destination-over",this},blendDestinationIn:function(){return this.op="destination-in",this},blendDestinationOut:function(){return this.op="destination-out",this},blendDestinationAtop:function(){return this.op="destination-atop",this},blendXor:function(){return this.op="xor",this},blendAdd:function(){return this.op="lighter",this},blendMultiply:function(){return this.op="multiply",this},blendScreen:function(){return this.op="screen",this},blendOverlay:function(){return this.op="overlay",this},blendDarken:function(){return this.op="darken",this},blendLighten:function(){return this.op="lighten",this},blendColorDodge:function(){return this.op="color-dodge",this},blendColorBurn:function(){return this.op="color-burn",this},blendHardLight:function(){return this.op="hard-light",this},blendSoftLight:function(){return this.op="soft-light",this},blendDifference:function(){return this.op="difference",this},blendExclusion:function(){return this.op="exclusion",this},blendHue:function(){return this.op="hue",this},blendSaturation:function(){return this.op="saturation",this},blendColor:function(){return this.op="color",this},blendLuminosity:function(){return this.op="luminosity",this}},Object.defineProperty(U.BitmapData.prototype,"smoothed",{get:function(){U.Canvas.getSmoothingEnabled(this.context)},set:function(t){U.Canvas.setSmoothingEnabled(this.context,t)}}),Object.defineProperty(U.BitmapData.prototype,"op",{get:function(){return this.context.globalCompositeOperation},set:function(t){this.context.globalCompositeOperation=t}}),U.BitmapData.getTransform=function(t,e,i,n,r,s){return"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0),"number"!=typeof i&&(i=1),"number"!=typeof n&&(n=1),"number"!=typeof r&&(r=0),"number"!=typeof s&&(s=0),{sx:i,sy:n,scaleX:i,scaleY:n,skewX:r,skewY:s,translateX:t,translateY:e,tx:t,ty:e}},U.BitmapData.prototype.constructor=U.BitmapData,PIXI.Graphics=function(){PIXI.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this.blendMode=PIXI.blendModes.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this._localBounds=new PIXI.Rectangle(0,0,1,1),this.dirty=!0,this._boundsDirty=!1,this.webGLDirty=!1,this.cachedSpriteDirty=!1},PIXI.Graphics.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.Graphics.prototype.constructor=PIXI.Graphics,PIXI.Graphics.prototype.lineStyle=function(t,e,i){return this.lineWidth=t||0,this.lineColor=e||0,this.lineAlpha=void 0===i?1:i,this.currentPath&&(this.currentPath.shape.points.length?this.drawShape(new PIXI.Polygon(this.currentPath.shape.points.slice(-2))):(this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha)),this},PIXI.Graphics.prototype.moveTo=function(t,e){return this.drawShape(new PIXI.Polygon([t,e])),this},PIXI.Graphics.prototype.lineTo=function(t,e){return this.currentPath||this.moveTo(0,0),this.currentPath.shape.points.push(t,e),this.dirty=!0,this._boundsDirty=!0,this},PIXI.Graphics.prototype.quadraticCurveTo=function(t,e,i,n){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var r,s,o=this.currentPath.shape.points;0===o.length&&this.moveTo(0,0);for(var a,l=o[o.length-2],p=o[o.length-1],h=1;h<=20;++h)r=l+(t-l)*(a=h/20),s=p+(e-p)*a,o.push(r+(t+(i-t)*a-r)*a,s+(e+(n-e)*a-s)*a);return this.dirty=!0,this._boundsDirty=!0,this},PIXI.Graphics.prototype.bezierCurveTo=function(t,e,i,n,r,s){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var o,a,l,p,h,u,c=this.currentPath.shape.points,d=c[c.length-2],_=c[c.length-1],y=1;y<=20;++y)l=(a=(o=1-(u=y/20))*o)*o,h=(p=u*u)*u,c.push(l*d+3*a*u*t+3*o*p*i+h*r,l*_+3*a*u*e+3*o*p*n+h*s);return this.dirty=!0,this._boundsDirty=!0,this},PIXI.Graphics.prototype.arcTo=function(t,e,i,n,r){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);var s,o,a,l=this.currentPath.shape.points,p=l[l.length-2],h=l[l.length-1]-e,u=p-t,c=n-e,d=i-t,_=Math.abs(h*d-u*c);return _<1e-8||0===r?l[l.length-2]===t&&l[l.length-1]===e||l.push(t,e):(o=h*h+u*u,a=c*c+d*d,s=h*c+u*d,i=(p=r*Math.sqrt(o)/_)*d+(n=r*Math.sqrt(a)/_)*u,l=p*c+n*h,o=u*(n+(_=p*s/o)),_=h*(n+_),a=d*(p+(s=n*s/a)),s=c*(p+s),o=Math.atan2(_-l,o-i),a=Math.atan2(s-l,a-i),this.arc(i+t,l+e,r,o,a,d*h<u*c)),this.dirty=!0,this._boundsDirty=!0,this},PIXI.Graphics.prototype.arc=function(t,e,i,n,r,s,o){if(n===r)return this;void 0===s&&(s=!1),void 0===o&&(o=40),!s&&r<=n?r+=2*Math.PI:s&&n<=r&&(n+=2*Math.PI);var a=s?-1*(n-r):r-n,l=Math.ceil(Math.abs(a)/(2*Math.PI))*o;if(0==a)return this;r=t+Math.cos(n)*i,o=e+Math.sin(n)*i;s&&this.filling?this.moveTo(t,e):this.moveTo(r,o);for(var p=this.currentPath.shape.points,h=a/(2*l),u=2*h,c=Math.cos(h),d=Math.sin(h),_=l-1,y=_%1/_,f=0;f<=_;f++){var m=h+n+u*(f+y*f),x=Math.cos(m),m=-Math.sin(m);p.push((c*x+d*m)*i+t,(c*-m+d*x)*i+e)}return this.dirty=!0,this._boundsDirty=!0,this},PIXI.Graphics.prototype.beginFill=function(t,e){return this.filling=!0,this.fillColor=t||0,this.fillAlpha=void 0===e?1:e,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},PIXI.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},PIXI.Graphics.prototype.drawRect=function(t,e,i,n){return this.drawShape(new PIXI.Rectangle(t,e,i,n)),this},PIXI.Graphics.prototype.drawRoundedRect=function(t,e,i,n,r){return this.drawShape(new PIXI.RoundedRectangle(t,e,i,n,r)),this},PIXI.Graphics.prototype.drawCircle=function(t,e,i){return this.drawShape(new PIXI.Circle(t,e,i)),this},PIXI.Graphics.prototype.drawEllipse=function(t,e,i,n){return this.drawShape(new PIXI.Ellipse(t,e,i,n)),this},PIXI.Graphics.prototype.drawPolygon=function(t){(t instanceof U.Polygon||t instanceof PIXI.Polygon)&&(t=t.points);var e=t;if(!Array.isArray(e)){e=new Array(arguments.length);for(var i=0;i<e.length;++i)e[i]=arguments[i]}return this.drawShape(new U.Polygon(e)),this},PIXI.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this._boundsDirty=!0,this.clearDirty=!0,this.graphicsData=[],this.updateLocalBounds(),this},PIXI.Graphics.prototype.generateTexture=function(t,e,i){void 0===t&&(t=1),void 0===e&&(e=PIXI.scaleModes.DEFAULT),void 0===i&&(i=0);var n=this.getBounds();n.width+=i,n.height+=i;i=new PIXI.CanvasBuffer(n.width*t,n.height*t),e=PIXI.Texture.fromCanvas(i.canvas,e);return e.baseTexture.resolution=t,i.context.scale(t,t),i.context.translate(-n.x,-n.y),PIXI.CanvasGraphics.renderGraphics(this,i.context),e},PIXI.Graphics.prototype._renderWebGL=function(t){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,void PIXI.Sprite.prototype._renderWebGL.call(this._cachedSprite,t);var e;if(t.spriteBatch.stop(),t.blendModeManager.setBlendMode(this.blendMode),this._mask&&t.maskManager.pushMask(this._mask,t),this._filters&&t.filterManager.pushFilter(this._filterBlock),this.blendMode!==t.spriteBatch.currentBlendMode&&(t.spriteBatch.currentBlendMode=this.blendMode,e=PIXI.blendModesWebGL[t.spriteBatch.currentBlendMode],t.spriteBatch.gl.blendFunc(e[0],e[1])),this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),PIXI.WebGLGraphics.renderGraphics(this,t),this.children.length){t.spriteBatch.start();for(var i=0;i<this.children.length;i++)this.children[i]._renderWebGL(t);t.spriteBatch.stop()}this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this.mask,t),t.drawCount++,t.spriteBatch.start()}},PIXI.Graphics.prototype._renderCanvas=function(t){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._prevTint!==this.tint&&(this.dirty=!0,this._prevTint=this.tint),this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void PIXI.Sprite.prototype._renderCanvas.call(this._cachedSprite,t);var e=t.context,i=this.worldTransform;this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,e.globalCompositeOperation=PIXI.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t);var n=t.resolution,r=i.tx*t.resolution+t.shakeX,s=i.ty*t.resolution+t.shakeY;e.setTransform(i.a*n,i.b*n,i.c*n,i.d*n,r,s),PIXI.CanvasGraphics.renderGraphics(this,e);for(var o=0;o<this.children.length;o++)this.children[o]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},PIXI.Graphics.prototype.getBounds=function(t){if(!this._currentBounds){if(!this.renderable)return PIXI.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var e=this._localBounds,i=e.x,n=e.width+e.x,r=e.y,s=e.height+e.y,o=t||this.worldTransform,a=o.a,l=o.b,p=o.c,h=o.d,u=o.tx,c=o.ty,d=a*n+p*s+u,e=h*s+l*n+c,t=a*i+p*s+u,o=h*s+l*i+c,s=a*i+p*r+u,i=h*r+l*i+c,u=a*n+p*r+u,l=h*r+l*n+c,n=d,c=e,d=d,e=e;d=u<(d=s<(d=t<d?t:d)?s:d)?u:d,e=l<(e=i<(e=o<e?o:e)?i:e)?l:e,n=(n=(n=n<t?t:n)<s?s:n)<u?u:n,c=(c=(c=c<o?o:c)<i?i:c)<l?l:c,this._bounds.x=d,this._bounds.width=n-d,this._bounds.y=e,this._bounds.height=c-e,this._currentBounds=this._bounds}return this._currentBounds},PIXI.Graphics.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=PIXI.identityMatrix;for(var e=0;e<this.children.length;e++)this.children[e].updateTransform();var i=this.getBounds();for(this.worldTransform=t,e=0;e<this.children.length;e++)this.children[e].updateTransform();return i},PIXI.Graphics.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,tempPoint);for(var e=this.graphicsData,i=0;i<e.length;i++){var n=e[i];if(n.fill&&n.shape&&n.shape.contains(tempPoint.x,tempPoint.y))return!0}return!1},PIXI.Graphics.prototype.updateLocalBounds=function(){var t=1/0,e=-1/0,i=1/0,n=-1/0;if(this.graphicsData.length)for(var r,s,o,a,l,p=0;p<this.graphicsData.length;p++){var h=this.graphicsData[p],u=h.type,c=h.lineWidth,h=h.shape;if(u===PIXI.Graphics.RECT||u===PIXI.Graphics.RREC)s=h.x-c/2,o=h.y-c/2,t=s<t?s:t,e=e<s+(a=h.width+c)?s+a:e,i=o<i?o:i,n=n<o+(l=h.height+c)?o+l:n;else if(u===PIXI.Graphics.CIRC)s=h.x,o=h.y,t=s-(a=h.radius+c/2)<t?s-a:t,e=e<s+a?s+a:e,i=o-(l=h.radius+c/2)<i?o-l:i,n=n<o+l?o+l:n;else if(u===PIXI.Graphics.ELIP)s=h.x,o=h.y,t=s-(a=h.width+c/2)<t?s-a:t,e=e<s+a?s+a:e,i=o-(l=h.height+c/2)<i?o-l:i,n=n<o+l?o+l:n;else{r=h.points;for(var d=0;d<r.length;d++)r[d]instanceof U.Point?(s=r[d].x,o=r[d].y):(s=r[d],o=r[d+1],d<r.length-1&&d++),t=s-c<t?s-c:t,e=e<s+c?s+c:e,i=o-c<i?o-c:i,n=n<o+c?o+c:n}}else n=i=e=t=0;var _=this.boundsPadding;this._localBounds.x=t-_,this._localBounds.width=e-t+2*_,this._localBounds.y=i-_,this._localBounds.height=n-i+2*_},PIXI.Graphics.prototype._generateCachedSprite=function(){var t,e,i=this.getLocalBounds();this._cachedSprite?this._cachedSprite.buffer.resize(i.width,i.height):(t=new PIXI.CanvasBuffer(i.width,i.height),e=PIXI.Texture.fromCanvas(t.canvas),this._cachedSprite=new PIXI.Sprite(e),this._cachedSprite.buffer=t,this._cachedSprite.worldTransform=this.worldTransform),this._cachedSprite.anchor.x=-(i.x/i.width),this._cachedSprite.anchor.y=-(i.y/i.height),this._cachedSprite.buffer.context.translate(-i.x,-i.y),this.worldAlpha=1,PIXI.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},PIXI.Graphics.prototype.updateCachedSpriteTexture=function(){var t=this._cachedSprite,e=t.texture,i=t.buffer.canvas;e.baseTexture.width=i.width,e.baseTexture.height=i.height,e.crop.width=e.frame.width=i.width,e.crop.height=e.frame.height=i.height,t._width=i.width,t._height=i.height,e.baseTexture.dirty()},PIXI.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},PIXI.Graphics.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null,t instanceof U.Polygon&&(t=t.clone()).flatten();t=new PIXI.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,t);return this.graphicsData.push(t),t.type===PIXI.Graphics.POLY&&(t.shape.closed=this.filling,this.currentPath=t),this.dirty=!0,this._boundsDirty=!0,t},Object.defineProperty(PIXI.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap=t,this._cacheAsBitmap?this._generateCachedSprite():this.destroyCachedSprite(),this.dirty=!0,this.webGLDirty=!0}}),PIXI.GraphicsData=function(t,e,i,n,r,s,o){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this._lineTint=e,this.fillColor=n,this.fillAlpha=r,this._fillTint=n,this.fill=s,this.shape=o,this.type=o.type},PIXI.GraphicsData.prototype.constructor=PIXI.GraphicsData,PIXI.GraphicsData.prototype.clone=function(){return new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},PIXI.EarCut={},PIXI.EarCut.Triangulate=function(t,e,i){i=i||2;var n,r,s,o,a,l,p,h=e&&e.length,u=h?e[0]*i:t.length,c=PIXI.EarCut.linkedList(t,0,u,i,!0),d=[];if(!c)return d;if(h&&(c=PIXI.EarCut.eliminateHoles(t,e,c,i)),t.length>80*i){n=s=t[0],r=o=t[1];for(var _=i;_<u;_+=i)(a=t[_])<n&&(n=a),(l=t[_+1])<r&&(r=l),s<a&&(s=a),o<l&&(o=l);p=Math.max(s-n,o-r)}return PIXI.EarCut.earcutLinked(c,d,i,n,r,p),d},PIXI.EarCut.linkedList=function(t,e,i,n,r){for(var s,o=0,a=e,l=i-n;a<i;a+=n)o+=(t[l]-t[a])*(t[a+1]+t[l+1]),l=a;if(r===0<o)for(a=e;a<i;a+=n)s=PIXI.EarCut.insertNode(a,t[a],t[a+1],s);else for(a=i-n;e<=a;a-=n)s=PIXI.EarCut.insertNode(a,t[a],t[a+1],s);return s},PIXI.EarCut.filterPoints=function(t,e){if(!t)return t;e=e||t;var i,n=t;do{if(i=!1,n.steiner||!PIXI.EarCut.equals(n,n.next)&&0!==PIXI.EarCut.area(n.prev,n,n.next))n=n.next;else{if(PIXI.EarCut.removeNode(n),(n=e=n.prev)===n.next)return null;i=!0}}while(i||n!==e);return e},PIXI.EarCut.earcutLinked=function(t,e,i,n,r,s,o){if(t){!o&&s&&PIXI.EarCut.indexCurve(t,n,r,s);for(var a,l,p=t;t.prev!==t.next;)if(a=t.prev,l=t.next,s?PIXI.EarCut.isEarHashed(t,n,r,s):PIXI.EarCut.isEar(t))e.push(a.i/i),e.push(t.i/i),e.push(l.i/i),PIXI.EarCut.removeNode(t),t=l.next,p=l.next;else if((t=l)===p){o?1===o?(t=PIXI.EarCut.cureLocalIntersections(t,e,i),PIXI.EarCut.earcutLinked(t,e,i,n,r,s,2)):2===o&&PIXI.EarCut.splitEarcut(t,e,i,n,r,s):PIXI.EarCut.earcutLinked(PIXI.EarCut.filterPoints(t),e,i,n,r,s,1);break}}},PIXI.EarCut.isEar=function(t){var e=t.prev,i=t,n=t.next;if(0<=PIXI.EarCut.area(e,i,n))return!1;for(var r=t.next.next;r!==t.prev;){if(PIXI.EarCut.pointInTriangle(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&0<=PIXI.EarCut.area(r.prev,r,r.next))return!1;r=r.next}return!0},PIXI.EarCut.isEarHashed=function(t,e,i,n){var r=t.prev,s=t,o=t.next;if(0<=PIXI.EarCut.area(r,s,o))return!1;for(var a=(r.x<s.x?r.x<o.x?r:o:s.x<o.x?s:o).x,l=(r.y<s.y?r.y<o.y?r:o:s.y<o.y?s:o).y,p=(r.x>s.x?r.x>o.x?r:o:s.x>o.x?s:o).x,h=(r.y>s.y?r.y>o.y?r:o:s.y>o.y?s:o).y,u=PIXI.EarCut.zOrder(a,l,e,i,n),c=PIXI.EarCut.zOrder(p,h,e,i,n),d=t.nextZ;d&&d.z<=c;){if(d!==t.prev&&d!==t.next&&PIXI.EarCut.pointInTriangle(r.x,r.y,s.x,s.y,o.x,o.y,d.x,d.y)&&0<=PIXI.EarCut.area(d.prev,d,d.next))return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&PIXI.EarCut.pointInTriangle(r.x,r.y,s.x,s.y,o.x,o.y,d.x,d.y)&&0<=PIXI.EarCut.area(d.prev,d,d.next))return!1;d=d.prevZ}return!0},PIXI.EarCut.cureLocalIntersections=function(t,e,i){var n=t;do{var r=n.prev,s=n.next.next}while(PIXI.EarCut.intersects(r,n,n.next,s)&&PIXI.EarCut.locallyInside(r,s)&&PIXI.EarCut.locallyInside(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),PIXI.EarCut.removeNode(n),PIXI.EarCut.removeNode(n.next),n=t=s),(n=n.next)!==t);return n},PIXI.EarCut.splitEarcut=function(t,e,i,n,r,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&PIXI.EarCut.isValidDiagonal(o,a)){var l=PIXI.EarCut.splitPolygon(o,a),o=PIXI.EarCut.filterPoints(o,o.next),l=PIXI.EarCut.filterPoints(l,l.next);return PIXI.EarCut.earcutLinked(o,e,i,n,r,s),void PIXI.EarCut.earcutLinked(l,e,i,n,r,s)}a=a.next}}while((o=o.next)!==t)},PIXI.EarCut.eliminateHoles=function(t,e,i,n){for(var r,s,o=[],a=0,l=e.length;a<l;a++)r=e[a]*n,s=a<l-1?e[a+1]*n:t.length,(s=PIXI.EarCut.linkedList(t,r,s,n,!1))===s.next&&(s.steiner=!0),o.push(PIXI.EarCut.getLeftmost(s));for(o.sort(compareX),a=0;a<o.length;a++)PIXI.EarCut.eliminateHole(o[a],i),i=PIXI.EarCut.filterPoints(i,i.next);return i},PIXI.EarCut.compareX=function(t,e){return t.x-e.x},PIXI.EarCut.eliminateHole=function(t,e){(e=PIXI.EarCut.findHoleBridge(t,e))&&(t=PIXI.EarCut.splitPolygon(e,t),PIXI.EarCut.filterPoints(t,t.next))},PIXI.EarCut.findHoleBridge=function(t,e){var i,n,r=e,s=t.x,o=t.y,a=-1/0;do{}while(o<=r.y&&o>=r.next.y&&((n=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y))<=s&&a<n&&(a=n,i=r.x<r.next.x?r:r.next)),(r=r.next)!==e);if(!i)return null;if(t.x===i.x)return i.prev;for(var l,p=i,h=1/0,r=i.next;r!==p;)s>=r.x&&r.x>=i.x&&PIXI.EarCut.pointInTriangle(o<i.y?s:a,o,i.x,i.y,o<i.y?a:s,o,r.x,r.y)&&(((l=Math.abs(o-r.y)/(s-r.x))<h||l===h&&r.x>i.x)&&PIXI.EarCut.locallyInside(r,t)&&(i=r,h=l)),r=r.next;return i},PIXI.EarCut.indexCurve=function(t,e,i,n){for(var r=t;null===r.z&&(r.z=PIXI.EarCut.zOrder(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next,r!==t;);r.prevZ.nextZ=null,r.prevZ=null,PIXI.EarCut.sortLinked(r)},PIXI.EarCut.sortLinked=function(t){var e,i,n,r,s,o,a,l,p=1;do{for(i=t,s=t=null,o=0;i;){for(o++,n=i,e=a=0;e<p&&(a++,n=n.nextZ);e++);for(l=p;0<a||0<l&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(i=(r=i).nextZ,a--):(n=(r=n).nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}}while(s.nextZ=null,p*=2,1<o);return t},PIXI.EarCut.zOrder=function(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)/r)|e<<8))|e<<4))|e<<2))|e<<1))<<1},PIXI.EarCut.getLeftmost=function(t){for(var e=t,i=t;e.x<i.x&&(i=e),e=e.next,e!==t;);return i},PIXI.EarCut.pointInTriangle=function(t,e,i,n,r,s,o,a){return 0<=(r-o)*(e-a)-(t-o)*(s-a)&&0<=(t-o)*(n-a)-(i-o)*(e-a)&&0<=(i-o)*(s-a)-(r-o)*(n-a)},PIXI.EarCut.isValidDiagonal=function(t,e){return PIXI.EarCut.equals(t,e)||t.next.i!==e.i&&t.prev.i!==e.i&&!PIXI.EarCut.intersectsPolygon(t,e)&&PIXI.EarCut.locallyInside(t,e)&&PIXI.EarCut.locallyInside(e,t)&&PIXI.EarCut.middleInside(t,e)},PIXI.EarCut.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)},PIXI.EarCut.equals=function(t,e){return t.x===e.x&&t.y===e.y},PIXI.EarCut.intersects=function(t,e,i,n){return 0<PIXI.EarCut.area(t,e,i)!=0<PIXI.EarCut.area(t,e,n)&&0<PIXI.EarCut.area(i,n,t)!=0<PIXI.EarCut.area(i,n,e)},PIXI.EarCut.intersectsPolygon=function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&PIXI.EarCut.intersects(i,i.next,t,e))return!0}while((i=i.next)!==t);return!1},PIXI.EarCut.locallyInside=function(t,e){return PIXI.EarCut.area(t.prev,t,t.next)<0?0<=PIXI.EarCut.area(t,e,t.next)&&0<=PIXI.EarCut.area(t,t.prev,e):PIXI.EarCut.area(t,e,t.prev)<0||PIXI.EarCut.area(t,t.next,e)<0},PIXI.EarCut.middleInside=function(t,e){for(var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;i.y>s!=i.next.y>s&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next,i!==t;);return n},PIXI.EarCut.splitPolygon=function(t,e){var i=new PIXI.EarCut.Node(t.i,t.x,t.y),n=new PIXI.EarCut.Node(e.i,e.x,e.y),r=t.next,s=e.prev;return(t.next=e).prev=t,(i.next=r).prev=i,(n.next=i).prev=n,(s.next=n).prev=s,n},PIXI.EarCut.insertNode=function(t,e,i,n){i=new PIXI.EarCut.Node(t,e,i);return n?(i.next=n.next,(i.prev=n).next.prev=i,n.next=i):(i.prev=i).next=i,i},PIXI.EarCut.removeNode=function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)},PIXI.EarCut.Node=function(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1},PIXI.WebGLGraphics=function(){},PIXI.WebGLGraphics.stencilBufferLimit=6,PIXI.WebGLGraphics.renderGraphics=function(t,e){var i,n=e.gl,r=e.projection,s=e.offset,o=e.shaderManager.primitiveShader;t.dirty&&PIXI.WebGLGraphics.updateGraphics(t,n);for(var a=t._webGL[n.id],l=0;l<a.data.length;l++)1===a.data[l].mode?(i=a.data[l],e.stencilManager.pushStencil(t,i,e),n.drawElements(n.TRIANGLE_FAN,4,n.UNSIGNED_SHORT,2*(i.indices.length-4)),e.stencilManager.popStencil(t,i,e)):(i=a.data[l],e.shaderManager.setShader(o),o=e.shaderManager.primitiveShader,n.uniformMatrix3fv(o.translationMatrix,!1,t.worldTransform.toArray(!0)),n.uniform1f(o.flipY,1),n.uniform2f(o.projectionVector,r.x,-r.y),n.uniform2f(o.offsetVector,-s.x,-s.y),n.uniform3fv(o.tintColor,PIXI.hex2rgb(t.tint)),n.uniform1f(o.alpha,t.worldAlpha),n.bindBuffer(n.ARRAY_BUFFER,i.buffer),n.vertexAttribPointer(o.aVertexPosition,2,n.FLOAT,!1,24,0),n.vertexAttribPointer(o.colorAttribute,4,n.FLOAT,!1,24,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.indexBuffer),n.drawElements(n.TRIANGLE_STRIP,i.indices.length,n.UNSIGNED_SHORT,0))},PIXI.WebGLGraphics.updateGraphics=function(t,e){var i,n=(n=t._webGL[e.id])||(t._webGL[e.id]={lastIndex:0,data:[],gl:e});if(t.dirty=!1,t.clearDirty){for(t.clearDirty=!1,i=0;i<n.data.length;i++){var r=n.data[i];r.reset(),PIXI.WebGLGraphics.graphicsDataPool.push(r)}n.data=[],n.lastIndex=0}for(i=n.lastIndex;i<t.graphicsData.length;i++){var s,o=t.graphicsData[i];o.type===PIXI.Graphics.POLY?(o.points=o.shape.points.slice(),o.shape.closed&&(o.points[0]===o.points[o.points.length-2]&&o.points[1]===o.points[o.points.length-1]||o.points.push(o.points[0],o.points[1])),o.fill&&o.points.length>=PIXI.WebGLGraphics.stencilBufferLimit&&(o.points.length<2*PIXI.WebGLGraphics.stencilBufferLimit?(s=PIXI.WebGLGraphics.switchMode(n,0),PIXI.WebGLGraphics.buildPoly(o,s)||(s=PIXI.WebGLGraphics.switchMode(n,1),PIXI.WebGLGraphics.buildComplexPoly(o,s))):(s=PIXI.WebGLGraphics.switchMode(n,1),PIXI.WebGLGraphics.buildComplexPoly(o,s))),0<o.lineWidth&&(s=PIXI.WebGLGraphics.switchMode(n,0),PIXI.WebGLGraphics.buildLine(o,s))):(s=PIXI.WebGLGraphics.switchMode(n,0),o.type===PIXI.Graphics.RECT?PIXI.WebGLGraphics.buildRectangle(o,s):o.type===PIXI.Graphics.CIRC||o.type===PIXI.Graphics.ELIP?PIXI.WebGLGraphics.buildCircle(o,s):o.type===PIXI.Graphics.RREC&&PIXI.WebGLGraphics.buildRoundedRectangle(o,s)),n.lastIndex++}for(i=0;i<n.data.length;i++)(s=n.data[i]).dirty&&s.upload()},PIXI.WebGLGraphics.switchMode=function(t,e){var i;return t.data.length?(i=t.data[t.data.length-1]).mode===e&&1!==e||((i=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(t.gl)).mode=e,t.data.push(i)):((i=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(t.gl)).mode=e,t.data.push(i)),i.dirty=!0,i},PIXI.WebGLGraphics.buildRectangle=function(t,e){var i,n,r,s,o,a,l=t.shape,p=l.x,h=l.y,u=l.width,c=l.height;t.fill&&(a=PIXI.hex2rgb(t.fillColor),i=t.fillAlpha,n=a[0]*i,r=a[1]*i,s=a[2]*i,o=e.points,l=e.indices,a=o.length/6,o.push(p,h),o.push(n,r,s,i),o.push(p+u,h),o.push(n,r,s,i),o.push(p,h+c),o.push(n,r,s,i),o.push(p+u,h+c),o.push(n,r,s,i),l.push(a,a,1+a,2+a,3+a,3+a)),t.lineWidth&&(a=t.points,t.points=[p,h,p+u,h,p+u,h+c,p,h+c,p,h],PIXI.WebGLGraphics.buildLine(t,e),t.points=a)},PIXI.WebGLGraphics.buildRoundedRectangle=function(t,e){var i=t.shape,n=i.x,r=i.y,s=i.width,o=i.height,i=i.radius,a=[];if(a.push(n,r+i),a=(a=(a=(a=a.concat(PIXI.WebGLGraphics.quadraticBezierCurve(n,r+o-i,n,r+o,n+i,r+o))).concat(PIXI.WebGLGraphics.quadraticBezierCurve(n+s-i,r+o,n+s,r+o,n+s,r+o-i))).concat(PIXI.WebGLGraphics.quadraticBezierCurve(n+s,r+i,n+s,r,n+s-i,r))).concat(PIXI.WebGLGraphics.quadraticBezierCurve(n+i,r,n,r,n,r+i)),t.fill){for(var l=PIXI.hex2rgb(t.fillColor),p=t.fillAlpha,h=l[0]*p,u=l[1]*p,c=l[2]*p,d=e.points,_=e.indices,y=d.length/6,f=PIXI.EarCut.Triangulate(a,null,2),m=0,m=0;m<f.length;m+=3)_.push(f[m]+y),_.push(f[m]+y),_.push(f[m+1]+y),_.push(f[m+2]+y),_.push(f[m+2]+y);for(m=0;m<a.length;m++)d.push(a[m],a[++m],h,u,c,p)}t.lineWidth&&(l=t.points,t.points=a,PIXI.WebGLGraphics.buildLine(t,e),t.points=l)},PIXI.WebGLGraphics.quadraticBezierCurve=function(t,e,i,n,r,s){function o(t,e,i){return t+(e-t)*i}for(var a,l,p,h,u,c=[],d=0;d<=20;d++)a=o(t,i,u=d/20),l=o(e,n,u),p=o(i,r,u),h=o(n,s,u),p=o(a,p,u),h=o(l,h,u),c.push(p,h);return c},PIXI.WebGLGraphics.buildCircle=function(t,e){var i,n=t.shape,r=n.x,s=n.y,o=t.type===PIXI.Graphics.CIRC?(i=n.radius,n.radius):(i=n.width,n.height),a=2*Math.PI/40,l=0;if(t.fill){var p=PIXI.hex2rgb(t.fillColor),h=t.fillAlpha,u=p[0]*h,c=p[1]*h,d=p[2]*h,_=e.points,y=e.indices,f=_.length/6;for(y.push(f),l=0;l<41;l++)_.push(r,s,u,c,d,h),_.push(r+Math.sin(a*l)*i,s+Math.cos(a*l)*o,u,c,d,h),y.push(f++,f++);y.push(f-1)}if(t.lineWidth){p=t.points;for(t.points=[],l=0;l<41;l++)t.points.push(r+Math.sin(a*l)*i,s+Math.cos(a*l)*o);PIXI.WebGLGraphics.buildLine(t,e),t.points=p}},PIXI.WebGLGraphics.buildLine=function(t,e){var i=0,n=t.points;if(0!==n.length){if(t.lineWidth%2)for(i=0;i<n.length;i++)n[i]+=.5;var r,s=new PIXI.Point(n[0],n[1]),o=new PIXI.Point(n[n.length-2],n[n.length-1]);s.x===o.x&&s.y===o.y&&((n=n.slice()).pop(),n.pop(),r=(o=new PIXI.Point(n[n.length-2],n[n.length-1])).x+.5*(s.x-o.x),o=o.y+.5*(s.y-o.y),n.unshift(r,o),n.push(r,o));var a,l,p,h,u,c,d,_,y,f=e.points,m=e.indices,x=n.length/2,v=n.length,g=f.length/6,b=t.lineWidth/2,e=PIXI.hex2rgb(t.lineColor),z=t.lineAlpha,w=e[0]*z,C=e[1]*z,P=e[2]*z,T=n[0],S=n[1],M=n[2],A=n[3],O=-(S-A),k=T-M,E=Math.sqrt(O*O+k*k);for(O/=E,k/=E,O*=b,k*=b,f.push(T-O,S-k,w,C,P,z),f.push(T+O,S+k,w,C,P,z),i=1;i<x-1;i++)T=n[2*(i-1)],S=n[2*(i-1)+1],M=n[2*i],A=n[2*i+1],h=n[2*(i+1)],y=n[2*(i+1)+1],O=-(S-A),k=T-M,O/=E=Math.sqrt(O*O+k*k),k/=E,O*=b,k*=b,a=-(A-y),l=M-h,a/=E=Math.sqrt(a*a+l*l),l/=E,u=(-O+T)*(-k+A)-(-O+M)*(-k+S),_=(-(a*=b)+h)*(-(l*=b)+A)-(-a+M)*(-l+y),y=(p=-k+S-(-k+A))*(d=-a+M-(-a+h))-(c=-l+y-(-l+A))*(h=-O+M-(-O+T)),Math.abs(y)<.1?(y+=10.1,f.push(M-O,A-k,w,C,P,z),f.push(M+O,A+k,w,C,P,z)):19600<((d=(h*_-d*u)/y)-M)*(d-M)+((y=(c*u-p*_)/y)-A)+(y-A)?(a=O-a,l=k-l,a/=E=Math.sqrt(a*a+l*l),l/=E,a*=b,l*=b,f.push(M-a,A-l),f.push(w,C,P,z),f.push(M+a,A+l),f.push(w,C,P,z),f.push(M-a,A-l),f.push(w,C,P,z),v++):(f.push(d,y),f.push(w,C,P,z),f.push(M-(d-M),A-(y-A)),f.push(w,C,P,z));for(T=n[2*(x-2)],S=n[2*(x-2)+1],M=n[2*(x-1)],O=-(S-(A=n[2*(x-1)+1])),k=T-M,O/=E=Math.sqrt(O*O+k*k),k/=E,O*=b,k*=b,f.push(M-O,A-k),f.push(w,C,P,z),f.push(M+O,A+k),f.push(w,C,P,z),m.push(g),i=0;i<v;i++)m.push(g++);m.push(g-1)}},PIXI.WebGLGraphics.buildComplexPoly=function(t,e){var i=t.points.slice();if(!(i.length<6)){var n=e.indices;e.points=i,e.alpha=t.fillAlpha,e.color=PIXI.hex2rgb(t.fillColor);for(var r,s=1/0,o=-1/0,a=1/0,l=-1/0,p=0;p<i.length;p+=2)s=(r=i[p])<s?r:s,o=o<r?r:o,a=(r=i[p+1])<a?r:a,l=l<r?r:l;i.push(s,a,o,a,o,l,s,l);for(var h=i.length/2,p=0;p<h;p++)n.push(p)}},PIXI.WebGLGraphics.buildPoly=function(t,e){var i=t.points;if(!(i.length<6)){var n=e.points,r=e.indices,s=i.length/2,e=PIXI.hex2rgb(t.fillColor),o=t.fillAlpha,a=e[0]*o,l=e[1]*o,p=e[2]*o,h=PIXI.EarCut.Triangulate(i,null,2);if(!h)return!1;for(var u=n.length/6,c=0,c=0;c<h.length;c+=3)r.push(h[c]+u),r.push(h[c]+u),r.push(h[c+1]+u),r.push(h[c+2]+u),r.push(h[c+2]+u);for(c=0;c<s;c++)n.push(i[2*c],i[2*c+1],a,l,p,o);return!0}},PIXI.WebGLGraphics.graphicsDataPool=[],PIXI.WebGLGraphicsData=function(t){this.gl=t,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},PIXI.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[]},PIXI.WebGLGraphicsData.prototype.upload=function(){var t=this.gl;this.glPoints=new PIXI.Float32Array(this.points),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.glPoints,t.STATIC_DRAW),this.glIndicies=new PIXI.Uint16Array(this.indices),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.glIndicies,t.STATIC_DRAW),this.dirty=!1},PIXI.CanvasGraphics=function(){},PIXI.CanvasGraphics.renderGraphics=function(t,e){var i=t.worldAlpha;t.dirty&&(this.updateGraphicsTint(t),t.dirty=!1);for(var n=0;n<t.graphicsData.length;n++){var r,s,o,a,l,p,h,u,c=t.graphicsData[n],d=c.shape,_=c._fillTint,y=c._lineTint;if(e.lineWidth=c.lineWidth,c.type===PIXI.Graphics.POLY){e.beginPath();var f=d.points;e.moveTo(f[0],f[1]);for(var m=1;m<f.length/2;m++)e.lineTo(f[2*m],f[2*m+1]);d.closed&&e.lineTo(f[0],f[1]),f[0]===f[f.length-2]&&f[1]===f[f.length-1]&&e.closePath(),c.fill&&(e.globalAlpha=c.fillAlpha*i,e.fillStyle="#"+("00000"+(0|_).toString(16)).substr(-6),e.fill()),c.lineWidth&&(e.globalAlpha=c.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|y).toString(16)).substr(-6),e.stroke())}else c.type===PIXI.Graphics.RECT?(!c.fillColor&&0!==c.fillColor||(e.globalAlpha=c.fillAlpha*i,e.fillStyle="#"+("00000"+(0|_).toString(16)).substr(-6),e.fillRect(d.x,d.y,d.width,d.height)),c.lineWidth&&(e.globalAlpha=c.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|y).toString(16)).substr(-6),e.strokeRect(d.x,d.y,d.width,d.height))):c.type===PIXI.Graphics.CIRC?(e.beginPath(),e.arc(d.x,d.y,d.radius,0,2*Math.PI),e.closePath(),c.fill&&(e.globalAlpha=c.fillAlpha*i,e.fillStyle="#"+("00000"+(0|_).toString(16)).substr(-6),e.fill()),c.lineWidth&&(e.globalAlpha=c.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|y).toString(16)).substr(-6),e.stroke())):c.type===PIXI.Graphics.ELIP?(o=2*d.width,u=2*d.height,h=d.x-o/2,r=d.y-u/2,e.beginPath(),a=o/2*.5522848,p=u/2*.5522848,s=h+o,l=r+u,o=h+o/2,u=r+u/2,e.moveTo(h,u),e.bezierCurveTo(h,u-p,o-a,r,o,r),e.bezierCurveTo(o+a,r,s,u-p,s,u),e.bezierCurveTo(s,u+p,o+a,l,o,l),e.bezierCurveTo(o-a,l,h,u+p,h,u),e.closePath(),c.fill&&(e.globalAlpha=c.fillAlpha*i,e.fillStyle="#"+("00000"+(0|_).toString(16)).substr(-6),e.fill()),c.lineWidth&&(e.globalAlpha=c.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|y).toString(16)).substr(-6),e.stroke())):c.type===PIXI.Graphics.RREC&&(a=d.x,l=d.y,p=d.width,h=d.height,u=d.radius,u=(d=Math.min(p,h)/2|0)<u?d:u,e.beginPath(),e.moveTo(a,l+u),e.lineTo(a,l+h-u),e.quadraticCurveTo(a,l+h,a+u,l+h),e.lineTo(a+p-u,l+h),e.quadraticCurveTo(a+p,l+h,a+p,l+h-u),e.lineTo(a+p,l+u),e.quadraticCurveTo(a+p,l,a+p-u,l),e.lineTo(a+u,l),e.quadraticCurveTo(a,l,a,l+u),e.closePath(),!c.fillColor&&0!==c.fillColor||(e.globalAlpha=c.fillAlpha*i,e.fillStyle="#"+("00000"+(0|_).toString(16)).substr(-6),e.fill()),c.lineWidth&&(e.globalAlpha=c.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|y).toString(16)).substr(-6),e.stroke()))}},PIXI.CanvasGraphics.renderGraphicsMask=function(t,e){var i=t.graphicsData.length;if(0!==i){e.beginPath();for(var n=0;n<i;n++){var r,s,o,a,l,p,h,u,c=t.graphicsData[n],d=c.shape;if(c.type===PIXI.Graphics.POLY){var _=d.points;e.moveTo(_[0],_[1]);for(var y=1;y<_.length/2;y++)e.lineTo(_[2*y],_[2*y+1]);_[0]===_[_.length-2]&&_[1]===_[_.length-1]&&e.closePath()}else c.type===PIXI.Graphics.RECT?(e.rect(d.x,d.y,d.width,d.height),e.closePath()):c.type===PIXI.Graphics.CIRC?(e.arc(d.x,d.y,d.radius,0,2*Math.PI),e.closePath()):c.type===PIXI.Graphics.ELIP?(s=(a=2*d.width)/2*.5522848,p=(u=2*d.height)/2*.5522848,o=(h=d.x-a/2)+a,l=(r=d.y-u/2)+u,a=h+a/2,u=r+u/2,e.moveTo(h,u),e.bezierCurveTo(h,u-p,a-s,r,a,r),e.bezierCurveTo(a+s,r,o,u-p,o,u),e.bezierCurveTo(o,u+p,a+s,l,a,l),e.bezierCurveTo(a-s,l,h,u+p,h,u),e.closePath()):c.type===PIXI.Graphics.RREC&&(l=d.x,p=d.y,h=d.width,u=d.height,c=d.radius,c=(d=Math.min(h,u)/2|0)<c?d:c,e.moveTo(l,p+c),e.lineTo(l,p+u-c),e.quadraticCurveTo(l,p+u,l+c,p+u),e.lineTo(l+h-c,p+u),e.quadraticCurveTo(l+h,p+u,l+h,p+u-c),e.lineTo(l+h,p+c),e.quadraticCurveTo(l+h,p,l+h-c,p),e.lineTo(l+c,p),e.quadraticCurveTo(l,p,l,p+c),e.closePath())}}},PIXI.CanvasGraphics.updateGraphicsTint=function(t){if(16777215!==t.tint)for(var e=(t.tint>>16&255)/255,i=(t.tint>>8&255)/255,n=(255&t.tint)/255,r=0;r<t.graphicsData.length;r++){var s=t.graphicsData[r],o=0|s.fillColor,a=0|s.lineColor;s._fillTint=((o>>16&255)/255*e*255<<16)+((o>>8&255)/255*i*255<<8)+(255&o)/255*n*255,s._lineTint=((a>>16&255)/255*e*255<<16)+((a>>8&255)/255*i*255<<8)+(255&a)/255*n*255}},U.Graphics=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this.type=U.GRAPHICS,this.physicsType=U.SPRITE,this.anchor=new U.Point,PIXI.Graphics.call(this),U.Component.Core.init.call(this,t,e,i,"",null)},U.Graphics.prototype=Object.create(PIXI.Graphics.prototype),U.Graphics.prototype.constructor=U.Graphics,U.Component.Core.install.call(U.Graphics.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]),U.Graphics.prototype.preUpdatePhysics=U.Component.PhysicsBody.preUpdate,U.Graphics.prototype.preUpdateLifeSpan=U.Component.LifeSpan.preUpdate,U.Graphics.prototype.preUpdateInWorld=U.Component.InWorld.preUpdate,U.Graphics.prototype.preUpdateCore=U.Component.Core.preUpdate,U.Graphics.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},U.Graphics.prototype.postUpdate=function(){U.Component.PhysicsBody.postUpdate.call(this),U.Component.FixedToCamera.postUpdate.call(this),this._boundsDirty&&(this.updateLocalBounds(),this._boundsDirty=!1);for(var t=0;t<this.children.length;t++)this.children[t].postUpdate()},U.Graphics.prototype.destroy=function(t){this.clear(),U.Component.Destroy.prototype.destroy.call(this,t)},U.Graphics.prototype.drawTriangle=function(t,e){void 0===e&&(e=!1);var i,n=new U.Polygon(t);e?(i=new U.Point(this.game.camera.x-t[0].x,this.game.camera.y-t[0].y),e=new U.Point(t[1].x-t[0].x,t[1].y-t[0].y),e=new U.Point(t[1].x-t[2].x,t[1].y-t[2].y).cross(e),0<i.dot(e)&&this.drawPolygon(n)):this.drawPolygon(n)},U.Graphics.prototype.drawTriangles=function(t,e,i){void 0===i&&(i=!1);var n,r=new U.Point,s=new U.Point,o=new U.Point,a=[];if(e)if(t[0]instanceof U.Point)for(n=0;n<e.length/3;n++)a.push(t[e[3*n]]),a.push(t[e[3*n+1]]),a.push(t[e[3*n+2]]),3===a.length&&(this.drawTriangle(a,i),a=[]);else for(n=0;n<e.length;n++)r.x=t[2*e[n]],r.y=t[2*e[n]+1],a.push(r.copyTo({})),3===a.length&&(this.drawTriangle(a,i),a=[]);else if(t[0]instanceof U.Point)for(n=0;n<t.length/3;n++)this.drawTriangle([t[3*n],t[3*n+1],t[3*n+2]],i);else for(n=0;n<t.length/6;n++)r.x=t[6*n+0],r.y=t[6*n+1],s.x=t[6*n+2],s.y=t[6*n+3],o.x=t[6*n+4],o.y=t[6*n+5],this.drawTriangle([r,s,o],i)},U.RenderTexture=function(t,e,i,n,r,s){void 0===n&&(n=""),void 0===r&&(r=U.scaleModes.DEFAULT),void 0===s&&(s=1),this.game=t,this.key=n,this.type=U.RENDERTEXTURE,this._tempMatrix=new PIXI.Matrix,PIXI.RenderTexture.call(this,e,i,this.game.renderer,r,s),this.render=U.RenderTexture.prototype.render},U.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype),U.RenderTexture.prototype.constructor=U.RenderTexture,U.RenderTexture.prototype.renderXY=function(t,e,i,n){t.updateTransform(),this._tempMatrix.copyFrom(t.worldTransform),this._tempMatrix.tx=e,this._tempMatrix.ty=i,this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(t,this._tempMatrix,n):this.renderCanvas(t,this._tempMatrix,n)},U.RenderTexture.prototype.renderRawXY=function(t,e,i,n){this._tempMatrix.identity().translate(e,i),this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(t,this._tempMatrix,n):this.renderCanvas(t,this._tempMatrix,n)},U.RenderTexture.prototype.render=function(t,e,i){null==e?this._tempMatrix.copyFrom(t.worldTransform):this._tempMatrix.copyFrom(e),this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(t,this._tempMatrix,i):this.renderCanvas(t,this._tempMatrix,i)},U.Text=function(t,e,i,n,r){e=e||0,i=i||0,n=null==n?"":n.toString(),r=U.Utils.extend({},r),this.type=U.TEXT,this.physicsType=U.SPRITE,this.padding=new U.Point,this.textBounds=null,this.canvas=PIXI.CanvasPool.create(this),this.context=this.canvas.getContext("2d"),this.colors=[],this.strokeColors=[],this.fontStyles=[],this.fontWeights=[],this.autoRound=!1,this.useAdvancedWrap=!1,this._res=t.renderer.resolution,this._text=n,this._fontComponents=null,this._lineSpacing=0,this._charCount=0,this._width=0,this._height=0,U.Sprite.call(this,t,e,i,PIXI.Texture.fromCanvas(this.canvas)),this.setStyle(r),""!==n&&this.updateText()},U.Text.prototype=Object.create(U.Sprite.prototype),U.Text.prototype.constructor=U.Text,U.Text.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},U.Text.prototype.update=function(){},U.Text.prototype.destroy=function(t){this.texture.destroy(!0),U.Component.Destroy.prototype.destroy.call(this,t)},U.Text.prototype.setShadow=function(t,e,i,n,r,s){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i="rgba(0, 0, 0, 1)"),void 0===n&&(n=0),void 0===r&&(r=!0),void 0===s&&(s=!0),this.style.shadowOffsetX=t,this.style.shadowOffsetY=e,this.style.shadowColor=i,this.style.shadowBlur=n,this.style.shadowStroke=r,this.style.shadowFill=s,this.dirty=!0,this},U.Text.prototype.setStyle=function(t,e){void 0===e&&(e=!1),(t=t||{}).font=t.font||"bold 20pt Arial",t.backgroundColor=t.backgroundColor||null,t.fill=t.fill||"black",t.align=t.align||"left",t.boundsAlignH=t.boundsAlignH||"left",t.boundsAlignV=t.boundsAlignV||"top",t.stroke=t.stroke||"black",t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.wordWrapWidth=t.wordWrapWidth||100,t.maxLines=t.maxLines||0,t.shadowOffsetX=t.shadowOffsetX||0,t.shadowOffsetY=t.shadowOffsetY||0,t.shadowColor=t.shadowColor||"rgba(0,0,0,0)",t.shadowBlur=t.shadowBlur||0,t.tabs=t.tabs||0;var i=this.fontToComponents(t.font);return t.fontStyle&&(i.fontStyle=t.fontStyle),t.fontVariant&&(i.fontVariant=t.fontVariant),t.fontWeight&&(i.fontWeight=t.fontWeight),t.fontSize&&("number"==typeof t.fontSize&&(t.fontSize=t.fontSize+"px"),i.fontSize=t.fontSize),this._fontComponents=i,t.font=this.componentsToFont(this._fontComponents),this.style=t,this.dirty=!0,e&&this.updateText(),this},U.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font;var t=this.text;this.style.wordWrap&&(t=this.runWordWrap(this.text));var e=t.split(/(?:\r\n|\r|\n)/),i=this.style.tabs,n=[],r=0,s=this.determineFontProperties(this.style.font),o=e.length;0<this.style.maxLines&&this.style.maxLines<e.length&&(o=this.style.maxLines);for(var a=this._charCount=0;a<o;a++){if(0===i){var l=this.style.strokeThickness+this.padding.x;l+=0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?this.measureLine(e[a]):this.context.measureText(e[a]).width,this.style.wordWrap&&(l-=this.context.measureText(" ").width)}else{var p=e[a].split(/(?:\t)/),l=this.padding.x+this.style.strokeThickness;if(Array.isArray(i))for(var h=0,u=0;u<p.length;u++){var c=0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?this.measureLine(p[u]):Math.ceil(this.context.measureText(p[u]).width);0<u&&(h+=i[u-1]),l=h+c}else for(u=0;u<p.length;u++)l+=0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?this.measureLine(p[u]):Math.ceil(this.context.measureText(p[u]).width),l+=this.game.math.snapToCeil(l,i)-l}n[a]=Math.ceil(l),r=Math.max(r,n[a])}this.canvas.width=r*this._res;var d,_,y=s.fontSize+this.style.strokeThickness+this.padding.y,t=y*o,f=this._lineSpacing;for(f<0&&Math.abs(f)>y&&(f=-y),0!==f&&(t+=0<f?f*e.length:f*(e.length-1)),this.canvas.height=t*this._res,this.context.scale(this._res,this._res),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.style.backgroundColor&&(this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.textBaseline="alphabetic",this.context.lineWidth=this.style.strokeThickness,this.context.lineCap="round",this.context.lineJoin="round",a=this._charCount=0;a<o;a++)d=this.style.strokeThickness/2,_=this.style.strokeThickness/2+a*y+s.ascent,0<a&&(_+=f*a),"right"===this.style.align?d+=r-n[a]:"center"===this.style.align&&(d+=(r-n[a])/2),this.autoRound&&(d=Math.round(d),_=Math.round(_)),0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?this.updateLine(e[a],d,_):(this.style.stroke&&this.style.strokeThickness&&(this.updateShadow(this.style.shadowStroke),0===i?this.context.strokeText(e[a],d,_):this.renderTabLine(e[a],d,_,!1)),this.style.fill&&(this.updateShadow(this.style.shadowFill),0===i?this.context.fillText(e[a],d,_):this.renderTabLine(e[a],d,_,!0)));this.updateTexture(),this.dirty=!1},U.Text.prototype.renderTabLine=function(t,e,i,n){var r=t.split(/(?:\t)/),s=this.style.tabs,o=0;if(Array.isArray(s))for(var a=0,l=0;l<r.length;l++)0<l&&(a+=s[l-1]),o=e+a,n?this.context.fillText(r[l],o,i):this.context.strokeText(r[l],o,i);else for(l=0;l<r.length;l++){var p=Math.ceil(this.context.measureText(r[l]).width),o=this.game.math.snapToCeil(e,s);n?this.context.fillText(r[l],o,i):this.context.strokeText(r[l],o,i),e=o+p}},U.Text.prototype.updateShadow=function(t){t?(this.context.shadowOffsetX=this.style.shadowOffsetX,this.context.shadowOffsetY=this.style.shadowOffsetY,this.context.shadowColor=this.style.shadowColor,this.context.shadowBlur=this.style.shadowBlur):(this.context.shadowOffsetX=0,this.context.shadowOffsetY=0,this.context.shadowColor=0,this.context.shadowBlur=0)},U.Text.prototype.measureLine=function(t){for(var e=0,i=0;i<t.length;i++){var n,r=t[i];(0<this.fontWeights.length||0<this.fontStyles.length)&&(n=this.fontToComponents(this.context.font),this.fontStyles[this._charCount]&&(n.fontStyle=this.fontStyles[this._charCount]),this.fontWeights[this._charCount]&&(n.fontWeight=this.fontWeights[this._charCount]),this.context.font=this.componentsToFont(n)),this.style.stroke&&this.style.strokeThickness&&(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),this.updateShadow(this.style.shadowStroke)),this.style.fill&&(this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount]),this.updateShadow(this.style.shadowFill)),e+=this.context.measureText(r).width,this._charCount++}return Math.ceil(e)},U.Text.prototype.updateLine=function(t,e,i){for(var n=0;n<t.length;n++){var r,s=t[n];(0<this.fontWeights.length||0<this.fontStyles.length)&&(r=this.fontToComponents(this.context.font),this.fontStyles[this._charCount]&&(r.fontStyle=this.fontStyles[this._charCount]),this.fontWeights[this._charCount]&&(r.fontWeight=this.fontWeights[this._charCount]),this.context.font=this.componentsToFont(r)),this.style.stroke&&this.style.strokeThickness&&(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),this.updateShadow(this.style.shadowStroke),this.context.strokeText(s,e,i)),this.style.fill&&(this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount]),this.updateShadow(this.style.shadowFill),this.context.fillText(s,e,i)),e+=this.context.measureText(s).width,this._charCount++}},U.Text.prototype.clearColors=function(){return this.colors=[],this.strokeColors=[],this.dirty=!0,this},U.Text.prototype.clearFontValues=function(){return this.fontStyles=[],this.fontWeights=[],this.dirty=!0,this},U.Text.prototype.addColor=function(t,e){return this.colors[e]=t,this.dirty=!0,this},U.Text.prototype.addStrokeColor=function(t,e){return this.strokeColors[e]=t,this.dirty=!0,this},U.Text.prototype.addFontStyle=function(t,e){return this.fontStyles[e]=t,this.dirty=!0,this},U.Text.prototype.addFontWeight=function(t,e){return this.fontWeights[e]=t,this.dirty=!0,this},U.Text.prototype.precalculateWordWrap=function(t){return this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font,this.runWordWrap(t).split(/(?:\r\n|\r|\n)/)},U.Text.prototype.runWordWrap=function(t){return this.useAdvancedWrap?this.advancedWordWrap(t):this.basicWordWrap(t)},U.Text.prototype.advancedWordWrap=function(t){for(var e=this.context,i=this.style.wordWrapWidth,n="",r=t.replace(/ +/gi," ").split(/\r?\n/gi),s=r.length,o=0;o<s;o++){var a="",l=(l=r[o]).replace(/^ *|\s*$/gi,"");if(e.measureText(l).width<i)n+=l+"\n";else{for(var p=i,h=l.split(" "),u=0;u<h.length;u++){var c=h[u],d=c+" ",_=e.measureText(d).width;if(p<_){if(0===u){for(var y=d;y.length&&(y=y.slice(0,-1),!((_=e.measureText(y).width)<=p)););if(!y.length)throw new Error("This text's wordWrapWidth setting is less than a single character!");var f=c.substr(y.length);h[u]=f,a+=y}f=h[u].length?u:u+1,f=h.slice(f).join(" ").replace(/[ \n]*$/gi,"");r[o+1]=f+" "+(r[o+1]||""),s=r.length;break}a+=d,p-=_}n+=a.replace(/[ \n]*$/gi,"")+"\n"}}return n.replace(/[\s|\n]*$/gi,"")},U.Text.prototype.basicWordWrap=function(t){for(var e="",i=t.split("\n"),n=0;n<i.length;n++){for(var r=this.style.wordWrapWidth,s=i[n].split(" "),o=0;o<s.length;o++){var a=this.context.measureText(s[o]).width,l=a+this.context.measureText(" ").width;r<l?(0<o&&(e+="\n"),e+=s[o]+" ",r=this.style.wordWrapWidth-a):(r-=l,e+=s[o]+" ")}n<i.length-1&&(e+="\n")}return e},U.Text.prototype.updateFont=function(t){t=this.componentsToFont(t);this.style.font!==t&&(this.style.font=t,this.dirty=!0,this.parent&&this.updateTransform())},U.Text.prototype.fontToComponents=function(t){var e=t.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);if(e){var i=e[5].trim();return/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(i)||/['",]/.exec(i)||(i="'"+i+"'"),{font:t,fontStyle:e[1]||"normal",fontVariant:e[2]||"normal",fontWeight:e[3]||"normal",fontSize:e[4]||"medium",fontFamily:i}}return console.warn("Phaser.Text - unparsable CSS font: "+t),{font:t}},U.Text.prototype.componentsToFont=function(t){var e=[],i=t.fontStyle;return i&&"normal"!==i&&e.push(i),(i=t.fontVariant)&&"normal"!==i&&e.push(i),(i=t.fontWeight)&&"normal"!==i&&e.push(i),(i=t.fontSize)&&"medium"!==i&&e.push(i),(i=t.fontFamily)&&e.push(i),e.length||e.push(t.font),e.join(" ")},U.Text.prototype.setText=function(t,e){return void 0===e&&(e=!1),this.text=t.toString()||"",e?this.updateText():this.dirty=!0,this},U.Text.prototype.parseList=function(t){if(!Array.isArray(t))return this;for(var e="",i=0;i<t.length;i++)Array.isArray(t[i])?(e+=t[i].join("\t"),i<t.length-1&&(e+="\n")):(e+=t[i],i<t.length-1&&(e+="\t"));return this.text=e,this.dirty=!0,this},U.Text.prototype.setTextBounds=function(t,e,i,n){return void 0===t?this.textBounds=null:(this.textBounds?this.textBounds.setTo(t,e,i,n):this.textBounds=new U.Rectangle(t,e,i,n),this.style.wordWrapWidth>i&&(this.style.wordWrapWidth=i)),this.updateTexture(),this},U.Text.prototype.updateTexture=function(){var t=this.texture.baseTexture,e=this.texture.crop,i=this.texture.frame,n=this.canvas.width,r=this.canvas.height;t.width=n,t.height=r,e.width=n,e.height=r,i.width=n,i.height=r,this.texture.width=n,this.texture.height=r,this._width=n,this._height=r,this.textBounds&&(e=this.textBounds.x,i=this.textBounds.y,"right"===this.style.boundsAlignH?e+=this.textBounds.width-this.canvas.width/this.resolution:"center"===this.style.boundsAlignH&&(e+=this.textBounds.halfWidth-this.canvas.width/this.resolution/2),"bottom"===this.style.boundsAlignV?i+=this.textBounds.height-this.canvas.height/this.resolution:"middle"===this.style.boundsAlignV&&(i+=this.textBounds.halfHeight-this.canvas.height/this.resolution/2),this.pivot.x=-e,this.pivot.y=-i),this.renderable=0!==n&&0!==r,this.texture.requiresReTint=!0,this.texture.baseTexture.dirty()},U.Text.prototype._renderWebGL=function(t){this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype._renderWebGL.call(this,t)},U.Text.prototype._renderCanvas=function(t){this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype._renderCanvas.call(this,t)},U.Text.prototype.determineFontProperties=function(t){var e=U.Text.fontPropertiesCache[t];if(!e){e={};var i=U.Text.fontPropertiesCanvas,n=U.Text.fontPropertiesContext;n.font=t;var r=Math.ceil(n.measureText("|MÃ‰q").width),s=2*(o=Math.ceil(n.measureText("|MÃ‰q").width)),o=1.4*o|0;if(i.width=r,i.height=s,n.fillStyle="#f00",n.fillRect(0,0,r,s),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText("|MÃ‰q",0,o),!n.getImageData(0,0,r,s))return e.ascent=o,e.descent=6+o,e.fontSize=e.ascent+e.descent,U.Text.fontPropertiesCache[t]=e;for(var a,l=n.getImageData(0,0,r,s).data,n=l.length,p=4*r,h=0,u=!1,c=0;c<o;c++){for(a=0;a<p;a+=4)if(255!==l[h+a]){u=!0;break}if(u)break;h+=p}for(e.ascent=o-c,h=n-p,u=!1,c=s;o<c;c--){for(a=0;a<p;a+=4)if(255!==l[h+a]){u=!0;break}if(u)break;h-=p}e.descent=c-o,e.descent+=6,e.fontSize=e.ascent+e.descent,U.Text.fontPropertiesCache[t]=e}return e},U.Text.prototype.getBounds=function(t){return this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype.getBounds.call(this,t)},Object.defineProperty(U.Text.prototype,"text",{get:function(){return this._text},set:function(t){t!==this._text&&(this._text=t.toString()||"",this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(U.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(t){t=t||"bold 20pt Arial",this._fontComponents=this.fontToComponents(t),this.updateFont(this._fontComponents)}}),Object.defineProperty(U.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(t){t=(t=t||"Arial").trim(),/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(t)||/['",]/.exec(t)||(t="'"+t+"'"),this._fontComponents.fontFamily=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(U.Text.prototype,"fontSize",{get:function(){var t=this._fontComponents.fontSize;return t&&/(?:^0$|px$)/.exec(t)?parseInt(t,10):t},set:function(t){"number"==typeof(t=t||"0")&&(t+="px"),this._fontComponents.fontSize=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(U.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(t){t=t||"normal",this._fontComponents.fontWeight=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(U.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(t){t=t||"normal",this._fontComponents.fontStyle=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(U.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(t){t=t||"normal",this._fontComponents.fontVariant=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(U.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(t){t!==this.style.fill&&(this.style.fill=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"align",{get:function(){return this.style.align},set:function(t){t!==this.style.align&&(this.style.align=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"resolution",{get:function(){return this._res},set:function(t){t!==this._res&&(this._res=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"tabs",{get:function(){return this.style.tabs},set:function(t){t!==this.style.tabs&&(this.style.tabs=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"boundsAlignH",{get:function(){return this.style.boundsAlignH},set:function(t){t!==this.style.boundsAlignH&&(this.style.boundsAlignH=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"boundsAlignV",{get:function(){return this.style.boundsAlignV},set:function(t){t!==this.style.boundsAlignV&&(this.style.boundsAlignV=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(t){t!==this.style.stroke&&(this.style.stroke=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(t){t!==this.style.strokeThickness&&(this.style.strokeThickness=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(t){t!==this.style.wordWrap&&(this.style.wordWrap=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(t){t!==this.style.wordWrapWidth&&(this.style.wordWrapWidth=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(t){t!==this._lineSpacing&&(this._lineSpacing=parseFloat(t),this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(U.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(t){t!==this.style.shadowOffsetX&&(this.style.shadowOffsetX=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(t){t!==this.style.shadowOffsetY&&(this.style.shadowOffsetY=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(t){t!==this.style.shadowColor&&(this.style.shadowColor=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(t){t!==this.style.shadowBlur&&(this.style.shadowBlur=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"shadowStroke",{get:function(){return this.style.shadowStroke},set:function(t){t!==this.style.shadowStroke&&(this.style.shadowStroke=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"shadowFill",{get:function(){return this.style.shadowFill},set:function(t){t!==this.style.shadowFill&&(this.style.shadowFill=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(U.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),U.Text.fontPropertiesCache={},U.Text.fontPropertiesCanvas=document.createElement("canvas"),U.Text.fontPropertiesContext=U.Text.fontPropertiesCanvas.getContext("2d"),U.BitmapText=function(t,e,i,n,r,s,o){e=e||0,i=i||0,n=n||"",r=r||"",s=s||32,o=o||"left",PIXI.DisplayObjectContainer.call(this),this.type=U.BITMAPTEXT,this.physicsType=U.SPRITE,this.textWidth=0,this.textHeight=0,this.anchor=new U.Point,this._prevAnchor=new U.Point,this._glyphs=[],this._maxWidth=0,this._text=r.toString()||"",this._data=t.cache.getBitmapFont(n),this._font=n,this._fontSize=s,this._align=o,this._tint=16777215,this.updateText(),this.dirty=!1,U.Component.Core.init.call(this,t,e,i,"",null)},U.BitmapText.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),U.BitmapText.prototype.constructor=U.BitmapText,U.Component.Core.install.call(U.BitmapText.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]),U.BitmapText.prototype.preUpdatePhysics=U.Component.PhysicsBody.preUpdate,U.BitmapText.prototype.preUpdateLifeSpan=U.Component.LifeSpan.preUpdate,U.BitmapText.prototype.preUpdateInWorld=U.Component.InWorld.preUpdate,U.BitmapText.prototype.preUpdateCore=U.Component.Core.preUpdate,U.BitmapText.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},U.BitmapText.prototype.postUpdate=function(){U.Component.PhysicsBody.postUpdate.call(this),U.Component.FixedToCamera.postUpdate.call(this),this.body&&this.body.type===U.Physics.ARCADE&&(this.textWidth===this.body.sourceWidth&&this.textHeight===this.body.sourceHeight||this.body.setSize(this.textWidth,this.textHeight))},U.BitmapText.prototype.setText=function(t){this.text=t},U.BitmapText.prototype.scanLine=function(t,e,i){for(var n=0,r=0,s=-1,o=0,a=null,l=0<this._maxWidth?this._maxWidth:null,p=[],h=0;h<i.length;h++){var u=h===i.length-1;if(/(?:\r\n|\r|\n)/.test(i.charAt(h)))return{width:r,text:i.substr(0,h),end:u,chars:p};var c,d=i.charCodeAt(h),_=t.chars[d];void 0===_&&(d=32,_=t.chars[d]);var y=a&&_.kerning[a]?_.kerning[a]:0;if(/(\s)/.test(i.charAt(h))&&(s=h,o=r),c=(y+_.texture.width+_.xOffset)*e,l&&l<=r+c&&-1<s)return{width:o||r,text:i.substr(0,h-(h-s)),end:u,chars:p};r+=(_.xAdvance+y)*e,p.push(n+(_.xOffset+y)*e),n+=(_.xAdvance+y)*e,a=d}return{width:r,text:i,end:u,chars:p}},U.BitmapText.prototype.cleanText=function(t,e){void 0===e&&(e="");var i=this._data.font;if(!i)return"";for(var n=t.replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),r=0;r<n.length;r++){for(var s="",o=n[r],a=0;a<o.length;a++)s=i.chars[o.charCodeAt(a)]?s.concat(o[a]):s.concat(e);n[r]=s}return n.join("\n")},U.BitmapText.prototype.updateText=function(){var t=this._data.font;if(t){var e=this.text,i=this._fontSize/t.size,n=[],r=0;this.textWidth=0;do{}while((h=this.scanLine(t,i,e)).y=r,n.push(h),h.width>this.textWidth&&(this.textWidth=h.width),r+=t.lineHeight*i,e=e.substr(h.text.length+1),!1===h.end);this.textHeight=r;for(var s=0,o=0,a=this.textWidth*this.anchor.x,l=this.textHeight*this.anchor.y,p=0;p<n.length;p++){var h=n[p];"right"===this._align?o=this.textWidth-h.width:"center"===this._align&&(o=(this.textWidth-h.width)/2);for(var u=0;u<h.text.length;u++){var c=h.text.charCodeAt(u),d=t.chars[c];void 0===d&&(c=32,d=t.chars[32]);c=this._glyphs[s];c?c.texture=d.texture:((c=new PIXI.Sprite(d.texture)).name=h.text[u],this._glyphs.push(c)),c.position.x=h.chars[u]+o-a,c.position.y=h.y+d.yOffset*i-l,c.scale.set(i),c.tint=this.tint,c.texture.requiresReTint=!0,c.parent||this.addChild(c),s++}}for(p=s;p<this._glyphs.length;p++)this.removeChild(this._glyphs[p])}},U.BitmapText.prototype.purgeGlyphs=function(){for(var t=this._glyphs.length,e=[],i=0;i<this._glyphs.length;i++)this._glyphs[i].parent!==this?this._glyphs[i].destroy():e.push(this._glyphs[i]);return this._glyphs=[],this._glyphs=e,this.updateText(),t-e.length},U.BitmapText.prototype.updateTransform=function(){!this.dirty&&this.anchor.equals(this._prevAnchor)||(this.updateText(),this.dirty=!1,this._prevAnchor.copyFrom(this.anchor)),PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)},Object.defineProperty(U.BitmapText.prototype,"align",{get:function(){return this._align},set:function(t){t===this._align||"left"!==t&&"center"!==t&&"right"!==t||(this._align=t,this.updateText())}}),Object.defineProperty(U.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(t){t!==this._tint&&(this._tint=t,this.updateText())}}),Object.defineProperty(U.BitmapText.prototype,"font",{get:function(){return this._font},set:function(t){t!==this._font&&(this._font=t.trim(),this._data=this.game.cache.getBitmapFont(this._font),this.updateText())}}),Object.defineProperty(U.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){(t=parseInt(t,10))!==this._fontSize&&0<t&&(this._fontSize=t,this.updateText())}}),Object.defineProperty(U.BitmapText.prototype,"text",{get:function(){return this._text},set:function(t){t!==this._text&&(this._text=t.toString()||"",this.updateText())}}),Object.defineProperty(U.BitmapText.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){t!==this._maxWidth&&(this._maxWidth=t,this.updateText())}}),Object.defineProperty(U.BitmapText.prototype,"smoothed",{get:function(){return!this._data.base.scaleMode},set:function(t){this._data.base.scaleMode=t?0:1}}),U.RetroFont=function(t,e,i,n,r,s,o,a,l,p){if(!t.cache.checkImageKey(e))return!1;null!=s||(s=t.cache.getImage(e).width/i),this.characterWidth=i,this.characterHeight=n,this.characterSpacingX=o||0,this.characterSpacingY=a||0,this.characterPerRow=s,this.offsetX=l||0,this.offsetY=p||0,this.align="left",this.multiLine=!1,this.autoUpperCase=!0,this.customSpacingX=0,this.customSpacingY=0,this.fixedWidth=0,this.fontSet=t.cache.getImage(e),this._text="",this.grabData=[],this.frameData=new U.FrameData;for(var h=this.offsetX,u=this.offsetY,c=0,d=0;d<r.length;d++){var _=this.frameData.addFrame(new U.Frame(d,h,u,this.characterWidth,this.characterHeight));this.grabData[r.charCodeAt(d)]=_.index,++c===this.characterPerRow?(c=0,h=this.offsetX,u+=this.characterHeight+this.characterSpacingY):h+=this.characterWidth+this.characterSpacingX}t.cache.updateFrameData(e,this.frameData),this.stamp=new U.Image(t,0,0,e,0),U.RenderTexture.call(this,t,100,100,"",U.scaleModes.NEAREST),this.type=U.RETROFONT},U.RetroFont.prototype=Object.create(U.RenderTexture.prototype),U.RetroFont.prototype.constructor=U.RetroFont,U.RetroFont.ALIGN_LEFT="left",U.RetroFont.ALIGN_RIGHT="right",U.RetroFont.ALIGN_CENTER="center",U.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",U.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ",U.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ",U.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789",U.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789",U.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ",U.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39",U.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ",U.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!",U.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ",U.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789",U.RetroFont.prototype.setFixedWidth=function(t,e){void 0===e&&(e="left"),this.fixedWidth=t,this.align=e},U.RetroFont.prototype.setText=function(t,e,i,n,r,s){this.multiLine=e||!1,this.customSpacingX=i||0,this.customSpacingY=n||0,this.align=r||"left",this.autoUpperCase=!s,0<t.length&&(this.text=t)},U.RetroFont.prototype.buildRetroFontText=function(){var t=0,e=0;if(this.clear(),this.multiLine){var i=this._text.split("\n");0<this.fixedWidth?this.resize(this.fixedWidth,i.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0):this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),i.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0);for(var n=0;n<i.length;n++)t=0,this.align===U.RetroFont.ALIGN_RIGHT?t=this.width-i[n].length*(this.characterWidth+this.customSpacingX):this.align===U.RetroFont.ALIGN_CENTER&&(t=this.width/2-i[n].length*(this.characterWidth+this.customSpacingX)/2,t+=this.customSpacingX/2),t<0&&(t=0),this.pasteLine(i[n],t,e,this.customSpacingX),e+=this.characterHeight+this.customSpacingY}else 0<this.fixedWidth?this.resize(this.fixedWidth,this.characterHeight,!0):this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,!0),t=0,this.align===U.RetroFont.ALIGN_RIGHT?t=this.width-this._text.length*(this.characterWidth+this.customSpacingX):this.align===U.RetroFont.ALIGN_CENTER&&(t=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/2,t+=this.customSpacingX/2),t<0&&(t=0),this.pasteLine(this._text,t,0,this.customSpacingX);this.requiresReTint=!0},U.RetroFont.prototype.pasteLine=function(t,e,i,n){for(var r=0;r<t.length;r++)if(" "===t.charAt(r))e+=this.characterWidth+n;else if(0<=this.grabData[t.charCodeAt(r)]&&(this.stamp.frame=this.grabData[t.charCodeAt(r)],this.renderXY(this.stamp,e,i,!1),(e+=this.characterWidth+n)>this.width))break},U.RetroFont.prototype.getLongestLine=function(){var t=0;if(0<this._text.length)for(var e=this._text.split("\n"),i=0;i<e.length;i++)e[i].length>t&&(t=e[i].length);return t},U.RetroFont.prototype.removeUnsupportedCharacters=function(t){for(var e="",i=0;i<this._text.length;i++){var n=this._text[i],r=n.charCodeAt(0);(0<=this.grabData[r]||!t&&"\n"===n)&&(e=e.concat(n))}return e},U.RetroFont.prototype.updateOffset=function(t,e){if(this.offsetX!==t||this.offsetY!==e){for(var i=t-this.offsetX,n=e-this.offsetY,r=this.game.cache.getFrameData(this.stamp.key).getFrames(),s=r.length;s--;)r[s].x+=i,r[s].y+=n;this.buildRetroFontText()}},Object.defineProperty(U.RetroFont.prototype,"text",{get:function(){return this._text},set:function(t){t=this.autoUpperCase?t.toUpperCase():t;t!==this._text&&(this._text=t,this.removeUnsupportedCharacters(this.multiLine),this.buildRetroFontText())}}),Object.defineProperty(U.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(t){this.stamp.smoothed=t,this.buildRetroFontText()}}),U.Rope=function(t,e,i,n,r,s){this.points=[],this.points=s,this._hasUpdateAnimation=!1,this._updateAnimationCallback=null,e=e||0,i=i||0,n=n||null,r=r||null,this.type=U.ROPE,PIXI.Rope.call(this,U.Cache.DEFAULT,this.points),U.Component.Core.init.call(this,t,e,i,n,r)},U.Rope.prototype=Object.create(PIXI.Rope.prototype),U.Rope.prototype.constructor=U.Rope,U.Component.Core.install.call(U.Rope.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]),U.Rope.prototype.preUpdatePhysics=U.Component.PhysicsBody.preUpdate,U.Rope.prototype.preUpdateLifeSpan=U.Component.LifeSpan.preUpdate,U.Rope.prototype.preUpdateInWorld=U.Component.InWorld.preUpdate,U.Rope.prototype.preUpdateCore=U.Component.Core.preUpdate,U.Rope.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},U.Rope.prototype.update=function(){this._hasUpdateAnimation&&this.updateAnimation.call(this)},U.Rope.prototype.reset=function(t,e){return U.Component.Reset.prototype.reset.call(this,t,e),this},Object.defineProperty(U.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(t){t&&"function"==typeof t?(this._hasUpdateAnimation=!0,this._updateAnimation=t):(this._hasUpdateAnimation=!1,this._updateAnimation=null)}}),Object.defineProperty(U.Rope.prototype,"segments",{get:function(){for(var t,e,i,n,r=[],s=0;s<this.points.length;s++)n=4*s,t=this.vertices[n]*this.scale.x,e=this.vertices[1+n]*this.scale.y,i=this.vertices[4+n]*this.scale.x,n=this.vertices[3+n]*this.scale.y,i=U.Math.difference(t,i),n=U.Math.difference(e,n),t+=this.world.x,e+=this.world.y,n=new U.Rectangle(t,e,i,n),r.push(n);return r}}),U.TileSprite=function(t,e,i,n,r,s,o){e=e||0,i=i||0,n=n||256,r=r||256,s=s||null,o=o||null,this.type=U.TILESPRITE,this.physicsType=U.SPRITE,this._scroll=new U.Point;var a=t.cache.getImage("__default",!0);PIXI.TilingSprite.call(this,new PIXI.Texture(a.base),n,r),U.Component.Core.init.call(this,t,e,i,s,o)},U.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype),U.TileSprite.prototype.constructor=U.TileSprite,U.Component.Core.install.call(U.TileSprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","Smoothed"]),U.TileSprite.prototype.preUpdatePhysics=U.Component.PhysicsBody.preUpdate,U.TileSprite.prototype.preUpdateLifeSpan=U.Component.LifeSpan.preUpdate,U.TileSprite.prototype.preUpdateInWorld=U.Component.InWorld.preUpdate,U.TileSprite.prototype.preUpdateCore=U.Component.Core.preUpdate,U.TileSprite.prototype.preUpdate=function(){return 0!==this._scroll.x&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed),0!==this._scroll.y&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed),!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},U.TileSprite.prototype.autoScroll=function(t,e){this._scroll.set(t,e)},U.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0)},U.TileSprite.prototype.destroy=function(t){U.Component.Destroy.prototype.destroy.call(this,t),PIXI.TilingSprite.prototype.destroy.call(this)},U.TileSprite.prototype.reset=function(t,e){return U.Component.Reset.prototype.reset.call(this,t,e),this.tilePosition.x=0,this.tilePosition.y=0,this},U.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.iOSVersion=0,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.edge=!1,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.safariVersion=0,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.dolby=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},U.Device=new U.Device,U.Device.onInitialized=new U.Signal,U.Device.whenReady=function(t,e,i){var n=this._readyCheck;this.deviceReadyAt||!n?t.call(e,this):n._monitor||i?(n._queue=n._queue||[],n._queue.push([t,e])):(n._monitor=n.bind(this),n._queue=n._queue||[],n._queue.push([t,e]),t=void 0!==window.cordova,e=navigator.isCocoonJS,"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(n._monitor,0):t&&!e?document.addEventListener("deviceready",n._monitor,!1):(document.addEventListener("DOMContentLoaded",n._monitor,!1),window.addEventListener("load",n._monitor,!1)))},U.Device._readyCheck=function(){var t=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",t._monitor),document.removeEventListener("DOMContentLoaded",t._monitor),window.removeEventListener("load",t._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(;i=t._queue.shift();){var e=i[0],i=i[1];e.call(i,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(t._monitor,20)},U.Device._initialize=function(){var t,e,r=this;(function(){var t=navigator.userAgent;/Playstation Vita/.test(t)?r.vita=!0:/Kindle/.test(t)||/\bKF[A-Z][A-Z]+/.test(t)||/Silk.*Mobile Safari/.test(t)?r.kindle=!0:/Android/.test(t)?r.android=!0:/CrOS/.test(t)?r.chromeOS=!0:/iP[ao]d|iPhone/i.test(t)?(r.iOS=!0,navigator.appVersion.match(/OS (\d+)/),r.iOSVersion=parseInt(RegExp.$1,10)):/Linux/.test(t)?r.linux=!0:/Mac OS/.test(t)?r.macOS=!0:/Windows/.test(t)&&(r.windows=!0),(/Windows Phone/i.test(t)||/IEMobile/i.test(t))&&(r.android=!1,r.iOS=!1,r.macOS=!1,r.windows=!0,r.windowsPhone=!0);var e=/Silk/.test(t);(r.windows||r.macOS||r.linux&&!e||r.chromeOS)&&(r.desktop=!0),(r.windowsPhone||/Windows NT/i.test(t)&&/Touch/i.test(t))&&(r.desktop=!1)})(),function(){var t=navigator.userAgent;if(/Arora/.test(t)?r.arora=!0:/Edge\/\d+/.test(t)?r.edge=!0:/Chrome\/(\d+)/.test(t)&&!r.windowsPhone?(r.chrome=!0,r.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(t)?r.epiphany=!0:/Firefox\D+(\d+)/.test(t)?(r.firefox=!0,r.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(t)&&r.iOS?r.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(t)?(r.ie=!0,r.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(t)?r.midori=!0:/Opera/.test(t)?r.opera=!0:/Safari\/(\d+)/.test(t)&&!r.windowsPhone?(r.safari=!0,/Version\/(\d+)\./.test(t)&&(r.safariVersion=parseInt(RegExp.$1,10))):/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(t)&&(r.ie=!0,r.trident=!0,r.tridentVersion=parseInt(RegExp.$1,10),r.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(t)&&(r.silk=!0),navigator.standalone&&(r.webApp=!0),void 0!==window.cordova&&(r.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(r.node=!0),r.node&&"object"==typeof process.versions&&(r.nodeWebkit=!!process.versions["node-webkit"],r.electron=!!process.versions.electron),navigator.isCocoonJS&&(r.cocoonJS=!0),r.cocoonJS)try{r.cocoonJSApp="undefined"!=typeof CocoonJS}catch(t){r.cocoonJSApp=!1}void 0!==window.ejecta&&(r.ejecta=!0),/Crosswalk/.test(t)&&(r.crosswalk=!0)}(),function(){r.audioData=!!window.Audio,r.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var t,e,i=document.createElement("audio");try{!!i.canPlayType&&(i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(r.ogg=!0),(i.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||i.canPlayType("audio/opus;").replace(/^no$/,""))&&(r.opus=!0),i.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(r.mp3=!0),i.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(r.wav=!0),(i.canPlayType("audio/x-m4a;")||i.canPlayType("audio/aac;").replace(/^no$/,""))&&(r.m4a=!0),i.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(r.webm=!0),""!==i.canPlayType('audio/mp4;codecs="ec-3"'))&&(r.edge?r.dolby=!0:r.safari&&9<=r.safariVersion&&/Mac OS X (\d+)_(\d+)/.test(navigator.userAgent)&&(t=parseInt(RegExp.$1,10),e=parseInt(RegExp.$2,10),(10===t&&11<=e||10<t)&&(r.dolby=!0)))}catch(i){}}(),function(){var t=document.createElement("video");try{!!t.canPlayType&&(t.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(r.oggVideo=!0),t.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(r.h264Video=!0,r.mp4Video=!0),t.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(r.webmVideo=!0),t.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(r.vp9Video=!0),t.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(r.hlsVideo=!0))}catch(t){}}(),function(){var t,e,i=document.createElement("p"),n={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};for(e in document.body.insertBefore(i,null),n)void 0!==i.style[e]&&(i.style[e]="translate3d(1px,1px,1px)",t=window.getComputedStyle(i).getPropertyValue(n[e]));document.body.removeChild(i),r.css3D=void 0!==t&&0<t.length&&"none"!==t}(),r.pixelRatio=window.devicePixelRatio||1,r.iPhone=-1!==navigator.userAgent.toLowerCase().indexOf("iphone"),r.iPhone4=2===r.pixelRatio&&r.iPhone,r.iPad=-1!==navigator.userAgent.toLowerCase().indexOf("ipad"),"undefined"!=typeof Int8Array?r.typedArray=!0:r.typedArray=!1,"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint32Array&&(r.littleEndian=(t=new ArrayBuffer(4),e=new Uint8Array(t),t=new Uint32Array(t),e[0]=161,e[1]=178,e[2]=195,e[3]=212,3569595041===t[0]||2712847316!==t[0]&&null),r.LITTLE_ENDIAN=r.littleEndian),r.support32bit="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof Int32Array&&null!==r.littleEndian&&function(){if(void 0===Uint8ClampedArray)return!1;var t=PIXI.CanvasPool.create(this,1,1).getContext("2d");return!!t&&(t=t.createImageData(1,1),PIXI.CanvasPool.remove(this),t.data instanceof Uint8ClampedArray)}(),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(r.vibration=!0),function(){r.canvas=!!window.CanvasRenderingContext2D||r.cocoonJS;try{r.localStorage=!!localStorage.getItem}catch(t){r.localStorage=!1}r.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),r.fileSystem=!!window.requestFileSystem,r.webGL=function(){try{var t=document.createElement("canvas");return t.screencanvas=!1,!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(t){return!1}}(),r.webGL=!!r.webGL,r.worker=!!window.Worker,r.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,r.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,r.getUserMedia=r.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,r.firefox&&r.firefoxVersion<21&&(r.getUserMedia=!1),!r.iOS&&(r.ie||r.firefox||r.chrome)&&(r.canvasBitBltShift=!0),(r.safari||r.mobileSafari)&&(r.canvasBitBltShift=!1)}(),function(){for(var t=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],e=document.createElement("div"),i=0;i<t.length;i++)if(e[t[i]]){r.fullscreen=!0,r.requestFullscreen=t[i];break}var n=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(r.fullscreen)for(i=0;i<n.length;i++)if(document[n[i]]){r.cancelFullscreen=n[i];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(r.fullscreenKeyboard=!0)}(),("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&1<=window.navigator.maxTouchPoints)&&(r.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(r.mspointer=!0),r.cocoonJS||("onwheel"in window||r.ie&&"WheelEvent"in window?r.wheelEvent="wheel":"onmousewheel"in window?r.wheelEvent="mousewheel":r.firefox&&"MouseScrollEvent"in window&&(r.wheelEvent="DOMMouseScroll"))},U.Device.canPlayAudio=function(t){return!!("mp3"===t&&this.mp3||"ogg"===t&&(this.ogg||this.opus)||"m4a"===t&&this.m4a||"opus"===t&&this.opus||"wav"===t&&this.wav||"webm"===t&&this.webm||"mp4"===t&&this.dolby)},U.Device.canPlayVideo=function(t){return!!("webm"===t&&(this.webmVideo||this.vp9Video)||"mp4"===t&&(this.mp4Video||this.h264Video)||("ogg"===t||"ogv"===t)&&this.oggVideo||"mpeg"===t&&this.hlsVideo)},U.Device.isConsoleOpen=function(){return!(!window.console||!window.console.firebug)||!(!window.console||(console.profile(),console.profileEnd(),console.clear&&console.clear(),!console.profiles))&&0<console.profiles.length},U.Device.isAndroidStockBrowser=function(){var t=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return t&&t[1]<537},U.Canvas={create:function(t,e,i,n,r){e=e||256,i=i||256;t=r?document.createElement("canvas"):PIXI.CanvasPool.create(t,e,i);return"string"==typeof n&&""!==n&&(t.id=n),t.width=e,t.height=i,t.style.display="block",t},setBackgroundColor:function(t,e){return e=e||"rgb(0,0,0)",t.style.backgroundColor=e,t},setTouchAction:function(t,e){return e=e||"none",t.style.msTouchAction=e,t.style["ms-touch-action"]=e,t.style["touch-action"]=e,t},setUserSelect:function(t,e){return e=e||"none",t.style["-webkit-touch-callout"]=e,t.style["-webkit-user-select"]=e,t.style["-khtml-user-select"]=e,t.style["-moz-user-select"]=e,t.style["-ms-user-select"]=e,t.style["user-select"]=e,t.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",t},addToDOM:function(t,e,i){var n;return void 0===i&&(i=!0),e&&("string"==typeof e?n=document.getElementById(e):"object"==typeof e&&1===e.nodeType&&(n=e)),n=n||document.body,i&&n.style&&(n.style.overflow="hidden"),n.appendChild(t),t},removeFromDOM:function(t){t.parentNode&&t.parentNode.removeChild(t)},setTransform:function(t,e,i,n,r,s,o){return t.setTransform(n,s,o,r,e,i),t},setSmoothingEnabled:function(t,e){var i=U.Canvas.getSmoothingPrefix(t);return i&&(t[i]=e),t},getSmoothingPrefix:function(t){var e,i=["i","webkitI","msI","mozI","oI"];for(e in i){var n=i[e]+"mageSmoothingEnabled";if(n in t)return n}return null},getSmoothingEnabled:function(t){var e=U.Canvas.getSmoothingPrefix(t);if(e)return t[e]},setImageRenderingCrisp:function(t){for(var e=["optimizeSpeed","crisp-edges","-moz-crisp-edges","-webkit-optimize-contrast","optimize-contrast","pixelated"],i=0;i<e.length;i++)t.style["image-rendering"]=e[i];return t.style.msInterpolationMode="nearest-neighbor",t},setImageRenderingBicubic:function(t){return t.style["image-rendering"]="auto",t.style.msInterpolationMode="bicubic",t}},U.RequestAnimationFrame=function(t,e){void 0===e&&(e=!1),this.game=t,this.isRunning=!1,this.forceSetTimeOut=e;for(var i=["ms","moz","webkit","o"],n=0;n<i.length&&!window.requestAnimationFrame;n++)window.requestAnimationFrame=window[i[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[i[n]+"CancelAnimationFrame"];this._isSetTimeOut=!1,this._onLoop=null,this._timeOutID=null},U.RequestAnimationFrame.prototype={start:function(){this.isRunning=!0;var e=this;!window.requestAnimationFrame||this.forceSetTimeOut?(this._isSetTimeOut=!0,this._onLoop=function(){return e.updateSetTimeout()},this._timeOutID=window.setTimeout(this._onLoop,0)):(this._isSetTimeOut=!1,this._onLoop=function(t){return e.updateRAF(t)},this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateRAF:function(t){this.isRunning&&(this.game.update(Math.floor(t)),this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateSetTimeout:function(){this.isRunning&&(this.game.update(Date.now()),this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall))},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame(this._timeOutID),this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return!1===this._isSetTimeOut}},U.RequestAnimationFrame.prototype.constructor=U.RequestAnimationFrame,U.Math={PI2:2*Math.PI,between:function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},fuzzyEqual:function(t,e,i){return void 0===i&&(i=1e-4),Math.abs(t-e)<i},fuzzyLessThan:function(t,e,i){return void 0===i&&(i=1e-4),t<e+i},fuzzyGreaterThan:function(t,e,i){return void 0===i&&(i=1e-4),e-i<t},fuzzyCeil:function(t,e){return void 0===e&&(e=1e-4),Math.ceil(t-e)},fuzzyFloor:function(t,e){return void 0===e&&(e=1e-4),Math.floor(t+e)},average:function(){for(var t=0,e=arguments.length,i=0;i<e;i++)t+=+arguments[i];return t/e},shear:function(t){return t%1},snapTo:function(t,e,i){return void 0===i&&(i=0),0===e?t:(t-=i,i+(t=e*Math.round(t/e)))},snapToFloor:function(t,e,i){return void 0===i&&(i=0),0===e?t:(t-=i,i+(t=e*Math.floor(t/e)))},snapToCeil:function(t,e,i){return void 0===i&&(i=0),0===e?t:(t-=i,i+(t=e*Math.ceil(t/e)))},roundTo:function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=10);e=Math.pow(i,-e);return Math.round(t*e)/e},floorTo:function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=10);e=Math.pow(i,-e);return Math.floor(t*e)/e},ceilTo:function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=10);e=Math.pow(i,-e);return Math.ceil(t*e)/e},rotateToAngle:function(t,e,i){return void 0===i&&(i=.05),t===e||(Math.abs(e-t)<=i||Math.abs(e-t)>=U.Math.PI2-i?t=e:(Math.abs(e-t)>Math.PI&&(e<t?e+=U.Math.PI2:e-=U.Math.PI2),t<e?t+=i:e<t&&(t-=i))),t},getShortestAngle:function(t,e){t=e-t;return 0==t?0:t-360*Math.floor((t+180)/360)},angleBetween:function(t,e,i,n){return Math.atan2(n-e,i-t)},angleBetweenY:function(t,e,i,n){return Math.atan2(i-t,n-e)},angleBetweenPoints:function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},angleBetweenPointsY:function(t,e){return Math.atan2(e.x-t.x,e.y-t.y)},reverseAngle:function(t){return this.normalizeAngle(t+Math.PI,!0)},normalizeAngle:function(t){return 0<=(t%=2*Math.PI)?t:t+2*Math.PI},maxAdd:function(t,e,i){return Math.min(t+e,i)},minSub:function(t,e,i){return Math.max(t-e,i)},wrap:function(t,e,i){i-=e;if(i<=0)return 0;t=(t-e)%i;return t<0&&(t+=i),t+e},wrapValue:function(t,e,i){return((t=Math.abs(t))+(e=Math.abs(e)))%(i=Math.abs(i))},isOdd:function(t){return!!(1&t)},isEven:function(t){return!(1&t)},min:function(){for(var t,e=1,i=0,n=(t=1===arguments.length&&"object"==typeof arguments[0]?arguments[0]:arguments).length;e<n;e++)t[e]<t[i]&&(i=e);return t[i]},max:function(){for(var t,e=1,i=0,n=(t=1===arguments.length&&"object"==typeof arguments[0]?arguments[0]:arguments).length;e<n;e++)t[e]>t[i]&&(i=e);return t[i]},minProperty:function(t){for(var e,i=1,n=0,r=(e=2===arguments.length&&"object"==typeof arguments[1]?arguments[1]:arguments.slice(1)).length;i<r;i++)e[i][t]<e[n][t]&&(n=i);return e[n][t]},maxProperty:function(t){for(var e,i=1,n=0,r=(e=2===arguments.length&&"object"==typeof arguments[1]?arguments[1]:arguments.slice(1)).length;i<r;i++)e[i][t]>e[n][t]&&(n=i);return e[n][t]},wrapAngle:function(t,e){return e?this.wrap(t,-Math.PI,Math.PI):this.wrap(t,-180,180)},linearInterpolation:function(t,e){var i=t.length-1,n=i*e,r=Math.floor(n);return e<0?this.linear(t[0],t[1],n):1<e?this.linear(t[i],t[i-1],i-n):this.linear(t[r],t[i<r+1?i:r+1],n-r)},bezierInterpolation:function(t,e){for(var i=0,n=t.length-1,r=0;r<=n;r++)i+=Math.pow(1-e,n-r)*Math.pow(e,r)*t[r]*this.bernstein(n,r);return i},catmullRomInterpolation:function(t,e){var i=t.length-1,n=i*e,r=Math.floor(n);return t[0]===t[i]?(e<0&&(r=Math.floor(n=i*(1+e))),this.catmullRom(t[(r-1+i)%i],t[r],t[(r+1)%i],t[(r+2)%i],n-r)):e<0?t[0]-(this.catmullRom(t[0],t[0],t[1],t[1],-n)-t[0]):1<e?t[i]-(this.catmullRom(t[i],t[i],t[i-1],t[i-1],n-i)-t[i]):this.catmullRom(t[r?r-1:0],t[r],t[i<r+1?i:r+1],t[i<r+2?i:r+2],n-r)},linear:function(t,e,i){return(e-t)*i+t},bernstein:function(t,e){return this.factorial(t)/this.factorial(e)/this.factorial(t-e)},factorial:function(t){if(0===t)return 1;for(var e=t;--t;)e*=t;return e},catmullRom:function(t,e,i,n,r){var s=.5*(i-t),t=.5*(n-e),n=r*r;return(2*e-2*i+s+t)*(r*n)+(-3*e+3*i-2*s-t)*n+s*r+e},difference:function(t,e){return Math.abs(t-e)},roundAwayFromZero:function(t){return 0<t?Math.ceil(t):Math.floor(t)},sinCosGenerator:function(t,e,i,n){void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n=1);for(var r=e,s=i,o=n*Math.PI/t,a=[],l=[],p=0;p<t;p++)r+=(s-=r*o)*o,a[p]=s,l[p]=r;return{sin:l,cos:a,length:t}},distance:function(t,e,i,n){i=t-i,n=e-n;return Math.sqrt(i*i+n*n)},distanceSq:function(t,e,i,n){i=t-i,n=e-n;return i*i+n*n},distancePow:function(t,e,i,n,r){return void 0===r&&(r=2),Math.sqrt(Math.pow(i-t,r)+Math.pow(n-e,r))},clamp:function(t,e,i){return t<e?e:i<t?i:t},clampBottom:function(t,e){return t<e?e:t},within:function(t,e,i){return Math.abs(t-e)<=i},mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},smoothstep:function(t,e,i){return(t=Math.max(0,Math.min(1,(t-e)/(i-e))))*t*(3-2*t)},smootherstep:function(t,e,i){return(t=Math.max(0,Math.min(1,(t-e)/(i-e))))*t*t*(t*(6*t-15)+10)},sign:function(t){return t<0?-1:0<t?1:0},percent:function(t,e,i){return void 0===i&&(i=0),e<t||e<i?1:t<i||t<i?0:(t-i)/e}};var o=Math.PI/180,a=180/Math.PI;return U.Math.degToRad=function(t){return t*o},U.Math.radToDeg=function(t){return t*a},U.RandomDataGenerator=function(t){void 0===t&&(t=[]),this.c=1,this.s0=0,this.s1=0,this.s2=0,"string"==typeof t?this.state(t):this.sow(t)},U.RandomDataGenerator.prototype={rnd:function(){var t=2091639*this.s0+2.3283064365386963e-10*this.c;return this.c=0|t,this.s0=this.s1,this.s1=this.s2,this.s2=t-this.c,this.s2},sow:function(t){if(this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1),this.c=1,t)for(var e=0;e<t.length&&null!=t[e];e++){var i=t[e];this.s0-=this.hash(i),this.s0+=~~(this.s0<0),this.s1-=this.hash(i),this.s1+=~~(this.s1<0),this.s2-=this.hash(i),this.s2+=~~(this.s2<0)}},hash:function(t){var e,i,n=4022871197;for(t=t.toString(),i=0;i<t.length;i++)e=.02519603282416938*(n+=t.charCodeAt(i)),e-=n=e>>>0,n=(e*=n)>>>0,n+=4294967296*(e-=n);return 2.3283064365386963e-10*(n>>>0)},integer:function(){return 4294967296*this.rnd.apply(this)},frac:function(){return this.rnd.apply(this)+11102230246251565e-32*(2097152*this.rnd.apply(this)|0)},real:function(){return this.integer()+this.frac()},integerInRange:function(t,e){return Math.floor(this.realInRange(0,e-t+1)+t)},between:function(t,e){return this.integerInRange(t,e)},realInRange:function(t,e){return this.frac()*(e-t)+t},normal:function(){return 1-2*this.frac()},uuid:function(){for(var t="",e="",e=t="";t++<36;e+=~t%5|3*t&4?(15^t?8^this.frac()*(20^t?16:4):4).toString(16):"-");return e},pick:function(t){return t[this.integerInRange(0,t.length-1)]},sign:function(){return this.pick([-1,1])},weightedPick:function(t){return t[~~(Math.pow(this.frac(),2)*(t.length-1)+.5)]},timestamp:function(t,e){return this.realInRange(t||9466848e5,e||1577862e6)},angle:function(){return this.integerInRange(-180,180)},state:function(t){return"string"==typeof t&&t.match(/^!rnd/)&&(t=t.split(","),this.c=parseFloat(t[1]),this.s0=parseFloat(t[2]),this.s1=parseFloat(t[3]),this.s2=parseFloat(t[4])),["!rnd",this.c,this.s0,this.s1,this.s2].join(",")}},U.RandomDataGenerator.prototype.constructor=U.RandomDataGenerator,U.QuadTree=function(t,e,i,n,r,s,o){this.maxObjects=10,this.maxLevels=4,this.level=0,this.bounds={},this.objects=[],this.nodes=[],this._empty=[],this.reset(t,e,i,n,r,s,o)},U.QuadTree.prototype={reset:function(t,e,i,n,r,s,o){this.maxObjects=r||10,this.maxLevels=s||4,this.level=o||0,this.bounds={x:Math.round(t),y:Math.round(e),width:i,height:n,subWidth:Math.floor(i/2),subHeight:Math.floor(n/2),right:Math.round(t)+Math.floor(i/2),bottom:Math.round(e)+Math.floor(n/2)},this.objects.length=0,this.nodes.length=0},populate:function(t){t.forEach(this.populateHandler,this,!0)},populateHandler:function(t){t.body&&t.exists&&this.insert(t.body)},split:function(){this.nodes[0]=new U.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[1]=new U.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[2]=new U.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[3]=new U.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1)},insert:function(t){var e,i=0;if(null==this.nodes[0]||-1===(e=this.getIndex(t))){if(this.objects.push(t),this.objects.length>this.maxObjects&&this.level<this.maxLevels)for(null==this.nodes[0]&&this.split();i<this.objects.length;)-1!==(e=this.getIndex(this.objects[i]))?this.nodes[e].insert(this.objects.splice(i,1)[0]):i++}else this.nodes[e].insert(t)},getIndex:function(t){var e=-1;return t.x<this.bounds.right&&t.right<this.bounds.right?t.y<this.bounds.bottom&&t.bottom<this.bounds.bottom?e=1:t.y>this.bounds.bottom&&(e=2):t.x>this.bounds.right&&(t.y<this.bounds.bottom&&t.bottom<this.bounds.bottom?e=0:t.y>this.bounds.bottom&&(e=3)),e},retrieve:function(t){if(t instanceof U.Rectangle)var e=this.objects,i=this.getIndex(t);else{if(!t.body)return this._empty;e=this.objects,i=this.getIndex(t.body)}return this.nodes[0]&&(e=-1!==i?e.concat(this.nodes[i].retrieve(t)):(e=(e=(e=e.concat(this.nodes[0].retrieve(t))).concat(this.nodes[1].retrieve(t))).concat(this.nodes[2].retrieve(t))).concat(this.nodes[3].retrieve(t))),e},clear:function(){this.objects.length=0;for(var t=this.nodes.length;t--;)this.nodes[t].clear(),this.nodes.splice(t,1);this.nodes.length=0}},U.QuadTree.prototype.constructor=U.QuadTree,U.Net=function(t){this.game=t},U.Net.prototype={getHostName:function(){return window.location&&window.location.hostname?window.location.hostname:null},checkDomainName:function(t){return-1!==window.location.hostname.indexOf(t)},updateQueryString:function(t,e,i,n){void 0===i&&(i=!1),void 0!==n&&""!==n||(n=window.location.href);var r,s="",o=new RegExp("([?|&])"+t+"=.*?(&|#|$)(.*)","gi"),s=o.test(n)?null!=e?n.replace(o,"$1"+t+"="+e+"$2$3"):n.replace(o,"$1$3").replace(/(&|\?)$/,""):(null!=e&&(r=-1!==n.indexOf("?")?"&":"?",n=(o=n.split("#"))[0]+r+t+"="+e,o[1]&&(n+="#"+o[1])),n);return i?void(window.location.href=s):s},getQueryString:function(t){void 0===t&&(t="");var e,i={},n=location.search.substring(1).split("&");for(e in n){var r=n[e].split("=");if(1<r.length){if(t&&t===this.decodeURI(r[0]))return this.decodeURI(r[1]);i[this.decodeURI(r[0])]=this.decodeURI(r[1])}}return i},decodeURI:function(t){return decodeURIComponent(t.replace(/\+/g," "))}},U.Net.prototype.constructor=U.Net,U.TweenManager=function(t){this.game=t,this.frameBased=!1,this._tweens=[],this._add=[],this.easeMap={Power0:U.Easing.Power0,Power1:U.Easing.Power1,Power2:U.Easing.Power2,Power3:U.Easing.Power3,Power4:U.Easing.Power4,Linear:U.Easing.Linear.None,Quad:U.Easing.Quadratic.Out,Cubic:U.Easing.Cubic.Out,Quart:U.Easing.Quartic.Out,Quint:U.Easing.Quintic.Out,Sine:U.Easing.Sinusoidal.Out,Expo:U.Easing.Exponential.Out,Circ:U.Easing.Circular.Out,Elastic:U.Easing.Elastic.Out,Back:U.Easing.Back.Out,Bounce:U.Easing.Bounce.Out,"Quad.easeIn":U.Easing.Quadratic.In,"Cubic.easeIn":U.Easing.Cubic.In,"Quart.easeIn":U.Easing.Quartic.In,"Quint.easeIn":U.Easing.Quintic.In,"Sine.easeIn":U.Easing.Sinusoidal.In,"Expo.easeIn":U.Easing.Exponential.In,"Circ.easeIn":U.Easing.Circular.In,"Elastic.easeIn":U.Easing.Elastic.In,"Back.easeIn":U.Easing.Back.In,"Bounce.easeIn":U.Easing.Bounce.In,"Quad.easeOut":U.Easing.Quadratic.Out,"Cubic.easeOut":U.Easing.Cubic.Out,"Quart.easeOut":U.Easing.Quartic.Out,"Quint.easeOut":U.Easing.Quintic.Out,"Sine.easeOut":U.Easing.Sinusoidal.Out,"Expo.easeOut":U.Easing.Exponential.Out,"Circ.easeOut":U.Easing.Circular.Out,"Elastic.easeOut":U.Easing.Elastic.Out,"Back.easeOut":U.Easing.Back.Out,"Bounce.easeOut":U.Easing.Bounce.Out,"Quad.easeInOut":U.Easing.Quadratic.InOut,"Cubic.easeInOut":U.Easing.Cubic.InOut,"Quart.easeInOut":U.Easing.Quartic.InOut,"Quint.easeInOut":U.Easing.Quintic.InOut,"Sine.easeInOut":U.Easing.Sinusoidal.InOut,"Expo.easeInOut":U.Easing.Exponential.InOut,"Circ.easeInOut":U.Easing.Circular.InOut,"Elastic.easeInOut":U.Easing.Elastic.InOut,"Back.easeInOut":U.Easing.Back.InOut,"Bounce.easeInOut":U.Easing.Bounce.InOut},this.game.onPause.add(this._pauseAll,this),this.game.onResume.add(this._resumeAll,this)},U.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var t=0;t<this._tweens.length;t++)this._tweens[t].pendingDelete=!0;this._add=[]},removeFrom:function(t,e){if(void 0===e&&(e=!0),Array.isArray(t))for(i=0,n=t.length;i<n;i++)this.removeFrom(t[i]);else if(t.type===U.GROUP&&e)for(var i=0,n=t.children.length;i<n;i++)this.removeFrom(t.children[i]);else{for(i=0,n=this._tweens.length;i<n;i++)t===this._tweens[i].target&&this.remove(this._tweens[i]);for(i=0,n=this._add.length;i<n;i++)t===this._add[i].target&&this.remove(this._add[i])}},add:function(t){(t._manager=this)._add.push(t)},create:function(t){return new U.Tween(t,this.game,this)},remove:function(t){var e=this._tweens.indexOf(t);-1!==e?this._tweens[e].pendingDelete=!0:-1!==(e=this._add.indexOf(t))&&(this._add[e].pendingDelete=!0)},update:function(){var t=this._add.length,e=this._tweens.length;if(0===e&&0===t)return!1;for(var i=0;i<e;)this._tweens[i].update(this.game.time.time)?i++:(this._tweens.splice(i,1),e--);return 0<t&&(this._tweens=this._tweens.concat(this._add),this._add.length=0),!0},isTweening:function(e){return this._tweens.some(function(t){return t.target===e})},_pauseAll:function(){for(var t=this._tweens.length-1;0<=t;t--)this._tweens[t]._pause()},_resumeAll:function(){for(var t=this._tweens.length-1;0<=t;t--)this._tweens[t]._resume()},pauseAll:function(){for(var t=this._tweens.length-1;0<=t;t--)this._tweens[t].pause()},resumeAll:function(){for(var t=this._tweens.length-1;0<=t;t--)this._tweens[t].resume(!0)}},U.TweenManager.prototype.constructor=U.TweenManager,U.Tween=function(t,e,i){this.game=e,this.target=t,this.manager=i,this.timeline=[],this.reverse=!1,this.timeScale=1,this.repeatCounter=0,this.pendingDelete=!1,this.onStart=new U.Signal,this.onLoop=new U.Signal,this.onRepeat=new U.Signal,this.onChildComplete=new U.Signal,this.onComplete=new U.Signal,this.isRunning=!1,this.current=0,this.properties={},this.chainedTween=null,this.isPaused=!1,this.frameBased=i.frameBased,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,this._pausedTime=0,this._codePaused=!1,this._hasStarted=!1},U.Tween.prototype={to:function(t,e,i,n,r,s,o){return(void 0===e||e<=0)&&(e=1e3),null!=i||(i=U.Easing.Default),void 0===n&&(n=!1),void 0===r&&(r=0),void 0===s&&(s=0),void 0===o&&(o=!1),"string"==typeof i&&this.manager.easeMap[i]&&(i=this.manager.easeMap[i]),this.isRunning?console.warn("Phaser.Tween.to cannot be called after Tween.start"):(this.timeline.push(new U.TweenData(this).to(t,e,i,r,s,o)),n&&this.start()),this},from:function(t,e,i,n,r,s,o){return void 0===e&&(e=1e3),null!=i||(i=U.Easing.Default),void 0===n&&(n=!1),void 0===r&&(r=0),void 0===s&&(s=0),void 0===o&&(o=!1),"string"==typeof i&&this.manager.easeMap[i]&&(i=this.manager.easeMap[i]),this.isRunning?console.warn("Phaser.Tween.from cannot be called after Tween.start"):(this.timeline.push(new U.TweenData(this).from(t,e,i,r,s,o)),n&&this.start()),this},start:function(t){if(void 0===t&&(t=0),null===this.game||null===this.target||0===this.timeline.length||this.isRunning)return this;for(var e=0;e<this.timeline.length;e++)for(var i in this.timeline[e].vEnd)this.properties[i]=this.target[i]||0,Array.isArray(this.properties[i])||(this.properties[i]*=1);for(e=0;e<this.timeline.length;e++)this.timeline[e].loadValues();return this.manager.add(this),this.isRunning=!0,(t<0||t>this.timeline.length-1)&&(t=0),this.current=t,this.timeline[this.current].start(),this},stop:function(t){return void 0===t&&(t=!1),this.isRunning=!1,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,t&&(this.onComplete.dispatch(this.target,this),this._hasStarted=!1,this.chainedTween&&this.chainedTween.start()),this.manager.remove(this),this},updateTweenData:function(t,e,i){if(0===this.timeline.length)return this;if(void 0===i&&(i=0),-1===i)for(var n=0;n<this.timeline.length;n++)this.timeline[n][t]=e;else this.timeline[i][t]=e;return this},delay:function(t,e){return this.updateTweenData("delay",t,e)},repeat:function(t,e,i){return void 0===e&&(e=0),this.updateTweenData("repeatCounter",t,i),this.updateTweenData("repeatDelay",e,i)},repeatDelay:function(t,e){return this.updateTweenData("repeatDelay",t,e)},yoyo:function(t,e,i){return void 0===e&&(e=0),this.updateTweenData("yoyo",t,i),this.updateTweenData("yoyoDelay",e,i)},yoyoDelay:function(t,e){return this.updateTweenData("yoyoDelay",t,e)},easing:function(t,e){return"string"==typeof t&&this.manager.easeMap[t]&&(t=this.manager.easeMap[t]),this.updateTweenData("easingFunction",t,e)},interpolation:function(t,e,i){return void 0===e&&(e=U.Math),this.updateTweenData("interpolationFunction",t,i),this.updateTweenData("interpolationContext",e,i)},repeatAll:function(t){return void 0===t&&(t=0),this.repeatCounter=t,this},chain:function(){for(var t=arguments.length;t--;)0<t?arguments[t-1].chainedTween=arguments[t]:this.chainedTween=arguments[t];return this},loop:function(t){return void 0===t&&(t=!0),this.repeatCounter=t?-1:0,this},onUpdateCallback:function(t,e){return this._onUpdateCallback=t,this._onUpdateCallbackContext=e,this},pause:function(){this.isPaused=!0,this._codePaused=!0,this._pausedTime=this.game.time.time},_pause:function(){this._codePaused||(this.isPaused=!0,this._pausedTime=this.game.time.time)},resume:function(){if(this.isPaused){this.isPaused=!1,this._codePaused=!1;for(var t=0;t<this.timeline.length;t++)this.timeline[t].isRunning||(this.timeline[t].startTime+=this.game.time.time-this._pausedTime)}},_resume:function(){this._codePaused||this.resume()},update:function(t){if(this.pendingDelete||!this.target)return!1;if(this.isPaused)return!0;t=this.timeline[this.current].update(t);if(t===U.TweenData.PENDING)return!0;if(t===U.TweenData.RUNNING)return this._hasStarted||(this.onStart.dispatch(this.target,this),this._hasStarted=!0),null!==this._onUpdateCallback&&this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current]),this.isRunning;if(t===U.TweenData.LOOPED)return(-1===this.timeline[this.current].repeatCounter?this.onLoop:this.onRepeat).dispatch(this.target,this),!0;if(t===U.TweenData.COMPLETE){t=!1;return this.reverse?(this.current--,this.current<0&&(this.current=this.timeline.length-1,t=!0)):(this.current++,this.current===this.timeline.length&&(t=!(this.current=0))),t?-1===this.repeatCounter?(this.timeline[this.current].start(),this.onLoop.dispatch(this.target,this),!0):0<this.repeatCounter?(this.repeatCounter--,this.timeline[this.current].start(),this.onRepeat.dispatch(this.target,this),!0):(this.isRunning=!1,this.onComplete.dispatch(this.target,this),this._hasStarted=!1,this.chainedTween&&this.chainedTween.start(),!1):(this.onChildComplete.dispatch(this.target,this),this.timeline[this.current].start(),!0)}},generateData:function(t,e){if(null===this.game||null===this.target)return null;void 0===t&&(t=60),void 0===e&&(e=[]);for(var i=0;i<this.timeline.length;i++)for(var n in this.timeline[i].vEnd)this.properties[n]=this.target[n]||0,Array.isArray(this.properties[n])||(this.properties[n]*=1);for(i=0;i<this.timeline.length;i++)this.timeline[i].loadValues();for(i=0;i<this.timeline.length;i++)e=e.concat(this.timeline[i].generateData(t));return e}},Object.defineProperty(U.Tween.prototype,"totalDuration",{get:function(){for(var t=0,e=0;e<this.timeline.length;e++)t+=this.timeline[e].duration;return t}}),U.Tween.prototype.constructor=U.Tween,U.TweenData=function(t){this.parent=t,this.game=t.game,this.vStart={},this.vStartCache={},this.vEnd={},this.vEndCache={},this.duration=1e3,this.percent=0,this.value=0,this.repeatCounter=0,this.repeatDelay=0,this.repeatTotal=0,this.interpolate=!1,this.yoyo=!1,this.yoyoDelay=0,this.inReverse=!1,this.delay=0,this.dt=0,this.startTime=null,this.easingFunction=U.Easing.Default,this.interpolationFunction=U.Math.linearInterpolation,this.interpolationContext=U.Math,this.isRunning=!1,this.isFrom=!1},U.TweenData.PENDING=0,U.TweenData.RUNNING=1,U.TweenData.LOOPED=2,U.TweenData.COMPLETE=3,U.TweenData.prototype={to:function(t,e,i,n,r,s){return this.vEnd=t,this.duration=e,this.easingFunction=i,this.delay=n,this.repeatTotal=r,this.yoyo=s,this.isFrom=!1,this},from:function(t,e,i,n,r,s){return this.vEnd=t,this.duration=e,this.easingFunction=i,this.delay=n,this.repeatTotal=r,this.yoyo=s,this.isFrom=!0,this},start:function(){if(this.startTime=this.game.time.time+this.delay,this.parent.reverse?this.dt=this.duration:this.dt=0,0<this.delay?this.isRunning=!1:this.isRunning=!0,this.isFrom)for(var t in this.vStartCache)this.vStart[t]=this.vEndCache[t],this.vEnd[t]=this.vStartCache[t],this.parent.target[t]=this.vStart[t];return this.value=0,this.yoyoCounter=0,this.repeatCounter=this.repeatTotal,this},loadValues:function(){for(var t in this.parent.properties){if(this.vStart[t]=this.parent.properties[t],Array.isArray(this.vEnd[t])){if(0===this.vEnd[t].length)continue;0===this.percent&&(this.vEnd[t]=[this.vStart[t]].concat(this.vEnd[t]))}void 0!==this.vEnd[t]?("string"==typeof this.vEnd[t]&&(this.vEnd[t]=this.vStart[t]+parseFloat(this.vEnd[t],10)),this.parent.properties[t]=this.vEnd[t]):this.vEnd[t]=this.vStart[t],this.vStartCache[t]=this.vStart[t],this.vEndCache[t]=this.vEnd[t]}return this},update:function(t){if(this.isRunning){if(t<this.startTime)return U.TweenData.RUNNING}else{if(!(t>=this.startTime))return U.TweenData.PENDING;this.isRunning=!0}var e,t=this.parent.frameBased?this.game.time.physicsElapsedMS:this.game.time.elapsedMS;for(e in this.parent.reverse?(this.dt-=t*this.parent.timeScale,this.dt=Math.max(this.dt,0)):(this.dt+=t*this.parent.timeScale,this.dt=Math.min(this.dt,this.duration)),this.percent=this.dt/this.duration,this.value=this.easingFunction(this.percent),this.vEnd){var i=this.vStart[e],n=this.vEnd[e];Array.isArray(n)?this.parent.target[e]=this.interpolationFunction.call(this.interpolationContext,n,this.value):this.parent.target[e]=i+(n-i)*this.value}return!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent?this.repeat():U.TweenData.RUNNING},generateData:function(t){this.parent.reverse?this.dt=this.duration:this.dt=0;var e=[],i=!1,n=1/t*1e3;do{this.parent.reverse?(this.dt-=n,this.dt=Math.max(this.dt,0)):(this.dt+=n,this.dt=Math.min(this.dt,this.duration)),this.percent=this.dt/this.duration,this.value=this.easingFunction(this.percent);var r,s={};for(r in this.vEnd){var o=this.vStart[r],a=this.vEnd[r];Array.isArray(a)?s[r]=this.interpolationFunction(a,this.value):s[r]=o+(a-o)*this.value}}while(e.push(s),(!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent)&&(i=!0),!i);return this.yoyo&&((t=e.slice()).reverse(),e=e.concat(t)),e},repeat:function(){if(this.yoyo){if(this.inReverse&&0===this.repeatCounter){for(var t in this.vStartCache)this.vStart[t]=this.vStartCache[t],this.vEnd[t]=this.vEndCache[t];return this.inReverse=!1,U.TweenData.COMPLETE}this.inReverse=!this.inReverse}else if(0===this.repeatCounter)return U.TweenData.COMPLETE;if(this.inReverse)for(var t in this.vStartCache)this.vStart[t]=this.vEndCache[t],this.vEnd[t]=this.vStartCache[t];else{for(var t in this.vStartCache)this.vStart[t]=this.vStartCache[t],this.vEnd[t]=this.vEndCache[t];0<this.repeatCounter&&this.repeatCounter--}return this.startTime=this.game.time.time,this.yoyo&&this.inReverse?this.startTime+=this.yoyoDelay:this.inReverse||(this.startTime+=this.repeatDelay),this.parent.reverse?this.dt=this.duration:this.dt=0,U.TweenData.LOOPED}},U.TweenData.prototype.constructor=U.TweenData,U.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},Out:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},InOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var e,i=.1;return 0===t?0:1===t?1:(e=!i||i<1?(i=1,.1):.4*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*--t)*Math.sin((t-e)*(2*Math.PI)/.4)))},Out:function(t){var e,i=.1;return 0===t?0:1===t?1:(e=!i||i<1?(i=1,.1):.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)},InOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(e=!i||i<1?(i=1,.1):.4*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?i*Math.pow(2,10*--t)*Math.sin((t-e)*(2*Math.PI)/.4)*-.5:i*Math.pow(2,-10*--t)*Math.sin((t-e)*(2*Math.PI)/.4)*.5+1)}},Back:{In:function(t){return t*t*(2.70158*t-1.70158)},Out:function(t){return--t*t*(2.70158*t+1.70158)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((1+e)*t-e)*.5:.5*((t-=2)*t*((1+e)*t+e)+2)}},Bounce:{In:function(t){return 1-U.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*U.Easing.Bounce.In(2*t):.5*U.Easing.Bounce.Out(2*t-1)+.5}}},U.Easing.Default=U.Easing.Linear.None,U.Easing.Power0=U.Easing.Linear.None,U.Easing.Power1=U.Easing.Quadratic.Out,U.Easing.Power2=U.Easing.Cubic.Out,U.Easing.Power3=U.Easing.Quartic.Out,U.Easing.Power4=U.Easing.Quintic.Out,U.Time=function(t){this.game=t,this.time=0,this.prevTime=0,this.now=0,this.elapsed=0,this.elapsedMS=0,this.physicsElapsed=1/60,this.physicsElapsedMS=1/60*1e3,this.desiredFpsMult=1/60,this._desiredFps=60,this.suggestedFps=this.desiredFps,this.slowMotion=1,this.advancedTiming=!1,this.frames=0,this.fps=0,this.fpsMin=1e3,this.fpsMax=0,this.msMin=1e3,this.msMax=0,this.pauseDuration=0,this.timeToCall=0,this.timeExpected=0,this.events=new U.Timer(this.game,!1),this._frameCount=0,this._elapsedAccumulator=0,this._started=0,this._timeLastSecond=0,this._pauseStarted=0,this._justResumed=!1,this._timers=[]},U.Time.prototype={boot:function(){this._started=Date.now(),this.time=Date.now(),this.events.start(),this.timeExpected=this.time},add:function(t){return this._timers.push(t),t},create:function(t){void 0===t&&(t=!0);t=new U.Timer(this.game,t);return this._timers.push(t),t},removeAll:function(){for(var t=0;t<this._timers.length;t++)this._timers[t].destroy();this._timers=[],this.events.removeAll()},refresh:function(){var t=this.time;this.time=Date.now(),this.elapsedMS=this.time-t},update:function(t){var e=this.time;this.time=Date.now(),this.elapsedMS=this.time-e,this.prevTime=this.now,this.now=t,this.elapsed=this.now-this.prevTime,this.game.raf._isSetTimeOut&&(this.timeToCall=Math.floor(Math.max(0,1e3/this._desiredFps-(this.timeExpected-t))),this.timeExpected=t+this.timeToCall),this.advancedTiming&&this.updateAdvancedTiming(),this.game.paused||(this.events.update(this.time),this._timers.length&&this.updateTimers())},updateTimers:function(){for(var t=0,e=this._timers.length;t<e;)this._timers[t].update(this.time)?t++:(this._timers.splice(t,1),e--)},updateAdvancedTiming:function(){this._frameCount++,this._elapsedAccumulator+=this.elapsed,this._frameCount>=2*this._desiredFps&&(this.suggestedFps=5*Math.floor(200/(this._elapsedAccumulator/this._frameCount)),this._frameCount=0,this._elapsedAccumulator=0),this.msMin=Math.min(this.msMin,this.elapsed),this.msMax=Math.max(this.msMax,this.elapsed),this.frames++,this.now>this._timeLastSecond+1e3&&(this.fps=Math.round(1e3*this.frames/(this.now-this._timeLastSecond)),this.fpsMin=Math.min(this.fpsMin,this.fps),this.fpsMax=Math.max(this.fpsMax,this.fps),this._timeLastSecond=this.now,this.frames=0)},gamePaused:function(){this._pauseStarted=Date.now(),this.events.pause();for(var t=this._timers.length;t--;)this._timers[t]._pause()},gameResumed:function(){this.time=Date.now(),this.pauseDuration=this.time-this._pauseStarted,this.events.resume();for(var t=this._timers.length;t--;)this._timers[t]._resume()},totalElapsedSeconds:function(){return.001*(this.time-this._started)},elapsedSince:function(t){return this.time-t},elapsedSecondsSince:function(t){return.001*(this.time-t)},reset:function(){this._started=this.time,this.removeAll()}},Object.defineProperty(U.Time.prototype,"desiredFps",{get:function(){return this._desiredFps},set:function(t){this._desiredFps=t,this.physicsElapsed=1/t,this.physicsElapsedMS=1e3*this.physicsElapsed,this.desiredFpsMult=1/t}}),U.Time.prototype.constructor=U.Time,U.Timer=function(t,e){void 0===e&&(e=!0),this.game=t,this.running=!1,this.autoDestroy=e,this.expired=!1,this.elapsed=0,this.events=[],this.onComplete=new U.Signal,this.nextTick=0,this.timeCap=1e3,this.paused=!1,this._codePaused=!1,this._started=0,this._pauseStarted=0,this._pauseTotal=0,this._now=Date.now(),this._len=0,this._marked=0,this._i=0,this._diff=0,this._newTick=0},U.Timer.MINUTE=6e4,U.Timer.SECOND=1e3,U.Timer.HALF=500,U.Timer.QUARTER=250,U.Timer.prototype={create:function(t,e,i,n,r,s){var o=t=Math.round(t);o+=0===this._now?this.game.time.time:this._now;s=new U.TimerEvent(this,t,o,i,e,n,r,s);return this.events.push(s),this.order(),this.expired=!1,s},add:function(t,e,i){return this.create(t,!1,0,e,i,Array.prototype.slice.call(arguments,3))},repeat:function(t,e,i,n){return this.create(t,!1,e,i,n,Array.prototype.slice.call(arguments,4))},loop:function(t,e,i){return this.create(t,!0,0,e,i,Array.prototype.slice.call(arguments,3))},start:function(t){if(!this.running){this._started=this.game.time.time+(t||0),this.running=!0;for(var e=0;e<this.events.length;e++)this.events[e].tick=this.events[e].delay+this._started}},stop:function(t){this.running=!1,void 0===t&&(t=!0),t&&(this.events.length=0)},remove:function(t){for(var e=0;e<this.events.length;e++)if(this.events[e]===t)return this.events[e].pendingDelete=!0;return!1},order:function(){0<this.events.length&&(this.events.sort(this.sortHandler),this.nextTick=this.events[0].tick)},sortHandler:function(t,e){return t.tick<e.tick?-1:t.tick>e.tick?1:0},clearPendingEvents:function(){for(this._i=this.events.length;this._i--;)this.events[this._i].pendingDelete&&this.events.splice(this._i,1);this._len=this.events.length,this._i=0},update:function(t){if(this.paused)return!0;if(this.elapsed=t-this._now,this._now=t,this.elapsed>this.timeCap&&this.adjustEvents(t-this.elapsed),this._marked=0,this.clearPendingEvents(),this.running&&this._now>=this.nextTick&&0<this._len){for(;this._i<this._len&&this.running&&this._now>=this.events[this._i].tick&&!this.events[this._i].pendingDelete;)this._newTick=this._now+this.events[this._i].delay-(this._now-this.events[this._i].tick),this._newTick<0&&(this._newTick=this._now+this.events[this._i].delay),!0===this.events[this._i].loop?this.events[this._i].tick=this._newTick:0<this.events[this._i].repeatCount?(this.events[this._i].repeatCount--,this.events[this._i].tick=this._newTick):(this._marked++,this.events[this._i].pendingDelete=!0),this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args),this._i++;this.events.length>this._marked?this.order():(this.expired=!0,this.onComplete.dispatch(this))}return!this.expired||!this.autoDestroy},pause:function(){this.running&&(this._codePaused=!0,this.paused||(this._pauseStarted=this.game.time.time,this.paused=!0))},_pause:function(){!this.paused&&this.running&&(this._pauseStarted=this.game.time.time,this.paused=!0)},adjustEvents:function(t){for(var e,i=0;i<this.events.length;i++)this.events[i].pendingDelete||((e=this.events[i].tick-t)<0&&(e=0),this.events[i].tick=this._now+e);var n=this.nextTick-t;this.nextTick=n<0?this._now:this._now+n},resume:function(){var t;this.paused&&(t=this.game.time.time,this._pauseTotal+=t-this._now,this._now=t,this.adjustEvents(this._pauseStarted),this.paused=!1,this._codePaused=!1)},_resume:function(){this._codePaused||this.resume()},removeAll:function(){this.onComplete.removeAll(),this.events.length=0,this._len=0,this._i=0},destroy:function(){this.onComplete.removeAll(),this.running=!1,this.events=[],this._len=0,this._i=0}},Object.defineProperty(U.Timer.prototype,"next",{get:function(){return this.nextTick}}),Object.defineProperty(U.Timer.prototype,"duration",{get:function(){return this.running&&this.nextTick>this._now?this.nextTick-this._now:0}}),Object.defineProperty(U.Timer.prototype,"length",{get:function(){return this.events.length}}),Object.defineProperty(U.Timer.prototype,"ms",{get:function(){return this.running?this._now-this._started-this._pauseTotal:0}}),Object.defineProperty(U.Timer.prototype,"seconds",{get:function(){return this.running?.001*this.ms:0}}),U.Timer.prototype.constructor=U.Timer,U.TimerEvent=function(t,e,i,n,r,s,o,a){this.timer=t,this.delay=e,this.tick=i,this.repeatCount=n-1,this.loop=r,this.callback=s,this.callbackContext=o,this.args=a,this.pendingDelete=!1},U.TimerEvent.prototype.constructor=U.TimerEvent,U.AnimationManager=function(t){this.sprite=t,this.game=t.game,this.currentFrame=null,this.currentAnim=null,this.updateIfVisible=!0,this.isLoaded=!1,this._frameData=null,this._anims={},this._outputFrames=[]},U.AnimationManager.prototype={loadFrameData:function(t,e){if(void 0===t)return!1;if(this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(t);return this._frameData=t,null==e?this.frame=0:"string"==typeof e?this.frameName=e:this.frame=e,this.isLoaded=!0},copyFrameData:function(t,e){if(this._frameData=t.clone(),this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(this._frameData);return null==e?this.frame=0:"string"==typeof e?this.frameName=e:this.frame=e,this.isLoaded=!0},add:function(t,e,i,n,r){return e=e||[],i=i||60,void 0===n&&(n=!1),void 0===r&&(r=!(!e||"number"!=typeof e[0])),this._outputFrames=[],this._frameData.getFrameIndexes(e,r,this._outputFrames),this._anims[t]=new U.Animation(this.game,this.sprite,t,this._frameData,this._outputFrames,i,n),this.currentAnim=this._anims[t],this.sprite.tilingTexture&&(this.sprite.refreshTexture=!0),this._anims[t]},validateFrames:function(t,e){void 0===e&&(e=!0);for(var i=0;i<t.length;i++)if(!0===e){if(t[i]>this._frameData.total)return!1}else if(!1===this._frameData.checkFrameName(t[i]))return!1;return!0},play:function(t,e,i,n){if(this._anims[t])return this.currentAnim===this._anims[t]?!1===this.currentAnim.isPlaying?(this.currentAnim.paused=!1,this.currentAnim.play(e,i,n)):this.currentAnim:(this.currentAnim&&this.currentAnim.isPlaying&&this.currentAnim.stop(),this.currentAnim=this._anims[t],this.currentAnim.paused=!1,this.currentFrame=this.currentAnim.currentFrame,this.currentAnim.play(e,i,n))},stop:function(t,e){void 0===e&&(e=!1),!this.currentAnim||"string"==typeof t&&t!==this.currentAnim.name||this.currentAnim.stop(e)},update:function(){return!(this.updateIfVisible&&!this.sprite.visible||!this.currentAnim||!this.currentAnim.update()||(this.currentFrame=this.currentAnim.currentFrame,0))},next:function(t){this.currentAnim&&(this.currentAnim.next(t),this.currentFrame=this.currentAnim.currentFrame)},previous:function(t){this.currentAnim&&(this.currentAnim.previous(t),this.currentFrame=this.currentAnim.currentFrame)},getAnimation:function(t){return"string"==typeof t&&this._anims[t]?this._anims[t]:null},refreshFrame:function(){},destroy:function(){var t=null;for(t in this._anims)this._anims.hasOwnProperty(t)&&this._anims[t].destroy();this._anims={},this._outputFrames=[],this._frameData=null,this.currentAnim=null,this.currentFrame=null,this.sprite=null,this.game=null}},U.AnimationManager.prototype.constructor=U.AnimationManager,Object.defineProperty(U.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}}),Object.defineProperty(U.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}}),Object.defineProperty(U.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(t){this.currentAnim.paused=t}}),Object.defineProperty(U.AnimationManager.prototype,"name",{get:function(){if(this.currentAnim)return this.currentAnim.name}}),Object.defineProperty(U.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame)return this.currentFrame.index},set:function(t){"number"==typeof t&&this._frameData&&null!==this._frameData.getFrame(t)&&(this.currentFrame=this._frameData.getFrame(t),this.currentFrame&&this.sprite.setFrame(this.currentFrame))}}),Object.defineProperty(U.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame)return this.currentFrame.name},set:function(t){"string"==typeof t&&this._frameData&&null!==this._frameData.getFrameByName(t)?(this.currentFrame=this._frameData.getFrameByName(t),this.currentFrame&&(this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame))):console.warn("Cannot set frameName: "+t)}}),U.Animation=function(t,e,i,n,r,s,o){void 0===o&&(o=!1),this.game=t,this._parent=e,this._frameData=n,this.name=i,this._frames=[],this._frames=this._frames.concat(r),this.delay=1e3/s,this.loop=o,this.loopCount=0,this.killOnComplete=!1,this.isFinished=!1,this.isPlaying=!1,this.isPaused=!1,this._pauseStartTime=0,this._frameIndex=0,this._frameDiff=0,this._frameSkip=1,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.onStart=new U.Signal,this.onUpdate=null,this.onComplete=new U.Signal,this.onLoop=new U.Signal,this.isReversed=!1,this.game.onPause.add(this.onPause,this),this.game.onResume.add(this.onResume,this)},U.Animation.prototype={play:function(t,e,i){return"number"==typeof t&&(this.delay=1e3/t),"boolean"==typeof e&&(this.loop=e),void 0!==i&&(this.killOnComplete=i),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=this.isReversed?this._frames.length-1:0,this.updateCurrentFrame(!1,!0),this._parent.events.onAnimationStart$dispatch(this._parent,this),this.onStart.dispatch(this._parent,this),(this._parent.animations.currentAnim=this)._parent.animations.currentFrame=this.currentFrame,this},restart:function(){this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this._parent.setFrame(this.currentFrame),(this._parent.animations.currentAnim=this)._parent.animations.currentFrame=this.currentFrame,this.onStart.dispatch(this._parent,this)},reverse:function(){return this.reversed=!this.reversed,this},reverseOnce:function(){return this.onComplete.addOnce(this.reverse,this),this.reverse()},setFrame:function(t,e){var i;if(void 0===e&&(e=!1),"string"==typeof t)for(var n=0;n<this._frames.length;n++)this._frameData.getFrame(this._frames[n]).name===t&&(i=n);else if("number"==typeof t)if(e)i=t;else for(n=0;n<this._frames.length;n++)this._frames[n]===t&&(i=n);i&&(this._frameIndex=i-1,this._timeNextFrame=this.game.time.time,this.update())},stop:function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,t&&(this.currentFrame=this._frameData.getFrame(this._frames[0]),this._parent.setFrame(this.currentFrame)),e&&(this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.time)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.time+this._frameDiff)},update:function(){return!this.isPaused&&!!(this.isPlaying&&this.game.time.time>=this._timeNextFrame)&&(this._frameSkip=1,this._frameDiff=this.game.time.time-this._timeNextFrame,this._timeLastFrame=this.game.time.time,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay),this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff),this.isReversed?this._frameIndex-=this._frameSkip:this._frameIndex+=this._frameSkip,!this.isReversed&&this._frameIndex>=this._frames.length||this.isReversed&&this._frameIndex<=-1?this.loop?(this._frameIndex=Math.abs(this._frameIndex)%this._frames.length,this.isReversed&&(this._frameIndex=this._frames.length-1-this._frameIndex),this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&this._parent.setFrame(this.currentFrame),this.loopCount++,this._parent.events.onAnimationLoop$dispatch(this._parent,this),this.onLoop.dispatch(this._parent,this),!this.onUpdate||(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData)):(this.complete(),!1):this.updateCurrentFrame(!0))},updateCurrentFrame:function(t,e){if(void 0===e&&(e=!1),!this._frameData)return!1;var i=this.currentFrame.index;return this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(e||!e&&i!==this.currentFrame.index)&&this._parent.setFrame(this.currentFrame),!this.onUpdate||!t||(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData)},next:function(t){void 0===t&&(t=1);t=this._frameIndex+t;t>=this._frames.length&&(this.loop?t%=this._frames.length:t=this._frames.length-1),t!==this._frameIndex&&(this._frameIndex=t,this.updateCurrentFrame(!0))},previous:function(t){void 0===t&&(t=1);t=this._frameIndex-t;t<0&&(this.loop?t=this._frames.length+t:t++),t!==this._frameIndex&&(this._frameIndex=t,this.updateCurrentFrame(!0))},updateFrameData:function(t){this._frameData=t,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){this._frameData&&(this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose(),this.onUpdate&&this.onUpdate.dispose())},complete:function(){this._frameIndex=this._frames.length-1,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this),this.killOnComplete&&this._parent.kill()}},U.Animation.prototype.constructor=U.Animation,Object.defineProperty(U.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(t){(this.isPaused=t)?this._pauseStartTime=this.game.time.time:this.isPlaying&&(this._timeNextFrame=this.game.time.time+this.delay)}}),Object.defineProperty(U.Animation.prototype,"reversed",{get:function(){return this.isReversed},set:function(t){this.isReversed=t}}),Object.defineProperty(U.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}}),Object.defineProperty(U.Animation.prototype,"frame",{get:function(){return null!==this.currentFrame?this.currentFrame.index:this._frameIndex},set:function(t){this.currentFrame=this._frameData.getFrame(this._frames[t]),null!==this.currentFrame&&(this._frameIndex=t,this._parent.setFrame(this.currentFrame),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))}}),Object.defineProperty(U.Animation.prototype,"speed",{get:function(){return 1e3/this.delay},set:function(t){0<t&&(this.delay=1e3/t)}}),Object.defineProperty(U.Animation.prototype,"enableUpdate",{get:function(){return null!==this.onUpdate},set:function(t){t&&null===this.onUpdate?this.onUpdate=new U.Signal:t||null===this.onUpdate||(this.onUpdate.dispose(),this.onUpdate=null)}}),U.Animation.generateFrameNames=function(t,e,i,n,r){void 0===n&&(n="");var s=[],o="";if(e<i)for(var a=e;a<=i;a++)o=t+(o="number"==typeof r?U.Utils.pad(a.toString(),r,"0",1):a.toString())+n,s.push(o);else for(a=e;i<=a;a--)o=t+(o="number"==typeof r?U.Utils.pad(a.toString(),r,"0",1):a.toString())+n,s.push(o);return s},U.Frame=function(t,e,i,n,r,s){this.index=t,this.x=e,this.y=i,this.width=n,this.height=r,this.name=s,this.centerX=Math.floor(n/2),this.centerY=Math.floor(r/2),this.distance=U.Math.distance(0,0,n,r),this.rotated=!1,this.rotationDirection="cw",this.trimmed=!1,this.sourceSizeW=n,this.sourceSizeH=r,this.spriteSourceSizeX=0,this.spriteSourceSizeY=0,this.spriteSourceSizeW=0,this.spriteSourceSizeH=0,this.right=this.x+this.width,this.bottom=this.y+this.height},U.Frame.prototype={resize:function(t,e){this.width=t,this.height=e,this.centerX=Math.floor(t/2),this.centerY=Math.floor(e/2),this.distance=U.Math.distance(0,0,t,e),this.sourceSizeW=t,this.sourceSizeH=e,this.right=this.x+t,this.bottom=this.y+e},setTrim:function(t,e,i,n,r,s,o){(this.trimmed=t)&&(this.sourceSizeW=e,this.sourceSizeH=i,this.centerX=Math.floor(e/2),this.centerY=Math.floor(i/2),this.spriteSourceSizeX=n,this.spriteSourceSizeY=r,this.spriteSourceSizeW=s,this.spriteSourceSizeH=o)},clone:function(){var t,e=new U.Frame(this.index,this.x,this.y,this.width,this.height,this.name);for(t in this)this.hasOwnProperty(t)&&(e[t]=this[t]);return e},getRect:function(t){return void 0===t?t=new U.Rectangle(this.x,this.y,this.width,this.height):t.setTo(this.x,this.y,this.width,this.height),t}},U.Frame.prototype.constructor=U.Frame,U.FrameData=function(){this._frames=[],this._frameNames=[]},U.FrameData.prototype={addFrame:function(t){return t.index=this._frames.length,this._frames.push(t),""!==t.name&&(this._frameNames[t.name]=t.index),t},getFrame:function(t){return t>=this._frames.length&&(t=0),this._frames[t]},getFrameByName:function(t){return"number"==typeof this._frameNames[t]?this._frames[this._frameNames[t]]:null},checkFrameName:function(t){return null!=this._frameNames[t]},clone:function(){for(var t,e=new U.FrameData,i=0;i<this._frames.length;i++)e._frames.push(this._frames[i].clone());for(t in this._frameNames)this._frameNames.hasOwnProperty(t)&&e._frameNames.push(this._frameNames[t]);return e},getFrameRange:function(t,e,i){void 0===i&&(i=[]);for(var n=t;n<=e;n++)i.push(this._frames[n]);return i},getFrames:function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=[]),void 0===t||0===t.length)for(var n=0;n<this._frames.length;n++)i.push(this._frames[n]);else for(n=0;n<t.length;n++)e?i.push(this.getFrame(t[n])):i.push(this.getFrameByName(t[n]));return i},getFrameIndexes:function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=[]),void 0===t||0===t.length)for(var n=0;n<this._frames.length;n++)i.push(this._frames[n].index);else for(n=0;n<t.length;n++)e&&this._frames[t[n]]?i.push(this._frames[t[n]].index):this.getFrameByName(t[n])&&i.push(this.getFrameByName(t[n]).index);return i},destroy:function(){this._frames=null,this._frameNames=null}},U.FrameData.prototype.constructor=U.FrameData,Object.defineProperty(U.FrameData.prototype,"total",{get:function(){return this._frames.length}}),U.AnimationParser={spriteSheet:function(t,e,i,n,r,s,o){var a=e;if("string"==typeof e&&(a=t.cache.getImage(e)),null===a)return null;var l=a.width,p=a.height;i<=0&&(i=Math.floor(-l/Math.min(-1,i))),n<=0&&(n=Math.floor(-p/Math.min(-1,n)));var t=Math.floor((l-s)/(i+o)),a=Math.floor((p-s)/(n+o)),h=-1!==r?r:t*a;if(0===l||0===p||l<i||p<n||0===h)return console.warn("Phaser.AnimationParser.spriteSheet: '"+e+"'s width/height zero or width/height < given frameWidth/frameHeight"),null;for(var u=new U.FrameData,c=s,d=s,_=0;_<h;_++)u.addFrame(new U.Frame(_,c,d,i,n,"")),l<(c+=i+o)+i&&(c=s,d+=n+o);return u},JSONData:function(t,e){if(!e.frames)return console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array"),void console.log(e);for(var i,n=new U.FrameData,r=e.frames,s=0;s<r.length;s++)i=n.addFrame(new U.Frame(s,r[s].frame.x,r[s].frame.y,r[s].frame.w,r[s].frame.h,r[s].filename)),r[s].trimmed&&i.setTrim(r[s].trimmed,r[s].sourceSize.w,r[s].sourceSize.h,r[s].spriteSourceSize.x,r[s].spriteSourceSize.y,r[s].spriteSourceSize.w,r[s].spriteSourceSize.h);return n},JSONDataPyxel:function(t,e){if(["layers","tilewidth","tileheight","tileswide","tileshigh"].forEach(function(t){if(!e[t])return console.warn('Phaser.AnimationParser.JSONDataPyxel: Invalid Pyxel Tilemap JSON given, missing "'+t+'" key.'),void console.log(e)}),1!==e.layers.length)return console.warn("Phaser.AnimationParser.JSONDataPyxel: Too many layers, this parser only supports flat Tilemaps."),void console.log(e);for(var i=new U.FrameData,n=e.tileheight,r=e.tilewidth,s=e.layers[0].tiles,o=0;o<s.length;o++)i.addFrame(new U.Frame(o,s[o].x,s[o].y,r,n,"frame_"+o)).setTrim(!1);return i},JSONDataHash:function(t,e){if(!e.frames)return console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object"),void console.log(e);var i,n,r=new U.FrameData,s=e.frames,o=0;for(n in s)i=r.addFrame(new U.Frame(o,s[n].frame.x,s[n].frame.y,s[n].frame.w,s[n].frame.h,n)),s[n].trimmed&&i.setTrim(s[n].trimmed,s[n].sourceSize.w,s[n].sourceSize.h,s[n].spriteSourceSize.x,s[n].spriteSourceSize.y,s[n].spriteSourceSize.w,s[n].spriteSourceSize.h),o++;return r},XMLData:function(t,e){if(e.getElementsByTagName("TextureAtlas")){for(var i,n,r,s,o,a,l,p,h,u,c=new U.FrameData,d=e.getElementsByTagName("SubTexture"),_=0;_<d.length;_++)i=(n=d[_].attributes).name.value,r=parseInt(n.x.value,10),s=parseInt(n.y.value,10),o=parseInt(n.width.value,10),a=parseInt(n.height.value,10),p=l=null,n.frameX&&(l=Math.abs(parseInt(n.frameX.value,10)),p=Math.abs(parseInt(n.frameY.value,10)),h=parseInt(n.frameWidth.value,10),u=parseInt(n.frameHeight.value,10)),i=c.addFrame(new U.Frame(_,r,s,o,a,i)),null===l&&null===p||i.setTrim(!0,o,a,l,p,h,u);return c}console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag")}},U.Cache=function(t){this.game=t,this.autoResolveURL=!1,this._cache={canvas:{},image:{},texture:{},sound:{},video:{},text:{},json:{},xml:{},physics:{},tilemap:{},binary:{},bitmapData:{},bitmapFont:{},shader:{},renderTexture:{}},this._urlMap={},this._urlResolver=new Image,this._urlTemp=null,this.onSoundUnlock=new U.Signal,this._cacheMap=[],this._cacheMap[U.Cache.CANVAS]=this._cache.canvas,this._cacheMap[U.Cache.IMAGE]=this._cache.image,this._cacheMap[U.Cache.TEXTURE]=this._cache.texture,this._cacheMap[U.Cache.SOUND]=this._cache.sound,this._cacheMap[U.Cache.TEXT]=this._cache.text,this._cacheMap[U.Cache.PHYSICS]=this._cache.physics,this._cacheMap[U.Cache.TILEMAP]=this._cache.tilemap,this._cacheMap[U.Cache.BINARY]=this._cache.binary,this._cacheMap[U.Cache.BITMAPDATA]=this._cache.bitmapData,this._cacheMap[U.Cache.BITMAPFONT]=this._cache.bitmapFont,this._cacheMap[U.Cache.JSON]=this._cache.json,this._cacheMap[U.Cache.XML]=this._cache.xml,this._cacheMap[U.Cache.VIDEO]=this._cache.video,this._cacheMap[U.Cache.SHADER]=this._cache.shader,this._cacheMap[U.Cache.RENDER_TEXTURE]=this._cache.renderTexture,this.addDefaultImage(),this.addMissingImage()},U.Cache.CANVAS=1,U.Cache.IMAGE=2,U.Cache.TEXTURE=3,U.Cache.SOUND=4,U.Cache.TEXT=5,U.Cache.PHYSICS=6,U.Cache.TILEMAP=7,U.Cache.BINARY=8,U.Cache.BITMAPDATA=9,U.Cache.BITMAPFONT=10,U.Cache.JSON=11,U.Cache.XML=12,U.Cache.VIDEO=13,U.Cache.SHADER=14,U.Cache.RENDER_TEXTURE=15,U.Cache.DEFAULT=null,U.Cache.MISSING=null,U.Cache.prototype={addCanvas:function(t,e,i){void 0===i&&(i=e.getContext("2d")),this._cache.canvas[t]={canvas:e,context:i}},addImage:function(t,e,i){this.checkImageKey(t)&&this.removeImage(t);var n={key:t,url:e,data:i,base:new PIXI.BaseTexture(i),frame:new U.Frame(0,0,0,i.width,i.height,t),frameData:new U.FrameData};return n.frameData.addFrame(new U.Frame(0,0,0,i.width,i.height,e)),this._cache.image[t]=n,this._resolveURL(e,n),"__default"===t?U.Cache.DEFAULT=new PIXI.Texture(n.base):"__missing"===t&&(U.Cache.MISSING=new PIXI.Texture(n.base)),n},addDefaultImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQAAAABbAUdZAAAAAnRSTlMAAQGU/a4AAAAOSURBVHgBY/gPBIOYAADa6X+Bl/KbWAAAAABJRU5ErkJggg==";t=this.addImage("__default",null,t);t.base.skipRender=!0,U.Cache.DEFAULT=new PIXI.Texture(t.base)},addMissingImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAABlBMVEUA/wAAAABvA35DAAAAS0lEQVR4ARXERQEDMRQFwO+sUiqhtzI42zhpHGxOyzwPJiRO27bGGRfc8MIHX/x+SMgo6DBhwYrth4SMgg4TFqzYvqjwR40WI+aQHWuRZPCURnd5AAAAAElFTkSuQmCC";t=this.addImage("__missing",null,t);U.Cache.MISSING=new PIXI.Texture(t.base)},addSound:function(t,e,i,n,r){void 0===n&&(r=!(n=!0)),void 0===r&&(r=!(n=!1));var s=r?!0:!1;this._cache.sound[t]={url:e,data:i,isDecoding:!1,decoded:s,webAudio:n,audioTag:r,locked:this.game.sound.touchLocked},this._resolveURL(e,this._cache.sound[t])},addText:function(t,e,i){this._cache.text[t]={url:e,data:i},this._resolveURL(e,this._cache.text[t])},addPhysicsData:function(t,e,i,n){this._cache.physics[t]={url:e,data:i,format:n},this._resolveURL(e,this._cache.physics[t])},addTilemap:function(t,e,i,n){this._cache.tilemap[t]={url:e,data:i,format:n},this._resolveURL(e,this._cache.tilemap[t])},addBinary:function(t,e){this._cache.binary[t]=e},addBitmapData:function(t,e,i){return e.key=t,void 0===i&&(i=new U.FrameData).addFrame(e.textureFrame),this._cache.bitmapData[t]={data:e,frameData:i},e},addBitmapFont:function(t,e,i,n,r,s,o){i={url:e,data:i,font:null,base:new PIXI.BaseTexture(i)};void 0===s&&(s=0),void 0===o&&(o=0),i.font="json"===r?U.LoaderParser.jsonBitmapFont(n,i.base,s,o):U.LoaderParser.xmlBitmapFont(n,i.base,s,o),this._cache.bitmapFont[t]=i,this._resolveURL(e,i)},addJSON:function(t,e,i){this._cache.json[t]={url:e,data:i},this._resolveURL(e,this._cache.json[t])},addXML:function(t,e,i){this._cache.xml[t]={url:e,data:i},this._resolveURL(e,this._cache.xml[t])},addVideo:function(t,e,i,n){this._cache.video[t]={url:e,data:i,isBlob:n,locked:!0},this._resolveURL(e,this._cache.video[t])},addShader:function(t,e,i){this._cache.shader[t]={url:e,data:i},this._resolveURL(e,this._cache.shader[t])},addRenderTexture:function(t,e){this._cache.renderTexture[t]={texture:e,frame:new U.Frame(0,0,0,e.width,e.height,"","")}},addSpriteSheet:function(t,e,i,n,r,s,o,a){void 0===s&&(s=-1),void 0===o&&(o=0),void 0===a&&(a=0);a={key:t,url:e,data:i,frameWidth:n,frameHeight:r,margin:o,spacing:a,base:new PIXI.BaseTexture(i),frameData:U.AnimationParser.spriteSheet(this.game,i,n,r,s,o,a)};this._cache.image[t]=a,this._resolveURL(e,a)},addTextureAtlas:function(t,e,i,n,r){i={key:t,url:e,data:i,base:new PIXI.BaseTexture(i)};r===U.Loader.TEXTURE_ATLAS_XML_STARLING?i.frameData=U.AnimationParser.XMLData(this.game,n,t):r===U.Loader.TEXTURE_ATLAS_JSON_PYXEL?i.frameData=U.AnimationParser.JSONDataPyxel(this.game,n,t):Array.isArray(n.frames)?i.frameData=U.AnimationParser.JSONData(this.game,n,t):i.frameData=U.AnimationParser.JSONDataHash(this.game,n,t),this._cache.image[t]=i,this._resolveURL(e,i)},reloadSound:function(t){var e=this,i=this.getSound(t);i&&(i.data.src=i.url,i.data.addEventListener("canplaythrough",function(){return e.reloadSoundComplete(t)},!1),i.data.load())},reloadSoundComplete:function(t){var e=this.getSound(t);e&&(e.locked=!1,this.onSoundUnlock.dispatch(t))},updateSound:function(t,e,i){t=this.getSound(t);t&&(t[e]=i)},decodedSound:function(t,e){t=this.getSound(t);t.data=e,t.decoded=!0,t.isDecoding=!1},isSoundDecoded:function(t){t=this.getItem(t,U.Cache.SOUND,"isSoundDecoded");if(t)return t.decoded},isSoundReady:function(t){t=this.getItem(t,U.Cache.SOUND,"isSoundDecoded");if(t)return t.decoded&&!this.game.sound.touchLocked},checkKey:function(t,e){return!!this._cacheMap[t][e]},checkURL:function(t){return!!this._urlMap[this._resolveURL(t)]},checkCanvasKey:function(t){return this.checkKey(U.Cache.CANVAS,t)},checkImageKey:function(t){return this.checkKey(U.Cache.IMAGE,t)},checkTextureKey:function(t){return this.checkKey(U.Cache.TEXTURE,t)},checkSoundKey:function(t){return this.checkKey(U.Cache.SOUND,t)},checkTextKey:function(t){return this.checkKey(U.Cache.TEXT,t)},checkPhysicsKey:function(t){return this.checkKey(U.Cache.PHYSICS,t)},checkTilemapKey:function(t){return this.checkKey(U.Cache.TILEMAP,t)},checkBinaryKey:function(t){return this.checkKey(U.Cache.BINARY,t)},checkBitmapDataKey:function(t){return this.checkKey(U.Cache.BITMAPDATA,t)},checkBitmapFontKey:function(t){return this.checkKey(U.Cache.BITMAPFONT,t)},checkJSONKey:function(t){return this.checkKey(U.Cache.JSON,t)},checkXMLKey:function(t){return this.checkKey(U.Cache.XML,t)},checkVideoKey:function(t){return this.checkKey(U.Cache.VIDEO,t)},checkShaderKey:function(t){return this.checkKey(U.Cache.SHADER,t)},checkRenderTextureKey:function(t){return this.checkKey(U.Cache.RENDER_TEXTURE,t)},getItem:function(t,e,i,n){return this.checkKey(e,t)?void 0===n?this._cacheMap[e][t]:this._cacheMap[e][t][n]:(i&&console.warn("Phaser.Cache."+i+': Key "'+t+'" not found in Cache.'),null)},getCanvas:function(t){return this.getItem(t,U.Cache.CANVAS,"getCanvas","canvas")},getImage:function(t,e){null!=t||(t="__default"),void 0===e&&(e=!1);t=this.getItem(t,U.Cache.IMAGE,"getImage");return null===t&&(t=this.getItem("__missing",U.Cache.IMAGE,"getImage")),e?t:t.data},getTextureFrame:function(t){return this.getItem(t,U.Cache.TEXTURE,"getTextureFrame","frame")},getSound:function(t){return this.getItem(t,U.Cache.SOUND,"getSound")},getSoundData:function(t){return this.getItem(t,U.Cache.SOUND,"getSoundData","data")},getText:function(t){return this.getItem(t,U.Cache.TEXT,"getText","data")},getPhysicsData:function(t,e,i){var n=this.getItem(t,U.Cache.PHYSICS,"getPhysicsData","data");if(null===n||null==e)return n;if(n[e]){var r,s=n[e];if(!s||!i)return s;for(r in s)if(r=s[r],r.fixtureKey===i)return r;console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+i+" in "+t+'"')}else console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+t+" / "+e+'"');return null},getTilemapData:function(t){return this.getItem(t,U.Cache.TILEMAP,"getTilemapData")},getBinary:function(t){return this.getItem(t,U.Cache.BINARY,"getBinary")},getBitmapData:function(t){return this.getItem(t,U.Cache.BITMAPDATA,"getBitmapData","data")},getBitmapFont:function(t){return this.getItem(t,U.Cache.BITMAPFONT,"getBitmapFont")},getJSON:function(t,e){t=this.getItem(t,U.Cache.JSON,"getJSON","data");return t?e?U.Utils.extend(!0,Array.isArray(t)?[]:{},t):t:null},getXML:function(t){return this.getItem(t,U.Cache.XML,"getXML","data")},getVideo:function(t){return this.getItem(t,U.Cache.VIDEO,"getVideo")},getShader:function(t){return this.getItem(t,U.Cache.SHADER,"getShader","data")},getRenderTexture:function(t){return this.getItem(t,U.Cache.RENDER_TEXTURE,"getRenderTexture")},getBaseTexture:function(t,e){return void 0===e&&(e=U.Cache.IMAGE),this.getItem(t,e,"getBaseTexture","base")},getFrame:function(t,e){return void 0===e&&(e=U.Cache.IMAGE),this.getItem(t,e,"getFrame","frame")},getFrameCount:function(t,e){e=this.getFrameData(t,e);return e?e.total:0},getFrameData:function(t,e){return void 0===e&&(e=U.Cache.IMAGE),this.getItem(t,e,"getFrameData","frameData")},hasFrameData:function(t,e){return void 0===e&&(e=U.Cache.IMAGE),null!==this.getItem(t,e,"","frameData")},updateFrameData:function(t,e,i){void 0===i&&(i=U.Cache.IMAGE),this._cacheMap[i][t]&&(this._cacheMap[i][t].frameData=e)},getFrameByIndex:function(t,e,i){i=this.getFrameData(t,i);return i?i.getFrame(e):null},getFrameByName:function(t,e,i){i=this.getFrameData(t,i);return i?i.getFrameByName(e):null},getURL:function(t){return(t=this._resolveURL(t))?this._urlMap[t]:(console.warn('Phaser.Cache.getUrl: Invalid url: "'+t+'" or Cache.autoResolveURL was false'),null)},getKeys:function(t){void 0===t&&(t=U.Cache.IMAGE);var e=[];if(this._cacheMap[t])for(var i in this._cacheMap[t])"__default"!==i&&"__missing"!==i&&e.push(i);return e},removeCanvas:function(t){delete this._cache.canvas[t]},removeImage:function(t,e){void 0===e&&(e=!0);var i=this.getImage(t,!0);e&&i.base&&i.base.destroy(),delete this._cache.image[t]},removeSound:function(t){delete this._cache.sound[t]},removeText:function(t){delete this._cache.text[t]},removePhysics:function(t){delete this._cache.physics[t]},removeTilemap:function(t){delete this._cache.tilemap[t]},removeBinary:function(t){delete this._cache.binary[t]},removeBitmapData:function(t){delete this._cache.bitmapData[t]},removeBitmapFont:function(t){delete this._cache.bitmapFont[t]},removeJSON:function(t){delete this._cache.json[t]},removeXML:function(t){delete this._cache.xml[t]},removeVideo:function(t){delete this._cache.video[t]},removeShader:function(t){delete this._cache.shader[t]},removeRenderTexture:function(t){delete this._cache.renderTexture[t]},removeSpriteSheet:function(t){delete this._cache.spriteSheet[t]},removeTextureAtlas:function(t){delete this._cache.atlas[t]},clearGLTextures:function(){for(var t in this._cache.image)this._cache.image[t].base._glTextures=[]},_resolveURL:function(t,e){return this.autoResolveURL?(this._urlResolver.src=this.game.load.baseURL+t,this._urlTemp=this._urlResolver.src,this._urlResolver.src="",e&&(this._urlMap[this._urlTemp]=e),this._urlTemp):null},destroy:function(){for(var t=0;t<this._cacheMap.length;t++){var e,i=this._cacheMap[t];for(e in i)"__default"!==e&&"__missing"!==e&&(i[e].destroy&&i[e].destroy(),delete i[e])}this._urlMap=null,this._urlResolver=null,this._urlTemp=null}},U.Cache.prototype.constructor=U.Cache,U.Loader=function(t){this.game=t,this.cache=t.cache,this.resetLocked=!1,this.isLoading=!1,this.hasLoaded=!1,this.preloadSprite=null,this.crossOrigin=!1,this.baseURL="",this.path="",this.headers={requestedWith:!1,json:"application/json",xml:"application/xml"},this.onLoadStart=new U.Signal,this.onLoadComplete=new U.Signal,this.onPackComplete=new U.Signal,this.onFileStart=new U.Signal,this.onFileComplete=new U.Signal,this.onFileError=new U.Signal,this.useXDomainRequest=!1,this._warnedAboutXDomainRequest=!1,this.enableParallel=!0,this.maxParallelDownloads=4,this._withSyncPointDepth=0,this._fileList=[],this._flightQueue=[],this._processingHead=0,this._fileLoadStarted=!1,this._totalPackCount=0,this._totalFileCount=0,this._loadedPackCount=0,this._loadedFileCount=0},U.Loader.TEXTURE_ATLAS_JSON_ARRAY=0,U.Loader.TEXTURE_ATLAS_JSON_HASH=1,U.Loader.TEXTURE_ATLAS_XML_STARLING=2,U.Loader.PHYSICS_LIME_CORONA_JSON=3,U.Loader.PHYSICS_PHASER_JSON=4,U.Loader.TEXTURE_ATLAS_JSON_PYXEL=5,U.Loader.prototype={setPreloadSprite:function(t,e){e=e||0,this.preloadSprite={sprite:t,direction:e,width:t.width,height:t.height,rect:null},this.preloadSprite.rect=0===e?new U.Rectangle(0,0,1,t.height):new U.Rectangle(0,0,t.width,1),t.crop(this.preloadSprite.rect),t.visible=!0},resize:function(){this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height&&(this.preloadSprite.rect.height=this.preloadSprite.sprite.height)},checkKeyExists:function(t,e){return-1<this.getAssetIndex(t,e)},getAssetIndex:function(t,e){for(var i=-1,n=0;n<this._fileList.length;n++){var r=this._fileList[n];if(r.type===t&&r.key===e&&(i=n,!r.loaded&&!r.loading))break}return i},getAsset:function(t,e){e=this.getAssetIndex(t,e);return-1<e&&{index:e,file:this._fileList[e]}},reset:function(t,e){void 0===e&&(e=!1),this.resetLocked||(t&&(this.preloadSprite=null),this.isLoading=!1,this._processingHead=0,this._fileList.length=0,this._flightQueue.length=0,this._fileLoadStarted=!1,this._totalFileCount=0,this._totalPackCount=0,this._loadedPackCount=0,this._loadedFileCount=0,e&&(this.onLoadStart.removeAll(),this.onLoadComplete.removeAll(),this.onPackComplete.removeAll(),this.onFileStart.removeAll(),this.onFileComplete.removeAll(),this.onFileError.removeAll()))},addToFileList:function(t,e,i,n,r,s){if(void 0===r&&(r=!1),void 0===e||""===e)return console.warn("Phaser.Loader: Invalid or no key given of type "+t),this;if(null==i){if(!s)return console.warn("Phaser.Loader: No URL given for file type: "+t+" key: "+e),this;i=e+s}var o={type:t,key:e,path:this.path,url:i,syncPoint:0<this._withSyncPointDepth,data:null,loading:!1,loaded:!1,error:!1};if(n)for(var a in n)o[a]=n[a];e=this.getAssetIndex(t,e);return r&&-1<e?(r=this._fileList[e]).loading||r.loaded?(this._fileList.push(o),this._totalFileCount++):this._fileList[e]=o:-1===e&&(this._fileList.push(o),this._totalFileCount++),this},replaceInFileList:function(t,e,i,n){return this.addToFileList(t,e,i,n,!0)},pack:function(t,e,i,n){if(void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=null),!e&&!i)return console.warn("Phaser.Loader.pack - Both url and data are null. One must be set."),this;var r={type:"packfile",key:t,url:e,path:this.path,syncPoint:!0,data:null,loading:!1,loaded:!1,error:!1,callbackContext:n};i&&("string"==typeof i&&(i=JSON.parse(i)),r.data=i||{},r.loaded=!0);for(var s=0;s<this._fileList.length+1;s++){var o=this._fileList[s];if(!o||!o.loaded&&!o.loading&&"packfile"!==o.type){this._fileList.splice(s,0,r),this._totalPackCount++;break}}return this},image:function(t,e,i){return this.addToFileList("image",t,e,void 0,i,".png")},images:function(t,e){if(Array.isArray(e))for(var i=0;i<t.length;i++)this.image(t[i],e[i]);else for(i=0;i<t.length;i++)this.image(t[i]);return this},text:function(t,e,i){return this.addToFileList("text",t,e,void 0,i,".txt")},json:function(t,e,i){return this.addToFileList("json",t,e,void 0,i,".json")},shader:function(t,e,i){return this.addToFileList("shader",t,e,void 0,i,".frag")},xml:function(t,e,i){return this.addToFileList("xml",t,e,void 0,i,".xml")},script:function(t,e,i,n){return void 0===i&&(i=!1),!1!==i&&void 0===n&&(n=this),this.addToFileList("script",t,e,{syncPoint:!0,callback:i,callbackContext:n},!1,".js")},binary:function(t,e,i,n){return void 0===i&&(i=!1),!1!==i&&void 0===n&&(n=i),this.addToFileList("binary",t,e,{callback:i,callbackContext:n},!1,".bin")},spritesheet:function(t,e,i,n,r,s,o){return void 0===r&&(r=-1),void 0===s&&(s=0),void 0===o&&(o=0),this.addToFileList("spritesheet",t,e,{frameWidth:i,frameHeight:n,frameMax:r,margin:s,spacing:o},!1,".png")},audio:function(t,e,i){return this.game.sound.noAudio?this:(void 0===i&&(i=!0),"string"==typeof e&&(e=[e]),this.addToFileList("audio",t,e,{buffer:null,autoDecode:i}))},audioSprite:function(t,e,i,n,r){return this.game.sound.noAudio||(void 0===i&&(i=null),void 0===n&&(n=null),void 0===r&&(r=!0),this.audio(t,e,r),i?this.json(t+"-audioatlas",i):n?("string"==typeof n&&(n=JSON.parse(n)),this.cache.addJSON(t+"-audioatlas","",n)):console.warn("Phaser.Loader.audiosprite - You must specify either a jsonURL or provide a jsonData object")),this},audiosprite:function(t,e,i,n,r){return this.audioSprite(t,e,i,n,r)},video:function(t,e,i,n){return void 0===i&&(i=this.game.device.firefox?"loadeddata":"canplaythrough"),void 0===n&&(n=!1),"string"==typeof e&&(e=[e]),this.addToFileList("video",t,e,{buffer:null,asBlob:n,loadEvent:i})},tilemap:function(t,e,i,n){if(void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=U.Tilemap.CSV),e||i||(e=n===U.Tilemap.CSV?t+".csv":t+".json"),i){switch(n){case U.Tilemap.CSV:break;case U.Tilemap.TILED_JSON:"string"==typeof i&&(i=JSON.parse(i))}this.cache.addTilemap(t,null,i,n)}else this.addToFileList("tilemap",t,e,{format:n});return this},physics:function(t,e,i,n){return void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=U.Physics.LIME_CORONA_JSON),e||i||(e=t+".json"),i?("string"==typeof i&&(i=JSON.parse(i)),this.cache.addPhysicsData(t,null,i,n)):this.addToFileList("physics",t,e,{format:n}),this},bitmapFont:function(t,e,i,n,r,s){if(null!=e||(e=t+".png"),void 0===i&&(i=null),void 0===n&&(n=null),null===i&&null===n&&(i=t+".xml"),void 0===r&&(r=0),void 0===s&&(s=0),i)this.addToFileList("bitmapfont",t,e,{atlasURL:i,xSpacing:r,ySpacing:s});else if("string"==typeof n){var o,a;try{o=JSON.parse(n)}catch(t){a=this.parseXml(n)}if(!a&&!o)throw new Error("Phaser.Loader. Invalid Bitmap Font atlas given");this.addToFileList("bitmapfont",t,e,{atlasURL:null,atlasData:o||a,atlasType:o?"json":"xml",xSpacing:r,ySpacing:s})}return this},atlasJSONArray:function(t,e,i,n){return this.atlas(t,e,i,n,U.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(t,e,i,n){return this.atlas(t,e,i,n,U.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(t,e,i,n){return void 0===i&&(i=null),void 0===n&&(n=null),i||n||(i=t+".xml"),this.atlas(t,e,i,n,U.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(t,e,i,n,r){if(null!=e||(e=t+".png"),void 0===i&&(i=null),void 0===n&&(n=null),void 0===r&&(r=U.Loader.TEXTURE_ATLAS_JSON_ARRAY),i||n||(i=r===U.Loader.TEXTURE_ATLAS_XML_STARLING?t+".xml":t+".json"),i)this.addToFileList("textureatlas",t,e,{atlasURL:i,format:r});else{switch(r){case U.Loader.TEXTURE_ATLAS_JSON_ARRAY:"string"==typeof n&&(n=JSON.parse(n));break;case U.Loader.TEXTURE_ATLAS_XML_STARLING:if("string"==typeof n){var s=this.parseXml(n);if(!s)throw new Error("Phaser.Loader. Invalid Texture Atlas XML given");n=s}}this.addToFileList("textureatlas",t,e,{atlasURL:null,atlasData:n,format:r})}return this},withSyncPoint:function(t,e){this._withSyncPointDepth++;try{t.call(e||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(t,e){e=this.getAsset(t,e);return e&&(e.file.syncPoint=!0),this},removeFile:function(t,e){e=this.getAsset(t,e);e&&(e.loaded||e.loading||this._fileList.splice(e.index,1))},removeAll:function(){this._fileList.length=0,this._flightQueue.length=0},start:function(){this.isLoading||(this.hasLoaded=!1,this.isLoading=!0,this.updateProgress(),this.processLoadQueue())},processLoadQueue:function(){if(!this.isLoading)return console.warn("Phaser.Loader - active loading canceled / reset"),void this.finishedLoading(!0);for(var t=0;t<this._flightQueue.length;t++)((e=this._flightQueue[t]).loaded||e.error)&&(this._flightQueue.splice(t,1),t--,e.loading=!1,e.requestUrl=null,e.requestObject=null,e.error&&this.onFileError.dispatch(e.key,e),"packfile"!==e.type?(this._loadedFileCount++,this.onFileComplete.dispatch(this.progress,e.key,!e.error,this._loadedFileCount,this._totalFileCount)):"packfile"===e.type&&e.error&&(this._loadedPackCount++,this.onPackComplete.dispatch(e.key,!e.error,this._loadedPackCount,this._totalPackCount)));for(var e,i,n=!1,r=this.enableParallel?U.Math.clamp(this.maxParallelDownloads,1,12):1,t=this._processingHead;t<this._fileList.length;t++)if("packfile"===(e=this._fileList[t]).type&&!e.error&&e.loaded&&t===this._processingHead&&(this.processPack(e),this._loadedPackCount++,this.onPackComplete.dispatch(e.key,!e.error,this._loadedPackCount,this._totalPackCount)),e.loaded||e.error?t===this._processingHead&&(this._processingHead=t+1):!e.loading&&this._flightQueue.length<r&&("packfile"!==e.type||e.data?n||(this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this._flightQueue.push(e),e.loading=!0,this.onFileStart.dispatch(this.progress,e.key,e.url),this.loadFile(e)):(this._flightQueue.push(e),e.loading=!0,this.loadFile(e))),!e.loaded&&e.syncPoint&&(n=!0),this._flightQueue.length>=r||n&&this._loadedPackCount===this._totalPackCount)break;this.updateProgress(),this._processingHead>=this._fileList.length?this.finishedLoading():this._flightQueue.length||(console.warn("Phaser.Loader - aborting: processing queue empty, loading may have stalled"),i=this,setTimeout(function(){i.finishedLoading(!0)},2e3))},finishedLoading:function(t){this.hasLoaded||(this.hasLoaded=!0,this.isLoading=!1,t||this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this.onLoadComplete.dispatch(),this.game.state.loadComplete(),this.reset())},asyncComplete:function(t,e){void 0===e&&(e=""),t.loaded=!0,t.error=!!e,e&&(t.errorMessage=e,console.warn("Phaser.Loader - "+t.type+"["+t.key+"]: "+e)),this.processLoadQueue()},processPack:function(t){var e=t.data[t.key];if(e)for(var i=0;i<e.length;i++){var n=e[i];switch(n.type){case"image":this.image(n.key,n.url,n.overwrite);break;case"text":this.text(n.key,n.url,n.overwrite);break;case"json":this.json(n.key,n.url,n.overwrite);break;case"xml":this.xml(n.key,n.url,n.overwrite);break;case"script":this.script(n.key,n.url,n.callback,t.callbackContext||this);break;case"binary":this.binary(n.key,n.url,n.callback,t.callbackContext||this);break;case"spritesheet":this.spritesheet(n.key,n.url,n.frameWidth,n.frameHeight,n.frameMax,n.margin,n.spacing);break;case"video":this.video(n.key,n.urls);break;case"audio":this.audio(n.key,n.urls,n.autoDecode);break;case"audiosprite":this.audiosprite(n.key,n.urls,n.jsonURL,n.jsonData,n.autoDecode);break;case"tilemap":this.tilemap(n.key,n.url,n.data,U.Tilemap[n.format]);break;case"physics":this.physics(n.key,n.url,n.data,U.Loader[n.format]);break;case"bitmapFont":this.bitmapFont(n.key,n.textureURL,n.atlasURL,n.atlasData,n.xSpacing,n.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(n.key,n.textureURL,n.atlasURL,n.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(n.key,n.textureURL,n.atlasURL,n.atlasData);break;case"atlasXML":this.atlasXML(n.key,n.textureURL,n.atlasURL,n.atlasData);break;case"atlas":this.atlas(n.key,n.textureURL,n.atlasURL,n.atlasData,U.Loader[n.format]);break;case"shader":this.shader(n.key,n.url,n.overwrite)}}else console.warn("Phaser.Loader - "+t.key+": pack has data, but not for pack key")},transformUrl:function(t,e){return!!t&&(t.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)?t:this.baseURL+e.path+t)},loadFile:function(t){switch(t.type){case"packfile":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.fileComplete);break;case"image":case"spritesheet":case"textureatlas":case"bitmapfont":this.loadImageTag(t);break;case"audio":t.url=this.getAudioURL(t.url),t.url?this.game.sound.usingWebAudio?this.xhrLoad(t,this.transformUrl(t.url,t),"arraybuffer",this.fileComplete):this.game.sound.usingAudioTag&&this.loadAudioTag(t):this.fileError(t,null,"No supported audio URL specified or device does not have audio playback support");break;case"video":t.url=this.getVideoURL(t.url),t.url?t.asBlob?this.xhrLoad(t,this.transformUrl(t.url,t),"blob",this.fileComplete):this.loadVideoTag(t):this.fileError(t,null,"No supported video URL specified or device does not have video playback support");break;case"json":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.jsonLoadComplete);break;case"xml":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.xmlLoadComplete);break;case"tilemap":t.format===U.Tilemap.TILED_JSON?this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.jsonLoadComplete):t.format===U.Tilemap.CSV?this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.csvLoadComplete):this.asyncComplete(t,"invalid Tilemap format: "+t.format);break;case"text":case"script":case"shader":case"physics":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.fileComplete);break;case"binary":this.xhrLoad(t,this.transformUrl(t.url,t),"arraybuffer",this.fileComplete)}},loadImageTag:function(t){var e=this;t.data=new Image,t.data.name=t.key,this.crossOrigin&&(t.data.crossOrigin=this.crossOrigin),t.data.onload=function(){t.data.onload&&(t.data.onload=null,t.data.onerror=null,e.fileComplete(t))},t.data.onerror=function(){t.data.onload&&(t.data.onload=null,t.data.onerror=null,e.fileError(t))},t.data.src=this.transformUrl(t.url,t),t.data.complete&&t.data.width&&t.data.height&&(t.data.onload=null,t.data.onerror=null,this.fileComplete(t))},loadVideoTag:function(t){var e=this;t.data=document.createElement("video"),t.data.name=t.key,t.data.controls=!1,t.data.autoplay=!1;var i=function(){t.data.removeEventListener(t.loadEvent,i,!1),t.data.onerror=null,t.data.canplay=!0,U.GAMES[e.game.id].load.fileComplete(t)};t.data.onerror=function(){t.data.removeEventListener(t.loadEvent,i,!1),t.data.onerror=null,t.data.canplay=!1,e.fileError(t)},t.data.addEventListener(t.loadEvent,i,!1),t.data.src=this.transformUrl(t.url,t),t.data.load()},loadAudioTag:function(t){var e,i=this;this.game.sound.touchLocked?(t.data=new Audio,t.data.name=t.key,t.data.preload="auto",t.data.src=this.transformUrl(t.url,t),this.fileComplete(t)):(t.data=new Audio,t.data.name=t.key,e=function(){t.data.removeEventListener("canplaythrough",e,!1),t.data.onerror=null,i.fileComplete(t)},t.data.onerror=function(){t.data.removeEventListener("canplaythrough",e,!1),t.data.onerror=null,i.fileError(t)},t.data.preload="auto",t.data.src=this.transformUrl(t.url,t),t.data.addEventListener("canplaythrough",e,!1),t.data.load())},xhrLoad:function(e,t,i,n,r){var s,o;this.useXDomainRequest&&window.XDomainRequest?this.xhrLoadWithXDR(e,t,i,n,r):((s=new XMLHttpRequest).open("GET",t,!0),s.responseType=i,!1!==this.headers.requestedWith&&s.setRequestHeader("X-Requested-With",this.headers.requestedWith),this.headers[e.type]&&s.setRequestHeader("Accept",this.headers[e.type]),r=r||this.fileError,o=this,s.onload=function(){try{return(4===s.readyState&&400<=s.status&&s.status<=599?r:n).call(o,e,s)}catch(t){o.hasLoaded?window.console&&console.error(t):o.asyncComplete(e,t.message||"Exception")}},s.onerror=function(){try{return r.call(o,e,s)}catch(t){o.hasLoaded?window.console&&console.error(t):o.asyncComplete(e,t.message||"Exception")}},e.requestObject=s,e.requestUrl=t,s.send())},xhrLoadWithXDR:function(e,t,i,n,r){this._warnedAboutXDomainRequest||this.game.device.ie&&!(10<=this.game.device.ieVersion)||(this._warnedAboutXDomainRequest=!0,console.warn("Phaser.Loader - using XDomainRequest outside of IE 9"));var s=new window.XDomainRequest;s.open("GET",t,!0),s.responseType=i,s.timeout=3e3,r=r||this.fileError;var o=this;s.onerror=function(){try{return r.call(o,e,s)}catch(t){o.asyncComplete(e,t.message||"Exception")}},s.ontimeout=function(){try{return r.call(o,e,s)}catch(t){o.asyncComplete(e,t.message||"Exception")}},s.onprogress=function(){},s.onload=function(){try{return(4===s.readyState&&400<=s.status&&s.status<=599?r:n).call(o,e,s)}catch(t){o.asyncComplete(e,t.message||"Exception")}},e.requestObject=s,e.requestUrl=t,setTimeout(function(){s.send()},0)},getVideoURL:function(t){for(var e=0;e<t.length;e++){var i=t[e];if(i.uri){if(n=i.type,i=i.uri,this.game.device.canPlayVideo(n))return i}else{if(0===i.indexOf("blob:")||0===i.indexOf("data:"))return i;0<=i.indexOf("?")&&(i=i.substr(0,i.indexOf("?")));var n=i.substr((Math.max(0,i.lastIndexOf("."))||1/0)+1).toLowerCase();if(this.game.device.canPlayVideo(n))return t[e]}}return null},getAudioURL:function(t){if(this.game.sound.noAudio)return null;for(var e=0;e<t.length;e++){var i=t[e];if(i.uri){if(n=i.type,i=i.uri,this.game.device.canPlayAudio(n))return i}else{if(0===i.indexOf("blob:")||0===i.indexOf("data:"))return i;0<=i.indexOf("?")&&(i=i.substr(0,i.indexOf("?")));var n=i.substr((Math.max(0,i.lastIndexOf("."))||1/0)+1).toLowerCase();if(this.game.device.canPlayAudio(n))return t[e]}}return null},fileError:function(t,e,i){var n="error loading asset from URL "+(t.requestUrl||this.transformUrl(t.url,t));!i&&e&&(i=e.status),i&&(n=n+" ("+i+")"),this.asyncComplete(t,n)},fileComplete:function(t,e){var i=!0;switch(t.type){case"packfile":var n=JSON.parse(e.responseText);t.data=n||{};break;case"image":this.cache.addImage(t.key,t.url,t.data);break;case"spritesheet":this.cache.addSpriteSheet(t.key,t.url,t.data,t.frameWidth,t.frameHeight,t.frameMax,t.margin,t.spacing);break;case"textureatlas":if(null==t.atlasURL)this.cache.addTextureAtlas(t.key,t.url,t.data,t.atlasData,t.format);else if(i=!1,t.format===U.Loader.TEXTURE_ATLAS_JSON_ARRAY||t.format===U.Loader.TEXTURE_ATLAS_JSON_HASH||t.format===U.Loader.TEXTURE_ATLAS_JSON_PYXEL)this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.jsonLoadComplete);else{if(t.format!==U.Loader.TEXTURE_ATLAS_XML_STARLING)throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+t.format);this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.xmlLoadComplete)}break;case"bitmapfont":t.atlasURL?(i=!1,this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",function(t,e){var i;try{i=JSON.parse(e.responseText)}catch(t){}i?(t.atlasType="json",this.jsonLoadComplete(t,e)):(t.atlasType="xml",this.xmlLoadComplete(t,e))})):this.cache.addBitmapFont(t.key,t.url,t.data,t.atlasData,t.atlasType,t.xSpacing,t.ySpacing);break;case"video":if(t.asBlob)try{t.data=e.response}catch(e){throw new Error("Phaser.Loader. Unable to parse video file as Blob: "+t.key)}this.cache.addVideo(t.key,t.url,t.data,t.asBlob);break;case"audio":this.game.sound.usingWebAudio?(t.data=e.response,this.cache.addSound(t.key,t.url,t.data,!0,!1),t.autoDecode&&this.game.sound.decode(t.key)):this.cache.addSound(t.key,t.url,t.data,!1,!0);break;case"text":t.data=e.responseText,this.cache.addText(t.key,t.url,t.data);break;case"shader":t.data=e.responseText,this.cache.addShader(t.key,t.url,t.data);break;case"physics":n=JSON.parse(e.responseText);this.cache.addPhysicsData(t.key,t.url,n,t.format);break;case"script":t.data=document.createElement("script"),t.data.language="javascript",t.data.type="text/javascript",t.data.defer=!1,t.data.text=e.responseText,document.head.appendChild(t.data),t.callback&&(t.data=t.callback.call(t.callbackContext,t.key,e.responseText));break;case"binary":t.callback?t.data=t.callback.call(t.callbackContext,t.key,e.response):t.data=e.response,this.cache.addBinary(t.key,t.data)}i&&this.asyncComplete(t)},jsonLoadComplete:function(t,e){e=JSON.parse(e.responseText);"tilemap"===t.type?this.cache.addTilemap(t.key,t.url,e,t.format):"bitmapfont"===t.type?this.cache.addBitmapFont(t.key,t.url,t.data,e,t.atlasType,t.xSpacing,t.ySpacing):"json"===t.type?this.cache.addJSON(t.key,t.url,e):this.cache.addTextureAtlas(t.key,t.url,t.data,e,t.format),this.asyncComplete(t)},csvLoadComplete:function(t,e){e=e.responseText;this.cache.addTilemap(t.key,t.url,e,t.format),this.asyncComplete(t)},xmlLoadComplete:function(t,e){var i=e.responseText,i=this.parseXml(i);if(!i){e=e.responseType||e.contentType;return console.warn("Phaser.Loader - "+t.key+": invalid XML ("+e+")"),void this.asyncComplete(t,"invalid XML")}"bitmapfont"===t.type?this.cache.addBitmapFont(t.key,t.url,t.data,i,t.atlasType,t.xSpacing,t.ySpacing):"textureatlas"===t.type?this.cache.addTextureAtlas(t.key,t.url,t.data,i,t.format):"xml"===t.type&&this.cache.addXML(t.key,t.url,i),this.asyncComplete(t)},parseXml:function(t){var e;try{window.DOMParser?e=(new DOMParser).parseFromString(t,"text/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t))}catch(t){e=null}return e&&e.documentElement&&!e.getElementsByTagName("parsererror").length?e:null},updateProgress:function(){this.preloadSprite&&(0===this.preloadSprite.direction?this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress):this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite?this.preloadSprite.sprite.updateCrop():this.preloadSprite=null)},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-this._loadedPackCount}},Object.defineProperty(U.Loader.prototype,"progressFloat",{get:function(){var t=this._loadedFileCount/this._totalFileCount*100;return U.Math.clamp(t||0,0,100)}}),Object.defineProperty(U.Loader.prototype,"progress",{get:function(){return Math.round(this.progressFloat)}}),U.Loader.prototype.constructor=U.Loader,U.LoaderParser={bitmapFont:function(t,e,i,n){return this.xmlBitmapFont(t,e,i,n)},xmlBitmapFont:function(t,e,i,n){var r={},s=t.getElementsByTagName("info")[0],o=t.getElementsByTagName("common")[0];r.font=s.getAttribute("face"),r.size=parseInt(s.getAttribute("size"),10),r.lineHeight=parseInt(o.getAttribute("lineHeight"),10)+n,r.chars={};for(var a=t.getElementsByTagName("char"),l=0;l<a.length;l++){var p=parseInt(a[l].getAttribute("id"),10);r.chars[p]={x:parseInt(a[l].getAttribute("x"),10),y:parseInt(a[l].getAttribute("y"),10),width:parseInt(a[l].getAttribute("width"),10),height:parseInt(a[l].getAttribute("height"),10),xOffset:parseInt(a[l].getAttribute("xoffset"),10),yOffset:parseInt(a[l].getAttribute("yoffset"),10),xAdvance:parseInt(a[l].getAttribute("xadvance"),10)+i,kerning:{}}}for(var h=t.getElementsByTagName("kerning"),l=0;l<h.length;l++){var u=parseInt(h[l].getAttribute("first"),10),c=parseInt(h[l].getAttribute("second"),10),d=parseInt(h[l].getAttribute("amount"),10);r.chars[c].kerning[u]=d}return this.finalizeBitmapFont(e,r)},jsonBitmapFont:function(t,e,i,n){var r={font:t.font.info._face,size:parseInt(t.font.info._size,10),lineHeight:parseInt(t.font.common._lineHeight,10)+n,chars:{}};return t.font.chars.char.forEach(function(t){var e=parseInt(t._id,10);r.chars[e]={x:parseInt(t._x,10),y:parseInt(t._y,10),width:parseInt(t._width,10),height:parseInt(t._height,10),xOffset:parseInt(t._xoffset,10),yOffset:parseInt(t._yoffset,10),xAdvance:parseInt(t._xadvance,10)+i,kerning:{}}}),t.font.kernings&&t.font.kernings.kerning&&t.font.kernings.kerning.forEach(function(t){r.chars[t._second].kerning[t._first]=parseInt(t._amount,10)}),this.finalizeBitmapFont(e,r)},finalizeBitmapFont:function(e,i){return Object.keys(i.chars).forEach(function(t){t=i.chars[t];t.texture=new PIXI.Texture(e,new U.Rectangle(t.x,t.y,t.width,t.height))}),i}},U.AudioSprite=function(t,e){for(var i in this.game=t,this.key=e,this.config=this.game.cache.getJSON(e+"-audioatlas"),this.autoplayKey=null,this.autoplay=!1,this.sounds={},this.config.spritemap){var n=this.config.spritemap[i],r=this.game.add.sound(this.key);r.addMarker(i,n.start,n.end-n.start,null,n.loop),this.sounds[i]=r}this.config.autoplay&&(this.autoplayKey=this.config.autoplay,this.play(this.autoplayKey),this.autoplay=this.sounds[this.autoplayKey])},U.AudioSprite.prototype={play:function(t,e){return void 0===e&&(e=1),this.sounds[t].play(t,null,e)},stop:function(t){if(t)this.sounds[t].stop();else for(var e in this.sounds)this.sounds[e].stop()},get:function(t){return this.sounds[t]}},U.AudioSprite.prototype.constructor=U.AudioSprite,U.Sound=function(t,e,i,n,r){void 0===i&&(i=1),void 0===n&&(n=!1),void 0===r&&(r=t.sound.connectToMaster),this.game=t,this.name=e,this.key=e,this.loop=n,this.markers={},this.context=null,this.autoplay=!1,this.totalDuration=0,this.startTime=0,this.currentTime=0,this.duration=0,this.durationMS=0,this.position=0,this.stopTime=0,this.paused=!1,this.pausedPosition=0,this.pausedTime=0,this.isPlaying=!1,this.currentMarker="",this.fadeTween=null,this.pendingPlayback=!1,this.override=!1,this.allowMultiple=!1,this.usingWebAudio=this.game.sound.usingWebAudio,this.usingAudioTag=this.game.sound.usingAudioTag,this.externalNode=null,this.masterGainNode=null,this.gainNode=null,this._sound=null,this.usingWebAudio?(this.context=this.game.sound.context,this.masterGainNode=this.game.sound.masterGain,void 0===this.context.createGain?this.gainNode=this.context.createGainNode():this.gainNode=this.context.createGain(),this.gainNode.gain.value=i*this.game.sound.volume,r&&this.gainNode.connect(this.masterGainNode)):this.usingAudioTag&&(this.game.cache.getSound(e)&&this.game.cache.isSoundReady(e)?(this._sound=this.game.cache.getSoundData(e),this.totalDuration=0,this._sound.duration&&(this.totalDuration=this._sound.duration)):this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this)),this.onDecoded=new U.Signal,this.onPlay=new U.Signal,this.onPause=new U.Signal,this.onResume=new U.Signal,this.onLoop=new U.Signal,this.onStop=new U.Signal,this.onMute=new U.Signal,this.onMarkerComplete=new U.Signal,this.onFadeComplete=new U.Signal,this._volume=i,this._buffer=null,this._muted=!1,this._tempMarker=0,this._tempPosition=0,this._tempVolume=0,this._tempPause=0,this._muteVolume=0,this._tempLoop=0,this._paused=!1,this._onDecodedEventDispatched=!1},U.Sound.prototype={soundHasUnlocked:function(t){t===this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this._sound.duration)},addMarker:function(t,e,i,n,r){null!=i||(i=1),null!=n||(n=1),void 0===r&&(r=!1),this.markers[t]={name:t,start:e,stop:e+i,volume:n,duration:i,durationMS:1e3*i,loop:r}},removeMarker:function(t){delete this.markers[t]},onEndedHandler:function(){this._sound.onended=null,this.isPlaying=!1,this.currentTime=this.durationMS,this.stop()},update:function(){return this.game.cache.checkSoundKey(this.key)?(this.isDecoded&&!this._onDecodedEventDispatched&&(this.onDecoded.dispatch(this),this._onDecodedEventDispatched=!0),this.pendingPlayback&&this.game.cache.isSoundReady(this.key)&&(this.pendingPlayback=!1,this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)),void(this.isPlaying&&(this.currentTime=this.game.time.time-this.startTime,this.currentTime>=this.durationMS&&(this.usingWebAudio?this.loop?(this.onLoop.dispatch(this),this.isPlaying=!1,""===this.currentMarker?(this.currentTime=0,this.startTime=this.game.time.time,this.isPlaying=!0):(this.onMarkerComplete.dispatch(this.currentMarker,this),this.play(this.currentMarker,0,this.volume,!0,!0))):""!==this.currentMarker&&this.stop():this.loop?(this.onLoop.dispatch(this),""===this.currentMarker&&(this.currentTime=0,this.startTime=this.game.time.time),this.isPlaying=!1,this.play(this.currentMarker,0,this.volume,!0,!0)):this.stop())))):void this.destroy()},loopFull:function(t){return this.play(null,0,t,!0)},play:function(t,e,i,n,r){if(void 0!==t&&!1!==t&&null!==t||(t=""),void 0===r&&(r=!0),this.isPlaying&&!this.allowMultiple&&!r&&!this.override)return this;if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||r)){if(this.usingWebAudio){if(void 0===this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(t){}this.externalNode?this._sound.disconnect(this.externalNode):this.gainNode&&this._sound.disconnect(this.gainNode)}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);this.isPlaying=!1}if(""===t&&0<Object.keys(this.markers).length)return this;if(""!==t){if(!this.markers[t])return console.warn("Phaser.Sound.play: audio marker "+t+" doesn't exist"),this;this.currentMarker=t,this.position=this.markers[t].start,this.volume=this.markers[t].volume,this.loop=this.markers[t].loop,this.duration=this.markers[t].duration,this.durationMS=this.markers[t].durationMS,void 0!==i&&(this.volume=i),void 0!==n&&(this.loop=n),this._tempMarker=t,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop}else e=e||0,void 0===i&&(i=this._volume),void 0===n&&(n=this.loop),this.position=Math.max(0,e),this.volume=i,this.loop=n,this.duration=0,this.durationMS=0,this._tempMarker=t,this._tempPosition=e,this._tempVolume=i,this._tempLoop=n;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(this._sound=this.context.createBufferSource(),this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this._buffer=this.game.cache.getSoundData(this.key),this._sound.buffer=this._buffer,this.loop&&""===t&&(this._sound.loop=!0),this.loop||""!==t||(this._sound.onended=this.onEndedHandler.bind(this)),this.totalDuration=this._sound.buffer.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=Math.ceil(1e3*this.totalDuration)),void 0===this._sound.start?this._sound.noteGrainOn(0,this.position,this.duration):this.loop&&""===t?this._sound.start(0,0):this._sound.start(0,this.position,this.duration),this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&!1===this.game.cache.getSound(this.key).isDecoding&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||4===this._sound.readyState)?(this._sound.play(),this.totalDuration=this._sound.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1e3*this.totalDuration),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._muted||this.game.sound.mute?this._sound.volume=0:this._sound.volume=this._volume,this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):this.pendingPlayback=!0,this},restart:function(t,e,i,n){t=t||"",e=e||0,i=i||1,void 0===n&&(n=!1),this.play(t,e,i,n,!0)},pause:function(){this.isPlaying&&this._sound&&(this.paused=!0,this.pausedPosition=this.currentTime,this.pausedTime=this.game.time.time,this._tempPause=this._sound.currentTime,this.onPause.dispatch(this),this.stop())},resume:function(){var t,e;this.paused&&this._sound&&(this.usingWebAudio?(t=Math.max(0,this.position+this.pausedPosition/1e3),this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this.loop&&(this._sound.loop=!0),this.loop||""!==this.currentMarker||(this._sound.onended=this.onEndedHandler.bind(this)),e=this.duration-this.pausedPosition/1e3,void 0===this._sound.start?this._sound.noteGrainOn(0,t,e):this.loop&&this.game.device.chrome?42===this.game.device.chromeVersion?this._sound.start(0):this._sound.start(0,t):this._sound.start(0,t,e)):(this._sound.currentTime=this._tempPause,this._sound.play()),this.isPlaying=!0,this.paused=!1,this.startTime+=this.game.time.time-this.pausedTime,this.onResume.dispatch(this))},stop:function(){if(this.isPlaying&&this._sound)if(this.usingWebAudio){if(void 0===this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(t){}this.externalNode?this._sound.disconnect(this.externalNode):this.gainNode&&this._sound.disconnect(this.gainNode)}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);var t;this.pendingPlayback=!1,this.isPlaying=!1,this.paused||(t=this.currentMarker,""!==this.currentMarker&&this.onMarkerComplete.dispatch(this.currentMarker,this),this.currentMarker="",null!==this.fadeTween&&this.fadeTween.stop(),this.onStop.dispatch(this,t))},fadeIn:function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=this.currentMarker),this.paused||(this.play(i,0,0,e),this.fadeTo(t,1))},fadeOut:function(t){this.fadeTo(t,0)},fadeTo:function(t,e){this.isPlaying&&!this.paused&&e!==this.volume&&(void 0===t&&(t=1e3),void 0!==e?(this.fadeTween=this.game.add.tween(this).to({volume:e},t,U.Easing.Linear.None,!0),this.fadeTween.onComplete.add(this.fadeComplete,this)):console.warn("Phaser.Sound.fadeTo: No Volume Specified."))},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume),0===this.volume&&this.stop()},updateGlobalVolume:function(t){this.usingAudioTag&&this._sound&&(this._sound.volume=t*this._volume)},destroy:function(t){void 0===t&&(t=!0),this.stop(),t?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose())}},U.Sound.prototype.constructor=U.Sound,Object.defineProperty(U.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}}),Object.defineProperty(U.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}}),Object.defineProperty(U.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(t){(t=t||!1)!==this._muted&&(t?(this._muted=!0,this._muteVolume=this._tempVolume,this.usingWebAudio?this.gainNode.gain.value=0:this.usingAudioTag&&this._sound&&(this._sound.volume=0)):(this._muted=!1,this.usingWebAudio?this.gainNode.gain.value=this._muteVolume:this.usingAudioTag&&this._sound&&(this._sound.volume=this._muteVolume)),this.onMute.dispatch(this))}}),Object.defineProperty(U.Sound.prototype,"volume",{get:function(){return this._volume},set:function(t){return this.game.device.firefox&&this.usingAudioTag&&(t=this.game.math.clamp(t,0,1)),this._muted?void(this._muteVolume=t):(this._tempVolume=t,this._volume=t,void(this.usingWebAudio?this.gainNode.gain.value=t:this.usingAudioTag&&this._sound&&(this._sound.volume=t)))}}),U.SoundManager=function(t){this.game=t,this.onSoundDecode=new U.Signal,this.onVolumeChange=new U.Signal,this.onMute=new U.Signal,this.onUnMute=new U.Signal,this.context=null,this.usingWebAudio=!1,this.usingAudioTag=!1,this.noAudio=!1,this.connectToMaster=!0,this.touchLocked=!1,this.channels=32,this.muteOnPause=!0,this._codeMuted=!1,this._muted=!1,this._unlockSource=null,this._volume=1,this._sounds=[],this._watchList=new U.ArraySet,this._watching=!1,this._watchCallback=null,this._watchContext=null},U.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&!1===this.game.device.webAudio&&(this.channels=1),window.PhaserGlobal){if(!0===window.PhaserGlobal.disableAudio)return this.noAudio=!0,void(this.touchLocked=!1);if(!0===window.PhaserGlobal.disableWebAudio)return this.usingAudioTag=!0,void(this.touchLocked=!1)}if(window.PhaserGlobal&&window.PhaserGlobal.audioContext)this.context=window.PhaserGlobal.audioContext;else if(window.AudioContext)try{this.context=new window.AudioContext}catch(t){this.context=null,this.usingWebAudio=!1,this.touchLocked=!1}else if(window.webkitAudioContext)try{this.context=new window.webkitAudioContext}catch(t){this.context=null,this.usingWebAudio=!1,this.touchLocked=!1}if(null===this.context){if(void 0===window.Audio)return void(this.noAudio=!0);this.usingAudioTag=!0}else this.usingWebAudio=!0,void 0===this.context.createGain?this.masterGain=this.context.createGainNode():this.masterGain=this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination);this.noAudio||(!this.game.device.cocoonJS&&this.game.device.iOS||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock)&&this.setTouchLock()},setTouchLock:function(){this.noAudio||window.PhaserGlobal&&!0===window.PhaserGlobal.disableAudio||(8<this.game.device.iOSVersion?this.game.input.touch.addTouchLockCallback(this.unlock,this,!0):this.game.input.touch.addTouchLockCallback(this.unlock,this),this.touchLocked=!0)},unlock:function(){return this.noAudio||!this.touchLocked||null!==this._unlockSource||(this.usingAudioTag?(this.touchLocked=!1,this._unlockSource=null):this.usingWebAudio&&(t=this.context.createBuffer(1,1,22050),this._unlockSource=this.context.createBufferSource(),this._unlockSource.buffer=t,this._unlockSource.connect(this.context.destination),void 0===this._unlockSource.start?this._unlockSource.noteOn(0):this._unlockSource.start(0))),!0;var t},stopAll:function(){if(!this.noAudio)for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].stop()},pauseAll:function(){if(!this.noAudio)for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].pause()},resumeAll:function(){if(!this.noAudio)for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].resume()},decode:function(e,i){i=i||null;var t=this.game.cache.getSoundData(e);if(t&&!1===this.game.cache.isSoundDecoded(e)){this.game.cache.updateSound(e,"isDecoding",!0);var n=this;try{this.context.decodeAudioData(t,function(t){t&&(n.game.cache.decodedSound(e,t),n.onSoundDecode.dispatch(e,i))})}catch(e){}}},setDecodedCallback:function(t,e,i){"string"==typeof t&&(t=[t]),this._watchList.reset();for(var n=0;n<t.length;n++)t[n]instanceof U.Sound?this.game.cache.isSoundDecoded(t[n].key)||this._watchList.add(t[n].key):this.game.cache.isSoundDecoded(t[n])||this._watchList.add(t[n]);0===this._watchList.total?(this._watching=!1,e.call(i)):(this._watching=!0,this._watchCallback=e,this._watchContext=i)},update:function(){if(!this.noAudio){!this.touchLocked||null===this._unlockSource||this._unlockSource.playbackState!==this._unlockSource.PLAYING_STATE&&this._unlockSource.playbackState!==this._unlockSource.FINISHED_STATE||(this.touchLocked=!1,this._unlockSource=null);for(var t=0;t<this._sounds.length;t++)this._sounds[t].update();if(this._watching){for(var e=this._watchList.first;e;)this.game.cache.isSoundDecoded(e)&&this._watchList.remove(e),e=this._watchList.next;0===this._watchList.total&&(this._watching=!1,this._watchCallback.call(this._watchContext))}}},add:function(t,e,i,n){void 0===e&&(e=1),void 0===i&&(i=!1),void 0===n&&(n=this.connectToMaster);n=new U.Sound(this.game,t,e,i,n);return this._sounds.push(n),n},addSprite:function(t){return new U.AudioSprite(this.game,t)},remove:function(t){for(var e=this._sounds.length;e--;)if(this._sounds[e]===t)return this._sounds[e].destroy(!1),this._sounds.splice(e,1),!0;return!1},removeByKey:function(t){for(var e=this._sounds.length,i=0;e--;)this._sounds[e].key===t&&(this._sounds[e].destroy(!1),this._sounds.splice(e,1),i++);return i},play:function(t,e,i){if(!this.noAudio){i=this.add(t,e,i);return i.play(),i}},setMute:function(){if(!this._muted){this._muted=!0,this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0);for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].mute=!0);this.onMute.dispatch()}},unsetMute:function(){if(this._muted&&!this._codeMuted){this._muted=!1,this.usingWebAudio&&(this.masterGain.gain.value=this._muteVolume);for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].mute=!1);this.onUnMute.dispatch()}},destroy:function(){this.stopAll();for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].destroy();this._sounds=[],this.onSoundDecode.dispose(),this.context&&(window.PhaserGlobal?window.PhaserGlobal.audioContext=this.context:this.context.close&&this.context.close())}},U.SoundManager.prototype.constructor=U.SoundManager,Object.defineProperty(U.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(t){(t=t||!1)?this._muted||(this._codeMuted=!0,this.setMute()):this._muted&&(this._codeMuted=!1,this.unsetMute())}}),Object.defineProperty(U.SoundManager.prototype,"volume",{get:function(){return this._volume},set:function(t){if(t<0?t=0:1<t&&(t=1),this._volume!==t){if(this._volume=t,this.usingWebAudio)this.masterGain.gain.value=t;else for(var e=0;e<this._sounds.length;e++)this._sounds[e].usingAudioTag&&this._sounds[e].updateGlobalVolume(t);this.onVolumeChange.dispatch(t)}}}),U.ScaleManager=function(t,e,i){this.game=t,this.dom=U.DOM,this.grid=null,this.width=0,this.height=0,this.minWidth=null,this.maxWidth=null,this.minHeight=null,this.maxHeight=null,this.offset=new U.Point,this.forceLandscape=!1,this.forcePortrait=!1,this.incorrectOrientation=!1,this._pageAlignHorizontally=!1,this._pageAlignVertically=!1,this.onOrientationChange=new U.Signal,this.enterIncorrectOrientation=new U.Signal,this.leaveIncorrectOrientation=new U.Signal,this.hasPhaserSetFullScreen=!1,this.fullScreenTarget=null,this._createdFullScreenTarget=null,this.onFullScreenInit=new U.Signal,this.onFullScreenChange=new U.Signal,this.onFullScreenError=new U.Signal,this.screenOrientation=this.dom.getScreenOrientation(),this.scaleFactor=new U.Point(1,1),this.scaleFactorInversed=new U.Point(1,1),this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0},this.bounds=new U.Rectangle,this.aspectRatio=0,this.sourceAspectRatio=0,this.event=null,this.windowConstraints={right:"layout",bottom:""},this.compatibility={supportsFullScreen:!1,orientationFallback:null,noMargins:!1,scrollTo:null,forceMinimumDocumentHeight:!1,canExpandParent:!0,clickTrampoline:""},this._scaleMode=U.ScaleManager.NO_SCALE,this._fullScreenScaleMode=U.ScaleManager.NO_SCALE,this.parentIsWindow=!1,this.parentNode=null,this.parentScaleFactor=new U.Point(1,1),this.trackParentInterval=2e3,this.onSizeChange=new U.Signal,this.onResize=null,this.onResizeContext=null,this._pendingScaleMode=null,this._fullScreenRestore=null,this._gameSize=new U.Rectangle,this._userScaleFactor=new U.Point(1,1),this._userScaleTrim=new U.Point(0,0),this._lastUpdate=0,this._updateThrottle=0,this._updateThrottleReset=100,this._parentBounds=new U.Rectangle,this._tempBounds=new U.Rectangle,this._lastReportedCanvasSize=new U.Rectangle,this._lastReportedGameSize=new U.Rectangle,this._booted=!1,t.config&&this.parseConfig(t.config),this.setupScale(e,i)},U.ScaleManager.EXACT_FIT=0,U.ScaleManager.NO_SCALE=1,U.ScaleManager.SHOW_ALL=2,U.ScaleManager.RESIZE=3,U.ScaleManager.USER_SCALE=4,U.ScaleManager.prototype={boot:function(){var t=this.compatibility;t.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS,this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(this.game.device.android&&!this.game.device.chrome?t.scrollTo=new U.Point(0,1):t.scrollTo=new U.Point(0,0)),this.game.device.desktop?(t.orientationFallback="screen",t.clickTrampoline="when-not-mouse"):(t.orientationFallback="",t.clickTrampoline="");var e=this;this._orientationChange=function(t){return e.orientationChange(t)},this._windowResize=function(t){return e.windowResize(t)},window.addEventListener("orientationchange",this._orientationChange,!1),window.addEventListener("resize",this._windowResize,!1),this.compatibility.supportsFullScreen&&(this._fullScreenChange=function(t){return e.fullScreenChange(t)},this._fullScreenError=function(t){return e.fullScreenError(t)},document.addEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.addEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.addEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.addEventListener("fullscreenchange",this._fullScreenChange,!1),document.addEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.addEventListener("mozfullscreenerror",this._fullScreenError,!1),document.addEventListener("MSFullscreenError",this._fullScreenError,!1),document.addEventListener("fullscreenerror",this._fullScreenError,!1)),this.game.onResume.add(this._gameResumed,this),this.dom.getOffset(this.game.canvas,this.offset),this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height),this.setGameSize(this.game.width,this.game.height),this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback),U.FlexGrid&&(this.grid=new U.FlexGrid(this,this.width,this.height)),this._booted=!0,null!==this._pendingScaleMode&&(this.scaleMode=this._pendingScaleMode,this._pendingScaleMode=null)},parseConfig:function(t){void 0!==t.scaleMode&&(this._booted?this.scaleMode=t.scaleMode:this._pendingScaleMode=t.scaleMode),void 0!==t.fullScreenScaleMode&&(this.fullScreenScaleMode=t.fullScreenScaleMode),t.fullScreenTarget&&(this.fullScreenTarget=t.fullScreenTarget)},setupScale:function(t,e){var i=new U.Rectangle;""!==this.game.parent&&("string"==typeof this.game.parent?r=document.getElementById(this.game.parent):this.game.parent&&1===this.game.parent.nodeType&&(r=this.game.parent)),r?(this.parentNode=r,this.parentIsWindow=!1,this.getParentBounds(this._parentBounds),i.width=this._parentBounds.width,i.height=this._parentBounds.height,this.offset.set(this._parentBounds.x,this._parentBounds.y)):(this.parentNode=null,this.parentIsWindow=!0,i.width=this.dom.visualBounds.width,i.height=this.dom.visualBounds.height,this.offset.set(0,0));var n=0,r=0,n="number"==typeof t?t:(this.parentScaleFactor.x=parseInt(t,10)/100,i.width*this.parentScaleFactor.x),r="number"==typeof e?e:(this.parentScaleFactor.y=parseInt(e,10)/100,i.height*this.parentScaleFactor.y);n=Math.floor(n),r=Math.floor(r),this._gameSize.setTo(0,0,n,r),this.updateDimensions(n,r,!1)},_gameResumed:function(){this.queueUpdate(!0)},setGameSize:function(t,e){this._gameSize.setTo(0,0,t,e),this.currentScaleMode!==U.ScaleManager.RESIZE&&this.updateDimensions(t,e,!0),this.queueUpdate(!0)},setUserScale:function(t,e,i,n){this._userScaleFactor.setTo(t,e),this._userScaleTrim.setTo(0|i,0|n),this.queueUpdate(!0)},setResizeCallback:function(t,e){this.onResize=t,this.onResizeContext=e},signalSizeChange:function(){var t,e;U.Rectangle.sameDimensions(this,this._lastReportedCanvasSize)&&U.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)||(t=this.width,e=this.height,this._lastReportedCanvasSize.setTo(0,0,t,e),this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height),this.grid&&this.grid.onResize(t,e),this.onSizeChange.dispatch(this,t,e),this.currentScaleMode===U.ScaleManager.RESIZE&&(this.game.state.resize(t,e),this.game.load.resize(t,e)))},setMinMax:function(t,e,i,n){this.minWidth=t,this.minHeight=e,void 0!==i&&(this.maxWidth=i),void 0!==n&&(this.maxHeight=n)},preUpdate:function(){var t,e,i,n;this.game.time.time<this._lastUpdate+this._updateThrottle||(t=this._updateThrottle,this._updateThrottleReset=400<=t?0:100,this.dom.getOffset(this.game.canvas,this.offset),e=this._parentBounds.width,i=this._parentBounds.height,e=(n=this.getParentBounds(this._parentBounds)).width!==e||n.height!==i,i=this.updateOrientationState(),(e||i)&&(this.onResize&&this.onResize.call(this.onResizeContext,this,n),this.updateLayout(),this.signalSizeChange()),n=2*this._updateThrottle,this._updateThrottle<t&&(n=Math.min(t,this._updateThrottleReset)),this._updateThrottle=U.Math.clamp(n,25,this.trackParentInterval),this._lastUpdate=this.game.time.time)},pauseUpdate:function(){this.preUpdate(),this._updateThrottle=this.trackParentInterval},updateDimensions:function(t,e,i){this.width=t*this.parentScaleFactor.x,this.height=e*this.parentScaleFactor.y,this.game.width=this.width,this.game.height=this.height,this.sourceAspectRatio=this.width/this.height,this.updateScalingAndBounds(),i&&(this.game.renderer.resize(this.width,this.height),this.game.camera.setSize(this.width,this.height),this.game.world.resize(this.width,this.height))},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height,this.scaleFactorInversed.x=this.width/this.game.width,this.scaleFactorInversed.y=this.height/this.game.height,this.aspectRatio=this.width/this.height,this.game.canvas&&this.dom.getOffset(this.game.canvas,this.offset),this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height),this.game.input&&this.game.input.scale&&this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)},forceOrientation:function(t,e){void 0===e&&(e=!1),this.forceLandscape=t,this.forcePortrait=e,this.queueUpdate(!0)},classifyOrientation:function(t){return"portrait-primary"===t||"portrait-secondary"===t?"portrait":"landscape-primary"===t||"landscape-secondary"===t?"landscape":null},updateOrientationState:function(){var t=this.screenOrientation,e=this.incorrectOrientation;this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback),this.incorrectOrientation=this.forceLandscape&&!this.isLandscape||this.forcePortrait&&!this.isPortrait;var i=t!==this.screenOrientation,n=e!==this.incorrectOrientation;return n&&(this.incorrectOrientation?this.enterIncorrectOrientation:this.leaveIncorrectOrientation).dispatch(),(i||n)&&this.onOrientationChange.dispatch(this,t,e),i||n},orientationChange:function(t){this.event=t,this.queueUpdate(!0)},windowResize:function(t){this.event=t,this.queueUpdate(!0)},scrollTop:function(){var t=this.compatibility.scrollTo;t&&window.scrollTo(t.x,t.y)},refresh:function(){this.scrollTop(),this.queueUpdate(!0)},updateLayout:function(){var t=this.currentScaleMode;t!==U.ScaleManager.RESIZE?(this.scrollTop(),this.compatibility.forceMinimumDocumentHeight&&(document.documentElement.style.minHeight=window.innerHeight+"px"),this.incorrectOrientation?this.setMaximum():t===U.ScaleManager.EXACT_FIT?this.setExactFit():t===U.ScaleManager.SHOW_ALL?(!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent&&(this.setShowAll(!0),this.resetCanvas()),this.setShowAll()):t===U.ScaleManager.NO_SCALE?(this.width=this.game.width,this.height=this.game.height):t===U.ScaleManager.USER_SCALE&&(this.width=this.game.width*this._userScaleFactor.x-this._userScaleTrim.x,this.height=this.game.height*this._userScaleFactor.y-this._userScaleTrim.y),this.compatibility.canExpandParent||t!==U.ScaleManager.SHOW_ALL&&t!==U.ScaleManager.USER_SCALE||(t=this.getParentBounds(this._tempBounds),this.width=Math.min(this.width,t.width),this.height=Math.min(this.height,t.height)),this.width=0|this.width,this.height=0|this.height,this.reflowCanvas()):this.reflowGame()},getParentBounds:function(t){var e,i=t||new U.Rectangle,n=this.boundingParent,r=this.dom.visualBounds,s=this.dom.layoutBounds;return n?(t=n.getBoundingClientRect(),n=(n.offsetParent||n).getBoundingClientRect(),i.setTo(t.left-n.left,t.top-n.top,t.width,t.height),(t=this.windowConstraints).right&&(e="layout"===t.right?s:r,i.right=Math.min(i.right,e.width)),t.bottom&&(e="layout"===t.bottom?s:r,i.bottom=Math.min(i.bottom,e.height))):i.setTo(0,0,r.width,r.height),i.setTo(Math.round(i.x),Math.round(i.y),Math.round(i.width),Math.round(i.height)),i},alignCanvas:function(t,e){var i,n,r,s,o=this.getParentBounds(this._tempBounds),a=this.game.canvas,l=this.margin;t&&(l.left=l.right=0,i=a.getBoundingClientRect(),this.width<o.width&&!this.incorrectOrientation&&(n=i.left-o.x,r=o.width/2-this.width/2,s=(r=Math.max(r,0))-n,l.left=Math.round(s)),a.style.marginLeft=l.left+"px",0!==l.left&&(l.right=-(o.width-i.width-l.left),a.style.marginRight=l.right+"px")),e&&(l.top=l.bottom=0,i=a.getBoundingClientRect(),this.height<o.height&&!this.incorrectOrientation&&(n=i.top-o.y,r=o.height/2-this.height/2,s=(r=Math.max(r,0))-n,l.top=Math.round(s)),a.style.marginTop=l.top+"px",0!==l.top&&(l.bottom=-(o.height-i.height-l.top),a.style.marginBottom=l.bottom+"px")),l.x=l.left,l.y=l.top},reflowGame:function(){this.resetCanvas("","");var t=this.getParentBounds(this._tempBounds);this.updateDimensions(t.width,t.height,!0)},reflowCanvas:function(){this.incorrectOrientation||(this.width=U.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width),this.height=U.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height)),this.resetCanvas(),this.compatibility.noMargins||(this.isFullScreen&&this._createdFullScreenTarget?this.alignCanvas(!0,!0):this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically)),this.updateScalingAndBounds()},resetCanvas:function(t,e){void 0===t&&(t=this.width+"px"),void 0===e&&(e=this.height+"px");var i=this.game.canvas;this.compatibility.noMargins||(i.style.marginLeft="",i.style.marginTop="",i.style.marginRight="",i.style.marginBottom=""),i.style.width=t,i.style.height=e},queueUpdate:function(t){t&&(this._parentBounds.width=0,this._parentBounds.height=0),this._updateThrottle=this._updateThrottleReset},reset:function(t){t&&this.grid&&this.grid.reset()},setMaximum:function(){this.width=this.dom.visualBounds.width,this.height=this.dom.visualBounds.height},setShowAll:function(t){var e=this.getParentBounds(this._tempBounds),i=e.width,e=e.height,i=t?Math.max(e/this.game.height,i/this.game.width):Math.min(e/this.game.height,i/this.game.width);this.width=Math.round(this.game.width*i),this.height=Math.round(this.game.height*i)},setExactFit:function(){var t=this.getParentBounds(this._tempBounds);this.width=t.width,this.height=t.height,this.isFullScreen||(this.maxWidth&&(this.width=Math.min(this.width,this.maxWidth)),this.maxHeight&&(this.height=Math.min(this.height,this.maxHeight)))},createFullScreenTarget:function(){var t=document.createElement("div");return t.style.margin="0",t.style.padding="0",t.style.background="#000",t},startFullScreen:function(t,e){if(this.isFullScreen)return!1;if(this.compatibility.supportsFullScreen){if("when-not-mouse"===this.compatibility.clickTrampoline){var i=this.game.input;if(i.activePointer&&i.activePointer!==i.mousePointer&&(e||!1!==e))return void i.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[t,!1])}void 0!==t&&this.game.renderType===U.CANVAS&&(this.game.stage.smoothed=t);i=this.fullScreenTarget;i||(this.cleanupCreatedTarget(),this._createdFullScreenTarget=this.createFullScreenTarget(),i=this._createdFullScreenTarget);t={targetElement:i};return this.hasPhaserSetFullScreen=!0,this.onFullScreenInit.dispatch(this,t),this._createdFullScreenTarget&&((t=this.game.canvas).parentNode.insertBefore(i,t),i.appendChild(t)),this.game.device.fullscreenKeyboard?i[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT):i[this.game.device.requestFullscreen](),!0}var n=this;setTimeout(function(){n.fullScreenError()},10)},stopFullScreen:function(){return!(!this.isFullScreen||!this.compatibility.supportsFullScreen||(this.hasPhaserSetFullScreen=!1,document[this.game.device.cancelFullscreen](),0))},cleanupCreatedTarget:function(){var t,e=this._createdFullScreenTarget;e&&e.parentNode&&((t=e.parentNode).insertBefore(this.game.canvas,e),t.removeChild(e)),this._createdFullScreenTarget=null},prepScreenMode:function(t){var e=!!this._createdFullScreenTarget,i=this._createdFullScreenTarget||this.fullScreenTarget;t?!e&&this.fullScreenScaleMode!==U.ScaleManager.EXACT_FIT||i===this.game.canvas||(this._fullScreenRestore={targetWidth:i.style.width,targetHeight:i.style.height},i.style.width="100%",i.style.height="100%"):(this._fullScreenRestore&&(i.style.width=this._fullScreenRestore.targetWidth,i.style.height=this._fullScreenRestore.targetHeight,this._fullScreenRestore=null),this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.resetCanvas())},fullScreenChange:function(t){this.event=t,this.isFullScreen?this.prepScreenMode(!0):(this.prepScreenMode(!1),this.cleanupCreatedTarget()),this.updateLayout(),this.queueUpdate(!0),this.onFullScreenChange.dispatch(this,this.width,this.height)},fullScreenError:function(t){this.event=t,this.cleanupCreatedTarget(),console.warn("Phaser.ScaleManager: requestFullscreen failed or device does not support the Fullscreen API"),this.onFullScreenError.dispatch(this)},scaleSprite:function(t,e,i,n){if(void 0===e&&(e=this.width),void 0===i&&(i=this.height),void 0===n&&(n=!1),!t||!t.scale)return t;if(t.scale.x=1,t.scale.y=1,t.width<=0||t.height<=0||e<=0||i<=0)return t;var r=t.height*e/t.width,s=t.width*i/t.height,i=i;return(e<s?n:!n)?(t.width=Math.floor(e),t.height=Math.floor(r)):(t.width=Math.floor(s),t.height=Math.floor(i)),t},destroy:function(){this.game.onResume.remove(this._gameResumed,this),window.removeEventListener("orientationchange",this._orientationChange,!1),window.removeEventListener("resize",this._windowResize,!1),this.compatibility.supportsFullScreen&&(document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.removeEventListener("fullscreenchange",this._fullScreenChange,!1),document.removeEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.removeEventListener("mozfullscreenerror",this._fullScreenError,!1),document.removeEventListener("MSFullscreenError",this._fullScreenError,!1),document.removeEventListener("fullscreenerror",this._fullScreenError,!1))}},U.ScaleManager.prototype.constructor=U.ScaleManager,Object.defineProperty(U.ScaleManager.prototype,"boundingParent",{get:function(){return!(this.parentIsWindow||this.isFullScreen&&this.hasPhaserSetFullScreen&&!this._createdFullScreenTarget)&&this.game.canvas&&this.game.canvas.parentNode||null}}),Object.defineProperty(U.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(t){return t!==this._scaleMode&&(this.isFullScreen||(this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.queueUpdate(!0)),this._scaleMode=t),this._scaleMode}}),Object.defineProperty(U.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},set:function(t){return t!==this._fullScreenScaleMode&&(this.isFullScreen?(this.prepScreenMode(!1),this._fullScreenScaleMode=t,this.prepScreenMode(!0),this.queueUpdate(!0)):this._fullScreenScaleMode=t),this._fullScreenScaleMode}}),Object.defineProperty(U.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}}),Object.defineProperty(U.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},set:function(t){t!==this._pageAlignHorizontally&&(this._pageAlignHorizontally=t,this.queueUpdate(!0))}}),Object.defineProperty(U.ScaleManager.prototype,"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(t){t!==this._pageAlignVertically&&(this._pageAlignVertically=t,this.queueUpdate(!0))}}),Object.defineProperty(U.ScaleManager.prototype,"isFullScreen",{get:function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}}),Object.defineProperty(U.ScaleManager.prototype,"isPortrait",{get:function(){return"portrait"===this.classifyOrientation(this.screenOrientation)}}),Object.defineProperty(U.ScaleManager.prototype,"isLandscape",{get:function(){return"landscape"===this.classifyOrientation(this.screenOrientation)}}),Object.defineProperty(U.ScaleManager.prototype,"isGamePortrait",{get:function(){return this.height>this.width}}),Object.defineProperty(U.ScaleManager.prototype,"isGameLandscape",{get:function(){return this.width>this.height}}),U.Utils.Debug=function(t){this.game=t,this.sprite=null,this.bmd=null,this.canvas=null,this.context=null,this.font="14px Courier",this.columnWidth=100,this.lineHeight=16,this.renderShadow=!0,this.currentX=0,this.currentY=0,this.currentAlpha=1,this.dirty=!1},U.Utils.Debug.prototype={boot:function(){this.game.renderType===U.CANVAS?this.context=this.game.context:(this.bmd=new U.BitmapData(this.game,"__DEBUG",this.game.width,this.game.height,!0),this.sprite=this.game.make.image(0,0,this.bmd),this.game.stage.addChild(this.sprite),this.game.scale.onSizeChange.add(this.resize,this),this.canvas=PIXI.CanvasPool.create(this,this.game.width,this.game.height),this.context=this.canvas.getContext("2d"))},resize:function(t,e,i){this.bmd.resize(e,i),this.canvas.width=e,this.canvas.height=i},preUpdate:function(){this.dirty&&this.sprite&&(this.bmd.clear(),this.bmd.draw(this.canvas,0,0),this.context.clearRect(0,0,this.game.width,this.game.height),this.dirty=!1)},reset:function(){this.context&&this.context.clearRect(0,0,this.game.width,this.game.height),this.sprite&&this.bmd.clear()},start:function(t,e,i,n){"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0),i=i||"rgb(255,255,255)",void 0===n&&(n=0),this.currentX=t,this.currentY=e,this.currentColor=i,this.columnWidth=n,this.dirty=!0,this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.strokeStyle=i,this.context.fillStyle=i,this.context.font=this.font,this.context.globalAlpha=this.currentAlpha},stop:function(){this.context.restore()},line:function(){for(var t=this.currentX,e=0;e<arguments.length;e++)this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(arguments[e],t+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(arguments[e],t,this.currentY),t+=this.columnWidth;this.currentY+=this.lineHeight},soundInfo:function(t,e,i,n){this.start(e,i,n),this.line("Sound: "+t.key+" Locked: "+t.game.sound.touchLocked),this.line("Is Ready?: "+this.game.cache.isSoundReady(t.key)+" Pending Playback: "+t.pendingPlayback),this.line("Decoded: "+t.isDecoded+" Decoding: "+t.isDecoding),this.line("Total Duration: "+t.totalDuration+" Playing: "+t.isPlaying),this.line("Time: "+t.currentTime),this.line("Volume: "+t.volume+" Muted: "+t.mute),this.line("WebAudio: "+t.usingWebAudio+" Audio: "+t.usingAudioTag),""!==t.currentMarker&&(this.line("Marker: "+t.currentMarker+" Duration: "+t.duration+" (ms: "+t.durationMS+")"),this.line("Start: "+t.markers[t.currentMarker].start+" Stop: "+t.markers[t.currentMarker].stop),this.line("Position: "+t.position)),this.stop()},cameraInfo:function(t,e,i,n){this.start(e,i,n),this.line("Camera ("+t.width+" x "+t.height+")"),this.line("X: "+t.x+" Y: "+t.y),t.bounds&&this.line("Bounds x: "+t.bounds.x+" Y: "+t.bounds.y+" w: "+t.bounds.width+" h: "+t.bounds.height),this.line("View x: "+t.view.x+" Y: "+t.view.y+" w: "+t.view.width+" h: "+t.view.height),this.line("Total in view: "+t.totalInView),this.stop()},timer:function(t,e,i,n){this.start(e,i,n),this.line("Timer (running: "+t.running+" expired: "+t.expired+")"),this.line("Next Tick: "+t.next+" Duration: "+t.duration),this.line("Paused: "+t.paused+" Length: "+t.length),this.stop()},pointer:function(t,e,i,n,r){null!=t&&(void 0===e&&(e=!1),i=i||"rgba(0,255,0,0.5)",n=n||"rgba(255,0,0,0.5)",!0===e&&!0===t.isUp||(this.start(t.x,t.y-100,r),this.context.beginPath(),this.context.arc(t.x,t.y,t.circle.radius,0,2*Math.PI),t.active?this.context.fillStyle=i:this.context.fillStyle=n,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(t.positionDown.x,t.positionDown.y),this.context.lineTo(t.position.x,t.position.y),this.context.lineWidth=2,this.context.stroke(),this.context.closePath(),this.line("ID: "+t.id+" Active: "+t.active),this.line("World X: "+t.worldX+" World Y: "+t.worldY),this.line("Screen X: "+t.x+" Screen Y: "+t.y+" In: "+t.withinGame),this.line("Duration: "+t.duration+" ms"),this.line("is Down: "+t.isDown+" is Up: "+t.isUp),this.stop()))},spriteInputInfo:function(t,e,i,n){this.start(e,i,n),this.line("Sprite Input: ("+t.width+" x "+t.height+")"),this.line("x: "+t.input.pointerX().toFixed(1)+" y: "+t.input.pointerY().toFixed(1)),this.line("over: "+t.input.pointerOver()+" duration: "+t.input.overDuration().toFixed(0)),this.line("down: "+t.input.pointerDown()+" duration: "+t.input.downDuration().toFixed(0)),this.line("just over: "+t.input.justOver()+" just out: "+t.input.justOut()),this.stop()},key:function(t,e,i,n){this.start(e,i,n,150),this.line("Key:",t.keyCode,"isDown:",t.isDown),this.line("justDown:",t.justDown,"justUp:",t.justUp),this.line("Time Down:",t.timeDown.toFixed(0),"duration:",t.duration.toFixed(0)),this.stop()},inputInfo:function(t,e,i){this.start(t,e,i),this.line("Input"),this.line("X: "+this.game.input.x+" Y: "+this.game.input.y),this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY),this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1)),this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY),this.stop()},spriteBounds:function(t,e,i){t=t.getBounds();t.x+=this.game.camera.x,t.y+=this.game.camera.y,this.rectangle(t,e,i)},ropeSegments:function(t,e,i){var t=t.segments,n=this;t.forEach(function(t){n.rectangle(t,e,i)},this)},spriteInfo:function(t,e,i,n){this.start(e,i,n),this.line("Sprite:  ("+t.width+" x "+t.height+") anchor: "+t.anchor.x+" x "+t.anchor.y),this.line("x: "+t.x.toFixed(1)+" y: "+t.y.toFixed(1)),this.line("angle: "+t.angle.toFixed(1)+" rotation: "+t.rotation.toFixed(1)),this.line("visible: "+t.visible+" in camera: "+t.inCamera),this.line("bounds x: "+t._bounds.x.toFixed(1)+" y: "+t._bounds.y.toFixed(1)+" w: "+t._bounds.width.toFixed(1)+" h: "+t._bounds.height.toFixed(1)),this.stop()},spriteCoords:function(t,e,i,n){this.start(e,i,n,100),t.name&&this.line(t.name),this.line("x:",t.x.toFixed(2),"y:",t.y.toFixed(2)),this.line("pos x:",t.position.x.toFixed(2),"pos y:",t.position.y.toFixed(2)),this.line("world x:",t.world.x.toFixed(2),"world y:",t.world.y.toFixed(2)),this.stop()},lineInfo:function(t,e,i,n){this.start(e,i,n,80),this.line("start.x:",t.start.x.toFixed(2),"start.y:",t.start.y.toFixed(2)),this.line("end.x:",t.end.x.toFixed(2),"end.y:",t.end.y.toFixed(2)),this.line("length:",t.length.toFixed(2),"angle:",t.angle),this.stop()},pixel:function(t,e,i,n){n=n||2,this.start(),this.context.fillStyle=i,this.context.fillRect(t,e,n,n),this.stop()},geom:function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=0),e=e||"rgba(0,255,0,0.4)",this.start(),this.context.fillStyle=e,this.context.strokeStyle=e,t instanceof U.Rectangle||1===n?i?this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height):this.context.strokeRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height):t instanceof U.Circle||2===n?(this.context.beginPath(),this.context.arc(t.x-this.game.camera.x,t.y-this.game.camera.y,t.radius,0,2*Math.PI,!1),this.context.closePath(),i?this.context.fill():this.context.stroke()):t instanceof U.Point||3===n?this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,4,4):(t instanceof U.Line||4===n)&&(this.context.lineWidth=1,this.context.beginPath(),this.context.moveTo(t.start.x+.5-this.game.camera.x,t.start.y+.5-this.game.camera.y),this.context.lineTo(t.end.x+.5-this.game.camera.x,t.end.y+.5-this.game.camera.y),this.context.closePath(),this.context.stroke()),this.stop()},rectangle:function(t,e,i){void 0===i&&(i=!0),e=e||"rgba(0, 255, 0, 0.4)",this.start(),i?(this.context.fillStyle=e,this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)):(this.context.strokeStyle=e,this.context.strokeRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)),this.stop()},text:function(t,e,i,n,r){n=n||"rgb(255,255,255)",r=r||"16px Courier",this.start(),this.context.font=r,this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(t,e+1,i+1)),this.context.fillStyle=n,this.context.fillText(t,e,i),this.stop()},quadTree:function(t,e){e=e||"rgba(255,0,0,0.3)",this.start();var i=t.bounds;if(0===t.nodes.length){this.context.strokeStyle=e,this.context.strokeRect(i.x,i.y,i.width,i.height),this.text("size: "+t.objects.length,i.x+4,i.y+16,"rgb(0,200,0)","12px Courier"),this.context.strokeStyle="rgb(0,255,0)";for(var n=0;n<t.objects.length;n++)this.context.strokeRect(t.objects[n].x,t.objects[n].y,t.objects[n].width,t.objects[n].height)}else for(n=0;n<t.nodes.length;n++)this.quadTree(t.nodes[n]);this.stop()},body:function(t,e,i){t.body&&(this.start(),t.body.type===U.Physics.ARCADE?U.Physics.Arcade.Body.render(this.context,t.body,e,i):t.body.type===U.Physics.NINJA?U.Physics.Ninja.Body.render(this.context,t.body,e,i):t.body.type===U.Physics.BOX2D&&U.Physics.Box2D.renderBody(this.context,t.body,e),this.stop())},bodyInfo:function(t,e,i,n){t.body&&(this.start(e,i,n,210),t.body.type===U.Physics.ARCADE?U.Physics.Arcade.Body.renderBodyInfo(this,t.body):t.body.type===U.Physics.BOX2D&&this.game.physics.box2d.renderBodyInfo(this,t.body),this.stop())},box2dWorld:function(){this.start(),this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0),this.game.physics.box2d.renderDebugDraw(this.context),this.stop()},box2dBody:function(t,e){this.start(),U.Physics.Box2D.renderBody(this.context,t,e),this.stop()},displayList:function(t){if(void 0===t&&(t=this.game.world),t.hasOwnProperty("renderOrderID")?console.log("["+t.renderOrderID+"]",t):console.log("[]",t),t.children&&0<t.children.length)for(var e=0;e<t.children.length;e++)this.game.debug.displayList(t.children[e])},destroy:function(){PIXI.CanvasPool.remove(this)}},U.Utils.Debug.prototype.constructor=U.Utils.Debug,U.DOM={getOffset:function(t,e){e=e||new U.Point;var i=t.getBoundingClientRect(),n=U.DOM.scrollY,r=U.DOM.scrollX,s=document.documentElement.clientTop,t=document.documentElement.clientLeft;return e.x=i.left+r-t,e.y=i.top+n-s,e},getBounds:function(t,e){return void 0===e&&(e=0),!(!(t=t&&!t.nodeType?t[0]:t)||1!==t.nodeType)&&this.calibrate(t.getBoundingClientRect(),e)},calibrate:function(t,e){e=+e||0;var i={width:0,height:0,left:0,right:0,top:0,bottom:0};return i.width=(i.right=t.right+e)-(i.left=t.left-e),i.height=(i.bottom=t.bottom+e)-(i.top=t.top-e),i},getAspectRatio:function(t){var e=(t=null==t?this.visualBounds:1===t.nodeType?this.getBounds(t):t).width,i=t.height;return"function"==typeof e&&(e=e.call(t)),"function"==typeof i&&(i=i.call(t)),e/i},inLayoutViewport:function(t,e){e=this.getBounds(t,e);return!!e&&0<=e.bottom&&0<=e.right&&e.top<=this.layoutBounds.width&&e.left<=this.layoutBounds.height},getScreenOrientation:function(t){var e=window.screen,i=e.orientation||e.mozOrientation||e.msOrientation;if(i&&"string"==typeof i.type)return i.type;if("string"==typeof i)return i;var n="portrait-primary",i="landscape-primary";if("screen"===t)return e.height>e.width?n:i;if("viewport"===t)return this.visualBounds.height>this.visualBounds.width?n:i;if("window.orientation"===t&&"number"==typeof window.orientation)return 0===window.orientation||180===window.orientation?n:i;if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches)return n;if(window.matchMedia("(orientation: landscape)").matches)return i}return this.visualBounds.height>this.visualBounds.width?n:i},visualBounds:new U.Rectangle,layoutBounds:new U.Rectangle,documentBounds:new U.Rectangle},U.Device.whenReady(function(t){var e=window&&"pageXOffset"in window?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft},i=window&&"pageYOffset"in window?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop};Object.defineProperty(U.DOM,"scrollX",{get:e}),Object.defineProperty(U.DOM,"scrollY",{get:i}),Object.defineProperty(U.DOM.visualBounds,"x",{get:e}),Object.defineProperty(U.DOM.visualBounds,"y",{get:i}),Object.defineProperty(U.DOM.layoutBounds,"x",{value:0}),Object.defineProperty(U.DOM.layoutBounds,"y",{value:0}),t.desktop&&document.documentElement.clientWidth<=window.innerWidth&&document.documentElement.clientHeight<=window.innerHeight?(i=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)},t=function(){return Math.max(window.innerHeight,document.documentElement.clientHeight)},Object.defineProperty(U.DOM.visualBounds,"width",{get:i}),Object.defineProperty(U.DOM.visualBounds,"height",{get:t}),Object.defineProperty(U.DOM.layoutBounds,"width",{get:i}),Object.defineProperty(U.DOM.layoutBounds,"height",{get:t})):(Object.defineProperty(U.DOM.visualBounds,"width",{get:function(){return window.innerWidth}}),Object.defineProperty(U.DOM.visualBounds,"height",{get:function(){return window.innerHeight}}),Object.defineProperty(U.DOM.layoutBounds,"width",{get:function(){var t=document.documentElement.clientWidth,e=window.innerWidth;return t<e?e:t}}),Object.defineProperty(U.DOM.layoutBounds,"height",{get:function(){var t=document.documentElement.clientHeight,e=window.innerHeight;return t<e?e:t}})),Object.defineProperty(U.DOM.documentBounds,"x",{value:0}),Object.defineProperty(U.DOM.documentBounds,"y",{value:0}),Object.defineProperty(U.DOM.documentBounds,"width",{get:function(){var t=document.documentElement;return Math.max(t.clientWidth,t.offsetWidth,t.scrollWidth)}}),Object.defineProperty(U.DOM.documentBounds,"height",{get:function(){var t=document.documentElement;return Math.max(t.clientHeight,t.offsetHeight,t.scrollHeight)}})},null,!0),U.ArraySet=function(t){this.position=0,this.list=t||[]},U.ArraySet.prototype={add:function(t){return this.exists(t)||this.list.push(t),t},getIndex:function(t){return this.list.indexOf(t)},getByKey:function(t,e){for(var i=this.list.length;i--;)if(this.list[i][t]===e)return this.list[i];return null},exists:function(t){return-1<this.list.indexOf(t)},reset:function(){this.list.length=0},remove:function(t){var e=this.list.indexOf(t);if(-1<e)return this.list.splice(e,1),t},setAll:function(t,e){for(var i=this.list.length;i--;)this.list[i]&&(this.list[i][t]=e)},callAll:function(t){for(var e=Array.prototype.slice.call(arguments,1),i=this.list.length;i--;)this.list[i]&&this.list[i][t]&&this.list[i][t].apply(this.list[i],e)},removeAll:function(t){void 0===t&&(t=!1);for(var e,i=this.list.length;i--;)this.list[i]&&(e=this.remove(this.list[i]),t&&e.destroy());this.position=0,this.list=[]}},Object.defineProperty(U.ArraySet.prototype,"total",{get:function(){return this.list.length}}),Object.defineProperty(U.ArraySet.prototype,"first",{get:function(){return(this.position=0)<this.list.length?this.list[0]:null}}),Object.defineProperty(U.ArraySet.prototype,"next",{get:function(){return this.position<this.list.length?(this.position++,this.list[this.position]):null}}),U.ArraySet.prototype.constructor=U.ArraySet,U.ArrayUtils={getRandomItem:function(t,e,i){if(null===t)return null;void 0===e&&(e=0),void 0===i&&(i=t.length);i=e+Math.floor(Math.random()*i);return void 0===t[i]?null:t[i]},removeRandomItem:function(t,e,i){if(null==t)return null;void 0===e&&(e=0),void 0===i&&(i=t.length);i=e+Math.floor(Math.random()*i);if(i<t.length){i=t.splice(i,1);return void 0===i[0]?null:i[0]}return null},shuffle:function(t){for(var e=t.length-1;0<e;e--){var i=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[i],t[i]=n}return t},transposeMatrix:function(t){for(var e=t.length,i=t[0].length,n=new Array(i),r=0;r<i;r++){n[r]=new Array(e);for(var s=e-1;-1<s;s--)n[r][s]=t[s][r]}return n},rotateMatrix:function(t,e){if("string"!=typeof e&&(e=(e%360+360)%360),90===e||-270===e||"rotateLeft"===e)t=(t=U.ArrayUtils.transposeMatrix(t)).reverse();else if(-90===e||270===e||"rotateRight"===e)t=t.reverse(),t=U.ArrayUtils.transposeMatrix(t);else if(180===Math.abs(e)||"rotate180"===e){for(var i=0;i<t.length;i++)t[i].reverse();t=t.reverse()}return t},findClosest:function(t,e){if(!e.length)return NaN;if(1===e.length||t<e[0])return e[0];for(var i=1;e[i]<t;)i++;var n=e[i-1],r=i<e.length?e[i]:Number.POSITIVE_INFINITY;return r-t<=t-n?r:n},rotateRight:function(t){var e=t.pop();return t.unshift(e),e},rotateLeft:function(t){var e=t.shift();return t.push(e),e},rotate:function(t){var e=t.shift();return t.push(e),e},numberArray:function(t,e){for(var i=[],n=t;n<=e;n++)i.push(n);return i},numberArrayStep:function(t,e,i){null!=t||(t=0),null!=e||(e=t,t=0),void 0===i&&(i=1);for(var n=[],r=Math.max(U.Math.roundAwayFromZero((e-t)/(i||1)),0),s=0;s<r;s++)n.push(t),t+=i;return n}},U.LinkedList=function(){this.next=null,this.prev=null,this.first=null,this.last=null,this.total=0},U.LinkedList.prototype={add:function(t){return 0===this.total&&null===this.first&&null===this.last?(this.first=t,this.last=t,(this.next=t).prev=this):((this.last.next=t).prev=this.last,this.last=t),this.total++,t},reset:function(){this.first=null,this.last=null,this.next=null,this.prev=null,this.total=0},remove:function(t){return 1===this.total?(this.reset(),void(t.next=t.prev=null)):(t===this.first?this.first=this.first.next:t===this.last&&(this.last=this.last.prev),t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),(t.next=t.prev=null)===this.first&&(this.last=null),void this.total--)},callAll:function(t){if(this.first&&this.last)for(var e=this.first;e&&e[t]&&e[t].call(e),e=e.next,e!==this.last.next;);}},U.LinkedList.prototype.constructor=U.LinkedList,U.Create=function(t){this.game=t,this.bmd=null,this.canvas=null,this.ctx=null,this.palettes=[{0:"#000",1:"#9D9D9D",2:"#FFF",3:"#BE2633",4:"#E06F8B",5:"#493C2B",6:"#A46422",7:"#EB8931",8:"#F7E26B",9:"#2F484E",A:"#44891A",B:"#A3CE27",C:"#1B2632",D:"#005784",E:"#31A2F2",F:"#B2DCEF"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#f5f4eb"},{0:"#000",1:"#2234d1",2:"#0c7e45",3:"#44aacc",4:"#8a3622",5:"#5c2e78",6:"#aa5c3d",7:"#b5b5b5",8:"#5e606e",9:"#4c81fb",A:"#6cd947",B:"#7be2f9",C:"#eb8a60",D:"#e23d69",E:"#ffd93f",F:"#fff"},{0:"#000",1:"#fff",2:"#8b4131",3:"#7bbdc5",4:"#8b41ac",5:"#6aac41",6:"#3931a4",7:"#d5de73",8:"#945a20",9:"#5a4100",A:"#bd736a",B:"#525252",C:"#838383",D:"#acee8b",E:"#7b73de",F:"#acacac"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#fff"}]},U.Create.PALETTE_ARNE=0,U.Create.PALETTE_JMP=1,U.Create.PALETTE_CGA=2,U.Create.PALETTE_C64=3,U.Create.PALETTE_JAPANESE_MACHINE=4,U.Create.prototype={texture:function(t,e,i,n,r){void 0===i&&(i=8),void 0===n&&(n=i),void 0===r&&(r=0);var s=e[0].length*i,o=e.length*n;null===this.bmd&&(this.bmd=this.game.make.bitmapData(),this.canvas=this.bmd.canvas,this.ctx=this.bmd.context),this.bmd.resize(s,o),this.bmd.clear();for(var a=0;a<e.length;a++)for(var l=e[a],p=0;p<l.length;p++){var h=l[p];"."!==h&&" "!==h&&(this.ctx.fillStyle=this.palettes[r][h],this.ctx.fillRect(p*i,a*n,i,n))}return this.bmd.generateTexture(t)},grid:function(t,e,i,n,r,s){null===this.bmd&&(this.bmd=this.game.make.bitmapData(),this.canvas=this.bmd.canvas,this.ctx=this.bmd.context),this.bmd.resize(e,i),this.ctx.fillStyle=s;for(var o=0;o<i;o+=r)this.ctx.fillRect(0,o,e,1);for(var a=0;a<e;a+=n)this.ctx.fillRect(a,0,1,i);return this.bmd.generateTexture(t)}},U.Create.prototype.constructor=U.Create,U.FlexGrid=function(t,e,i){this.game=t.game,this.manager=t,this.width=e,this.height=i,this.boundsCustom=new U.Rectangle(0,0,e,i),this.boundsFluid=new U.Rectangle(0,0,e,i),this.boundsFull=new U.Rectangle(0,0,e,i),this.boundsNone=new U.Rectangle(0,0,e,i),this.positionCustom=new U.Point(0,0),this.positionFluid=new U.Point(0,0),this.positionFull=new U.Point(0,0),this.positionNone=new U.Point(0,0),this.scaleCustom=new U.Point(1,1),this.scaleFluid=new U.Point(1,1),this.scaleFluidInversed=new U.Point(1,1),this.scaleFull=new U.Point(1,1),this.scaleNone=new U.Point(1,1),this.customWidth=0,this.customHeight=0,this.customOffsetX=0,this.customOffsetY=0,this.ratioH=e/i,this.ratioV=i/e,this.multiplier=0,this.layers=[]},U.FlexGrid.prototype={setSize:function(t,e){this.width=t,this.height=e,this.ratioH=t/e,this.ratioV=e/t,this.scaleNone=new U.Point(1,1),this.boundsNone.width=this.width,this.boundsNone.height=this.height,this.refresh()},createCustomLayer:function(t,e,i,n){void 0===n&&(n=!0),this.customWidth=t,this.customHeight=e,this.boundsCustom.width=t,this.boundsCustom.height=e;e=new U.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);return n&&this.game.world.add(e),this.layers.push(e),void 0!==i&&null!==typeof i&&e.addMultiple(i),e},createFluidLayer:function(t,e){void 0===e&&(e=!0);var i=new U.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);return e&&this.game.world.add(i),this.layers.push(i),void 0!==t&&null!==typeof t&&i.addMultiple(t),i},createFullLayer:function(t){var e=new U.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);return this.game.world.add(e),this.layers.push(e),void 0!==t&&e.addMultiple(t),e},createFixedLayer:function(t){var e=new U.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);return this.game.world.add(e),this.layers.push(e),void 0!==t&&e.addMultiple(t),e},reset:function(){for(var t=this.layers.length;t--;)this.layers[t].persist||(this.layers[t].position=null,this.layers[t].scale=null,this.layers.slice(t,1))},onResize:function(t,e){this.ratioH=t/e,this.ratioV=e/t,this.refresh(t,e)},refresh:function(){this.multiplier=Math.min(this.manager.height/this.height,this.manager.width/this.width),this.boundsFluid.width=Math.round(this.width*this.multiplier),this.boundsFluid.height=Math.round(this.height*this.multiplier),this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height),this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height),this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height),this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x),this.boundsFull.height=Math.round(this.manager.height*this.scaleFluidInversed.y),this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY),this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY),this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y),this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(t){this.manager.scaleSprite(t),t.x=this.manager.bounds.centerX,t.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16),this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",!1)}},U.FlexGrid.prototype.constructor=U.FlexGrid,U.FlexLayer=function(t,e,i,n){U.Group.call(this,t.game,null,"__flexLayer"+t.game.rnd.uuid(),!1),this.manager=t.manager,this.grid=t,this.persist=!1,this.position=e,this.bounds=i,this.scale=n,this.topLeft=i.topLeft,this.topMiddle=new U.Point(i.halfWidth,0),this.topRight=i.topRight,this.bottomLeft=i.bottomLeft,this.bottomMiddle=new U.Point(i.halfWidth,i.bottom),this.bottomRight=i.bottomRight},U.FlexLayer.prototype=Object.create(U.Group.prototype),U.FlexLayer.prototype.constructor=U.FlexLayer,U.FlexLayer.prototype.resize=function(){},U.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16),this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",!1),this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9"),this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9"),this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")},U.Color={packPixel:function(t,e,i,n){return U.Device.LITTLE_ENDIAN?(n<<24|i<<16|e<<8|t)>>>0:(t<<24|e<<16|i<<8|n)>>>0},unpackPixel:function(t,e,i,n){return null!=e||(e=U.Color.createColor()),null!=i||(i=!1),null!=n||(n=!1),U.Device.LITTLE_ENDIAN?(e.a=(4278190080&t)>>>24,e.b=(16711680&t)>>>16,e.g=(65280&t)>>>8,e.r=255&t):(e.r=(4278190080&t)>>>24,e.g=(16711680&t)>>>16,e.b=(65280&t)>>>8,e.a=255&t),e.color=t,e.rgba="rgba("+e.r+","+e.g+","+e.b+","+e.a/255+")",i&&U.Color.RGBtoHSL(e.r,e.g,e.b,e),n&&U.Color.RGBtoHSV(e.r,e.g,e.b,e),e},fromRGBA:function(t,e){return(e=e||U.Color.createColor()).r=(4278190080&t)>>>24,e.g=(16711680&t)>>>16,e.b=(65280&t)>>>8,e.a=255&t,e.rgba="rgba("+e.r+","+e.g+","+e.b+","+e.a+")",e},toRGBA:function(t,e,i,n){return t<<24|e<<16|i<<8|n},toABGR:function(t,e,i,n){return(n<<24|i<<16|e<<8|t)>>>0},RGBtoHSL:function(t,e,i,n){n=n||U.Color.createColor(t,e,i,1),t/=255,e/=255,i/=255;var r,s=Math.min(t,e,i),o=Math.max(t,e,i);return n.h=0,n.s=0,n.l=(o+s)/2,o!==s&&(r=o-s,n.s=.5<n.l?r/(2-o-s):r/(o+s),o===t?n.h=(e-i)/r+(e<i?6:0):o===e?n.h=(i-t)/r+2:o===i&&(n.h=(t-e)/r+4),n.h/=6),n},HSLtoRGB:function(t,e,i,n){return n?(n.r=i,n.g=i,n.b=i):n=U.Color.createColor(i,i,i),0!==e&&(e=2*i-(i=i<.5?i*(1+e):i+e-i*e),n.r=U.Color.hueToColor(e,i,t+1/3),n.g=U.Color.hueToColor(e,i,t),n.b=U.Color.hueToColor(e,i,t-1/3)),n.r=Math.floor(255*n.r|0),n.g=Math.floor(255*n.g|0),n.b=Math.floor(255*n.b|0),U.Color.updateColor(n),n},RGBtoHSV:function(t,e,i,n){n=n||U.Color.createColor(t,e,i,255),t/=255,e/=255,i/=255;var r=Math.min(t,e,i),s=Math.max(t,e,i),o=s-r;return n.h=0,n.s=0===s?0:o/s,(n.v=s)!==r&&(s===t?n.h=(e-i)/o+(e<i?6:0):s===e?n.h=(i-t)/o+2:s===i&&(n.h=(t-e)/o+4),n.h/=6),n},HSVtoRGB:function(t,e,i,n){void 0===n&&(n=U.Color.createColor(0,0,0,1,t,e,0,i));var r,s,o,a=Math.floor(6*t),t=6*t-a,l=i*(1-e),p=i*(1-t*e),h=i*(1-(1-t)*e);switch(a%6){case 0:r=i,s=h,o=l;break;case 1:r=p,s=i,o=l;break;case 2:r=l,s=i,o=h;break;case 3:r=l,s=p,o=i;break;case 4:r=h,s=l,o=i;break;case 5:r=i,s=l,o=p}return n.r=Math.floor(255*r),n.g=Math.floor(255*s),n.b=Math.floor(255*o),U.Color.updateColor(n),n},hueToColor:function(t,e,i){return i<0&&(i+=1),1<i&&--i,i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t},createColor:function(t,e,i,n,r,s,o,a){a={r:t||0,g:e||0,b:i||0,a:n||1,h:r||0,s:s||0,l:o||0,v:a||0,color:0,color32:0,rgba:""};return U.Color.updateColor(a)},updateColor:function(t){return t.rgba="rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+t.a.toString()+")",t.color=U.Color.getColor(t.r,t.g,t.b),t.color32=U.Color.getColor32(255*t.a,t.r,t.g,t.b),t},getColor32:function(t,e,i,n){return t<<24|e<<16|i<<8|n},getColor:function(t,e,i){return t<<16|e<<8|i},RGBtoString:function(t,e,i,n,r){return void 0===n&&(n=255),void 0===r&&(r="#"),"#"===r?"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1):"0x"+U.Color.componentToHex(n)+U.Color.componentToHex(t)+U.Color.componentToHex(e)+U.Color.componentToHex(i)},hexToRGB:function(t){t=U.Color.hexToColor(t);if(t)return U.Color.getColor32(t.a,t.r,t.g,t.b)},hexToColor:function(t,e){t=t.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,n){return e+e+i+i+n+n});var i,n=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return n&&(i=parseInt(n[1],16),t=parseInt(n[2],16),n=parseInt(n[3],16),e?(e.r=i,e.g=t,e.b=n):e=U.Color.createColor(i,t,n)),e},webToColor:function(t,e){e=e||U.Color.createColor();t=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(t);return t&&(e.r=parseInt(t[1],10),e.g=parseInt(t[2],10),e.b=parseInt(t[3],10),e.a=void 0!==t[4]?parseFloat(t[4]):1,U.Color.updateColor(e)),e},valueToColor:function(t,e){if(e=e||U.Color.createColor(),"string"==typeof t)return 0===t.indexOf("rgb")?U.Color.webToColor(t,e):(e.a=1,U.Color.hexToColor(t,e));if("number"!=typeof t)return e;t=U.Color.getRGB(t);return e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a/255,e},componentToHex:function(t){t=t.toString(16);return 1===t.length?"0"+t:t},HSVColorWheel:function(t,e){void 0===t&&(t=1),void 0===e&&(e=1);for(var i=[],n=0;n<=359;n++)i.push(U.Color.HSVtoRGB(n/359,t,e));return i},HSLColorWheel:function(t,e){void 0===t&&(t=.5),void 0===e&&(e=.5);for(var i=[],n=0;n<=359;n++)i.push(U.Color.HSLtoRGB(n/359,t,e));return i},interpolateColor:function(t,e,i,n,r){void 0===r&&(r=255);var s=U.Color.getRGB(t),o=U.Color.getRGB(e),t=(o.red-s.red)*n/i+s.red,e=(o.green-s.green)*n/i+s.green,s=(o.blue-s.blue)*n/i+s.blue;return U.Color.getColor32(r,t,e,s)},interpolateColorWithRGB:function(t,e,i,n,r,s){t=U.Color.getRGB(t),e=(e-t.red)*s/r+t.red,i=(i-t.green)*s/r+t.green,t=(n-t.blue)*s/r+t.blue;return U.Color.getColor(e,i,t)},interpolateRGB:function(t,e,i,n,r,s,o,a){t=(n-t)*a/o+t,e=(r-e)*a/o+e,i=(s-i)*a/o+i;return U.Color.getColor(t,e,i)},getRandomColor:function(t,e,i){if(void 0===t&&(t=0),void 0===e&&(e=255),void 0===i&&(i=255),255<e||e<t)return U.Color.getColor(255,255,255);var n=t+Math.round(Math.random()*(e-t)),r=t+Math.round(Math.random()*(e-t)),t=t+Math.round(Math.random()*(e-t));return U.Color.getColor32(i,n,r,t)},getRGB:function(t){return 16777215<t?{alpha:t>>>24,red:t>>16&255,green:t>>8&255,blue:255&t,a:t>>>24,r:t>>16&255,g:t>>8&255,b:255&t}:{alpha:255,red:t>>16&255,green:t>>8&255,blue:255&t,a:255,r:t>>16&255,g:t>>8&255,b:255&t}},getWebRGB:function(t){if("object"==typeof t)return"rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+(t.a/255).toString()+")";t=U.Color.getRGB(t);return"rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+(t.a/255).toString()+")"},getAlpha:function(t){return t>>>24},getAlphaFloat:function(t){return(t>>>24)/255},getRed:function(t){return t>>16&255},getGreen:function(t){return t>>8&255},getBlue:function(t){return 255&t},blendNormal:function(t){return t},blendLighten:function(t,e){return t<e?e:t},blendDarken:function(t,e){return t<e?t:e},blendMultiply:function(t,e){return t*e/255},blendAverage:function(t,e){return(t+e)/2},blendAdd:function(t,e){return Math.min(255,t+e)},blendSubtract:function(t,e){return Math.max(0,t+e-255)},blendDifference:function(t,e){return Math.abs(t-e)},blendNegation:function(t,e){return 255-Math.abs(255-t-e)},blendScreen:function(t,e){return 255-((255-t)*(255-e)>>8)},blendExclusion:function(t,e){return t+e-2*t*e/255},blendOverlay:function(t,e){return e<128?2*t*e/255:255-2*(255-t)*(255-e)/255},blendSoftLight:function(t,e){return e<128?2*(64+(t>>1))*(e/255):255-2*(255-(64+(t>>1)))*(255-e)/255},blendHardLight:function(t,e){return U.Color.blendOverlay(e,t)},blendColorDodge:function(t,e){return 255===e?e:Math.min(255,(t<<8)/(255-e))},blendColorBurn:function(t,e){return 0===e?e:Math.max(0,255-(255-t<<8)/e)},blendLinearDodge:function(t,e){return U.Color.blendAdd(t,e)},blendLinearBurn:function(t,e){return U.Color.blendSubtract(t,e)},blendLinearLight:function(t,e){return e<128?U.Color.blendLinearBurn(t,2*e):U.Color.blendLinearDodge(t,2*(e-128))},blendVividLight:function(t,e){return e<128?U.Color.blendColorBurn(t,2*e):U.Color.blendColorDodge(t,2*(e-128))},blendPinLight:function(t,e){return e<128?U.Color.blendDarken(t,2*e):U.Color.blendLighten(t,2*(e-128))},blendHardMix:function(t,e){return U.Color.blendVividLight(t,e)<128?0:255},blendReflect:function(t,e){return 255===e?e:Math.min(255,t*t/(255-e))},blendGlow:function(t,e){return U.Color.blendReflect(e,t)},blendPhoenix:function(t,e){return Math.min(t,e)-Math.max(t,e)+255}},U.Physics=function(t,e){e=e||{},this.game=t,this.config=e,this.arcade=null,this.p2=null,this.ninja=null,this.box2d=null,this.chipmunk=null,this.matter=null,this.parseConfig()},U.Physics.ARCADE=0,U.Physics.P2JS=1,U.Physics.NINJA=2,U.Physics.BOX2D=3,U.Physics.CHIPMUNK=4,U.Physics.MATTERJS=5,U.Physics.prototype={parseConfig:function(){this.config.hasOwnProperty("arcade")&&!0!==this.config.arcade||!U.Physics.hasOwnProperty("Arcade")||(this.arcade=new U.Physics.Arcade(this.game)),this.config.hasOwnProperty("ninja")&&!0===this.config.ninja&&U.Physics.hasOwnProperty("Ninja")&&(this.ninja=new U.Physics.Ninja(this.game)),this.config.hasOwnProperty("p2")&&!0===this.config.p2&&U.Physics.hasOwnProperty("P2")&&(this.p2=new U.Physics.P2(this.game,this.config)),this.config.hasOwnProperty("box2d")&&!0===this.config.box2d&&U.Physics.hasOwnProperty("BOX2D")&&(this.box2d=new U.Physics.BOX2D(this.game,this.config)),this.config.hasOwnProperty("matter")&&!0===this.config.matter&&U.Physics.hasOwnProperty("Matter")&&(this.matter=new U.Physics.Matter(this.game,this.config))},startSystem:function(t){t===U.Physics.ARCADE?this.arcade=new U.Physics.Arcade(this.game):t===U.Physics.P2JS?null===this.p2?this.p2=new U.Physics.P2(this.game,this.config):this.p2.reset():t===U.Physics.NINJA?this.ninja=new U.Physics.Ninja(this.game):t===U.Physics.BOX2D?null===this.box2d?this.box2d=new U.Physics.Box2D(this.game,this.config):this.box2d.reset():t===U.Physics.MATTERJS&&(null===this.matter?this.matter=new U.Physics.Matter(this.game,this.config):this.matter.reset())},enable:function(t,e,i){void 0===e&&(e=U.Physics.ARCADE),void 0===i&&(i=!1),e===U.Physics.ARCADE?this.arcade.enable(t):e===U.Physics.P2JS&&this.p2?this.p2.enable(t,i):e===U.Physics.NINJA&&this.ninja?this.ninja.enableAABB(t):e===U.Physics.BOX2D&&this.box2d?this.box2d.enable(t):e===U.Physics.MATTERJS&&this.matter?this.matter.enable(t):console.warn(t.key+" is attempting to enable a physics body using an unknown physics system.")},preUpdate:function(){this.p2&&this.p2.preUpdate(),this.box2d&&this.box2d.preUpdate(),this.matter&&this.matter.preUpdate()},update:function(){this.p2&&this.p2.update(),this.box2d&&this.box2d.update(),this.matter&&this.matter.update()},setBoundsToWorld:function(){this.arcade&&this.arcade.setBoundsToWorld(),this.ninja&&this.ninja.setBoundsToWorld(),this.p2&&this.p2.setBoundsToWorld(),this.box2d&&this.box2d.setBoundsToWorld(),this.matter&&this.matter.setBoundsToWorld()},clear:function(){this.p2&&this.p2.clear(),this.box2d&&this.box2d.clear(),this.matter&&this.matter.clear()},reset:function(){this.p2&&this.p2.reset(),this.box2d&&this.box2d.reset(),this.matter&&this.matter.reset()},destroy:function(){this.p2&&this.p2.destroy(),this.box2d&&this.box2d.destroy(),this.matter&&this.matter.destroy(),this.arcade=null,this.ninja=null,this.p2=null,this.box2d=null,this.matter=null}},U.Physics.prototype.constructor=U.Physics,U.Physics.Arcade=function(t){this.game=t,this.gravity=new U.Point,this.bounds=new U.Rectangle(0,0,t.world.width,t.world.height),this.checkCollision={up:!0,down:!0,left:!0,right:!0},this.maxObjects=10,this.maxLevels=4,this.OVERLAP_BIAS=4,this.forceX=!1,this.sortDirection=U.Physics.Arcade.LEFT_RIGHT,this.skipQuadTree=!0,this.isPaused=!1,this.quadTree=new U.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this._total=0,this.setBoundsToWorld()},U.Physics.Arcade.prototype.constructor=U.Physics.Arcade,U.Physics.Arcade.SORT_NONE=0,U.Physics.Arcade.LEFT_RIGHT=1,U.Physics.Arcade.RIGHT_LEFT=2,U.Physics.Arcade.TOP_BOTTOM=3,U.Physics.Arcade.BOTTOM_TOP=4,U.Physics.Arcade.prototype={setBounds:function(t,e,i,n){this.bounds.setTo(t,e,i,n)},setBoundsToWorld:function(){this.bounds.copyFrom(this.game.world.bounds)},enable:function(t,e){void 0===e&&(e=!0);var i=1;if(Array.isArray(t))for(i=t.length;i--;)t[i]instanceof U.Group?this.enable(t[i].children,e):(this.enableBody(t[i]),e&&t[i].hasOwnProperty("children")&&0<t[i].children.length&&this.enable(t[i],!0));else t instanceof U.Group?this.enable(t.children,e):(this.enableBody(t),e&&t.hasOwnProperty("children")&&0<t.children.length&&this.enable(t.children,!0))},enableBody:function(t){t.hasOwnProperty("body")&&null===t.body&&(t.body=new U.Physics.Arcade.Body(t),t.parent&&t.parent instanceof U.Group&&t.parent.addToHash(t))},updateMotion:function(t){var e=this.computeVelocity(0,t,t.angularVelocity,t.angularAcceleration,t.angularDrag,t.maxAngular)-t.angularVelocity;t.angularVelocity+=e,t.rotation+=t.angularVelocity*this.game.time.physicsElapsed,t.velocity.x=this.computeVelocity(1,t,t.velocity.x,t.acceleration.x,t.drag.x,t.maxVelocity.x),t.velocity.y=this.computeVelocity(2,t,t.velocity.y,t.acceleration.y,t.drag.y,t.maxVelocity.y)},computeVelocity:function(t,e,i,n,r,s){return void 0===s&&(s=1e4),1===t&&e.allowGravity?i+=(this.gravity.x+e.gravity.x)*this.game.time.physicsElapsed:2===t&&e.allowGravity&&(i+=(this.gravity.y+e.gravity.y)*this.game.time.physicsElapsed),n?i+=n*this.game.time.physicsElapsed:r&&(0<i-(r*=this.game.time.physicsElapsed)?i-=r:i+r<0?i+=r:i=0),s<i?i=s:i<-s&&(i=-s),i},overlap:function(t,e,i,n,r){if(i=i||null,n=n||null,r=r||i,this._total=0,!Array.isArray(t)&&Array.isArray(e))for(var s=0;s<e.length;s++)this.collideHandler(t,e[s],i,n,r,!0);else if(Array.isArray(t)&&!Array.isArray(e))for(s=0;s<t.length;s++)this.collideHandler(t[s],e,i,n,r,!0);else if(Array.isArray(t)&&Array.isArray(e))for(s=0;s<t.length;s++)for(var o=0;o<e.length;o++)this.collideHandler(t[s],e[o],i,n,r,!0);else this.collideHandler(t,e,i,n,r,!0);return 0<this._total},collide:function(t,e,i,n,r){if(i=i||null,n=n||null,r=r||i,this._total=0,!Array.isArray(t)&&Array.isArray(e))for(var s=0;s<e.length;s++)this.collideHandler(t,e[s],i,n,r,!1);else if(Array.isArray(t)&&!Array.isArray(e))for(s=0;s<t.length;s++)this.collideHandler(t[s],e,i,n,r,!1);else if(Array.isArray(t)&&Array.isArray(e))for(s=0;s<t.length;s++)for(var o=0;o<e.length;o++)this.collideHandler(t[s],e[o],i,n,r,!1);else this.collideHandler(t,e,i,n,r,!1);return 0<this._total},sortLeftRight:function(t,e){return t.body&&e.body?t.body.x-e.body.x:0},sortRightLeft:function(t,e){return t.body&&e.body?e.body.x-t.body.x:0},sortTopBottom:function(t,e){return t.body&&e.body?t.body.y-e.body.y:0},sortBottomTop:function(t,e){return t.body&&e.body?e.body.y-t.body.y:0},sort:function(t,e){null!==t.physicsSortDirection?e=t.physicsSortDirection:void 0===e&&(e=this.sortDirection),e===U.Physics.Arcade.LEFT_RIGHT?t.hash.sort(this.sortLeftRight):e===U.Physics.Arcade.RIGHT_LEFT?t.hash.sort(this.sortRightLeft):e===U.Physics.Arcade.TOP_BOTTOM?t.hash.sort(this.sortTopBottom):e===U.Physics.Arcade.BOTTOM_TOP&&t.hash.sort(this.sortBottomTop)},collideHandler:function(t,e,i,n,r,s){return void 0===e&&t.physicsType===U.GROUP?(this.sort(t),void this.collideGroupVsSelf(t,i,n,r,s)):void(t&&e&&t.exists&&e.exists&&(this.sortDirection!==U.Physics.Arcade.SORT_NONE&&(t.physicsType===U.GROUP&&this.sort(t),e.physicsType===U.GROUP&&this.sort(e)),t.physicsType===U.SPRITE?e.physicsType===U.SPRITE?this.collideSpriteVsSprite(t,e,i,n,r,s):e.physicsType===U.GROUP?this.collideSpriteVsGroup(t,e,i,n,r,s):e.physicsType===U.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(t,e,i,n,r,s):t.physicsType===U.GROUP?e.physicsType===U.SPRITE?this.collideSpriteVsGroup(e,t,i,n,r,s):e.physicsType===U.GROUP?this.collideGroupVsGroup(t,e,i,n,r,s):e.physicsType===U.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(t,e,i,n,r,s):t.physicsType===U.TILEMAPLAYER&&(e.physicsType===U.SPRITE?this.collideSpriteVsTilemapLayer(e,t,i,n,r,s):e.physicsType===U.GROUP&&this.collideGroupVsTilemapLayer(e,t,i,n,r,s))))},collideSpriteVsSprite:function(t,e,i,n,r,s){return!(!t.body||!e.body||(this.separate(t.body,e.body,n,r,s)&&(i&&i.call(r,t,e),this._total++),0))},collideSpriteVsGroup:function(t,e,i,n,r,s){if(0!==e.length&&t.body)if(this.skipQuadTree||t.body.skipQuadTree)for(var o={},a=0;a<e.hash.length;a++){var l=e.hash[a];if(l&&l.exists&&l.body){if(o=l.body.getBounds(o),this.sortDirection===U.Physics.Arcade.LEFT_RIGHT){if(t.body.right<o.x)break;if(o.right<t.body.x)continue}else if(this.sortDirection===U.Physics.Arcade.RIGHT_LEFT){if(t.body.x>o.right)break;if(o.x>t.body.right)continue}else if(this.sortDirection===U.Physics.Arcade.TOP_BOTTOM){if(t.body.bottom<o.y)break;if(o.bottom<t.body.y)continue}else if(this.sortDirection===U.Physics.Arcade.BOTTOM_TOP){if(t.body.y>o.bottom)break;if(o.y>t.body.bottom)continue}this.collideSpriteVsSprite(t,l,i,n,r,s)}}else{this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(e);for(var p=this.quadTree.retrieve(t),a=0;a<p.length;a++)this.separate(t.body,p[a],n,r,s)&&(i&&i.call(r,t,p[a].sprite),this._total++)}},collideGroupVsSelf:function(t,e,i,n,r){if(0!==t.length)for(var s=0;s<t.hash.length;s++){var o={},a=t.hash[s];if(a&&a.exists&&a.body){o=a.body.getBounds(o);for(var l=s+1;l<t.hash.length;l++){var p={},h=t.hash[l];if(h&&h.exists&&h.body){if(p=h.body.getBounds(p),this.sortDirection===U.Physics.Arcade.LEFT_RIGHT){if(o.right<p.x)break;if(p.right<o.x)continue}else if(this.sortDirection===U.Physics.Arcade.RIGHT_LEFT){if(o.x>p.right)continue;if(p.x>o.right)break}else if(this.sortDirection===U.Physics.Arcade.TOP_BOTTOM){if(o.bottom<p.y)continue;if(p.bottom<o.y)break}else if(this.sortDirection===U.Physics.Arcade.BOTTOM_TOP){if(o.y>p.bottom)continue;if(p.y>a.body.bottom)break}this.collideSpriteVsSprite(a,h,e,i,n,r)}}}}},collideGroupVsGroup:function(t,e,i,n,r,s){if(0!==t.length&&0!==e.length)for(var o=0;o<t.children.length;o++)t.children[o].exists&&(t.children[o].physicsType===U.GROUP?this.collideGroupVsGroup(t.children[o],e,i,n,r,s):this.collideSpriteVsGroup(t.children[o],e,i,n,r,s))},separate:function(t,e,i,n,r){if(!t.enable||!e.enable||t.checkCollision.none||e.checkCollision.none||!this.intersects(t,e))return!1;if(i&&!1===i.call(n,t.sprite,e.sprite))return!1;if(t.isCircle&&e.isCircle)return this.separateCircle(t,e,r);if(t.isCircle!==e.isCircle){var s=t.isCircle?e:t,o=t.isCircle?t:e,a=s.x,i=s.y,l=s.right,n=s.bottom,s=o.x+o.radius,o=o.y+o.radius;if((o<i||n<o)&&(s<a||l<s))return this.separateCircle(t,e,r)}l=!1,s=!1;this.forceX||Math.abs(this.gravity.y+t.gravity.y)<Math.abs(this.gravity.x+t.gravity.x)?(l=this.separateX(t,e,r),this.intersects(t,e)&&(s=this.separateY(t,e,r))):(s=this.separateY(t,e,r),this.intersects(t,e)&&(l=this.separateX(t,e,r)));s=l||s;return s&&(r?(t.onOverlap&&t.onOverlap.dispatch(t.sprite,e.sprite),e.onOverlap&&e.onOverlap.dispatch(e.sprite,t.sprite)):(t.onCollide&&t.onCollide.dispatch(t.sprite,e.sprite),e.onCollide&&e.onCollide.dispatch(e.sprite,t.sprite))),s},intersects:function(t,e){return t!==e&&(t.isCircle?e.isCircle?U.Math.distance(t.center.x,t.center.y,e.center.x,e.center.y)<=t.radius+e.radius:this.circleBodyIntersects(t,e):e.isCircle?this.circleBodyIntersects(e,t):!(t.right<=e.position.x||t.bottom<=e.position.y||t.position.x>=e.right||t.position.y>=e.bottom))},circleBodyIntersects:function(t,e){var i=U.Math.clamp(t.center.x,e.left,e.right),e=U.Math.clamp(t.center.y,e.top,e.bottom);return(t.center.x-i)*(t.center.x-i)+(t.center.y-e)*(t.center.y-e)<=t.radius*t.radius},separateCircle:function(t,e,i){this.getOverlapX(t,e),this.getOverlapY(t,e);var n=e.center.x-t.center.x,r=e.center.y-t.center.y,s=Math.atan2(r,n),o=0;if(t.isCircle!==e.isCircle?(a={x:(e.isCircle?t:e).position.x,y:(e.isCircle?t:e).position.y,right:(e.isCircle?t:e).right,bottom:(e.isCircle?t:e).bottom},(l={x:t.isCircle?t.position.x+t.radius:e.position.x+e.radius,y:t.isCircle?t.position.y+t.radius:e.position.y+e.radius,radius:(t.isCircle?t:e).radius}).y<a.y?l.x<a.x?o=U.Math.distance(l.x,l.y,a.x,a.y)-l.radius:a.right<l.x&&(o=U.Math.distance(l.x,l.y,a.right,a.y)-l.radius):a.bottom<l.y&&(l.x<a.x?o=U.Math.distance(l.x,l.y,a.x,a.bottom)-l.radius:a.right<l.x&&(o=U.Math.distance(l.x,l.y,a.right,a.bottom)-l.radius)),o*=-1):o=t.radius+e.radius-U.Math.distance(t.center.x,t.center.y,e.center.x,e.center.y),i||0===o||t.immovable&&e.immovable||t.customSeparateX||e.customSeparateX)return 0!==o&&(t.onOverlap&&t.onOverlap.dispatch(t.sprite,e.sprite),e.onOverlap&&e.onOverlap.dispatch(e.sprite,t.sprite)),0!==o;var r=t.velocity.x*Math.cos(s)+t.velocity.y*Math.sin(s),n=t.velocity.x*Math.sin(s)-t.velocity.y*Math.cos(s),a=e.velocity.x*Math.cos(s)+e.velocity.y*Math.sin(s),l=e.velocity.x*Math.sin(s)-e.velocity.y*Math.cos(s),i=((t.mass-e.mass)*r+2*e.mass*a)/(t.mass+e.mass),a=(2*t.mass*r+(e.mass-t.mass)*a)/(t.mass+e.mass);return t.immovable||(t.velocity.x=(i*Math.cos(s)-n*Math.sin(s))*t.bounce.x,t.velocity.y=(n*Math.cos(s)+i*Math.sin(s))*t.bounce.y),e.immovable||(e.velocity.x=(a*Math.cos(s)-l*Math.sin(s))*e.bounce.x,e.velocity.y=(l*Math.cos(s)+a*Math.sin(s))*e.bounce.y),Math.abs(s)<Math.PI/2?0<t.velocity.x&&!t.immovable&&e.velocity.x>t.velocity.x?t.velocity.x*=-1:e.velocity.x<0&&!e.immovable&&t.velocity.x<e.velocity.x?e.velocity.x*=-1:0<t.velocity.y&&!t.immovable&&e.velocity.y>t.velocity.y?t.velocity.y*=-1:e.velocity.y<0&&!e.immovable&&t.velocity.y<e.velocity.y&&(e.velocity.y*=-1):Math.abs(s)>Math.PI/2&&(t.velocity.x<0&&!t.immovable&&e.velocity.x<t.velocity.x?t.velocity.x*=-1:0<e.velocity.x&&!e.immovable&&t.velocity.x>e.velocity.x?e.velocity.x*=-1:t.velocity.y<0&&!t.immovable&&e.velocity.y<t.velocity.y?t.velocity.y*=-1:0<e.velocity.y&&!e.immovable&&t.velocity.x>e.velocity.y&&(e.velocity.y*=-1)),t.immovable||(t.x+=t.velocity.x*this.game.time.physicsElapsed-o*Math.cos(s),t.y+=t.velocity.y*this.game.time.physicsElapsed-o*Math.sin(s)),e.immovable||(e.x+=e.velocity.x*this.game.time.physicsElapsed+o*Math.cos(s),e.y+=e.velocity.y*this.game.time.physicsElapsed+o*Math.sin(s)),t.onCollide&&t.onCollide.dispatch(t.sprite,e.sprite),e.onCollide&&e.onCollide.dispatch(e.sprite,t.sprite),!0},getOverlapX:function(t,e,i){var n=0,r=t.deltaAbsX()+e.deltaAbsX()+this.OVERLAP_BIAS;return 0===t.deltaX()&&0===e.deltaX()?(t.embedded=!0,e.embedded=!0):t.deltaX()>e.deltaX()?r<(n=t.right-e.x)&&!i||!1===t.checkCollision.right||!1===e.checkCollision.left?n=0:(t.touching.none=!1,t.touching.right=!0,e.touching.none=!1,e.touching.left=!0):t.deltaX()<e.deltaX()&&(r<-(n=t.x-e.width-e.x)&&!i||!1===t.checkCollision.left||!1===e.checkCollision.right?n=0:(t.touching.none=!1,t.touching.left=!0,e.touching.none=!1,e.touching.right=!0)),t.overlapX=n,e.overlapX=n},getOverlapY:function(t,e,i){var n=0,r=t.deltaAbsY()+e.deltaAbsY()+this.OVERLAP_BIAS;return 0===t.deltaY()&&0===e.deltaY()?(t.embedded=!0,e.embedded=!0):t.deltaY()>e.deltaY()?r<(n=t.bottom-e.y)&&!i||!1===t.checkCollision.down||!1===e.checkCollision.up?n=0:(t.touching.none=!1,t.touching.down=!0,e.touching.none=!1,e.touching.up=!0):t.deltaY()<e.deltaY()&&(r<-(n=t.y-e.bottom)&&!i||!1===t.checkCollision.up||!1===e.checkCollision.down?n=0:(t.touching.none=!1,t.touching.up=!0,e.touching.none=!1,e.touching.down=!0)),t.overlapY=n,e.overlapY=n},separateX:function(t,e,i){var n=this.getOverlapX(t,e,i);if(i||0===n||t.immovable&&e.immovable||t.customSeparateX||e.customSeparateX)return 0!==n||t.embedded&&e.embedded;var r=t.velocity.x,i=e.velocity.x;return t.immovable||e.immovable?t.immovable?(e.x+=n,e.velocity.x=r-i*e.bounce.x,t.moves&&(e.y+=(t.y-t.prev.y)*t.friction.y)):(t.x-=n,t.velocity.x=i-r*t.bounce.x,e.moves&&(t.y+=(e.y-e.prev.y)*e.friction.y)):(n*=.5,t.x-=n,e.x+=n,n=Math.sqrt(i*i*e.mass/t.mass)*(0<i?1:-1),n-=r=.5*(n+(i=Math.sqrt(r*r*t.mass/e.mass)*(0<r?1:-1))),i-=r,t.velocity.x=r+n*t.bounce.x,e.velocity.x=r+i*e.bounce.x),!0},separateY:function(t,e,i){var n=this.getOverlapY(t,e,i);if(i||0===n||t.immovable&&e.immovable||t.customSeparateY||e.customSeparateY)return 0!==n||t.embedded&&e.embedded;var r=t.velocity.y,i=e.velocity.y;return t.immovable||e.immovable?t.immovable?(e.y+=n,e.velocity.y=r-i*e.bounce.y,t.moves&&(e.x+=(t.x-t.prev.x)*t.friction.x)):(t.y-=n,t.velocity.y=i-r*t.bounce.y,e.moves&&(t.x+=(e.x-e.prev.x)*e.friction.x)):(n*=.5,t.y-=n,e.y+=n,n=Math.sqrt(i*i*e.mass/t.mass)*(0<i?1:-1),n-=r=.5*(n+(i=Math.sqrt(r*r*t.mass/e.mass)*(0<r?1:-1))),i-=r,t.velocity.y=r+n*t.bounce.y,e.velocity.y=r+i*e.bounce.y),!0},getObjectsUnderPointer:function(t,e,i,n){if(0!==e.length&&t.exists)return this.getObjectsAtLocation(t.x,t.y,e,i,n,t)},getObjectsAtLocation:function(t,e,i,n,r,s){this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(i);for(var i=new U.Rectangle(t,e,1,1),o=[],a=this.quadTree.retrieve(i),l=0;l<a.length;l++)a[l].hitTest(t,e)&&(n&&n.call(r,s,a[l].sprite),o.push(a[l].sprite));return o},moveToObject:function(t,e,i,n){void 0===i&&(i=60),void 0===n&&(n=0);var r=Math.atan2(e.y-t.y,e.x-t.x);return 0<n&&(i=this.distanceBetween(t,e)/(n/1e3)),t.body.velocity.x=Math.cos(r)*i,t.body.velocity.y=Math.sin(r)*i,r},moveToPointer:function(t,e,i,n){void 0===e&&(e=60),i=i||this.game.input.activePointer,void 0===n&&(n=0);var r=this.angleToPointer(t,i);return 0<n&&(e=this.distanceToPointer(t,i)/(n/1e3)),t.body.velocity.x=Math.cos(r)*e,t.body.velocity.y=Math.sin(r)*e,r},moveToXY:function(t,e,i,n,r){void 0===n&&(n=60),void 0===r&&(r=0);var s=Math.atan2(i-t.y,e-t.x);return 0<r&&(n=this.distanceToXY(t,e,i)/(r/1e3)),t.body.velocity.x=Math.cos(s)*n,t.body.velocity.y=Math.sin(s)*n,s},velocityFromAngle:function(t,e,i){return void 0===e&&(e=60),(i=i||new U.Point).setTo(Math.cos(this.game.math.degToRad(t))*e,Math.sin(this.game.math.degToRad(t))*e)},velocityFromRotation:function(t,e,i){return void 0===e&&(e=60),(i=i||new U.Point).setTo(Math.cos(t)*e,Math.sin(t)*e)},accelerationFromRotation:function(t,e,i){return void 0===e&&(e=60),(i=i||new U.Point).setTo(Math.cos(t)*e,Math.sin(t)*e)},accelerateToObject:function(t,e,i,n,r){void 0===i&&(i=60),void 0===n&&(n=1e3),void 0===r&&(r=1e3);e=this.angleBetween(t,e);return t.body.acceleration.setTo(Math.cos(e)*i,Math.sin(e)*i),t.body.maxVelocity.setTo(n,r),e},accelerateToPointer:function(t,e,i,n,r){void 0===i&&(i=60),void 0===e&&(e=this.game.input.activePointer),void 0===n&&(n=1e3),void 0===r&&(r=1e3);e=this.angleToPointer(t,e);return t.body.acceleration.setTo(Math.cos(e)*i,Math.sin(e)*i),t.body.maxVelocity.setTo(n,r),e},accelerateToXY:function(t,e,i,n,r,s){void 0===n&&(n=60),void 0===r&&(r=1e3),void 0===s&&(s=1e3);i=this.angleToXY(t,e,i);return t.body.acceleration.setTo(Math.cos(i)*n,Math.sin(i)*n),t.body.maxVelocity.setTo(r,s),i},distanceBetween:function(t,e,i){void 0===i&&(i=!1);var n=i?t.world.x-e.world.x:t.x-e.x,e=i?t.world.y-e.world.y:t.y-e.y;return Math.sqrt(n*n+e*e)},distanceToXY:function(t,e,i,n){void 0===n&&(n=!1);e=n?t.world.x-e:t.x-e,i=n?t.world.y-i:t.y-i;return Math.sqrt(e*e+i*i)},distanceToPointer:function(t,e,i){void 0===e&&(e=this.game.input.activePointer),void 0===i&&(i=!1);var n=i?t.world.x-e.worldX:t.x-e.worldX,e=i?t.world.y-e.worldY:t.y-e.worldY;return Math.sqrt(n*n+e*e)},angleBetween:function(t,e,i){return void 0===i&&(i=!1),i?Math.atan2(e.world.y-t.world.y,e.world.x-t.world.x):Math.atan2(e.y-t.y,e.x-t.x)},angleBetweenCenters:function(t,e){var i=e.centerX-t.centerX,t=e.centerY-t.centerY;return Math.atan2(t,i)},angleToXY:function(t,e,i,n){return void 0===n&&(n=!1),n?Math.atan2(i-t.world.y,e-t.world.x):Math.atan2(i-t.y,e-t.x)},angleToPointer:function(t,e,i){return void 0===e&&(e=this.game.input.activePointer),void 0===i&&(i=!1),i?Math.atan2(e.worldY-t.world.y,e.worldX-t.world.x):Math.atan2(e.worldY-t.y,e.worldX-t.x)},worldAngleToPointer:function(t,e){return this.angleToPointer(t,e,!0)}},U.Physics.Arcade.Body=function(t){this.sprite=t,this.game=t.game,this.type=U.Physics.ARCADE,this.enable=!0,this.isCircle=!1,this.radius=0,this.offset=new U.Point,this.position=new U.Point(t.x,t.y),this.prev=new U.Point(this.position.x,this.position.y),this.allowRotation=!0,this.rotation=t.angle,this.preRotation=t.angle,this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height,t.texture&&(this.sourceWidth=t.texture.frame.width,this.sourceHeight=t.texture.frame.height),this.halfWidth=Math.abs(t.width/2),this.halfHeight=Math.abs(t.height/2),this.center=new U.Point(t.x+this.halfWidth,t.y+this.halfHeight),this.velocity=new U.Point,this.newVelocity=new U.Point,this.deltaMax=new U.Point,this.acceleration=new U.Point,this.drag=new U.Point,this.allowGravity=!0,this.gravity=new U.Point,this.bounce=new U.Point,this.worldBounce=null,this.onWorldBounds=null,this.onCollide=null,this.onOverlap=null,this.maxVelocity=new U.Point(1e4,1e4),this.friction=new U.Point(1,0),this.angularVelocity=0,this.angularAcceleration=0,this.angularDrag=0,this.maxAngular=1e3,this.mass=1,this.angle=0,this.speed=0,this.facing=U.NONE,this.immovable=!1,this.moves=!0,this.customSeparateX=!1,this.customSeparateY=!1,this.overlapX=0,this.overlapY=0,this.overlapR=0,this.embedded=!1,this.collideWorldBounds=!1,this.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0},this.touching={none:!0,up:!1,down:!1,left:!1,right:!1},this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1},this.blocked={up:!1,down:!1,left:!1,right:!1},this.tilePadding=new U.Point,this.dirty=!1,this.skipQuadTree=!1,this.syncBounds=!1,this.isMoving=!1,this.stopVelocityOnCollide=!0,this.moveTimer=0,this.moveDistance=0,this.moveDuration=0,this.moveTarget=null,this.moveEnd=null,this.onMoveComplete=new U.Signal,this.movementCallback=null,this.movementCallbackContext=null,this._reset=!0,this._sx=t.scale.x,this._sy=t.scale.y,this._dx=0,this._dy=0},U.Physics.Arcade.Body.prototype={updateBounds:function(){var t,e;this.syncBounds?((e=this.sprite.getBounds()).ceilAll(),e.width===this.width&&e.height===this.height||(this.width=e.width,this.height=e.height,this._reset=!0)):(t=Math.abs(this.sprite.scale.x),e=Math.abs(this.sprite.scale.y),t===this._sx&&e===this._sy||(this.width=this.sourceWidth*t,this.height=this.sourceHeight*e,this._sx=t,this._sy=e,this._reset=!0)),this._reset&&(this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight))},preUpdate:function(){this.enable&&!this.game.physics.arcade.isPaused&&(this.dirty=!0,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.world.x-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x,this.position.x-=this.sprite.scale.x<0?this.width:0,this.position.y=this.sprite.world.y-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y,this.position.y-=this.sprite.scale.y<0?this.height:0,this.rotation=this.sprite.angle,this.preRotation=this.rotation,(this._reset||this.sprite.fresh)&&(this.prev.x=this.position.x,this.prev.y=this.position.y),this.moves&&(this.game.physics.arcade.updateMotion(this),this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,this.position.x===this.prev.x&&this.position.y===this.prev.y||(this.angle=Math.atan2(this.velocity.y,this.velocity.x)),this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.collideWorldBounds&&this.checkWorldBounds()&&this.onWorldBounds&&this.onWorldBounds.dispatch(this.sprite,this.blocked.up,this.blocked.down,this.blocked.left,this.blocked.right)),this._dx=this.deltaX(),this._dy=this.deltaY(),this._reset=!1)},updateMovement:function(){var t,e=0,i=0!==this.overlapX||0!==this.overlapY,e=0<this.moveDuration?(this.moveTimer+=this.game.time.elapsedMS,this.moveTimer/this.moveDuration):(this.moveTarget.end.set(this.position.x,this.position.y),this.moveTarget.length/this.moveDistance);return this.movementCallback&&(t=this.movementCallback.call(this.movementCallbackContext,this,this.velocity,e)),!(i||1<=e||void 0!==t&&!0!==t)||(this.stopMovement(1<=e||this.stopVelocityOnCollide&&i),!1)},stopMovement:function(t){this.isMoving&&(this.isMoving=!1,t&&this.velocity.set(0),this.onMoveComplete.dispatch(this.sprite,0!==this.overlapX||0!==this.overlapY))},postUpdate:function(){this.enable&&this.dirty&&(this.isMoving&&this.updateMovement(),this.dirty=!1,this.deltaX()<0?this.facing=U.LEFT:0<this.deltaX()&&(this.facing=U.RIGHT),this.deltaY()<0?this.facing=U.UP:0<this.deltaY()&&(this.facing=U.DOWN),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),0!==this.deltaMax.x&&0!==this._dx&&(this._dx<0&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:0<this._dx&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),0!==this.deltaMax.y&&0!==this._dy&&(this._dy<0&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:0<this._dy&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),this.sprite.position.x+=this._dx,this.sprite.position.y+=this._dy,this._reset=!0),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.allowRotation&&(this.sprite.angle+=this.deltaZ()),this.prev.x=this.position.x,this.prev.y=this.position.y)},checkWorldBounds:function(){var t,e,i,n,r=this.position,s=this.game.physics.arcade.bounds,o=this.game.physics.arcade.checkCollision,a=this.worldBounce?-this.worldBounce.x:-this.bounce.x,l=this.worldBounce?-this.worldBounce.y:-this.bounce.y;return this.isCircle?(t=this.center.x-this.radius,e=this.center.y-this.radius,i=this.center.x+this.radius,n=this.center.y+this.radius,t<s.x&&o.left?(r.x=s.x-this.halfWidth+this.radius,this.velocity.x*=a,this.blocked.left=!0):i>s.right&&o.right&&(r.x=s.right-this.halfWidth-this.radius,this.velocity.x*=a,this.blocked.right=!0),e<s.y&&o.up?(r.y=s.y-this.halfHeight+this.radius,this.velocity.y*=l,this.blocked.up=!0):n>s.bottom&&o.down&&(r.y=s.bottom-this.halfHeight-this.radius,this.velocity.y*=l,this.blocked.down=!0)):(r.x<s.x&&o.left?(r.x=s.x,this.velocity.x*=a,this.blocked.left=!0):this.right>s.right&&o.right&&(r.x=s.right-this.width,this.velocity.x*=a,this.blocked.right=!0),r.y<s.y&&o.up?(r.y=s.y,this.velocity.y*=l,this.blocked.up=!0):this.bottom>s.bottom&&o.down&&(r.y=s.bottom-this.height,this.velocity.y*=l,this.blocked.down=!0)),this.blocked.up||this.blocked.down||this.blocked.left||this.blocked.right},moveFrom:function(t,e,i){return void 0===e&&(e=this.speed),0!==e&&(void 0===i?(n=this.angle,i=this.game.math.radToDeg(n)):n=this.game.math.degToRad(i),this.moveTimer=0,this.moveDuration=t,0===i||180===i?this.velocity.set(Math.cos(n)*e,0):90===i||270===i?this.velocity.set(0,Math.sin(n)*e):this.velocity.set(Math.cos(n)*e,Math.sin(n)*e),this.isMoving=!0);var n},moveTo:function(t,e,i){var n,t=e/(t/1e3);return 0!=t&&(void 0===i?(n=this.angle,i=this.game.math.radToDeg(n)):n=this.game.math.degToRad(i),e=Math.abs(e),this.moveDuration=0,this.moveDistance=e,null===this.moveTarget&&(this.moveTarget=new U.Line,this.moveEnd=new U.Point),this.moveTarget.fromAngle(this.x,this.y,n,e),this.moveEnd.set(this.moveTarget.end.x,this.moveTarget.end.y),this.moveTarget.setTo(this.x,this.y,this.x,this.y),0===i||180===i?this.velocity.set(Math.cos(n)*t,0):90===i||270===i?this.velocity.set(0,Math.sin(n)*t):this.velocity.set(Math.cos(n)*t,Math.sin(n)*t),this.isMoving=!0)},setSize:function(t,e,i,n){void 0===i&&(i=this.offset.x),void 0===n&&(n=this.offset.y),this.sourceWidth=t,this.sourceHeight=e,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.setTo(i,n),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.isCircle=!1,this.radius=0},setCircle:function(t,e,i){void 0===e&&(e=this.offset.x),void 0===i&&(i=this.offset.y),0<t?(this.isCircle=!0,this.radius=t,this.sourceWidth=2*t,this.sourceHeight=2*t,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.setTo(e,i),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)):this.isCircle=!1},reset:function(t,e){this.velocity.set(0),this.acceleration.set(0),this.speed=0,this.angularVelocity=0,this.angularAcceleration=0,this.position.x=t-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x,this.position.x-=this.sprite.scale.x<0?this.width:0,this.position.y=e-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y,this.position.y-=this.sprite.scale.y<0?this.height:0,this.prev.x=this.position.x,this.prev.y=this.position.y,this.rotation=this.sprite.angle,this.preRotation=this.rotation,this._sx=this.sprite.scale.x,this._sy=this.sprite.scale.y,this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},getBounds:function(t){return this.isCircle?(t.x=this.center.x-this.radius,t.y=this.center.y-this.radius,t.right=this.center.x+this.radius,t.bottom=this.center.y+this.radius):(t.x=this.x,t.y=this.y,t.right=this.right,t.bottom=this.bottom),t},hitTest:function(t,e){return(this.isCircle?U.Circle:U.Rectangle).contains(this,t,e)},onFloor:function(){return this.blocked.down},onCeiling:function(){return this.blocked.up},onWall:function(){return this.blocked.left||this.blocked.right},deltaAbsX:function(){return 0<this.deltaX()?this.deltaX():-this.deltaX()},deltaAbsY:function(){return 0<this.deltaY()?this.deltaY():-this.deltaY()},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation},destroy:function(){this.sprite.parent&&this.sprite.parent instanceof U.Group&&this.sprite.parent.removeFromHash(this.sprite),this.sprite.body=null,this.sprite=null}},Object.defineProperty(U.Physics.Arcade.Body.prototype,"left",{get:function(){return this.position.x}}),Object.defineProperty(U.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}}),Object.defineProperty(U.Physics.Arcade.Body.prototype,"top",{get:function(){return this.position.y}}),Object.defineProperty(U.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}}),Object.defineProperty(U.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(U.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),U.Physics.Arcade.Body.render=function(t,e,i,n){void 0===n&&(n=!0),i=i||"rgba(0,255,0,0.4)",t.fillStyle=i,t.strokeStyle=i,e.isCircle?(t.beginPath(),t.arc(e.center.x-e.game.camera.x,e.center.y-e.game.camera.y,e.radius,0,2*Math.PI),n?t.fill():t.stroke()):n?t.fillRect(e.position.x-e.game.camera.x,e.position.y-e.game.camera.y,e.width,e.height):t.strokeRect(e.position.x-e.game.camera.x,e.position.y-e.game.camera.y,e.width,e.height)},U.Physics.Arcade.Body.renderBodyInfo=function(t,e){t.line("x: "+e.x.toFixed(2),"y: "+e.y.toFixed(2),"width: "+e.width,"height: "+e.height),t.line("velocity x: "+e.velocity.x.toFixed(2),"y: "+e.velocity.y.toFixed(2),"deltaX: "+e._dx.toFixed(2),"deltaY: "+e._dy.toFixed(2)),t.line("acceleration x: "+e.acceleration.x.toFixed(2),"y: "+e.acceleration.y.toFixed(2),"speed: "+e.speed.toFixed(2),"angle: "+e.angle.toFixed(2)),t.line("gravity x: "+e.gravity.x,"y: "+e.gravity.y,"bounce x: "+e.bounce.x.toFixed(2),"y: "+e.bounce.y.toFixed(2)),t.line("touching left: "+e.touching.left,"right: "+e.touching.right,"up: "+e.touching.up,"down: "+e.touching.down),t.line("blocked left: "+e.blocked.left,"right: "+e.blocked.right,"up: "+e.blocked.up,"down: "+e.blocked.down)},U.Physics.Arcade.Body.prototype.constructor=U.Physics.Arcade.Body,U.Physics.Arcade.TilemapCollision=function(){},U.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(t,e,i,n,r,s){if(t.body){var o=e.getTiles(t.body.position.x-t.body.tilePadding.x,t.body.position.y-t.body.tilePadding.y,t.body.width+t.body.tilePadding.x,t.body.height+t.body.tilePadding.y,!1,!1);if(0!==o.length)for(var a=0;a<o.length;a++)n?n.call(r,t,o[a])&&this.separateTile(a,t.body,o[a],e,s)&&(this._total++,i&&i.call(r,t,o[a])):this.separateTile(a,t.body,o[a],e,s)&&(this._total++,i&&i.call(r,t,o[a]))}},collideGroupVsTilemapLayer:function(t,e,i,n,r,s){if(0!==t.length)for(var o=0;o<t.children.length;o++)t.children[o].exists&&this.collideSpriteVsTilemapLayer(t.children[o],e,i,n,r,s)},separateTile:function(t,e,i,n,r){if(!e.enable)return!1;var s=n.fixedToCamera?0:n.position.x,o=n.fixedToCamera?0:n.position.y;if(!i.intersects(e.position.x-s,e.position.y-o,e.right-s,e.bottom-o))return!1;if(r)return!0;if(i.collisionCallback&&!i.collisionCallback.call(i.collisionCallbackContext,e.sprite,i))return!1;if(void 0!==i.layer.callbacks&&i.layer.callbacks[i.index]&&!i.layer.callbacks[i.index].callback.call(i.layer.callbacks[i.index].callbackContext,e.sprite,i))return!1;if(!(i.faceLeft||i.faceRight||i.faceTop||i.faceBottom))return!1;var a=0,l=0,p=0,r=1;if(e.deltaAbsX()>e.deltaAbsY()?p=-1:e.deltaAbsX()<e.deltaAbsY()&&(r=-1),0!==e.deltaX()&&0!==e.deltaY()&&(i.faceLeft||i.faceRight)&&(i.faceTop||i.faceBottom)&&(p=Math.min(Math.abs(e.position.x-s-i.right),Math.abs(e.right-s-i.left)),r=Math.min(Math.abs(e.position.y-o-i.bottom),Math.abs(e.bottom-o-i.top))),p<r){if((i.faceLeft||i.faceRight)&&(0!==(a=this.tileCheckX(e,i,n))&&!i.intersects(e.position.x-s,e.position.y-o,e.right-s,e.bottom-o)))return!0;(i.faceTop||i.faceBottom)&&(l=this.tileCheckY(e,i,n))}else{if((i.faceTop||i.faceBottom)&&(0!==(l=this.tileCheckY(e,i,n))&&!i.intersects(e.position.x-s,e.position.y-o,e.right-s,e.bottom-o)))return!0;(i.faceLeft||i.faceRight)&&(a=this.tileCheckX(e,i,n))}return 0!==a||0!==l},tileCheckX:function(t,e,i){var n=0,i=i.fixedToCamera?0:i.position.x;return t.deltaX()<0&&!t.blocked.left&&e.collideRight&&t.checkCollision.left?e.faceRight&&t.x-i<e.right&&((n=t.x-i-e.right)<-this.TILE_BIAS&&(n=0)):0<t.deltaX()&&!t.blocked.right&&e.collideLeft&&t.checkCollision.right&&e.faceLeft&&t.right-i>e.left&&((n=t.right-i-e.left)>this.TILE_BIAS&&(n=0)),0!==n&&(t.customSeparateX?t.overlapX=n:this.processTileSeparationX(t,n)),n},tileCheckY:function(t,e,i){var n=0,i=i.fixedToCamera?0:i.position.y;return t.deltaY()<0&&!t.blocked.up&&e.collideDown&&t.checkCollision.up?e.faceBottom&&t.y-i<e.bottom&&((n=t.y-i-e.bottom)<-this.TILE_BIAS&&(n=0)):0<t.deltaY()&&!t.blocked.down&&e.collideUp&&t.checkCollision.down&&e.faceTop&&t.bottom-i>e.top&&((n=t.bottom-i-e.top)>this.TILE_BIAS&&(n=0)),0!==n&&(t.customSeparateY?t.overlapY=n:this.processTileSeparationY(t,n)),n},processTileSeparationX:function(t,e){e<0?t.blocked.left=!0:0<e&&(t.blocked.right=!0),t.position.x-=e,0===t.bounce.x?t.velocity.x=0:t.velocity.x=-t.velocity.x*t.bounce.x},processTileSeparationY:function(t,e){e<0?t.blocked.up=!0:0<e&&(t.blocked.down=!0),t.position.y-=e,0===t.bounce.y?t.velocity.y=0:t.velocity.y=-t.velocity.y*t.bounce.y}},U.Utils.mixinPrototype(U.Physics.Arcade.prototype,U.Physics.Arcade.TilemapCollision.prototype),p2.Body.prototype.parent=null,p2.Spring.prototype.parent=null,U.Physics.P2=function(t,e){this.game=t,void 0===e?e={gravity:[0,0],broadphase:new p2.SAPBroadphase}:(e.hasOwnProperty("gravity")||(e.gravity=[0,0]),e.hasOwnProperty("broadphase")||(e.broadphase=new p2.SAPBroadphase)),this.config=e,this.world=new p2.World(this.config),this.frameRate=1/60,this.useElapsedTime=!1,this.paused=!1,this.materials=[],this.gravity=new U.Physics.P2.InversePointProxy(this,this.world.gravity),this.walls={left:null,right:null,top:null,bottom:null},this.onBodyAdded=new U.Signal,this.onBodyRemoved=new U.Signal,this.onSpringAdded=new U.Signal,this.onSpringRemoved=new U.Signal,this.onConstraintAdded=new U.Signal,this.onConstraintRemoved=new U.Signal,this.onContactMaterialAdded=new U.Signal,this.onContactMaterialRemoved=new U.Signal,this.postBroadphaseCallback=null,this.callbackContext=null,this.onBeginContact=new U.Signal,this.onEndContact=new U.Signal,e.hasOwnProperty("mpx")&&e.hasOwnProperty("pxm")&&e.hasOwnProperty("mpxi")&&e.hasOwnProperty("pxmi")&&(this.mpx=e.mpx,this.mpxi=e.mpxi,this.pxm=e.pxm,this.pxmi=e.pxmi),this.world.on("beginContact",this.beginContactHandler,this),this.world.on("endContact",this.endContactHandler,this),this.collisionGroups=[],this.nothingCollisionGroup=new U.Physics.P2.CollisionGroup(1),this.boundsCollisionGroup=new U.Physics.P2.CollisionGroup(2),this.everythingCollisionGroup=new U.Physics.P2.CollisionGroup(2147483648),this.boundsCollidesWith=[],this._toRemove=[],this._collisionGroupID=2,this._boundsLeft=!0,this._boundsRight=!0,this._boundsTop=!0,this._boundsBottom=!0,this._boundsOwnGroup=!1,this.setBoundsToWorld(!0,!0,!0,!0,!1)},U.Physics.P2.prototype={removeBodyNextStep:function(t){this._toRemove.push(t)},preUpdate:function(){for(var t=this._toRemove.length;t--;)this.removeBody(this._toRemove[t]);this._toRemove.length=0},enable:function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!0);var n=1;if(Array.isArray(t))for(n=t.length;n--;)t[n]instanceof U.Group?this.enable(t[n].children,e,i):(this.enableBody(t[n],e),i&&t[n].hasOwnProperty("children")&&0<t[n].children.length&&this.enable(t[n],e,!0));else t instanceof U.Group?this.enable(t.children,e,i):(this.enableBody(t,e),i&&t.hasOwnProperty("children")&&0<t.children.length&&this.enable(t.children,e,!0))},enableBody:function(t,e){t.hasOwnProperty("body")&&null===t.body&&(t.body=new U.Physics.P2.Body(this.game,t,t.x,t.y,1),t.body.debug=e,void 0!==t.anchor&&t.anchor.set(.5))},setImpactEvents:function(t){t?this.world.on("impact",this.impactHandler,this):this.world.off("impact",this.impactHandler,this)},setPostBroadphaseCallback:function(t,e){this.postBroadphaseCallback=t,this.callbackContext=e,null!==t?this.world.on("postBroadphase",this.postBroadphaseHandler,this):this.world.off("postBroadphase",this.postBroadphaseHandler,this)},postBroadphaseHandler:function(t){if(this.postBroadphaseCallback&&0!==t.pairs.length)for(var e=t.pairs.length-2;0<=e;e-=2)t.pairs[e].parent&&t.pairs[e+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,t.pairs[e].parent,t.pairs[e+1].parent)&&t.pairs.splice(e,2)},impactHandler:function(t){var e,i;t.bodyA.parent&&t.bodyB.parent&&(e=t.bodyA.parent,i=t.bodyB.parent,e._bodyCallbacks[t.bodyB.id]&&e._bodyCallbacks[t.bodyB.id].call(e._bodyCallbackContext[t.bodyB.id],e,i,t.shapeA,t.shapeB),i._bodyCallbacks[t.bodyA.id]&&i._bodyCallbacks[t.bodyA.id].call(i._bodyCallbackContext[t.bodyA.id],i,e,t.shapeB,t.shapeA),e._groupCallbacks[t.shapeB.collisionGroup]&&e._groupCallbacks[t.shapeB.collisionGroup].call(e._groupCallbackContext[t.shapeB.collisionGroup],e,i,t.shapeA,t.shapeB),i._groupCallbacks[t.shapeA.collisionGroup]&&i._groupCallbacks[t.shapeA.collisionGroup].call(i._groupCallbackContext[t.shapeA.collisionGroup],i,e,t.shapeB,t.shapeA))},beginContactHandler:function(t){t.bodyA&&t.bodyB&&(this.onBeginContact.dispatch(t.bodyA,t.bodyB,t.shapeA,t.shapeB,t.contactEquations),t.bodyA.parent&&t.bodyA.parent.onBeginContact.dispatch(t.bodyB.parent,t.bodyB,t.shapeA,t.shapeB,t.contactEquations),t.bodyB.parent&&t.bodyB.parent.onBeginContact.dispatch(t.bodyA.parent,t.bodyA,t.shapeB,t.shapeA,t.contactEquations))},endContactHandler:function(t){t.bodyA&&t.bodyB&&(this.onEndContact.dispatch(t.bodyA,t.bodyB,t.shapeA,t.shapeB),t.bodyA.parent&&t.bodyA.parent.onEndContact.dispatch(t.bodyB.parent,t.bodyB,t.shapeA,t.shapeB),t.bodyB.parent&&t.bodyB.parent.onEndContact.dispatch(t.bodyA.parent,t.bodyA,t.shapeB,t.shapeA))},setBoundsToWorld:function(t,e,i,n,r){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,t,e,i,n,r)},setWorldMaterial:function(t,e,i,n,r){void 0===e&&(e=!0),void 0===i&&(i=!0),void 0===n&&(n=!0),void 0===r&&(r=!0),e&&this.walls.left&&(this.walls.left.shapes[0].material=t),i&&this.walls.right&&(this.walls.right.shapes[0].material=t),n&&this.walls.top&&(this.walls.top.shapes[0].material=t),r&&this.walls.bottom&&(this.walls.bottom.shapes[0].material=t)},updateBoundsCollisionGroup:function(t){void 0===t&&(t=!0);var e=(t?this.boundsCollisionGroup:this.everythingCollisionGroup).mask;this.walls.left&&(this.walls.left.shapes[0].collisionGroup=e),this.walls.right&&(this.walls.right.shapes[0].collisionGroup=e),this.walls.top&&(this.walls.top.shapes[0].collisionGroup=e),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionGroup=e),this._boundsOwnGroup=t},setBounds:function(t,e,i,n,r,s,o,a,l){void 0===r&&(r=this._boundsLeft),void 0===s&&(s=this._boundsRight),void 0===o&&(o=this._boundsTop),void 0===a&&(a=this._boundsBottom),void 0===l&&(l=this._boundsOwnGroup),this.setupWall(r,"left",t,e,1.5707963267948966,l),this.setupWall(s,"right",t+i,e,-1.5707963267948966,l),this.setupWall(o,"top",t,e,-3.141592653589793,l),this.setupWall(a,"bottom",t,e+n,0,l),this._boundsLeft=r,this._boundsRight=s,this._boundsTop=o,this._boundsBottom=a,this._boundsOwnGroup=l},setupWall:function(t,e,i,n,r,s){t?(this.walls[e]?this.walls[e].position=[this.pxmi(i),this.pxmi(n)]:(this.walls[e]=new p2.Body({mass:0,position:[this.pxmi(i),this.pxmi(n)],angle:r}),this.walls[e].addShape(new p2.Plane),this.world.addBody(this.walls[e])),s&&(this.walls[e].shapes[0].collisionGroup=this.boundsCollisionGroup.mask)):this.walls[e]&&(this.world.removeBody(this.walls[e]),this.walls[e]=null)},pause:function(){this.paused=!0},resume:function(){this.paused=!1},update:function(){this.paused||(this.useElapsedTime?this.world.step(this.game.time.physicsElapsed):this.world.step(this.frameRate))},reset:function(){this.world.on("beginContact",this.beginContactHandler,this),this.world.on("endContact",this.endContactHandler,this),this.nothingCollisionGroup=new U.Physics.P2.CollisionGroup(1),this.boundsCollisionGroup=new U.Physics.P2.CollisionGroup(2),this.everythingCollisionGroup=new U.Physics.P2.CollisionGroup(2147483648),this._collisionGroupID=2,this.setBoundsToWorld(!0,!0,!0,!0,!1)},clear:function(){this.world.time=0,this.world.fixedStepTime=0,this.world.solver&&this.world.solver.equations.length&&this.world.solver.removeAllEquations();for(var t=this.world.constraints,e=t.length-1;0<=e;e--)this.world.removeConstraint(t[e]);for(var i=this.world.bodies,e=i.length-1;0<=e;e--)this.world.removeBody(i[e]);for(var n=this.world.springs,e=n.length-1;0<=e;e--)this.world.removeSpring(n[e]);for(var r=this.world.contactMaterials,e=r.length-1;0<=e;e--)this.world.removeContactMaterial(r[e]);this.world.off("beginContact",this.beginContactHandler,this),this.world.off("endContact",this.endContactHandler,this),this.postBroadphaseCallback=null,this.callbackContext=null,this.impactCallback=null,this.collisionGroups=[],this._toRemove=[],this.boundsCollidesWith=[],this.walls={left:null,right:null,top:null,bottom:null}},destroy:function(){this.clear(),this.game=null},addBody:function(t){return!t.data.world&&(this.world.addBody(t.data),this.onBodyAdded.dispatch(t),!0)},removeBody:function(t){return t.data.world===this.world&&(this.world.removeBody(t.data),this.onBodyRemoved.dispatch(t)),t},addSpring:function(t){return t instanceof U.Physics.P2.Spring||t instanceof U.Physics.P2.RotationalSpring?this.world.addSpring(t.data):this.world.addSpring(t),this.onSpringAdded.dispatch(t),t},removeSpring:function(t){return t instanceof U.Physics.P2.Spring||t instanceof U.Physics.P2.RotationalSpring?this.world.removeSpring(t.data):this.world.removeSpring(t),this.onSpringRemoved.dispatch(t),t},createDistanceConstraint:function(t,e,i,n,r,s){return t=this.getBody(t),e=this.getBody(e),t&&e?this.addConstraint(new U.Physics.P2.DistanceConstraint(this,t,e,i,n,r,s)):void console.warn("Cannot create Constraint, invalid body objects given")},createGearConstraint:function(t,e,i,n){return t=this.getBody(t),e=this.getBody(e),t&&e?this.addConstraint(new U.Physics.P2.GearConstraint(this,t,e,i,n)):void console.warn("Cannot create Constraint, invalid body objects given")},createRevoluteConstraint:function(t,e,i,n,r,s){return t=this.getBody(t),i=this.getBody(i),t&&i?this.addConstraint(new U.Physics.P2.RevoluteConstraint(this,t,e,i,n,r,s)):void console.warn("Cannot create Constraint, invalid body objects given")},createLockConstraint:function(t,e,i,n,r){return t=this.getBody(t),e=this.getBody(e),t&&e?this.addConstraint(new U.Physics.P2.LockConstraint(this,t,e,i,n,r)):void console.warn("Cannot create Constraint, invalid body objects given")},createPrismaticConstraint:function(t,e,i,n,r,s,o){return t=this.getBody(t),e=this.getBody(e),t&&e?this.addConstraint(new U.Physics.P2.PrismaticConstraint(this,t,e,i,n,r,s,o)):void console.warn("Cannot create Constraint, invalid body objects given")},addConstraint:function(t){return this.world.addConstraint(t),this.onConstraintAdded.dispatch(t),t},removeConstraint:function(t){return this.world.removeConstraint(t),this.onConstraintRemoved.dispatch(t),t},addContactMaterial:function(t){return this.world.addContactMaterial(t),this.onContactMaterialAdded.dispatch(t),t},removeContactMaterial:function(t){return this.world.removeContactMaterial(t),this.onContactMaterialRemoved.dispatch(t),t},getContactMaterial:function(t,e){return this.world.getContactMaterial(t,e)},setMaterial:function(t,e){for(var i=e.length;i--;)e[i].setMaterial(t)},createMaterial:function(t,e){t=t||"";t=new U.Physics.P2.Material(t);return this.materials.push(t),void 0!==e&&e.setMaterial(t),t},createContactMaterial:function(t,e,i){void 0===t&&(t=this.createMaterial()),void 0===e&&(e=this.createMaterial());i=new U.Physics.P2.ContactMaterial(t,e,i);return this.addContactMaterial(i)},getBodies:function(){for(var t=[],e=this.world.bodies.length;e--;)t.push(this.world.bodies[e].parent);return t},getBody:function(t){return t instanceof p2.Body?t:t instanceof U.Physics.P2.Body?t.data:t.body&&t.body.type===U.Physics.P2JS?t.body.data:null},getSprings:function(){for(var t=[],e=this.world.springs.length;e--;)t.push(this.world.springs[e].parent);return t},getConstraints:function(){for(var t=[],e=this.world.constraints.length;e--;)t.push(this.world.constraints[e]);return t},hitTest:function(t,e,i,n){void 0===e&&(e=this.world.bodies),void 0===i&&(i=5),void 0===n&&(n=!1);for(var t=[this.pxmi(t.x),this.pxmi(t.y)],r=[],s=e.length;s--;)e[s]instanceof U.Physics.P2.Body&&(!n||e[s].data.type!==p2.Body.STATIC)?r.push(e[s].data):e[s]instanceof p2.Body&&e[s].parent&&(!n||e[s].type!==p2.Body.STATIC)?r.push(e[s]):e[s]instanceof U.Sprite&&e[s].hasOwnProperty("body")&&(!n||e[s].body.data.type!==p2.Body.STATIC)&&r.push(e[s].body.data);return this.world.hitTest(t,r,i)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(t){var e=Math.pow(2,this._collisionGroupID);this.walls.left&&(this.walls.left.shapes[0].collisionMask=this.walls.left.shapes[0].collisionMask|e),this.walls.right&&(this.walls.right.shapes[0].collisionMask=this.walls.right.shapes[0].collisionMask|e),this.walls.top&&(this.walls.top.shapes[0].collisionMask=this.walls.top.shapes[0].collisionMask|e),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionMask=this.walls.bottom.shapes[0].collisionMask|e),this._collisionGroupID++;e=new U.Physics.P2.CollisionGroup(e);return this.collisionGroups.push(e),t&&this.setCollisionGroup(t,e),e},setCollisionGroup:function(t,e){if(t instanceof U.Group)for(var i=0;i<t.total;i++)t.children[i].body&&t.children[i].body.type===U.Physics.P2JS&&t.children[i].body.setCollisionGroup(e);else t.body.setCollisionGroup(e)},createSpring:function(t,e,i,n,r,s,o,a,l){return t=this.getBody(t),e=this.getBody(e),t&&e?this.addSpring(new U.Physics.P2.Spring(this,t,e,i,n,r,s,o,a,l)):void console.warn("Cannot create Spring, invalid body objects given")},createRotationalSpring:function(t,e,i,n,r){return t=this.getBody(t),e=this.getBody(e),t&&e?this.addSpring(new U.Physics.P2.RotationalSpring(this,t,e,i,n,r)):void console.warn("Cannot create Rotational Spring, invalid body objects given")},createBody:function(t,e,i,n,r,s){void 0===n&&(n=!1);i=new U.Physics.P2.Body(this.game,null,t,e,i);if(s&&!i.addPolygon(r,s))return!1;return n&&this.world.addBody(i.data),i},createParticle:function(t,e,i,n,r,s){void 0===n&&(n=!1);i=new U.Physics.P2.Body(this.game,null,t,e,i);if(s&&!i.addPolygon(r,s))return!1;return n&&this.world.addBody(i.data),i},convertCollisionObjects:function(t,e,i){void 0===i&&(i=!0);for(var n=[],r=0,s=t.collision[e].length;r<s;r++){var o=t.collision[e][r],o=this.createBody(o.x,o.y,0,i,{},o.polyline);o&&n.push(o)}return n},clearTilemapLayerBodies:function(t,e){e=t.getLayer(e);for(var i=t.layers[e].bodies.length;i--;)t.layers[e].bodies[i].destroy();t.layers[e].bodies.length=0},convertTilemap:function(t,e,i,n){e=t.getLayer(e),void 0===i&&(i=!0),void 0===n&&(n=!0),this.clearTilemapLayerBodies(t,e);for(var r=0,s=0,o=0,a=0,l=t.layers[e].height;a<l;a++)for(var p=r=0,h=t.layers[e].width;p<h;p++){var u,c,d=t.layers[e].data[a][p];d&&-1<d.index&&d.collides&&(n?(u=t.getTileRight(e,p,a),0===r&&(s=d.x*d.width,o=d.y*d.height,r=d.width),u&&u.collides?r+=d.width:((c=this.createBody(s,o,0,!1)).addRectangle(r,d.height,r/2,d.height/2,0),i&&this.addBody(c),t.layers[e].bodies.push(c),r=0)):((c=this.createBody(d.x*d.width,d.y*d.height,0,!1)).addRectangle(d.width,d.height,d.width/2,d.height/2,0),i&&this.addBody(c),t.layers[e].bodies.push(c)))}return t.layers[e].bodies},mpx:function(t){return 20*t},pxm:function(t){return.05*t},mpxi:function(t){return-20*t},pxmi:function(t){return-.05*t}},Object.defineProperty(U.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(t){this.world.defaultContactMaterial.friction=t}}),Object.defineProperty(U.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(t){this.world.defaultContactMaterial.restitution=t}}),Object.defineProperty(U.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(t){this.world.defaultContactMaterial=t}}),Object.defineProperty(U.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(t){this.world.applySpringForces=t}}),Object.defineProperty(U.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(t){this.world.applyDamping=t}}),Object.defineProperty(U.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(t){this.world.applyGravity=t}}),Object.defineProperty(U.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(t){this.world.solveConstraints=t}}),Object.defineProperty(U.Physics.P2.prototype,"time",{get:function(){return this.world.time}}),Object.defineProperty(U.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(t){this.world.emitImpactEvent=t}}),Object.defineProperty(U.Physics.P2.prototype,"sleepMode",{get:function(){return this.world.sleepMode},set:function(t){this.world.sleepMode=t}}),Object.defineProperty(U.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}}),U.Physics.P2.FixtureList=function(t){Array.isArray(t)||(t=[t]),this.rawList=t,this.init(),this.parse(this.rawList)},U.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={},this.groupedFixtures=[],this.allFixtures=[]},setCategory:function(e,t){this.getFixtures(t).forEach(function(t){t.collisionGroup=e})},setMask:function(e,t){this.getFixtures(t).forEach(function(t){t.collisionMask=e})},setSensor:function(e,t){this.getFixtures(t).forEach(function(t){t.sensor=e})},setMaterial:function(e,t){this.getFixtures(t).forEach(function(t){t.material=e})},getFixtures:function(t){var e=[];if(t){t instanceof Array||(t=[t]);var i=this;return t.forEach(function(t){i.namedFixtures[t]&&e.push(i.namedFixtures[t])}),this.flatten(e)}return this.allFixtures},getFixtureByKey:function(t){return this.namedFixtures[t]},getGroup:function(t){return this.groupedFixtures[t]},parse:function(){var t,e,i=this.rawList,n=[];for(t in i)e=i[t],isNaN(+t)?this.namedFixtures[t]=this.flatten(e):(this.groupedFixtures[t]=this.groupedFixtures[t]||[],this.groupedFixtures[t]=this.groupedFixtures[t].concat(e)),n.push(this.allFixtures=this.flatten(this.groupedFixtures))},flatten:function(t){var e=[],i=arguments.callee;return t.forEach(function(t){return Array.prototype.push.apply(e,Array.isArray(t)?i(t):[t])}),e}},U.Physics.P2.PointProxy=function(t,e){this.world=t,this.destination=e},U.Physics.P2.PointProxy.prototype.constructor=U.Physics.P2.PointProxy,Object.defineProperty(U.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.world.mpx(this.destination[0])},set:function(t){this.destination[0]=this.world.pxm(t)}}),Object.defineProperty(U.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.world.mpx(this.destination[1])},set:function(t){this.destination[1]=this.world.pxm(t)}}),Object.defineProperty(U.Physics.P2.PointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(t){this.destination[0]=t}}),Object.defineProperty(U.Physics.P2.PointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(t){this.destination[1]=t}}),U.Physics.P2.InversePointProxy=function(t,e){this.world=t,this.destination=e},U.Physics.P2.InversePointProxy.prototype.constructor=U.Physics.P2.InversePointProxy,Object.defineProperty(U.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.world.mpxi(this.destination[0])},set:function(t){this.destination[0]=this.world.pxmi(t)}}),Object.defineProperty(U.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.world.mpxi(this.destination[1])},set:function(t){this.destination[1]=this.world.pxmi(t)}}),Object.defineProperty(U.Physics.P2.InversePointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(t){this.destination[0]=-t}}),Object.defineProperty(U.Physics.P2.InversePointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(t){this.destination[1]=-t}}),U.Physics.P2.Body=function(t,e,i,n,r){e=e||null,i=i||0,n=n||0,void 0===r&&(r=1),this.game=t,this.world=t.physics.p2,this.sprite=e,this.type=U.Physics.P2JS,this.offset=new U.Point,this.data=new p2.Body({position:[this.world.pxmi(i),this.world.pxmi(n)],mass:r}),(this.data.parent=this).velocity=new U.Physics.P2.InversePointProxy(this.world,this.data.velocity),this.force=new U.Physics.P2.InversePointProxy(this.world,this.data.force),this.gravity=new U.Point,this.onBeginContact=new U.Signal,this.onEndContact=new U.Signal,this.collidesWith=[],this.removeNextStep=!1,this.debugBody=null,this.dirty=!1,this._collideWorldBounds=!0,this._bodyCallbacks={},this._bodyCallbackContext={},this._groupCallbacks={},this._groupCallbackContext={},this._reset=!1,e&&(this.setRectangleFromSprite(e),e.exists&&this.game.physics.p2.addBody(this))},U.Physics.P2.Body.prototype={createBodyCallback:function(t,e,i){var n=-1;t.id?n=t.id:t.body&&(n=t.body.id),-1<n&&(null===e?(delete this._bodyCallbacks[n],delete this._bodyCallbackContext[n]):(this._bodyCallbacks[n]=e,this._bodyCallbackContext[n]=i))},createGroupCallback:function(t,e,i){null===e?(delete this._groupCallbacks[t.mask],delete this._groupCallbackContext[t.mask]):(this._groupCallbacks[t.mask]=e,this._groupCallbackContext[t.mask]=i)},getCollisionMask:function(){var t=0;this._collideWorldBounds&&(t=this.game.physics.p2.boundsCollisionGroup.mask);for(var e=0;e<this.collidesWith.length;e++)t|=this.collidesWith[e].mask;return t},updateCollisionMask:function(t){var e=this.getCollisionMask();if(void 0===t)for(var i=this.data.shapes.length-1;0<=i;i--)this.data.shapes[i].collisionMask=e;else t.collisionMask=e},setCollisionGroup:function(t,e){var i=this.getCollisionMask();if(void 0===e)for(var n=this.data.shapes.length-1;0<=n;n--)this.data.shapes[n].collisionGroup=t.mask,this.data.shapes[n].collisionMask=i;else e.collisionGroup=t.mask,e.collisionMask=i},clearCollision:function(t,e,i){if(void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===i)for(var n=this.data.shapes.length-1;0<=n;n--)t&&(this.data.shapes[n].collisionGroup=null),e&&(this.data.shapes[n].collisionMask=null);else t&&(i.collisionGroup=null),e&&(i.collisionMask=null);t&&(this.collidesWith.length=0)},removeCollisionGroup:function(t,e,i){var n;if(void 0===e&&(e=!0),Array.isArray(t))for(var r=0;r<t.length;r++)-1<(n=this.collidesWith.indexOf(t[r]))&&(this.collidesWith.splice(n,1),e&&(delete this._groupCallbacks[t.mask],delete this._groupCallbackContext[t.mask]));else-1<(n=this.collidesWith.indexOf(t))&&(this.collidesWith.splice(n,1),e&&(delete this._groupCallbacks[t.mask],delete this._groupCallbackContext[t.mask]));var s=this.getCollisionMask();if(void 0===i)for(r=this.data.shapes.length-1;0<=r;r--)this.data.shapes[r].collisionMask=s;else i.collisionMask=s},collides:function(t,e,i,n){if(Array.isArray(t))for(var r=0;r<t.length;r++)-1===this.collidesWith.indexOf(t[r])&&(this.collidesWith.push(t[r]),e&&this.createGroupCallback(t[r],e,i));else-1===this.collidesWith.indexOf(t)&&(this.collidesWith.push(t),e&&this.createGroupCallback(t,e,i));var s=this.getCollisionMask();if(void 0===n)for(r=this.data.shapes.length-1;0<=r;r--)this.data.shapes[r].collisionMask=s;else n.collisionMask=s},adjustCenterOfMass:function(){this.data.adjustCenterOfMass(),this.shapeChanged()},getVelocityAtPoint:function(t,e){return this.data.getVelocityAtPoint(t,e)},applyDamping:function(t){this.data.applyDamping(t)},applyImpulse:function(t,e,i){this.data.applyImpulse(t,[this.world.pxmi(e),this.world.pxmi(i)])},applyImpulseLocal:function(t,e,i){this.data.applyImpulseLocal(t,[this.world.pxmi(e),this.world.pxmi(i)])},applyForce:function(t,e,i){this.data.applyForce(t,[this.world.pxmi(e),this.world.pxmi(i)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0,this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0,this.data.angularDamping=0},toLocalFrame:function(t,e){return this.data.toLocalFrame(t,e)},toWorldFrame:function(t,e){return this.data.toWorldFrame(t,e)},rotateLeft:function(t){this.data.angularVelocity=this.world.pxm(-t)},rotateRight:function(t){this.data.angularVelocity=this.world.pxm(t)},moveForward:function(t){var e=this.world.pxmi(-t),t=this.data.angle+Math.PI/2;this.data.velocity[0]=e*Math.cos(t),this.data.velocity[1]=e*Math.sin(t)},moveBackward:function(t){var e=this.world.pxmi(-t),t=this.data.angle+Math.PI/2;this.data.velocity[0]=-(e*Math.cos(t)),this.data.velocity[1]=-(e*Math.sin(t))},thrust:function(t){var e=this.world.pxmi(-t),t=this.data.angle+Math.PI/2;this.data.force[0]+=e*Math.cos(t),this.data.force[1]+=e*Math.sin(t)},thrustLeft:function(t){var e=this.world.pxmi(-t),t=this.data.angle;this.data.force[0]+=e*Math.cos(t),this.data.force[1]+=e*Math.sin(t)},thrustRight:function(t){var e=this.world.pxmi(-t),t=this.data.angle;this.data.force[0]-=e*Math.cos(t),this.data.force[1]-=e*Math.sin(t)},reverse:function(t){var e=this.world.pxmi(-t),t=this.data.angle+Math.PI/2;this.data.force[0]-=e*Math.cos(t),this.data.force[1]-=e*Math.sin(t)},moveLeft:function(t){this.data.velocity[0]=this.world.pxmi(-t)},moveRight:function(t){this.data.velocity[0]=this.world.pxmi(t)},moveUp:function(t){this.data.velocity[1]=this.world.pxmi(-t)},moveDown:function(t){this.data.velocity[1]=this.world.pxmi(t)},preUpdate:function(){this.dirty=!0,this.removeNextStep&&(this.removeFromWorld(),this.removeNextStep=!1)},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0])+this.offset.x,this.sprite.y=this.world.mpxi(this.data.position[1])+this.offset.y,this.fixedRotation||(this.sprite.rotation=this.data.angle),this.debugBody&&this.debugBody.updateSpriteTransform(),this.dirty=!1},reset:function(t,e,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),this.setZeroForce(),this.setZeroVelocity(),this.setZeroRotation(),i&&this.setZeroDamping(),n&&(this.mass=1),this.x=t,this.y=e},addToWorld:function(){if(this.game.physics.p2._toRemove)for(var t=0;t<this.game.physics.p2._toRemove.length;t++)this.game.physics.p2._toRemove[t]===this&&this.game.physics.p2._toRemove.splice(t,1);this.data.world!==this.game.physics.p2.world&&this.game.physics.p2.addBody(this)},removeFromWorld:function(){this.data.world===this.game.physics.p2.world&&this.game.physics.p2.removeBodyNextStep(this)},destroy:function(){this.removeFromWorld(),this.clearShapes(),this._bodyCallbacks={},this._bodyCallbackContext={},this._groupCallbacks={},this._groupCallbackContext={},this.debugBody&&this.debugBody.destroy(!0,!0),this.debugBody=null,this.sprite&&(this.sprite.body=null,this.sprite=null)},clearShapes:function(){for(var t=this.data.shapes.length;t--;)this.data.removeShape(this.data.shapes[t]);this.shapeChanged()},addShape:function(t,e,i,n){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.data.addShape(t,[this.world.pxmi(e),this.world.pxmi(i)],n),this.shapeChanged(),t},addCircle:function(t,e,i,n){t=new p2.Circle({radius:this.world.pxm(t)});return this.addShape(t,e,i,n)},addRectangle:function(t,e,i,n,r){e=new p2.Box({width:this.world.pxm(t),height:this.world.pxm(e)});return this.addShape(e,i,n,r)},addPlane:function(t,e,i){var n=new p2.Plane;return this.addShape(n,t,e,i)},addParticle:function(t,e,i){var n=new p2.Particle;return this.addShape(n,t,e,i)},addLine:function(t,e,i,n){t=new p2.Line({length:this.world.pxm(t)});return this.addShape(t,e,i,n)},addCapsule:function(t,e,i,n,r){e=new p2.Capsule({length:this.world.pxm(t),radius:this.world.pxm(e)});return this.addShape(e,i,n,r)},addPolygon:function(t,e){t=t||{},Array.isArray(e)||(e=Array.prototype.slice.call(arguments,1));var i=[];if(1===e.length&&Array.isArray(e[0]))i=e[0].slice(0);else if(Array.isArray(e[0]))i=e.slice();else if("number"==typeof e[0])for(var n=0,r=e.length;n<r;n+=2)i.push([e[n],e[n+1]]);var s=i.length-1;i[s][0]===i[0][0]&&i[s][1]===i[0][1]&&i.pop();for(var o=0;o<i.length;o++)i[o][0]=this.world.pxmi(i[o][0]),i[o][1]=this.world.pxmi(i[o][1]);s=this.data.fromPolygon(i,t);return this.shapeChanged(),s},removeShape:function(t){t=this.data.removeShape(t);return this.shapeChanged(),t},setCircle:function(t,e,i,n){return this.clearShapes(),this.addCircle(t,e,i,n)},setRectangle:function(t,e,i,n,r){return void 0===t&&(t=16),void 0===e&&(e=16),this.clearShapes(),this.addRectangle(t,e,i,n,r)},setRectangleFromSprite:function(t){return void 0===t&&(t=this.sprite),this.clearShapes(),this.addRectangle(t.width,t.height,0,0,t.rotation)},setMaterial:function(t,e){if(void 0===e)for(var i=this.data.shapes.length-1;0<=i;i--)this.data.shapes[i].material=t;else e.material=t},shapeChanged:function(){this.debugBody&&this.debugBody.draw()},addPhaserPolygon:function(t,e){for(var i=this.game.cache.getPhysicsData(t,e),n=[],r=0;r<i.length;r++){var s=i[r],o=this.addFixture(s);n[s.filter.group]=n[s.filter.group]||[],n[s.filter.group]=n[s.filter.group].concat(o),s.fixtureKey&&(n[s.fixtureKey]=o)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),n},addFixture:function(t){var e=[];if(t.circle){(p=new p2.Circle({radius:this.world.pxm(t.circle.radius)})).collisionGroup=t.filter.categoryBits,p.collisionMask=t.filter.maskBits,p.sensor=t.isSensor;var i=p2.vec2.create();i[0]=this.world.pxmi(t.circle.position[0]-this.sprite.width/2),i[1]=this.world.pxmi(t.circle.position[1]-this.sprite.height/2),this.data.addShape(p,i),e.push(p)}else for(var n=t.polygons,r=p2.vec2.create(),s=0;s<n.length;s++){for(var o=n[s],a=[],l=0;l<o.length;l+=2)a.push([this.world.pxmi(o[l]),this.world.pxmi(o[l+1])]);for(var p=new p2.Convex({vertices:a}),h=0;h!==p.vertices.length;h++){var u=p.vertices[h];p2.vec2.sub(u,u,p.centerOfMass)}p2.vec2.scale(r,p.centerOfMass,1),r[0]-=this.world.pxmi(this.sprite.width/2),r[1]-=this.world.pxmi(this.sprite.height/2),p.updateTriangles(),p.updateCenterOfMass(),p.updateBoundingRadius(),p.collisionGroup=t.filter.categoryBits,p.collisionMask=t.filter.maskBits,p.sensor=t.isSensor,this.data.addShape(p,r),e.push(p)}return e},loadPolygon:function(t,e){var i;i=null===t?e:this.game.cache.getPhysicsData(t,e);for(var n=p2.vec2.create(),r=0;r<i.length;r++){for(var s=[],o=0;o<i[r].shape.length;o+=2)s.push([this.world.pxmi(i[r].shape[o]),this.world.pxmi(i[r].shape[o+1])]);for(var a=new p2.Convex({vertices:s}),l=0;l!==a.vertices.length;l++){var p=a.vertices[l];p2.vec2.sub(p,p,a.centerOfMass)}p2.vec2.scale(n,a.centerOfMass,1),n[0]-=this.world.pxmi(this.sprite.width/2),n[1]-=this.world.pxmi(this.sprite.height/2),a.updateTriangles(),a.updateCenterOfMass(),a.updateBoundingRadius(),this.data.addShape(a,n)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),!0}},U.Physics.P2.Body.prototype.constructor=U.Physics.P2.Body,U.Physics.P2.Body.DYNAMIC=1,U.Physics.P2.Body.STATIC=2,U.Physics.P2.Body.KINEMATIC=4,Object.defineProperty(U.Physics.P2.Body.prototype,"static",{get:function(){return this.data.type===U.Physics.P2.Body.STATIC},set:function(t){t&&this.data.type!==U.Physics.P2.Body.STATIC?(this.data.type=U.Physics.P2.Body.STATIC,this.mass=0):t||this.data.type!==U.Physics.P2.Body.STATIC||(this.data.type=U.Physics.P2.Body.DYNAMIC,this.mass=1)}}),Object.defineProperty(U.Physics.P2.Body.prototype,"dynamic",{get:function(){return this.data.type===U.Physics.P2.Body.DYNAMIC},set:function(t){t&&this.data.type!==U.Physics.P2.Body.DYNAMIC?(this.data.type=U.Physics.P2.Body.DYNAMIC,this.mass=1):t||this.data.type!==U.Physics.P2.Body.DYNAMIC||(this.data.type=U.Physics.P2.Body.STATIC,this.mass=0)}}),Object.defineProperty(U.Physics.P2.Body.prototype,"kinematic",{get:function(){return this.data.type===U.Physics.P2.Body.KINEMATIC},set:function(t){t&&this.data.type!==U.Physics.P2.Body.KINEMATIC?(this.data.type=U.Physics.P2.Body.KINEMATIC,this.mass=4):t||this.data.type!==U.Physics.P2.Body.KINEMATIC||(this.data.type=U.Physics.P2.Body.STATIC,this.mass=0)}}),Object.defineProperty(U.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(t){t!==this.data.allowSleep&&(this.data.allowSleep=t)}}),Object.defineProperty(U.Physics.P2.Body.prototype,"angle",{get:function(){return U.Math.wrapAngle(U.Math.radToDeg(this.data.angle))},set:function(t){this.data.angle=U.Math.degToRad(U.Math.wrapAngle(t))}}),Object.defineProperty(U.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(t){this.data.angularDamping=t}}),Object.defineProperty(U.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(t){this.data.angularForce=t}}),Object.defineProperty(U.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(t){this.data.angularVelocity=t}}),Object.defineProperty(U.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(t){this.data.damping=t}}),Object.defineProperty(U.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(t){t!==this.data.fixedRotation&&(this.data.fixedRotation=t)}}),Object.defineProperty(U.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(t){this.data.inertia=t}}),Object.defineProperty(U.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(t){t!==this.data.mass&&(this.data.mass=t,this.data.updateMassProperties())}}),Object.defineProperty(U.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.type},set:function(t){t!==this.data.type&&(this.data.type=t)}}),Object.defineProperty(U.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(t){this.data.angle=t}}),Object.defineProperty(U.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(t){this.data.sleepSpeedLimit=t}}),Object.defineProperty(U.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(t){this.data.position[0]=this.world.pxmi(t)}}),Object.defineProperty(U.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(t){this.data.position[1]=this.world.pxmi(t)}}),Object.defineProperty(U.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}}),Object.defineProperty(U.Physics.P2.Body.prototype,"debug",{get:function(){return null!==this.debugBody},set:function(t){t&&!this.debugBody?this.debugBody=new U.Physics.P2.BodyDebug(this.game,this.data):!t&&this.debugBody&&(this.debugBody.destroy(),this.debugBody=null)}}),Object.defineProperty(U.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(t){t&&!this._collideWorldBounds?(this._collideWorldBounds=!0,this.updateCollisionMask()):!t&&this._collideWorldBounds&&(this._collideWorldBounds=!1,this.updateCollisionMask())}}),U.Physics.P2.BodyDebug=function(t,e,i){U.Group.call(this,t);var n={pixelsPerLengthUnit:t.physics.p2.mpx(1),debugPolygons:!1,lineWidth:1,alpha:.5};this.settings=U.Utils.extend(n,i),this.ppu=this.settings.pixelsPerLengthUnit,this.ppu=-1*this.ppu,this.body=e,this.canvas=new U.Graphics(t),this.canvas.alpha=this.settings.alpha,this.add(this.canvas),this.draw(),this.updateSpriteTransform()},U.Physics.P2.BodyDebug.prototype=Object.create(U.Group.prototype),U.Physics.P2.BodyDebug.prototype.constructor=U.Physics.P2.BodyDebug,U.Utils.extend(U.Physics.P2.BodyDebug.prototype,{updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu,this.position.y=this.body.position[1]*this.ppu,this.rotation=this.body.angle},draw:function(){var t,e,i,n,r,s,o,a,l,p,h,u,c=this.body,d=this.canvas;if(d.clear(),i=parseInt(this.randomPastelHex(),16),r=16711680,s=this.lineWidth,c instanceof p2.Body&&c.shapes.length)for(var _=c.shapes.length,y=0;y!==_;){if(o=(e=c.shapes[y]).position||0,t=e.angle||0,e instanceof p2.Circle)this.drawCircle(d,o[0]*this.ppu,o[1]*this.ppu,t,e.radius*this.ppu,i,s);else if(e instanceof p2.Capsule)this.drawCapsule(d,o[0]*this.ppu,o[1]*this.ppu,t,e.length*this.ppu,e.radius*this.ppu,r,i,s);else if(e instanceof p2.Plane)this.drawPlane(d,o[0]*this.ppu,-o[1]*this.ppu,i,r,5*s,10*s,10*s,100*this.ppu,t);else if(e instanceof p2.Line)this.drawLine(d,e.length*this.ppu,r,s);else if(e instanceof p2.Box)this.drawRectangle(d,o[0]*this.ppu,o[1]*this.ppu,t,e.width*this.ppu,e.height*this.ppu,r,i,s);else if(e instanceof p2.Convex){for(l=[],p=p2.vec2.create(),n=h=0,u=e.vertices.length;0<=u?h<u:u<h;n=0<=u?++h:--h)a=e.vertices[n],p2.vec2.rotate(p,a,t),l.push([(p[0]+o[0])*this.ppu,-(p[1]+o[1])*this.ppu]);this.drawConvex(d,l,e.triangles,r,i,s,this.settings.debugPolygons,[o[0]*this.ppu,-o[1]*this.ppu])}y++}},drawRectangle:function(t,e,i,n,r,s,o,a,l){void 0===l&&(l=1),void 0===o&&(o=0),t.lineStyle(l,o,1),t.beginFill(a),t.drawRect(e-r/2,i-s/2,r,s)},drawCircle:function(t,e,i,n,r,s,o){void 0===o&&(o=1),void 0===s&&(s=16777215),t.lineStyle(o,0,1),t.beginFill(s,1),t.drawCircle(e,i,2*-r),t.endFill(),t.moveTo(e,i),t.lineTo(e+r*Math.cos(-n),i+r*Math.sin(-n))},drawLine:function(t,e,i,n){void 0===n&&(n=1),void 0===i&&(i=0),t.lineStyle(5*n,i,1),t.moveTo(-e/2,0),t.lineTo(e/2,0)},drawConvex:function(t,e,i,n,r,s,o,a){var l,p,h,u,c,d,_,y;if(void 0===s&&(s=1),void 0===n&&(n=0),o){for(l=[16711680,65280,255],p=0;p!==e.length+1;)c=e[p%e.length],y=e[(p+1)%e.length],u=c[0],_=c[1],c=y[0],y=y[1],t.lineStyle(s,l[p%l.length],1),t.moveTo(u,-_),t.lineTo(c,-y),t.drawCircle(u,-_,2*s),p++;return t.lineStyle(s,0,1),t.drawCircle(a[0],a[1],2*s)}for(t.lineStyle(s,n,1),t.beginFill(r),p=0;p!==e.length;)h=(d=e[p])[0],d=d[1],0===p?t.moveTo(h,-d):t.lineTo(h,-d),p++;if(t.endFill(),2<e.length)return t.moveTo(e[e.length-1][0],-e[e.length-1][1]),t.lineTo(e[0][0],-e[0][1])},drawPath:function(t,e,i,n,r){var s,o,a,l,p,h;for(void 0===r&&(r=1),void 0===i&&(i=0),t.lineStyle(r,i,1),"number"==typeof n&&t.beginFill(n),a=o=null,s=0;s<e.length;)p=(l=e[s])[0],h=l[1],p===o&&h===a||(0===s?t.moveTo(p,h):(l=e[(s+1)%e.length][0],0!=(p-o)*(e[(s+1)%e.length][1]-a)-(l-o)*(h-a)&&t.lineTo(p,h)),o=p,a=h),s++;"number"==typeof n&&t.endFill(),2<e.length&&"number"==typeof n&&(t.moveTo(e[e.length-1][0],e[e.length-1][1]),t.lineTo(e[0][0],e[0][1]))},drawPlane:function(t,e,i,n,r,s,o,a,l,p){void 0===s&&(s=1),void 0===n&&(n=16777215),t.lineStyle(s,r,11),t.beginFill(n),t.moveTo(e,-i),n=e+Math.cos(p)*this.game.width,l=i+Math.sin(p)*this.game.height,t.lineTo(n,-l),t.moveTo(e,-i),n=e+Math.cos(p)*-this.game.width,l=i+Math.sin(p)*-this.game.height,t.lineTo(n,-l)},drawCapsule:function(t,e,i,n,r,s,o,a,l){void 0===l&&(l=1),void 0===o&&(o=0),t.lineStyle(l,o,1);var p=Math.cos(n),n=Math.sin(n);t.beginFill(a,1),t.drawCircle(-r/2*p+e,-r/2*n+i,2*-s),t.drawCircle(r/2*p+e,r/2*n+i,2*-s),t.endFill(),t.lineStyle(l,o,0),t.beginFill(a,1),t.moveTo(-r/2*p+s*n+e,-r/2*n+s*p+i),t.lineTo(r/2*p+s*n+e,r/2*n+s*p+i),t.lineTo(r/2*p-s*n+e,r/2*n-s*p+i),t.lineTo(-r/2*p-s*n+e,-r/2*n-s*p+i),t.endFill(),t.lineStyle(l,o,1),t.moveTo(-r/2*p+s*n+e,-r/2*n+s*p+i),t.lineTo(r/2*p+s*n+e,r/2*n+s*p+i),t.moveTo(-r/2*p-s*n+e,-r/2*n-s*p+i),t.lineTo(r/2*p-s*n+e,r/2*n-s*p+i)},randomPastelHex:function(){var t=[255,255,255],e=Math.floor(256*Math.random()),i=Math.floor(256*Math.random()),n=Math.floor(256*Math.random());return e=Math.floor((e+3*t[0])/4),i=Math.floor((i+3*t[1])/4),n=Math.floor((n+3*t[2])/4),this.rgbToHex(e,i,n)},rgbToHex:function(t,e,i){return this.componentToHex(t)+this.componentToHex(e)+this.componentToHex(i)},componentToHex:function(t){t=t.toString(16);return 2===t.length?t:t+"0"}}),U.Physics.P2.Spring=function(t,e,i,n,r,s,o,a,l,p){this.game=t.game,void 0===n&&(n=1),void 0===r&&(r=100),void 0===s&&(s=1);s={restLength:n=(this.world=t).pxm(n),stiffness:r,damping:s};null!=o&&(s.worldAnchorA=[t.pxm(o[0]),t.pxm(o[1])]),null!=a&&(s.worldAnchorB=[t.pxm(a[0]),t.pxm(a[1])]),null!=l&&(s.localAnchorA=[t.pxm(l[0]),t.pxm(l[1])]),null!=p&&(s.localAnchorB=[t.pxm(p[0]),t.pxm(p[1])]),this.data=new p2.LinearSpring(e,i,s),this.data.parent=this},U.Physics.P2.Spring.prototype.constructor=U.Physics.P2.Spring,U.Physics.P2.RotationalSpring=function(t,e,i,n,r,s){this.game=t.game,this.world=t,void 0===n&&(n=null),void 0===r&&(r=100),void 0===s&&(s=1);s={restAngle:n=n&&t.pxm(n),stiffness:r,damping:s};this.data=new p2.RotationalSpring(e,i,s),this.data.parent=this},U.Physics.P2.Spring.prototype.constructor=U.Physics.P2.Spring,U.Physics.P2.Material=function(t){this.name=t,p2.Material.call(this)},U.Physics.P2.Material.prototype=Object.create(p2.Material.prototype),U.Physics.P2.Material.prototype.constructor=U.Physics.P2.Material,U.Physics.P2.ContactMaterial=function(t,e,i){p2.ContactMaterial.call(this,t,e,i)},U.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype),U.Physics.P2.ContactMaterial.prototype.constructor=U.Physics.P2.ContactMaterial,U.Physics.P2.CollisionGroup=function(t){this.mask=t},U.Physics.P2.DistanceConstraint=function(t,e,i,n,r,s,o){void 0===n&&(n=100),void 0===r&&(r=[0,0]),void 0===s&&(s=[0,0]),void 0===o&&(o=Number.MAX_VALUE),this.game=t.game;o={distance:n=(this.world=t).pxm(n),localAnchorA:r=[t.pxmi(r[0]),t.pxmi(r[1])],localAnchorB:s=[t.pxmi(s[0]),t.pxmi(s[1])],maxForce:o};p2.DistanceConstraint.call(this,e,i,o)},U.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype),U.Physics.P2.DistanceConstraint.prototype.constructor=U.Physics.P2.DistanceConstraint,U.Physics.P2.GearConstraint=function(t,e,i,n,r){void 0===n&&(n=0),void 0===r&&(r=1),this.game=t.game,this.world=t;r={angle:n,ratio:r};p2.GearConstraint.call(this,e,i,r)},U.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype),U.Physics.P2.GearConstraint.prototype.constructor=U.Physics.P2.GearConstraint,U.Physics.P2.LockConstraint=function(t,e,i,n,r,s){void 0===n&&(n=[0,0]),void 0===r&&(r=0),void 0===s&&(s=Number.MAX_VALUE),this.game=t.game;s={localOffsetB:n=[(this.world=t).pxm(n[0]),t.pxm(n[1])],localAngleB:r,maxForce:s};p2.LockConstraint.call(this,e,i,s)},U.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype),U.Physics.P2.LockConstraint.prototype.constructor=U.Physics.P2.LockConstraint,U.Physics.P2.PrismaticConstraint=function(t,e,i,n,r,s,o,a){void 0===n&&(n=!0),void 0===r&&(r=[0,0]),void 0===s&&(s=[0,0]),void 0===o&&(o=[0,0]),void 0===a&&(a=Number.MAX_VALUE),this.game=t.game;n={localAnchorA:r=[(this.world=t).pxmi(r[0]),t.pxmi(r[1])],localAnchorB:s=[t.pxmi(s[0]),t.pxmi(s[1])],localAxisA:o,maxForce:a,disableRotationalLock:!n};p2.PrismaticConstraint.call(this,e,i,n)},U.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype),U.Physics.P2.PrismaticConstraint.prototype.constructor=U.Physics.P2.PrismaticConstraint,U.Physics.P2.RevoluteConstraint=function(t,e,i,n,r,s,o){void 0===s&&(s=Number.MAX_VALUE),void 0===o&&(o=null),this.game=t.game,i=[(this.world=t).pxmi(i[0]),t.pxmi(i[1])],r=[t.pxmi(r[0]),t.pxmi(r[1])];s={worldPivot:o=o&&[t.pxmi(o[0]),t.pxmi(o[1])],localPivotA:i,localPivotB:r,maxForce:s};p2.RevoluteConstraint.call(this,e,n,s)},U.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype),U.Physics.P2.RevoluteConstraint.prototype.constructor=U.Physics.P2.RevoluteConstraint,U.ImageCollection=function(t,e,i,n,r,s,o){(void 0===i||i<=0)&&(i=32),(void 0===n||n<=0)&&(n=32),void 0===r&&(r=0),void 0===s&&(s=0),this.name=t,this.firstgid=0|e,this.imageWidth=0|i,this.imageHeight=0|n,this.imageMargin=0|r,this.imageSpacing=0|s,this.properties=o||{},this.images=[],this.total=0},U.ImageCollection.prototype={containsImageIndex:function(t){return t>=this.firstgid&&t<this.firstgid+this.total},addImage:function(t,e){this.images.push({gid:t,image:e}),this.total++}},U.ImageCollection.prototype.constructor=U.ImageCollection,U.Tile=function(t,e,i,n,r,s){this.layer=t,this.index=e,this.x=i,this.y=n,this.rotation=0,this.flipped=!1,this.worldX=i*r,this.worldY=n*s,this.width=r,this.height=s,this.centerX=Math.abs(r/2),this.centerY=Math.abs(s/2),this.alpha=1,this.properties={},this.scanned=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1,this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.collisionCallback=null,this.collisionCallbackContext=this},U.Tile.prototype={containsPoint:function(t,e){return!(t<this.worldX||e<this.worldY||t>this.right||e>this.bottom)},intersects:function(t,e,i,n){return!(i<=this.worldX||n<=this.worldY||t>=this.worldX+this.width||e>=this.worldY+this.height)},setCollisionCallback:function(t,e){this.collisionCallback=t,this.collisionCallbackContext=e},destroy:function(){this.collisionCallback=null,this.collisionCallbackContext=null,this.properties=null},setCollision:function(t,e,i,n){this.collideLeft=t,this.collideRight=e,this.collideUp=i,this.collideDown=n,this.faceLeft=t,this.faceRight=e,this.faceTop=i,this.faceBottom=n},resetCollision:function(){this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1},isInteresting:function(t,e){return t&&e?this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback:t?this.collideLeft||this.collideRight||this.collideUp||this.collideDown:!!e&&(this.faceTop||this.faceBottom||this.faceLeft||this.faceRight)},copy:function(t){this.index=t.index,this.alpha=t.alpha,this.properties=t.properties,this.collideUp=t.collideUp,this.collideDown=t.collideDown,this.collideLeft=t.collideLeft,this.collideRight=t.collideRight,this.collisionCallback=t.collisionCallback,this.collisionCallbackContext=t.collisionCallbackContext}},U.Tile.prototype.constructor=U.Tile,Object.defineProperty(U.Tile.prototype,"collides",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}}),Object.defineProperty(U.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback}}),Object.defineProperty(U.Tile.prototype,"left",{get:function(){return this.worldX}}),Object.defineProperty(U.Tile.prototype,"right",{get:function(){return this.worldX+this.width}}),Object.defineProperty(U.Tile.prototype,"top",{get:function(){return this.worldY}}),Object.defineProperty(U.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}}),U.Tilemap=function(t,e,i,n,r,s){this.game=t,this.key=e;s=U.TilemapParser.parse(this.game,e,i,n,r,s);null!==s&&(this.width=s.width,this.height=s.height,this.tileWidth=s.tileWidth,this.tileHeight=s.tileHeight,this.orientation=s.orientation,this.format=s.format,this.version=s.version,this.properties=s.properties,this.widthInPixels=s.widthInPixels,this.heightInPixels=s.heightInPixels,this.layers=s.layers,this.tilesets=s.tilesets,this.imagecollections=s.imagecollections,this.tiles=s.tiles,this.objects=s.objects,this.collideIndexes=[],this.collision=s.collision,this.images=s.images,this.enableDebug=!1,this.currentLayer=0,this.debugMap=[],this._results=[],this._tempA=0,this._tempB=0)},U.Tilemap.CSV=0,U.Tilemap.TILED_JSON=1,U.Tilemap.NORTH=0,U.Tilemap.EAST=1,U.Tilemap.SOUTH=2,U.Tilemap.WEST=3,U.Tilemap.prototype={create:function(t,e,i,n,r,s){return void 0===s&&(s=this.game.world),this.width=e,this.height=i,this.setTileSize(n,r),this.layers.length=0,this.createBlankLayer(t,e,i,n,r,s)},setTileSize:function(t,e){this.tileWidth=t,this.tileHeight=e,this.widthInPixels=this.width*t,this.heightInPixels=this.height*e},addTilesetImage:function(t,e,i,n,r,s,o){if(void 0===t)return null;void 0===i&&(i=this.tileWidth),void 0===n&&(n=this.tileHeight),void 0===r&&(r=0),void 0===s&&(s=0),void 0===o&&(o=0),0===i&&(i=32),0===n&&(n=32);var a=null;if(null!=e||(e=t),e instanceof U.BitmapData)a=e.canvas;else{if(!this.game.cache.checkImageKey(e))return console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+e+'"'),null;a=this.game.cache.getImage(e)}e=this.getTilesetIndex(t);if(null===e&&this.format===U.Tilemap.TILED_JSON)return console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+t+'"'),null;if(this.tilesets[e])return this.tilesets[e].setImage(a),this.tilesets[e];var l=new U.Tileset(t,o,i,n,r,s,{});l.setImage(a),this.tilesets.push(l);for(var p=this.tilesets.length-1,h=r,u=r,c=0,d=0,_=0,y=o;y<o+l.total&&(this.tiles[y]=[h,u,p],h+=i+s,++c!==l.total)&&(++d!==l.columns||(h=r,u+=n+s,d=0,++_!==l.rows));y++);return l},createFromObjects:function(t,e,i,n,r,s,o,a,l){if(void 0===r&&(r=!0),void 0===s&&(s=!1),void 0===o&&(o=this.game.world),void 0===a&&(a=U.Sprite),void 0===l&&(l=!0),this.objects[t])for(var p=0;p<this.objects[t].length;p++){var h=!1,u=this.objects[t][p];if((void 0!==u.gid&&"number"==typeof e&&u.gid===e||void 0!==u.id&&"number"==typeof e&&u.id===e||void 0!==u.name&&"string"==typeof e&&u.name===e)&&(h=!0),h){var c,d=new a(this.game,parseFloat(u.x,10),parseFloat(u.y,10),i,n);for(c in d.name=u.name,d.visible=u.visible,d.autoCull=s,d.exists=r,u.width&&(d.width=u.width),u.height&&(d.height=u.height),u.rotation&&(d.angle=u.rotation),l&&(d.y-=d.height),o.add(d),u.properties)o.set(d,c,u.properties[c],!1,!1,0,!0)}}else console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+t)},createFromTiles:function(t,e,i,n,r,s){"number"==typeof t&&(t=[t]),null==e?e=[]:"number"==typeof e&&(e=[e]),n=this.getLayer(n),void 0===r&&(r=this.game.world),void 0===s&&(s={}),void 0===s.customClass&&(s.customClass=U.Sprite),void 0===s.adjustY&&(s.adjustY=!0);var o=this.layers[n].width,a=this.layers[n].height;if(this.copy(0,0,o,a,n),this._results.length<2)return 0;for(var l,p=0,h=1,u=this._results.length;h<u;h++)if(-1!==t.indexOf(this._results[h].index)){for(var c in l=new s.customClass(this.game,this._results[h].worldX,this._results[h].worldY,i),s)l[c]=s[c];r.add(l),p++}if(1===e.length)for(h=0;h<t.length;h++)this.replace(t[h],e[0],0,0,o,a,n);else if(1<e.length)for(h=0;h<t.length;h++)this.replace(t[h],e[h],0,0,o,a,n);return p},createLayer:function(t,e,i,n){void 0===e&&(e=this.game.width),void 0===i&&(i=this.game.height),void 0===n&&(n=this.game.world);var r=t;if("string"==typeof t&&(r=this.getLayerIndex(t)),!(null===r||r>this.layers.length)){void 0===e||e<=0?e=Math.min(this.game.width,this.layers[r].widthInPixels):e>this.game.width&&(e=this.game.width),void 0===i||i<=0?i=Math.min(this.game.height,this.layers[r].heightInPixels):i>this.game.height&&(i=this.game.height),this.enableDebug&&(console.group("Tilemap.createLayer"),console.log("Name:",this.layers[r].name),console.log("Size:",e,"x",i),console.log("Tileset:",this.tilesets[0].name,"index:",r));i=n.add(new U.TilemapLayer(this.game,this,r,e,i));return this.enableDebug&&console.groupEnd(),i}console.warn("Tilemap.createLayer: Invalid layer ID given: "+r)},createBlankLayer:function(t,e,i,n,r,s){if(void 0===s&&(s=this.game.world),null===this.getLayerIndex(t)){for(var o,a={name:t,x:0,y:0,width:e,height:i,widthInPixels:e*n,heightInPixels:i*r,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:null},l=[],p=0;p<i;p++){o=[];for(var h=0;h<e;h++)o.push(new U.Tile(a,-1,h,p,n,r));l.push(o)}a.data=l,this.layers.push(a),this.currentLayer=this.layers.length-1;var u=a.widthInPixels,c=a.heightInPixels;return u>this.game.width&&(u=this.game.width),c>this.game.height&&(c=this.game.height),(l=new U.TilemapLayer(this.game,this,this.layers.length-1,u,c)).name=t,s.add(l)}console.warn("Tilemap.createBlankLayer: Layer with matching name already exists: "+t)},getIndex:function(t,e){for(var i=0;i<t.length;i++)if(t[i].name===e)return i;return null},getLayerIndex:function(t){return this.getIndex(this.layers,t)},getTilesetIndex:function(t){return this.getIndex(this.tilesets,t)},getImageIndex:function(t){return this.getIndex(this.images,t)},setTileIndexCallback:function(t,e,i,n){if(n=this.getLayer(n),"number"==typeof t)this.layers[n].callbacks[t]={callback:e,callbackContext:i};else for(var r=0,s=t.length;r<s;r++)this.layers[n].callbacks[t[r]]={callback:e,callbackContext:i}},setTileLocationCallback:function(t,e,i,n,r,s,o){if(o=this.getLayer(o),this.copy(t,e,i,n,o),!(this._results.length<2))for(var a=1;a<this._results.length;a++)this._results[a].setCollisionCallback(r,s)},setCollision:function(t,e,i,n){if(void 0===e&&(e=!0),void 0===n&&(n=!0),i=this.getLayer(i),"number"==typeof t)return this.setCollisionByIndex(t,e,i,!0);if(Array.isArray(t)){for(var r=0;r<t.length;r++)this.setCollisionByIndex(t[r],e,i,!1);n&&this.calculateFaces(i)}},setCollisionBetween:function(t,e,i,n,r){if(void 0===i&&(i=!0),void 0===r&&(r=!0),n=this.getLayer(n),!(e<t)){for(var s=t;s<=e;s++)this.setCollisionByIndex(s,i,n,!1);r&&this.calculateFaces(n)}},setCollisionByExclusion:function(t,e,i,n){void 0===e&&(e=!0),void 0===n&&(n=!0),i=this.getLayer(i);for(var r=0,s=this.tiles.length;r<s;r++)-1===t.indexOf(r)&&this.setCollisionByIndex(r,e,i,!1);n&&this.calculateFaces(i)},setCollisionByIndex:function(t,e,i,n){var r;void 0===e&&(e=!0),void 0===i&&(i=this.currentLayer),void 0===n&&(n=!0),e?this.collideIndexes.push(t):-1<(r=this.collideIndexes.indexOf(t))&&this.collideIndexes.splice(r,1);for(var s=0;s<this.layers[i].height;s++)for(var o=0;o<this.layers[i].width;o++){var a=this.layers[i].data[s][o];a&&a.index===t&&(e?a.setCollision(!0,!0,!0,!0):a.resetCollision(),a.faceTop=e,a.faceBottom=e,a.faceLeft=e,a.faceRight=e)}return n&&this.calculateFaces(i),i},getLayer:function(t){return void 0===t?t=this.currentLayer:"string"==typeof t?t=this.getLayerIndex(t):t instanceof U.TilemapLayer&&(t=t.index),t},setPreventRecalculate:function(t){if(!0===t&&!0!==this.preventingRecalculate&&(this.preventingRecalculate=!0,this.needToRecalculate={}),!1===t&&!0===this.preventingRecalculate){for(var e in this.preventingRecalculate=!1,this.needToRecalculate)this.calculateFaces(e);this.needToRecalculate=!1}},calculateFaces:function(t){if(this.preventingRecalculate)this.needToRecalculate[t]=!0;else for(var e,i,n,r,s=0,o=this.layers[t].height;s<o;s++)for(var a=0,l=this.layers[t].width;a<l;a++){var p=this.layers[t].data[s][a];p&&(e=this.getTileAbove(t,a,s),i=this.getTileBelow(t,a,s),n=this.getTileLeft(t,a,s),r=this.getTileRight(t,a,s),p.collides&&(p.faceTop=!0,p.faceBottom=!0,p.faceLeft=!0,p.faceRight=!0),e&&e.collides&&(p.faceTop=!1),i&&i.collides&&(p.faceBottom=!1),n&&n.collides&&(p.faceLeft=!1),r&&r.collides&&(p.faceRight=!1))}},getTileAbove:function(t,e,i){return 0<i?this.layers[t].data[i-1][e]:null},getTileBelow:function(t,e,i){return i<this.layers[t].height-1?this.layers[t].data[i+1][e]:null},getTileLeft:function(t,e,i){return 0<e?this.layers[t].data[i][e-1]:null},getTileRight:function(t,e,i){return e<this.layers[t].width-1?this.layers[t].data[i][e+1]:null},setLayer:function(t){t=this.getLayer(t),this.layers[t]&&(this.currentLayer=t)},hasTile:function(t,e,i){return i=this.getLayer(i),void 0!==this.layers[i].data[e]&&void 0!==this.layers[i].data[e][t]&&-1<this.layers[i].data[e][t].index},removeTile:function(t,e,i){if(i=this.getLayer(i),0<=t&&t<this.layers[i].width&&0<=e&&e<this.layers[i].height&&this.hasTile(t,e,i)){var n=this.layers[i].data[e][t];return this.layers[i].data[e][t]=new U.Tile(this.layers[i],-1,t,e,this.tileWidth,this.tileHeight),this.layers[i].dirty=!0,this.calculateFaces(i),n}},removeTileWorldXY:function(t,e,i,n,r){return r=this.getLayer(r),t=this.game.math.snapToFloor(t,i)/i,e=this.game.math.snapToFloor(e,n)/n,this.removeTile(t,e,r)},putTile:function(t,e,i,n){return null===t?this.removeTile(e,i,n):(n=this.getLayer(n),0<=e&&e<this.layers[n].width&&0<=i&&i<this.layers[n].height?(t instanceof U.Tile?(r=t.index,this.hasTile(e,i,n)?this.layers[n].data[i][e].copy(t):this.layers[n].data[i][e]=new U.Tile(n,r,e,i,t.width,t.height)):(r=t,this.hasTile(e,i,n)?this.layers[n].data[i][e].index=r:this.layers[n].data[i][e]=new U.Tile(this.layers[n],r,e,i,this.tileWidth,this.tileHeight)),-1<this.collideIndexes.indexOf(r)?this.layers[n].data[i][e].setCollision(!0,!0,!0,!0):this.layers[n].data[i][e].resetCollision(),this.layers[n].dirty=!0,this.calculateFaces(n),this.layers[n].data[i][e]):null);var r},putTileWorldXY:function(t,e,i,n,r,s){return s=this.getLayer(s),e=this.game.math.snapToFloor(e,n)/n,i=this.game.math.snapToFloor(i,r)/r,this.putTile(t,e,i,s)},searchTileIndex:function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=!1),n=this.getLayer(n);var r=0;if(i){for(var s=this.layers[n].height-1;0<=s;s--)for(var o=this.layers[n].width-1;0<=o;o--)if(this.layers[n].data[s][o].index===t){if(r===e)return this.layers[n].data[s][o];r++}}else for(s=0;s<this.layers[n].height;s++)for(o=0;o<this.layers[n].width;o++)if(this.layers[n].data[s][o].index===t){if(r===e)return this.layers[n].data[s][o];r++}return null},getTile:function(t,e,i,n){return void 0===n&&(n=!1),i=this.getLayer(i),0<=t&&t<this.layers[i].width&&0<=e&&e<this.layers[i].height&&(-1!==this.layers[i].data[e][t].index||n)?this.layers[i].data[e][t]:null},getTileWorldXY:function(t,e,i,n,r,s){return void 0===i&&(i=this.tileWidth),void 0===n&&(n=this.tileHeight),r=this.getLayer(r),t=this.game.math.snapToFloor(t,i)/i,e=this.game.math.snapToFloor(e,n)/n,this.getTile(t,e,r,s)},copy:function(t,e,i,n,r){if(r=this.getLayer(r),this.layers[r]){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=this.layers[r].width),void 0===n&&(n=this.layers[r].height),t<0&&(t=0),e<0&&(e=0),i>this.layers[r].width&&(i=this.layers[r].width),n>this.layers[r].height&&(n=this.layers[r].height),this._results.length=0,this._results.push({x:t,y:e,width:i,height:n,layer:r});for(var s=e;s<e+n;s++)for(var o=t;o<t+i;o++)this._results.push(this.layers[r].data[s][o]);return this._results}this._results.length=0},paste:function(t,e,i,n){if(void 0===t&&(t=0),void 0===e&&(e=0),n=this.getLayer(n),i&&!(i.length<2)){for(var r=t-i[1].x,s=e-i[1].y,o=1;o<i.length;o++)this.layers[n].data[s+i[o].y][r+i[o].x].copy(i[o]);this.layers[n].dirty=!0,this.calculateFaces(n)}},swap:function(t,e,i,n,r,s,o){o=this.getLayer(o),this.copy(i,n,r,s,o),this._results.length<2||(this._tempA=t,this._tempB=e,this._results.forEach(this.swapHandler,this),this.paste(i,n,this._results,o))},swapHandler:function(t){t.index===this._tempA?t.index=this._tempB:t.index===this._tempB&&(t.index=this._tempA)},forEach:function(t,e,i,n,r,s,o){o=this.getLayer(o),this.copy(i,n,r,s,o),this._results.length<2||(this._results.forEach(t,e),this.paste(i,n,this._results,o))},replace:function(t,e,i,n,r,s,o){if(o=this.getLayer(o),this.copy(i,n,r,s,o),!(this._results.length<2)){for(var a=1;a<this._results.length;a++)this._results[a].index===t&&(this._results[a].index=e);this.paste(i,n,this._results,o)}},random:function(t,e,i,n,r){if(r=this.getLayer(r),this.copy(t,e,i,n,r),!(this._results.length<2)){for(var s,o=[],a=1;a<this._results.length;a++)this._results[a].index&&(s=this._results[a].index,-1===o.indexOf(s)&&o.push(s));for(var l=1;l<this._results.length;l++)this._results[l].index=this.game.rnd.pick(o);this.paste(t,e,this._results,r)}},shuffle:function(t,e,i,n,r){if(r=this.getLayer(r),this.copy(t,e,i,n,r),!(this._results.length<2)){for(var s=[],o=1;o<this._results.length;o++)this._results[o].index&&s.push(this._results[o].index);U.ArrayUtils.shuffle(s);for(var a=1;a<this._results.length;a++)this._results[a].index=s[a-1];this.paste(t,e,this._results,r)}},fill:function(t,e,i,n,r,s){if(s=this.getLayer(s),this.copy(e,i,n,r,s),!(this._results.length<2)){for(var o=1;o<this._results.length;o++)this._results[o].index=t;this.paste(e,i,this._results,s)}},removeAllLayers:function(){this.layers.length=0,this.currentLayer=0},dump:function(){for(var t="",e=[""],i=0;i<this.layers[this.currentLayer].height;i++){for(var n=0;n<this.layers[this.currentLayer].width;n++)t+="%c  ",1<this.layers[this.currentLayer].data[i][n]?this.debugMap[this.layers[this.currentLayer].data[i][n]]?e.push("background: "+this.debugMap[this.layers[this.currentLayer].data[i][n]]):e.push("background: #ffffff"):e.push("background: rgb(0, 0, 0)");t+="\n"}e[0]=t,console.log.apply(console,e)},destroy:function(){this.removeAllLayers(),this.data=[],this.game=null}},U.Tilemap.prototype.constructor=U.Tilemap,Object.defineProperty(U.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(t){t!==this.currentLayer&&this.setLayer(t)}}),U.TilemapLayer=function(t,e,i,n,r){n|=0,r|=0,U.Sprite.call(this,t,0,0),this.map=e,this.index=i,this.layer=e.layers[i],this.canvas=PIXI.CanvasPool.create(this,n,r),this.context=this.canvas.getContext("2d"),this.setTexture(new PIXI.Texture(new PIXI.BaseTexture(this.canvas))),this.type=U.TILEMAPLAYER,this.physicsType=U.TILEMAPLAYER,this.renderSettings={enableScrollDelta:!1,overdrawRatio:.2,copyCanvas:null},this.debug=!1,this.exists=!0,this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:!0,debugAlpha:.5,facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"},this.scrollFactorX=1,this.scrollFactorY=1,this.dirty=!0,this.rayStepRate=4,this._wrap=!1,this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:e.tileWidth,tileHeight:e.tileHeight,cw:e.tileWidth,ch:e.tileHeight,tilesets:[]},this._scrollX=0,this._scrollY=0,this._results=[],t.device.canvasBitBltShift||(this.renderSettings.copyCanvas=U.TilemapLayer.ensureSharedCopyCanvas()),this.fixedToCamera=!0},U.TilemapLayer.prototype=Object.create(U.Sprite.prototype),U.TilemapLayer.prototype.constructor=U.TilemapLayer,U.TilemapLayer.prototype.preUpdateCore=U.Component.Core.preUpdate,U.TilemapLayer.sharedCopyCanvas=null,U.TilemapLayer.ensureSharedCopyCanvas=function(){return this.sharedCopyCanvas||(this.sharedCopyCanvas=PIXI.CanvasPool.create(this,2,2)),this.sharedCopyCanvas},U.TilemapLayer.prototype.preUpdate=function(){return this.preUpdateCore()},U.TilemapLayer.prototype.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y),this._scrollX=this.game.camera.view.x*this.scrollFactorX/this.scale.x,this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y},U.TilemapLayer.prototype._renderCanvas=function(t){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y),this._scrollX=this.game.camera.view.x*this.scrollFactorX/this.scale.x,this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y,this.render(),PIXI.Sprite.prototype._renderCanvas.call(this,t)},U.TilemapLayer.prototype._renderWebGL=function(t){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y),this._scrollX=this.game.camera.view.x*this.scrollFactorX/this.scale.x,this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y,this.render(),PIXI.Sprite.prototype._renderWebGL.call(this,t)},U.TilemapLayer.prototype.destroy=function(){PIXI.CanvasPool.remove(this),U.Component.Destroy.prototype.destroy.call(this)},U.TilemapLayer.prototype.resize=function(t,e){this.canvas.width=t,this.canvas.height=e,this.texture.frame.resize(t,e),this.texture.width=t,this.texture.height=e,this.texture.crop.width=t,this.texture.crop.height=e,this.texture.baseTexture.width=t,this.texture.baseTexture.height=e,this.texture.baseTexture.dirty(),this.texture.requiresUpdate=!0,this.texture._updateUvs(),this.dirty=!0},U.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)},U.TilemapLayer.prototype._fixX=function(t){return 1===this.scrollFactorX||0===this.scrollFactorX&&0===this.position.x?t:0===this.scrollFactorX&&0!==this.position.x?t-this.position.x:this._scrollX+(t-this._scrollX/this.scrollFactorX)},U.TilemapLayer.prototype._unfixX=function(t){return 1===this.scrollFactorX?t:this._scrollX/this.scrollFactorX+(t-this._scrollX)},U.TilemapLayer.prototype._fixY=function(t){return 1===this.scrollFactorY||0===this.scrollFactorY&&0===this.position.y?t:0===this.scrollFactorY&&0!==this.position.y?t-this.position.y:this._scrollY+(t-this._scrollY/this.scrollFactorY)},U.TilemapLayer.prototype._unfixY=function(t){return 1===this.scrollFactorY?t:this._scrollY/this.scrollFactorY+(t-this._scrollY)},U.TilemapLayer.prototype.getTileX=function(t){return Math.floor(this._fixX(t)/this._mc.tileWidth)},U.TilemapLayer.prototype.getTileY=function(t){return Math.floor(this._fixY(t)/this._mc.tileHeight)},U.TilemapLayer.prototype.getTileXY=function(t,e,i){return i.x=this.getTileX(t),i.y=this.getTileY(e),i},U.TilemapLayer.prototype.getRayCastTiles=function(t,e,i,n){e=e||this.rayStepRate,void 0===i&&(i=!1),void 0===n&&(n=!1);var r=this.getTiles(t.x,t.y,t.width,t.height,i,n);if(0===r.length)return[];for(var s=t.coordinatesOnLine(e),o=[],a=0;a<r.length;a++)for(var l=0;l<s.length;l++){var p=r[a],h=s[l];if(p.containsPoint(h[0],h[1])){o.push(p);break}}return o},U.TilemapLayer.prototype.getTiles=function(t,e,i,n,r,s){void 0===r&&(r=!1),void 0===s&&(s=!1);var o=!(r||s);t=this._fixX(t),e=this._fixY(e);for(var a=Math.floor(t/(this._mc.cw*this.scale.x)),l=Math.floor(e/(this._mc.ch*this.scale.y)),p=Math.ceil((t+i)/(this._mc.cw*this.scale.x))-a,h=Math.ceil((e+n)/(this._mc.ch*this.scale.y))-l;this._results.length;)this._results.pop();for(var u=l;u<l+h;u++)for(var c=a;c<a+p;c++){var d=this.layer.data[u];d&&d[c]&&(o||d[c].isInteresting(r,s))&&this._results.push(d[c])}return this._results.slice()},U.TilemapLayer.prototype.resolveTileset=function(t){var e=this._mc.tilesets;if(t<2e3)for(;e.length<t;)e.push(void 0);var i=this.map.tiles[t]&&this.map.tiles[t][2];if(null!==i){i=this.map.tilesets[i];if(i&&i.containsTileIndex(t))return e[t]=i}return e[t]=null},U.TilemapLayer.prototype.resetTilesetCache=function(){for(var t=this._mc.tilesets;t.length;)t.pop()},U.TilemapLayer.prototype.setScale=function(t,e){t=t||1,e=e||t;for(var i=0;i<this.layer.data.length;i++)for(var n=this.layer.data[i],r=0;r<n.length;r++){var s=n[r];s.width=this.map.tileWidth*t,s.height=this.map.tileHeight*e,s.worldX=s.x*s.width,s.worldY=s.y*s.height}this.scale.setTo(t,e)},U.TilemapLayer.prototype.shiftCanvas=function(t,e,i){var n=t.canvas,r=n.width-Math.abs(e),s=n.height-Math.abs(i),o=0,a=0,l=e,p=i;e<0&&(o=-e,l=0),i<0&&(a=-i,p=0);e=this.renderSettings.copyCanvas;e?((e.width<r||e.height<s)&&(e.width=r,e.height=s),(i=e.getContext("2d")).clearRect(0,0,r,s),i.drawImage(n,o,a,r,s,0,0,r,s),t.clearRect(l,p,r,s),t.drawImage(e,0,0,r,s,l,p,r,s)):(t.save(),t.globalCompositeOperation="copy",t.drawImage(n,o,a,r,s,l,p,r,s),t.restore())},U.TilemapLayer.prototype.renderRegion=function(t,e,i,n,r,s){var o=this.context,a=this.layer.width,l=this.layer.height,p=this._mc.tileWidth,h=this._mc.tileHeight,u=this._mc.tilesets,c=NaN;this._wrap||(i<=r&&(i=Math.max(0,i),r=Math.min(a-1,r)),n<=s&&(n=Math.max(0,n),s=Math.min(l-1,s)));for(var d=i*p-t,_=(i+(1<<20)*a)%a,y=(n+(1<<20)*l)%l,f=s-n,m=n*h-e;0<=f;y++,f--,m+=h){l<=y&&(y-=l);for(var x=this.layer.data[y],v=_,g=r-i,b=d;0<=g;v++,g--,b+=p){a<=v&&(v-=a);var z,w,C=x[v];!C||C.index<0||(void 0===(w=u[z=C.index])&&(w=this.resolveTileset(z)),C.alpha===c||this.debug||(o.globalAlpha=C.alpha,c=C.alpha),w?C.rotation||C.flipped?(o.save(),o.translate(b+C.centerX,m+C.centerY),o.rotate(C.rotation),C.flipped&&o.scale(-1,1),w.draw(o,-C.centerX,-C.centerY,z),o.restore()):w.draw(o,b,m,z):this.debugSettings.missingImageFill&&(o.fillStyle=this.debugSettings.missingImageFill,o.fillRect(b,m,p,h)),C.debug&&this.debugSettings.debuggedTileOverfill&&(o.fillStyle=this.debugSettings.debuggedTileOverfill,o.fillRect(b,m,p,h)))}}},U.TilemapLayer.prototype.renderDeltaScroll=function(t,e){var i=this._mc.scrollX,n=this._mc.scrollY,r=this.canvas.width,s=this.canvas.height,o=this._mc.tileWidth,a=this._mc.tileHeight,l=0,p=-o,h=0,u=-a;t<0?(l=r+t,p=r-1):0<t&&(p=t),e<0?(h=s+e,u=s-1):0<e&&(u=e),this.shiftCanvas(this.context,t,e),l=Math.floor((l+i)/o),p=Math.floor((p+i)/o),h=Math.floor((h+n)/a),u=Math.floor((u+n)/a),l<=p&&(this.context.clearRect(l*o-i,0,(p-l+1)*o,s),e=Math.floor((0+n)/a),s=Math.floor((s-1+n)/a),this.renderRegion(i,n,l,e,p,s)),h<=u&&(this.context.clearRect(0,h*a-n,r,(u-h+1)*a),a=Math.floor((0+i)/o),o=Math.floor((r-1+i)/o),this.renderRegion(i,n,a,h,o,u))},U.TilemapLayer.prototype.renderFull=function(){var t=this._mc.scrollX,e=this._mc.scrollY,i=this.canvas.width,n=this.canvas.height,r=this._mc.tileWidth,s=this._mc.tileHeight,o=Math.floor(t/r),a=Math.floor((i-1+t)/r),r=Math.floor(e/s),s=Math.floor((n-1+e)/s);this.context.clearRect(0,0,i,n),this.renderRegion(t,e,o,r,a,s)},U.TilemapLayer.prototype.render=function(){var t=!1;if(this.visible){(this.dirty||this.layer.dirty)&&(t=!(this.layer.dirty=!1));var e=this.canvas.width,i=this.canvas.height,n=0|this._scrollX,r=0|this._scrollY,s=this._mc,o=s.scrollX-n,a=s.scrollY-r;if(t||0!=o||0!=a||s.renderWidth!==e||s.renderHeight!==i)return this.context.save(),s.scrollX=n,s.scrollY=r,s.renderWidth===e&&s.renderHeight===i||(s.renderWidth=e,s.renderHeight=i),this.debug&&(this.context.globalAlpha=this.debugSettings.debugAlpha,this.debugSettings.forceFullRedraw&&(t=!0)),!t&&this.renderSettings.enableScrollDelta&&Math.abs(o)+Math.abs(a)<Math.min(e,i)?this.renderDeltaScroll(o,a):this.renderFull(),this.debug&&(this.context.globalAlpha=1,this.renderDebug()),this.texture.baseTexture.dirty(),this.dirty=!1,this.context.restore(),!0}},U.TilemapLayer.prototype.renderDebug=function(){var t,e,i,n=this._mc.scrollX,r=this._mc.scrollY,s=this.context,o=this.canvas.width,a=this.canvas.height,l=this.layer.width,p=this.layer.height,h=this._mc.tileWidth,u=this._mc.tileHeight,c=Math.floor(n/h),d=Math.floor((o-1+n)/h),o=Math.floor(r/u),a=Math.floor((a-1+r)/u),_=c*h-n,n=o*u-r,y=(c+(1<<20)*l)%l,r=(o+(1<<20)*p)%p;for(s.strokeStyle=this.debugSettings.facingEdgeStroke,e=r,i=a-o,t=n;0<=i;e++,i--,t+=u){p<=e&&(e-=p);for(var f=this.layer.data[e],m=y,x=d-c,v=_;0<=x;m++,x--,v+=h){l<=m&&(m-=l);var g=f[m];!g||g.index<0||!g.collides||(this.debugSettings.collidingTileOverfill&&(s.fillStyle=this.debugSettings.collidingTileOverfill,s.fillRect(v,t,this._mc.cw,this._mc.ch)),this.debugSettings.facingEdgeStroke&&(s.beginPath(),g.faceTop&&(s.moveTo(v,t),s.lineTo(v+this._mc.cw,t)),g.faceBottom&&(s.moveTo(v,t+this._mc.ch),s.lineTo(v+this._mc.cw,t+this._mc.ch)),g.faceLeft&&(s.moveTo(v,t),s.lineTo(v,t+this._mc.ch)),g.faceRight&&(s.moveTo(v+this._mc.cw,t),s.lineTo(v+this._mc.cw,t+this._mc.ch)),s.closePath(),s.stroke()))}}},Object.defineProperty(U.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(t){this._wrap=t,this.dirty=!0}}),Object.defineProperty(U.TilemapLayer.prototype,"scrollX",{get:function(){return this._scrollX},set:function(t){this._scrollX=t}}),Object.defineProperty(U.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(t){this._scrollY=t}}),Object.defineProperty(U.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(t){this._mc.cw=0|t,this.dirty=!0}}),Object.defineProperty(U.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(t){this._mc.ch=0|t,this.dirty=!0}}),U.TilemapParser={INSERT_NULL:!1,parse:function(t,e,i,n,r,s){if(void 0===i&&(i=32),void 0===n&&(n=32),void 0===r&&(r=10),void 0===s&&(s=10),void 0===e)return this.getEmptyData();if(null===e)return this.getEmptyData(i,n,r,s);t=t.cache.getTilemapData(e);if(t)return t.format===U.Tilemap.CSV?this.parseCSV(e,t.data,i,n):t.format&&t.format!==U.Tilemap.TILED_JSON?void 0:this.parseTiledJSON(t.data);console.warn("Phaser.TilemapParser.parse - No map data found for key "+e)},parseCSV:function(t,e,i,n){for(var r=this.getEmptyData(),s=[],o=(e=e.trim()).split("\n"),e=o.length,a=0,l=0;l<o.length;l++){s[l]=[];for(var p=o[l].split(","),h=0;h<p.length;h++)s[l][h]=new U.Tile(r.layers[0],parseInt(p[h],10),h,l,i,n);0===a&&(a=p.length)}return r.format=U.Tilemap.CSV,r.name=t,r.width=a,r.height=e,r.tileWidth=i,r.tileHeight=n,r.widthInPixels=a*i,r.heightInPixels=e*n,r.layers[0].width=a,r.layers[0].height=e,r.layers[0].widthInPixels=r.widthInPixels,r.layers[0].heightInPixels=r.heightInPixels,r.layers[0].data=s,r},getEmptyData:function(t,e,i,n){return{width:null!=i?i:0,height:null!=n?n:0,tileWidth:null!=t?t:0,tileHeight:null!=e?e:0,orientation:"orthogonal",version:"1",properties:{},widthInPixels:0,heightInPixels:0,layers:[{name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:[]}],images:[],objects:{},collision:{},tilesets:[],tiles:[]}},parseTiledJSON:function(t){function e(t,e){var i,n={};for(i in e){var r=e[i];void 0!==t[r]&&(n[r]=t[r])}return n}if("orthogonal"!==t.orientation)return console.warn("TilemapParser.parseTiledJSON - Only orthogonal map types are supported in this version of Phaser"),null;for(var i={width:t.width,height:t.height,tileWidth:t.tilewidth,tileHeight:t.tileheight,orientation:t.orientation,format:U.Tilemap.TILED_JSON,version:t.version,properties:t.properties,widthInPixels:t.width*t.tilewidth,heightInPixels:t.height*t.tileheight},n=[],r=0;r<t.layers.length;r++)if("tilelayer"===t.layers[r].type){var s=t.layers[r];if(!s.compression&&s.encoding&&"base64"===s.encoding){for(var o=window.atob(s.data),a=o.length,l=new Array(a),p=0;p<a;p+=4)l[p/4]=(o.charCodeAt(p)|o.charCodeAt(p+1)<<8|o.charCodeAt(p+2)<<16|o.charCodeAt(p+3)<<24)>>>0;s.data=l,delete s.encoding}else if(s.compression){console.warn("TilemapParser.parseTiledJSON - Layer compression is unsupported, skipping layer '"+s.name+"'");continue}var h={name:s.name,x:s.x,y:s.y,width:s.width,height:s.height,widthInPixels:s.width*t.tilewidth,heightInPixels:s.height*t.tileheight,alpha:s.opacity,visible:s.visible,properties:{},indexes:[],callbacks:[],bodies:[]};s.properties&&(h.properties=s.properties);for(var u,c,d,_=0,y=[],f=[],m=0,a=s.data.length;m<a;m++){if(c=!1,d=u=0,536870912<(S=s.data[m]))switch(2147483648<S&&(S-=2147483648,d+=4),1073741824<S&&(S-=1073741824,d+=2),536870912<S&&(S-=536870912,d+=1),d){case 5:u=Math.PI/2;break;case 6:u=Math.PI;break;case 3:u=3*Math.PI/2;break;case 4:c=!(u=0);break;case 7:u=Math.PI/2,c=!0;break;case 2:u=Math.PI,c=!0;break;case 1:u=3*Math.PI/2,c=!0}0<S?((F=new U.Tile(h,S,_,f.length,t.tilewidth,t.tileheight)).rotation=u,F.flipped=c,0!==d&&(F.flippedVal=d),y.push(F)):U.TilemapParser.INSERT_NULL?y.push(null):y.push(new U.Tile(h,-1,_,f.length,t.tilewidth,t.tileheight)),++_===s.width&&(f.push(y),_=0,y=[])}h.data=f,n.push(h)}i.layers=n;for(var x,v=[],r=0;r<t.layers.length;r++)"imagelayer"===t.layers[r].type&&(T={name:(x=t.layers[r]).name,image:x.image,x:x.x,y:x.y,alpha:x.opacity,visible:x.visible,properties:{}},x.properties&&(T.properties=x.properties),v.push(T));i.images=v;for(var g=[],b=[],z=null,r=0;r<t.tilesets.length;r++){if((N=t.tilesets[r]).image){var w=new U.Tileset(N.name,N.firstgid,N.tilewidth,N.tileheight,N.margin,N.spacing,N.properties);N.tileproperties&&(w.tileProperties=N.tileproperties),w.updateTileData(N.imagewidth,N.imageheight),g.push(w)}else{var C,P=new U.ImageCollection(N.name,N.firstgid,N.tilewidth,N.tileheight,N.margin,N.spacing,N.properties);for(C in N.tiles){var T=N.tiles[C].image,S=N.firstgid+parseInt(C,10);P.addImage(S,T)}b.push(P)}z&&(z.lastgid=N.firstgid-1),z=N}i.tilesets=g,i.imagecollections=b;for(var M={},A={},r=0;r<t.layers.length;r++)if("objectgroup"===t.layers[r].type){var O=t.layers[r];M[O.name]=[],A[O.name]=[];for(var k=0,a=O.objects.length;k<a;k++)if(O.objects[k].gid){var E={gid:O.objects[k].gid,name:O.objects[k].name,type:O.objects[k].hasOwnProperty("type")?O.objects[k].type:"",x:O.objects[k].x,y:O.objects[k].y,visible:O.objects[k].visible,properties:O.objects[k].properties};O.objects[k].rotation&&(E.rotation=O.objects[k].rotation),M[O.name].push(E)}else if(O.objects[k].polyline){var E={name:O.objects[k].name,type:O.objects[k].type,x:O.objects[k].x,y:O.objects[k].y,width:O.objects[k].width,height:O.objects[k].height,visible:O.objects[k].visible,properties:O.objects[k].properties};O.objects[k].rotation&&(E.rotation=O.objects[k].rotation),E.polyline=[];for(var I=0;I<O.objects[k].polyline.length;I++)E.polyline.push([O.objects[k].polyline[I].x,O.objects[k].polyline[I].y]);A[O.name].push(E),M[O.name].push(E)}else if(O.objects[k].polygon){(E=e(O.objects[k],["name","type","x","y","visible","rotation","properties"])).polygon=[];for(I=0;I<O.objects[k].polygon.length;I++)E.polygon.push([O.objects[k].polygon[I].x,O.objects[k].polygon[I].y]);M[O.name].push(E)}else O.objects[k].ellipse?E=e(O.objects[k],["name","type","ellipse","x","y","width","height","visible","rotation","properties"]):(E=e(O.objects[k],["name","type","x","y","width","height","visible","rotation","properties"])).rectangle=!0,M[O.name].push(E)}i.objects=M,i.collision=A,i.tiles=[];for(r=0;r<i.tilesets.length;r++)for(var _=(N=i.tilesets[r]).tileMargin,D=N.tileMargin,B=0,L=0,R=0,m=N.firstgid;m<N.firstgid+N.total&&(i.tiles[m]=[_,D,r],_+=N.tileWidth+N.tileSpacing,++B!==N.total)&&(++L!==N.columns||(_=N.tileMargin,D+=N.tileHeight+N.tileSpacing,L=0,++R!==N.rows));m++);for(var F,j,N,r=0;r<i.layers.length;r++){h=i.layers[r],N=null;for(p=0;p<h.data.length;p++){y=h.data[p];for(var G=0;G<y.length;G++)null===(F=y[G])||F.index<0||(j=i.tiles[F.index][2],(N=i.tilesets[j]).tileProperties&&N.tileProperties[F.index-N.firstgid]&&(F.properties=U.Utils.mixin(N.tileProperties[F.index-N.firstgid],F.properties)))}}return i}},U.Tileset=function(t,e,i,n,r,s,o){(void 0===i||i<=0)&&(i=32),(void 0===n||n<=0)&&(n=32),void 0===r&&(r=0),void 0===s&&(s=0),this.name=t,this.firstgid=0|e,this.tileWidth=0|i,this.tileHeight=0|n,this.tileMargin=0|r,this.tileSpacing=0|s,this.properties=o||{},this.image=null,this.rows=0,this.columns=0,this.total=0,this.drawCoords=[]},U.Tileset.prototype={draw:function(t,e,i,n){n=n-this.firstgid<<1;0<=n&&1+n<this.drawCoords.length&&t.drawImage(this.image,this.drawCoords[n],this.drawCoords[1+n],this.tileWidth,this.tileHeight,e,i,this.tileWidth,this.tileHeight)},containsTileIndex:function(t){return t>=this.firstgid&&t<this.firstgid+this.total},setImage:function(t){this.image=t,this.updateTileData(t.width,t.height)},setSpacing:function(t,e){this.tileMargin=0|t,this.tileSpacing=0|e,this.image&&this.updateTileData(this.image.width,this.image.height)},updateTileData:function(t,e){e=(e-2*this.tileMargin+this.tileSpacing)/(this.tileHeight+this.tileSpacing),t=(t-2*this.tileMargin+this.tileSpacing)/(this.tileWidth+this.tileSpacing);e%1==0&&t%1==0||console.warn("Phaser.Tileset - "+this.name+" image tile area is not an even multiple of tile size"),e=Math.floor(e),t=Math.floor(t),(this.rows&&this.rows!==e||this.columns&&this.columns!==t)&&console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ"),this.rows=e,this.columns=t,this.total=e*t,this.drawCoords.length=0;for(var i=this.tileMargin,n=this.tileMargin,r=0;r<this.rows;r++){for(var s=0;s<this.columns;s++)this.drawCoords.push(i),this.drawCoords.push(n),i+=this.tileWidth+this.tileSpacing;i=this.tileMargin,n+=this.tileHeight+this.tileSpacing}}},U.Tileset.prototype.constructor=U.Tileset,U.Particle=function(t,e,i,n,r){U.Sprite.call(this,t,e,i,n,r),this.autoScale=!1,this.scaleData=null,this._s=0,this.autoAlpha=!1,this.alphaData=null,this._a=0},U.Particle.prototype=Object.create(U.Sprite.prototype),U.Particle.prototype.constructor=U.Particle,U.Particle.prototype.update=function(){this.autoScale&&(this._s--,this._s?this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y):this.autoScale=!1),this.autoAlpha&&(this._a--,this._a?this.alpha=this.alphaData[this._a].v:this.autoAlpha=!1)},U.Particle.prototype.onEmit=function(){},U.Particle.prototype.setAlphaData=function(t){this.alphaData=t,this._a=t.length-1,this.alpha=this.alphaData[this._a].v,this.autoAlpha=!0},U.Particle.prototype.setScaleData=function(t){this.scaleData=t,this._s=t.length-1,this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y),this.autoScale=!0},U.Particle.prototype.reset=function(t,e,i){return U.Component.Reset.prototype.reset.call(this,t,e,i),this.alpha=1,this.scale.set(1),this.autoScale=!1,this.autoAlpha=!1,this},U.Particles=function(t){this.game=t,this.emitters={},this.ID=0},U.Particles.prototype={add:function(t){return this.emitters[t.name]=t},remove:function(t){delete this.emitters[t.name]},update:function(){for(var t in this.emitters)this.emitters[t].exists&&this.emitters[t].update()}},U.Particles.prototype.constructor=U.Particles,U.Particles.Arcade={},U.Particles.Arcade.Emitter=function(t,e,i,n){this.maxParticles=n||50,U.Group.call(this,t),this.name="emitter"+this.game.particles.ID++,this.type=U.EMITTER,this.physicsType=U.GROUP,this.area=new U.Rectangle(e,i,1,1),this.minParticleSpeed=new U.Point(-100,-100),this.maxParticleSpeed=new U.Point(100,100),this.minParticleScale=1,this.maxParticleScale=1,this.scaleData=null,this.minRotation=-360,this.maxRotation=360,this.minParticleAlpha=1,this.maxParticleAlpha=1,this.alphaData=null,this.gravity=100,this.particleClass=U.Particle,this.particleDrag=new U.Point,this.angularDrag=0,this.frequency=100,this.lifespan=2e3,this.bounce=new U.Point,this.on=!1,this.particleAnchor=new U.Point(.5,.5),this.blendMode=U.blendModes.NORMAL,this.emitX=e,this.emitY=i,this.autoScale=!1,this.autoAlpha=!1,this.particleBringToTop=!1,this.particleSendToBack=!1,this._minParticleScale=new U.Point(1,1),this._maxParticleScale=new U.Point(1,1),this._quantity=0,this._timer=0,this._counter=0,this._flowQuantity=0,this._flowTotal=0,this._explode=!0,this._frames=null},U.Particles.Arcade.Emitter.prototype=Object.create(U.Group.prototype),U.Particles.Arcade.Emitter.prototype.constructor=U.Particles.Arcade.Emitter,U.Particles.Arcade.Emitter.prototype.update=function(){if(this.on&&this.game.time.time>=this._timer)if(this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion,0!==this._flowTotal)if(0<this._flowQuantity){for(var t=0;t<this._flowQuantity;t++)if(this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal)){this.on=!1;break}}else this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal&&(this.on=!1));else this.emitParticle()&&(this._counter++,0<this._quantity&&this._counter>=this._quantity&&(this.on=!1));for(t=this.children.length;t--;)this.children[t].exists&&this.children[t].update()},U.Particles.Arcade.Emitter.prototype.makeParticles=function(t,e,i,n,r){void 0===e&&(e=0),void 0===i&&(i=this.maxParticles),void 0===n&&(n=!1),void 0===r&&(r=!1);var s,o=0,a=t,l=e;for(this._frames=e,i>this.maxParticles&&(this.maxParticles=i);o<i;)Array.isArray(t)&&(a=this.game.rnd.pick(t)),Array.isArray(e)&&(l=this.game.rnd.pick(e)),s=new this.particleClass(this.game,0,0,a,l),this.game.physics.arcade.enable(s,!1),n?(s.body.checkCollision.any=!0,s.body.checkCollision.none=!1):s.body.checkCollision.none=!0,s.body.collideWorldBounds=r,s.body.skipQuadTree=!0,s.exists=!1,s.visible=!1,s.anchor.copyFrom(this.particleAnchor),this.add(s),o++;return this},U.Particles.Arcade.Emitter.prototype.kill=function(){return this.on=!1,this.alive=!1,this.exists=!1,this},U.Particles.Arcade.Emitter.prototype.revive=function(){return this.alive=!0,this.exists=!0,this},U.Particles.Arcade.Emitter.prototype.explode=function(t,e){return this._flowTotal=0,this.start(!0,t,0,e,!1),this},U.Particles.Arcade.Emitter.prototype.flow=function(t,e,i,n,r){return void 0!==i&&0!==i||(i=1),void 0===n&&(n=-1),void 0===r&&(r=!0),i>this.maxParticles&&(i=this.maxParticles),this._counter=0,this._flowQuantity=i,this._flowTotal=n,r?(this.start(!0,t,e,i),this._counter+=i,this.on=!0,this._timer=this.game.time.time+e*this.game.time.slowMotion):this.start(!1,t,e,i),this},U.Particles.Arcade.Emitter.prototype.start=function(t,e,i,n,r){if(void 0===t&&(t=!0),void 0===e&&(e=0),null!=i||(i=250),void 0===n&&(n=0),void 0===r&&(r=!1),n>this.maxParticles&&(n=this.maxParticles),this.revive(),this.visible=!0,this.lifespan=e,this.frequency=i,t||r)for(var s=0;s<n;s++)this.emitParticle();else this.on=!0,this._quantity=n,this._counter=0,this._timer=this.game.time.time+i*this.game.time.slowMotion;return this},U.Particles.Arcade.Emitter.prototype.emitParticle=function(t,e,i,n){void 0===t&&(t=null),void 0===e&&(e=null);var r=this.getFirstExists(!1);if(null===r)return!1;var s=this.game.rnd;void 0!==i&&void 0!==n?r.loadTexture(i,n):void 0!==i&&r.loadTexture(i);var o=this.emitX,i=this.emitY;null!==t?o=t:1<this.width&&(o=s.between(this.left,this.right)),null!==e?i=e:1<this.height&&(i=s.between(this.top,this.bottom)),r.reset(o,i),r.angle=0,r.lifespan=this.lifespan,this.particleBringToTop?this.bringToTop(r):this.particleSendToBack&&this.sendToBack(r),this.autoScale?r.setScaleData(this.scaleData):1!==this.minParticleScale||1!==this.maxParticleScale?r.scale.set(s.realInRange(this.minParticleScale,this.maxParticleScale)):this._minParticleScale.x===this._maxParticleScale.x&&this._minParticleScale.y===this._maxParticleScale.y||r.scale.set(s.realInRange(this._minParticleScale.x,this._maxParticleScale.x),s.realInRange(this._minParticleScale.y,this._maxParticleScale.y)),void 0===n&&(Array.isArray(this._frames)?r.frame=this.game.rnd.pick(this._frames):r.frame=this._frames),this.autoAlpha?r.setAlphaData(this.alphaData):r.alpha=s.realInRange(this.minParticleAlpha,this.maxParticleAlpha),r.blendMode=this.blendMode;n=r.body;return n.updateBounds(),n.bounce.copyFrom(this.bounce),n.drag.copyFrom(this.particleDrag),n.velocity.x=s.between(this.minParticleSpeed.x,this.maxParticleSpeed.x),n.velocity.y=s.between(this.minParticleSpeed.y,this.maxParticleSpeed.y),n.angularVelocity=s.between(this.minRotation,this.maxRotation),n.gravity.y=this.gravity,n.angularDrag=this.angularDrag,r.onEmit(),!0},U.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this),U.Group.prototype.destroy.call(this,!0,!1)},U.Particles.Arcade.Emitter.prototype.setSize=function(t,e){return this.area.width=t,this.area.height=e,this},U.Particles.Arcade.Emitter.prototype.setXSpeed=function(t,e){return t=t||0,e=e||0,this.minParticleSpeed.x=t,this.maxParticleSpeed.x=e,this},U.Particles.Arcade.Emitter.prototype.setYSpeed=function(t,e){return t=t||0,e=e||0,this.minParticleSpeed.y=t,this.maxParticleSpeed.y=e,this},U.Particles.Arcade.Emitter.prototype.setRotation=function(t,e){return t=t||0,e=e||0,this.minRotation=t,this.maxRotation=e,this},U.Particles.Arcade.Emitter.prototype.setAlpha=function(t,e,i,n,r){return void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=0),void 0===n&&(n=U.Easing.Linear.None),void 0===r&&(r=!1),this.minParticleAlpha=t,this.maxParticleAlpha=e,this.autoAlpha=!1,0<i&&t!==e&&(t={v:t},(n=this.game.make.tween(t).to({v:e},i,n)).yoyo(r),this.alphaData=n.generateData(60),this.alphaData.reverse(),this.autoAlpha=!0),this},U.Particles.Arcade.Emitter.prototype.setScale=function(t,e,i,n,r,s,o){return void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n=1),void 0===r&&(r=0),void 0===s&&(s=U.Easing.Linear.None),void 0===o&&(o=!1),this.minParticleScale=1,this.maxParticleScale=1,this._minParticleScale.set(t,i),this._maxParticleScale.set(e,n),this.autoScale=!1,0<r&&(t!==e||i!==n)&&(i={x:t,y:i},(s=this.game.make.tween(i).to({x:e,y:n},r,s)).yoyo(o),this.scaleData=s.generateData(60),this.scaleData.reverse(),this.autoScale=!0),this},U.Particles.Arcade.Emitter.prototype.at=function(t){return t.center?(this.emitX=t.center.x,this.emitY=t.center.y):(this.emitX=t.world.x+t.anchor.x*t.width,this.emitY=t.world.y+t.anchor.y*t.height),this},Object.defineProperty(U.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(t){this.area.width=t}}),Object.defineProperty(U.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(t){this.area.height=t}}),Object.defineProperty(U.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(t){this.emitX=t}}),Object.defineProperty(U.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(t){this.emitY=t}}),Object.defineProperty(U.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.area.width/2)}}),Object.defineProperty(U.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.area.width/2)}}),Object.defineProperty(U.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.area.height/2)}}),Object.defineProperty(U.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+this.area.height/2)}}),U.Weapon=function(t,e){U.Plugin.call(this,t,e),this.bullets=null,this.autoExpandBulletsGroup=!1,this.autofire=!1,this.shots=0,this.fireLimit=0,this.fireRate=100,this.fireRateVariance=0,this.fireFrom=new U.Rectangle(0,0,1,1),this.fireAngle=U.ANGLE_UP,this.bulletInheritSpriteSpeed=!1,this.bulletAnimation="",this.bulletFrameRandom=!1,this.bulletFrameCycle=!1,this.bulletWorldWrap=!1,this.bulletWorldWrapPadding=0,this.bulletAngleOffset=0,this.bulletAngleVariance=0,this.bulletSpeed=200,this.bulletSpeedVariance=0,this.bulletLifespan=0,this.bulletKillDistance=0,this.bulletGravity=new U.Point(0,0),this.bulletRotateToVelocity=!1,this.bulletKey="",this.bulletFrame="",this._bulletClass=U.Bullet,this._bulletCollideWorldBounds=!1,this._bulletKillType=U.Weapon.KILL_WORLD_BOUNDS,this._data={customBody:!1,width:0,height:0,offsetX:0,offsetY:0},this.bounds=new U.Rectangle,this.bulletBounds=t.world.bounds,this.bulletFrames=[],this.bulletFrameIndex=0,this.anims={},this.onFire=new U.Signal,this.onKill=new U.Signal,this.onFireLimit=new U.Signal,this.trackedSprite=null,this.trackedPointer=null,this.trackRotation=!1,this.trackOffset=new U.Point,this._nextFire=0,this._rotatedPoint=new U.Point},U.Weapon.prototype=Object.create(U.Plugin.prototype),U.Weapon.prototype.constructor=U.Weapon,U.Weapon.KILL_NEVER=0,U.Weapon.KILL_LIFESPAN=1,U.Weapon.KILL_DISTANCE=2,U.Weapon.KILL_WEAPON_BOUNDS=3,U.Weapon.KILL_CAMERA_BOUNDS=4,U.Weapon.KILL_WORLD_BOUNDS=5,U.Weapon.KILL_STATIC_BOUNDS=6,U.Weapon.prototype.createBullets=function(t,e,i,n){return void 0===t&&(t=1),void 0===n&&(n=this.game.world),this.bullets||(this.bullets=this.game.add.physicsGroup(U.Physics.ARCADE,n),this.bullets.classType=this._bulletClass),0!==t&&(-1===t&&(this.autoExpandBulletsGroup=!0,t=1),this.bullets.createMultiple(t,e,i),this.bullets.setAll("data.bulletManager",this),this.bulletKey=e,this.bulletFrame=i),this},U.Weapon.prototype.forEach=function(t,e){return this.bullets.forEachExists(t,e,arguments),this},U.Weapon.prototype.pauseAll=function(){return this.bullets.setAll("body.enable",!1),this},U.Weapon.prototype.resumeAll=function(){return this.bullets.setAll("body.enable",!0),this},U.Weapon.prototype.killAll=function(){return this.bullets.callAllExists("kill",!0),this.bullets.setAll("body.enable",!0),this},U.Weapon.prototype.resetShots=function(t){return void(this.shots=0)!==t&&(this.fireLimit=t),this},U.Weapon.prototype.destroy=function(){this.parent.remove(this,!1),this.bullets.destroy(),this.game=null,this.parent=null,this.active=!1,this.visible=!1},U.Weapon.prototype.update=function(){this._bulletKillType===U.Weapon.KILL_WEAPON_BOUNDS&&(this.trackedSprite?(this.trackedSprite.updateTransform(),this.bounds.centerOn(this.trackedSprite.worldPosition.x,this.trackedSprite.worldPosition.y)):this.trackedPointer&&this.bounds.centerOn(this.trackedPointer.worldX,this.trackedPointer.worldY)),this.autofire&&this.fire()},U.Weapon.prototype.trackSprite=function(t,e,i,n){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=!1),this.trackedPointer=null,this.trackedSprite=t,this.trackRotation=n,this.trackOffset.set(e,i),this},U.Weapon.prototype.trackPointer=function(t,e,i){return void 0===t&&(t=this.game.input.activePointer),void 0===e&&(e=0),void 0===i&&(i=0),this.trackedPointer=t,this.trackedSprite=null,this.trackRotation=!1,this.trackOffset.set(e,i),this},U.Weapon.prototype.fire=function(t,e,i){if(this.game.time.now<this._nextFire||0<this.fireLimit&&this.shots===this.fireLimit)return!1;var n=this.bulletSpeed;0!==this.bulletSpeedVariance&&(n+=U.Math.between(-this.bulletSpeedVariance,this.bulletSpeedVariance)),t?1<this.fireFrom.width?this.fireFrom.centerOn(t.x,t.y):(this.fireFrom.x=t.x,this.fireFrom.y=t.y):this.trackedSprite?(this.trackRotation?(this._rotatedPoint.set(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y),this._rotatedPoint.rotate(this.trackedSprite.world.x,this.trackedSprite.world.y,this.trackedSprite.rotation),1<this.fireFrom.width?this.fireFrom.centerOn(this._rotatedPoint.x,this._rotatedPoint.y):(this.fireFrom.x=this._rotatedPoint.x,this.fireFrom.y=this._rotatedPoint.y)):1<this.fireFrom.width?this.fireFrom.centerOn(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y):(this.fireFrom.x=this.trackedSprite.world.x+this.trackOffset.x,this.fireFrom.y=this.trackedSprite.world.y+this.trackOffset.y),this.bulletInheritSpriteSpeed&&(n+=this.trackedSprite.body.speed)):this.trackedPointer&&(1<this.fireFrom.width?this.fireFrom.centerOn(this.trackedPointer.world.x+this.trackOffset.x,this.trackedPointer.world.y+this.trackOffset.y):(this.fireFrom.x=this.trackedPointer.world.x+this.trackOffset.x,this.fireFrom.y=this.trackedPointer.world.y+this.trackOffset.y));var r=1<this.fireFrom.width?this.fireFrom.randomX:this.fireFrom.x,s=1<this.fireFrom.height?this.fireFrom.randomY:this.fireFrom.y,o=this.trackRotation?this.trackedSprite.angle:this.fireAngle;void 0!==e&&void 0!==i&&(o=this.game.math.radToDeg(Math.atan2(i-s,e-r))),0!==this.bulletAngleVariance&&(o+=U.Math.between(-this.bulletAngleVariance,this.bulletAngleVariance));t=0,i=0;0===o||180===o?t=Math.cos(this.game.math.degToRad(o))*n:i=(90===o||270===o||(t=Math.cos(this.game.math.degToRad(o))*n),Math.sin(this.game.math.degToRad(o))*n);e=null;return this.autoExpandBulletsGroup?(e=this.bullets.getFirstExists(!1,!0,r,s,this.bulletKey,this.bulletFrame)).data.bulletManager=this:e=this.bullets.getFirstExists(!1),e&&(e.reset(r,s),e.data.fromX=r,e.data.fromY=s,e.data.killType=this.bulletKillType,e.data.killDistance=this.bulletKillDistance,e.data.rotateToVelocity=this.bulletRotateToVelocity,this.bulletKillType===U.Weapon.KILL_LIFESPAN&&(e.lifespan=this.bulletLifespan),e.angle=o+this.bulletAngleOffset,""!==this.bulletAnimation?(null===e.animations.getAnimation(this.bulletAnimation)&&(o=this.anims[this.bulletAnimation],e.animations.add(o.name,o.frames,o.frameRate,o.loop,o.useNumericIndex)),e.animations.play(this.bulletAnimation)):this.bulletFrameCycle?(e.frame=this.bulletFrames[this.bulletFrameIndex],this.bulletFrameIndex++,this.bulletFrameIndex>=this.bulletFrames.length&&(this.bulletFrameIndex=0)):this.bulletFrameRandom&&(e.frame=this.bulletFrames[Math.floor(Math.random()*this.bulletFrames.length)]),e.data.bodyDirty&&(this._data.customBody&&e.body.setSize(this._data.width,this._data.height,this._data.offsetX,this._data.offsetY),e.body.collideWorldBounds=this.bulletCollideWorldBounds,e.data.bodyDirty=!1),e.body.velocity.set(t,i),e.body.gravity.set(this.bulletGravity.x,this.bulletGravity.y),0!==this.bulletSpeedVariance?(i=this.fireRate,(i+=U.Math.between(-this.fireRateVariance,this.fireRateVariance))<0&&(i=0),this._nextFire=this.game.time.now+i):this._nextFire=this.game.time.now+this.fireRate,this.shots++,this.onFire.dispatch(e,this,n),0<this.fireLimit&&this.shots===this.fireLimit&&this.onFireLimit.dispatch(this,this.fireLimit)),e},U.Weapon.prototype.fireAtPointer=function(t){return void 0===t&&(t=this.game.input.activePointer),this.fire(null,t.worldX,t.worldY)},U.Weapon.prototype.fireAtSprite=function(t){return this.fire(null,t.world.x,t.world.y)},U.Weapon.prototype.fireAtXY=function(t,e){return this.fire(null,t,e)},U.Weapon.prototype.setBulletBodyOffset=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),this._data.customBody=!0,this._data.width=t,this._data.height=e,this._data.offsetX=i,this._data.offsetY=n,this.bullets.callAll("body.setSize","body",t,e,i,n),this.bullets.setAll("data.bodyDirty",!1),this},U.Weapon.prototype.setBulletFrames=function(t,e,i,n){return void 0===i&&(i=!0),void 0===n&&(n=!1),this.bulletFrames=U.ArrayUtils.numberArray(t,e),this.bulletFrameIndex=0,this.bulletFrameCycle=i,this.bulletFrameRandom=n,this},U.Weapon.prototype.addBulletAnimation=function(t,e,i,n,r){return this.anims[t]={name:t,frames:e,frameRate:i,loop:n,useNumericIndex:r},this.bullets.callAll("animations.add","animations",t,e,i,n,r),this.bulletAnimation=t,this},U.Weapon.prototype.debug=function(t,e,i){void 0===t&&(t=16),void 0===e&&(e=32),void 0===i&&(i=!1),this.game.debug.text("Weapon Plugin",t,e),this.game.debug.text("Bullets Alive: "+this.bullets.total+" - Total: "+this.bullets.length,t,e+24),i&&this.bullets.forEachExists(this.game.debug.body,this.game.debug,"rgba(255, 0, 255, 0.8)")},Object.defineProperty(U.Weapon.prototype,"bulletClass",{get:function(){return this._bulletClass},set:function(t){this._bulletClass=t,this.bullets.classType=this._bulletClass}}),Object.defineProperty(U.Weapon.prototype,"bulletKillType",{get:function(){return this._bulletKillType},set:function(t){switch(t){case U.Weapon.KILL_STATIC_BOUNDS:case U.Weapon.KILL_WEAPON_BOUNDS:this.bulletBounds=this.bounds;break;case U.Weapon.KILL_CAMERA_BOUNDS:this.bulletBounds=this.game.camera.view;break;case U.Weapon.KILL_WORLD_BOUNDS:this.bulletBounds=this.game.world.bounds}this._bulletKillType=t}}),Object.defineProperty(U.Weapon.prototype,"bulletCollideWorldBounds",{get:function(){return this._bulletCollideWorldBounds},set:function(t){this._bulletCollideWorldBounds=t,this.bullets.setAll("body.collideWorldBounds",t),this.bullets.setAll("data.bodyDirty",!1)}}),Object.defineProperty(U.Weapon.prototype,"x",{get:function(){return this.fireFrom.x},set:function(t){this.fireFrom.x=t}}),Object.defineProperty(U.Weapon.prototype,"y",{get:function(){return this.fireFrom.y},set:function(t){this.fireFrom.y=t}}),U.Bullet=function(t,e,i,n,r){U.Sprite.call(this,t,e,i,n,r),this.anchor.set(.5),this.data={bulletManager:null,fromX:0,fromY:0,bodyDirty:!0,rotateToVelocity:!1,killType:0,killDistance:0}},U.Bullet.prototype=Object.create(U.Sprite.prototype),U.Bullet.prototype.constructor=U.Bullet,U.Bullet.prototype.kill=function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.data.bulletManager.onKill.dispatch(this),this},U.Bullet.prototype.update=function(){this.exists&&(this.data.killType>U.Weapon.KILL_LIFESPAN&&(this.data.killType===U.Weapon.KILL_DISTANCE?this.game.physics.arcade.distanceToXY(this,this.data.fromX,this.data.fromY,!0)>this.data.killDistance&&this.kill():this.data.bulletManager.bulletBounds.intersects(this)||this.kill()),this.data.rotateToVelocity&&(this.rotation=Math.atan2(this.body.velocity.y,this.body.velocity.x)),this.data.bulletManager.bulletWorldWrap&&this.game.world.wrap(this,this.data.bulletManager.bulletWorldWrapPadding))},U.Video=function(t,e,i){var n;void 0===e&&(e=null),void 0===i&&(i=null),this.game=t,this.key=e,this.width=0,this.height=0,this.type=U.VIDEO,this.disableTextureUpload=!1,this.touchLocked=!1,this.onPlay=new U.Signal,this.onChangeSource=new U.Signal,this.onComplete=new U.Signal,this.onAccess=new U.Signal,this.onError=new U.Signal,this.onTimeout=new U.Signal,this.timeout=15e3,this._timeOutID=null,this.video=null,this.videoStream=null,this.isStreaming=!1,this.retryLimit=20,this.retry=0,this.retryInterval=500,this._retryID=null,this._codeMuted=!1,this._muted=!1,this._codePaused=!1,this._paused=!1,this._pending=!1,this._autoplay=!1,this._endCallback=null,this._playCallback=null,e&&this.game.cache.checkVideoKey(e)?((n=this.game.cache.getVideo(e)).isBlob?this.createVideoFromBlob(n.data):this.video=n.data,this.width=this.video.videoWidth,this.height=this.video.videoHeight):i&&this.createVideoFromURL(i,!1),this.video&&!i?this.baseTexture=new PIXI.BaseTexture(this.video):this.baseTexture=new PIXI.BaseTexture(U.Cache.DEFAULT.baseTexture.source),this.baseTexture.forceLoaded(this.width,this.height),this.texture=new PIXI.Texture(this.baseTexture),this.textureFrame=new U.Frame(0,0,0,this.width,this.height,"video"),this.texture.setFrame(this.textureFrame),this.texture.valid=!1,null!==e&&this.video&&(this.texture.valid=this.video.canplay),this.snapshot=null,U.BitmapData&&(this.snapshot=new U.BitmapData(this.game,"",this.width,this.height)),!this.game.device.cocoonJS&&(this.game.device.iOS||this.game.device.android)||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock?this.setTouchLock():n&&(n.locked=!1)},U.Video.prototype={connectToMediaStream:function(t,e){return t&&e&&(this.video=t,this.videoStream=e,this.isStreaming=!0,this.baseTexture.source=this.video,this.updateTexture(null,this.video.videoWidth,this.video.videoHeight),this.onAccess.dispatch(this)),this},startMediaStream:function(t,e,i){if(void 0===t&&(t=!1),void 0===e&&(e=null),void 0===i&&(i=null),!this.game.device.getUserMedia)return this.onError.dispatch(this,"No getUserMedia"),!1;null!==this.videoStream&&(this.videoStream.active?this.videoStream.active=!1:this.videoStream.stop()),this.removeVideoElement(),this.video=document.createElement("video"),this.video.setAttribute("autoplay","autoplay"),null!==e&&(this.video.width=e),null!==i&&(this.video.height=i),this._timeOutID=window.setTimeout(this.getUserMediaTimeout.bind(this),this.timeout);try{navigator.getUserMedia({audio:t,video:!0},this.getUserMediaSuccess.bind(this),this.getUserMediaError.bind(this))}catch(t){this.getUserMediaError(t)}return this},getUserMediaTimeout:function(){clearTimeout(this._timeOutID),this.onTimeout.dispatch(this)},getUserMediaError:function(t){clearTimeout(this._timeOutID),this.onError.dispatch(this,t)},getUserMediaSuccess:function(t){clearTimeout(this._timeOutID),this.videoStream=t,void 0!==this.video.mozSrcObject?this.video.mozSrcObject=t:this.video.src=window.URL&&window.URL.createObjectURL(t)||t;var r=this;this.video.onloadeddata=function(){var n=10;!function t(){var e,i;0<n?0<r.video.videoWidth?(e=r.video.videoWidth,i=r.video.videoHeight,isNaN(r.video.videoHeight)&&(i=e/(4/3)),r.video.play(),r.isStreaming=!0,r.baseTexture.source=r.video,r.updateTexture(null,e,i),r.onAccess.dispatch(r)):window.setTimeout(t,500):console.warn("Unable to connect to video stream. Webcam error?"),n--}()}},createVideoFromBlob:function(t){var e=this;return this.video=document.createElement("video"),this.video.controls=!1,this.video.setAttribute("autoplay","autoplay"),this.video.addEventListener("loadeddata",function(t){e.updateTexture(t)},!0),this.video.src=window.URL.createObjectURL(t),this.video.canplay=!0,this},createVideoFromURL:function(t,e){return void 0===e&&(e=!1),this.texture&&(this.texture.valid=!1),this.video=document.createElement("video"),this.video.controls=!1,e&&this.video.setAttribute("autoplay","autoplay"),this.video.src=t,this.video.canplay=!0,this.video.load(),this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval),this.key=t,this},updateTexture:function(t,e,i){var n=!1;null!=e||(e=this.video.videoWidth,n=!0),null!=i||(i=this.video.videoHeight),this.width=e,this.height=i,this.baseTexture.source!==this.video&&(this.baseTexture.source=this.video),this.baseTexture.forceLoaded(e,i),this.texture.frame.resize(e,i),this.texture.width=e,this.texture.height=i,this.texture.valid=!0,this.snapshot&&this.snapshot.resize(e,i),n&&null!==this.key&&(this.onChangeSource.dispatch(this,e,i),this._autoplay&&(this.video.play(),this.onPlay.dispatch(this,this.loop,this.playbackRate)))},complete:function(){this.onComplete.dispatch(this)},play:function(t,e){return void 0===t&&(t=!1),void 0===e&&(e=1),this.game.sound.onMute&&(this.game.sound.onMute.add(this.setMute,this),this.game.sound.onUnMute.add(this.unsetMute,this),this.game.sound.mute&&this.setMute()),this.game.onPause.add(this.setPause,this),this.game.onResume.add(this.setResume,this),this._endCallback=this.complete.bind(this),this.video.addEventListener("ended",this._endCallback,!0),this.video.addEventListener("webkitendfullscreen",this._endCallback,!0),this.video.loop=t?"loop":"",this.video.playbackRate=e,this.touchLocked?this._pending=!0:(this._pending=!1,null!==this.key&&(4!==this.video.readyState?(this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval)):(this._playCallback=this.playHandler.bind(this),this.video.addEventListener("playing",this._playCallback,!0))),this.video.play(),this.onPlay.dispatch(this,t,e)),this},playHandler:function(){this.video.removeEventListener("playing",this._playCallback,!0),this.updateTexture()},stop:function(){return this.game.sound.onMute&&(this.game.sound.onMute.remove(this.setMute,this),this.game.sound.onUnMute.remove(this.unsetMute,this)),this.game.onPause.remove(this.setPause,this),this.game.onResume.remove(this.setResume,this),this.isStreaming?(this.video.mozSrcObject?(this.video.mozSrcObject.stop(),this.video.src=null):(this.video.src="",this.videoStream.active?this.videoStream.active=!1:this.videoStream.getTracks?this.videoStream.getTracks().forEach(function(t){t.stop()}):this.videoStream.stop()),this.videoStream=null,this.isStreaming=!1):(this.video.removeEventListener("ended",this._endCallback,!0),this.video.removeEventListener("webkitendfullscreen",this._endCallback,!0),this.video.removeEventListener("playing",this._playCallback,!0),this.touchLocked?this._pending=!1:this.video.pause()),this},add:function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)t[e].loadTexture&&t[e].loadTexture(this);else t.loadTexture(this);return this},addToWorld:function(t,e,i,n,r,s){r=r||1,s=s||1;e=this.game.add.image(t,e,this);return e.anchor.set(i,n),e.scale.set(r,s),e},render:function(){!this.disableTextureUpload&&this.playing&&this.baseTexture.dirty()},setMute:function(){this._muted||(this._muted=!0,this.video.muted=!0)},unsetMute:function(){this._muted&&!this._codeMuted&&(this._muted=!1,this.video.muted=!1)},setPause:function(){this._paused||this.touchLocked||(this._paused=!0,this.video.pause())},setResume:function(){!this._paused||this._codePaused||this.touchLocked||(this._paused=!1,this.video.ended||this.video.play())},changeSource:function(t,e){return void 0===e&&(e=!0),this.texture.valid=!1,this.video.pause(),this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval),this.video.src=t,this.video.load(),(this._autoplay=e)||(this.paused=!0),this},checkVideoProgress:function(){4===this.video.readyState?this.updateTexture():(this.retry--,0<this.retry?this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval):console.warn("Phaser.Video: Unable to start downloading video in time",this.isStreaming))},setTouchLock:function(){this.game.input.touch.addTouchLockCallback(this.unlock,this),this.touchLocked=!0},unlock:function(){var t;return this.touchLocked=!1,this.video.play(),this.onPlay.dispatch(this,this.loop,this.playbackRate),this.key&&(t=this.game.cache.getVideo(this.key))&&!t.isBlob&&(t.locked=!1),!0},grab:function(t,e,i){return void 0===t&&(t=!1),void 0===e&&(e=1),void 0===i&&(i=null),null===this.snapshot?void console.warn("Video.grab cannot run because Phaser.BitmapData is unavailable"):(t&&this.snapshot.cls(),this.snapshot.copy(this.video,0,0,this.width,this.height,0,0,this.width,this.height,0,0,0,1,1,e,i),this.snapshot)},removeVideoElement:function(){if(this.video){for(this.video.parentNode&&this.video.parentNode.removeChild(this.video);this.video.hasChildNodes();)this.video.removeChild(this.video.firstChild);this.video.removeAttribute("autoplay"),this.video.removeAttribute("src"),this.video=null}},destroy:function(){this.stop(),this.removeVideoElement(),this.touchLocked&&this.game.input.touch.removeTouchLockCallback(this.unlock,this),this._retryID&&window.clearTimeout(this._retryID)}},Object.defineProperty(U.Video.prototype,"currentTime",{get:function(){return this.video?this.video.currentTime:0},set:function(t){this.video.currentTime=t}}),Object.defineProperty(U.Video.prototype,"duration",{get:function(){return this.video?this.video.duration:0}}),Object.defineProperty(U.Video.prototype,"progress",{get:function(){return this.video?this.video.currentTime/this.video.duration:0}}),Object.defineProperty(U.Video.prototype,"mute",{get:function(){return this._muted},set:function(t){(t=t||null)?this._muted||(this._codeMuted=!0,this.setMute()):this._muted&&(this._codeMuted=!1,this.unsetMute())}}),Object.defineProperty(U.Video.prototype,"paused",{get:function(){return this._paused},set:function(t){t=t||null,this.touchLocked||(t?this._paused||(this._codePaused=!0,this.setPause()):this._paused&&(this._codePaused=!1,this.setResume()))}}),Object.defineProperty(U.Video.prototype,"volume",{get:function(){return this.video?this.video.volume:1},set:function(t){t<0?t=0:1<t&&(t=1),this.video&&(this.video.volume=t)}}),Object.defineProperty(U.Video.prototype,"playbackRate",{get:function(){return this.video?this.video.playbackRate:1},set:function(t){this.video&&(this.video.playbackRate=t)}}),Object.defineProperty(U.Video.prototype,"loop",{get:function(){return!!this.video&&this.video.loop},set:function(t){t&&this.video?this.video.loop="loop":this.video&&(this.video.loop="")}}),Object.defineProperty(U.Video.prototype,"playing",{get:function(){return!(this.video.paused&&this.video.ended)}}),U.Video.prototype.constructor=U.Video,void 0===PIXI.blendModes&&(PIXI.blendModes=U.blendModes),void 0===PIXI.scaleModes&&(PIXI.scaleModes=U.scaleModes),void 0===PIXI.Texture.emptyTexture&&(PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture)),void 0===PIXI.DisplayObject._tempMatrix&&(PIXI.DisplayObject._tempMatrix=new PIXI.Matrix),void 0===PIXI.RenderTexture.tempMatrix&&(PIXI.RenderTexture.tempMatrix=new PIXI.Matrix),PIXI.Graphics&&void 0===PIXI.Graphics.POLY&&(PIXI.Graphics.POLY=U.POLYGON,PIXI.Graphics.RECT=U.RECTANGLE,PIXI.Graphics.CIRC=U.CIRCLE,PIXI.Graphics.ELIP=U.ELLIPSE,PIXI.Graphics.RREC=U.ROUNDEDRECTANGLE),PIXI.TextureSilentFail=!0,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=U),exports.Phaser=U):"undefined"!=typeof define&&define.amd?define("Phaser",r.Phaser=U):r.Phaser=U,U}.call(this);var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},PhaserCachebuster,PhaserSuperStorage,PhaserSuperStorage,PhaserSuperStorage,PhaserSuperStorage,PhaserSuperStorage,PhaserSuperStorage;!function(t){var i,e=(i=Phaser.Plugin,__extends(n,i),n.prototype.patchLoader=function(){Object.defineProperty(Phaser.Loader,"cacheBuster",{value:null}),Phaser.Loader.prototype.transformUrl=function(t,e){return t?(null!==this.cacheBuster&&null===t.match(/^(data:)/)&&(t+="?v="+this.cacheBuster),t.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)?t:this.baseURL+e.path+t):""}},n);function n(t,e){e=i.call(this,t,e)||this;return e.patchLoader(),e}t.CacheBuster=e}(PhaserCachebuster=PhaserCachebuster||{}),function(t){var e;function i(t){void 0===t&&(t=""),this.namespace="",this.forcePromises=!1,this.setNamespace(t)}e=t.StorageAdapters||(t.StorageAdapters={}),Object.defineProperty(i.prototype,"length",{get:function(){return null!==this.getNameSpaceMatches()?this.getNameSpaceMatches().length:0},enumerable:!0,configurable:!0}),i.prototype.key=function(t){t=this.getNameSpaceMatches()[t],t=this.getCookiesForNameSpace()[t]||null;return this.forcePromises?this.promisefy(t):t},i.prototype.getItem=function(t){t=this.getCookiesForNameSpace()[t]||null;return this.forcePromises?this.promisefy(t):t},i.prototype.setItem=function(t,e){if(document.cookie=encodeURIComponent(this.namespace+t)+"="+encodeURIComponent(e)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/",this.forcePromises)return this.promisefy(null)},i.prototype.removeItem=function(t){if(document.cookie=encodeURIComponent(this.namespace+t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",this.forcePromises)return this.promisefy(null)},i.prototype.clear=function(){var t,e=this.getCookiesForNameSpace();for(t in e)e.hasOwnProperty(t)&&this.removeItem(t);if(this.forcePromises)return this.promisefy(null)},i.prototype.setNamespace=function(t){if(t&&(this.namespace=t+":",this.reg=new RegExp("^"+this.namespace+"[a-zA-Z0-9]*","g")),this.forcePromises)return this.promisefy(t)},i.prototype.getNameSpaceMatches=function(){var e=this;return decodeURIComponent(document.cookie).split("; ").filter(function(t){return null!==t.match(e.reg)&&0<t.match(e.reg).length})},i.prototype.getCookiesForNameSpace=function(){var e=this,i={};return this.getNameSpaceMatches().forEach(function(t){t=t.replace(e.namespace,"").split("=");i[t[0]]=t[1]}),i},i.prototype.promisefy=function(i){return new Promise(function(t,e){t(i)})},t=i,e.CookieStorage=t}(PhaserSuperStorage=PhaserSuperStorage||{}),function(t){var e;function i(){this.namespace="",this.keys=[]}e=t.StorageAdapters||(t.StorageAdapters={}),Object.defineProperty(i.prototype,"forcePromises",{get:function(){return!0},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"length",{get:function(){return this.keys.length},enumerable:!0,configurable:!0}),i.prototype.key=function(t){return this.promisefy(this.keys[t])},i.prototype.getItem=function(t){var n=this;return new Promise(function(e,i){NativeStorage.getItem(n.namespace+t,function(t){e(t)},function(t){2===t.code?e(null):i(t)})})},i.prototype.setItem=function(i,n){var r=this;return i.length<1?void console.error("CordovaStorage: Key cannot be an empty string!"):new Promise(function(t,e){NativeStorage.setItem(r.namespace+i,n,function(){r.keys.indexOf(i)<0&&(r.keys.push(i),r.save()),t(null)},function(t){e(t)})})},i.prototype.removeItem=function(n){var r=this;return new Promise(function(e,i){NativeStorage.remove(r.namespace+n,function(){var t=r.keys.indexOf(n);0<=t&&(r.keys.splice(t,1),r.save()),e(null)},function(t){i(t)})})},i.prototype.clear=function(){var r=this;return new Promise(function(t,e){for(var i=0,n=0;n<r.keys.length;n++)NativeStorage.remove(r.namespace+r.keys[n],function(){++i>=r.keys.length&&(r.keys=[],r.save(),t(null))},function(t){e(t)})})},i.prototype.setNamespace=function(t){var i=this;return void 0===t&&(t=""),this.namespace=t+":",this.keys=[],new Promise(function(t,e){i.load().then(t).catch(t)})},i.prototype.promisefy=function(i){return new Promise(function(t,e){t(i)})},i.prototype.load=function(){var n=this;return new Promise(function(e,i){NativeStorage.getItem(n.namespace,function(t){n.keys=JSON.parse(t),e(null)},function(t){i(t)})})},i.prototype.save=function(){NativeStorage.setItem(this.namespace,JSON.stringify(this.keys),function(){},function(t){console.warn("CordovaStorage: Failed to save keys of namespace.")})},t=i,e.CordovaStorage=t}(PhaserSuperStorage=PhaserSuperStorage||{}),function(o){var t,e;function i(t,e){void 0===t&&(t=""),void 0===e&&(e="*"),this.namespace="",this.expectedOrigin="",this.storageLength=0,this.enabled=!1,""!==t&&this.setNamespace(t),this.expectedOrigin=e}t=o.StorageAdapters||(o.StorageAdapters={}),Object.defineProperty(i.prototype,"forcePromises",{get:function(){return!0},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"length",{get:function(){return this.storageLength},enumerable:!0,configurable:!0}),i.prototype.init=function(){var t=this;return this.sendMessage({command:o.StorageCommand.init}).then(function(){t.enabled=!0})},i.prototype.key=function(t){return this.sendMessage({command:o.StorageCommand.key,value:t})},i.prototype.getItem=function(t){return this.sendMessage({command:o.StorageCommand.getItem,key:t})},i.prototype.setItem=function(t,e){return this.sendMessage({command:o.StorageCommand.setItem,key:t,value:e})},i.prototype.removeItem=function(t){return this.sendMessage({command:o.StorageCommand.removeItem,key:t})},i.prototype.clear=function(){return this.sendMessage({command:o.StorageCommand.clear})},i.prototype.setNamespace=function(t){return this.sendMessage({command:o.StorageCommand.setNamespace,value:t})},i.prototype.sendMessage=function(t){var r,s=this;t.command===o.StorageCommand.init&&(r=!1);var e=new MessageChannel;return new Promise(function(i,n){s.enabled||t.command===o.StorageCommand.init||n("Messaging not enabled!"),t.command===o.StorageCommand.init&&setTimeout(function(){r||n("Unable to get a response in time")},1e3),e.port1.onmessage=function(t){console.log("Frame received message",t);var e=o.StorageUtils.validateMessage(t.data);switch(e.command===o.StorageCommand.init&&(r=!0),void 0!==e.status&&"ok"===e.status||n(e.value),void 0!==e.length&&(s.storageLength=e.length),e.command){case o.StorageCommand.setNamespace:s.namespace=e.value+":";case o.StorageCommand.getItem:case o.StorageCommand.length:case o.StorageCommand.key:i(e.value);break;case o.StorageCommand.setItem:case o.StorageCommand.removeItem:case o.StorageCommand.clear:case o.StorageCommand.init:i(e.status);break;default:n(e.value)}},!s.enabled&&t.command!==o.StorageCommand.init||(console.log("Sending message to parent: ",t),window.parent.postMessage(t,s.expectedOrigin,[e.port2]))})},e=i,t.IframeStorage=e}(PhaserSuperStorage=PhaserSuperStorage||{}),function(n){var t,e;function i(t){void 0===t&&(t=""),this.namespace="",this.forcePromises=!1,this.setNamespace(t)}t=n.StorageAdapters||(n.StorageAdapters={}),Object.defineProperty(i.prototype,"length",{get:function(){var t=Object.keys(localStorage);return n.StorageUtils.nameSpaceKeyFilter(t,this.namespace).length},enumerable:!0,configurable:!0}),i.prototype.key=function(t){return this.forcePromises?this.promisefy(this._key,arguments):this._key(t)},i.prototype._key=function(t){var e=Object.keys(localStorage),e=n.StorageUtils.nameSpaceKeyFilter(e,this.namespace);return localStorage.getItem(e[t])},i.prototype.getItem=function(t){return this.forcePromises?this.promisefy(this._getItem,arguments):this._getItem(t)},i.prototype._getItem=function(t){return localStorage.getItem(this.namespace+t)},i.prototype.setItem=function(t,e){return this.forcePromises?this.promisefy(this._setItem,arguments):this._setItem(t,e)},i.prototype._setItem=function(t,e){return localStorage.setItem(this.namespace+t,e)},i.prototype.removeItem=function(t){return this.forcePromises?this.promisefy(this._removeItem,arguments):this._removeItem(t)},i.prototype._removeItem=function(t){return localStorage.removeItem(this.namespace+t)},i.prototype.clear=function(){return this.forcePromises?this.promisefy(this._clear,arguments):this._clear()},i.prototype._clear=function(){for(var t=Object.keys(localStorage),e=n.StorageUtils.nameSpaceKeyFilter(t,this.namespace),i=0;i<e.length;i++)localStorage.removeItem(e[i])},i.prototype.setNamespace=function(t){return this.forcePromises?this.promisefy(this._setNameSpace,arguments):this._setNameSpace(t)},i.prototype._setNameSpace=function(t){t&&(this.namespace=t+":")},i.prototype.promisefy=function(i,n){var r=this;return new Promise(function(t,e){t(i.apply(r,n))})},e=i,t.LocalStorage=e}(PhaserSuperStorage=PhaserSuperStorage||{}),function(e){var t=(i.prototype.setAdapter=function(t){this.storage=t},Object.defineProperty(i.prototype,"forcePromises",{get:function(){return this.storage.forcePromises},set:function(t){this.storage.forcePromises=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"length",{get:function(){return null===this.storage?0:this.storage.length},enumerable:!0,configurable:!0}),i.prototype.setNamespace=function(t){if(null!==this.storage)return this.storage.setNamespace(t)},i.prototype.key=function(t){return null===this.storage?"":this.storage.key(t)},i.prototype.getItem=function(t){return null===this.storage?null:this.storage.getItem(t)},i.prototype.setItem=function(t,e){if(null!==this.storage)return this.storage.setItem(t,e)},i.prototype.removeItem=function(t){if(null!==this.storage)return this.storage.removeItem(t)},i.prototype.clear=function(){if(null!==this.storage)return this.storage.clear()},i.instance=null,i);function i(t){if(void 0!==t)Object.defineProperty(t,"storage",{value:this});else{if(null!==i.instance)return i.instance;i.instance=this}e.StorageUtils.isLocalStorageSupport()?this.setAdapter(new e.StorageAdapters.LocalStorage):this.setAdapter(new e.StorageAdapters.CookieStorage)}e.StoragePlugin=t}(PhaserSuperStorage=PhaserSuperStorage||{}),void 0!==window.Phaser&&Phaser.Utils.mixinPrototype(PhaserSuperStorage.StoragePlugin,Phaser.Plugin),function(t){(e=t.StorageCommand||(t.StorageCommand={}))[e.init=0]="init",e[e.setItem=1]="setItem",e[e.getItem=2]="getItem",e[e.removeItem=3]="removeItem",e[e.clear=4]="clear",e[e.setNamespace=5]="setNamespace",e[e.length=6]="length",e[e.key=7]="key",e[e.error=8]="error";var e=(t.StorageCommand,i.isLocalStorageSupport=function(){try{if("object"==typeof localStorage)return localStorage.setItem("testingLocalStorage","foo"),localStorage.removeItem("testingLocalStorage"),!0}catch(t){return!1}return!1},i.validateMessage=function(t){return t.hasOwnProperty("command")?t:null},i.nameSpaceKeyFilter=function(t,e){return t.filter(function(t){return t.substring(0,e.length)===e})},i);function i(){}t.StorageUtils=e}(PhaserSuperStorage=PhaserSuperStorage||{});var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones,dragonBones;function spEvent(t){t=new Event(t);document.getElementById("content").dispatchEvent(t)}dragonBones=dragonBones||{},function(o){var t=(e.prototype.advanceTime=function(t){if(0<this._objects.length){for(var e=0,i=this._objects;e<i.length;e++)i[e].returnToPool();this._objects.length=0}if(this._clock.advanceTime(t),0<this._events.length){for(var n=0;n<this._events.length;++n){var r=this._events[n],s=r.armature;null!==s._armatureData&&(s.eventDispatcher.dispatchDBEvent(r.type,r),r.type===o.EventObject.SOUND_EVENT&&this._eventManager.dispatchDBEvent(r.type,r)),this.bufferObject(r)}this._events.length=0}},e.prototype.bufferEvent=function(t){this._events.indexOf(t)<0&&this._events.push(t)},e.prototype.bufferObject=function(t){this._objects.indexOf(t)<0&&this._objects.push(t)},Object.defineProperty(e.prototype,"clock",{get:function(){return this._clock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventManager",{get:function(){return this._eventManager},enumerable:!0,configurable:!0}),e.VERSION="5.6.0",e.yDown=!0,e.debug=!1,e.debugDraw=!1,e.webAssembly=!1,e);function e(t){this._clock=new o.WorldClock,this._events=[],this._objects=[],this._eventManager=null,this._eventManager=t,console.info("DragonBones: "+e.VERSION+"\nWebsite: http://www.dragonbones.com/\nSource: http://www.github.com/dragonbones/")}o.DragonBones=t,console.warn||(console.warn=function(){}),console.assert||(console.assert=function(){})}(dragonBones=dragonBones||{}),function(t){var e=(r._returnObject=function(t){var e=String(t.constructor),i=e in r._maxCountMap?r._maxCountMap[e]:r._defaultMaxCount,e=r._poolsMap[e]=r._poolsMap[e]||[];e.length<i&&(t._isInPool?console.warn("The object is already in the pool."):(t._isInPool=!0,e.push(t)))},r.toString=function(){throw new Error},r.setMaxCount=function(t,e){var i;if((e<0||e!=e)&&(e=0),null!==t)null!==(i=(n=String(t))in r._poolsMap?r._poolsMap[n]:null)&&i.length>e&&(i.length=e),r._maxCountMap[n]=e;else for(var n in r._defaultMaxCount=e,r._poolsMap)(i=r._poolsMap[n]).length>e&&(i.length=e),n in r._maxCountMap&&(r._maxCountMap[n]=e)},r.clearPool=function(t){if(void 0===t&&(t=null),null!==t){t=String(t);null!==(i=t in r._poolsMap?r._poolsMap[t]:null)&&0<i.length&&(i.length=0)}else for(var e in r._poolsMap){var i;(i=r._poolsMap[e]).length=0}},r.borrowObject=function(t){var e=String(t),e=e in r._poolsMap?r._poolsMap[e]:null;if(null!==e&&0<e.length){e=e.pop();return e._isInPool=!1,e}t=new t;return t._onClear(),t},r.prototype.returnToPool=function(){this._onClear(),r._returnObject(this)},r._hashCode=0,r._defaultMaxCount=3e3,r._maxCountMap={},r._poolsMap={},r);function r(){this.hashCode=r._hashCode++,this._isInPool=!1}t.BaseObject=e}(dragonBones=dragonBones||{}),function(t){var e=(i.prototype.toString=function(){return"[object dragonBones.Matrix] a:"+this.a+" b:"+this.b+" c:"+this.c+" d:"+this.d+" tx:"+this.tx+" ty:"+this.ty},i.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},i.prototype.copyFromArray=function(t,e){return void 0===e&&(e=0),this.a=t[e],this.b=t[e+1],this.c=t[e+2],this.d=t[e+3],this.tx=t[e+4],this.ty=t[e+5],this},i.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this},i.prototype.concat=function(t){var e=this.a*t.a,i=0,n=0,r=this.d*t.d,s=this.tx*t.a+t.tx,o=this.ty*t.d+t.ty;return 0===this.b&&0===this.c||(e+=this.b*t.c,i+=this.b*t.d,n+=this.c*t.a,r+=this.c*t.b),0===t.b&&0===t.c||(i+=this.a*t.b,n+=this.d*t.c,s+=this.ty*t.c,o+=this.tx*t.b),this.a=e,this.b=i,this.c=n,this.d=r,this.tx=s,this.ty=o,this},i.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,r=this.tx,s=this.ty;if(0===e&&0===i)return(this.b=this.c=0)===t||0===n?this.a=this.b=this.tx=this.ty=0:(t=this.a=1/t,n=this.d=1/n,this.tx=-t*r,this.ty=-n*s),this;var o=t*n-e*i;if(0==o)return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this;o=1/o;var a=this.a=n*o,e=this.b=-e*o,i=this.c=-i*o,n=this.d=t*o;return this.tx=-(a*r+i*s),this.ty=-(e*r+n*s),this},i.prototype.transformPoint=function(t,e,i,n){void 0===n&&(n=!1),i.x=this.a*t+this.c*e,i.y=this.b*t+this.d*e,n||(i.x+=this.tx,i.y+=this.ty)},i.prototype.transformRectangle=function(t,e){void 0===e&&(e=!1);var i=this.a,n=this.b,r=this.c,s=this.d,o=e?0:this.tx,a=e?0:this.ty,l=t.x,p=t.y,h=l+t.width,u=p+t.height,c=i*l+r*p+o,d=n*l+s*p+a,_=i*h+r*p+o,e=n*h+s*p+a,p=i*h+r*u+o,h=n*h+s*u+a,o=i*l+r*u+o,u=n*l+s*u+a,a=0;_<c&&(a=c,c=_,_=a),o<p&&(a=p,p=o,o=a),t.x=Math.floor(c<p?c:p),t.width=Math.ceil((o<_?_:o)-t.x),e<d&&(a=d,d=e,e=a),u<h&&(a=h,h=u,u=a),t.y=Math.floor(d<h?d:h),t.height=Math.ceil((u<e?e:u)-t.y)},i);function i(t,e,i,n,r,s){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=0),void 0===s&&(s=0),this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s}t.Matrix=e}(dragonBones=dragonBones||{}),function(t){var e=(s.normalizeRadian=function(t){return t=(t+Math.PI)%(2*Math.PI),t+=0<t?-Math.PI:Math.PI},s.prototype.toString=function(){return"[object dragonBones.Transform] x:"+this.x+" y:"+this.y+" skewX:"+180*this.skew/Math.PI+" skewY:"+180*this.rotation/Math.PI+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY},s.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.skew=t.skew,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this},s.prototype.identity=function(){return this.x=this.y=0,this.skew=this.rotation=0,this.scaleX=this.scaleY=1,this},s.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.skew+=t.skew,this.rotation+=t.rotation,this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this},s.prototype.minus=function(t){return this.x-=t.x,this.y-=t.y,this.skew-=t.skew,this.rotation-=t.rotation,this.scaleX/=t.scaleX,this.scaleY/=t.scaleY,this},s.prototype.fromMatrix=function(t){var e=this.scaleX,i=this.scaleY,n=s.PI_Q;this.x=t.tx,this.y=t.ty,this.rotation=Math.atan(t.b/t.a);var r=Math.atan(-t.c/t.d);return this.scaleX=this.rotation>-n&&this.rotation<n?t.a/Math.cos(this.rotation):t.b/Math.sin(this.rotation),this.scaleY=-n<r&&r<n?t.d/Math.cos(r):-t.c/Math.sin(r),0<=e&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.rotation=this.rotation-Math.PI),0<=i&&this.scaleY<0&&(this.scaleY=-this.scaleY,r-=Math.PI),this.skew=r-this.rotation,this},s.prototype.toMatrix=function(t){return 0!==this.skew||0!==this.rotation?(t.a=Math.cos(this.rotation),t.b=Math.sin(this.rotation),0===this.skew?(t.c=-t.b,t.d=t.a):(t.c=-Math.sin(this.skew+this.rotation),t.d=Math.cos(this.skew+this.rotation)),1!==this.scaleX&&(t.a*=this.scaleX,t.b*=this.scaleX),1!==this.scaleY&&(t.c*=this.scaleY,t.d*=this.scaleY)):(t.a=this.scaleX,t.b=0,t.c=0,t.d=this.scaleY),t.tx=this.x,t.ty=this.y,this},s.PI_D=2*Math.PI,s.PI_H=Math.PI/2,s.PI_Q=Math.PI/4,s.RAD_DEG=180/Math.PI,s.DEG_RAD=Math.PI/180,s);function s(t,e,i,n,r,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===s&&(s=1),this.x=t,this.y=e,this.skew=i,this.rotation=n,this.scaleX=r,this.scaleY=s}t.Transform=e}(dragonBones=dragonBones||{}),function(t){var e=(i.prototype.copyFrom=function(t){this.alphaMultiplier=t.alphaMultiplier,this.redMultiplier=t.redMultiplier,this.greenMultiplier=t.greenMultiplier,this.blueMultiplier=t.blueMultiplier,this.alphaOffset=t.alphaOffset,this.redOffset=t.redOffset,this.greenOffset=t.greenOffset,this.blueOffset=t.blueOffset},i.prototype.identity=function(){this.alphaMultiplier=this.redMultiplier=this.greenMultiplier=this.blueMultiplier=1,this.alphaOffset=this.redOffset=this.greenOffset=this.blueOffset=0},i);function i(t,e,i,n,r,s,o,a){void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n=1),void 0===r&&(r=0),void 0===s&&(s=0),void 0===o&&(o=0),void 0===a&&(a=0),this.alphaMultiplier=t,this.redMultiplier=e,this.greenMultiplier=i,this.blueMultiplier=n,this.alphaOffset=r,this.redOffset=s,this.greenOffset=o,this.blueOffset=a}t.ColorTransform=e}(dragonBones=dragonBones||{}),function(t){var e=(i.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},i.prototype.clear=function(){this.x=this.y=0},i);function i(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}t.Point=e}(dragonBones=dragonBones||{}),function(t){var e=(i.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},i.prototype.clear=function(){this.x=this.y=0,this.width=this.height=0},i);function i(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=t,this.y=e,this.width=i,this.height=n}t.Rectangle=e}(dragonBones=dragonBones||{}),function(t){var e,i=(e=t.BaseObject,__extends(n,e),n.toString=function(){return"[class dragonBones.UserData]"},n.prototype._onClear=function(){this.ints.length=0,this.floats.length=0,this.strings.length=0},n.prototype.addInt=function(t){this.ints.push(t)},n.prototype.addFloat=function(t){this.floats.push(t)},n.prototype.addString=function(t){this.strings.push(t)},n.prototype.getInt=function(t){return void 0===t&&(t=0),0<=t&&t<this.ints.length?this.ints[t]:0},n.prototype.getFloat=function(t){return void 0===t&&(t=0),0<=t&&t<this.floats.length?this.floats[t]:0},n.prototype.getString=function(t){return void 0===t&&(t=0),0<=t&&t<this.strings.length?this.strings[t]:""},n);function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.ints=[],t.floats=[],t.strings=[],t}t.UserData=i;var r,i=(r=t.BaseObject,__extends(s,r),s.toString=function(){return"[class dragonBones.ActionData]"},s.prototype._onClear=function(){null!==this.data&&this.data.returnToPool(),this.type=0,this.name="",this.bone=null,this.slot=null,this.data=null},s);function s(){var t=null!==r&&r.apply(this,arguments)||this;return t.data=null,t}t.ActionData=i}(dragonBones=dragonBones||{}),function(t){var e,i=(e=t.BaseObject,__extends(n,e),n.toString=function(){return"[class dragonBones.DragonBonesData]"},n.prototype._onClear=function(){for(var t in this.armatures)this.armatures[t].returnToPool(),delete this.armatures[t];null!==this.userData&&this.userData.returnToPool(),this.autoSearch=!1,this.frameRate=0,this.version="",this.name="",this.stage=null,this.frameIndices.length=0,this.cachedFrames.length=0,this.armatureNames.length=0,this.binary=null,this.intArray=null,this.floatArray=null,this.frameIntArray=null,this.frameFloatArray=null,this.frameArray=null,this.timelineArray=null,this.userData=null},n.prototype.addArmature=function(t){t.name in this.armatures?console.warn("Same armature: "+t.name):((t.parent=this).armatures[t.name]=t,this.armatureNames.push(t.name))},n.prototype.getArmature=function(t){return t in this.armatures?this.armatures[t]:null},n.prototype.dispose=function(){console.warn("å·²åºŸå¼ƒ"),this.returnToPool()},n);function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.frameIndices=[],t.cachedFrames=[],t.armatureNames=[],t.armatures={},t.userData=null,t}t.DragonBonesData=i}(dragonBones=dragonBones||{}),function(e){var i,t=(i=e.BaseObject,__extends(n,i),n.toString=function(){return"[class dragonBones.ArmatureData]"},n.prototype._onClear=function(){for(var t=0,e=this.defaultActions;t<e.length;t++)e[t].returnToPool();for(var i,n=0,r=this.actions;n<r.length;n++)r[n].returnToPool();for(i in this.bones)this.bones[i].returnToPool(),delete this.bones[i];for(i in this.slots)this.slots[i].returnToPool(),delete this.slots[i];for(i in this.constraints)this.constraints[i].returnToPool(),delete this.constraints[i];for(i in this.skins)this.skins[i].returnToPool(),delete this.skins[i];for(i in this.animations)this.animations[i].returnToPool(),delete this.animations[i];null!==this.canvas&&this.canvas.returnToPool(),null!==this.userData&&this.userData.returnToPool(),this.type=0,this.frameRate=0,this.cacheFrameRate=0,this.scale=1,this.name="",this.aabb.clear(),this.animationNames.length=0,this.sortedBones.length=0,this.sortedSlots.length=0,this.defaultActions.length=0,this.actions.length=0,this.defaultSkin=null,this.defaultAnimation=null,this.canvas=null,this.userData=null,this.parent=null},n.prototype.sortBones=function(){var t=this.sortedBones.length;if(!(t<=0)){var e=this.sortedBones.concat(),i=0,n=0;for(this.sortedBones.length=0;n<t;){var r=e[i++];if(t<=i&&(i=0),!(0<=this.sortedBones.indexOf(r))){var s,o=!1;for(s in this.constraints){var a=this.constraints[s];if(a.bone===r&&this.sortedBones.indexOf(a.target)<0){o=!0;break}}o||null!==r.parent&&this.sortedBones.indexOf(r.parent)<0||(this.sortedBones.push(r),n++)}}}},n.prototype.cacheFrames=function(t){if(!(0<this.cacheFrameRate))for(var e in this.cacheFrameRate=t,this.animations)this.animations[e].cacheFrames(this.cacheFrameRate)},n.prototype.setCacheFrame=function(t,e){var i=this.parent.cachedFrames,n=i.length;return i.length+=10,i[n]=t.a,i[n+1]=t.b,i[n+2]=t.c,i[n+3]=t.d,i[n+4]=t.tx,i[n+5]=t.ty,i[n+6]=e.rotation,i[n+7]=e.skew,i[n+8]=e.scaleX,i[n+9]=e.scaleY,n},n.prototype.getCacheFrame=function(t,e,i){var n=this.parent.cachedFrames;t.a=n[i],t.b=n[i+1],t.c=n[i+2],t.d=n[i+3],t.tx=n[i+4],t.ty=n[i+5],e.rotation=n[i+6],e.skew=n[i+7],e.scaleX=n[i+8],e.scaleY=n[i+9],e.x=t.tx,e.y=t.ty},n.prototype.addBone=function(t){t.name in this.bones?console.warn("Same bone: "+t.name):(this.bones[t.name]=t,this.sortedBones.push(t))},n.prototype.addSlot=function(t){t.name in this.slots?console.warn("Same slot: "+t.name):(this.slots[t.name]=t,this.sortedSlots.push(t))},n.prototype.addConstraint=function(t){t.name in this.constraints?console.warn("Same constraint: "+t.name):this.constraints[t.name]=t},n.prototype.addSkin=function(t){t.name in this.skins?console.warn("Same skin: "+t.name):((t.parent=this).skins[t.name]=t,null===this.defaultSkin&&(this.defaultSkin=t),"default"===t.name&&(this.defaultSkin=t))},n.prototype.addAnimation=function(t){t.name in this.animations?console.warn("Same animation: "+t.name):((t.parent=this).animations[t.name]=t,this.animationNames.push(t.name),null===this.defaultAnimation&&(this.defaultAnimation=t))},n.prototype.addAction=function(t,e){(e?this.defaultActions:this.actions).push(t)},n.prototype.getBone=function(t){return t in this.bones?this.bones[t]:null},n.prototype.getSlot=function(t){return t in this.slots?this.slots[t]:null},n.prototype.getConstraint=function(t){return t in this.constraints?this.constraints[t]:null},n.prototype.getSkin=function(t){return t in this.skins?this.skins[t]:null},n.prototype.getAnimation=function(t){return t in this.animations?this.animations[t]:null},n);function n(){var t=null!==i&&i.apply(this,arguments)||this;return t.aabb=new e.Rectangle,t.animationNames=[],t.sortedBones=[],t.sortedSlots=[],t.defaultActions=[],t.actions=[],t.bones={},t.slots={},t.constraints={},t.skins={},t.animations={},t.canvas=null,t.userData=null,t}e.ArmatureData=t;var r,t=(r=e.BaseObject,__extends(s,r),s.toString=function(){return"[class dragonBones.BoneData]"},s.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.inheritReflection=!1,this.length=0,this.name="",this.transform.identity(),this.userData=null,this.parent=null},s);function s(){var t=null!==r&&r.apply(this,arguments)||this;return t.transform=new e.Transform,t.userData=null,t}e.BoneData=t;var o,t=(o=e.BaseObject,__extends(a,o),a.createColor=function(){return new e.ColorTransform},a.toString=function(){return"[class dragonBones.SlotData]"},a.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.blendMode=0,this.displayIndex=0,this.zOrder=0,this.name="",this.color=null,this.userData=null,this.parent=null},a.DEFAULT_COLOR=new e.ColorTransform,a);function a(){var t=null!==o&&o.apply(this,arguments)||this;return t.color=null,t.userData=null,t}e.SlotData=t}(dragonBones=dragonBones||{}),function(t){var e,i=(e=t.BaseObject,__extends(n,e),n.toString=function(){return"[class dragonBones.CanvasData]"},n.prototype._onClear=function(){this.hasBackground=!1,this.color=0,this.x=0,this.y=0,this.width=0,this.height=0},n);function n(){return null!==e&&e.apply(this,arguments)||this}t.CanvasData=i}(dragonBones=dragonBones||{}),function(t){var e,i=(e=t.BaseObject,__extends(n,e),n.toString=function(){return"[class dragonBones.SkinData]"},n.prototype._onClear=function(){for(var t in this.displays){for(var e=0,i=this.displays[t];e<i.length;e++){var n=i[e];null!==n&&n.returnToPool()}delete this.displays[t]}this.name="",this.parent=null},n.prototype.addDisplay=function(t,e){t in this.displays||(this.displays[t]=[]),null!==e&&(e.parent=this),this.displays[t].push(e)},n.prototype.getDisplay=function(t,e){t=this.getDisplays(t);if(null!==t)for(var i=0,n=t;i<n.length;i++){var r=n[i];if(null!==r&&r.name===e)return r}return null},n.prototype.getDisplays=function(t){return t in this.displays?this.displays[t]:null},n);function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.displays={},t}t.SkinData=i}(dragonBones=dragonBones||{}),function(t){var e,i=(e=t.BaseObject,__extends(n,e),n.prototype._onClear=function(){this.order=0,this.name="",this.target=null,this.bone=null,this.root=null},n);function n(){return null!==e&&e.apply(this,arguments)||this}t.ConstraintData=i;var r,i=(__extends(s,r=i),s.toString=function(){return"[class dragonBones.IKConstraintData]"},s.prototype._onClear=function(){r.prototype._onClear.call(this),this.scaleEnabled=!1,this.bendPositive=!1,this.weight=1},s);function s(){return null!==r&&r.apply(this,arguments)||this}t.IKConstraintData=i}(dragonBones=dragonBones||{}),function(e){var i,t=(i=e.BaseObject,__extends(n,i),n.prototype._onClear=function(){this.name="",this.path="",this.transform.identity(),this.parent=null},n);function n(){var t=null!==i&&i.apply(this,arguments)||this;return t.transform=new e.Transform,t}e.DisplayData=t;var r,s=(__extends(o,r=t),o.toString=function(){return"[class dragonBones.ImageDisplayData]"},o.prototype._onClear=function(){r.prototype._onClear.call(this),this.type=0,this.pivot.clear(),this.texture=null},o);function o(){var t=null!==r&&r.apply(this,arguments)||this;return t.pivot=new e.Point,t}e.ImageDisplayData=s;var a,l=(__extends(p,a=t),p.toString=function(){return"[class dragonBones.ArmatureDisplayData]"},p.prototype._onClear=function(){a.prototype._onClear.call(this);for(var t=0,e=this.actions;t<e.length;t++)e[t].returnToPool();this.type=1,this.inheritAnimation=!1,this.actions.length=0,this.armature=null},p.prototype.addAction=function(t){this.actions.push(t)},p);function p(){var t=null!==a&&a.apply(this,arguments)||this;return t.actions=[],t}e.ArmatureDisplayData=l;var h,s=(__extends(u,h=s),u.toString=function(){return"[class dragonBones.MeshDisplayData]"},u.prototype._onClear=function(){h.prototype._onClear.call(this),null!==this.weight&&this.weight.returnToPool(),this.type=2,this.inheritAnimation=!1,this.offset=0,this.weight=null},u);function u(){var t=null!==h&&h.apply(this,arguments)||this;return t.weight=null,t}e.MeshDisplayData=s;var c,t=(__extends(d,c=t),d.toString=function(){return"[class dragonBones.BoundingBoxDisplayData]"},d.prototype._onClear=function(){c.prototype._onClear.call(this),null!==this.boundingBox&&this.boundingBox.returnToPool(),this.type=3,this.boundingBox=null},d);function d(){var t=null!==c&&c.apply(this,arguments)||this;return t.boundingBox=null,t}e.BoundingBoxDisplayData=t;var _,t=(_=e.BaseObject,__extends(y,_),y.toString=function(){return"[class dragonBones.WeightData]"},y.prototype._onClear=function(){this.count=0,this.offset=0,this.bones.length=0},y.prototype.addBone=function(t){this.bones.push(t)},y);function y(){var t=null!==_&&_.apply(this,arguments)||this;return t.bones=[],t}e.WeightData=t}(dragonBones=dragonBones||{}),function(t){var e,i=(e=t.BaseObject,__extends(n,e),n.prototype._onClear=function(){this.color=0,this.width=0,this.height=0},n);function n(){return null!==e&&e.apply(this,arguments)||this}t.BoundingBoxData=i;var r,l=(__extends(g,r=i),g.toString=function(){return"[class dragonBones.RectangleBoundingBoxData]"},g._computeOutCode=function(t,e,i,n,r,s){var o=0;return t<i?o|=1:r<t&&(o|=2),e<n?o|=4:s<e&&(o|=8),o},g.rectangleIntersectsSegment=function(t,e,i,n,r,s,o,a,l,p,h){void 0===l&&(l=null),void 0===p&&(p=null),void 0===h&&(h=null);var u=r<t&&t<o&&s<e&&e<a,c=r<i&&i<o&&s<n&&n<a;if(u&&c)return-1;for(var d=0,_=g._computeOutCode(t,e,r,s,o,a),y=g._computeOutCode(i,n,r,s,o,a);;){if(0==(_|y)){d=2;break}if(0!=(_&y))break;var f=0,m=0,x=0,v=0!==_?_:y;0!=(4&v)?(f=t+(i-t)*(s-e)/(n-e),m=s,null!==h&&(x=.5*-Math.PI)):0!=(8&v)?(f=t+(i-t)*(a-e)/(n-e),m=a,null!==h&&(x=.5*Math.PI)):0!=(2&v)?(m=e+(n-e)*(o-t)/(i-t),f=o,null!==h&&(x=0)):0!=(1&v)&&(m=e+(n-e)*(r-t)/(i-t),f=r,null!==h&&(x=Math.PI)),v===_?(_=g._computeOutCode(t=f,e=m,r,s,o,a),null!==h&&(h.x=x)):(y=g._computeOutCode(i=f,n=m,r,s,o,a),null!==h&&(h.y=x))}return d&&(u?(d=2,null!==l&&(l.x=i,l.y=n),null!==p&&(p.x=i,p.y=i),null!==h&&(h.x=h.y+Math.PI)):c?(d=1,null!==l&&(l.x=t,l.y=e),null!==p&&(p.x=t,p.y=e),null!==h&&(h.y=h.x+Math.PI)):(d=3,null!==l&&(l.x=t,l.y=e),null!==p&&(p.x=i,p.y=n))),d},g.prototype._onClear=function(){r.prototype._onClear.call(this),this.type=0},g.prototype.containsPoint=function(t,e){var i=.5*this.width;if(-i<=t&&t<=i){i=.5*this.height;if(-i<=e&&e<=i)return!0}return!1},g.prototype.intersectsSegment=function(t,e,i,n,r,s,o){void 0===r&&(r=null),void 0===s&&(s=null),void 0===o&&(o=null);var a=.5*this.width,l=.5*this.height;return g.rectangleIntersectsSegment(t,e,i,n,-a,-l,a,l,r,s,o)},g);function g(){return null!==r&&r.apply(this,arguments)||this}t.RectangleBoundingBoxData=l;var s,o=(__extends(a,s=i),a.toString=function(){return"[class dragonBones.EllipseData]"},a.ellipseIntersectsSegment=function(t,e,i,n,r,s,o,a,l,p,h){void 0===l&&(l=null),void 0===p&&(p=null),void 0===h&&(h=null);var u=o/a,c=u*u,d=i-t,_=(n*=u)-(e*=u),y=Math.sqrt(d*d+_*_),f=d/y,m=_/y,a=(r-t)*f+(s-e)*m,d=o*o,_=d-(t*t+e*e)+a*a,r=0;if(0<=_){s=Math.sqrt(_),o=a-s,_=a+s,a=o<0?-1:o<=y?0:1,s=_<0?-1:_<=y?0:1,y=a*s;if(y<0)return-1;0==y&&(-1==a?(r=2,i=t+_*f,n=(e+_*m)/u,null!==l&&(l.x=i,l.y=n),null!==p&&(p.x=i,p.y=n),null!==h&&(h.x=Math.atan2(n/d*c,i/d),h.y=h.x+Math.PI)):1==s?(r=1,t+=o*f,e=(e+o*m)/u,null!==l&&(l.x=t,l.y=e),null!==p&&(p.x=t,p.y=e),null!==h&&(h.x=Math.atan2(e/d*c,t/d),h.y=h.x+Math.PI)):(r=3,null!==l&&(l.x=t+o*f,l.y=(e+o*m)/u,null!==h&&(h.x=Math.atan2(l.y/d*c,l.x/d))),null!==p&&(p.x=t+_*f,p.y=(e+_*m)/u,null!==h&&(h.y=Math.atan2(p.y/d*c,p.x/d)))))}return r},a.prototype._onClear=function(){s.prototype._onClear.call(this),this.type=1},a.prototype.containsPoint=function(t,e){var i=.5*this.width;if(-i<=t&&t<=i){var n=.5*this.height;if(-n<=e&&e<=n)return e*=i/n,Math.sqrt(t*t+e*e)<=i}return!1},a.prototype.intersectsSegment=function(t,e,i,n,r,s,o){return void 0===r&&(r=null),void 0===s&&(s=null),void 0===o&&(o=null),a.ellipseIntersectsSegment(t,e,i,n,0,0,.5*this.width,.5*this.height,r,s,o)},a);function a(){return null!==s&&s.apply(this,arguments)||this}t.EllipseBoundingBoxData=o;var p,i=(__extends(h,p=i),h.toString=function(){return"[class dragonBones.PolygonBoundingBoxData]"},h.polygonIntersectsSegment=function(t,e,i,n,r,s,o,a){void 0===s&&(s=null),void 0===o&&(o=null),void 0===a&&(a=null),t===i&&(t=i+1e-6),e===n&&(e=n+1e-6);for(var l=r.length,p=t-i,h=e-n,u=t*n-e*i,c=0,d=r[l-2],_=r[l-1],y=0,f=0,m=0,x=0,v=0,g=0,b=0;b<l;b+=2){var z=r[b],w=r[b+1];d===z&&(d=z+1e-4),_===w&&(_=w+1e-4);var C=d-z,P=_-w,T=d*w-_*z,S=p*P-h*C,C=(u*C-p*T)/S;if((d<=C&&C<=z||z<=C&&C<=d)&&(0==p||t<=C&&C<=i||i<=C&&C<=t)){T=(u*P-h*T)/S;if((_<=T&&T<=w||w<=T&&T<=_)&&(0==h||e<=T&&T<=n||n<=T&&T<=e)){if(null===o){v=m=C,g=x=T,c++,null!==a&&(a.x=Math.atan2(w-_,z-d)-.5*Math.PI,a.y=a.x);break}S=C-t;S<0&&(S=-S),0===c?(f=y=S,v=m=C,g=x=T,null!==a&&(a.x=Math.atan2(w-_,z-d)-.5*Math.PI,a.y=a.x)):(S<y&&(y=S,m=C,x=T,null!==a&&(a.x=Math.atan2(w-_,z-d)-.5*Math.PI)),f<S&&(f=S,v=C,g=T,null!==a&&(a.y=Math.atan2(w-_,z-d)-.5*Math.PI))),c++}}d=z,_=w}return 1===c?(null!==s&&(s.x=m,s.y=x),null!==o&&(o.x=m,o.y=x),null!==a&&(a.y=a.x+Math.PI)):1<c&&(c++,null!==s&&(s.x=m,s.y=x),null!==o&&(o.x=v,o.y=g)),c},h.prototype._onClear=function(){p.prototype._onClear.call(this),null!==this.weight&&this.weight.returnToPool(),this.type=2,this.x=0,this.y=0,this.vertices.length=0,this.weight=null},h.prototype.containsPoint=function(t,e){var i=!1;if(t>=this.x&&t<=this.width&&e>=this.y&&e<=this.height)for(var n=0,r=this.vertices.length,s=r-2;n<r;n+=2){var o,a=this.vertices[s+1],l=this.vertices[n+1];!(l<e&&e<=a||a<e&&e<=l)||(e-l)*(this.vertices[s]-(o=this.vertices[n]))/(a-l)+o<t&&(i=!i),s=n}return i},h.prototype.intersectsSegment=function(t,e,i,n,r,s,o){void 0===r&&(r=null),void 0===s&&(s=null),void 0===o&&(o=null);var a=0;return 0!==l.rectangleIntersectsSegment(t,e,i,n,this.x,this.y,this.width,this.height,null,null,null)&&(a=h.polygonIntersectsSegment(t,e,i,n,this.vertices,r,s,o)),a},h);function h(){var t=null!==p&&p.apply(this,arguments)||this;return t.vertices=[],t.weight=null,t}t.PolygonBoundingBoxData=i}(dragonBones=dragonBones||{}),function(t){var e,i=(e=t.BaseObject,__extends(n,e),n.toString=function(){return"[class dragonBones.AnimationData]"},n.prototype._onClear=function(){for(var t in this.boneTimelines){for(var e=0,i=this.boneTimelines[t];e<i.length;e++)i[e].returnToPool();delete this.boneTimelines[t]}for(var t in this.slotTimelines){for(var n=0,r=this.slotTimelines[t];n<r.length;n++)r[n].returnToPool();delete this.slotTimelines[t]}for(var t in this.constraintTimelines){for(var s=0,o=this.constraintTimelines[t];s<o.length;s++)o[s].returnToPool();delete this.constraintTimelines[t]}for(var t in this.boneCachedFrameIndices)delete this.boneCachedFrameIndices[t];for(var t in this.slotCachedFrameIndices)delete this.slotCachedFrameIndices[t];null!==this.actionTimeline&&this.actionTimeline.returnToPool(),null!==this.zOrderTimeline&&this.zOrderTimeline.returnToPool(),this.frameIntOffset=0,this.frameFloatOffset=0,this.frameOffset=0,this.frameCount=0,this.playTimes=0,this.duration=0,this.scale=1,this.fadeInTime=0,this.cacheFrameRate=0,this.name="",this.cachedFrames.length=0,this.actionTimeline=null,this.zOrderTimeline=null,this.parent=null},n.prototype.cacheFrames=function(t){if(!(0<this.cacheFrameRate)){this.cacheFrameRate=Math.max(Math.ceil(t*this.scale),1);var e=Math.ceil(this.cacheFrameRate*this.duration)+1;this.cachedFrames.length=e;for(var i=0,n=this.cacheFrames.length;i<n;++i)this.cachedFrames[i]=!1;for(var r=0,s=this.parent.sortedBones;r<s.length;r++){for(var o=s[r],i=0,n=(p=new Array(e)).length;i<n;++i)p[i]=-1;this.boneCachedFrameIndices[o.name]=p}for(var a=0,l=this.parent.sortedSlots;a<l.length;a++){for(var p,h=l[a],i=0,n=(p=new Array(e)).length;i<n;++i)p[i]=-1;this.slotCachedFrameIndices[h.name]=p}}},n.prototype.addBoneTimeline=function(t,e){t=t.name in this.boneTimelines?this.boneTimelines[t.name]:this.boneTimelines[t.name]=[];t.indexOf(e)<0&&t.push(e)},n.prototype.addSlotTimeline=function(t,e){t=t.name in this.slotTimelines?this.slotTimelines[t.name]:this.slotTimelines[t.name]=[];t.indexOf(e)<0&&t.push(e)},n.prototype.addConstraintTimeline=function(t,e){t=t.name in this.constraintTimelines?this.constraintTimelines[t.name]:this.constraintTimelines[t.name]=[];t.indexOf(e)<0&&t.push(e)},n.prototype.getBoneTimelines=function(t){return t in this.boneTimelines?this.boneTimelines[t]:null},n.prototype.getSlotTimelines=function(t){return t in this.slotTimelines?this.slotTimelines[t]:null},n.prototype.getConstraintTimelines=function(t){return t in this.constraintTimelines?this.constraintTimelines[t]:null},n.prototype.getBoneCachedFrameIndices=function(t){return t in this.boneCachedFrameIndices?this.boneCachedFrameIndices[t]:null},n.prototype.getSlotCachedFrameIndices=function(t){return t in this.slotCachedFrameIndices?this.slotCachedFrameIndices[t]:null},n);function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.cachedFrames=[],t.boneTimelines={},t.slotTimelines={},t.constraintTimelines={},t.boneCachedFrameIndices={},t.slotCachedFrameIndices={},t.actionTimeline=null,t.zOrderTimeline=null,t}t.AnimationData=i;var r,i=(r=t.BaseObject,__extends(s,r),s.toString=function(){return"[class dragonBones.TimelineData]"},s.prototype._onClear=function(){this.type=10,this.offset=0,this.frameIndicesOffset=-1},s);function s(){return null!==r&&r.apply(this,arguments)||this}t.TimelineData=i}(dragonBones=dragonBones||{}),function(t){var e,i=(e=t.BaseObject,__extends(n,e),n.toString=function(){return"[class dragonBones.AnimationConfig]"},n.prototype._onClear=function(){this.pauseFadeOut=!0,this.fadeOutMode=4,this.fadeOutTweenType=1,this.fadeOutTime=-1,this.actionEnabled=!0,this.additiveBlending=!1,this.displayControl=!0,this.pauseFadeIn=!0,this.resetToPose=!0,this.fadeInTweenType=1,this.playTimes=-1,this.layer=0,this.position=0,this.duration=-1,this.timeScale=-100,this.weight=1,this.fadeInTime=-1,this.autoFadeOutTime=-1,this.name="",this.animation="",this.group="",this.boneMask.length=0},n.prototype.clear=function(){this._onClear()},n.prototype.copyFrom=function(t){this.pauseFadeOut=t.pauseFadeOut,this.fadeOutMode=t.fadeOutMode,this.autoFadeOutTime=t.autoFadeOutTime,this.fadeOutTweenType=t.fadeOutTweenType,this.actionEnabled=t.actionEnabled,this.additiveBlending=t.additiveBlending,this.displayControl=t.displayControl,this.pauseFadeIn=t.pauseFadeIn,this.resetToPose=t.resetToPose,this.playTimes=t.playTimes,this.layer=t.layer,this.position=t.position,this.duration=t.duration,this.timeScale=t.timeScale,this.fadeInTime=t.fadeInTime,this.fadeOutTime=t.fadeOutTime,this.fadeInTweenType=t.fadeInTweenType,this.weight=t.weight,this.name=t.name,this.animation=t.animation,this.group=t.group,this.boneMask.length=t.boneMask.length;for(var e=0,i=this.boneMask.length;e<i;++e)this.boneMask[e]=t.boneMask[e]},n.prototype.containsBoneMask=function(t){return 0===this.boneMask.length||0<=this.boneMask.indexOf(t)},n.prototype.addBoneMask=function(t,e,i){void 0===i&&(i=!0);var n=t.getBone(e);if(null!==n&&(this.boneMask.indexOf(e)<0&&this.boneMask.push(e),i))for(var r=0,s=t.getBones();r<s.length;r++){var o=s[r];this.boneMask.indexOf(o.name)<0&&n.contains(o)&&this.boneMask.push(o.name)}},n.prototype.removeBoneMask=function(t,e,i){void 0===i&&(i=!0);var n=this.boneMask.indexOf(e);if(0<=n&&this.boneMask.splice(n,1),i){var r=t.getBone(e);if(null!==r)if(0<this.boneMask.length)for(var s=0,o=t.getBones();s<o.length;s++){var a=o[s],l=this.boneMask.indexOf(a.name);0<=l&&r.contains(a)&&this.boneMask.splice(l,1)}else for(var p=0,h=t.getBones();p<h.length;p++)(a=h[p])!==r&&(r.contains(a)||this.boneMask.push(a.name))}},n);function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.boneMask=[],t}t.AnimationConfig=i}(dragonBones=dragonBones||{}),function(e){var i,t=(i=e.BaseObject,__extends(n,i),n.prototype._onClear=function(){for(var t in this.textures)this.textures[t].returnToPool(),delete this.textures[t];this.autoSearch=!1,this.width=0,this.height=0,this.scale=1,this.name="",this.imagePath=""},n.prototype.copyFrom=function(t){for(var e in this.autoSearch=t.autoSearch,this.scale=t.scale,this.width=t.width,this.height=t.height,this.name=t.name,this.imagePath=t.imagePath,this.textures)this.textures[e].returnToPool(),delete this.textures[e];for(var e in t.textures){var i=this.createTexture();i.copyFrom(t.textures[e]),this.textures[e]=i}},n.prototype.addTexture=function(t){t.name in this.textures?console.warn("Same texture: "+t.name):(t.parent=this).textures[t.name]=t},n.prototype.getTexture=function(t){return t in this.textures?this.textures[t]:null},n);function n(){var t=null!==i&&i.apply(this,arguments)||this;return t.textures={},t}e.TextureAtlasData=t;var r,t=(r=e.BaseObject,__extends(s,r),s.createRectangle=function(){return new e.Rectangle},s.prototype._onClear=function(){this.rotated=!1,this.name="",this.region.clear(),this.parent=null,this.frame=null},s.prototype.copyFrom=function(t){this.rotated=t.rotated,this.name=t.name,this.region.copyFrom(t.region),this.parent=t.parent,null===this.frame&&null!==t.frame?this.frame=s.createRectangle():null!==this.frame&&null===t.frame&&(this.frame=null),null!==this.frame&&null!==t.frame&&this.frame.copyFrom(t.frame)},s);function s(){var t=null!==r&&r.apply(this,arguments)||this;return t.region=new e.Rectangle,t.frame=null,t}e.TextureData=t}(dragonBones=dragonBones||{}),function(r){var e,t=(e=r.BaseObject,__extends(i,e),i.toString=function(){return"[class dragonBones.Armature]"},i._onSortSlots=function(t,e){return t._zOrder>e._zOrder?1:-1},i.prototype._onClear=function(){null!==this._clock&&this._clock.remove(this);for(var t=0,e=this._bones;t<e.length;t++)e[t].returnToPool();for(var i=0,n=this._slots;i<n.length;i++)n[i].returnToPool();for(var r=0,s=this._constraints;r<s.length;r++)s[r].returnToPool();null!==this._animation&&this._animation.returnToPool(),null!==this._proxy&&this._proxy.dbClear(),null!==this._replaceTextureAtlasData&&this._replaceTextureAtlasData.returnToPool(),this.inheritAnimation=!0,this.userData=null,this._lockUpdate=!1,this._bonesDirty=!1,this._slotsDirty=!1,this._zOrderDirty=!1,this._flipX=!1,this._flipY=!1,this._cacheFrameIndex=-1,this._bones.length=0,this._slots.length=0,this._constraints.length=0,this._actions.length=0,this._armatureData=null,this._animation=null,this._proxy=null,this._display=null,this._replaceTextureAtlasData=null,this._replacedTexture=null,this._dragonBones=null,this._clock=null,this._parent=null},i.prototype._sortBones=function(){var t=this._bones.length;if(!(t<=0)){var e=this._bones.concat(),i=0,n=0;for(this._bones.length=0;n<t;){var r=e[i++];if(t<=i&&(i=0),!(0<=this._bones.indexOf(r))){if(r._hasConstraint){for(var s=!1,o=0,a=this._constraints;o<a.length;o++){var l=a[o];if(l._bone===r&&this._bones.indexOf(l._target)<0){s=!0;break}}if(s)continue}null!==r.parent&&this._bones.indexOf(r.parent)<0||(this._bones.push(r),n++)}}}},i.prototype._sortSlots=function(){this._slots.sort(i._onSortSlots)},i.prototype._sortZOrder=function(t,e){var i=this._armatureData.sortedSlots,n=null===t;if(this._zOrderDirty||!n){for(var r=0,s=i.length;r<s;++r){var o=n?r:t[e+r];o<0||s<=o||(o=i[o],null!==(o=this.getSlot(o.name))&&o._setZorder(r))}this._slotsDirty=!0,this._zOrderDirty=!n}},i.prototype._addBoneToBoneList=function(t){this._bones.indexOf(t)<0&&(this._bonesDirty=!0,this._bones.push(t))},i.prototype._removeBoneFromBoneList=function(t){t=this._bones.indexOf(t);0<=t&&this._bones.splice(t,1)},i.prototype._addSlotToSlotList=function(t){this._slots.indexOf(t)<0&&(this._slotsDirty=!0,this._slots.push(t))},i.prototype._removeSlotFromSlotList=function(t){t=this._slots.indexOf(t);0<=t&&this._slots.splice(t,1)},i.prototype._bufferAction=function(t,e){this._actions.indexOf(t)<0&&(e?this._actions.push(t):this._actions.unshift(t))},i.prototype.dispose=function(){null!==this._armatureData&&(this._lockUpdate=!0,this._dragonBones.bufferObject(this))},i.prototype.init=function(t,e,i,n){null===this._armatureData&&(this._armatureData=t,this._animation=r.BaseObject.borrowObject(r.Animation),this._proxy=e,this._display=i,this._dragonBones=n,this._proxy.dbInit(this),this._animation.init(this),this._animation.animations=this._armatureData.animations)},i.prototype.advanceTime=function(t){if(!this._lockUpdate)if(null!==this._armatureData)if(null!==this._armatureData.parent){var e=this._cacheFrameIndex;if(this._animation.advanceTime(t),this._bonesDirty&&(this._bonesDirty=!1,this._sortBones()),this._slotsDirty&&(this._slotsDirty=!1,this._sortSlots()),this._cacheFrameIndex<0||this._cacheFrameIndex!==e){for(var i=0,n=0,i=0,n=this._bones.length;i<n;++i)this._bones[i].update(this._cacheFrameIndex);for(i=0,n=this._slots.length;i<n;++i)this._slots[i].update(this._cacheFrameIndex)}if(0<this._actions.length){this._lockUpdate=!0;for(var r=0,s=this._actions;r<s.length;r++){var o=s[r];0===o.type&&this._animation.fadeIn(o.name)}this._actions.length=0,this._lockUpdate=!1}this._proxy.dbUpdate()}else console.warn("The armature data has been disposed.\nPlease make sure dispose armature before call factory.clear().");else console.warn("The armature has been disposed.")},i.prototype.invalidUpdate=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=!1),null!==t&&0<t.length){var i=this.getBone(t);if(null!==i&&(i.invalidUpdate(),e))for(var n=0,r=this._slots;n<r.length;n++)(a=r[n]).parent===i&&a.invalidUpdate()}else{for(var s=0,o=this._bones;s<o.length;s++)(i=o[s]).invalidUpdate();if(e)for(var a,l=0,p=this._slots;l<p.length;l++)(a=p[l]).invalidUpdate()}},i.prototype.containsPoint=function(t,e){for(var i=0,n=this._slots;i<n.length;i++){var r=n[i];if(r.containsPoint(t,e))return r}return null},i.prototype.intersectsSegment=function(t,e,i,n,r,s,o){void 0===r&&(r=null),void 0===s&&(s=null),void 0===o&&(o=null);for(var a=t===i,l=0,p=0,h=0,u=0,c=0,d=0,_=0,y=0,f=null,m=null,x=0,v=this._slots;x<v.length;x++){var g,b=v[x];if(0<b.intersectsSegment(t,e,i,n,r,s,o)){if(null===r&&null===s){f=b;break}null!==r&&((g=a?r.y-e:r.x-t)<0&&(g=-g),(null===f||g<l)&&(l=g,h=r.x,u=r.y,f=b,o&&(_=o.x))),null!==s&&((g=s.x-t)<0&&(g=-g),(null===m||p<g)&&(p=g,c=s.x,d=s.y,m=b,null!==o&&(y=o.y)))}}return null!==f&&null!==r&&(r.x=h,r.y=u,null!==o&&(o.x=_)),null!==m&&null!==s&&(s.x=c,s.y=d,null!==o&&(o.y=y)),f},i.prototype.getBone=function(t){for(var e=0,i=this._bones;e<i.length;e++){var n=i[e];if(n.name===t)return n}return null},i.prototype.getBoneByDisplay=function(t){t=this.getSlotByDisplay(t);return null!==t?t.parent:null},i.prototype.getSlot=function(t){for(var e=0,i=this._slots;e<i.length;e++){var n=i[e];if(n.name===t)return n}return null},i.prototype.getSlotByDisplay=function(t){if(null!==t)for(var e=0,i=this._slots;e<i.length;e++){var n=i[e];if(n.display===t)return n}return null},i.prototype.addBone=function(t,e){console.assert(null!==t),t._setArmature(this),t._setParent(0<e.length?this.getBone(e):null)},i.prototype.addSlot=function(t,e){e=this.getBone(e);console.assert(null!==t&&null!==e),t._setArmature(this),t._setParent(e)},i.prototype.addConstraint=function(t){this._constraints.indexOf(t)<0&&this._constraints.push(t)},i.prototype.removeBone=function(t){console.assert(null!==t&&t.armature===this),t._setParent(null),t._setArmature(null)},i.prototype.removeSlot=function(t){console.assert(null!==t&&t.armature===this),t._setParent(null),t._setArmature(null)},i.prototype.getBones=function(){return this._bones},i.prototype.getSlots=function(){return this._slots},Object.defineProperty(i.prototype,"flipX",{get:function(){return this._flipX},set:function(t){this._flipX!==t&&(this._flipX=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"flipY",{get:function(){return this._flipY},set:function(t){this._flipY!==t&&(this._flipY=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cacheFrameRate",{get:function(){return this._armatureData.cacheFrameRate},set:function(t){if(this._armatureData.cacheFrameRate!==t){this._armatureData.cacheFrames(t);for(var e=0,i=this._slots;e<i.length;e++){var n=i[e].childArmature;null!==n&&(n.cacheFrameRate=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._armatureData.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"armatureData",{get:function(){return this._armatureData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"proxy",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"eventDispatcher",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"display",{get:function(){return this._display},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"replacedTexture",{get:function(){return this._replacedTexture},set:function(t){if(this._replacedTexture!==t){null!==this._replaceTextureAtlasData&&(this._replaceTextureAtlasData.returnToPool(),this._replaceTextureAtlasData=null),this._replacedTexture=t;for(var e=0,i=this._slots;e<i.length;e++){var n=i[e];n.invalidUpdate(),n.update(-1)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clock",{get:function(){return this._clock},set:function(t){if(this._clock!==t){null!==this._clock&&this._clock.remove(this),this._clock=t,this._clock&&this._clock.add(this);for(var e=0,i=this._slots;e<i.length;e++){var n=i[e].childArmature;null!==n&&(n.clock=this._clock)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),i.prototype.replaceTexture=function(t){this.replacedTexture=t},i.prototype.hasEventListener=function(t){return this._proxy.hasDBEventListener(t)},i.prototype.addEventListener=function(t,e,i){this._proxy.addDBEventListener(t,e,i)},i.prototype.removeEventListener=function(t,e,i){this._proxy.removeDBEventListener(t,e,i)},i.prototype.enableAnimationCache=function(t){this.cacheFrameRate=t},i.prototype.getDisplay=function(){return this._display},i);function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._bones=[],t._slots=[],t._constraints=[],t._actions=[],t._animation=null,t._proxy=null,t._replaceTextureAtlasData=null,t._clock=null,t}r.Armature=t}(dragonBones=dragonBones||{}),function(e){var i,t=(i=e.BaseObject,__extends(n,i),n.prototype._onClear=function(){this.globalTransformMatrix.identity(),this.global.identity(),this.offset.identity(),this.origin=null,this.userData=null,this._globalDirty=!1,this._armature=null,this._parent=null},n.prototype._setArmature=function(t){this._armature=t},n.prototype._setParent=function(t){this._parent=t},n.prototype.updateGlobalTransform=function(){this._globalDirty&&(this._globalDirty=!1,this.global.fromMatrix(this.globalTransformMatrix))},Object.defineProperty(n.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),n._helpMatrix=new e.Matrix,n._helpTransform=new e.Transform,n._helpPoint=new e.Point,n);function n(){var t=null!==i&&i.apply(this,arguments)||this;return t.globalTransformMatrix=new e.Matrix,t.global=new e.Transform,t.offset=new e.Transform,t}e.TransformObject=t}(dragonBones=dragonBones||{}),function(l){var e,t=(e=l.TransformObject,__extends(i,e),i.toString=function(){return"[class dragonBones.Bone]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.offsetMode=1,this.animationPose.identity(),this._transformDirty=!1,this._childrenTransformDirty=!1,this._blendDirty=!1,this._localDirty=!0,this._hasConstraint=!1,this._visible=!0,this._cachedFrameIndex=-1,this._blendLayer=0,this._blendLeftWeight=1,this._blendLayerWeight=0,this._boneData=null,this._cachedFrameIndices=null},i.prototype._updateGlobalTransformMatrix=function(t){var e,i=this._armature.flipX,n=this._armature.flipY===l.DragonBones.yDown,r=null!==this._parent,s=0,o=this.global,a=this.globalTransformMatrix;1===this.offsetMode?(o.x=this.origin.x+this.offset.x+this.animationPose.x,o.y=this.origin.y+this.offset.y+this.animationPose.y,o.skew=this.origin.skew+this.offset.skew+this.animationPose.skew,o.rotation=this.origin.rotation+this.offset.rotation+this.animationPose.rotation,o.scaleX=this.origin.scaleX*this.offset.scaleX*this.animationPose.scaleX,o.scaleY=this.origin.scaleY*this.offset.scaleY*this.animationPose.scaleY):0===this.offsetMode?o.copyFrom(this.origin).add(this.animationPose):(r=!1,o.copyFrom(this.offset)),r?(e=this._parent.globalTransformMatrix,this._boneData.inheritScale?(this._boneData.inheritRotation||(this._parent.updateGlobalTransform(),s=i&&n?o.rotation-(this._parent.global.rotation+Math.PI):i?o.rotation+this._parent.global.rotation+Math.PI:n?o.rotation+this._parent.global.rotation:o.rotation-this._parent.global.rotation,o.rotation=s),o.toMatrix(a),a.concat(e),this._boneData.inheritTranslation?(o.x=a.tx,o.y=a.ty):(a.tx=o.x,a.ty=o.y),t?o.fromMatrix(a):this._globalDirty=!0):(this._boneData.inheritTranslation?(r=o.x,t=o.y,o.x=e.a*r+e.c*t+e.tx,o.y=e.d*t+e.b*r+e.ty):(i&&(o.x=-o.x),n&&(o.y=-o.y)),this._boneData.inheritRotation?(this._parent.updateGlobalTransform(),s=this._parent.global.scaleX<0?o.rotation+this._parent.global.rotation+Math.PI:o.rotation+this._parent.global.rotation,e.a*e.d-e.b*e.c<0&&(s-=2*o.rotation,i===n&&!this._boneData.inheritReflection||(o.skew+=Math.PI)),o.rotation=s):(i||n)&&(i&&n?s=o.rotation+Math.PI:(s=i?Math.PI-o.rotation:-o.rotation,o.skew+=Math.PI),o.rotation=s),o.toMatrix(a))):((i||n)&&(i&&(o.x=-o.x),n&&(o.y=-o.y),i&&n?s=o.rotation+Math.PI:(s=i?Math.PI-o.rotation:-o.rotation,o.skew+=Math.PI),o.rotation=s),o.toMatrix(a))},i.prototype._setArmature=function(t){if(this._armature!==t){var e=null,i=null;if(null!==this._armature&&(e=this.getSlots(),i=this.getBones(),this._armature._removeBoneFromBoneList(this)),this._armature=t,null!==this._armature&&this._armature._addBoneToBoneList(this),null!==e)for(var n=0,r=e;n<r.length;n++){var s=r[n];s.parent===this&&s._setArmature(this._armature)}if(null!==i)for(var o=0,a=i;o<a.length;o++){var l=a[o];l.parent===this&&l._setArmature(this._armature)}}},i.prototype.init=function(t){null===this._boneData&&(this._boneData=t,this.origin=this._boneData.transform)},i.prototype.update=function(t){if(this._blendDirty=!1,0<=t&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];if(0<=e&&this._cachedFrameIndex===e)this._transformDirty=!1;else if(0<=e)this._transformDirty=!0,this._cachedFrameIndex=e;else{if(this._hasConstraint)for(var i=0,n=this._armature._constraints;i<n.length;i++)(r=n[i])._bone===this&&r.update();!(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&0<=this._cachedFrameIndex?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var r,s=0,o=this._armature._constraints;s<o.length;s++)(r=o[s])._bone===this&&r.update();(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}this._transformDirty?(this._transformDirty=!1,this._childrenTransformDirty=!0,this._cachedFrameIndex<0?(e=0<=t,this._localDirty&&this._updateGlobalTransformMatrix(e),e&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))):this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex)):this._childrenTransformDirty&&(this._childrenTransformDirty=!1),this._localDirty=!0},i.prototype.updateByConstraint=function(){this._localDirty&&(this._localDirty=!1,(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&this._updateGlobalTransformMatrix(!0),this._transformDirty=!0)},i.prototype.invalidUpdate=function(){this._transformDirty=!0},i.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.parent;return e===this},Object.defineProperty(i.prototype,"boneData",{get:function(){return this._boneData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return this._visible},set:function(t){if(this._visible!==t){this._visible=t;for(var e=0,i=this._armature.getSlots();e<i.length;e++){var n=i[e];n._parent===this&&n._updateVisible()}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._boneData.name},enumerable:!0,configurable:!0}),i.prototype.getBones=function(){for(var t=new Array,e=0,i=this._armature.getBones();e<i.length;e++){var n=i[e];n.parent===this&&t.push(n)}return t},i.prototype.getSlots=function(){for(var t=new Array,e=0,i=this._armature.getSlots();e<i.length;e++){var n=i[e];n.parent===this&&t.push(n)}return t},Object.defineProperty(i.prototype,"slot",{get:function(){for(var t=0,e=this._armature.getSlots();t<e.length;t++){var i=e[t];if(i.parent===this)return i}return null},enumerable:!0,configurable:!0}),i);function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.animationPose=new l.Transform,t}l.Bone=t}(dragonBones=dragonBones||{}),function(l){var o,t=(o=l.TransformObject,__extends(h,o),h.prototype._onClear=function(){o.prototype._onClear.call(this);for(var t=[],e=0,i=this._displayList;e<i.length;e++)null!==(n=i[e])&&n!==this._rawDisplay&&n!==this._meshDisplay&&t.indexOf(n)<0&&t.push(n);for(var n,r=0,s=t;r<s.length;r++)(n=s[r])instanceof l.Armature?n.dispose():this._disposeDisplay(n);null!==this._meshDisplay&&this._meshDisplay!==this._rawDisplay&&this._disposeDisplay(this._meshDisplay),null!==this._rawDisplay&&this._disposeDisplay(this._rawDisplay),this.displayController=null,this._displayDirty=!1,this._zOrderDirty=!1,this._blendModeDirty=!1,this._colorDirty=!1,this._meshDirty=!1,this._transformDirty=!1,this._visible=!0,this._blendMode=0,this._displayIndex=-1,this._animationDisplayIndex=-1,this._zOrder=0,this._cachedFrameIndex=-1,this._pivotX=0,this._pivotY=0,this._localMatrix.identity(),this._colorTransform.identity(),this._ffdVertices.length=0,this._displayList.length=0,this._displayDatas.length=0,this._meshBones.length=0,this._slotData=null,this._rawDisplayDatas=null,this._displayData=null,this._textureData=null,this._meshData=null,this._boundingBoxData=null,this._rawDisplay=null,this._meshDisplay=null,this._display=null,this._childArmature=null,this._cachedFrameIndices=null},h.prototype._updateDisplayData=function(){var t,e,i,n,r=this._displayData,s=this._textureData,o=this._meshData,a=0<=this._displayIndex&&null!==this._rawDisplayDatas&&this._displayIndex<this._rawDisplayDatas.length?this._rawDisplayDatas[this._displayIndex]:null;if(0<=this._displayIndex&&this._displayIndex<this._displayDatas.length?this._displayData=this._displayDatas[this._displayIndex]:this._displayData=null,null!==this._displayData&&(0===this._displayData.type||2===this._displayData.type)?(this._textureData=this._displayData.texture,2===this._displayData.type?this._meshData=this._displayData:null!==a&&2===a.type?this._meshData=a:this._meshData=null):(this._textureData=null,this._meshData=null),null!==this._displayData&&3===this._displayData.type?this._boundingBoxData=this._displayData.boundingBox:null!==a&&3===a.type?this._boundingBoxData=a.boundingBox:this._boundingBoxData=null,this._displayData!==r||this._textureData!==s||this._meshData!==o){if(null===this._meshData&&null!==this._textureData?(n=this._displayData,t=this._textureData.parent.scale*this._armature._armatureData.scale,e=this._textureData.frame,this._pivotX=n.pivot.x,this._pivotY=n.pivot.y,r=(i=null!==e?e:this._textureData.region).width,n=i.height,this._textureData.rotated&&null===e&&(r=i.height,n=i.width),this._pivotX*=r*t,this._pivotY*=n*t,null!==e&&(this._pivotX+=e.x*t,this._pivotY+=e.y*t)):(this._pivotX=0,this._pivotY=0),this._meshData!==o)if(null!==this._meshData){if(null!==this._meshData.weight){this._ffdVertices.length=2*this._meshData.weight.count,this._meshBones.length=this._meshData.weight.bones.length;for(var l=0,p=this._meshBones.length;l<p;++l)this._meshBones[l]=this._armature.getBone(this._meshData.weight.bones[l].name)}else{o=this._meshData.parent.parent.parent.intArray[this._meshData.offset+0];this._ffdVertices.length=2*o,this._meshBones.length=0}for(l=0,p=this._ffdVertices.length;l<p;++l)this._ffdVertices[l]=0;this._meshDirty=!0}else this._ffdVertices.length=0,this._meshBones.length=0;else null!==this._meshData&&this._textureData!==s&&(this._meshDirty=!0);null!==this._displayData&&null!==a&&this._displayData!==a&&null===this._meshData&&(a.transform.toMatrix(h._helpMatrix),h._helpMatrix.invert(),h._helpMatrix.transformPoint(0,0,h._helpPoint),this._pivotX-=h._helpPoint.x,this._pivotY-=h._helpPoint.y,this._displayData.transform.toMatrix(h._helpMatrix),h._helpMatrix.invert(),h._helpMatrix.transformPoint(0,0,h._helpPoint),this._pivotX+=h._helpPoint.x,this._pivotY+=h._helpPoint.y),null!==a?this.origin=a.transform:null!==this._displayData&&(this.origin=this._displayData.transform),this._displayDirty=!0,this._transformDirty=!0}},h.prototype._updateDisplay=function(){var t=null!==this._display?this._display:this._rawDisplay,e=this._childArmature;0<=this._displayIndex&&this._displayIndex<this._displayList.length?(this._display=this._displayList[this._displayIndex],null!==this._display&&this._display instanceof l.Armature?(this._childArmature=this._display,this._display=this._childArmature.display):this._childArmature=null):(this._display=null,this._childArmature=null);var i=null!==this._display?this._display:this._rawDisplay;if(i!==t&&(this._onUpdateDisplay(),this._replaceDisplay(t),this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0),i!==this._rawDisplay&&i!==this._meshDisplay||this._updateFrame(),this._childArmature!==e&&(null!==e&&(e._parent=null,e.clock=null,e.inheritAnimation&&e.animation.reset()),null!==this._childArmature&&((this._childArmature._parent=this)._childArmature.clock=this._armature.clock,this._childArmature.inheritAnimation))){0!==this._childArmature.cacheFrameRate||0!==(n=this._armature.cacheFrameRate)&&(this._childArmature.cacheFrameRate=n);var n,e=null;if(null!==this._displayData&&1===this._displayData.type?e=this._displayData.actions:null!==(n=0<=this._displayIndex&&null!==this._rawDisplayDatas&&this._displayIndex<this._rawDisplayDatas.length?this._rawDisplayDatas[this._displayIndex]:null)&&1===n.type&&(e=n.actions),null!==e&&0<e.length)for(var r=0,s=e;r<s.length;r++){var o=s[r];this._childArmature._bufferAction(o,!1)}else this._childArmature.animation.play()}},h.prototype._updateGlobalTransformMatrix=function(t){this.globalTransformMatrix.copyFrom(this._localMatrix),this.globalTransformMatrix.concat(this._parent.globalTransformMatrix),t?this.global.fromMatrix(this.globalTransformMatrix):this._globalDirty=!0},h.prototype._isMeshBonesUpdate=function(){for(var t=0,e=this._meshBones;t<e.length;t++){var i=e[t];if(null!==i&&i._childrenTransformDirty)return!0}return!1},h.prototype._setArmature=function(t){this._armature!==t&&(null!==this._armature&&this._armature._removeSlotFromSlotList(this),this._armature=t,this._onUpdateDisplay(),null!==this._armature?(this._armature._addSlotToSlotList(this),this._addDisplay()):this._removeDisplay())},h.prototype._setDisplayIndex=function(t,e){if(void 0===e&&(e=!1),e){if(this._animationDisplayIndex===t)return!1;this._animationDisplayIndex=t}return this._displayIndex!==t&&(this._displayIndex=t,this._displayDirty=!0,this._updateDisplayData(),this._displayDirty)},h.prototype._setZorder=function(t){return this._zOrder,this._zOrder=t,this._zOrderDirty=!0,this._zOrderDirty},h.prototype._setColor=function(t){return this._colorTransform.copyFrom(t),this._colorDirty=!0,this._colorDirty},h.prototype._setDisplayList=function(t){if(null!==t&&0<t.length){this._displayList.length!==t.length&&(this._displayList.length=t.length);for(var e=0,i=t.length;e<i;++e){var n=t[e];null!==n&&n!==this._rawDisplay&&n!==this._meshDisplay&&!(n instanceof l.Armature)&&this._displayList.indexOf(n)<0&&this._initDisplay(n),this._displayList[e]=n}}else 0<this._displayList.length&&(this._displayList.length=0);return 0<=this._displayIndex&&this._displayIndex<this._displayList.length?this._displayDirty=this._display!==this._displayList[this._displayIndex]:this._displayDirty=null!==this._display,this._updateDisplayData(),this._displayDirty},h.prototype.init=function(t,e,i,n){null===this._slotData&&(this._slotData=t,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0,this._blendMode=this._slotData.blendMode,this._zOrder=this._slotData.zOrder,this._colorTransform.copyFrom(this._slotData.color),this._rawDisplay=i,this._meshDisplay=n,this.rawDisplayDatas=e)},h.prototype.update=function(t){var e;if(this._displayDirty&&(this._displayDirty=!1,this._updateDisplay(),this._transformDirty&&(null!==this.origin?this.global.copyFrom(this.origin).add(this.offset):this.global.copyFrom(this.offset)).toMatrix(this._localMatrix)),this._zOrderDirty&&(this._zOrderDirty=!1,this._updateZOrder()),0<=t&&null!==this._cachedFrameIndices?0<=(e=this._cachedFrameIndices[t])&&this._cachedFrameIndex===e?this._transformDirty=!1:0<=e?(this._transformDirty=!0,this._cachedFrameIndex=e):!this._transformDirty&&!this._parent._childrenTransformDirty&&0<=this._cachedFrameIndex?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1):(this._transformDirty||this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1),null!==this._display){if(this._visibleDirty&&(this._visibleDirty=!1,this._updateVisible()),this._blendModeDirty&&(this._blendModeDirty=!1,this._updateBlendMode()),this._colorDirty&&(this._colorDirty=!1,this._updateColor()),null!==this._meshData&&this._display===this._meshDisplay){var i=null!==this._meshData.weight;if((this._meshDirty||i&&this._isMeshBonesUpdate())&&(this._meshDirty=!1,this._updateMesh()),i)return void(this._transformDirty&&(this._transformDirty=!1,this._updateTransform(!0)))}this._transformDirty&&(this._transformDirty=!1,this._cachedFrameIndex<0?(i=0<=t,this._updateGlobalTransformMatrix(i),i&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))):this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex),this._updateTransform(!1))}},h.prototype.updateTransformAndMatrix=function(){this._transformDirty&&(this._transformDirty=!1,this._updateGlobalTransformMatrix(!1))},h.prototype.replaceDisplayData=function(t,e){if(void 0===e&&(e=-1),e<0&&(e=this._displayIndex<0?0:this._displayIndex),this._displayDatas.length<=e){this._displayDatas.length=e+1;for(var i=0,n=this._displayDatas.length;i<n;++i)this._displayDatas[i]||(this._displayDatas[i]=null)}this._displayDatas[e]=t},h.prototype.containsPoint=function(t,e){return null!==this._boundingBoxData&&(this.updateTransformAndMatrix(),h._helpMatrix.copyFrom(this.globalTransformMatrix),h._helpMatrix.invert(),h._helpMatrix.transformPoint(t,e,h._helpPoint),this._boundingBoxData.containsPoint(h._helpPoint.x,h._helpPoint.y))},h.prototype.intersectsSegment=function(t,e,i,n,r,s,o){if(void 0===r&&(r=null),void 0===s&&(s=null),void 0===o&&(o=null),null===this._boundingBoxData)return 0;this.updateTransformAndMatrix(),h._helpMatrix.copyFrom(this.globalTransformMatrix),h._helpMatrix.invert(),h._helpMatrix.transformPoint(t,e,h._helpPoint),t=h._helpPoint.x,e=h._helpPoint.y,h._helpMatrix.transformPoint(i,n,h._helpPoint),i=h._helpPoint.x,n=h._helpPoint.y;n=this._boundingBoxData.intersectsSegment(t,e,i,n,r,s,o);return 0<n&&(1===n||2===n?null!==r?(this.globalTransformMatrix.transformPoint(r.x,r.y,r),null!==s&&(s.x=r.x,s.y=r.y)):null!==s&&this.globalTransformMatrix.transformPoint(s.x,s.y,s):(null!==r&&this.globalTransformMatrix.transformPoint(r.x,r.y,r),null!==s&&this.globalTransformMatrix.transformPoint(s.x,s.y,s)),null!==o&&(this.globalTransformMatrix.transformPoint(Math.cos(o.x),Math.sin(o.x),h._helpPoint,!0),o.x=Math.atan2(h._helpPoint.y,h._helpPoint.x),this.globalTransformMatrix.transformPoint(Math.cos(o.y),Math.sin(o.y),h._helpPoint,!0),o.y=Math.atan2(h._helpPoint.y,h._helpPoint.x))),n},h.prototype.invalidUpdate=function(){this._displayDirty=!0,this._transformDirty=!0},Object.defineProperty(h.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible!==t&&(this._visible=t,this._updateVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"displayIndex",{get:function(){return this._displayIndex},set:function(t){this._setDisplayIndex(t)&&this.update(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"name",{get:function(){return this._slotData.name},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"displayList",{get:function(){return this._displayList.concat()},set:function(t){var e=this._displayList.concat(),i=new Array;this._setDisplayList(t)&&this.update(-1);for(var n=0,r=e;n<r.length;n++)null!==(s=r[n])&&s!==this._rawDisplay&&s!==this._meshDisplay&&this._displayList.indexOf(s)<0&&i.indexOf(s)<0&&i.push(s);for(var s,o=0,a=i;o<a.length;o++)(s=a[o])instanceof l.Armature?s.dispose():this._disposeDisplay(s)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"slotData",{get:function(){return this._slotData},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"rawDisplayDatas",{get:function(){return this._rawDisplayDatas},set:function(t){if(this._rawDisplayDatas!==t)if(this._displayDirty=!0,this._rawDisplayDatas=t,this._rawDisplayDatas){this._displayDatas.length=this._rawDisplayDatas.length;for(var e=0,i=this._displayDatas.length;e<i;++e)this._displayDatas[e]=this._rawDisplayDatas[e]}else this._displayDatas.length=0},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"boundingBoxData",{get:function(){return this._boundingBoxData},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"rawDisplay",{get:function(){return this._rawDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"meshDisplay",{get:function(){return this._meshDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"display",{get:function(){return this._display},set:function(t){var e,i;this._display!==t&&(e=this._displayList.length,this._displayIndex<0&&0===e&&(this._displayIndex=0),this._displayIndex<0||(i=this.displayList,e<=this._displayIndex&&(i.length=this._displayIndex+1),i[this._displayIndex]=t,this.displayList=i))},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"childArmature",{get:function(){return this._childArmature},set:function(t){this._childArmature!==t&&(this.display=t)},enumerable:!0,configurable:!0}),h.prototype.getDisplay=function(){return this.display},h.prototype.setDisplay=function(t){this.display=t},h);function h(){var t=null!==o&&o.apply(this,arguments)||this;return t._localMatrix=new l.Matrix,t._colorTransform=new l.ColorTransform,t._ffdVertices=[],t._displayDatas=[],t._displayList=[],t._meshBones=[],t._rawDisplay=null,t._meshDisplay=null,t}l.Slot=t}(dragonBones=dragonBones||{}),function(m){var t,e=(t=m.BaseObject,__extends(i,t),i.prototype._onClear=function(){this._armature=null,this._target=null,this._bone=null,this._root=null},Object.defineProperty(i.prototype,"name",{get:function(){return this._constraintData.name},enumerable:!0,configurable:!0}),i._helpMatrix=new m.Matrix,i._helpTransform=new m.Transform,i._helpPoint=new m.Point,i);function i(){return null!==t&&t.apply(this,arguments)||this}m.Constraint=e;var n,e=(__extends(r,n=e),r.toString=function(){return"[class dragonBones.IKConstraint]"},r.prototype._onClear=function(){n.prototype._onClear.call(this),this._scaleEnabled=!1,this._bendPositive=!1,this._weight=1,this._constraintData=null},r.prototype._computeA=function(){var t=this._target.global,e=this._bone.global,i=this._bone.globalTransformMatrix,t=Math.atan2(t.y-e.y,t.x-e.x);e.scaleX<0&&(t+=Math.PI),e.rotation+=(t-e.rotation)*this._weight,e.toMatrix(i)},r.prototype._computeB=function(){var t=this._bone._boneData.length,e=this._root,i=this._target.global,n=e.global,r=this._bone.global,s=this._bone.globalTransformMatrix,o=s.a*t,a=s.b*t,l=o*o+a*a,p=Math.sqrt(l),h=r.x-n.x,u=r.y-n.y,c=h*h+u*u,d=Math.sqrt(c),_=r.rotation,y=n.rotation,f=Math.atan2(u,h),t=(h=i.x-n.x)*h+(u=i.y-n.y)*u,o=Math.sqrt(t),a=0;p+d<=o||o+p<=d||o+d<=p?(a=Math.atan2(i.y-n.y,i.x-n.x),p+d<=o||d<p&&(a+=Math.PI)):(l=(c-l+t)/(2*t),c=Math.sqrt(c-l*l*t)/o,t=n.x+h*l,o=n.y+u*l,l=-u*c,u=h*c,h=!1,null!==e._parent&&(h=(c=e._parent.globalTransformMatrix).a*c.d-c.b*c.c<0),h!==this._bendPositive?(r.x=t-l,r.y=o-u):(r.x=t+l,r.y=o+u),a=Math.atan2(r.y-n.y,r.x-n.x));a=m.Transform.normalizeRadian(a-f);n.rotation=y+a*this._weight,n.toMatrix(e.globalTransformMatrix);f+=a*this._weight;r.x=n.x+Math.cos(f)*d,r.y=n.y+Math.sin(f)*d;i=Math.atan2(i.y-r.y,i.x-r.x);r.scaleX<0&&(i+=Math.PI),r.rotation=n.rotation+_-y+m.Transform.normalizeRadian(i-a-_)*this._weight,r.toMatrix(s)},r.prototype.init=function(t,e){null===this._constraintData&&(this._constraintData=t,this._armature=e,this._target=this._armature.getBone(this._constraintData.target.name),this._bone=this._armature.getBone(this._constraintData.bone.name),this._root=null!==this._constraintData.root?this._armature.getBone(this._constraintData.root.name):null,e=this._constraintData,this._scaleEnabled=e.scaleEnabled,this._bendPositive=e.bendPositive,this._weight=e.weight,this._bone._hasConstraint=!0)},r.prototype.update=function(){null===this._root?(this._bone.updateByConstraint(),this._computeA()):(this._root.updateByConstraint(),this._bone.updateByConstraint(),this._computeB())},r.prototype.invalidUpdate=function(){null===this._root||this._root.invalidUpdate(),this._bone.invalidUpdate()},r);function r(){return null!==n&&n.apply(this,arguments)||this}m.IKConstraint=e}(dragonBones=dragonBones||{}),function(t){var e=(i.prototype.advanceTime=function(t){if(t!=t&&(t=0),t<0&&(t=.001*(new Date).getTime()-this.time),1!==this.timeScale&&(t*=this.timeScale),t<0?this.time-=t:this.time+=t,0!==t){for(var e=0,i=0,n=this._animatebles.length;e<n;++e){var r=this._animatebles[e];null!==r?(0<i&&(this._animatebles[e-i]=r,this._animatebles[e]=null),r.advanceTime(t)):i++}if(0<i){for(n=this._animatebles.length;e<n;++e){var s=this._animatebles[e];null!==s?this._animatebles[e-i]=s:i++}this._animatebles.length-=i}}},i.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.clock;return e===this},i.prototype.add=function(t){this._animatebles.indexOf(t)<0&&(this._animatebles.push(t),t.clock=this)},i.prototype.remove=function(t){var e=this._animatebles.indexOf(t);0<=e&&(this._animatebles[e]=null,t.clock=null)},i.prototype.clear=function(){for(var t=0,e=this._animatebles;t<e.length;t++){var i=e[t];null!==i&&(i.clock=null)}},Object.defineProperty(i.prototype,"clock",{get:function(){return this._clock},set:function(t){this._clock!==t&&(null!==this._clock&&this._clock.remove(this),this._clock=t,null!==this._clock&&this._clock.add(this))},enumerable:!0,configurable:!0}),i.clock=new i,i);function i(t){void 0===t&&(t=-1),this.time=0,this.timeScale=1,this._animatebles=[],this._clock=null,this.time=t<0?.001*(new Date).getTime():t}t.WorldClock=e}(dragonBones=dragonBones||{}),function(d){var e,t=(e=d.BaseObject,__extends(i,e),i.toString=function(){return"[class dragonBones.Animation]"},i.prototype._onClear=function(){for(var t,e=0,i=this._animationStates;e<i.length;e++)i[e].returnToPool();for(t in this._animations)delete this._animations[t];null!==this._animationConfig&&this._animationConfig.returnToPool(),this.timeScale=1,this._animationDirty=!1,this._inheritTimeScale=1,this._animationNames.length=0,this._animationStates.length=0,this._armature=null,this._animationConfig=null,this._lastAnimationState=null},i.prototype._fadeOut=function(t){switch(t.fadeOutMode){case 1:for(var e=0,i=this._animationStates;e<i.length;e++)(a=i[e]).layer===t.layer&&a.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 2:for(var n=0,r=this._animationStates;n<r.length;n++)(a=r[n]).group===t.group&&a.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 3:for(var s=0,o=this._animationStates;s<o.length;s++)(a=o[s]).layer===t.layer&&a.group===t.group&&a.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 4:for(var a,l=0,p=this._animationStates;l<p.length;l++)(a=p[l]).fadeOut(t.fadeOutTime,t.pauseFadeOut)}},i.prototype.init=function(t){null===this._armature&&(this._armature=t,this._animationConfig=d.BaseObject.borrowObject(d.AnimationConfig))},i.prototype.advanceTime=function(t){t<0&&(t=-t),this._armature.inheritAnimation&&null!==this._armature._parent?this._inheritTimeScale=this._armature._parent._armature.animation._inheritTimeScale*this.timeScale:this._inheritTimeScale=this.timeScale,1!==this._inheritTimeScale&&(t*=this._inheritTimeScale);var e=this._animationStates.length;if(1===e)if(0<(h=this._animationStates[0])._fadeState&&0<h._subFadeState)this._armature._dragonBones.bufferObject(h),this._animationStates.length=0,this._lastAnimationState=null;else{var i=h._animationData,n=i.cacheFrameRate;if(this._animationDirty&&0<n){this._animationDirty=!1;for(var r=0,s=this._armature.getBones();r<s.length;r++){var o=s[r];o._cachedFrameIndices=i.getBoneCachedFrameIndices(o.name)}for(var a=0,l=this._armature.getSlots();a<l.length;a++){var p=l[a];p._cachedFrameIndices=i.getSlotCachedFrameIndices(p.name)}}h.advanceTime(t,n)}else if(1<e){for(var h,u=0,c=0;u<e;++u)0<(h=this._animationStates[u])._fadeState&&0<h._subFadeState?(c++,this._armature._dragonBones.bufferObject(h),this._animationDirty=!0,this._lastAnimationState===h&&(this._lastAnimationState=null)):(0<c&&(this._animationStates[u-c]=h),h.advanceTime(t,0)),u===e-1&&0<c&&(this._animationStates.length-=c,null===this._lastAnimationState&&0<this._animationStates.length&&(this._lastAnimationState=this._animationStates[this._animationStates.length-1]));this._armature._cacheFrameIndex=-1}else this._armature._cacheFrameIndex=-1},i.prototype.reset=function(){for(var t=0,e=this._animationStates;t<e.length;t++)e[t].returnToPool();this._animationDirty=!1,this._animationConfig.clear(),this._animationStates.length=0,this._lastAnimationState=null},i.prototype.stop=function(t){if(void 0===t&&(t=null),null!==t)null!==(e=this.getState(t))&&e.stop();else for(var e,i=0,n=this._animationStates;i<n.length;i++)(e=n[i]).stop()},i.prototype.playConfig=function(t){var e=t.animation;if(!(e in this._animations))return console.warn("Non-existent animation.\n","DragonBones name: "+this._armature.armatureData.parent.name,"Armature name: "+this._armature.name,"Animation name: "+e),null;var i=this._animations[e];if(5===t.fadeOutMode)for(var n=0,r=this._animationStates;n<r.length;n++){var s=r[n];if(s._animationData===i)return s}0===this._animationStates.length?t.fadeInTime=0:t.fadeInTime<0&&(t.fadeInTime=i.fadeInTime),t.fadeOutTime<0&&(t.fadeOutTime=t.fadeInTime),t.timeScale<=-100&&(t.timeScale=1/i.scale),1<i.frameCount?(t.position<0?(t.position%=i.duration,t.position=i.duration-t.position):t.position===i.duration?t.position-=1e-6:t.position>i.duration&&(t.position%=i.duration),0<t.duration&&t.position+t.duration>i.duration&&(t.duration=i.duration-t.position),t.playTimes<0&&(t.playTimes=i.playTimes)):(t.playTimes=1,(t.position=0)<t.duration&&(t.duration=0)),0===t.duration&&(t.duration=-1),this._fadeOut(t);var o=d.BaseObject.borrowObject(d.AnimationState);if(o.init(this._armature,i,t),this._animationDirty=!0,this._armature._cacheFrameIndex=-1,0<this._animationStates.length){for(var a=!1,l=0,p=this._animationStates.length;l<p;++l)if(!(o.layer>=this._animationStates[l].layer)){a=!0,this._animationStates.splice(l+1,0,o);break}a||this._animationStates.push(o)}else this._animationStates.push(o);for(var h=0,u=this._armature.getSlots();h<u.length;h++){var c=u[h].childArmature;null!==c&&c.inheritAnimation&&c.animation.hasAnimation(e)&&null===c.animation.getState(e)&&c.animation.fadeIn(e)}return t.fadeInTime<=0&&this._armature.advanceTime(0),this._lastAnimationState=o},i.prototype.play=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=null!==t?t:"",null!==t&&0<t.length?this.playConfig(this._animationConfig):null===this._lastAnimationState?null!==(t=this._armature.armatureData.defaultAnimation)&&(this._animationConfig.animation=t.name,this.playConfig(this._animationConfig)):this._lastAnimationState.isPlaying||this._lastAnimationState.isCompleted?(this._animationConfig.animation=this._lastAnimationState.name,this.playConfig(this._animationConfig)):this._lastAnimationState.play(),this._lastAnimationState},i.prototype.fadeIn=function(t,e,i,n,r,s){return void 0===e&&(e=-1),void 0===i&&(i=-1),void 0===n&&(n=0),void 0===r&&(r=null),void 0===s&&(s=3),this._animationConfig.clear(),this._animationConfig.fadeOutMode=s,this._animationConfig.playTimes=i,this._animationConfig.layer=n,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==r?r:"",this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByTime=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.position=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t,this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByFrame=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0;t=(this._animationConfig.animation=t)in this._animations?this._animations[t]:null;return null!==t&&(this._animationConfig.position=t.duration*e/t.frameCount),this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByProgress=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0;t=(this._animationConfig.animation=t)in this._animations?this._animations[t]:null;return null!==t&&(this._animationConfig.position=t.duration*(0<e?e:0)),this.playConfig(this._animationConfig)},i.prototype.gotoAndStopByTime=function(t,e){void 0===e&&(e=0);e=this.gotoAndPlayByTime(t,e,1);return null!==e&&e.stop(),e},i.prototype.gotoAndStopByFrame=function(t,e){void 0===e&&(e=0);e=this.gotoAndPlayByFrame(t,e,1);return null!==e&&e.stop(),e},i.prototype.gotoAndStopByProgress=function(t,e){void 0===e&&(e=0);e=this.gotoAndPlayByProgress(t,e,1);return null!==e&&e.stop(),e},i.prototype.getState=function(t){for(var e=this._animationStates.length;e--;){var i=this._animationStates[e];if(i.name===t)return i}return null},i.prototype.hasAnimation=function(t){return t in this._animations},i.prototype.getStates=function(){return this._animationStates},Object.defineProperty(i.prototype,"isPlaying",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++)if(e[t].isPlaying)return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isCompleted",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++)if(!e[t].isCompleted)return!1;return 0<this._animationStates.length},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastAnimationName",{get:function(){return null!==this._lastAnimationState?this._lastAnimationState.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animations",{get:function(){return this._animations},set:function(t){if(this._animations!==t){for(var e in this._animationNames.length=0,this._animations)delete this._animations[e];for(var e in t)this._animationNames.push(e),this._animations[e]=t[e]}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationConfig",{get:function(){return this._animationConfig.clear(),this._animationConfig},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastAnimationState",{get:function(){return this._lastAnimationState},enumerable:!0,configurable:!0}),i.prototype.gotoAndPlay=function(t,e,i,n,r,s,o,a,l){void 0===e&&(e=-1),void 0===i&&(i=-1),void 0===n&&(n=-1),void 0===r&&(r=0),void 0===s&&(s=null),void 0===o&&(o=3),void 0===a&&(a=!0),void 0===l&&(l=!0),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.fadeOutMode=o,this._animationConfig.playTimes=n,this._animationConfig.layer=r,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==s?s:"";t=this._animations[t];return t&&0<i&&(this._animationConfig.timeScale=t.duration/i),this.playConfig(this._animationConfig)},i.prototype.gotoAndStop=function(t,e){return void 0===e&&(e=0),this.gotoAndStopByTime(t,e)},Object.defineProperty(i.prototype,"animationList",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationDataList",{get:function(){for(var t=[],e=0,i=this._animationNames.length;e<i;++e)t.push(this._animations[this._animationNames[e]]);return t},enumerable:!0,configurable:!0}),i);function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._animationNames=[],t._animationStates=[],t._animations={},t._animationConfig=null,t}d.Animation=t}(dragonBones=dragonBones||{}),function(X){var e,t=(e=X.BaseObject,__extends(i,e),i.toString=function(){return"[class dragonBones.AnimationState]"},i.prototype._onClear=function(){for(var t=0,e=this._boneTimelines;t<e.length;t++)e[t].returnToPool();for(var i=0,n=this._slotTimelines;i<n.length;i++)n[i].returnToPool();for(var r,s=0,o=this._constraintTimelines;s<o.length;s++)o[s].returnToPool();for(r in this._bonePoses)this._bonePoses[r].returnToPool(),delete this._bonePoses[r];null!==this._actionTimeline&&this._actionTimeline.returnToPool(),null!==this._zOrderTimeline&&this._zOrderTimeline.returnToPool(),this.actionEnabled=!1,this.additiveBlending=!1,this.displayControl=!1,this.resetToPose=!1,this.playTimes=1,this.layer=0,this.timeScale=1,this.weight=1,this.autoFadeOutTime=0,this.fadeTotalTime=0,this.name="",this.group="",this._timelineDirty=!0,this._playheadState=0,this._fadeState=-1,this._subFadeState=-1,this._position=0,this._duration=0,this._fadeTime=0,this._time=0,this._fadeProgress=0,this._weightResult=0,this._boneMask.length=0,this._boneTimelines.length=0,this._slotTimelines.length=0,this._constraintTimelines.length=0,this._poseTimelines.length=0,this._animationData=null,this._armature=null,this._actionTimeline=null,this._zOrderTimeline=null},i.prototype._updateTimelines=function(){for(var t={},e=0,i=this._boneTimelines;e<i.length;e++)(o=(d=i[e]).bone.name)in t||(t[o]=[]),t[o].push(d);for(var n=0,r=this._armature.getBones();n<r.length;n++){var s=r[n],o=s.name;if(this.containsBoneMask(o)){var a=this._animationData.getBoneTimelines(o);if(o in t)delete t[o];else{var l=o in this._bonePoses?this._bonePoses[o]:this._bonePoses[o]=X.BaseObject.borrowObject(V);if(null!==a)for(var p=0,h=a;p<h.length;p++)switch((F=h[p]).type){case 10:(d=X.BaseObject.borrowObject(X.BoneAllTimelineState)).bone=s,d.bonePose=l,d.init(this._armature,this,F),this._boneTimelines.push(d);break;case 11:(d=X.BaseObject.borrowObject(X.BoneTranslateTimelineState)).bone=s,d.bonePose=l,d.init(this._armature,this,F),this._boneTimelines.push(d);break;case 12:(d=X.BaseObject.borrowObject(X.BoneRotateTimelineState)).bone=s,d.bonePose=l,d.init(this._armature,this,F),this._boneTimelines.push(d);break;case 13:(d=X.BaseObject.borrowObject(X.BoneScaleTimelineState)).bone=s,d.bonePose=l,d.init(this._armature,this,F),this._boneTimelines.push(d)}else this.resetToPose&&((d=X.BaseObject.borrowObject(X.BoneAllTimelineState)).bone=s,d.bonePose=l,d.init(this._armature,this,null),this._boneTimelines.push(d),this._poseTimelines.push(d))}}}for(D in t)for(var u=0,c=t[D];u<c.length;u++){var d=c[u];this._boneTimelines.splice(this._boneTimelines.indexOf(d),1),d.returnToPool()}for(var _={},y=[],f=0,m=this._slotTimelines;f<m.length;f++)(o=(d=m[f]).slot.name)in _||(_[o]=[]),_[o].push(d);for(var x=0,v=this._armature.getSlots();x<v.length;x++){var g=v[x],b=g.parent.name;if(this.containsBoneMask(b)){o=g.name,a=this._animationData.getSlotTimelines(o);if(o in _)delete _[o];else{var z=!1,w=!1;if(y.length=0,null!==a)for(var C=0,P=a;C<P.length;C++)switch((F=P[C]).type){case 20:(d=X.BaseObject.borrowObject(X.SlotDislayTimelineState)).slot=g,d.init(this._armature,this,F),this._slotTimelines.push(d),z=!0;break;case 21:(d=X.BaseObject.borrowObject(X.SlotColorTimelineState)).slot=g,d.init(this._armature,this,F),this._slotTimelines.push(d),w=!0;break;case 22:(d=X.BaseObject.borrowObject(X.SlotFFDTimelineState)).slot=g,d.init(this._armature,this,F),this._slotTimelines.push(d),y.push(d.meshOffset)}if(this.resetToPose)if(z||((d=X.BaseObject.borrowObject(X.SlotDislayTimelineState)).slot=g,d.init(this._armature,this,null),this._slotTimelines.push(d),this._poseTimelines.push(d)),w||((d=X.BaseObject.borrowObject(X.SlotColorTimelineState)).slot=g,d.init(this._armature,this,null),this._slotTimelines.push(d),this._poseTimelines.push(d)),null!==g.rawDisplayDatas)for(var T=0,S=g.rawDisplayDatas;T<S.length;T++){var M=S[T];null!==M&&2===M.type&&(M=M.offset,y.indexOf(M)<0&&((d=X.BaseObject.borrowObject(X.SlotFFDTimelineState)).meshOffset=M,d.slot=g,d.init(this._armature,this,null),this._slotTimelines.push(d),this._poseTimelines.push(d)))}}}}for(D in _)for(var A=0,O=_[D];A<O.length;A++){d=O[A];this._slotTimelines.splice(this._slotTimelines.indexOf(d),1),d.returnToPool()}for(var k={},E=0,I=this._constraintTimelines;E<I.length;E++)(o=(d=I[E]).constraint.name)in k||(k[o]=[]),k[o].push(d);for(var D,B=0,L=this._armature._constraints;B<L.length;B++){var R=L[B],o=R.name,a=this._animationData.getConstraintTimelines(o);if(o in k)delete k[o];else if(null!==a)for(var F,j=0,N=a;j<N.length;j++)30===(F=N[j]).type&&((d=X.BaseObject.borrowObject(X.IKConstraintTimelineState)).constraint=R,d.init(this._armature,this,F),this._constraintTimelines.push(d));else this.resetToPose&&((d=X.BaseObject.borrowObject(X.IKConstraintTimelineState)).constraint=R,d.init(this._armature,this,null),this._constraintTimelines.push(d),this._poseTimelines.push(d))}for(D in k)for(var G=0,U=k[D];G<U.length;G++){d=U[G];this._constraintTimelines.splice(this._constraintTimelines.indexOf(d),1),d.returnToPool()}},i.prototype._advanceFadeTime=function(t){var e,i,n=0<this._fadeState;this._subFadeState<0&&(this._subFadeState=0,e=n?X.EventObject.FADE_OUT:X.EventObject.FADE_IN,this._armature.eventDispatcher.hasDBEventListener(e)&&((i=X.BaseObject.borrowObject(X.EventObject)).type=e,i.armature=this._armature,(i.animationState=this)._armature._dragonBones.bufferEvent(i))),t<0&&(t=-t),this._fadeTime+=t,this._fadeTime>=this.fadeTotalTime?(this._subFadeState=1,this._fadeProgress=n?0:1):0<this._fadeTime?this._fadeProgress=n?1-this._fadeTime/this.fadeTotalTime:this._fadeTime/this.fadeTotalTime:this._fadeProgress=n?1:0,0<this._subFadeState&&(n||(this._playheadState|=1,this._fadeState=0),e=n?X.EventObject.FADE_OUT_COMPLETE:X.EventObject.FADE_IN_COMPLETE,this._armature.eventDispatcher.hasDBEventListener(e)&&((i=X.BaseObject.borrowObject(X.EventObject)).type=e,i.armature=this._armature,(i.animationState=this)._armature._dragonBones.bufferEvent(i)))},i.prototype._blendBoneTimline=function(t){var e=0<this._weightResult?this._weightResult:-this._weightResult,i=t.bone,n=t.bonePose.result,t=i.animationPose;i._blendDirty?(e*=i._blendLeftWeight,i._blendLayerWeight+=e,t.x+=n.x*e,t.y+=n.y*e,t.rotation+=n.rotation*e,t.skew+=n.skew*e,t.scaleX+=(n.scaleX-1)*e,t.scaleY+=(n.scaleY-1)*e):(i._blendDirty=!0,i._blendLayer=this.layer,i._blendLayerWeight=e,i._blendLeftWeight=1,t.x=n.x*e,t.y=n.y*e,t.rotation=n.rotation*e,t.skew=n.skew*e,t.scaleX=(n.scaleX-1)*e+1,t.scaleY=(n.scaleY-1)*e+1),0===this._fadeState&&0===this._subFadeState||(i._transformDirty=!0)},i.prototype.init=function(t,e,i){if(null===this._armature){if(this._armature=t,this._animationData=e,this.resetToPose=i.resetToPose,this.additiveBlending=i.additiveBlending,this.displayControl=i.displayControl,this.actionEnabled=i.actionEnabled,this.layer=i.layer,this.playTimes=i.playTimes,this.timeScale=i.timeScale,this.fadeTotalTime=i.fadeInTime,this.autoFadeOutTime=i.autoFadeOutTime,this.weight=i.weight,this.name=0<i.name.length?i.name:i.animation,this.group=i.group,i.pauseFadeIn?this._playheadState=2:this._playheadState=3,i.duration<0?(this._position=0,this._duration=this._animationData.duration,0!==i.position?0<=this.timeScale?this._time=i.position:this._time=i.position-this._duration:this._time=0):(this._position=i.position,this._duration=i.duration,this._time=0),this.timeScale<0&&0===this._time&&(this._time=-1e-6),this.fadeTotalTime<=0&&(this._fadeProgress=.999999),0<i.boneMask.length){this._boneMask.length=i.boneMask.length;for(var n=0,r=this._boneMask.length;n<r;++n)this._boneMask[n]=i.boneMask[n]}this._actionTimeline=X.BaseObject.borrowObject(X.ActionTimelineState),this._actionTimeline.init(this._armature,this,this._animationData.actionTimeline),this._actionTimeline.currentTime=this._time,this._actionTimeline.currentTime<0&&(this._actionTimeline.currentTime=this._duration-this._actionTimeline.currentTime),null!==this._animationData.zOrderTimeline&&(this._zOrderTimeline=X.BaseObject.borrowObject(X.ZOrderTimelineState),this._zOrderTimeline.init(this._armature,this,this._animationData.zOrderTimeline))}},i.prototype.advanceTime=function(t,e){if(0===this._fadeState&&0===this._subFadeState||this._advanceFadeTime(t),3===this._playheadState&&(1!==this.timeScale&&(t*=this.timeScale),this._time+=t),this._timelineDirty&&(this._timelineDirty=!1,this._updateTimelines()),0!==this.weight){var i=0===this._fadeState&&0<e,n=!0,r=!0,s=this._time;if(this._weightResult=this.weight*this._fadeProgress,this._actionTimeline.playState<=0&&this._actionTimeline.update(s),i&&(t=2*e,this._actionTimeline.currentTime=Math.floor(this._actionTimeline.currentTime*t)/t),null!==this._zOrderTimeline&&this._zOrderTimeline.playState<=0&&this._zOrderTimeline.update(s),i&&(e=Math.floor(this._actionTimeline.currentTime*e),this._armature._cacheFrameIndex===e?r=n=!1:(this._armature._cacheFrameIndex=e,this._animationData.cachedFrames[e]?r=!1:this._animationData.cachedFrames[e]=!0)),n){if(r)for(var o=null,a=null,l=0,p=this._boneTimelines.length;l<p;++l)o!==(u=this._boneTimelines[l]).bone&&(null!==o&&(this._blendBoneTimline(a),o._blendDirty&&(0<o._blendLeftWeight?o._blendLayer!==this.layer&&(o._blendLayerWeight>=o._blendLeftWeight?(o._blendLeftWeight=0,o=null):(o._blendLayer=this.layer,o._blendLeftWeight-=o._blendLayerWeight,o._blendLayerWeight=0)):o=null)),o=u.bone),null!==o&&(u.playState<=0&&u.update(s),l===p-1?this._blendBoneTimline(u):a=u);if(this.displayControl)for(l=0,p=this._slotTimelines.length;l<p;++l){var h=(u=this._slotTimelines[l]).slot.displayController;null!==h&&h!==this.name&&h!==this.group||u.playState<=0&&u.update(s)}for(l=0,p=this._constraintTimelines.length;l<p;++l)(u=this._constraintTimelines[l]).playState<=0&&u.update(s)}if(0===this._fadeState){if(0<this._subFadeState&&(this._subFadeState=0)<this._poseTimelines.length){for(var u,c,d=0,_=this._poseTimelines;d<_.length;d++)(u=_[d])instanceof X.BoneTimelineState?(c=this._boneTimelines.indexOf(u),this._boneTimelines.splice(c,1)):u instanceof X.SlotTimelineState?(c=this._slotTimelines.indexOf(u),this._slotTimelines.splice(c,1)):u instanceof X.ConstraintTimelineState&&(c=this._constraintTimelines.indexOf(u),this._constraintTimelines.splice(c,1)),u.returnToPool();this._poseTimelines.length=0}0<this._actionTimeline.playState&&0<=this.autoFadeOutTime&&this.fadeOut(this.autoFadeOutTime)}}},i.prototype.play=function(){this._playheadState=3},i.prototype.stop=function(){this._playheadState&=1},i.prototype.fadeOut=function(t,e){if(void 0===e&&(e=!0),t<0&&(t=0),e&&(this._playheadState&=2),0<this._fadeState){if(t>this.fadeTotalTime-this._fadeTime)return}else{this._fadeState=1,this._subFadeState=-1,(t<=0||this._fadeProgress<=0)&&(this._fadeProgress=1e-6);for(var i=0,n=this._boneTimelines;i<n.length;i++)n[i].fadeOut();for(var r=0,s=this._slotTimelines;r<s.length;r++)s[r].fadeOut()}this.displayControl=!1,this.fadeTotalTime=1e-6<this._fadeProgress?t/this._fadeProgress:0,this._fadeTime=this.fadeTotalTime*(1-this._fadeProgress)},i.prototype.containsBoneMask=function(t){return 0===this._boneMask.length||0<=this._boneMask.indexOf(t)},i.prototype.addBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._armature.getBone(t);if(null!==i){if(this._boneMask.indexOf(t)<0&&this._boneMask.push(t),e)for(var n=0,r=this._armature.getBones();n<r.length;n++){var s=r[n];this._boneMask.indexOf(s.name)<0&&i.contains(s)&&this._boneMask.push(s.name)}this._timelineDirty=!0}},i.prototype.removeBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._boneMask.indexOf(t);if(0<=i&&this._boneMask.splice(i,1),e){var n=this._armature.getBone(t);if(null!==n){t=this._armature.getBones();if(0<this._boneMask.length)for(var r=0,s=t;r<s.length;r++){var o=s[r],a=this._boneMask.indexOf(o.name);0<=a&&n.contains(o)&&this._boneMask.splice(a,1)}else for(var l=0,p=t;l<p.length;l++)(o=p[l])!==n&&(n.contains(o)||this._boneMask.push(o.name))}}this._timelineDirty=!0},i.prototype.removeAllBoneMask=function(){this._boneMask.length=0,this._timelineDirty=!0},Object.defineProperty(i.prototype,"isFadeIn",{get:function(){return this._fadeState<0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isFadeOut",{get:function(){return 0<this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isFadeComplete",{get:function(){return 0===this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isPlaying",{get:function(){return 0!=(2&this._playheadState)&&this._actionTimeline.playState<=0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isCompleted",{get:function(){return 0<this._actionTimeline.playState},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentPlayTimes",{get:function(){return this._actionTimeline.currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"totalTime",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentTime",{get:function(){return this._actionTimeline.currentTime},set:function(t){var e=this._actionTimeline.currentPlayTimes-(0<this._actionTimeline.playState?1:0);if((t<0||this._duration<t)&&(t=t%this._duration+e*this._duration)<0&&(t+=this._duration),0<this.playTimes&&e==this.playTimes-1&&t===this._duration&&(t=this._duration-1e-6),this._time!==t){this._time=t,this._actionTimeline.setCurrentTime(this._time),null!==this._zOrderTimeline&&(this._zOrderTimeline.playState=-1);for(var i=0,n=this._boneTimelines;i<n.length;i++)n[i].playState=-1;for(var r=0,s=this._slotTimelines;r<s.length;r++)s[r].playState=-1}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationData",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),i);function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._boneMask=[],t._boneTimelines=[],t._slotTimelines=[],t._constraintTimelines=[],t._poseTimelines=[],t._bonePoses={},t._actionTimeline=null,t._zOrderTimeline=null,t}X.AnimationState=t;var n,V=(n=X.BaseObject,__extends(r,n),r.toString=function(){return"[class dragonBones.BonePose]"},r.prototype._onClear=function(){this.current.identity(),this.delta.identity(),this.result.identity()},r);function r(){var t=null!==n&&n.apply(this,arguments)||this;return t.current=new X.Transform,t.delta=new X.Transform,t.result=new X.Transform,t}X.BonePose=V}(dragonBones=dragonBones||{}),function(t){var e,i=(e=t.BaseObject,__extends(n,e),n.prototype._onClear=function(){this.playState=-1,this.currentPlayTimes=-1,this.currentTime=-1,this._tweenState=0,this._frameRate=0,this._frameValueOffset=0,this._frameCount=0,this._frameOffset=0,this._frameIndex=-1,this._frameRateR=0,this._position=0,this._duration=0,this._timeScale=1,this._timeOffset=0,this._dragonBonesData=null,this._animationData=null,this._timelineData=null,this._armature=null,this._animationState=null,this._actionTimeline=null,this._frameArray=null,this._frameIntArray=null,this._frameFloatArray=null,this._timelineArray=null,this._frameIndices=null},n.prototype._setCurrentTime=function(t){var e,i,n=this.playState,r=this.currentPlayTimes,s=this.currentTime;return null!==this._actionTimeline&&this._frameCount<=1?(this.playState=0<=this._actionTimeline.playState?1:-1,this.currentPlayTimes=1,this.currentTime=this._actionTimeline.currentTime):null===this._actionTimeline||1!==this._timeScale||0!==this._timeOffset?(i=(e=this._animationState.playTimes)*this._duration,t*=this._timeScale,0!==this._timeOffset&&(t+=this._timeOffset*this._animationData.duration),0<e&&(i<=t||t<=-i)?(this.playState<=0&&3===this._animationState._playheadState&&(this.playState=1),this.currentPlayTimes=e,this.currentTime=t<0?0:this._duration):(0!==this.playState&&3===this._animationState._playheadState&&(this.playState=0),t<0?(t=-t,this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=this._duration-t%this._duration):(this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=t%this._duration)),this.currentTime+=this._position):(this.playState=this._actionTimeline.playState,this.currentPlayTimes=this._actionTimeline.currentPlayTimes,this.currentTime=this._actionTimeline.currentTime),(this.currentPlayTimes!==r||this.currentTime!==s)&&((n<0&&this.playState!==n||this.playState<=0&&this.currentPlayTimes!==r)&&(this._frameIndex=-1),!0)},n.prototype.init=function(t,e,i){this._armature=t,this._animationState=e,this._timelineData=i,this._actionTimeline=this._animationState._actionTimeline,this===this._actionTimeline&&(this._actionTimeline=null),this._animationData=this._animationState._animationData,this._frameRate=this._animationData.parent.frameRate,this._frameRateR=1/this._frameRate,this._position=this._animationState._position,this._duration=this._animationState._duration,this._dragonBonesData=this._animationData.parent.parent,null!==this._timelineData&&(this._frameIntArray=this._dragonBonesData.frameIntArray,this._frameFloatArray=this._dragonBonesData.frameFloatArray,this._frameArray=this._dragonBonesData.frameArray,this._timelineArray=this._dragonBonesData.timelineArray,this._frameIndices=this._dragonBonesData.frameIndices,this._frameCount=this._timelineArray[this._timelineData.offset+2],this._frameValueOffset=this._timelineArray[this._timelineData.offset+4],this._timeScale=100/this._timelineArray[this._timelineData.offset+0],this._timeOffset=.01*this._timelineArray[this._timelineData.offset+1])},n.prototype.fadeOut=function(){},n.prototype.update=function(t){this._setCurrentTime(t)&&(1<this._frameCount?(t=Math.floor(this.currentTime*this._frameRate),t=this._frameIndices[this._timelineData.frameIndicesOffset+t],this._frameIndex!==t&&(this._frameIndex=t,this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex],this._onArriveAtFrame())):this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5]),this._onArriveAtFrame()),0!==this._tweenState&&this._onUpdateFrame())},n);function n(){return null!==e&&e.apply(this,arguments)||this}t.TimelineState=i;var r,s=(__extends(o,r=i),o._getEasingValue=function(t,e,i){var n=e;switch(t){case 3:n=Math.pow(e,2);break;case 4:n=1-Math.pow(1-e,2);break;case 5:n=.5*(1-Math.cos(e*Math.PI))}return(n-e)*i+e},o._getEasingCurveValue=function(t,e,i,n){if(t<=0)return 0;if(1<=t)return 1;var r=i+1,s=Math.floor(t*r),i=0===s?0:e[n+s-1];return 1e-4*(i+((s===r-1?1e4:e[n+s])-i)*(t*r-s))},o.prototype._onClear=function(){r.prototype._onClear.call(this),this._tweenType=0,this._curveCount=0,this._framePosition=0,this._frameDurationR=0,this._tweenProgress=0,this._tweenEasing=0},o.prototype._onArriveAtFrame=function(){var t;1<this._frameCount&&(this._frameIndex!==this._frameCount-1||0===this._animationState.playTimes||this._animationState.currentPlayTimes<this._animationState.playTimes-1)?(this._tweenType=this._frameArray[this._frameOffset+1],this._tweenState=0===this._tweenType?1:2,2===this._tweenType?this._curveCount=this._frameArray[this._frameOffset+2]:0!==this._tweenType&&1!==this._tweenType&&(this._tweenEasing=.01*this._frameArray[this._frameOffset+2]),this._framePosition=this._frameArray[this._frameOffset]*this._frameRateR,this._frameIndex===this._frameCount-1?this._frameDurationR=1/(this._animationData.duration-this._framePosition):(t=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex+1],t=this._frameArray[t]*this._frameRateR-this._framePosition,this._frameDurationR=0<t?1/t:0)):this._tweenState=1},o.prototype._onUpdateFrame=function(){2===this._tweenState?(this._tweenProgress=(this.currentTime-this._framePosition)*this._frameDurationR,2===this._tweenType?this._tweenProgress=o._getEasingCurveValue(this._tweenProgress,this._frameArray,this._curveCount,this._frameOffset+3):1!==this._tweenType&&(this._tweenProgress=o._getEasingValue(this._tweenType,this._tweenProgress,this._tweenEasing))):this._tweenProgress=0},o);function o(){return null!==r&&r.apply(this,arguments)||this}t.TweenTimelineState=s;var a,i=(__extends(l,a=s),l.prototype._onClear=function(){a.prototype._onClear.call(this),this.bone=null,this.bonePose=null},l);function l(){return null!==a&&a.apply(this,arguments)||this}t.BoneTimelineState=i;var p,i=(__extends(h,p=s),h.prototype._onClear=function(){p.prototype._onClear.call(this),this.slot=null},h);function h(){return null!==p&&p.apply(this,arguments)||this}t.SlotTimelineState=i;var u,s=(__extends(c,u=s),c.prototype._onClear=function(){u.prototype._onClear.call(this),this.constraint=null},c);function c(){return null!==u&&u.apply(this,arguments)||this}t.ConstraintTimelineState=s}(dragonBones=dragonBones||{}),function(d){var t,e=(t=d.TimelineState,__extends(i,t),i.toString=function(){return"[class dragonBones.ActionTimelineState]"},i.prototype._onCrossFrame=function(t){var e=this._armature.eventDispatcher;if(this._animationState.actionEnabled)for(var i=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+t],n=this._frameArray[i+1],r=this._animationData.parent.actions,s=0;s<n;++s){var o=r[this._frameArray[i+2+s]];if(0===o.type)if(null!==o.slot)null!==(a=this._armature.getSlot(o.slot.name))&&null!==(l=a.childArmature)&&l._bufferAction(o,!0);else if(null!==o.bone)for(var a,l,p=0,h=this._armature.getSlots();p<h.length;p++)null!==(l=(a=h[p]).childArmature)&&a.parent._boneData===o.bone&&l._bufferAction(o,!0);else this._armature._bufferAction(o,!0);else{var u,c=10===o.type?d.EventObject.FRAME_EVENT:d.EventObject.SOUND_EVENT;11!==o.type&&!e.hasDBEventListener(c)||((u=d.BaseObject.borrowObject(d.EventObject)).time=this._frameArray[i]/this._frameRate,u.type=c,u.name=o.name,u.data=o.data,u.armature=this._armature,u.animationState=this._animationState,null!==o.bone&&(u.bone=this._armature.getBone(o.bone.name)),null!==o.slot&&(u.slot=this._armature.getSlot(o.slot.name)),this._armature._dragonBones.bufferEvent(u))}}},i.prototype._onArriveAtFrame=function(){},i.prototype._onUpdateFrame=function(){},i.prototype.update=function(t){var e=this.playState,i=this.currentPlayTimes,n=this.currentTime;if(this._setCurrentTime(t)){t=this._armature.eventDispatcher;if(e<0){if(this.playState===e)return;this._animationState.displayControl&&this._animationState.resetToPose&&this._armature._sortZOrder(null,0),i=this.currentPlayTimes,t.hasDBEventListener(d.EventObject.START)&&((s=d.BaseObject.borrowObject(d.EventObject)).type=d.EventObject.START,s.armature=this._armature,s.animationState=this._animationState,this._armature._dragonBones.bufferEvent(s))}var e=this._animationState.timeScale<0,r=null,s=null;if(this.currentPlayTimes!==i&&(t.hasDBEventListener(d.EventObject.LOOP_COMPLETE)&&((r=d.BaseObject.borrowObject(d.EventObject)).type=d.EventObject.LOOP_COMPLETE,r.armature=this._armature,r.animationState=this._animationState),0<this.playState&&t.hasDBEventListener(d.EventObject.COMPLETE)&&((s=d.BaseObject.borrowObject(d.EventObject)).type=d.EventObject.COMPLETE,s.armature=this._armature,s.animationState=this._animationState)),1<this._frameCount){var o=this._timelineData,t=Math.floor(this.currentTime*this._frameRate),a=this._frameIndices[o.frameIndicesOffset+t];if(this._frameIndex!==a){var l,p=this._frameIndex;if(this._frameIndex=a,null!==this._timelineArray)if(this._frameOffset=this._animationData.frameOffset+this._timelineArray[o.offset+5+this._frameIndex],e)for(p<0&&(l=Math.floor(n*this._frameRate),p=this._frameIndices[o.frameIndicesOffset+l],this.currentPlayTimes===i&&p===a&&(p=-1));0<=p;){var h=this._animationData.frameOffset+this._timelineArray[o.offset+5+p],u=this._frameArray[h]/this._frameRate;if(this._position<=u&&u<=this._position+this._duration&&this._onCrossFrame(p),null!==r&&0===p&&(this._armature._dragonBones.bufferEvent(r),r=null),0<p?p--:p=this._frameCount-1,p===a)break}else for(p<0&&(l=Math.floor(n*this._frameRate),p=this._frameIndices[o.frameIndicesOffset+l],h=this._animationData.frameOffset+this._timelineArray[o.offset+5+p],u=this._frameArray[h]/this._frameRate,this.currentPlayTimes===i&&(n<=u?0<p?p--:p=this._frameCount-1:p===a&&(p=-1)));0<=p;){p<this._frameCount-1?p++:p=0;var h=this._animationData.frameOffset+this._timelineArray[o.offset+5+p],u=this._frameArray[h]/this._frameRate;if(this._position<=u&&u<=this._position+this._duration&&this._onCrossFrame(p),null!==r&&0===p&&(this._armature._dragonBones.bufferEvent(r),r=null),p===a)break}}}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5],u=this._frameArray[this._frameOffset]/this._frameRate,this.currentPlayTimes===i?n<=u&&this._onCrossFrame(this._frameIndex):this._position<=u&&(e||null===r||(this._armature._dragonBones.bufferEvent(r),r=null),this._onCrossFrame(this._frameIndex))));null!==r&&this._armature._dragonBones.bufferEvent(r),null!==s&&this._armature._dragonBones.bufferEvent(s)}},i.prototype.setCurrentTime=function(t){this._setCurrentTime(t),this._frameIndex=-1},i);function i(){return null!==t&&t.apply(this,arguments)||this}d.ActionTimelineState=e;var n,e=(n=d.TimelineState,__extends(r,n),r.toString=function(){return"[class dragonBones.ZOrderTimelineState]"},r.prototype._onArriveAtFrame=function(){0<=this.playState&&(0<this._frameArray[this._frameOffset+1]?this._armature._sortZOrder(this._frameArray,this._frameOffset+2):this._armature._sortZOrder(null,0))},r.prototype._onUpdateFrame=function(){},r);function r(){return null!==n&&n.apply(this,arguments)||this}d.ZOrderTimelineState=e;var s,e=(s=d.BoneTimelineState,__extends(o,s),o.toString=function(){return"[class dragonBones.BoneAllTimelineState]"},o.prototype._onArriveAtFrame=function(){var t,e,i,n,r;s.prototype._onArriveAtFrame.call(this),null!==this._timelineData?(t=this._animationData.frameFloatOffset+this._frameValueOffset+6*this._frameIndex,e=this._armature._armatureData.scale,i=this._frameFloatArray,n=this.bonePose.current,r=this.bonePose.delta,n.x=i[t++]*e,n.y=i[t++]*e,n.rotation=i[t++],n.skew=i[t++],n.scaleX=i[t++],n.scaleY=i[t++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameFloatOffset+this._frameValueOffset),r.x=i[t++]*e-n.x,r.y=i[t++]*e-n.y,r.rotation=i[t++]-n.rotation,r.skew=i[t++]-n.skew,r.scaleX=i[t++]-n.scaleX,r.scaleY=i[t++]-n.scaleY):(r.x=0,r.y=0,r.rotation=0,r.skew=0,r.scaleX=0,r.scaleY=0)):(n=this.bonePose.current,r=this.bonePose.delta,n.x=0,n.y=0,n.rotation=0,n.skew=0,n.scaleX=1,n.scaleY=1,r.x=0,r.y=0,r.rotation=0,r.skew=0,r.scaleX=0,r.scaleY=0)},o.prototype._onUpdateFrame=function(){s.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,e=this.bonePose.delta,i=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),i.x=t.x+e.x*this._tweenProgress,i.y=t.y+e.y*this._tweenProgress,i.rotation=t.rotation+e.rotation*this._tweenProgress,i.skew=t.skew+e.skew*this._tweenProgress,i.scaleX=t.scaleX+e.scaleX*this._tweenProgress,i.scaleY=t.scaleY+e.scaleY*this._tweenProgress},o.prototype.fadeOut=function(){var t=this.bonePose.result;t.rotation=d.Transform.normalizeRadian(t.rotation),t.skew=d.Transform.normalizeRadian(t.skew)},o);function o(){return null!==s&&s.apply(this,arguments)||this}d.BoneAllTimelineState=e;var a,e=(a=d.BoneTimelineState,__extends(l,a),l.toString=function(){return"[class dragonBones.BoneTranslateTimelineState]"},l.prototype._onArriveAtFrame=function(){var t,e,i,n,r;a.prototype._onArriveAtFrame.call(this),null!==this._timelineData?(t=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,e=this._armature._armatureData.scale,i=this._frameFloatArray,n=this.bonePose.current,r=this.bonePose.delta,n.x=i[t++]*e,n.y=i[t++]*e,2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameFloatOffset+this._frameValueOffset),r.x=i[t++]*e-n.x,r.y=i[t++]*e-n.y):(r.x=0,r.y=0)):(n=this.bonePose.current,r=this.bonePose.delta,n.x=0,n.y=0,r.x=0,r.y=0)},l.prototype._onUpdateFrame=function(){a.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,e=this.bonePose.delta,i=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),i.x=t.x+e.x*this._tweenProgress,i.y=t.y+e.y*this._tweenProgress},l);function l(){return null!==a&&a.apply(this,arguments)||this}d.BoneTranslateTimelineState=e;var p,e=(p=d.BoneTimelineState,__extends(h,p),h.toString=function(){return"[class dragonBones.BoneRotateTimelineState]"},h.prototype._onArriveAtFrame=function(){var t,e,i,n;p.prototype._onArriveAtFrame.call(this),null!==this._timelineData?(t=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,e=this._frameFloatArray,i=this.bonePose.current,n=this.bonePose.delta,i.rotation=e[t++],i.skew=e[t++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameFloatOffset+this._frameValueOffset),n.rotation=e[t++]-i.rotation,n.skew=e[t++]-i.skew):(n.rotation=0,n.skew=0)):(i=this.bonePose.current,n=this.bonePose.delta,i.rotation=0,i.skew=0,n.rotation=0,n.skew=0)},h.prototype._onUpdateFrame=function(){p.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,e=this.bonePose.delta,i=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),i.rotation=t.rotation+e.rotation*this._tweenProgress,i.skew=t.skew+e.skew*this._tweenProgress},h.prototype.fadeOut=function(){var t=this.bonePose.result;t.rotation=d.Transform.normalizeRadian(t.rotation),t.skew=d.Transform.normalizeRadian(t.skew)},h);function h(){return null!==p&&p.apply(this,arguments)||this}d.BoneRotateTimelineState=e;var u,e=(u=d.BoneTimelineState,__extends(c,u),c.toString=function(){return"[class dragonBones.BoneScaleTimelineState]"},c.prototype._onArriveAtFrame=function(){var t,e,i,n;u.prototype._onArriveAtFrame.call(this),null!==this._timelineData?(t=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,e=this._frameFloatArray,i=this.bonePose.current,n=this.bonePose.delta,i.scaleX=e[t++],i.scaleY=e[t++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameFloatOffset+this._frameValueOffset),n.scaleX=e[t++]-i.scaleX,n.scaleY=e[t++]-i.scaleY):(n.scaleX=0,n.scaleY=0)):(i=this.bonePose.current,n=this.bonePose.delta,i.scaleX=1,i.scaleY=1,n.scaleX=0,n.scaleY=0)},c.prototype._onUpdateFrame=function(){u.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,e=this.bonePose.delta,i=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),i.scaleX=t.scaleX+e.scaleX*this._tweenProgress,i.scaleY=t.scaleY+e.scaleY*this._tweenProgress},c);function c(){return null!==u&&u.apply(this,arguments)||this}d.BoneScaleTimelineState=e;var _,e=(_=d.SlotTimelineState,__extends(y,_),y.toString=function(){return"[class dragonBones.SlotDislayTimelineState]"},y.prototype._onArriveAtFrame=function(){var t;0<=this.playState&&(t=null!==this._timelineData?this._frameArray[this._frameOffset+1]:this.slot._slotData.displayIndex,this.slot.displayIndex!==t&&this.slot._setDisplayIndex(t,!0))},y);function y(){return null!==_&&_.apply(this,arguments)||this}d.SlotDislayTimelineState=e;var f,e=(f=d.SlotTimelineState,__extends(m,f),m.toString=function(){return"[class dragonBones.SlotColorTimelineState]"},m.prototype._onClear=function(){f.prototype._onClear.call(this),this._dirty=!1},m.prototype._onArriveAtFrame=function(){var t,e,i,n;f.prototype._onArriveAtFrame.call(this),null!==this._timelineData?(t=this._dragonBonesData.intArray,(n=(e=this._frameIntArray)[i=this._animationData.frameIntOffset+this._frameValueOffset+ +this._frameIndex])<0&&(n+=32767),this._current[0]=t[n++],this._current[1]=t[n++],this._current[2]=t[n++],this._current[3]=t[n++],this._current[4]=t[n++],this._current[5]=t[n++],this._current[6]=t[n++],this._current[7]=t[n++],2===this._tweenState&&((n=this._frameIndex===this._frameCount-1?e[this._animationData.frameIntOffset+this._frameValueOffset]:e[i+1])<0&&(n+=32767),this._delta[0]=t[n++]-this._current[0],this._delta[1]=t[n++]-this._current[1],this._delta[2]=t[n++]-this._current[2],this._delta[3]=t[n++]-this._current[3],this._delta[4]=t[n++]-this._current[4],this._delta[5]=t[n++]-this._current[5],this._delta[6]=t[n++]-this._current[6],this._delta[7]=t[n++]-this._current[7])):(n=this.slot._slotData.color,this._current[0]=100*n.alphaMultiplier,this._current[1]=100*n.redMultiplier,this._current[2]=100*n.greenMultiplier,this._current[3]=100*n.blueMultiplier,this._current[4]=n.alphaOffset,this._current[5]=n.redOffset,this._current[6]=n.greenOffset,this._current[7]=n.blueOffset)},m.prototype._onUpdateFrame=function(){f.prototype._onUpdateFrame.call(this),this._dirty=!0,2!==this._tweenState&&(this._tweenState=0),this._result[0]=.01*(this._current[0]+this._delta[0]*this._tweenProgress),this._result[1]=.01*(this._current[1]+this._delta[1]*this._tweenProgress),this._result[2]=.01*(this._current[2]+this._delta[2]*this._tweenProgress),this._result[3]=.01*(this._current[3]+this._delta[3]*this._tweenProgress),this._result[4]=this._current[4]+this._delta[4]*this._tweenProgress,this._result[5]=this._current[5]+this._delta[5]*this._tweenProgress,this._result[6]=this._current[6]+this._delta[6]*this._tweenProgress,this._result[7]=this._current[7]+this._delta[7]*this._tweenProgress},m.prototype.fadeOut=function(){this._tweenState=0,this._dirty=!1},m.prototype.update=function(t){var e;f.prototype.update.call(this,t),0===this._tweenState&&!this._dirty||(e=this.slot._colorTransform,0!==this._animationState._fadeState||0!==this._animationState._subFadeState?e.alphaMultiplier===this._result[0]&&e.redMultiplier===this._result[1]&&e.greenMultiplier===this._result[2]&&e.blueMultiplier===this._result[3]&&e.alphaOffset===this._result[4]&&e.redOffset===this._result[5]&&e.greenOffset===this._result[6]&&e.blueOffset===this._result[7]||(t=Math.pow(this._animationState._fadeProgress,4),e.alphaMultiplier+=(this._result[0]-e.alphaMultiplier)*t,e.redMultiplier+=(this._result[1]-e.redMultiplier)*t,e.greenMultiplier+=(this._result[2]-e.greenMultiplier)*t,e.blueMultiplier+=(this._result[3]-e.blueMultiplier)*t,e.alphaOffset+=(this._result[4]-e.alphaOffset)*t,e.redOffset+=(this._result[5]-e.redOffset)*t,e.greenOffset+=(this._result[6]-e.greenOffset)*t,e.blueOffset+=(this._result[7]-e.blueOffset)*t,this.slot._colorDirty=!0):this._dirty&&(this._dirty=!1,e.alphaMultiplier===this._result[0]&&e.redMultiplier===this._result[1]&&e.greenMultiplier===this._result[2]&&e.blueMultiplier===this._result[3]&&e.alphaOffset===this._result[4]&&e.redOffset===this._result[5]&&e.greenOffset===this._result[6]&&e.blueOffset===this._result[7]||(e.alphaMultiplier=this._result[0],e.redMultiplier=this._result[1],e.greenMultiplier=this._result[2],e.blueMultiplier=this._result[3],e.alphaOffset=this._result[4],e.redOffset=this._result[5],e.greenOffset=this._result[6],e.blueOffset=this._result[7],this.slot._colorDirty=!0)))},m);function m(){var t=null!==f&&f.apply(this,arguments)||this;return t._current=[0,0,0,0,0,0,0,0],t._delta=[0,0,0,0,0,0,0,0],t._result=[0,0,0,0,0,0,0,0],t}d.SlotColorTimelineState=e;var x,e=(x=d.SlotTimelineState,__extends(v,x),v.toString=function(){return"[class dragonBones.SlotFFDTimelineState]"},v.prototype._onClear=function(){x.prototype._onClear.call(this),this.meshOffset=0,this._dirty=!1,this._frameFloatOffset=0,this._valueCount=0,this._ffdCount=0,this._valueOffset=0,this._current.length=0,this._delta.length=0,this._result.length=0},v.prototype._onArriveAtFrame=function(){if(x.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var t=this._animationData.frameFloatOffset+this._frameValueOffset+this._frameIndex*this._valueCount,e=this._armature._armatureData.scale,i=this._frameFloatArray;if(2===this._tweenState){var n=t+this._valueCount;this._frameIndex===this._frameCount-1&&(n=this._animationData.frameFloatOffset+this._frameValueOffset);for(var r=0;r<this._valueCount;++r)this._delta[r]=i[n+r]*e-(this._current[r]=i[t+r]*e)}else for(r=0;r<this._valueCount;++r)this._current[r]=i[t+r]*e}else for(r=0;r<this._valueCount;++r)this._current[r]=0},v.prototype._onUpdateFrame=function(){x.prototype._onUpdateFrame.call(this),this._dirty=!0,2!==this._tweenState&&(this._tweenState=0);for(var t=0;t<this._valueCount;++t)this._result[t]=this._current[t]+this._delta[t]*this._tweenProgress},v.prototype.init=function(t,e,i){x.prototype.init.call(this,t,e,i),null!==this._timelineData?(i=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3],this.meshOffset=this._frameIntArray[i+0],this._ffdCount=this._frameIntArray[i+1],this._valueCount=this._frameIntArray[i+2],this._valueOffset=this._frameIntArray[i+3],this._frameFloatOffset=this._frameIntArray[i+4]+this._animationData.frameFloatOffset):this._valueCount=0,this._current.length=this._valueCount,this._delta.length=this._valueCount,this._result.length=this._valueCount;for(var n=0;n<this._valueCount;++n)this._delta[n]=0},v.prototype.fadeOut=function(){this._tweenState=0,this._dirty=!1},v.prototype.update=function(t){if(null!==this.slot._meshData&&this.slot._meshData.offset===this.meshOffset&&(x.prototype.update.call(this,t),0!==this._tweenState||this._dirty)){var e=this.slot._ffdVertices;if(null!==this._timelineData){if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){for(var i=Math.pow(this._animationState._fadeProgress,2),n=0;n<this._ffdCount;++n)n<this._valueOffset?e[n]+=(this._frameFloatArray[this._frameFloatOffset+n]-e[n])*i:n<this._valueOffset+this._valueCount?e[n]+=(this._result[n-this._valueOffset]-e[n])*i:e[n]+=(this._frameFloatArray[this._frameFloatOffset+n-this._valueCount]-e[n])*i;this.slot._meshDirty=!0}else if(this._dirty){this._dirty=!1;for(n=0;n<this._ffdCount;++n)n<this._valueOffset?e[n]=this._frameFloatArray[this._frameFloatOffset+n]:n<this._valueOffset+this._valueCount?e[n]=this._result[n-this._valueOffset]:e[n]=this._frameFloatArray[this._frameFloatOffset+n-this._valueCount];this.slot._meshDirty=!0}}else if(this._ffdCount=e.length,0!==this._animationState._fadeState||0!==this._animationState._subFadeState){for(i=Math.pow(this._animationState._fadeProgress,2),n=0;n<this._ffdCount;++n)e[n]+=(0-e[n])*i;this.slot._meshDirty=!0}else if(this._dirty){this._dirty=!1;for(n=0;n<this._ffdCount;++n)e[n]=0;this.slot._meshDirty=!0}}},v);function v(){var t=null!==x&&x.apply(this,arguments)||this;return t._current=[],t._delta=[],t._result=[],t}d.SlotFFDTimelineState=e;var g,e=(g=d.ConstraintTimelineState,__extends(b,g),b.toString=function(){return"[class dragonBones.IKConstraintTimelineState]"},b.prototype._onClear=function(){g.prototype._onClear.call(this),this._current=0,this._delta=0},b.prototype._onArriveAtFrame=function(){g.prototype._onArriveAtFrame.call(this);var t,e,i,n=this.constraint;null!==this._timelineData?(t=this._animationData.frameIntOffset+this._frameValueOffset+2*this._frameIndex,i=0!==(e=this._frameIntArray)[t++],this._current=.01*e[t++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameIntOffset+this._frameValueOffset),this._delta=.01*e[t+1]-this._current):this._delta=0,n._bendPositive=i):(i=n._constraintData,this._current=i.weight,this._delta=0,n._bendPositive=i.bendPositive),n.invalidUpdate()},b.prototype._onUpdateFrame=function(){g.prototype._onUpdateFrame.call(this),2!==this._tweenState&&(this._tweenState=0);var t=this.constraint;t._weight=this._current+this._delta*this._tweenProgress,t.invalidUpdate()},b);function b(){return null!==g&&g.apply(this,arguments)||this}d.IKConstraintTimelineState=e}(dragonBones=dragonBones||{}),function(t){var e,i=(e=t.BaseObject,__extends(n,e),n.toString=function(){return"[class dragonBones.EventObject]"},n.prototype._onClear=function(){this.time=0,this.type="",this.name="",this.armature=null,this.bone=null,this.slot=null,this.animationState=null,this.data=null},n.START="start",n.LOOP_COMPLETE="loopComplete",n.COMPLETE="complete",n.FADE_IN="fadeIn",n.FADE_IN_COMPLETE="fadeInComplete",n.FADE_OUT="fadeOut",n.FADE_OUT_COMPLETE="fadeOutComplete",n.FRAME_EVENT="frameEvent",n.SOUND_EVENT="soundEvent",n);function n(){return null!==e&&e.apply(this,arguments)||this}t.EventObject=i}(dragonBones=dragonBones||{}),function(h){var t=(u._getArmatureType=function(t){switch(t.toLowerCase()){case"stage":return 2;case"armature":return 0;case"movieclip":return 1;default:return 0}},u._getDisplayType=function(t){switch(t.toLowerCase()){case"image":return 0;case"mesh":return 2;case"armature":return 1;case"boundingbox":return 3;default:return 0}},u._getBoundingBoxType=function(t){switch(t.toLowerCase()){case"rectangle":return 0;case"ellipse":return 1;case"polygon":return 2;default:return 0}},u._getActionType=function(t){switch(t.toLowerCase()){case"play":return 0;case"frame":return 10;case"sound":return 11;default:return 0}},u._getBlendMode=function(t){switch(t.toLowerCase()){case"normal":return 0;case"add":return 1;case"alpha":return 2;case"darken":return 3;case"difference":return 4;case"erase":return 5;case"hardlight":return 6;case"invert":return 7;case"layer":return 8;case"lighten":return 9;case"multiply":return 10;case"overlay":return 11;case"screen":return 12;case"subtract":return 13;default:return 0}},u.parseDragonBonesData=function(t){return(t instanceof ArrayBuffer?h.BinaryDataParser:h.ObjectDataParser).getInstance().parseDragonBonesData(t)},u.parseTextureAtlasData=function(t,e){void 0===e&&(e=1),console.warn("å·²åºŸå¼ƒ");for(var i={},n=t[u.SUB_TEXTURE],r=0,s=n.length;r<s;r++){var o=n[r],a=o[u.NAME],l=new h.Rectangle,p=null;l.x=o[u.X]/e,l.y=o[u.Y]/e,l.width=o[u.WIDTH]/e,l.height=o[u.HEIGHT]/e,u.FRAME_WIDTH in o&&((p=new h.Rectangle).x=o[u.FRAME_X]/e,p.y=o[u.FRAME_Y]/e,p.width=o[u.FRAME_WIDTH]/e,p.height=o[u.FRAME_HEIGHT]/e),i[a]={region:l,frame:p,rotated:!1}}return i},u.DATA_VERSION_2_3="2.3",u.DATA_VERSION_3_0="3.0",u.DATA_VERSION_4_0="4.0",u.DATA_VERSION_4_5="4.5",u.DATA_VERSION_5_0="5.0",u.DATA_VERSION=u.DATA_VERSION_5_5="5.5",u.DATA_VERSIONS=[u.DATA_VERSION_4_0,u.DATA_VERSION_4_5,u.DATA_VERSION_5_0,u.DATA_VERSION_5_5],u.TEXTURE_ATLAS="textureAtlas",u.SUB_TEXTURE="SubTexture",u.FORMAT="format",u.IMAGE_PATH="imagePath",u.WIDTH="width",u.HEIGHT="height",u.ROTATED="rotated",u.FRAME_X="frameX",u.FRAME_Y="frameY",u.FRAME_WIDTH="frameWidth",u.FRAME_HEIGHT="frameHeight",u.DRADON_BONES="dragonBones",u.USER_DATA="userData",u.ARMATURE="armature",u.BONE="bone",u.SLOT="slot",u.CONSTRAINT="constraint",u.IK="ik",u.SKIN="skin",u.DISPLAY="display",u.ANIMATION="animation",u.Z_ORDER="zOrder",u.FFD="ffd",u.FRAME="frame",u.TRANSLATE_FRAME="translateFrame",u.ROTATE_FRAME="rotateFrame",u.SCALE_FRAME="scaleFrame",u.DISPLAY_FRAME="displayFrame",u.COLOR_FRAME="colorFrame",u.DEFAULT_ACTIONS="defaultActions",u.ACTIONS="actions",u.EVENTS="events",u.INTS="ints",u.FLOATS="floats",u.STRINGS="strings",u.CANVAS="canvas",u.TRANSFORM="transform",u.PIVOT="pivot",u.AABB="aabb",u.COLOR="color",u.VERSION="version",u.COMPATIBLE_VERSION="compatibleVersion",u.FRAME_RATE="frameRate",u.TYPE="type",u.SUB_TYPE="subType",u.NAME="name",u.PARENT="parent",u.TARGET="target",u.STAGE="stage",u.SHARE="share",u.PATH="path",u.LENGTH="length",u.DISPLAY_INDEX="displayIndex",u.BLEND_MODE="blendMode",u.INHERIT_TRANSLATION="inheritTranslation",u.INHERIT_ROTATION="inheritRotation",u.INHERIT_SCALE="inheritScale",u.INHERIT_REFLECTION="inheritReflection",u.INHERIT_ANIMATION="inheritAnimation",u.INHERIT_FFD="inheritFFD",u.BEND_POSITIVE="bendPositive",u.CHAIN="chain",u.WEIGHT="weight",u.FADE_IN_TIME="fadeInTime",u.PLAY_TIMES="playTimes",u.SCALE="scale",u.OFFSET="offset",u.POSITION="position",u.DURATION="duration",u.TWEEN_EASING="tweenEasing",u.TWEEN_ROTATE="tweenRotate",u.TWEEN_SCALE="tweenScale",u.CLOCK_WISE="clockwise",u.CURVE="curve",u.SOUND="sound",u.EVENT="event",u.ACTION="action",u.X="x",u.Y="y",u.SKEW_X="skX",u.SKEW_Y="skY",u.SCALE_X="scX",u.SCALE_Y="scY",u.VALUE="value",u.ROTATE="rotate",u.SKEW="skew",u.ALPHA_OFFSET="aO",u.RED_OFFSET="rO",u.GREEN_OFFSET="gO",u.BLUE_OFFSET="bO",u.ALPHA_MULTIPLIER="aM",u.RED_MULTIPLIER="rM",u.GREEN_MULTIPLIER="gM",u.BLUE_MULTIPLIER="bM",u.UVS="uvs",u.VERTICES="vertices",u.TRIANGLES="triangles",u.WEIGHTS="weights",u.SLOT_POSE="slotPose",u.BONE_POSE="bonePose",u.GOTO_AND_PLAY="gotoAndPlay",u.DEFAULT_NAME="default",u);function u(){}h.DataParser=t}(dragonBones=dragonBones||{}),function(G){var e,t=(e=G.DataParser,__extends(U,e),U._getBoolean=function(t,e,i){if(e in t){t=t[e],e=typeof t;if("boolean"==e)return t;if("string"!=e)return!!t;switch(t){case"0":case"NaN":case"":case"false":case"null":case"undefined":return!1;default:return!0}}return i},U._getNumber=function(t,e,i){if(e in t){e=t[e];return null===e||"NaN"===e?i:+e||0}return i},U._getString=function(t,e,i){if(e in t){var n=t[e];if("string"!=typeof n)return String(n);if(G.DragonBones.webAssembly)for(var r=0,s=n.length;r<s;++r)if(255<n.charCodeAt(r))return encodeURI(n);return n}return i},U.prototype._getCurvePoint=function(t,e,i,n,r,s,o,a,l,p){var h=1-l,u=h*h,c=l*l,d=h*u,u=3*l*u,h=3*h*c,c=l*c;p.x=d*t+u*i+h*r+c*o,p.y=d*e+u*n+h*s+c*a},U.prototype._samplingEasingCurve=function(t,e){for(var i=t.length,n=-2,r=0,s=e.length;r<s;++r){for(var o=(r+1)/(s+1);(n+6<i?t[n+6]:1)<o;)n+=6;for(var a=0<=n&&n+6<i,l=a?t[n]:0,p=a?t[n+1]:0,h=t[n+2],u=t[n+3],c=t[n+4],d=t[n+5],_=a?t[n+6]:1,y=a?t[n+7]:1,f=0,m=1;1e-4<m-f;){var x=.5*(m+f);this._getCurvePoint(l,p,h,u,c,d,_,y,x,this._helpPoint),0<o-this._helpPoint.x?f=x:m=x}e[r]=this._helpPoint.y}},U.prototype._parseActionDataInFrame=function(t,e,i,n){U.EVENT in t&&this._mergeActionFrame(t[U.EVENT],e,10,i,n),U.SOUND in t&&this._mergeActionFrame(t[U.SOUND],e,11,i,n),U.ACTION in t&&this._mergeActionFrame(t[U.ACTION],e,0,i,n),U.EVENTS in t&&this._mergeActionFrame(t[U.EVENTS],e,10,i,n),U.ACTIONS in t&&this._mergeActionFrame(t[U.ACTIONS],e,0,i,n)},U.prototype._mergeActionFrame=function(t,e,i,n,r){for(var s=G.DragonBones.webAssembly?this._armature.actions.size():this._armature.actions.length,o=this._parseActionData(t,i,n,r),a=0,l=null,p=0,h=o;p<h.length;p++){var u=h[p];this._armature.addAction(u,!1)}0===this._actionFrames.length&&((l=new g).frameStart=0,this._actionFrames.push(l),l=null);for(var c=0,d=this._actionFrames;c<d.length;c++){var _=d[c];if(_.frameStart===e){l=_;break}if(_.frameStart>e)break;a++}null===l&&((l=new g).frameStart=e,this._actionFrames.splice(a+1,0,l));for(var y=0;y<o.length;++y)l.actions.push(s+y)},U.prototype._parseArmature=function(t,e){var i,n,r,s=G.BaseObject.borrowObject(G.ArmatureData);if(s.name=U._getString(t,U.NAME,""),s.frameRate=U._getNumber(t,U.FRAME_RATE,this._data.frameRate),s.scale=e,U.TYPE in t&&"string"==typeof t[U.TYPE]?s.type=U._getArmatureType(t[U.TYPE]):s.type=U._getNumber(t,U.TYPE,0),0===s.frameRate&&(s.frameRate=24),this._armature=s,U.CANVAS in t&&(e=t[U.CANVAS],i=G.BaseObject.borrowObject(G.CanvasData),U.COLOR in e?i.hasBackground=!0:i.hasBackground=!1,i.color=U._getNumber(e,U.COLOR,0),i.x=U._getNumber(e,U.X,0)*s.scale,i.y=U._getNumber(e,U.Y,0)*s.scale,i.width=U._getNumber(e,U.WIDTH,0)*s.scale,i.height=U._getNumber(e,U.HEIGHT,0)*s.scale,s.canvas=i),U.AABB in t&&(i=t[U.AABB],s.aabb.x=U._getNumber(i,U.X,0)*s.scale,s.aabb.y=U._getNumber(i,U.Y,0)*s.scale,s.aabb.width=U._getNumber(i,U.WIDTH,0)*s.scale,s.aabb.height=U._getNumber(i,U.HEIGHT,0)*s.scale),U.BONE in t)for(var o=0,a=t[U.BONE];o<a.length;o++){var l=a[o],p=U._getString(l,U.PARENT,""),h=this._parseBone(l);if(0<p.length&&(null!==(l=s.getBone(p))?h.parent=l:(p in this._cacheBones||(this._cacheBones[p]=[]),this._cacheBones[p].push(h))),h.name in this._cacheBones){for(var u=0,c=this._cacheBones[h.name];u<c.length;u++)c[u].parent=h;delete this._cacheBones[h.name]}s.addBone(h),this._rawBones.push(h)}if(U.IK in t)for(var d=0,_=t[U.IK];d<_.length;d++){var y=_[d],y=this._parseIKConstraint(y);y&&s.addConstraint(y)}if(s.sortBones(),U.SLOT in t)for(var f=0,m=0,x=t[U.SLOT];m<x.length;m++){var v=x[m];s.addSlot(this._parseSlot(v,f++))}if(U.SKIN in t)for(var g=0,b=t[U.SKIN];g<b.length;g++){var z=b[g];s.addSkin(this._parseSkin(z))}for(n in this._cacheMeshs){var w=s.getSkin(n);if(null!==w){var C,P=this._cacheMeshs[n];for(C in P){var T,S=P[C];for(T in S){var M=w.getDisplay(C,T);if(null!==M)for(var A=0,O=S[T];A<O.length;A++){var k=O[A];k.offset=M.offset,k.weight=M.weight}}}}}if(U.ANIMATION in t)for(var E=0,I=t[U.ANIMATION];E<I.length;E++){var D=I[E],B=this._parseAnimation(D);s.addAnimation(B)}if(U.DEFAULT_ACTIONS in t)for(var L=0,R=this._parseActionData(t[U.DEFAULT_ACTIONS],0,null,null);L<R.length;L++){var F=R[L];s.addAction(F,!0),0===F.type&&null!==(B=s.getAnimation(F.name))&&(s.defaultAnimation=B)}if(U.ACTIONS in t)for(var j=0,N=this._parseActionData(t[U.ACTIONS],0,null,null);j<N.length;j++){F=N[j];s.addAction(F,!1)}for(r in this._rawBones.length=0,this._armature=null,this._weightSlotPose)delete this._weightSlotPose[r];for(r in this._weightBonePoses)delete this._weightBonePoses[r];for(r in this._cacheMeshs)delete this._cacheMeshs[r];for(r in this._cacheBones)delete this._cacheBones[r];for(r in this._slotChildActions)delete this._slotChildActions[r];return s},U.prototype._parseBone=function(t){var e=G.BaseObject.borrowObject(G.BoneData);return e.inheritTranslation=U._getBoolean(t,U.INHERIT_TRANSLATION,!0),e.inheritRotation=U._getBoolean(t,U.INHERIT_ROTATION,!0),e.inheritScale=U._getBoolean(t,U.INHERIT_SCALE,!0),e.inheritReflection=U._getBoolean(t,U.INHERIT_REFLECTION,!0),e.length=U._getNumber(t,U.LENGTH,0)*this._armature.scale,e.name=U._getString(t,U.NAME,""),U.TRANSFORM in t&&this._parseTransform(t[U.TRANSFORM],e.transform,this._armature.scale),e},U.prototype._parseIKConstraint=function(t){var e=this._armature.getBone(U._getString(t,U.BONE,""));if(null===e)return null;var i=this._armature.getBone(U._getString(t,U.TARGET,""));if(null===i)return null;var n=G.BaseObject.borrowObject(G.IKConstraintData);return n.scaleEnabled=U._getBoolean(t,U.SCALE,!1),n.bendPositive=U._getBoolean(t,U.BEND_POSITIVE,!0),n.weight=U._getNumber(t,U.WEIGHT,1),n.name=U._getString(t,U.NAME,""),n.bone=e,n.target=i,0<U._getNumber(t,U.CHAIN,0)&&(n.root=e.parent),n},U.prototype._parseSlot=function(t,e){var i=G.BaseObject.borrowObject(G.SlotData);return i.displayIndex=U._getNumber(t,U.DISPLAY_INDEX,0),i.zOrder=e,i.name=U._getString(t,U.NAME,""),i.parent=this._armature.getBone(U._getString(t,U.PARENT,"")),U.BLEND_MODE in t&&"string"==typeof t[U.BLEND_MODE]?i.blendMode=U._getBlendMode(t[U.BLEND_MODE]):i.blendMode=U._getNumber(t,U.BLEND_MODE,0),U.COLOR in t?(i.color=G.SlotData.createColor(),this._parseColorTransform(t[U.COLOR],i.color)):i.color=G.SlotData.DEFAULT_COLOR,U.ACTIONS in t&&(this._slotChildActions[i.name]=this._parseActionData(t[U.ACTIONS],0,null,null)),i},U.prototype._parseSkin=function(t){var e=G.BaseObject.borrowObject(G.SkinData);if(e.name=U._getString(t,U.NAME,U.DEFAULT_NAME),0===e.name.length&&(e.name=U.DEFAULT_NAME),U.SLOT in t){t=t[U.SLOT];this._skin=e;for(var i=0,n=t;i<n.length;i++){var r=n[i],s=U._getString(r,U.NAME,""),o=this._armature.getSlot(s);if(null!==o){if(this._slot=o,U.DISPLAY in r)for(var a=0,l=r[U.DISPLAY];a<l.length;a++){var p=l[a];e.addDisplay(s,this._parseDisplay(p))}this._slot=null}}this._skin=null}return e},U.prototype._parseDisplay=function(t){var e=U._getString(t,U.NAME,""),i=U._getString(t,U.PATH,""),n=0,r=null;switch(n=U.TYPE in t&&"string"==typeof t[U.TYPE]?U._getDisplayType(t[U.TYPE]):U._getNumber(t,U.TYPE,n)){case 0:var s=r=G.BaseObject.borrowObject(G.ImageDisplayData);s.name=e,s.path=0<i.length?i:e,this._parsePivot(t,s);break;case 1:var o=r=G.BaseObject.borrowObject(G.ArmatureDisplayData);if(o.name=e,o.path=0<i.length?i:e,o.inheritAnimation=!0,U.ACTIONS in t)for(var a=0,l=this._parseActionData(t[U.ACTIONS],0,null,null);a<l.length;a++){var p=l[a];o.addAction(p)}else if(this._slot.name in this._slotChildActions){var h=this._skin.getDisplays(this._slot.name);if(null===h?0===this._slot.displayIndex:this._slot.displayIndex===h.length){for(var u=0,c=this._slotChildActions[this._slot.name];u<c.length;u++){p=c[u];o.addAction(p)}delete this._slotChildActions[this._slot.name]}}break;case 2:var d=U._getString(t,U.SHARE,""),_=r=G.BaseObject.borrowObject(G.MeshDisplayData);_.name=e,_.path=0<i.length?i:e,_.inheritAnimation=U._getBoolean(t,U.INHERIT_FFD,!0),this._parsePivot(t,_),0<d.length?(s=U._getString(t,U.SKIN,""),h=this._slot.name,0===s.length&&(s=U.DEFAULT_NAME),s in this._cacheMeshs||(this._cacheMeshs[s]={}),h in(s=this._cacheMeshs[s])||(s[h]={}),d in(h=s[h])||(h[d]=[]),h[d].push(_)):this._parseMesh(t,_);break;case 3:d=this._parseBoundingBox(t);null!==d&&((_=r=G.BaseObject.borrowObject(G.BoundingBoxDisplayData)).name=e,_.path=0<i.length?i:e,_.boundingBox=d)}return null!==r&&U.TRANSFORM in t&&this._parseTransform(t[U.TRANSFORM],r.transform,this._armature.scale),r},U.prototype._parsePivot=function(t,e){U.PIVOT in t?(t=t[U.PIVOT],e.pivot.x=U._getNumber(t,U.X,0),e.pivot.y=U._getNumber(t,U.Y,0)):(e.pivot.x=.5,e.pivot.y=.5)},U.prototype._parseMesh=function(t,e){var i=t[U.VERTICES],n=t[U.UVS],r=t[U.TRIANGLES],s=Math.floor(i.length/2),o=Math.floor(r.length/3),a=this._floatArray.length,l=a+2*s,p=this._intArray.length;e.offset=p,this._intArray.length+=4+3*o,this._intArray[p+0]=s,this._intArray[p+1]=o,this._intArray[p+2]=a;for(var h=0,u=3*o;h<u;++h)this._intArray[p+4+h]=r[h];this._floatArray.length+=2*s+2*s;for(h=0,u=2*s;h<u;++h)this._floatArray[a+h]=i[h],this._floatArray[l+h]=n[h];if(U.WEIGHTS in t){var c=t[U.WEIGHTS],d=t[U.SLOT_POSE],_=t[U.BONE_POSE],y=this._armature.sortedBones,f=new Array,m=Math.floor(_.length/7),o=this._floatArray.length,t=Math.floor(c.length-s)/2,x=this._intArray.length,v=G.BaseObject.borrowObject(G.WeightData);v.count=t,v.offset=x,f.length=m,this._intArray.length+=2+m+s+t,this._intArray[x+1]=o;for(h=0;h<m;++h){var g=_[7*h],b=this._rawBones[g];v.addBone(b),f[h]=g,this._intArray[x+2+h]=y.indexOf(b)}this._floatArray.length+=3*t,this._helpMatrixA.copyFromArray(d,0);for(var h=0,z=0,w=x+2+m,C=o;h<s;++h){var P=2*h,T=this._intArray[w++]=c[z++],S=this._floatArray[a+P],M=this._floatArray[a+P+1];this._helpMatrixA.transformPoint(S,M,this._helpPoint),S=this._helpPoint.x,M=this._helpPoint.y;for(var A=0;A<T;++A){var g=c[z++],O=f.indexOf(g);this._helpMatrixB.copyFromArray(_,7*O+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(S,M,this._helpPoint),this._intArray[w++]=O,this._floatArray[C++]=c[z++],this._floatArray[C++]=this._helpPoint.x,this._floatArray[C++]=this._helpPoint.y}}e.weight=v;e=this._skin.name+"_"+this._slot.name+"_"+e.name;this._weightSlotPose[e]=d,this._weightBonePoses[e]=_}},U.prototype._parseBoundingBox=function(t){var e=null,i=0;switch(i=U.SUB_TYPE in t&&"string"==typeof t[U.SUB_TYPE]?U._getBoundingBoxType(t[U.SUB_TYPE]):U._getNumber(t,U.SUB_TYPE,i)){case 0:e=G.BaseObject.borrowObject(G.RectangleBoundingBoxData);break;case 1:e=G.BaseObject.borrowObject(G.EllipseBoundingBoxData);break;case 2:e=this._parsePolygonBoundingBox(t)}return null!==e&&(e.color=U._getNumber(t,U.COLOR,0),0!==e.type&&1!==e.type||(e.width=U._getNumber(t,U.WIDTH,0),e.height=U._getNumber(t,U.HEIGHT,0))),e},U.prototype._parsePolygonBoundingBox=function(t){var e=G.BaseObject.borrowObject(G.PolygonBoundingBoxData);if(U.VERTICES in t){var i=t[U.VERTICES],n=e.vertices;G.DragonBones.webAssembly?n.resize(i.length,0):n.length=i.length;for(var r=0,s=i.length;r<s;r+=2){var o=i[r],a=i[r+1];G.DragonBones.webAssembly?(n.set(r,o),n.set(r+1,a)):(n[r]=o,n[r+1]=a),0===r?(e.x=o,e.y=a,e.width=o,e.height=a):(o<e.x?e.x=o:o>e.width&&(e.width=o),a<e.y?e.y=a:a>e.height&&(e.height=a))}}else console.warn("Data error.\n Please reexport DragonBones Data to fixed the bug.");return e},U.prototype._parseAnimation=function(t){var e=G.BaseObject.borrowObject(G.AnimationData);if(e.frameCount=Math.max(U._getNumber(t,U.DURATION,1),1),e.playTimes=U._getNumber(t,U.PLAY_TIMES,1),e.duration=e.frameCount/this._armature.frameRate,e.fadeInTime=U._getNumber(t,U.FADE_IN_TIME,0),e.scale=U._getNumber(t,U.SCALE,1),e.name=U._getString(t,U.NAME,U.DEFAULT_NAME),0===e.name.length&&(e.name=U.DEFAULT_NAME),e.frameIntOffset=this._frameIntArray.length,e.frameFloatOffset=this._frameFloatArray.length,e.frameOffset=this._frameArray.length,this._animation=e,U.FRAME in t){var i=t[U.FRAME],n=i.length;if(0<n)for(var r=0,s=0;r<n;++r){var o=i[r];this._parseActionDataInFrame(o,s,null,null),s+=U._getNumber(o,U.DURATION,1)}}if(U.Z_ORDER in t&&(this._animation.zOrderTimeline=this._parseTimeline(t[U.Z_ORDER],null,U.FRAME,1,!1,!1,0,this._parseZOrderFrame)),U.BONE in t)for(var a=0,l=t[U.BONE];a<l.length;a++){var p=l[a];this._parseBoneTimeline(p)}if(U.SLOT in t)for(var h=0,u=t[U.SLOT];h<u.length;h++){p=u[h];this._parseSlotTimeline(p)}if(U.FFD in t)for(var c=0,d=t[U.FFD];c<d.length;c++){var p=d[c],_=U._getString(p,U.SKIN,""),y=U._getString(p,U.SLOT,""),f=U._getString(p,U.NAME,"");0===_.length&&(_=U.DEFAULT_NAME),this._skin=this._armature.getSkin(_),null!==this._skin&&(this._slot=this._armature.getSlot(y),this._mesh=this._skin.getDisplay(y,f),null!==this._skin&&null!==this._slot&&null!==this._mesh&&(null!==(f=this._parseTimeline(p,null,U.FRAME,22,!1,!0,0,this._parseSlotFFDFrame))&&this._animation.addSlotTimeline(this._slot,f),this._skin=null,this._slot=null,this._mesh=null))}if(U.IK in t)for(var m=0,x=t[U.IK];m<x.length;m++){var p=x[m],v=U._getString(p,U.NAME,""),g=this._armature.getConstraint(v);null!==g&&(null!==(v=this._parseTimeline(p,null,U.FRAME,30,!0,!1,2,this._parseIKConstraintFrame))&&this._animation.addConstraintTimeline(g,v))}return 0<this._actionFrames.length&&(this._animation.actionTimeline=this._parseTimeline(null,this._actionFrames,"",0,!1,!1,0,this._parseActionFrame),this._actionFrames.length=0),this._animation=null,e},U.prototype._parseTimeline=function(t,e,i,n,r,s,o,a){if(null!==t&&0<i.length&&i in t&&(e=t[i]),null===e)return null;var l=e.length;if(0===l)return null;var p=this._frameIntArray.length,h=this._frameFloatArray.length,i=G.BaseObject.borrowObject(G.TimelineData),u=this._timelineArray.length;if(this._timelineArray.length+=5+l,null!==t?(this._timelineArray[u+0]=Math.round(100*U._getNumber(t,U.SCALE,1)),this._timelineArray[u+1]=Math.round(100*U._getNumber(t,U.OFFSET,0))):(this._timelineArray[u+0]=100,this._timelineArray[u+1]=0),this._timelineArray[u+2]=l,this._timelineArray[u+3]=o,this._timelineArray[u+4]=r?p-this._animation.frameIntOffset:s?h-this._animation.frameFloatOffset:0,(this._timeline=i).type=n,i.offset=u,1===l)i.frameIndicesOffset=-1,this._timelineArray[u+5+0]=a.call(this,e[0],0,0)-this._animation.frameOffset;else{var c=this._animation.frameCount+1,d=this._data.frameIndices,_=0;G.DragonBones.webAssembly?(_=d.size(),d.resize(_+c,0)):(_=d.length,d.length+=c),i.frameIndicesOffset=_;for(var y,f=0,m=0,x=0,v=0;f<c;++f)x+v<=f&&m<l&&(y=e[m],x=f,v=m===l-1?this._animation.frameCount-x:y instanceof g?this._actionFrames[m+1].frameStart-x:U._getNumber(y,U.DURATION,1),this._timelineArray[u+5+m]=a.call(this,y,x,v)-this._animation.frameOffset,m++),G.DragonBones.webAssembly?d.set(_+f,m-1):d[_+f]=m-1}return this._timeline=null,i},U.prototype._parseBoneTimeline=function(t){var e,i=this._armature.getBone(U._getString(t,U.NAME,""));null!==i&&(this._bone=i,this._slot=this._armature.getSlot(this._bone.name),U.TRANSLATE_FRAME in t&&null!==(e=this._parseTimeline(t,null,U.TRANSLATE_FRAME,11,!1,!0,2,this._parseBoneTranslateFrame))&&this._animation.addBoneTimeline(i,e),U.ROTATE_FRAME in t&&null!==(e=this._parseTimeline(t,null,U.ROTATE_FRAME,12,!1,!0,2,this._parseBoneRotateFrame))&&this._animation.addBoneTimeline(i,e),U.SCALE_FRAME in t&&null!==(e=this._parseTimeline(t,null,U.SCALE_FRAME,13,!1,!0,2,this._parseBoneScaleFrame))&&this._animation.addBoneTimeline(i,e),U.FRAME in t&&null!==(e=this._parseTimeline(t,null,U.FRAME,10,!1,!0,6,this._parseBoneAllFrame))&&this._animation.addBoneTimeline(i,e),this._bone=null,this._slot=null)},U.prototype._parseSlotTimeline=function(t){var e,i=this._armature.getSlot(U._getString(t,U.NAME,""));null!==i&&(this._slot=i,(e=null)!==(e=U.DISPLAY_FRAME in t?this._parseTimeline(t,null,U.DISPLAY_FRAME,20,!1,!1,0,this._parseSlotDisplayFrame):this._parseTimeline(t,null,U.FRAME,20,!1,!1,0,this._parseSlotDisplayFrame))&&this._animation.addSlotTimeline(i,e),(e=null)!==(e=U.COLOR_FRAME in t?this._parseTimeline(t,null,U.COLOR_FRAME,21,!0,!1,1,this._parseSlotColorFrame):this._parseTimeline(t,null,U.FRAME,21,!0,!1,1,this._parseSlotColorFrame))&&this._animation.addSlotTimeline(i,e),this._slot=null)},U.prototype._parseFrame=function(t,e,i){var n=this._frameArray.length;return this._frameArray.length+=1,this._frameArray[n+0]=e,n},U.prototype._parseTweenFrame=function(t,e,i){var n=this._parseFrame(t,e,i);if(0<i)if(U.CURVE in t){var r=i+1;this._helpArray.length=r,this._samplingEasingCurve(t[U.CURVE],this._helpArray),this._frameArray.length+=2+this._helpArray.length,this._frameArray[n+1]=2,this._frameArray[n+2]=r;for(var s=0;s<r;++s)this._frameArray[n+3+s]=Math.round(1e4*this._helpArray[s])}else{i=-2;U.TWEEN_EASING in t&&(i=U._getNumber(t,U.TWEEN_EASING,-2)),-2===i?(this._frameArray.length+=1,this._frameArray[n+1]=0):0===i?(this._frameArray.length+=1,this._frameArray[n+1]=1):i<0?(this._frameArray.length+=2,this._frameArray[n+1]=3,this._frameArray[n+2]=Math.round(100*-i)):i<=1?(this._frameArray.length+=2,this._frameArray[n+1]=4,this._frameArray[n+2]=Math.round(100*i)):(this._frameArray.length+=2,this._frameArray[n+1]=5,this._frameArray[n+2]=Math.round(100*i-100))}else this._frameArray.length+=1,this._frameArray[n+1]=0;return n},U.prototype._parseActionFrame=function(t,e,i){var n=this._frameArray.length,r=t.actions.length;this._frameArray.length+=2+r,this._frameArray[n+0]=e,this._frameArray[n+0+1]=r;for(var s=0;s<r;++s)this._frameArray[n+0+2+s]=t.actions[s];return n},U.prototype._parseZOrderFrame=function(t,e,i){var n=this._parseFrame(t,e,i);if(U.Z_ORDER in t){var r=t[U.Z_ORDER];if(0<r.length){for(var s=this._armature.sortedSlots.length,o=new Array(s-r.length/2),a=new Array(s),l=0;l<o.length;++l)o[l]=0;for(var p=0;p<s;++p)a[p]=-1;for(var h=0,u=0,c=0,d=r.length;c<d;c+=2){for(var _=r[c],y=r[c+1];h!==_;)o[u++]=h++;a[h+y]=h++}for(;h<s;)o[u++]=h++;this._frameArray.length+=1+s;for(var f=this._frameArray[n+1]=s;f--;)-1===a[f]?this._frameArray[n+2+f]=o[--u]||0:this._frameArray[n+2+f]=a[f]||0;return n}}return this._frameArray.length+=1,this._frameArray[n+1]=0,n},U.prototype._parseBoneAllFrame=function(t,e,i){this._helpTransform.identity(),U.TRANSFORM in t&&this._parseTransform(t[U.TRANSFORM],this._helpTransform,1);var n=this._helpTransform.rotation;0!==e&&(n=0===this._prevClockwise?this._prevRotation+G.Transform.normalizeRadian(n-this._prevRotation):((0<this._prevClockwise?n>=this._prevRotation:n<=this._prevRotation)&&(this._prevClockwise=0<this._prevClockwise?this._prevClockwise-1:this._prevClockwise+1),this._prevRotation+n-this._prevRotation+G.Transform.PI_D*this._prevClockwise)),this._prevClockwise=U._getNumber(t,U.TWEEN_ROTATE,0),this._prevRotation=n;var r=this._parseTweenFrame(t,e,i),i=this._frameFloatArray.length;return this._frameFloatArray.length+=6,this._frameFloatArray[i++]=this._helpTransform.x,this._frameFloatArray[i++]=this._helpTransform.y,this._frameFloatArray[i++]=n,this._frameFloatArray[i++]=this._helpTransform.skew,this._frameFloatArray[i++]=this._helpTransform.scaleX,this._frameFloatArray[i++]=this._helpTransform.scaleY,this._parseActionDataInFrame(t,e,this._bone,this._slot),r},U.prototype._parseBoneTranslateFrame=function(t,e,i){e=this._parseTweenFrame(t,e,i),i=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[i++]=U._getNumber(t,U.X,0),this._frameFloatArray[i++]=U._getNumber(t,U.Y,0),e},U.prototype._parseBoneRotateFrame=function(t,e,i){var n=U._getNumber(t,U.ROTATE,0)*G.Transform.DEG_RAD;0!==e&&(n=0===this._prevClockwise?this._prevRotation+G.Transform.normalizeRadian(n-this._prevRotation):((0<this._prevClockwise?n>=this._prevRotation:n<=this._prevRotation)&&(this._prevClockwise=0<this._prevClockwise?this._prevClockwise-1:this._prevClockwise+1),this._prevRotation+n-this._prevRotation+G.Transform.PI_D*this._prevClockwise)),this._prevClockwise=U._getNumber(t,U.CLOCK_WISE,0),this._prevRotation=n;e=this._parseTweenFrame(t,e,i),i=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[i++]=n,this._frameFloatArray[i++]=U._getNumber(t,U.SKEW,0)*G.Transform.DEG_RAD,e},U.prototype._parseBoneScaleFrame=function(t,e,i){e=this._parseTweenFrame(t,e,i),i=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[i++]=U._getNumber(t,U.X,1),this._frameFloatArray[i++]=U._getNumber(t,U.Y,1),e},U.prototype._parseSlotDisplayFrame=function(t,e,i){i=this._parseFrame(t,e,i);return this._frameArray.length+=1,U.VALUE in t?this._frameArray[i+1]=U._getNumber(t,U.VALUE,0):this._frameArray[i+1]=U._getNumber(t,U.DISPLAY_INDEX,0),this._parseActionDataInFrame(t,e,this._slot.parent,this._slot),i},U.prototype._parseSlotColorFrame=function(t,e,i){var i=this._parseTweenFrame(t,e,i),n=-1;if(U.VALUE in t||U.COLOR in t){var r,s=U.VALUE in t?t[U.VALUE]:t[U.COLOR];for(r in s){this._parseColorTransform(s,this._helpColorTransform),n=this._intArray.length,this._intArray.length+=8,this._intArray[n++]=Math.round(100*this._helpColorTransform.alphaMultiplier),this._intArray[n++]=Math.round(100*this._helpColorTransform.redMultiplier),this._intArray[n++]=Math.round(100*this._helpColorTransform.greenMultiplier),this._intArray[n++]=Math.round(100*this._helpColorTransform.blueMultiplier),this._intArray[n++]=Math.round(this._helpColorTransform.alphaOffset),this._intArray[n++]=Math.round(this._helpColorTransform.redOffset),this._intArray[n++]=Math.round(this._helpColorTransform.greenOffset),this._intArray[n++]=Math.round(this._helpColorTransform.blueOffset),n-=8;break}}n<0&&(this._defaultColorOffset<0&&(this._defaultColorOffset=n=this._intArray.length,this._intArray.length+=8,this._intArray[n++]=100,this._intArray[n++]=100,this._intArray[n++]=100,this._intArray[n++]=100,this._intArray[n++]=0,this._intArray[n++]=0,this._intArray[n++]=0,this._intArray[n++]=0),n=this._defaultColorOffset);t=this._frameIntArray.length;return this._frameIntArray.length+=1,this._frameIntArray[t]=n,i},U.prototype._parseSlotFFDFrame=function(t,e,i){var n=this._frameFloatArray.length,i=this._parseTweenFrame(t,e,i),r=U.VERTICES in t?t[U.VERTICES]:null,s=U._getNumber(t,U.OFFSET,0),o=this._intArray[this._mesh.offset+0],a=this._skin.name+"_"+this._slot.name+"_"+this._mesh.name,l=0,p=0,h=0,u=0;null!==this._mesh.weight?(t=this._weightSlotPose[a],this._helpMatrixA.copyFromArray(t,0),this._frameFloatArray.length+=2*this._mesh.weight.count,h=this._mesh.weight.offset+2+this._mesh.weight.bones.length):this._frameFloatArray.length+=2*o;for(var c=0;c<2*o;c+=2)if(p=null===r?l=0:(l=c<s||c-s>=r.length?0:r[c-s],c+1<s||c+1-s>=r.length?0:r[c+1-s]),null!==this._mesh.weight){var d=this._weightBonePoses[a],_=this._intArray[h++];this._helpMatrixA.transformPoint(l,p,this._helpPoint,!0),l=this._helpPoint.x,p=this._helpPoint.y;for(var y=0;y<_;++y){var f=this._intArray[h++];this._helpMatrixB.copyFromArray(d,7*f+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(l,p,this._helpPoint,!0),this._frameFloatArray[n+u++]=this._helpPoint.x,this._frameFloatArray[n+u++]=this._helpPoint.y}}else this._frameFloatArray[n+c]=l,this._frameFloatArray[n+c+1]=p;return 0===e&&(e=this._frameIntArray.length,this._frameIntArray.length+=5,this._frameIntArray[e+0]=this._mesh.offset,this._frameIntArray[e+1]=this._frameFloatArray.length-n,this._frameIntArray[e+2]=this._frameFloatArray.length-n,this._frameIntArray[e+3]=0,this._frameIntArray[e+4]=n,this._timelineArray[this._timeline.offset+3]=e-this._animation.frameIntOffset),i},U.prototype._parseIKConstraintFrame=function(t,e,i){e=this._parseTweenFrame(t,e,i),i=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[i++]=U._getBoolean(t,U.BEND_POSITIVE,!0)?1:0,this._frameIntArray[i++]=Math.round(100*U._getNumber(t,U.WEIGHT,1)),e},U.prototype._parseActionData=function(t,e,i,n){var r=new Array;if("string"==typeof t)(p=G.BaseObject.borrowObject(G.ActionData)).type=e,p.name=t,p.bone=i,p.slot=n,r.push(p);else if(t instanceof Array)for(var s=0,o=t;s<o.length;s++){var a,l=o[s],p=G.BaseObject.borrowObject(G.ActionData);U.GOTO_AND_PLAY in l?(p.type=0,p.name=U._getString(l,U.GOTO_AND_PLAY,"")):(U.TYPE in l&&"string"==typeof l[U.TYPE]?p.type=U._getActionType(l[U.TYPE]):p.type=U._getNumber(l,U.TYPE,e),p.name=U._getString(l,U.NAME,"")),U.BONE in l?(a=U._getString(l,U.BONE,""),p.bone=this._armature.getBone(a)):p.bone=i,U.SLOT in l?(a=U._getString(l,U.SLOT,""),p.slot=this._armature.getSlot(a)):p.slot=n;var h=null;if(U.INTS in l){null===h&&(h=G.BaseObject.borrowObject(G.UserData));for(var u=0,c=l[U.INTS];u<c.length;u++){var d=c[u];h.addInt(d)}}if(U.FLOATS in l){null===h&&(h=G.BaseObject.borrowObject(G.UserData));for(var _=0,y=l[U.FLOATS];_<y.length;_++){d=y[_];h.addFloat(d)}}if(U.STRINGS in l){null===h&&(h=G.BaseObject.borrowObject(G.UserData));for(var f=0,m=l[U.STRINGS];f<m.length;f++){d=m[f];h.addString(d)}}p.data=h,r.push(p)}return r},U.prototype._parseTransform=function(t,e,i){e.x=U._getNumber(t,U.X,0)*i,e.y=U._getNumber(t,U.Y,0)*i,U.ROTATE in t||U.SKEW in t?(e.rotation=G.Transform.normalizeRadian(U._getNumber(t,U.ROTATE,0)*G.Transform.DEG_RAD),e.skew=G.Transform.normalizeRadian(U._getNumber(t,U.SKEW,0)*G.Transform.DEG_RAD)):(U.SKEW_X in t||U.SKEW_Y in t)&&(e.rotation=G.Transform.normalizeRadian(U._getNumber(t,U.SKEW_Y,0)*G.Transform.DEG_RAD),e.skew=G.Transform.normalizeRadian(U._getNumber(t,U.SKEW_X,0)*G.Transform.DEG_RAD)-e.rotation),e.scaleX=U._getNumber(t,U.SCALE_X,1),e.scaleY=U._getNumber(t,U.SCALE_Y,1)},U.prototype._parseColorTransform=function(t,e){e.alphaMultiplier=.01*U._getNumber(t,U.ALPHA_MULTIPLIER,100),e.redMultiplier=.01*U._getNumber(t,U.RED_MULTIPLIER,100),e.greenMultiplier=.01*U._getNumber(t,U.GREEN_MULTIPLIER,100),e.blueMultiplier=.01*U._getNumber(t,U.BLUE_MULTIPLIER,100),e.alphaOffset=U._getNumber(t,U.ALPHA_OFFSET,0),e.redOffset=U._getNumber(t,U.RED_OFFSET,0),e.greenOffset=U._getNumber(t,U.GREEN_OFFSET,0),e.blueOffset=U._getNumber(t,U.BLUE_OFFSET,0)},U.prototype._parseArray=function(t){this._intArray.length=0,this._floatArray.length=0,this._frameIntArray.length=0,this._frameFloatArray.length=0,this._frameArray.length=0,this._timelineArray.length=0},U.prototype._modifyArray=function(){this._intArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._intArray.push(0),this._frameIntArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameIntArray.push(0),this._frameArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameArray.push(0),this._timelineArray.length%Uint16Array.BYTES_PER_ELEMENT!=0&&this._timelineArray.push(0);var t=this._intArray.length*Int16Array.BYTES_PER_ELEMENT,e=this._floatArray.length*Float32Array.BYTES_PER_ELEMENT,i=this._frameIntArray.length*Int16Array.BYTES_PER_ELEMENT,n=this._frameFloatArray.length*Float32Array.BYTES_PER_ELEMENT,r=this._frameArray.length*Int16Array.BYTES_PER_ELEMENT,s=this._timelineArray.length*Uint16Array.BYTES_PER_ELEMENT,o=t+e+i+n+r+s;if(G.DragonBones.webAssembly){for(var a=G.webAssemblyModule.HEAP16.buffer,l=G.webAssemblyModule._malloc(o),p=new Int16Array(a,l,this._intArray.length),h=new Float32Array(a,l+t,this._floatArray.length),u=new Int16Array(a,l+t+e,this._frameIntArray.length),c=new Float32Array(a,l+t+e+i,this._frameFloatArray.length),d=new Int16Array(a,l+t+e+i+n,this._frameArray.length),_=new Uint16Array(a,l+t+e+i+n+r,this._timelineArray.length),y=0,f=this._intArray.length;y<f;++y)p[y]=this._intArray[y];for(y=0,f=this._floatArray.length;y<f;++y)h[y]=this._floatArray[y];for(y=0,f=this._frameIntArray.length;y<f;++y)u[y]=this._frameIntArray[y];for(y=0,f=this._frameFloatArray.length;y<f;++y)c[y]=this._frameFloatArray[y];for(y=0,f=this._frameArray.length;y<f;++y)d[y]=this._frameArray[y];for(y=0,f=this._timelineArray.length;y<f;++y)_[y]=this._timelineArray[y];G.webAssemblyModule.setDataBinary(this._data,l,t,e,i,n,r,s)}else{for(o=new ArrayBuffer(o),p=new Int16Array(o,0,this._intArray.length),h=new Float32Array(o,t,this._floatArray.length),u=new Int16Array(o,t+e,this._frameIntArray.length),c=new Float32Array(o,t+e+i,this._frameFloatArray.length),d=new Int16Array(o,t+e+i+n,this._frameArray.length),_=new Uint16Array(o,t+e+i+n+r,this._timelineArray.length),y=0,f=this._intArray.length;y<f;++y)p[y]=this._intArray[y];for(y=0,f=this._floatArray.length;y<f;++y)h[y]=this._floatArray[y];for(y=0,f=this._frameIntArray.length;y<f;++y)u[y]=this._frameIntArray[y];for(y=0,f=this._frameFloatArray.length;y<f;++y)c[y]=this._frameFloatArray[y];for(y=0,f=this._frameArray.length;y<f;++y)d[y]=this._frameArray[y];for(y=0,f=this._timelineArray.length;y<f;++y)_[y]=this._timelineArray[y];this._data.binary=o,this._data.intArray=p,this._data.floatArray=h,this._data.frameIntArray=u,this._data.frameFloatArray=c,this._data.frameArray=d,this._data.timelineArray=_}this._defaultColorOffset=-1},U.prototype.parseDragonBonesData=function(t,e){void 0===e&&(e=1),console.assert(null!=t,"Data error.");var i=U._getString(t,U.VERSION,""),n=U._getString(t,U.COMPATIBLE_VERSION,"");if(0<=U.DATA_VERSIONS.indexOf(i)||0<=U.DATA_VERSIONS.indexOf(n)){var r=G.BaseObject.borrowObject(G.DragonBonesData);if(r.version=i,r.name=U._getString(t,U.NAME,""),r.frameRate=U._getNumber(t,U.FRAME_RATE,24),0===r.frameRate&&(r.frameRate=24),U.ARMATURE in t){this._data=r,this._parseArray(t);for(var s=0,o=t[U.ARMATURE];s<o.length;s++){var a=o[s];r.addArmature(this._parseArmature(a,e))}this._data.binary||this._modifyArray(),U.STAGE in t?r.stage=r.getArmature(U._getString(t,U.STAGE,"")):0<r.armatureNames.length&&(r.stage=r.getArmature(r.armatureNames[0])),this._data=null}return U.TEXTURE_ATLAS in t&&(this._rawTextureAtlases=t[U.TEXTURE_ATLAS]),r}return console.assert(!1,"Nonsupport data version: "+i+"\nPlease convert DragonBones data to support version.\nRead more: https://github.com/DragonBones/Tools/"),null},U.prototype.parseTextureAtlasData=function(t,e,i){if(void 0===i&&(i=1),console.assert(void 0!==t),null===t){if(null===this._rawTextureAtlases||0===this._rawTextureAtlases.length)return!1;var n=this._rawTextureAtlases[this._rawTextureAtlasIndex++];return this.parseTextureAtlasData(n,e,i),this._rawTextureAtlasIndex>=this._rawTextureAtlases.length&&(this._rawTextureAtlasIndex=0,this._rawTextureAtlases=null),!0}if(e.width=U._getNumber(t,U.WIDTH,0),e.height=U._getNumber(t,U.HEIGHT,0),e.scale=1===i?1/U._getNumber(t,U.SCALE,1):i,e.name=U._getString(t,U.NAME,""),e.imagePath=U._getString(t,U.IMAGE_PATH,""),U.SUB_TEXTURE in t)for(var r=t[U.SUB_TEXTURE],s=0,o=r.length;s<o;++s){var a=r[s],l=e.createTexture();l.rotated=U._getBoolean(a,U.ROTATED,!1),l.name=U._getString(a,U.NAME,""),l.region.x=U._getNumber(a,U.X,0),l.region.y=U._getNumber(a,U.Y,0),l.region.width=U._getNumber(a,U.WIDTH,0),l.region.height=U._getNumber(a,U.HEIGHT,0);var p=U._getNumber(a,U.FRAME_WIDTH,-1),h=U._getNumber(a,U.FRAME_HEIGHT,-1);0<p&&0<h&&(l.frame=G.TextureData.createRectangle(),l.frame.x=U._getNumber(a,U.FRAME_X,0),l.frame.y=U._getNumber(a,U.FRAME_Y,0),l.frame.width=p,l.frame.height=h),e.addTexture(l)}return!0},U.getInstance=function(){return null===U._objectDataParserInstance&&(U._objectDataParserInstance=new U),U._objectDataParserInstance},U._objectDataParserInstance=null,U);function U(){var t=null!==e&&e.apply(this,arguments)||this;return t._rawTextureAtlasIndex=0,t._rawBones=[],t._data=null,t._armature=null,t._bone=null,t._slot=null,t._skin=null,t._mesh=null,t._animation=null,t._timeline=null,t._rawTextureAtlases=null,t._defaultColorOffset=-1,t._prevClockwise=0,t._prevRotation=0,t._helpMatrixA=new G.Matrix,t._helpMatrixB=new G.Matrix,t._helpTransform=new G.Transform,t._helpColorTransform=new G.ColorTransform,t._helpPoint=new G.Point,t._helpArray=[],t._intArray=[],t._floatArray=[],t._frameIntArray=[],t._frameFloatArray=[],t._frameArray=[],t._timelineArray=[],t._actionFrames=[],t._weightSlotPose={},t._weightBonePoses={},t._cacheBones={},t._cacheMeshs={},t._slotChildActions={},t}G.ObjectDataParser=t;var g=function(){this.frameStart=0,this.actions=[]};G.ActionFrame=g}(dragonBones=dragonBones||{}),function(x){var r,t=(r=x.ObjectDataParser,__extends(e,r),e.prototype._inRange=function(t,e,i){return e<=t&&t<=i},e.prototype._decodeUTF8=function(t){for(var e=0,i="",n=0,r=0,s=0,o=0;t.length>e;){var a,l,p=t[e++];null!==(p=-1===p?0!==r?65533:-1:0===r?this._inRange(p,0,127)?p:(this._inRange(p,194,223)?(r=1,o=128,n=p-192):this._inRange(p,224,239)?(r=2,o=2048,n=p-224):this._inRange(p,240,244)&&(r=3,o=65536,n=p-240),n*=Math.pow(64,r),null):this._inRange(p,128,191)?(s+=1,n+=(p-128)*Math.pow(64,r-s),s!==r?null:(a=n,l=o,o=s=r=n=0,this._inRange(a,l,1114111)&&!this._inRange(a,55296,57343)?a:p)):(o=s=r=n=0,e--,p))&&-1!==p&&(p<=65535?0<p&&(i+=String.fromCharCode(p)):(p-=65536,i+=String.fromCharCode(55296+(p>>10&1023)),i+=String.fromCharCode(56320+(1023&p))))}return i},e.prototype._getUTF16Key=function(t){for(var e=0,i=t.length;e<i;++e)if(255<t.charCodeAt(e))return encodeURI(t);return t},e.prototype._parseBinaryTimeline=function(t,e,i){void 0===i&&(i=null);var n=null!==i?i:x.BaseObject.borrowObject(x.TimelineData);n.type=t,n.offset=e,this._timeline=n;var r=this._timelineArrayBuffer[n.offset+2];if(1===r)n.frameIndicesOffset=-1;else{var s=0,o=this._animation.frameCount+1,a=this._data.frameIndices;x.DragonBones.webAssembly?(s=a.size(),a.resize(s+o,0)):(s=a.length,a.length+=o),n.frameIndicesOffset=s;for(var l=0,p=0,h=0,u=0;l<o;++l)h+u<=l&&p<r&&(h=this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[n.offset+5+p]],u=p===r-1?this._animation.frameCount-h:this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[n.offset+5+p+1]]-h,p++),x.DragonBones.webAssembly?a.set(s+l,p-1):a[s+l]=p-1}return this._timeline=null,n},e.prototype._parseMesh=function(t,e){e.offset=t[x.ObjectDataParser.OFFSET];var i=this._intArrayBuffer[e.offset+3];if(0<=i){var n=x.BaseObject.borrowObject(x.WeightData),t=this._intArrayBuffer[e.offset+0],r=this._intArrayBuffer[i+0];n.offset=i;for(var s=0;s<r;++s){var o=this._intArrayBuffer[i+2+s];n.addBone(this._rawBones[o])}for(var a=i+2+r,l=0,s=0,p=t;s<p;++s){var h=this._intArrayBuffer[a++];l+=h,a+=h}n.count=l,e.weight=n}},e.prototype._parseAnimation=function(t){var e=x.BaseObject.borrowObject(x.AnimationData);e.frameCount=Math.max(x.ObjectDataParser._getNumber(t,x.ObjectDataParser.DURATION,1),1),e.playTimes=x.ObjectDataParser._getNumber(t,x.ObjectDataParser.PLAY_TIMES,1),e.duration=e.frameCount/this._armature.frameRate,e.fadeInTime=x.ObjectDataParser._getNumber(t,x.ObjectDataParser.FADE_IN_TIME,0),e.scale=x.ObjectDataParser._getNumber(t,x.ObjectDataParser.SCALE,1),e.name=x.ObjectDataParser._getString(t,x.ObjectDataParser.NAME,x.ObjectDataParser.DEFAULT_NAME),0===e.name.length&&(e.name=x.ObjectDataParser.DEFAULT_NAME);var i,n,r=t[x.ObjectDataParser.OFFSET];if(e.frameIntOffset=r[0],e.frameFloatOffset=r[1],e.frameOffset=r[2],this._animation=e,x.ObjectDataParser.ACTION in t&&(e.actionTimeline=this._parseBinaryTimeline(0,t[x.ObjectDataParser.ACTION])),x.ObjectDataParser.Z_ORDER in t&&(e.zOrderTimeline=this._parseBinaryTimeline(1,t[x.ObjectDataParser.Z_ORDER])),x.ObjectDataParser.BONE in t)for(n in i=t[x.ObjectDataParser.BONE]){var s=i[n];x.DragonBones.webAssembly&&(n=this._getUTF16Key(n));var o=this._armature.getBone(n);if(null!==o)for(var a=0,l=s.length;a<l;a+=2){var p=s[a],h=s[a+1],u=this._parseBinaryTimeline(p,h);this._animation.addBoneTimeline(o,u)}}if(x.ObjectDataParser.SLOT in t)for(n in i=t[x.ObjectDataParser.SLOT]){s=i[n];x.DragonBones.webAssembly&&(n=this._getUTF16Key(n));var c=this._armature.getSlot(n);if(null!==c)for(a=0,l=s.length;a<l;a+=2){p=s[a],h=s[a+1],u=this._parseBinaryTimeline(p,h);this._animation.addSlotTimeline(c,u)}}if(x.ObjectDataParser.CONSTRAINT in t)for(n in i=t[x.ObjectDataParser.CONSTRAINT]){s=i[n];x.DragonBones.webAssembly&&(n=this._getUTF16Key(n));var d=this._armature.getConstraint(n);if(null!==d)for(a=0,l=s.length;a<l;a+=2){p=s[a],h=s[a+1],u=this._parseBinaryTimeline(p,h);this._animation.addConstraintTimeline(d,u)}}return this._animation=null,e},e.prototype._parseArray=function(t){var e=t[x.ObjectDataParser.OFFSET],i=e[1],n=e[3],r=e[5],s=e[7],o=e[9],a=e[11],l=new Int16Array(this._binary,this._binaryOffset+e[0],i/Int16Array.BYTES_PER_ELEMENT),p=new Float32Array(this._binary,this._binaryOffset+e[2],n/Float32Array.BYTES_PER_ELEMENT),h=new Int16Array(this._binary,this._binaryOffset+e[4],r/Int16Array.BYTES_PER_ELEMENT),u=new Float32Array(this._binary,this._binaryOffset+e[6],s/Float32Array.BYTES_PER_ELEMENT),c=new Int16Array(this._binary,this._binaryOffset+e[8],o/Int16Array.BYTES_PER_ELEMENT),d=new Uint16Array(this._binary,this._binaryOffset+e[10],a/Uint16Array.BYTES_PER_ELEMENT);if(x.DragonBones.webAssembly){for(var t=i+n+r+s+o+a,e=x.webAssemblyModule._malloc(t),_=new Uint8Array(this._binary,this._binaryOffset,t/Uint8Array.BYTES_PER_ELEMENT),y=new Uint8Array(x.webAssemblyModule.HEAP16.buffer,e,_.length),f=0,m=_.length;f<m;++f)y[f]=_[f];x.webAssemblyModule.setDataBinary(this._data,e,i,n,r,s,o,a),this._intArrayBuffer=l,this._floatArrayBuffer=p,this._frameIntArrayBuffer=h,this._frameFloatArrayBuffer=u,this._frameArrayBuffer=c,this._timelineArrayBuffer=d}else this._data.binary=this._binary,this._data.intArray=this._intArrayBuffer=l,this._data.floatArray=this._floatArrayBuffer=p,this._data.frameIntArray=this._frameIntArrayBuffer=h,this._data.frameFloatArray=this._frameFloatArrayBuffer=u,this._data.frameArray=this._frameArrayBuffer=c,this._data.timelineArray=this._timelineArrayBuffer=d},e.prototype.parseDragonBonesData=function(t,e){void 0===e&&(e=1),console.assert(null!=t&&t instanceof ArrayBuffer,"Data error.");var i=new Uint8Array(t,0,8);if(i[0]!=="D".charCodeAt(0)||i[1]!=="B".charCodeAt(0)||i[2]!=="D".charCodeAt(0)||i[3]!=="T".charCodeAt(0))return console.assert(!1,"Nonsupport data."),null;var n=new Uint32Array(t,8,1)[0],i=new Uint8Array(t,12,n),i=this._decodeUTF8(i),i=JSON.parse(i);return this._binaryOffset=12+n,this._binary=t,r.prototype.parseDragonBonesData.call(this,i,e)},e.getInstance=function(){return null===e._binaryDataParserInstance&&(e._binaryDataParserInstance=new e),e._binaryDataParserInstance},e._binaryDataParserInstance=null,e);function e(){return null!==r&&r.apply(this,arguments)||this}x.BinaryDataParser=t}(dragonBones=dragonBones||{}),function(y){var t=(s.prototype._isSupportMesh=function(){return!0},s.prototype._getTextureData=function(t,e){if(t in this._textureAtlasDataMap)for(var i=0,n=this._textureAtlasDataMap[t];i<n.length;i++)if(null!==(a=(l=n[i]).getTexture(e)))return a;if(this.autoSearch)for(var r in this._textureAtlasDataMap)for(var s=0,o=this._textureAtlasDataMap[r];s<o.length;s++){var a,l=o[s];if(l.autoSearch)if(null!==(a=l.getTexture(e)))return a}return null},s.prototype._fillBuildArmaturePackage=function(t,e,i,n,r){var s=null,o=null;if(0<e.length&&e in this._dragonBonesDataMap&&(o=(s=this._dragonBonesDataMap[e]).getArmature(i)),null===o&&(0===e.length||this.autoSearch))for(var a in this._dragonBonesDataMap)if(s=this._dragonBonesDataMap[a],(0===e.length||s.autoSearch)&&null!==(o=s.getArmature(i))){e=a;break}if(null===o)return!1;if(t.dataName=e,t.textureAtlasName=r,t.data=s,t.armature=o,t.skin=null,0<n.length&&(t.skin=o.getSkin(n),null===t.skin&&this.autoSearch))for(var a in this._dragonBonesDataMap){var l=this._dragonBonesDataMap[a].getArmature(n);if(null!==l){t.skin=l.defaultSkin;break}}return null===t.skin&&(t.skin=o.defaultSkin),!0},s.prototype._buildBones=function(t,e){for(var i=0,n=t.armature.sortedBones;i<n.length;i++){var r=n[i],s=y.BaseObject.borrowObject(y.Bone);s.init(r),null!==r.parent?e.addBone(s,r.parent.name):e.addBone(s,"")}var o,a=t.armature.constraints;for(o in a){var l=a[o],p=y.BaseObject.borrowObject(y.IKConstraint);p.init(l,e),e.addConstraint(p)}},s.prototype._buildSlots=function(t,e){var i=t.skin,n=t.armature.defaultSkin;if(null!==i&&null!==n){var r={};for(o in n.displays){var s=n.getDisplays(o);r[o]=s}if(i!==n)for(var o in i.displays){s=i.getDisplays(o);r[o]=s}for(var a=0,l=t.armature.sortedSlots;a<l.length;a++){var p=l[a],s=p.name in r?r[p.name]:null,h=this._buildSlot(t,p,s,e);if(e.addSlot(h,p.parent.name),null!==s){for(var u=new Array,c=0,d=y.DragonBones.webAssembly?s.size():s.length;c<d;++c){var _=y.DragonBones.webAssembly?s.get(c):s[c];null!==_?u.push(this._getSlotDisplay(t,_,null,h)):u.push(null)}h._setDisplayList(u)}h._setDisplayIndex(p.displayIndex,!0)}}},s.prototype._buildChildArmature=function(t,e,i){return this.buildArmature(i.path,null!==t?t.dataName:"","",null!==t?t.textureAtlasName:"")},s.prototype._getSlotDisplay=function(t,e,i,n){var r=null!==t?t.dataName:e.parent.parent.parent.name,s=null;switch(e.type){case 0:var o=e;null===o.texture?o.texture=this._getTextureData(r,e.path):null!==t&&0<t.textureAtlasName.length&&(o.texture=this._getTextureData(t.textureAtlasName,e.path)),s=null!==i&&2===i.type&&this._isSupportMesh()?n.meshDisplay:n.rawDisplay;break;case 2:var a=e;null===a.texture?a.texture=this._getTextureData(r,a.path):null!==t&&0<t.textureAtlasName.length&&(a.texture=this._getTextureData(t.textureAtlasName,a.path)),s=this._isSupportMesh()?n.meshDisplay:n.rawDisplay;break;case 1:var o=e,l=this._buildChildArmature(t,n,e);if(null!==l){if(l.inheritAnimation=o.inheritAnimation,!l.inheritAnimation){a=0<o.actions.length?o.actions:l.armatureData.defaultActions;if(0<a.length)for(var p=0,h=a;p<h.length;p++){var u=h[p];l._bufferAction(u,!0)}else l.animation.play()}o.armature=l.armatureData}s=l}return s},s.prototype.parseDragonBonesData=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=1);for(var n=t instanceof ArrayBuffer?s._binaryParser:this._dataParser,t=n.parseDragonBonesData(t,i);;){var r=this._buildTextureAtlasData(null,null);if(!n.parseTextureAtlasData(null,r,i)){r.returnToPool();break}this.addTextureAtlasData(r,e)}return null!==t&&this.addDragonBonesData(t,e),t},s.prototype.parseTextureAtlasData=function(t,e,i,n){void 0===i&&(i=null),void 0===n&&(n=1);var r=this._buildTextureAtlasData(null,null);return this._dataParser.parseTextureAtlasData(t,r,n),this._buildTextureAtlasData(r,e||null),this.addTextureAtlasData(r,i),r},s.prototype.updateTextureAtlasData=function(t,e){var i=this.getTextureAtlasData(t);if(null!==i)for(var n=0,r=i.length;n<r;++n)n<e.length&&this._buildTextureAtlasData(i[n],e[n])},s.prototype.getDragonBonesData=function(t){return t in this._dragonBonesDataMap?this._dragonBonesDataMap[t]:null},s.prototype.addDragonBonesData=function(t,e){if(void 0===e&&(e=null),(e=null!==e?e:t.name)in this._dragonBonesDataMap)return this._dragonBonesDataMap[e]===t?void 0:void console.warn("Can not add same name data: "+e);this._dragonBonesDataMap[e]=t},s.prototype.removeDragonBonesData=function(t,e){void 0===e&&(e=!0),t in this._dragonBonesDataMap&&(e&&this._dragonBones.bufferObject(this._dragonBonesDataMap[t]),delete this._dragonBonesDataMap[t])},s.prototype.getTextureAtlasData=function(t){return t in this._textureAtlasDataMap?this._textureAtlasDataMap[t]:null},s.prototype.addTextureAtlasData=function(t,e){void 0===e&&(e=null);e=(e=null!==e?e:t.name)in this._textureAtlasDataMap?this._textureAtlasDataMap[e]:this._textureAtlasDataMap[e]=[];e.indexOf(t)<0&&e.push(t)},s.prototype.removeTextureAtlasData=function(t,e){if(void 0===e&&(e=!0),t in this._textureAtlasDataMap){var i=this._textureAtlasDataMap[t];if(e)for(var n=0,r=i;n<r.length;n++){var s=r[n];this._dragonBones.bufferObject(s)}delete this._textureAtlasDataMap[t]}},s.prototype.getArmatureData=function(t,e){void 0===e&&(e="");var i=new o;return this._fillBuildArmaturePackage(i,e,t,"","")?i.armature:null},s.prototype.clear=function(t){for(var e in void 0===t&&(t=!0),this._dragonBonesDataMap)t&&this._dragonBones.bufferObject(this._dragonBonesDataMap[e]),delete this._dragonBonesDataMap[e];for(var e in this._textureAtlasDataMap){if(t)for(var i=0,n=this._textureAtlasDataMap[e];i<n.length;i++){var r=n[i];this._dragonBones.bufferObject(r)}delete this._textureAtlasDataMap[e]}},s.prototype.buildArmature=function(t,e,i,n){void 0===e&&(e=""),void 0===i&&(i=""),void 0===n&&(n="");var r=new o;if(!this._fillBuildArmaturePackage(r,e||"",t,i||"",n||""))return console.warn("No armature data: "+t+", "+(null!==e?e:"")),null;e=this._buildArmature(r);return this._buildBones(r,e),this._buildSlots(r,e),e.invalidUpdate(null,!0),e.advanceTime(0),e},s.prototype.replaceDisplay=function(t,e,i){void 0===i&&(i=-1),i<0&&(i=t.displayIndex),i<0&&(i=0),t.replaceDisplayData(e,i);var n,r,s=t.displayList;if(s.length<=i){s.length=i+1;for(var o=0,a=s.length;o<a;++o)s[o]||(s[o]=null)}null!==e?(r=null,(n=t.rawDisplayDatas)&&(y.DragonBones.webAssembly?i<n.size()&&(r=n.get(i)):i<n.length&&(r=n[i])),s[i]=this._getSlotDisplay(null,e,r,t)):s[i]=null,t.displayList=s},s.prototype.replaceSlotDisplay=function(t,e,i,n,r,s){void 0===s&&(s=-1);t=this.getArmatureData(e,t||"");if(!t||!t.defaultSkin)return!1;n=t.defaultSkin.getDisplay(i,n);return!!n&&(this.replaceDisplay(r,n,s),!0)},s.prototype.replaceSlotDisplayList=function(t,e,i,n){t=this.getArmatureData(e,t||"");if(!t||!t.defaultSkin)return!1;var r=t.defaultSkin.getDisplays(i);if(!r)return!1;for(var s=0,o=0,a=y.DragonBones.webAssembly?r.size():r.length;o<a;++o){var l=y.DragonBones.webAssembly?r.get(o):r[o];this.replaceDisplay(n,l,s++)}return!0},s.prototype.replaceSkin=function(t,e,i,n){void 0===i&&(i=!1),void 0===n&&(n=null);for(var r=!1,s=0,o=t.getSlots();s<o.length;s++){var a=o[s];if(!(null!==n&&0<=n.indexOf(a.name))){var l=e.getDisplays(a.name);if(l){for(var p=y.DragonBones.webAssembly?l.size():l.length,h=a.displayList,u=0,c=h.length=p;u<c;++u){var d=y.DragonBones.webAssembly?l.get(u):l[u];h[u]=null!==d?this._getSlotDisplay(null,d,null,a):null}r=!0,a.rawDisplayDatas=l,a.displayList=h}else i&&(a.rawDisplayDatas=null,a.displayList=[])}}return r},s.prototype.replaceAnimation=function(t,e,i){void 0===i&&(i=!0);var n=e.defaultSkin;if(null===n)return!1;if(i)t.animation.animations=e.animations;else{var r,s=t.animation.animations,o={};for(r in s)o[r]=s[r];for(r in e.animations)o[r]=e.animations[r];t.animation.animations=o}for(var a=0,l=t.getSlots();a<l.length;a++)for(var p=l[a],h=0,u=0,c=p.displayList;u<c.length;u++){var d,_=c[u];_ instanceof y.Armature&&(null!==(d=n.getDisplays(p.name))&&h<(y.DragonBones.webAssembly?d.size():d.length)&&(null===(d=y.DragonBones.webAssembly?d.get(h):d[h])||1!==d.type||(d=this.getArmatureData(d.path,d.parent.parent.parent.name))&&this.replaceAnimation(_,d,i))),h++}return!0},s.prototype.getAllDragonBonesData=function(){return this._dragonBonesDataMap},s.prototype.getAllTextureAtlasData=function(){return this._textureAtlasDataMap},Object.defineProperty(s.prototype,"clock",{get:function(){return this._dragonBones.clock},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"dragonBones",{get:function(){return this._dragonBones},enumerable:!0,configurable:!0}),s.prototype.changeSkin=function(t,e,i){return void 0===i&&(i=null),this.replaceSkin(t,e,!1,i)},s.prototype.copyAnimationsToArmature=function(t,e,i,n,r){void 0===i&&(i=""),void 0===n&&(n=""),void 0===r&&(r=!0);n=this.getArmatureData(e,n);return!!n&&this.replaceAnimation(t,n,r)},s._objectParser=null,s._binaryParser=null,s);function s(t){void 0===t&&(t=null),this.autoSearch=!1,this._dragonBonesDataMap={},this._textureAtlasDataMap={},this._dragonBones=null,(this._dataParser=null)===s._objectParser&&(s._objectParser=new y.ObjectDataParser),null===s._binaryParser&&(s._binaryParser=new y.BinaryDataParser),this._dataParser=null!==t?t:s._objectParser}y.BaseFactory=t;var o=function(){this.dataName="",this.textureAtlasName="",this.skin=null};y.BuildArmaturePackage=o}(dragonBones=dragonBones||{}),function(t){var e,i=(e=t.TextureAtlasData,__extends(n,e),n.toString=function(){return"[class dragonBones.PhaserTextureAtlasData]"},n.prototype._onClear=function(){e.prototype._onClear.call(this),this._renderTexture,this._renderTexture=null},n.prototype.createTexture=function(){return t.BaseObject.borrowObject(s)},Object.defineProperty(n.prototype,"renderTexture",{get:function(){return this._renderTexture},set:function(t){if(this._renderTexture!==t)if(this._renderTexture=t,null!==this._renderTexture)for(var e in this.textures)(i=this.textures[e]).renderTexture=new PIXI.Texture(this._renderTexture,i.region,i.region,new PIXI.Rectangle(0,0,i.region.width,i.region.height));else for(var e in this.textures){var i;(i=this.textures[e]).renderTexture=null}},enumerable:!0,configurable:!0}),n);function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._renderTexture=null,t}t.PhaserTextureAtlasData=i;var r,s=(r=t.TextureData,__extends(o,r),o.toString=function(){return"[class dragonBones.PhaserTextureData]"},o.prototype._onClear=function(){r.prototype._onClear.call(this),null!==this.renderTexture&&this.renderTexture.destroy(!1),this.renderTexture=null},o);function o(){var t=null!==r&&r.apply(this,arguments)||this;return t.renderTexture=null,t}t.PhaserTextureData=s}(dragonBones=dragonBones||{}),function(h){var i,t=(i=Phaser.Sprite,__extends(e,i),e.prototype.dbInit=function(t){this._armature=t},e.prototype.dbClear=function(){for(var t in this._signals){var e=this._signals[t];e.removeAll(),e.dispose(),delete this._signals[t]}this._disposeProxy=!1,this._armature=null,i.prototype.destroy.call(this,!1)},e.prototype.dbUpdate=function(){var t=h.DragonBones.debugDraw;(t||this._debugDraw)&&(this._debugDraw=t)},e.prototype.dispose=function(t){void 0===t&&(t=!0),this._disposeProxy=t,null!==this._armature&&(this._armature.dispose(),this._armature=null)},e.prototype.destroy=function(){this.dispose()},e.prototype.dispatchDBEvent=function(t,e){t in this._signals||(this._signals[t]=new Phaser.Signal),this._signals[t].dispatch(e)},e.prototype.hasDBEventListener=function(t){return t in this._signals&&0<this._signals[t].getNumListeners()},e.prototype.addDBEventListener=function(t,e,i){t in this._signals||(this._signals[t]=new Phaser.Signal),this._signals[t].add(e,i)},e.prototype.removeDBEventListener=function(t,e,i){t in this._signals&&this._signals[t].remove(e,i)},Object.defineProperty(e.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0}),e.prototype.hasEvent=function(t){return this.hasDBEventListener(t)},e.prototype.addEvent=function(t,e,i){this.addDBEventListener(t,e,i)},e.prototype.removeEvent=function(t,e,i){this.removeDBEventListener(t,e,i)},e);function e(){var t=i.call(this,h.PhaserFactory._game,0,0)||this;return t._debugDraw=!1,t._disposeProxy=!1,t._armature=null,t._signals={},t}h.PhaserArmatureDisplay=t,Phaser.Image.prototype.updateTransform=function(t){if(!t&&!this.parent&&!this.game)return this;var e=this.parent;t?e=t:this.parent||(e=this.game.world);var i,n,r,s,o,a=e.worldTransform,t=this.worldTransform;this.rotation%Phaser.Math.PI2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),o=(s=.01<(p=this.skew%h.Transform.PI_D)||p<-.01?(i=this._cr*this.scale.x,n=this._sr*this.scale.x,r=-Math.sin(p+this.rotation)*this.scale.y,Math.cos(p+this.rotation)*this.scale.y):(i=this._cr*this.scale.x,n=this._sr*this.scale.x,r=-this._sr*this.scale.y,this._cr*this.scale.y),this.position.x),p=this.position.y,(this.pivot.x||this.pivot.y)&&(o-=this.pivot.x*i+this.pivot.y*r,p-=this.pivot.x*n+this.pivot.y*s),t.a=i*a.a+n*a.c,t.b=i*a.b+n*a.d,t.c=r*a.a+s*a.c,t.d=r*a.b+s*a.d):(i=this.scale.x,r=n=0,s=this.scale.y,o=this.position.x-this.pivot.x*i,p=this.position.y-this.pivot.y*s,t.a=i*a.a,t.b=i*a.b,t.c=s*a.c,t.d=s*a.d),t.tx=o*a.a+p*a.c+a.tx,t.ty=o*a.b+p*a.d+a.ty,i=t.a,n=t.b,r=t.c;var l,p=i*(s=t.d)-n*r;return i||n?(l=Math.sqrt(i*i+n*n),this.worldRotation=0<n?Math.acos(i/l):-Math.acos(i/l),this.worldScale.x=l,this.worldScale.y=p/l):r||s?(l=Math.sqrt(r*r+s*s),this.worldRotation=Phaser.Math.HALF_PI-(0<s?Math.acos(-r/l):-Math.acos(r/l)),this.worldScale.x=p/l,this.worldScale.y=l):(this.worldScale.x=0,this.worldScale.y=0),this.worldAlpha=this.alpha*e.worldAlpha,this.worldPosition.x=t.tx,this.worldPosition.y=t.ty,this._currentBounds=null,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,t,a),this}}(dragonBones=dragonBones||{}),function(r){var t,e=(t=r.Slot,__extends(i,t),i.toString=function(){return"[class dragonBones.PhaserSlot]"},i.prototype._onClear=function(){t.prototype._onClear.call(this),this._textureScale=1,this._renderDisplay=null},i.prototype._initDisplay=function(t){},i.prototype._disposeDisplay=function(t){t.destroy(!0)},i.prototype._onUpdateDisplay=function(){this._renderDisplay=this._display||this._rawDisplay},i.prototype._addDisplay=function(){this._armature.display.addChild(this._renderDisplay)},i.prototype._replaceDisplay=function(t){var e=this._armature.display,t=t;e.addChild(this._renderDisplay),e.swapChildren(this._renderDisplay,t),e.removeChild(t),this._textureScale=1},i.prototype._removeDisplay=function(){this._renderDisplay.parent.removeChild(this._renderDisplay)},i.prototype._updateZOrder=function(){var t=this._armature.display;t.getChildIndex(this._renderDisplay)!==this._zOrder&&t.addChildAt(this._renderDisplay,this._zOrder)},i.prototype._updateVisible=function(){this._renderDisplay.visible=this._parent.visible&&this._visible},i.prototype._updateBlendMode=function(){if(this._renderDisplay instanceof PIXI.Sprite)switch(this._blendMode){case 0:this._renderDisplay.blendMode=PIXI.blendModes.NORMAL;break;case 1:this._renderDisplay.blendMode=PIXI.blendModes.ADD;break;case 3:this._renderDisplay.blendMode=PIXI.blendModes.DARKEN;break;case 4:this._renderDisplay.blendMode=PIXI.blendModes.DIFFERENCE;break;case 6:this._renderDisplay.blendMode=PIXI.blendModes.HARD_LIGHT;break;case 9:this._renderDisplay.blendMode=PIXI.blendModes.LIGHTEN;break;case 10:this._renderDisplay.blendMode=PIXI.blendModes.MULTIPLY;break;case 11:this._renderDisplay.blendMode=PIXI.blendModes.OVERLAY;break;case 12:this._renderDisplay.blendMode=PIXI.blendModes.SCREEN}},i.prototype._updateColor=function(){var t;this._renderDisplay.alpha=this._colorTransform.alphaMultiplier,this._renderDisplay instanceof PIXI.Sprite&&(t=(Math.round(255*this._colorTransform.redMultiplier)<<16)+(Math.round(255*this._colorTransform.greenMultiplier)<<8)+Math.round(255*this._colorTransform.blueMultiplier),this._renderDisplay.tint=t)},i.prototype._updateFrame=function(){var t=this._display===this._meshDisplay?this._meshData:null,e=this._textureData;if(0<=this._displayIndex&&null!==this._display&&null!==e){var i=e.parent;null!==this._armature.replacedTexture&&null!==this._rawDisplayDatas&&0<=this._rawDisplayDatas.indexOf(this._displayData)&&(null===this._armature._replaceTextureAtlasData?((i=r.BaseObject.borrowObject(r.PhaserTextureAtlasData)).copyFrom(e.parent),i.renderTexture=this._armature.replacedTexture,this._armature._replaceTextureAtlasData=i):i=this._armature._replaceTextureAtlasData,e=i.getTexture(e.name));var n,i=e.renderTexture;if(null!==i)return null!==t||(this._textureScale=e.parent.scale*this._armature._armatureData.scale,(n=this._renderDisplay).setTexture(i)),void(this._visibleDirty=!0)}null!==t||((n=this._renderDisplay).x=0,n.y=0,n.visible=!1)},i.prototype._updateMesh=function(){},i.prototype._updateTransform=function(t){var e,i;t?(this._renderDisplay.x=0,this._renderDisplay.y=0,this._renderDisplay.rotation=0,this._renderDisplay.skew=0,this._renderDisplay.scale.x=1,this._renderDisplay.scale.y=1):(this.updateGlobalTransform(),e=this.global,this._renderDisplay===this._rawDisplay||this._renderDisplay===this._meshDisplay?(i=e.x-(this.globalTransformMatrix.a*this._pivotX+this.globalTransformMatrix.c*this._pivotY),t=e.y-(this.globalTransformMatrix.b*this._pivotX+this.globalTransformMatrix.d*this._pivotY),this._renderDisplay.x=i,this._renderDisplay.y=t):(this._renderDisplay.x=e.x,this._renderDisplay.y=e.y),this._renderDisplay.rotation=e.rotation,this._renderDisplay.skew=e.skew,this._renderDisplay.scale.x=e.scaleX*this._textureScale,this._renderDisplay.scale.y=e.scaleY*this._textureScale)},i);function i(){return null!==t&&t.apply(this,arguments)||this}r.PhaserSlot=e}(dragonBones=dragonBones||{}),function(o){var e,t=(e=o.BaseFactory,__extends(a,e),a.init=function(t){null===a._game&&(a._game=t,t=new o.PhaserArmatureDisplay,a._dragonBonesInstance=new o.DragonBones(t))},Object.defineProperty(a,"factory",{get:function(){return null===a._factory&&(a._factory=new a),a._factory},enumerable:!0,configurable:!0}),a.prototype._isSupportMesh=function(){return console.warn("Phaser-ce can not support mesh."),!1},a.prototype._buildTextureAtlasData=function(t,e){return t?t.renderTexture=e:t=o.BaseObject.borrowObject(o.PhaserTextureAtlasData),t},a.prototype._buildArmature=function(t){var e=o.BaseObject.borrowObject(o.Armature),i=new o.PhaserArmatureDisplay;return e.init(t.armature,i,i,this._dragonBones),e},a.prototype._buildSlot=function(t,e,i,n){var r=o.BaseObject.borrowObject(o.PhaserSlot),s=new Phaser.Image(a._game,0,0,Phaser.Cache.DEFAULT);return r.init(e,i,s,s),r},a.prototype.buildArmatureDisplay=function(t,e,i,n){void 0===e&&(e=""),void 0===i&&(i=""),void 0===n&&(n="");n=this.buildArmature(t,e||"",i||"",n||"");return null!==n?(this._dragonBones.clock.add(n),n.display):null},a.prototype.getTextureDisplay=function(t,e){void 0===e&&(e=null);t=this._getTextureData(null!==e?e:"",t);return null!==t&&null!==t.renderTexture?new Phaser.Sprite(a._game,0,0):null},Object.defineProperty(a.prototype,"soundEventManager",{get:function(){return this._dragonBones.eventManager},enumerable:!0,configurable:!0}),a._game=null,a._dragonBonesInstance=null,a._factory=null,a);function a(t){void 0===t&&(t=null);t=e.call(this,t)||this;return t._dragonBones=a._dragonBonesInstance,t}o.PhaserFactory=t}(dragonBones=dragonBones||{}),function(i){function n(t){if(r[t])return r[t].exports;var e=r[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,n),e.l=!0,e.exports}var r={};n.m=i,n.c=r,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=54)}([function(e,t,i){(function(t){e.exports=t.Phaser=i(58)}).call(t,i(27))},function(t,e,i){"use strict";e.__esModule=!0;var n=i(63);e.Images=n.default;n=i(35);e.Constants=n.default;n=i(36);e.Atlases=n.default;n=i(64);e.Sounds=n.default;i=i(65);e.JSONData=i.default},function(t,e,i){"use strict";e.__esModule=!0;var n=i(66);e.GameCore=n.GameCore;n=i(13);e.MainGameCore=n.MainGameCore;n=i(44);e.GameObject=n.GameObject;n=i(78);e.IDisposed=n.IDisposed;n=i(79);e.IUpdated=n.IUpdated;n=i(80);e.IRestarted=n.IRestarted;n=i(28);e.GamePhysics=n.GamePhysics;n=i(22);e.NapePhysics=n.NapePhysics;n=i(45);e.GameBuilder=n.GameBuilder;n=i(19);e.MyRand=n.MyRand;n=i(23);e.NapeUtil=n.NapeUtil;n=i(38);e.GameView=n.GameView;n=i(24);e.Inventory=n.Inventory;n=i(83);e.CbTypes=n.CbTypes;n=i(84);e.Filters=n.Filters;n=i(85);e.Materials=n.Materials;n=i(86);e.PlayerObject=n.PlayerObject;n=i(89);e.AIController=n.AIController;n=i(93);e.AIController2=n.AIController2;n=i(25);e.BaseController=n.BaseController;n=i(94);e.PlayerController=n.PlayerController;n=i(95);e.PlayerController2=n.PlayerController2;n=i(96);e.PlayerControllerGeneral=n.PlayerControllerGeneral;n=i(97);e.Teleport=n.Teleport;n=i(46);e.BallObject=n.BallObject;n=i(39);e.TimerObject=n.TimerObject;n=i(98);e.CountDownObject=n.CountDownObject;n=i(99);e.EnergyBar=n.EnergyBar;n=i(100);e.MessageInfo=n.MessageInfo;n=i(16);e.ObjectsType=n.ObjectsType;n=i(101);e.BallTrail=n.BallTrail;n=i(30);e.ObjectsData=n.ObjectsData;i=i(29);e.PlayersData=i.PlayersData},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0,i(6),i(0);var s,o=i(1),a=i(8),l=i(9),p=i(4),h=i(0),u=i(37),c=i(2),d=i(12),_=i(11),y=i(5),r=(s=Phaser.State,r(f,s),f.prototype.preload=function(){var e=this;s.prototype.preload.call(this),this.game.sound.muteOnPause=!0,this.game.load.onFileComplete.add(this.fileComplete,this);o.JSONData.list.forEach(function(t){e.game.load.json(t,"/js/"+t+".json")}),o.Images.list.forEach(function(t){e.game.load.image(t,"/img/"+t+".png")}),o.Atlases.list.forEach(function(t){e.game.load.atlas(t,"/img/"+t+".png","/js/"+t+".json")}),o.Sounds.list.forEach(function(t){e.game.device.iOS?e.game.load.audio(t,["/media/"+t+".ogg"]):e.game.load.audio(t,["/media/"+t+".ogg","/media/"+t+".ogg"])}),this.game.scale.onSizeChange.add(function(){e.game.state.getCurrentState().resize()},this)},f.prototype.init=function(){this.game.world.removeAll(),this.backgroundBase=this.game.add.sprite(0,0);var t=this.game.add.graphics(0,0);t.beginFill(6360199,1),t.drawRect(-699,0,1398,480),t.endFill(),this.backgroundGraphic=t,this.backgroundBase.addChild(t),this.backgroundBaseMask=this.game.add.graphics(0,0),this.backgroundBaseMask.beginFill(65280,0),this.backgroundBaseMask.drawRect(0,0,1398,480),this.backgroundBaseMask.endFill();t=this.game.add.group();this.backgroundBase.addChild(t);t=this.game.add.group();this.backgroundBase.addChild(t);this.ccc=new l.default(this.game,100,300,"MADPUFFERS 2020Â©",{font:"16px Impact2",fill:"#FFFFFF"}),this.ccc.anchor.set(.5),this.mainParent=this.game.add.group(),this.mainParent.x=this.game.width/2,this.mainParent.y=this.game.height/2,this.setPauseViewCar(this.mainParent),this.wait2=this.game.add.text(this.game.width/2,.75*this.game.height,"LOADING...",o.Constants.styleLoading),this.wait2.anchor.set(.5),this.wait2.stroke="#FFFFFF",this.wait2.strokeThickness=5,this.wait=this.game.add.text(this.game.width/2,.75*this.game.height,"",o.Constants.styleLoading),this.wait.anchor.set(.5),this.wait.stroke="#000000",this.wait.strokeThickness=7,this.inited=!0,this.resize()},f.prototype.setPauseViewCar=function(t){null!==this.bike&&this.bike.destroy(),this.bike=this.game.add.group(t);var e=null;(e=this.game.add.sprite(0,0,o.Images.GameLogo)).anchor.set(.5),t.addChild(e)},f.prototype.create=function(){s.prototype.create.call(this),this.resize()},f.prototype.hide=function(){var t=this.game.add.tween(this.wait);t.to({y:800},p.default.PRELOADER_TIME,h.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.wait2)).to({y:800},p.default.PRELOADER_TIME,h.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.ccc)).to({y:800},p.default.PRELOADER_TIME,h.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.mainParent)).to({y:-800},p.default.PRELOADER_TIME,h.Easing.Linear.None),t.start()},f.prototype.update=function(){s.prototype.update.call(this),this.loadComplete&&(this.loadComplete=!1,f.game=this.game,this.startLocalGame())},f.prototype.startLocalGame=function(t){void 0===t&&(t=null),_.default.getInstance(this.game,this.onLoadSfx,this)},f.prototype.onLoadSfx=function(){y.default.getInstance(this.game).playMusic(o.Sounds.MenuMusic),u.default.getInstance(this.game,this.onSaveGameLoad,this)},f.prototype.onSaveGameLoad=function(){c.Inventory.instance.initManagers(),this.backgroundBase.removeChild(this.backgroundGraphic),this.backgroundBase=this.game.add.sprite(0,0,o.Atlases.Interface,a.default.getBG());var t=this.game.add.group();this.backgroundBase.addChild(t);t=this.game.add.group();this.backgroundBase.addChild(t),this.world.addChildAt(this.backgroundBase,0),this.resize(),new a.default(this.game,this,d.Menu.Name)},f.prototype.fileComplete=function(t,e,i,n,r){this.wait2.setText("Loading "+t+"%")},f.prototype.resize=function(){var t;this.inited&&(t=(t=1)<(t=this.game.width/o.Constants.WIDTH)?1:t,t*=1.33333,this.backgroundBase.scale.set(t),this.backgroundBase.alignIn(this.world.bounds,Phaser.TOP_CENTER),this.backgroundBaseMask.scale.set(t,t),this.backgroundBaseMask.x=this.backgroundBase.x,this.backgroundBaseMask.y=this.backgroundBase.y,this.bike.scale.set(t),this.mainParent.alignIn(this.world.bounds,Phaser.TOP_CENTER),this.ccc.scale.set(t),this.ccc.x=this.backgroundBase.x,this.ccc.y=this.backgroundGraphic.height*t-this.ccc.height+15,this.wait2.position.set(this.ccc.x,this.ccc.y-35),this.wait2.position.set(this.ccc.x,this.ccc.y-35)),s.prototype.resize.call(this)},f.prototype.shutdown=function(){this.mainParent=null,this.backgroundBase=null,this.wait=null,this.wait2=null,this.bike=null,s.prototype.shutdown.call(this)},f.Name="preloader",f.game=null,f);function f(){var t=s.call(this)||this;return t.name=f.Name,t.loadComplete=!0,t.bike=null,t.wait=null,t.wait2=null,t.ccc=null,t.mainParent=null,t.backgroundBase=null,t.backgroundGraphic=null,t}e.default=r},function(t,e,i){"use strict";e.__esModule=!0;var n=(r.WIDTH=800,r.WIDTH2=400,r.GAME_W=1066,r.GAME_H=640,r.GAME_W2=400,r.GAME_H2=240,r.DISPLAY_W=1066,r.DISPLAY_H=640,r.DISPLAY_W2=533,r.DISPLAY_H2=320,r.PRELOADER_TIME=325,r.PRELOADER_TIME_HALF=325,r.STEP=.025,r.MATCH_TIME=60,r.OVERTIME_TIME=15,r.LIMITS_FOR_ACHIEVS=[20,50,5,5,20,50,500,25,25,150,150],r);function r(){}e.default=n},function(t,e,i){"use strict";e.__esModule=!0;var n=i(11),i=(r.getInstance=function(t){if(null===r.instance){if(!t)throw new Error("Cant create a new instance without a game");r.instance=new r(t)}return r.instance},r.prototype.play=function(t,e,i){return void 0===e&&(e=1),void 0===i&&(i=!1),this.audioInstances.hasOwnProperty(t)||(this.audioInstances[t]=this.sound.add(t)),n.default.getInstance().sfx?(this.audioInstances[t].play(void 0,void 0,e,i,!0),this.audioInstances[t]):this.audioInstances[t].play(void 0,void 0,0,i,!0)},r.prototype.stop=function(t){this.audioInstances.hasOwnProperty(t)&&this.audioInstances[t].stop()},r.prototype.playMusic=function(t){if(!n.default.getInstance().music)return this.music=this.sound.play(t,.5,!0),void this.music.stop();null!==this.music&&this.music.name===t||(null!==this.music&&this.music.name!==t&&this.music.stop(),this.music=this.sound.play(t,.5,!0))},r.prototype.fadeMusicVolume=function(t,e){this.music&&this.music.fadeTo(t,e)},r.prototype.stopMusic=function(){null!==this.music&&this.music.isPlaying&&this.music.stop()},r.prototype.toggleSfx=function(){n.default.getInstance().sfx=!n.default.getInstance().sfx},r.prototype.toggleMusic=function(){n.default.getInstance().music=!n.default.getInstance().music,n.default.getInstance().music?this.music&&this.music.play(void 0,void 0,1,!0):this.music&&this.music.isPlaying&&this.stopMusic()},r.instance=null,r);function r(t){this.music=null,this.audioInstances={},this.sound=t.sound}e.default=i},function(e,t,i){(function(t){e.exports=t.PIXI=i(57)}).call(t,i(27))},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0,i(6),i(0);var o,a=i(9),r=(o=Phaser.Group,r(s,o),Object.defineProperty(s.prototype,"labelState",{get:function(){return this._labelState},set:function(t){this._labelState=t,this._texts.addChild(t),this._labelState.anchor.set(.5)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"sScale",{set:function(t){this._sScale=t,this._graphics.scale.set(this._sScale)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"sLabelScale",{set:function(t){this._sLabelScale=t,this._texts.scale.set(this._sLabelScale)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"dynamicScaleDown",{set:function(t){this._dynamicScaleDown=t},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"dynamicScaleUp",{set:function(t){this._dynamicScaleUp=t},enumerable:!0,configurable:!0}),s.prototype.onOver=function(){this._graphics.scale.set(this._sScale*this._dynamicScaleUp),this._texts.scale.set(this._sLabelScale*this._dynamicScaleUp)},s.prototype.onDownLabel=function(){this._graphics.scale.set(this._sScale*this._dynamicScaleDown),this._texts.scale.set(this._sLabelScale*this._dynamicScaleDown)},s.prototype.onOut=function(){this._graphics.scale.set(this._sScale),this._texts.scale.set(this._sLabelScale)},s.prototype.setText=function(t){this.label.setText(t)},s.prototype.setFrames=function(t,e,i,n){this.btn.setFrames(t,e,i,n)},s.prototype.destroy=function(t){this.id=null,this.label=null,this.btn=null,this._graphics=null,this._texts=null,this._labelState=null,o.prototype.destroy.call(this,t)},Object.defineProperty(s.prototype,"enable",{get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.btn.inputEnabled=this._enable,this._enable?(this.btn.tint=16777215,this.label.tint=16777215):(this.btn.tint=10066329,this.label.tint=10066329))},enumerable:!0,configurable:!0}),s);function s(t,e,i,n,r,s){void 0===s&&(s=null);t=o.call(this,t)||this;return t._labelState=null,t._enable=!0,t._graphics=null,t._texts=null,t._dynamicScaleUp=1.1,t._dynamicScaleDown=.9,t._sScale=1,t._sLabelScale=1,t.inputEnableChildren=!0,t._graphics=t.game.add.group(t),t._texts=t.game.add.group(t),t.btn=t.game.add.button(0,0,s,n,r),t.btn.anchor.set(.5),t._graphics.addChild(t.btn),t.label=new a.default(t.game,0,2,e,i,70,40),t.label.anchor.set(.5),t._texts.addChild(t.label),null!==n&&null!==r?(t.label.inputEnabled=!0,t.label.events.onInputDown.add(n,r),t._graphics.inputEnableChildren=!0,t._graphics.onChildInputOver.add(t.onOver,t),t._graphics.onChildInputDown.add(t.onDownLabel,t),t._graphics.onChildInputOut.add(t.onOut,t),t._graphics.onChildInputUp.add(t.onOut,t),t._texts.inputEnableChildren=!0,t._texts.onChildInputOver.add(t.onOver,t),t._texts.onChildInputDown.add(t.onDownLabel,t),t._texts.onChildInputOut.add(t.onOut,t)):(t._graphics.inputEnableChildren=!1,t._texts.inputEnableChildren=!1,t.btn.inputEnabled=!1),t.game.add.existing(t),t}e.default=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var a,l=i(4),p=i(1),h=i(0),r=(a=Phaser.Graphics,r(u,a),u.getBG=function(){return this.BASE_BG[this.INDEX_BG]+"0000"},u.prototype.startTransition=function(t,e,i,n){var r=this;t.hide&&t.hide();e=this.game.add.tween(e);e.to({alpha:.5},l.default.PRELOADER_TIME_HALF,h.Easing.Linear.None),e.onComplete.add(function(){r.game.state.start(i,!0,!1,n)}),e.start()},u.prevState=[],u.INDEX_BG=0,u.BASE_BG=["bg1","bg2blue","bg1red"],u);function u(t,e,i,n){var r,s,o=a.call(this,t)||this;return 2===u.prevState.length&&u.prevState.shift(),u.prevState.push(i+""),t.add.existing(o),e.backgroundBase?(r=o.game.make.sprite(0,0,p.Atlases.Interface,u.BASE_BG[u.INDEX_BG+1===3?0:u.INDEX_BG+1]+"0000"),e.backgroundBase.addChildAt(r,1),r.alpha=.03,e.popup?((s=o.game.add.tween(e.popup)).to({alpha:0},l.default.PRELOADER_TIME_HALF,h.Easing.Linear.None),s.onComplete.add(function(){o.startTransition(e,r,i,n)},o),s.start()):o.startTransition(e,r,i,n)):t.state.start(i,!0,!1,n),o}e.default=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0,i(6),i(0);var a,r=(a=Phaser.Text,r(s,a),s.prototype.setText=function(t){return a.prototype.setText.call(this,t),(this.maxWidth||this.maxHeight)&&this.makeFontFit(),this},s.prototype.setMaxSize=function(t,e){this.maxWidth=t,this.maxHeight=e},s.prototype.makeFontFit=function(){for(var t;this.width>this.maxWidth||this.height>this.maxHeight;){if((t=parseInt(this.fontSize.toString().replace("px",""),10)-1)<10){t=10,this.fontSize=t;break}this.fontSize=t}},s);function s(t,e,i,n,r,s,o){r=a.call(this,t,e,i,n,r)||this;return r.maxWidth=s,r.maxHeight=o,r.game.add.existing(r),r}e.default=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0,i(6),i(0);var a,l=i(9),p=i(7),r=(a=Phaser.Group,r(s,a),s.prototype.drawRectHit=function(){var t=this.game.make.graphics();t.beginFill(16711680,0),t.drawRect(+this.width/-2,+this.height/-2,+this.width,+this.height),t.endFill(),t.inputEnabled=!0,this.btn.label.parent.inputEnableChildren=!0,this.btn.label.parent.onChildInputDown.add(this._callback,this._context),this.btn.label.parent.addChild(t)},s.prototype.setProp=function(t,e,i,n){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=null),null!==t&&(this._colorFront=t),null!==i&&(this._colorBack=i),null!==n&&(this._thickBack=n),null!==e&&(this._thickFront=e),this.btn.label.stroke=this._colorFront,this.btn.label.strokeThickness=this._thickFront,this.label.stroke=this._colorBack,this.label.strokeThickness=this._thickBack,null!==this._callback&&null!==this._context&&this.drawRectHit()},s.prototype.setText=function(t){this.label.setText(t),this.btn.setText(t)},s.prototype.setFrames=function(t,e,i,n){this.btn.setFrames(t,e,i,n)},s.prototype.destroy=function(t){this.btn=null,this.label=null,this._callback=null,this._context=null,a.prototype.destroy.call(this,t)},Object.defineProperty(s.prototype,"enable",{get:function(){return this.btn.enable},set:function(t){this.btn.enable=t},enumerable:!0,configurable:!0}),s);function s(t,e,i,n,r,s){void 0===s&&(s=null);var o=a.call(this,t)||this;return o._colorFront="#000000",o._thickFront=7,o._colorBack="#FFFFFF",o._thickBack=15,o._callback=null,o._context=null,o.inputEnableChildren=!0,o.btn=new p.default(t,e,i,n,r,s),o.label=new l.default(o.game,0,2,e,i),o.label.anchor.set(.5),null!==n&&null!==r&&(o.label.inputEnabled=!0,o.btn.label.inputEnabled=!0,o.btn.label.input.useHandCursor=!0,o._callback=n,o._context=r),o.addChild(o.btn),o.btn.label.parent.addChildAt(o.label,0),o.game.add.existing(o),o}e.default=r},function(t,e,i){"use strict";e.__esModule=!0;var s=i(1),i=(n.prototype.initFirstSave=function(){this.sfxOn=!0,this.musicOn=!0,this.save()},n.getInstance=function(t,e,i){return n.instance?i&&e.call(i):n.instance=new n(t,e,i),n.instance},Object.defineProperty(n.prototype,"music",{get:function(){return this.musicOn},set:function(t){this.musicOn=t,this.save()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"sfx",{get:function(){return this.sfxOn},set:function(t){this.sfxOn=t,this.save()},enumerable:!0,configurable:!0}),n.prototype.save=function(){var t=JSON.stringify({m:this.musicOn,sf:this.sfxOn}),e=this.hash(t);this.game.storage.setItem(s.Constants.STORAGE_KEY_SFX,t),this.game.storage.setItem(s.Constants.STORAGE_KEY_SFX+"h",e)},n.prototype.restore=function(){var i,n,r=this,t=this.game.storage.getItem(s.Constants.STORAGE_KEY_SFX),e=this.game.storage.getItem(s.Constants.STORAGE_KEY_SFX+"h");Promise.all([t,e]).then(function(t){if(i=t[0]||"",n=t[1]||"0",""===i)return r.initFirstSave(),void(r.callback&&r.callbackContext&&r.callback.call(r.callbackContext));if(n!==r.hash(i))return r.initFirstSave(),void(r.callback&&r.callbackContext&&r.callback.call(r.callbackContext));if(i&&""!==i)try{var e=JSON.parse(i);r.musicOn=e.m,r.sfxOn=e.sf}catch(t){r.initFirstSave()}else r.initFirstSave();r.callback&&r.callbackContext&&r.callback.call(r.callbackContext)})},n.prototype.hash=function(t){var e,i,n=0;if(0===t.length)return n.toString();for(e=0,i=t.length;e<i;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n.toString()},n);function n(t,e,i){var n=this;this.musicOn=!0,this.sfxOn=!0,this.game=t,this.callback=e,this.callbackContext=i,this.game.storage.getItem(s.Constants.STORAGE_KEY_SFX).then(function(t){null==t?(n.initFirstSave(),n.callback&&n.callbackContext&&n.callback.call(n.callbackContext)):n.restore()})}e.default=i},function(t,e,i){"use strict";e.__esModule=!0;var n=i(61);e.Boot=n.default;n=i(32);e.Gameplay=n.default;n=i(33);e.Menu=n.default;n=i(26);e.RandomState=n.default;i=i(104);e.TournamentState=i.default},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(2),a=i(67),l=i(3),p=i(22),h=i(0),u=i(5),c=i(24),d=i(11),_=i(77),y=i(4),f=i(15),m=i(31),x=i(1),v=i(14),r=(s=o.GameCore,r(g,s),Object.defineProperty(g,"instance",{get:function(){return g._instance||(g._instance=new g),g._instance},enumerable:!0,configurable:!0}),g.prototype.init=function(t){s.prototype.init.call(this,t),this.view=new a.MainGameView(l.default.game),this.physics=new p.NapePhysics,this.physics2=new _.Physics2,this.playersLeft=[],this.playersRight=[],this.opponents=[]},g.prototype.start=function(){s.prototype.start.call(this),this.matchPreloader=this.view.matchPreloader,this.matchPreloader.setCallBacks(this.restart2,this.startPlay,this),f.Signals.MatchProcessorSignal.add(this.processMatchProcessor,this),f.Signals.EventSignal.add(this.processEvent,this),this.isTraining=3===c.Inventory.instance.gameMode,this.isTraining=this.isTraining;var t=0===c.Inventory.instance.matchData.matchMode;this.isSinglePlayer=t,this.infoPanel=this.view.infoPanel,this.timer=this.view.timer,this.infoPanel.start(c.Inventory.instance.matchData.teams,c.Inventory.instance.matchData.matchScore[0],c.Inventory.instance.matchData.matchScore[1]),this.winSnds=[],this.winSnds[0]=x.Sounds.m_win,this.winSnds[1]=c.Inventory.instance.isPvP()?x.Sounds.m_win:x.Sounds.m_lost,this.startMatch(!0),this.isTraining||(this.m_tribune=u.default.getInstance().play(x.Sounds.m_tribune,d.default.getInstance().sfx?1:0,!0))},g.prototype.startMatch=function(t){void 0===t&&(t=!0),this.SIDE=this.isTraining?1:0,this.isPlaying=!1,this.isPaused=!1,this.isOvertime=!1,this.isEnd=!1,this.isWaiting=!1,this.matchTime=0;var e=this.isTraining?250:500;this.matchPreloader.setTime(e),this.isTraining||(this.endTime=t?y.default.MATCH_TIME:y.default.OVERTIME_TIME,this.countDown.activate()),t&&c.Inventory.instance.matchData.resetScore(),this.infoPanel.updateScore(c.Inventory.instance.matchData.matchScore[0],c.Inventory.instance.matchData.matchScore[1]),this.timer.start(this.endTime),this.restart2(),4===c.Inventory.instance.gameMode?c.Inventory.instance.firstRun2&&(c.Inventory.instance.firstRun2=!1,m.default.instance.signalPause.dispatch(g.HELP)):c.Inventory.instance.firstRun&&(c.Inventory.instance.firstRun=!1,m.default.instance.signalPause.dispatch(g.HELP))},g.prototype.startPlay=function(){this.isScored=!1},g.prototype.restart2=function(){this.restart(this.SIDE),this.matchPreloader.hide()},g.prototype.getNextState=function(){return 0===c.Inventory.instance.gameMode||1===c.Inventory.instance.gameMode||3===c.Inventory.instance.gameMode?"GameMode":"NumPlayers"},g.prototype.processMatchProcessor=function(t,e,i,n){var r;this.isEnd||(r=-1===t?1:0,u.default.getInstance().play(this.winSnds[r]),c.Inventory.instance.matchData.matchScore[r]+=e,this.timer.updateScore(t,c.Inventory.instance.matchData.matchScore[r]),this.view.shake(n),this.isTraining?(this.matchPreloader.show(),this.setEmotions(0)):(this.SIDE=t,this.isScored=!0,this.scoredByHuman=i,this.isWaiting||(this.processEvent(i,n),this.matchPreloader.show(),this.setEmotions(-t))))},g.prototype.update=function(t){this.isPaused?this.m_tribune&&(this.m_tribune.volume=0):(this.m_tribune&&(this.m_tribune.volume=d.default.getInstance().sfx?1:0),this.isPlaying?(this.isAlleyOop&&this.physics2.update(t),s.prototype.update.call(this,t),this.isEnd?(this.deltaEndTime+=t,this.deltaEndTime>this.delayEndTime&&(this.isOvertime?this.startMatch(!1):(this.isPlaying=!1,this.nextState="PostMatch",this.finishMatch()))):this.isWaiting||this.isScored||this.isTraining||this.isSuperShot||(this.matchTime+=t,this.timer.process(this.matchTime),this.matchTime>=this.endTime&&this.endOfTime())):this.countDown.process(t)&&(u.default.getInstance().play(x.Sounds.m_whistle),this.isPlaying=!0))},g.prototype.endOfTime=function(){u.default.getInstance().play(x.Sounds.m_buzzer),this.isBallInGame()?(this.isWaiting=!0,this.activateWaiting(),f.Signals.MatchEndSignal.add(this.processMatchEnd,this)):this.endMatch()},g.prototype.processMatchEnd=function(){f.Signals.MatchEndSignal.remove(this.processMatchEnd,this),this.isWaiting=!1,this.endMatch()},g.prototype.endMatch=function(){this.isEnd=!0,this.isOvertime=!1;var t=c.Inventory.instance.matchData.whoWins(),e=10;0===t&&(e=11,this.isOvertime=!0),this.setEmotions(t),this.isScored?this.processEvent(this.scoredByHuman,3,e):this.messageInfo.show2(e),this.deltaEndTime=0},g.prototype.add=function(t){var e;null!==t&&(t.objType===o.ObjectsType.BALL?(this.ball=t,this.ball.space2=_.Physics2.space):t.objType===o.ObjectsType.PLAYER?(-1===(e=t).SIDE?this.playersLeft:this.playersRight).push(e):t.objType===o.ObjectsType.BASKET?-1===(e=t).side?this.basket1=e:this.basket2=e:(t.objType,o.ObjectsType.ARENA),t instanceof o.CountDownObject&&(this.countDown=t),s.prototype.add.call(this,t))},g.prototype.restart=function(t){void 0===t&&(t=0),s.prototype.restart.call(this,t),this.isSuperShot=!1,this.isAlleyOop=!1,this.isTraining?(this.ball.takeInHands(-1,0,!0),this.playersLeft[0].takeBallInHands()):0!==t?-1===t?(this.ball.takeInHands(t,this.leftCounter,!0),this.playersLeft[this.leftCounter].takeBallInHands(),this.leftCounter=this.leftCounter++/2>>0):(this.ball.takeInHands(t,this.rightCounter,!0),this.playersRight[this.rightCounter].takeBallInHands(),this.rightCounter=this.rightCounter++/2>>0):y.default.isDesktop||v.default.instance.btnDown.labelState.loadTexture(x.Atlases.Gameplay,"shoot_icon0001"),this.physics.update(y.default.STEP)},g.prototype.ballInHands=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);for(var i=0;i<this.playersLeft.length;i++)this.playersLeft[i].ballInHands(t,e);for(var n=0;n<this.playersRight.length;n++)this.playersRight[n].ballInHands(t,e)},g.prototype.ballShooting=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);for(var i=0;i<this.playersLeft.length;i++)this.playersLeft[i].ballShooting(t,e);for(var n=0;n<this.playersRight.length;n++)this.playersRight[n].ballShooting(t,e)},g.prototype.ballOthers=function(){for(var t=0;t<this.playersLeft.length;t++)this.playersLeft[t].ballOthers();for(var e=0;e<this.playersRight.length;e++)this.playersRight[e].ballOthers()},g.prototype.setEmotions=function(t){for(var e=0;e<this.playersLeft.length;e++)this.playersLeft[e].setEmotion(t);for(var i=0;i<this.playersRight.length;i++)this.playersRight[i].setEmotion(t)},g.prototype.release=function(){this.ball=null,this.basket1=null,this.basket2=null,this.playersLeft.splice(0,this.playersLeft.length),this.playersRight.splice(0,this.playersRight.length),this.opponents.splice(0,this.opponents.length),this.physics2.release(),f.Signals.MatchProcessorSignal.remove(this.processMatchProcessor,this),s.prototype.release.call(this)},g.prototype.steal=function(t,e,i,n){var r;this.isTraining||this.isSuperShot||(this.opponents=-1===t?this.playersRight:this.playersLeft,r=!1,r=this.isSinglePlayer?this.stealSinglePlayer(e,i,0):(t=this.opponents[0].checkToBeStolen(e,i))<0?this.stealSinglePlayer(e,i,1):((0<(i=this.opponents[1].checkToBeStolen(e,i))&&i<t?this.opponents[1]:this.opponents[0]).getBeStolen(e),!0),n&&r&&f.Signals.EventSignal.dispatch(!0,5))},g.prototype.stealSinglePlayer=function(t,e,i){return 0<=this.opponents[i].checkToBeStolen(t,e)&&(this.opponents[i].getBeStolen(t),!0)},g.prototype.isBallInGame=function(){return"shooting"===this.ball.state||"basket"===this.ball.state||"dunk"===this.ball.state||"block"===this.ball.state},g.prototype.activateWaiting=function(){this.ball.isWaiting=!0,this.setEmotions(0)},g.prototype.getTeamMate=function(t){return this.isSinglePlayer?null:(t=0===t?1:0,this.playersLeft[t])},g.prototype.processEvent=function(t,e,i){void 0===i&&(i=0),e<9&&4!==e&&5!==e&&this.messageInfo.show2(e,i),0===c.Inventory.instance.gameMode&&t&&e<7&&c.Inventory.instance.statsMgr.updateData(e)},g.prototype.finishMatch=function(){this.isTraining||u.default.getInstance().stop(x.Sounds.m_tribune),""===this.nextState&&(this.nextState=g.FULL_TIME),this.isPaused=!0,g.instance.menuPauseSignal.dispatch(this.nextState)},g.PAUSE="pause",g.HELP="help",g.FULL_TIME="PostMatch",g);function g(){var t=s.call(this)||this;return t.isPlaying=!1,t.isPaused=!1,t.isWaiting=!1,t.scoredByHuman=!1,t.isEnd=!1,t.SIDE=0,t.delayEndTime=1.5,t.matchTime=0,t.endTime=0,t.leftCounter=0,t.rightCounter=0,t.nextState="",t.slowSignal=new h.Signal,t.matchEndSignal=new h.Signal,t.menuPauseSignal=new h.Signal,f.Signals.MatchProcessorSignal.add(t.processMatchProcessor,t),t}e.MainGameCore=r},function(t,e,i){"use strict";e.__esModule=!0;var n=Phaser.Keyboard,r=i(1),s=i(7),o=i(4),i=(Object.defineProperty(a.prototype,"isbtnZ",{get:function(){return!o.default.isDesktop&&this._isbtnZ||this.keyboard.isDown(n.Z)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isbtnX",{get:function(){return!o.default.isDesktop&&this._isbtnX||this.keyboard.isDown(n.X)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isbtnK",{get:function(){return!o.default.isDesktop&&this._isbtnK||this.keyboard.isDown(n.K)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isbtnL",{get:function(){return!o.default.isDesktop&&this._isbtnL||this.keyboard.isDown(n.L)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isbtnV",{get:function(){return!o.default.isDesktop&&this._isbtnV||this.keyboard.isDown(n.V)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isbtnB",{get:function(){return!o.default.isDesktop&&this._isbtnB||this.keyboard.isDown(n.B)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isbtnUp",{get:function(){return!o.default.isDesktop&&this._isbtnUp||this.keyboard.isDown(n.UP)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isbtnDown",{get:function(){return!o.default.isDesktop&&this._isbtnDown||this.keyboard.isDown(n.DOWN)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isbtnLeft",{get:function(){return!o.default.isDesktop&&this._isbtnLeft||this.keyboard.isDown(n.LEFT)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isbtnLeftDouble",{get:function(){null===this.keyLeft&&(this.keyLeft=this.keyboard.addKey(n.LEFT)),this.keyTimer=this.keyLeft.timeDown-this.keyLeft.timeUp;var t=this.keyTimer<460&&this.keyLeft.justDown;if(o.default.isDesktop||t)return t;t=this.game.time.time-this.btnLeftDownTime<100;return this.btnLeftDownTime-this.btnLeftUpTime<460&&t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isbtnRight",{get:function(){return!o.default.isDesktop&&this._isbtnRight||this.keyboard.isDown(n.RIGHT)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isbtnRightDouble",{get:function(){null===this.keyRight&&(this.keyRight=this.keyboard.addKey(n.RIGHT)),this.keyTimer=this.keyRight.timeDown-this.keyRight.timeUp;var t=this.keyTimer<460&&this.keyRight.justDown;if(o.default.isDesktop||t)return t;t=this.game.time.time-this.btnRightDownTime<100;return this.btnRightDownTime-this.btnRightUpTime<460&&t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isbtnW",{get:function(){return!o.default.isDesktop&&this._isbtnUp||this.keyboard.isDown(n.W)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isbtnS",{get:function(){return!o.default.isDesktop&&this._isbtnDown||this.keyboard.isDown(n.S)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isbtnADouble",{get:function(){return null===this.keyA&&(this.keyA=this.keyboard.addKey(n.A)),this.keyTimer=this.keyA.timeDown-this.keyA.timeUp,this.keyTimer<460&&this.keyA.justDown},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isbtnA",{get:function(){return!o.default.isDesktop&&this._isbtnLeft||this.keyboard.isDown(n.A)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isbtnDDouble",{get:function(){return null===this.keyD&&(this.keyD=this.keyboard.addKey(n.D)),this.keyTimer=this.keyD.timeDown-this.keyD.timeUp,this.keyTimer<460&&this.keyD.justDown},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isbtnD",{get:function(){return!o.default.isDesktop&&this._isbtnRight||this.keyboard.isDown(n.D)},enumerable:!0,configurable:!0}),a.prototype.init=function(t,e){this.container=t,this.game=e,this.container.inputEnableChildren=!0,this.keyboard=this.game.input.keyboard,this.keyboard.addKeyCapture(n.RIGHT),this.keyboard.addKeyCapture(n.LEFT),this.keyboard.addKeyCapture(n.DOWN),this.keyboard.addKeyCapture(n.UP),this.keyboard.addKeyCapture(n.A),this.keyboard.addKeyCapture(n.W),this.keyboard.addKeyCapture(n.S),this.keyboard.addKeyCapture(n.D),this.keyboard.addKeyCapture(n.Z),this.keyboard.addKeyCapture(n.X),this.keyboard.addKeyCapture(n.K),this.keyboard.addKeyCapture(n.L),o.default.isDesktop||this.createButtons()},a.prototype.createButtons=function(){var t=this.game.add.image(0,0,r.Atlases.Gameplay,"arrow_icon20000");t.anchor.set(.5),this.btnUp=new s.default(this.game,"",{},function(){},this,r.Atlases.Gameplay),this.btnUp.setFrames("btn_bg20000","btn_bg20000","btn_bg20000","btn_bg20000"),this.btnUp.x=725,this.btnUp.y=427,this.btnUp.btn.alpha=.9,this.container.addChild(this.btnUp),this.btnUp.label.parent.addChild(t);var e=this.game.make.graphics();e.beginFill(16711680,0),e.drawRect((this.btnUp.width+5)/-2,(this.btnUp.height+5)/-2,this.btnUp.width+30,this.btnUp.height+10),e.endFill(),e.inputEnabled=!0,e.events.onInputDown.add(this.upTap,this),e.events.onInputUp.add(this.upUnTap,this),this.btnUp.label.parent.addChild(e),this.btnZ=new s.default(this.game,"",{},function(){},this,r.Atlases.Gameplay),this.btnZ.setFrames("btn_bg20000","btn_bg20000","btn_bg20000","btn_bg20000"),this.btnZ.x=745,this.btnZ.y=327,this.btnZ.btn.events.onInputDown.add(this.ZTap,this),this.btnZ.btn.events.onInputUp.add(this.ZUnTap,this),this.btnZ.btn.alpha=.9,this.container.addChild(this.btnZ),(t=this.game.add.image(0,0,r.Atlases.Gameplay,"shoot_icon0000")).anchor.set(.5),this.btnDown=new s.default(this.game,"",{},function(){},this,r.Atlases.Gameplay),this.btnDown.setFrames("btn_bg20000","btn_bg20000","btn_bg20000","btn_bg20000"),this.btnDown.x=615,this.btnDown.y=427,this.btnDown.btn.events.onInputDown.add(this.XTap,this),this.btnDown.btn.events.onInputUp.add(this.XUnTap,this),this.btnDown.btn.alpha=.9,this.container.addChild(this.btnDown),this.btnDown.labelState=t,(t=this.game.add.image(0,0,r.Atlases.Gameplay,"arrow_icon0000")).anchor.set(.5),t.scale.set(.85),this.btnLeft=new s.default(this.game,"",{},function(){},this,r.Atlases.Gameplay),this.btnLeft.setFrames("bg0000","bg0000","bg0000","bg0000"),this.btnLeft.x=75,this.btnLeft.y=415,this.btnLeft.sScale=.57,this.btnLeft.btn.alpha=.9,this.container.addChild(this.btnLeft),t.angle=-180,this.btnLeft.label.parent.addChild(t),(e=this.game.make.graphics()).beginFill(16711680,0),e.drawRect((this.btnLeft.width+59)/-2,(this.btnLeft.height+5)/-2,this.btnLeft.width+34,this.btnLeft.height+10),e.endFill(),e.inputEnabled=!0,e.events.onInputDown.add(this.leftTap,this),e.events.onInputUp.add(this.leftUnTap,this),this.btnLeft.label.parent.addChild(e),(t=this.game.add.image(0,0,r.Atlases.Gameplay,"arrow_icon0000")).anchor.set(.5),t.scale.set(.85),this.btnRight=new s.default(this.game,"",{},function(){},this,r.Atlases.Gameplay),this.btnRight.setFrames("bg0000","bg0000","bg0000","bg0000"),this.btnRight.x=185,this.btnRight.y=415,this.btnRight.sScale=.57,this.btnRight.btn.alpha=.9,this.container.addChild(this.btnRight),this.btnRight.label.parent.addChild(t),(e=this.game.make.graphics()).beginFill(16711680,0),e.drawRect((this.btnRight.width+59)/-2,(this.btnRight.height+5)/-2,this.btnRight.width+34,this.btnRight.height+10),e.endFill(),e.inputEnabled=!0,e.events.onInputDown.add(this.rightTap,this),e.events.onInputUp.add(this.rightUnTap,this),this.btnRight.label.parent.addChild(e)},a.prototype.upTap=function(){this.btnUp.onDownLabel(),this._isbtnUp=!0},a.prototype.leftTap=function(){this.btnLeft.onDownLabel(),this.btnLeftDownTime=this.game.time.time,this._isbtnLeft=!0},a.prototype.rightTap=function(){this.btnRight.onDownLabel(),this.btnRightDownTime=this.game.time.time,this._isbtnRight=!0},a.prototype.ZTap=function(){this._isbtnZ=!0},a.prototype.XTap=function(){this._isbtnX=!0},a.prototype.upUnTap=function(){this.btnUp.onOut(),this._isbtnUp=!1},a.prototype.leftUnTap=function(){this.btnLeft.onOut(),this.btnLeftUpTime=this.game.time.time,this._isbtnLeft=!1},a.prototype.rightUnTap=function(){this.btnRight.onOut(),this.btnRightUpTime=this.game.time.time,this._isbtnRight=!1},a.prototype.ZUnTap=function(){this._isbtnZ=!1},a.prototype.XUnTap=function(){this._isbtnX=!1},a.prototype.resize=function(t){var e;this.container.parent&&this.container.parent.parent,this.container&&(this.container.scale.set(t),e=0,1<=t&&this.game.width>r.Constants.WIDTH&&(e=.5*(this.game.width-r.Constants.WIDTH)/this.container.parent.scale.x),this.btnUp.x=725+e,this.btnUp.y=427,this.btnZ.x=745+e,this.btnZ.y=327,this.btnDown.x=615+e,this.btnDown.y=427,this.btnLeft.x=75-e,this.btnLeft.y=415,this.btnRight.x=185-e,this.btnRight.y=415)},Object.defineProperty(a,"instance",{get:function(){return a._instance||(a._instance=new a),a._instance},enumerable:!0,configurable:!0}),a);function a(){this.container=null,this.keyLeft=null,this.keyRight=null,this.keyA=null,this.keyD=null,this.keyL=null,this.keyX=null,this.keyB=null,this.btnUp=null,this.btnZ=null,this.btnDown=null,this.btnLeft=null,this.btnLeftDownTime=0,this.btnLeftUpTime=0,this.btnRight=null,this.btnRightDownTime=0,this.btnRightUpTime=0,this._isbtnZ=!1,this._isbtnK=!1,this._isbtnX=!1,this._isbtnL=!1,this._isbtnV=!1,this._isbtnB=!1,this._isbtnUp=!1,this._isbtnDown=!1,this._isbtnLeft=!1,this._isbtnRight=!1,this._isbtnLeftDouble=!1,this._isbtnRightDouble=!1,this._isbtnADouble=!1,this._isbtnDDouble=!1}e.default=i},function(t,e,i){"use strict";e.__esModule=!0;i=i(0),n.dataLoadedSignal=new i.Signal,n.PlayerSignal=new i.Signal,n.SensorSignal=new i.Signal,n.MatchProcessorSignal=new i.Signal,n.MatchEndSignal=new i.Signal,n.EventSignal=new i.Signal,i=n;function n(){}e.Signals=i},function(t,e,i){"use strict";e.__esModule=!0;var n=(r.ARENA=0,r.BASKET=1,r.BALL=2,r.PLAYER=3,r.SHADOW=4,r.EFFECTS=5,r.INFO=6,r);function r(){}e.ObjectsType=n},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(1),a=i(4),l=i(8),p=i(0),r=(s=Phaser.Graphics,r(h,s),h);function h(t,e,i){void 0===i&&(i=null);var n=s.call(this,t)||this;return t.add.existing(n),e.backgroundBase&&(t=n.game.make.sprite(0,0,o.Atlases.Interface,l.default.BASE_BG[l.default.INDEX_BG+1===3?0:l.default.INDEX_BG+1]+"0000"),e.backgroundBase.addChildAt(t,0),t.alpha=.5,(t=n.game.add.tween(t)).to({alpha:1},a.default.PRELOADER_TIME_HALF,p.Easing.Linear.None),t.start(),l.default.INDEX_BG++,l.default.INDEX_BG>=l.default.BASE_BG.length&&(l.default.INDEX_BG=0),e.backgroundBaseMask&&(e.backgroundBase.mask=e.backgroundBaseMask)),null!==i&&i.call(e),n}e.default=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0,i(6),i(0);var s,o=i(5),a=i(1),l=i(7),p=i(17),h=i(8),u=i(2),c=i(9),d=i(21),_=i(11),y=i(10),f=i(33),m=i(26),x=i(12),v=i(4),g=i(0),r=(s=Phaser.State,r(b,s),b.prototype.init=function(){this.game.world.removeAll()},b.prototype.create=function(){s.prototype.create.call(this),this.background=this.game.add.sprite(0,0,a.Atlases.Interface,"bg0000"),this.backgroundBase=this.game.add.sprite(0,0,a.Atlases.Interface,h.default.getBG()),this.backgroundBase2=this.game.add.sprite(299,0,a.Atlases.Interface,"bg0000"),this.backgroundBase.addChild(this.backgroundBase2),this.backgroundBaseMask=this.game.add.graphics(0,0),this.backgroundBaseMask.beginFill(65280,0),this.backgroundBaseMask.drawRect(0,0,1398,480),this.backgroundBaseMask.endFill(),this.background4=this.game.add.sprite(400,290,a.Atlases.Interface,"bg0000");var t=null;(t=this.game.add.sprite(-185,66,a.Atlases.Interface,"body00000")).anchor.set(.5),this.background4.addChild(t),(t=this.game.add.sprite(230,55,a.Atlases.Interface,"body10000")).anchor.set(.5),this.background4.addChild(t),(t=this.game.add.sprite(10,5,a.Atlases.Interface,"0bg100000")).anchor.set(.5),t.scale.set(1,.8),this.background4.addChild(t),(t=this.game.add.sprite(-213,-50,a.Atlases.Interface,"head00000")).anchor.set(.5),t.scale.set(.95),this.background4.addChild(t),(t=this.game.add.sprite(215,-55,a.Atlases.Interface,"head10000")).anchor.set(.5),t.scale.set(-.95,.95),this.background4.addChild(t),this.background4.anchor.set(.5),this.playBtn1=new l.default(this.game,"TOURNAMENT",a.Constants.stylePlay,this.startTournament,this,a.Atlases.Interface),this.playBtn1.setFrames("bg0000","bg0000","bg0000","bg0000"),this.playBtn1.y=-105,this.background4.addChild(this.playBtn1),this.playBtn1.scale.set(1,1),this.playBtn2=new l.default(this.game,"RANDOM",a.Constants.stylePlay,this.startRandom,this,a.Atlases.Interface),this.playBtn2.y=0,this.playBtn2.label.parent.y=-40,this.playBtn2.setFrames("bg0000","bg0000","bg0000","bg0000"),this.background4.addChild(this.playBtn2);t=new l.default(this.game,"MATCH",a.Constants.stylePlay,null,null,a.Atlases.Interface);t.label.parent.y=40,t.setFrames("bg0000","bg0000","bg0000","bg0000"),t.inputEnableChildren=!0,this.playBtn2.label.addChild(t);t=new l.default(this.game,"TRAINING",a.Constants.stylePlay2,this.startTraining,this,a.Atlases.Interface);t.setFrames("bg0000","bg0000","bg0000","bg0000"),t.y=60,this.background4.addChild(t),this.playBtn3=new l.default(this.game,"BACK",a.Constants.stylePlay4,this.onBack,this,a.Atlases.Interface),this.playBtn3.setFrames("arrow0000","arrow0000","arrow0000","arrow0000"),this.playBtn3.label.x+=110;t=this.game.add.image(0,0,a.Atlases.Interface,"bg0000");t.anchor.set(.5),t.x=80,t.height=58,t.width=200,this.playBtn3.btn.addChild(t),this.playBtn3.x=-75,this.playBtn3.y=110,this.background4.addChild(this.playBtn3),this.leaderBoardBtn=new l.default(this.game,"",null,this.onScoreList,this,a.Atlases.Interface),this.leaderBoardBtn.setFrames("btn_bg0000","btn_bg0000","btn_bg0000","btn_bg0000"),this.leaderBoardBtn.sScale=.7,this.leaderBoardBtn.sLabelScale=.7;t=this.game.add.image(0,0,a.Atlases.Interface,"lead_icon0000");t.anchor.set(.5),this.leaderBoardBtn.label.parent.addChild(t),this.logo=this.game.add.sprite(400,72,a.Images.GameLogo),this.logo.anchor.set(.5),this.backgroundBase2.addChild(this.logo),this.musicBtn=new l.default(this.game,"",{},this.toggleMusic,this,a.Atlases.Gameplay),this.musicBtn.setFrames("btn_bg0000","btn_bg0000","btn_bg0000","btn_bg0000"),this.musicBtn.sScale=42/this.musicBtn.btn.width,this.musicBtn.x=772,this.musicBtn.y=25,this.musicBtn.labelState=this.game.add.image(0,0,a.Atlases.Gameplay,"InGameMusicButton0000"),this.backgroundBase2.addChild(this.musicBtn),this.updateSoundButtons(),this.backgroundBase2.addChild(this.leaderBoardBtn),this.leaderBoardBtn.x=730,this.leaderBoardBtn.y=150,this.backgroundBase2.addChild(this.background4),this.leaderBoardBtn.visible=!1,this.resize(),new p.default(this.game,this,this.show)},b.prototype.show=function(){var t=this.game.add.tween(this.background4);t.from({y:800},v.default.PRELOADER_TIME,g.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.logo)).from({y:-145},v.default.PRELOADER_TIME,g.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.leaderBoardBtn)).from({x:1600},v.default.PRELOADER_TIME,g.Easing.Back.Out),t.start()},b.prototype.hide=function(){var t=this.game.add.tween(this.background4);t.to({y:800},v.default.PRELOADER_TIME),t.start(),(t=this.game.add.tween(this.logo)).to({y:-145},v.default.PRELOADER_TIME),t.start(),(t=this.game.add.tween(this.leaderBoardBtn)).to({x:1600},v.default.PRELOADER_TIME,g.Easing.Linear.None),t.start()},b.prototype.onMoreGames=function(){window.open(d.default.getInstance().getUrl(d.default.Current),"_blank")},b.prototype.startTournament=function(){var t,e;o.default.getInstance().play(a.Sounds.Click),u.Inventory.instance.getTournament()?(this.createPopup("0bg100000"),(t=this.popup.getChildAt(0)).alpha=.5,t.inputEnabled=!0,t.events.onInputDown.addOnce(this.disposePopup,this),(e=new y.default(this.game,"CONTINUE TOURNAMENT",a.Constants.styleTournamentPopup,this.startOLDTournament,this,a.Atlases.Interface)).setFrames("bg0000","bg0000","bg0000","bg0000"),e.y=-140,this.popup.getChildAt(1).addChild(e),(e=new y.default(this.game,"NEW TOURNAMENT",a.Constants.styleTournamentPopup,this.startNEWTournament,this,a.Atlases.Interface)).setFrames("bg0000","bg0000","bg0000","bg0000"),e.y=-65,this.popup.getChildAt(1).addChild(e),t={font:"bold 28px Impact2",fill:"#FF99FF"},(e=new c.default(this.game,0,-10,"WARNING",t)).anchor.set(.5),this.popup.getChildAt(1).addChild(e),(e=new c.default(this.game,0,20,"IF YOU CHOOSE",t)).anchor.set(.5),this.popup.getChildAt(1).addChild(e),(e=new c.default(this.game,0,50,"NEW TOURNAMENT,",t)).anchor.set(.5),this.popup.getChildAt(1).addChild(e),(e=new c.default(this.game,0,80,"YOU WILL LOST",t)).anchor.set(.5),this.popup.getChildAt(1).addChild(e),(e=new c.default(this.game,0,110,"YOUR PROGRESS",t)).anchor.set(.5),this.popup.getChildAt(1).addChild(e),this.resize()):this.startNEWTournament()},b.prototype.startNEWTournament=function(){u.Inventory.instance.matchData.matchMode=0,u.Inventory.instance.breakTournament(),new h.default(this.game,this,m.default.Name)},b.prototype.startOLDTournament=function(){u.Inventory.instance.matchData.matchMode=0,new h.default(this.game,this,x.TournamentState.Name)},b.prototype.startRandom=function(){o.default.getInstance().play(a.Sounds.Click),u.Inventory.instance.matchData.resetScore(),u.Inventory.instance.gameMode=1,new h.default(this.game,this,m.default.Name)},b.prototype.startTraining=function(){o.default.getInstance().play(a.Sounds.Click),u.Inventory.instance.matchData.resetScore(),u.Inventory.instance.gameMode=3,new h.default(this.game,this,x.Gameplay.Name)},b.prototype.onScoreList=function(){o.default.getInstance().play(a.Sounds.Click)},b.prototype.toggleMusic=function(){_.default.getInstance().music?o.default.getInstance().toggleMusic():_.default.getInstance().sfx?o.default.getInstance().toggleSfx():(o.default.getInstance().toggleSfx(),o.default.getInstance().toggleMusic()),this.updateSoundButtons(),o.default.getInstance().play(a.Sounds.Click)},b.prototype.updateSoundButtons=function(){var t=_.default.getInstance().music?0:1;t+=_.default.getInstance().sfx?0:1,this.musicBtn.labelState.loadTexture(a.Atlases.Gameplay,"InGameMusicButton000"+t)},b.prototype.onBack=function(){o.default.getInstance().play(a.Sounds.Click),new h.default(this.game,this,f.default.Name)},b.prototype.disposePopup=function(){this.popup.destroy(),this.popup=null,this.popup_btn&&(this.popup_btn.destroy(),this.popup_btn=null)},b.prototype.backgroundPopup=function(){this.popup=this.game.add.sprite(350,280,a.Atlases.Interface,"bg0000"),this.popup.anchor.set(.5),this.popup.scale.set(1.3);var t=this.game.add.sprite(0,0,a.Atlases.Interface,"black0000");t.width=this.game.width+500,t.height=this.game.height+500,t.inputEnabled=!0,t.anchor.set(.5),this.popup.addChild(t)},b.prototype.createPopup=function(t){void 0===t&&(t="0bg100000"),null!==this.popup&&this.disposePopup(),this.backgroundPopup();var e=this.game.add.sprite(0,0,a.Atlases.Interface,"bg0000");e.anchor.set(.5),e.inputEnabled=!0,this.popup.addChild(e);t=this.game.add.sprite(0,-30,a.Atlases.Interface,t);t.scale.set(1.8,1),t.anchor.set(.5),e.addChild(t)},b.prototype.resizePopup=function(t){var e;null!==this.popup&&((e=this.popup.removeChildAt(0)).width=this.game.width+500,e.height=this.game.height+500,this.popup.x=this.world.bounds.centerX,this.popup.y=this.world.bounds.centerY,this.popup.addChildAt(e,0),this.popup_btn&&(this.popup_btn.x=this.world.bounds.centerX-270*t,this.popup_btn.y=this.world.bounds.centerY+200*t))},b.prototype.resize=function(){var t=1;t=1<(t=this.game.width/a.Constants.WIDTH)?1:t,t*=1.33333,this.backgroundBase.scale.set(t),this.backgroundBase.alignIn(this.world.bounds,Phaser.TOP_CENTER),this.background.scale.set(t),this.background.alignIn(this.backgroundBase2,Phaser.BOTTOM_CENTER),this.backgroundBaseMask.scale.set(t,t),this.backgroundBaseMask.x=this.backgroundBase.x,this.backgroundBaseMask.y=this.backgroundBase.y,this.resizePopup(t),s.prototype.resize.call(this)},b.prototype.shutdown=function(){this.background=null,this.popup=null,this.popup_btn=null,this.playBtn1=null,this.playBtn2=null,this.playBtn3=null,this.leaderBoardBtn=null,this.musicBtn=null,s.prototype.shutdown.call(this)},b.Name="menu2",b);function b(){var t=s.call(this)||this;return t.name=b.Name,t.popup=null,t.popup_btn=null,t}e.default=r},function(t,e,i){"use strict";e.__esModule=!0;var n=(_.normalizeAngle=function(t){return t>Math.PI?t-=2*Math.PI:t<-Math.PI&&(t+=2*Math.PI),t},_.normalizeAngle2=function(t){return(t%=2*Math.PI)>Math.PI?t-=2*Math.PI:t<-Math.PI&&(t+=2*Math.PI),t},_.normalizeVertices=function(t){var e={};e.className=t.className,e.params={},e.params.vertices=[];var i,n=t.params,r=n.x,s=n.y;for(i in n)"vertices"!==i&&(e.params[i]=n[i]);for(var o=_.TO_RAD*n.rotation,a=n.vertices,l=e.params.vertices,p=a.length,h=0;h<p;h++){var u,c=Math.round(a[h].x),d=Math.round(a[h].y);l[h]={},0===c&&0===d?(l[h].x=r,l[h].y=s):(u=void 0,u=Math.atan2(d,c),d=Math.sqrt(c*c+d*d),u+=o,l[h].x=r+Math.cos(u)*d,l[h].y=s+Math.sin(u)*d)}return e.params.x=0,e.params.y=0,e.params.rotation=0,e},_.dist=function(t,e,i,n){return Math.sqrt((t-i)*(t-i)+(e-n)*(e-n))},_.TO_RAD=Math.PI/180,_.TO_DEG=180/Math.PI,_.PIdiv2=Math.PI/0,_.PIdiv4=Math.PI/4,_.PIdiv4mul3=3*Math.PI/4,_);function _(){}e.default=n;r.rand=function(t,e){return t-.5*e+e*Math.random()},n=r;function r(){}e.MyRand=n},function(t,e,i){"use strict";e.__esModule=!0;var n=(r.prototype.activate=function(){this.delta=0,this.dispersion=Math.random()*this.range,this.delay=this.fixed+this.dispersion},r.prototype.update=function(t){return 0<=this.delta?(this.result=0,this.delta+=t,this.delta>=this.delay&&(this.result=1,this.delta=-1),this.result):-1},r.prototype.reset=function(){this.delta=-1},r);function r(t,e){void 0===e&&(e=0),this.result=0,this.delta=-1,this.fixed=e,this.range=t}e.FullDelay=n},function(t,e,i){"use strict";e.__esModule=!0;var n=(r.getInstance=function(){return null===r.instance&&(r.instance=new r),r.instance},r.prototype.checkDomain=function(t){for(var e=0;e<this.brandDomains.length;e++){var i=this.brandDomains[e];if(-1!==t.indexOf(i))return!0}return!1},r.prototype.getUrlLock=function(){return null!==r.Current?this.brandInstances[r.Current]:""},r.prototype.getUrl=function(t){return this.brandInstances[t]},r.instance=null,r.YEP10="yep10",r.Current=r.YEP10,r.Google="google",r.Apple="itunes",r);function r(){this.brandInstances={},this.brandDomains=[],this.brandInstances[r.YEP10]="http://yep10.com/?utm_source=bb_2019",this.brandInstances[r.Google]="https://play.google.com/store/apps/details?id=air.com.madpuffers.football",this.brandInstances[r.Apple]="https://itunes.apple.com/us/app/euro-football-legends/id1124042258&utm_source=flash_fl2016&utm_medium=banner&utm_campaign=football_legends_ios",r.Current=r.YEP10,this.brandDomains=[],this.brandDomains.push("y8.com"),this.brandDomains.push("id.net"),this.brandDomains.push("pog.com"),this.brandDomains.push("gamepost.com"),this.brandDomains.push("dollmania.com"),this.brandDomains.push("madpuffers.com")}e.default=n},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=nape.space.Space,a=i(28),l=i(23),p=nape.callbacks.CbEvent,h=nape.callbacks.InteractionListener,u=nape.callbacks.InteractionType,c=i(2),d=i(40),_=i(15),r=(s=a.GamePhysics,r(y,s),y.prototype.start=function(){y.hasListeners||this.setupListners()},y.prototype.setupListners=function(){y.space.listeners.add(new h(p.BEGIN,u.COLLISION,c.CbTypes.cbBall,c.CbTypes.cbGround,this.onBallGround)),y.space.listeners.add(new h(p.BEGIN,u.COLLISION,c.CbTypes.cbBall,c.CbTypes.cbBorders,this.onBallBorder)),y.space.listeners.add(new h(p.BEGIN,u.COLLISION,c.CbTypes.cbBall,c.CbTypes.cbBasket,this.onBallBasket)),y.space.listeners.add(new h(p.BEGIN,u.COLLISION,c.CbTypes.cbBall,c.CbTypes.cbRing,this.onBallRing)),y.space.listeners.add(new h(p.BEGIN,u.COLLISION,c.CbTypes.cbBall,c.CbTypes.cbShield,this.onBallShield)),y.space.listeners.add(new h(p.BEGIN,u.SENSOR,c.CbTypes.cbBall,c.CbTypes.cbPlayersHands,this.onBallHands)),y.space.listeners.add(new h(p.BEGIN,u.COLLISION,c.CbTypes.cbBall,c.CbTypes.cbPlayersBlock,this.onBallBlock)),y.space.listeners.add(new h(p.BEGIN,u.SENSOR,c.CbTypes.cbPlayersBlock,c.CbTypes.cbDownSensor,this.onBlockSensor)),y.space.listeners.add(new h(p.BEGIN,u.COLLISION,c.CbTypes.cbPlayer,c.CbTypes.cbGround,this.onPlayerGround)),y.space.listeners.add(new h(p.BEGIN,u.SENSOR,c.CbTypes.cbBall,c.CbTypes.cbUpperSensor,this.onUpperSensor)),y.space.listeners.add(new h(p.BEGIN,u.SENSOR,c.CbTypes.cbBall,c.CbTypes.cbDownSensor,this.onDownSensor)),y.hasListeners=!0},y.prototype.onBallGround=function(t){t.int1.castBody.userData.owner.onGroundCollision(!0)},y.prototype.onBallBorder=function(t){t.int1.castBody.userData.owner.onGroundCollision(!1)},y.prototype.onBallRing=function(t){var e=t.int1.castBody.userData.owner;e.setState("basket"),0<t.arbiters.length&&t.arbiters.at(0).collisionArbiter.contacts.at(0).position.y<198&&e.playSnd(1)},y.prototype.onBallBasket=function(t){t=t.int1.castBody.userData.owner;t.setState("basket"),t.playSnd(2)},y.prototype.onBallBlock=function(t){var e=t.int1.castBody.userData.owner,i=!1;t.int2.castShape.body&&(i=0<(e.getX()-t.int2.castShape.worldCOM.x)*e.SIDE),t.int2.castShape.body&&i&&(t=t.int2.castShape.body.userData.owner,e.setState("block",t.SIDE),d.MatchProcessor.instance.block(t.SIDE,t.isHuman),_.Signals.EventSignal.dispatch(t.isHuman,4))},y.prototype.onBallHands=function(t){var e=t.int2.castShape.body.userData.owner,i=e.SIDE,n=e.playerNo;e.canTakeInHands&&t.int1.castBody.userData.owner.takeInHands(i,n)},y.prototype.onBlockSensor=function(t){t.int1.castShape.body&&t.int1.castShape.body.userData.owner.removeBlock()},y.prototype.onPlayerGround=function(t){t.int1.castShape.body.userData.owner.onGroundCollision()},y.prototype.onUpperSensor=function(t){_.Signals.SensorSignal.dispatch(0,t.int2.castShape.body.userData.side)},y.prototype.onDownSensor=function(t){_.Signals.SensorSignal.dispatch(1,t.int2.castShape.body.userData.side),t.int1.castBody.userData.owner.onDownSensor()},y.prototype.onBallShield=function(t){var e=t.int2.castShape.body.userData.side;t.int1.castBody.userData.owner.onShieldCollision(e)},y.prototype.update=function(t){y.space.step(t)},y.prototype.updateGraphics=function(){for(var t=y.space.liveBodies.iterator();t.hasNext();){var e=t.next(),i=e.userData;i.graphic&&((i=i.graphic).x=e.position.x,i.y=e.position.y,i.rotation=e.rotation%(2*Math.PI))}},y.prototype.add=function(t){t.body&&(t.body.space=y.space)},y.prototype.release=function(){for(;!y.space.bodies.empty();)l.NapeUtil.disposeBody(y.space.bodies.at(0));s.prototype.release.call(this),y.space.clear(),y.space=null,y.hasListeners=!1},y.hasListeners=!1,y.isGoal=!1,y);function y(){var t=s.call(this)||this;return y.space=new o(c.ObjectsData.GRAVITY),t}e.NapePhysics=r},function(t,e,i){"use strict";e.__esModule=!0;var o=i(19),n=nape.constraint.PivotJoint,d=nape.geom.GeomPoly,r=nape.geom.GeomPolyList,_=nape.geom.Vec2,y=nape.phys.Body,i=nape.phys.BodyList,f=nape.phys.BodyType,p=nape.shape.Circle,m=nape.shape.Polygon,i=(c.disposeBody=function(t){c.clearUserData(t),t.cbTypes.clear(),t.compound?t.compound=null:t.space=null},c.resetStartPos=function(t){t.position.x=t.userData.sx,t.position.y=t.userData.sy,t.rotation=t.userData.sr},c.clearUserData=function(t){for(var e in t.userData)t.userData.hasOwnProperty(e)&&(t.userData[e]=null)},c.createRectBody=function(t,e,i,n,r,s){void 0===r&&(r=null),void 0===s&&(s=null);e=new m(m.box(n.width,n.height,!0),s,e);e.sensorEnabled=i;r=c.createBody(t,n.x,n.y,o.default.TO_RAD*n.rotation,r);return r.shapes.add(e),r},c.createRectBodyWH=function(t,e,i,n,r,s,o,a,l,p){void 0===s&&(s=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===l&&(l=null),void 0===p&&(p=null);e=new m(m.box(n,r,!0),p,e);e.sensorEnabled=i;l=c.createBody(t,s,o,a,l);return l.shapes.add(e),l},c.createRegularBody=function(t,e,i,n,r,s,o,a,l,p,h){void 0===o&&(o=0),void 0===a&&(a=0),void 0===l&&(l=0),void 0===p&&(p=null),void 0===h&&(h=null);e=new m(m.regular(.5*n,.5*r,s,0,!0),h,e);e.sensorEnabled=i;p=c.createBody(t,o,a,l,p);return p.shapes.add(e),p},c.createBody=function(t,e,i,n,r){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=null);i=new y(t,_.weak(e,i));return i.rotation=n,null!=r&&i.cbTypes.add(r),i},c.createCircleBody=function(t,e,i,n,r,s,o,a,l){void 0===r&&(r=0),void 0===s&&(s=0),void 0===o&&(o=0),void 0===a&&(a=null),void 0===l&&(l=null);e=new p(n,null,l,e);e.sensorEnabled=i;o=c.createBody(t,r,s,o,a);return null!=a&&o.cbTypes.add(a),o.shapes.add(e),o},c.bodiesInCircle=function(t,e,i,n,r){return void 0===n&&(n=!1),void 0===r&&(r=null),c.bodyList.clear(),t.bodiesInCircle(e,i,n,r,c.bodyList),c.bodyList},c.bodiesUnderPoint=function(t,e,i){return void 0===i&&(i=null),c.bodyList.clear(),t.bodiesUnderPoint(e,i,c.bodyList),c.bodyList},c.createPolyBody=function(t,e,i,n){for(var r,s=t instanceof Array?(r=t,new y(n)):(r=t.vertices,new y(n,_.weak(t.x,t.y))),o=r.length,a=[],l=0;l<o;l++)a[l]=_.get(r[l].x,r[l].y);var p=new d(a);if(p.isConvex())s.shapes.add(new m(p,e,i)),p.dispose();else for(p.convexDecomposition(!1,c.geomPolyList),p.dispose();!c.geomPolyList.empty();)p=c.geomPolyList.pop(),s.shapes.add(new m(p,e,i)),p.dispose();return s},c.createPolyShape=function(t,e,i,n,r){for(var s=e.vertices,o=s.length,a=[],l=0;l<o;l++)a.push(_.get(e.x+s[l].x,e.y+s[l].y));var p=new d(a);if(p.isConvex()){var h=new m(p,i,n);h.cbTypes.add(r),t.shapes.add(h),p.dispose()}else for(p.convexDecomposition(!1,c.geomPolyList),p.dispose();!c.geomPolyList.empty();){p=c.geomPolyList.pop();var u=new m(p,i,n);u.cbTypes.add(r),t.shapes.add(u),p.dispose()}},c.createSensor=function(t,e,i){var n=new m(m.rect(e.x,e.y-e.height/2,e.width,e.height));n.sensorEnabled=!0,n.cbTypes.add(i),n.userData.id=e.id,t.shapes.add(n)},c.createPivot=function(t,e,i){return new n(t,e,t.worldPointToLocal(i,!0),e.worldPointToLocal(i,!0))},c.disposeJoint=function(t){t.active=!1,t.space=null,t.body1=null,t.body2=null},c.createPatherBody=function(t,e,i,n){(e=e.copy()).density=t.params.density;for(var r,s=new y(t.params.isStatic?f.STATIC:f.DYNAMIC,_.weak(t.params.x,t.params.y)),o=[_.get(),_.get(),_.get(),_.get()],a=_.get(),l=_.get(),p=t.params.vertices,h=p.length,u=0;u<h-1;u++){a.setxy(p[u+1].x-p[u].x,p[u+1].y-p[u].y),0===u?(r=a.angle+.5*Math.PI,o[0].x=p[u].x-.5*n*Math.cos(r),o[0].y=p[u].y-.5*n*Math.sin(r),o[1].x=p[u].x+.5*n*Math.cos(r),o[1].y=p[u].y+.5*n*Math.sin(r)):(o[0].x=o[3].x,o[0].y=o[3].y,o[1].x=o[2].x,o[1].y=o[2].y),u===h-2?(r=a.angle+.5*Math.PI,o[3].x=p[u+1].x-.5*n*Math.cos(r),o[3].y=p[u+1].y-.5*n*Math.sin(r),o[2].x=p[u+1].x+.5*n*Math.cos(r),o[2].y=p[u+1].y+.5*n*Math.sin(r)):(a.muleq(-1/a.length),l.setxy(p[u+2].x-p[u+1].x,p[u+2].y-p[u+1].y),l.muleq(1/l.length),r=(c=_.get(a.x+l.x,a.y+l.y)).angle,o[3].x=p[u+1].x-.5*n*Math.cos(r),o[3].y=p[u+1].y-.5*n*Math.sin(r),o[2].x=p[u+1].x+.5*n*Math.cos(r),o[2].y=p[u+1].y+.5*n*Math.sin(r),c.dispose());var c;new d(o).isConvex()||(c=o[3],o[3]=o[2],o[2]=c),new m(o,e,i).body=s}return a.dispose(),l.dispose(),o[0].dispose(),o[1].dispose(),o[2].dispose(),o[3].dispose(),o=null,s.align(),s},c.geomPolyList=new r,c.bodyList=new i,c);function c(){}e.NapeUtil=i},function(t,e,i){"use strict";e.__esModule=!0;var n=i(37),r=i(70),s=i(71),o=i(72),a=i(73),l=i(75),i=(p.prototype.initManagers=function(){this.achievsMgr=new a.AchievsDataManager(this.save,this.ACHIEVS,!this.isLocal),this.achievsMgr.signalSave.add(n.default.getInstance().save,n.default.getInstance()),this.statsMgr=new l.StatsDataManager(this.save,this.STATS,!this.isLocal,this.achievsMgr),this.statsMgr.signalSave.add(n.default.getInstance().save,n.default.getInstance())},Object.defineProperty(p,"instance",{get:function(){return null===p._instance&&(p._instance=new p),p._instance},enumerable:!0,configurable:!0}),p.prototype.init=function(){var t;this.inited||(this.inited=!0,this.save={},t=this.save[p.LAST_ENTER],this.save[p.LAST_ENTER]=Date.now(),t||(this.firstEnter=!0),this.gameMode=0,this.currentScore=0,this.clearWin=0,this.losesCount=0,this.localGamesCount=0,this.prevShowForum=0,p.instance.initManagers())},p.prototype.saveTournament=function(){var t=this.tournament.getValues(),e=this.SAVE;this.save[e]=t,n.default.getInstance().save()},p.prototype.getTournament=function(){var t=this.SAVE,t=this.save[t];return!!t&&(this.tournament.setValues(t),!0)},p.prototype.breakTournament=function(){this.clearTournamentData(),this.clearTournamentSave()},p.prototype.clearTournamentData=function(){this.tournament.resetAll()},p.prototype.clearTournamentSave=function(){var t=this.SAVE;delete this.save[t],n.default.getInstance().save()},p.prototype.reset=function(){this.inited=!1,this.init()},p.prototype.checkQuickMatch=function(){return 3===this.gameMode},p.prototype.isFinal=function(){return this.team===this.rounds[28]||this.team===this.rounds[29]},p.prototype.summarizeMatch=function(){var t;0===this.gameMode&&(this.matchScores=o.ScoresCalculator.calcScores(this.matchData.matchScore,this.tournament.state,this.tournament.difficulty,this.tournament.isSecondPlace()),this.tournament.scores+=this.matchScores,this.statsMgr.updateScore(this.tournament.scores,this.tournament.mode),t=this.matchData.matchScore[0],this.tournament.points+=t,this.achievsMgr.updateData(7,t),1===this.tournament.difficulty&&this.achievsMgr.updateData(8,t))},p.prototype.checkForumAchievement=function(){this.achievsMgr.updateData(12)},Object.defineProperty(p.prototype,"firstRun",{get:function(){return!this.save.hasOwnProperty("firstRun")||this.save.firstRun},set:function(t){this.save.firstRun=t,n.default.getInstance().save()},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"firstRun2",{get:function(){return!this.save.hasOwnProperty("firstRun2")||this.save.firstRun2},set:function(t){this.save.firstRun2=t,n.default.getInstance().save()},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"rounds",{get:function(){return this.tournament.rounds},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"results",{get:function(){return this.tournament.results},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"opponent",{get:function(){return this.tournament.opponent},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"team",{get:function(){return this.tournament.team},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"teamNo",{get:function(){return this.tournament.teamRound},enumerable:!0,configurable:!0}),p.prototype.nextLeg=function(){var t="Standings";this.calcVars();var e=this.tournament.generateResults(this.startId,this.endId,this.isFinalLegs,this.matchData.matchScore);if(this.tournament.state++,this.summarizeMatch(),4===this.tournament.state)this.summarizeTournament(!0),t="Final";else if(e)this.tournament.defineOpponent(),this.saveTournament(),t="Standings";else{for(var i=this.tournament.state;i<4;i++)this.calcVars(),this.tournament.generateResults(this.startId,this.endId,this.isFinalLegs),this.tournament.state++;this.summarizeTournament(!1),t="Final"}return[e,t]},p.prototype.calcVars=function(){this.isFinalLegs=!1;var t=this.tournament.state;0===t?(this.startId=0,this.endId=8):1===t?(this.startId=8,this.endId=12):(2===t?(this.startId=12,this.endId=14):(this.startId=14,this.endId=16),this.isFinalLegs=!0)},p.prototype.summarizeTournament=function(t){var e=this.tournament.getPlace();t&&e<4&&(this.achievsMgr.updateData(14+3*this.tournament.mode+e),1===e&&(17===this.tournament.team&&this.achievsMgr.updateData(11),1===this.tournament.difficulty&&this.achievsMgr.updateData(13+this.tournament.mode))),this.achievsMgr.updateData(9,this.tournament.points),1===this.tournament.difficulty&&this.achievsMgr.updateData(10,this.tournament.points)},p.prototype.breakMatch=function(){0===this.gameMode&&this.breakTournament(),this.matchData.finishMatch(this.gameMode)},p.prototype.getTitleFrame=function(){var t=-1===this.matchData.whoWins();return 4!==this.gameMode||2===this.matchData.matchMode?t?1:2:t?3:4},p.prototype.isPvP=function(){return 4===this.gameMode&&this.matchData.matchMode<2},p.prototype.createNewTournament=function(){this.tournament.createNewTournament(this.matchData),this.saveTournament()},p.prototype.startTournamentMatch=function(){this.matchData.startTournamentMatch(this.tournament)},p.prototype.showAdditionalGUI=function(){0===this.gameMode&&this.matchData.matchScore[0]<=this.matchData.matchScore[1]&&this.losesCount++,this.isLocal&&this.notLogged&&this.localGamesCount++;var t=Date.now();return 3<=this.losesCount&&(0===this.prevShowForum||t-this.prevShowForum>=this.timeToShowAdditionalGUI)?(this.prevShowForum=t,this.losesCount=0,1):3<=this.localGamesCount&&(0===this.prevShowRegister||t-this.prevShowRegister>=this.timeToShowAdditionalGUI)?(this.prevShowRegister=t,this.localGamesCount=0,2):0},p.prototype.getAchievsArray=function(){return this.achievsMgr.getValuesForRead()},p.prototype.getMatchScores=function(){return this.matchScores},p.prototype.getTournamentScores=function(){return this.tournament.scores},p.prototype.getTotalScores=function(){return this.statsMgr.getTotalScores()},p.LAST_ENTER="l_e",p._instance=null,p);function p(){if(this.nickNames=["points3","dunks","fromBlock","buzzer","blocks","steals","scores","pointsM","pointsMH","pointsT","pointsTH","idNet","forum","GC1","SC1","BC1","GC2","SC2","BC2","GC1H","GC2H"],this.save=null,this.firstEnter=!1,this.inited=!1,this.isLocal=!0,this.gameMode=0,this.matchData=null,this.tournament=null,this.currentScore=0,this.clearWin=0,this.losesCount=0,this.localGamesCount=0,this.prevShowForum=0,this.SAVE="tsave",this.ACHIEVS="achievs",this.STATS="stats",this.outInfo="",this.timeToShowAdditionalGUI=18e5,this.notLogged=!0,null!==p._instance)throw new Error("Signleton: Must be only one Object");this.isLocal=!0,this.matchData=new r.MatchData(this.isLocal),this.tournament=new s.TournamentData,this.matchData.matchMode=0}e.Inventory=i},function(t,e,i){"use strict";e.__esModule=!0;var n=(r.prototype.playerOnGround=function(){},r.prototype.playerOnBlock=function(){},r.prototype.ballInOwnHands=function(t){void 0===t&&(t=0)},r.prototype.ballInOpponentsHands=function(t){void 0===t&&(t=0)},r.prototype.ballOwnShoot=function(t){void 0===t&&(t=0)},r.prototype.ballOpponentShoot=function(t){void 0===t&&(t=0)},r.prototype.ballOthers=function(){},r.prototype.readyForAction=function(){return!1},r.prototype.releaseBlockOrPump=function(t){return!1},r.prototype.restart=function(t){},r.prototype.update=function(t){},r.prototype.dispose=function(){this.player=null},r);function r(t){this.type=-1,this.player=t,this.SIDE=t.SIDE}e.BaseController=n},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0,i(6),i(0);var s,o=i(5),a=i(1),l=i(7),p=i(17),h=i(8),u=i(2),c=i(9),d=i(11),_=i(32),y=i(18),f=i(102),m=i(51),x=i(12),v=i(4),g=i(0),r=(s=Phaser.State,r(b,s),b.prototype.init=function(){this.game.world.removeAll(),this.manager=u.Inventory.instance},b.prototype.create=function(){s.prototype.create.call(this),u.PlayersData.initDragonbones(!0),this.backgroundBase=this.game.add.sprite(0,0,a.Atlases.Interface,h.default.getBG()),this.backgroundBase2=this.game.add.sprite(299,0,a.Atlases.Interface,"bg0000"),this.backgroundBase.addChild(this.backgroundBase2),this.backgroundBaseMask=this.game.add.graphics(0,0),this.backgroundBaseMask.beginFill(65280,0),this.backgroundBaseMask.drawRect(0,0,1398,480),this.backgroundBaseMask.endFill(),this.background5=this.game.add.sprite(600,240,a.Atlases.Interface,"bg0000"),this.background4=this.game.add.sprite(200,240,a.Atlases.Interface,"bg0000"),this.background5.anchor.set(.5),this.background4.anchor.set(.5),this.selectPlayer=new f.SelectPlayer(0),this.selectPlayer.x=162,this.selectPlayer.y=131,this.backgroundBase2.addChild(this.selectPlayer),this.musicBtn=new l.default(this.game,"",{},this.toggleMusic,this,a.Atlases.Gameplay),this.musicBtn.setFrames("btn_bg0000","btn_bg0000","btn_bg0000","btn_bg0000"),this.musicBtn.sScale=42/this.musicBtn.btn.width,this.musicBtn.x=772,this.musicBtn.y=25,this.musicBtn.labelState=this.game.add.image(0,0,a.Atlases.Gameplay,"InGameMusicButton0000"),this.backgroundBase2.addChild(this.musicBtn),this.backgroundBase2.addChild(this.background4),this.updateSoundButtons(),(this.manager.matchData.matchMode=0)===this.manager.gameMode?(0===this.manager.matchData.matchMode&&(this.createPanel(),this.createDifficultySelect()),this.selectPlayer.setUp(0)):(this.createP2Select(),this.createPanel(),0===this.manager.matchData.matchMode&&4!==u.Inventory.instance.gameMode?(this.selectPlayer.setUp(),this.selectPlayer2.setUp(2)):1===this.manager.matchData.matchMode?(this.selectPlayer.setUp(1),this.selectPlayer2.setUp(2)):(this.selectPlayer.setUp(),this.selectPlayer2.setUp())),this.logo=this.game.add.sprite(400,35,a.Atlases.Interface,"bg0000"),this.logo.anchor.set(.5);var t="RANDOM MATCH";4===u.Inventory.instance.gameMode?t="2 PLAYERS MATCH":0===u.Inventory.instance.gameMode&&(t="TOURNAMENT",u.Inventory.instance.tournament.state=0);t=new l.default(this.game,t,a.Constants.styleTitle2,null,null,a.Atlases.Interface);t.setFrames("bg0000","bg0000","bg0000","bg0000"),this.logo.addChild(t),this.logo.x=400,this.backgroundBase2.addChild(this.logo),0===u.Inventory.instance.gameMode?(this.playBtn=new l.default(this.game,"NEXT",a.Constants.stylePlayGreen,this.onTournament,this,a.Atlases.Interface),this.playBtn.setFrames("arrow20000","arrow20000","arrow20000","arrow20000"),this.playBtn.btn.x=110,this.playBtn.x=646):(this.playBtn=new l.default(this.game,"PLAY",a.Constants.stylePlayGreen,this.onPlay,this,a.Atlases.Interface),this.playBtn.setFrames("bg0000","bg0000","bg0000","bg0000"),this.playBtn.x=716),this.playBtn.y=450,this.background4.addChild(this.playBtn);t=this.game.add.image(0,0,a.Atlases.Interface,"bg0000");t.anchor.set(.5),t.x=-80,t.height=58,t.width=200,this.playBtn.btn.addChildAt(t,0),this.backBtn=new l.default(this.game,"BACK",a.Constants.styleBackArrow,this.onBack,this,a.Atlases.Interface),this.backBtn.setFrames("arrow0000","arrow0000","arrow0000","arrow0000"),this.backBtn.btn.x=-110,this.backBtn.x=150,this.backBtn.y=450,(t=this.game.add.image(0,0,a.Atlases.Interface,"bg0000")).anchor.set(.5),t.x=80,t.height=58,t.width=200,this.backBtn.btn.addChild(t),this.backgroundBase2.addChild(this.backBtn),this.backgroundBase2.addChild(this.playBtn),this.resize(),new p.default(this.game,this,this.show)},b.prototype.show=function(){var t=this.game.add.tween(this.logo);t.from({y:-60},v.default.PRELOADER_TIME,g.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.selectPlayer)).from({x:-520},v.default.PRELOADER_TIME,g.Easing.Back.Out),t.start(),this.selectPlayer2&&((t=this.game.add.tween(this.selectPlayer2)).from({x:1140},v.default.PRELOADER_TIME,g.Easing.Back.Out),t.start()),this.plateDifficulty&&((t=this.game.add.tween(this.plateDifficulty)).from({y:720},v.default.PRELOADER_TIME,g.Easing.Back.Out),t.start()),(t=this.game.add.tween(this.playBtn)).from({y:520},v.default.PRELOADER_TIME,g.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.backBtn)).from({y:520},v.default.PRELOADER_TIME,g.Easing.Back.Out),t.start(),this.matchModePanel&&((t=this.game.add.tween(this.matchModePanel)).from({y:720},v.default.PRELOADER_TIME,g.Easing.Back.Out),t.start())},b.prototype.hide=function(){var t=this.game.add.tween(this.logo);t.to({y:-60},v.default.PRELOADER_TIME,g.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.selectPlayer)).to({x:-520},v.default.PRELOADER_TIME,g.Easing.Linear.None),t.start(),this.selectPlayer2&&((t=this.game.add.tween(this.selectPlayer2)).to({x:1140},v.default.PRELOADER_TIME,g.Easing.Linear.None),t.start()),this.plateDifficulty&&((t=this.game.add.tween(this.plateDifficulty)).to({y:720},v.default.PRELOADER_TIME,g.Easing.Linear.None),t.start()),(t=this.game.add.tween(this.playBtn)).to({y:520},v.default.PRELOADER_TIME,g.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.backBtn)).to({y:520},v.default.PRELOADER_TIME,g.Easing.Linear.None),t.start(),this.matchModePanel&&((t=this.game.add.tween(this.matchModePanel)).to({y:720},v.default.PRELOADER_TIME,g.Easing.Linear.None),t.start())},b.prototype.render=function(){dragonBones.PhaserFactory.factory.dragonBones.advanceTime(-1),s.prototype.render.call(this)},b.prototype.createPanel=function(){this.matchModePanel=new m.MatchModePanel(this),this.matchModePanel.x=400,this.matchModePanel.y=207,this.backgroundBase2.addChild(this.matchModePanel),this.processMatchMode()},b.prototype.createDifficultySelect=function(){this.plateDifficulty=this.game.add.sprite(400,370,a.Atlases.Interface,"bg0000"),this.plateDifficulty.anchor.set(.5);var t=this.game.make.image(0,0,a.Atlases.Interface,"0bg130000");t.anchor.set(.5),t.scale.set(1,.42),this.plateDifficulty.addChild(t),(t=this.game.make.image(0,0,a.Atlases.Interface,"line0000")).anchor.set(.5),t.scale.set(1),this.plateDifficulty.addChild(t);var e=new c.default(this.game,0,-26,"NORMAL",a.Constants.styleDIfficulltyBg);e.anchor.set(.5),this.plateDifficulty.addChild(e);t=new c.default(this.game,0,26,"HARD",a.Constants.styleDIfficulltyBg2);t.anchor.set(.5),this.plateDifficulty.addChild(t),e.inputEnabled=!0,t.inputEnabled=!0,e.input.useHandCursor=!0,t.input.useHandCursor=!0;var i=new l.default(this.game,"NORMAL",a.Constants.styleNormalGreen,null,null,a.Atlases.Interface);i.setFrames("bg0000","bg0000","bg0000","bg0000");var n=new l.default(this.game,"HARD",a.Constants.styleHardGreen,null,null,a.Atlases.Interface);n.setFrames("bg0000","bg0000","bg0000","bg0000"),this.backgroundBase2.addChild(this.plateDifficulty),this.plateDifficulty.addChild(i),this.plateDifficulty.addChild(n),i.y=-27,n.y=25,n.visible=!1,u.Inventory.instance.tournament.difficulty=0,t.events.onInputDown.add(function(){n.visible=!0,i.visible=!1,u.Inventory.instance.tournament.difficulty=1}),e.events.onInputDown.add(function(){i.visible=!0,n.visible=!1,u.Inventory.instance.tournament.difficulty=0})},b.prototype.createP2Select=function(){this.selectPlayer2=new f.SelectPlayer(1),this.selectPlayer2.x=638,this.selectPlayer2.y=131,this.backgroundBase2.addChild(this.selectPlayer2)},b.prototype.processMatchMode=function(){var t,e;0===this.manager.matchData.matchMode&&(t=this.manager.matchData.players[0][0],e=this.manager.matchData.players[1][0],this.manager.matchData.players=[[t],[e]]),0!==this.manager.gameMode?2===this.manager.matchData.matchMode?(this.selectPlayer.setUp(1),this.selectPlayer2.setUp(2)):(this.selectPlayer.setUp(),this.selectPlayer2.setUp(4===this.manager.gameMode?0:2)):this.selectPlayer.setUp(0)},b.prototype.toggleMusic=function(){d.default.getInstance().music?o.default.getInstance().toggleMusic():d.default.getInstance().sfx?o.default.getInstance().toggleSfx():(o.default.getInstance().toggleSfx(),o.default.getInstance().toggleMusic()),this.updateSoundButtons(),o.default.getInstance().play(a.Sounds.Click)},b.prototype.updateSoundButtons=function(){var t=d.default.getInstance().music?0:1;t+=d.default.getInstance().sfx?0:1,this.musicBtn.labelState.loadTexture(a.Atlases.Gameplay,"InGameMusicButton000"+t)},b.prototype.onBack=function(){o.default.getInstance().play(a.Sounds.Click),0===u.Inventory.instance.gameMode?new h.default(this.game,this,y.default.Name):new h.default(this.game,this,x.Menu.Name)},b.prototype.onPlay=function(){o.default.getInstance().play(a.Sounds.Click),new h.default(this.game,this,_.default.Name)},b.prototype.onTournament=function(){o.default.getInstance().play(a.Sounds.Click),this.manager.createNewTournament(),new h.default(this.game,this,x.TournamentState.Name)},b.prototype.resize=function(){var t=1;t=1<(t=this.game.width/a.Constants.WIDTH)?1:t,t*=1.33333,this.backgroundBase.scale.set(t),this.backgroundBase.alignIn(this.world.bounds,Phaser.TOP_CENTER),this.backgroundBaseMask.scale.set(t,t),this.backgroundBaseMask.x=this.backgroundBase.x,this.backgroundBaseMask.y=this.backgroundBase.y,this.background5.scale.set(.65*t),this.background5.alignIn(this.backgroundBase2,Phaser.RIGHT_CENTER,-20,0),s.prototype.resize.call(this)},b.prototype.shutdown=function(){this.backBtn=null,this.playBtn=null,this.musicBtn=null,s.prototype.shutdown.call(this)},b.Name="randomstate",b.dragonbonesParsed=!1,b);function b(){var t=s.call(this)||this;return t.name=b.Name,t.manager=null,t}e.default=r},function(t,e){var i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";e.__esModule=!0;var n=(r.prototype.add=function(t){},r.prototype.release=function(){},r.prototype.update=function(t){},r.prototype.updateGraphics=function(){},r.prototype.start=function(){},r);function r(){}e.GamePhysics=n},function(t,e,i){"use strict";e.__esModule=!0;var r=i(4),n=i(41),s=i(3),o=i(12),a=i(1),i=(l.initDragonbones=function(t){void 0===t&&(t=!1);var e,i,n,t=s.default.game;l.coreDBInited||(dragonBones.PhaserFactory.init(t),l.coreDBInited=!0),l.uiDBInited||(e=t.cache.getJSON(a.JSONData.DBPers),i=t.cache.getJSON(a.JSONData.DBPers_Texture),n=t.cache.getImage(a.Images.DBPers,!0).base,dragonBones.PhaserFactory.factory.parseDragonBonesData(e),dragonBones.PhaserFactory.factory.parseTextureAtlasData(i,n),l.uiDBInited=!0),l.gameplayDBInited||(e=t.cache.getJSON(a.JSONData.DBPers2),i=t.cache.getJSON(a.JSONData.DBPers_Texture2),n=t.cache.getImage(a.Images.DBPers2,!0).base,dragonBones.PhaserFactory.factory.parseDragonBonesData(e),dragonBones.PhaserFactory.factory.parseTextureAtlasData(i,n),l.gameplayDBInited=!0)},l.setupPlayers=function(){n.AISkillsData.create();for(var t=0;t<l.PLAYERS_COUNT;t++)l.legs[t]="leg"+(1+(15*Math.random()>>0)).toString()},l.switchPlayer=function(t,e,i){void 0===i&&(i=1);var n=e;t.getBone("head").slot.childArmature.animation.gotoAndPlay("head"+(e+1).toString()),t.getBone("body").slot.childArmature.animation.gotoAndPlay("body"+(i+1).toString()),t.getBone("left hand").slot.childArmature.animation.gotoAndPlay("hand"+l.hands[n]),t.getBone("right hand").slot.childArmature.animation.gotoAndPlay("hand"+l.hands[n]);e=l.legs[e];t.getBone("left leg").slot.childArmature.animation.gotoAndPlay(e),t.getBone("right leg").slot.childArmature.animation.gotoAndPlay(e),s.default.game.state.current===o.Gameplay.Name&&(t.getBone("dighand").slot.childArmature.animation.gotoAndPlay("hand"+l.hands[n]),t.getBone("digleg").slot.childArmature.animation.gotoAndPlay(e)),t.animation.gotoAndPlay("idle"),t.advanceTime(r.default.STEP)},l.setPoint=function(t,e){l.POINTS[t]=e},l.getPoint=function(t){return l.POINTS[t]},l.TEAM_SIZE=3,l.PLAYERS_COUNT=60,l.TEAMS_COUNT=20,l.POINTS=[0,0,0,0,0,0],l.legs=[],l.hands=[2,2,3,2,3,1,2,2,3,2,2,1,1,2,2,1,2,2,1,1,3,1,1,1,3,3,2,1,2,1,1,1,2,1,1,3,3,2,2,1,3,2,1,3,1,2,2,1,3,2,2,1,3,1,2,2,2,1,1,1],l.coreDBInited=!1,l.uiDBInited=!1,l.gameplayDBInited=!1,l);function l(){}e.PlayersData=i},function(t,e,i){"use strict";e.__esModule=!0;var n=nape.geom.Vec2,i=i(4),i=(r.GRAVITY=new n(0,450),r.BALL_RADIUS=18,r.BALL_GRAVMASS=2,r.BALL_BOUNCE=-400,r.BALL_UP_VELOCITY_Y=-500,r.BALL_STEAL_VELOCITY_X_BASE=400,r.BALL_STEAL_VELOCITY_X_ADD=200,r.BALL_STEAL_VELOCITY_Y=-100,r.BALL_INDENT_Y_CENTER=300,r.BALL_INDENT_Y_PLAYER=340,r.VERTICAL_DISPERSION=.1,r.DISPERSION=.01,r.BASKET_CENTER=(r.BASKET_INDENT=25)+(r.BASKET_RADIUS=30),r.BASKET_CENTER2=i.default.WIDTH-r.BASKET_CENTER,r.BASKET_HEIGHT=200,r.BASKET_PART_RADIUS=7,r.GLASS_WIDTH=12,r.GLASS_Y=20-(r.GLASS_HEIGHT=120),r.SENSOR_WIDTH=2*(r.SENSOR_HALF=25),r.SENSOR_HEIGHT=5,r.SENSOR_UP=-10,r.SENSOR_DOWN=15,r.PLAYER_JUMP=-600,r.PLAYER_MOVE_WITH_BALL=.85*(r.PLAYER_MOVE=250),r.PLAYER_INDENT_X=30,r.PLAYER_INDENT_Y=385,r.STEAL_DISTANCE=55,r.INDENT_GENERAL_X=50,r.PAINT_START_X=100,r.PAINT_MIDDLE_X=200,r.DUNK_ZONE1_Y=280,r.DUNK_ZONE2_Y=300,r.DUNK_X=100,r.DUNK_Y=180,r.ALLEY_OOP_X=160,r.ALLEY_OOP_Y=150,r.SUPER_DASH_X1=150,r.SUPER_DASH_X2=650,r.SUPER_DASH_Y=385,r.OPPONENT_DELTA=60,r.IDEAL_JUMP_BALL_JUMP=.5,r.IDEAL_ATTACK_JUMP=.41,r.CHANCE_FOR_THREE=.2,r.CHANCE_FOR_THREE2=.4,r.ATTACK_ZONE_START=120,r.ATTACK_ZONE_END=350,r.DASH_ZONE_START=300,r.DASH_ZONE_END=700,r.DEFENSE_POINT=250,r.STEAL_DURATION=.3,r.THREE_POINTS_DISTANCE=500,r.DASH_DELAY=1,r.DIG_TIME=3,r.ENERGY_TIME=3,r);function r(){}e.ObjectsData=i},function(t,e,i){"use strict";e.__esModule=!0;var n=i(1),r=i(7),s=i(14),o=i(5),a=i(11),l=i(4),p=i(2),i=(h.prototype.release=function(){l.default.isDesktop||s.default.instance.container&&s.default.instance.container.destroy(),this.game=null,this.helpBtn=null,this.pauseBtn=null,this.musicBtn=null,this.signalToggleMusic.removeAll(),this.signalRestart.removeAll(),this.signalPause.removeAll(),this.signalToggleMusic=null,this.signalRestart=null,this.signalPause=null,this.container.destroy(),this.container=null},h.prototype.init=function(t,e){this.container=t,this.game=e,this.scl=Math.max(this.game.width,this.game.height)/n.Constants.WIDTH,this.scl=1<this.scl?1:this.scl,this.signalRestart=new Phaser.Signal,this.signalPause=new Phaser.Signal,this.signalToggleMusic=new Phaser.Signal,this.helpBtn=new r.default(this.game,"",{},this.onHelp,this,n.Atlases.Gameplay),this.helpBtn.setFrames("btn_bg0000","btn_bg0000","btn_bg0000","btn_bg0000"),this.helpBtn.sScale=42/this.helpBtn.btn.width*1.33333,this.helpBtn.x=l.default.GAME_W-Math.round(162.66626),this.helpBtn.y=Math.round(33.33325),this.helpBtn.labelState=this.game.add.image(0,0,n.Atlases.Gameplay,"InGameHelpButton0000"),this.pauseBtn=new r.default(this.game,"",{},this.onPause,this,n.Atlases.Gameplay),this.pauseBtn.setFrames("btn_bg0000","btn_bg0000","btn_bg0000","btn_bg0000"),this.pauseBtn.sScale=42/this.pauseBtn.btn.width*1.33333,this.pauseBtn.x=l.default.GAME_W-Math.round(75*1.33333),this.pauseBtn.y=this.helpBtn.y,this.pauseBtn.labelState=this.game.add.image(0,0,n.Atlases.Gameplay,"InGamePauseButton0000"),this.musicBtn=new r.default(this.game,"",{},this.toggleMusic,this,n.Atlases.Gameplay),this.musicBtn.setFrames("btn_bg0000","btn_bg0000","btn_bg0000","btn_bg0000"),this.musicBtn.sScale=42/this.musicBtn.btn.width*1.33333,this.musicBtn.x=l.default.GAME_W-Math.round(28*1.33333),this.musicBtn.y=this.helpBtn.y,this.musicBtn.labelState=this.game.add.image(0,0,n.Atlases.Gameplay,"InGameMusicButton0000"),this.updateSoundButtons(),l.default.isDesktop?this.container.addChild(this.helpBtn):this.helpBtn.destroy(),this.container.addChild(this.pauseBtn),this.container.addChild(this.musicBtn),l.default.isDesktop||s.default.instance.container.parent.addChild(s.default.instance.container)},h.prototype.toggleMusic=function(){a.default.getInstance().music?o.default.getInstance().toggleMusic():a.default.getInstance().sfx?o.default.getInstance().toggleSfx():(o.default.getInstance().toggleSfx(),o.default.getInstance().toggleMusic()),this.updateSoundButtons(),o.default.getInstance().play(n.Sounds.Click)},h.prototype.updateSoundButtons=function(){var t=a.default.getInstance().music?0:1;t+=a.default.getInstance().sfx?0:1,this.musicBtn.labelState.loadTexture(n.Atlases.Gameplay,"InGameMusicButton000"+t)},h.prototype.resize=function(t){this.game.width/this.game.height<l.default.GAME_W/l.default.GAME_H?(this.container.scale.set(t),this.container.x=0):(this.container.scale.set(t),this.container.x=this.game.width/2-l.default.DISPLAY_W2),l.default.isDesktop||s.default.instance.resize(t)},h.prototype.onPause=function(){this.signalPause.dispatch(p.MainGameCore.PAUSE)},h.prototype.onHelp=function(){this.signalPause.dispatch(p.MainGameCore.HELP)},Object.defineProperty(h,"instance",{get:function(){return h._instance||(h._instance=new h),h._instance},enumerable:!0,configurable:!0}),h);function h(){this.signalRestart=null,this.signalPause=null,this.signalToggleMusic=null,this.game=null,this.scl=1,this.container=null}e.default=i},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0,i(6),i(0);var s,h=i(1),u=i(36),c=i(7),o=i(5),a=i(8),l=i(31),p=i(45),d=i(13),_=i(33),y=i(4),f=i(10),m=i(2),x=i(52),v=i(21),g=i(18),r=(s=Phaser.State,r(b,s),b.prototype.onBuild=function(){d.MainGameCore.instance.start(),d.MainGameCore.instance.slowSignal.removeAll(),d.MainGameCore.instance.menuPauseSignal.removeAll(),d.MainGameCore.instance.menuPauseSignal.add(this.onCallPopup,this),d.MainGameCore.instance.slowSignal.add(d.MainGameCore.instance.slow,d.MainGameCore.instance)},b.prototype.init=function(){var t,e=this;s.prototype.init.call(this),this.game.world.removeAll(),b.loadedLevel=!1,m.PlayersData.initDragonbones(),this._armatureDisplay=dragonBones.PhaserFactory.factory.buildArmatureDisplay("playerSmall"),this._armatureDisplay.animation.play("idle",0),this._armatureDisplay2=dragonBones.PhaserFactory.factory.buildArmatureDisplay("playerSmall"),this._armatureDisplay2.animation.play("idle",0),this._armatureDisplay3=dragonBones.PhaserFactory.factory.buildArmatureDisplay("playerSmall"),this._armatureDisplay3.animation.play("idle",0),this._armatureDisplay4=dragonBones.PhaserFactory.factory.buildArmatureDisplay("playerSmall"),this._armatureDisplay4.animation.play("idle",0),this._armatureDisplayArr=[];for(var i=0;i<5;i++)(t=dragonBones.PhaserFactory.factory.buildArmatureDisplay("playerH"+i)).animation.play("anim",0),t.visible=!1,this._armatureDisplayArr.push(t);this.initData(),this.game.time.advancedTiming=!0,this.game.time.desiredFps=40,d.MainGameCore.instance.init(this.game),l.default.instance.init(this.game.add.group(),this.game),(new p.GameBuilder).start(this.onBuild,this,[this._armatureDisplay,this._armatureDisplay3,this._armatureDisplay2,this._armatureDisplay4]);var n=1;n=1<(n=this.game.width/h.Constants.WIDTH)?1:n,this.backgroudBase=this.game.add.sprite(0,0,u.default.Interface,a.default.getBG()),this.backgroudBase.scale.set(1.33333*n),this.backgroudBase.x=this.game.width/2-this.backgroudBase.width/2,this.transition=this.game.add.tween(this.backgroudBase),this.transition.to({alpha:0},1,Phaser.Easing.Linear.None,!1,500),this.transition.onComplete.add(function(){b.loadedLevel=!0,e.backgroudBase.destroy(),e.backgroudBase=null,e.transition=null,y.default.isDesktop&&(e.game.input.keyboard.addKey(Phaser.Keyboard.P).onUp.add(e.onP,e),e.game.input.keyboard.addKey(Phaser.Keyboard.ONE).onUp.add(e.onOne,e),e.game.input.keyboard.addKey(Phaser.Keyboard.TWO).onUp.add(e.onTwo,e),e.game.input.keyboard.addKey(Phaser.Keyboard.THREE).onUp.add(e.onThree,e)),l.default.instance.signalPause.add(e.onPause,e)}),this.transition.start(),o.default.getInstance().playMusic(h.Sounds.GameMusic)},b.prototype.onOne=function(){d.MainGameCore.instance.messageInfo.show2(0)},b.prototype.onTwo=function(){d.MainGameCore.instance.messageInfo.show2(1)},b.prototype.onThree=function(){d.MainGameCore.instance.messageInfo.show2(2)},b.prototype.create=function(){s.prototype.create.call(this),this.resize()},b.prototype.onP=function(){d.MainGameCore.instance.isPaused?this.onResume():this.onPause()},b.prototype.onPause=function(t){void 0===t&&(t=""),d.MainGameCore.instance.isPaused||d.MainGameCore.instance.menuPauseSignal.dispatch(0===t.length?d.MainGameCore.PAUSE:t)},b.prototype.onCallPopup=function(t){this.closePopup();var e="GAME PAUSED";if(t!==d.MainGameCore.PAUSE)return t===d.MainGameCore.HELP?void this.createHelpPopup():void this.onPostMatch();this.createPopup();var i=new f.default(this.game,e,h.Constants.stylePause,null,this,u.default.Interface);i.y=-210,i.setFrames("bg0000","bg0000","bg0000","bg0000"),i.btn.label.setMaxSize(600,90),i.label.setMaxSize(600,90),i.setText(e),this.popup.getChildAt(1).addChild(i);var n=new f.default(this.game,"MENU",h.Constants.stylePauseBtn1,this.confirmExit,this,u.default.Interface);n.x=-150,n.y=200,n.setFrames("bg0000","bg0000","bg0000","bg0000"),this.popup.getChildAt(1).addChild(n);t=new f.default(this.game,"RESUME",h.Constants.stylePauseBtn2,this.onResume,this,u.default.Interface);t.x=150,t.y=200,t.setFrames("bg0000","bg0000","bg0000","bg0000"),this.popup.getChildAt(1).addChild(t);e=new f.default(this.game,m.Inventory.instance.matchData.matchScore[0]+" : "+m.Inventory.instance.matchData.matchScore[1],h.Constants.styleEndMatchScore,null,null,u.default.Interface);e.setFrames("bg0000","bg0000","bg0000","bg0000"),e.y=-90,this.popup.getChildAt(1).addChild(e);i=m.Inventory.instance.matchData.teams[0]-1,n=m.Inventory.instance.matchData.teams[1]-1,t=this.game.add.image(-270,-90,u.default.Interface,"EmblemsBg0000");t.anchor.set(.5),t.scale.set(1.18),this.popup.getChildAt(1).addChild(t);e=this.game.add.image(270,-90,u.default.Interface,"EmblemsBg0000");e.anchor.set(.5),e.scale.set(1.18),this.popup.getChildAt(1).addChild(e),(t=this.game.add.image(-270,-90,u.default.Interface,"emptyBg0000")).scale.set(.8),this.popup.getChildAt(1).addChild(t),(e=this.game.add.image(270,-90,u.default.Interface,"emptyBg0000")).scale.set(.8),this.popup.getChildAt(1).addChild(e),t.loadTexture(u.default.Interface,"Emblems00"+(i<10?"0":"")+i),e.loadTexture(u.default.Interface,"Emblems00"+(n<10?"0":"")+n),t.anchor.set(.5),e.anchor.set(.5);e=1;e=1<(e=this.game.width/h.Constants.WIDTH)?1:e,this.resizePopup(e)},b.prototype.buildText=function(t,e,i,n){void 0===i&&(i=30),void 0===n&&(n=h.Constants.stylePopupContentSmall);for(var r,s=0;s<t.length;s++)(r=new c.default(this.game,t[s],n,null,null,u.default.Interface)).y=s*i+8,r.setFrames("bg0000","bg0000","bg0000","bg0000"),r.btn.inputEnabled=!1,0===s&&r.label.addColor("#66CCFF",11),1===s&&(r.label.addColor("#66CCFF",0),r.label.addColor("#ffffff",5)),2===s&&r.label.addColor("#66CCFF",10),e.label.parent.addChild(r)},b.prototype.buildText2=function(t,e,i,n){void 0===i&&(i=30),void 0===n&&(n=h.Constants.stylePopupContent);for(var r,s=0;s<t.length;s++)(r=new c.default(this.game,t[s],n,null,null,u.default.Interface)).y=s*i-30,r.setFrames("bg0000","bg0000","bg0000","bg0000"),r.btn.inputEnabled=!1,e.label.parent.addChild(r)},b.prototype.onForum=function(){m.Inventory.instance.checkForumAchievement(),window.open("https://forum.y8.com/t/basketball-legends/1741","_blank")},b.prototype.onMoreGames=function(){window.open(v.default.getInstance().getUrl(v.default.Current),"_blank")},b.prototype.onScoreList=function(){},b.prototype.disposePopup=function(){this.popup&&this.popup.destroy(!0),this.popup=null,d.MainGameCore.instance.countDown.activate()},b.prototype.backgroundPopup=function(){this.popup=this.game.add.sprite(350,250,u.default.Interface,"bg0000"),this.popup.anchor.set(.5),this.popup.scale.set(1.33333);var t=this.game.add.sprite(0,0,u.default.Interface,"bg0000");t.width=this.game.width,t.height=this.game.height,t.inputEnabled=!0,t.anchor.set(.5),this.popup.addChild(t),this.world.addChild(l.default.instance.container)},b.prototype.createPopup=function(){null!==this.popup&&this.disposePopup(),this.backgroundPopup();var t=this.game.add.sprite(0,0,u.default.Interface,a.default.BASE_BG[a.default.INDEX_BG]+"0000");t.anchor.set(.5),this.popup.addChild(t),d.MainGameCore.instance.isPlaying=!1,d.MainGameCore.instance.isPaused=!0,l.default.instance.pauseBtn.visible=!1,l.default.instance.helpBtn&&(l.default.instance.helpBtn.visible=!1)},b.prototype.createHelpPopup=function(){null!==this.popup&&this.disposePopup(),this.backgroundPopup();var t=this.game.add.sprite(0,0,u.default.Interface,"0bg100000");t.anchor.set(.5),t.scale.set(2.2,1.2),this.popup.addChild(t),d.MainGameCore.instance.isPlaying=!1,d.MainGameCore.instance.isPaused=!0,l.default.instance.pauseBtn.visible=!1,l.default.instance.helpBtn&&(l.default.instance.helpBtn.visible=!1);var e=this.game.cache.getJSON(h.JSONData.Players),t=this.parseStaticGraphic(e,2);this.popup.addChild(t),t=4===m.Inventory.instance.gameMode?this.parseStaticGraphic(e,1):this.parseStaticGraphic(e,0),this.popup.addChild(t);t=new f.default(this.game,"OK",h.Constants.styleOKGreen,this.closePopup,this,u.default.Interface);t.setFrames("bg0000","bg0000","bg0000","bg0000"),t.y=215,this.popup.addChild(t),(t=new f.default(this.game,"HOW TO PLAY",h.Constants.styleHelpTitle,null,null,u.default.Interface)).setFrames("bg0000","bg0000","bg0000","bg0000"),t.y=-210,this.popup.addChild(t),this.resizePopup(1)},b.prototype.parseStaticGraphic=function(t,e){for(var i,n,r,s=this.game.make.group(this.popup),o=null,a=0,l=t["control"+e],p=0;p<40;p++)l.hasOwnProperty(p)&&((a=0)===l[p].g.indexOf("arm_")?((o=this.game.make.image(0,0,u.default.Interface,"loginSelect0000")).anchor.set(.5,.95),o.x=l[p].x,o.y=l[p].y+-10,s.addChild(o),n=parseInt(l[p].g.split("arm_")[1]),(r=this._armatureDisplayArr[n]).x=l[p].x+a,r.y=l[p].y+-10,r.scale.set(.5),r.visible=!0,s.addChild(r),r.animation.play("anim",0)):0===l[p].g.indexOf("txt_")?(i=l[p].g.split("txt_")[1],n=h.Constants.styleHelpLetter,r=" ",3<i.length?n=h.Constants.styleHelpTxt0:("X"===(i=i.charAt(0))&&(a=2),"W"===i&&(a=1)),(0<l[p].g.indexOf("Attack")||0<l[p].g.indexOf("Defense"))&&(n=h.Constants.styleHelpTxt1),(0<l[p].g.indexOf("action")||0<l[p].g.indexOf("super"))&&(n=h.Constants.styleHelpTxt0,r=" - "),(o=new c.default(this.game,r+i,n,null,null,u.default.Gameplay)).setFrames("bg0000","bg0000","bg0000","bg0000"),3<i.length&&(o.label.stroke="#0033FF",o.label.strokeThickness=1),o.label.anchor.set(0),o.x=l[p].x+a,o.y=l[p].y+-10,s.addChild(o)):((o=this.game.make.image(l[p].x,l[p].y,u.default.Interface,l[p].g+"0000")).anchor.set(.5),o.x=l[p].x,o.y=l[p].y+-10,o.angle=l[p].r,o.scale.set(l[p].scaleX,l[p].scaleY),0<l[p].g.indexOf("plate")?s.addChildAt(o,0):s.addChild(o)));return s},b.prototype.resizePopup=function(t){var e;null!==this.popup&&((e=this.popup.removeChildAt(0)).width=this.game.width,e.height=this.game.height,this.popup.x=this.world.bounds.centerX,this.popup.y=240*t*1.33333,this.popup.addChildAt(e,0),this.popup.scale.set(1.33333*t))},b.prototype.closePopup=function(){if(this._armatureDisplayArr[0].visible)for(var t=0;t<this._armatureDisplayArr.length;t++){var e=this._armatureDisplayArr[t];e.parent.removeChild(e),e.visible=!1}d.MainGameCore.instance.isPaused=!1,l.default.instance.pauseBtn.visible=!0,l.default.instance.helpBtn&&(l.default.instance.helpBtn.visible=!0),l.default.instance.pauseBtn.onOut(),this.disposePopup()},b.prototype.onResume=function(){this.closePopup()},b.prototype.onPostMatch=function(){new a.default(this.game,0,x.default.Name)},b.prototype.confirmExit=function(){var t=new c.default(this.game,"",null,null,null,u.default.Interface);t.setFrames("0bg100000","0bg100000","0bg100000","0bg100000"),t.btn.scale.set(1.3,1);var e=this.game.add.sprite(0,0,u.default.Interface,"black0000");e.width=this.game.width+500,e.height=this.game.height+500,e.inputEnabled=!0,e.anchor.set(.5),e.alpha=.5,t.btn.parent.addChildAt(e,0);e=new f.default(this.game,"WARNING!!",h.Constants.styleWarningLeave,null,this,u.default.Interface);e.setFrames("bg0000","bg0000","bg0000","bg0000"),e.y=-95,t.addChild(e);e=this.game.add.image(0,-55,u.default.Interface,"line0000");e.anchor.set(.5),t.label.parent.addChild(e),(e=this.game.add.image(0,55,u.default.Interface,"line0000")).anchor.set(.5),t.label.parent.addChild(e),this.popup.getChildAt(1).addChild(t);this.buildText2(["IF YOU CONTINUE,","YOU WIL LOST","YOUR PROGRESS"],t,30);e=new f.default(this.game,"OK",h.Constants.stylePopupPlay,this.onMenu,this,u.default.Interface);e.setFrames("bg0000","bg0000","bg0000","bg0000"),e.x=-110,e.y=90,t.label.parent.addChild(e),(e=new f.default(this.game,"CANCEL",h.Constants.stylePopupCancel,function(){t.destroy()},this,u.default.Interface)).setFrames("bg0000","bg0000","bg0000","bg0000"),e.x=60,e.y=90,t.label.parent.addChild(e)},b.prototype.onMenu=function(){this.closePopup(),!m.Inventory.instance.checkQuickMatch()&&0===m.Inventory.instance.gameMode?new a.default(this.game,0,g.default.Name):new a.default(this.game,0,_.default.Name)},b.prototype.update=function(){if(!b.isAdsPause&&(s.prototype.update.call(this),b.loadedLevel)){if(this.isFirstUpdate)return this.isFirstUpdate=!1,this.timeAcc=0,void(this.prevTimeMS=Date.now());for(this.currTimeMS=Date.now(),this.deltaTime=(this.currTimeMS-this.prevTimeMS)/1e3,this.deltaTime>b.MAX_FRAME_TIME&&(this.deltaTime=b.MAX_FRAME_TIME),this.prevTimeMS=this.currTimeMS,this.timeAcc+=this.deltaTime;this.timeAcc>=b.DESIRED_FRAME_TIME;)this.updateGameController(b.DESIRED_FRAME_TIME),this.timeAcc-=b.DESIRED_FRAME_TIME;d.MainGameCore.instance.isPaused||d.MainGameCore.instance.physics.updateGraphics()}},b.prototype.resize=function(){s.prototype.resize.call(this);var t=1;t=1<(t=this.game.width/h.Constants.WIDTH)?1:t,d.MainGameCore.instance.view.resize(),d.MainGameCore.instance.view.scale.set(1.3333333*t),d.MainGameCore.instance.view.alignIn(this.world.bounds,Phaser.TOP_CENTER),l.default.instance.resize(t),this.resizePopup(t)},b.prototype.shutdown=function(){this.closePopup(),this._armatureDisplay=null,this._armatureDisplay2=null,this._armatureDisplay3=null,this._armatureDisplay4=null,d.MainGameCore.instance.release(),l.default.instance.release(),s.prototype.shutdown.call(this)},b.prototype.render=function(){1!==d.MainGameCore.instance.timeScale?0===d.MainGameCore.instance.timeScale?dragonBones.PhaserFactory.factory.dragonBones.advanceTime(.3*y.default.STEP):dragonBones.PhaserFactory.factory.dragonBones.advanceTime(y.default.STEP*d.MainGameCore.instance.timeScale):dragonBones.PhaserFactory.factory.dragonBones.advanceTime(-1),s.prototype.render.call(this)},b.prototype.initData=function(){this.isFirstUpdate=!0},b.prototype.updateGameController=function(t){d.MainGameCore.instance.update(t)},b.Name="gameplay",b.pause=!1,b.MAX_FRAME_TIME=.1,b.DESIRED_FRAME_TIME=.025,b.isAdsPause=!1,b.loadedLevel=!1,b);function b(){var t=s.call(this)||this;return t.name=b.Name,t.popup=null,t.backgroudBase=null,t.transition=null,t._armatureDisplay=null,t._armatureDisplay2=null,t._armatureDisplay3=null,t._armatureDisplay4=null,t}e.default=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0,i(6),i(0);var s,o=i(5),a=i(1),l=i(7),p=i(17),h=i(8),u=i(4),c=i(2),d=i(9),_=i(11),y=i(10),f=i(32),m=i(18),x=i(0),v=i(26),g=i(34),r=(s=Phaser.State,r(b,s),b.prototype.init=function(){this.game.world.removeAll(),g.default.getInstance().init(this.game)},b.prototype.create=function(){s.prototype.create.call(this),c.PlayersData.setupPlayers(),this.backgroundBase=this.game.add.sprite(0,0,a.Atlases.Interface,h.default.getBG()),this.backgroundBase2=this.game.add.sprite(299,0,a.Atlases.Interface,"bg0000"),this.backgroundBase.addChild(this.backgroundBase2),this.backgroundBaseMask=this.game.add.graphics(0,0),this.backgroundBaseMask.beginFill(65280,0),this.backgroundBaseMask.drawRect(0,0,1398,480),this.backgroundBaseMask.endFill(),this.background4=this.game.add.sprite(400,290,a.Atlases.Interface,"bg0000");var t=null;(t=this.game.add.sprite(-185,66,a.Atlases.Interface,"body00000")).anchor.set(.5),this.background4.addChild(t),(t=this.game.add.sprite(230,55,a.Atlases.Interface,"body10000")).anchor.set(.5),this.background4.addChild(t),(t=this.game.add.sprite(10,5,a.Atlases.Interface,"0bg100000")).anchor.set(.5),t.scale.set(1,.8),this.background4.addChild(t),(t=this.game.add.sprite(-213,-50,a.Atlases.Interface,"head00000")).anchor.set(.5),t.scale.set(.95),this.background4.addChild(t),(t=this.game.add.sprite(215,-55,a.Atlases.Interface,"head10000")).anchor.set(.5),t.scale.set(-.95,.95),this.background4.addChild(t),this.background4.anchor.set(.5),this.playBtn1=new l.default(this.game,"1 PLAYER",a.Constants.stylePlay,this.start1Player,this,a.Atlases.Interface),this.playBtn1.setFrames("bg0000","bg0000","bg0000","bg0000"),this.playBtn1.y=-110,this.background4.addChild(this.playBtn1),this.playBtn2=new l.default(this.game,"2 PLAYERS",a.Constants.stylePlay,this.start2Player,this,a.Atlases.Interface),this.playBtn2.y=-50,this.playBtn2.setFrames("bg0000","bg0000","bg0000","bg0000"),this.background4.addChild(this.playBtn2),this.playBtn4=new l.default(this.game,"CREDITS",a.Constants.stylePlay,this.onCredits,this,a.Atlases.Interface),this.playBtn4.y=115,this.playBtn4.setFrames("bg0000","bg0000","bg0000","bg0000"),this.background4.addChild(this.playBtn4),this.playBtn3=new l.default(this.game,"QUICK",a.Constants.stylePlay2,this.startQuickMath,this,a.Atlases.Interface),this.playBtn3.y=60,this.playBtn3.label.parent.y=-50,this.playBtn3.setFrames("bg0000","bg0000","bg0000","bg0000"),this.background4.addChild(this.playBtn3);t=new l.default(this.game,"MATCH",a.Constants.stylePlay2,null,null,a.Atlases.Interface);t.label.parent.y=40,t.setFrames("bg0000","bg0000","bg0000","bg0000"),t.inputEnableChildren=!0,this.playBtn3.label.addChild(t),u.default.isDesktop||(this.playBtn2.visible=!1,this.playBtn1.y+=35,this.playBtn4.y+=-35,this.playBtn3.y+=-35),this.leaderBoardBtn=new l.default(this.game,"",null,this.onScoreList,this,a.Atlases.Interface),this.leaderBoardBtn.setFrames("btn_bg0000","btn_bg0000","btn_bg0000","btn_bg0000"),this.leaderBoardBtn.sScale=.7,this.leaderBoardBtn.sLabelScale=.7;t=this.game.add.image(0,0,a.Atlases.Interface,"lead_icon0000");t.anchor.set(.5),this.leaderBoardBtn.label.parent.addChild(t),this.logo=this.game.add.sprite(400,72,a.Images.GameLogo),this.logo.anchor.set(.5),this.backgroundBase2.addChild(this.logo),this.musicBtn=new l.default(this.game,"",{},this.toggleMusic,this,a.Atlases.Gameplay),this.musicBtn.setFrames("btn_bg0000","btn_bg0000","btn_bg0000","btn_bg0000"),this.musicBtn.sScale=42/this.musicBtn.btn.width,this.musicBtn.x=772,this.musicBtn.y=25,this.musicBtn.labelState=this.game.add.image(0,0,a.Atlases.Gameplay,"InGameMusicButton0000"),this.backgroundBase2.addChild(this.musicBtn),this.textVersion=new d.default(this.game,0,465," "+a.Constants.VERSION,a.Constants.styleVersion),this.backgroundBase2.addChild(this.textVersion),this.updateSoundButtons(),this.backgroundBase2.addChild(this.leaderBoardBtn),this.leaderBoardBtn.x=730,this.leaderBoardBtn.y=150,this.backgroundBase2.addChild(this.background4),this.leaderBoardBtn.visible=!1,this.resize(),new p.default(this.game,this,this.show)},b.prototype.show=function(){var t=this.game.add.tween(this.background4);t.from({y:800},u.default.PRELOADER_TIME,x.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.logo)).from({y:-145},u.default.PRELOADER_TIME,x.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.leaderBoardBtn)).from({x:1600},u.default.PRELOADER_TIME,x.Easing.Back.Out),t.start()},b.prototype.hide=function(){var t=this.game.add.tween(this.background4);t.to({y:800},u.default.PRELOADER_TIME),t.start(),(t=this.game.add.tween(this.logo)).to({y:-145},u.default.PRELOADER_TIME),t.start(),(t=this.game.add.tween(this.leaderBoardBtn)).to({x:1600},u.default.PRELOADER_TIME,x.Easing.Linear.None),t.start()},b.prototype.start1Player=function(){o.default.getInstance().play(a.Sounds.Click),c.Inventory.instance.matchData.resetScore(),c.Inventory.instance.gameMode=0,c.Inventory.instance.matchData.matchMode=0,g.default.getInstance().displayInterstitial(this.fadeToMenu2,this)},b.prototype.fadeToMenu2=function(){new h.default(this.game,this,m.default.Name)},b.prototype.start2Player=function(){o.default.getInstance().play(a.Sounds.Click),c.Inventory.instance.matchData.resetScore(),c.Inventory.instance.gameMode=4,c.Inventory.instance.matchData.matchMode=0,g.default.getInstance().displayInterstitial(this.fadeToRandom,this)},b.prototype.fadeToRandom=function(){new h.default(this.game,this,v.default.Name)},b.prototype.startQuickMath=function(){o.default.getInstance().play(a.Sounds.Click),c.Inventory.instance.gameMode=2,c.Inventory.instance.matchData.matchMode=0,g.default.getInstance().displayInterstitial(this.fadeToGameplay,this)},b.prototype.fadeToGameplay=function(){new h.default(this.game,this,f.default.Name)},b.prototype.onScoreList=function(){o.default.getInstance().play(a.Sounds.Click)},b.prototype.toggleMusic=function(){_.default.getInstance().music?o.default.getInstance().toggleMusic():_.default.getInstance().sfx?o.default.getInstance().toggleSfx():(o.default.getInstance().toggleSfx(),o.default.getInstance().toggleMusic()),this.updateSoundButtons(),o.default.getInstance().play(a.Sounds.Click)},b.prototype.updateSoundButtons=function(){var t=_.default.getInstance().music?0:1;t+=_.default.getInstance().sfx?0:1,this.musicBtn.labelState.loadTexture(a.Atlases.Gameplay,"InGameMusicButton000"+t)},b.prototype.onCredits=function(){this.createPopup();var t=new y.default(this.game,"CREDITS",a.Constants.styleCredits3,null,null,a.Atlases.Interface);t.setFrames("bg0000","bg0000","bg0000","bg0000"),t.y=-192,this.popup.getChildAt(1).addChild(t);for(var e,i=[" "," "," "," "," ","CEO: Konstantin Matrunchik","Coding: Yuriy Borozenets,","Dmytro Borozenets","Art: Andrey Zdyshchuk","Roman Padaliuk","Game Design: Vasiliy Kachor","Ported by iriysoft.com"],n=0;n<i.length;n++)(e=new l.default(this.game,i[n],a.Constants.styleCredits2,null,this,a.Atlases.Interface)).y=19*n-48,e.setFrames("bg0000","bg0000","bg0000","bg0000"),e.btn.inputEnabled=!1,this.popup.getChildAt(1).addChild(e);this.popup_btn=new y.default(this.game,"BACK",a.Constants.styleBackArrow,this.disposePopup,this,a.Atlases.Interface),this.popup_btn.setFrames("arrow0000","arrow0000","arrow0000","arrow0000"),this.popup_btn.btn.btn.x=-110,this.popup_btn.x=-250,this.popup_btn.y=200;var r=new l.default(this.game,"",{},this.onLogo,this,a.Atlases.Interface);r.setFrames("logo_mad0000","logo_mad0000","logo_mad0000","logo_mad0000"),r.position.set(0,-92),r.scale.set(.87),this.popup.getChildAt(1).addChild(r),this.popup.getChildAt(1).addChild(this.popup_btn);t=null,r=this.game.add.group();this.popup.getChildAt(1).addChildAt(r,0),(t=this.game.add.sprite(-175,66,a.Atlases.Interface,"body00000")).anchor.set(.5),this.popup.addChildAt(t,1),(t=this.game.add.sprite(220,55,a.Atlases.Interface,"body10000")).anchor.set(.5),this.popup.addChildAt(t,1),(t=this.game.add.sprite(-203,-50,a.Atlases.Interface,"head00000")).anchor.set(.5),t.scale.set(.95),r.addChild(t),(t=this.game.add.sprite(205,-55,a.Atlases.Interface,"head10000")).anchor.set(.5),t.scale.set(.95),r.addChild(t),this.resize()},b.prototype.onLogo=function(){},b.prototype.disposePopup=function(){this.popup.destroy(),this.popup=null,this.popup_btn.destroy(),this.popup_btn=null},b.prototype.backgroundPopup=function(){this.popup=this.game.add.sprite(350,280,a.Atlases.Interface,"bg0000"),this.popup.anchor.set(.5),this.popup.scale.set(1.33333);var t=this.game.add.sprite(0,0,a.Atlases.Interface,"black0000");t.width=this.game.width+500,t.height=this.game.height+500,t.inputEnabled=!0,t.anchor.set(.5),this.popup.addChild(t)},b.prototype.createPopup=function(){null!==this.popup&&this.disposePopup(),this.backgroundPopup();var t=this.game.add.sprite(0,-15,a.Atlases.Interface,"0bg100000");t.anchor.set(.5),this.popup.addChild(t)},b.prototype.resizePopup=function(t){var e;null!==this.popup&&((e=this.popup.removeChildAt(0)).width=this.game.width+500,e.height=this.game.height+500,this.popup.x=this.world.bounds.centerX,this.popup.y=260*t,this.popup.addChildAt(e,0),this.popup.scale.set(t))},b.prototype.resize=function(){var t=1;t=1<(t=this.game.width/a.Constants.WIDTH)?1:t,t*=1.33333,this.backgroundBase.scale.set(t),this.backgroundBase.alignIn(this.world.bounds,Phaser.TOP_CENTER),this.backgroundBaseMask.scale.set(t,t),this.backgroundBaseMask.x=this.backgroundBase.x,this.backgroundBaseMask.y=this.backgroundBase.y,this.resizePopup(t),s.prototype.resize.call(this)},b.prototype.shutdown=function(){this.popup=null,this.popup_btn=null,this.playBtn1=null,this.playBtn2=null,this.playBtn3=null,this.leaderBoardBtn=null,this.musicBtn=null,s.prototype.shutdown.call(this)},b.Name="menu",b);function b(){var t=s.call(this)||this;return t.name=b.Name,t.popup=null,t.popup_btn=null,t}e.default=r},function(t,e,i){"use strict";e.__esModule=!0,i(0);n.prototype.init=function(t){var e=this;this.inited||(this.game=t,void 0!==hello&&"undefined"!==hello.showBanner&&(this.sdk=hello,this.inited=!0,document.getElementById("content").addEventListener("START",function(t){null!==e._callback&&null!==e._context&&(e._callback.call(e._context),e._callback=null,e._context=null),e.game.input.enabled=!0}),document.getElementById("content").addEventListener("PAUSE",function(t){})))},n.prototype.firstStart=function(){},n.prototype.displatchProgress=function(t){},n.prototype.displatchLoaded=function(){},n.prototype.dispatchStop=function(){},n.prototype.dispatchStart=function(){},n.prototype.dispatchHappy=function(t){},n.prototype.displayInterstitial=function(t,e){this.isInterstitialDisplayed||(this._callback=t,this._context=e,this.game.input.enabled=!1,this.sdk.sayHello())},n.prototype.displayRewarded=function(t,e){},n.prototype.createBannerDiv=function(){this.myAd=document.createElement("div"),this.width=300,this.height=250,this.fullWidth=this.width+2*this.safeBannerDist,this.fullHeight=this.height+2*this.safeBannerDist,this.ad_type=this.width+"x"+this.height,this.inited=!0,this.myAd.id="adContainer",this.myAd.style.width=this.width+"px",this.myAd.style.height=this.height+"px",this.myAd.style.position="absolute",this.myAd.style.zIndex="999",document.getElementById("content").appendChild(this.myAd)},n.prototype.displayBanner=function(t){null===this.myAd&&this.createBannerDiv(),this.isBannerLoaded||(this.isBannerLoaded=!0,this.sdk.displayAd(this.myAd,this.ad_type)),t?this.myAd.style.visibility="hidden":(this.myAd.style.visibility="visible",this.isBannerDisplayed=!0)},n.prototype.hideBanner=function(){this.isBannerDisplayed&&(this.myAd.style.visibility="hidden",this.sdk.destroyAd(this.myAd),this.isBannerDisplayed=!1,this.isBannerLoaded=!1)},n.prototype.getBannerLeft=function(t,e){if(this.isBannerDisplayed){var i=this.safeBannerDist,n=t*window.innerHeight*e/this.game.height-2*this.safeBannerDist,e=window.innerWidth-this.fullWidth;return(this.myAd.style.left=window.innerWidth-this.safeBannerDist-this.width+"px",this.myAd.style.top=Math.round(i+n-this.height)+"px",n<this.height)?(this.myAd.style.visibility="hidden",0):(this.myAd.style.visibility="visible",this.game.width/t*e/window.innerWidth)}return 0},n.prototype.setBannerVisible=function(t){this.isBannerDisplayed&&(this.myAd.style.visibility=t?"visible":"hidden")},n.getInstance=function(){return n.instance||(n.instance=new n),this.instance},i=n;function n(){this.myAd=null,this.inited=!1,this.started=!1,this.adRequested=!1,this.rewardedSignal=new Phaser.Signal,this.isInterstitialDisplayed=!1,this.isBannerLoaded=!1,this.isBannerDisplayed=!1,this.safeBannerDist=20,this._callback=null,this._context=null}e.default=i},function(t,e,i){"use strict";e.__esModule=!0;var n=(r.VERSION="2.1",r.GAME_SCALE=1,r.CALCULATED_WIDTH=0,r.CALCULATED_HEIGHT=0,r.WIDTH=1066,r.HEIGHT=640,r.LANDSCAPE_LOCKED=!0,r.PORTRAIT_LOCKED=!1,r.GAME_DISTRIBUTION_LOCAL_ID="",r.STORAGE_KEY="bb_20g",r.STORAGE_KEY_SFX="bb_sfx_sv",r.styleFPS={font:"24px Impact",fill:"#FF00FF"},r.styleTime={font:"15px Impact",fill:"#DDD9D7"},r.stylePreMatchTop={font:"60px Impact",fill:"#FFFFFF"},r.styleEndMatchTop={font:"60px Impact",fill:"#FFFFFF"},r.stylePreMatchState={font:"40px Impact",fill:"#FFFFFF"},r.stylePreMatchScore={font:"80px CfCrackBold",fill:"#FEAE00"},r.styleEndMatchScore={font:"90px CfCrackBold",fill:"#FEAE00"},r.stylePreMatchNames={font:"20px Impact",fill:"#FFFFFF"},r.styleIDnetScore={font:"18px Impact2",fill:"#FFFFFF"},r.styleIDnetScore2={font:"18px Impact2",fill:"#FF9900"},r.styleIDnetBestScore={font:"18px Impact2",fill:"#FFFFFF"},r.styleIDnetBestScore2={font:"18px Impact2",fill:"#FF9900"},r.styleHintSkillKey={font:"14px Impact",fill:"#1E292E"},r.stylePlay={font:"40px Impact",fill:"#FFFFFF"},r.stylePlay3={font:"40px Impact",fill:"#00CCFF"},r.stylePauseBtn1={font:"42px Impact",fill:"#FF9900"},r.stylePauseBtn2={font:"42px Impact",fill:"#00CCFF"},r.stylePlayLogin={font:"42px Impact",fill:"#B1FE00"},r.stylePlayGreen={font:"40px Impact",fill:"#CEF016"},r.styleNormalGreen={font:"25px Impact",fill:"#C254FF"},r.styleHardGreen={font:"35px Impact",fill:"#C254FF"},r.styleDIfficulltyBg={font:"25px Impact",fill:"#FFFFFF"},r.styleDIfficulltyBg2={font:"35px Impact",fill:"#FFFFFF"},r.stylePlay2={font:"40px Impact",fill:"#3AD9FF"},r.stylePlay4={font:"40px Impact",fill:"#FF9900"},r.styleAchievDiscr={font:"24px Impact",fill:"#FF9900"},r.styleTitle0={font:"88px Impact",fill:"#FFFFFF"},r.styleTitle1={font:"88px Impact",fill:"#000000"},r.styleTitle2={font:"34px Impact",fill:"#00CCFF"},r.styleTitleFinalTournamet={font:"40px Impact",fill:"#FFFFFF"},r.styleVS={font:"25px Impact",fill:"#FFFFFF"},r.styleVS2={font:"25px Impact",fill:"#C254FF"},r.styleCPU={font:"10px Impact",fill:"#FFFFFF"},r.styleCPU2={font:"10px Impact",fill:"#C254FF"},r.stylePause={font:"42px Impact",fill:"#FFFFFF"},r.styleWarningLeave={font:"38px Impact",fill:"#FFFFFF"},r.styleWarningContext={font:"28px Impact2",fill:"#FFFFFF"},r.styleOKGreen={font:"42px Impact",fill:"#CDF00F"},r.styleCancel={font:"52px Impact",fill:"#FF9900"},r.styleLoading={font:"25px Impact",fill:"#FF00FF"},r.styleCredits0={font:"30px Impact",fill:"#FFFFFF"},r.styleBackArrow={font:"40px Impact",fill:"#FF9900"},r.stylePopupContentSmall={font:"17px Impact2",fill:"#FFFFFF"},r.stylePopupContent={font:"30px Impact2",fill:"#FFFFFF"},r.stylePopupContentYellow={font:"30px Impact2",fill:"#66CCFF"},r.stylePopupContent2={font:"46px Impact2",fill:"#000000"},r.stylePopupCancel={font:"40px Impact",fill:"#FF9900"},r.stylePopupPlay={font:"40px Impact",fill:"#B1FE00"},r.styleCredits1={font:"19px Impact2",fill:"#FFFFFF"},r.styleCredits2={font:"15px Impact2",fill:"#FFFFFF"},r.styleCredits3={font:"56px Impact",fill:"#FFFFFF"},r.styleCredits33={font:"42px Impact",fill:"#FFFFFF"},r.styleCredits4={font:"46px Impact",fill:"#FFFFFF"},r.styleCredits5={font:"27px Impact",fill:"#FFFFFF"},r.styleTournamentPopup={font:"38px Impact",fill:"#00CCFF"},r.styleMSG={font:"64px Impact",fill:"#FF9900"},r.styleTimer={font:"24px CfCrackBold",fill:"#CDF00F"},r.styleVersion={font:"12px Impact",fill:"#FFFFFF"},r.styleHelpTxt0={font:"18px Impact2",fill:"#FFFFFF"},r.styleHelpTxt1={font:"24px Impact2",fill:"#FFFFFF"},r.styleHelpLetter={font:"20px Impact2",fill:"#000000"},r.styleHelpTitle={font:"40px Impact",fill:"#FFB600"},r.styleLogin={font:"28px Impact",fill:"#FFB600",boundsAlignH:"center",boundsAlignV:"middle"},r.styleLoginInfo={font:"18px Impact2",fill:"#FFFFFF",boundsAlignH:"center",boundsAlignV:"middle"},r.styleLoginInfoYellow={font:"20px Impact2",fill:"#66CCFF",boundsAlignH:"center",boundsAlignV:"middle"},r.styleLoginInfoYellow2={font:"20px Impact2",fill:"#FFFFFF",boundsAlignH:"center",boundsAlignV:"middle"},r.styleLoginInfoIsf={font:"16px Impact2",fill:"#FFFFFF"},r.stylePlayer={font:"16px Impact2",fill:"#FF9900"},r.stylePlayerName={font:"14px Impact2",fill:"#FFFFFF"},r.styleClubName={font:"20px Impact2",fill:"#FFFFFF"},r.styleSkillName={font:"14px Impact2",fill:"#FFFFFF"},r);function r(){}e.default=n},function(t,e,i){"use strict";e.__esModule=!0;var n=(r.Interface="interface",r.Gameplay="gameplay",r.preloadList=[],r.list=[r.Interface,r.Gameplay],r);function r(){}e.default=n},function(t,e,i){"use strict";e.__esModule=!0;var s=i(1),o=i(2),i=(n.prototype.initFirstSave=function(){o.Inventory.instance.init(),this.save()},n.getInstance=function(t,e,i){return n.instance?i&&e.call(i):n.instance=new n(t,e,i),n.instance},n.prototype.save=function(){var t=JSON.stringify({invsav:o.Inventory.instance.save}),e=this.hash(t);this.game.storage.setItem(s.Constants.STORAGE_KEY,t),this.game.storage.setItem(s.Constants.STORAGE_KEY+"h",e)},n.prototype.restore=function(){var i,n,r=this,t=this.game.storage.getItem(s.Constants.STORAGE_KEY),e=this.game.storage.getItem(s.Constants.STORAGE_KEY+"h");Promise.all([t,e]).then(function(t){if(i=t[0]||"",n=t[1]||"0",""===i)return r.initFirstSave(),void(r.callback&&r.callbackContext&&r.callback.call(r.callbackContext));if(n!==r.hash(i))return r.initFirstSave(),void(r.callback&&r.callbackContext&&r.callback.call(r.callbackContext));if(i&&""!==i)try{var e=JSON.parse(i);o.Inventory.instance.save=e.invsav}catch(t){r.initFirstSave()}else r.initFirstSave();r.callback&&r.callbackContext&&r.callback.call(r.callbackContext)})},n.prototype.hash=function(t){var e,i,n=0;if(0===t.length)return n.toString();for(e=0,i=t.length;e<i;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n.toString()},n);function n(t,e,i){var n=this;this.carSaves={},this.game=t,this.callback=e,this.callbackContext=i,this.game&&this.game.storage.getItem(s.Constants.STORAGE_KEY).then(function(t){null==t?(n.initFirstSave(),n.callback&&n.callbackContext&&n.callback.call(n.callbackContext)):n.restore()})}e.default=i},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(3),r=(s=Phaser.Group,r(a,s),a.prototype.add=function(t){},a.prototype.shake=function(t){},a.prototype.shakeContainer=function(t,e){void 0===t&&(t=null);var i=o.default.game.add.tween(t),n=t.x,r=t.y;i.to({x:t.x-e,y:t.y-e},25,Phaser.Easing.Bounce.InOut,!1,0,4,!0),i.onComplete.addOnce(function(){t.x=n,t.y=r},this),i.start()},a.prototype.release=function(){this.game=null},a.prototype.start=function(){},a.prototype.resize=function(){},a);function a(t){var e=s.call(this,t)||this;return e.game=t,e}e.GameView=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(5),a=i(3),l=i(35),p=i(13),h=i(1),u=i(7),c=i(2),d=i(15),r=(s=Phaser.Group,r(_,s),_.prototype.start=function(t){this.wasEnd=!1,this.fullTime=t,this.noticeTime=4,this.process(0)},Object.defineProperty(_.prototype,"fullTimeMatch",{get:function(){return this.fullTime},enumerable:!0,configurable:!0}),_.prototype.updateScore=function(t,e){1===t?p.MainGameCore.instance.infoPanel.updateScore(e,c.Inventory.instance.matchData.matchScore[1]):p.MainGameCore.instance.infoPanel.updateScore(c.Inventory.instance.matchData.matchScore[0],e)},_.prototype.process=function(t){var e,i=this.fullTime-t;i<=0?this.wasEnd||(this.timer.label.text="00.0",this.wasEnd=!0,d.Signals.MatchEndSignal.dispatch()):120==i?this.timer.label.text="2:00":60<=i?(e=i-60>>0,this.timer.label.text=10<=e?"1:"+e.toString():"1:0"+e.toString()):(e=10*(i-(t=i>>0))>>0,10<=i?this.timer.label.text=t.toString()+"."+e.toString():(this.timer.label.text="0"+t.toString()+"."+e.toString(),t===this.noticeTime&&0<=this.noticeTime&&(o.default.getInstance().play(h.Sounds.m_countdown),this.noticeTime--)))},_);function _(){var t=s.call(this,a.default.game)||this;return t.timer=null,t.x=400,t.y=82,t.timer=new u.default(a.default.game," ",l.default.styleTimer,null,null,h.Atlases.Gameplay),t.addChild(t.timer),t.timer.label.setMaxSize(150,70),t.timer.setFrames("bg0000","bg0000","bg0000","bg0000"),t.timer.label.setShadow(3,3,"rgba(0,0,0,0.5)",5),t.timer.setText("2:00"),t}e.TimerObject=r},function(t,e,i){"use strict";e.__esModule=!0;var n=i(15),i=(Object.defineProperty(r,"instance",{get:function(){return null===r._instance&&(r._instance=new r),r._instance},enumerable:!0,configurable:!0}),r.prototype.clearSensors=function(){this.canScore=!0,this.upperSensor=!1},r.prototype.shoot=function(t,e,i){this.clearSensors(),this.shotSide=t,this.isHuman=e,this.throwType=i,this.blockSide=0,this.blockIsHuman=!1},r.prototype.block=function(t,e){this.clearSensors(),this.blockSide=t,this.blockIsHuman=e},r.prototype.processSensor=function(t,e){this.canScore&&(0===t?this.upperSensor=!0:this.upperSensor?this.sendScore(e):this.canScore=!1)},r.prototype.sendScore=function(t){var e;this.blockSide===-t?(e=2,this.isHuman=this.blockIsHuman,this.throwType=2):e=0===this.throwType?3:2,this.callBack.dispatch(t,e,this.isHuman,this.throwType)},r.prototype.finishMatch=function(){n.Signals.SensorSignal.remove(this.processSensor,this)},r._instance=null,r);function r(){this.callBack=n.Signals.MatchProcessorSignal,n.Signals.SensorSignal.add(this.processSensor,this)}e.MatchProcessor=i},function(t,e,i){"use strict";e.__esModule=!0;var n=(r.create=function(){var t;r.botsSkills.push({accuracy:.01,chanceToCompleteDunk:.9,coolDown:18}),t={accuracy:.14,chanceToCompleteDunk:.4,jumpBall:.45,chanceToRebound:.3,attack:.4,attackAtOnce:.2,avoidSteal:.2,makePump:.5,reactOnOpponent:.3,makeDash:1,delayDash:5,defence:.5,jumpThrow:.3,makeSteal:.3,delaySteal:3,jumpPump:.8,makeBlock:.2,reboundFixed:.35,reboundRange:.1,moveDelay:.1,coolDown:48},r.botsSkills.push(t),t={accuracy:.12,chanceToCompleteDunk:.45,jumpBall:.45,chanceToRebound:.35,attack:.4,attackAtOnce:.3,avoidSteal:.3,makePump:.5,reactOnOpponent:.4,makeDash:1,delayDash:4.5,defence:.5,jumpThrow:.4,makeSteal:.4,delaySteal:2.5,jumpPump:.7,makeBlock:.3,reboundFixed:.3,reboundRange:.1,moveDelay:.08,coolDown:48},r.botsSkills.push(t),t={accuracy:.1,chanceToCompleteDunk:.5,jumpBall:.45,chanceToRebound:.4,attack:.35,attackAtOnce:.4,avoidSteal:.4,makePump:.5,reactOnOpponent:.5,makeDash:1,delayDash:4,defence:.45,jumpThrow:.6,makeSteal:.5,delaySteal:2,jumpPump:.6,makeBlock:.4,reboundFixed:.25,reboundRange:.1,moveDelay:.06,coolDown:35},r.botsSkills.push(t),t={accuracy:.08,chanceToCompleteDunk:.6,jumpBall:.4,chanceToRebound:.5,attack:.3,attackAtOnce:.5,avoidSteal:.5,makePump:.5,reactOnOpponent:.6,makeDash:1,delayDash:3,defence:.3,jumpThrow:.8,makeSteal:.6,delaySteal:1,jumpPump:.5,makeBlock:.5,reboundFixed:.2,reboundRange:.1,moveDelay:.05,coolDown:35},r.botsSkills.push(t),t={accuracy:.04,chanceToCompleteDunk:.7,jumpBall:.4,chanceToRebound:.7,attack:.3,attackAtOnce:.6,avoidSteal:.6,makePump:.5,reactOnOpponent:.6,makeDash:1,delayDash:3,defence:.3,jumpThrow:1,makeSteal:.7,delaySteal:1,jumpPump:.5,makeBlock:.5,reboundFixed:.2,reboundRange:.1,moveDelay:.05,coolDown:28},r.botsSkills.push(t),t={accuracy:.03,chanceToCompleteDunk:.75,jumpBall:.3,chanceToRebound:.8,attack:.2,attackAtOnce:.7,avoidSteal:.7,makePump:.5,reactOnOpponent:.7,makeDash:1,delayDash:2.5,defence:.2,jumpThrow:1,makeSteal:.8,delaySteal:1,jumpPump:.4,makeBlock:.5,reboundFixed:.15,reboundRange:.1,moveDelay:.05,coolDown:28},r.botsSkills.push(t),t={accuracy:.02,chanceToCompleteDunk:.8,jumpBall:.2,chanceToRebound:.9,attack:.1,attackAtOnce:.8,avoidSteal:.8,makePump:.5,reactOnOpponent:.8,makeDash:1,delayDash:2,defence:.1,jumpThrow:1,makeSteal:.9,delaySteal:1,jumpPump:.3,makeBlock:.8,reboundFixed:.1,reboundRange:.1,moveDelay:.05,coolDown:28},r.botsSkills.push(t),t={accuracy:.01,chanceToCompleteDunk:.9,jumpBall:.1,chanceToRebound:1,attack:.05,attackAtOnce:.9,avoidSteal:.9,makePump:.5,reactOnOpponent:.9,makeDash:1,delayDash:2,defence:.05,jumpThrow:1,makeSteal:.9,delaySteal:1,jumpPump:.2,makeBlock:1,reboundFixed:0,reboundRange:.1,moveDelay:.05,coolDown:28},r.botsSkills.push(t)},r.botsSkills=[],r);function r(){}e.AISkillsData=n},function(t,e,i){"use strict";e.__esModule=!0;var n=i(0),i=(r.prototype.init=function(t,e,i){this.values=this.baseData.getValues(),this.save=t,this.saveName=e,this.signalSave=new n.Signal,this.loadData()},r.prototype.loadData=function(){var t;null===this.save&&(this.save={}),null==(t=this.save[this.saveName])?(this.save[this.saveName]={},this.saveData()):this.baseData.setValues(t)},r.prototype.saveData=function(){this.save[this.saveName]=this.baseData.getValuesForWrite(),this.signalSave.dispatch()},r.prototype.updateData=function(t,e){void 0===e&&(e=0)},r);function r(){}e.BaseDataManager=i},function(t,e,i){"use strict";e.__esModule=!0;var n=(r.prototype.createEmpty=function(){this.values=[];for(var t=0;t<this.count;t++)this.values[t]=0},r.prototype.getValuesForWrite=function(){for(var t={},e=0;e<this.count;e++)t[this.names[e]]=this.values[e];return t},r.prototype.setValues=function(t){for(var e in t){var i=this.names.indexOf(e);this.values[i]=t[e]}},r.prototype.getValues=function(){return this.values},r);function r(){}e.BaseData=n},function(t,e,i){"use strict";e.__esModule=!0;var n=i(2),r=i(13),i=(s.prototype.create=function(t){void 0===t&&(t=null)},s.prototype.add=function(){this.body&&this.updateGraphic(),r.MainGameCore.instance.add(this)},s.prototype.release=function(){if(this.graphic){if(this.graphic.dispose)try{this.graphic.dispose()}catch(t){}this.graphic=null}if(this.body){try{n.NapeUtil.disposeBody(this.body)}catch(t){}this.body=null}},s.prototype.updateGraphic=function(){this.graphic&&(this.graphic.x=this.body.position.x,this.graphic.y=this.body.position.y,this.graphic.rotation=180*this.body.rotation/Math.PI%360,this.body.userData.graphic=this.graphic)},s.prototype.start=function(){},s.prototype.update=function(t){},s.prototype.getPosition=function(){return this.body?this.body.position:null},s.prototype.getX=function(){return this.body?this.body.position.x:-1e3},s.prototype.getY=function(){return this.body?this.body.position.y:-1e3},s.prototype.stopVelocity=function(){this.body&&this.body.velocity.setxy(0,0)},s);function s(){this.graphic=null,this.objType=-1}e.GameObject=i},function(t,e,i){"use strict";e.__esModule=!0;var h=i(2),u=i(46),c=i(24),d=i(3),_=i(81),y=i(82),f=i(41),i=(n.prototype.start=function(t,e,i){var n=new _.ArenaObject;new y.BasketObject(-1),new y.BasketObject(1),new u.BallObject,new h.CountDownObject,new h.MessageInfo;for(var r=c.Inventory.instance.matchData,s=1===r.matchMode||2===r.matchMode?2:1,o=3===c.Inventory.instance.gameMode?1:2,a=0;a<o;a++)for(var l=0;l<s;l++){var p=i.pop();d.default.game.world.addChild(p),new h.PlayerObject(a,r.teams[a],r.players[a][l],r.forms[a],l,r.pb[a][l],f.AISkillsData.botsSkills[r.skills[a][l]],p)}n.setLogo(r.teams[0]),t.call(e)},n);function n(){var t=c.Inventory.instance.gameMode;0===t?c.Inventory.instance.startTournamentMatch():3===t?c.Inventory.instance.matchData.startTraining():c.Inventory.instance.matchData.restarted?(c.Inventory.instance.matchData.restarted=!1,c.Inventory.instance.matchData.resetScore()):1===t?c.Inventory.instance.matchData.startRandomMatch():2===t?c.Inventory.instance.matchData.startQuickMatch():4===t&&c.Inventory.instance.matchData.startPlayers2Match()}e.GameBuilder=i},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=nape.geom.Vec2,a=nape.phys.BodyType,l=i(44),p=i(23),h=i(2),u=i(16),c=i(4),d=i(30),_=i(3),y=i(1),f=i(47),m=i(15),x=i(5),r=(s=l.GameObject,r(v,s),v.prototype.createGraphic=function(){this.graphic=new Phaser.Group(_.default.game);var t=new Phaser.Sprite(_.default.game,0,0,y.Atlases.Gameplay,"BallMC0000");t.anchor.set(.5),this.graphic.addChild(t),this.shadow=new f.ShadowObject(this.graphic,0)},v.prototype.createBody=function(){this.body=p.NapeUtil.createCircleBody(a.DYNAMIC,h.Filters.BALL,!1,d.ObjectsData.BALL_RADIUS,0,0,0,h.CbTypes.cbBall,h.Materials.BALL),this.body.userData.graphic=this.graphic,(this.body.userData.owner=this).body.gravMass*=d.ObjectsData.BALL_GRAVMASS},v.prototype.restart=function(t){void 0===t&&(t=0),0===t&&(this.body.velocity.setxy(0,this.velUp),this.state="up",this.body.position.set(this.indent),this.body.rotation=0,this.body.angularVel=0,this.updateGraphic(),this.shadow.update(),null===this.body.space&&this.returnToPhysics())},v.prototype.setState=function(t,e,i,n){void 0===e&&(e=2),void 0===i&&(i=0),void 0===n&&(n=!1),t===this.state&&!n||(e<2&&(this.SIDE=e),"inHands"===t?this.gamecore.ballInHands(this.SIDE,i):"shooting"===t?this.gamecore.ballShooting(this.SIDE,i):this.gamecore.ballOthers(),!this.isWaiting||"bounce"!==t&&"score"!==t||(this.isWaiting=!1,m.Signals.MatchEndSignal.dispatch()),this.state=t)},v.prototype.shoot=function(t,e,i,n,r){this.SIDE=t,this.body.position.setxy(e,i);var s=this.calcThrowVel(e,i),o=1===t?e:this.width-e,n=Math.abs(n)/this.maxVelX*.1,r=this.calcDispersion(o,i,n,r);r<2?this.body.velocity.setxy(s.x*r,s.y):2===r?this.body.velocity.set(this.calcThrowVel(e,i,30*this.SIDE)):this.body.velocity.set(this.calcThrowVel(e,i,30*-this.SIDE)),this.body.rotation=0,this.body.angularVel=t*(5+10*Math.random()),this.setState("shooting"),s.dispose(),this.returnToPhysics()},v.prototype.alleyOop=function(t,e,i,n){this.player=n,this.SIDE=t,this.body.position.setxy(e,i),this.body.rotation=0;t=1===t?this.alleyOopX1:this.alleyOopX2;this.body.velocity.set(this.calcVel(e,i,t,this.alleyOopY,150)),this.toPhysics2()},v.prototype.calcThrowVel=function(t,e,i){var n;return void 0===i&&(i=0),i=(i=1===this.SIDE?(n=this.xB1+i,t):(n=this.xB2+i,this.width-t))<=150?70:i<=250?100:i<=350?.3*i+40:i<=540?150:130,185<(i*=1+.1*(Math.random()<=.5?-1:1)*Math.random())&&(i=185),this.calcVel(t,e,n,this.yB,i)},v.prototype.calcVel=function(t,e,i,n,r){e-=n-r,n=-Math.sqrt(2*this.gravity*e),e=-n/this.gravity,r=Math.sqrt(2*r/this.gravity);return new o((i-t)/(e+r)*1.035,n)},v.prototype.calcDispersion=function(t,e,i,n){e=e<235?0:295<=e?this.vertDispersion:(1-(295-e)/60)*this.vertDispersion,t=t<=100?0:t<=200?.01:t<=300?.02:t<=400?.03:t<=490?.04:t<=540?.01:.07;i=(Math.random()<.5?-1:1)*(this.baseDispersion+e+t+n+i)*Math.random();return Math.abs(i)<=.02?1:i<-.08?2:.08<i?3:1+i},v.prototype.dunk=function(t,e){var i,n,r;return this.SIDE=t,Math.random()<=e?(i=1===t?this.basket1+17:this.basket2-17,n=o.get(-260*t,400),r=!0):(i=1===t?this.basket1:this.basket2,n=o.get(-550*t,400),r=!1,x.default.getInstance().play(y.Sounds.b_brick)),this.body.position.setxy(i,170),this.body.velocity.set(n),this.body.rotation=0,this.body.angularVel=0,this.setState("dunk"),this.returnToPhysics(),n.dispose(),r},v.prototype.takeInHands=function(t,e,i){void 0===i&&(i=!1);var n=!1;return(i||"shooting"!==this.state&&"inHands"!==this.state)&&(this.removeFromPhysics(),this.SIDE=t,this.setState("inHands",this.SIDE,e,i),n=!0),n},v.prototype.fromHands=function(t,e){this.setState("down"),this.body.position.set(t),this.body.velocity.setxy(150*e,-100),this.returnToPhysics()},v.prototype.applySteal=function(t,e,i){this.setState("steal"),this.body.position.set(t);e=i*(this.stealVelXBase+e*this.stealVelXAdd);this.body.velocity.setxy(e,this.stealVelY),this.returnToPhysics()},v.prototype.onGroundCollision=function(t){void 0===t&&(t=!0),"inHands"!==this.state&&(this.setState("bounce"),t&&(this.body.velocity.y=this.bounceVel,x.default.getInstance().play(y.Sounds.b_bounce)))},v.prototype.isInGame=function(){return null!==this.body.space},v.prototype.removeFromPhysics=function(){this.shadow.hide(),this.body.velocity.setxy(0,0),this.body.angularVel=0,this.body.rotation=0,this.graphic.visible=!1,this.body.space=null,this.setVisibleOnframe=!1},v.prototype.returnToPhysics=function(){this.body.space=this.space1,this.updateGraphic(),this.setVisibleOnframe=!0},v.prototype.toPhysics2=function(){this.gamecore.isAlleyOop=!0,this.body.space=this.space2,this.updateGraphic(),this.graphic.visible=!0},v.prototype.playSnd=function(t){var e,i;0===t?x.default.getInstance().play(y.Sounds.b_net):1===t?(i=void 0,i=300<(e=Math.abs(this.body.velocity.length))?1:e/300*.8,x.default.getInstance().play(y.Sounds.b_ring,i)):2===t&&x.default.getInstance().play(y.Sounds.b_basket)},v.prototype.onDownSensor=function(){this.setState("score"),this.playSnd(0)},v.prototype.onShieldCollision=function(t){"score"!==this.state&&(x.default.getInstance().play(y.Sounds.b_steel),this.body.velocity.setxy(-t*(200+100*Math.random()),-200-100*Math.random()),this.setState("basket"))},v.prototype.update=function(t){void 0===t&&(t=0),this.player&&0<this.body.velocity.y&&(this.player.continueAlleyOop(),this.player=null),this.setVisibleOnframe&&(this.setVisibleOnframe=!1,this.graphic.visible=!0,this.shadow.show())},v.prototype.release=function(){this.shadow=null,this.space1=null,this.space2=null,this.indent.dispose(),this.indent=null,this.player=null,s.prototype.release.call(this)},v);function v(){var t=s.call(this)||this;return t.isWaiting=!1,t.setVisibleOnframe=!1,t.gamecore=h.MainGameCore.instance,t.objType=u.ObjectsType.BALL,t.width=c.default.WIDTH,t.velUp=d.ObjectsData.BALL_UP_VELOCITY_Y,t.bounceVel=d.ObjectsData.BALL_BOUNCE,t.stealVelXBase=d.ObjectsData.BALL_STEAL_VELOCITY_X_BASE,t.stealVelXAdd=d.ObjectsData.BALL_STEAL_VELOCITY_X_ADD,t.stealVelY=d.ObjectsData.BALL_STEAL_VELOCITY_Y,t.xB1=d.ObjectsData.BASKET_CENTER,t.xB2=d.ObjectsData.BASKET_CENTER2,t.yB=d.ObjectsData.BASKET_HEIGHT,t.gravity=d.ObjectsData.GRAVITY.y*d.ObjectsData.BALL_GRAVMASS,t.alleyOopX1=d.ObjectsData.ALLEY_OOP_X,t.alleyOopX2=t.width-d.ObjectsData.ALLEY_OOP_X,t.alleyOopY=d.ObjectsData.ALLEY_OOP_Y,t.baseDispersion=d.ObjectsData.DISPERSION,t.vertDispersion=d.ObjectsData.VERTICAL_DISPERSION,t.maxVelX=d.ObjectsData.PLAYER_MOVE_WITH_BALL,t.basket1=d.ObjectsData.BASKET_CENTER,t.basket2=d.ObjectsData.BASKET_CENTER2,t.createBody(),t.createGraphic(),t.indent=o.get(c.default.WIDTH2,d.ObjectsData.BALL_INDENT_Y_CENTER),s.prototype.add.call(t),t.space1=t.body.space,t}e.BallObject=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(2),a=i(0),l=nape.geom.Ray,p=nape.geom.Vec2,h=i(22),u=i(3),c=i(1),r=(s=o.GameObject,r(d,s),d.prototype.update=function(t){var e;void 0===t&&(t=0),this.space&&this.graphic.visible&&(this.ray.origin=p.weak(this.owner.x,this.owner.y),(e=this.space.rayCast(this.ray,!1,o.Filters.RAY))&&(t=this.ray.at(e.distance),this.graphic.x=t.x,this.graphic.y=t.y,this.graphic.alpha=0<1-e.distance/this.dist?1-e.distance/this.dist:0,t.dispose(),e.dispose()))},d.prototype.release=function(){this.space=null,this.owner=null,this.ray.origin.dispose(),this.ray.direction.dispose(),this.ray=null,s.prototype.release.call(this)},d.prototype.show=function(){this.graphic.visible=!0,this.update()},d.prototype.hide=function(){this.graphic.visible=!1},d);function d(t,e){var i,n=s.call(this)||this;return n.objType=o.ObjectsType.SHADOW,n.space=h.NapePhysics.space,n.owner=t,n.ray=new l(p.weak(t.x,t.y),p.weak(0,1)),n.graphic=new a.Sprite(u.default.game,0,0,c.Atlases.Gameplay,"ShadowMC0002"),n.graphic.anchor.set(.5),n.dist=250,0===e?(n.dist=400,n.graphic.scale.set(.7)):1===e||(2===e?((i=new Phaser.Image(u.default.game,0,0,c.Atlases.Gameplay,"ShadowMC0000")).anchor.set(.5),n.graphic.addChild(i)):3===e&&((i=new Phaser.Image(u.default.game,0,0,c.Atlases.Gameplay,"ShadowMC0001")).anchor.set(.5),n.graphic.addChild(i))),s.prototype.add.call(n),n}e.ShadowObject=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(25),a=i(13),l=i(4),p=i(2),h=i(20),u=i(90),c=i(91),d=i(92),_=i(15),r=(s=o.BaseController,r(y,s),y.prototype.initZones=function(){1===this.SIDE?(this.attackZoneStart=p.ObjectsData.ATTACK_ZONE_START,this.attackZoneEnd=p.ObjectsData.ATTACK_ZONE_END,this.dashZoneStart=p.ObjectsData.DASH_ZONE_START,this.dashZoneEnd=p.ObjectsData.DASH_ZONE_END,0===this.playerNo?(this.baseEndPoint=280,this.reboundPointInAttack=190,this.reboundPointInDefence=610):(this.baseEndPoint=400,this.reboundPointInAttack=150,this.reboundPointInDefence=680)):(this.attackZoneStart=this.width-p.ObjectsData.ATTACK_ZONE_END,this.attackZoneEnd=this.width-p.ObjectsData.ATTACK_ZONE_START,this.dashZoneStart=this.width-p.ObjectsData.DASH_ZONE_END,this.dashZoneEnd=this.width-p.ObjectsData.DASH_ZONE_START,0===this.playerNo?(this.baseEndPoint=580,this.reboundPointInAttack=610,this.reboundPointInDefence=190):(this.baseEndPoint=400,this.reboundPointInAttack=650,this.reboundPointInDefence=120))},y.prototype.init=function(t){this.jumpBall=new u.NegativeDelay(p.ObjectsData.IDEAL_JUMP_BALL_JUMP,t.jumpBall),this.attack=new h.FullDelay(p.ObjectsData.IDEAL_ATTACK_JUMP,t.attack),this.attackJumpDelay=new c.SimpleDelay(t.attackAtOnce),this.chanceToRebound=t.chanceToRebound,this.chanceToAvoidSteal=t.avoidSteal,this.chanceToMakePump=t.makePump,this.chanceToReactOnCloseOpponent=t.reactOnOpponent,this.chanceToDash=t.makeDash,this.dashDelay=new d.AIUseDelay(.1,t.delayDash),this.defence=new c.SimpleDelay(t.defence),this.chanceToJumpWhenThrow=t.jumpThrow,this.chanceToUseSteal=t.makeSteal,this.stealDelay=new d.AIUseDelay(.1,p.ObjectsData.STEAL_DURATION+t.delaySteal),this.chanceToJumpWhenPump=t.jumpPump,this.chanceToBlock=t.makeBlock,this.blockDelay=new h.FullDelay(0,.2),this.reboundDelay=new h.FullDelay(t.reboundRange,t.reboundFixed),this.moveDelay=new h.FullDelay(t.moveDelay,.05),this.opponentDelta=p.ObjectsData.OPPONENT_DELTA,this.chanceForThree=p.ObjectsData.CHANCE_FOR_THREE,this.initZones()},y.prototype.restart=function(t){this.strategy=3,0===t&&this.onJumpBall(),this.deltaDownTime=0,this.endPoint=this.baseEndPoint,this.currentSuper=!1,this.resetAllDelays(),this.resetCurrents(),this.isPumped=!1,this.pumpCount=0,this.canJump=!0,this.willAttackAtOnce=!1,s.prototype.restart.call(this,t)},y.prototype.onJumpBall=function(){},y.prototype.resetCurrents=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===n&&(n=0),this.currentMove=t,this.currentJump=e,this.currentAction=i,this.currentDash=n},y.prototype.resetBaseDelays=function(){this.attackJumpDelay.reset(),this.attack.reset(),this.defence.reset(),this.moveDelay.reset(),this.stealDelay.reset(),this.resetAvoidSteal()},y.prototype.resetAllDelays=function(){this.dashDelay.reset(),this.resetBaseDelays()},y.prototype.resetAvoidSteal=function(){this.avoidStealJump=!1,this.avoidStealMove=0},y.prototype.ballInOwnHands=function(t){void 0===t&&(t=0),0===this.superID&&this.player.readyForSuper&&this.megaDunkDelay.activate(),this.resetBaseDelays(),this.resetCurrents(),this.strategy=2;t=this.isReboundInAttackZone();-1===t?(this.willAttackAtOnce=!this.player.isGrounded,this.setAttackPoint(150,this.player.getX())):0===t?(this.willAttackAtOnce=!this.player.isGrounded,t=this.player.getX(),this.setAttackPoint(t,t)):(this.setAttackPoint(0),Math.abs(this.player.getX()-this.attackPoint)<50?this.willAttackAtOnce=!this.player.isGrounded:this.willAttackAtOnce=!1),this.willAttackAtOnce&&(this.canJump=!1)},y.prototype.ballInOpponentsHands=function(t){void 0===t&&(t=0),this.resetBaseDelays(),this.resetCurrents(),this.willAttackAtOnce=!1,this.isPumped=!1,this.strategy=0},y.prototype.ballOwnShoot=function(t){void 0===t&&(t=0),this.resetCurrents(),this.strategy=4,this.reboundPoint=this.reboundPointInAttack},y.prototype.ballOpponentShoot=function(t){void 0===t&&(t=0),1===this.superID&&this.superShot(!0),this.resetCurrents(),this.strategy=4,this.currentJump=this.opponent.isGrounded&&this.isOpponentCloseBehind(120)&&Math.random()<=this.chanceToJumpWhenThrow,this.reboundPoint=this.reboundPointInDefence},y.prototype.ballOthers=function(){this.strategy=1},y.prototype.setAttackPoint=function(t,e){void 0===e&&(e=0),0!=t?(this.attackPoint=t,this.jumpPoint=e):(0<(this.player.getX()-450)*this.SIDE&&Math.random()<=this.chanceForThree?this.attackPoint=510:Math.random()<=.7?this.attackPoint=120+200*Math.random():this.attackPoint=320+160*Math.random(),this.jumpPoint=this.attackPoint<=200?this.attackPoint+100:this.attackPoint),-1===this.SIDE&&(this.attackPoint=this.width-this.attackPoint,this.jumpPoint=this.width-this.jumpPoint)},y.prototype.processPlayerSignal=function(t,e,i){void 0===i&&(i=0),"startSteal"===t?this.playerStartSteal(e,i):"steal"===t?this.playerSteal(e,i):"jumpA"===t?this.playerJumpA(e,i):"pump"===t?this.playerPump(e,i):"dash"===t?this.playerDash(e,i):"stun"===t&&this.playerStun(e,i)},y.prototype.playerStartSteal=function(t,e){void 0===e&&(e=0),this.SIDE===-t?this.player.withBall&&this.player.isGrounded&&(this.isOpponentCloseBehind(80)||this.isOpponentCloseBehind(140)&&this.opponent.isMoving())&&this.tryToAvoid():this.stealDelay.useIt()},y.prototype.tryToAvoid=function(){var t;(Math.random()<=this.chanceToAvoidSteal||600<this.player.getX())&&((t=Math.random())<=.1&&this.player.isReadyToDash()?this.currentDash=-this.SIDE:t<=.4&&this.isInAttackZone()?(this.avoidStealJump=!0,this.moveDelay.reset()):this.avoidStealMove=this.SIDE)},y.prototype.playerJumpA=function(t,e){void 0===e&&(e=0),this.SIDE===t?e===this.playerNo&&(this.resetAvoidSteal(),this.attack.activate(),this.throwPoint=this.player.getX(),this.directionToFly=0<=this.player.getX()-this.attackPoint?-1:1):Math.random()<=this.chanceToJumpWhenThrow&&this.defence.activate()},y.prototype.playerPump=function(t,e){void 0===e&&(e=0),this.SIDE===-t&&this.player.canAct&&++this.pumpCount<=3&&this.isOpponentCloseBehind(90)&&Math.random()<=this.chanceToJumpWhenPump&&(this.defence.activate(),this.stealDelay.reset(),this.currentMove=0,this.isPumped=!0)},y.prototype.playerDash=function(t,e){void 0===e&&(e=0),this.SIDE===t?this.attack.reset():0===this.strategy&&this.player.canAct&&this.isOpponentInRangeBehind()&&Math.random()<=this.chanceToBlock&&(this.resetCurrents(),this.resetAllDelays(),this.currentBlockOrPump=!0)},y.prototype.playerStun=function(t,e){void 0===e&&(e=0),this.SIDE===t&&this.resetAllDelays()},y.prototype.playerSteal=function(t,e){void 0===e&&(e=0),this.SIDE===-t&&this.resetAvoidSteal()},y.prototype.playerOnGround=function(){this.isPumped=!1,this.player.withBall&&this.willAttackAtOnce&&(this.resetCurrents(),this.attackJumpDelay.activate())},y.prototype.playerOnDashEnd=function(){(this.player.getX()-this.attackPoint)*this.SIDE<0&&(this.attackPoint=this.player.getX()-10*this.SIDE)},y.prototype.playerOnBlock=function(){this.currentBlockOrPump=!1,this.blockDelay.activate()},y.prototype.releaseBlockOrPump=function(t){return 1===this.blockDelay.update(t)},y.prototype.isReboundInAttackZone=function(){var t=this.player.getX(),e=0;return(t-this.attackZoneStart)*this.SIDE<=0?e=-1:0<=(t-this.attackZoneEnd)*this.SIDE&&(e=1),e},y.prototype.isInAttackZone=function(){return 1===this.SIDE?this.player.getX()<600:200<this.player.getX()},y.prototype.inDashingZone=function(){return this.playerX>=this.dashZoneStart},y.prototype.moveToo=function(t){t=this.player.getX()-t;return Math.abs(t)<=this.deltaDistance?0:0<t?-1:1},y.prototype.moveInAttack=function(){var t=this.moveToo(this.jumpPoint);return t=0===t?(this.attackJump=!0,this.jumpPoint===this.attackPoint?2:this.moveToo(this.attackPoint)):(this.attackJump=!1,this.moveToo(this.attackPoint))},y.prototype.readyForAction=function(){return!0},y.prototype.dispose=function(){_.Signals.PlayerSignal.remove(this.processPlayerSignal,this),this.gamecore=null,this.ball=null,this.opponent=null,this.opponents=null,this.superShot=null,this.attackJumpDelay=null,this.moveDelay=null,this.stealDelay=null,this.dashDelay=null,this.jumpBall=null,this.attack=null,this.defence=null,this.blockDelay=null,this.reboundDelay=null,this.megaDunkDelay=null,s.prototype.dispose.call(this)},y.prototype.update=function(t){this.currentDash=0;var e=this.attackJumpDelay.update(t);0<=e?1===e?(this.currentMove=0,this.currentJump=!0,this.currentAction=!1,this.canJump=!0):(this.currentMove=this.avoidStealMove,this.currentJump=this.avoidStealJump):(this.calcPositions(),0===this.strategy?this.strategyDefence(t):1===this.strategy?this.strategyBallFight(t):2===this.strategy?this.strategyAttack(t):3===this.strategy?this.strategyJumpBall(t):4===this.strategy?this.strategyRebound(t):5===this.strategy&&this.strategyDefence2(t))},y.prototype.calcPositions=function(){this.playerX=this.player.getX(),this.opponentX=this.opponent.getX()},y.prototype.strategyDefence=function(t){var e=this.stealDelay.update(t),i=this.moveDelay.update(t);this.isPumped?this.currentMove=0:(this.player.isGrounded?-1===i&&(i=(this.opponentX-this.endPoint)*this.SIDE<0?this.endPoint:this.opponent.isGrounded?this.opponentX+this.SIDE*this.opponentDelta:this.opponentX+this.SIDE*(this.opponentDelta-10),this.currentMove=this.moveToo(i),this.moveDelay.activate()):this.currentMove=this.moveToo(this.opponentX+this.SIDE*(this.opponentDelta-10)),-1===e&&this.tryToSteal()),this.currentJump=1===this.defence.update(t)&&this.isOpponentCloseAbs(180),this.currentAction=1===e,!1===this.currentAction&&!1===this.currentJump&&0===this.currentMove?(this.deltaDownTime+=this.incDownTime,this.deltaDownTime>=this.downTime&&(this.endPoint=1===this.SIDE?0:this.width,this.deltaDownTime=0)):this.deltaDownTime=0},y.prototype.tryToSteal=function(){this.opponent.isGrounded&&(this.isOpponentCloseBehind(80)?Math.random()<=this.chanceToUseSteal?this.stealDelay.activate():this.stealDelay.skipIt():this.isOpponentCloseToBasket(45)&&(Math.random()<=1.5*this.chanceToUseSteal?this.stealDelay.activate():this.stealDelay.skipIt()))},y.prototype.strategyDefence2=function(t){},y.prototype.strategyBallFight=function(t){var e=this.ball.getX(),i=0<=e-this.playerX?10:-10,t=this.reboundDelay.update(t);this.currentMove=this.moveToo(e+i),this.currentJump=!1,"bounce"!=this.ball.state&&"shooting"!=this.ball.state&&("basket"===this.ball.state?-1===t&&this.isBallInReboundZone()?this.reboundDelay.activate():this.currentJump=1===t&&Math.random()<+this.chanceToRebound&&this.isBallInReboundZone():this.currentJump=Math.abs(this.deltaBallX())<60&&70<Math.abs(this.deltaBallY())),this.currentAction=!1},y.prototype.isBallInReboundZone=function(){return Math.abs(this.deltaBallX())<60&&70<Math.abs(this.deltaBallY())},y.prototype.strategyAttack=function(t){var e;this.player.withBall&&(1===this.megaDunkDelay.update(t)?this.currentSuper=!0:this.avoidStealJump||0!=this.avoidStealMove?(this.currentMove=this.avoidStealMove,this.currentJump=this.avoidStealJump):this.player.isGrounded?-1===this.moveDelay.update(t)&&(e=this.moveInAttack(),this.attackJump?(this.currentJump=!0,this.currentMove=e):this.isAICloserForBasket()?e===-this.SIDE?(this.currentMove=-this.SIDE,this.currentJump=!1):(this.currentMove=e,this.currentJump=!0):(this.currentJump=!1,this.currentDash=0,this.isOpponentCloseBehind()?this.isUnderOwnBasket()?this.player.readyForDash?(this.currentDash=-this.SIDE,this.currentMove=0):(Math.random()<=.5?this.currentMove=-this.SIDE:this.currentMove=0,this.moveDelay.activate()):Math.random()<=this.chanceToReactOnCloseOpponent?(this.currentJump=!1,this.player.readyForDash&&this.inDashingZone()&&Math.random()<=this.chanceToDash?this.currentDash=-this.SIDE:(Math.random()<=.5?this.currentMove=0:this.currentMove=this.SIDE,this.moveDelay.activate())):(this.currentMove=-this.SIDE,this.moveDelay.activate()):this.currentMove=-this.SIDE)):(this.currentMove=0<(this.playerX-this.attackPoint)*this.directionToFly?this.directionToFly:0,this.currentJump=!1,this.currentAction=1===this.attack.update(t)))},y.prototype.strategyJumpBall=function(t){this.currentMove=0,this.currentJump=1===this.jumpBall.update(t),this.currentAction=!1},y.prototype.strategyRebound=function(t){this.currentJump?this.currentMove=0:this.currentMove=this.player.isGrounded?this.moveToo(this.reboundPoint):0},y.prototype.deltaBallX=function(){return this.player.getX()-this.ball.getX()},y.prototype.deltaBallY=function(){return this.player.getY()-this.ball.getY()},y.prototype.isOpponentCloseBehind=function(t){void 0===t&&(t=100);var e=(this.player.getX()-this.opponent.getX())*this.SIDE;return 0<e&&e<=t},y.prototype.isOpponentInRangeBehind=function(t,e){void 0===t&&(t=40),void 0===e&&(e=180);var i=(this.player.getX()-this.opponent.getX())*this.SIDE;return 0<i&&t<=i&&i<=e},y.prototype.isOpponentCloseToBasket=function(t){void 0===t&&(t=30);var e=(this.playerX-this.opponentX)*this.SIDE;return e<0&&0<=e+t},y.prototype.isAICloserForBasket=function(){return(this.playerX-this.opponentX)*this.SIDE<0},y.prototype.isOpponentCloseAbs=function(t){return void 0===t&&(t=100),Math.abs(this.playerX-this.opponentX)<=t},y.prototype.isUnderOwnBasket=function(){return 1===this.SIDE?700<this.playerX:this.playerX<100},y);function y(t,e){var i=s.call(this,t)||this;return i.deltaDistance=20,i.chanceToBlock=1,i.downTime=5,i.superShot=e,i.superID=t.superID,i.megaDunkDelay=new h.FullDelay(.5,.5),i.gamecore=a.MainGameCore.instance,i.ball=i.gamecore.ball,i.opponents=-1===i.SIDE?i.gamecore.playersRight:i.gamecore.playersLeft,i.playerNo=t.playerNo,i.width=l.default.WIDTH,i.delta=-1===i.SIDE?0:l.default.WIDTH,i.incDownTime=l.default.STEP,_.Signals.PlayerSignal.add(i.processPlayerSignal,i),i}e.BaseAIController=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,i=i(25),r=(s=i.BaseController,r(o,s),o.prototype.update=function(){this.currentMove=0},o.prototype.readyForAction=function(){return!1},o.prototype.releaseBlockOrPump=function(){return!1},o);function o(t){return s.call(this,t)||this}e.PlayerBaseController=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0,i(6),i(0);var s,o=i(1),a=i(21),l=i(8),p=i(3),h=i(9),r=(s=Phaser.State,r(u,s),u.prototype.preload=function(){s.prototype.preload.call(this);var t=a.default.getInstance().checkDomain(document.URL.split("//")[1].split("/")[0]);-1===document.URL.indexOf("84.42.47.232")&&-1===document.URL.indexOf("192.168.10.226")&&-1===document.URL.indexOf("iriysoft.com")||(t=!0),t?this.preloadSplash():this.preloadLock()},u.prototype.init=function(){s.prototype.init.call(this),this.mainParent=this.game.add.group(),this.mainParent.x=this.game.width/2,this.mainParent.y=this.game.height/2,this.setPauseViewCar(this.mainParent)},u.prototype.preloadLock=function(){this.game.load.image(o.Images.GameLogo,"/assets/atlases/"+o.Images.GameLogo+".png")},u.prototype.preloadSplash=function(){new l.default(this.game,0,p.default.Name)},u.prototype.createLock=function(){this.logo=this.game.add.image(0,-30,o.Images.GameLogo),this.logo.anchor.set(.5),this.logo.inputEnabled=!0,this.logo.input.useHandCursor=!0,this.logo.events.onInputDown.add(this.opensitelockLink,this);var t={font:"25px Impact2",fill:"#A8DB2B"},e={font:"25px Impact2",fill:"#FFFFFF"},i=new h.default(this.game,0,-200,"This is version is url-locked",t),n=new h.default(this.game,0,-160,a.default.getInstance().getUrlLock(),e),t=new h.default(this.game,0,100,"Contact to license this game",t),e=new h.default(this.game,0,140,"madpuffers@gmail.com",e);i.anchor.set(.5),n.anchor.set(.5),t.anchor.set(.5),e.anchor.set(.5),this.mainParent.addChild(this.logo),this.mainParent.addChild(i),this.mainParent.addChild(n),this.mainParent.addChild(t),this.mainParent.addChild(e)},u.prototype.opensitelockLink=function(){window.open(a.default.getInstance().getUrlLock(),"_blank")},u.prototype.createSplash=function(){new l.default(this.game,0,p.default.Name)},u.prototype.fileComplete=function(t,e,i,n,r){100===t&&this.game.load.onFileComplete.removeAll()},u.prototype.setPauseViewCar=function(t){null!==this.bike&&this.bike.destroy(),this.bike=this.game.add.group(t),this.bike.x=0,this.bike.y=10},u.prototype.create=function(){s.prototype.create.call(this);var t=a.default.getInstance().checkDomain(document.URL.split("//")[1].split("/")[0]);-1===document.URL.indexOf("84.42.47.232")&&-1===document.URL.indexOf("192.168.10.38")&&-1===document.URL.indexOf("iriysoft.com")||(t=!0),t?this.createSplash():this.createLock()},u.prototype.resize=function(){var t=1;t=1<(t=this.game.width/o.Constants.WIDTH)?1:t,this.mainParent&&(this.mainParent.x=this.game.width/2,this.mainParent.y=this.game.height/2),s.prototype.resize.call(this)},u.prototype.shutdown=function(){s.prototype.shutdown.call(this)},u.Name="sitelock",u);function u(){var t=s.call(this)||this;return t.name=u.Name,t.bike=null,t.logo=null,t.mainParent=null,t}e.default=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(3),a=i(1),l=i(2),p=i(10),h=i(5),u=i(9),r=(s=Phaser.Group,r(c,s),c.prototype.onGameModeClick=function(t){h.default.getInstance().play(a.Sounds.button);t=parseInt(t.parent.parent.id)-1;l.Inventory.instance.matchData.matchMode=t,this.setButtonsState(t),null!==this.context&&this.context.processMatchMode()},c.prototype.updateIcon=function(t,e){for(var i=2;i<t.btn.children.length;i++){var n=t.btn.children[i];this.updateSingleIcon(n,e),1===e&&(this.btnSelect.x=t.x,this.btnSelect.y=t.y)}},c.prototype.updateSingleIcon=function(t,e){t.loadTexture(a.Atlases.Interface,"iconPl000"+e)},c.prototype.setButtonsState=function(t){0===t?(this.updateIcon(this.btn1,1),this.updateIcon(this.btn2,0),this.updateIcon(this.btn3,0),4===l.Inventory.instance.gameMode&&(this.cpu.visible=!0,this.cpu2.visible=!1)):1===t?(this.updateIcon(this.btn1,0),this.updateIcon(this.btn2,1),this.updateIcon(this.btn3,0),4===l.Inventory.instance.gameMode&&(this.cpu.visible=!0,this.cpu2.visible=!1)):2===t&&(this.updateIcon(this.btn1,0),this.updateIcon(this.btn2,0),this.updateIcon(this.btn3,1),4===l.Inventory.instance.gameMode&&(this.cpu.visible=!1,this.cpu2.visible=!0))},c.prototype.hideBG=function(){this.bg.visible=!1,this.ccc.visible=!1},c.prototype.showCurrentMode=function(){(this.btn1.y=this.btn2.y=this.btn3.y=this.btnSelect.y=0)===l.Inventory.instance.matchData.matchMode?(this.btn1.visible=!0,this.btn2.visible=!1,this.btn3.visible=!1):1===l.Inventory.instance.matchData.matchMode?(this.btn1.visible=!1,this.btn2.visible=!0,this.btn3.visible=!1):2===l.Inventory.instance.matchData.matchMode&&(this.btn1.visible=!1,this.btn2.visible=!1,this.btn3.visible=!0)},c.prototype.destroy=function(){this.btn1=null,this.btn2=null,this.btn3=null,this.context=null,s.prototype.destroy.call(this)},c);function c(t){var e=s.call(this,o.default.game)||this;e.context=null,e.context=t,e.bg=e.game.add.sprite(0,0,a.Atlases.Interface,"0bg130000"),e.bg.anchor.set(.5),e.addChild(e.bg);e.ccc=new u.default(e.game,0,-90,"MODE",{font:"bold 42px Impact2",fill:"#FFFFFF"}),e.ccc.anchor.set(.5),e.addChild(e.ccc),e.btn1=new p.default(e.game,"VS",a.Constants.styleVS,e.onGameModeClick,e,a.Atlases.Interface),e.btn2=new p.default(e.game,"VS",a.Constants.styleVS,e.onGameModeClick,e,a.Atlases.Interface),e.btn3=new p.default(e.game,"VS",a.Constants.styleVS,e.onGameModeClick,e,a.Atlases.Interface),e.btnSelect=new p.default(e.game,"VS",a.Constants.styleVS2,null,null,a.Atlases.Interface),e.btn1.y=-30,e.btn2.y=30,e.btn3.y=90,e.btn1.btn.id="1",e.btn2.btn.id="2",e.btn3.btn.id="3",e.btn1.setFrames("bg0000","bg0000","bg0000","bg0000"),e.btn2.setFrames("bg0000","bg0000","bg0000","bg0000"),e.btn3.setFrames("bg0000","bg0000","bg0000","bg0000"),e.btnSelect.setFrames("selectModeBg0000","selectModeBg0000","selectModeBg0000","selectModeBg0000"),e.addChild(e.btn1),e.addChild(e.btn2),e.addChild(e.btn3),e.addChild(e.btnSelect);t=e.game.add.image(-47,0,a.Atlases.Interface,"iconPl0000");return t.anchor.set(.5),e.btn1.btn.addChild(t),(t=e.game.add.image(47,0,a.Atlases.Interface,"iconPl0000")).anchor.set(.5),e.btn1.btn.addChild(t),(t=e.game.add.image(-55,-2,a.Atlases.Interface,"iconPl0000")).anchor.set(.5),e.btn2.btn.addChild(t),(t=e.game.add.image(-35,2,a.Atlases.Interface,"iconPl0000")).anchor.set(.5),e.btn2.btn.addChild(t),(t=e.game.add.image(55,-2,a.Atlases.Interface,"iconPl0000")).anchor.set(.5),e.btn2.btn.addChild(t),(t=e.game.add.image(35,2,a.Atlases.Interface,"iconPl0000")).anchor.set(.5),e.btn2.btn.addChild(t),(t=e.game.add.image(55,-2,a.Atlases.Interface,"iconPl0000")).anchor.set(.5),e.btn3.btn.addChild(t),(t=e.game.add.image(35,2,a.Atlases.Interface,"iconPl0000")).anchor.set(.5),e.btn3.btn.addChild(t),4!==l.Inventory.instance.gameMode?((t=e.game.add.image(-45,0,a.Atlases.Interface,"iconPl0000")).anchor.set(.5),e.btn3.btn.addChild(t),e.btn3.visible=!1):((t=e.game.add.image(-55,-2,a.Atlases.Interface,"iconPl0000")).anchor.set(.5),e.btn3.btn.addChild(t),(t=e.game.add.image(-35,2,a.Atlases.Interface,"iconPl0000")).anchor.set(.5),e.btn3.btn.addChild(t),e.cpu=new p.default(e.game,"CPU",a.Constants.styleCPU,null,null,a.Atlases.Interface),e.cpu.x=60,e.cpu.y=15,e.cpu.setFrames("bg0000","bg0000","bg0000","bg0000"),e.btn3.addChild(e.cpu),e.cpu2=new p.default(e.game,"CPU",a.Constants.styleCPU2,null,null,a.Atlases.Interface),e.cpu2.x=60,e.cpu2.y=15,e.cpu2.setFrames("bg0000","bg0000","bg0000","bg0000"),e.btn3.addChild(e.cpu2),e.cpu2.visible=!1),e.setButtonsState(l.Inventory.instance.matchData.matchMode),e.btn1.btn.dynamicScaleDown=1,e.btn1.btn.dynamicScaleUp=1,e.btn2.btn.dynamicScaleDown=1,e.btn2.btn.dynamicScaleUp=1,e.btn3.btn.dynamicScaleDown=1,e.btn3.btn.dynamicScaleUp=1,e.btn1.btn.btn.scale.set(13,5),e.btn2.btn.btn.scale.set(14,5),e.btn3.btn.btn.scale.set(14,5),e}e.MatchModePanel=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0,i(6),i(0);var s,o=i(5),a=i(1),l=i(7),p=i(17),h=i(8),u=i(2),c=i(11),d=i(10),_=i(12),y=i(26),f=i(103),m=i(21),x=i(53),v=i(4),g=i(0),b=i(34),r=(s=Phaser.State,r(z,s),z.prototype.init=function(){this.game.world.removeAll(),this.manager=u.Inventory.instance},z.prototype.create=function(){s.prototype.create.call(this),u.PlayersData.initDragonbones(),this.backgroundBase=this.game.add.sprite(0,0,a.Atlases.Interface,h.default.getBG()),this.backgroundBase2=this.game.add.sprite(299,0,a.Atlases.Interface,"bg0000"),this.backgroundBase.addChild(this.backgroundBase2),this.backgroundBaseMask=this.game.add.graphics(0,0),this.backgroundBaseMask.beginFill(65280,0),this.backgroundBaseMask.drawRect(0,0,1398,480),this.backgroundBaseMask.endFill(),this.armatureDisplay=dragonBones.PhaserFactory.factory.buildArmatureDisplay("player"),this.armatureDisplay.animation.play("idle",0),this.armatureDisplay2=dragonBones.PhaserFactory.factory.buildArmatureDisplay("player"),this.armatureDisplay2.animation.play("idle",0),this.logo=this.game.add.sprite(400,100,a.Atlases.Interface,"bg0000"),this.logo.anchor.set(.5),this.logo.x=400,this.backgroundBase2.addChild(this.logo),this.backBtn=new d.default(this.game,"RESTART",a.Constants.styleBackArrow,this.onBack,this,a.Atlases.Interface),this.backBtn.setFrames("bg0000","bg0000","bg0000","bg0000"),this.backBtn.x=130,this.backBtn.y=450,this.backgroundBase2.addChild(this.backBtn);0===u.Inventory.instance.gameMode&&(t=this.manager.nextLeg(),u.Inventory.instance.statsMgr.getTotalScores()),this.setUp(),3===u.Inventory.instance.gameMode||2===u.Inventory.instance.gameMode?this.nextState=_.Menu.Name:0===u.Inventory.instance.gameMode?!0===t[0]?this.nextState=("Standings"===t[1]?_.TournamentState:x.default).Name:this.nextState=x.default.Name:this.nextState=y.default.Name,this.musicBtn=new l.default(this.game,"",{},this.toggleMusic,this,a.Atlases.Gameplay),this.musicBtn.setFrames("btn_bg0000","btn_bg0000","btn_bg0000","btn_bg0000"),this.musicBtn.sScale=42/this.musicBtn.btn.width,this.musicBtn.x=772,this.musicBtn.y=25,this.musicBtn.labelState=this.game.add.image(0,0,a.Atlases.Gameplay,"InGameMusicButton0000"),this.backgroundBase2.addChild(this.musicBtn),this.updateSoundButtons(),this.playBtn=new d.default(this.game,"NEXT",a.Constants.stylePlayGreen,this.onNextState,this,a.Atlases.Interface),this.playBtn.setFrames("arrow20000","arrow20000","arrow20000","arrow20000"),this.playBtn.btn.btn.x=110,this.playBtn.x=655,this.playBtn.y=450;var t=this.game.add.image(0,0,a.Atlases.Interface,"bg0000");t.anchor.set(.5),t.x=-80,t.height=58,t.width=200,this.playBtn.btn.btn.addChildAt(t,0),this.backgroundBase2.addChild(this.playBtn),this.resize(),new p.default(this.game,this,this.show)},z.prototype.show=function(){var t=this.game.add.tween(this.scoreLabel);t.from({y:520},v.default.PRELOADER_TIME,g.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.scoreText)).from({y:520},v.default.PRELOADER_TIME,g.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.scoreBestLabel)).from({y:520},v.default.PRELOADER_TIME,g.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.scoreBestText)).from({y:520},v.default.PRELOADER_TIME,g.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.playBtn)).from({y:520},v.default.PRELOADER_TIME,g.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.backBtn)).from({y:520},v.default.PRELOADER_TIME,g.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.panel.score)).from({y:-220},v.default.PRELOADER_TIME,g.Easing.Back.Out),t.start(),(t=this.panel.title?this.game.add.tween(this.panel.title):this.game.add.tween(this.panel.title_state)).from({y:-220},v.default.PRELOADER_TIME,g.Easing.Back.Out,!1,100),t.start(),(t=this.game.add.tween(this.panel.ccc)).from({x:-600},v.default.PRELOADER_TIME,g.Easing.Back.Out,!1,100),t.start(),(t=this.game.add.tween(this.panel.team1)).from({x:-550},v.default.PRELOADER_TIME,g.Easing.Back.Out,!1,100),t.start(),(t=this.game.add.tween(this.player1)).from({x:-550},v.default.PRELOADER_TIME,g.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.panel.ccc2)).from({x:600},v.default.PRELOADER_TIME,g.Easing.Back.Out,!1,100),t.start(),(t=this.game.add.tween(this.panel.team2)).from({x:550},v.default.PRELOADER_TIME,g.Easing.Back.Out,!1,100),t.start(),(t=this.game.add.tween(this.player2)).from({x:880},v.default.PRELOADER_TIME,g.Easing.Back.Out),t.start()},z.prototype.hide=function(){var t=this.game.add.tween(this.scoreLabel);t.to({y:520},v.default.PRELOADER_TIME,g.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.scoreText)).to({y:520},v.default.PRELOADER_TIME,g.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.scoreBestLabel)).to({y:520},v.default.PRELOADER_TIME,g.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.scoreBestText)).to({y:520},v.default.PRELOADER_TIME,g.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.playBtn)).to({y:520},v.default.PRELOADER_TIME,g.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.backBtn)).to({y:520},v.default.PRELOADER_TIME,g.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.panel.score)).to({y:-220},v.default.PRELOADER_TIME,g.Easing.Linear.None),t.start(),(t=this.panel.title?this.game.add.tween(this.panel.title):this.game.add.tween(this.panel.title_state)).to({y:-220},v.default.PRELOADER_TIME,g.Easing.Linear.None,!1,100),t.start(),(t=this.game.add.tween(this.panel.ccc)).to({x:-600},v.default.PRELOADER_TIME,g.Easing.Linear.None,!1,100),t.start(),(t=this.game.add.tween(this.panel.team1)).to({x:-550},v.default.PRELOADER_TIME,g.Easing.Linear.None,!1,100),t.start(),(t=this.game.add.tween(this.player1)).to({x:-550},v.default.PRELOADER_TIME,g.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.panel.ccc2)).to({x:600},v.default.PRELOADER_TIME,g.Easing.Linear.None,!1,100),t.start(),(t=this.game.add.tween(this.panel.team2)).to({x:550},v.default.PRELOADER_TIME,g.Easing.Linear.None,!1,100),t.start(),(t=this.game.add.tween(this.player2)).to({x:880},v.default.PRELOADER_TIME,g.Easing.Linear.None),t.start()},z.prototype.render=function(){dragonBones.PhaserFactory.factory.dragonBones.advanceTime(-1),s.prototype.render.call(this)},z.prototype.setUp=function(){u.PlayersData.switchPlayer(this.armatureDisplay.armature,u.PlayersData.TEAM_SIZE*(u.Inventory.instance.matchData.teams[0]-1)+u.Inventory.instance.matchData.players[0][0],2*u.Inventory.instance.matchData.teams[0]-2),u.PlayersData.switchPlayer(this.armatureDisplay2.armature,u.PlayersData.TEAM_SIZE*(u.Inventory.instance.matchData.teams[1]-1)+u.Inventory.instance.matchData.players[1][0],2*u.Inventory.instance.matchData.teams[1]-2+1);var t=u.Inventory.instance.matchData.matchScore[0],e=u.Inventory.instance.matchData.matchScore[1];this.panel=new f.PreMatchPanelResult(2),e<t?(this.armatureDisplay.armature.animation.play("happiness",-1),this.armatureDisplay2.armature.animation.play("sad",-1)):(this.armatureDisplay.armature.animation.play("sad",-1),this.armatureDisplay2.armature.animation.play("happiness",-1)),this.player1=this.game.add.group(),this.player1.x=216,this.player1.y=388,this.player2=this.game.add.group(),this.player2.x=584,this.player2.y=388;t=this.game.add.sprite(0,0,a.Atlases.Gameplay,"ShadowMC0002");t.scale.set(2.5),t.anchor.set(.5),this.player1.addChild(t),(t=this.game.add.sprite(0,0,a.Atlases.Gameplay,"ShadowMC0002")).scale.set(2.5),t.anchor.set(.5),this.player2.addChild(t),this.player1.addChild(this.armatureDisplay.armature.display),this.player2.addChild(this.armatureDisplay2.armature.display),this.player1.scale.set(.9),this.player2.scale.set(-.9,.9),this.backgroundBase2.addChild(this.player1),this.backgroundBase2.addChild(this.player2),this.logo.addChild(this.panel),this.scoreLabel=new d.default(this.game,"SCORE:",a.Constants.styleIDnetScore,null,null,a.Atlases.Interface),this.scoreLabel.setFrames("bg0000","bg0000","bg0000","bg0000"),this.scoreLabel.x=250,this.scoreLabel.y=460,this.backgroundBase2.addChild(this.scoreLabel),this.scoreBestLabel=new d.default(this.game,"BEST SCORE:",a.Constants.styleIDnetBestScore,null,null,a.Atlases.Interface),this.scoreBestLabel.setFrames("bg0000","bg0000","bg0000","bg0000"),this.scoreBestLabel.x=460,this.scoreBestLabel.y=460,this.backgroundBase2.addChild(this.scoreBestLabel),this.scoreText=new d.default(this.game,"",a.Constants.styleIDnetScore2,null,null,a.Atlases.Interface),this.scoreText.setFrames("bg0000","bg0000","bg0000","bg0000"),this.scoreText.x=310,this.scoreText.y=460,this.backgroundBase2.addChild(this.scoreText),this.scoreBestText=new d.default(this.game,"",a.Constants.styleIDnetBestScore2,null,null,a.Atlases.Interface),this.scoreBestText.setFrames("bg0000","bg0000","bg0000","bg0000"),this.scoreBestText.x=540,this.scoreBestText.y=460,this.backgroundBase2.addChild(this.scoreBestText),3===u.Inventory.instance.gameMode||2===u.Inventory.instance.gameMode?(this.scoreLabel.visible=!1,this.scoreText.visible=!1,this.scoreBestLabel.visible=!1,this.scoreBestText.visible=!1):(this.backBtn.visible=!1,0===u.Inventory.instance.gameMode?(this.scoreText.setText(u.Inventory.instance.getMatchScores()+""),this.scoreBestText.setText(u.Inventory.instance.getTournamentScores()+"")):(this.scoreLabel.visible=!1,this.scoreText.visible=!1,this.scoreBestLabel.visible=!1,this.scoreBestText.visible=!1))},z.prototype.onOk=function(){u.Inventory.instance.checkForumAchievement(),window.open("https://forum.y8.com/t/basketball-legends/1741","_blank")},z.prototype.onMoreGames=function(){window.open(m.default.getInstance().getUrl(m.default.Current),"_blank")},z.prototype.onScoreList=function(){o.default.getInstance().play(a.Sounds.Click)},z.prototype.toggleMusic=function(){c.default.getInstance().music?o.default.getInstance().toggleMusic():c.default.getInstance().sfx?o.default.getInstance().toggleSfx():(o.default.getInstance().toggleSfx(),o.default.getInstance().toggleMusic()),this.updateSoundButtons(),o.default.getInstance().play(a.Sounds.Click)},z.prototype.updateSoundButtons=function(){var t=c.default.getInstance().music?0:1;t+=c.default.getInstance().sfx?0:1,this.musicBtn.labelState.loadTexture(a.Atlases.Gameplay,"InGameMusicButton000"+t)},z.prototype.onBack=function(){o.default.getInstance().play(a.Sounds.Click),u.Inventory.instance.matchData.resetScore(),new h.default(this.game,this,_.Gameplay.Name)},z.prototype.onNextState=function(){o.default.getInstance().play(a.Sounds.Click),b.default.getInstance().displayInterstitial(this.fadeToNextState,this)},z.prototype.fadeToNextState=function(){new h.default(this.game,this,this.nextState)},z.prototype.resize=function(){s.prototype.resize.call(this);var t=1;t=1<(t=this.game.width/a.Constants.WIDTH)?1:t,t*=1.33333,this.backgroundBase.scale.set(t),this.backgroundBase.alignIn(this.world.bounds,Phaser.TOP_CENTER),this.backgroundBaseMask.scale.set(t,t),this.backgroundBaseMask.x=this.backgroundBase.x,this.backgroundBaseMask.y=this.backgroundBase.y},z.prototype.shutdown=function(){this.backgroundBase2=null,this.backgroundBaseMask=null,this.backBtn=null,this.playBtn=null,this.musicBtn=null,this.armatureDisplay=null,this.armatureDisplay2=null,s.prototype.shutdown.call(this)},z.Name="postmatchstate",z);function z(){var t=s.call(this)||this;return t.name=z.Name,t.player1=null,t.player2=null,t.armatureDisplay=null,t.armatureDisplay2=null,t._armatureDisplay=null,t._armatureDisplay2=null,t.manager=null,t}e.default=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0,i(6),i(0);var s,o=i(5),a=i(1),l=i(7),p=i(17),h=i(8),u=i(2),c=i(11),d=i(10),_=i(18),y=i(0),f=i(4),r=(s=Phaser.State,r(m,s),m.prototype.init=function(){this.game.world.removeAll(),this.manager=u.Inventory.instance},m.prototype.create=function(){s.prototype.create.call(this),this.background=this.game.add.sprite(0,0,a.Atlases.Interface,"bg0000"),this.backgroundBase=this.game.add.sprite(0,0,a.Atlases.Interface,h.default.getBG()),this.backgroundBase2=this.game.add.sprite(299,0,a.Atlases.Interface,"bg0000"),this.backgroundBase.addChild(this.backgroundBase2),this.backgroundBaseMask=this.game.add.graphics(0,0),this.backgroundBaseMask.beginFill(65280,0),this.backgroundBaseMask.drawRect(0,0,1398,480),this.backgroundBaseMask.endFill(),this.background4=this.game.add.sprite(200,240,a.Atlases.Interface,"bg0000"),this.background4.anchor.set(.5),this._armatureDisplay=dragonBones.PhaserFactory.factory.buildArmatureDisplay("player"),this._armatureDisplay.x=-50,this._armatureDisplay.y=60,this._armatureDisplay.animation.play("idle",0),this._armatureDisplay2=dragonBones.PhaserFactory.factory.buildArmatureDisplay("player"),this._armatureDisplay2.x=50,this._armatureDisplay2.y=60,this._armatureDisplay2.animation.play("idle",0),this._armatureDisplay3=dragonBones.PhaserFactory.factory.buildArmatureDisplay("player"),this._armatureDisplay3.x=-50,this._armatureDisplay3.y=60,this._armatureDisplay3.animation.play("idle",0),this._armatureDisplay4=dragonBones.PhaserFactory.factory.buildArmatureDisplay("player"),this._armatureDisplay4.x=50,this._armatureDisplay4.y=60,this._armatureDisplay4.animation.play("idle",0),this._armatureDisplay4.visible=!1,this.world.addChild(this._armatureDisplay),this.world.addChild(this._armatureDisplay2),this.world.addChild(this._armatureDisplay3),this.world.addChild(this._armatureDisplay4),this.musicBtn=new l.default(this.game,"",{},this.toggleMusic,this,a.Atlases.Gameplay),this.musicBtn.setFrames("btn_bg0000","btn_bg0000","btn_bg0000","btn_bg0000"),this.musicBtn.sScale=42/this.musicBtn.btn.width,this.musicBtn.x=772,this.musicBtn.y=25,this.musicBtn.labelState=this.game.add.image(0,0,a.Atlases.Gameplay,"InGameMusicButton0000"),this.backgroundBase2.addChild(this.musicBtn),this.backgroundBase2.addChild(this.background4),this.updateSoundButtons(),this.logo=this.game.add.sprite(400,35,a.Atlases.Interface,"bg0000"),this.logo.anchor.set(.5),this.backgroundBase2.addChild(this.logo),this.playBtn=new d.default(this.game,"MENU",a.Constants.stylePlayGreen,this.onPlay,this,a.Atlases.Interface),this.playBtn.setFrames("bg0000","bg0000","bg0000","bg0000"),this.playBtn.x=720,this.playBtn.y=447,this.background4.addChild(this.playBtn),this.backgroundBase2.addChild(this.playBtn),this.setUp(),this.manager.breakTournament(),this.resize(),new p.default(this.game,this,this.show)},m.prototype.show=function(){var t=this.game.add.tween(this.place1);t.from({y:-60},f.default.PRELOADER_TIME,y.Easing.Back.Out,!1,50),t.start(),(t=this.game.add.tween(this.place2)).from({y:-60},f.default.PRELOADER_TIME,y.Easing.Back.Out,!1,50),t.start(),(t=this.game.add.tween(this.place3)).from({y:-60},f.default.PRELOADER_TIME,y.Easing.Back.Out,!1,50),t.start(),(t=this.game.add.tween(this.logo)).from({y:-100},f.default.PRELOADER_TIME,y.Easing.Back.Out,!1,100),t.start(),(t=this.game.add.tween(this.tribune)).from({y:800},f.default.PRELOADER_TIME,y.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.scoreLabel)).from({y:520},f.default.PRELOADER_TIME,y.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.scoreText)).from({y:520},f.default.PRELOADER_TIME,y.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.scoreBestLabel)).from({y:520},f.default.PRELOADER_TIME,y.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.scoreTotalText)).from({y:520},f.default.PRELOADER_TIME,y.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.playBtn)).from({y:520},f.default.PRELOADER_TIME,y.Easing.Back.Out),t.start(),this.player4&&((t=this.game.add.tween(this.place4)).from({x:900},f.default.PRELOADER_TIME,y.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.tribune4)).from({x:900},f.default.PRELOADER_TIME,y.Easing.Back.Out),t.start())},m.prototype.hide=function(){var t=this.game.add.tween(this.place1);t.to({y:-60},f.default.PRELOADER_TIME,y.Easing.Linear.None,!1,50),t.start(),(t=this.game.add.tween(this.place2)).to({y:-60},f.default.PRELOADER_TIME,y.Easing.Linear.None,!1,50),t.start(),(t=this.game.add.tween(this.place3)).to({y:-60},f.default.PRELOADER_TIME,y.Easing.Linear.None,!1,50),t.start(),(t=this.game.add.tween(this.logo)).to({y:-100},f.default.PRELOADER_TIME,y.Easing.Linear.None,!1,100),t.start(),(t=this.game.add.tween(this.tribune)).to({y:800},f.default.PRELOADER_TIME,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.scoreLabel)).to({y:520},f.default.PRELOADER_TIME,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.scoreText)).to({y:520},f.default.PRELOADER_TIME,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.scoreBestLabel)).to({y:520},f.default.PRELOADER_TIME,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.scoreTotalText)).to({y:520},f.default.PRELOADER_TIME,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.playBtn)).to({y:520},f.default.PRELOADER_TIME,y.Easing.Linear.None),t.start(),this.player4&&((t=this.game.add.tween(this.place4)).to({x:900},f.default.PRELOADER_TIME,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.tribune4)).to({x:900},f.default.PRELOADER_TIME,y.Easing.Linear.None),t.start())},m.prototype.onScoreList=function(){o.default.getInstance().play(a.Sounds.Click)},m.prototype.setUp=function(){this.tribune=new Phaser.Sprite(this.game,400,448,a.Atlases.Interface,"TribuneFinal0000"),this.tribune.anchor.set(.58,1.2),this.tribune4=new Phaser.Sprite(this.game,716,380,a.Atlases.Interface,"bg0000"),this.tribune4.anchor.set(.5),this.player1=new Phaser.Group(this.game),this.player1.x=40,this.player1.y=-168,this.player2=new Phaser.Group(this.game),this.player2.x=-147,this.player2.y=-155,this.player3=new Phaser.Group(this.game),this.player3.x=147,this.player3.y=-146,this.player1.scale.set(.8),this.player2.scale.set(.8),this.player3.scale.set(.8),this.backgroundBase2.addChild(this.tribune),this.backgroundBase2.addChild(this.tribune4),this.tribune.addChild(this.player3),this.tribune.addChild(this.player1),this.tribune.addChild(this.player2);this.manager.rounds;var t=this.manager.tournament.getFinalistsArray(),e=u.Inventory.instance.matchData.teams[0],i=u.Inventory.instance.matchData.players[0][0]+1,n="",r=t.pop();1===r?(u.PlayersData.switchPlayer(this._armatureDisplay.armature,u.PlayersData.TEAM_SIZE*(e-1)+(i-1),2*e-2),this._armatureDisplay.armature.animation.play("happiness"),this.thePlayer=this._armatureDisplay.armature,this.frame="cup1",n="1st PLACE!!!"):(u.PlayersData.switchPlayer(this._armatureDisplay.armature,u.PlayersData.TEAM_SIZE*(t[0]-1),2*t[0]-2),this._armatureDisplay.armature.animation.gotoAndPlay("idle")),2===r?(u.PlayersData.switchPlayer(this._armatureDisplay2.armature,u.PlayersData.TEAM_SIZE*(e-1)+(i-1),2*e-2),this._armatureDisplay2.armature.animation.gotoAndPlay("happiness"),this.thePlayer=this._armatureDisplay2.armature,this.frame="cup2",n="2nd PLACE!!!"):(u.PlayersData.switchPlayer(this._armatureDisplay2.armature,u.PlayersData.TEAM_SIZE*(t[1]-1),2*t[1]-2),this._armatureDisplay2.armature.animation.gotoAndPlay("idle")),3===r?(u.PlayersData.switchPlayer(this._armatureDisplay3.armature,u.PlayersData.TEAM_SIZE*(e-1)+(i-1),2*e-2),this._armatureDisplay3.armature.animation.gotoAndPlay("happiness"),this.thePlayer=this._armatureDisplay3.armature,this.frame="cup3",n="3d PLACE!!!"):(u.PlayersData.switchPlayer(this._armatureDisplay3.armature,u.PlayersData.TEAM_SIZE*(t[2]-1),2*t[2]-2),this._armatureDisplay3.armature.animation.gotoAndPlay("idle")),4<=r&&(n=4===r?"4th PLACE":"YOU LOST");var s=new d.default(this.game,n,a.Constants.styleTitleFinalTournamet,null,null,a.Atlases.Interface);s.setFrames("bg0000","bg0000","bg0000","bg0000"),this.logo.addChild(s),this.player1.addChild(this._armatureDisplay.armature.display),this.player2.addChild(this._armatureDisplay2.armature.display),this.player3.addChild(this._armatureDisplay3.armature.display),this.place1=this.game.add.sprite(400,90,a.Atlases.Interface,"EmblemsBg0000"),this.place2=this.game.add.sprite(294,90,a.Atlases.Interface,"EmblemsBg0000"),this.place3=this.game.add.sprite(506,90,a.Atlases.Interface,"EmblemsBg0000"),this.place1.anchor.set(.5),this.place2.anchor.set(.5),this.place3.anchor.set(.5),this.place1.scale.set(.4),this.place2.scale.set(.4),this.place3.scale.set(.4),this.backgroundBase2.addChild(this.place1),this.backgroundBase2.addChild(this.place2),this.backgroundBase2.addChild(this.place3);var o=this.game.add.image(0,0),n=this.game.add.image(0,0),s=this.game.add.image(0,0);this.place1.addChild(o),this.place2.addChild(n),this.place3.addChild(s),o.loadTexture(a.Atlases.Interface,"Emblems00"+(t[0]-1<10?"0":"")+(t[0]-1)),n.loadTexture(a.Atlases.Interface,"Emblems00"+(t[1]-1<10?"0":"")+(t[1]-1)),s.loadTexture(a.Atlases.Interface,"Emblems00"+(t[2]-1<10?"0":"")+(t[2]-1)),o.anchor.set(.5),o.scale.set(.8),n.anchor.set(.5),n.scale.set(.8),s.anchor.set(.5),s.scale.set(.8),r<=3?(this.tribune4.visible=!1,this.thePlayer.getBone("effects stun").slot.childArmature.animation.gotoAndStop(this.frame,.1)):(this.place4=this.game.add.sprite(716,140,a.Atlases.Interface,"EmblemsBg0000"),this.place4.scale.set(.4),this.place4.anchor.set(.5),this.backgroundBase2.addChild(this.place4),(r=this.game.add.image(0,0,a.Atlases.Interface,"Emblems00"+(e-1<10?"0":"")+(e-1))).anchor.set(.5),r.scale.set(.8),this.place4.addChild(r),this.player4=new Phaser.Group(this.game),this.player4.x=40,this.player4.y=-72,this.player4.scale.set(-.8,.8),(r=new Phaser.Image(this.game,0,-23,a.Atlases.Gameplay,"ShadowMC0002")).anchor.set(.5),r.scale.set(1.8),this.tribune4.addChild(r),this.tribune4.addChild(this.player4),this._armatureDisplay4.visible=!0,u.PlayersData.switchPlayer(this._armatureDisplay4.armature,u.PlayersData.TEAM_SIZE*(e-1)+(i-1),2*e-2),this._armatureDisplay4.armature.animation.play("sad",-1),this.player4.addChild(this._armatureDisplay4.armature.display)),this.scoreLabel=new d.default(this.game,"SCORE:",a.Constants.styleIDnetScore,null,null,a.Atlases.Interface),this.scoreLabel.setFrames("bg0000","bg0000","bg0000","bg0000"),this.scoreLabel.x=250,this.scoreLabel.y=460,this.backgroundBase2.addChild(this.scoreLabel),this.scoreBestLabel=new d.default(this.game,"TOTAL SCORE:",a.Constants.styleIDnetBestScore,null,null,a.Atlases.Interface),this.scoreBestLabel.setFrames("bg0000","bg0000","bg0000","bg0000"),this.scoreBestLabel.x=460,this.scoreBestLabel.y=460,this.backgroundBase2.addChild(this.scoreBestLabel),this.scoreText=new d.default(this.game,"",a.Constants.styleIDnetScore2,null,null,a.Atlases.Interface),this.scoreText.setFrames("bg0000","bg0000","bg0000","bg0000"),this.scoreText.x=330,this.scoreText.y=460,this.backgroundBase2.addChild(this.scoreText),this.scoreTotalText=new d.default(this.game,"",a.Constants.styleIDnetBestScore2,null,null,a.Atlases.Interface),this.scoreTotalText.setFrames("bg0000","bg0000","bg0000","bg0000"),this.scoreTotalText.x=570,this.scoreTotalText.y=460,this.backgroundBase2.addChild(this.scoreTotalText),this.scoreText.setText(this.manager.getTournamentScores().toString()),this.scoreTotalText.setText(this.manager.getTotalScores().toString())},m.prototype.render=function(){dragonBones.PhaserFactory.factory.dragonBones.advanceTime(-1),s.prototype.render.call(this)},m.prototype.toggleMusic=function(){c.default.getInstance().music?o.default.getInstance().toggleMusic():c.default.getInstance().sfx?o.default.getInstance().toggleSfx():(o.default.getInstance().toggleSfx(),o.default.getInstance().toggleMusic()),this.updateSoundButtons(),o.default.getInstance().play(a.Sounds.Click)},m.prototype.updateSoundButtons=function(){var t=c.default.getInstance().music?0:1;t+=c.default.getInstance().sfx?0:1,this.musicBtn.labelState.loadTexture(a.Atlases.Gameplay,"InGameMusicButton000"+t)},m.prototype.onPlay=function(){o.default.getInstance().play(a.Sounds.Click),u.Inventory.instance.clearTournamentData(),new h.default(this.game,this,_.default.Name)},m.prototype.resize=function(){var t=1;t=1<(t=this.game.width/a.Constants.WIDTH)?1:t,t*=1.33333,this.backgroundBase.scale.set(t),this.backgroundBase.alignIn(this.world.bounds,Phaser.TOP_CENTER),this.backgroundBaseMask.scale.set(t,t),this.backgroundBaseMask.x=this.backgroundBase.x,this.backgroundBaseMask.y=this.backgroundBase.y,s.prototype.resize.call(this)},m.prototype.shutdown=function(){this.backgroundBase2=null,this.backgroundBaseMask=null,this.playBtn=null,this.musicBtn=null,this._armatureDisplay=null,this._armatureDisplay2=null,s.prototype.shutdown.call(this)},m.Name="finaltournamentstate",m);function m(){var t=s.call(this)||this;return t.name=m.Name,t._armatureDisplay=null,t._armatureDisplay2=null,t._armatureDisplay3=null,t._armatureDisplay4=null,t.thePlayer=null,t.player1=null,t.player2=null,t.player3=null,t.player4=null,t.tribune=null,t.tribune4=null,t.place1=null,t.place2=null,t.place3=null,t.place4=null,t.manager=null,t.frame="",t.texts=["1st place!!!","2nd place!!!","3rd place!!!","4th place","You lost"],t}e.default=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0,i(55),i(6),i(0);var s,o,a=i(60),l=i(12),p=i(3),h=i(50),u=i(18),c=i(52),d=i(53),_=i(31),y=i(4),f=i(34);function m(){var e=o.call(this,{enableDebug:!1,width:1066,height:640,renderer:Phaser.WEBGL,parent:"content",transparent:!0,antialias:!0,preserveDrawingBuffer:!1,physicsConfig:null,seed:"",state:null,forceSetTimeOut:!1})||this;return e.clearBeforeRender=!1,Phaser.Device.whenReady(function(){y.default.isDesktop=e.device.desktop,e._isPad()&&(y.default.isDesktop=!1),e.stage.disableVisibilityChange=!0;var t=y.default.isDesktop?"click":"touchstart";document.getElementById("content").addEventListener(t,function(t){e.gameResumed(t),window.focus()}),f.default.getInstance().init(e),document.getElementById("content").addEventListener("START",function(t){e.adsResume()}),document.getElementById("content").addEventListener("PAUSE",function(t){e.adsPause()})}),e.state.add("game",{create:e.stateCreator.bind(e),preload:e.statePreloader.bind(e)},!0),e}i=s=s||{},o=Phaser.Game,r(m,o),m.prototype._isPad=function(){var t=-1!==navigator.userAgent.toLowerCase().indexOf("ipad");return!!(!t&&navigator.userAgent.match(/Mac/)&&navigator.maxTouchPoints&&2<navigator.maxTouchPoints)||t},m.prototype.statePreloader=function(){},m.prototype.stateCreator=function(){var t=this;this.plugins.add(PhaserSuperStorage.StoragePlugin),this.plugins.add(PhaserCachebuster.CacheBuster),this.storage.forcePromises=!0,this.state.add(l.Boot.Name,l.Boot,!1),this.state.add(p.default.Name,p.default,!1),this.state.add(h.default.Name,h.default,!1),this.state.add(l.RandomState.Name,l.RandomState,!1),this.state.add(l.TournamentState.Name,l.TournamentState,!1),this.state.add(c.default.Name,c.default,!1),this.state.add(d.default.Name,d.default,!1),this.state.add(u.default.Name,u.default,!1),this.state.add(l.Menu.Name,l.Menu,!1),this.state.add(l.Gameplay.Name,l.Gameplay,!1);function e(){t.recursiveUpdateText(t.stage)}this.state.start(l.Boot.Name),this.state.remove("game")},m.prototype.recursiveUpdateText=function(t){var e=this;t instanceof Phaser.Text&&(t.dirty=!0),t.children&&0<t.children.length&&t.children.forEach(function(t){e.recursiveUpdateText(t)})},m.prototype.adsResume=function(){this.sound.mute=!1,l.Gameplay.isAdsPause=!1,window.focus()},m.prototype.adsPause=function(){this.sound.mute=!0,l.Gameplay.isAdsPause=!0,_.default.instance.signalPause&&_.default.instance.signalPause.dispatch()},r=m,i.Game=r,new s.Game},function(e,t,i){(function(t){e.exports=t.p2=i(56)}).call(t,i(27))},function(t,e,i){t.exports=function n(r,s,o){function a(e,t){if(!s[e]){if(!r[e]){if(0,l)return l(e,!0);throw new Error("Cannot find module '"+e+"'")}var i=s[e]={exports:{}};r[e][0].call(i.exports,function(t){return a(r[e][1][t]||t)},i,i.exports,n,r,s,o)}return s[e].exports}for(var l=!1,t=0;t<o.length;t++)a(o[t]);return a}({1:[function(t,e,i){function n(){}var p=t("./Scalar");(e.exports=n).lineInt=function(t,e,i){i=i||0;var n=[0,0],r=t[1][1]-t[0][1],s=t[0][0]-t[1][0],o=r*t[0][0]+s*t[0][1],a=e[1][1]-e[0][1],l=e[0][0]-e[1][0],t=a*e[0][0]+l*e[0][1],e=r*l-a*s;return p.eq(e,0,i)||(n[0]=(l*o-s*t)/e,n[1]=(r*t-a*o)/e),n},n.segmentsIntersect=function(t,e,i,n){var r=e[0]-t[0],s=e[1]-t[1],o=n[0]-i[0],e=n[1]-i[1];if(o*s-e*r==0)return!1;n=(r*(i[1]-t[1])+s*(t[0]-i[0]))/(o*s-e*r),s=(o*(t[1]-i[1])+e*(i[0]-t[0]))/(e*r-o*s);return 0<=n&&n<=1&&0<=s&&s<=1}},{"./Scalar":4}],2:[function(t,e,i){function a(){}(e.exports=a).area=function(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])},a.left=function(t,e,i){return 0<a.area(t,e,i)},a.leftOn=function(t,e,i){return 0<=a.area(t,e,i)},a.right=function(t,e,i){return a.area(t,e,i)<0},a.rightOn=function(t,e,i){return a.area(t,e,i)<=0};var l=[],p=[];a.collinear=function(t,e,i,n){if(n){var r=l,s=p;r[0]=e[0]-t[0],r[1]=e[1]-t[1],s[0]=i[0]-e[0],s[1]=i[1]-e[1];var o=r[0]*s[0]+r[1]*s[1],r=Math.sqrt(r[0]*r[0]+r[1]*r[1]),s=Math.sqrt(s[0]*s[0]+s[1]*s[1]);return Math.acos(o/(r*s))<n}return 0==a.area(t,e,i)},a.sqdist=function(t,e){var i=e[0]-t[0],t=e[1]-t[1];return i*i+t*t}},{}],3:[function(t,e,i){function z(){this.vertices=[]}function w(t,e,i,n,r){r=r||0;var s=e[1]-t[1],o=t[0]-e[0],a=s*t[0]+o*t[1],e=n[1]-i[1],t=i[0]-n[0],n=e*i[0]+t*i[1],i=s*t-e*o;return l.eq(i,0,r)?[0,0]:[(t*a-o*n)/i,(s*n-e*a)/i]}var a=t("./Line"),C=t("./Point"),l=t("./Scalar");(e.exports=z).prototype.at=function(t){var e=this.vertices,i=e.length;return e[t<0?t%i+i:t%i]},z.prototype.first=function(){return this.vertices[0]},z.prototype.last=function(){return this.vertices[this.vertices.length-1]},z.prototype.clear=function(){this.vertices.length=0},z.prototype.append=function(t,e,i){if(void 0===e)throw new Error("From is not given!");if(void 0===i)throw new Error("To is not given!");if(i-1<e)throw new Error("lol1");if(i>t.vertices.length)throw new Error("lol2");if(e<0)throw new Error("lol3");for(var n=e;n<i;n++)this.vertices.push(t.vertices[n])},z.prototype.makeCCW=function(){for(var t=0,e=this.vertices,i=1;i<this.vertices.length;++i)(e[i][1]<e[t][1]||e[i][1]==e[t][1]&&e[i][0]>e[t][0])&&(t=i);C.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},z.prototype.reverse=function(){for(var t=[],e=0,i=this.vertices.length;e!==i;e++)t.push(this.vertices.pop());this.vertices=t},z.prototype.isReflex=function(t){return C.right(this.at(t-1),this.at(t),this.at(t+1))};var p=[],h=[];z.prototype.canSee=function(t,e){var i,n,r=p,s=h;if(C.leftOn(this.at(t+1),this.at(t),this.at(e))&&C.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;n=C.sqdist(this.at(t),this.at(e));for(var o=0;o!==this.vertices.length;++o)if((o+1)%this.vertices.length!==t&&o!==t&&C.leftOn(this.at(t),this.at(e),this.at(o+1))&&C.rightOn(this.at(t),this.at(e),this.at(o))&&(r[0]=this.at(t),r[1]=this.at(e),s[0]=this.at(o),s[1]=this.at(o+1),i=a.lineInt(r,s),C.sqdist(this.at(t),i)<n))return!1;return!0},z.prototype.copy=function(t,e,i){var n=i||new z;if(n.clear(),t<e)for(var r=t;r<=e;r++)n.vertices.push(this.vertices[r]);else{for(r=0;r<=e;r++)n.vertices.push(this.vertices[r]);for(r=t;r<this.vertices.length;r++)n.vertices.push(this.vertices[r])}return n},z.prototype.getCutEdges=function(){for(var t,e=[],i=[],n=new z,r=Number.MAX_VALUE,s=0;s<this.vertices.length;++s)if(this.isReflex(s))for(var o=0;o<this.vertices.length;++o)if(this.canSee(s,o)){i=this.copy(s,o,n).getCutEdges(),t=this.copy(o,s,n).getCutEdges();for(var a=0;a<t.length;a++)i.push(t[a]);i.length<r&&(r=(e=i).length,e.push([this.at(s),this.at(o)]))}return e},z.prototype.decomp=function(){var t=this.getCutEdges();return 0<t.length?this.slice(t):[this]},z.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],i=0;i<t.length;i++)for(var n=t[i],r=0;r<e.length;r++){var s=e[r].slice(n);if(s){e.splice(r,1),e.push(s[0],s[1]);break}}return e}n=t,i=this.vertices.indexOf(n[0]),r=this.vertices.indexOf(n[1]);return-1!=i&&-1!=r&&[this.copy(i,r),this.copy(r,i)]},z.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var i=0;i<e-1;i++)if(a.segmentsIntersect(t[e],t[e+1],t[i],t[i+1]))return!1;for(e=1;e<t.length-2;e++)if(a.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},z.prototype.quickDecomp=function(t,e,i,n,r,s){r=r||100,s=s||0,n=n||25,t=void 0!==t?t:[],e=e||[],i=i||[];var o=[0,0],a=[0,0],l=[0,0],p=0,h=0,u=0,c=0,d=0,_=0,y=0,f=new z,m=new z,x=this,v=this.vertices;if(v.length<3)return t;if(++s>r)return t;for(var g=0;g<this.vertices.length;++g)if(x.isReflex(g)){e.push(x.vertices[g]),p=h=Number.MAX_VALUE;for(var b=0;b<this.vertices.length;++b)C.left(x.at(g-1),x.at(g),x.at(b))&&C.rightOn(x.at(g-1),x.at(g),x.at(b-1))&&(l=w(x.at(g-1),x.at(g),x.at(b),x.at(b-1)),C.right(x.at(g+1),x.at(g),l)&&(u=C.sqdist(x.vertices[g],l))<h&&(h=u,a=l,_=b)),C.left(x.at(g+1),x.at(g),x.at(b+1))&&C.rightOn(x.at(g+1),x.at(g),x.at(b))&&(l=w(x.at(g+1),x.at(g),x.at(b),x.at(b+1)),C.left(x.at(g-1),x.at(g),l)&&(u=C.sqdist(x.vertices[g],l))<p&&(p=u,o=l,d=b));if(_==(d+1)%this.vertices.length)l[0]=(a[0]+o[0])/2,l[1]=(a[1]+o[1])/2,i.push(l),g<d?(f.append(x,g,d+1),f.vertices.push(l),m.vertices.push(l),0!=_&&m.append(x,_,x.vertices.length),m.append(x,0,g+1)):(0!=g&&f.append(x,g,x.vertices.length),f.append(x,0,d+1),f.vertices.push(l),m.vertices.push(l),m.append(x,_,g+1));else{if(d<_&&(d+=this.vertices.length),c=Number.MAX_VALUE,d<_)return t;for(b=_;b<=d;++b)C.leftOn(x.at(g-1),x.at(g),x.at(b))&&C.rightOn(x.at(g+1),x.at(g),x.at(b))&&(u=C.sqdist(x.at(g),x.at(b)))<c&&(c=u,y=b%this.vertices.length);g<y?(f.append(x,g,y+1),0!=y&&m.append(x,y,v.length),m.append(x,0,g+1)):(0!=g&&f.append(x,g,v.length),f.append(x,0,y+1),m.append(x,y,g+1))}return f.vertices.length<m.vertices.length?(f.quickDecomp(t,e,i,n,r,s),m.quickDecomp(t,e,i,n,r,s)):(m.quickDecomp(t,e,i,n,r,s),f.quickDecomp(t,e,i,n,r,s)),t}return t.push(this),t},z.prototype.removeCollinearPoints=function(t){for(var e=0,i=this.vertices.length-1;3<this.vertices.length&&0<=i;--i)C.collinear(this.at(i-1),this.at(i),this.at(i+1),t)&&(this.vertices.splice(i%this.vertices.length,1),i--,e++);return e}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(t,e,i){function n(){}(e.exports=n).eq=function(t,e,i){return i=i||0,Math.abs(t-e)<i}},{}],5:[function(t,e,i){e.exports={Polygon:t("./Polygon"),Point:t("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(t,e,i){e.exports={name:"p2",version:"0.7.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{}],7:[function(t,e,i){function n(t){this.lowerBound=d.create(),t&&t.lowerBound&&d.copy(this.lowerBound,t.lowerBound),this.upperBound=d.create(),t&&t.upperBound&&d.copy(this.upperBound,t.upperBound)}var d=t("../math/vec2");t("../utils/Utils");e.exports=n;var _=d.create();n.prototype.setFromPoints=function(t,e,i,n){var r=this.lowerBound,s=this.upperBound;"number"!=typeof i&&(i=0),0!==i?d.rotate(r,t[0],i):d.copy(r,t[0]),d.copy(s,r);for(var o=Math.cos(i),a=Math.sin(i),l=1;l<t.length;l++){var p,h,u=t[l];0!==i&&(p=u[0],h=u[1],_[0]=o*p-a*h,_[1]=a*p+o*h,u=_);for(var c=0;c<2;c++)u[c]>s[c]&&(s[c]=u[c]),u[c]<r[c]&&(r[c]=u[c])}e&&(d.add(this.lowerBound,this.lowerBound,e),d.add(this.upperBound,this.upperBound,e)),n&&(this.lowerBound[0]-=n,this.lowerBound[1]-=n,this.upperBound[0]+=n,this.upperBound[1]+=n)},n.prototype.copy=function(t){d.copy(this.lowerBound,t.lowerBound),d.copy(this.upperBound,t.upperBound)},n.prototype.extend=function(t){for(var e=2;e--;){var i=t.lowerBound[e];this.lowerBound[e]>i&&(this.lowerBound[e]=i);i=t.upperBound[e];this.upperBound[e]<i&&(this.upperBound[e]=i)}},n.prototype.overlaps=function(t){var e=this.lowerBound,i=this.upperBound,n=t.lowerBound,t=t.upperBound;return(n[0]<=i[0]&&i[0]<=t[0]||e[0]<=t[0]&&t[0]<=i[0])&&(n[1]<=i[1]&&i[1]<=t[1]||e[1]<=t[1]&&t[1]<=i[1])},n.prototype.containsPoint=function(t){var e=this.lowerBound,i=this.upperBound;return e[0]<=t[0]&&t[0]<=i[0]&&e[1]<=t[1]&&t[1]<=i[1]},n.prototype.overlapsRay=function(t){var e=1/t.direction[0],i=1/t.direction[1],n=(this.lowerBound[0]-t.from[0])*e,r=(this.upperBound[0]-t.from[0])*e,e=(this.lowerBound[1]-t.from[1])*i,t=(this.upperBound[1]-t.from[1])*i,i=Math.max(Math.max(Math.min(n,r),Math.min(e,t))),t=Math.min(Math.min(Math.max(n,r),Math.max(e,t)));return t<0||t<i?-1:i}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(t,e,i){function n(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=n.AABB}var r=t("../math/vec2"),s=t("../objects/Body");(e.exports=n).AABB=1,n.BOUNDING_CIRCLE=2,n.prototype.setWorld=function(t){this.world=t},n.prototype.getCollisionPairs=function(t){};var o=r.create();n.boundingRadiusCheck=function(t,e){r.sub(o,t.position,e.position);var i=r.squaredLength(o),e=t.boundingRadius+e.boundingRadius;return i<=e*e},n.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())},n.prototype.boundingVolumeCheck=function(t,e){var i;switch(this.boundingVolumeType){case n.BOUNDING_CIRCLE:i=n.boundingRadiusCheck(t,e);break;case n.AABB:i=n.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return i},n.canCollide=function(t,e){var i=s.KINEMATIC,n=s.STATIC;return!(t.type===n&&e.type===n||t.type===i&&e.type===n||t.type===n&&e.type===i||t.type===i&&e.type===i||t.sleepState===s.SLEEPING&&e.sleepState===s.SLEEPING||t.sleepState===s.SLEEPING&&e.type===n||e.sleepState===s.SLEEPING&&t.type===n)},n.NAIVE=1,n.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(t,e,i){function n(){l.call(this,l.NAIVE)}t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Shape"),t("../shapes/Particle");var l=t("../collision/Broadphase");t("../math/vec2");(((e.exports=n).prototype=new l).constructor=n).prototype.getCollisionPairs=function(t){for(var e=t.bodies,i=this.result,n=i.length=0,r=e.length;n!==r;n++)for(var s=e[n],o=0;o<n;o++){var a=e[o];l.canCollide(s,a)&&this.boundingVolumeCheck(s,a)&&i.push(s,a)}return i},n.prototype.aabbQuery=function(t,e,i){i=i||[];for(var n=t.bodies,r=0;r<n.length;r++){var s=n[r];s.aabbNeedsUpdate&&s.updateAABB(),s.aabb.overlaps(e)&&i.push(s)}return i}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(t,e,i){function N(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new n({size:32}),this.frictionEquationPool=new r({size:64}),this.restitution=0,this.stiffness=o.DEFAULT_STIFFNESS,this.relaxation=o.DEFAULT_RELAXATION,this.frictionStiffness=o.DEFAULT_STIFFNESS,this.frictionRelaxation=o.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new s,this.contactSkinSize=.01}function x(t,e){G.set(t.vertices[0],.5*-e.length,-e.radius),G.set(t.vertices[1],.5*e.length,-e.radius),G.set(t.vertices[2],.5*e.length,e.radius),G.set(t.vertices[3],.5*-e.length,e.radius)}function A(t,e,i,n){for(var r=_,s=y,o=f,a=m,l=t,p=e.vertices,h=null,u=0;u!==p.length+1;u++){var c=p[u%p.length],d=p[(u+1)%p.length];G.rotate(r,c,n),G.rotate(s,d,n),X(r,r,i),X(s,s,i),U(o,r,l),U(a,s,l);d=G.crossLength(o,a);if(null===h&&(h=d),d*h<=0)return;h=d}return 1}var G=t("../math/vec2"),U=G.sub,X=G.add,V=G.dot,n=(t("../utils/Utils"),t("../utils/ContactEquationPool")),r=t("../utils/FrictionEquationPool"),s=t("../utils/TupleDictionary"),o=t("../equations/Equation"),a=(t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("../shapes/Circle")),l=t("../shapes/Convex"),p=t("../shapes/Shape"),w=(t("../objects/Body"),t("../shapes/Box"));e.exports=N;var C=G.fromValues(0,1),W=G.fromValues(0,0),H=G.fromValues(0,0),q=G.fromValues(0,0),Y=G.fromValues(0,0),K=G.fromValues(0,0),O=G.fromValues(0,0),Z=G.fromValues(0,0),J=G.fromValues(0,0),Q=G.fromValues(0,0),k=G.fromValues(0,0),E=G.fromValues(0,0),I=G.fromValues(0,0),D=G.fromValues(0,0),B=G.fromValues(0,0),L=G.fromValues(0,0),R=G.fromValues(0,0),T=G.fromValues(0,0),S=G.fromValues(0,0),F=[],h=G.create(),u=G.create();N.prototype.bodiesOverlap=function(t,e){for(var i=h,n=u,r=0,s=t.shapes.length;r!==s;r++){var o=t.shapes[r];t.toWorldFrame(i,o.position);for(var a=0,l=e.shapes.length;a!==l;a++){var p=e.shapes[a];if(e.toWorldFrame(n,p.position),this[o.type|p.type](t,o,i,o.angle+t.angle,e,p,n,p.angle+e.angle,!0))return!0}}return!1},N.prototype.collidedLastStep=function(t,e){t=0|t.id,e=0|e.id;return!!this.collidingBodiesLastStep.get(t,e)},N.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var i=t[e],n=i.bodyA.id,i=i.bodyB.id;this.collidingBodiesLastStep.set(n,i,!0)}for(var r=this.contactEquations,s=this.frictionEquations,o=0;o<r.length;o++)this.contactEquationPool.release(r[o]);for(o=0;o<s.length;o++)this.frictionEquationPool.release(s[o]);this.contactEquations.length=this.frictionEquations.length=0},N.prototype.createContactEquation=function(t,e,i,n){var r=this.contactEquationPool.get();return r.bodyA=t,r.bodyB=e,r.shapeA=i,r.shapeB=n,r.restitution=this.restitution,r.firstImpact=!this.collidedLastStep(t,e),r.stiffness=this.stiffness,r.relaxation=this.relaxation,r.needsUpdate=!0,r.enabled=this.enabledEquations,r.offset=this.contactSkinSize,r},N.prototype.createFrictionEquation=function(t,e,i,n){var r=this.frictionEquationPool.get();return r.bodyA=t,r.bodyB=e,r.shapeA=i,r.shapeB=n,r.setSlipForce(this.slipForce),r.frictionCoefficient=this.frictionCoefficient,r.relativeVelocity=this.surfaceVelocity,r.enabled=this.enabledEquations,r.needsUpdate=!0,r.stiffness=this.frictionStiffness,r.relaxation=this.frictionRelaxation,r.contactEquations.length=0,r},N.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return G.copy(e.contactPointA,t.contactPointA),G.copy(e.contactPointB,t.contactPointB),G.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},N.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1],i=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),n=e.bodyA;e.bodyB;G.set(i.contactPointA,0,0),G.set(i.contactPointB,0,0),G.set(i.t,0,0);for(var r=0;r!==t;r++)(e=this.contactEquations[this.contactEquations.length-1-r]).bodyA===n?(G.add(i.t,i.t,e.normalA),G.add(i.contactPointA,i.contactPointA,e.contactPointA),G.add(i.contactPointB,i.contactPointB,e.contactPointB)):(G.sub(i.t,i.t,e.normalA),G.add(i.contactPointA,i.contactPointA,e.contactPointB),G.add(i.contactPointB,i.contactPointB,e.contactPointA)),i.contactEquations.push(e);var s=1/t;return G.scale(i.contactPointA,i.contactPointA,s),G.scale(i.contactPointB,i.contactPointB,s),G.normalize(i.t,i.t),G.rotate90cw(i.t,i.t),i},N.prototype[p.LINE|p.CONVEX]=N.prototype.convexLine=function(t,e,i,n,r,s,o,a,l){return!l&&0},N.prototype[p.LINE|p.BOX]=N.prototype.lineBox=function(t,e,i,n,r,s,o,a,l){return!l&&0};var c=new w({width:1,height:1}),d=G.create();N.prototype[p.CAPSULE|p.CONVEX]=N.prototype[p.CAPSULE|p.BOX]=N.prototype.convexCapsule=function(t,e,i,n,r,s,o,a,l){var p=d;G.set(p,s.length/2,0),G.rotate(p,p,a),G.add(p,p,o);var h=this.circleConvex(r,s,p,a,t,e,i,n,l,s.radius);G.set(p,-s.length/2,0),G.rotate(p,p,a),G.add(p,p,o);var u=this.circleConvex(r,s,p,a,t,e,i,n,l,s.radius);if(l&&(h||u))return!0;p=c;return x(p,s),this.convexConvex(t,e,i,n,r,p,o,a,l)+h+u},N.prototype[p.CAPSULE|p.LINE]=N.prototype.lineCapsule=function(t,e,i,n,r,s,o,a,l){return!l&&0};var v=G.create(),g=G.create(),b=new w({width:1,height:1});N.prototype[p.CAPSULE|p.CAPSULE]=N.prototype.capsuleCapsule=function(t,e,i,n,r,s,o,a,l){for(var p=v,h=g,u=0,c=0;c<2;c++){G.set(p,(0===c?-1:1)*e.length/2,0),G.rotate(p,p,n),G.add(p,p,i);for(var d=0;d<2;d++){G.set(h,(0===d?-1:1)*s.length/2,0),G.rotate(h,h,a),G.add(h,h,o),this.enableFrictionReduction&&(f=this.enableFriction,this.enableFriction=!1);var _=this.circleCircle(t,e,p,n,r,s,h,a,l,e.radius,s.radius);if(this.enableFrictionReduction&&(this.enableFriction=f),l&&_)return!0;u+=_}}this.enableFrictionReduction&&(f=this.enableFriction,this.enableFriction=!1);var y=b;x(y,e);var f,m=this.convexCapsule(t,y,i,n,r,s,o,a,l);if(this.enableFrictionReduction&&(this.enableFriction=f),l&&m)return!0;u+=m,this.enableFrictionReduction&&(f=this.enableFriction,this.enableFriction=!1),x(y,s);y=this.convexCapsule(r,y,o,a,t,e,i,n,l);return this.enableFrictionReduction&&(this.enableFriction=f),!(!l||!y)||(u+=y,this.enableFrictionReduction&&u&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(u)),u)},N.prototype[p.LINE|p.LINE]=N.prototype.lineLine=function(t,e,i,n,r,s,o,a,l){return!l&&0},N.prototype[p.PLANE|p.LINE]=N.prototype.planeLine=function(t,e,i,n,r,s,o,a,l){var p=W,h=H,u=q,c=Y,d=K,_=O,y=Z,f=J,m=Q,x=F,v=0;G.set(p,-s.length/2,0),G.set(h,s.length/2,0),G.rotate(u,p,a),G.rotate(c,h,a),X(u,u,o),X(c,c,o),G.copy(p,u),G.copy(h,c),U(d,h,p),G.normalize(_,d),G.rotate90cw(m,_),G.rotate(f,C,n),x[0]=p,x[1]=h;for(var g=0;g<x.length;g++){var b=x[g];U(y,b,i);var z=V(y,f);if(z<0){if(l)return!0;var w=this.createContactEquation(t,r,e,s);v++,G.copy(w.normalA,f),G.normalize(w.normalA,w.normalA),G.scale(y,f,z),U(w.contactPointA,b,y),U(w.contactPointA,w.contactPointA,t.position),U(w.contactPointB,b,o),X(w.contactPointB,w.contactPointB,o),U(w.contactPointB,w.contactPointB,r.position),this.contactEquations.push(w),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(w))}}return!l&&(this.enableFrictionReduction||v&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(v)),v)},N.prototype[p.PARTICLE|p.CAPSULE]=N.prototype.particleCapsule=function(t,e,i,n,r,s,o,a,l){return this.circleLine(t,e,i,n,r,s,o,a,l,s.radius,0)},N.prototype[p.CIRCLE|p.LINE]=N.prototype.circleLine=function(t,e,i,n,r,s,o,a,l,p,h){var p=p||0,h=void 0!==h?h:e.radius,u=W,c=H,d=q,_=Y,y=K,f=O,m=Z,x=J,v=Q,g=k,b=E,z=I,w=D,C=B,P=F;G.set(x,-s.length/2,0),G.set(v,s.length/2,0),G.rotate(g,x,a),G.rotate(b,v,a),X(g,g,o),X(b,b,o),G.copy(x,g),G.copy(v,b),U(f,v,x),G.normalize(m,f),G.rotate90cw(y,m),U(z,i,x);f=V(z,y);U(_,x,o),U(w,i,o);var T=h+p;if(Math.abs(f)<T){G.scale(u,y,f),U(d,i,u),G.scale(c,y,V(y,w)),G.normalize(c,c),G.scale(c,c,p),X(d,d,c);w=V(m,d),c=V(m,x),m=V(m,v);if(c<w&&w<m){if(l)return!0;var S=this.createContactEquation(t,r,e,s);return G.scale(S.normalA,u,-1),G.normalize(S.normalA,S.normalA),G.scale(S.contactPointA,S.normalA,h),X(S.contactPointA,S.contactPointA,i),U(S.contactPointA,S.contactPointA,t.position),U(S.contactPointB,d,o),X(S.contactPointB,S.contactPointB,o),U(S.contactPointB,S.contactPointB,r.position),this.contactEquations.push(S),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(S)),1}}P[0]=x,P[1]=v;for(var M=0;M<P.length;M++){var A=P[M];if(U(z,A,i),G.squaredLength(z)<Math.pow(T,2)){if(l)return!0;S=this.createContactEquation(t,r,e,s);return G.copy(S.normalA,z),G.normalize(S.normalA,S.normalA),G.scale(S.contactPointA,S.normalA,h),X(S.contactPointA,S.contactPointA,i),U(S.contactPointA,S.contactPointA,t.position),U(S.contactPointB,A,o),G.scale(C,S.normalA,-p),X(S.contactPointB,S.contactPointB,C),X(S.contactPointB,S.contactPointB,o),U(S.contactPointB,S.contactPointB,r.position),this.contactEquations.push(S),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(S)),1}}return 0},N.prototype[p.CIRCLE|p.CAPSULE]=N.prototype.circleCapsule=function(t,e,i,n,r,s,o,a,l){return this.circleLine(t,e,i,n,r,s,o,a,l,s.radius)},N.prototype[p.CIRCLE|p.CONVEX]=N.prototype[p.CIRCLE|p.BOX]=N.prototype.circleConvex=function(t,e,i,n,r,s,o,a,l,p){for(var p="number"==typeof p?p:e.radius,h=W,u=H,c=q,d=Y,_=K,y=k,f=E,m=D,x=B,v=L,g=R,b=!1,z=Number.MAX_VALUE,w=s.vertices,C=0;C!==w.length+1;C++){var P=w[C%w.length],T=w[(C+1)%w.length];G.rotate(h,P,a),G.rotate(u,T,a),X(h,h,o),X(u,u,o),U(c,u,h),G.normalize(d,c),G.rotate90cw(_,d),G.scale(x,_,-e.radius),X(x,x,i),A(x,s,o,a)&&(G.sub(v,h,x),(T=Math.abs(G.dot(v,_)))<z&&(G.copy(g,x),z=T,G.scale(m,_,T),G.add(m,m,x),b=!0))}if(b){if(l)return!0;var S=this.createContactEquation(t,r,e,s);return G.sub(S.normalA,g,i),G.normalize(S.normalA,S.normalA),G.scale(S.contactPointA,S.normalA,p),X(S.contactPointA,S.contactPointA,i),U(S.contactPointA,S.contactPointA,t.position),U(S.contactPointB,m,o),X(S.contactPointB,S.contactPointB,o),U(S.contactPointB,S.contactPointB,r.position),this.contactEquations.push(S),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(S)),1}if(0<p)for(C=0;C<w.length;C++){var M=w[C];if(G.rotate(f,M,a),X(f,f,o),U(y,f,i),G.squaredLength(y)<Math.pow(p,2)){if(l)return!0;S=this.createContactEquation(t,r,e,s);return G.copy(S.normalA,y),G.normalize(S.normalA,S.normalA),G.scale(S.contactPointA,S.normalA,p),X(S.contactPointA,S.contactPointA,i),U(S.contactPointA,S.contactPointA,t.position),U(S.contactPointB,f,o),X(S.contactPointB,S.contactPointB,o),U(S.contactPointB,S.contactPointB,r.position),this.contactEquations.push(S),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(S)),1}}return 0};var _=G.create(),y=G.create(),f=G.create(),m=G.create();N.prototype[p.PARTICLE|p.CONVEX]=N.prototype[p.PARTICLE|p.BOX]=N.prototype.particleConvex=function(t,e,i,n,r,s,o,a,l){var p=W,h=H,u=q,c=Y,d=K,_=O,y=Z,f=k,m=D,x=T,v=S,g=Number.MAX_VALUE,b=!1,z=s.vertices;if(!A(i,s,o,a))return 0;if(l)return!0;for(var w=0;w!==z.length+1;w++){var C=z[w%z.length],P=z[(w+1)%z.length];G.rotate(p,C,a),G.rotate(h,P,a),X(p,p,o),X(h,h,o),U(u,h,p),G.normalize(c,u),G.rotate90cw(d,c),U(f,i,p);V(f,d);U(_,p,o),U(y,i,o),G.sub(x,p,i);P=Math.abs(G.dot(x,d));P<g&&(g=P,G.scale(m,d,P),G.add(m,m,i),G.copy(v,d),b=!0)}if(b){s=this.createContactEquation(t,r,e,s);return G.scale(s.normalA,v,-1),G.normalize(s.normalA,s.normalA),G.set(s.contactPointA,0,0),X(s.contactPointA,s.contactPointA,i),U(s.contactPointA,s.contactPointA,t.position),U(s.contactPointB,m,o),X(s.contactPointB,s.contactPointB,o),U(s.contactPointB,s.contactPointB,r.position),this.contactEquations.push(s),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(s)),1}return 0},N.prototype[p.CIRCLE]=N.prototype.circleCircle=function(t,e,i,n,r,s,o,a,l,p,h){var u=W,p=p||e.radius,h=h||s.radius;U(u,i,o);var c=p+h;if(G.squaredLength(u)>Math.pow(c,2))return 0;if(l)return!0;s=this.createContactEquation(t,r,e,s);return U(s.normalA,o,i),G.normalize(s.normalA,s.normalA),G.scale(s.contactPointA,s.normalA,p),G.scale(s.contactPointB,s.normalA,-h),X(s.contactPointA,s.contactPointA,i),U(s.contactPointA,s.contactPointA,t.position),X(s.contactPointB,s.contactPointB,o),U(s.contactPointB,s.contactPointB,r.position),this.contactEquations.push(s),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(s)),1},N.prototype[p.PLANE|p.CONVEX]=N.prototype[p.PLANE|p.BOX]=N.prototype.planeConvex=function(t,e,i,n,r,s,o,a,l){var p=W,h=H,u=q,c=0;G.rotate(h,C,n);for(var d=0;d!==s.vertices.length;d++){var _=s.vertices[d];if(G.rotate(p,_,a),X(p,p,o),U(u,p,i),V(u,h)<=0){if(l)return!0;c++;var y=this.createContactEquation(t,r,e,s);U(u,p,i),G.copy(y.normalA,h);_=V(u,y.normalA);G.scale(u,y.normalA,_),U(y.contactPointB,p,r.position),U(y.contactPointA,p,u),U(y.contactPointA,y.contactPointA,t.position),this.contactEquations.push(y),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(y))}}return this.enableFrictionReduction&&this.enableFriction&&c&&this.frictionEquations.push(this.createFrictionFromAverage(c)),c},N.prototype[p.PARTICLE|p.PLANE]=N.prototype.particlePlane=function(t,e,i,n,r,s,o,a,l){var p=W,h=H;a=a||0,U(p,i,o),G.rotate(h,C,a);a=V(p,h);if(0<a)return 0;if(l)return!0;e=this.createContactEquation(r,t,s,e);return G.copy(e.normalA,h),G.scale(p,e.normalA,a),U(e.contactPointA,i,p),U(e.contactPointA,e.contactPointA,r.position),U(e.contactPointB,i,t.position),this.contactEquations.push(e),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(e)),1},N.prototype[p.CIRCLE|p.PARTICLE]=N.prototype.circleParticle=function(t,e,i,n,r,s,o,a,l){var p=W;if(U(p,o,i),G.squaredLength(p)>Math.pow(e.radius,2))return 0;if(l)return!0;s=this.createContactEquation(t,r,e,s);return G.copy(s.normalA,p),G.normalize(s.normalA,s.normalA),G.scale(s.contactPointA,s.normalA,e.radius),X(s.contactPointA,s.contactPointA,i),U(s.contactPointA,s.contactPointA,t.position),U(s.contactPointB,o,r.position),this.contactEquations.push(s),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(s)),1};var z=new a({radius:1}),P=G.create(),M=G.create();G.create();N.prototype[p.PLANE|p.CAPSULE]=N.prototype.planeCapsule=function(t,e,i,n,r,s,o,a,l){var p,h=P,u=M,c=z;G.set(h,-s.length/2,0),G.rotate(h,h,a),X(h,h,o),G.set(u,s.length/2,0),G.rotate(u,u,a),X(u,u,o),c.radius=s.radius,this.enableFrictionReduction&&(p=this.enableFriction,this.enableFriction=!1);h=this.circlePlane(r,c,h,0,t,e,i,n,l),n=this.circlePlane(r,c,u,0,t,e,i,n,l);if(this.enableFrictionReduction&&(this.enableFriction=p),l)return h||n;n=h+n;return this.enableFrictionReduction&&n&&this.frictionEquations.push(this.createFrictionFromAverage(n)),n},N.prototype[p.CIRCLE|p.PLANE]=N.prototype.circlePlane=function(t,e,i,n,r,s,o,a,l){var p=t,h=e,u=i,c=r,t=o,i=(i=a)||0,r=W,o=H,a=q;U(r,u,t),G.rotate(o,C,i);i=V(o,r);if(i>h.radius)return 0;if(l)return!0;e=this.createContactEquation(c,p,s,e);return G.copy(e.normalA,o),G.scale(e.contactPointB,e.normalA,-h.radius),X(e.contactPointB,e.contactPointB,u),U(e.contactPointB,e.contactPointB,p.position),G.scale(a,e.normalA,i),U(e.contactPointA,r,a),X(e.contactPointA,e.contactPointA,t),U(e.contactPointA,e.contactPointA,c.position),this.contactEquations.push(e),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(e)),1},N.prototype[p.CONVEX]=N.prototype[p.CONVEX|p.BOX]=N.prototype[p.BOX]=N.prototype.convexConvex=function(t,e,i,n,r,s,o,a,l,p){var h=W,u=H,c=q,d=Y,_=K,y=Z,f=J,m=Q,x=0,p="number"==typeof p?p:0;if(!N.findSeparatingAxis(e,i,n,s,o,a,h))return 0;U(f,o,i),0<V(h,f)&&G.scale(h,h,-1);var v=N.getClosestEdge(e,n,h,!0),g=N.getClosestEdge(s,a,h);if(-1===v||-1===g)return 0;for(var b=0;b<2;b++){var z,w=v,C=g,P=e,T=s,S=i,M=o,A=n,O=a,k=t,E=r;0===b&&(z=w,w=C,C=z,z=P,P=T,T=z,z=S,S=M,M=z,z=A,A=O,O=z,z=k,k=E,E=z);for(var I=C;I<C+2;I++){var D=T.vertices[(I+T.vertices.length)%T.vertices.length];G.rotate(u,D,O),X(u,u,M);for(var B=0,L=w-1;L<w+2;L++){var R=P.vertices[(L+P.vertices.length)%P.vertices.length],F=P.vertices[(L+1+P.vertices.length)%P.vertices.length];G.rotate(c,R,A),G.rotate(d,F,A),X(c,c,S),X(d,d,S),U(_,d,c),G.rotate90cw(m,_),G.normalize(m,m),U(f,u,c);var j=V(m,f);(L===w&&j<=p||L!==w&&j<=0)&&B++}if(3<=B){if(l)return!0;D=this.createContactEquation(k,E,P,T);x++;R=P.vertices[w%P.vertices.length],F=P.vertices[(w+1)%P.vertices.length];G.rotate(c,R,A),G.rotate(d,F,A),X(c,c,S),X(d,d,S),U(_,d,c),G.rotate90cw(D.normalA,_),G.normalize(D.normalA,D.normalA),U(f,u,c);j=V(D.normalA,f);G.scale(y,D.normalA,j),U(D.contactPointA,u,S),U(D.contactPointA,D.contactPointA,y),X(D.contactPointA,D.contactPointA,S),U(D.contactPointA,D.contactPointA,k.position),U(D.contactPointB,u,M),X(D.contactPointB,D.contactPointB,M),U(D.contactPointB,D.contactPointB,E.position),this.contactEquations.push(D),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(D))}}}return this.enableFrictionReduction&&this.enableFriction&&x&&this.frictionEquations.push(this.createFrictionFromAverage(x)),x};var j=G.fromValues(0,0);N.projectConvexOntoAxis=function(t,e,i,n,r){var s,o=null,a=null,l=j;G.rotate(l,n,-i);for(var p=0;p<t.vertices.length;p++)s=t.vertices[p],s=V(s,l),(null===o||o<s)&&(o=s),(null===a||s<a)&&(a=s);o<a&&(i=a,a=o,o=i);n=V(e,n);G.set(r,a+n,o+n)};var $=G.fromValues(0,0),tt=G.fromValues(0,0),et=G.fromValues(0,0),it=G.fromValues(0,0),nt=G.fromValues(0,0),rt=G.fromValues(0,0);N.findSeparatingAxis=function(t,e,i,n,r,s,o){var a=null,l=!1,p=!1,h=$,u=tt,c=et,d=it,_=nt,y=rt;if(t instanceof w&&n instanceof w)for(var f=0;2!==f;f++){var m=t,x=i;1===f&&(m=n,x=s);for(var v=0;2!==v;v++){0===v?G.set(d,0,1):1===v&&G.set(d,1,0),0!==x&&G.rotate(d,d,x),N.projectConvexOntoAxis(t,e,i,d,_),N.projectConvexOntoAxis(n,r,s,d,y);var g=_,b=y;_[0]>y[0]&&(b=_,g=y,0);l=(z=b[0]-g[1])<=0;(null===a||a<z)&&(G.copy(o,d),a=z,p=l)}}else for(f=0;2!==f;f++){m=t,x=i;1===f&&(m=n,x=s);for(v=0;v!==m.vertices.length;v++){G.rotate(u,m.vertices[v],x),G.rotate(c,m.vertices[(v+1)%m.vertices.length],x),U(h,c,u),G.rotate90cw(d,h),G.normalize(d,d),N.projectConvexOntoAxis(t,e,i,d,_),N.projectConvexOntoAxis(n,r,s,d,y);var z,g=_,b=y;_[0]>y[0]&&(b=_,g=y,0),l=(z=b[0]-g[1])<=0,(null===a||a<z)&&(G.copy(o,d),a=z,p=l)}}return p};var st=G.fromValues(0,0),ot=G.fromValues(0,0),at=G.fromValues(0,0);N.getClosestEdge=function(t,e,i,n){var r=st,s=ot,o=at;G.rotate(r,i,-e),n&&G.scale(r,r,-1);for(var a=-1,l=t.vertices.length,p=-1,h=0;h!==l;h++){U(s,t.vertices[(h+1)%l],t.vertices[h%l]),G.rotate90cw(o,s),G.normalize(o,o);var u=V(o,r);(-1===a||p<u)&&(a=h%l,p=u)}return a};var lt=G.create(),pt=G.create(),ht=G.create(),ut=G.create(),ct=G.create(),dt=G.create(),_t=G.create();N.prototype[p.CIRCLE|p.HEIGHTFIELD]=N.prototype.circleHeightfield=function(t,e,i,n,r,s,o,a,l,p){var h=s.heights,p=p||e.radius,u=s.elementWidth,c=pt,d=lt,_=ct,y=_t,f=dt,m=ht,x=ut,v=Math.floor((i[0]-p-o[0])/u),g=Math.ceil((i[0]+p-o[0])/u);v<0&&(v=0),g>=h.length&&(g=h.length-1);for(var b=h[v],z=h[g],w=v;w<g;w++)h[w]<z&&(z=h[w]),h[w]>b&&(b=h[w]);if(i[1]-p>b)return!l&&0;for(var C=!1,w=v;w<g;w++){G.set(m,w*u,h[w]),G.set(x,(w+1)*u,h[w+1]),G.add(m,m,o),G.add(x,x,o),G.sub(f,x,m),G.rotate(f,f,Math.PI/2),G.normalize(f,f),G.scale(d,f,-p),G.add(d,d,i),G.sub(c,d,m);var P=G.dot(c,f);if(d[0]>=m[0]&&d[0]<x[0]&&P<=0){if(l)return!0;C=!0,G.scale(c,f,-P),G.add(_,d,c),G.copy(y,f);var T=this.createContactEquation(r,t,s,e);G.copy(T.normalA,y),G.scale(T.contactPointB,T.normalA,-p),X(T.contactPointB,T.contactPointB,i),U(T.contactPointB,T.contactPointB,t.position),G.copy(T.contactPointA,_),G.sub(T.contactPointA,T.contactPointA,r.position),this.contactEquations.push(T),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(T))}}if(C=!1,0<p)for(w=v;w<=g;w++)if(G.set(m,w*u,h[w]),G.add(m,m,o),G.sub(c,i,m),G.squaredLength(c)<Math.pow(p,2)){if(l)return!0;C=!0;T=this.createContactEquation(r,t,s,e);G.copy(T.normalA,c),G.normalize(T.normalA,T.normalA),G.scale(T.contactPointB,T.normalA,-p),X(T.contactPointB,T.contactPointB,i),U(T.contactPointB,T.contactPointB,t.position),U(T.contactPointA,m,o),X(T.contactPointA,T.contactPointA,o),U(T.contactPointA,T.contactPointA,r.position),this.contactEquations.push(T),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(T))}return C?1:0};var yt=G.create(),ft=G.create(),mt=G.create(),xt=new l({vertices:[G.create(),G.create(),G.create(),G.create()]});N.prototype[p.BOX|p.HEIGHTFIELD]=N.prototype[p.CONVEX|p.HEIGHTFIELD]=N.prototype.convexHeightfield=function(t,e,i,n,r,s,o,a,l){var p=s.heights,h=s.elementWidth,u=yt,c=ft,d=mt,_=xt,s=Math.floor((t.aabb.lowerBound[0]-o[0])/h),y=Math.ceil((t.aabb.upperBound[0]-o[0])/h);s<0&&(s=0),y>=p.length&&(y=p.length-1);for(var f=p[s],m=p[y],x=s;x<y;x++)p[x]<m&&(m=p[x]),p[x]>f&&(f=p[x]);if(t.aabb.lowerBound[1]>f)return!l&&0;for(var v=0,x=s;x<y;x++){G.set(u,x*h,p[x]),G.set(c,(x+1)*h,p[x+1]),G.add(u,u,o),G.add(c,c,o);G.set(d,.5*(c[0]+u[0]),.5*(c[1]+u[1]-100)),G.sub(_.vertices[0],c,d),G.sub(_.vertices[1],u,d),G.copy(_.vertices[2],_.vertices[1]),G.copy(_.vertices[3],_.vertices[0]),_.vertices[2][1]-=100,_.vertices[3][1]-=100,v+=this.convexConvex(t,e,i,n,r,_,d,0,l)}return v}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(t,e,i){function o(t){t=t||{},this.from=t.from?l.fromValues(t.from[0],t.from[1]):l.create(),this.to=t.to?l.fromValues(t.to[0],t.to[1]):l.create(),this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,this.skipBackfaces=!!t.skipBackfaces,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:-1,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:-1,this.mode=void 0!==t.mode?t.mode:o.ANY,this.callback=t.callback||function(t){},this.direction=l.create(),this.length=1,this.update()}e.exports=o;var l=t("../math/vec2");t("../collision/RaycastResult"),t("../shapes/Shape"),t("../collision/AABB");(o.prototype.constructor=o).CLOSEST=1,o.ANY=2,o.ALL=4,o.prototype.update=function(){var t=this.direction;l.sub(t,this.to,this.from),this.length=l.length(t),l.normalize(t,t)},o.prototype.intersectBodies=function(t,e){for(var i=0,n=e.length;!t.shouldStop(this)&&i<n;i++){var r=e[i],s=r.getAABB();(0<=s.overlapsRay(this)||s.containsPoint(this.from))&&this.intersectBody(t,r)}};var p=l.create();o.prototype.intersectBody=function(t,e){var i=this.checkCollisionResponse;if(!i||e.collisionResponse)for(var n=p,r=0,s=e.shapes.length;r<s;r++){var o=e.shapes[r];if((!i||o.collisionResponse)&&0!=(this.collisionGroup&o.collisionMask)&&0!=(o.collisionGroup&this.collisionMask)){l.rotate(n,o.position,e.angle),l.add(n,n,e.position);var a=o.angle+e.angle;if(this.intersectShape(t,o,a,n,e),t.shouldStop(this))break}}},o.prototype.intersectShape=function(t,e,i,n,r){(function(t,e,i){l.sub(s,i,t);var n=l.dot(s,e);return l.scale(a,e,n),l.add(a,a,t),l.squaredDistance(i,a)})(this.from,this.direction,n)>e.boundingRadius*e.boundingRadius||(this._currentBody=r,(this._currentShape=e).raycast(t,this,n,i),this._currentBody=this._currentShape=null)},o.prototype.getAABB=function(t){var e=this.to,i=this.from;l.set(t.lowerBound,Math.min(e[0],i[0]),Math.min(e[1],i[1])),l.set(t.upperBound,Math.max(e[0],i[0]),Math.max(e[1],i[1]))};l.create();o.prototype.reportIntersection=function(t,e,i,n){this.from,this.to;var r=this._currentShape,s=this._currentBody;if(!(this.skipBackfaces&&0<l.dot(i,this.direction)))switch(this.mode){case o.ALL:t.set(i,r,s,e,n),this.callback(t);break;case o.CLOSEST:(e<t.fraction||!t.hasHit())&&t.set(i,r,s,e,n);break;case o.ANY:t.set(i,r,s,e,n)}};var s=l.create(),a=l.create()},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(t,e,i){function n(){this.normal=s.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}var s=t("../math/vec2"),r=t("../collision/Ray");(e.exports=n).prototype.reset=function(){s.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},n.prototype.getHitDistance=function(t){return s.distance(t.from,t.to)*this.fraction},n.prototype.hasHit=function(){return-1!==this.fraction},n.prototype.getHitPoint=function(t,e){s.lerp(t,e.from,e.to,this.fraction)},n.prototype.stop=function(){this.isStopped=!0},n.prototype.shouldStop=function(t){return this.isStopped||-1!==this.fraction&&t.mode===r.ANY},n.prototype.set=function(t,e,i,n,r){s.copy(this.normal,t),this.shape=e,this.body=i,this.fraction=n,this.faceIndex=r}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(t,e,i){function n(){u.call(this,u.SAP),this.axisList=[],this.axisIndex=0;var e=this;this._addBodyHandler=function(t){e.axisList.push(t.body)},this._removeBodyHandler=function(t){t=e.axisList.indexOf(t.body);-1!==t&&e.axisList.splice(t,1)}}var r=t("../utils/Utils"),u=t("../collision/Broadphase");(((e.exports=n).prototype=new u).constructor=n).prototype.setWorld=function(t){this.axisList.length=0,r.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},n.sortAxisList=function(t,e){e|=0;for(var i=1,n=t.length;i<n;i++){for(var r=t[i],s=i-1;0<=s&&!(t[s].aabb.lowerBound[e]<=r.aabb.lowerBound[e]);s--)t[s+1]=t[s];t[s+1]=r}return t},n.prototype.sortList=function(){var t=this.axisList,e=this.axisIndex;n.sortAxisList(t,e)},n.prototype.getCollisionPairs=function(t){var e=this.axisList,i=this.result,n=this.axisIndex;i.length=0;for(var r=e.length;r--;){var s=e[r];s.aabbNeedsUpdate&&s.updateAABB()}this.sortList();for(var o=0,a=0|e.length;o!==a;o++)for(var l=e[o],p=o+1;p<a;p++){var h=e[p];if(!(h.aabb.lowerBound[n]<=l.aabb.upperBound[n]))break;u.canCollide(l,h)&&this.boundingVolumeCheck(l,h)&&i.push(l,h)}return i},n.prototype.aabbQuery=function(t,e,i){i=i||[],this.sortList();for(var n=this.axisIndex,n=2===n?"z":1===n?"y":"x",r=this.axisList,s=(e.lowerBound[n],e.upperBound[n],0);s<r.length;s++){var o=r[s];o.aabbNeedsUpdate&&o.updateAABB(),o.aabb.overlaps(e)&&i.push(o)}return i}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(t,e,i){function n(t,e,i,n){this.type=i,n=r.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}e.exports=n;var r=t("../utils/Utils");n.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},n.DISTANCE=1,n.GEAR=2,n.LOCK=3,n.PRISMATIC=4,n.REVOLUTE=5,n.prototype.setStiffness=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var n=e[i];n.stiffness=t,n.needsUpdate=!0}},n.prototype.setRelaxation=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var n=e[i];n.relaxation=t,n.needsUpdate=!0}}},{"../utils/Utils":57}],15:[function(t,e,i){function n(t,e,i){i=_.defaults(i,{localAnchorA:[0,0],localAnchorB:[0,0]}),u.call(this,t,e,u.DISTANCE,i),this.localAnchorA=d.fromValues(i.localAnchorA[0],i.localAnchorA[1]),this.localAnchorB=d.fromValues(i.localAnchorB[0],i.localAnchorB[1]);var n,r,s=this.localAnchorA,o=this.localAnchorB;this.distance=0,"number"==typeof i.distance?this.distance=i.distance:(n=d.create(),r=d.create(),a=d.create(),d.rotate(n,s,t.angle),d.rotate(r,o,e.angle),d.add(a,e.position,r),d.sub(a,a,n),d.sub(a,a,t.position),this.distance=d.length(a)),i=void 0===i.maxForce?Number.MAX_VALUE:i.maxForce;e=new c(t,e,-i,i);this.equations=[e],this.maxForce=i;var a=d.create(),l=d.create(),p=d.create(),h=this;e.computeGq=function(){var t=this.bodyA,e=this.bodyB,i=t.position,n=e.position;return d.rotate(l,s,t.angle),d.rotate(p,o,e.angle),d.add(a,n,p),d.sub(a,a,l),d.sub(a,a,i),d.length(a)-h.distance},this.setMaxForce(i),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var u=t("./Constraint"),c=t("../equations/Equation"),d=t("../math/vec2"),_=t("../utils/Utils");((e.exports=n).prototype=new u).constructor=n;var o=d.create(),a=d.create(),l=d.create();n.prototype.update=function(){var t=this.equations[0],e=this.bodyA,i=this.bodyB,n=(this.distance,e.position),r=i.position,s=this.equations[0],t=t.G;d.rotate(a,this.localAnchorA,e.angle),d.rotate(l,this.localAnchorB,i.angle),d.add(o,r,l),d.sub(o,o,a),d.sub(o,o,n),this.position=d.length(o);r=!1;this.upperLimitEnabled&&this.position>this.upperLimit&&(s.maxForce=0,s.minForce=-this.maxForce,this.distance=this.upperLimit,r=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(s.maxForce=this.maxForce,s.minForce=0,this.distance=this.lowerLimit,r=!0),!this.lowerLimitEnabled&&!this.upperLimitEnabled||r?(s.enabled=!0,d.normalize(o,o),n=d.crossLength(a,o),r=d.crossLength(l,o),t[0]=-o[0],t[1]=-o[1],t[2]=-n,t[3]=o[0],t[4]=o[1],t[5]=r):s.enabled=!1},n.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},n.prototype.getMaxForce=function(){return this.equations[0].maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,r.GEAR,i),this.ratio=void 0!==i.ratio?i.ratio:1,this.angle=void 0!==i.angle?i.angle:e.angle-this.ratio*t.angle,i.angle=this.angle,i.ratio=this.ratio,this.equations=[new s(t,e,i)],void 0!==i.maxTorque&&this.setMaxTorque(i.maxTorque)}var r=t("./Constraint"),s=(t("../equations/Equation"),t("../equations/AngleLockEquation"));t("../math/vec2");(((e.exports=n).prototype=new r).constructor=n).prototype.update=function(){var t=this.equations[0];t.ratio!==this.ratio&&t.setRatio(this.ratio),t.angle=this.angle},n.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},n.prototype.getMaxTorque=function(t){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(t,e,i){function n(t,e,i){i=i||{},c.call(this,t,e,c.LOCK,i);var n=void 0===i.maxForce?Number.MAX_VALUE:i.maxForce,r=(i.localAngleB,new _(t,e,-n,n)),s=new _(t,e,-n,n),o=new _(t,e,-n,n),a=d.create(),l=d.create(),p=this;r.computeGq=function(){return d.rotate(a,p.localOffsetB,t.angle),d.sub(l,e.position,t.position),d.sub(l,l,a),l[0]},s.computeGq=function(){return d.rotate(a,p.localOffsetB,t.angle),d.sub(l,e.position,t.position),d.sub(l,l,a),l[1]};var h=d.create(),u=d.create();o.computeGq=function(){return d.rotate(h,p.localOffsetB,e.angle-p.localAngleB),d.scale(h,h,-1),d.sub(l,t.position,e.position),d.add(l,l,h),d.rotate(u,h,-Math.PI/2),d.normalize(u,u),d.dot(l,u)},this.localOffsetB=d.create(),i.localOffsetB?d.copy(this.localOffsetB,i.localOffsetB):(d.sub(this.localOffsetB,e.position,t.position),d.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,"number"==typeof i.localAngleB?this.localAngleB=i.localAngleB:this.localAngleB=e.angle-t.angle,this.equations.push(r,s,o),this.setMaxForce(n)}var c=t("./Constraint"),d=t("../math/vec2"),_=t("../equations/Equation");(((e.exports=n).prototype=new c).constructor=n).prototype.setMaxForce=function(t){for(var e=this.equations,i=0;i<this.equations.length;i++)e[i].maxForce=t,e[i].minForce=-t},n.prototype.getMaxForce=function(){return this.equations[0].maxForce};var s=d.create(),o=d.create(),a=d.create(),l=d.fromValues(1,0),p=d.fromValues(0,1);n.prototype.update=function(){var t=this.equations[0],e=this.equations[1],i=this.equations[2],n=this.bodyA,r=this.bodyB;d.rotate(s,this.localOffsetB,n.angle),d.rotate(o,this.localOffsetB,r.angle-this.localAngleB),d.scale(o,o,-1),d.rotate(a,o,Math.PI/2),d.normalize(a,a),t.G[0]=-1,t.G[1]=0,t.G[2]=-d.crossLength(s,l),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-d.crossLength(s,p),e.G[4]=1,i.G[0]=-a[0],i.G[1]=-a[1],i.G[3]=a[0],i.G[4]=a[1],i.G[5]=d.crossLength(o,a)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(t,e,i){function n(n,r,t){t=t||{},d.call(this,n,r,d.PRISMATIC,t);var s=f.fromValues(0,0),o=f.fromValues(1,0),a=f.fromValues(0,0);t.localAnchorA&&f.copy(s,t.localAnchorA),t.localAxisA&&f.copy(o,t.localAxisA),t.localAnchorB&&f.copy(a,t.localAnchorB),this.localAnchorA=s,this.localAnchorB=a,this.localAxisA=o;var e=this.maxForce=void 0!==t.maxForce?t.maxForce:Number.MAX_VALUE,i=new y(n,r,-e,e),l=new f.create,p=new f.create,h=new f.create,u=new f.create;i.computeGq=function(){return f.dot(h,u)},i.updateJacobian=function(){var t=this.G,e=n.position,i=r.position;f.rotate(l,s,n.angle),f.rotate(p,a,r.angle),f.add(h,i,p),f.sub(h,h,e),f.sub(h,h,l),f.rotate(u,o,n.angle+Math.PI/2),t[0]=-u[0],t[1]=-u[1],t[2]=-f.crossLength(l,u)+f.crossLength(u,h),t[3]=u[0],t[4]=u[1],t[5]=f.crossLength(p,u)},this.equations.push(i),t.disableRotationalLock||(i=new m(n,r,-e,e),this.equations.push(i)),this.position=0,this.velocity=0,this.lowerLimitEnabled=void 0!==t.lowerLimit,this.upperLimitEnabled=void 0!==t.upperLimit,this.lowerLimit=void 0!==t.lowerLimit?t.lowerLimit:0,this.upperLimit=void 0!==t.upperLimit?t.upperLimit:1,this.upperLimitEquation=new _(n,r),this.lowerLimitEquation=new _(n,r),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=e,this.motorEquation=new y(n,r),this.motorEnabled=!1,this.motorSpeed=0;var c=this,e=this.motorEquation;e.computeGW;e.computeGq=function(){return 0},e.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,n=e.velocity,r=i.velocity,e=e.angularVelocity,i=i.angularVelocity;return this.gmult(t,n,e,r,i)+c.motorSpeed}}var d=t("./Constraint"),_=t("../equations/ContactEquation"),y=t("../equations/Equation"),f=t("../math/vec2"),m=t("../equations/RotationalLockEquation");((e.exports=n).prototype=new d).constructor=n;var c=f.create(),x=f.create(),v=f.create(),g=f.create(),b=f.create(),z=f.create();n.prototype.update=function(){var t=this.equations,e=t[0],i=this.upperLimit,n=this.lowerLimit,r=this.upperLimitEquation,s=this.lowerLimitEquation,o=this.bodyA,a=this.bodyB,l=this.localAxisA,p=this.localAnchorA,h=this.localAnchorB;e.updateJacobian(),f.rotate(c,l,o.angle),f.rotate(g,p,o.angle),f.add(x,g,o.position),f.rotate(b,h,a.angle),f.add(v,b,a.position);var u,p=this.position=f.dot(v,c)-f.dot(x,c);this.motorEnabled&&((h=this.motorEquation.G)[0]=c[0],h[1]=c[1],h[2]=f.crossLength(c,b),h[3]=-c[0],h[4]=-c[1],h[5]=-f.crossLength(c,g)),this.upperLimitEnabled&&i<p?(f.scale(r.normalA,c,-1),f.sub(r.contactPointA,x,o.position),f.sub(r.contactPointB,v,a.position),f.scale(z,c,i),f.add(r.contactPointA,r.contactPointA,z),-1===t.indexOf(r)&&t.push(r)):-1!==(u=t.indexOf(r))&&t.splice(u,1),this.lowerLimitEnabled&&p<n?(f.scale(s.normalA,c,1),f.sub(s.contactPointA,x,o.position),f.sub(s.contactPointB,v,a.position),f.scale(z,c,n),f.sub(s.contactPointB,s.contactPointB,z),-1===t.indexOf(s)&&t.push(s)):-1!==(u=t.indexOf(s))&&t.splice(u,1)},n.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},n.prototype.disableMotor=function(){var t;this.motorEnabled&&(t=this.equations.indexOf(this.motorEquation),this.equations.splice(t,1),this.motorEnabled=!1)},n.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(t,e,i){function n(t,e,i){i=i||{},o.call(this,t,e,o.REVOLUTE,i);var n=this.maxForce=void 0!==i.maxForce?i.maxForce:Number.MAX_VALUE;this.pivotA=d.create(),this.pivotB=d.create(),i.worldPivot?(d.sub(this.pivotA,i.worldPivot,t.position),d.sub(this.pivotB,i.worldPivot,e.position),d.rotate(this.pivotA,this.pivotA,-t.angle),d.rotate(this.pivotB,this.pivotB,-e.angle)):(d.copy(this.pivotA,i.localPivotA),d.copy(this.pivotB,i.localPivotB));var r=this.equations=[new a(t,e,-n,n),new a(t,e,-n,n)],i=r[0],r=r[1],s=this;i.computeGq=function(){return d.rotate(_,s.pivotA,t.angle),d.rotate(y,s.pivotB,e.angle),d.add(h,e.position,y),d.sub(h,h,t.position),d.sub(h,h,_),d.dot(h,f)},r.computeGq=function(){return d.rotate(_,s.pivotA,t.angle),d.rotate(y,s.pivotB,e.angle),d.add(h,e.position,y),d.sub(h,h,t.position),d.sub(h,h,_),d.dot(h,m)},r.minForce=i.minForce=-n,r.maxForce=i.maxForce=n,this.motorEquation=new l(t,e),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new p(t,e),this.lowerLimitEquation=new p(t,e),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var o=t("./Constraint"),a=t("../equations/Equation"),l=t("../equations/RotationalVelocityEquation"),p=t("../equations/RotationalLockEquation"),d=t("../math/vec2");e.exports=n;var _=d.create(),y=d.create(),f=d.fromValues(1,0),m=d.fromValues(0,1),h=d.create();((n.prototype=new o).constructor=n).prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)},n.prototype.update=function(){var t,e=this.bodyA,i=this.bodyB,n=this.pivotA,r=this.pivotB,s=this.equations,o=(s[0],s[1],s[0]),a=s[1],l=this.upperLimit,p=this.lowerLimit,h=this.upperLimitEquation,u=this.lowerLimitEquation,c=this.angle=i.angle-e.angle;this.upperLimitEnabled&&l<c?(h.angle=l,-1===s.indexOf(h)&&s.push(h)):-1!==(t=s.indexOf(h))&&s.splice(t,1),this.lowerLimitEnabled&&c<p?(u.angle=p,-1===s.indexOf(u)&&s.push(u)):-1!==(t=s.indexOf(u))&&s.splice(t,1),d.rotate(_,n,e.angle),d.rotate(y,r,i.angle),o.G[0]=-1,o.G[1]=0,o.G[2]=-d.crossLength(_,f),o.G[3]=1,o.G[4]=0,o.G[5]=d.crossLength(y,f),a.G[0]=0,a.G[1]=-1,a.G[2]=-d.crossLength(_,m),a.G[3]=0,a.G[4]=1,a.G[5]=d.crossLength(y,m)},n.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},n.prototype.disableMotor=function(){var t;this.motorEnabled&&(t=this.equations.indexOf(this.motorEquation),this.equations.splice(t,1),this.motorEnabled=!1)},n.prototype.motorIsEnabled=function(){return!!this.motorEnabled},n.prototype.setMotorSpeed=function(t){var e;this.motorEnabled&&(e=this.equations.indexOf(this.motorEquation),this.equations[e].relativeVelocity=t)},n.prototype.getMotorSpeed=function(){return!!this.motorEnabled&&this.motorEquation.relativeVelocity}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0,this.ratio="number"==typeof i.ratio?i.ratio:1,this.setRatio(this.ratio)}var r=t("./Equation");t("../math/vec2");(((e.exports=n).prototype=new r).constructor=n).prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},n.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},n.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}},{"../math/vec2":30,"./Equation":22}],21:[function(t,e,i){function n(t,e){r.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=d.create(),this.penetrationVec=d.create(),this.contactPointB=d.create(),this.normalA=d.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var r=t("./Equation"),d=t("../math/vec2");(((e.exports=n).prototype=new r).constructor=n).prototype.computeB=function(t,e,i){var n,r=this.bodyA,s=this.bodyB,o=this.contactPointA,a=this.contactPointB,l=r.position,p=s.position,h=this.penetrationVec,u=this.normalA,c=this.G,r=d.crossLength(o,u),s=d.crossLength(a,u);return c[0]=-u[0],c[1]=-u[1],c[2]=-r,c[3]=u[0],c[4]=u[1],c[5]=s,d.add(h,p,a),d.sub(h,h,l),d.sub(h,h,o),h=this.firstImpact&&0!==this.restitution?(n=0,1/e*(1+this.restitution)*this.computeGW()):(n=d.dot(u,h)+this.offset,this.computeGW()),-n*t-h*e-i*this.computeGiMf()}},{"../math/vec2":30,"./Equation":22}],22:[function(t,e,i){function s(t,e,i,n){this.minForce=void 0===i?-Number.MAX_VALUE:i,this.maxForce=void 0===n?Number.MAX_VALUE:n,this.bodyA=t,this.bodyB=e,this.stiffness=s.DEFAULT_STIFFNESS,this.relaxation=s.DEFAULT_RELAXATION,this.G=new o.ARRAY_TYPE(6);for(var r=0;r<6;r++)this.G[r]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}e.exports=s;var u=t("../math/vec2"),o=t("../utils/Utils");t("../objects/Body");(s.prototype.constructor=s).DEFAULT_STIFFNESS=1e6,s.DEFAULT_RELAXATION=4,s.prototype.update=function(){var t=this.stiffness,e=this.relaxation,i=this.timeStep;this.a=4/(i*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(i*i*t*(1+4*e)),this.needsUpdate=!1},s.prototype.gmult=function(t,e,i,n,r){return t[0]*e[0]+t[1]*e[1]+t[2]*i+t[3]*n[0]+t[4]*n[1]+t[5]*r},s.prototype.computeB=function(t,e,i){var n=this.computeGW();return-this.computeGq()*t-n*e-this.computeGiMf()*i};var n=u.create(),r=u.create();s.prototype.computeGq=function(){var t=this.G,e=this.bodyA,i=this.bodyB,e=(e.position,i.position,e.angle),i=i.angle;return this.gmult(t,n,e,r,i)+this.offset},s.prototype.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,n=e.velocity,r=i.velocity,e=e.angularVelocity,i=i.angularVelocity;return this.gmult(t,n,e,r,i)+this.relativeVelocity},s.prototype.computeGWlambda=function(){var t=this.G,e=this.bodyA,i=this.bodyB,n=e.vlambda,r=i.vlambda,e=e.wlambda,i=i.wlambda;return this.gmult(t,n,e,r,i)};var c=u.create(),d=u.create();s.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,i=t.force,n=t.angularForce,r=e.force,s=e.angularForce,o=t.invMassSolve,a=e.invMassSolve,l=t.invInertiaSolve,p=e.invInertiaSolve,h=this.G;return u.scale(c,i,o),u.multiply(c,t.massMultiplier,c),u.scale(d,r,a),u.multiply(d,e.massMultiplier,d),this.gmult(h,c,n*l,d,s*p)},s.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,i=t.invMassSolve,n=e.invMassSolve,r=t.invInertiaSolve,s=e.invInertiaSolve,o=this.G;return o[0]*o[0]*i*t.massMultiplier[0]+o[1]*o[1]*i*t.massMultiplier[1]+o[2]*o[2]*r+o[3]*o[3]*n*e.massMultiplier[0]+o[4]*o[4]*n*e.massMultiplier[1]+o[5]*o[5]*s};var _=u.create(),y=u.create(),f=u.create();u.create(),u.create(),u.create();s.prototype.addToWlambda=function(t){var e=this.bodyA,i=this.bodyB,n=_,r=y,s=f,o=e.invMassSolve,a=i.invMassSolve,l=e.invInertiaSolve,p=i.invInertiaSolve,h=this.G;r[0]=h[0],r[1]=h[1],s[0]=h[3],s[1]=h[4],u.scale(n,r,o*t),u.multiply(n,n,e.massMultiplier),u.add(e.vlambda,e.vlambda,n),e.wlambda+=l*h[2]*t,u.scale(n,s,a*t),u.multiply(n,n,i.massMultiplier),u.add(i.vlambda,i.vlambda,n),i.wlambda+=p*h[5]*t},s.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(t,e,i){function n(t,e,i){r.call(this,t,e,-i,i),this.contactPointA=a.create(),this.contactPointB=a.create(),this.t=a.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var a=t("../math/vec2"),r=t("./Equation");t("../utils/Utils");(((e.exports=n).prototype=new r).constructor=n).prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},n.prototype.getSlipForce=function(){return this.maxForce},n.prototype.computeB=function(t,e,i){this.bodyA,this.bodyB;var n=this.contactPointA,r=this.contactPointB,s=this.t,o=this.G;return o[0]=-s[0],o[1]=-s[1],o[2]=-a.crossLength(n,s),o[3]=s[0],o[4]=s[1],o[5]=a.crossLength(r,s),-this.computeGW()*e-i*this.computeGiMf()}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0;i=this.G;i[2]=1,i[5]=-1}var r=t("./Equation"),s=t("../math/vec2");((e.exports=n).prototype=new r).constructor=n;var o=s.create(),a=s.create(),l=s.fromValues(1,0),p=s.fromValues(0,1);n.prototype.computeGq=function(){return s.rotate(o,l,this.bodyA.angle+this.angle),s.rotate(a,p,this.bodyB.angle),s.dot(o,a)}},{"../math/vec2":30,"./Equation":22}],25:[function(t,e,i){function n(t,e){r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var r=t("./Equation");t("../math/vec2");(((e.exports=n).prototype=new r).constructor=n).prototype.computeB=function(t,e,i){var n=this.G;n[2]=-1,n[5]=this.ratio;n=this.computeGiMf();return-this.computeGW()*e-i*n}},{"../math/vec2":30,"./Equation":22}],26:[function(t,e,i){function n(){}(e.exports=n).prototype={constructor:n,on:function(t,e,i){e.context=i||this,void 0===this._listeners&&(this._listeners={});i=this._listeners;return void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;if(e){if(void 0!==i[t]&&-1!==i[t].indexOf(e))return!0}else if(void 0!==i[t])return!0;return!1},off:function(t,e){if(void 0===this._listeners)return this;var i=this._listeners,e=i[t].indexOf(e);return-1!==e&&i[t].splice(e,1),this},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var i=0,n=e.length;i<n;i++){var r=e[i];r.call(r.context,t)}}return this}}},{}],27:[function(t,e,i){function n(t,e,i){if(i=i||{},!(t instanceof r&&e instanceof r))throw new Error("First two arguments must be Material instances.");this.id=n.idCounter++,this.materialA=t,this.materialB=e,this.friction=void 0!==i.friction?Number(i.friction):.3,this.restitution=void 0!==i.restitution?Number(i.restitution):0,this.stiffness=void 0!==i.stiffness?Number(i.stiffness):s.DEFAULT_STIFFNESS,this.relaxation=void 0!==i.relaxation?Number(i.relaxation):s.DEFAULT_RELAXATION,this.frictionStiffness=void 0!==i.frictionStiffness?Number(i.frictionStiffness):s.DEFAULT_STIFFNESS,this.frictionRelaxation=void 0!==i.frictionRelaxation?Number(i.frictionRelaxation):s.DEFAULT_RELAXATION,this.surfaceVelocity=void 0!==i.surfaceVelocity?Number(i.surfaceVelocity):0,this.contactSkinSize=.005}var r=t("./Material"),s=t("../equations/Equation");(e.exports=n).idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(t,e,i){function n(t){this.id=t||n.idCounter++}(e.exports=n).idCounter=0},{}],29:[function(t,e,i){var x={GetArea:function(t){if(t.length<6)return 0;for(var e=t.length-2,i=0,n=0;n<e;n+=2)i+=(t[n+2]-t[n])*(t[n+1]+t[n+3]);return.5*-(i+(t[0]-t[e])*(t[1+e]+t[1]))},Triangulate:function(t){var e=t.length>>1;if(e<3)return[];for(var i=[],n=[],r=0;r<e;r++)n.push(r);for(var r=0,s=e;3<s;){var o=n[(r+0)%s],a=n[(r+1)%s],l=n[(r+2)%s],p=t[2*o],h=t[2*o+1],u=t[2*a],c=t[2*a+1],d=t[2*l],_=t[2*l+1],y=!1;if(x._convex(p,h,u,c,d,_)){y=!0;for(var f=0;f<s;f++){var m=n[f];if(m!=o&&m!=a&&m!=l&&x._PointInTriangle(t[2*m],t[2*m+1],p,h,u,c,d,_)){y=!1;break}}}if(y)i.push(o,a,l),n.splice((r+1)%s,1),s--,r=0;else if(r++>3*s)break}return i.push(n[0],n[1],n[2]),i},_PointInTriangle:function(t,e,i,n,r,s,o,a){o-=i,a-=n,r-=i,s-=n,t-=i,i=e-n,e=o*o+a*a,n=o*r+a*s,o=o*t+a*i,a=r*r+s*s,s=r*t+s*i,i=1/(e*a-n*n),a=(a*o-n*s)*i,i*=e*s-n*o;return 0<=a&&0<=i&&a+i<1},_convex:function(t,e,i,n,r,s){return 0<=(e-n)*(r-i)+(i-t)*(s-n)}};e.exports=x},{}],30:[function(t,e,i){var s=e.exports={},n=t("../utils/Utils");s.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},s.crossVZ=function(t,e,i){return s.rotate(t,e,-Math.PI/2),s.scale(t,t,i),t},s.crossZV=function(t,e,i){return s.rotate(t,i,Math.PI/2),s.scale(t,t,e),t},s.rotate=function(t,e,i){var n,r,s;0!==i?(n=Math.cos(i),r=Math.sin(i),s=e[0],i=e[1],t[0]=n*s-r*i,t[1]=r*s+n*i):(t[0]=e[0],t[1]=e[1])},s.rotate90cw=function(t,e){var i=e[0],e=e[1];t[0]=e,t[1]=-i},s.toLocalFrame=function(t,e,i,n){s.copy(t,e),s.sub(t,t,i),s.rotate(t,t,-n)},s.toGlobalFrame=function(t,e,i,n){s.copy(t,e),s.rotate(t,t,n),s.add(t,t,i)},s.vectorToLocalFrame=function(t,e,i){s.rotate(t,e,-i)},s.vectorToGlobalFrame=function(t,e,i){s.rotate(t,e,i)},s.centroid=function(t,e,i,n){return s.add(t,e,i),s.add(t,t,n),s.scale(t,t,1/3),t},s.create=function(){var t=new n.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},s.clone=function(t){var e=new n.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},s.fromValues=function(t,e){var i=new n.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},s.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},s.set=function(t,e,i){return t[0]=e,t[1]=i,t},s.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},s.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},s.sub=s.subtract,s.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},s.mul=s.multiply,s.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},s.div=s.divide,s.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},s.distance=function(t,e){var i=e[0]-t[0],t=e[1]-t[1];return Math.sqrt(i*i+t*t)},s.dist=s.distance,s.squaredDistance=function(t,e){var i=e[0]-t[0],t=e[1]-t[1];return i*i+t*t},s.sqrDist=s.squaredDistance,s.length=function(t){var e=t[0],t=t[1];return Math.sqrt(e*e+t*t)},s.len=s.length,s.squaredLength=function(t){var e=t[0],t=t[1];return e*e+t*t},s.sqrLen=s.squaredLength,s.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},s.normalize=function(t,e){var i=e[0],n=e[1],n=i*i+n*n;return 0<n&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},s.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},s.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},s.lerp=function(t,e,i,n){var r=e[0],e=e[1];return t[0]=r+n*(i[0]-r),t[1]=e+n*(i[1]-e),t},s.reflect=function(t,e,i){var n=e[0]*i[0]+e[1]*i[1];t[0]=e[0]-2*i[0]*n,t[1]=e[1]-2*i[1]*n},s.getLineSegmentsIntersection=function(t,e,i,n,r){r=s.getLineSegmentsIntersectionFraction(e,i,n,r);return!(r<0||(t[0]=e[0]+r*(i[0]-e[0]),t[1]=e[1]+r*(i[1]-e[1]),0))},s.getLineSegmentsIntersectionFraction=function(t,e,i,n){var r=e[0]-t[0],s=e[1]-t[1],o=n[0]-i[0],e=n[1]-i[1],n=(-s*(t[0]-i[0])+r*(t[1]-i[1]))/(-o*s+r*e),e=(o*(t[1]-i[1])-e*(t[0]-i[0]))/(-o*s+r*e);return 0<=n&&n<=1&&0<=e&&e<=1?e:-1}},{"../utils/Utils":57}],31:[function(t,e,i){function a(t){t=t||{},o.call(this),this.id=t.id||++a._idCounter,this.world=null,this.shapes=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation,this.fixedX=!!t.fixedX,this.fixedY=!!t.fixedY,this.massMultiplier=u.create(),this.position=u.fromValues(0,0),t.position&&u.copy(this.position,t.position),this.interpolatedPosition=u.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=u.fromValues(0,0),this.previousAngle=0,this.velocity=u.fromValues(0,0),t.velocity&&u.copy(this.velocity,t.velocity),this.vlambda=u.fromValues(0,0),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=u.create(),t.force&&u.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.damping="number"==typeof t.damping?t.damping:.1,this.angularDamping="number"==typeof t.angularDamping?t.angularDamping:.1,this.type=a.STATIC,void 0!==t.type?this.type=t.type:t.mass?this.type=a.DYNAMIC:this.type=a.STATIC,this.boundingRadius=0,this.aabb=new s,this.aabbNeedsUpdate=!0,this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.wantsToSleep=!1,this.sleepState=a.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.gravityScale=void 0!==t.gravityScale?t.gravityScale:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==t.ccdSpeedThreshold?t.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==t.ccdIterations?t.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var u=t("../math/vec2"),p=t("poly-decomp"),h=t("../shapes/Convex"),n=t("../collision/RaycastResult"),r=t("../collision/Ray"),s=t("../collision/AABB"),o=t("../events/EventEmitter");(e.exports=a).prototype=new o,(a.prototype.constructor=a)._idCounter=0,a.prototype.updateSolveMassProperties=function(){this.sleepState===a.SLEEPING||this.type===a.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},a.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},a.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},a.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var l=new s,c=u.create();a.prototype.updateAABB=function(){for(var t=this.shapes,e=t.length,i=c,n=this.angle,r=0;r!==e;r++){var s=t[r],o=s.angle+n;u.rotate(i,s.position,n),u.add(i,i,this.position),s.computeAABB(l,i,o),0===r?this.aabb.copy(l):this.aabb.extend(l)}this.aabbNeedsUpdate=!1},a.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=t.length,i=0,n=0;n!==e;n++){var r=t[n],s=u.length(r.position),r=r.boundingRadius;i<s+r&&(i=s+r)}this.boundingRadius=i},a.prototype.addShape=function(t,e,i){if(t.body)throw new Error("A shape can only be added to one body.");t.body=this,e?u.copy(t.position,e):u.set(t.position,0,0),t.angle=i||0,this.shapes.push(t),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},a.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);return-1!==e&&(this.shapes.splice(e,1),this.aabbNeedsUpdate=!0,!(t.body=null))},a.prototype.updateMassProperties=function(){if(this.type===a.STATIC||this.type===a.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,i=this.mass/e,n=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var r=0;r<e;r++){var s=t[r],o=u.squaredLength(s.position);n+=s.computeMomentOfInertia(i)+i*o}this.inertia=n,this.invInertia=0<n?1/n:0}this.invMass=1/this.mass,u.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};u.create();a.prototype.applyForce=function(t,e){u.add(this.force,this.force,t),e&&(t=u.crossLength(e,t),this.angularForce+=t)};var d=u.create(),_=u.create(),y=u.create();a.prototype.applyForceLocal=function(t,e){e=e||y;var i=d,n=_;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(n,e),this.applyForce(i,n)};var f=u.create();a.prototype.applyImpulse=function(t,e){var i;this.type===a.DYNAMIC&&(i=f,u.scale(i,t,this.invMass),u.multiply(i,this.massMultiplier,i),u.add(this.velocity,i,this.velocity),e&&(t=u.crossLength(e,t),t*=this.invInertia,this.angularVelocity+=t))};var m=u.create(),x=u.create(),v=u.create();a.prototype.applyImpulseLocal=function(t,e){e=e||v;var i=m,n=x;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(n,e),this.applyImpulse(i,n)},a.prototype.toLocalFrame=function(t,e){u.toLocalFrame(t,e,this.position,this.angle)},a.prototype.toWorldFrame=function(t,e){u.toGlobalFrame(t,e,this.position,this.angle)},a.prototype.vectorToLocalFrame=function(t,e){u.vectorToLocalFrame(t,e,this.angle)},a.prototype.vectorToWorldFrame=function(t,e){u.vectorToGlobalFrame(t,e,this.angle)},a.prototype.fromPolygon=function(t,e){e=e||{};for(var i=this.shapes.length;0<=i;--i)this.removeShape(this.shapes[i]);var n=new p.Polygon;if(n.vertices=t,n.makeCCW(),"number"==typeof e.removeCollinearPoints&&n.removeCollinearPoints(e.removeCollinearPoints),void 0===e.skipSimpleCheck&&!n.isSimple())return!1;this.concavePath=n.vertices.slice(0);for(var r,i=0;i<this.concavePath.length;i++){var s=[0,0];u.copy(s,this.concavePath[i]),this.concavePath[i]=s}r=e.optimalDecomp?n.decomp():n.quickDecomp();for(var o=u.create(),i=0;i!==r.length;i++){for(var a=new h({vertices:r[i].vertices}),l=0;l!==a.vertices.length;l++){s=a.vertices[l];u.sub(s,s,a.centerOfMass)}u.scale(o,a.centerOfMass,1),a.updateTriangles(),a.updateCenterOfMass(),a.updateBoundingRadius(),this.addShape(a,o)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0};u.fromValues(0,0);var g=u.fromValues(0,0),b=u.fromValues(0,0),z=u.fromValues(0,0);a.prototype.adjustCenterOfMass=function(){var t=g,e=b,i=z,n=0;u.set(e,0,0);for(var r=0;r!==this.shapes.length;r++){var s=this.shapes[r];u.scale(t,s.position,s.area),u.add(e,e,t),n+=s.area}u.scale(i,e,1/n);for(r=0;r!==this.shapes.length;r++){s=this.shapes[r];u.sub(s.position,s.position,i)}u.add(this.position,this.position,i);for(r=0;this.concavePath&&r<this.concavePath.length;r++)u.sub(this.concavePath[r],this.concavePath[r],i);this.updateMassProperties(),this.updateBoundingRadius()},a.prototype.setZeroForce=function(){u.set(this.force,0,0),this.angularForce=0},a.prototype.resetConstraintVelocity=function(){var t=this.vlambda;u.set(t,0,0),this.wlambda=0},a.prototype.addConstraintVelocity=function(){var t=this.velocity;u.add(t,t,this.vlambda),this.angularVelocity+=this.wlambda},a.prototype.applyDamping=function(t){var e;this.type===a.DYNAMIC&&(e=this.velocity,u.scale(e,e,Math.pow(1-this.damping,t)),this.angularVelocity*=Math.pow(1-this.angularDamping,t))},a.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=a.AWAKE,this.idleTime=0,t!==a.AWAKE&&this.emit(a.wakeUpEvent)},a.prototype.sleep=function(){this.sleepState=a.SLEEPING,this.angularVelocity=0,this.angularForce=0,u.set(this.velocity,0,0),u.set(this.force,0,0),this.emit(a.sleepEvent)},a.prototype.sleepTick=function(t,e,i){this.allowSleep&&this.type!==a.SLEEPING&&(this.wantsToSleep=!1,this.sleepState,u.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)>=Math.pow(this.sleepSpeedLimit,2)?(this.idleTime=0,this.sleepState=a.AWAKE):(this.idleTime+=i,this.sleepState=a.SLEEPY),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep()))},a.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var w=u.create(),C=u.create();a.prototype.integrate=function(t){var e=this.invMass,i=this.force,n=this.position,r=this.velocity;u.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*t),u.scale(w,i,t*e),u.multiply(w,this.massMultiplier,w),u.add(r,w,r),this.integrateToTimeOfImpact(t)||(u.scale(C,r,t),u.add(n,n,C),this.fixedRotation||(this.angle+=this.angularVelocity*t)),this.aabbNeedsUpdate=!0};var P=new n,T=new r({mode:r.ALL}),S=u.create(),M=u.create(),A=u.create(),O=u.create();a.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||u.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;u.normalize(S,this.velocity),u.scale(M,this.velocity,t),u.add(M,M,this.position),u.sub(A,M,this.position);var e,i=this.angularVelocity*t,n=u.length(A),r=1,s=this;if(P.reset(),T.callback=function(t){t.body!==s&&(e=t.body,t.getHitPoint(M,T),u.sub(A,M,s.position),r=u.length(A)/n,t.stop())},u.copy(T.from,this.position),u.copy(T.to,M),T.update(),this.world.raycast(P,T),!e)return!1;var o=this.angle;u.copy(O,this.position);for(var a=0,l=0,p=0,h=r;l<=h&&a<this.ccdIterations;)a++,p=(h-l)/2,u.scale(C,A,r),u.add(this.position,O,C),this.angle=o+i*r,this.updateAABB(),this.aabb.overlaps(e.aabb)&&this.world.narrowphase.bodiesOverlap(this,e)?l=p:h=p;return r=p,u.copy(this.position,O),this.angle=o,u.scale(C,A,r),u.add(this.position,this.position,C),this.fixedRotation||(this.angle+=i*r),!0},a.prototype.getVelocityAtPoint=function(t,e){return u.crossVZ(t,e,this.angularVelocity),u.subtract(t,this.velocity,t),t},a.sleepyEvent={type:"sleepy"},a.sleepEvent={type:"sleep"},a.wakeUpEvent={type:"wakeup"},a.DYNAMIC=1,a.STATIC=2,a.KINEMATIC=4,a.AWAKE=0,a.SLEEPY=1,a.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,i),this.localAnchorA=_.fromValues(0,0),this.localAnchorB=_.fromValues(0,0),i.localAnchorA&&_.copy(this.localAnchorA,i.localAnchorA),i.localAnchorB&&_.copy(this.localAnchorB,i.localAnchorB),i.worldAnchorA&&this.setWorldAnchorA(i.worldAnchorA),i.worldAnchorB&&this.setWorldAnchorB(i.worldAnchorB);t=_.create(),e=_.create();this.getWorldAnchorA(t),this.getWorldAnchorB(e);e=_.distance(t,e);this.restLength="number"==typeof i.restLength?i.restLength:e}var _=t("../math/vec2"),r=t("./Spring");t("../utils/Utils");(((e.exports=n).prototype=new r).constructor=n).prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},n.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},n.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},n.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var y=_.create(),f=_.create(),m=_.create(),x=_.create(),v=_.create(),g=_.create(),b=_.create(),z=_.create(),w=_.create();n.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restLength,n=this.bodyA,r=this.bodyB,s=y,o=f,a=m,l=x,p=w,h=v,u=g,c=b,d=z;this.getWorldAnchorA(h),this.getWorldAnchorB(u),_.sub(c,h,n.position),_.sub(d,u,r.position),_.sub(s,u,h);h=_.len(s);_.normalize(o,s),_.sub(a,r.velocity,n.velocity),_.crossZV(p,r.angularVelocity,d),_.add(a,a,p),_.crossZV(p,n.angularVelocity,c),_.sub(a,a,p),_.scale(l,o,-t*(h-i)-e*_.dot(a,o)),_.sub(n.force,n.force,l),_.add(r.force,r.force,l);c=_.crossLength(c,l),l=_.crossLength(d,l);n.angularForce-=c,r.angularForce+=l}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,t,e,i),this.restAngle="number"==typeof i.restAngle?i.restAngle:e.angle-t.angle}t("../math/vec2");var r=t("./Spring");(((e.exports=n).prototype=new r).constructor=n).prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restAngle,n=this.bodyA,r=this.bodyB,e=-t*(r.angle-n.angle-i)-e*(r.angularVelocity-n.angularVelocity)*0;n.angularForce-=e,r.angularForce+=e}},{"../math/vec2":30,"./Spring":34}],34:[function(t,e,i){function n(t,e,i){i=r.defaults(i,{stiffness:100,damping:1}),this.stiffness=i.stiffness,this.damping=i.damping,this.bodyA=t,this.bodyB=e}t("../math/vec2");var r=t("../utils/Utils");(e.exports=n).prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(t,e,i){function n(t,e){this.chassisBody=t,this.wheels=[],this.groundBody=new l({mass:0}),this.world=null;var i=this;this.preStepCallback=function(){i.update()}}function r(t,e){e=e||{},this.vehicle=t,this.forwardEquation=new a(t.chassisBody,t.groundBody),this.sideEquation=new a(t.chassisBody,t.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==e.sideFriction?e.sideFriction:5),this.localForwardVector=s.fromValues(0,1),e.localForwardVector&&s.copy(this.localForwardVector,e.localForwardVector),this.localPosition=s.fromValues(0,0),e.localPosition&&s.copy(this.localPosition,e.localPosition),o.apply(this,t.chassisBody,t.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}var s=t("../math/vec2"),o=(t("../utils/Utils"),t("../constraints/Constraint")),a=t("../equations/FrictionEquation"),l=t("../objects/Body");(e.exports=n).prototype.addToWorld=function(t){(this.world=t).addBody(this.groundBody),t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.addConstraint(i)}},n.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody),t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.removeConstraint(i)}this.world=null},n.prototype.addWheel=function(t){t=new r(this,t);return this.wheels.push(t),t},n.prototype.update=function(){for(var t=0;t<this.wheels.length;t++)this.wheels[t].update()},(r.prototype=new o).setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)},r.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var p=s.create(),h=s.create();r.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(h,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(p,h),s.dot(p,h)};var u=s.create();r.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),s.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),s.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),s.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),s.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),s.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),s.normalize(u,this.forwardEquation.t),s.scale(u,u,this.engineForce),this.vehicle.chassisBody.applyForce(u,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(t,e,i){t=e.exports={AABB:t("./collision/AABB"),AngleLockEquation:t("./equations/AngleLockEquation"),Body:t("./objects/Body"),Broadphase:t("./collision/Broadphase"),Capsule:t("./shapes/Capsule"),Circle:t("./shapes/Circle"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),ContactEquationPool:t("./utils/ContactEquationPool"),ContactMaterial:t("./material/ContactMaterial"),Convex:t("./shapes/Convex"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventEmitter:t("./events/EventEmitter"),FrictionEquation:t("./equations/FrictionEquation"),FrictionEquationPool:t("./utils/FrictionEquationPool"),GearConstraint:t("./constraints/GearConstraint"),GSSolver:t("./solver/GSSolver"),Heightfield:t("./shapes/Heightfield"),Line:t("./shapes/Line"),LockConstraint:t("./constraints/LockConstraint"),Material:t("./material/Material"),Narrowphase:t("./collision/Narrowphase"),NaiveBroadphase:t("./collision/NaiveBroadphase"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),Pool:t("./utils/Pool"),RevoluteConstraint:t("./constraints/RevoluteConstraint"),PrismaticConstraint:t("./constraints/PrismaticConstraint"),Ray:t("./collision/Ray"),RaycastResult:t("./collision/RaycastResult"),Box:t("./shapes/Box"),RotationalVelocityEquation:t("./equations/RotationalVelocityEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Spring:t("./objects/Spring"),TopDownVehicle:t("./objects/TopDownVehicle"),LinearSpring:t("./objects/LinearSpring"),RotationalSpring:t("./objects/RotationalSpring"),Utils:t("./utils/Utils"),World:t("./world/World"),vec2:t("./math/vec2"),version:t("../package.json").version};Object.defineProperty(t,"Rectangle",{get:function(){return this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(t,e,i){function n(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={width:arguments[0],height:arguments[1]}),t=t||{};var e=this.width=t.width||1,i=this.height=t.height||1,e=[r.fromValues(-e/2,-i/2),r.fromValues(e/2,-i/2),r.fromValues(e/2,i/2),r.fromValues(-e/2,i/2)],i=[r.fromValues(1,0),r.fromValues(0,1)];t.vertices=e,t.axes=i,t.type=s.BOX,o.call(this,t)}var r=t("../math/vec2"),s=t("./Shape"),o=t("./Convex");(((e.exports=n).prototype=new o).constructor=n).prototype.computeMomentOfInertia=function(t){var e=this.width,i=this.height;return t*(i*i+e*e)/12},n.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2};r.create(),r.create(),r.create(),r.create();n.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)},n.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(t,e,i){function n(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={length:arguments[0],radius:arguments[1]}),t=t||{},this.length=t.length||1,this.radius=t.radius||1,t.type=r.CAPSULE,r.call(this,t)}var r=t("./Shape"),v=t("../math/vec2");(((e.exports=n).prototype=new r).constructor=n).prototype.computeMomentOfInertia=function(t){var e=this.radius,i=this.length+e,e=2*e;return t*(e*e+i*i)/12},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},n.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var s=v.create();n.prototype.computeAABB=function(t,e,i){var n=this.radius;v.set(s,this.length/2,0),0!==i&&v.rotate(s,s,i),v.set(t.upperBound,Math.max(s[0]+n,-s[0]+n),Math.max(s[1]+n,-s[1]+n)),v.set(t.lowerBound,Math.min(s[0]-n,-s[0]-n),Math.min(s[1]-n,-s[1]-n)),v.add(t.lowerBound,t.lowerBound,e),v.add(t.upperBound,t.upperBound,e)};var g=v.create(),b=v.create(),z=v.create(),w=v.create(),C=v.fromValues(0,1);n.prototype.raycast=function(t,e,i,n){for(var r=e.from,s=e.to,o=(e.direction,g),a=b,l=z,p=w,h=this.length/2,u=0;u<2;u++){var c=this.radius*(2*u-1);if(v.set(l,-h,c),v.set(p,h,c),v.toGlobalFrame(l,l,i,n),v.toGlobalFrame(p,p,i,n),0<=(_=v.getLineSegmentsIntersectionFraction(r,s,l,p))&&(v.rotate(a,C,n),v.scale(a,a,2*u-1),e.reportIntersection(t,_,a,-1),t.shouldStop(e)))return}for(var d=Math.pow(this.radius,2)+Math.pow(h,2),u=0;u<2;u++){v.set(l,h*(2*u-1),0),v.toGlobalFrame(l,l,i,n);var _,y=Math.pow(s[0]-r[0],2)+Math.pow(s[1]-r[1],2),f=2*((s[0]-r[0])*(r[0]-l[0])+(s[1]-r[1])*(r[1]-l[1])),m=Math.pow(r[0]-l[0],2)+Math.pow(r[1]-l[1],2)-Math.pow(this.radius,2);if(!((_=Math.pow(f,2)-4*y*m)<0))if(0===_){if(v.lerp(o,r,s,_),v.squaredDistance(o,i)>d&&(v.sub(a,o,l),v.normalize(a,a),e.reportIntersection(t,_,a,-1),t.shouldStop(e)))return}else{var x=Math.sqrt(_),m=1/(2*y),y=(-f-x)*m,m=(-f+x)*m;if(0<=y&&y<=1&&(v.lerp(o,r,s,y),v.squaredDistance(o,i)>d&&(v.sub(a,o,l),v.normalize(a,a),e.reportIntersection(t,y,a,-1),t.shouldStop(e))))return;if(0<=m&&m<=1&&(v.lerp(o,r,s,m),v.squaredDistance(o,i)>d&&(v.sub(a,o,l),v.normalize(a,a),e.reportIntersection(t,m,a,-1),t.shouldStop(e))))return}}}},{"../math/vec2":30,"./Shape":45}],39:[function(t,e,i){function n(t){"number"==typeof arguments[0]&&(t={radius:arguments[0]}),t=t||{},this.radius=t.radius||1,t.type=r.CIRCLE,r.call(this,t)}var r=t("./Shape"),c=t("../math/vec2");(((e.exports=n).prototype=new r).constructor=n).prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},n.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},n.prototype.computeAABB=function(t,e,i){var n=this.radius;c.set(t.upperBound,n,n),c.set(t.lowerBound,-n,-n),e&&(c.add(t.lowerBound,t.lowerBound,e),c.add(t.upperBound,t.upperBound,e))};var d=c.create(),_=c.create();n.prototype.raycast=function(t,e,i,n){var r=e.from,s=e.to,o=this.radius,a=Math.pow(s[0]-r[0],2)+Math.pow(s[1]-r[1],2),l=2*((s[0]-r[0])*(r[0]-i[0])+(s[1]-r[1])*(r[1]-i[1])),p=Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2)-Math.pow(o,2),h=Math.pow(l,2)-4*a*p,u=d,o=_;h<0||(0==h?(c.lerp(u,r,s,h),c.sub(o,u,i),c.normalize(o,o),e.reportIntersection(t,h,o,-1)):(a=(-l+(p=Math.sqrt(h)))*(h=1/(2*a)),0<=(h=(-l-p)*h)&&h<=1&&(c.lerp(u,r,s,h),c.sub(o,u,i),c.normalize(o,o),e.reportIntersection(t,h,o,-1),t.shouldStop(e))||0<=a&&a<=1&&(c.lerp(u,r,s,a),c.sub(o,u,i),c.normalize(o,o),e.reportIntersection(t,a,o,-1))))}},{"../math/vec2":30,"./Shape":45}],40:[function(t,e,i){function u(t){Array.isArray(arguments[0])&&(t={vertices:arguments[0],axes:arguments[1]}),t=t||{},this.vertices=[];for(var e=void 0!==t.vertices?t.vertices:[],i=0;i<e.length;i++){var n=d.create();d.copy(n,e[i]),this.vertices.push(n)}if(this.axes=[],t.axes)for(i=0;i<t.axes.length;i++){var r=d.create();d.copy(r,t.axes[i]),this.axes.push(r)}else for(i=0;i<this.vertices.length;i++){var s=this.vertices[i],o=this.vertices[(i+1)%this.vertices.length],a=d.create();d.sub(a,o,s),d.rotate90cw(a,a),d.normalize(a,a),this.axes.push(a)}if(this.centerOfMass=d.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,t.type=l.CONVEX,l.call(this,t),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var l=t("./Shape"),d=t("../math/vec2"),a=t("../math/polyk");t("poly-decomp");((e.exports=u).prototype=new l).constructor=u;var p=d.create(),s=d.create();u.prototype.projectOntoLocalAxis=function(t,e){for(var i,n,r=null,s=null,t=p,o=0;o<this.vertices.length;o++)i=this.vertices[o],i=d.dot(i,t),(null===r||r<i)&&(r=i),(null===s||i<s)&&(s=i);r<s&&(n=s,s=r,r=n),d.set(e,s,r)},u.prototype.projectOntoWorldAxis=function(t,e,i,n){var r=s;this.projectOntoLocalAxis(t,n),0!==i?d.rotate(r,t,i):r=t;r=d.dot(e,r);d.set(n,n[0]+r,n[1]+r)},u.prototype.updateTriangles=function(){for(var t=[],e=this.triangles.length=0;e<this.vertices.length;e++){var i=this.vertices[e];t.push(i[0],i[1])}for(var n=a.Triangulate(t),e=0;e<n.length;e+=3){var r=n[e],s=n[e+1],o=n[e+2];this.triangles.push([r,s,o])}};var c=d.create(),_=d.create();d.create(),d.create(),d.create(),d.create(),d.create(),d.create(),d.create();u.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,i=this.centerOfMass,n=c,r=_;d.set(i,0,0);for(var s=0,o=0;o!==t.length;o++){var a=t[o],l=e[a[0]],p=e[a[1]],h=e[a[2]];d.centroid(n,l,p,h);a=u.triangleArea(l,p,h);s+=a,d.scale(r,n,a),d.add(i,i,r)}d.scale(i,i,1/s)},u.prototype.computeMomentOfInertia=function(t){for(var e=0,i=0,n=this.vertices.length,r=n-1,s=0;s<n;r=s,s++){var o=this.vertices[r],a=this.vertices[s],l=Math.abs(d.crossLength(o,a));e+=l*(d.dot(a,a)+d.dot(a,o)+d.dot(o,o)),i+=l}return t/6*(e/i)},u.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,i=0;i!==t.length;i++){var n=d.squaredLength(t[i]);e<n&&(e=n)}this.boundingRadius=Math.sqrt(e)},u.triangleArea=function(t,e,i){return.5*((e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1]))},u.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,i=0;i!==t.length;i++){var n=t[i],r=e[n[0]],s=e[n[1]],n=e[n[2]],n=u.triangleArea(r,s,n);this.area+=n}},u.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)};var y=d.create(),f=d.create(),m=d.create();u.prototype.raycast=function(t,e,i,n){var r=y,s=f,o=m,a=this.vertices;d.toLocalFrame(r,e.from,i,n),d.toLocalFrame(s,e.to,i,n);for(var l=a.length,p=0;p<l&&!t.shouldStop(e);p++){var h=a[p],u=a[(p+1)%l],c=d.getLineSegmentsIntersectionFraction(r,s,h,u);0<=c&&(d.sub(o,u,h),d.rotate(o,o,-Math.PI/2+n),d.normalize(o,o),e.reportIntersection(t,c,o,p))}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(t,e,i){function n(t){if(Array.isArray(arguments[0])&&(t={heights:arguments[0]},"object"==typeof arguments[1]))for(var e in arguments[1])t[e]=arguments[1][e];t=t||{},this.heights=t.heights?t.heights.slice(0):[],this.maxValue=t.maxValue||null,this.minValue=t.minValue||null,this.elementWidth=t.elementWidth||.1,void 0!==t.maxValue&&void 0!==t.minValue||this.updateMaxMinValues(),t.type=r.HEIGHTFIELD,r.call(this,t)}var r=t("./Shape"),d=t("../math/vec2");t("../utils/Utils");(((e.exports=n).prototype=new r).constructor=n).prototype.updateMaxMinValues=function(){for(var t=this.heights,e=t[0],i=t[0],n=0;n!==t.length;n++){var r=t[n];e<r&&(e=r),r<i&&(i=r)}this.maxValue=e,this.minValue=i},n.prototype.computeMomentOfInertia=function(t){return Number.MAX_VALUE},n.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},n.prototype.updateArea=function(){for(var t=this.heights,e=0,i=0;i<t.length-1;i++)e+=(t[i]+t[i+1])/2*this.elementWidth;this.area=e};var s=[d.create(),d.create(),d.create(),d.create()];n.prototype.computeAABB=function(t,e,i){d.set(s[0],0,this.maxValue),d.set(s[1],this.elementWidth*this.heights.length,this.maxValue),d.set(s[2],this.elementWidth*this.heights.length,this.minValue),d.set(s[3],0,this.minValue),t.setFromPoints(s,e,i)},n.prototype.getLineSegment=function(t,e,i){var n=this.heights,r=this.elementWidth;d.set(t,i*r,n[i]),d.set(e,(i+1)*r,n[i+1])},n.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)},n.prototype.getClampedSegmentIndex=function(t){t=this.getSegmentIndex(t);return Math.min(this.heights.length,Math.max(t,0))};d.create();var _=d.create(),y=d.create(),f=d.create(),m=d.create(),x=d.create();d.fromValues(0,1);n.prototype.raycast=function(t,e,i,n){var r=e.from,s=e.to,o=(e.direction,_),a=y,l=f,p=m,h=x;d.toLocalFrame(p,r,i,n),d.toLocalFrame(h,s,i,n);r=this.getClampedSegmentIndex(p),s=this.getClampedSegmentIndex(h);s<r&&(i=r,r=s,s=i);for(var u=0;u<this.heights.length-1;u++){this.getLineSegment(a,l,u);var c=d.getLineSegmentsIntersectionFraction(p,h,a,l);if(0<=c&&(d.sub(o,l,a),d.rotate(o,o,n+Math.PI/2),d.normalize(o,o),e.reportIntersection(t,c,o,-1),t.shouldStop(e)))return}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(t,e,i){function n(t){"number"==typeof arguments[0]&&(t={length:arguments[0]}),t=t||{},this.length=t.length||1,t.type=r.LINE,r.call(this,t)}var r=t("./Shape"),p=t("../math/vec2");(((e.exports=n).prototype=new r).constructor=n).prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var s=[p.create(),p.create()];n.prototype.computeAABB=function(t,e,i){var n=this.length/2;p.set(s[0],-n,0),p.set(s[1],n,0),t.setFromPoints(s,e,i,0)};p.create();var h=p.create(),u=p.create(),c=p.create(),d=p.fromValues(0,1);n.prototype.raycast=function(t,e,i,n){var r=e.from,s=e.to,o=u,a=c,l=this.length/2;p.set(o,-l,0),p.set(a,l,0),p.toGlobalFrame(o,o,i,n),p.toGlobalFrame(a,a,i,n);r=p.getLineSegmentsIntersectionFraction(o,a,r,s);0<=r&&(s=h,p.rotate(s,d,n),e.reportIntersection(t,r,s,-1))}},{"../math/vec2":30,"./Shape":45}],43:[function(t,e,i){function n(t){(t=t||{}).type=r.PARTICLE,r.call(this,t)}var r=t("./Shape"),s=t("../math/vec2");(((e.exports=n).prototype=new r).constructor=n).prototype.computeMomentOfInertia=function(t){return 0},n.prototype.updateBoundingRadius=function(){this.boundingRadius=0},n.prototype.computeAABB=function(t,e,i){s.copy(t.lowerBound,e),s.copy(t.upperBound,e)}},{"../math/vec2":30,"./Shape":45}],44:[function(t,e,i){function n(t){(t=t||{}).type=r.PLANE,r.call(this,t)}var r=t("./Shape"),h=t("../math/vec2");t("../utils/Utils");(((e.exports=n).prototype=new r).constructor=n).prototype.computeMomentOfInertia=function(t){return 0},n.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},n.prototype.computeAABB=function(t,e,i){var n=i%(2*Math.PI),r=h.set,s=Number.MAX_VALUE,i=t.lowerBound,t=t.upperBound;0==n?(r(i,-s,-s),r(t,s,0)):n==Math.PI/2?(r(i,0,-s),r(t,s,s)):n===Math.PI?(r(i,-s,0),r(t,s,s)):n==3*Math.PI/2?(r(i,-s,-s),r(t,0,s)):(r(i,-s,-s),r(t,s,s)),h.add(i,i,e),h.add(t,t,e)},n.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var u=h.create(),c=(h.create(),h.create(),h.create()),d=h.create();n.prototype.raycast=function(t,e,i,n){var r=e.from,s=e.to,o=e.direction,a=u,l=c,p=d;h.set(l,0,1),h.rotate(l,l,n),h.sub(p,r,i);n=h.dot(p,l);h.sub(p,s,i),0<n*h.dot(p,l)||h.squaredDistance(r,s)<n*n||(o=h.dot(l,o),h.sub(a,r,i),o=-h.dot(l,a)/o/e.length,e.reportIntersection(t,o,l,-1))}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(t,e,i){function n(t){t=t||{},this.body=null,this.position=r.fromValues(0,0),t.position&&r.copy(this.position,t.position),this.angle=t.angle||0,this.type=t.type||0,this.id=n.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:1,this.material=t.material||null,this.area=0,this.sensor=void 0!==t.sensor&&t.sensor,this.type&&this.updateBoundingRadius(),this.updateArea()}e.exports=n;var r=t("../math/vec2");n.idCounter=0,n.CIRCLE=1,n.PARTICLE=2,n.PLANE=4,n.CONVEX=8,n.LINE=16,n.BOX=32,Object.defineProperty(n,"RECTANGLE",{get:function(){return n.BOX}}),n.CAPSULE=64,n.HEIGHTFIELD=128,n.prototype.computeMomentOfInertia=function(t){},n.prototype.updateBoundingRadius=function(){},n.prototype.updateArea=function(){},n.prototype.computeAABB=function(t,e,i){},n.prototype.raycast=function(t,e,i,n){}},{"../math/vec2":30}],46:[function(t,e,i){function z(t){n.call(this,t,n.GS),t=t||{},this.iterations=t.iterations||10,this.tolerance=t.tolerance||1e-7,this.arrayStep=30,this.lambda=new C.ARRAY_TYPE(this.arrayStep),this.Bs=new C.ARRAY_TYPE(this.arrayStep),this.invCs=new C.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=0,this.usedIterations=0}var w=t("../math/vec2"),n=t("./Solver"),C=t("../utils/Utils"),P=t("../equations/FrictionEquation");(((e.exports=z).prototype=new n).constructor=z).prototype.solve=function(t,e){this.sortEquations();var i=0,n=this.iterations,r=this.frictionIterations,s=this.equations,o=s.length,a=Math.pow(this.tolerance*o,2),l=e.bodies,p=e.bodies.length,h=(w.add,w.set,this.useZeroRHS),u=this.lambda;if(this.usedIterations=0,o)for(var c=0;c!==p;c++)l[c].updateSolveMassProperties();u.length<o&&(u=this.lambda=new C.ARRAY_TYPE(o+this.arrayStep),this.Bs=new C.ARRAY_TYPE(o+this.arrayStep),this.invCs=new C.ARRAY_TYPE(o+this.arrayStep)),function(t){for(var e=t.length;e--;)t[e]=0}(u);for(var d,_,y,f=this.invCs,m=this.Bs,u=this.lambda,c=0;c!==s.length;c++)(d=s[c]).timeStep===t&&!d.needsUpdate||(d.timeStep=t,d.update()),m[c]=d.computeB(d.a,d.b,t),f[c]=d.computeInvC(d.epsilon);if(0!==o){for(c=0;c!==p;c++)l[c].resetConstraintVelocity();if(r){for(i=0;i!==r;i++){for(y=_=0;y!==o;y++){d=s[y];var x=z.iterateEquation(y,d,d.epsilon,m,f,u,h,t,i);_+=Math.abs(x)}if(this.usedIterations++,_*_<=a)break}for(z.updateMultipliers(s,u,1/t),y=0;y!==o;y++){var v=s[y];if(v instanceof P){for(var g=0,b=0;b!==v.contactEquations.length;b++)g+=v.contactEquations[b].multiplier;g*=v.frictionCoefficient/v.contactEquations.length,v.maxForce=g,v.minForce=-g}}}for(i=0;i!==n;i++){for(y=_=0;y!==o;y++){d=s[y];x=z.iterateEquation(y,d,d.epsilon,m,f,u,h,t,i);_+=Math.abs(x)}if(this.usedIterations++,_*_<=a)break}for(c=0;c!==p;c++)l[c].addConstraintVelocity();z.updateMultipliers(s,u,1/t)}},z.updateMultipliers=function(t,e,i){for(var n=t.length;n--;)t[n].multiplier=e[n]*i},z.iterateEquation=function(t,e,i,n,r,s,o,a,l){var p=n[t],h=r[t],u=s[t],c=e.computeGWlambda(),n=e.maxForce,r=e.minForce;o&&(p=0);c=h*(p-c-i*u),i=u+c;return i<r*a?c=r*a-u:n*a<i&&(c=n*a-u),s[t]+=c,e.addToWlambda(c),c}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(t,e,i){function n(t,e){t=t||{},r.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}t("../utils/Utils");var r=t("../events/EventEmitter");(((e.exports=n).prototype=new r).constructor=n).prototype.solve=function(t,e){throw new Error("Solver.solve should be implemented by subclasses!")};var s={bodies:[]};n.prototype.solveIsland=function(t,e){this.removeAllEquations(),e.equations.length&&(this.addEquations(e.equations),s.bodies.length=0,e.getBodies(s.bodies),s.bodies.length&&this.solve(t,s))},n.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},n.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},n.prototype.addEquations=function(t){for(var e=0,i=t.length;e!==i;e++){var n=t[e];n.enabled&&this.equations.push(n)}},n.prototype.removeEquation=function(t){t=this.equations.indexOf(t);-1!==t&&this.equations.splice(t,1)},n.prototype.removeAllEquations=function(){this.equations.length=0},n.GS=1,n.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(t,e,i){function n(){s.apply(this,arguments)}var r=t("../equations/ContactEquation"),s=t("./Pool");(((e.exports=n).prototype=new s).constructor=n).prototype.create=function(){return new r},n.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(t,e,i){function n(){s.apply(this,arguments)}var r=t("../equations/FrictionEquation"),s=t("./Pool");(((e.exports=n).prototype=new s).constructor=n).prototype.create=function(){return new r},n.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(t,e,i){function n(){s.apply(this,arguments)}var r=t("../world/IslandNode"),s=t("./Pool");(((e.exports=n).prototype=new s).constructor=n).prototype.create=function(){return new r},n.prototype.destroy=function(t){return t.reset(),this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(t,e,i){function n(){s.apply(this,arguments)}var r=t("../world/Island"),s=t("./Pool");(((e.exports=n).prototype=new s).constructor=n).prototype.create=function(){return new r},n.prototype.destroy=function(t){return t.reset(),this}},{"../world/Island":58,"./Pool":55}],52:[function(t,e,i){function n(){this.overlappingShapesLastState=new r,this.overlappingShapesCurrentState=new r,this.recordPool=new s({size:16}),this.tmpDict=new r,this.tmpArray1=[]}var r=t("./TupleDictionary"),s=(t("./OverlapKeeperRecord"),t("./OverlapKeeperRecordPool"));t("./Utils");(e.exports=n).prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,i=t.keys.length;i--;){var n=t.keys[i],r=t.getByKey(n);e.getByKey(n);r&&this.recordPool.release(r)}t.reset(),t.copy(e),e.reset()},n.prototype.setOverlapping=function(t,e,i,n){this.overlappingShapesLastState;var r,s=this.overlappingShapesCurrentState;s.get(e.id,n.id)||((r=this.recordPool.get()).set(t,e,i,n),s.set(e.id,n.id,r))},n.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},n.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},n.prototype.bodiesAreOverlapping=function(t,e){for(var i=this.overlappingShapesCurrentState,n=i.keys.length;n--;){var r=i.keys[n],r=i.data[r];if(r.bodyA===t&&r.bodyB===e||r.bodyA===e&&r.bodyB===t)return!0}return!1},n.prototype.getDiff=function(t,e,i){var n=t,r=e;(i=i||[]).length=0;for(var s=r.keys.length;s--;){var o=r.keys[s],a=r.data[o];if(!a)throw new Error("Key "+o+" had no data!");n.data[o]||i.push(a)}return i},n.prototype.isNewOverlap=function(t,e){var i=0|t.id,n=0|e.id,t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState;return!t.get(i,n)&&!!e.get(i,n)},n.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},n.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},n.prototype.getBodyDiff=function(t,e){e=e||[];for(var i=this.tmpDict,n=t.length;n--;){var r=t[n];i.set(0|r.bodyA.id,0|r.bodyB.id,r)}for(n=i.keys.length;n--;)(r=i.getByKey(i.keys[n]))&&e.push(r.bodyA,r.bodyB);return i.reset(),e}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(t,e,i){function r(t,e,i,n){this.shapeA=e,this.shapeB=n,this.bodyA=t,this.bodyB=i}(e.exports=r).prototype.set=function(t,e,i,n){r.call(this,t,e,i,n)}},{}],54:[function(t,e,i){function n(){s.apply(this,arguments)}var r=t("./OverlapKeeperRecord"),s=t("./Pool");(((e.exports=n).prototype=new s).constructor=n).prototype.create=function(){return new r},n.prototype.destroy=function(t){return t.bodyA=t.bodyB=t.shapeA=t.shapeB=null,this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(t,e,i){function n(t){t=t||{},this.objects=[],void 0!==t.size&&this.resize(t.size)}(e.exports=n).prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.create());return this},n.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()},n.prototype.release=function(t){return this.destroy(t),this.objects.push(t),this}},{}],56:[function(t,e,i){function n(){this.data={},this.keys=[]}var r=t("./Utils");(e.exports=n).prototype.getKey=function(t,e){return(0|(t|=0))==(0|(e|=0))?-1:0|((0|e)<(0|t)?t<<16|65535&e:e<<16|65535&t)},n.prototype.getByKey=function(t){return t|=0,this.data[t]},n.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},n.prototype.set=function(t,e,i){if(!i)throw new Error("No data!");e=this.getKey(t,e);return this.data[e]||this.keys.push(e),this.data[e]=i,e},n.prototype.reset=function(){for(var t=this.data,e=this.keys,i=e.length;i--;)delete t[e[i]];e.length=0},n.prototype.copy=function(t){this.reset(),r.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var i=t.keys[e];this.data[i]=t.data[i]}}},{"./Utils":57}],57:[function(t,e,i){function n(){}(e.exports=n).appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var i=0,n=e.length;i!==n;++i)t.push(e[i])},n.splice=function(t,e,i){i=i||1;for(var n=e,r=t.length-i;n<r;n++)t[n]=t[n+i];t.length=r},"undefined"!=typeof P2_ARRAY_TYPE?n.ARRAY_TYPE=P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?n.ARRAY_TYPE=Float32Array:n.ARRAY_TYPE=Array,n.extend=function(t,e){for(var i in e)t[i]=e[i]},n.defaults=function(t,e){for(var i in t=t||{},e)i in t||(t[i]=e[i]);return t}},{}],58:[function(t,e,i){function n(){this.equations=[],this.bodies=[]}var r=t("../objects/Body");(e.exports=n).prototype.reset=function(){this.equations.length=this.bodies.length=0};var s=[];n.prototype.getBodies=function(t){for(var e=t||[],i=this.equations,n=s.length=0;n!==i.length;n++){var r=i[n];-1===s.indexOf(r.bodyA.id)&&(e.push(r.bodyA),s.push(r.bodyA.id)),-1===s.indexOf(r.bodyB.id)&&(e.push(r.bodyB),s.push(r.bodyB.id))}return e},n.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===r.DYNAMIC&&!e.wantsToSleep)return!1}return!0},n.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++)this.bodies[t].sleep();return!0}},{"../objects/Body":31}],59:[function(t,e,i){function d(t){this.nodePool=new n({size:16}),this.islandPool=new r({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}t("../math/vec2"),t("./Island"),t("./IslandNode");var n=t("./../utils/IslandNodePool"),r=t("./../utils/IslandPool"),o=t("../objects/Body");(e.exports=d).getUnvisitedNode=function(t){for(var e=t.length,i=0;i!==e;i++){var n=t[i];if(!n.visited&&n.body.type===o.DYNAMIC)return n}return!1},d.prototype.visit=function(t,e,i){e.push(t.body);for(var n=t.equations.length,r=0;r!==n;r++){var s=t.equations[r];-1===i.indexOf(s)&&i.push(s)}},d.prototype.bfs=function(t,e,i){var n=this.queue;for(n.length=0,n.push(t),t.visited=!0,this.visit(t,e,i);n.length;)for(var r,s=n.pop();r=d.getUnvisitedNode(s.neighbors);)r.visited=!0,this.visit(r,e,i),r.body.type===o.DYNAMIC&&n.push(r)},d.prototype.split=function(t){for(var e=t.bodies,i=this.nodes,n=this.equations;i.length;)this.nodePool.release(i.pop());for(var r=0;r!==e.length;r++){var s=this.nodePool.get();s.body=e[r],i.push(s)}for(var o=0;o!==n.length;o++){var a=n[o],r=e.indexOf(a.bodyA),l=e.indexOf(a.bodyB),p=i[r],l=i[l];p.neighbors.push(l),l.neighbors.push(p),p.equations.push(a),l.equations.push(a)}for(var h,u=this.islands,r=0;r<u.length;r++)this.islandPool.release(u[r]);for(u.length=0;h=d.getUnvisitedNode(i);){var c=this.islandPool.get();this.bfs(h,c.bodies,c.equations),u.push(c)}return u}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(t,e,i){function n(t){this.body=t,this.neighbors=[],this.equations=[],this.visited=!1}(e.exports=n).prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],61:[function(t,e,i){function V(t){r.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new n,this.narrowphase=new p(this),this.islandManager=new u,this.gravity=W.fromValues(0,-9.78),t.gravity&&W.copy(this.gravity,t.gravity),this.frictionGravity=W.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=t.broadphase||new l,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new s,this.defaultContactMaterial=new o(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit=void 0===t.islandSplit||!!t.islandSplit,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=V.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new h}var n=t("../solver/GSSolver"),W=(t("../solver/Solver"),t("../collision/Ray"),t("../math/vec2")),m=t("../shapes/Circle"),x=t("../shapes/Convex"),v=(t("../shapes/Line"),t("../shapes/Plane")),g=t("../shapes/Capsule"),b=t("../shapes/Particle"),r=t("../events/EventEmitter"),H=t("../objects/Body"),s=(t("../shapes/Shape"),t("../objects/LinearSpring"),t("../material/Material")),o=t("../material/ContactMaterial"),a=(t("../constraints/DistanceConstraint"),t("../constraints/Constraint"),t("../constraints/LockConstraint"),t("../constraints/RevoluteConstraint"),t("../constraints/PrismaticConstraint"),t("../constraints/GearConstraint"),t("../../package.json"),t("../collision/Broadphase"),t("../collision/AABB")),l=t("../collision/SAPBroadphase"),p=t("../collision/Narrowphase"),q=t("../utils/Utils"),h=t("../utils/OverlapKeeper"),u=t("./IslandManager");t("../objects/RotationalSpring");(((e.exports=V).prototype=new Object(r.prototype)).constructor=V).NO_SLEEPING=1,V.BODY_SLEEPING=2,V.ISLAND_SLEEPING=4,V.prototype.addConstraint=function(t){this.constraints.push(t)},V.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},V.prototype.removeContactMaterial=function(t){t=this.contactMaterials.indexOf(t);-1!==t&&q.splice(this.contactMaterials,t,1)},V.prototype.getContactMaterial=function(t,e){for(var i=this.contactMaterials,n=0,r=i.length;n!==r;n++){var s=i[n];if(s.materialA.id===t.id&&s.materialB.id===e.id||s.materialA.id===e.id&&s.materialB.id===t.id)return s}return!1},V.prototype.removeConstraint=function(t){t=this.constraints.indexOf(t);-1!==t&&q.splice(this.constraints,t,1)};W.create(),W.create(),W.create(),W.create(),W.create(),W.create();var Y=W.create(),y=W.fromValues(0,0),f=W.fromValues(0,0);W.fromValues(0,0),W.fromValues(0,0);V.prototype.step=function(t,e,i){if(i=i||10,0===(e=e||0))this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var n=0;this.accumulator>=t&&n<i;)this.internalStep(t),this.time+=t,this.accumulator-=t,n++;for(var r=this.accumulator%t/t,s=0;s!==this.bodies.length;s++){var o=this.bodies[s];W.lerp(o.interpolatedPosition,o.previousPosition,o.position,r),o.interpolatedAngle=o.previousAngle+r*(o.angle-o.previousAngle)}}};var K=[];V.prototype.internalStep=function(t){this.stepping=!0;var e,i=this.springs.length,n=this.springs,r=this.bodies,s=this.gravity,o=this.solver,a=this.bodies.length,l=this.broadphase,p=this.narrowphase,h=this.constraints,u=Y,c=(W.scale,W.add),d=(W.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=t,this.useWorldGravityAsFrictionGravity&&(0===(e=W.length(this.gravity))&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=e)),this.applyGravity)for(var _=0;_!==a;_++){var y,f=(y=r[_]).force;y.type===H.DYNAMIC&&y.sleepState!==H.SLEEPING&&(W.scale(u,s,y.mass*y.gravityScale),c(f,f,u))}if(this.applySpringForces)for(_=0;_!==i;_++)n[_].applyForce();if(this.applyDamping)for(_=0;_!==a;_++)(y=r[_]).type===H.DYNAMIC&&y.applyDamping(t);for(var m=l.getCollisionPairs(this),x=this.disabledBodyCollisionPairs,_=x.length-2;0<=_;_-=2)for(var v=m.length-2;0<=v;v-=2)(x[_]===m[v]&&x[_+1]===m[v+1]||x[_+1]===m[v]&&x[_]===m[v+1])&&m.splice(v,2);var g=h.length;for(_=0;_!==g;_++){var b=h[_];if(!b.collideConnected)for(v=m.length-2;0<=v;v-=2)(b.bodyA===m[v]&&b.bodyB===m[v+1]||b.bodyB===m[v]&&b.bodyA===m[v+1])&&m.splice(v,2)}this.postBroadphaseEvent.pairs=m,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,p.reset(this);for(var _=0,z=m.length;_!==z;_+=2)for(var w=m[_],C=m[_+1],P=0,T=w.shapes.length;P!==T;P++)for(var S=w.shapes[P],M=S.position,A=S.angle,O=0,k=C.shapes.length;O!==k;O++){var E,I=C.shapes[O],D=I.position,B=I.angle,L=this.defaultContactMaterial;S.material&&I.material&&((E=this.getContactMaterial(S.material,I.material))&&(L=E)),this.runNarrowphase(p,w,S,M,A,C,I,D,B,L,this.frictionGravity)}for(_=0;_!==a;_++)(j=r[_])._wakeUpAfterNarrowphase&&(j.wakeUp(),j._wakeUpAfterNarrowphase=!1);if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(K);for(var R=this.endContactEvent,O=K.length;O--;){var F=K[O];R.shapeA=F.shapeA,R.shapeB=F.shapeB,R.bodyA=F.bodyA,R.bodyB=F.bodyB,this.emit(R)}K.length=0}l=this.preSolveEvent;l.contactEquations=p.contactEquations,l.frictionEquations=p.frictionEquations,this.emit(l),l.contactEquations=l.frictionEquations=null;g=h.length;for(_=0;_!==g;_++)h[_].update();if(p.contactEquations.length||p.frictionEquations.length||g)if(this.islandSplit){for(d.equations.length=0,q.appendArray(d.equations,p.contactEquations),q.appendArray(d.equations,p.frictionEquations),_=0;_!==g;_++)q.appendArray(d.equations,h[_].equations);d.split(this);for(_=0;_!==d.islands.length;_++)(U=d.islands[_]).equations.length&&o.solveIsland(t,U)}else{for(o.addEquations(p.contactEquations),o.addEquations(p.frictionEquations),_=0;_!==g;_++)o.addEquations(h[_].equations);this.solveConstraints&&o.solve(t,this),o.removeAllEquations()}for(var j,_=0;_!==a;_++)(j=r[_]).integrate(t);for(_=0;_!==a;_++)r[_].setZeroForce();if(this.emitImpactEvent&&this.has("impact"))for(var N=this.impactEvent,_=0;_!==p.contactEquations.length;_++){var G=p.contactEquations[_];G.firstImpact&&(N.bodyA=G.bodyA,N.bodyB=G.bodyB,N.shapeA=G.shapeA,N.shapeB=G.shapeB,N.contactEquation=G,this.emit(N))}if(this.sleepMode===V.BODY_SLEEPING)for(_=0;_!==a;_++)r[_].sleepTick(this.time,!1,t);else if(this.sleepMode===V.ISLAND_SLEEPING&&this.islandSplit){for(_=0;_!==a;_++)r[_].sleepTick(this.time,!0,t);for(var U,_=0;_<this.islandManager.islands.length;_++)(U=this.islandManager.islands[_]).wantsToSleep()&&U.sleep()}this.stepping=!1;for(var X=this.bodiesToBeRemoved,_=0;_!==X.length;_++)this.removeBody(X[_]);X.length=0,this.emit(this.postStepEvent)},V.prototype.runNarrowphase=function(t,e,i,n,r,s,o,a,l,p,h){if(0!=(i.collisionGroup&o.collisionMask)&&0!=(o.collisionGroup&i.collisionMask)){W.rotate(y,n,e.angle),W.rotate(f,a,s.angle),W.add(y,y,e.position),W.add(f,f,s.position);n=r+e.angle,a=l+s.angle;t.enableFriction=0<p.friction,t.frictionCoefficient=p.friction,r=e.type===H.STATIC||e.type===H.KINEMATIC?s.mass:s.type===H.STATIC||s.type===H.KINEMATIC?e.mass:e.mass*s.mass/(e.mass+s.mass),t.slipForce=p.friction*h*r,t.restitution=p.restitution,t.surfaceVelocity=p.surfaceVelocity,t.frictionStiffness=p.frictionStiffness,t.frictionRelaxation=p.frictionRelaxation,t.stiffness=p.stiffness,t.relaxation=p.relaxation,t.contactSkinSize=p.contactSkinSize,t.enabledEquations=e.collisionResponse&&s.collisionResponse&&i.collisionResponse&&o.collisionResponse;l=t[i.type|o.type],h=0;if(l){var r=i.sensor||o.sensor,p=t.frictionEquations.length,h=i.type<o.type?l.call(t,e,i,y,n,s,o,f,a,r):l.call(t,s,o,f,a,e,i,y,n,r),u=t.frictionEquations.length-p;if(h){if(e.allowSleep&&e.type===H.DYNAMIC&&e.sleepState===H.SLEEPING&&s.sleepState===H.AWAKE&&s.type!==H.STATIC&&W.squaredLength(s.velocity)+Math.pow(s.angularVelocity,2)>=2*Math.pow(s.sleepSpeedLimit,2)&&(e._wakeUpAfterNarrowphase=!0),s.allowSleep&&s.type===H.DYNAMIC&&s.sleepState===H.SLEEPING&&e.sleepState===H.AWAKE&&e.type!==H.STATIC&&W.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2)>=2*Math.pow(e.sleepSpeedLimit,2)&&(s._wakeUpAfterNarrowphase=!0),this.overlapKeeper.setOverlapping(e,i,s,o),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(i,o)){var c=this.beginContactEvent;if(c.shapeA=i,c.shapeB=o,c.bodyA=e,c.bodyB=s,c.contactEquations.length=0,"number"==typeof h)for(var d=t.contactEquations.length-h;d<t.contactEquations.length;d++)c.contactEquations.push(t.contactEquations[d]);this.emit(c)}if("number"==typeof h&&1<u)for(d=t.frictionEquations.length-u;d<t.frictionEquations.length;d++){var _=t.frictionEquations[d];_.setSlipForce(_.getSlipForce()/u)}}}}},V.prototype.addSpring=function(t){this.springs.push(t);var e=this.addSpringEvent;e.spring=t,this.emit(e),e.spring=null},V.prototype.removeSpring=function(t){t=this.springs.indexOf(t);-1!==t&&q.splice(this.springs,t,1)},V.prototype.addBody=function(t){var e;-1===this.bodies.indexOf(t)&&(this.bodies.push(t),(e=(t.world=this).addBodyEvent).body=t,this.emit(e),e.body=null)},V.prototype.removeBody=function(t){var e;this.stepping?this.bodiesToBeRemoved.push(t):(t.world=null,-1!==(e=this.bodies.indexOf(t))&&(q.splice(this.bodies,e,1),(this.removeBodyEvent.body=t).resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null))},V.prototype.getBodyById=function(t){for(var e=this.bodies,i=0;i<e.length;i++){var n=e[i];if(n.id===t)return n}return!1},V.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},V.prototype.enableBodyCollision=function(t,e){for(var i=this.disabledBodyCollisionPairs,n=0;n<i.length;n+=2)if(i[n]===t&&i[n+1]===e||i[n+1]===t&&i[n]===e)return void i.splice(n,2)},V.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var t=this.constraints,e=t.length-1;0<=e;e--)this.removeConstraint(t[e]);for(var i=this.bodies,e=i.length-1;0<=e;e--)this.removeBody(i[e]);for(var n=this.springs,e=n.length-1;0<=e;e--)this.removeSpring(n[e]);for(var r=this.contactMaterials,e=r.length-1;0<=e;e--)this.removeContactMaterial(r[e]);V.apply(this)};var z=W.create(),w=(W.fromValues(0,0),W.fromValues(0,0));V.prototype.hitTest=function(t,e,i){i=i||0;var n=new H({position:t}),r=new b,s=t,o=z,a=w;n.addShape(r);for(var l=this.narrowphase,p=[],h=0,u=e.length;h!==u;h++)for(var c=e[h],d=0,_=c.shapes.length;d!==_;d++){var y=c.shapes[d];W.rotate(o,y.position,c.angle),W.add(o,o,c.position);var f=y.angle+c.angle;(y instanceof m&&l.circleParticle(c,y,o,f,n,r,s,0,!0)||y instanceof x&&l.particleConvex(n,r,s,0,c,y,o,f,!0)||y instanceof v&&l.particlePlane(n,r,s,0,c,y,o,f,!0)||y instanceof g&&l.particleCapsule(n,r,s,0,c,y,o,f,!0)||y instanceof b&&W.squaredLength(W.sub(a,o,t))<i*i)&&p.push(c)}return p},V.prototype.setGlobalStiffness=function(t){for(var e=this.constraints,i=0;i!==e.length;i++)for(var n=e[i],r=0;r!==n.equations.length;r++){var s=n.equations[r];s.stiffness=t,s.needsUpdate=!0}for(var o=this.contactMaterials,i=0;i!==o.length;i++)(n=o[i]).stiffness=n.frictionStiffness=t;(n=this.defaultContactMaterial).stiffness=n.frictionStiffness=t},V.prototype.setGlobalRelaxation=function(t){for(var e=0;e!==this.constraints.length;e++)for(var i=this.constraints[e],n=0;n!==i.equations.length;n++){var r=i.equations[n];r.relaxation=t,r.needsUpdate=!0}for(e=0;e!==this.contactMaterials.length;e++)(i=this.contactMaterials[e]).relaxation=i.frictionRelaxation=t;(i=this.defaultContactMaterial).relaxation=i.frictionRelaxation=t};var c=new a,d=[];V.prototype.raycast=function(t,e){return e.getAABB(c),this.broadphase.aabbQuery(this,c,d),e.intersectBodies(t,d),d.length=0,t.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)},function(t,e,i){(function(){var T=T||{};return T.game=null,T.WEBGL_RENDERER=0,T.CANVAS_RENDERER=1,T.VERSION="v2.2.9",T._UID=0,"undefined"!=typeof Float32Array?(T.Float32Array=Float32Array,T.Uint16Array=Uint16Array,T.Uint32Array=Uint32Array,T.ArrayBuffer=ArrayBuffer):(T.Float32Array=Array,T.Uint16Array=Array),T.PI_2=2*Math.PI,T.RAD_TO_DEG=180/Math.PI,T.DEG_TO_RAD=Math.PI/180,T.RETINA_PREFIX="@2x",T.DisplayObject=function(){this.position=new T.Point(0,0),this.scale=new T.Point(1,1),this.pivot=new T.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.renderable=!1,this.parent=null,this.worldAlpha=1,this.worldTransform=new T.Matrix,this.worldPosition=new T.Point(0,0),this.worldScale=new T.Point(1,1),this.worldRotation=0,this.filterArea=null,this._sr=0,this._cr=1,this._bounds=new T.Rectangle(0,0,0,0),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},T.DisplayObject.prototype.constructor=T.DisplayObject,T.DisplayObject.prototype={destroy:function(){if(this.children){for(var t=this.children.length;t--;)this.children[t].destroy();this.children=[]}this.hitArea=null,this.parent=null,this.worldTransform=null,this.filterArea=null,this.renderable=!1,this._bounds=null,this._currentBounds=null,this._mask=null,this._destroyCachedSprite()},updateTransform:function(t){if(!t&&!this.parent&&!this.game)return this;var e=this.parent;t?e=t:this.parent||(e=this.game.world);var i,n,r,s,o,a=e.worldTransform,l=this.worldTransform;return this.rotation%T.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),i=this._cr*this.scale.x,n=this._sr*this.scale.x,t=-this._sr*this.scale.y,r=this._cr*this.scale.y,s=this.position.x,o=this.position.y,(this.pivot.x||this.pivot.y)&&(s-=this.pivot.x*i+this.pivot.y*t,o-=this.pivot.x*n+this.pivot.y*r),l.a=i*a.a+n*a.c,l.b=i*a.b+n*a.d,l.c=t*a.a+r*a.c,l.d=t*a.b+r*a.d):(i=this.scale.x,r=this.scale.y,s=this.position.x-this.pivot.x*i,o=this.position.y-this.pivot.y*r,l.a=i*a.a,l.b=i*a.b,l.c=r*a.c,l.d=r*a.d),l.tx=s*a.a+o*a.c+a.tx,l.ty=s*a.b+o*a.d+a.ty,this.worldAlpha=this.alpha*e.worldAlpha,this.worldPosition.set(l.tx,l.ty),this.worldScale.set(this.scale.x*Math.sqrt(l.a*l.a+l.c*l.c),this.scale.y*Math.sqrt(l.b*l.b+l.d*l.d)),this.worldRotation=Math.atan2(-l.c,l.d),this._currentBounds=null,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,l,a),this},preUpdate:function(){},generateTexture:function(t,e,i){var n=this.getLocalBounds(),t=new T.RenderTexture(0|n.width,0|n.height,i,e,t);return T.DisplayObject._tempMatrix.tx=-n.x,T.DisplayObject._tempMatrix.ty=-n.y,t.render(this,T.DisplayObject._tempMatrix),t},updateCache:function(){return this._generateCachedSprite(),this},toGlobal:function(t){return this.updateTransform(),this.worldTransform.apply(t)},toLocal:function(t,e){return e&&(t=e.toGlobal(t)),this.updateTransform(),this.worldTransform.applyInverse(t)},_renderCachedSprite:function(t){this._cachedSprite.worldAlpha=this.worldAlpha,(t.gl?T.Sprite.prototype._renderWebGL:T.Sprite.prototype._renderCanvas).call(this._cachedSprite,t)},_generateCachedSprite:function(){this._cacheAsBitmap=!1;var t=this.getLocalBounds();t.width=Math.max(1,Math.ceil(t.width)),t.height=Math.max(1,Math.ceil(t.height)),this.updateTransform(),this._cachedSprite?this._cachedSprite.texture.resize(t.width,t.height):(e=new T.RenderTexture(t.width,t.height),this._cachedSprite=new T.Sprite(e),this._cachedSprite.worldTransform=this.worldTransform);var e=this._filters;this._filters=null,this._cachedSprite.filters=e,T.DisplayObject._tempMatrix.tx=-t.x,T.DisplayObject._tempMatrix.ty=-t.y,this._cachedSprite.texture.render(this,T.DisplayObject._tempMatrix,!0),this._cachedSprite.anchor.x=-t.x/t.width,this._cachedSprite.anchor.y=-t.y/t.height,this._filters=e,this._cacheAsBitmap=!0},_destroyCachedSprite:function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)}},T.DisplayObject.prototype.displayObjectUpdateTransform=T.DisplayObject.prototype.updateTransform,Object.defineProperties(T.DisplayObject.prototype,{x:{get:function(){return this.position.x},set:function(t){this.position.x=t}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t}},worldVisible:{get:function(){if(this.visible){var t=this.parent;if(!t)return this.visible;do{if(!t.visible)return!1}while(t=t.parent);return!0}return!1}},mask:{get:function(){return this._mask},set:function(t){this._mask&&(this._mask.isMask=!1),(this._mask=t)&&(this._mask.isMask=!0)}},filters:{get:function(){return this._filters},set:function(t){if(Array.isArray(t)){for(var e=[],i=0;i<t.length;i++)for(var n=t[i].passes,r=0;r<n.length;r++)e.push(n[r]);this._filterBlock={target:this,filterPasses:e}}this._filters=t,this.blendMode&&this.blendMode===T.blendModes.MULTIPLY&&(this.blendMode=T.blendModes.NORMAL)}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap!==t&&(t?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=t)}}}),T.DisplayObjectContainer=function(){T.DisplayObject.call(this),this.children=[],this.ignoreChildInput=!1},T.DisplayObjectContainer.prototype=Object.create(T.DisplayObject.prototype),T.DisplayObjectContainer.prototype.constructor=T.DisplayObjectContainer,T.DisplayObjectContainer.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)},T.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(0<=e&&e<=this.children.length)return t.parent&&t.parent.removeChild(t),(t.parent=this).children.splice(e,0,t),t;throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)},T.DisplayObjectContainer.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),n=this.getChildIndex(e);if(i<0||n<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=e,this.children[n]=t}},T.DisplayObjectContainer.prototype.getChildIndex=function(t){t=this.children.indexOf(t);if(-1===t)throw new Error("The supplied DisplayObject must be a child of the caller");return t},T.DisplayObjectContainer.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(t);this.children.splice(i,1),this.children.splice(e,0,t)},T.DisplayObjectContainer.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[t]},T.DisplayObjectContainer.prototype.removeChild=function(t){t=this.children.indexOf(t);if(-1!==t)return this.removeChildAt(t)},T.DisplayObjectContainer.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e&&(e.parent=void 0,this.children.splice(t,1)),e},T.DisplayObjectContainer.prototype.removeChildren=function(t,e){void 0===t&&(t=0),void 0===e&&(e=this.children.length);t=e-t;if(0<t&&t<=e){for(var i=this.children.splice(begin,t),n=0;n<i.length;n++)i[n].parent=void 0;return i}if(0==t&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},T.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var t=0;t<this.children.length;t++)this.children[t].updateTransform()},T.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=T.DisplayObjectContainer.prototype.updateTransform,T.DisplayObjectContainer.prototype.getBounds=function(t){var e=t&&t instanceof T.DisplayObject,i=!0;if(e?i=t instanceof T.DisplayObjectContainer&&t.contains(this):t=this,e){var n=t.worldTransform;for(t.worldTransform=T.identityMatrix,u=0;u<t.children.length;u++)t.children[u].updateTransform()}for(var r,s,o=1/0,a=1/0,l=-1/0,p=-1/0,h=!1,u=0;u<this.children.length;u++)this.children[u].visible&&(h=!0,o=o<(s=this.children[u].getBounds()).x?o:s.x,a=a<s.y?a:s.y,l=(r=s.width+s.x)<l?l:r,p=(s=s.height+s.y)<p?p:s);var c,d,_,y,f,m,x,v,g,b,z,w,C,P=this._bounds;if(h||(g=(P=new T.Rectangle).x,c=P.width+P.x,z=P.y,d=P.height+P.y,_=(C=this.worldTransform).a,y=C.b,m=C.c,f=C.d,o=(w=_*c+m*z+(x=C.tx))<(o=(b=_*g+m*z+x)<(o=(v=_*g+m*d+x)<(o=m=_*c+m*d+x)?v:o)?b:o)?w:o,a=(C=f*z+y*c+(x=C.ty))<(a=(z=f*z+y*g+x)<(a=(g=f*d+y*g+x)<(a=x=f*d+y*c+x)?g:a)?z:a)?C:a,l=(l=(l=(l=m)<v?v:l)<b?b:l)<w?w:l,p=(p=(p=(p=x)<g?g:p)<z?z:p)<C?C:p),P.x=o,P.y=a,P.width=l-o,P.height=p-a,e)for(t.worldTransform=n,u=0;u<t.children.length;u++)t.children[u].updateTransform();return i||(i=t.getBounds(),P.x-=i.x,P.y-=i.y),P},T.DisplayObjectContainer.prototype.getLocalBounds=function(){return this.getBounds(this)},T.DisplayObjectContainer.prototype.contains=function(t){return!!t&&(t===this||this.contains(t.parent))},T.DisplayObjectContainer.prototype._renderWebGL=function(t){var e;if(this.visible&&!(this.alpha<=0))if(this._cacheAsBitmap)this._renderCachedSprite(t);else if(this._mask||this._filters){for(this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),t.spriteBatch.start()}else for(e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t)},T.DisplayObjectContainer.prototype._renderCanvas=function(t){if(!1!==this.visible&&0!==this.alpha)if(this._cacheAsBitmap)this._renderCachedSprite(t);else{this._mask&&t.maskManager.pushMask(this._mask,t);for(var e=0;e<this.children.length;e++)this.children[e]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},Object.defineProperty(T.DisplayObjectContainer.prototype,"width",{get:function(){return this.getLocalBounds().width*this.scale.x},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}}),Object.defineProperty(T.DisplayObjectContainer.prototype,"height",{get:function(){return this.getLocalBounds().height*this.scale.y},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}}),T.Sprite=function(t){T.DisplayObjectContainer.call(this),this.anchor=new T.Point,this.texture=t||T.Texture.emptyTexture,this._width=0,this._height=0,this.tint=16777215,this.cachedTint=-1,this.tintedTexture=null,this.blendMode=T.blendModes.NORMAL,this.shader=null,this.exists=!0,this.texture.baseTexture.hasLoaded&&this.onTextureUpdate(),this.renderable=!0},T.Sprite.prototype=Object.create(T.DisplayObjectContainer.prototype),T.Sprite.prototype.constructor=T.Sprite,Object.defineProperty(T.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(T.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),T.Sprite.prototype.setTexture=function(t,e){void 0!==e&&this.texture.baseTexture.destroy(),this.texture.baseTexture.skipRender=!1,this.texture=t,this.texture.valid=!0,this.cachedTint=-1},T.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},T.Sprite.prototype.getBounds=function(t){var e,i=this.texture.frame.width,n=this.texture.frame.height,r=i*(1-this.anchor.x),s=i*-this.anchor.x,o=n*(1-this.anchor.y),a=n*-this.anchor.y,l=t||this.worldTransform,p=l.a,h=l.b,u=l.c,c=l.d,d=l.tx,_=l.ty,y=-1/0,f=-1/0,i=1/0,n=1/0,f=0===h&&0===u?(p<0&&(p*=-1,e=r,r=-s,s=-e),c<0&&(c*=-1,e=o,o=-a,a=-e),i=p*s+d,y=p*r+d,n=c*a+_,c*o+_):(i=(t=p*s+u*o+d)<(i=(l=p*r+u*o+d)<(i=(e=p*r+u*a+d)<(i=(d=p*s+u*a+d)<i?d:i)?e:i)?l:i)?t:i,n=(m=c*o+h*s+_)<(n=(o=c*o+h*r+_)<(n=(r=c*a+h*r+_)<(n=(_=c*a+h*s+_)<n?_:n)?r:n)?o:n)?m:n,y=(y=(y=(y=y<d?d:y)<e?e:y)<l?l:y)<t?t:y,(f=(f=(f=f<_?_:f)<r?r:f)<o?o:f)<m?m:f),m=this._bounds;return m.x=i,m.width=y-i,m.y=n,m.height=f-n,this._currentBounds=m},T.Sprite.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=T.identityMatrix;for(var e=0;e<this.children.length;e++)this.children[e].updateTransform();var i=this.getBounds();for(this.worldTransform=t,e=0;e<this.children.length;e++)this.children[e].updateTransform();return i},T.Sprite.prototype._renderWebGL=function(t,e){if(this.visible&&!(this.alpha<=0)&&this.renderable){var i=this.worldTransform;if(e&&(i=e),this._mask||this._filters){e=t.spriteBatch;this._filters&&(e.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(e.stop(),t.maskManager.pushMask(this.mask,t),e.start()),e.render(this);for(var n=0;n<this.children.length;n++)this.children[n]._renderWebGL(t);e.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),e.start()}else{t.spriteBatch.render(this);for(n=0;n<this.children.length;n++)this.children[n]._renderWebGL(t,i)}}},T.Sprite.prototype._renderCanvas=function(t,e){if(!(!this.visible||0===this.alpha||!this.renderable||this.texture.crop.width<=0||this.texture.crop.height<=0)){var i,n,r,s,o,a=this.worldTransform;e&&(a=e),this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=T.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),this.texture.valid&&(i=this.texture.baseTexture.resolution/t.resolution,t.context.globalAlpha=this.worldAlpha,t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode&&(t.scaleMode=this.texture.baseTexture.scaleMode,t.context[t.smoothProperty]=t.scaleMode===T.scaleModes.LINEAR),n=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,r=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height,s=a.tx*t.resolution+t.shakeX,o=a.ty*t.resolution+t.shakeY,t.roundPixels?(t.context.setTransform(a.a,a.b,a.c,a.d,0|s,0|o),n|=0,r|=0):t.context.setTransform(a.a,a.b,a.c,a.d,s,o),e=this.texture.crop.width,a=this.texture.crop.height,n/=i,r/=i,16777215!==this.tint?(!this.texture.requiresReTint&&this.cachedTint===this.tint||(this.tintedTexture=T.CanvasTinter.getTintedTexture(this,this.tint),this.cachedTint=this.tint,this.texture.requiresReTint=!1),t.context.drawImage(this.tintedTexture,0,0,e,a,n,r,e/i,a/i)):(s=this.texture.crop.x,o=this.texture.crop.y,t.context.drawImage(this.texture.baseTexture.source,s,o,e,a,n,r,e/i,a/i)));for(var l=0;l<this.children.length;l++)this.children[l]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},T.SpriteBatch=function(t){T.DisplayObjectContainer.call(this),this.textureThing=t,this.ready=!1},T.SpriteBatch.prototype=Object.create(T.DisplayObjectContainer.prototype),T.SpriteBatch.prototype.constructor=T.SpriteBatch,T.SpriteBatch.prototype.initWebGL=function(t){this.fastSpriteBatch=new T.WebGLFastSpriteBatch(t),this.ready=!0},T.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},T.SpriteBatch.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(t.gl),this.fastSpriteBatch.gl!==t.gl&&this.fastSpriteBatch.setContext(t.gl),t.spriteBatch.stop(),t.shaderManager.setShader(t.shaderManager.fastShader),this.fastSpriteBatch.begin(this,t),this.fastSpriteBatch.render(this),t.spriteBatch.start())},T.SpriteBatch.prototype._renderCanvas=function(t){if(this.visible&&!(this.alpha<=0)&&this.children.length){var e=t.context;e.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var i=this.worldTransform,n=!0,r=0;r<this.children.length;r++){var s,o,a,l,p,h=this.children[r];h.visible&&(o=(s=h.texture).frame,e.globalAlpha=this.worldAlpha*h.alpha,h.rotation%(2*Math.PI)==0?(n&&(e.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),n=!1),e.drawImage(s.baseTexture.source,o.x,o.y,o.width,o.height,h.anchor.x*(-o.width*h.scale.x)+h.position.x+.5+t.shakeX|0,h.anchor.y*(-o.height*h.scale.y)+h.position.y+.5+t.shakeY|0,o.width*h.scale.x,o.height*h.scale.y)):(n=n||!0,h.displayObjectUpdateTransform(),l=(a=h.worldTransform).tx*t.resolution+t.shakeX,p=a.ty*t.resolution+t.shakeY,t.roundPixels?e.setTransform(a.a,a.b,a.c,a.d,0|l,0|p):e.setTransform(a.a,a.b,a.c,a.d,l,p),e.drawImage(s.baseTexture.source,o.x,o.y,o.width,o.height,h.anchor.x*-o.width+.5|0,h.anchor.y*-o.height+.5|0,o.width,o.height)))}}},T.hex2rgb=function(t){return[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]},T.rgb2hex=function(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]},T.canUseNewCanvasBlendModes=function(){if(void 0===document)return!1;var t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/",e="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==",i=new Image;i.src=t+"AP804Oa6"+e;var n=new Image;n.src=t+"/wCKxvRF"+e;e=T.CanvasPool.create(this,6,1).getContext("2d");if(e.globalCompositeOperation="multiply",e.drawImage(i,0,0),e.drawImage(n,2,0),!e.getImageData(2,0,1,1))return!1;e=e.getImageData(2,0,1,1).data;return T.CanvasPool.remove(this),255===e[0]&&0===e[1]&&0===e[2]},T.getNextPowerOfTwo=function(t){if(0<t&&0==(t&t-1))return t;for(var e=1;e<t;)e<<=1;return e},T.isPowerOfTwo=function(t,e){return 0<t&&0==(t&t-1)&&0<e&&0==(e&e-1)},T.CanvasPool={create:function(t,e,i){var n,r=T.CanvasPool.getFirst(),r=-1===r?(n={parent:t,canvas:document.createElement("canvas")},T.CanvasPool.pool.push(n),n.canvas):(T.CanvasPool.pool[r].parent=t,T.CanvasPool.pool[r].canvas);return void 0!==e&&(r.width=e,r.height=i),r},getFirst:function(){for(var t=T.CanvasPool.pool,e=0;e<t.length;e++)if(!t[e].parent)return e;return-1},remove:function(t){for(var e=T.CanvasPool.pool,i=0;i<e.length;i++)e[i].parent===t&&(e[i].parent=null,e[i].canvas.width=1,e[i].canvas.height=1)},removeByCanvas:function(t){for(var e=T.CanvasPool.pool,i=0;i<e.length;i++)e[i].canvas===t&&(e[i].parent=null,e[i].canvas.width=1,e[i].canvas.height=1)},getTotal:function(){for(var t=T.CanvasPool.pool,e=0,i=0;i<t.length;i++)t[i].parent&&e++;return e},getFree:function(){for(var t=T.CanvasPool.pool,e=0,i=0;i<t.length;i++)t[i].parent||e++;return e}},T.CanvasPool.pool=[],T.initDefaultShaders=function(){},T.CompileVertexShader=function(t,e){return T._CompileShader(t,e,t.VERTEX_SHADER)},T.CompileFragmentShader=function(t,e){return T._CompileShader(t,e,t.FRAGMENT_SHADER)},T._CompileShader=function(t,e,i){var n=e;Array.isArray(e)&&(n=e.join("\n"));i=t.createShader(i);return t.shaderSource(i,n),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(window.console.log(t.getShaderInfoLog(i)),null)},T.compileProgram=function(t,e,i){var n=T.CompileFragmentShader(t,i),i=T.CompileVertexShader(t,e),e=t.createProgram();return t.attachShader(e,i),t.attachShader(e,n),t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS)||(window.console.log(t.getProgramInfoLog(e)),window.console.log("Could not initialise shaders")),e},T.PixiShader=function(t){this._UID=T._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()},T.PixiShader.prototype.constructor=T.PixiShader,T.PixiShader.prototype.init=function(){var t,e=this.gl,i=T.compileProgram(e,this.vertexSrc||T.PixiShader.defaultVertexSrc,this.fragmentSrc);for(t in e.useProgram(i),this.uSampler=e.getUniformLocation(i,"uSampler"),this.projectionVector=e.getUniformLocation(i,"projectionVector"),this.offsetVector=e.getUniformLocation(i,"offsetVector"),this.dimensions=e.getUniformLocation(i,"dimensions"),this.aVertexPosition=e.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute],this.uniforms)this.uniforms[t].uniformLocation=e.getUniformLocation(i,t);this.initUniforms(),this.program=i},T.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var t,e,i=this.gl;for(e in this.uniforms){var n=(t=this.uniforms[e]).type;"sampler2D"===n?(t._init=!1,null!==t.value&&this.initSampler2D(t)):"mat2"===n||"mat3"===n||"mat4"===n?(t.glMatrix=!0,t.glValueLength=1,"mat2"===n?t.glFunc=i.uniformMatrix2fv:"mat3"===n?t.glFunc=i.uniformMatrix3fv:"mat4"===n&&(t.glFunc=i.uniformMatrix4fv)):(t.glFunc=i["uniform"+n],t.glValueLength="2f"===n||"2i"===n?2:"3f"===n||"3i"===n?3:"4f"===n||"4i"===n?4:1)}},T.PixiShader.prototype.initSampler2D=function(t){var e,i,n,r,s,o,a,l,p;t.value&&t.value.baseTexture&&t.value.baseTexture.hasLoaded&&((e=this.gl).activeTexture(e["TEXTURE"+this.textureCount]),e.bindTexture(e.TEXTURE_2D,t.value.baseTexture._glTextures[e.id]),t.textureData&&(i=(p=t.textureData).magFilter||e.LINEAR,n=p.minFilter||e.LINEAR,r=p.wrapS||e.CLAMP_TO_EDGE,s=p.wrapT||e.CLAMP_TO_EDGE,o=p.luminance?e.LUMINANCE:e.RGBA,p.repeat&&(r=e.REPEAT,s=e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!p.flipY),p.width?(a=p.width||512,l=p.height||2,p=p.border||0,e.texImage2D(e.TEXTURE_2D,0,o,a,l,p,o,e.UNSIGNED_BYTE,null)):e.texImage2D(e.TEXTURE_2D,0,o,e.RGBA,e.UNSIGNED_BYTE,t.value.baseTexture.source),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,s)),e.uniform1i(t.uniformLocation,this.textureCount),t._init=!0,this.textureCount++)},T.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var t,e,i=this.gl;for(e in this.uniforms)t=this.uniforms[e],1===t.glValueLength?!0===t.glMatrix?t.glFunc.call(i,t.uniformLocation,t.transpose,t.value):t.glFunc.call(i,t.uniformLocation,t.value):2===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y):3===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z):4===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w):"sampler2D"===t.type&&(t._init?(i.activeTexture(i["TEXTURE"+this.textureCount]),t.value.baseTexture._dirty[i.id]?T.instances[i.id].updateTexture(t.value.baseTexture):i.bindTexture(i.TEXTURE_2D,t.value.baseTexture._glTextures[i.id]),i.uniform1i(t.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(t))},T.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},T.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],T.PixiFastShader=function(t){this._UID=T._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},T.PixiFastShader.prototype.constructor=T.PixiFastShader,T.PixiFastShader.prototype.init=function(){var t=this.gl,e=T.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e),this.uSampler=t.getUniformLocation(e,"uSampler"),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.dimensions=t.getUniformLocation(e,"dimensions"),this.uMatrix=t.getUniformLocation(e,"uMatrix"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.aPositionCoord=t.getAttribLocation(e,"aPositionCoord"),this.aScale=t.getAttribLocation(e,"aScale"),this.aRotation=t.getAttribLocation(e,"aRotation"),this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(e,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=e},T.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},T.StripShader=function(t){this._UID=T._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},T.StripShader.prototype.constructor=T.StripShader,T.StripShader.prototype.init=function(){var t=this.gl,e=T.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e),this.uSampler=t.getUniformLocation(e,"uSampler"),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.colorAttribute=t.getAttribLocation(e,"aColor"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=t.getUniformLocation(e,"translationMatrix"),this.alpha=t.getUniformLocation(e,"alpha"),this.program=e},T.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},T.PrimitiveShader=function(t){this._UID=T._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},T.PrimitiveShader.prototype.constructor=T.PrimitiveShader,T.PrimitiveShader.prototype.init=function(){var t=this.gl,e=T.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.tintColor=t.getUniformLocation(e,"tint"),this.flipY=t.getUniformLocation(e,"flipY"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.colorAttribute=t.getAttribLocation(e,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(e,"translationMatrix"),this.alpha=t.getUniformLocation(e,"alpha"),this.program=e},T.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},T.ComplexPrimitiveShader=function(t){this._UID=T._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},T.ComplexPrimitiveShader.prototype.constructor=T.ComplexPrimitiveShader,T.ComplexPrimitiveShader.prototype.init=function(){var t=this.gl,e=T.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.tintColor=t.getUniformLocation(e,"tint"),this.color=t.getUniformLocation(e,"color"),this.flipY=t.getUniformLocation(e,"flipY"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(e,"translationMatrix"),this.alpha=t.getUniformLocation(e,"alpha"),this.program=e},T.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},T.glContexts=[],T.instances=[],T.WebGLRenderer=function(t){this.game=t,T.defaultRenderer||(T.defaultRenderer=this),this.type=T.WEBGL_RENDERER,this.resolution=t.resolution,this.transparent=t.transparent,this.autoResize=!1,this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.clearBeforeRender=t.clearBeforeRender,this.width=t.width,this.height=t.height,this.view=t.canvas,this._contextOptions={alpha:this.transparent,antialias:t.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:this.preserveDrawingBuffer},this.projection=new T.Point,this.offset=new T.Point,this.shaderManager=new T.WebGLShaderManager,this.spriteBatch=new T.WebGLSpriteBatch,this.maskManager=new T.WebGLMaskManager,this.filterManager=new T.WebGLFilterManager,this.stencilManager=new T.WebGLStencilManager,this.blendModeManager=new T.WebGLBlendModeManager,this.renderSession={},this.renderSession.game=this.game,this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,(this.renderSession.renderer=this).renderSession.resolution=this.resolution,this.initContext(),this.mapBlendModes()},T.WebGLRenderer.prototype.constructor=T.WebGLRenderer,T.WebGLRenderer.prototype.initContext=function(){var t=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(!(this.gl=t))throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=t.id=T.WebGLRenderer.glContextId++,T.glContexts[this.glContextId]=t,T.instances[this.glContextId]=this,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.enable(t.BLEND),this.shaderManager.setContext(t),this.spriteBatch.setContext(t),this.maskManager.setContext(t),this.filterManager.setContext(t),this.blendModeManager.setContext(t),this.stencilManager.setContext(t),this.renderSession.gl=this.gl,this.resize(this.width,this.height)},T.WebGLRenderer.prototype.render=function(t){var e;this.contextLost||((e=this.gl).viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,null),this.game.clearBeforeRender&&(e.clearColor(t._bgColor.r,t._bgColor.g,t._bgColor.b,t._bgColor.a),e.clear(e.COLOR_BUFFER_BIT)),this.offset.x=this.game.camera._shake.x,this.offset.y=this.game.camera._shake.y,this.renderDisplayObject(t,this.projection))},T.WebGLRenderer.prototype.renderDisplayObject=function(t,e,i,n){this.renderSession.blendModeManager.setBlendMode(T.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.flipY=i?-1:1,this.renderSession.projection=e,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,i),t._renderWebGL(this.renderSession,n),this.spriteBatch.end()},T.WebGLRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},T.WebGLRenderer.prototype.updateTexture=function(t){if(!t.hasLoaded)return!1;var e=this.gl;return t._glTextures[e.id]||(t._glTextures[e.id]=e.createTexture()),e.bindTexture(e.TEXTURE_2D,t._glTextures[e.id]),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.source),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t.scaleMode===T.scaleModes.LINEAR?e.LINEAR:e.NEAREST),t.mipmap&&T.isPowerOfTwo(t.width,t.height)?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===T.scaleModes.LINEAR?e.LINEAR_MIPMAP_LINEAR:e.NEAREST_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D)):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===T.scaleModes.LINEAR?e.LINEAR:e.NEAREST),t._powerOf2?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),!(t._dirty[e.id]=!1)},T.WebGLRenderer.prototype.destroy=function(){T.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null,T.CanvasPool.remove(this),T.instances[this.glContextId]=null,T.WebGLRenderer.glContextId--},T.WebGLRenderer.prototype.mapBlendModes=function(){var t,e,i=this.gl;T.blendModesWebGL||((t=[])[(e=T.blendModes).NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.ADD]=[i.SRC_ALPHA,i.DST_ALPHA],t[e.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA],t[e.SCREEN]=[i.SRC_ALPHA,i.ONE],t[e.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[e.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],T.blendModesWebGL=t)},T.WebGLRenderer.glContextId=0,T.WebGLBlendModeManager=function(){this.currentBlendMode=99999},T.WebGLBlendModeManager.prototype.constructor=T.WebGLBlendModeManager,T.WebGLBlendModeManager.prototype.setContext=function(t){this.gl=t},T.WebGLBlendModeManager.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;t=T.blendModesWebGL[this.currentBlendMode];return t&&this.gl.blendFunc(t[0],t[1]),!0},T.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},T.WebGLMaskManager=function(){},T.WebGLMaskManager.prototype.constructor=T.WebGLMaskManager,T.WebGLMaskManager.prototype.setContext=function(t){this.gl=t},T.WebGLMaskManager.prototype.pushMask=function(t,e){var i=e.gl;t.dirty&&T.WebGLGraphics.updateGraphics(t,i),void 0!==t._webGL[i.id]&&void 0!==t._webGL[i.id].data&&0!==t._webGL[i.id].data.length&&e.stencilManager.pushStencil(t,t._webGL[i.id].data[0],e)},T.WebGLMaskManager.prototype.popMask=function(t,e){var i=this.gl;void 0!==t._webGL[i.id]&&void 0!==t._webGL[i.id].data&&0!==t._webGL[i.id].data.length&&e.stencilManager.popStencil(t,t._webGL[i.id].data[0],e)},T.WebGLMaskManager.prototype.destroy=function(){this.gl=null},T.WebGLStencilManager=function(){this.stencilStack=[],this.reverse=!0,this.count=0},T.WebGLStencilManager.prototype.setContext=function(t){this.gl=t},T.WebGLStencilManager.prototype.pushStencil=function(t,e,i){var n=this.gl;this.bindGraphics(t,e,i),0===this.stencilStack.length&&(n.enable(n.STENCIL_TEST),n.clear(n.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(e);i=this.count;n.colorMask(!1,!1,!1,!1),n.stencilFunc(n.ALWAYS,0,255),n.stencilOp(n.KEEP,n.KEEP,n.INVERT),1===e.mode?(n.drawElements(n.TRIANGLE_FAN,e.indices.length-4,n.UNSIGNED_SHORT,0),this.reverse?(n.stencilFunc(n.EQUAL,255-i,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)):(n.stencilFunc(n.EQUAL,i,255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)),n.drawElements(n.TRIANGLE_FAN,4,n.UNSIGNED_SHORT,2*(e.indices.length-4)),this.reverse?n.stencilFunc(n.EQUAL,255-(i+1),255):n.stencilFunc(n.EQUAL,i+1,255),this.reverse=!this.reverse):(this.reverse?(n.stencilFunc(n.EQUAL,i,255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)):(n.stencilFunc(n.EQUAL,255-i,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)),n.drawElements(n.TRIANGLE_STRIP,e.indices.length,n.UNSIGNED_SHORT,0),this.reverse?n.stencilFunc(n.EQUAL,i+1,255):n.stencilFunc(n.EQUAL,255-(i+1),255)),n.colorMask(!0,!0,!0,!0),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),this.count++},T.WebGLStencilManager.prototype.bindGraphics=function(t,e,i){this._currentGraphics=t;var n,r=this.gl,s=i.projection,o=i.offset;1===e.mode?(n=i.shaderManager.complexPrimitiveShader,i.shaderManager.setShader(n),r.uniform1f(n.flipY,i.flipY),r.uniformMatrix3fv(n.translationMatrix,!1,t.worldTransform.toArray(!0)),r.uniform2f(n.projectionVector,s.x,-s.y),r.uniform2f(n.offsetVector,-o.x,-o.y),r.uniform3fv(n.tintColor,T.hex2rgb(t.tint)),r.uniform3fv(n.color,e.color),r.uniform1f(n.alpha,t.worldAlpha*e.alpha),r.bindBuffer(r.ARRAY_BUFFER,e.buffer),r.vertexAttribPointer(n.aVertexPosition,2,r.FLOAT,!1,8,0)):(n=i.shaderManager.primitiveShader,i.shaderManager.setShader(n),r.uniformMatrix3fv(n.translationMatrix,!1,t.worldTransform.toArray(!0)),r.uniform1f(n.flipY,i.flipY),r.uniform2f(n.projectionVector,s.x,-s.y),r.uniform2f(n.offsetVector,-o.x,-o.y),r.uniform3fv(n.tintColor,T.hex2rgb(t.tint)),r.uniform1f(n.alpha,t.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,e.buffer),r.vertexAttribPointer(n.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(n.colorAttribute,4,r.FLOAT,!1,24,8)),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.indexBuffer)},T.WebGLStencilManager.prototype.popStencil=function(t,e,i){var n,r=this.gl;this.stencilStack.pop(),this.count--,0===this.stencilStack.length?r.disable(r.STENCIL_TEST):(n=this.count,this.bindGraphics(t,e,i),r.colorMask(!1,!1,!1,!1),1===e.mode?(this.reverse=!this.reverse,this.reverse?(r.stencilFunc(r.EQUAL,255-(n+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,n+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(e.indices.length-4)),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),r.drawElements(r.TRIANGLE_FAN,e.indices.length-4,r.UNSIGNED_SHORT,0)):(this.reverse?(r.stencilFunc(r.EQUAL,n+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,255-(n+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_STRIP,e.indices.length,r.UNSIGNED_SHORT,0)),this.reverse?r.stencilFunc(r.EQUAL,n,255):r.stencilFunc(r.EQUAL,255-n,255),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP))},T.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null,this.gl=null},T.WebGLShaderManager=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.stack=[]},T.WebGLShaderManager.prototype.constructor=T.WebGLShaderManager,T.WebGLShaderManager.prototype.setContext=function(t){this.gl=t,this.primitiveShader=new T.PrimitiveShader(t),this.complexPrimitiveShader=new T.ComplexPrimitiveShader(t),this.defaultShader=new T.PixiShader(t),this.fastShader=new T.PixiFastShader(t),this.stripShader=new T.StripShader(t),this.setShader(this.defaultShader)},T.WebGLShaderManager.prototype.setAttribs=function(t){for(var e=0;e<this.tempAttribState.length;e++)this.tempAttribState[e]=!1;for(e=0;e<t.length;e++){var i=t[e];this.tempAttribState[i]=!0}var n=this.gl;for(e=0;e<this.attribState.length;e++)this.attribState[e]!==this.tempAttribState[e]&&(this.attribState[e]=this.tempAttribState[e],this.tempAttribState[e]?n.enableVertexAttribArray(e):n.disableVertexAttribArray(e))},T.WebGLShaderManager.prototype.setShader=function(t){return this._currentId!==t._UID&&(this._currentId=t._UID,this.currentShader=t,this.gl.useProgram(t.program),this.setAttribs(t.attributes),!0)},T.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},T.WebGLSpriteBatch=function(){this.vertSize=5,this.size=2e3;var t=4*this.size*4*this.vertSize,e=6*this.size;this.vertices=new T.ArrayBuffer(t),this.positions=new T.Float32Array(this.vertices),this.colors=new T.Uint32Array(this.vertices),this.indices=new T.Uint16Array(e);for(var i=this.lastIndexCount=0,n=0;i<e;i+=6,n+=4)this.indices[i+0]=n+0,this.indices[i+1]=n+1,this.indices[i+2]=n+2,this.indices[i+3]=n+0,this.indices[i+4]=n+2,this.indices[i+5]=n+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=new T.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])},T.WebGLSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),this.currentBlendMode=99999;var e=new T.PixiShader(t);e.fragmentSrc=this.defaultShader.fragmentSrc,e.uniforms={},e.init(),this.defaultShader.shaders[t.id]=e},T.WebGLSpriteBatch.prototype.begin=function(t){this.renderSession=t,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},T.WebGLSpriteBatch.prototype.end=function(){this.flush()},T.WebGLSpriteBatch.prototype.render=function(t,e){var i=t.texture,n=t.worldTransform;e&&(n=e),this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=i.baseTexture);var r,s,o,a,l,p,h,u,c,d,_=i._uvs;_&&(u=t.anchor.x,c=t.anchor.y,i.trim?(s=(r=(h=i.trim).x-u*h.width)+i.crop.width,a=(o=h.y-c*h.height)+i.crop.height):(s=i.frame.width*(1-u),r=i.frame.width*-u,a=i.frame.height*(1-c),o=i.frame.height*-c),l=4*this.currentBatchSize*this.vertSize,d=i.baseTexture.resolution,p=n.a/d,e=n.b/d,h=n.c/d,u=n.d/d,c=n.tx,i=n.ty,d=this.colors,n=this.positions,this.renderSession.roundPixels?(n[l]=p*r+h*o+c|0,n[1+l]=u*o+e*r+i|0,n[5+l]=p*s+h*o+c|0,n[6+l]=u*o+e*s+i|0,n[10+l]=p*s+h*a+c|0,n[11+l]=u*a+e*s+i|0,n[15+l]=p*r+h*a+c|0,n[16+l]=u*a+e*r+i|0):(n[l]=p*r+h*o+c,n[1+l]=u*o+e*r+i,n[5+l]=p*s+h*o+c,n[6+l]=u*o+e*s+i,n[10+l]=p*s+h*a+c,n[11+l]=u*a+e*s+i,n[15+l]=p*r+h*a+c,n[16+l]=u*a+e*r+i),n[2+l]=_.x0,n[3+l]=_.y0,n[7+l]=_.x1,n[8+l]=_.y1,n[12+l]=_.x2,n[13+l]=_.y2,n[17+l]=_.x3,n[18+l]=_.y3,_=t.tint,d[4+l]=d[9+l]=d[14+l]=d[19+l]=(_>>16)+(65280&_)+((255&_)<<16)+(255*t.worldAlpha<<24),this.sprites[this.currentBatchSize++]=t)},T.WebGLSpriteBatch.prototype.renderTilingSprite=function(t){var e=t.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=e.baseTexture),t._uvs||(t._uvs=new T.TextureUvs);var i=t._uvs,n=e.baseTexture.width,r=e.baseTexture.height;t.tilePosition.x%=n*t.tileScaleOffset.x,t.tilePosition.y%=r*t.tileScaleOffset.y;var s=t.tilePosition.x/(n*t.tileScaleOffset.x),o=t.tilePosition.y/(r*t.tileScaleOffset.y),a=t.width/n/(t.tileScale.x*t.tileScaleOffset.x),l=t.height/r/(t.tileScale.y*t.tileScaleOffset.y);i.x0=0-s,i.y0=0-o,i.x1=a-s,i.y1=0-o,i.x2=a-s,i.y2=l-o,i.x3=0-s,i.y3=l-o;var p=t.tint,h=(p>>16)+(65280&p)+((255&p)<<16)+(255*t.worldAlpha<<24),u=this.positions,c=this.colors,d=t.width,_=t.height,y=t.anchor.x,n=t.anchor.y,r=d*(1-y),a=d*-y,s=_*(1-n),l=_*-n,o=4*this.currentBatchSize*this.vertSize,p=e.baseTexture.resolution,d=t.worldTransform,y=d.a/p,_=d.b/p,n=d.c/p,e=d.d/p,p=d.tx,d=d.ty;u[o++]=y*a+n*l+p,u[o++]=e*l+_*a+d,u[o++]=i.x0,u[o++]=i.y0,c[o++]=h,u[o++]=y*r+n*l+p,u[o++]=e*l+_*r+d,u[o++]=i.x1,u[o++]=i.y1,c[o++]=h,u[o++]=y*r+n*s+p,u[o++]=e*s+_*r+d,u[o++]=i.x2,u[o++]=i.y2,c[o++]=h,u[o++]=y*a+n*s+p,u[o++]=e*s+_*a+d,u[o++]=i.x3,u[o++]=i.y3,c[+o]=h,this.sprites[this.currentBatchSize++]=t},T.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t,e,i=this.gl;this.dirty&&(this.dirty=!1,i.activeTexture(i.TEXTURE0),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t=this.defaultShader.shaders[i.id],e=4*this.vertSize,i.vertexAttribPointer(t.aVertexPosition,2,i.FLOAT,!1,e,0),i.vertexAttribPointer(t.aTextureCoord,2,i.FLOAT,!1,e,8),i.vertexAttribPointer(t.colorAttribute,4,i.UNSIGNED_BYTE,!0,e,16)),this.currentBatchSize>.5*this.size?i.bufferSubData(i.ARRAY_BUFFER,0,this.vertices):(e=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize),i.bufferSubData(i.ARRAY_BUFFER,0,e));for(var n,r,s,o,a,l=0,p=0,h=null,u=this.renderSession.blendModeManager.currentBlendMode,c=null,d=0,_=this.currentBatchSize;d<_;d++){n=((a=this.sprites[d]).tilingTexture||a.texture).baseTexture,s=u!==(r=a.blendMode),o=c!==(y=a.shader||this.defaultShader);var y,f=n.skipRender;f&&0<a.children.length&&(f=!1),(h!==n&&!f||s||o)&&(this.renderBatch(h,l,p),p=d,l=0,h=n,s&&(u=r,this.renderSession.blendModeManager.setBlendMode(u)),o)&&((t=(c=y).shaders[i.id])||((t=new T.PixiShader(i)).fragmentSrc=c.fragmentSrc,t.uniforms=c.uniforms,t.init(),c.shaders[i.id]=t),this.renderSession.shaderManager.setShader(t),t.dirty&&t.syncUniforms(),y=this.renderSession.projection,i.uniform2f(t.projectionVector,y.x,y.y),y=this.renderSession.offset,i.uniform2f(t.offsetVector,y.x,y.y)),l++}this.renderBatch(h,l,p),this.currentBatchSize=0}},T.WebGLSpriteBatch.prototype.renderBatch=function(t,e,i){if(0!==e){var n=this.gl;if(t._dirty[n.id]){if(!this.renderSession.renderer.updateTexture(t))return}else n.bindTexture(n.TEXTURE_2D,t._glTextures[n.id]);n.drawElements(n.TRIANGLES,6*e,n.UNSIGNED_SHORT,6*i*2),this.renderSession.drawCount++}},T.WebGLSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},T.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},T.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},T.WebGLFastSpriteBatch=function(t){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var e=4*this.size*this.vertSize,i=6*this.maxSize;this.vertices=new T.Float32Array(e),this.indices=new T.Uint16Array(i),this.vertexBuffer=null,this.indexBuffer=null;for(var n=this.lastIndexCount=0,r=0;n<i;n+=6,r+=4)this.indices[n+0]=r+0,this.indices[n+1]=r+1,this.indices[n+2]=r+2,this.indices[n+3]=r+0,this.indices[n+4]=r+2,this.indices[n+5]=r+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(t)},T.WebGLFastSpriteBatch.prototype.constructor=T.WebGLFastSpriteBatch,T.WebGLFastSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW)},T.WebGLFastSpriteBatch.prototype.begin=function(t,e){this.renderSession=e,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=t.worldTransform.toArray(!0),this.start()},T.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},T.WebGLFastSpriteBatch.prototype.render=function(t){var e=t.children,t=e[0];if(t.texture._uvs){this.currentBaseTexture=t.texture.baseTexture,t.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(t.blendMode));for(var i=0,n=e.length;i<n;i++)this.renderSprite(e[i]);this.flush()}},T.WebGLFastSpriteBatch.prototype.renderSprite=function(t){var e,i,n,r,s,o,a;t.visible&&(t.texture.baseTexture===this.currentBaseTexture||t.texture.baseTexture.skipRender||(this.flush(),this.currentBaseTexture=t.texture.baseTexture,t.texture._uvs))&&(e=this.vertices,a=t.texture._uvs,t.texture.frame.width,t.texture.frame.height,t.texture.trim?(r=(n=(i=t.texture.trim).x-t.anchor.x*i.width)+t.texture.crop.width,o=(s=i.y-t.anchor.y*i.height)+t.texture.crop.height):(r=t.texture.frame.width*(1-t.anchor.x),n=t.texture.frame.width*-t.anchor.x,o=t.texture.frame.height*(1-t.anchor.y),s=t.texture.frame.height*-t.anchor.y),i=4*this.currentBatchSize*this.vertSize,e[i++]=n,e[i++]=s,e[i++]=t.position.x,e[i++]=t.position.y,e[i++]=t.scale.x,e[i++]=t.scale.y,e[i++]=t.rotation,e[i++]=a.x0,e[i++]=a.y1,e[i++]=t.alpha,e[i++]=r,e[i++]=s,e[i++]=t.position.x,e[i++]=t.position.y,e[i++]=t.scale.x,e[i++]=t.scale.y,e[i++]=t.rotation,e[i++]=a.x1,e[i++]=a.y1,e[i++]=t.alpha,e[i++]=r,e[i++]=o,e[i++]=t.position.x,e[i++]=t.position.y,e[i++]=t.scale.x,e[i++]=t.scale.y,e[i++]=t.rotation,e[i++]=a.x2,e[i++]=a.y2,e[i++]=t.alpha,e[i++]=n,e[i++]=o,e[i++]=t.position.x,e[i++]=t.position.y,e[i++]=t.scale.x,e[i++]=t.scale.y,e[i++]=t.rotation,e[i++]=a.x3,e[i++]=a.y3,e[i++]=t.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush())},T.WebGLFastSpriteBatch.prototype.flush=function(){var t,e;0!==this.currentBatchSize&&(t=this.gl,this.currentBaseTexture._glTextures[t.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,t),t.bindTexture(t.TEXTURE_2D,this.currentBaseTexture._glTextures[t.id]),this.currentBatchSize>.5*this.size?t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices):(e=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize),t.bufferSubData(t.ARRAY_BUFFER,0,e)),t.drawElements(t.TRIANGLES,6*this.currentBatchSize,t.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++)},T.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},T.WebGLFastSpriteBatch.prototype.start=function(){var t=this.gl;t.activeTexture(t.TEXTURE0),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.renderSession.projection;t.uniform2f(this.shader.projectionVector,e.x,e.y),t.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);e=4*this.vertSize;t.vertexAttribPointer(this.shader.aVertexPosition,2,t.FLOAT,!1,e,0),t.vertexAttribPointer(this.shader.aPositionCoord,2,t.FLOAT,!1,e,8),t.vertexAttribPointer(this.shader.aScale,2,t.FLOAT,!1,e,16),t.vertexAttribPointer(this.shader.aRotation,1,t.FLOAT,!1,e,24),t.vertexAttribPointer(this.shader.aTextureCoord,2,t.FLOAT,!1,e,28),t.vertexAttribPointer(this.shader.colorAttribute,1,t.FLOAT,!1,e,36)},T.WebGLFilterManager=function(){this.filterStack=[],this.offsetX=0,this.offsetY=0},T.WebGLFilterManager.prototype.constructor=T.WebGLFilterManager,T.WebGLFilterManager.prototype.setContext=function(t){this.gl=t,this.texturePool=[],this.initShaderBuffers()},T.WebGLFilterManager.prototype.begin=function(t,e){this.renderSession=t,this.defaultShader=t.shaderManager.defaultShader;t=this.renderSession.projection;this.width=2*t.x,this.height=2*-t.y,this.buffer=e},T.WebGLFilterManager.prototype.pushFilter=function(t){var e=this.gl,i=this.renderSession.projection,n=this.renderSession.offset;t._filterArea=t.target.filterArea||t.target.getBounds(),t._previous_stencil_mgr=this.renderSession.stencilManager,this.renderSession.stencilManager=new T.WebGLStencilManager,this.renderSession.stencilManager.setContext(e),e.disable(e.STENCIL_TEST),this.filterStack.push(t);var r=t.filterPasses[0];this.offsetX+=t._filterArea.x,this.offsetY+=t._filterArea.y;var s=this.texturePool.pop();s?s.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution):s=new T.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),e.bindTexture(e.TEXTURE_2D,s.texture);var o=t._filterArea,r=r.padding;o.x-=r,o.y-=r,o.width+=2*r,o.height+=2*r,o.x<0&&(o.x=0),o.width>this.width&&(o.width=this.width),o.y<0&&(o.y=0),o.height>this.height&&(o.height=this.height),e.bindFramebuffer(e.FRAMEBUFFER,s.frameBuffer),e.viewport(0,0,o.width*this.renderSession.resolution,o.height*this.renderSession.resolution),i.x=o.width/2,i.y=-o.height/2,n.x=-o.x,n.y=-o.y,e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),t._glFilterTexture=s},T.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl,e=this.filterStack.pop(),i=e._filterArea,n=e._glFilterTexture,r=this.renderSession.projection,s=this.renderSession.offset;if(1<e.filterPasses.length){t.viewport(0,0,i.width*this.renderSession.resolution,i.height*this.renderSession.resolution),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=i.height,this.vertexArray[2]=i.width,this.vertexArray[3]=i.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=i.width,this.vertexArray[7]=0,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=i.width/this.width,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);var o=n;(p=(p=this.texturePool.pop())||new T.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)).resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),t.bindFramebuffer(t.FRAMEBUFFER,p.frameBuffer),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.BLEND);for(var a=0;a<e.filterPasses.length-1;a++){var l=e.filterPasses[a];t.bindFramebuffer(t.FRAMEBUFFER,p.frameBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,o.texture),this.applyFilterPass(l,i,i.width,i.height);var l=o,o=p,p=l}t.enable(t.BLEND),n=o,this.texturePool.push(p)}var h=e.filterPasses[e.filterPasses.length-1];this.offsetX-=i.x,this.offsetY-=i.y;var u,c=this.width,d=this.height,_=0,y=0,f=this.buffer;0===this.filterStack.length?t.colorMask(!0,!0,!0,!0):(c=(i=(u=this.filterStack[this.filterStack.length-1])._filterArea).width,d=i.height,_=i.x,y=i.y,f=u._glFilterTexture.frameBuffer),r.x=c/2,r.y=-d/2,s.x=_,s.y=y;_=(i=e._filterArea).x-_,y=i.y-y;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=_,this.vertexArray[1]=y+i.height,this.vertexArray[2]=_+i.width,this.vertexArray[3]=y+i.height,this.vertexArray[4]=_,this.vertexArray[5]=y,this.vertexArray[6]=_+i.width,this.vertexArray[7]=y,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=i.width/this.width,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),t.viewport(0,0,c*this.renderSession.resolution,d*this.renderSession.resolution),t.bindFramebuffer(t.FRAMEBUFFER,f),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,n.texture),this.renderSession.stencilManager&&this.renderSession.stencilManager.destroy(),this.renderSession.stencilManager=e._previous_stencil_mgr,e._previous_stencil_mgr=null,0<this.renderSession.stencilManager.count?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.applyFilterPass(h,i,c,d),this.texturePool.push(n),e._glFilterTexture=null},T.WebGLFilterManager.prototype.applyFilterPass=function(t,e,i,n){var r=this.gl,s=t.shaders[r.id];s||((s=new T.PixiShader(r)).fragmentSrc=t.fragmentSrc,s.uniforms=t.uniforms,s.init(),t.shaders[r.id]=s),this.renderSession.shaderManager.setShader(s),r.uniform2f(s.projectionVector,i/2,-n/2),r.uniform2f(s.offsetVector,0,0),t.uniforms.dimensions&&(t.uniforms.dimensions.value[0]=this.width,t.uniforms.dimensions.value[1]=this.height,t.uniforms.dimensions.value[2]=this.vertexArray[0],t.uniforms.dimensions.value[3]=this.vertexArray[5]),s.syncUniforms(),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),r.vertexAttribPointer(s.aVertexPosition,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this.uvBuffer),r.vertexAttribPointer(s.aTextureCoord,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this.colorBuffer),r.vertexAttribPointer(s.colorAttribute,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer),r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0),this.renderSession.drawCount++},T.WebGLFilterManager.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.vertexArray=new T.Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW),this.uvArray=new T.Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW),this.colorArray=new T.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)},T.WebGLFilterManager.prototype.destroy=function(){var t=this.gl;this.filterStack=null,this.offsetX=0;for(var e=this.offsetY=0;e<this.texturePool.length;e++)this.texturePool[e].destroy();this.texturePool=null,t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.uvBuffer),t.deleteBuffer(this.colorBuffer),t.deleteBuffer(this.indexBuffer)},T.FilterTexture=function(t,e,i,n){this.gl=t,this.frameBuffer=t.createFramebuffer(),this.texture=t.createTexture(),n=n||T.scaleModes.DEFAULT,t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,n===T.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n===T.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0),this.renderBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.renderBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderBuffer),this.resize(e,i)},T.FilterTexture.prototype.constructor=T.FilterTexture,T.FilterTexture.prototype.clear=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},T.FilterTexture.prototype.resize=function(t,e){var i;this.width===t&&this.height===e||(this.width=t,this.height=e,(i=this.gl).bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,e))},T.FilterTexture.prototype.destroy=function(){var t=this.gl;t.deleteFramebuffer(this.frameBuffer),t.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},T.CanvasBuffer=function(t,e){this.width=t,this.height=e,this.canvas=T.CanvasPool.create(this,this.width,this.height),this.context=this.canvas.getContext("2d"),this.canvas.width=t,this.canvas.height=e},T.CanvasBuffer.prototype.constructor=T.CanvasBuffer,T.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height)},T.CanvasBuffer.prototype.resize=function(t,e){this.width=this.canvas.width=t,this.height=this.canvas.height=e},T.CanvasBuffer.prototype.destroy=function(){T.CanvasPool.remove(this)},T.CanvasMaskManager=function(){},T.CanvasMaskManager.prototype.constructor=T.CanvasMaskManager,T.CanvasMaskManager.prototype.pushMask=function(t,e){var i=e.context;i.save();var n=t.alpha,r=t.worldTransform,e=e.resolution;i.setTransform(r.a*e,r.b*e,r.c*e,r.d*e,r.tx*e,r.ty*e),T.CanvasGraphics.renderGraphicsMask(t,i),i.clip(),t.worldAlpha=n},T.CanvasMaskManager.prototype.popMask=function(t){t.context.restore()},T.CanvasTinter=function(){},T.CanvasTinter.getTintedTexture=function(t,e){var i=t.tintedTexture||T.CanvasPool.create(this);return T.CanvasTinter.tintMethod(t.texture,e,i),i},T.CanvasTinter.tintWithMultiply=function(t,e,i){var n=i.getContext("2d"),r=t.crop;i.width===r.width&&i.height===r.height||(i.width=r.width,i.height=r.height),n.clearRect(0,0,r.width,r.height),n.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),n.fillRect(0,0,r.width,r.height),n.globalCompositeOperation="multiply",n.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height),n.globalCompositeOperation="destination-atop",n.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)},T.CanvasTinter.tintWithPerPixel=function(t,e,i){var n=i.getContext("2d"),r=t.crop;i.width=r.width,i.height=r.height,n.globalCompositeOperation="copy",n.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height);for(var s,e=T.hex2rgb(e),o=e[0],a=e[1],l=e[2],r=n.getImageData(0,0,r.width,r.height),p=r.data,h=0;h<p.length;h+=4)p[h+0]*=o,p[h+1]*=a,p[h+2]*=l,T.CanvasTinter.canHandleAlpha||(s=p[h+3],p[h+0]/=255/s,p[h+1]/=255/s,p[h+2]/=255/s);n.putImageData(r,0,0)},T.CanvasTinter.checkInverseAlpha=function(){var t=new T.CanvasBuffer(2,1);t.context.fillStyle="rgba(10, 20, 30, 0.5)",t.context.fillRect(0,0,1,1);var e=t.context.getImageData(0,0,1,1);if(null===e)return!1;t.context.putImageData(e,1,0);t=t.context.getImageData(1,0,1,1);return t.data[0]===e.data[0]&&t.data[1]===e.data[1]&&t.data[2]===e.data[2]&&t.data[3]===e.data[3]},T.CanvasTinter.canHandleAlpha=T.CanvasTinter.checkInverseAlpha(),T.CanvasTinter.canUseMultiply=T.canUseNewCanvasBlendModes(),T.CanvasTinter.tintMethod=T.CanvasTinter.canUseMultiply?T.CanvasTinter.tintWithMultiply:T.CanvasTinter.tintWithPerPixel,T.CanvasRenderer=function(t){this.game=t,T.defaultRenderer||(T.defaultRenderer=this),this.type=T.CANVAS_RENDERER,this.resolution=t.resolution,this.clearBeforeRender=t.clearBeforeRender,this.transparent=t.transparent,this.autoResize=!1,this.width=t.width*this.resolution,this.height=t.height*this.resolution,this.view=t.canvas,this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.count=0,this.maskManager=new T.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:Phaser.Canvas.getSmoothingPrefix(this.context),roundPixels:!1},this.mapBlendModes(),this.resize(this.width,this.height)},T.CanvasRenderer.prototype.constructor=T.CanvasRenderer,T.CanvasRenderer.prototype.render=function(t){this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=0,this.renderSession.shakeX=this.game.camera._shake.x,this.renderSession.shakeY=this.game.camera._shake.y,this.context.globalCompositeOperation="source-over",navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):t._bgColor&&(this.context.fillStyle=t._bgColor.rgba,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(t)},T.CanvasRenderer.prototype.destroy=function(t){void 0===t&&(t=!0),t&&this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.context=null,this.maskManager=null,this.renderSession=null},T.CanvasRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.renderSession.smoothProperty&&(this.context[this.renderSession.smoothProperty]=this.renderSession.scaleMode===T.scaleModes.LINEAR)},T.CanvasRenderer.prototype.renderDisplayObject=function(t,e,i){this.renderSession.context=e||this.context,this.renderSession.resolution=this.resolution,t._renderCanvas(this.renderSession,i)},T.CanvasRenderer.prototype.mapBlendModes=function(){var t,e,i;T.blendModesCanvas||(t=[],e=T.blendModes,i=T.canUseNewCanvasBlendModes(),t[e.NORMAL]="source-over",t[e.ADD]="lighter",t[e.MULTIPLY]=i?"multiply":"source-over",t[e.SCREEN]=i?"screen":"source-over",t[e.OVERLAY]=i?"overlay":"source-over",t[e.DARKEN]=i?"darken":"source-over",t[e.LIGHTEN]=i?"lighten":"source-over",t[e.COLOR_DODGE]=i?"color-dodge":"source-over",t[e.COLOR_BURN]=i?"color-burn":"source-over",t[e.HARD_LIGHT]=i?"hard-light":"source-over",t[e.SOFT_LIGHT]=i?"soft-light":"source-over",t[e.DIFFERENCE]=i?"difference":"source-over",t[e.EXCLUSION]=i?"exclusion":"source-over",t[e.HUE]=i?"hue":"source-over",t[e.SATURATION]=i?"saturation":"source-over",t[e.COLOR]=i?"color":"source-over",t[e.LUMINOSITY]=i?"luminosity":"source-over",T.blendModesCanvas=t)},T.BaseTexture=function(t,e){this.resolution=1,this.width=100,this.height=100,this.scaleMode=e||T.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=t,this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this._dirty=[!0,!0,!0,!0],t&&((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height&&(this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty()),this.skipRender=!1,this._powerOf2=!1)},T.BaseTexture.prototype.constructor=T.BaseTexture,T.BaseTexture.prototype.forceLoaded=function(t,e){this.hasLoaded=!0,this.width=t,this.height=e,this.dirty()},T.BaseTexture.prototype.destroy=function(){this.source&&T.CanvasPool.removeByCanvas(this.source),this.source=null,this.unloadFromGPU()},T.BaseTexture.prototype.updateSourceImage=function(t){},T.BaseTexture.prototype.dirty=function(){for(var t=0;t<this._glTextures.length;t++)this._dirty[t]=!0},T.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var t=this._glTextures.length-1;0<=t;t--){var e=this._glTextures[t],i=T.glContexts[t];i&&e&&i.deleteTexture(e)}this._glTextures.length=0,this.dirty()},T.BaseTexture.fromCanvas=function(t,e){return 0===t.width&&(t.width=1),0===t.height&&(t.height=1),new T.BaseTexture(t,e)},T.TextureSilentFail=!1,T.Texture=function(t,e,i,n){this.noFrame=!1,e||(this.noFrame=!0,e=new T.Rectangle(0,0,1,1)),t instanceof T.Texture&&(t=t.baseTexture),this.baseTexture=t,this.frame=e,this.trim=n,this.valid=!1,this.isTiling=!1,this.requiresUpdate=!1,this.requiresReTint=!1,this._uvs=null,this.width=0,this.height=0,this.crop=i||new T.Rectangle(0,0,1,1),t.hasLoaded&&(this.noFrame&&(e=new T.Rectangle(0,0,t.width,t.height)),this.setFrame(e))},T.Texture.prototype.constructor=T.Texture,T.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;this.noFrame&&(this.frame=new T.Rectangle(0,0,t.width,t.height)),this.setFrame(this.frame)},T.Texture.prototype.destroy=function(t){t&&this.baseTexture.destroy(),this.valid=!1},T.Texture.prototype.setFrame=function(t){if(this.noFrame=!1,this.frame=t,this.width=t.width,this.height=t.height,this.crop.x=t.x,this.crop.y=t.y,this.crop.width=t.width,this.crop.height=t.height,this.trim||!(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height))this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs();else{if(!T.TextureSilentFail)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=!1}},T.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new T.TextureUvs);var t=this.crop,e=this.baseTexture.width,i=this.baseTexture.height;this._uvs.x0=t.x/e,this._uvs.y0=t.y/i,this._uvs.x1=(t.x+t.width)/e,this._uvs.y1=t.y/i,this._uvs.x2=(t.x+t.width)/e,this._uvs.y2=(t.y+t.height)/i,this._uvs.x3=t.x/e,this._uvs.y3=(t.y+t.height)/i},T.Texture.fromCanvas=function(t,e){e=T.BaseTexture.fromCanvas(t,e);return new T.Texture(e)},T.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},T.RenderTexture=function(t,e,i,n,r){this.width=t||100,this.height=e||100,this.resolution=r||1,this.frame=new T.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new T.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new T.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=n||T.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,T.Texture.call(this,this.baseTexture,new T.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution)),this.renderer=i||T.defaultRenderer,this.renderer.type===T.WEBGL_RENDERER?(i=this.renderer.gl,this.baseTexture._dirty[i.id]=!1,this.textureBuffer=new T.FilterTexture(i,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[i.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new T.Point(.5*this.width,.5*-this.height)):(this.render=this.renderCanvas,this.textureBuffer=new T.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas),this.valid=!0,this.tempMatrix=new Phaser.Matrix,this._updateUvs()},T.RenderTexture.prototype=Object.create(T.Texture.prototype),T.RenderTexture.prototype.constructor=T.RenderTexture,T.RenderTexture.prototype.resize=function(t,e,i){t===this.width&&e===this.height||(this.valid=0<t&&0<e,this.width=t,this.height=e,this.frame.width=this.crop.width=t*this.resolution,this.frame.height=this.crop.height=e*this.resolution,i&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===T.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width,this.height))},T.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===T.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},T.RenderTexture.prototype.renderWebGL=function(t,e,i){if(this.valid&&0!==t.alpha){var n=t.worldTransform;n.identity(),n.translate(0,2*this.projection.y),e&&n.append(e),n.scale(1,-1);for(var r=0;r<t.children.length;r++)t.children[r].updateTransform();n=this.renderer.gl;n.viewport(0,0,this.width*this.resolution,this.height*this.resolution),n.bindFramebuffer(n.FRAMEBUFFER,this.textureBuffer.frameBuffer),i&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer,e),this.renderer.spriteBatch.dirty=!0}},T.RenderTexture.prototype.renderCanvas=function(t,e,i){if(this.valid&&0!==t.alpha){var n=t.worldTransform;n.identity(),e&&n.append(e);for(var r=0;r<t.children.length;r++)t.children[r].updateTransform();i&&this.textureBuffer.clear();i=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(t,this.textureBuffer.context,e),this.renderer.resolution=i}},T.RenderTexture.prototype.getImage=function(){var t=new Image;return t.src=this.getBase64(),t},T.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},T.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type!==T.WEBGL_RENDERER)return this.textureBuffer.canvas;var t=this.renderer.gl,e=this.textureBuffer.width,i=this.textureBuffer.height,n=new Uint8Array(4*e*i);t.bindFramebuffer(t.FRAMEBUFFER,this.textureBuffer.frameBuffer),t.readPixels(0,0,e,i,t.RGBA,t.UNSIGNED_BYTE,n),t.bindFramebuffer(t.FRAMEBUFFER,null);t=new T.CanvasBuffer(e,i),i=t.context.getImageData(0,0,e,i);return i.data.set(n),t.context.putImageData(i,0,0),t.canvas},T.AbstractFilter=function(t,e){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=e||{},this.fragmentSrc=t||[]},T.AbstractFilter.prototype.constructor=T.AbstractFilter,T.AbstractFilter.prototype.syncUniforms=function(){for(var t=0,e=this.shaders.length;t<e;t++)this.shaders[t].dirty=!0},T.Strip=function(t){T.DisplayObjectContainer.call(this),this.texture=t,this.uvs=new T.Float32Array([0,1,1,1,1,0,0,1]),this.vertices=new T.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new T.Float32Array([1,1,1,1]),this.indices=new T.Uint16Array([0,1,2,3]),this.dirty=!0,this.blendMode=T.blendModes.NORMAL,this.canvasPadding=0,this.drawMode=T.Strip.DrawModes.TRIANGLE_STRIP},T.Strip.prototype=Object.create(T.DisplayObjectContainer.prototype),T.Strip.prototype.constructor=T.Strip,T.Strip.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||(t.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(t),t.shaderManager.setShader(t.shaderManager.stripShader),this._renderStrip(t),t.spriteBatch.start())},T.Strip.prototype._initWebGL=function(t){t=t.gl;this._vertexBuffer=t.createBuffer(),this._indexBuffer=t.createBuffer(),this._uvBuffer=t.createBuffer(),this._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvs,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW)},T.Strip.prototype._renderStrip=function(t){var e=t.gl,i=t.projection,n=t.offset,r=t.shaderManager.stripShader,s=this.drawMode===T.Strip.DrawModes.TRIANGLE_STRIP?e.TRIANGLE_STRIP:e.TRIANGLES;t.blendModeManager.setBlendMode(this.blendMode),e.uniformMatrix3fv(r.translationMatrix,!1,this.worldTransform.toArray(!0)),e.uniform2f(r.projectionVector,i.x,-i.y),e.uniform2f(r.offsetVector,-n.x,-n.y),e.uniform1f(r.alpha,this.worldAlpha),this.dirty?(this.dirty=!1,e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.STATIC_DRAW),e.vertexAttribPointer(r.aVertexPosition,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW),e.vertexAttribPointer(r.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),this.texture.baseTexture._dirty[e.id]?t.renderer.updateTexture(this.texture.baseTexture):e.bindTexture(e.TEXTURE_2D,this.texture.baseTexture._glTextures[e.id]),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)):(e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices),e.vertexAttribPointer(r.aVertexPosition,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer),e.vertexAttribPointer(r.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),this.texture.baseTexture._dirty[e.id]?t.renderer.updateTexture(this.texture.baseTexture):e.bindTexture(e.TEXTURE_2D,this.texture.baseTexture._glTextures[e.id]),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),e.drawElements(s,this.indices.length,e.UNSIGNED_SHORT,0)},T.Strip.prototype._renderCanvas=function(t){var e=t.context,i=this.worldTransform,n=i.tx*t.resolution+t.shakeX,r=i.ty*t.resolution+t.shakeY;t.roundPixels?e.setTransform(i.a,i.b,i.c,i.d,0|n,0|r):e.setTransform(i.a,i.b,i.c,i.d,n,r),this.drawMode===T.Strip.DrawModes.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(e):this._renderCanvasTriangles(e)},T.Strip.prototype._renderCanvasTriangleStrip=function(t){var e=this.vertices,i=this.uvs,n=e.length/2;this.count++;for(var r=0;r<n-2;r++){var s=2*r;this._renderCanvasDrawTriangle(t,e,i,s,2+s,4+s)}},T.Strip.prototype._renderCanvasTriangles=function(t){var e=this.vertices,i=this.uvs,n=this.indices,r=n.length;this.count++;for(var s=0;s<r;s+=3){var o=2*n[s],a=2*n[s+1],l=2*n[s+2];this._renderCanvasDrawTriangle(t,e,i,o,a,l)}},T.Strip.prototype._renderCanvasDrawTriangle=function(t,e,i,n,r,s){var o=this.texture.baseTexture.source,a=this.texture.width,l=this.texture.height,p=e[n],h=e[r],u=e[s],c=e[n+1],d=e[r+1],_=e[s+1],y=i[n]*a,f=i[r]*a,m=i[s]*a,e=i[n+1]*l,a=i[r+1]*l,n=i[s+1]*l;0<this.canvasPadding&&(r=this.canvasPadding/this.worldTransform.a,g=this.canvasPadding/this.worldTransform.d,x=c-(i=(c+d+_)/3),p=(s=(p+h+u)/3)+(l=p-s)/(v=Math.sqrt(l*l+x*x))*(v+r),c=i+x/v*(v+g),x=d-i,h=s+(l=h-s)/(v=Math.sqrt(l*l+x*x))*(v+r),d=i+x/v*(v+g),x=_-i,u=s+(l=u-s)/(v=Math.sqrt(l*l+x*x))*(v+r),_=i+x/v*(v+g)),t.save(),t.beginPath(),t.moveTo(p,c),t.lineTo(h,d),t.lineTo(u,_),t.closePath(),t.clip();var x=y*a+e*m+f*n-a*m-e*f-y*n,v=p*a+e*u+h*n-a*u-e*h-p*n,g=y*h+p*m+f*u-h*m-p*f-y*u,p=y*a*u+e*h*m+p*f*n-p*a*m-e*f*u-y*h*n,u=c*a+e*_+d*n-a*_-e*d-c*n,h=y*d+c*m+f*_-d*m-c*f-y*_,n=y*a*_+e*d*m+c*f*n-c*a*m-e*f*_-y*d*n;t.transform(v/x,u/x,g/x,h/x,p/x,n/x),t.drawImage(o,0,0),t.restore()},T.Strip.prototype.renderStripFlat=function(t){var e=this.context,i=t.vertices,n=i.length/2;this.count++,e.beginPath();for(var r=1;r<n-2;r++){var s=2*r,o=i[s],a=i[2+s],l=i[4+s],p=i[1+s],h=i[3+s],s=i[5+s];e.moveTo(o,p),e.lineTo(a,h),e.lineTo(l,s)}e.fillStyle="#FF0000",e.fill(),e.closePath()},T.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},T.Strip.prototype.getBounds=function(t){for(var t=t||this.worldTransform,e=t.a,i=t.b,n=t.c,r=t.d,s=t.tx,o=t.ty,a=-1/0,l=-1/0,p=1/0,h=1/0,u=this.vertices,c=0,d=u.length;c<d;c+=2)var _=u[c],y=u[c+1],f=e*_+n*y+s,_=r*y+i*_+o,p=f<p?f:p,h=_<h?_:h,a=a<f?f:a,l=l<_?_:l;if(p===-1/0||l===1/0)return T.EmptyRectangle;t=this._bounds;return t.x=p,t.width=a-p,t.y=h,t.height=l-h,this._currentBounds=t},T.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1},T.Rope=function(t,e){T.Strip.call(this,t),this.points=e,this.vertices=new T.Float32Array(4*e.length),this.uvs=new T.Float32Array(4*e.length),this.colors=new T.Float32Array(2*e.length),this.indices=new T.Uint16Array(2*e.length),this.refresh()},T.Rope.prototype=Object.create(T.Strip.prototype),T.Rope.prototype.constructor=T.Rope,T.Rope.prototype.refresh=function(){var t=this.points;if(!(t.length<1)){var e=this.uvs,i=(t[0],this.indices),n=this.colors;this.count-=.2,e[0]=0,e[1]=0,e[2]=0,e[3]=1,n[0]=1,n[1]=1,i[0]=0,i[1]=1;for(var r,s,o=t.length,a=1;a<o;a++)t[a],s=a/(o-1),e[r=4*a]=s,e[1+r]=0,e[2+r]=s,e[3+r]=1,n[r=2*a]=1,n[1+r]=1,i[r=2*a]=r,i[1+r]=1+r,0}},T.Rope.prototype.updateTransform=function(){var t=this.points;if(!(t.length<1)){var e=t[0],i={x:0,y:0};this.count-=.2;for(var n,r,s,o,a=this.vertices,l=t.length,p=0;p<l;p++)n=t[p],r=4*p,o=p<t.length-1?t[p+1]:n,i.y=-(o.x-e.x),i.x=o.y-e.y,s=Math.sqrt(i.x*i.x+i.y*i.y),o=this.texture.height/2,i.x/=s,i.y/=s,i.x*=o,i.y*=o,a[r]=n.x+i.x,a[1+r]=n.y+i.y,a[2+r]=n.x-i.x,a[3+r]=n.y-i.y,e=n;T.DisplayObjectContainer.prototype.updateTransform.call(this)}},T.Rope.prototype.setTexture=function(t){this.texture=t},T.TilingSprite=function(t,e,i){T.Sprite.call(this,t),this._width=e||128,this._height=i||128,this.tileScale=new T.Point(1,1),this.tileScaleOffset=new T.Point(1,1),this.tilePosition=new T.Point,this.renderable=!0,this.tint=16777215,this.textureDebug=!1,this.blendMode=T.blendModes.NORMAL,this.canvasBuffer=null,this.tilingTexture=null,this.tilePattern=null,this.refreshTexture=!0,this.frameWidth=0,this.frameHeight=0},T.TilingSprite.prototype=Object.create(T.Sprite.prototype),T.TilingSprite.prototype.constructor=T.TilingSprite,T.TilingSprite.prototype.setTexture=function(t){this.texture!==t&&(this.texture=t,this.refreshTexture=!0,this.cachedTint=16777215)},T.TilingSprite.prototype._renderWebGL=function(t){if(this.visible&&this.renderable&&0!==this.alpha){if(this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this.refreshTexture){if(this.generateTilingTexture(!0,t),!this.tilingTexture)return;this.tilingTexture.needsUpdate&&(t.renderer.updateTexture(this.tilingTexture.baseTexture),this.tilingTexture.needsUpdate=!1)}t.spriteBatch.renderTilingSprite(this);for(var e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this._mask,t),t.spriteBatch.start()}},T.TilingSprite.prototype._renderCanvas=function(t){if(this.visible&&this.renderable&&0!==this.alpha){var e=t.context;this._mask&&t.maskManager.pushMask(this._mask,t),e.globalAlpha=this.worldAlpha;var i=this.worldTransform,n=t.resolution,r=i.tx*n+t.shakeX,s=i.ty*n+t.shakeY;if(e.setTransform(i.a*n,i.b*n,i.c*n,i.d*n,r,s),this.refreshTexture){if(this.generateTilingTexture(!1,t),!this.tilingTexture)return;this.tilePattern=e.createPattern(this.tilingTexture.baseTexture.source,"repeat")}var o=t.currentBlendMode;this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,e.globalCompositeOperation=T.blendModesCanvas[t.currentBlendMode]);var a=this.tilePosition,l=this.tileScale;a.x%=this.tilingTexture.baseTexture.width,a.y%=this.tilingTexture.baseTexture.height,e.scale(l.x,l.y),e.translate(a.x+this.anchor.x*-this._width,a.y+this.anchor.y*-this._height),e.fillStyle=this.tilePattern;r=-a.x,s=-a.y,i=this._width/l.x,n=this._height/l.y;t.roundPixels&&(r|=0,s|=0,i|=0,n|=0),e.fillRect(r,s,i,n),e.scale(1/l.x,1/l.y),e.translate(-a.x+this.anchor.x*this._width,-a.y+this.anchor.y*this._height),this._mask&&t.maskManager.popMask(t);for(var p=0;p<this.children.length;p++)this.children[p]._renderCanvas(t);o!==this.blendMode&&(t.currentBlendMode=o,e.globalCompositeOperation=T.blendModesCanvas[o])}},T.TilingSprite.prototype.onTextureUpdate=function(){},T.TilingSprite.prototype.generateTilingTexture=function(t,e){var i,n,r,s,o,a,l;this.texture.baseTexture.hasLoaded&&(n=(i=this.texture).frame,r=this._frame.sourceSizeW||this._frame.width,s=this._frame.sourceSizeH||this._frame.height,a=o=0,this._frame.trimmed&&(o=this._frame.spriteSourceSizeX,a=this._frame.spriteSourceSizeY),t&&(r=T.getNextPowerOfTwo(r),s=T.getNextPowerOfTwo(s)),this.canvasBuffer?(this.canvasBuffer.resize(r,s),this.tilingTexture.baseTexture.width=r,this.tilingTexture.baseTexture.height=s):(this.canvasBuffer=new T.CanvasBuffer(r,s),this.tilingTexture=T.Texture.fromCanvas(this.canvasBuffer.canvas),this.tilingTexture.isTiling=!0),this.tilingTexture.needsUpdate=!0,this.textureDebug&&(this.canvasBuffer.context.strokeStyle="#00ff00",this.canvasBuffer.context.strokeRect(0,0,r,s)),l=i.crop.width,t=i.crop.height,l===r&&t===s||(l=r,t=s),this.canvasBuffer.context.drawImage(i.baseTexture.source,i.crop.x,i.crop.y,i.crop.width,i.crop.height,o,a,l,t),this.tileScaleOffset.x=n.width/r,this.tileScaleOffset.y=n.height/s,this.refreshTexture=!1,this.tilingTexture.baseTexture._powerOf2=!0)},T.TilingSprite.prototype.getBounds=function(){var t=this._width,e=this._height,i=t*(1-this.anchor.x),n=t*-this.anchor.x,r=e*(1-this.anchor.y),s=e*-this.anchor.y,o=this.worldTransform,a=o.a,l=o.b,p=o.c,h=o.d,u=o.tx,c=o.ty,d=a*n+p*s+u,t=h*s+l*n+c,e=a*i+p*s+u,o=h*s+l*i+c,s=a*i+p*r+u,i=h*r+l*i+c,u=a*n+p*r+u,h=h*r+l*n+c,r=-1/0,l=-1/0,n=1/0,c=1/0;n=u<(n=s<(n=e<(n=d<n?d:n)?e:n)?s:n)?u:n,c=h<(c=i<(c=o<(c=t<c?t:c)?o:c)?i:c)?h:c,r=(r=(r=(r=r<d?d:r)<e?e:r)<s?s:r)<u?u:r,l=(l=(l=(l=l<t?t:l)<o?o:l)<i?i:l)<h?h:l;h=this._bounds;return h.x=n,h.width=r-n,h.y=c,h.height=l-c,this._currentBounds=h},T.TilingSprite.prototype.destroy=function(){T.Sprite.prototype.destroy.call(this),this.canvasBuffer&&(this.canvasBuffer.destroy(),this.canvasBuffer=null),this.tileScale=null,this.tileScaleOffset=null,this.tilePosition=null,this.tilingTexture&&(this.tilingTexture.destroy(!0),this.tilingTexture=null)},Object.defineProperty(T.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}}),Object.defineProperty(T.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}}),void 0!==t&&t.exports&&(e=t.exports=T),e.PIXI=T}).call(this)},function(l,p,t){(function(a){(function(){function n(t,e){this._scaleFactor=t,this._deltaMode=e,this.originalEvent=null}var t,s,e,i,U=U||{VERSION:"2.6.4",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,CREATURE:27,VIDEO:28,PENDING_ATLAS:-1,HORIZONTAL:0,VERTICAL:1,LANDSCAPE:0,PORTRAIT:1,ANGLE_UP:270,ANGLE_DOWN:90,ANGLE_LEFT:180,ANGLE_RIGHT:0,ANGLE_NORTH_EAST:315,ANGLE_NORTH_WEST:225,ANGLE_SOUTH_EAST:45,ANGLE_SOUTH_WEST:135,TOP_LEFT:0,TOP_CENTER:1,TOP_RIGHT:2,LEFT_TOP:3,LEFT_CENTER:4,LEFT_BOTTOM:5,CENTER:6,RIGHT_TOP:7,RIGHT_CENTER:8,RIGHT_BOTTOM:9,BOTTOM_LEFT:10,BOTTOM_CENTER:11,BOTTOM_RIGHT:12,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1},PIXI:PIXI||{}};for(e in Math.trunc||(Math.trunc=function(t){return t<0?Math.ceil(t):Math.floor(t)}),Function.prototype.bind||(Function.prototype.bind=(s=Array.prototype.slice,function(e){function i(){var t=r.concat(s.call(arguments));n.apply(this instanceof i?this:e,t)}var n=this,r=s.call(arguments,1);if("function"!=typeof n)throw new TypeError;return i.prototype=function t(e){if(e&&(t.prototype=e),!(this instanceof t))return new t}(n.prototype),i})),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.forEach||(Array.prototype.forEach=function(t){"use strict";if(null==this)throw new TypeError;var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var n=2<=arguments.length?arguments[1]:void 0,r=0;r<i;r++)r in e&&t.call(n,e[r],r,e)}),"function"!=typeof window.Uint32Array&&"object"!=typeof window.Uint32Array&&((t=function(t){var e=new Array;window[t]=function(t){if("number"==typeof t){Array.call(this,t),this.length=t;for(var e=0;e<this.length;e++)this[e]=0}else{Array.call(this,t.length),this.length=t.length;for(e=0;e<this.length;e++)this[e]=t[e]}},window[t].prototype=e,window[t].constructor=window[t]})("Uint32Array"),t("Int16Array")),window.console||(window.console={},window.console.log=window.console.assert=function(){},window.console.warn=window.console.assert=function(){}),/firefox/i.test(navigator.userAgent)&&(window.oldGetComputedStyle=window.getComputedStyle,window.getComputedStyle=function(t,e){e=window.oldGetComputedStyle(t,e);return null===e?{getPropertyValue:function(){}}:e}),U.Utils={reverseString:function(t){return t.split("").reverse().join("")},getProperty:function(t,e){for(var i=e.split("."),e=i.pop(),n=i.length,r=1,s=i[0];r<n&&(t=t[s]);)s=i[r],r++;return t?t[e]:null},setProperty:function(t,e,i){for(var n=e.split("."),e=n.pop(),r=n.length,s=1,o=n[0];s<r&&(t=t[o]);)o=n[s],s++;return t&&(t[e]=i),t},chanceRoll:function(t){return void 0===t&&(t=50),0<t&&100*Math.random()<=t},randomChoice:function(t,e){return Math.random()<.5?t:e},parseDimension:function(t,e){var i;return"string"==typeof t?"%"===t.substr(-1)?(i=parseInt(t,10)/100,0===e?window.innerWidth*i:window.innerHeight*i):parseInt(t,10):t},pad:function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=" "),void 0===n&&(n=3);var r;if(e+1>=(t=t.toString()).length)switch(n){case 1:t=new Array(e+1-t.length).join(i)+t;break;case 3:var s=Math.ceil((r=e-t.length)/2);t=new Array(1+(r-s)).join(i)+t+new Array(s+1).join(i);break;default:t+=new Array(e+1-t.length).join(i)}return t},isPlainObject:function(t){if("object"!=typeof t||t.nodeType||t===t.window)return!1;try{if(t.constructor&&!{}.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},extend:function(){var t,e,i,n,r,s=arguments[0]||{},o=1,a=arguments.length,l=!1;for("boolean"==typeof s&&(l=s,s=arguments[1]||{},o=2),a===o&&(s=this,--o);o<a;o++)if(null!=(t=arguments[o]))for(e in t)r=s[e],i=t[e],s!==i&&(l&&i&&(U.Utils.isPlainObject(i)||(n=Array.isArray(i)))?(r=n?(n=!1,r&&Array.isArray(r)?r:[]):r&&U.Utils.isPlainObject(r)?r:{},s[e]=U.Utils.extend(l,r,i)):void 0!==i&&(s[e]=i));return s},mixinPrototype:function(t,e,i){void 0===i&&(i=!1);for(var n=Object.keys(e),r=0;r<n.length;r++){var s=n[r],o=e[s];!i&&s in t||(!o||"function"!=typeof o.get&&"function"!=typeof o.set?t[s]=o:"function"==typeof o.clone?t[s]=o.clone():Object.defineProperty(t,s,o))}},mixin:function(t,e){if(!t||"object"!=typeof t)return e;for(var i in t){var n,r=t[i];r.childNodes||r.cloneNode||(n=typeof t[i],t[i]&&"object"==n?typeof e[i]==n?e[i]=U.Utils.mixin(t[i],e[i]):e[i]=U.Utils.mixin(t[i],new r.constructor):e[i]=t[i])}return e}},U.Circle=function(t,e,i){t=t||0,e=e||0,i=i||0,this.x=t,this.y=e,this._diameter=i,(this._radius=0)<i&&(this._radius=.5*i),this.type=U.CIRCLE},U.Circle.prototype={circumference:function(){return Math.PI*this._radius*2},random:function(t){void 0===t&&(t=new U.Point);var e=2*Math.PI*Math.random(),i=Math.random()+Math.random(),n=1<i?2-i:i,i=n*Math.cos(e),e=n*Math.sin(e);return t.x=this.x+i*this.radius,t.y=this.y+e*this.radius,t},getBounds:function(){return new U.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(t,e,i){return this.x=t,this.y=e,this._diameter=i,this._radius=.5*i,this},copyFrom:function(t){return this.setTo(t.x,t.y,t.diameter)},copyTo:function(t){return t.x=this.x,t.y=this.y,t.diameter=this._diameter,t},distance:function(t,e){t=U.Math.distance(this.x,this.y,t.x,t.y);return e?Math.round(t):t},clone:function(t){return null==t?t=new U.Circle(this.x,this.y,this.diameter):t.setTo(this.x,this.y,this.diameter),t},contains:function(t,e){return U.Circle.contains(this,t,e)},circumferencePoint:function(t,e,i){return U.Circle.circumferencePoint(this,t,e,i)},offset:function(t,e){return this.x+=t,this.y+=e,this},offsetPoint:function(t){return this.offset(t.x,t.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}},U.Circle.prototype.constructor=U.Circle,Object.defineProperty(U.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(t){0<t&&(this._diameter=t,this._radius=.5*t)}}),Object.defineProperty(U.Circle.prototype,"radius",{get:function(){return this._radius},set:function(t){0<t&&(this._radius=t,this._diameter=2*t)}}),Object.defineProperty(U.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(t){t>this.x?(this._radius=0,this._diameter=0):this.radius=this.x-t}}),Object.defineProperty(U.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(t){t<this.x?(this._radius=0,this._diameter=0):this.radius=t-this.x}}),Object.defineProperty(U.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(t){t>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-t}}),Object.defineProperty(U.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(t){t<this.y?(this._radius=0,this._diameter=0):this.radius=t-this.y}}),Object.defineProperty(U.Circle.prototype,"area",{get:function(){return 0<this._radius?Math.PI*this._radius*this._radius:0}}),Object.defineProperty(U.Circle.prototype,"empty",{get:function(){return 0===this._diameter},set:function(t){!0===t&&this.setTo(0,0,0)}}),U.Circle.contains=function(t,e,i){return 0<t.radius&&e>=t.left&&e<=t.right&&i>=t.top&&i<=t.bottom&&(t.x-e)*(t.x-e)+(t.y-i)*(t.y-i)<=t.radius*t.radius},U.Circle.equals=function(t,e){return t.x===e.x&&t.y===e.y&&t.diameter===e.diameter},U.Circle.intersects=function(t,e){return U.Math.distance(t.x,t.y,e.x,e.y)<=t.radius+e.radius},U.Circle.circumferencePoint=function(t,e,i,n){return void 0===i&&(i=!1),void 0===n&&(n=new U.Point),!0===i&&(e=U.Math.degToRad(e)),n.x=t.x+t.radius*Math.cos(e),n.y=t.y+t.radius*Math.sin(e),n},U.Circle.intersectsRectangle=function(t,e){var i=Math.abs(t.x-e.x-e.halfWidth);if(i>e.halfWidth+t.radius)return!1;var n=Math.abs(t.y-e.y-e.halfHeight);if(n>e.halfHeight+t.radius)return!1;if(i<=e.halfWidth||n<=e.halfHeight)return!0;i-=e.halfWidth,e=n-e.halfHeight;return i*i+e*e<=t.radius*t.radius},PIXI.Circle=U.Circle,U.Ellipse=function(t,e,i,n){t=t||0,e=e||0,i=i||0,n=n||0,this.x=t,this.y=e,this.width=i,this.height=n,this.type=U.ELLIPSE},U.Ellipse.prototype={setTo:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},getBounds:function(){return new U.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(t){return this.setTo(t.x,t.y,t.width,t.height)},copyTo:function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},clone:function(t){return null==t?t=new U.Ellipse(this.x,this.y,this.width,this.height):t.setTo(this.x,this.y,this.width,this.height),t},contains:function(t,e){return U.Ellipse.contains(this,t,e)},random:function(t){void 0===t&&(t=new U.Point);var e=Math.random()*Math.PI*2,i=Math.random();return t.x=Math.sqrt(i)*Math.cos(e),t.y=Math.sqrt(i)*Math.sin(e),t.x=this.x+t.x*this.width/2,t.y=this.y+t.y*this.height/2,t},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}},U.Ellipse.prototype.constructor=U.Ellipse,Object.defineProperty(U.Ellipse.prototype,"left",{get:function(){return this.x},set:function(t){this.x=t}}),Object.defineProperty(U.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(t){t<this.x?this.width=0:this.width=t-this.x}}),Object.defineProperty(U.Ellipse.prototype,"top",{get:function(){return this.y},set:function(t){this.y=t}}),Object.defineProperty(U.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){t<this.y?this.height=0:this.height=t-this.y}}),Object.defineProperty(U.Ellipse.prototype,"empty",{get:function(){return 0===this.width||0===this.height},set:function(t){!0===t&&this.setTo(0,0,0,0)}}),U.Ellipse.contains=function(t,e,i){if(t.width<=0||t.height<=0)return!1;e=(e-t.x)/t.width-.5,t=(i-t.y)/t.height-.5;return(e*=e)+(t*=t)<.25},PIXI.Ellipse=U.Ellipse,U.Line=function(t,e,i,n){t=t||0,e=e||0,i=i||0,n=n||0,this.start=new U.Point(t,e),this.end=new U.Point(i,n),this.type=U.LINE},U.Line.prototype={setTo:function(t,e,i,n){return this.start.setTo(t,e),this.end.setTo(i,n),this},fromSprite:function(t,e,i){return void 0===i&&(i=!1),i?this.setTo(t.center.x,t.center.y,e.center.x,e.center.y):this.setTo(t.x,t.y,e.x,e.y)},fromAngle:function(t,e,i,n){return this.start.setTo(t,e),this.end.setTo(t+Math.cos(i)*n,e+Math.sin(i)*n),this},rotate:function(t,e){var i=(this.start.x+this.end.x)/2,n=(this.start.y+this.end.y)/2;return this.start.rotate(i,n,t,e),this.end.rotate(i,n,t,e),this},rotateAround:function(t,e,i,n){return this.start.rotate(t,e,i,n),this.end.rotate(t,e,i,n),this},intersects:function(t,e,i){return U.Line.intersectsPoints(this.start,this.end,t.start,t.end,e,i)},reflect:function(t){return U.Line.reflect(this,t)},midPoint:function(t){return void 0===t&&(t=new U.Point),t.x=(this.start.x+this.end.x)/2,t.y=(this.start.y+this.end.y)/2,t},centerOn:function(t,e){t-=(this.start.x+this.end.x)/2,e-=(this.start.y+this.end.y)/2;this.start.add(t,e),this.end.add(t,e)},pointOnLine:function(t,e){return(t-this.start.x)*(this.end.y-this.start.y)==(this.end.x-this.start.x)*(e-this.start.y)},pointOnSegment:function(t,e){var i=Math.min(this.start.x,this.end.x),n=Math.max(this.start.x,this.end.x),r=Math.min(this.start.y,this.end.y),s=Math.max(this.start.y,this.end.y);return this.pointOnLine(t,e)&&i<=t&&t<=n&&r<=e&&e<=s},random:function(t){void 0===t&&(t=new U.Point);var e=Math.random();return t.x=this.start.x+e*(this.end.x-this.start.x),t.y=this.start.y+e*(this.end.y-this.start.y),t},coordinatesOnLine:function(t,e){void 0===t&&(t=1),void 0===e&&(e=[]);var i=Math.round(this.start.x),n=Math.round(this.start.y),r=Math.round(this.end.x),s=Math.round(this.end.y),o=Math.abs(r-i),a=Math.abs(s-n),l=i<r?1:-1,p=n<s?1:-1,h=o-a;e.push([i,n]);for(var u=1;i!==r||n!==s;){var c=h<<1;-a<c&&(h-=a,i+=l),c<o&&(h+=o,n+=p),u%t==0&&e.push([i,n]),u++}return e},clone:function(t){return null==t?t=new U.Line(this.start.x,this.start.y,this.end.x,this.end.y):t.setTo(this.start.x,this.start.y,this.end.x,this.end.y),t}},Object.defineProperty(U.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}}),Object.defineProperty(U.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}}),Object.defineProperty(U.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}}),Object.defineProperty(U.Line.prototype,"perpSlope",{get:function(){return-(this.end.x-this.start.x)/(this.end.y-this.start.y)}}),Object.defineProperty(U.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(U.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(U.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(U.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}}),Object.defineProperty(U.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(U.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}}),Object.defineProperty(U.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}}),Object.defineProperty(U.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}}),Object.defineProperty(U.Line.prototype,"normalX",{get:function(){return Math.cos(this.angle-1.5707963267948966)}}),Object.defineProperty(U.Line.prototype,"normalY",{get:function(){return Math.sin(this.angle-1.5707963267948966)}}),Object.defineProperty(U.Line.prototype,"normalAngle",{get:function(){return U.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}}),U.Line.intersectsPoints=function(t,e,i,n,r,s){void 0===r&&(r=!0),void 0===s&&(s=new U.Point);var o=e.y-t.y,a=n.y-i.y,l=t.x-e.x,p=i.x-n.x,h=e.x*t.y-t.x*e.y,u=n.x*i.y-i.x*n.y,c=o*p-a*l;if(0==c)return null;if(s.x=(l*u-p*h)/c,s.y=(a*h-o*u)/c,r){r=(n.y-i.y)*(e.x-t.x)-(n.x-i.x)*(e.y-t.y),n=((n.x-i.x)*(t.y-i.y)-(n.y-i.y)*(t.x-i.x))/r,r=((e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x))/r;return 0<=n&&n<=1&&0<=r&&r<=1?s:null}return s},U.Line.intersects=function(t,e,i,n){return U.Line.intersectsPoints(t.start,t.end,e.start,e.end,i,n)},U.Line.intersectsRectangle=function(t,e){if(!U.Rectangle.intersects(t,e))return!1;var i=t.start.x,n=t.start.y,r=t.end.x,s=t.end.y,o=e.x,a=e.y,l=e.right,t=e.bottom,e=0;if(o<=i&&i<=l&&a<=n&&n<=t||o<=r&&r<=l&&a<=s&&s<=t)return!0;if(i<o&&o<=r){if((e=n+(s-n)*(o-i)/(r-i))>a&&e<=t)return!0}else if(l<i&&r<=l&&(e=n+(s-n)*(l-i)/(r-i))>=a&&e<=t)return!0;if(n<a&&a<=s){if((e=i+(r-i)*(a-n)/(s-n))>=o&&e<=l)return!0}else if(t<n&&s<=t&&(e=i+(r-i)*(t-n)/(s-n))>=o&&e<=l)return!0;return!1},U.Line.reflect=function(t,e){return 2*e.normalAngle-3.141592653589793-t.angle},U.Matrix=function(t,e,i,n,r,s){null!=t||(t=1),null!=e||(e=0),null!=i||(i=0),null!=n||(n=1),null!=r||(r=0),null!=s||(s=0),this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s,this.type=U.MATRIX},U.Matrix.prototype={fromArray:function(t){return this.setTo(t[0],t[1],t[3],t[4],t[2],t[5])},setTo:function(t,e,i,n,r,s){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s,this},clone:function(t){return null==t?t=new U.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty):(t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty),t},copyTo:function(t){return t.copyFrom(this),t},copyFrom:function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},toArray:function(t,e){return void 0===e&&(e=new PIXI.Float32Array(9)),t?(e[0]=this.a,e[1]=this.b,e[2]=0,e[3]=this.c,e[4]=this.d,e[5]=0,e[6]=this.tx,e[7]=this.ty):(e[0]=this.a,e[1]=this.c,e[2]=this.tx,e[3]=this.b,e[4]=this.d,e[5]=this.ty,e[6]=0,e[7]=0),e[8]=1,e},apply:function(t,e){return void 0===e&&(e=new U.Point),e.x=this.a*t.x+this.c*t.y+this.tx,e.y=this.b*t.x+this.d*t.y+this.ty,e},applyInverse:function(t,e){void 0===e&&(e=new U.Point);var i=1/(this.a*this.d+this.c*-this.b),n=t.x,t=t.y;return e.x=this.d*i*n+-this.c*i*t+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*t+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,e},translate:function(t,e){return this.tx+=t,this.ty+=e,this},scale:function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,t=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=t*e-this.ty*i,this.ty=t*i+this.ty*e,this},append:function(t){var e=this.a,i=this.b,n=this.c,r=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*r,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*r,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*r+this.ty,this},identity:function(){return this.setTo(1,0,0,1,0,0)}},U.identityMatrix=new U.Matrix,PIXI.Matrix=U.Matrix,PIXI.identityMatrix=U.identityMatrix,U.Point=function(t,e){t=t||0,e=e||0,this.x=t,this.y=e,this.type=U.POINT},U.Point.prototype={copyFrom:function(t){return this.setTo(t.x,t.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(t,e){return this.x=t||0,this.y=e||(0!==e?this.x:0),this},set:function(t,e){return this.x=t||0,this.y=e||(0!==e?this.x:0),this},add:function(t,e){return this.x+=t,this.y+=e,this},subtract:function(t,e){return this.x-=t,this.y-=e,this},multiply:function(t,e){return this.x*=t,this.y*=e,this},divide:function(t,e){return this.x/=t,this.y/=e,this},clampX:function(t,e){return this.x=U.Math.clamp(this.x,t,e),this},clampY:function(t,e){return this.y=U.Math.clamp(this.y,t,e),this},clamp:function(t,e){return this.x=U.Math.clamp(this.x,t,e),this.y=U.Math.clamp(this.y,t,e),this},clone:function(t){return null==t?t=new U.Point(this.x,this.y):t.setTo(this.x,this.y),t},copyTo:function(t){return t.x=this.x,t.y=this.y,t},distance:function(t,e){return U.Point.distance(this,t,e)},equals:function(t){return t.x===this.x&&t.y===this.y},angle:function(t,e){return void 0===e&&(e=!1),e?U.Math.radToDeg(Math.atan2(t.y-this.y,t.x-this.x)):Math.atan2(t.y-this.y,t.x-this.x)},rotate:function(t,e,i,n,r){return U.Point.rotate(this,t,e,i,n,r)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(t){return this.normalize().multiply(t,t)},normalize:function(){var t;return this.isZero()||(t=this.getMagnitude(),this.x/=t,this.y/=t),this},isZero:function(){return 0===this.x&&0===this.y},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(-1*this.y,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}},U.Point.prototype.constructor=U.Point,U.Point.add=function(t,e,i){return void 0===i&&(i=new U.Point),i.x=t.x+e.x,i.y=t.y+e.y,i},U.Point.subtract=function(t,e,i){return void 0===i&&(i=new U.Point),i.x=t.x-e.x,i.y=t.y-e.y,i},U.Point.multiply=function(t,e,i){return void 0===i&&(i=new U.Point),i.x=t.x*e.x,i.y=t.y*e.y,i},U.Point.divide=function(t,e,i){return void 0===i&&(i=new U.Point),i.x=t.x/e.x,i.y=t.y/e.y,i},U.Point.equals=function(t,e){return t.x===e.x&&t.y===e.y},U.Point.angle=function(t,e){return Math.atan2(t.y-e.y,t.x-e.x)},U.Point.negative=function(t,e){return void 0===e&&(e=new U.Point),e.setTo(-t.x,-t.y)},U.Point.multiplyAdd=function(t,e,i,n){return void 0===n&&(n=new U.Point),n.setTo(t.x+e.x*i,t.y+e.y*i)},U.Point.interpolate=function(t,e,i,n){return void 0===n&&(n=new U.Point),n.setTo(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i)},U.Point.perp=function(t,e){return void 0===e&&(e=new U.Point),e.setTo(-t.y,t.x)},U.Point.rperp=function(t,e){return void 0===e&&(e=new U.Point),e.setTo(t.y,-t.x)},U.Point.distance=function(t,e,i){e=U.Math.distance(t.x,t.y,e.x,e.y);return i?Math.round(e):e},U.Point.project=function(t,e,i){void 0===i&&(i=new U.Point);t=t.dot(e)/e.getMagnitudeSq();return 0!=t&&i.setTo(t*e.x,t*e.y),i},U.Point.projectUnit=function(t,e,i){void 0===i&&(i=new U.Point);t=t.dot(e);return 0!==t&&i.setTo(t*e.x,t*e.y),i},U.Point.normalRightHand=function(t,e){return void 0===e&&(e=new U.Point),e.setTo(-1*t.y,t.x)},U.Point.normalize=function(t,e){void 0===e&&(e=new U.Point);var i=t.getMagnitude();return 0!==i&&e.setTo(t.x/i,t.y/i),e},U.Point.rotate=function(t,e,i,n,r,s){var o,a;return r&&(n=U.Math.degToRad(n)),void 0===s?(t.subtract(e,i),o=Math.sin(n),r=(a=Math.cos(n))*t.x-o*t.y,a=o*t.x+a*t.y,t.x=r+e,t.y=a+i):(n=n+Math.atan2(t.y-i,t.x-e),t.x=e+s*Math.cos(n),t.y=i+s*Math.sin(n)),t},U.Point.centroid=function(t,e){if(void 0===e&&(e=new U.Point),"[object Array]"!==Object.prototype.toString.call(t))throw new Error("Phaser.Point. Parameter 'points' must be an array");var i=t.length;if(i<1)throw new Error("Phaser.Point. Parameter 'points' array must not be empty");if(1===i)return e.copyFrom(t[0]),e;for(var n=0;n<i;n++)U.Point.add(e,t[n],e);return e.divide(i,i),e},U.Point.parse=function(t,e,i){e=e||"x",i=i||"y";var n=new U.Point;return t[e]&&(n.x=parseInt(t[e],10)),t[i]&&(n.y=parseInt(t[i],10)),n},PIXI.Point=U.Point,U.Polygon=function(){this.area=0,this._points=[],0<arguments.length&&this.setTo.apply(this,arguments),this.closed=!0,this.flattened=!1,this.type=U.POLYGON},U.Polygon.prototype={toNumberArray:function(t){void 0===t&&(t=[]);for(var e=0;e<this._points.length;e++)"number"==typeof this._points[e]?(t.push(this._points[e]),t.push(this._points[e+1]),e++):(t.push(this._points[e].x),t.push(this._points[e].y));return t},flatten:function(){return this._points=this.toNumberArray(),this.flattened=!0,this},clone:function(t){var e=this._points.slice();return null==t?t=new U.Polygon(e):t.setTo(e),t},contains:function(t,e){var i=!1;if(this.flattened)for(var n=-2,r=this._points.length-2;(n+=2)<this._points.length;r=n){var s=this._points[n],o=this._points[n+1],a=this._points[r],l=this._points[r+1];(o<=e&&e<l||l<=e&&e<o)&&t<(a-s)*(e-o)/(l-o)+s&&(i=!i)}else for(n=-1,r=this._points.length-1;++n<this._points.length;r=n){s=this._points[n].x,o=this._points[n].y,a=this._points[r].x,l=this._points[r].y;(o<=e&&e<l||l<=e&&e<o)&&t<(a-s)*(e-o)/(l-o)+s&&(i=!i)}return i},setTo:function(t){if(this.area=0,this._points=[],0<arguments.length){Array.isArray(t)||(t=Array.prototype.slice.call(arguments));for(var e,i=Number.MAX_VALUE,n=0,r=t.length;n<r;n++)"number"==typeof t[n]?(e=new PIXI.Point(t[n],t[n+1]),n++):e=Array.isArray(t[n])?new PIXI.Point(t[n][0],t[n][1]):new PIXI.Point(t[n].x,t[n].y),this._points.push(e),e.y<i&&(i=e.y);this.calculateArea(i)}return this},calculateArea:function(t){for(var e,i,n,r=0,s=this._points.length;r<s;r++)e=this._points[r],n=r===s-1?this._points[0]:this._points[r+1],i=(e.y-t+(n.y-t))/2,n=e.x-n.x,this.area+=i*n;return this.area}},U.Polygon.prototype.constructor=U.Polygon,Object.defineProperty(U.Polygon.prototype,"points",{get:function(){return this._points},set:function(t){null!=t?this.setTo(t):this.setTo()}}),PIXI.Polygon=U.Polygon,U.Rectangle=function(t,e,i,n){t=t||0,e=e||0,i=i||0,n=n||0,this.x=t,this.y=e,this.width=i,this.height=n,this.type=U.RECTANGLE},U.Rectangle.prototype={offset:function(t,e){return this.x+=t,this.y+=e,this},offsetPoint:function(t){return this.offset(t.x,t.y)},setTo:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},scale:function(t,e){return void 0===e&&(e=t),this.width*=t,this.height*=e,this},centerOn:function(t,e){return this.centerX=t,this.centerY=e,this},floor:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.width=Math.floor(this.width),this.height=Math.floor(this.height)},ceil:function(){this.x=Math.ceil(this.x),this.y=Math.ceil(this.y)},ceilAll:function(){this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.width=Math.ceil(this.width),this.height=Math.ceil(this.height)},copyFrom:function(t){return this.setTo(t.x,t.y,t.width,t.height)},copyTo:function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},inflate:function(t,e){return U.Rectangle.inflate(this,t,e)},size:function(t){return U.Rectangle.size(this,t)},resize:function(t,e){return this.width=t,this.height=e,this},clone:function(t){return U.Rectangle.clone(this,t)},contains:function(t,e){return U.Rectangle.contains(this,t,e)},containsRect:function(t){return U.Rectangle.containsRect(t,this)},equals:function(t){return U.Rectangle.equals(this,t)},intersection:function(t,e){return U.Rectangle.intersection(this,t,e)},intersects:function(t){return U.Rectangle.intersects(this,t)},intersectsRaw:function(t,e,i,n,r){return U.Rectangle.intersectsRaw(this,t,e,i,n,r)},union:function(t,e){return U.Rectangle.union(this,t,e)},random:function(t){return void 0===t&&(t=new U.Point),t.x=this.randomX,t.y=this.randomY,t},getPoint:function(t,e){switch(void 0===e&&(e=new U.Point),t){default:case U.TOP_LEFT:return e.set(this.x,this.y);case U.TOP_CENTER:return e.set(this.centerX,this.y);case U.TOP_RIGHT:return e.set(this.right,this.y);case U.LEFT_CENTER:return e.set(this.x,this.centerY);case U.CENTER:return e.set(this.centerX,this.centerY);case U.RIGHT_CENTER:return e.set(this.right,this.centerY);case U.BOTTOM_LEFT:return e.set(this.x,this.bottom);case U.BOTTOM_CENTER:return e.set(this.centerX,this.bottom);case U.BOTTOM_RIGHT:return e.set(this.right,this.bottom)}},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}},Object.defineProperty(U.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}}),Object.defineProperty(U.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}}),Object.defineProperty(U.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){t<=this.y?this.height=0:this.height=t-this.y}}),Object.defineProperty(U.Rectangle.prototype,"bottomLeft",{get:function(){return new U.Point(this.x,this.bottom)},set:function(t){this.x=t.x,this.bottom=t.y}}),Object.defineProperty(U.Rectangle.prototype,"bottomRight",{get:function(){return new U.Point(this.right,this.bottom)},set:function(t){this.right=t.x,this.bottom=t.y}}),Object.defineProperty(U.Rectangle.prototype,"left",{get:function(){return this.x},set:function(t){t>=this.right?this.width=0:this.width=this.right-t,this.x=t}}),Object.defineProperty(U.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(t){t<=this.x?this.width=0:this.width=t-this.x}}),Object.defineProperty(U.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}}),Object.defineProperty(U.Rectangle.prototype,"perimeter",{get:function(){return 2*this.width+2*this.height}}),Object.defineProperty(U.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(t){this.x=t-this.halfWidth}}),Object.defineProperty(U.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(t){this.y=t-this.halfHeight}}),Object.defineProperty(U.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*this.width}}),Object.defineProperty(U.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}}),Object.defineProperty(U.Rectangle.prototype,"top",{get:function(){return this.y},set:function(t){t>=this.bottom?(this.height=0,this.y=t):this.height=this.bottom-t}}),Object.defineProperty(U.Rectangle.prototype,"topLeft",{get:function(){return new U.Point(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y}}),Object.defineProperty(U.Rectangle.prototype,"topRight",{get:function(){return new U.Point(this.x+this.width,this.y)},set:function(t){this.right=t.x,this.y=t.y}}),Object.defineProperty(U.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(t){!0===t&&this.setTo(0,0,0,0)}}),U.Rectangle.prototype.constructor=U.Rectangle,U.Rectangle.inflate=function(t,e,i){return t.x-=e,t.width+=2*e,t.y-=i,t.height+=2*i,t},U.Rectangle.inflatePoint=function(t,e){return U.Rectangle.inflate(t,e.x,e.y)},U.Rectangle.size=function(t,e){return null==e?e=new U.Point(t.width,t.height):e.setTo(t.width,t.height),e},U.Rectangle.clone=function(t,e){return null==e?e=new U.Rectangle(t.x,t.y,t.width,t.height):e.setTo(t.x,t.y,t.width,t.height),e},U.Rectangle.contains=function(t,e,i){return!(t.width<=0||t.height<=0)&&e>=t.x&&e<t.right&&i>=t.y&&i<t.bottom},U.Rectangle.containsRaw=function(t,e,i,n,r,s){return t<=r&&r<t+i&&e<=s&&s<e+n},U.Rectangle.containsPoint=function(t,e){return U.Rectangle.contains(t,e.x,e.y)},U.Rectangle.containsRect=function(t,e){return!(t.volume>e.volume)&&t.x>=e.x&&t.y>=e.y&&t.right<e.right&&t.bottom<e.bottom},U.Rectangle.equals=function(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},U.Rectangle.sameDimensions=function(t,e){return t.width===e.width&&t.height===e.height},U.Rectangle.intersection=function(t,e,i){return void 0===i&&(i=new U.Rectangle),U.Rectangle.intersects(t,e)&&(i.x=Math.max(t.x,e.x),i.y=Math.max(t.y,e.y),i.width=Math.min(t.right,e.right)-i.x,i.height=Math.min(t.bottom,e.bottom)-i.y),i},U.Rectangle.intersects=function(t,e){return!(t.width<=0||t.height<=0||e.width<=0||e.height<=0||t.right<e.x||t.bottom<e.y||t.x>e.right||t.y>e.bottom)},U.Rectangle.intersectsRaw=function(t,e,i,n,r,s){return void 0===s&&(s=0),!(e>t.right+s||i<t.left-s||n>t.bottom+s||r<t.top-s)},U.Rectangle.union=function(t,e,i){return void 0===i&&(i=new U.Rectangle),i.setTo(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.max(t.right,e.right)-Math.min(t.left,e.left),Math.max(t.bottom,e.bottom)-Math.min(t.top,e.top))},U.Rectangle.aabb=function(t,e){void 0===e&&(e=new U.Rectangle);var i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;return t.forEach(function(t){t.x>i&&(i=t.x),t.x<n&&(n=t.x),t.y>r&&(r=t.y),t.y<s&&(s=t.y)}),e.setTo(n,s,i-n,r-s),e},PIXI.Rectangle=U.Rectangle,PIXI.EmptyRectangle=new U.Rectangle(0,0,0,0),U.RoundedRectangle=function(t,e,i,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=20),this.x=t,this.y=e,this.width=i,this.height=n,this.radius=r||20,this.type=U.ROUNDEDRECTANGLE},U.RoundedRectangle.prototype={clone:function(){return new U.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},contains:function(t,e){if(this.width<=0||this.height<=0)return!1;var i=this.x;if(i<=t&&t<=i+this.width){i=this.y;if(i<=e&&e<=i+this.height)return!0}return!1}},U.RoundedRectangle.prototype.constructor=U.RoundedRectangle,PIXI.RoundedRectangle=U.RoundedRectangle,U.Camera=function(t,e,i,n,r,s){this.game=t,this.world=t.world,this.id=0,this.view=new U.Rectangle(i,n,r,s),this.bounds=new U.Rectangle(i,n,r,s),this.deadzone=null,this.visible=!0,this.roundPx=!0,this.atLimit={x:!1,y:!1},this.target=null,this.displayObject=null,this.scale=null,this.totalInView=0,this.lerp=new U.Point(1,1),this.onShakeComplete=new U.Signal,this.onFlashComplete=new U.Signal,this.onFadeComplete=new U.Signal,this.fx=null,this._targetPosition=new U.Point,this._edge=0,this._position=new U.Point,this._shake={intensity:0,duration:0,horizontal:!1,vertical:!1,shakeBounds:!0,x:0,y:0},this._fxDuration=0,this._fxType=0},U.Camera.FOLLOW_LOCKON=0,U.Camera.FOLLOW_PLATFORMER=1,U.Camera.FOLLOW_TOPDOWN=2,U.Camera.FOLLOW_TOPDOWN_TIGHT=3,U.Camera.SHAKE_BOTH=4,U.Camera.SHAKE_HORIZONTAL=5,U.Camera.SHAKE_VERTICAL=6,U.Camera.ENABLE_FX=!0,U.Camera.prototype={boot:function(){this.displayObject=this.game.world,this.scale=this.game.world.scale,this.game.camera=this,U.Graphics&&U.Camera.ENABLE_FX&&(this.fx=new U.Graphics(this.game),this.game.stage.addChild(this.fx))},preUpdate:function(){this.totalInView=0},follow:function(t,e,i,n){var r;switch(void 0===e&&(e=U.Camera.FOLLOW_LOCKON),void 0===i&&(i=1),void 0===n&&(n=1),this.target=t,this.lerp.set(i,n),e){case U.Camera.FOLLOW_PLATFORMER:var s=this.width/8,o=this.height/3;this.deadzone=new U.Rectangle((this.width-s)/2,(this.height-o)/2-.25*o,s,o);break;case U.Camera.FOLLOW_TOPDOWN:r=Math.max(this.width,this.height)/4,this.deadzone=new U.Rectangle((this.width-r)/2,(this.height-r)/2,r,r);break;case U.Camera.FOLLOW_TOPDOWN_TIGHT:r=Math.max(this.width,this.height)/8,this.deadzone=new U.Rectangle((this.width-r)/2,(this.height-r)/2,r,r);break;case U.Camera.FOLLOW_LOCKON:default:this.deadzone=null}},unfollow:function(){this.target=null},focusOn:function(t){this.setPosition(Math.round(t.x-this.view.halfWidth),Math.round(t.y-this.view.halfHeight))},focusOnXY:function(t,e){this.setPosition(Math.round(t-this.view.halfWidth),Math.round(e-this.view.halfHeight))},shake:function(t,e,i,n,r){return void 0===t&&(t=.05),void 0===e&&(e=500),void 0===i&&(i=!0),void 0===n&&(n=U.Camera.SHAKE_BOTH),void 0===r&&(r=!0),!(!i&&0<this._shake.duration||(this._shake.intensity=t,this._shake.duration=e,this._shake.shakeBounds=r,this._shake.x=0,this._shake.y=0,this._shake.horizontal=n===U.Camera.SHAKE_BOTH||n===U.Camera.SHAKE_HORIZONTAL,this._shake.vertical=n===U.Camera.SHAKE_BOTH||n===U.Camera.SHAKE_VERTICAL,0))},flash:function(t,e,i){return void 0===t&&(t=16777215),void 0===e&&(e=500),void 0===i&&(i=!1),!(!this.fx||!i&&0<this._fxDuration||(this.fx.clear(),this.fx.beginFill(t),this.fx.drawRect(0,0,this.width,this.height),this.fx.endFill(),this.fx.alpha=1,this._fxDuration=e,this._fxType=0))},fade:function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=500),void 0===i&&(i=!1),!(!this.fx||!i&&0<this._fxDuration||(this.fx.clear(),this.fx.beginFill(t),this.fx.drawRect(0,0,this.width,this.height),this.fx.endFill(),this.fx.alpha=0,this._fxDuration=e,this._fxType=1,0))},update:function(){0<this._fxDuration&&this.updateFX(),0<this._shake.duration&&this.updateShake(),this.bounds&&this.checkBounds(),this.roundPx&&(this.view.floor(),this._shake.x=Math.floor(this._shake.x),this._shake.y=Math.floor(this._shake.y)),this.displayObject.position.x=-this.view.x,this.displayObject.position.y=-this.view.y},updateFX:function(){0===this._fxType?(this.fx.alpha-=this.game.time.elapsedMS/this._fxDuration,this.fx.alpha<=0&&(this._fxDuration=0,this.fx.alpha=0,this.onFlashComplete.dispatch())):(this.fx.alpha+=this.game.time.elapsedMS/this._fxDuration,1<=this.fx.alpha&&(this._fxDuration=0,this.fx.alpha=1,this.onFadeComplete.dispatch()))},updateShake:function(){this._shake.duration-=this.game.time.elapsedMS,this._shake.duration<=0?(this.onShakeComplete.dispatch(),this._shake.x=0,this._shake.y=0):(this._shake.horizontal&&(this._shake.x=this.game.rnd.frac()*this._shake.intensity*this.view.width*2-this._shake.intensity*this.view.width),this._shake.vertical&&(this._shake.y=this.game.rnd.frac()*this._shake.intensity*this.view.height*2-this._shake.intensity*this.view.height))},updateTarget:function(){this._targetPosition.x=this.view.x+this.target.worldPosition.x,this._targetPosition.y=this.view.y+this.target.worldPosition.y,this.deadzone?(this._edge=this._targetPosition.x-this.view.x,this._edge<this.deadzone.left?this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.left,this.lerp.x):this._edge>this.deadzone.right&&(this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.right,this.lerp.x)),this._edge=this._targetPosition.y-this.view.y,this._edge<this.deadzone.top?this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.top,this.lerp.y):this._edge>this.deadzone.bottom&&(this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.bottom,this.lerp.y))):(this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.view.halfWidth,this.lerp.x),this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.view.halfHeight,this.lerp.y)),this.bounds&&this.checkBounds(),this.roundPx&&this.view.floor(),this.displayObject.position.x=-this.view.x,this.displayObject.position.y=-this.view.y},setBoundsToWorld:function(){this.bounds&&this.bounds.copyFrom(this.game.world.bounds)},checkBounds:function(){this.atLimit.x=!1,this.atLimit.y=!1;var t=this.view.x+this._shake.x,e=this.view.right+this._shake.x,i=this.view.y+this._shake.y,n=this.view.bottom+this._shake.y;t<=this.bounds.x*this.scale.x&&(this.atLimit.x=!0,this.view.x=this.bounds.x*this.scale.x,this._shake.shakeBounds||(this._shake.x=0)),e>=this.bounds.right*this.scale.x&&(this.atLimit.x=!0,this.view.x=this.bounds.right*this.scale.x-this.width,this._shake.shakeBounds||(this._shake.x=0)),i<=this.bounds.top*this.scale.y&&(this.atLimit.y=!0,this.view.y=this.bounds.top*this.scale.y,this._shake.shakeBounds||(this._shake.y=0)),n>=this.bounds.bottom*this.scale.y&&(this.atLimit.y=!0,this.view.y=this.bounds.bottom*this.scale.y-this.height,this._shake.shakeBounds||(this._shake.y=0))},setPosition:function(t,e){this.view.x=t,this.view.y=e,this.bounds&&this.checkBounds()},setSize:function(t,e){this.view.width=t,this.view.height=e},reset:function(){this.target=null,this.view.x=0,this.view.y=0,this._shake.duration=0,this.resetFX()},resetFX:function(){this.fx.clear(),this.fx.alpha=0,this._fxDuration=0}},U.Camera.prototype.constructor=U.Camera,Object.defineProperty(U.Camera.prototype,"x",{get:function(){return this.view.x},set:function(t){this.view.x=t,this.bounds&&this.checkBounds()}}),Object.defineProperty(U.Camera.prototype,"y",{get:function(){return this.view.y},set:function(t){this.view.y=t,this.bounds&&this.checkBounds()}}),Object.defineProperty(U.Camera.prototype,"position",{get:function(){return this._position.set(this.view.x,this.view.y),this._position},set:function(t){void 0!==t.x&&(this.view.x=t.x),void 0!==t.y&&(this.view.y=t.y),this.bounds&&this.checkBounds()}}),Object.defineProperty(U.Camera.prototype,"width",{get:function(){return this.view.width},set:function(t){this.view.width=t}}),Object.defineProperty(U.Camera.prototype,"height",{get:function(){return this.view.height},set:function(t){this.view.height=t}}),Object.defineProperty(U.Camera.prototype,"shakeIntensity",{get:function(){return this._shake.intensity},set:function(t){this._shake.intensity=t}}),U.State=function(){this.game=null,this.key="",this.add=null,this.make=null,this.camera=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.sound=null,this.scale=null,this.stage=null,this.state=null,this.time=null,this.tweens=null,this.world=null,this.particles=null,this.physics=null,this.rnd=null},U.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},preRender:function(){},render:function(){},resize:function(){},paused:function(){},resumed:function(){},pauseUpdate:function(){},shutdown:function(){}},U.State.prototype.constructor=U.State,U.StateManager=function(t,e){this.game=t,this.states={},(this._pendingState=null)!=e&&(this._pendingState=e),this._clearWorld=!1,this._clearCache=!1,this._created=!1,this._args=[],this.current="",this.onStateChange=new U.Signal,this.onInitCallback=null,this.onPreloadCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPreRenderCallback=null,this.onLoadUpdateCallback=null,this.onLoadRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.onShutDownCallback=null},U.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this),this.game.onResume.add(this.resume,this),null!==this._pendingState&&"string"!=typeof this._pendingState&&this.add("default",this._pendingState,!0)},add:function(t,e,i){var n;return void 0===i&&(i=!1),e instanceof U.State?n=e:"object"==typeof e?(n=e).game=this.game:"function"==typeof e&&(n=new e(this.game)),this.states[t]=n,i&&(this.game.isBooted?this.start(t):this._pendingState=t),n},remove:function(t){this.current===t&&(this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onPreRenderCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null),delete this.states[t]},start:function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),this.checkState(t)&&(this._pendingState=t,this._clearWorld=e,this._clearCache=i,3<arguments.length&&(this._args=Array.prototype.splice.call(arguments,3)))},restart:function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),this._pendingState=this.current,this._clearWorld=t,this._clearCache=e,2<arguments.length&&(this._args=Array.prototype.slice.call(arguments,2))},dummy:function(){},preUpdate:function(){var t;this._pendingState&&this.game.isBooted&&(t=this.current,this.clearCurrentState(),this.setCurrentState(this._pendingState),this.onStateChange.dispatch(this.current,t),this.current===this._pendingState&&(this._pendingState=null,this.onPreloadCallback?(this.game.load.reset(!0),this.onPreloadCallback.call(this.callbackContext,this.game),0===this.game.load.totalQueuedFiles()&&0===this.game.load.totalQueuedPacks()?this.loadComplete():this.game.load.start()):this.loadComplete()))},clearCurrentState:function(){this.current&&(this.onShutDownCallback&&this.onShutDownCallback.call(this.callbackContext,this.game),this.game.tweens.removeAll(),this.game.camera.reset(),this.game.input.reset(!0),this.game.physics.clear(),this.game.time.removeAll(),this.game.scale.reset(this._clearWorld),this.game.debug&&this.game.debug.reset(),this._clearWorld&&(this.game.world.shutdown(),this._clearCache&&this.game.cache.destroy()))},checkState:function(t){return!!this.states[t]&&!!(this.states[t].preload||this.states[t].create||this.states[t].update||this.states[t].render)},link:function(t){this.states[t].game=this.game,this.states[t].add=this.game.add,this.states[t].make=this.game.make,this.states[t].camera=this.game.camera,this.states[t].cache=this.game.cache,this.states[t].input=this.game.input,this.states[t].load=this.game.load,this.states[t].math=this.game.math,this.states[t].sound=this.game.sound,this.states[t].scale=this.game.scale,(this.states[t].state=this).states[t].stage=this.game.stage,this.states[t].time=this.game.time,this.states[t].tweens=this.game.tweens,this.states[t].world=this.game.world,this.states[t].particles=this.game.particles,this.states[t].rnd=this.game.rnd,this.states[t].physics=this.game.physics,this.states[t].key=t},unlink:function(t){this.states[t]&&(this.states[t].game=null,this.states[t].add=null,this.states[t].make=null,this.states[t].camera=null,this.states[t].cache=null,this.states[t].input=null,this.states[t].load=null,this.states[t].math=null,this.states[t].sound=null,this.states[t].scale=null,this.states[t].state=null,this.states[t].stage=null,this.states[t].time=null,this.states[t].tweens=null,this.states[t].world=null,this.states[t].particles=null,this.states[t].rnd=null,this.states[t].physics=null)},setCurrentState:function(t){this.callbackContext=this.states[t],this.link(t),this.onInitCallback=this.states[t].init||this.dummy,this.onPreloadCallback=this.states[t].preload||null,this.onLoadRenderCallback=this.states[t].loadRender||null,this.onLoadUpdateCallback=this.states[t].loadUpdate||null,this.onCreateCallback=this.states[t].create||null,this.onUpdateCallback=this.states[t].update||null,this.onPreRenderCallback=this.states[t].preRender||null,this.onRenderCallback=this.states[t].render||null,this.onResizeCallback=this.states[t].resize||null,this.onPausedCallback=this.states[t].paused||null,this.onResumedCallback=this.states[t].resumed||null,this.onPauseUpdateCallback=this.states[t].pauseUpdate||null,this.onShutDownCallback=this.states[t].shutdown||this.dummy,""!==this.current&&this.game.physics.reset(),this.current=t,this._created=!1,this.onInitCallback.apply(this.callbackContext,this._args),t===this._pendingState&&(this._args=[]),this.game._kickstart=!0},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){!1===this._created&&this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game),!1===this._created&&this.onCreateCallback?(this._created=!0,this.onCreateCallback.call(this.callbackContext,this.game)):this._created=!0},pause:function(){this._created&&this.onPausedCallback&&this.onPausedCallback.call(this.callbackContext,this.game)},resume:function(){this._created&&this.onResumedCallback&&this.onResumedCallback.call(this.callbackContext,this.game)},update:function(){this._created?this.onUpdateCallback&&this.onUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},pauseUpdate:function(){this._created?this.onPauseUpdateCallback&&this.onPauseUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},preRender:function(t){this._created&&this.onPreRenderCallback&&this.onPreRenderCallback.call(this.callbackContext,this.game,t)},resize:function(t,e){this.onResizeCallback&&this.onResizeCallback.call(this.callbackContext,t,e)},render:function(){this._created?this.onRenderCallback&&(this.game.renderType===U.CANVAS?(this.game.context.save(),this.game.context.setTransform(1,0,0,1,0,0),this.onRenderCallback.call(this.callbackContext,this.game),this.game.context.restore()):this.onRenderCallback.call(this.callbackContext,this.game)):this.onLoadRenderCallback&&this.onLoadRenderCallback.call(this.callbackContext,this.game)},destroy:function(){this._clearWorld=!0,this._clearCache=!0,this.clearCurrentState(),this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.game=null,this.states={},this._pendingState=null,this.current=""}},U.StateManager.prototype.constructor=U.StateManager,Object.defineProperty(U.StateManager.prototype,"created",{get:function(){return this._created}}),U.Signal=function(){},U.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!1,validateListener:function(t,e){if("function"!=typeof t)throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))},_registerListener:function(t,e,i,n,r){var s,o=this._indexOfListener(t,i);if(-1!==o){if((s=this._bindings[o]).isOnce()!==e)throw new Error("You cannot add"+(e?"":"Once")+"() then add"+(e?"Once":"")+"() the same listener without removing the relationship first.")}else s=new U.SignalBinding(this,t,e,i,n,r),this._addBinding(s);return this.memorize&&this._prevParams&&s.execute(this._prevParams),s},_addBinding:function(t){this._bindings||(this._bindings=[]);for(var e=this._bindings.length;e--,this._bindings[e]&&t._priority<=this._bindings[e]._priority;);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){if(!this._bindings)return-1;void 0===e&&(e=null);for(var i,n=this._bindings.length;n--;)if((i=this._bindings[n])._listener===t&&i.context===e)return n;return-1},has:function(t,e){return-1!==this._indexOfListener(t,e)},add:function(t,e,i){this.validateListener(t,"add");var n=[];if(3<arguments.length)for(var r=3;r<arguments.length;r++)n.push(arguments[r]);return this._registerListener(t,!1,e,i,n)},addOnce:function(t,e,i){this.validateListener(t,"addOnce");var n=[];if(3<arguments.length)for(var r=3;r<arguments.length;r++)n.push(arguments[r]);return this._registerListener(t,!0,e,i,n)},remove:function(t,e){this.validateListener(t,"remove");e=this._indexOfListener(t,e);return-1!==e&&(this._bindings[e]._destroy(),this._bindings.splice(e,1)),t},removeAll:function(t){if(void 0===t&&(t=null),this._bindings){for(var e=this._bindings.length;e--;)t?this._bindings[e].context===t&&(this._bindings[e]._destroy(),this._bindings.splice(e,1)):this._bindings[e]._destroy();t||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var t,e=Array.prototype.slice.call(arguments),i=this._bindings.length;if(this.memorize&&(this._prevParams=e),i)for(t=this._bindings.slice(),this._shouldPropagate=!0;i--,t[i]&&this._shouldPropagate&&!1!==t[i].execute(e););}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(U.Signal.prototype,"boundDispatch",{get:function(){var t=this;return this._boundDispatch||(this._boundDispatch=function(){return t.dispatch.apply(t,arguments)})}}),U.Signal.prototype.constructor=U.Signal,U.SignalBinding=function(t,e,i,n,r,s){this._listener=e,i&&(this._isOnce=!0),null!=n&&(this.context=n),this._signal=t,r&&(this._priority=r),s&&s.length&&(this._args=s)},U.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(t){var e;return this.active&&this._listener&&(e=this.params?this.params.concat(t):t,this._args&&(e=e.concat(this._args)),e=this._listener.apply(this.context,e),this.callCount++,this._isOnce&&this.detach()),e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},U.SignalBinding.prototype.constructor=U.SignalBinding,U.Filter=function(t,e,i){this.game=t,this.type=U.WEBGL_FILTER,this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.prevPoint=new U.Point;t=new Date;if(this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,y:0}},date:{type:"4fv",value:[t.getFullYear(),t.getMonth(),t.getDate(),60*t.getHours()*60+60*t.getMinutes()+t.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:!0}}},e)for(var n in e)this.uniforms[n]=e[n];this.fragmentSrc=i||""},U.Filter.prototype={init:function(){},setResolution:function(t,e){this.uniforms.resolution.value.x=t,this.uniforms.resolution.value.y=e},update:function(t){var e;void 0!==t&&(e=t.x/this.game.width,t=1-t.y/this.game.height,e===this.prevPoint.x&&t===this.prevPoint.y||(this.uniforms.mouse.value.x=e.toFixed(2),this.uniforms.mouse.value.y=t.toFixed(2),this.prevPoint.set(e,t))),this.uniforms.time.value=this.game.time.totalElapsedSeconds()},addToWorld:function(t,e,i,n,r,s){void 0===r&&(r=0),void 0===s&&(s=0),null!=i?this.width=i:i=this.width,null!=n?this.height=n:n=this.height;e=this.game.add.image(t,e,"__default");return e.width=i,e.height=n,e.anchor.set(r,s),e.filters=[this],e},destroy:function(){this.game=null}},U.Filter.prototype.constructor=U.Filter,Object.defineProperty(U.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(t){this.uniforms.resolution.value.x=t}}),Object.defineProperty(U.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(t){this.uniforms.resolution.value.y=t}}),U.Plugin=function(t,e){void 0===e&&(e=null),this.game=t,this.parent=e,this.active=!1,this.visible=!1,this.hasPreUpdate=!1,this.hasUpdate=!1,this.hasPostUpdate=!1,this.hasRender=!1,this.hasPostRender=!1},U.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null,this.parent=null,this.active=!1,this.visible=!1}},U.Plugin.prototype.constructor=U.Plugin,U.PluginManager=function(t){this.game=t,this.plugins=[],this._len=0,this._i=0},U.PluginManager.prototype={add:function(t){var e=Array.prototype.slice.call(arguments,1),i=!1;return"function"==typeof t?t=new t(this.game,this):(t.game=this.game,t.parent=this),"function"==typeof t.preUpdate&&(i=t.hasPreUpdate=!0),"function"==typeof t.update&&(i=t.hasUpdate=!0),"function"==typeof t.postUpdate&&(i=t.hasPostUpdate=!0),"function"==typeof t.render&&(i=t.hasRender=!0),"function"==typeof t.postRender&&(i=t.hasPostRender=!0),i?((t.hasPreUpdate||t.hasUpdate||t.hasPostUpdate)&&(t.active=!0),(t.hasRender||t.hasPostRender)&&(t.visible=!0),this._len=this.plugins.push(t),"function"==typeof t.init&&t.init.apply(t,e),t):null},remove:function(t,e){for(void 0===e&&(e=!0),this._i=this._len;this._i--;)if(this.plugins[this._i]===t)return e&&t.destroy(),this.plugins.splice(this._i,1),void this._len--},removeAll:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].destroy();this.plugins.length=0,this._len=0},preUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate&&this.plugins[this._i].preUpdate()},update:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasUpdate&&this.plugins[this._i].update()},postUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate&&this.plugins[this._i].postUpdate()},render:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasRender&&this.plugins[this._i].render()},postRender:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender&&this.plugins[this._i].postRender()},destroy:function(){this.removeAll(),this.game=null}},U.PluginManager.prototype.constructor=U.PluginManager,U.Stage=function(t){this.game=t,PIXI.DisplayObjectContainer.call(this),this.name="_stage_root",this.disableVisibilityChange=!1,this.exists=!0,this.worldTransform=new PIXI.Matrix,(this.stage=this).currentRenderOrderID=0,this._hiddenVar="hidden",this._onChange=null,this._bgColor={r:0,g:0,b:0,a:0,color:0,rgba:"#000000"},this.game.transparent||(this._bgColor.a=1),t.config&&this.parseConfig(t.config)},U.Stage.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),U.Stage.prototype.constructor=U.Stage,U.Stage.prototype.parseConfig=function(t){t.disableVisibilityChange&&(this.disableVisibilityChange=t.disableVisibilityChange),t.backgroundColor&&this.setBackgroundColor(t.backgroundColor)},U.Stage.prototype.boot=function(){U.DOM.getOffset(this.game.canvas,this.offset),U.Canvas.setUserSelect(this.game.canvas,"none"),U.Canvas.setTouchAction(this.game.canvas,"none"),this.checkVisibility()},U.Stage.prototype.preUpdate=function(){for(var t=this.currentRenderOrderID=0;t<this.children.length;t++)this.children[t].preUpdate()},U.Stage.prototype.update=function(){for(var t=this.children.length;t--;)this.children[t].update()},U.Stage.prototype.postUpdate=function(){this.game.camera.update(),this.game.camera.target&&(this.game.camera.target.postUpdate(),this.updateTransform(),this.game.camera.updateTarget());for(var t=0;t<this.children.length;t++)this.children[t].postUpdate();this.updateTransform()},U.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0;t<this.children.length;t++)this.children[t].updateTransform()},U.Stage.prototype.checkVisibility=function(){void 0!==document.hidden?this._hiddenVar="visibilitychange":void 0!==document.webkitHidden?this._hiddenVar="webkitvisibilitychange":void 0!==document.mozHidden?this._hiddenVar="mozvisibilitychange":void 0!==document.msHidden?this._hiddenVar="msvisibilitychange":this._hiddenVar=null;var e=this;this._onChange=function(t){return e.visibilityChange(t)},this._hiddenVar&&document.addEventListener(this._hiddenVar,this._onChange,!1),window.onblur=this._onChange,window.onfocus=this._onChange,window.onpagehide=this._onChange,window.onpageshow=this._onChange,this.game.device.cocoonJSApp&&(CocoonJS.App.onSuspended.addEventListener(function(){U.Stage.prototype.visibilityChange.call(e,{type:"pause"})}),CocoonJS.App.onActivated.addEventListener(function(){U.Stage.prototype.visibilityChange.call(e,{type:"resume"})}))},U.Stage.prototype.visibilityChange=function(t){"pagehide"!==t.type&&"blur"!==t.type&&"pageshow"!==t.type&&"focus"!==t.type?this.disableVisibilityChange||(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||"pause"===t.type?this.game.gamePaused(t):this.game.gameResumed(t)):"pagehide"===t.type||"blur"===t.type?this.game.focusLoss(t):"pageshow"!==t.type&&"focus"!==t.type||this.game.focusGain(t)},U.Stage.prototype.setBackgroundColor=function(t){this.game.transparent||(U.Color.valueToColor(t,this._bgColor),U.Color.updateColor(this._bgColor),this._bgColor.r/=255,this._bgColor.g/=255,this._bgColor.b/=255,this._bgColor.a=1)},U.Stage.prototype.destroy=function(){this._hiddenVar&&document.removeEventListener(this._hiddenVar,this._onChange,!1),window.onpagehide=null,window.onpageshow=null,window.onblur=null,window.onfocus=null},Object.defineProperty(U.Stage.prototype,"backgroundColor",{get:function(){return this._bgColor.color},set:function(t){this.setBackgroundColor(t)}}),Object.defineProperty(U.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(t){PIXI.scaleModes.DEFAULT=t?PIXI.scaleModes.LINEAR:PIXI.scaleModes.NEAREST}}),U.Group=function(t,e,i,n,r,s){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===s&&(s=U.Physics.ARCADE),this.game=t,void 0===e&&(e=t.world),this.name=i||"group",this.z=0,PIXI.DisplayObjectContainer.call(this),n?(this.game.stage.addChild(this),this.z=this.game.stage.children.length):e&&(e.addChild(this),this.z=e.children.length),this.type=U.GROUP,this.physicsType=U.GROUP,this.alive=!0,this.exists=!0,this.ignoreDestroy=!1,this.pendingDestroy=!1,this.classType=U.Sprite,this.cursor=null,this.inputEnableChildren=!1,this.onChildInputDown=new U.Signal,this.onChildInputUp=new U.Signal,this.onChildInputOver=new U.Signal,this.onChildInputOut=new U.Signal,this.enableBody=r,this.enableBodyDebug=!1,this.physicsBodyType=s,this.physicsSortDirection=null,this.onDestroy=new U.Signal,this.cursorIndex=0,this.fixedToCamera=!1,this.cameraOffset=new U.Point,this.hash=[],this._sortProperty="z"},U.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),U.Group.prototype.constructor=U.Group,U.Group.RETURN_NONE=0,U.Group.RETURN_TOTAL=1,U.Group.RETURN_CHILD=2,U.Group.RETURN_ALL=3,U.Group.SORT_ASCENDING=-1,U.Group.SORT_DESCENDING=1,U.Group.prototype.add=function(t,e,i){return void 0===e&&(e=!1),t.parent===this||(t.body&&t.parent&&t.parent.hash&&t.parent.removeFromHash(t),void 0===i?(t.z=this.children.length,this.addChild(t)):(this.addChildAt(t,i),this.updateZ()),this.enableBody&&t.hasOwnProperty("body")&&null===t.body?this.game.physics.enable(t,this.physicsBodyType):t.body&&this.addToHash(t),!this.inputEnableChildren||t.input&&!t.inputEnabled||(t.inputEnabled=!0),!e&&t.events&&t.events.onAddedToGroup$dispatch(t,this),null===this.cursor&&(this.cursor=t)),t},U.Group.prototype.addAt=function(t,e,i){this.add(t,i,e)},U.Group.prototype.addToHash=function(t){return t.parent===this&&-1===this.hash.indexOf(t)&&(this.hash.push(t),!0)},U.Group.prototype.removeFromHash=function(t){if(t){t=this.hash.indexOf(t);if(-1!==t)return this.hash.splice(t,1),!0}return!1},U.Group.prototype.addMultiple=function(t,e){if(t instanceof U.Group)t.moveAll(this,e);else if(Array.isArray(t))for(var i=0;i<t.length;i++)this.add(t[i],e);return t},U.Group.prototype.getAt=function(t){return t<0||t>=this.children.length?-1:this.getChildAt(t)},U.Group.prototype.create=function(t,e,i,n,r,s){void 0===r&&(r=!0);n=new this.classType(this.game,t,e,i,n);return n.exists=r,n.visible=r,n.alive=r,this.add(n,!1,s)},U.Group.prototype.createMultiple=function(n,t,e,r){void 0===e&&(e=0),void 0===r&&(r=!1),Array.isArray(t)||(t=[t]),Array.isArray(e)||(e=[e]);var s=this,o=[];return t.forEach(function(i){e.forEach(function(t){for(var e=0;e<n;e++)o.push(s.create(0,0,i,t,r))})}),o},U.Group.prototype.updateZ=function(){for(var t=this.children.length;t--;)this.children[t].z=t},U.Group.prototype.align=function(t,e,i,n,r,s){if(void 0===r&&(r=U.TOP_LEFT),void 0===s&&(s=0),0===this.children.length||s>this.children.length||-1===t&&-1===e)return!1;for(var o=new U.Rectangle(0,0,i,n),a=t*i,l=e*n,p=s;p<this.children.length;p++){var h=this.children[p];if(h.alignIn)if(h.alignIn(o,r),-1===t)o.y+=n,o.y===l&&(o.x+=i,o.y=0);else if(-1===e)o.x+=i,o.x===a&&(o.x=0,o.y+=n);else if(o.x+=i,o.x===a&&(o.x=0,o.y+=n,o.y===l))return!0}return!0},U.Group.prototype.resetCursor=function(t){if(void 0===t&&(t=0),t>this.children.length-1&&(t=0),this.cursor)return this.cursorIndex=t,this.cursor=this.children[this.cursorIndex],this.cursor},U.Group.prototype.next=function(){if(this.cursor)return this.cursorIndex>=this.children.length-1?this.cursorIndex=0:this.cursorIndex++,this.cursor=this.children[this.cursorIndex],this.cursor},U.Group.prototype.previous=function(){if(this.cursor)return 0===this.cursorIndex?this.cursorIndex=this.children.length-1:this.cursorIndex--,this.cursor=this.children[this.cursorIndex],this.cursor},U.Group.prototype.swap=function(t,e){this.swapChildren(t,e),this.updateZ()},U.Group.prototype.bringToTop=function(t){return t.parent===this&&this.getIndex(t)<this.children.length&&(this.remove(t,!1,!0),this.add(t,!0)),t},U.Group.prototype.sendToBack=function(t){return t.parent===this&&0<this.getIndex(t)&&(this.remove(t,!1,!0),this.addAt(t,0,!0)),t},U.Group.prototype.moveUp=function(t){var e;return t.parent===this&&this.getIndex(t)<this.children.length-1&&(e=this.getIndex(t),(e=this.getAt(e+1))&&this.swap(t,e)),t},U.Group.prototype.moveDown=function(t){var e;return t.parent===this&&0<this.getIndex(t)&&(e=this.getIndex(t),(e=this.getAt(e-1))&&this.swap(t,e)),t},U.Group.prototype.xy=function(t,e,i){if(t<0||t>this.children.length)return-1;this.getChildAt(t).x=e,this.getChildAt(t).y=i},U.Group.prototype.reverse=function(){this.children.reverse(),this.updateZ()},U.Group.prototype.getIndex=function(t){return this.children.indexOf(t)},U.Group.prototype.getByName=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].name===t)return this.children[e];return null},U.Group.prototype.replace=function(t,e){var i=this.getIndex(t);if(-1!==i)return e.parent&&(e.parent instanceof U.Group?e.parent.remove(e):e.parent.removeChild(e)),this.remove(t),this.addAt(e,i),t},U.Group.prototype.hasProperty=function(t,e){var i=e.length;return 1===i&&e[0]in t||2===i&&e[0]in t&&e[1]in t[e[0]]||3===i&&e[0]in t&&e[1]in t[e[0]]&&e[2]in t[e[0]][e[1]]||4===i&&e[0]in t&&e[1]in t[e[0]]&&e[2]in t[e[0]][e[1]]&&e[3]in t[e[0]][e[1]][e[2]]},U.Group.prototype.setProperty=function(t,e,i,n,r){if(void 0===r&&(r=!1),n=n||0,!this.hasProperty(t,e)&&(!r||0<n))return!1;r=e.length;return 1===r?0===n?t[e[0]]=i:1===n?t[e[0]]+=i:2===n?t[e[0]]-=i:3===n?t[e[0]]*=i:4===n&&(t[e[0]]/=i):2===r?0===n?t[e[0]][e[1]]=i:1===n?t[e[0]][e[1]]+=i:2===n?t[e[0]][e[1]]-=i:3===n?t[e[0]][e[1]]*=i:4===n&&(t[e[0]][e[1]]/=i):3===r?0===n?t[e[0]][e[1]][e[2]]=i:1===n?t[e[0]][e[1]][e[2]]+=i:2===n?t[e[0]][e[1]][e[2]]-=i:3===n?t[e[0]][e[1]][e[2]]*=i:4===n&&(t[e[0]][e[1]][e[2]]/=i):4===r&&(0===n?t[e[0]][e[1]][e[2]][e[3]]=i:1===n?t[e[0]][e[1]][e[2]][e[3]]+=i:2===n?t[e[0]][e[1]][e[2]][e[3]]-=i:3===n?t[e[0]][e[1]][e[2]][e[3]]*=i:4===n&&(t[e[0]][e[1]][e[2]][e[3]]/=i)),!0},U.Group.prototype.checkProperty=function(t,e,i,n){return void 0===n&&(n=!1),!(!U.Utils.getProperty(t,e)&&n)&&U.Utils.getProperty(t,e)===i},U.Group.prototype.set=function(t,e,i,n,r,s,o){if(void 0===o&&(o=!1),e=e.split("."),void 0===n&&(n=!1),void 0===r&&(r=!1),(!1===n||n&&t.alive)&&(!1===r||r&&t.visible))return this.setProperty(t,e,i,s,o)},U.Group.prototype.setAll=function(t,e,i,n,r,s){void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===s&&(s=!1),t=t.split("."),r=r||0;for(var o=0;o<this.children.length;o++)(!i||i&&this.children[o].alive)&&(!n||n&&this.children[o].visible)&&this.setProperty(this.children[o],t,e,r,s)},U.Group.prototype.setAllChildren=function(t,e,i,n,r,s){void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===s&&(s=!1),r=r||0;for(var o=0;o<this.children.length;o++)(!i||i&&this.children[o].alive)&&(!n||n&&this.children[o].visible)&&(this.children[o]instanceof U.Group?this.children[o].setAllChildren(t,e,i,n,r,s):this.setProperty(this.children[o],t.split("."),e,r,s))},U.Group.prototype.checkAll=function(t,e,i,n,r){void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===r&&(r=!1);for(var s=0;s<this.children.length;s++)if((!i||i&&this.children[s].alive)&&(!n||n&&this.children[s].visible)&&!this.checkProperty(this.children[s],t,e,r))return!1;return!0},U.Group.prototype.addAll=function(t,e,i,n){this.setAll(t,e,i,n,1)},U.Group.prototype.subAll=function(t,e,i,n){this.setAll(t,e,i,n,2)},U.Group.prototype.multiplyAll=function(t,e,i,n){this.setAll(t,e,i,n,3)},U.Group.prototype.divideAll=function(t,e,i,n){this.setAll(t,e,i,n,4)},U.Group.prototype.callAllExists=function(t,e){var i;if(2<arguments.length){i=[];for(var n=2;n<arguments.length;n++)i.push(arguments[n])}for(n=0;n<this.children.length;n++)this.children[n].exists===e&&this.children[n][t]&&this.children[n][t].apply(this.children[n],i)},U.Group.prototype.callbackFromArray=function(t,e,i){if(1===i){if(t[e[0]])return t[e[0]]}else if(2===i){if(t[e[0]][e[1]])return t[e[0]][e[1]]}else if(3===i){if(t[e[0]][e[1]][e[2]])return t[e[0]][e[1]][e[2]]}else if(4===i){if(t[e[0]][e[1]][e[2]][e[3]])return t[e[0]][e[1]][e[2]][e[3]]}else if(t[e])return t[e];return!1},U.Group.prototype.callAll=function(t,e){if(void 0!==t){var i,n,r=(t=t.split(".")).length;if(null==e||""===e?e=null:"string"==typeof e&&(i=(e=e.split(".")).length),2<arguments.length){n=[];for(var s=2;s<arguments.length;s++)n.push(arguments[s])}for(var o,a=null,s=0;s<this.children.length;s++)a=this.callbackFromArray(this.children[s],t,r),e&&a?(o=this.callbackFromArray(this.children[s],e,i),a&&a.apply(o,n)):a&&a.apply(this.children[s],n)}},U.Group.prototype.preUpdate=function(){if(this.pendingDestroy)return this.destroy(),!1;if(!this.exists||!this.parent.exists)return!(this.renderOrderID=-1);for(var t=0;t<this.children.length;t++)this.children[t].preUpdate();return!0},U.Group.prototype.update=function(){for(var t=this.children.length;t--;)this.children[t].update()},U.Group.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);for(var t=0;t<this.children.length;t++)this.children[t].postUpdate()},U.Group.prototype.filter=function(t,e){for(var i=-1,n=this.children.length,r=[];++i<n;){var s=this.children[i];(!e||e&&s.exists)&&t(s,i,this.children)&&r.push(s)}return new U.ArraySet(r)},U.Group.prototype.forEach=function(t,e,i){if(void 0===i&&(i=!1),arguments.length<=3)for(var n=0;n<this.children.length;n++)(!i||i&&this.children[n].exists)&&t.call(e,this.children[n]);else{for(var r=[null],n=3;n<arguments.length;n++)r.push(arguments[n]);for(n=0;n<this.children.length;n++)(!i||i&&this.children[n].exists)&&(r[0]=this.children[n],t.apply(e,r))}},U.Group.prototype.forEachExists=function(t,e){var i;if(2<arguments.length){i=[null];for(var n=2;n<arguments.length;n++)i.push(arguments[n])}this.iterate("exists",!0,U.Group.RETURN_TOTAL,t,e,i)},U.Group.prototype.forEachAlive=function(t,e){var i;if(2<arguments.length){i=[null];for(var n=2;n<arguments.length;n++)i.push(arguments[n])}this.iterate("alive",!0,U.Group.RETURN_TOTAL,t,e,i)},U.Group.prototype.forEachDead=function(t,e){var i;if(2<arguments.length){i=[null];for(var n=2;n<arguments.length;n++)i.push(arguments[n])}this.iterate("alive",!1,U.Group.RETURN_TOTAL,t,e,i)},U.Group.prototype.sort=function(t,e){this.children.length<2||(void 0===t&&(t="z"),void 0===e&&(e=U.Group.SORT_ASCENDING),this._sortProperty=t,e===U.Group.SORT_ASCENDING?this.children.sort(this.ascendingSortHandler.bind(this)):this.children.sort(this.descendingSortHandler.bind(this)),this.updateZ())},U.Group.prototype.customSort=function(t,e){this.children.length<2||(this.children.sort(t.bind(e)),this.updateZ())},U.Group.prototype.ascendingSortHandler=function(t,e){return t[this._sortProperty]<e[this._sortProperty]||!(t[this._sortProperty]>e[this._sortProperty])&&t.z<e.z?-1:1},U.Group.prototype.descendingSortHandler=function(t,e){return t[this._sortProperty]<e[this._sortProperty]?1:t[this._sortProperty]>e[this._sortProperty]?-1:0},U.Group.prototype.iterate=function(t,e,i,n,r,s){if(0===this.children.length){if(i===U.Group.RETURN_TOTAL)return 0;if(i===U.Group.RETURN_ALL)return[]}var o,a=0;i===U.Group.RETURN_ALL&&(o=[]);for(var l=0;l<this.children.length;l++)if(this.children[l][t]===e){if(a++,n&&(s?(s[0]=this.children[l],n.apply(r,s)):n.call(r,this.children[l])),i===U.Group.RETURN_CHILD)return this.children[l];i===U.Group.RETURN_ALL&&o.push(this.children[l])}return i===U.Group.RETURN_TOTAL?a:i===U.Group.RETURN_ALL?o:null},U.Group.prototype.getFirstExists=function(t,e,i,n,r,s){void 0===e&&(e=!1),"boolean"!=typeof t&&(t=!0);t=this.iterate("exists",t,U.Group.RETURN_CHILD);return null===t&&e?this.create(i,n,r,s):this.resetChild(t,i,n,r,s)},U.Group.prototype.getFirstAlive=function(t,e,i,n,r){void 0===t&&(t=!1);var s=this.iterate("alive",!0,U.Group.RETURN_CHILD);return null===s&&t?this.create(e,i,n,r):this.resetChild(s,e,i,n,r)},U.Group.prototype.getFirstDead=function(t,e,i,n,r){void 0===t&&(t=!1);var s=this.iterate("alive",!1,U.Group.RETURN_CHILD);return null===s&&t?this.create(e,i,n,r):this.resetChild(s,e,i,n,r)},U.Group.prototype.resetChild=function(t,e,i,n,r){return null===t?null:(void 0===e&&(e=null),void 0===i&&(i=null),null!==e&&null!==i&&t.reset(e,i),void 0!==n&&t.loadTexture(n,r),t)},U.Group.prototype.getTop=function(){if(0<this.children.length)return this.children[this.children.length-1]},U.Group.prototype.getBottom=function(){if(0<this.children.length)return this.children[0]},U.Group.prototype.getClosestTo=function(t,e,i){for(var n=Number.MAX_VALUE,r=0,s=null,o=0;o<this.children.length;o++){var a=this.children[o];a.exists&&(r=Math.abs(U.Point.distance(t,a)))<n&&(!e||e.call(i,a,r))&&(n=r,s=a)}return s},U.Group.prototype.getFurthestFrom=function(t,e,i){for(var n=0,r=0,s=null,o=0;o<this.children.length;o++){var a=this.children[o];a.exists&&(r=Math.abs(U.Point.distance(t,a)))>n&&(!e||e.call(i,a,r))&&(n=r,s=a)}return s},U.Group.prototype.countLiving=function(){return this.iterate("alive",!0,U.Group.RETURN_TOTAL)},U.Group.prototype.countDead=function(){return this.iterate("alive",!1,U.Group.RETURN_TOTAL)},U.Group.prototype.getRandom=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.children.length),0===e?null:U.ArrayUtils.getRandomItem(this.children,t,e)},U.Group.prototype.getRandomExists=function(t,e){e=this.getAll("exists",!0,t,e);return this.game.rnd.pick(e)},U.Group.prototype.getAll=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=this.children.length);for(var r=[],s=i;s<n;s++){var o=this.children[s];t&&o[t]===e&&r.push(o)}return r},U.Group.prototype.remove=function(t,e,i){if(void 0===e&&(e=!1),void 0===i&&(i=!1),0===this.children.length||-1===this.children.indexOf(t))return!1;i||!t.events||t.destroyPhase||t.events.onRemovedFromGroup$dispatch(t,this);i=this.removeChild(t);return this.removeFromHash(t),this.updateZ(),this.cursor===t&&this.next(),e&&i&&i.destroy(!0),!0},U.Group.prototype.moveAll=function(t,e){if(void 0===e&&(e=!1),0<this.children.length&&t instanceof U.Group){for(;t.add(this.children[0],e),0<this.children.length;);this.hash=[],this.cursor=null}return t},U.Group.prototype.removeAll=function(t,e,i){if(void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===i&&(i=!1),0!==this.children.length){do{!e&&this.children[0].events&&this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this);var n=this.removeChild(this.children[0])}while(this.removeFromHash(n),t&&n&&n.destroy(!0,i),0<this.children.length);this.hash=[],this.cursor=null}},U.Group.prototype.removeBetween=function(t,e,i,n){if(void 0===e&&(e=this.children.length-1),void 0===i&&(i=!1),void 0===n&&(n=!1),0!==this.children.length){if(e<t||t<0||e>this.children.length)return!1;for(var r=e;t<=r;){!n&&this.children[r].events&&this.children[r].events.onRemovedFromGroup$dispatch(this.children[r],this);var s=this.removeChild(this.children[r]);this.removeFromHash(s),i&&s&&s.destroy(!0),this.cursor===this.children[r]&&(this.cursor=null),r--}this.updateZ()}},U.Group.prototype.destroy=function(t,e){null===this.game||this.ignoreDestroy||(void 0===t&&(t=!0),void 0===e&&(e=!1),this.onDestroy.dispatch(this,t,e),this.removeAll(t),this.cursor=null,this.filters=null,this.pendingDestroy=!1,e||(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1))},Object.defineProperty(U.Group.prototype,"total",{get:function(){return this.iterate("exists",!0,U.Group.RETURN_TOTAL)}}),Object.defineProperty(U.Group.prototype,"length",{get:function(){return this.children.length}}),Object.defineProperty(U.Group.prototype,"angle",{get:function(){return U.Math.radToDeg(this.rotation)},set:function(t){this.rotation=U.Math.degToRad(t)}}),Object.defineProperty(U.Group.prototype,"centerX",{get:function(){return this.getBounds(this.parent).centerX},set:function(t){var e=this.getBounds(this.parent),i=this.x-e.x;this.x=t+i-e.halfWidth}}),Object.defineProperty(U.Group.prototype,"centerY",{get:function(){return this.getBounds(this.parent).centerY},set:function(t){var e=this.getBounds(this.parent),i=this.y-e.y;this.y=t+i-e.halfHeight}}),Object.defineProperty(U.Group.prototype,"left",{get:function(){return this.getBounds(this.parent).left},set:function(t){var e=this.getBounds(this.parent),e=this.x-e.x;this.x=t+e}}),Object.defineProperty(U.Group.prototype,"right",{get:function(){return this.getBounds(this.parent).right},set:function(t){var e=this.getBounds(this.parent),i=this.x-e.x;this.x=t+i-e.width}}),Object.defineProperty(U.Group.prototype,"top",{get:function(){return this.getBounds(this.parent).top},set:function(t){var e=this.getBounds(this.parent),e=this.y-e.y;this.y=t+e}}),Object.defineProperty(U.Group.prototype,"bottom",{get:function(){return this.getBounds(this.parent).bottom},set:function(t){var e=this.getBounds(this.parent),i=this.y-e.y;this.y=t+i-e.height}}),U.World=function(t){U.Group.call(this,t,null,"__world",!1),this.bounds=new U.Rectangle(0,0,t.width,t.height),this.camera=null,this._definedSize=!1,this._width=t.width,this._height=t.height,this.game.state.onStateChange.add(this.stateChange,this)},U.World.prototype=Object.create(U.Group.prototype),U.World.prototype.constructor=U.World,U.World.prototype.boot=function(){this.camera=new U.Camera(this.game,0,0,0,this.game.width,this.game.height),this.game.stage.addChild(this),this.camera.boot()},U.World.prototype.stateChange=function(){this.x=0,this.y=0,this.camera.reset()},U.World.prototype.setBounds=function(t,e,i,n){this._definedSize=!0,this._width=i,this._height=n,this.bounds.setTo(t,e,i,n),this.x=t,this.y=e,this.camera.bounds&&this.camera.bounds.setTo(t,e,Math.max(i,this.game.width),Math.max(n,this.game.height)),this.game.physics.setBoundsToWorld()},U.World.prototype.resize=function(t,e){this._definedSize&&(t<this._width&&(t=this._width),e<this._height&&(e=this._height)),this.bounds.width=t,this.bounds.height=e,this.game.camera.setBoundsToWorld(),this.game.physics.setBoundsToWorld()},U.World.prototype.shutdown=function(){this.destroy(!0,!0)},U.World.prototype.wrap=function(t,e,i,n,r){void 0===e&&(e=0),void 0===i&&(i=!1),void 0===n&&(n=!0),void 0===r&&(r=!0),i?(t.getBounds(),n&&(t.x+t._currentBounds.width<this.bounds.x?t.x=this.bounds.right:t.x>this.bounds.right&&(t.x=this.bounds.left)),r&&(t.y+t._currentBounds.height<this.bounds.top?t.y=this.bounds.bottom:t.y>this.bounds.bottom&&(t.y=this.bounds.top))):(n&&t.x+e<this.bounds.x?t.x=this.bounds.right+e:n&&t.x-e>this.bounds.right&&(t.x=this.bounds.left-e),r&&t.y+e<this.bounds.top?t.y=this.bounds.bottom+e:r&&t.y-e>this.bounds.bottom&&(t.y=this.bounds.top-e))},Object.defineProperty(U.World.prototype,"width",{get:function(){return this.bounds.width},set:function(t){t<this.game.width&&(t=this.game.width),this.bounds.width=t,this._width=t,this._definedSize=!0}}),Object.defineProperty(U.World.prototype,"height",{get:function(){return this.bounds.height},set:function(t){t<this.game.height&&(t=this.game.height),this.bounds.height=t,this._height=t,this._definedSize=!0}}),Object.defineProperty(U.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth+this.bounds.x}}),Object.defineProperty(U.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight+this.bounds.y}}),Object.defineProperty(U.World.prototype,"randomX",{get:function(){return this.bounds.x<0?this.game.rnd.between(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x)):this.game.rnd.between(this.bounds.x,this.bounds.width)}}),Object.defineProperty(U.World.prototype,"randomY",{get:function(){return this.bounds.y<0?this.game.rnd.between(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y)):this.game.rnd.between(this.bounds.y,this.bounds.height)}}),U.Game=function(t,e,i,n,r,s,o,a){return this.id=U.GAMES.push(this)-1,this.config=null,this.physicsConfig=a,this.parent="",this.width=800,this.height=600,this.resolution=1,this._width=800,this._height=600,this.transparent=!1,this.antialias=!0,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!0,this.renderer=null,this.renderType=U.AUTO,this.state=null,this.isBooted=!1,this.isRunning=!1,this.raf=null,this.add=null,this.make=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.net=null,this.scale=null,this.sound=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.physics=null,this.plugins=null,this.rnd=null,this.device=U.Device,this.camera=null,this.canvas=null,this.context=null,this.debug=null,this.particles=null,this.create=null,this.lockRender=!1,this.stepping=!1,this.pendingStep=!1,this.stepCount=0,this.onPause=null,this.onResume=null,this.onBlur=null,this.onFocus=null,this._paused=!1,this._codePaused=!1,this.currentUpdateID=0,this.updatesThisFrame=1,this._deltaTime=0,this._lastCount=0,this._spiraling=0,this._kickstart=!0,this.fpsProblemNotifier=new U.Signal,this.forceSingleUpdate=!0,this._nextFpsNotification=0,1===arguments.length&&"object"==typeof t?this.parseConfig(t):(this.config={enableDebug:!0},void 0!==t&&(this._width=t),void 0!==e&&(this._height=e),void 0!==i&&(this.renderType=i),void 0!==n&&(this.parent=n),void 0!==s&&(this.transparent=s),void 0!==o&&(this.antialias=o),this.rnd=new U.RandomDataGenerator([(Date.now()*Math.random()).toString()]),this.state=new U.StateManager(this,r)),this.device.whenReady(this.boot,this),this},U.Game.prototype={parseConfig:function(t){void 0===(this.config=t).enableDebug&&(this.config.enableDebug=!0),t.width&&(this._width=t.width),t.height&&(this._height=t.height),t.renderer&&(this.renderType=t.renderer),t.parent&&(this.parent=t.parent),void 0!==t.transparent&&(this.transparent=t.transparent),void 0!==t.antialias&&(this.antialias=t.antialias),t.resolution&&(this.resolution=t.resolution),void 0!==t.preserveDrawingBuffer&&(this.preserveDrawingBuffer=t.preserveDrawingBuffer),t.physicsConfig&&(this.physicsConfig=t.physicsConfig);var e=[(Date.now()*Math.random()).toString()];t.seed&&(e=t.seed),this.rnd=new U.RandomDataGenerator(e);e=null;t.state&&(e=t.state),this.state=new U.StateManager(this,e)},boot:function(){this.isBooted||(this.onPause=new U.Signal,this.onResume=new U.Signal,this.onBlur=new U.Signal,this.onFocus=new U.Signal,this.isBooted=!0,(PIXI.game=this).math=U.Math,this.scale=new U.ScaleManager(this,this._width,this._height),this.stage=new U.Stage(this),this.setUpRenderer(),this.world=new U.World(this),this.add=new U.GameObjectFactory(this),this.make=new U.GameObjectCreator(this),this.cache=new U.Cache(this),this.load=new U.Loader(this),this.time=new U.Time(this),this.tweens=new U.TweenManager(this),this.input=new U.Input(this),this.sound=new U.SoundManager(this),this.physics=new U.Physics(this,this.physicsConfig),this.particles=new U.Particles(this),this.create=new U.Create(this),this.plugins=new U.PluginManager(this),this.net=new U.Net(this),this.time.boot(),this.stage.boot(),this.world.boot(),this.scale.boot(),this.input.boot(),this.sound.boot(),this.state.boot(),this.config.enableDebug?(this.debug=new U.Utils.Debug(this),this.debug.boot()):this.debug={preUpdate:function(){},update:function(){},reset:function(){}},this.showDebugHeader(),this.isRunning=!0,this.config&&this.config.forceSetTimeOut?this.raf=new U.RequestAnimationFrame(this,this.config.forceSetTimeOut):this.raf=new U.RequestAnimationFrame(this,!1),this._kickstart=!0,window.focus&&(!window.PhaserGlobal||window.PhaserGlobal&&!window.PhaserGlobal.stopFocus)&&window.focus(),this.raf.start())},showDebugHeader:function(){if(!window.PhaserGlobal||!window.PhaserGlobal.hideBanner){var t=U.VERSION,e="Canvas",i="HTML Audio",n=1;if(this.renderType===U.WEBGL?(e="WebGL",n++):this.renderType===U.HEADLESS&&(e="Headless"),this.device.webAudio&&(i="WebAudio",n++),this.device.chrome)for(var r=["%c %c %c @orange-games/phaser v"+t+" | Pixi.js | "+e+" | "+i+"  %c %c %c http://phaser.io %câ™¥%câ™¥%câ™¥","background: #F47820","background: #ED873F","color: #ffffff; background: #DD6612;","background: #ED873F","background: #F47820","background: #ffffff"],s=0;s<3;s++)s<n?r.push("color: #ff2424; background: #fff"):r.push("color: #959595; background: #fff");else window.console}},setUpRenderer:function(){if(this.config.canvas?this.canvas=this.config.canvas:this.canvas=U.Canvas.create(this,this.width,this.height,this.config.canvasID,!0),this.config.canvasStyle?this.canvas.style=this.config.canvasStyle:this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%",this.renderType===U.HEADLESS||this.renderType===U.CANVAS||this.renderType===U.AUTO&&!this.device.webGL){if(!this.device.canvas)throw new Error("Phaser.Game - Cannot create Canvas or WebGL context, aborting.");this.renderType=U.CANVAS,this.renderer=new PIXI.CanvasRenderer(this),this.context=this.renderer.context}else this.renderType=U.WEBGL,this.renderer=new PIXI.WebGLRenderer(this),this.context=null,this.canvas.addEventListener("webglcontextlost",this.contextLost.bind(this),!1),this.canvas.addEventListener("webglcontextrestored",this.contextRestored.bind(this),!1);this.device.cocoonJS&&(this.canvas.screencanvas=this.renderType===U.CANVAS),this.renderType!==U.HEADLESS&&(this.stage.smoothed=this.antialias,U.Canvas.addToDOM(this.canvas,this.parent,!1),U.Canvas.setTouchAction(this.canvas))},contextLost:function(t){t.preventDefault(),this.renderer.contextLost=!0},contextRestored:function(){this.renderer.initContext(),this.cache.clearGLTextures(),this.renderer.contextLost=!1},update:function(t){if(this.time.update(t),this._kickstart)return this.updateLogic(this.time.desiredFpsMult),this.updateRender(this.time.slowMotion*this.time.desiredFps),void(this._kickstart=!1);if(1<this._spiraling&&!this.forceSingleUpdate)this.time.time>this._nextFpsNotification&&(this._nextFpsNotification=this.time.time+1e4,this.fpsProblemNotifier.dispatch()),this._deltaTime=0,this._spiraling=0,this.updateRender(this.time.slowMotion*this.time.desiredFps);else{var e=1e3*this.time.slowMotion/this.time.desiredFps;this._deltaTime+=Math.max(Math.min(3*e,this.time.elapsed),0);var i=0;for(this.updatesThisFrame=Math.floor(this._deltaTime/e),this.forceSingleUpdate&&(this.updatesThisFrame=Math.min(1,this.updatesThisFrame));this._deltaTime>=e&&(this._deltaTime-=e,this.currentUpdateID=i,this.updateLogic(this.time.desiredFpsMult),i++,!this.forceSingleUpdate||1!==i);)this.time.refresh();i>this._lastCount?this._spiraling++:i<this._lastCount&&(this._spiraling=0),this._lastCount=i,this.updateRender(this._deltaTime/e)}},updateLogic:function(t){this._paused||this.pendingStep?(this.scale.pauseUpdate(),this.state.pauseUpdate(),this.debug.preUpdate()):(this.stepping&&(this.pendingStep=!0),this.scale.preUpdate(),this.debug.preUpdate(),this.camera.preUpdate(),this.physics.preUpdate(),this.state.preUpdate(t),this.plugins.preUpdate(t),this.stage.preUpdate(),this.state.update(),this.stage.update(),this.tweens.update(),this.sound.update(),this.input.update(),this.physics.update(),this.particles.update(),this.plugins.update(),this.stage.postUpdate(),this.plugins.postUpdate()),this.stage.updateTransform()},updateRender:function(t){this.lockRender||(this.state.preRender(t),this.renderType!==U.HEADLESS&&(this.renderer.render(this.stage),this.plugins.render(t),this.state.render(t)),this.plugins.postRender(t))},enableStep:function(){this.stepping=!0,this.pendingStep=!1,this.stepCount=0},disableStep:function(){this.stepping=!1,this.pendingStep=!1},step:function(){this.pendingStep=!1,this.stepCount++},destroy:function(){this.raf.stop(),this.state.destroy(),this.sound.destroy(),this.scale.destroy(),this.stage.destroy(),this.input.destroy(),this.physics.destroy(),this.plugins.destroy(),this.state=null,this.sound=null,this.scale=null,this.stage=null,this.input=null,this.physics=null,this.plugins=null,this.cache=null,this.load=null,this.time=null,this.world=null,this.isBooted=!1,this.renderer.destroy(!1),U.Canvas.removeFromDOM(this.canvas),PIXI.defaultRenderer=null,U.GAMES[this.id]=null},gamePaused:function(t){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.muteOnPause&&this.sound.setMute(),this.onPause.dispatch(t),this.device.cordova&&this.device.iOS&&(this.lockRender=!0))},gameResumed:function(t){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.muteOnPause&&this.sound.unsetMute(),this.onResume.dispatch(t),this.device.cordova&&this.device.iOS&&(this.lockRender=!1))},focusLoss:function(t){this.onBlur.dispatch(t),this.stage.disableVisibilityChange||this.gamePaused(t)},focusGain:function(t){this.onFocus.dispatch(t),this.stage.disableVisibilityChange||this.gameResumed(t)}},U.Game.prototype.constructor=U.Game,Object.defineProperty(U.Game.prototype,"paused",{get:function(){return this._paused},set:function(t){!0===t?(!1===this._paused&&(this._paused=!0,this.sound.setMute(),this.time.gamePaused(),this.onPause.dispatch(this)),this._codePaused=!0):(this._paused&&(this._paused=!1,this.input.reset(),this.sound.unsetMute(),this.time.gameResumed(),this.onResume.dispatch(this)),this._codePaused=!1)}}),U.Input=function(t){this.game=t,this.hitCanvas=null,this.hitContext=null,this.moveCallbacks=[],this.customCandidateHandler=null,this.customCandidateHandlerContext=null,this.pollRate=0,this.enabled=!0,this.multiInputOverride=U.Input.MOUSE_TOUCH_COMBINE,this.position=null,this.speed=null,this.circle=null,this.scale=null,this.maxPointers=-1,this.tapRate=200,this.doubleTapRate=300,this.holdRate=2e3,this.justPressedRate=200,this.justReleasedRate=200,this.recordPointerHistory=!1,this.recordRate=100,this.recordLimit=100,this.pointer1=null,this.pointer2=null,this.pointer3=null,this.pointer4=null,this.pointer5=null,this.pointer6=null,this.pointer7=null,this.pointer8=null,this.pointer9=null,this.pointer10=null,this.pointers=[],this.activePointer=null,this.mousePointer=null,this.mouse=null,this.keyboard=null,this.touch=null,this.mspointer=null,this.gamepad=null,this.resetLocked=!1,this.onDown=null,this.onUp=null,this.onTap=null,this.onHold=null,this.minPriorityID=0,this.interactiveItems=new U.ArraySet,this._localPoint=new U.Point,this._pollCounter=0,this._oldPosition=null,this._x=0,this._y=0},U.Input.MOUSE_OVERRIDES_TOUCH=0,U.Input.TOUCH_OVERRIDES_MOUSE=1,U.Input.MOUSE_TOUCH_COMBINE=2,U.Input.MAX_POINTERS=10,U.Input.prototype={boot:function(){this.mousePointer=new U.Pointer(this.game,0,U.PointerMode.CURSOR),this.addPointer(),this.addPointer(),this.mouse=new U.Mouse(this.game),this.touch=new U.Touch(this.game),this.mspointer=new U.MSPointer(this.game),U.Keyboard&&(this.keyboard=new U.Keyboard(this.game)),U.Gamepad&&(this.gamepad=new U.Gamepad(this.game)),this.onDown=new U.Signal,this.onUp=new U.Signal,this.onTap=new U.Signal,this.onHold=new U.Signal,this.scale=new U.Point(1,1),this.speed=new U.Point,this.position=new U.Point,this._oldPosition=new U.Point,this.circle=new U.Circle(0,0,44),this.activePointer=this.mousePointer,this.hitCanvas=PIXI.CanvasPool.create(this,1,1),this.hitContext=this.hitCanvas.getContext("2d"),this.mouse.start(),this.touch.start(),this.mspointer.start(),this.mousePointer.active=!0,this.keyboard&&this.keyboard.start();var e=this;this._onClickTrampoline=function(t){e.onClickTrampoline(t)},this.game.canvas.addEventListener("click",this._onClickTrampoline,!1)},destroy:function(){this.mouse.stop(),this.touch.stop(),this.mspointer.stop(),this.keyboard&&this.keyboard.stop(),this.gamepad&&this.gamepad.stop(),this.moveCallbacks=[],PIXI.CanvasPool.remove(this),this.game.canvas.removeEventListener("click",this._onClickTrampoline)},setInteractiveCandidateHandler:function(t,e){this.customCandidateHandler=t,this.customCandidateHandlerContext=e},addMoveCallback:function(t,e){this.moveCallbacks.push({callback:t,context:e})},deleteMoveCallback:function(t,e){for(var i=this.moveCallbacks.length;i--;)if(this.moveCallbacks[i].callback===t&&this.moveCallbacks[i].context===e)return void this.moveCallbacks.splice(i,1)},addPointer:function(){if(this.pointers.length>=U.Input.MAX_POINTERS)return null;var t=this.pointers.length+1,e=new U.Pointer(this.game,t,U.PointerMode.TOUCH);return this.pointers.push(e),this["pointer"+t]=e},update:function(){if(this.keyboard&&this.keyboard.update(),0<this.pollRate&&this._pollCounter<this.pollRate)this._pollCounter++;else{this.speed.x=this.position.x-this._oldPosition.x,this.speed.y=this.position.y-this._oldPosition.y,this._oldPosition.copyFrom(this.position),this.mousePointer.update(),this.gamepad&&this.gamepad.active&&this.gamepad.update();for(var t=0;t<this.pointers.length;t++)this.pointers[t].update();this._pollCounter=0}},reset:function(t){if(this.game.isBooted&&!this.resetLocked){void 0===t&&(t=!1),this.mousePointer.reset(),this.keyboard&&this.keyboard.reset(t),this.gamepad&&this.gamepad.reset();for(var e=0;e<this.pointers.length;e++)this.pointers[e].reset();"none"!==this.game.canvas.style.cursor&&(this.game.canvas.style.cursor="inherit"),t&&(this.onDown.dispose(),this.onUp.dispose(),this.onTap.dispose(),this.onHold.dispose(),this.onDown=new U.Signal,this.onUp=new U.Signal,this.onTap=new U.Signal,this.onHold=new U.Signal,this.moveCallbacks=[]),this._pollCounter=0}},resetSpeed:function(t,e){this._oldPosition.setTo(t,e),this.speed.setTo(0,0)},startPointer:function(t){if(0<=this.maxPointers&&this.countActivePointers(this.maxPointers)>=this.maxPointers)return null;if(!this.pointer1.active)return this.pointer1.start(t);if(!this.pointer2.active)return this.pointer2.start(t);for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(!i.active)return i.start(t)}return null},updatePointer:function(t){if(this.pointer1.active&&this.pointer1.identifier===t.identifier)return this.pointer1.move(t);if(this.pointer2.active&&this.pointer2.identifier===t.identifier)return this.pointer2.move(t);for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active&&i.identifier===t.identifier)return i.move(t)}return null},stopPointer:function(t){if(this.pointer1.active&&this.pointer1.identifier===t.identifier)return this.pointer1.stop(t);if(this.pointer2.active&&this.pointer2.identifier===t.identifier)return this.pointer2.stop(t);for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active&&i.identifier===t.identifier)return i.stop(t)}return null},countActivePointers:function(t){void 0===t&&(t=this.pointers.length);for(var e=t,i=0;i<this.pointers.length&&0<e;i++)this.pointers[i].active&&e--;return t-e},getPointer:function(t){void 0===t&&(t=!1);for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active===t)return i}return null},getPointerFromIdentifier:function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.identifier===t)return i}return null},getPointerFromId:function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.pointerId===t)return i}return null},getLocalPosition:function(t,e,i){void 0===i&&(i=new U.Point);var n=t.worldTransform,t=1/(n.a*n.d+n.c*-n.b);return i.setTo(n.d*t*e.x+-n.c*t*e.y+(n.ty*n.c-n.tx*n.d)*t,n.a*t*e.y+-n.b*t*e.x+(-n.ty*n.a+n.tx*n.b)*t)},hitTest:function(t,e,i){if(!t.worldVisible)return!1;if(this.getLocalPosition(t,e,this._localPoint),i.copyFrom(this._localPoint),t.hitArea&&t.hitArea.contains)return t.hitArea.contains(this._localPoint.x,this._localPoint.y);if(t instanceof U.TileSprite){var n=t.width,r=t.height,s=-n*t.anchor.x;if(this._localPoint.x>=s&&this._localPoint.x<s+n){var o=-r*t.anchor.y;if(this._localPoint.y>=o&&this._localPoint.y<o+r)return!0}}else if(t instanceof PIXI.Sprite){n=t.texture.frame.width,r=t.texture.frame.height,s=-n*t.anchor.x;if(this._localPoint.x>=s&&this._localPoint.x<s+n){o=-r*t.anchor.y;if(this._localPoint.y>=o&&this._localPoint.y<o+r)return!0}}else if(t instanceof U.Graphics)for(var a=0;a<t.graphicsData.length;a++){var l=t.graphicsData[a];if(l.fill&&l.shape&&l.shape.contains(this._localPoint.x,this._localPoint.y))return!0}for(a=0;a<t.children.length;a++)if(this.hitTest(t.children[a],e,i))return!0;return!1},onClickTrampoline:function(){this.activePointer.processClickTrampolines()}},U.Input.prototype.constructor=U.Input,Object.defineProperty(U.Input.prototype,"x",{get:function(){return this._x},set:function(t){this._x=Math.floor(t)}}),Object.defineProperty(U.Input.prototype,"y",{get:function(){return this._y},set:function(t){this._y=Math.floor(t)}}),Object.defineProperty(U.Input.prototype,"pollLocked",{get:function(){return 0<this.pollRate&&this._pollCounter<this.pollRate}}),Object.defineProperty(U.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-this.countActivePointers()}}),Object.defineProperty(U.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}}),Object.defineProperty(U.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}}),Object.defineProperty(U.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}}),U.Mouse=function(t){this.game=t,this.input=t.input,this.callbackContext=this.game,this.mouseDownCallback=null,this.mouseUpCallback=null,this.mouseOutCallback=null,this.mouseOverCallback=null,this.mouseWheelCallback=null,this.capture=!1,this.button=-1,this.wheelDelta=0,this.enabled=!0,this.locked=!1,this.stopOnGameOut=!1,this.pointerLock=new U.Signal,this.event=null,this._onMouseDown=null,this._onMouseMove=null,this._onMouseUp=null,this._onMouseOut=null,this._onMouseOver=null,this._onMouseWheel=null,this._wheelEvent=null},U.Mouse.NO_BUTTON=-1,U.Mouse.LEFT_BUTTON=0,U.Mouse.MIDDLE_BUTTON=1,U.Mouse.RIGHT_BUTTON=2,U.Mouse.BACK_BUTTON=3,U.Mouse.FORWARD_BUTTON=4,U.Mouse.WHEEL_UP=1,U.Mouse.WHEEL_DOWN=-1,U.Mouse.prototype={start:function(){var e,t,i;this.game.device.android&&!1===this.game.device.chrome||null!==this._onMouseDown||((e=this)._onMouseDown=function(t){return e.onMouseDown(t)},this._onMouseMove=function(t){return e.onMouseMove(t)},this._onMouseUp=function(t){return e.onMouseUp(t)},this._onMouseUpGlobal=function(t){return e.onMouseUpGlobal(t)},this._onMouseOutGlobal=function(t){return e.onMouseOutGlobal(t)},this._onMouseOut=function(t){return e.onMouseOut(t)},this._onMouseOver=function(t){return e.onMouseOver(t)},this._onMouseWheel=function(t){return e.onMouseWheel(t)},(t=this.game.canvas).addEventListener("mousedown",this._onMouseDown,!0),t.addEventListener("mousemove",this._onMouseMove,!0),t.addEventListener("mouseup",this._onMouseUp,!0),this.game.device.cocoonJS||(window.addEventListener("mouseup",this._onMouseUpGlobal,!0),window.addEventListener("mouseout",this._onMouseOutGlobal,!0),t.addEventListener("mouseover",this._onMouseOver,!0),t.addEventListener("mouseout",this._onMouseOut,!0)),(i=this.game.device.wheelEvent)&&(t.addEventListener(i,this._onMouseWheel,!0),"mousewheel"===i?this._wheelEvent=new n(-.025,1):"DOMMouseScroll"===i&&(this._wheelEvent=new n(1,1))))},onMouseDown:function(t){this.event=t,this.capture&&t.preventDefault(),this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=0,this.input.mousePointer.start(t))},onMouseMove:function(t){this.event=t,this.capture&&t.preventDefault(),this.mouseMoveCallback&&this.mouseMoveCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=0,this.input.mousePointer.move(t))},onMouseUp:function(t){this.event=t,this.capture&&t.preventDefault(),this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=0,this.input.mousePointer.stop(t))},onMouseUpGlobal:function(t){this.input.mousePointer.withinGame||(this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,t),t.identifier=0,this.input.mousePointer.stop(t))},onMouseOutGlobal:function(t){this.event=t,this.capture&&t.preventDefault(),this.input.mousePointer.withinGame=!1,this.input.enabled&&this.enabled&&(this.input.mousePointer.stop(t),this.input.mousePointer.leftButton.stop(t),this.input.mousePointer.rightButton.stop(t))},onMouseOut:function(t){this.event=t,this.capture&&t.preventDefault(),this.input.mousePointer.withinGame=!1,this.mouseOutCallback&&this.mouseOutCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&this.stopOnGameOut&&(t.identifier=0,this.input.mousePointer.stop(t))},onMouseOver:function(t){this.event=t,this.capture&&t.preventDefault(),this.input.mousePointer.withinGame=!0,this.mouseOverCallback&&this.mouseOverCallback.call(this.callbackContext,t)},onMouseWheel:function(t){this._wheelEvent&&(t=this._wheelEvent.bindEvent(t)),this.event=t,this.capture&&t.preventDefault(),this.wheelDelta=U.Math.clamp(-t.deltaY,-1,1),this.mouseWheelCallback&&this.mouseWheelCallback.call(this.callbackContext,t)},requestPointerLock:function(){var t,e;this.game.device.pointerLock&&((t=this.game.canvas).requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock,t.requestPointerLock(),(e=this)._pointerLockChange=function(t){return e.pointerLockChange(t)},document.addEventListener("pointerlockchange",this._pointerLockChange,!0),document.addEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.addEventListener("webkitpointerlockchange",this._pointerLockChange,!0))},pointerLockChange:function(t){var e=this.game.canvas;document.pointerLockElement===e||document.mozPointerLockElement===e||document.webkitPointerLockElement===e?(this.locked=!0,this.pointerLock.dispatch(!0,t)):(this.locked=!1,this.pointerLock.dispatch(!1,t))},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock(),document.removeEventListener("pointerlockchange",this._pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)},stop:function(){var t=this.game.canvas;t.removeEventListener("mousedown",this._onMouseDown,!0),t.removeEventListener("mousemove",this._onMouseMove,!0),t.removeEventListener("mouseup",this._onMouseUp,!0),t.removeEventListener("mouseover",this._onMouseOver,!0),t.removeEventListener("mouseout",this._onMouseOut,!0);var e=this.game.device.wheelEvent;e&&t.removeEventListener(e,this._onMouseWheel,!0),window.removeEventListener("mouseup",this._onMouseUpGlobal,!0),window.removeEventListener("mouseout",this._onMouseOutGlobal,!0),document.removeEventListener("pointerlockchange",this._pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},U.Mouse.prototype.constructor=U.Mouse,((n.prototype={}).constructor=n).prototype.bindEvent=function(t){if(!n._stubsGenerated&&t){for(var e in t)e in n.prototype||Object.defineProperty(n.prototype,e,{get:function(e){return function(){var t=this.originalEvent[e];return"function"!=typeof t?t:t.bind(this.originalEvent)}}(e)});n._stubsGenerated=!0}return this.originalEvent=t,this},Object.defineProperties(n.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*this.originalEvent.wheelDeltaX||0}},deltaZ:{value:0}}),U.MSPointer=function(t){this.game=t,this.input=t.input,this.callbackContext=this.game,this.pointerDownCallback=null,this.pointerMoveCallback=null,this.pointerUpCallback=null,this.capture=!0,this.button=-1,this.event=null,this.enabled=!0,this._onMSPointerDown=null,this._onMSPointerMove=null,this._onMSPointerUp=null,this._onMSPointerUpGlobal=null,this._onMSPointerOut=null,this._onMSPointerOver=null},U.MSPointer.prototype={start:function(){var e,t;null!==this._onMSPointerDown||(e=this).game.device.mspointer&&(this._onMSPointerDown=function(t){return e.onPointerDown(t)},this._onMSPointerMove=function(t){return e.onPointerMove(t)},this._onMSPointerUp=function(t){return e.onPointerUp(t)},this._onMSPointerUpGlobal=function(t){return e.onPointerUpGlobal(t)},this._onMSPointerOut=function(t){return e.onPointerOut(t)},this._onMSPointerOver=function(t){return e.onPointerOver(t)},(t=this.game.canvas).addEventListener("MSPointerDown",this._onMSPointerDown,!1),t.addEventListener("MSPointerMove",this._onMSPointerMove,!1),t.addEventListener("MSPointerUp",this._onMSPointerUp,!1),t.addEventListener("pointerdown",this._onMSPointerDown,!1),t.addEventListener("pointermove",this._onMSPointerMove,!1),t.addEventListener("pointerup",this._onMSPointerUp,!1),t.style["-ms-content-zooming"]="none",t.style["-ms-touch-action"]="none",this.game.device.cocoonJS||(window.addEventListener("MSPointerUp",this._onMSPointerUpGlobal,!0),t.addEventListener("MSPointerOver",this._onMSPointerOver,!0),t.addEventListener("MSPointerOut",this._onMSPointerOut,!0),window.addEventListener("pointerup",this._onMSPointerUpGlobal,!0),t.addEventListener("pointerover",this._onMSPointerOver,!0),t.addEventListener("pointerout",this._onMSPointerOut,!0)))},onPointerDown:function(t){this.event=t,this.capture&&t.preventDefault(),this.pointerDownCallback&&this.pointerDownCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=t.pointerId,"mouse"===t.pointerType||4===t.pointerType?this.input.mousePointer.start(t):this.input.startPointer(t))},onPointerMove:function(t){this.event=t,this.capture&&t.preventDefault(),this.pointerMoveCallback&&this.pointerMoveCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=t.pointerId,"mouse"===t.pointerType||4===t.pointerType?this.input.mousePointer.move(t):this.input.updatePointer(t))},onPointerUp:function(t){this.event=t,this.capture&&t.preventDefault(),this.pointerUpCallback&&this.pointerUpCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=t.pointerId,"mouse"===t.pointerType||4===t.pointerType?this.input.mousePointer.stop(t):this.input.stopPointer(t))},onPointerUpGlobal:function(t){var e;(!("mouse"!==t.pointerType&&4!==t.pointerType||this.input.mousePointer.withinGame)||(e=this.input.getPointerFromIdentifier(t.identifier))&&e.withinGame)&&this.onPointerUp(t)},onPointerOut:function(t){var e;this.event=t,this.capture&&t.preventDefault(),"mouse"===t.pointerType||4===t.pointerType?this.input.mousePointer.withinGame=!1:(e=this.input.getPointerFromIdentifier(t.identifier))&&(e.withinGame=!1),this.input.mouse.mouseOutCallback&&this.input.mouse.mouseOutCallback.call(this.input.mouse.callbackContext,t),this.input.enabled&&this.enabled&&this.input.mouse.stopOnGameOut&&(t.identifier=0,(e||this.input.mousePointer).stop(t))},onPointerOver:function(t){var e;this.event=t,this.capture&&t.preventDefault(),"mouse"===t.pointerType||4===t.pointerType?this.input.mousePointer.withinGame=!0:(e=this.input.getPointerFromIdentifier(t.identifier))&&(e.withinGame=!0),this.input.mouse.mouseOverCallback&&this.input.mouse.mouseOverCallback.call(this.input.mouse.callbackContext,t)},stop:function(){var t=this.game.canvas;t.removeEventListener("MSPointerDown",this._onMSPointerDown,!1),t.removeEventListener("MSPointerMove",this._onMSPointerMove,!1),t.removeEventListener("MSPointerUp",this._onMSPointerUp,!1),t.removeEventListener("pointerdown",this._onMSPointerDown,!1),t.removeEventListener("pointermove",this._onMSPointerMove,!1),t.removeEventListener("pointerup",this._onMSPointerUp,!1),window.removeEventListener("MSPointerUp",this._onMSPointerUpGlobal,!0),t.removeEventListener("MSPointerOver",this._onMSPointerOver,!0),t.removeEventListener("MSPointerOut",this._onMSPointerOut,!0),window.removeEventListener("pointerup",this._onMSPointerUpGlobal,!0),t.removeEventListener("pointerover",this._onMSPointerOver,!0),t.removeEventListener("pointerout",this._onMSPointerOut,!0)}},U.MSPointer.prototype.constructor=U.MSPointer,U.DeviceButton=function(t,e){this.parent=t,this.game=t.game,this.event=null,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.repeats=0,this.altKey=!1,this.shiftKey=!1,this.ctrlKey=!1,this.value=0,this.buttonCode=e,this.onDown=new U.Signal,this.onUp=new U.Signal,this.onFloat=new U.Signal},U.DeviceButton.prototype={start:function(t,e){this.isDown||(this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.repeats=0,this.event=t,this.value=e,t&&(this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.ctrlKey=t.ctrlKey),this.onDown.dispatch(this,e))},stop:function(t,e){this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.event=t,this.value=e,t&&(this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.ctrlKey=t.ctrlKey),this.onUp.dispatch(this,e))},padFloat:function(t){this.value=t,this.onFloat.dispatch(this,t)},justPressed:function(t){return t=t||250,this.isDown&&this.timeDown+t>this.game.time.time},justReleased:function(t){return t=t||250,this.isUp&&this.timeUp+t>this.game.time.time},reset:function(){this.isDown=!1,this.isUp=!0,this.timeDown=this.game.time.time,this.repeats=0,this.altKey=!1,this.shiftKey=!1,this.ctrlKey=!1},destroy:function(){this.onDown.dispose(),this.onUp.dispose(),this.onFloat.dispose(),this.parent=null,this.game=null}},U.DeviceButton.prototype.constructor=U.DeviceButton,Object.defineProperty(U.DeviceButton.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}}),U.Pointer=function(t,e,i){this.game=t,this.id=e,this.type=U.POINTER,this.exists=!0,this.identifier=0,this.pointerId=null,this.pointerMode=i||U.PointerMode.CURSOR|U.PointerMode.CONTACT,this.target=null,this.button=null,this.leftButton=new U.DeviceButton(this,U.Pointer.LEFT_BUTTON),this.middleButton=new U.DeviceButton(this,U.Pointer.MIDDLE_BUTTON),this.rightButton=new U.DeviceButton(this,U.Pointer.RIGHT_BUTTON),this.backButton=new U.DeviceButton(this,U.Pointer.BACK_BUTTON),this.forwardButton=new U.DeviceButton(this,U.Pointer.FORWARD_BUTTON),this.eraserButton=new U.DeviceButton(this,U.Pointer.ERASER_BUTTON),this._holdSent=!1,this._history=[],this._nextDrop=0,this._stateReset=!1,this.withinGame=!1,this.clientX=-1,this.clientY=-1,this.pageX=-1,this.pageY=-1,this.screenX=-1,this.screenY=-1,this.rawMovementX=0,this.rawMovementY=0,this.movementX=0,this.movementY=0,this.x=-1,this.y=-1,this.isMouse=0===e,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.previousTapTime=0,this.totalTouches=0,this.msSinceLastClick=Number.MAX_VALUE,this.targetObject=null,this.interactiveCandidates=[],this.active=!1,this.dirty=!1,this.position=new U.Point,this.positionDown=new U.Point,this.positionUp=new U.Point,this.circle=new U.Circle(0,0,44),this._clickTrampolines=null,this._trampolineTargetObject=null},U.Pointer.NO_BUTTON=0,U.Pointer.LEFT_BUTTON=1,U.Pointer.RIGHT_BUTTON=2,U.Pointer.MIDDLE_BUTTON=4,U.Pointer.BACK_BUTTON=8,U.Pointer.FORWARD_BUTTON=16,U.Pointer.ERASER_BUTTON=32,U.Pointer.prototype={resetButtons:function(){this.isDown=!1,this.isUp=!0,this.isMouse&&(this.leftButton.reset(),this.middleButton.reset(),this.rightButton.reset(),this.backButton.reset(),this.forwardButton.reset(),this.eraserButton.reset())},processButtonsDown:function(t,e){U.Pointer.LEFT_BUTTON&t&&this.leftButton.start(e),U.Pointer.RIGHT_BUTTON&t&&this.rightButton.start(e),U.Pointer.MIDDLE_BUTTON&t&&this.middleButton.start(e),U.Pointer.BACK_BUTTON&t&&this.backButton.start(e),U.Pointer.FORWARD_BUTTON&t&&this.forwardButton.start(e),U.Pointer.ERASER_BUTTON&t&&this.eraserButton.start(e)},processButtonsUp:function(t,e){t===U.Mouse.LEFT_BUTTON&&this.leftButton.stop(e),t===U.Mouse.RIGHT_BUTTON&&this.rightButton.stop(e),t===U.Mouse.MIDDLE_BUTTON&&this.middleButton.stop(e),t===U.Mouse.BACK_BUTTON&&this.backButton.stop(e),t===U.Mouse.FORWARD_BUTTON&&this.forwardButton.stop(e),5===t&&this.eraserButton.stop(e)},updateButtons:function(t){this.button=t.button;var e="down"===t.type.toLowerCase().substr(-4);void 0!==t.buttons?e?this.processButtonsDown(t.buttons,t):this.processButtonsUp(t.button,t):e?this.leftButton.start(t):(this.leftButton.stop(t),this.rightButton.stop(t)),1===t.buttons&&t.ctrlKey&&this.leftButton.isDown&&(this.leftButton.stop(t),this.rightButton.start(t)),this.isUp=!0,this.isDown=!1,(this.leftButton.isDown||this.rightButton.isDown||this.middleButton.isDown||this.backButton.isDown||this.forwardButton.isDown||this.eraserButton.isDown)&&(this.isUp=!1,this.isDown=!0)},start:function(t){var e=this.game.input;return t.pointerId&&(this.pointerId=t.pointerId),this.identifier=t.identifier,this.target=t.target,this.isMouse?this.updateButtons(t):(this.isDown=!0,this.isUp=!1),this.active=!0,this.withinGame=!0,this.dirty=!1,this._history=[],this._clickTrampolines=null,this._trampolineTargetObject=null,this.msSinceLastClick=this.game.time.time-this.timeDown,this.timeDown=this.game.time.time,this._holdSent=!1,this.move(t,!0),this.positionDown.setTo(this.x,this.y),(e.multiInputOverride===U.Input.MOUSE_OVERRIDES_TOUCH||e.multiInputOverride===U.Input.MOUSE_TOUCH_COMBINE||e.multiInputOverride===U.Input.TOUCH_OVERRIDES_MOUSE&&0===e.totalActivePointers)&&(e.x=this.x,e.y=this.y,e.position.setTo(this.x,this.y),e.onDown.dispatch(this,t),e.resetSpeed(this.x,this.y)),this._stateReset=!1,this.totalTouches++,null!==this.targetObject&&this.targetObject._touchedHandler(this),this},update:function(){var t=this.game.input;this.active&&(this.dirty&&(0<t.interactiveItems.total&&this.processInteractiveObjects(!1),this.dirty=!1),!1===this._holdSent&&this.duration>=t.holdRate&&((t.multiInputOverride===U.Input.MOUSE_OVERRIDES_TOUCH||t.multiInputOverride===U.Input.MOUSE_TOUCH_COMBINE||t.multiInputOverride===U.Input.TOUCH_OVERRIDES_MOUSE&&0===t.totalActivePointers)&&t.onHold.dispatch(this),this._holdSent=!0),t.recordPointerHistory&&this.game.time.time>=this._nextDrop&&(this._nextDrop=this.game.time.time+t.recordRate,this._history.push({x:this.position.x,y:this.position.y}),this._history.length>t.recordLimit&&this._history.shift()))},move:function(t,e){var i=this.game.input;if(!i.pollLocked){if(void 0===e&&(e=!1),void 0!==t.button&&(this.button=t.button),e&&this.isMouse&&this.updateButtons(t),this.clientX=t.clientX,this.clientY=t.clientY,this.pageX=t.pageX,this.pageY=t.pageY,this.screenX=t.screenX,this.screenY=t.screenY,this.isMouse&&i.mouse.locked&&!e&&(this.rawMovementX=t.movementX||t.mozMovementX||t.webkitMovementX||0,this.rawMovementY=t.movementY||t.mozMovementY||t.webkitMovementY||0,this.movementX+=this.rawMovementX,this.movementY+=this.rawMovementY),this.x=(this.pageX-this.game.scale.offset.x)*i.scale.x,this.y=(this.pageY-this.game.scale.offset.y)*i.scale.y,this.position.setTo(this.x,this.y),this.circle.x=this.x,this.circle.y=this.y,(i.multiInputOverride===U.Input.MOUSE_OVERRIDES_TOUCH||i.multiInputOverride===U.Input.MOUSE_TOUCH_COMBINE||i.multiInputOverride===U.Input.TOUCH_OVERRIDES_MOUSE&&0===i.totalActivePointers)&&(i.activePointer=this,i.x=this.x,i.y=this.y,i.position.setTo(i.x,i.y),i.circle.x=i.x,i.circle.y=i.y),this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY),this.game.paused)return this;for(var n=i.moveCallbacks.length;n--;)i.moveCallbacks[n].callback.call(i.moveCallbacks[n].context,this,this.x,this.y,e);return null!==this.targetObject&&!0===this.targetObject.isDragged?!1===this.targetObject.update(this)&&(this.targetObject=null):0<i.interactiveItems.total&&this.processInteractiveObjects(e),this}},processInteractiveObjects:function(t){var e=0,i=-1,n=null,r=this.game.input.interactiveItems.first;for(this.interactiveCandidates=[];r;)r.checked=!1,r.validForInput(i,e,!1)&&(r.checked=!0,(t&&r.checkPointerDown(this,!0)||!t&&r.checkPointerOver(this,!0))&&(e=r.sprite.renderOrderID,i=r.priorityID,n=r,this.interactiveCandidates.push(r))),r=this.game.input.interactiveItems.next;for(r=this.game.input.interactiveItems.first;r;)!r.checked&&r.validForInput(i,e,!0)&&(t&&r.checkPointerDown(this,!1)||!t&&r.checkPointerOver(this,!1))&&(e=r.sprite.renderOrderID,i=r.priorityID,n=r,this.interactiveCandidates.push(r)),r=this.game.input.interactiveItems.next;return this.game.input.customCandidateHandler&&(n=this.game.input.customCandidateHandler.call(this.game.input.customCandidateHandlerContext,this,this.interactiveCandidates,n)),this.swapTarget(n,!1),null!==this.targetObject},swapTarget:function(t,e){void 0===e&&(e=!1),null===t?this.targetObject&&(this.targetObject._pointerOutHandler(this,e),this.targetObject=null):null===this.targetObject?(this.targetObject=t)._pointerOverHandler(this,e):this.targetObject===t?!1===t.update(this)&&(this.targetObject=null):(this.targetObject._pointerOutHandler(this,e),this.targetObject=t,this.targetObject._pointerOverHandler(this,e))},leave:function(t){this.withinGame=!1,this.move(t,!1)},stop:function(t){var e=this.game.input;return this._stateReset&&this.withinGame?void t.preventDefault():(this.timeUp=this.game.time.time,(e.multiInputOverride===U.Input.MOUSE_OVERRIDES_TOUCH||e.multiInputOverride===U.Input.MOUSE_TOUCH_COMBINE||e.multiInputOverride===U.Input.TOUCH_OVERRIDES_MOUSE&&0===e.totalActivePointers)&&(e.onUp.dispatch(this,t),0<=this.duration&&this.duration<=e.tapRate&&(this.timeUp-this.previousTapTime<e.doubleTapRate?e.onTap.dispatch(this,!0):e.onTap.dispatch(this,!1),this.previousTapTime=this.timeUp)),this.isMouse?this.updateButtons(t):(this.isDown=!1,this.isUp=!0),0<this.id&&(this.active=!1),this.withinGame=this.game.scale.bounds.contains(t.pageX,t.pageY),this.pointerId=null,this.identifier=null,this.positionUp.setTo(this.x,this.y),!1===this.isMouse&&e.currentPointers--,e.interactiveItems.callAll("_releasedHandler",this),this._clickTrampolines&&(this._trampolineTargetObject=this.targetObject),this.targetObject=null,this)},justPressed:function(t){return t=t||this.game.input.justPressedRate,!0===this.isDown&&this.timeDown+t>this.game.time.time},justReleased:function(t){return t=t||this.game.input.justReleasedRate,this.isUp&&this.timeUp+t>this.game.time.time},addClickTrampoline:function(t,e,i,n){if(this.isDown){for(var r=this._clickTrampolines=this._clickTrampolines||[],s=0;s<r.length;s++)if(r[s].name===t){r.splice(s,1);break}r.push({name:t,targetObject:this.targetObject,callback:e,callbackContext:i,callbackArgs:n})}},processClickTrampolines:function(){var t=this._clickTrampolines;if(t){for(var e=0;e<t.length;e++){var i=t[e];i.targetObject===this._trampolineTargetObject&&i.callback.apply(i.callbackContext,i.callbackArgs)}this._clickTrampolines=null,this._trampolineTargetObject=null}},reset:function(){!1===this.isMouse&&(this.active=!1),this.pointerId=null,this.identifier=null,this.dirty=!1,this.totalTouches=0,this._holdSent=!1,this._history.length=0,this._stateReset=!0,this.resetButtons(),this.targetObject&&this.targetObject._releasedHandler(this),this.targetObject=null},resetMovement:function(){this.movementX=0,this.movementY=0}},U.Pointer.prototype.constructor=U.Pointer,Object.defineProperty(U.Pointer.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}}),Object.defineProperty(U.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}}),Object.defineProperty(U.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}}),U.PointerMode={CURSOR:1,CONTACT:2},U.Touch=function(t){this.game=t,this.enabled=!0,this.touchLockCallbacks=[],this.callbackContext=this.game,this.touchStartCallback=null,this.touchMoveCallback=null,this.touchEndCallback=null,this.touchEnterCallback=null,this.touchLeaveCallback=null,this.touchCancelCallback=null,this.preventDefault=!0,this.event=null,this._onTouchStart=null,this._onTouchMove=null,this._onTouchEnd=null,this._onTouchEnter=null,this._onTouchLeave=null,this._onTouchCancel=null,this._onTouchMove=null},U.Touch.prototype={start:function(){var e;null!==this._onTouchStart||(e=this).game.device.touch&&(this._onTouchStart=function(t){return e.onTouchStart(t)},this._onTouchMove=function(t){return e.onTouchMove(t)},this._onTouchEnd=function(t){return e.onTouchEnd(t)},this._onTouchEnter=function(t){return e.onTouchEnter(t)},this._onTouchLeave=function(t){return e.onTouchLeave(t)},this._onTouchCancel=function(t){return e.onTouchCancel(t)},this.game.canvas.addEventListener("touchstart",this._onTouchStart,!1),this.game.canvas.addEventListener("touchmove",this._onTouchMove,!1),this.game.canvas.addEventListener("touchend",this._onTouchEnd,!1),this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,!1),this.game.device.cocoonJS||(this.game.canvas.addEventListener("touchenter",this._onTouchEnter,!1),this.game.canvas.addEventListener("touchleave",this._onTouchLeave,!1)))},consumeDocumentTouches:function(){this._documentTouchMove=function(t){t.preventDefault()},document.addEventListener("touchmove",this._documentTouchMove,!1)},addTouchLockCallback:function(t,e,i){void 0===i&&(i=!1),this.touchLockCallbacks.push({callback:t,context:e,onEnd:i})},removeTouchLockCallback:function(t,e){for(var i=this.touchLockCallbacks.length;i--;)if(this.touchLockCallbacks[i].callback===t&&this.touchLockCallbacks[i].context===e)return this.touchLockCallbacks.splice(i,1),!0;return!1},onTouchStart:function(t){for(var e=this.touchLockCallbacks.length;e--;){var i=this.touchLockCallbacks[e];!i.onEnd&&i.callback.call(i.context,this,t)&&this.touchLockCallbacks.splice(e,1)}if(this.event=t,this.game.input.enabled&&this.enabled){this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,t),this.preventDefault&&t.preventDefault();for(e=0;e<t.changedTouches.length;e++)this.game.input.startPointer(t.changedTouches[e])}},onTouchCancel:function(t){if(this.event=t,this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,t),this.game.input.enabled&&this.enabled){this.preventDefault&&t.preventDefault();for(var e=0;e<t.changedTouches.length;e++)this.game.input.stopPointer(t.changedTouches[e])}},onTouchEnter:function(t){this.event=t,this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,t),this.game.input.enabled&&this.enabled&&this.preventDefault&&t.preventDefault()},onTouchLeave:function(t){this.event=t,this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,t),this.preventDefault&&t.preventDefault()},onTouchMove:function(t){this.event=t,this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,t),this.preventDefault&&t.preventDefault();for(var e=0;e<t.changedTouches.length;e++)this.game.input.updatePointer(t.changedTouches[e])},onTouchEnd:function(t){for(var e=this.touchLockCallbacks.length;e--;){var i=this.touchLockCallbacks[e];i.onEnd&&i.callback.call(i.context,this,t)&&this.touchLockCallbacks.splice(e,1)}this.event=t,this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,t),this.preventDefault&&t.preventDefault();for(e=0;e<t.changedTouches.length;e++)this.game.input.stopPointer(t.changedTouches[e])},stop:function(){this.game.device.touch&&(this.game.canvas.removeEventListener("touchstart",this._onTouchStart),this.game.canvas.removeEventListener("touchmove",this._onTouchMove),this.game.canvas.removeEventListener("touchend",this._onTouchEnd),this.game.canvas.removeEventListener("touchenter",this._onTouchEnter),this.game.canvas.removeEventListener("touchleave",this._onTouchLeave),this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel))}},U.Touch.prototype.constructor=U.Touch,U.InputHandler=function(t){this.sprite=t,this.game=t.game,this.enabled=!1,this.checked=!1,this.priorityID=0,this.useHandCursor=!1,this._setHandCursor=!1,this.isDragged=!1,this.allowHorizontalDrag=!0,this.allowVerticalDrag=!0,this.bringToTop=!1,this.snapOffset=null,this.snapOnDrag=!1,this.snapOnRelease=!1,this.snapX=0,this.snapY=0,this.snapOffsetX=0,this.snapOffsetY=0,this.pixelPerfectOver=!1,this.pixelPerfectClick=!1,this.pixelPerfectAlpha=255,this.draggable=!1,this.boundsRect=null,this.boundsSprite=null,this.scaleLayer=!1,this.dragOffset=new U.Point,this.dragFromCenter=!1,this.dragStopBlocksInputUp=!1,this.dragStartPoint=new U.Point,this.dragDistanceThreshold=0,this.dragTimeThreshold=0,this.downPoint=new U.Point,this.snapPoint=new U.Point,this._dragPoint=new U.Point,this._dragPhase=!1,this._pendingDrag=!1,this._dragTimePass=!1,this._dragDistancePass=!1,this._wasEnabled=!1,this._tempPoint=new U.Point,this._pointerData=[],this._pointerData.push({id:0,x:0,y:0,camX:0,camY:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1})},U.InputHandler.prototype={start:function(t,e){if(t=t||0,void 0===e&&(e=!1),!1===this.enabled){this.game.input.interactiveItems.add(this),this.useHandCursor=e,this.priorityID=t;for(var i=0;i<10;i++)this._pointerData[i]={id:i,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1};this.snapOffset=new U.Point,this.enabled=!0,this._wasEnabled=!0}return this.sprite.events.onAddedToGroup.add(this.addedToGroup,this),this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this),this.sprite},addedToGroup:function(){this._dragPhase||this._wasEnabled&&!this.enabled&&this.start()},removedFromGroup:function(){this._dragPhase||(this.enabled?(this._wasEnabled=!0,this.stop()):this._wasEnabled=!1)},reset:function(){this.enabled=!1;for(var t=0;t<10;t++)this._pointerData[t]={id:t,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1}},stop:function(){!1!==this.enabled&&(this.enabled=!1,this.game.input.interactiveItems.remove(this))},destroy:function(){this.sprite&&(this._setHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.enabled=!1,this.game.input.interactiveItems.remove(this),this._pointerData.length=0,this.boundsRect=null,this.boundsSprite=null,this.sprite=null)},validForInput:function(t,e,i){return void 0===i&&(i=!0),!(!this.enabled||0===this.sprite.scale.x||0===this.sprite.scale.y||this.priorityID<this.game.input.minPriorityID||this.sprite.parent&&this.sprite.parent.ignoreChildInput||!i&&(this.pixelPerfectClick||this.pixelPerfectOver)||!(this.priorityID>t||this.priorityID===t&&this.sprite.renderOrderID>e))},isPixelPerfect:function(){return this.pixelPerfectClick||this.pixelPerfectOver},pointerX:function(t){return t=t||0,this._pointerData[t].x},pointerY:function(t){return t=t||0,this._pointerData[t].y},pointerDown:function(t){return t=t||0,this._pointerData[t].isDown},pointerUp:function(t){return t=t||0,this._pointerData[t].isUp},pointerTimeDown:function(t){return t=t||0,this._pointerData[t].timeDown},pointerTimeUp:function(t){return t=t||0,this._pointerData[t].timeUp},pointerOver:function(t){if(!this.enabled)return!1;if(void 0!==t)return this._pointerData[t].isOver;for(var e=0;e<10;e++)if(this._pointerData[e].isOver)return!0;return!1},pointerOut:function(t){if(!this.enabled)return!1;if(void 0!==t)return this._pointerData[t].isOut;for(var e=0;e<10;e++)if(this._pointerData[e].isOut)return!0},pointerTimeOver:function(t){return t=t||0,this._pointerData[t].timeOver},pointerTimeOut:function(t){return t=t||0,this._pointerData[t].timeOut},pointerDragged:function(t){return t=t||0,this._pointerData[t].isDragged},checkPointerDown:function(t,e){return!!(t.isDown&&this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&0!==this.sprite.worldScale.x&&0!==this.sprite.worldScale.y)&&!!this.game.input.hitTest(this.sprite,t,this._tempPoint)&&(void 0===e&&(e=!1),!(!e&&this.pixelPerfectClick)||this.checkPixel(this._tempPoint.x,this._tempPoint.y))},checkPointerOver:function(t,e){return!!(this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&0!==this.sprite.worldScale.x&&0!==this.sprite.worldScale.y)&&!!this.game.input.hitTest(this.sprite,t,this._tempPoint)&&(void 0===e&&(e=!1),!(!e&&this.pixelPerfectOver)||this.checkPixel(this._tempPoint.x,this._tempPoint.y))},checkPixel:function(t,e,i){if(this.sprite.texture.baseTexture.source){if(null===t&&null===e&&(this.game.input.getLocalPosition(this.sprite,i,this._tempPoint),t=this._tempPoint.x,e=this._tempPoint.y),0!==this.sprite.anchor.x&&(t-=-this.sprite.texture.frame.width*this.sprite.anchor.x),0!==this.sprite.anchor.y&&(e-=-this.sprite.texture.frame.height*this.sprite.anchor.y),t+=this.sprite.texture.frame.x,e+=this.sprite.texture.frame.y,this.sprite.texture.trim&&(t-=this.sprite.texture.trim.x,e-=this.sprite.texture.trim.y,t<this.sprite.texture.crop.x||t>this.sprite.texture.crop.right||e<this.sprite.texture.crop.y||e>this.sprite.texture.crop.bottom))return this._dx=t,this._dy=e,!1;if(this._dx=t,this._dy=e,this.game.input.hitContext.clearRect(0,0,1,1),this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,t,e,1,1,0,0,1,1),this.game.input.hitContext.getImageData(0,0,1,1).data[3]>=this.pixelPerfectAlpha)return!0}return!1},update:function(t){if(null!==this.sprite&&void 0!==this.sprite.parent)return this.enabled&&this.sprite.visible&&this.sprite.parent.visible?this._pendingDrag?(this._dragDistancePass||(this._dragDistancePass=U.Math.distance(t.x,t.y,this.downPoint.x,this.downPoint.y)>=this.dragDistanceThreshold),this._dragDistancePass&&this._dragTimePass&&this.startDrag(t),!0):this.draggable&&this._draggedPointerID===t.id?this.updateDrag(t,!1):this._pointerData[t.id].isOver?this.checkPointerOver(t)?(this._pointerData[t.id].x=t.x-this.sprite.x,this._pointerData[t.id].y=t.y-this.sprite.y,!0):(this._pointerOutHandler(t),!1):void 0:(this._pointerOutHandler(t),!1)},_pointerOverHandler:function(t,e){var i,n;null!==this.sprite&&(!1!==(i=this._pointerData[t.id]).isOver&&!t.dirty||(n=!1===i.isOver,i.isOver=!0,i.isOut=!1,i.timeOver=this.game.time.time,i.x=t.x-this.sprite.x,i.y=t.y-this.sprite.y,this.useHandCursor&&!1===i.isDragged&&(this.game.canvas.style.cursor="pointer",this._setHandCursor=!0),!e&&n&&this.sprite&&this.sprite.events&&this.sprite.events.onInputOver$dispatch(this.sprite,t),this.sprite.parent&&this.sprite.parent.type===U.GROUP&&this.sprite.parent.onChildInputOver.dispatch(this.sprite,t)))},_pointerOutHandler:function(t,e){var i;null!==this.sprite&&((i=this._pointerData[t.id]).isOver=!1,i.isOut=!0,i.timeOut=this.game.time.time,this.useHandCursor&&!1===i.isDragged&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),!e&&this.sprite&&this.sprite.events&&(this.sprite.events.onInputOut$dispatch(this.sprite,t),this.sprite&&this.sprite.parent&&this.sprite.parent.type===U.GROUP&&this.sprite.parent.onChildInputOut.dispatch(this.sprite,t)))},_touchedHandler:function(t){var e;null===this.sprite||!(e=this._pointerData[t.id]).isDown&&e.isOver&&(this.pixelPerfectClick&&!this.checkPixel(null,null,t)||(e.isDown=!0,e.isUp=!1,e.timeDown=this.game.time.time,this.downPoint.set(t.x,t.y),t.dirty=!0,this.sprite&&this.sprite.events&&(this.sprite.events.onInputDown$dispatch(this.sprite,t),this.sprite&&this.sprite.parent&&this.sprite.parent.type===U.GROUP&&this.sprite.parent.onChildInputDown.dispatch(this.sprite,t),null===this.sprite)||(this.draggable&&!1===this.isDragged&&(0===this.dragTimeThreshold&&0===this.dragDistanceThreshold?this.startDrag(t):(this._pendingDrag=!0,this._dragDistancePass=0===this.dragDistanceThreshold,0<this.dragTimeThreshold?(this._dragTimePass=!1,this.game.time.events.add(this.dragTimeThreshold,this.dragTimeElapsed,this,t)):this._dragTimePass=!0)),this.bringToTop&&this.sprite.bringToTop())))},dragTimeElapsed:function(t){this._dragTimePass=!0,this._pendingDrag&&this.sprite&&this._dragDistancePass&&this.startDrag(t)},_releasedHandler:function(t){var e,i;null===this.sprite||(e=this._pointerData[t.id]).isDown&&t.isUp&&(e.isDown=!1,e.isUp=!0,e.timeUp=this.game.time.time,e.downDuration=e.timeUp-e.timeDown,i=this.checkPointerOver(t),this.sprite&&this.sprite.events&&(this.dragStopBlocksInputUp&&(!this.dragStopBlocksInputUp||this.draggable&&this.isDragged&&this._draggedPointerID===t.id)||this.sprite.events.onInputUp$dispatch(this.sprite,t,i),this.sprite&&this.sprite.parent&&this.sprite.parent.type===U.GROUP&&this.sprite.parent.onChildInputUp.dispatch(this.sprite,t,i),i=i&&this.checkPointerOver(t)),!(e.isOver=i)&&this.useHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),t.dirty=!0,this._pendingDrag=!1,this.draggable&&this.isDragged&&this._draggedPointerID===t.id&&this.stopDrag(t))},updateDrag:function(t,e){if(void 0===e&&(e=!1),t.isUp)return this.stopDrag(t),!1;var i,n,r=this.globalToLocalX(t.x)+this._dragPoint.x+this.dragOffset.x,s=this.globalToLocalY(t.y)+this._dragPoint.y+this.dragOffset.y;return this.sprite.fixedToCamera?(this.allowHorizontalDrag&&(this.sprite.cameraOffset.x=r),this.allowVerticalDrag&&(this.sprite.cameraOffset.y=s),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY,this.snapPoint.set(this.sprite.cameraOffset.x,this.sprite.cameraOffset.y))):(i=this.game.camera.x-this._pointerData[t.id].camX,n=this.game.camera.y-this._pointerData[t.id].camY,this.allowHorizontalDrag&&(this.sprite.x=r+i),this.allowVerticalDrag&&(this.sprite.y=s+n),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY,this.snapPoint.set(this.sprite.x,this.sprite.y))),this.sprite.events.onDragUpdate.dispatch(this.sprite,t,r,s,this.snapPoint,e),!0},justOver:function(t,e){return t=t||0,e=e||500,this._pointerData[t].isOver&&this.overDuration(t)<e},justOut:function(t,e){return t=t||0,e=e||500,this._pointerData[t].isOut&&this.game.time.time-this._pointerData[t].timeOut<e},justPressed:function(t,e){return t=t||0,e=e||500,this._pointerData[t].isDown&&this.downDuration(t)<e},justReleased:function(t,e){return t=t||0,e=e||500,this._pointerData[t].isUp&&this.game.time.time-this._pointerData[t].timeUp<e},overDuration:function(t){return t=t||0,this._pointerData[t].isOver?this.game.time.time-this._pointerData[t].timeOver:-1},downDuration:function(t){return t=t||0,this._pointerData[t].isDown?this.game.time.time-this._pointerData[t].timeDown:-1},enableDrag:function(t,e,i,n,r,s){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===n&&(n=255),void 0===r&&(r=null),void 0===s&&(s=null),this._dragPoint=new U.Point,this.draggable=!0,this.bringToTop=e,this.dragOffset=new U.Point,this.dragFromCenter=t,this.pixelPerfectClick=i,this.pixelPerfectAlpha=n,r&&(this.boundsRect=r),s&&(this.boundsSprite=s)},disableDrag:function(){if(this._pointerData)for(var t=0;t<10;t++)this._pointerData[t].isDragged=!1;this.draggable=!1,this.isDragged=!1,this._draggedPointerID=-1,this._pendingDrag=!1},startDrag:function(t){var e,i=this.sprite.x,n=this.sprite.y;this.isDragged=!0,this._draggedPointerID=t.id,this._pointerData[t.id].camX=this.game.camera.x,this._pointerData[t.id].camY=this.game.camera.y,this._pointerData[t.id].isDragged=!0,this.sprite.fixedToCamera?(this.dragFromCenter&&(e=this.sprite.getBounds(),this.sprite.cameraOffset.x=this.globalToLocalX(t.x)+(this.sprite.cameraOffset.x-e.centerX),this.sprite.cameraOffset.y=this.globalToLocalY(t.y)+(this.sprite.cameraOffset.y-e.centerY)),this._dragPoint.setTo(this.sprite.cameraOffset.x-t.x,this.sprite.cameraOffset.y-t.y)):(this.dragFromCenter&&(e=this.sprite.getBounds(),this.sprite.x=this.globalToLocalX(t.x)+(this.sprite.x-e.centerX),this.sprite.y=this.globalToLocalY(t.y)+(this.sprite.y-e.centerY)),this._dragPoint.setTo(this.sprite.x-this.globalToLocalX(t.x),this.sprite.y-this.globalToLocalY(t.y))),this.updateDrag(t,!0),this.bringToTop&&(this._dragPhase=!0,this.sprite.bringToTop()),this.dragStartPoint.set(i,n),this.sprite.events.onDragStart$dispatch(this.sprite,t,i,n),this._pendingDrag=!1},globalToLocalX:function(t){return this.scaleLayer&&(t-=this.game.scale.grid.boundsFluid.x,t*=this.game.scale.grid.scaleFluidInversed.x),t},globalToLocalY:function(t){return this.scaleLayer&&(t-=this.game.scale.grid.boundsFluid.y,t*=this.game.scale.grid.scaleFluidInversed.y),t},stopDrag:function(t){this.isDragged=!1,this._draggedPointerID=-1,this._pointerData[t.id].isDragged=!1,this._dragPhase=!1,this._pendingDrag=!1,this.snapOnRelease&&(this.sprite.fixedToCamera?(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY):(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)),this.sprite.events.onDragStop$dispatch(this.sprite,t),!1===this.checkPointerOver(t)&&this._pointerOutHandler(t)},setDragLock:function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0),this.allowHorizontalDrag=t,this.allowVerticalDrag=e},enableSnap:function(t,e,i,n,r,s){void 0===i&&(i=!0),void 0===n&&(n=!1),void 0===r&&(r=0),void 0===s&&(s=0),this.snapX=t,this.snapY=e,this.snapOffsetX=r,this.snapOffsetY=s,this.snapOnDrag=i,this.snapOnRelease=n},disableSnap:function(){this.snapOnDrag=!1,this.snapOnRelease=!1},checkBoundsRect:function(){this.sprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsRect.left?this.sprite.cameraOffset.x=this.boundsRect.left:this.sprite.cameraOffset.x+this.sprite.width>this.boundsRect.right&&(this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width),this.sprite.cameraOffset.y<this.boundsRect.top?this.sprite.cameraOffset.y=this.boundsRect.top:this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height)):(this.sprite.left<this.boundsRect.left?this.sprite.x=this.boundsRect.x+this.sprite.offsetX:this.sprite.right>this.boundsRect.right&&(this.sprite.x=this.boundsRect.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsRect.top?this.sprite.y=this.boundsRect.top+this.sprite.offsetY:this.sprite.bottom>this.boundsRect.bottom&&(this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)))},checkBoundsSprite:function(){this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x?this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x:this.sprite.cameraOffset.x+this.sprite.width>this.boundsSprite.cameraOffset.x+this.boundsSprite.width&&(this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x+this.boundsSprite.width-this.sprite.width),this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y?this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y:this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.cameraOffset.y+this.boundsSprite.height&&(this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y+this.boundsSprite.height-this.sprite.height)):(this.sprite.left<this.boundsSprite.left?this.sprite.x=this.boundsSprite.left+this.sprite.offsetX:this.sprite.right>this.boundsSprite.right&&(this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsSprite.top?this.sprite.y=this.boundsSprite.top+this.sprite.offsetY:this.sprite.bottom>this.boundsSprite.bottom&&(this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)))}},U.InputHandler.prototype.constructor=U.InputHandler,U.Gamepad=function(t){this.game=t,this._gamepadIndexMap={},this._rawPads=[],this._active=!1,this.enabled=!0,this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||-1!==navigator.userAgent.indexOf("Firefox/")||!!navigator.getGamepads,this._prevRawGamepadTypes=[],this._prevTimestamps=[],(this.callbackContext=this).onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this._ongamepadconnected=null,this._gamepaddisconnected=null,this._gamepads=[new U.SinglePad(t,this),new U.SinglePad(t,this),new U.SinglePad(t,this),new U.SinglePad(t,this)]},U.Gamepad.prototype={addCallbacks:function(t,e){void 0!==e&&(this.onConnectCallback="function"==typeof e.onConnect?e.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof e.onDisconnect?e.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof e.onDown?e.onDown:this.onDownCallback,this.onUpCallback="function"==typeof e.onUp?e.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof e.onAxis?e.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof e.onFloat?e.onFloat:this.onFloatCallback,this.callbackContext=t)},start:function(){var e;this._active||(this._active=!0,(e=this)._onGamepadConnected=function(t){return e.onGamepadConnected(t)},this._onGamepadDisconnected=function(t){return e.onGamepadDisconnected(t)},window.addEventListener("gamepadconnected",this._onGamepadConnected,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,!1))},onGamepadConnected:function(t){t=t.gamepad;this._rawPads.push(t),this._gamepads[t.index].connect(t)},onGamepadDisconnected:function(t){var e,i=t.gamepad;for(e in this._rawPads)this._rawPads[e].index===i.index&&this._rawPads.splice(e,1);this._gamepads[i.index].disconnect()},update:function(){this._pollGamepads(),this.pad1.pollStatus(),this.pad2.pollStatus(),this.pad3.pollStatus(),this.pad4.pollStatus()},_pollGamepads:function(){var t;if(this._active&&(navigator.getGamepads?t=navigator.getGamepads():navigator.webkitGetGamepads?t=navigator.webkitGetGamepads():navigator.webkitGamepads&&(t=navigator.webkitGamepads()),t)){for(var e=!(this._rawPads=[]),i=0;i<t.length&&(typeof t[i]!==this._prevRawGamepadTypes[i]&&(e=!0,this._prevRawGamepadTypes[i]=typeof t[i]),t[i]&&this._rawPads.push(t[i]),3!==i);i++);for(var n=0;n<this._gamepads.length;n++)this._gamepads[n]._rawPad=this._rawPads[n];if(e){for(var r,s={rawIndices:{},padIndices:{}},o=0;o<this._gamepads.length;o++)if((r=this._gamepads[o]).connected)for(var a=0;a<this._rawPads.length;a++)this._rawPads[a].index===r.index&&(s.rawIndices[r.index]=!0,s.padIndices[o]=!0);for(var l=0;l<this._gamepads.length;l++)if(r=this._gamepads[l],!s.padIndices[l]){this._rawPads.length<1&&r.disconnect();for(var p=0;p<this._rawPads.length&&!s.padIndices[l];p++){var h=this._rawPads[p];!h||s.rawIndices[h.index]?r.disconnect():(r.connect(h),s.rawIndices[h.index]=!0,s.padIndices[l]=!0)}}}}},setDeadZones:function(t){for(var e=0;e<this._gamepads.length;e++)this._gamepads[e].deadZone=t},stop:function(){this._active=!1,window.removeEventListener("gamepadconnected",this._onGamepadConnected),window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},reset:function(){this.update();for(var t=0;t<this._gamepads.length;t++)this._gamepads[t].reset()},justPressed:function(t,e){for(var i=0;i<this._gamepads.length;i++)if(!0===this._gamepads[i].justPressed(t,e))return!0;return!1},justReleased:function(t,e){for(var i=0;i<this._gamepads.length;i++)if(!0===this._gamepads[i].justReleased(t,e))return!0;return!1},isDown:function(t){for(var e=0;e<this._gamepads.length;e++)if(!0===this._gamepads[e].isDown(t))return!0;return!1},destroy:function(){this.stop();for(var t=0;t<this._gamepads.length;t++)this._gamepads[t].destroy()}},U.Gamepad.prototype.constructor=U.Gamepad,Object.defineProperty(U.Gamepad.prototype,"active",{get:function(){return this._active}}),Object.defineProperty(U.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}}),Object.defineProperty(U.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}}),Object.defineProperty(U.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}}),Object.defineProperty(U.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}}),Object.defineProperty(U.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}}),Object.defineProperty(U.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}}),U.Gamepad.BUTTON_0=0,U.Gamepad.BUTTON_1=1,U.Gamepad.BUTTON_2=2,U.Gamepad.BUTTON_3=3,U.Gamepad.BUTTON_4=4,U.Gamepad.BUTTON_5=5,U.Gamepad.BUTTON_6=6,U.Gamepad.BUTTON_7=7,U.Gamepad.BUTTON_8=8,U.Gamepad.BUTTON_9=9,U.Gamepad.BUTTON_10=10,U.Gamepad.BUTTON_11=11,U.Gamepad.BUTTON_12=12,U.Gamepad.BUTTON_13=13,U.Gamepad.BUTTON_14=14,U.Gamepad.BUTTON_15=15,U.Gamepad.AXIS_0=0,U.Gamepad.AXIS_1=1,U.Gamepad.AXIS_2=2,U.Gamepad.AXIS_3=3,U.Gamepad.AXIS_4=4,U.Gamepad.AXIS_5=5,U.Gamepad.AXIS_6=6,U.Gamepad.AXIS_7=7,U.Gamepad.AXIS_8=8,U.Gamepad.AXIS_9=9,U.Gamepad.XBOX360_A=0,U.Gamepad.XBOX360_B=1,U.Gamepad.XBOX360_X=2,U.Gamepad.XBOX360_Y=3,U.Gamepad.XBOX360_LEFT_BUMPER=4,U.Gamepad.XBOX360_RIGHT_BUMPER=5,U.Gamepad.XBOX360_LEFT_TRIGGER=6,U.Gamepad.XBOX360_RIGHT_TRIGGER=7,U.Gamepad.XBOX360_BACK=8,U.Gamepad.XBOX360_START=9,U.Gamepad.XBOX360_STICK_LEFT_BUTTON=10,U.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11,U.Gamepad.XBOX360_DPAD_LEFT=14,U.Gamepad.XBOX360_DPAD_RIGHT=15,U.Gamepad.XBOX360_DPAD_UP=12,U.Gamepad.XBOX360_DPAD_DOWN=13,U.Gamepad.XBOX360_STICK_LEFT_X=0,U.Gamepad.XBOX360_STICK_LEFT_Y=1,U.Gamepad.XBOX360_STICK_RIGHT_X=2,U.Gamepad.XBOX360_STICK_RIGHT_Y=3,U.Gamepad.PS3XC_X=0,U.Gamepad.PS3XC_CIRCLE=1,U.Gamepad.PS3XC_SQUARE=2,U.Gamepad.PS3XC_TRIANGLE=3,U.Gamepad.PS3XC_L1=4,U.Gamepad.PS3XC_R1=5,U.Gamepad.PS3XC_L2=6,U.Gamepad.PS3XC_R2=7,U.Gamepad.PS3XC_SELECT=8,U.Gamepad.PS3XC_START=9,U.Gamepad.PS3XC_STICK_LEFT_BUTTON=10,U.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11,U.Gamepad.PS3XC_DPAD_UP=12,U.Gamepad.PS3XC_DPAD_DOWN=13,U.Gamepad.PS3XC_DPAD_LEFT=14,U.Gamepad.PS3XC_DPAD_RIGHT=15,U.Gamepad.PS3XC_STICK_LEFT_X=0,U.Gamepad.PS3XC_STICK_LEFT_Y=1,U.Gamepad.PS3XC_STICK_RIGHT_X=2,U.Gamepad.PS3XC_STICK_RIGHT_Y=3,U.SinglePad=function(t,e){this.game=t,this.index=null,this.connected=!1,(this.callbackContext=this).onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this.deadZone=.26,this._padParent=e,this._rawPad=null,this._prevTimestamp=null,this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0},U.SinglePad.prototype={addCallbacks:function(t,e){void 0!==e&&(this.onConnectCallback="function"==typeof e.onConnect?e.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof e.onDisconnect?e.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof e.onDown?e.onDown:this.onDownCallback,this.onUpCallback="function"==typeof e.onUp?e.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof e.onAxis?e.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof e.onFloat?e.onFloat:this.onFloatCallback,this.callbackContext=t)},getButton:function(t){return this._buttons[t]||null},pollStatus:function(){if(this.connected&&this.game.input.enabled&&this.game.input.gamepad.enabled&&(!this._rawPad.timestamp||this._rawPad.timestamp!==this._prevTimestamp)){for(var t=0;t<this._buttonsLen;t++){var e=isNaN(this._rawPad.buttons[t])?this._rawPad.buttons[t].value:this._rawPad.buttons[t];e!==this._buttons[t].value&&(1===e?this.processButtonDown(t,e):0===e?this.processButtonUp(t,e):this.processButtonFloat(t,e))}for(var i=0;i<this._axesLen;i++){var n=this._rawPad.axes[i];0<n&&n>this.deadZone||n<0&&n<-this.deadZone?this.processAxisChange(i,n):this.processAxisChange(i,0)}this._prevTimestamp=this._rawPad.timestamp}},connect:function(t){var e=!this.connected;this.connected=!0,this.index=t.index,this._rawPad=t,this._buttons=[],this._buttonsLen=t.buttons.length,this._axes=[],this._axesLen=t.axes.length;for(var i,n=0;n<this._axesLen;n++)this._axes[n]=t.axes[n];for(i in t.buttons)i=parseInt(i,10),this._buttons[i]=new U.DeviceButton(this,i);e&&this._padParent.onConnectCallback&&this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index),e&&this.onConnectCallback&&this.onConnectCallback.call(this.callbackContext)},disconnect:function(){var t=this.connected,e=this.index;this.connected=!1,this.index=null,this._rawPad=void 0;for(var i=0;i<this._buttonsLen;i++)this._buttons[i].destroy();this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0,t&&this._padParent.onDisconnectCallback&&this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,e),t&&this.onDisconnectCallback&&this.onDisconnectCallback.call(this.callbackContext)},destroy:function(){this._rawPad=void 0;for(var t=0;t<this._buttonsLen;t++)this._buttons[t].destroy();this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null},processAxisChange:function(t,e){this._axes[t]!==e&&(this._axes[t]=e,this._padParent.onAxisCallback&&this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,t,e),this.onAxisCallback&&this.onAxisCallback.call(this.callbackContext,this,t,e))},processButtonDown:function(t,e){this._buttons[t]&&this._buttons[t].start(null,e),this._padParent.onDownCallback&&this._padParent.onDownCallback.call(this._padParent.callbackContext,t,e,this.index),this.onDownCallback&&this.onDownCallback.call(this.callbackContext,t,e)},processButtonUp:function(t,e){this._padParent.onUpCallback&&this._padParent.onUpCallback.call(this._padParent.callbackContext,t,e,this.index),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,t,e),this._buttons[t]&&this._buttons[t].stop(null,e)},processButtonFloat:function(t,e){this._padParent.onFloatCallback&&this._padParent.onFloatCallback.call(this._padParent.callbackContext,t,e,this.index),this.onFloatCallback&&this.onFloatCallback.call(this.callbackContext,t,e),this._buttons[t]&&this._buttons[t].padFloat(e)},axis:function(t){return!!this._axes[t]&&this._axes[t]},isDown:function(t){return!!this._buttons[t]&&this._buttons[t].isDown},isUp:function(t){return!!this._buttons[t]&&this._buttons[t].isUp},justReleased:function(t,e){if(this._buttons[t])return this._buttons[t].justReleased(e)},justPressed:function(t,e){if(this._buttons[t])return this._buttons[t].justPressed(e)},buttonValue:function(t){return this._buttons[t]?this._buttons[t].value:null},reset:function(){for(var t=0;t<this._axes.length;t++)this._axes[t]=0}},U.SinglePad.prototype.constructor=U.SinglePad,U.Key=function(t,e){this.game=t,this._enabled=!0,this.event=null,this.isDown=!1,this.isUp=!0,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.timeDown=0,this.duration=0,this.timeUp=-2500,this.repeats=0,this.keyCode=e,this.onDown=new U.Signal,this.onHoldCallback=null,this.onHoldContext=null,this.onUp=new U.Signal,this._justDown=!1,this._justUp=!1},U.Key.prototype={update:function(){this._enabled&&this.isDown&&(this.duration=this.game.time.time-this.timeDown,this.repeats++,this.onHoldCallback&&this.onHoldCallback.call(this.onHoldContext,this))},processKeyDown:function(t){this._enabled&&(this.event=t,this.isDown||(this.altKey=t.altKey,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.duration=0,this.repeats=0,this._justDown=!0,this.onDown.dispatch(this)))},processKeyUp:function(t){this._enabled&&(this.event=t,this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=this.game.time.time-this.timeDown,this._justUp=!0,this.onUp.dispatch(this)))},reset:function(t){void 0===t&&(t=!0),this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=0,this._enabled=!0,this._justDown=!1,this._justUp=!1,t&&(this.onDown.removeAll(),this.onUp.removeAll(),this.onHoldCallback=null,this.onHoldContext=null)},downDuration:function(t){return void 0===t&&(t=50),this.isDown&&this.duration<t},upDuration:function(t){return void 0===t&&(t=50),!this.isDown&&this.game.time.time-this.timeUp<t}},Object.defineProperty(U.Key.prototype,"justDown",{get:function(){var t=this._justDown;return this._justDown=!1,t}}),Object.defineProperty(U.Key.prototype,"justUp",{get:function(){var t=this._justUp;return this._justUp=!1,t}}),Object.defineProperty(U.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(t){(t=!!t)!==this._enabled&&(t||this.reset(!1),this._enabled=t)}}),U.Key.prototype.constructor=U.Key,U.Keyboard=function(t){this.game=t,this.enabled=!0,this.event=null,this.pressEvent=null,(this.callbackContext=this).onDownCallback=null,this.onPressCallback=null,this.onUpCallback=null,this._keys=[],this._capture=[],this._onKeyDown=null,this._onKeyPress=null,this._onKeyUp=null,this._i=0,this._k=0},U.Keyboard.prototype={addCallbacks:function(t,e,i,n){this.callbackContext=t,null!=e&&(this.onDownCallback=e),null!=i&&(this.onUpCallback=i),null!=n&&(this.onPressCallback=n)},addKey:function(t){return this._keys[t]||(this._keys[t]=new U.Key(this.game,t),this.addKeyCapture(t)),this._keys[t]},addKeys:function(t){var e,i={};for(e in t)i[e]=this.addKey(t[e]);return i},removeKey:function(t){this._keys[t]&&(this._keys[t]=null,this.removeKeyCapture(t))},createCursorKeys:function(){return this.addKeys({up:U.KeyCode.UP,down:U.KeyCode.DOWN,left:U.KeyCode.LEFT,right:U.KeyCode.RIGHT})},start:function(){var e;this.game.device.cocoonJS||null!==this._onKeyDown||((e=this)._onKeyDown=function(t){return e.processKeyDown(t)},this._onKeyUp=function(t){return e.processKeyUp(t)},this._onKeyPress=function(t){return e.processKeyPress(t)},window.addEventListener("keydown",this._onKeyDown,!1),window.addEventListener("keyup",this._onKeyUp,!1),window.addEventListener("keypress",this._onKeyPress,!1))},stop:function(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),window.removeEventListener("keypress",this._onKeyPress),this._onKeyDown=null,this._onKeyUp=null,this._onKeyPress=null},destroy:function(){this.stop(),this.clearCaptures(),this._keys.length=0,this._i=0},addKeyCapture:function(t){if("object"==typeof t)for(var e in t)this._capture[t[e]]=!0;else this._capture[t]=!0},removeKeyCapture:function(t){delete this._capture[t]},clearCaptures:function(){this._capture={}},update:function(){for(this._i=this._keys.length;this._i--;)this._keys[this._i]&&this._keys[this._i].update()},processKeyDown:function(t){var e;this.event=t,this.game.input.enabled&&this.enabled&&(e=t.keyCode,this._capture[e]&&t.preventDefault(),this._keys[e]||(this._keys[e]=new U.Key(this.game,e)),this._keys[e].processKeyDown(t),this._k=e,this.onDownCallback&&this.onDownCallback.call(this.callbackContext,t))},processKeyPress:function(t){this.pressEvent=t,this.game.input.enabled&&this.enabled&&this.onPressCallback&&this.onPressCallback.call(this.callbackContext,String.fromCharCode(t.charCode),t)},processKeyUp:function(t){var e;this.event=t,this.game.input.enabled&&this.enabled&&(e=t.keyCode,this._capture[e]&&t.preventDefault(),this._keys[e]||(this._keys[e]=new U.Key(this.game,e)),this._keys[e].processKeyUp(t),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,t))},reset:function(t){void 0===t&&(t=!0),this.event=null;for(var e=this._keys.length;e--;)this._keys[e]&&this._keys[e].reset(t)},downDuration:function(t,e){return this._keys[t]?this._keys[t].downDuration(e):null},upDuration:function(t,e){return this._keys[t]?this._keys[t].upDuration(e):null},isDown:function(t){return this._keys[t]?this._keys[t].isDown:null}},Object.defineProperty(U.Keyboard.prototype,"lastChar",{get:function(){return 32===this.event.charCode?"":String.fromCharCode(this.pressEvent.charCode)}}),Object.defineProperty(U.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}}),U.Keyboard.prototype.constructor=U.Keyboard,U.KeyCode={A:"A".charCodeAt(0),B:"B".charCodeAt(0),C:"C".charCodeAt(0),D:"D".charCodeAt(0),E:"E".charCodeAt(0),F:"F".charCodeAt(0),G:"G".charCodeAt(0),H:"H".charCodeAt(0),I:"I".charCodeAt(0),J:"J".charCodeAt(0),K:"K".charCodeAt(0),L:"L".charCodeAt(0),M:"M".charCodeAt(0),N:"N".charCodeAt(0),O:"O".charCodeAt(0),P:"P".charCodeAt(0),Q:"Q".charCodeAt(0),R:"R".charCodeAt(0),S:"S".charCodeAt(0),T:"T".charCodeAt(0),U:"U".charCodeAt(0),V:"V".charCodeAt(0),W:"W".charCodeAt(0),X:"X".charCodeAt(0),Y:"Y".charCodeAt(0),Z:"Z".charCodeAt(0),ZERO:"0".charCodeAt(0),ONE:"1".charCodeAt(0),TWO:"2".charCodeAt(0),THREE:"3".charCodeAt(0),FOUR:"4".charCodeAt(0),FIVE:"5".charCodeAt(0),SIX:"6".charCodeAt(0),SEVEN:"7".charCodeAt(0),EIGHT:"8".charCodeAt(0),NINE:"9".charCodeAt(0),NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:108,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,COLON:186,EQUALS:187,COMMA:188,UNDERSCORE:189,PERIOD:190,QUESTION_MARK:191,TILDE:192,OPEN_BRACKET:219,BACKWARD_SLASH:220,CLOSED_BRACKET:221,QUOTES:222,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PLUS:43,MINUS:44,INSERT:45,DELETE:46,HELP:47,NUM_LOCK:144},U.KeyCode)U.KeyCode.hasOwnProperty(e)&&!e.match(/[a-z]/)&&(U.Keyboard[e]=U.KeyCode[e]);for(i in U.Component=function(){},U.Component.Angle=function(){},U.Component.Angle.prototype={angle:{get:function(){return U.Math.wrapAngle(U.Math.radToDeg(this.rotation))},set:function(t){this.rotation=U.Math.degToRad(U.Math.wrapAngle(t))}}},U.Component.Animation=function(){},U.Component.Animation.prototype={play:function(t,e,i,n){if(this.animations)return this.animations.play(t,e,i,n)}},U.Component.AutoCull=function(){},U.Component.AutoCull.prototype={autoCull:!1,inCamera:{get:function(){return this.autoCull||this.checkWorldBounds||(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y),this.game.world.camera.view.intersects(this._bounds)}}},U.Component.Bounds=function(){},U.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},centerX:{get:function(){return this.x-this.offsetX+.5*this.width},set:function(t){this.x=t+this.offsetX-.5*this.width}},centerY:{get:function(){return this.y-this.offsetY+.5*this.height},set:function(t){this.y=t+this.offsetY-.5*this.height}},left:{get:function(){return this.x-this.offsetX},set:function(t){this.x=t+this.offsetX}},right:{get:function(){return this.x+this.width-this.offsetX},set:function(t){this.x=t-this.width+this.offsetX}},top:{get:function(){return this.y-this.offsetY},set:function(t){this.y=t+this.offsetY}},bottom:{get:function(){return this.y+this.height-this.offsetY},set:function(t){this.y=t-this.height+this.offsetY}},alignIn:function(t,e,i,n){switch(void 0===i&&(i=0),void 0===n&&(n=0),e){default:case U.TOP_LEFT:this.left=t.left-i,this.top=t.top-n;break;case U.TOP_CENTER:this.centerX=t.centerX+i,this.top=t.top-n;break;case U.TOP_RIGHT:this.right=t.right+i,this.top=t.top-n;break;case U.LEFT_CENTER:this.left=t.left-i,this.centerY=t.centerY+n;break;case U.CENTER:this.centerX=t.centerX+i,this.centerY=t.centerY+n;break;case U.RIGHT_CENTER:this.right=t.right+i,this.centerY=t.centerY+n;break;case U.BOTTOM_LEFT:this.left=t.left-i,this.bottom=t.bottom+n;break;case U.BOTTOM_CENTER:this.centerX=t.centerX+i,this.bottom=t.bottom+n;break;case U.BOTTOM_RIGHT:this.right=t.right+i,this.bottom=t.bottom+n}return this},alignTo:function(t,e,i,n){switch(void 0===i&&(i=0),void 0===n&&(n=0),e){default:case U.TOP_LEFT:this.left=t.left-i,this.bottom=t.top-n;break;case U.TOP_CENTER:this.centerX=t.centerX+i,this.bottom=t.top-n;break;case U.TOP_RIGHT:this.right=t.right+i,this.bottom=t.top-n;break;case U.LEFT_TOP:this.right=t.left-i,this.top=t.top-n;break;case U.LEFT_CENTER:this.right=t.left-i,this.centerY=t.centerY+n;break;case U.LEFT_BOTTOM:this.right=t.left-i,this.bottom=t.bottom+n;break;case U.RIGHT_TOP:this.left=t.right+i,this.top=t.top-n;break;case U.RIGHT_CENTER:this.left=t.right+i,this.centerY=t.centerY+n;break;case U.RIGHT_BOTTOM:this.left=t.right+i,this.bottom=t.bottom+n;break;case U.BOTTOM_LEFT:this.left=t.left-i,this.top=t.bottom+n;break;case U.BOTTOM_CENTER:this.centerX=t.centerX+i,this.top=t.bottom+n;break;case U.BOTTOM_RIGHT:this.right=t.right+i,this.top=t.bottom+n}return this}},U.Group.prototype.alignIn=U.Component.Bounds.prototype.alignIn,U.Group.prototype.alignTo=U.Component.Bounds.prototype.alignTo,U.Component.BringToTop=function(){},U.Component.BringToTop.prototype.bringToTop=function(){return this.parent&&this.parent.bringToTop(this),this},U.Component.BringToTop.prototype.sendToBack=function(){return this.parent&&this.parent.sendToBack(this),this},U.Component.BringToTop.prototype.moveUp=function(){return this.parent&&this.parent.moveUp(this),this},U.Component.BringToTop.prototype.moveDown=function(){return this.parent&&this.parent.moveDown(this),this},U.Component.Core=function(){},U.Component.Core.install=function(t){U.Utils.mixinPrototype(this,U.Component.Core.prototype),this.components={};for(var e=0;e<t.length;e++){var i=t[e],n="Destroy"===i?!0:!1;U.Utils.mixinPrototype(this,U.Component[i].prototype,n),this.components[i]=!0}},U.Component.Core.init=function(t,e,i,n,r){this.game=t,this.key=n,this.data={},this.position.set(e,i),this.world=new U.Point(e,i),this.previousPosition=new U.Point(e,i),this.events=new U.Events(this),this._bounds=new U.Rectangle,this.components.PhysicsBody&&(this.body=this.body),this.components.Animation&&(this.animations=new U.AnimationManager(this)),this.components.LoadTexture&&null!==n&&this.loadTexture(n,r),this.components.FixedToCamera&&(this.cameraOffset=new U.Point(e,i))},U.Component.Core.preUpdate=function(){if(!this.pendingDestroy){if(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,!this.exists||!this.parent.exists)return!(this.renderOrderID=-1);this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this.renderOrderID=this.game.stage.currentRenderOrderID++),this.animations&&this.animations.update(),this.body&&this.body.preUpdate();for(var t=0;t<this.children.length;t++)this.children[t].preUpdate();return!0}this.destroy()},U.Component.Core.prototype={game:null,name:"",data:{},components:{},z:0,events:void 0,animations:void 0,key:"",world:null,debug:!1,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:!0,pendingDestroy:!1,_bounds:null,_exists:!0,exists:{get:function(){return this._exists},set:function(t){t?(this._exists=!0,this.body&&this.body.type===U.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._exists=!1,this.body&&this.body.type===U.Physics.P2JS&&this.body.removeFromWorld(),this.visible=!1)}},update:function(){},postUpdate:function(){this.customRender&&this.key.render(),this.components.PhysicsBody&&U.Component.PhysicsBody.postUpdate.call(this),this.components.FixedToCamera&&U.Component.FixedToCamera.postUpdate.call(this);for(var t=0;t<this.children.length;t++)this.children[t].postUpdate()}},U.Component.Crop=function(){},U.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(t,e){void 0===e&&(e=!1),t?(e&&null!==this.cropRect?this.cropRect.setTo(t.x,t.y,t.width,t.height):e&&null===this.cropRect?this.cropRect=new U.Rectangle(t.x,t.y,t.width,t.height):this.cropRect=t,this.updateCrop()):(this._crop=null,this.cropRect=null,this.resetFrame())},updateCrop:function(){var t,e,i,n,r,s,o,a;this.cropRect&&(t=this.texture.crop.x,e=this.texture.crop.y,i=this.texture.crop.width,n=this.texture.crop.height,this._crop=U.Rectangle.clone(this.cropRect,this._crop),this._crop.x+=this._frame.x,this._crop.y+=this._frame.y,r=Math.max(this._frame.x,this._crop.x),s=Math.max(this._frame.y,this._crop.y),o=Math.min(this._frame.right,this._crop.right)-r,a=Math.min(this._frame.bottom,this._crop.bottom)-s,this.texture.crop.x=r,this.texture.crop.y=s,this.texture.crop.width=o,this.texture.crop.height=a,this.texture.frame.width=Math.min(o,this.cropRect.width),this.texture.frame.height=Math.min(a,this.cropRect.height),this.texture.width=this.texture.frame.width,this.texture.height=this.texture.frame.height,this.texture._updateUvs(),16777215===this.tint||t===r&&e===s&&i===o&&n===a||(this.texture.requiresReTint=!0))}},U.Component.Delta=function(){},U.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-this.previousRotation}}},U.Component.Destroy=function(){},U.Component.Destroy.prototype={destroyPhase:!1,destroy:function(t,e){if(null!==this.game&&!this.destroyPhase){void 0===t&&(t=!0),void 0===e&&(e=!1),this.destroyPhase=!0,this.events&&this.events.onDestroy$dispatch(this),this.parent&&(this.parent instanceof U.Group?this.parent.remove(this):this.parent.removeChild(this)),this.input&&this.input.destroy(),this.animations&&this.animations.destroy(),this.body&&this.body.destroy(),this.events&&this.events.destroy(),this.game.tweens.removeFrom(this);var i=this.children.length;if(t)for(;i--;)this.children[i].destroy(t);else for(;i--;)this.removeChild(this.children[i]);this._crop&&(this._crop=null,this.cropRect=null),this._frame&&(this._frame=null),U.Video&&this.key instanceof U.Video&&this.key.onChangeSource.remove(this.resizeFrame,this),U.BitmapText&&this._glyphs&&(this._glyphs=[]),this.alive=!1,this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this.data={},this.renderable=!1,this.transformCallback&&(this.transformCallback=null,this.transformCallbackContext=null),this.hitArea=null,this.parent=null,this.stage=null,this.worldTransform=null,this.filterArea=null,this._bounds=null,this._currentBounds=null,this._mask=null,this._destroyCachedSprite(),e&&this.texture.destroy(!0),this.destroyPhase=!1,this.pendingDestroy=!1}}},U.Events=function(t){this.parent=t},U.Events.prototype={destroy:function(){this._parent=null,this._onDestroy&&this._onDestroy.dispose(),this._onAddedToGroup&&this._onAddedToGroup.dispose(),this._onRemovedFromGroup&&this._onRemovedFromGroup.dispose(),this._onRemovedFromWorld&&this._onRemovedFromWorld.dispose(),this._onKilled&&this._onKilled.dispose(),this._onRevived&&this._onRevived.dispose(),this._onEnterBounds&&this._onEnterBounds.dispose(),this._onOutOfBounds&&this._onOutOfBounds.dispose(),this._onInputOver&&this._onInputOver.dispose(),this._onInputOut&&this._onInputOut.dispose(),this._onInputDown&&this._onInputDown.dispose(),this._onInputUp&&this._onInputUp.dispose(),this._onDragStart&&this._onDragStart.dispose(),this._onDragUpdate&&this._onDragUpdate.dispose(),this._onDragStop&&this._onDragStop.dispose(),this._onAnimationStart&&this._onAnimationStart.dispose(),this._onAnimationComplete&&this._onAnimationComplete.dispose(),this._onAnimationLoop&&this._onAnimationLoop.dispose()},onAddedToGroup:null,onRemovedFromGroup:null,onRemovedFromWorld:null,onDestroy:null,onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragUpdate:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null},U.Events.prototype.constructor=U.Events,U.Events.prototype)U.Events.prototype.hasOwnProperty(i)&&0===i.indexOf("on")&&null===U.Events.prototype[i]&&function(t,e){"use strict";Object.defineProperty(U.Events.prototype,t,{get:function(){return this[e]||(this[e]=new U.Signal)}}),U.Events.prototype[t+"$dispatch"]=function(){return this[e]?this[e].dispatch.apply(this[e],arguments):null}}(i,"_"+i);U.Component.FixedToCamera=function(){},U.Component.FixedToCamera.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)},U.Component.FixedToCamera.prototype={_fixedToCamera:!1,fixedToCamera:{get:function(){return this._fixedToCamera},set:function(t){t?(this._fixedToCamera=!0,this.cameraOffset.set(this.x,this.y)):this._fixedToCamera=!1}},cameraOffset:new U.Point},U.Component.Health=function(){},U.Component.Health.prototype={health:1,maxHealth:100,damage:function(t){return this.alive&&(this.health-=t,this.health<=0&&this.kill()),this},setHealth:function(t){return this.health=t,this.health>this.maxHealth&&(this.health=this.maxHealth),this},heal:function(t){return this.alive&&(this.health+=t,this.health>this.maxHealth&&(this.health=this.maxHealth)),this}},U.Component.InCamera=function(){},U.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}},U.Component.InputEnabled=function(){},U.Component.InputEnabled.prototype={input:null,inputEnabled:{get:function(){return this.input&&this.input.enabled},set:function(t){t?null===this.input?(this.input=new U.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}},U.Component.InWorld=function(){},U.Component.InWorld.preUpdate=function(){if(this.autoCull||this.checkWorldBounds){if(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y,this.autoCull)if(this.game.world.camera.view.intersects(this._bounds))this.renderable=!0,this.game.world.camera.totalInView++;else if(this.renderable=!1,this.outOfCameraBoundsKill)return this.kill(),!1;if(this.checkWorldBounds)if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds))this._outOfBoundsFired=!1,this.events.onEnterBounds$dispatch(this);else if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)&&(this._outOfBoundsFired=!0,this.events.onOutOfBounds$dispatch(this),this.outOfBoundsKill))return this.kill(),!1}return!0},U.Component.InWorld.prototype={checkWorldBounds:!1,outOfBoundsKill:!1,outOfCameraBoundsKill:!1,_outOfBoundsFired:!1,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}},U.Component.LifeSpan=function(){},U.Component.LifeSpan.preUpdate=function(){return!(0<this.lifespan&&(this.lifespan-=this.game.time.physicsElapsedMS,this.lifespan<=0)&&(this.kill(),1))},U.Component.LifeSpan.prototype={alive:!0,lifespan:0,revive:function(t){return void 0===t&&(t=100),this.alive=!0,this.exists=!0,this.visible=!0,"function"==typeof this.setHealth&&this.setHealth(t),this.events&&this.events.onRevived$dispatch(this),this},kill:function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.events&&this.events.onKilled$dispatch(this),this}},U.Component.LoadTexture=function(){},U.Component.LoadTexture.prototype={customRender:!1,_frame:null,loadTexture:function(t,e,i){e=t===U.PENDING_ATLAS?(t=e,0):e||0,(i||void 0===i)&&this.animations&&this.animations.stop(),this.key=t,this.customRender=!1;var n=this.game.cache,r=!0,s=!this.texture.baseTexture.scaleMode;U.RenderTexture&&t instanceof U.RenderTexture?(this.key=t.key,this.setTexture(t)):U.BitmapData&&t instanceof U.BitmapData?(this.customRender=!0,this.setTexture(t.texture),r=n.hasFrameData(t.key,U.Cache.BITMAPDATA)?!this.animations.loadFrameData(n.getFrameData(t.key,U.Cache.BITMAPDATA),e):!this.animations.loadFrameData(t.frameData,0)):U.Video&&t instanceof U.Video?(this.customRender=!0,i=t.texture.valid,this.setTexture(t.texture),this.setFrame(t.texture.frame.clone()),t.onChangeSource.add(this.resizeFrame,this),this.texture.valid=i):U.Tilemap&&t instanceof U.TilemapLayer?this.setTexture(PIXI.Texture.fromCanvas(t.canvas)):t instanceof PIXI.Texture?this.setTexture(t):(n=n.getImage(t,!0),this.key=n.key,this.setTexture(new PIXI.Texture(n.base)),this.texture.baseTexture.skipRender="__default"===t,r=!this.animations.loadFrameData(n.frameData,e)),r&&(this._frame=U.Rectangle.clone(this.texture.frame)),s||(this.texture.baseTexture.scaleMode=1)},setFrame:function(t){this._frame=t,this.texture.frame.x=t.x,this.texture.frame.y=t.y,this.texture.frame.width=t.width,this.texture.frame.height=t.height,this.texture.crop.x=t.x,this.texture.crop.y=t.y,this.texture.crop.width=t.width,this.texture.crop.height=t.height,t.trimmed?(this.texture.trim?(this.texture.trim.x=t.spriteSourceSizeX,this.texture.trim.y=t.spriteSourceSizeY,this.texture.trim.width=t.sourceSizeW,this.texture.trim.height=t.sourceSizeH):this.texture.trim={x:t.spriteSourceSizeX,y:t.spriteSourceSizeY,width:t.sourceSizeW,height:t.sourceSizeH},this.texture.width=t.sourceSizeW,this.texture.height=t.sourceSizeH,this.texture.frame.width=t.sourceSizeW,this.texture.frame.height=t.sourceSizeH):!t.trimmed&&this.texture.trim&&(this.texture.trim=null),this.cropRect&&this.updateCrop(),this.texture.requiresReTint=!0,this.texture._updateUvs(),this.tilingTexture&&(this.refreshTexture=!0)},resizeFrame:function(t,e,i){this.texture.frame.resize(e,i),this.texture.setFrame(this.texture.frame)},resetFrame:function(){this._frame&&this.setFrame(this._frame)},frame:{get:function(){return this.animations.frame},set:function(t){this.animations.frame=t}},frameName:{get:function(){return this.animations.frameName},set:function(t){this.animations.frameName=t}}},U.Component.Overlap=function(){},U.Component.Overlap.prototype={overlap:function(t){return U.Rectangle.intersects(this.getBounds(),t.getBounds())}},U.Component.PhysicsBody=function(){},U.Component.PhysicsBody.preUpdate=function(){return this.fresh&&this.exists?(this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.body&&this.body.preUpdate(),this.fresh=!1):(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,!(!this._exists||!this.parent.exists)||!(this.renderOrderID=-1))},U.Component.PhysicsBody.postUpdate=function(){this.exists&&this.body&&this.body.postUpdate()},U.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(t){this.position.x=t,this.body&&!this.body.dirty&&(this.body._reset=!0)}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t,this.body&&!this.body.dirty&&(this.body._reset=!0)}}},U.Component.Reset=function(){},U.Component.Reset.prototype.reset=function(t,e,i){return void 0===i&&(i=1),this.world.set(t,e),this.position.set(t,e),this.fresh=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this.components.InWorld&&(this._outOfBoundsFired=!1),this.components.LifeSpan&&(this.alive=!0,this.health=i),this.components.PhysicsBody&&this.body&&this.body.reset(t,e,!1,!1),this},U.Component.ScaleMinMax=function(){},U.Component.ScaleMinMax.prototype={transformCallback:null,transformCallbackContext:this,scaleMin:null,scaleMax:null,checkTransform:function(t){this.scaleMin&&(t.a<this.scaleMin.x&&(t.a=this.scaleMin.x),t.d<this.scaleMin.y&&(t.d=this.scaleMin.y)),this.scaleMax&&(t.a>this.scaleMax.x&&(t.a=this.scaleMax.x),t.d>this.scaleMax.y&&(t.d=this.scaleMax.y))},setScaleMinMax:function(t,e,i,n){void 0===e?e=i=n=t:void 0===i&&(i=n=e,e=t),null===t?this.scaleMin=null:this.scaleMin?this.scaleMin.set(t,e):this.scaleMin=new U.Point(t,e),null===i?this.scaleMax=null:this.scaleMax?this.scaleMax.set(i,n):this.scaleMax=new U.Point(i,n),null===this.scaleMin?this.transformCallback=null:(this.transformCallback=this.checkTransform,this.transformCallbackContext=this)}},U.Component.Smoothed=function(){},U.Component.Smoothed.prototype={smoothed:{get:function(){return!this.texture.baseTexture.scaleMode},set:function(t){t?this.texture&&(this.texture.baseTexture.scaleMode=0):this.texture&&(this.texture.baseTexture.scaleMode=1)}}},U.GameObjectFactory=function(t){this.game=t,this.world=this.game.world},U.GameObjectFactory.prototype={existing:function(t){return this.world.add(t)},weapon:function(t,e,i,n){var r=this.game.plugins.add(U.Weapon);return r.createBullets(t,e,i,n),r},image:function(t,e,i,n,r){return void 0===r&&(r=this.world),r.add(new U.Image(this.game,t,e,i,n))},sprite:function(t,e,i,n,r){return void 0===r&&(r=this.world),r.create(t,e,i,n)},creature:function(t,e,i,n,r){void 0===r&&(r=this.world);n=new U.Creature(this.game,t,e,i,n);return r.add(n),n},tween:function(t){return this.game.tweens.create(t)},group:function(t,e,i,n,r){return new U.Group(this.game,t,e,i,n,r)},physicsGroup:function(t,e,i,n){return new U.Group(this.game,e,i,n,!0,t)},spriteBatch:function(t,e,i){return void 0===t&&(t=null),void 0===e&&(e="group"),void 0===i&&(i=!1),new U.SpriteBatch(this.game,t,e,i)},audio:function(t,e,i,n){return this.game.sound.add(t,e,i,n)},sound:function(t,e,i,n){return this.game.sound.add(t,e,i,n)},audioSprite:function(t){return this.game.sound.addSprite(t)},tileSprite:function(t,e,i,n,r,s,o){return void 0===o&&(o=this.world),o.add(new U.TileSprite(this.game,t,e,i,n,r,s))},rope:function(t,e,i,n,r,s){return void 0===s&&(s=this.world),s.add(new U.Rope(this.game,t,e,i,n,r))},text:function(t,e,i,n,r){return void 0===r&&(r=this.world),r.add(new U.Text(this.game,t,e,i,n))},button:function(t,e,i,n,r,s,o,a,l,p){return void 0===p&&(p=this.world),p.add(new U.Button(this.game,t,e,i,n,r,s,o,a,l))},graphics:function(t,e,i){return void 0===i&&(i=this.world),i.add(new U.Graphics(this.game,t,e))},emitter:function(t,e,i){return this.game.particles.add(new U.Particles.Arcade.Emitter(this.game,t,e,i))},retroFont:function(t,e,i,n,r,s,o,a,l){return new U.RetroFont(this.game,t,e,i,n,r,s,o,a,l)},bitmapText:function(t,e,i,n,r,s){return void 0===s&&(s=this.world),s.add(new U.BitmapText(this.game,t,e,i,n,r))},tilemap:function(t,e,i,n,r){return new U.Tilemap(this.game,t,e,i,n,r)},renderTexture:function(t,e,i,n){void 0!==i&&""!==i||(i=this.game.rnd.uuid()),void 0===n&&(n=!1);e=new U.RenderTexture(this.game,t,e,i);return n&&this.game.cache.addRenderTexture(i,e),e},video:function(t,e){return new U.Video(this.game,t,e)},bitmapData:function(t,e,i,n){void 0===n&&(n=!1),void 0!==i&&""!==i||(i=this.game.rnd.uuid());e=new U.BitmapData(this.game,i,t,e);return n&&this.game.cache.addBitmapData(i,e),e},filter:function(t){var e=Array.prototype.slice.call(arguments,1);return(t=new U.Filter[t](this.game)).init.apply(t,e),t},plugin:function(t){return this.game.plugins.add(t)}},U.GameObjectFactory.prototype.constructor=U.GameObjectFactory,U.GameObjectCreator=function(t){this.game=t,this.world=this.game.world},U.GameObjectCreator.prototype={image:function(t,e,i,n){return new U.Image(this.game,t,e,i,n)},sprite:function(t,e,i,n){return new U.Sprite(this.game,t,e,i,n)},tween:function(t){return new U.Tween(t,this.game,this.game.tweens)},group:function(t,e,i,n,r){return new U.Group(this.game,t,e,i,n,r)},spriteBatch:function(t,e,i){return void 0===e&&(e="group"),void 0===i&&(i=!1),new U.SpriteBatch(this.game,t,e,i)},audio:function(t,e,i,n){return this.game.sound.add(t,e,i,n)},audioSprite:function(t){return this.game.sound.addSprite(t)},sound:function(t,e,i,n){return this.game.sound.add(t,e,i,n)},tileSprite:function(t,e,i,n,r,s){return new U.TileSprite(this.game,t,e,i,n,r,s)},rope:function(t,e,i,n,r){return new U.Rope(this.game,t,e,i,n,r)},text:function(t,e,i,n){return new U.Text(this.game,t,e,i,n)},button:function(t,e,i,n,r,s,o,a,l){return new U.Button(this.game,t,e,i,n,r,s,o,a,l)},graphics:function(t,e){return new U.Graphics(this.game,t,e)},emitter:function(t,e,i){return new U.Particles.Arcade.Emitter(this.game,t,e,i)},retroFont:function(t,e,i,n,r,s,o,a,l){return new U.RetroFont(this.game,t,e,i,n,r,s,o,a,l)},bitmapText:function(t,e,i,n,r,s){return new U.BitmapText(this.game,t,e,i,n,r,s)},tilemap:function(t,e,i,n,r){return new U.Tilemap(this.game,t,e,i,n,r)},renderTexture:function(t,e,i,n){void 0!==i&&""!==i||(i=this.game.rnd.uuid()),void 0===n&&(n=!1);e=new U.RenderTexture(this.game,t,e,i);return n&&this.game.cache.addRenderTexture(i,e),e},bitmapData:function(t,e,i,n){void 0===n&&(n=!1),void 0!==i&&""!==i||(i=this.game.rnd.uuid());e=new U.BitmapData(this.game,i,t,e);return n&&this.game.cache.addBitmapData(i,e),e},filter:function(t){var e=Array.prototype.slice.call(arguments,1);return(t=new U.Filter[t](this.game)).init.apply(t,e),t}},U.GameObjectCreator.prototype.constructor=U.GameObjectCreator,U.Sprite=function(t,e,i,n,r){e=e||0,i=i||0,n=n||null,r=r||null,this.type=U.SPRITE,this.physicsType=U.SPRITE,PIXI.Sprite.call(this,U.Cache.DEFAULT),U.Component.Core.init.call(this,t,e,i,n,r)},U.Sprite.prototype=Object.create(PIXI.Sprite.prototype),U.Sprite.prototype.constructor=U.Sprite,U.Component.Core.install.call(U.Sprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]),U.Sprite.prototype.preUpdatePhysics=U.Component.PhysicsBody.preUpdate,U.Sprite.prototype.preUpdateLifeSpan=U.Component.LifeSpan.preUpdate,U.Sprite.prototype.preUpdateInWorld=U.Component.InWorld.preUpdate,U.Sprite.prototype.preUpdateCore=U.Component.Core.preUpdate,U.Sprite.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},U.Image=function(t,e,i,n,r){e=e||0,i=i||0,n=n||null,r=r||null,this.type=U.IMAGE,PIXI.Sprite.call(this,U.Cache.DEFAULT),U.Component.Core.init.call(this,t,e,i,n,r)},U.Image.prototype=Object.create(PIXI.Sprite.prototype),U.Image.prototype.constructor=U.Image,U.Component.Core.install.call(U.Image.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Destroy","FixedToCamera","InputEnabled","LifeSpan","LoadTexture","Overlap","Reset","ScaleMinMax","Smoothed"]),U.Image.prototype.preUpdateInWorld=U.Component.InWorld.preUpdate,U.Image.prototype.preUpdateCore=U.Component.Core.preUpdate,U.Image.prototype.preUpdate=function(){return!!this.preUpdateInWorld()&&this.preUpdateCore()},U.Button=function(t,e,i,n,r,s,o,a,l,p){e=e||0,i=i||0,n=n||null,r=r||null,s=s||this,U.Image.call(this,t,e,i,n,a),this.type=U.BUTTON,this.physicsType=U.SPRITE,this._onOverFrame=null,this._onOutFrame=null,this._onDownFrame=null,this._onUpFrame=null,this.onOverSound=null,this.onOutSound=null,this.onDownSound=null,this.onUpSound=null,this.onOverSoundMarker="",this.onOutSoundMarker="",this.onDownSoundMarker="",this.onUpSoundMarker="",this.onInputOver=new U.Signal,this.onInputOut=new U.Signal,this.onInputDown=new U.Signal,this.onInputUp=new U.Signal,this.onOverMouseOnly=!0,this.justReleasedPreventsOver=U.PointerMode.TOUCH,this.freezeFrames=!1,this.forceOut=!1,this.inputEnabled=!0,this.input.start(0,!0),this.input.useHandCursor=!0,this.setFrames(o,a,l,p),null!==r&&this.onInputUp.add(r,s),this.events.onInputOver.add(this.onInputOverHandler,this),this.events.onInputOut.add(this.onInputOutHandler,this),this.events.onInputDown.add(this.onInputDownHandler,this),this.events.onInputUp.add(this.onInputUpHandler,this),this.events.onRemovedFromWorld.add(this.removedFromWorld,this)},U.Button.prototype=Object.create(U.Image.prototype),U.Button.prototype.constructor=U.Button;U.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)},U.Button.prototype.removedFromWorld=function(){this.inputEnabled=!1},U.Button.prototype.setStateFrame=function(t,e,i){var n="_on"+t+"Frame";null!==e?(this[n]=e,i&&this.changeStateFrame(t)):this[n]=null},U.Button.prototype.changeStateFrame=function(t){if(this.freezeFrames)return!1;t=this["_on"+t+"Frame"];return"string"==typeof t?(this.frameName=t,!0):"number"==typeof t&&(this.frame=t,!0)},U.Button.prototype.setFrames=function(t,e,i,n){this.setStateFrame("Over",t,this.input.pointerOver()),this.setStateFrame("Out",e,!this.input.pointerOver()),this.setStateFrame("Down",i,this.input.pointerDown()),this.setStateFrame("Up",n,this.input.pointerUp())},U.Button.prototype.setStateSound=function(t,e,i){var n="on"+t+"Sound",t="on"+t+"SoundMarker";e instanceof U.Sound||e instanceof U.AudioSprite?(this[n]=e,this[t]="string"==typeof i?i:""):(this[n]=null,this[t]="")},U.Button.prototype.playStateSound=function(t){var e=this["on"+t+"Sound"];if(e){t=this["on"+t+"SoundMarker"];return e.play(t),!0}return!1},U.Button.prototype.setSounds=function(t,e,i,n,r,s,o,a){this.setStateSound("Over",t,e),this.setStateSound("Out",r,s),this.setStateSound("Down",i,n),this.setStateSound("Up",o,a)},U.Button.prototype.setOverSound=function(t,e){this.setStateSound("Over",t,e)},U.Button.prototype.setOutSound=function(t,e){this.setStateSound("Out",t,e)},U.Button.prototype.setDownSound=function(t,e){this.setStateSound("Down",t,e)},U.Button.prototype.setUpSound=function(t,e){this.setStateSound("Up",t,e)},U.Button.prototype.onInputOverHandler=function(t,e){e.justReleased()&&(this.justReleasedPreventsOver&e.pointerMode)===e.pointerMode||(this.changeStateFrame("Over"),this.onOverMouseOnly&&!e.isMouse||(this.playStateSound("Over"),this.onInputOver&&this.onInputOver.dispatch(this,e)))},U.Button.prototype.onInputOutHandler=function(t,e){this.changeStateFrame("Out"),this.playStateSound("Out"),this.onInputOut&&this.onInputOut.dispatch(this,e)},U.Button.prototype.onInputDownHandler=function(t,e){this.changeStateFrame("Down"),this.playStateSound("Down"),this.onInputDown&&this.onInputDown.dispatch(this,e)},U.Button.prototype.onInputUpHandler=function(t,e,i){this.playStateSound("Up"),this.onInputUp&&this.onInputUp.dispatch(this,e,i),this.freezeFrames||(!0===this.forceOut||(this.forceOut&e.pointerMode)===e.pointerMode?this.changeStateFrame("Out"):this.changeStateFrame("Up")||(i?this.changeStateFrame("Over"):this.changeStateFrame("Out")))},U.SpriteBatch=function(t,e,i,n){null!=e||(e=t.world),PIXI.SpriteBatch.call(this),U.Group.call(this,t,e,i,n),this.type=U.SPRITEBATCH},U.SpriteBatch.prototype=U.Utils.extend(!0,U.SpriteBatch.prototype,PIXI.SpriteBatch.prototype,U.Group.prototype),U.SpriteBatch.prototype.constructor=U.SpriteBatch,U.BitmapData=function(t,e,i,n,r){void 0!==i&&0!==i||(i=256),void 0!==n&&0!==n||(n=256),void 0===r&&(r=!1),this.game=t,this.key=e,this.width=i,this.height=n,this.canvas=U.Canvas.create(this,i,n,null,r),this.context=this.canvas.getContext("2d",{alpha:!0}),this.ctx=this.context,this.smoothProperty=t.renderType===U.CANVAS?t.renderer.renderSession.smoothProperty:U.Canvas.getSmoothingPrefix(this.context),this.imageData=this.context.getImageData(0,0,i,n),this.data=null,this.imageData&&(this.data=this.imageData.data),this.pixels=null,this.data&&(this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data),this.baseTexture=new PIXI.BaseTexture(this.canvas),this.texture=new PIXI.Texture(this.baseTexture),this.frameData=new U.FrameData,this.textureFrame=this.frameData.addFrame(new U.Frame(0,0,0,i,n,"bitmapData")),this.texture.frame=this.textureFrame,this.type=U.BITMAPDATA,this.disableTextureUpload=!1,this.dirty=!1,this.cls=this.clear,this._image=null,this._pos=new U.Point,this._size=new U.Point,this._scale=new U.Point,this._rotate=0,this._alpha={prev:1,current:1},this._anchor=new U.Point,this._tempR=0,this._tempG=0,this._tempB=0,this._circle=new U.Circle,this._swapCanvas=void 0},U.BitmapData.prototype={move:function(t,e,i){return 0!==t&&this.moveH(t,i),0!==e&&this.moveV(e,i),this},moveH:function(t,e){void 0===e&&(e=!0),void 0===this._swapCanvas&&(this._swapCanvas=PIXI.CanvasPool.create(this,this.width,this.height));var i,n=this._swapCanvas.getContext("2d"),r=this.height,s=this.canvas;return n.clearRect(0,0,this.width,this.height),t<0?(t=Math.abs(t),i=this.width-t,e&&n.drawImage(s,0,0,t,r,i,0,t,r),n.drawImage(s,t,0,i,r,0,0,i,r)):(i=this.width-t,e&&n.drawImage(s,i,0,t,r,0,0,t,r),n.drawImage(s,0,0,i,r,t,0,i,r)),this.clear(),this.copy(this._swapCanvas)},moveV:function(t,e){void 0===e&&(e=!0),void 0===this._swapCanvas&&(this._swapCanvas=PIXI.CanvasPool.create(this,this.width,this.height));var i,n=this._swapCanvas.getContext("2d"),r=this.width,s=this.canvas;return n.clearRect(0,0,this.width,this.height),t<0?(t=Math.abs(t),i=this.height-t,e&&n.drawImage(s,0,0,r,t,0,i,r,t),n.drawImage(s,0,t,r,i,0,0,r,i)):(i=this.height-t,e&&n.drawImage(s,0,i,r,t,0,0,r,t),n.drawImage(s,0,0,r,i,0,t,r,i)),this.clear(),this.copy(this._swapCanvas)},add:function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)t[e].loadTexture&&t[e].loadTexture(this);else t.loadTexture(this);return this},load:function(t){if("string"==typeof t&&(t=this.game.cache.getImage(t)),t)return this.resize(t.width,t.height),this.cls(),this.draw(t),this.update(),this},clear:function(t,e,i,n){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=this.width),void 0===n&&(n=this.height),this.context.clearRect(t,e,i,n),this.dirty=!0,this},fill:function(t,e,i,n){return void 0===n&&(n=1),this.context.fillStyle="rgba("+t+","+e+","+i+","+n+")",this.context.fillRect(0,0,this.width,this.height),this.dirty=!0,this},generateTexture:function(t){var e=new Image;e.src=this.canvas.toDataURL("image/png");e=this.game.cache.addImage(t,"",e);return new PIXI.Texture(e.base)},resize:function(t,e){return t===this.width&&e===this.height||(this.width=t,this.height=e,this.canvas.width=t,this.canvas.height=e,void 0!==this._swapCanvas&&(this._swapCanvas.width=t,this._swapCanvas.height=e),this.baseTexture.width=t,this.baseTexture.height=e,this.textureFrame.width=t,this.textureFrame.height=e,this.texture.width=t,this.texture.height=e,this.texture.crop.width=t,this.texture.crop.height=e,this.update(),this.dirty=!0),this},update:function(t,e,i,n){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=Math.max(1,this.width)),void 0===n&&(n=Math.max(1,this.height)),this.imageData=this.context.getImageData(t,e,i,n),this.data=this.imageData.data,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data,this},processPixelRGB:function(t,e,i,n,r,s){void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=this.width),void 0===s&&(s=this.height);for(var o,a=i+r,l=n+s,p=U.Color.createColor(),h=!1,u=n;u<l;u++)for(var c=i;c<a;c++)U.Color.unpackPixel(this.getPixel32(c,u),p),!1!==(o=t.call(e,p,c,u))&&null!=o&&(this.setPixel32(c,u,o.r,o.g,o.b,o.a,!1),h=!0);return h&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},processPixel:function(t,e,i,n,r,s){void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=this.width),void 0===s&&(s=this.height);for(var o,a,l=i+r,p=n+s,h=!1,u=n;u<p;u++)for(var c=i;c<l;c++)o=this.getPixel32(c,u),(a=t.call(e,o,c,u))!==o&&(this.pixels[u*this.width+c]=a,h=!0);return h&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},replaceRGB:function(t,e,i,n,r,s,o,a,l){var p=0,h=0,u=this.width,c=this.height,d=U.Color.packPixel(t,e,i,n);void 0!==l&&l instanceof U.Rectangle&&(p=l.x,h=l.y,u=l.width,c=l.height);for(var _=0;_<c;_++)for(var y=0;y<u;y++)this.getPixel32(p+y,h+_)===d&&this.setPixel32(p+y,h+_,r,s,o,a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this},setHSL:function(t,e,i,n){var r=t||0===t,s=e||0===e,o=i||0===i;if(r||s||o){void 0===n&&(n=new U.Rectangle(0,0,this.width,this.height));for(var a=U.Color.createColor(),l=n.y;l<n.bottom;l++)for(var p=n.x;p<n.right;p++)U.Color.unpackPixel(this.getPixel32(p,l),a,!0),r&&(a.h=t),s&&(a.s=e),o&&(a.l=i),U.Color.HSLtoRGB(a.h,a.s,a.l,a),this.setPixel32(p,l,a.r,a.g,a.b,a.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},shiftHSL:function(t,e,i,n){if(null!=t||(t=!1),null!=e||(e=!1),null!=i||(i=!1),t||e||i){void 0===n&&(n=new U.Rectangle(0,0,this.width,this.height));for(var r=U.Color.createColor(),s=n.y;s<n.bottom;s++)for(var o=n.x;o<n.right;o++)U.Color.unpackPixel(this.getPixel32(o,s),r,!0),t&&(r.h=this.game.math.wrap(r.h+t,0,1)),e&&(r.s=this.game.math.clamp(r.s+e,0,1)),i&&(r.l=this.game.math.clamp(r.l+i,0,1)),U.Color.HSLtoRGB(r.h,r.s,r.l,r),this.setPixel32(o,s,r.r,r.g,r.b,r.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},setPixel32:function(t,e,i,n,r,s,o){return void 0===o&&(o=!0),0<=t&&t<=this.width&&0<=e&&e<=this.height&&(U.Device.LITTLE_ENDIAN?this.pixels[e*this.width+t]=s<<24|r<<16|n<<8|i:this.pixels[e*this.width+t]=i<<24|n<<16|r<<8|s,o&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0)),this},setPixel:function(t,e,i,n,r,s){return this.setPixel32(t,e,i,n,r,255,s)},getPixel:function(t,e,i){i=i||U.Color.createColor();e=~~(t+e*this.width);return e*=4,i.r=this.data[e],i.g=this.data[++e],i.b=this.data[++e],i.a=this.data[++e],i},getPixel32:function(t,e){if(0<=t&&t<=this.width&&0<=e&&e<=this.height)return this.pixels[e*this.width+t]},getPixelRGB:function(t,e,i,n,r){return U.Color.unpackPixel(this.getPixel32(t,e),i,n,r)},getPixels:function(t){return this.context.getImageData(t.x,t.y,t.width,t.height)},getFirstPixel:function(t){void 0===t&&(t=0);var e=U.Color.createColor(),i=0,n=0,r=1,s=!1;for(1===t?(r=-1,n=this.height):3===t&&(r=-1,i=this.width);U.Color.unpackPixel(this.getPixel32(i,n),e),0===t||1===t?++i===this.width&&(i=0,((n+=r)>=this.height||n<=0)&&(s=!0)):2!==t&&3!==t||++n===this.height&&(n=0,((i+=r)>=this.width||i<=0)&&(s=!0)),0===e.a&&!s;);return e.x=i,e.y=n,e},getBounds:function(t){return void 0===t&&(t=new U.Rectangle),t.x=this.getFirstPixel(2).x,t.x===this.width?t.setTo(0,0,0,0):(t.y=this.getFirstPixel(0).y,t.width=this.getFirstPixel(3).x-t.x+1,t.height=this.getFirstPixel(1).y-t.y+1,t)},addToWorld:function(t,e,i,n,r,s){r=r||1,s=s||1;e=this.game.add.image(t,e,this);return e.anchor.set(i,n),e.scale.set(r,s),e},copy:function(t,e,i,n,r,s,o,a,l,p,h,u,c,d,_,y,f){if(null!=t||(t=this),(t instanceof U.RenderTexture||t instanceof PIXI.RenderTexture)&&(t=t.getCanvas()),(this._image=t)instanceof U.Sprite||t instanceof U.Image||t instanceof U.Text||t instanceof PIXI.Sprite)this._pos.set(t.texture.crop.x,t.texture.crop.y),this._size.set(t.texture.crop.width,t.texture.crop.height),this._scale.set(t.scale.x,t.scale.y),this._anchor.set(t.anchor.x,t.anchor.y),this._rotate=t.rotation,this._alpha.current=t.alpha,t.texture instanceof U.RenderTexture||t.texture instanceof PIXI.RenderTexture?this._image=t.texture.getCanvas():this._image=t.texture.baseTexture.source,null!=s||(s=t.x),null!=o||(o=t.y),t.texture.trim&&(s+=t.texture.trim.x-t.anchor.x*t.texture.trim.width,o+=t.texture.trim.y-t.anchor.y*t.texture.trim.height),16777215!==t.tint&&(t.cachedTint!==t.tint&&(t.cachedTint=t.tint,t.tintedTexture=PIXI.CanvasTinter.getTintedTexture(t,t.tint)),this._image=t.tintedTexture,this._pos.set(0));else{if(this._pos.set(0),this._scale.set(1),this._anchor.set(0),this._rotate=0,this._alpha.current=1,t instanceof U.BitmapData)this._image=t.canvas;else if("string"==typeof t){if(null===(t=this.game.cache.getImage(t)))return;this._image=t}this._size.set(this._image.width,this._image.height)}if(null!=e||(e=0),null!=i||(i=0),n&&(this._size.x=n),r&&(this._size.y=r),null!=s||(s=e),null!=o||(o=i),null!=a||(a=this._size.x),null!=l||(l=this._size.y),"number"==typeof p&&(this._rotate=p),"number"==typeof h&&(this._anchor.x=h),"number"==typeof u&&(this._anchor.y=u),"number"==typeof c&&(this._scale.x=c),"number"==typeof d&&(this._scale.y=d),"number"==typeof _&&(this._alpha.current=_),void 0===y&&(y=null),void 0===f&&(f=!1),!(this._alpha.current<=0||0===this._scale.x||0===this._scale.y||0===this._size.x||0===this._size.y)){_=this.context;return this._alpha.prev=_.globalAlpha,_.save(),_.globalAlpha=this._alpha.current,y&&(this.op=y),f&&(s|=0,o|=0),_.translate(s,o),_.scale(this._scale.x,this._scale.y),_.rotate(this._rotate),_.drawImage(this._image,this._pos.x+e,this._pos.y+i,this._size.x,this._size.y,-a*this._anchor.x,-l*this._anchor.y,a,l),_.restore(),_.globalAlpha=this._alpha.prev,this.dirty=!0,this}},copyTransform:function(t,e,i){if(void 0===e&&(e=null),void 0===i&&(i=!1),!t.hasOwnProperty("worldTransform")||!t.worldVisible||0===t.worldAlpha)return this;var n=t.worldTransform;if(this._pos.set(t.texture.crop.x,t.texture.crop.y),this._size.set(t.texture.crop.width,t.texture.crop.height),0===n.a||0===n.d||0===this._size.x||0===this._size.y)return this;t.texture instanceof U.RenderTexture||t.texture instanceof PIXI.RenderTexture?this._image=t.texture.getCanvas():this._image=t.texture.baseTexture.source;var r=n.tx,s=n.ty;t.texture.trim&&(r+=t.texture.trim.x-t.anchor.x*t.texture.trim.width,s+=t.texture.trim.y-t.anchor.y*t.texture.trim.height),16777215!==t.tint&&(t.cachedTint!==t.tint&&(t.cachedTint=t.tint,t.tintedTexture=PIXI.CanvasTinter.getTintedTexture(t,t.tint)),this._image=t.tintedTexture,this._pos.set(0)),i&&(r|=0,s|=0);i=this.context;return this._alpha.prev=i.globalAlpha,i.save(),i.globalAlpha=this._alpha.current,e&&(this.op=e),i[this.smoothProperty]=t.texture.baseTexture.scaleMode===PIXI.scaleModes.LINEAR,i.setTransform(n.a,n.b,n.c,n.d,r,s),i.drawImage(this._image,this._pos.x,this._pos.y,this._size.x,this._size.y,-this._size.x*t.anchor.x,-this._size.y*t.anchor.y,this._size.x,this._size.y),i.restore(),i.globalAlpha=this._alpha.prev,this.dirty=!0,this},copyRect:function(t,e,i,n,r,s,o){return this.copy(t,e.x,e.y,e.width,e.height,i,n,e.width,e.height,0,0,0,1,1,r,s,o)},draw:function(t,e,i,n,r,s,o){return this.copy(t,null,null,null,null,e,i,n,r,null,null,null,null,null,null,s,o)},drawGroup:function(t,e,i){return 0<t.total&&t.forEachExists(this.drawGroupProxy,this,e,i),this},drawGroupProxy:function(t,e,i){if(t.hasOwnProperty("texture")&&this.copyTransform(t,e,i),t.type===U.GROUP&&t.exists)this.drawGroup(t,e,i);else if(t.hasOwnProperty("children")&&0<t.children.length)for(var n=0;n<t.children.length;n++)t.children[n].exists&&this.copyTransform(t.children[n],e,i)},drawFull:function(t,e,i){if(!1===t.worldVisible||0===t.worldAlpha||t.hasOwnProperty("exists")&&!1===t.exists)return this;var n;if(t.type!==U.GROUP&&t.type!==U.EMITTER&&t.type!==U.BITMAPTEXT&&(t.type===U.GRAPHICS?(n=t.getBounds(),this.ctx.save(),this.ctx.translate(n.x,n.y),PIXI.CanvasGraphics.renderGraphics(t,this.ctx),this.ctx.restore()):this.copy(t,null,null,null,null,t.worldPosition.x,t.worldPosition.y,null,null,t.worldRotation,null,null,t.worldScale.x,t.worldScale.y,t.worldAlpha,e,i)),t.children)for(var r=0;r<t.children.length;r++)this.drawFull(t.children[r],e,i);return this},shadow:function(t,e,i,n){var r=this.context;return null==t?r.shadowColor="rgba(0,0,0,0)":(r.shadowColor=t,r.shadowBlur=e||5,r.shadowOffsetX=i||10,r.shadowOffsetY=n||10),this},alphaMask:function(t,e,i,n){return(null==n?this.draw(e):this.draw(e,n.x,n.y,n.width,n.height)).blendSourceAtop(),(null==i?this.draw(t):this.draw(t,i.x,i.y,i.width,i.height)).blendReset(),this},extract:function(n,r,s,o,a,t,l,p,h){return void 0===a&&(a=255),void 0===t&&(t=!1),void 0===l&&(l=r),void 0===p&&(p=s),void 0===h&&(h=o),t&&n.resize(this.width,this.height),this.processPixelRGB(function(t,e,i){return t.r===r&&t.g===s&&t.b===o&&n.setPixel32(e,i,l,p,h,a,!1),!1},this),n.context.putImageData(n.imageData,0,0),n.dirty=!0,n},rect:function(t,e,i,n,r){return void 0!==r&&(this.context.fillStyle=r),this.context.fillRect(t,e,i,n),this},text:function(t,e,i,n,r,s){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n="14px Courier"),void 0===r&&(r="rgb(255,255,255)"),void 0===s&&(s=!0);var o=this.context,a=o.font;return o.font=n,s&&(o.fillStyle="rgb(0,0,0)",o.fillText(t,e+1,i+1)),o.fillStyle=r,o.fillText(t,e,i),o.font=a,this},circle:function(t,e,i,n){var r=this.context;return void 0!==n&&(r.fillStyle=n),r.beginPath(),r.arc(t,e,i,0,2*Math.PI,!1),r.closePath(),r.fill(),this},line:function(t,e,i,n,r,s){void 0===r&&(r="#fff"),void 0===s&&(s=1);var o=this.context;return o.beginPath(),o.moveTo(t,e),o.lineTo(i,n),o.lineWidth=s,o.strokeStyle=r,o.stroke(),o.closePath(),this},textureLine:function(t,e,i){if(void 0===i&&(i="repeat-x"),"string"!=typeof e||(e=this.game.cache.getImage(e))){var n=t.length;"no-repeat"===i&&n>e.width&&(n=e.width);var r=this.context;return r.fillStyle=r.createPattern(e,i),this._circle=new U.Circle(t.start.x,t.start.y,e.height),this._circle.circumferencePoint(t.angle-1.5707963267948966,!1,this._pos),r.save(),r.translate(this._pos.x,this._pos.y),r.rotate(t.angle),r.fillRect(0,0,n,e.height),r.restore(),this.dirty=!0,this}},render:function(){return!this.disableTextureUpload&&this.dirty&&(this.baseTexture.dirty(),this.dirty=!1),this},destroy:function(){this.frameData.destroy(),this.texture.destroy(!0),PIXI.CanvasPool.remove(this)},blendReset:function(){return this.op="source-over",this},blendSourceOver:function(){return this.op="source-over",this},blendSourceIn:function(){return this.op="source-in",this},blendSourceOut:function(){return this.op="source-out",this},blendSourceAtop:function(){return this.op="source-atop",this},blendDestinationOver:function(){return this.op="destination-over",this},blendDestinationIn:function(){return this.op="destination-in",this},blendDestinationOut:function(){return this.op="destination-out",this},blendDestinationAtop:function(){return this.op="destination-atop",this},blendXor:function(){return this.op="xor",this},blendAdd:function(){return this.op="lighter",this},blendMultiply:function(){return this.op="multiply",this},blendScreen:function(){return this.op="screen",this},blendOverlay:function(){return this.op="overlay",this},blendDarken:function(){return this.op="darken",this},blendLighten:function(){return this.op="lighten",this},blendColorDodge:function(){return this.op="color-dodge",this},blendColorBurn:function(){return this.op="color-burn",this},blendHardLight:function(){return this.op="hard-light",this},blendSoftLight:function(){return this.op="soft-light",this},blendDifference:function(){return this.op="difference",this},blendExclusion:function(){return this.op="exclusion",this},blendHue:function(){return this.op="hue",this},blendSaturation:function(){return this.op="saturation",this},blendColor:function(){return this.op="color",this},blendLuminosity:function(){return this.op="luminosity",this}},Object.defineProperty(U.BitmapData.prototype,"smoothed",{get:function(){U.Canvas.getSmoothingEnabled(this.context)},set:function(t){U.Canvas.setSmoothingEnabled(this.context,t)}}),Object.defineProperty(U.BitmapData.prototype,"op",{get:function(){return this.context.globalCompositeOperation},set:function(t){this.context.globalCompositeOperation=t}}),U.BitmapData.getTransform=function(t,e,i,n,r,s){return"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0),"number"!=typeof i&&(i=1),"number"!=typeof n&&(n=1),"number"!=typeof r&&(r=0),"number"!=typeof s&&(s=0),{sx:i,sy:n,scaleX:i,scaleY:n,skewX:r,skewY:s,translateX:t,translateY:e,tx:t,ty:e}},U.BitmapData.prototype.constructor=U.BitmapData,PIXI.Graphics=function(){PIXI.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this.blendMode=PIXI.blendModes.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this._localBounds=new PIXI.Rectangle(0,0,1,1),this.dirty=!0,this._boundsDirty=!1,this.webGLDirty=!1,this.cachedSpriteDirty=!1},PIXI.Graphics.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.Graphics.prototype.constructor=PIXI.Graphics,PIXI.Graphics.prototype.lineStyle=function(t,e,i){return this.lineWidth=t||0,this.lineColor=e||0,this.lineAlpha=void 0===i?1:i,this.currentPath&&(this.currentPath.shape.points.length?this.drawShape(new PIXI.Polygon(this.currentPath.shape.points.slice(-2))):(this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha)),this},PIXI.Graphics.prototype.moveTo=function(t,e){return this.drawShape(new PIXI.Polygon([t,e])),this},PIXI.Graphics.prototype.lineTo=function(t,e){return this.currentPath||this.moveTo(0,0),this.currentPath.shape.points.push(t,e),this.dirty=!0,this._boundsDirty=!0,this},PIXI.Graphics.prototype.quadraticCurveTo=function(t,e,i,n){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var r,s,o=this.currentPath.shape.points;0===o.length&&this.moveTo(0,0);for(var a,l=o[o.length-2],p=o[o.length-1],h=1;h<=20;++h)r=l+(t-l)*(a=h/20),s=p+(e-p)*a,o.push(r+(t+(i-t)*a-r)*a,s+(e+(n-e)*a-s)*a);return this.dirty=!0,this._boundsDirty=!0,this},PIXI.Graphics.prototype.bezierCurveTo=function(t,e,i,n,r,s){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var o,a,l,p,h,u,c=this.currentPath.shape.points,d=c[c.length-2],_=c[c.length-1],y=1;y<=20;++y)l=(a=(o=1-(u=y/20))*o)*o,h=(p=u*u)*u,c.push(l*d+3*a*u*t+3*o*p*i+h*r,l*_+3*a*u*e+3*o*p*n+h*s);return this.dirty=!0,this._boundsDirty=!0,this},PIXI.Graphics.prototype.arcTo=function(t,e,i,n,r){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);var s,o,a,l=this.currentPath.shape.points,p=l[l.length-2],h=l[l.length-1]-e,u=p-t,c=n-e,d=i-t,_=Math.abs(h*d-u*c);return _<1e-8||0===r?l[l.length-2]===t&&l[l.length-1]===e||l.push(t,e):(o=h*h+u*u,a=c*c+d*d,s=h*c+u*d,i=(p=r*Math.sqrt(o)/_)*d+(n=r*Math.sqrt(a)/_)*u,l=p*c+n*h,o=u*(n+(_=p*s/o)),_=h*(n+_),a=d*(p+(s=n*s/a)),s=c*(p+s),o=Math.atan2(_-l,o-i),a=Math.atan2(s-l,a-i),this.arc(i+t,l+e,r,o,a,d*h<u*c)),this.dirty=!0,this._boundsDirty=!0,this},PIXI.Graphics.prototype.arc=function(t,e,i,n,r,s,o){if(n===r)return this;void 0===s&&(s=!1),void 0===o&&(o=40),!s&&r<=n?r+=2*Math.PI:s&&n<=r&&(n+=2*Math.PI);var a=s?-1*(n-r):r-n,l=Math.ceil(Math.abs(a)/(2*Math.PI))*o;if(0==a)return this;r=t+Math.cos(n)*i,o=e+Math.sin(n)*i;s&&this.filling?this.moveTo(t,e):this.moveTo(r,o);for(var p=this.currentPath.shape.points,h=a/(2*l),u=2*h,c=Math.cos(h),d=Math.sin(h),_=l-1,y=_%1/_,f=0;f<=_;f++){var m=h+n+u*(f+y*f),x=Math.cos(m),m=-Math.sin(m);p.push((c*x+d*m)*i+t,(c*-m+d*x)*i+e)}return this.dirty=!0,this._boundsDirty=!0,this},PIXI.Graphics.prototype.beginFill=function(t,e){return this.filling=!0,this.fillColor=t||0,this.fillAlpha=void 0===e?1:e,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},PIXI.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},PIXI.Graphics.prototype.drawRect=function(t,e,i,n){return this.drawShape(new PIXI.Rectangle(t,e,i,n)),this},PIXI.Graphics.prototype.drawRoundedRect=function(t,e,i,n,r){return this.drawShape(new PIXI.RoundedRectangle(t,e,i,n,r)),this},PIXI.Graphics.prototype.drawCircle=function(t,e,i){return this.drawShape(new PIXI.Circle(t,e,i)),this},PIXI.Graphics.prototype.drawEllipse=function(t,e,i,n){return this.drawShape(new PIXI.Ellipse(t,e,i,n)),this},PIXI.Graphics.prototype.drawPolygon=function(t){(t instanceof U.Polygon||t instanceof PIXI.Polygon)&&(t=t.points);var e=t;if(!Array.isArray(e)){e=new Array(arguments.length);for(var i=0;i<e.length;++i)e[i]=arguments[i]}return this.drawShape(new U.Polygon(e)),this},PIXI.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this._boundsDirty=!0,this.clearDirty=!0,this.graphicsData=[],this.updateLocalBounds(),this},PIXI.Graphics.prototype.generateTexture=function(t,e,i){void 0===t&&(t=1),void 0===e&&(e=PIXI.scaleModes.DEFAULT),void 0===i&&(i=0);var n=this.getBounds();n.width+=i,n.height+=i;i=new PIXI.CanvasBuffer(n.width*t,n.height*t),e=PIXI.Texture.fromCanvas(i.canvas,e);return e.baseTexture.resolution=t,i.context.scale(t,t),i.context.translate(-n.x,-n.y),PIXI.CanvasGraphics.renderGraphics(this,i.context),e},PIXI.Graphics.prototype._renderWebGL=function(t){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,void PIXI.Sprite.prototype._renderWebGL.call(this._cachedSprite,t);var e;if(t.spriteBatch.stop(),t.blendModeManager.setBlendMode(this.blendMode),this._mask&&t.maskManager.pushMask(this._mask,t),this._filters&&t.filterManager.pushFilter(this._filterBlock),this.blendMode!==t.spriteBatch.currentBlendMode&&(t.spriteBatch.currentBlendMode=this.blendMode,e=PIXI.blendModesWebGL[t.spriteBatch.currentBlendMode],t.spriteBatch.gl.blendFunc(e[0],e[1])),this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),PIXI.WebGLGraphics.renderGraphics(this,t),this.children.length){t.spriteBatch.start();for(var i=0;i<this.children.length;i++)this.children[i]._renderWebGL(t);t.spriteBatch.stop()}this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this.mask,t),t.drawCount++,t.spriteBatch.start()}},PIXI.Graphics.prototype._renderCanvas=function(t){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._prevTint!==this.tint&&(this.dirty=!0,this._prevTint=this.tint),this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void PIXI.Sprite.prototype._renderCanvas.call(this._cachedSprite,t);var e=t.context,i=this.worldTransform;this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,e.globalCompositeOperation=PIXI.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t);var n=t.resolution,r=i.tx*t.resolution+t.shakeX,s=i.ty*t.resolution+t.shakeY;e.setTransform(i.a*n,i.b*n,i.c*n,i.d*n,r,s),PIXI.CanvasGraphics.renderGraphics(this,e);for(var o=0;o<this.children.length;o++)this.children[o]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},PIXI.Graphics.prototype.getBounds=function(t){if(!this._currentBounds){if(!this.renderable)return PIXI.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var e=this._localBounds,i=e.x,n=e.width+e.x,r=e.y,s=e.height+e.y,o=t||this.worldTransform,a=o.a,l=o.b,p=o.c,h=o.d,u=o.tx,c=o.ty,d=a*n+p*s+u,e=h*s+l*n+c,t=a*i+p*s+u,o=h*s+l*i+c,s=a*i+p*r+u,i=h*r+l*i+c,u=a*n+p*r+u,l=h*r+l*n+c,n=d,c=e,d=d,e=e;d=u<(d=s<(d=t<d?t:d)?s:d)?u:d,e=l<(e=i<(e=o<e?o:e)?i:e)?l:e,n=(n=(n=n<t?t:n)<s?s:n)<u?u:n,c=(c=(c=c<o?o:c)<i?i:c)<l?l:c,this._bounds.x=d,this._bounds.width=n-d,this._bounds.y=e,this._bounds.height=c-e,this._currentBounds=this._bounds}return this._currentBounds},PIXI.Graphics.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=PIXI.identityMatrix;for(var e=0;e<this.children.length;e++)this.children[e].updateTransform();var i=this.getBounds();for(this.worldTransform=t,e=0;e<this.children.length;e++)this.children[e].updateTransform();return i},PIXI.Graphics.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,tempPoint);for(var e=this.graphicsData,i=0;i<e.length;i++){var n=e[i];if(n.fill&&n.shape&&n.shape.contains(tempPoint.x,tempPoint.y))return!0}return!1},PIXI.Graphics.prototype.updateLocalBounds=function(){var t=1/0,e=-1/0,i=1/0,n=-1/0;if(this.graphicsData.length)for(var r,s,o,a,l,p=0;p<this.graphicsData.length;p++){var h=this.graphicsData[p],u=h.type,c=h.lineWidth,h=h.shape;if(u===PIXI.Graphics.RECT||u===PIXI.Graphics.RREC)s=h.x-c/2,o=h.y-c/2,t=s<t?s:t,e=e<s+(a=h.width+c)?s+a:e,i=o<i?o:i,n=n<o+(l=h.height+c)?o+l:n;else if(u===PIXI.Graphics.CIRC)s=h.x,o=h.y,t=s-(a=h.radius+c/2)<t?s-a:t,e=e<s+a?s+a:e,i=o-(l=h.radius+c/2)<i?o-l:i,n=n<o+l?o+l:n;else if(u===PIXI.Graphics.ELIP)s=h.x,o=h.y,t=s-(a=h.width+c/2)<t?s-a:t,e=e<s+a?s+a:e,i=o-(l=h.height+c/2)<i?o-l:i,n=n<o+l?o+l:n;else{r=h.points;for(var d=0;d<r.length;d++)r[d]instanceof U.Point?(s=r[d].x,o=r[d].y):(s=r[d],o=r[d+1],d<r.length-1&&d++),t=s-c<t?s-c:t,e=e<s+c?s+c:e,i=o-c<i?o-c:i,n=n<o+c?o+c:n}}else n=i=e=t=0;var _=this.boundsPadding;this._localBounds.x=t-_,this._localBounds.width=e-t+2*_,this._localBounds.y=i-_,this._localBounds.height=n-i+2*_},PIXI.Graphics.prototype._generateCachedSprite=function(){var t,e,i=this.getLocalBounds();this._cachedSprite?this._cachedSprite.buffer.resize(i.width,i.height):(t=new PIXI.CanvasBuffer(i.width,i.height),e=PIXI.Texture.fromCanvas(t.canvas),this._cachedSprite=new PIXI.Sprite(e),this._cachedSprite.buffer=t,this._cachedSprite.worldTransform=this.worldTransform),this._cachedSprite.anchor.x=-i.x/i.width,this._cachedSprite.anchor.y=-i.y/i.height,this._cachedSprite.buffer.context.translate(-i.x,-i.y),this.worldAlpha=1,PIXI.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},PIXI.Graphics.prototype.updateCachedSpriteTexture=function(){var t=this._cachedSprite,e=t.texture,i=t.buffer.canvas;e.baseTexture.width=i.width,e.baseTexture.height=i.height,e.crop.width=e.frame.width=i.width,e.crop.height=e.frame.height=i.height,t._width=i.width,t._height=i.height,e.baseTexture.dirty()},PIXI.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},PIXI.Graphics.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null,t instanceof U.Polygon&&(t=t.clone()).flatten();t=new PIXI.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,t);return this.graphicsData.push(t),t.type===PIXI.Graphics.POLY&&(t.shape.closed=this.filling,this.currentPath=t),this.dirty=!0,this._boundsDirty=!0,t},Object.defineProperty(PIXI.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap=t,this._cacheAsBitmap?this._generateCachedSprite():this.destroyCachedSprite(),this.dirty=!0,this.webGLDirty=!0}}),PIXI.GraphicsData=function(t,e,i,n,r,s,o){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this._lineTint=e,this.fillColor=n,this.fillAlpha=r,this._fillTint=n,this.fill=s,this.shape=o,this.type=o.type},PIXI.GraphicsData.prototype.constructor=PIXI.GraphicsData,PIXI.GraphicsData.prototype.clone=function(){return new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},PIXI.EarCut={},PIXI.EarCut.Triangulate=function(t,e,i){i=i||2;var n,r,s,o,a,l,p,h=e&&e.length,u=h?e[0]*i:t.length,c=PIXI.EarCut.linkedList(t,0,u,i,!0),d=[];if(!c)return d;if(h&&(c=PIXI.EarCut.eliminateHoles(t,e,c,i)),t.length>80*i){n=s=t[0],r=o=t[1];for(var _=i;_<u;_+=i)(a=t[_])<n&&(n=a),(l=t[_+1])<r&&(r=l),s<a&&(s=a),o<l&&(o=l);p=Math.max(s-n,o-r)}return PIXI.EarCut.earcutLinked(c,d,i,n,r,p),d},PIXI.EarCut.linkedList=function(t,e,i,n,r){for(var s,o=0,a=e,l=i-n;a<i;a+=n)o+=(t[l]-t[a])*(t[a+1]+t[l+1]),l=a;if(r===0<o)for(a=e;a<i;a+=n)s=PIXI.EarCut.insertNode(a,t[a],t[a+1],s);else for(a=i-n;e<=a;a-=n)s=PIXI.EarCut.insertNode(a,t[a],t[a+1],s);return s},PIXI.EarCut.filterPoints=function(t,e){if(!t)return t;e=e||t;var i,n=t;do{if(i=!1,n.steiner||!PIXI.EarCut.equals(n,n.next)&&0!==PIXI.EarCut.area(n.prev,n,n.next))n=n.next;else{if(PIXI.EarCut.removeNode(n),(n=e=n.prev)===n.next)return null;i=!0}}while(i||n!==e);return e},PIXI.EarCut.earcutLinked=function(t,e,i,n,r,s,o){if(t){!o&&s&&PIXI.EarCut.indexCurve(t,n,r,s);for(var a,l,p=t;t.prev!==t.next;)if(a=t.prev,l=t.next,s?PIXI.EarCut.isEarHashed(t,n,r,s):PIXI.EarCut.isEar(t))e.push(a.i/i),e.push(t.i/i),e.push(l.i/i),PIXI.EarCut.removeNode(t),t=l.next,p=l.next;else if((t=l)===p){o?1===o?(t=PIXI.EarCut.cureLocalIntersections(t,e,i),PIXI.EarCut.earcutLinked(t,e,i,n,r,s,2)):2===o&&PIXI.EarCut.splitEarcut(t,e,i,n,r,s):PIXI.EarCut.earcutLinked(PIXI.EarCut.filterPoints(t),e,i,n,r,s,1);break}}},PIXI.EarCut.isEar=function(t){var e=t.prev,i=t,n=t.next;if(0<=PIXI.EarCut.area(e,i,n))return!1;for(var r=t.next.next;r!==t.prev;){if(PIXI.EarCut.pointInTriangle(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&0<=PIXI.EarCut.area(r.prev,r,r.next))return!1;r=r.next}return!0},PIXI.EarCut.isEarHashed=function(t,e,i,n){var r=t.prev,s=t,o=t.next;if(0<=PIXI.EarCut.area(r,s,o))return!1;for(var a=(r.x<s.x?r.x<o.x?r:o:s.x<o.x?s:o).x,l=(r.y<s.y?r.y<o.y?r:o:s.y<o.y?s:o).y,p=(r.x>s.x?r.x>o.x?r:o:s.x>o.x?s:o).x,h=(r.y>s.y?r.y>o.y?r:o:s.y>o.y?s:o).y,u=PIXI.EarCut.zOrder(a,l,e,i,n),c=PIXI.EarCut.zOrder(p,h,e,i,n),d=t.nextZ;d&&d.z<=c;){if(d!==t.prev&&d!==t.next&&PIXI.EarCut.pointInTriangle(r.x,r.y,s.x,s.y,o.x,o.y,d.x,d.y)&&0<=PIXI.EarCut.area(d.prev,d,d.next))return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&PIXI.EarCut.pointInTriangle(r.x,r.y,s.x,s.y,o.x,o.y,d.x,d.y)&&0<=PIXI.EarCut.area(d.prev,d,d.next))return!1;d=d.prevZ}return!0},PIXI.EarCut.cureLocalIntersections=function(t,e,i){var n=t;do{var r=n.prev,s=n.next.next}while(PIXI.EarCut.intersects(r,n,n.next,s)&&PIXI.EarCut.locallyInside(r,s)&&PIXI.EarCut.locallyInside(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),PIXI.EarCut.removeNode(n),PIXI.EarCut.removeNode(n.next),n=t=s),(n=n.next)!==t);return n},PIXI.EarCut.splitEarcut=function(t,e,i,n,r,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&PIXI.EarCut.isValidDiagonal(o,a)){var l=PIXI.EarCut.splitPolygon(o,a),o=PIXI.EarCut.filterPoints(o,o.next),l=PIXI.EarCut.filterPoints(l,l.next);return PIXI.EarCut.earcutLinked(o,e,i,n,r,s),void PIXI.EarCut.earcutLinked(l,e,i,n,r,s)}a=a.next}}while((o=o.next)!==t)},PIXI.EarCut.eliminateHoles=function(t,e,i,n){for(var r,s,o=[],a=0,l=e.length;a<l;a++)r=e[a]*n,s=a<l-1?e[a+1]*n:t.length,(s=PIXI.EarCut.linkedList(t,r,s,n,!1))===s.next&&(s.steiner=!0),o.push(PIXI.EarCut.getLeftmost(s));for(o.sort(compareX),a=0;a<o.length;a++)PIXI.EarCut.eliminateHole(o[a],i),i=PIXI.EarCut.filterPoints(i,i.next);return i},PIXI.EarCut.compareX=function(t,e){return t.x-e.x},PIXI.EarCut.eliminateHole=function(t,e){(e=PIXI.EarCut.findHoleBridge(t,e))&&(t=PIXI.EarCut.splitPolygon(e,t),PIXI.EarCut.filterPoints(t,t.next))},PIXI.EarCut.findHoleBridge=function(t,e){var i,n,r=e,s=t.x,o=t.y,a=-1/0;do{}while(o<=r.y&&o>=r.next.y&&((n=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y))<=s&&a<n&&(a=n,i=r.x<r.next.x?r:r.next)),(r=r.next)!==e);if(!i)return null;if(t.x===i.x)return i.prev;for(var l,p=i,h=1/0,r=i.next;r!==p;)s>=r.x&&r.x>=i.x&&PIXI.EarCut.pointInTriangle(o<i.y?s:a,o,i.x,i.y,o<i.y?a:s,o,r.x,r.y)&&((l=Math.abs(o-r.y)/(s-r.x))<h||l===h&&r.x>i.x)&&PIXI.EarCut.locallyInside(r,t)&&(i=r,h=l),r=r.next;return i},PIXI.EarCut.indexCurve=function(t,e,i,n){for(var r=t;null===r.z&&(r.z=PIXI.EarCut.zOrder(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next,r!==t;);r.prevZ.nextZ=null,r.prevZ=null,PIXI.EarCut.sortLinked(r)},PIXI.EarCut.sortLinked=function(t){var e,i,n,r,s,o,a,l,p=1;do{for(i=t,s=t=null,o=0;i;){for(o++,n=i,e=a=0;e<p&&(a++,n=n.nextZ);e++);for(l=p;0<a||0<l&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(i=(r=i).nextZ,a--):(n=(r=n).nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}}while(s.nextZ=null,p*=2,1<o);return t},PIXI.EarCut.zOrder=function(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)/r)|e<<8))|e<<4))|e<<2))|e<<1))<<1},PIXI.EarCut.getLeftmost=function(t){for(var e=t,i=t;e.x<i.x&&(i=e),e=e.next,e!==t;);return i},PIXI.EarCut.pointInTriangle=function(t,e,i,n,r,s,o,a){return 0<=(r-o)*(e-a)-(t-o)*(s-a)&&0<=(t-o)*(n-a)-(i-o)*(e-a)&&0<=(i-o)*(s-a)-(r-o)*(n-a)},PIXI.EarCut.isValidDiagonal=function(t,e){return PIXI.EarCut.equals(t,e)||t.next.i!==e.i&&t.prev.i!==e.i&&!PIXI.EarCut.intersectsPolygon(t,e)&&PIXI.EarCut.locallyInside(t,e)&&PIXI.EarCut.locallyInside(e,t)&&PIXI.EarCut.middleInside(t,e)},PIXI.EarCut.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)},PIXI.EarCut.equals=function(t,e){return t.x===e.x&&t.y===e.y},PIXI.EarCut.intersects=function(t,e,i,n){return 0<PIXI.EarCut.area(t,e,i)!=0<PIXI.EarCut.area(t,e,n)&&0<PIXI.EarCut.area(i,n,t)!=0<PIXI.EarCut.area(i,n,e)},PIXI.EarCut.intersectsPolygon=function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&PIXI.EarCut.intersects(i,i.next,t,e))return!0}while((i=i.next)!==t);return!1},PIXI.EarCut.locallyInside=function(t,e){return PIXI.EarCut.area(t.prev,t,t.next)<0?0<=PIXI.EarCut.area(t,e,t.next)&&0<=PIXI.EarCut.area(t,t.prev,e):PIXI.EarCut.area(t,e,t.prev)<0||PIXI.EarCut.area(t,t.next,e)<0},PIXI.EarCut.middleInside=function(t,e){for(var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;i.y>s!=i.next.y>s&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next,i!==t;);return n},PIXI.EarCut.splitPolygon=function(t,e){var i=new PIXI.EarCut.Node(t.i,t.x,t.y),n=new PIXI.EarCut.Node(e.i,e.x,e.y),r=t.next,s=e.prev;return(t.next=e).prev=t,(i.next=r).prev=i,(n.next=i).prev=n,(s.next=n).prev=s,n},PIXI.EarCut.insertNode=function(t,e,i,n){i=new PIXI.EarCut.Node(t,e,i);return n?(i.next=n.next,(i.prev=n).next.prev=i,n.next=i):(i.prev=i).next=i,i},PIXI.EarCut.removeNode=function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)},PIXI.EarCut.Node=function(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1},PIXI.WebGLGraphics=function(){},PIXI.WebGLGraphics.stencilBufferLimit=6,PIXI.WebGLGraphics.renderGraphics=function(t,e){var i,n=e.gl,r=e.projection,s=e.offset,o=e.shaderManager.primitiveShader;t.dirty&&PIXI.WebGLGraphics.updateGraphics(t,n);for(var a=t._webGL[n.id],l=0;l<a.data.length;l++)1===a.data[l].mode?(i=a.data[l],e.stencilManager.pushStencil(t,i,e),n.drawElements(n.TRIANGLE_FAN,4,n.UNSIGNED_SHORT,2*(i.indices.length-4)),e.stencilManager.popStencil(t,i,e)):(i=a.data[l],e.shaderManager.setShader(o),o=e.shaderManager.primitiveShader,n.uniformMatrix3fv(o.translationMatrix,!1,t.worldTransform.toArray(!0)),n.uniform1f(o.flipY,1),n.uniform2f(o.projectionVector,r.x,-r.y),n.uniform2f(o.offsetVector,-s.x,-s.y),n.uniform3fv(o.tintColor,PIXI.hex2rgb(t.tint)),n.uniform1f(o.alpha,t.worldAlpha),n.bindBuffer(n.ARRAY_BUFFER,i.buffer),n.vertexAttribPointer(o.aVertexPosition,2,n.FLOAT,!1,24,0),n.vertexAttribPointer(o.colorAttribute,4,n.FLOAT,!1,24,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.indexBuffer),n.drawElements(n.TRIANGLE_STRIP,i.indices.length,n.UNSIGNED_SHORT,0))},PIXI.WebGLGraphics.updateGraphics=function(t,e){var i,n=(n=t._webGL[e.id])||(t._webGL[e.id]={lastIndex:0,data:[],gl:e});if(t.dirty=!1,t.clearDirty){for(t.clearDirty=!1,i=0;i<n.data.length;i++){var r=n.data[i];r.reset(),PIXI.WebGLGraphics.graphicsDataPool.push(r)}n.data=[],n.lastIndex=0}for(i=n.lastIndex;i<t.graphicsData.length;i++){var s,o=t.graphicsData[i];o.type===PIXI.Graphics.POLY?(o.points=o.shape.points.slice(),o.shape.closed&&(o.points[0]===o.points[o.points.length-2]&&o.points[1]===o.points[o.points.length-1]||o.points.push(o.points[0],o.points[1])),o.fill&&o.points.length>=PIXI.WebGLGraphics.stencilBufferLimit&&(o.points.length<2*PIXI.WebGLGraphics.stencilBufferLimit?(s=PIXI.WebGLGraphics.switchMode(n,0),PIXI.WebGLGraphics.buildPoly(o,s)||(s=PIXI.WebGLGraphics.switchMode(n,1),PIXI.WebGLGraphics.buildComplexPoly(o,s))):(s=PIXI.WebGLGraphics.switchMode(n,1),PIXI.WebGLGraphics.buildComplexPoly(o,s))),0<o.lineWidth&&(s=PIXI.WebGLGraphics.switchMode(n,0),PIXI.WebGLGraphics.buildLine(o,s))):(s=PIXI.WebGLGraphics.switchMode(n,0),o.type===PIXI.Graphics.RECT?PIXI.WebGLGraphics.buildRectangle(o,s):o.type===PIXI.Graphics.CIRC||o.type===PIXI.Graphics.ELIP?PIXI.WebGLGraphics.buildCircle(o,s):o.type===PIXI.Graphics.RREC&&PIXI.WebGLGraphics.buildRoundedRectangle(o,s)),n.lastIndex++}for(i=0;i<n.data.length;i++)(s=n.data[i]).dirty&&s.upload()},PIXI.WebGLGraphics.switchMode=function(t,e){var i;return t.data.length?(i=t.data[t.data.length-1]).mode===e&&1!==e||((i=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(t.gl)).mode=e,t.data.push(i)):((i=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(t.gl)).mode=e,t.data.push(i)),i.dirty=!0,i},PIXI.WebGLGraphics.buildRectangle=function(t,e){var i,n,r,s,o,a,l=t.shape,p=l.x,h=l.y,u=l.width,c=l.height;t.fill&&(a=PIXI.hex2rgb(t.fillColor),i=t.fillAlpha,n=a[0]*i,r=a[1]*i,s=a[2]*i,o=e.points,l=e.indices,a=o.length/6,o.push(p,h),o.push(n,r,s,i),o.push(p+u,h),o.push(n,r,s,i),o.push(p,h+c),o.push(n,r,s,i),o.push(p+u,h+c),o.push(n,r,s,i),l.push(a,a,1+a,2+a,3+a,3+a)),t.lineWidth&&(a=t.points,t.points=[p,h,p+u,h,p+u,h+c,p,h+c,p,h],PIXI.WebGLGraphics.buildLine(t,e),t.points=a)},PIXI.WebGLGraphics.buildRoundedRectangle=function(t,e){var i=t.shape,n=i.x,r=i.y,s=i.width,o=i.height,i=i.radius,a=[];if(a.push(n,r+i),a=(a=(a=(a=a.concat(PIXI.WebGLGraphics.quadraticBezierCurve(n,r+o-i,n,r+o,n+i,r+o))).concat(PIXI.WebGLGraphics.quadraticBezierCurve(n+s-i,r+o,n+s,r+o,n+s,r+o-i))).concat(PIXI.WebGLGraphics.quadraticBezierCurve(n+s,r+i,n+s,r,n+s-i,r))).concat(PIXI.WebGLGraphics.quadraticBezierCurve(n+i,r,n,r,n,r+i)),t.fill){for(var l=PIXI.hex2rgb(t.fillColor),p=t.fillAlpha,h=l[0]*p,u=l[1]*p,c=l[2]*p,d=e.points,_=e.indices,y=d.length/6,f=PIXI.EarCut.Triangulate(a,null,2),m=0,m=0;m<f.length;m+=3)_.push(f[m]+y),_.push(f[m]+y),_.push(f[m+1]+y),_.push(f[m+2]+y),_.push(f[m+2]+y);for(m=0;m<a.length;m++)d.push(a[m],a[++m],h,u,c,p)}t.lineWidth&&(l=t.points,t.points=a,PIXI.WebGLGraphics.buildLine(t,e),t.points=l)},PIXI.WebGLGraphics.quadraticBezierCurve=function(t,e,i,n,r,s){function o(t,e,i){return t+(e-t)*i}for(var a,l,p,h,u,c=[],d=0;d<=20;d++)a=o(t,i,u=d/20),l=o(e,n,u),p=o(i,r,u),h=o(n,s,u),p=o(a,p,u),h=o(l,h,u),c.push(p,h);return c},PIXI.WebGLGraphics.buildCircle=function(t,e){var i,n=t.shape,r=n.x,s=n.y,o=t.type===PIXI.Graphics.CIRC?(i=n.radius,n.radius):(i=n.width,n.height),a=2*Math.PI/40,l=0;if(t.fill){var p=PIXI.hex2rgb(t.fillColor),h=t.fillAlpha,u=p[0]*h,c=p[1]*h,d=p[2]*h,_=e.points,y=e.indices,f=_.length/6;for(y.push(f),l=0;l<41;l++)_.push(r,s,u,c,d,h),_.push(r+Math.sin(a*l)*i,s+Math.cos(a*l)*o,u,c,d,h),y.push(f++,f++);y.push(f-1)}if(t.lineWidth){p=t.points;for(t.points=[],l=0;l<41;l++)t.points.push(r+Math.sin(a*l)*i,s+Math.cos(a*l)*o);PIXI.WebGLGraphics.buildLine(t,e),t.points=p}},PIXI.WebGLGraphics.buildLine=function(t,e){var i=0,n=t.points;if(0!==n.length){if(t.lineWidth%2)for(i=0;i<n.length;i++)n[i]+=.5;var r,s=new PIXI.Point(n[0],n[1]),o=new PIXI.Point(n[n.length-2],n[n.length-1]);s.x===o.x&&s.y===o.y&&((n=n.slice()).pop(),n.pop(),r=(o=new PIXI.Point(n[n.length-2],n[n.length-1])).x+.5*(s.x-o.x),o=o.y+.5*(s.y-o.y),n.unshift(r,o),n.push(r,o));var a,l,p,h,u,c,d,_,y,f=e.points,m=e.indices,x=n.length/2,v=n.length,g=f.length/6,b=t.lineWidth/2,e=PIXI.hex2rgb(t.lineColor),z=t.lineAlpha,w=e[0]*z,C=e[1]*z,P=e[2]*z,T=n[0],S=n[1],M=n[2],A=n[3],O=-(S-A),k=T-M,E=Math.sqrt(O*O+k*k);for(O/=E,k/=E,O*=b,k*=b,f.push(T-O,S-k,w,C,P,z),f.push(T+O,S+k,w,C,P,z),i=1;i<x-1;i++)T=n[2*(i-1)],S=n[2*(i-1)+1],M=n[2*i],A=n[2*i+1],h=n[2*(i+1)],y=n[2*(i+1)+1],O=-(S-A),k=T-M,O/=E=Math.sqrt(O*O+k*k),k/=E,O*=b,k*=b,a=-(A-y),l=M-h,a/=E=Math.sqrt(a*a+l*l),l/=E,u=(-O+T)*(-k+A)-(-O+M)*(-k+S),_=(-(a*=b)+h)*(-(l*=b)+A)-(-a+M)*(-l+y),y=(p=-k+S-(-k+A))*(d=-a+M-(-a+h))-(c=-l+y-(-l+A))*(h=-O+M-(-O+T)),Math.abs(y)<.1?(y+=10.1,f.push(M-O,A-k,w,C,P,z),f.push(M+O,A+k,w,C,P,z)):19600<((d=(h*_-d*u)/y)-M)*(d-M)+((y=(c*u-p*_)/y)-A)+(y-A)?(a=O-a,l=k-l,a/=E=Math.sqrt(a*a+l*l),l/=E,a*=b,l*=b,f.push(M-a,A-l),f.push(w,C,P,z),f.push(M+a,A+l),f.push(w,C,P,z),f.push(M-a,A-l),f.push(w,C,P,z),v++):(f.push(d,y),f.push(w,C,P,z),f.push(M-(d-M),A-(y-A)),f.push(w,C,P,z));for(T=n[2*(x-2)],S=n[2*(x-2)+1],M=n[2*(x-1)],O=-(S-(A=n[2*(x-1)+1])),k=T-M,O/=E=Math.sqrt(O*O+k*k),k/=E,O*=b,k*=b,f.push(M-O,A-k),f.push(w,C,P,z),f.push(M+O,A+k),f.push(w,C,P,z),m.push(g),i=0;i<v;i++)m.push(g++);m.push(g-1)}},PIXI.WebGLGraphics.buildComplexPoly=function(t,e){var i=t.points.slice();if(!(i.length<6)){var n=e.indices;e.points=i,e.alpha=t.fillAlpha,e.color=PIXI.hex2rgb(t.fillColor);for(var r,s=1/0,o=-1/0,a=1/0,l=-1/0,p=0;p<i.length;p+=2)s=(r=i[p])<s?r:s,o=o<r?r:o,a=(r=i[p+1])<a?r:a,l=l<r?r:l;i.push(s,a,o,a,o,l,s,l);for(var h=i.length/2,p=0;p<h;p++)n.push(p)}},PIXI.WebGLGraphics.buildPoly=function(t,e){var i=t.points;if(!(i.length<6)){var n=e.points,r=e.indices,s=i.length/2,e=PIXI.hex2rgb(t.fillColor),o=t.fillAlpha,a=e[0]*o,l=e[1]*o,p=e[2]*o,h=PIXI.EarCut.Triangulate(i,null,2);if(!h)return!1;for(var u=n.length/6,c=0,c=0;c<h.length;c+=3)r.push(h[c]+u),r.push(h[c]+u),r.push(h[c+1]+u),r.push(h[c+2]+u),r.push(h[c+2]+u);for(c=0;c<s;c++)n.push(i[2*c],i[2*c+1],a,l,p,o);return!0}},PIXI.WebGLGraphics.graphicsDataPool=[],PIXI.WebGLGraphicsData=function(t){this.gl=t,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},PIXI.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[]},PIXI.WebGLGraphicsData.prototype.upload=function(){var t=this.gl;this.glPoints=new PIXI.Float32Array(this.points),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.glPoints,t.STATIC_DRAW),this.glIndicies=new PIXI.Uint16Array(this.indices),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.glIndicies,t.STATIC_DRAW),this.dirty=!1},PIXI.CanvasGraphics=function(){},PIXI.CanvasGraphics.renderGraphics=function(t,e){var i=t.worldAlpha;t.dirty&&(this.updateGraphicsTint(t),t.dirty=!1);for(var n=0;n<t.graphicsData.length;n++){var r,s,o,a,l,p,h,u,c=t.graphicsData[n],d=c.shape,_=c._fillTint,y=c._lineTint;if(e.lineWidth=c.lineWidth,c.type===PIXI.Graphics.POLY){e.beginPath();var f=d.points;e.moveTo(f[0],f[1]);for(var m=1;m<f.length/2;m++)e.lineTo(f[2*m],f[2*m+1]);d.closed&&e.lineTo(f[0],f[1]),f[0]===f[f.length-2]&&f[1]===f[f.length-1]&&e.closePath(),c.fill&&(e.globalAlpha=c.fillAlpha*i,e.fillStyle="#"+("00000"+(0|_).toString(16)).substr(-6),e.fill()),c.lineWidth&&(e.globalAlpha=c.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|y).toString(16)).substr(-6),e.stroke())}else c.type===PIXI.Graphics.RECT?(!c.fillColor&&0!==c.fillColor||(e.globalAlpha=c.fillAlpha*i,e.fillStyle="#"+("00000"+(0|_).toString(16)).substr(-6),e.fillRect(d.x,d.y,d.width,d.height)),c.lineWidth&&(e.globalAlpha=c.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|y).toString(16)).substr(-6),e.strokeRect(d.x,d.y,d.width,d.height))):c.type===PIXI.Graphics.CIRC?(e.beginPath(),e.arc(d.x,d.y,d.radius,0,2*Math.PI),e.closePath(),c.fill&&(e.globalAlpha=c.fillAlpha*i,e.fillStyle="#"+("00000"+(0|_).toString(16)).substr(-6),e.fill()),c.lineWidth&&(e.globalAlpha=c.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|y).toString(16)).substr(-6),e.stroke())):c.type===PIXI.Graphics.ELIP?(o=2*d.width,u=2*d.height,h=d.x-o/2,r=d.y-u/2,e.beginPath(),a=o/2*.5522848,p=u/2*.5522848,s=h+o,l=r+u,o=h+o/2,u=r+u/2,e.moveTo(h,u),e.bezierCurveTo(h,u-p,o-a,r,o,r),e.bezierCurveTo(o+a,r,s,u-p,s,u),e.bezierCurveTo(s,u+p,o+a,l,o,l),e.bezierCurveTo(o-a,l,h,u+p,h,u),e.closePath(),c.fill&&(e.globalAlpha=c.fillAlpha*i,e.fillStyle="#"+("00000"+(0|_).toString(16)).substr(-6),e.fill()),c.lineWidth&&(e.globalAlpha=c.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|y).toString(16)).substr(-6),e.stroke())):c.type===PIXI.Graphics.RREC&&(a=d.x,l=d.y,p=d.width,h=d.height,u=d.radius,u=(d=Math.min(p,h)/2|0)<u?d:u,e.beginPath(),e.moveTo(a,l+u),e.lineTo(a,l+h-u),e.quadraticCurveTo(a,l+h,a+u,l+h),e.lineTo(a+p-u,l+h),e.quadraticCurveTo(a+p,l+h,a+p,l+h-u),e.lineTo(a+p,l+u),e.quadraticCurveTo(a+p,l,a+p-u,l),e.lineTo(a+u,l),e.quadraticCurveTo(a,l,a,l+u),e.closePath(),!c.fillColor&&0!==c.fillColor||(e.globalAlpha=c.fillAlpha*i,e.fillStyle="#"+("00000"+(0|_).toString(16)).substr(-6),e.fill()),c.lineWidth&&(e.globalAlpha=c.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|y).toString(16)).substr(-6),e.stroke()))}},PIXI.CanvasGraphics.renderGraphicsMask=function(t,e){var i=t.graphicsData.length;if(0!==i){e.beginPath();for(var n=0;n<i;n++){var r,s,o,a,l,p,h,u,c=t.graphicsData[n],d=c.shape;if(c.type===PIXI.Graphics.POLY){var _=d.points;e.moveTo(_[0],_[1]);for(var y=1;y<_.length/2;y++)e.lineTo(_[2*y],_[2*y+1]);_[0]===_[_.length-2]&&_[1]===_[_.length-1]&&e.closePath()}else c.type===PIXI.Graphics.RECT?(e.rect(d.x,d.y,d.width,d.height),e.closePath()):c.type===PIXI.Graphics.CIRC?(e.arc(d.x,d.y,d.radius,0,2*Math.PI),e.closePath()):c.type===PIXI.Graphics.ELIP?(s=(a=2*d.width)/2*.5522848,p=(u=2*d.height)/2*.5522848,o=(h=d.x-a/2)+a,l=(r=d.y-u/2)+u,a=h+a/2,u=r+u/2,e.moveTo(h,u),e.bezierCurveTo(h,u-p,a-s,r,a,r),e.bezierCurveTo(a+s,r,o,u-p,o,u),e.bezierCurveTo(o,u+p,a+s,l,a,l),e.bezierCurveTo(a-s,l,h,u+p,h,u),e.closePath()):c.type===PIXI.Graphics.RREC&&(l=d.x,p=d.y,h=d.width,u=d.height,c=d.radius,c=(d=Math.min(h,u)/2|0)<c?d:c,e.moveTo(l,p+c),e.lineTo(l,p+u-c),e.quadraticCurveTo(l,p+u,l+c,p+u),e.lineTo(l+h-c,p+u),e.quadraticCurveTo(l+h,p+u,l+h,p+u-c),e.lineTo(l+h,p+c),e.quadraticCurveTo(l+h,p,l+h-c,p),e.lineTo(l+c,p),e.quadraticCurveTo(l,p,l,p+c),e.closePath())}}},PIXI.CanvasGraphics.updateGraphicsTint=function(t){if(16777215!==t.tint)for(var e=(t.tint>>16&255)/255,i=(t.tint>>8&255)/255,n=(255&t.tint)/255,r=0;r<t.graphicsData.length;r++){var s=t.graphicsData[r],o=0|s.fillColor,a=0|s.lineColor;s._fillTint=((o>>16&255)/255*e*255<<16)+((o>>8&255)/255*i*255<<8)+(255&o)/255*n*255,s._lineTint=((a>>16&255)/255*e*255<<16)+((a>>8&255)/255*i*255<<8)+(255&a)/255*n*255}},U.Graphics=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this.type=U.GRAPHICS,this.physicsType=U.SPRITE,this.anchor=new U.Point,PIXI.Graphics.call(this),U.Component.Core.init.call(this,t,e,i,"",null)},U.Graphics.prototype=Object.create(PIXI.Graphics.prototype),U.Graphics.prototype.constructor=U.Graphics,U.Component.Core.install.call(U.Graphics.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]),U.Graphics.prototype.preUpdatePhysics=U.Component.PhysicsBody.preUpdate,U.Graphics.prototype.preUpdateLifeSpan=U.Component.LifeSpan.preUpdate,U.Graphics.prototype.preUpdateInWorld=U.Component.InWorld.preUpdate,U.Graphics.prototype.preUpdateCore=U.Component.Core.preUpdate,U.Graphics.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},U.Graphics.prototype.postUpdate=function(){U.Component.PhysicsBody.postUpdate.call(this),U.Component.FixedToCamera.postUpdate.call(this),this._boundsDirty&&(this.updateLocalBounds(),this._boundsDirty=!1);for(var t=0;t<this.children.length;t++)this.children[t].postUpdate()},U.Graphics.prototype.destroy=function(t){this.clear(),U.Component.Destroy.prototype.destroy.call(this,t)},U.Graphics.prototype.drawTriangle=function(t,e){void 0===e&&(e=!1);var i,n=new U.Polygon(t);e?(i=new U.Point(this.game.camera.x-t[0].x,this.game.camera.y-t[0].y),e=new U.Point(t[1].x-t[0].x,t[1].y-t[0].y),e=new U.Point(t[1].x-t[2].x,t[1].y-t[2].y).cross(e),0<i.dot(e)&&this.drawPolygon(n)):this.drawPolygon(n)},U.Graphics.prototype.drawTriangles=function(t,e,i){void 0===i&&(i=!1);var n,r=new U.Point,s=new U.Point,o=new U.Point,a=[];if(e)if(t[0]instanceof U.Point)for(n=0;n<e.length/3;n++)a.push(t[e[3*n]]),a.push(t[e[3*n+1]]),a.push(t[e[3*n+2]]),3===a.length&&(this.drawTriangle(a,i),a=[]);else for(n=0;n<e.length;n++)r.x=t[2*e[n]],r.y=t[2*e[n]+1],a.push(r.copyTo({})),3===a.length&&(this.drawTriangle(a,i),a=[]);else if(t[0]instanceof U.Point)for(n=0;n<t.length/3;n++)this.drawTriangle([t[3*n],t[3*n+1],t[3*n+2]],i);else for(n=0;n<t.length/6;n++)r.x=t[6*n+0],r.y=t[6*n+1],s.x=t[6*n+2],s.y=t[6*n+3],o.x=t[6*n+4],o.y=t[6*n+5],this.drawTriangle([r,s,o],i)},U.RenderTexture=function(t,e,i,n,r,s){void 0===n&&(n=""),void 0===r&&(r=U.scaleModes.DEFAULT),void 0===s&&(s=1),this.game=t,this.key=n,this.type=U.RENDERTEXTURE,this._tempMatrix=new PIXI.Matrix,PIXI.RenderTexture.call(this,e,i,this.game.renderer,r,s),this.render=U.RenderTexture.prototype.render},U.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype),U.RenderTexture.prototype.constructor=U.RenderTexture,U.RenderTexture.prototype.renderXY=function(t,e,i,n){t.updateTransform(),this._tempMatrix.copyFrom(t.worldTransform),this._tempMatrix.tx=e,this._tempMatrix.ty=i,this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(t,this._tempMatrix,n):this.renderCanvas(t,this._tempMatrix,n)},U.RenderTexture.prototype.renderRawXY=function(t,e,i,n){this._tempMatrix.identity().translate(e,i),this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(t,this._tempMatrix,n):this.renderCanvas(t,this._tempMatrix,n)},U.RenderTexture.prototype.render=function(t,e,i){null==e?this._tempMatrix.copyFrom(t.worldTransform):this._tempMatrix.copyFrom(e),this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(t,this._tempMatrix,i):this.renderCanvas(t,this._tempMatrix,i)},U.Text=function(t,e,i,n,r){e=e||0,i=i||0,n=null==n?"":n.toString(),r=U.Utils.extend({},r),this.type=U.TEXT,this.physicsType=U.SPRITE,this.padding=new U.Point,this.textBounds=null,this.canvas=PIXI.CanvasPool.create(this),this.context=this.canvas.getContext("2d"),this.colors=[],this.strokeColors=[],this.fontStyles=[],this.fontWeights=[],this.autoRound=!1,this.useAdvancedWrap=!1,this._res=t.renderer.resolution,this._text=n,this._fontComponents=null,this._lineSpacing=0,this._charCount=0,this._width=0,this._height=0,U.Sprite.call(this,t,e,i,PIXI.Texture.fromCanvas(this.canvas)),this.setStyle(r),""!==n&&this.updateText()},U.Text.prototype=Object.create(U.Sprite.prototype),U.Text.prototype.constructor=U.Text,U.Text.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},U.Text.prototype.update=function(){},U.Text.prototype.destroy=function(t){this.texture.destroy(!0),U.Component.Destroy.prototype.destroy.call(this,t)},U.Text.prototype.setShadow=function(t,e,i,n,r,s){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i="rgba(0, 0, 0, 1)"),void 0===n&&(n=0),void 0===r&&(r=!0),void 0===s&&(s=!0),this.style.shadowOffsetX=t,this.style.shadowOffsetY=e,this.style.shadowColor=i,this.style.shadowBlur=n,this.style.shadowStroke=r,this.style.shadowFill=s,this.dirty=!0,this},U.Text.prototype.setStyle=function(t,e){void 0===e&&(e=!1),(t=t||{}).font=t.font||"bold 20pt Arial",t.backgroundColor=t.backgroundColor||null,t.fill=t.fill||"black",t.align=t.align||"left",t.boundsAlignH=t.boundsAlignH||"left",t.boundsAlignV=t.boundsAlignV||"top",t.stroke=t.stroke||"black",t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.wordWrapWidth=t.wordWrapWidth||100,t.maxLines=t.maxLines||0,t.shadowOffsetX=t.shadowOffsetX||0,t.shadowOffsetY=t.shadowOffsetY||0,t.shadowColor=t.shadowColor||"rgba(0,0,0,0)",t.shadowBlur=t.shadowBlur||0,t.tabs=t.tabs||0;var i=this.fontToComponents(t.font);return t.fontStyle&&(i.fontStyle=t.fontStyle),t.fontVariant&&(i.fontVariant=t.fontVariant),t.fontWeight&&(i.fontWeight=t.fontWeight),t.fontSize&&("number"==typeof t.fontSize&&(t.fontSize=t.fontSize+"px"),i.fontSize=t.fontSize),this._fontComponents=i,t.font=this.componentsToFont(this._fontComponents),this.style=t,this.dirty=!0,e&&this.updateText(),this},U.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font;var t=this.text;this.style.wordWrap&&(t=this.runWordWrap(this.text));var e=t.split(/(?:\r\n|\r|\n)/),i=this.style.tabs,n=[],r=0,s=this.determineFontProperties(this.style.font),o=e.length;0<this.style.maxLines&&this.style.maxLines<e.length&&(o=this.style.maxLines);for(var a=this._charCount=0;a<o;a++){if(0===i){var l=this.style.strokeThickness+this.padding.x;0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?l+=this.measureLine(e[a]):l+=this.context.measureText(e[a]).width,this.style.wordWrap&&(l-=this.context.measureText(" ").width)}else{var p=e[a].split(/(?:\t)/),l=this.padding.x+this.style.strokeThickness;if(Array.isArray(i))for(var h=0,u=0;u<p.length;u++){var c=0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?this.measureLine(p[u]):Math.ceil(this.context.measureText(p[u]).width);0<u&&(h+=i[u-1]),l=h+c}else for(u=0;u<p.length;u++)0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?l+=this.measureLine(p[u]):l+=Math.ceil(this.context.measureText(p[u]).width),l+=this.game.math.snapToCeil(l,i)-l}n[a]=Math.ceil(l),r=Math.max(r,n[a])}this.canvas.width=r*this._res;var d,_,y=s.fontSize+this.style.strokeThickness+this.padding.y,t=y*o,f=this._lineSpacing;for(f<0&&Math.abs(f)>y&&(f=-y),0!==f&&(t+=0<f?f*e.length:f*(e.length-1)),this.canvas.height=t*this._res,this.context.scale(this._res,this._res),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.style.backgroundColor&&(this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.textBaseline="alphabetic",this.context.lineWidth=this.style.strokeThickness,this.context.lineCap="round",this.context.lineJoin="round",a=this._charCount=0;a<o;a++)d=this.style.strokeThickness/2,_=this.style.strokeThickness/2+a*y+s.ascent,0<a&&(_+=f*a),"right"===this.style.align?d+=r-n[a]:"center"===this.style.align&&(d+=(r-n[a])/2),this.autoRound&&(d=Math.round(d),_=Math.round(_)),0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?this.updateLine(e[a],d,_):(this.style.stroke&&this.style.strokeThickness&&(this.updateShadow(this.style.shadowStroke),0===i?this.context.strokeText(e[a],d,_):this.renderTabLine(e[a],d,_,!1)),this.style.fill&&(this.updateShadow(this.style.shadowFill),0===i?this.context.fillText(e[a],d,_):this.renderTabLine(e[a],d,_,!0)));this.updateTexture(),this.dirty=!1},U.Text.prototype.renderTabLine=function(t,e,i,n){var r=t.split(/(?:\t)/),s=this.style.tabs,o=0;if(Array.isArray(s))for(var a=0,l=0;l<r.length;l++)0<l&&(a+=s[l-1]),o=e+a,n?this.context.fillText(r[l],o,i):this.context.strokeText(r[l],o,i);else for(l=0;l<r.length;l++){var p=Math.ceil(this.context.measureText(r[l]).width),o=this.game.math.snapToCeil(e,s);n?this.context.fillText(r[l],o,i):this.context.strokeText(r[l],o,i),e=o+p}},U.Text.prototype.updateShadow=function(t){t?(this.context.shadowOffsetX=this.style.shadowOffsetX,this.context.shadowOffsetY=this.style.shadowOffsetY,this.context.shadowColor=this.style.shadowColor,this.context.shadowBlur=this.style.shadowBlur):(this.context.shadowOffsetX=0,this.context.shadowOffsetY=0,this.context.shadowColor=0,this.context.shadowBlur=0)},U.Text.prototype.measureLine=function(t){for(var e=0,i=0;i<t.length;i++){var n,r=t[i];(0<this.fontWeights.length||0<this.fontStyles.length)&&(n=this.fontToComponents(this.context.font),this.fontStyles[this._charCount]&&(n.fontStyle=this.fontStyles[this._charCount]),this.fontWeights[this._charCount]&&(n.fontWeight=this.fontWeights[this._charCount]),this.context.font=this.componentsToFont(n)),this.style.stroke&&this.style.strokeThickness&&(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),this.updateShadow(this.style.shadowStroke)),this.style.fill&&(this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount]),this.updateShadow(this.style.shadowFill)),e+=this.context.measureText(r).width,this._charCount++}return Math.ceil(e)},U.Text.prototype.updateLine=function(t,e,i){for(var n=0;n<t.length;n++){var r,s=t[n];(0<this.fontWeights.length||0<this.fontStyles.length)&&(r=this.fontToComponents(this.context.font),this.fontStyles[this._charCount]&&(r.fontStyle=this.fontStyles[this._charCount]),this.fontWeights[this._charCount]&&(r.fontWeight=this.fontWeights[this._charCount]),this.context.font=this.componentsToFont(r)),this.style.stroke&&this.style.strokeThickness&&(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),this.updateShadow(this.style.shadowStroke),this.context.strokeText(s,e,i)),this.style.fill&&(this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount]),this.updateShadow(this.style.shadowFill),this.context.fillText(s,e,i)),e+=this.context.measureText(s).width,this._charCount++}},U.Text.prototype.clearColors=function(){return this.colors=[],this.strokeColors=[],this.dirty=!0,this},U.Text.prototype.clearFontValues=function(){return this.fontStyles=[],this.fontWeights=[],this.dirty=!0,this},U.Text.prototype.addColor=function(t,e){return this.colors[e]=t,this.dirty=!0,this},U.Text.prototype.addStrokeColor=function(t,e){return this.strokeColors[e]=t,this.dirty=!0,this},U.Text.prototype.addFontStyle=function(t,e){return this.fontStyles[e]=t,this.dirty=!0,this},U.Text.prototype.addFontWeight=function(t,e){return this.fontWeights[e]=t,this.dirty=!0,this},U.Text.prototype.precalculateWordWrap=function(t){return this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font,this.runWordWrap(t).split(/(?:\r\n|\r|\n)/)},U.Text.prototype.runWordWrap=function(t){return this.useAdvancedWrap?this.advancedWordWrap(t):this.basicWordWrap(t)},U.Text.prototype.advancedWordWrap=function(t){for(var e=this.context,i=this.style.wordWrapWidth,n="",r=t.replace(/ +/gi," ").split(/\r?\n/gi),s=r.length,o=0;o<s;o++){var a="",l=(l=r[o]).replace(/^ *|\s*$/gi,"");if(e.measureText(l).width<i)n+=l+"\n";else{for(var p=i,h=l.split(" "),u=0;u<h.length;u++){var c=h[u],d=c+" ",_=e.measureText(d).width;if(p<_){if(0===u){for(var y=d;y.length&&(y=y.slice(0,-1),!((_=e.measureText(y).width)<=p)););if(!y.length)throw new Error("This text's wordWrapWidth setting is less than a single character!");var f=c.substr(y.length);h[u]=f,a+=y}f=h[u].length?u:u+1,f=h.slice(f).join(" ").replace(/[ \n]*$/gi,"");r[o+1]=f+" "+(r[o+1]||""),s=r.length;break}a+=d,p-=_}n+=a.replace(/[ \n]*$/gi,"")+"\n"}}return n.replace(/[\s|\n]*$/gi,"")},U.Text.prototype.basicWordWrap=function(t){for(var e="",i=t.split("\n"),n=0;n<i.length;n++){for(var r=this.style.wordWrapWidth,s=i[n].split(" "),o=0;o<s.length;o++){var a=this.context.measureText(s[o]).width,l=a+this.context.measureText(" ").width;r<l?(0<o&&(e+="\n"),e+=s[o]+" ",r=this.style.wordWrapWidth-a):(r-=l,e+=s[o]+" ")}n<i.length-1&&(e+="\n")}return e},U.Text.prototype.updateFont=function(t){t=this.componentsToFont(t);this.style.font!==t&&(this.style.font=t,this.dirty=!0,this.parent&&this.updateTransform())},U.Text.prototype.fontToComponents=function(t){var e=t.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);if(e){var i=e[5].trim();return/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(i)||/['",]/.exec(i)||(i="'"+i+"'"),{font:t,fontStyle:e[1]||"normal",fontVariant:e[2]||"normal",fontWeight:e[3]||"normal",fontSize:e[4]||"medium",fontFamily:i}}return{font:t}},U.Text.prototype.componentsToFont=function(t){var e=[],i=t.fontStyle;return i&&"normal"!==i&&e.push(i),(i=t.fontVariant)&&"normal"!==i&&e.push(i),(i=t.fontWeight)&&"normal"!==i&&e.push(i),(i=t.fontSize)&&"medium"!==i&&e.push(i),(i=t.fontFamily)&&e.push(i),e.length||e.push(t.font),e.join(" ")},U.Text.prototype.setText=function(t,e){return void 0===e&&(e=!1),this.text=t.toString()||"",e?this.updateText():this.dirty=!0,this},U.Text.prototype.parseList=function(t){if(!Array.isArray(t))return this;for(var e="",i=0;i<t.length;i++)Array.isArray(t[i])?(e+=t[i].join("\t"),i<t.length-1&&(e+="\n")):(e+=t[i],i<t.length-1&&(e+="\t"));return this.text=e,this.dirty=!0,this},U.Text.prototype.setTextBounds=function(t,e,i,n){return void 0===t?this.textBounds=null:(this.textBounds?this.textBounds.setTo(t,e,i,n):this.textBounds=new U.Rectangle(t,e,i,n),this.style.wordWrapWidth>i&&(this.style.wordWrapWidth=i)),this.updateTexture(),this},U.Text.prototype.updateTexture=function(){var t=this.texture.baseTexture,e=this.texture.crop,i=this.texture.frame,n=this.canvas.width,r=this.canvas.height;t.width=n,t.height=r,e.width=n,e.height=r,i.width=n,i.height=r,this.texture.width=n,this.texture.height=r,this._width=n,this._height=r,this.textBounds&&(e=this.textBounds.x,i=this.textBounds.y,"right"===this.style.boundsAlignH?e+=this.textBounds.width-this.canvas.width/this.resolution:"center"===this.style.boundsAlignH&&(e+=this.textBounds.halfWidth-this.canvas.width/this.resolution/2),"bottom"===this.style.boundsAlignV?i+=this.textBounds.height-this.canvas.height/this.resolution:"middle"===this.style.boundsAlignV&&(i+=this.textBounds.halfHeight-this.canvas.height/this.resolution/2),this.pivot.x=-e,this.pivot.y=-i),this.renderable=0!==n&&0!==r,this.texture.requiresReTint=!0,this.texture.baseTexture.dirty()},U.Text.prototype._renderWebGL=function(t){this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype._renderWebGL.call(this,t)},U.Text.prototype._renderCanvas=function(t){this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype._renderCanvas.call(this,t)},U.Text.prototype.determineFontProperties=function(t){var e=U.Text.fontPropertiesCache[t];if(!e){e={};var i=U.Text.fontPropertiesCanvas,n=U.Text.fontPropertiesContext;n.font=t;var r=Math.ceil(n.measureText("|MÃ‰q").width),s=2*(o=Math.ceil(n.measureText("|MÃ‰q").width)),o=1.4*o|0;if(i.width=r,i.height=s,n.fillStyle="#f00",n.fillRect(0,0,r,s),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText("|MÃ‰q",0,o),!n.getImageData(0,0,r,s))return e.ascent=o,e.descent=6+o,e.fontSize=e.ascent+e.descent,U.Text.fontPropertiesCache[t]=e;for(var a,l=n.getImageData(0,0,r,s).data,n=l.length,p=4*r,h=0,u=!1,c=0;c<o;c++){for(a=0;a<p;a+=4)if(255!==l[h+a]){u=!0;break}if(u)break;h+=p}for(e.ascent=o-c,h=n-p,u=!1,c=s;o<c;c--){for(a=0;a<p;a+=4)if(255!==l[h+a]){u=!0;break}if(u)break;h-=p}e.descent=c-o,e.descent+=6,e.fontSize=e.ascent+e.descent,U.Text.fontPropertiesCache[t]=e}return e},U.Text.prototype.getBounds=function(t){return this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype.getBounds.call(this,t)},Object.defineProperty(U.Text.prototype,"text",{get:function(){return this._text},set:function(t){t!==this._text&&(this._text=t.toString()||"",this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(U.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(t){t=t||"bold 20pt Arial",this._fontComponents=this.fontToComponents(t),this.updateFont(this._fontComponents)}}),Object.defineProperty(U.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(t){t=(t=t||"Arial").trim(),/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(t)||/['",]/.exec(t)||(t="'"+t+"'"),this._fontComponents.fontFamily=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(U.Text.prototype,"fontSize",{get:function(){var t=this._fontComponents.fontSize;return t&&/(?:^0$|px$)/.exec(t)?parseInt(t,10):t},set:function(t){"number"==typeof(t=t||"0")&&(t+="px"),this._fontComponents.fontSize=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(U.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(t){t=t||"normal",this._fontComponents.fontWeight=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(U.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(t){t=t||"normal",this._fontComponents.fontStyle=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(U.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(t){t=t||"normal",this._fontComponents.fontVariant=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(U.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(t){t!==this.style.fill&&(this.style.fill=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"align",{get:function(){return this.style.align},set:function(t){t!==this.style.align&&(this.style.align=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"resolution",{get:function(){return this._res},set:function(t){t!==this._res&&(this._res=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"tabs",{get:function(){return this.style.tabs},set:function(t){t!==this.style.tabs&&(this.style.tabs=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"boundsAlignH",{get:function(){return this.style.boundsAlignH},set:function(t){t!==this.style.boundsAlignH&&(this.style.boundsAlignH=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"boundsAlignV",{get:function(){return this.style.boundsAlignV},set:function(t){t!==this.style.boundsAlignV&&(this.style.boundsAlignV=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(t){t!==this.style.stroke&&(this.style.stroke=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(t){t!==this.style.strokeThickness&&(this.style.strokeThickness=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(t){t!==this.style.wordWrap&&(this.style.wordWrap=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(t){t!==this.style.wordWrapWidth&&(this.style.wordWrapWidth=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(t){t!==this._lineSpacing&&(this._lineSpacing=parseFloat(t),this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(U.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(t){t!==this.style.shadowOffsetX&&(this.style.shadowOffsetX=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(t){t!==this.style.shadowOffsetY&&(this.style.shadowOffsetY=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(t){t!==this.style.shadowColor&&(this.style.shadowColor=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(t){t!==this.style.shadowBlur&&(this.style.shadowBlur=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"shadowStroke",{get:function(){return this.style.shadowStroke},set:function(t){t!==this.style.shadowStroke&&(this.style.shadowStroke=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"shadowFill",{get:function(){return this.style.shadowFill},set:function(t){t!==this.style.shadowFill&&(this.style.shadowFill=t,this.dirty=!0)}}),Object.defineProperty(U.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(U.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),U.Text.fontPropertiesCache={},U.Text.fontPropertiesCanvas=document.createElement("canvas"),U.Text.fontPropertiesContext=U.Text.fontPropertiesCanvas.getContext("2d"),U.BitmapText=function(t,e,i,n,r,s,o){e=e||0,i=i||0,n=n||"",r=r||"",s=s||32,o=o||"left",PIXI.DisplayObjectContainer.call(this),this.type=U.BITMAPTEXT,this.physicsType=U.SPRITE,this.textWidth=0,this.textHeight=0,this.anchor=new U.Point,this._prevAnchor=new U.Point,this._glyphs=[],this._maxWidth=0,this._text=r.toString()||"",this._data=t.cache.getBitmapFont(n),this._font=n,this._fontSize=s,this._align=o,this._tint=16777215,this.updateText(),this.dirty=!1,U.Component.Core.init.call(this,t,e,i,"",null)},U.BitmapText.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),U.BitmapText.prototype.constructor=U.BitmapText,U.Component.Core.install.call(U.BitmapText.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]),U.BitmapText.prototype.preUpdatePhysics=U.Component.PhysicsBody.preUpdate,U.BitmapText.prototype.preUpdateLifeSpan=U.Component.LifeSpan.preUpdate,U.BitmapText.prototype.preUpdateInWorld=U.Component.InWorld.preUpdate,U.BitmapText.prototype.preUpdateCore=U.Component.Core.preUpdate,U.BitmapText.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},U.BitmapText.prototype.postUpdate=function(){U.Component.PhysicsBody.postUpdate.call(this),U.Component.FixedToCamera.postUpdate.call(this),this.body&&this.body.type===U.Physics.ARCADE&&(this.textWidth===this.body.sourceWidth&&this.textHeight===this.body.sourceHeight||this.body.setSize(this.textWidth,this.textHeight))},U.BitmapText.prototype.setText=function(t){this.text=t},U.BitmapText.prototype.scanLine=function(t,e,i){for(var n=0,r=0,s=-1,o=0,a=null,l=0<this._maxWidth?this._maxWidth:null,p=[],h=0;h<i.length;h++){var u=h===i.length-1;if(/(?:\r\n|\r|\n)/.test(i.charAt(h)))return{width:r,text:i.substr(0,h),end:u,chars:p};var c,d=i.charCodeAt(h),_=t.chars[d];void 0===_&&(d=32,_=t.chars[d]);var y=a&&_.kerning[a]?_.kerning[a]:0;if(/(\s)/.test(i.charAt(h))&&(s=h,o=r),c=(y+_.texture.width+_.xOffset)*e,l&&l<=r+c&&-1<s)return{width:o||r,text:i.substr(0,h-(h-s)),end:u,chars:p};r+=(_.xAdvance+y)*e,p.push(n+(_.xOffset+y)*e),n+=(_.xAdvance+y)*e,a=d}return{width:r,text:i,end:u,chars:p}},U.BitmapText.prototype.cleanText=function(t,e){void 0===e&&(e="");var i=this._data.font;if(!i)return"";for(var n=t.replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),r=0;r<n.length;r++){for(var s="",o=n[r],a=0;a<o.length;a++)s=i.chars[o.charCodeAt(a)]?s.concat(o[a]):s.concat(e);n[r]=s}return n.join("\n")},U.BitmapText.prototype.updateText=function(){var t=this._data.font;if(t){var e=this.text,i=this._fontSize/t.size,n=[],r=0;this.textWidth=0;do{}while((h=this.scanLine(t,i,e)).y=r,n.push(h),h.width>this.textWidth&&(this.textWidth=h.width),r+=t.lineHeight*i,e=e.substr(h.text.length+1),!1===h.end);this.textHeight=r;for(var s=0,o=0,a=this.textWidth*this.anchor.x,l=this.textHeight*this.anchor.y,p=0;p<n.length;p++){var h=n[p];"right"===this._align?o=this.textWidth-h.width:"center"===this._align&&(o=(this.textWidth-h.width)/2);for(var u=0;u<h.text.length;u++){var c=h.text.charCodeAt(u),d=t.chars[c];void 0===d&&(c=32,d=t.chars[32]);c=this._glyphs[s];c?c.texture=d.texture:((c=new PIXI.Sprite(d.texture)).name=h.text[u],this._glyphs.push(c)),c.position.x=h.chars[u]+o-a,c.position.y=h.y+d.yOffset*i-l,c.scale.set(i),c.tint=this.tint,c.texture.requiresReTint=!0,c.parent||this.addChild(c),s++}}for(p=s;p<this._glyphs.length;p++)this.removeChild(this._glyphs[p])}},U.BitmapText.prototype.purgeGlyphs=function(){for(var t=this._glyphs.length,e=[],i=0;i<this._glyphs.length;i++)this._glyphs[i].parent!==this?this._glyphs[i].destroy():e.push(this._glyphs[i]);return this._glyphs=[],this._glyphs=e,this.updateText(),t-e.length},U.BitmapText.prototype.updateTransform=function(){!this.dirty&&this.anchor.equals(this._prevAnchor)||(this.updateText(),this.dirty=!1,this._prevAnchor.copyFrom(this.anchor)),PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)},Object.defineProperty(U.BitmapText.prototype,"align",{get:function(){return this._align},set:function(t){t===this._align||"left"!==t&&"center"!==t&&"right"!==t||(this._align=t,this.updateText())}}),Object.defineProperty(U.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(t){t!==this._tint&&(this._tint=t,this.updateText())}}),Object.defineProperty(U.BitmapText.prototype,"font",{get:function(){return this._font},set:function(t){t!==this._font&&(this._font=t.trim(),this._data=this.game.cache.getBitmapFont(this._font),this.updateText())}}),Object.defineProperty(U.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){(t=parseInt(t,10))!==this._fontSize&&0<t&&(this._fontSize=t,this.updateText())}}),Object.defineProperty(U.BitmapText.prototype,"text",{get:function(){return this._text},set:function(t){t!==this._text&&(this._text=t.toString()||"",this.updateText())}}),Object.defineProperty(U.BitmapText.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){t!==this._maxWidth&&(this._maxWidth=t,this.updateText())}}),Object.defineProperty(U.BitmapText.prototype,"smoothed",{get:function(){return!this._data.base.scaleMode},set:function(t){this._data.base.scaleMode=t?0:1}}),U.RetroFont=function(t,e,i,n,r,s,o,a,l,p){if(!t.cache.checkImageKey(e))return!1;null!=s||(s=t.cache.getImage(e).width/i),this.characterWidth=i,this.characterHeight=n,this.characterSpacingX=o||0,this.characterSpacingY=a||0,this.characterPerRow=s,this.offsetX=l||0,this.offsetY=p||0,this.align="left",this.multiLine=!1,this.autoUpperCase=!0,this.customSpacingX=0,this.customSpacingY=0,this.fixedWidth=0,this.fontSet=t.cache.getImage(e),this._text="",this.grabData=[],this.frameData=new U.FrameData;for(var h=this.offsetX,u=this.offsetY,c=0,d=0;d<r.length;d++){var _=this.frameData.addFrame(new U.Frame(d,h,u,this.characterWidth,this.characterHeight));this.grabData[r.charCodeAt(d)]=_.index,++c===this.characterPerRow?(c=0,h=this.offsetX,u+=this.characterHeight+this.characterSpacingY):h+=this.characterWidth+this.characterSpacingX}t.cache.updateFrameData(e,this.frameData),this.stamp=new U.Image(t,0,0,e,0),U.RenderTexture.call(this,t,100,100,"",U.scaleModes.NEAREST),this.type=U.RETROFONT},U.RetroFont.prototype=Object.create(U.RenderTexture.prototype),U.RetroFont.prototype.constructor=U.RetroFont,U.RetroFont.ALIGN_LEFT="left",U.RetroFont.ALIGN_RIGHT="right",U.RetroFont.ALIGN_CENTER="center",U.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",U.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ",U.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ",U.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789",U.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789",U.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ",U.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39",U.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ",U.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!",U.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ",U.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789",U.RetroFont.prototype.setFixedWidth=function(t,e){void 0===e&&(e="left"),this.fixedWidth=t,this.align=e},U.RetroFont.prototype.setText=function(t,e,i,n,r,s){this.multiLine=e||!1,this.customSpacingX=i||0,this.customSpacingY=n||0,this.align=r||"left",this.autoUpperCase=!s,0<t.length&&(this.text=t)},U.RetroFont.prototype.buildRetroFontText=function(){var t=0,e=0;if(this.clear(),this.multiLine){var i=this._text.split("\n");0<this.fixedWidth?this.resize(this.fixedWidth,i.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0):this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),i.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0);for(var n=0;n<i.length;n++)t=0,this.align===U.RetroFont.ALIGN_RIGHT?t=this.width-i[n].length*(this.characterWidth+this.customSpacingX):this.align===U.RetroFont.ALIGN_CENTER&&(t=this.width/2-i[n].length*(this.characterWidth+this.customSpacingX)/2,t+=this.customSpacingX/2),t<0&&(t=0),this.pasteLine(i[n],t,e,this.customSpacingX),e+=this.characterHeight+this.customSpacingY}else 0<this.fixedWidth?this.resize(this.fixedWidth,this.characterHeight,!0):this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,!0),t=0,this.align===U.RetroFont.ALIGN_RIGHT?t=this.width-this._text.length*(this.characterWidth+this.customSpacingX):this.align===U.RetroFont.ALIGN_CENTER&&(t=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/2,t+=this.customSpacingX/2),t<0&&(t=0),this.pasteLine(this._text,t,0,this.customSpacingX);this.requiresReTint=!0},U.RetroFont.prototype.pasteLine=function(t,e,i,n){for(var r=0;r<t.length;r++)if(" "===t.charAt(r))e+=this.characterWidth+n;else if(0<=this.grabData[t.charCodeAt(r)]&&(this.stamp.frame=this.grabData[t.charCodeAt(r)],this.renderXY(this.stamp,e,i,!1),(e+=this.characterWidth+n)>this.width))break},U.RetroFont.prototype.getLongestLine=function(){var t=0;if(0<this._text.length)for(var e=this._text.split("\n"),i=0;i<e.length;i++)e[i].length>t&&(t=e[i].length);return t},U.RetroFont.prototype.removeUnsupportedCharacters=function(t){for(var e="",i=0;i<this._text.length;i++){var n=this._text[i],r=n.charCodeAt(0);(0<=this.grabData[r]||!t&&"\n"===n)&&(e=e.concat(n))}return e},U.RetroFont.prototype.updateOffset=function(t,e){if(this.offsetX!==t||this.offsetY!==e){for(var i=t-this.offsetX,n=e-this.offsetY,r=this.game.cache.getFrameData(this.stamp.key).getFrames(),s=r.length;s--;)r[s].x+=i,r[s].y+=n;this.buildRetroFontText()}},Object.defineProperty(U.RetroFont.prototype,"text",{get:function(){return this._text},set:function(t){(t=this.autoUpperCase?t.toUpperCase():t)!==this._text&&(this._text=t,this.removeUnsupportedCharacters(this.multiLine),this.buildRetroFontText())}}),Object.defineProperty(U.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(t){this.stamp.smoothed=t,this.buildRetroFontText()}}),U.Rope=function(t,e,i,n,r,s){this.points=[],this.points=s,this._hasUpdateAnimation=!1,this._updateAnimationCallback=null,e=e||0,i=i||0,n=n||null,r=r||null,this.type=U.ROPE,PIXI.Rope.call(this,U.Cache.DEFAULT,this.points),U.Component.Core.init.call(this,t,e,i,n,r)},U.Rope.prototype=Object.create(PIXI.Rope.prototype),U.Rope.prototype.constructor=U.Rope,U.Component.Core.install.call(U.Rope.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]),U.Rope.prototype.preUpdatePhysics=U.Component.PhysicsBody.preUpdate,U.Rope.prototype.preUpdateLifeSpan=U.Component.LifeSpan.preUpdate,U.Rope.prototype.preUpdateInWorld=U.Component.InWorld.preUpdate,U.Rope.prototype.preUpdateCore=U.Component.Core.preUpdate,U.Rope.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},U.Rope.prototype.update=function(){this._hasUpdateAnimation&&this.updateAnimation.call(this)},U.Rope.prototype.reset=function(t,e){return U.Component.Reset.prototype.reset.call(this,t,e),this},Object.defineProperty(U.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(t){t&&"function"==typeof t?(this._hasUpdateAnimation=!0,this._updateAnimation=t):(this._hasUpdateAnimation=!1,this._updateAnimation=null)}}),Object.defineProperty(U.Rope.prototype,"segments",{get:function(){for(var t,e,i,n,r=[],s=0;s<this.points.length;s++)n=4*s,t=this.vertices[n]*this.scale.x,e=this.vertices[1+n]*this.scale.y,i=this.vertices[4+n]*this.scale.x,n=this.vertices[3+n]*this.scale.y,i=U.Math.difference(t,i),n=U.Math.difference(e,n),t+=this.world.x,e+=this.world.y,n=new U.Rectangle(t,e,i,n),r.push(n);return r}}),U.TileSprite=function(t,e,i,n,r,s,o){e=e||0,i=i||0,n=n||256,r=r||256,s=s||null,o=o||null,this.type=U.TILESPRITE,this.physicsType=U.SPRITE,this._scroll=new U.Point;var a=t.cache.getImage("__default",!0);PIXI.TilingSprite.call(this,new PIXI.Texture(a.base),n,r),U.Component.Core.init.call(this,t,e,i,s,o)},U.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype),U.TileSprite.prototype.constructor=U.TileSprite,U.Component.Core.install.call(U.TileSprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","Smoothed"]),U.TileSprite.prototype.preUpdatePhysics=U.Component.PhysicsBody.preUpdate,U.TileSprite.prototype.preUpdateLifeSpan=U.Component.LifeSpan.preUpdate,U.TileSprite.prototype.preUpdateInWorld=U.Component.InWorld.preUpdate,U.TileSprite.prototype.preUpdateCore=U.Component.Core.preUpdate,U.TileSprite.prototype.preUpdate=function(){return 0!==this._scroll.x&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed),0!==this._scroll.y&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed),!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},U.TileSprite.prototype.autoScroll=function(t,e){this._scroll.set(t,e)},U.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0)},U.TileSprite.prototype.destroy=function(t){U.Component.Destroy.prototype.destroy.call(this,t),PIXI.TilingSprite.prototype.destroy.call(this)},U.TileSprite.prototype.reset=function(t,e){return U.Component.Reset.prototype.reset.call(this,t,e),this.tilePosition.x=0,this.tilePosition.y=0,this},U.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.iOSVersion=0,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.edge=!1,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.safariVersion=0,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.dolby=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},U.Device=new U.Device,U.Device.onInitialized=new U.Signal,U.Device.whenReady=function(t,e,i){var n=this._readyCheck;this.deviceReadyAt||!n?t.call(e,this):n._monitor||i?(n._queue=n._queue||[],n._queue.push([t,e])):(n._monitor=n.bind(this),n._queue=n._queue||[],n._queue.push([t,e]),t=void 0!==window.cordova,e=navigator.isCocoonJS,"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(n._monitor,0):t&&!e?document.addEventListener("deviceready",n._monitor,!1):(document.addEventListener("DOMContentLoaded",n._monitor,!1),window.addEventListener("load",n._monitor,!1)))},U.Device._readyCheck=function(){var t=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",t._monitor),document.removeEventListener("DOMContentLoaded",t._monitor),window.removeEventListener("load",t._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(;i=t._queue.shift();){var e=i[0],i=i[1];e.call(i,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(t._monitor,20)},U.Device._initialize=function(){var t,e,r=this;(function(){var t=navigator.userAgent;/Playstation Vita/.test(t)?r.vita=!0:/Kindle/.test(t)||/\bKF[A-Z][A-Z]+/.test(t)||/Silk.*Mobile Safari/.test(t)?r.kindle=!0:/Android/.test(t)?r.android=!0:/CrOS/.test(t)?r.chromeOS=!0:/iP[ao]d|iPhone/i.test(t)?(r.iOS=!0,navigator.appVersion.match(/OS (\d+)/),r.iOSVersion=parseInt(RegExp.$1,10)):/Linux/.test(t)?r.linux=!0:/Mac OS/.test(t)?r.macOS=!0:/Windows/.test(t)&&(r.windows=!0),(/Windows Phone/i.test(t)||/IEMobile/i.test(t))&&(r.android=!1,r.iOS=!1,r.macOS=!1,r.windows=!0,r.windowsPhone=!0);var e=/Silk/.test(t);(r.windows||r.macOS||r.linux&&!e||r.chromeOS)&&(r.desktop=!0),(r.windowsPhone||/Windows NT/i.test(t)&&/Touch/i.test(t))&&(r.desktop=!1)})(),function(){var t=navigator.userAgent;if(/Arora/.test(t)?r.arora=!0:/Edge\/\d+/.test(t)?r.edge=!0:/Chrome\/(\d+)/.test(t)&&!r.windowsPhone?(r.chrome=!0,r.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(t)?r.epiphany=!0:/Firefox\D+(\d+)/.test(t)?(r.firefox=!0,r.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(t)&&r.iOS?r.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(t)?(r.ie=!0,r.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(t)?r.midori=!0:/Opera/.test(t)?r.opera=!0:/Safari\/(\d+)/.test(t)&&!r.windowsPhone?(r.safari=!0,/Version\/(\d+)\./.test(t)&&(r.safariVersion=parseInt(RegExp.$1,10))):/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(t)&&(r.ie=!0,r.trident=!0,r.tridentVersion=parseInt(RegExp.$1,10),r.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(t)&&(r.silk=!0),navigator.standalone&&(r.webApp=!0),void 0!==window.cordova&&(r.cordova=!0),void 0!==a&&(r.node=!0),r.node&&"object"==typeof a.versions&&(r.nodeWebkit=!!a.versions["node-webkit"],r.electron=!!a.versions.electron),navigator.isCocoonJS&&(r.cocoonJS=!0),r.cocoonJS)try{r.cocoonJSApp="undefined"!=typeof CocoonJS}catch(t){r.cocoonJSApp=!1}void 0!==window.ejecta&&(r.ejecta=!0),/Crosswalk/.test(t)&&(r.crosswalk=!0)}(),function(){r.audioData=!!window.Audio,r.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var t,e,i=document.createElement("audio");try{!!i.canPlayType&&(i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(r.ogg=!0),(i.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||i.canPlayType("audio/opus;").replace(/^no$/,""))&&(r.opus=!0),i.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(r.mp3=!0),i.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(r.wav=!0),(i.canPlayType("audio/x-m4a;")||i.canPlayType("audio/aac;").replace(/^no$/,""))&&(r.m4a=!0),i.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(r.webm=!0),""!==i.canPlayType('audio/mp4;codecs="ec-3"'))&&(r.edge?r.dolby=!0:r.safari&&9<=r.safariVersion&&/Mac OS X (\d+)_(\d+)/.test(navigator.userAgent)&&(t=parseInt(RegExp.$1,10),e=parseInt(RegExp.$2,10),(10===t&&11<=e||10<t)&&(r.dolby=!0)))}catch(i){}}(),function(){var t=document.createElement("video");try{!!t.canPlayType&&(t.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(r.oggVideo=!0),t.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(r.h264Video=!0,r.mp4Video=!0),t.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(r.webmVideo=!0),t.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(r.vp9Video=!0),t.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(r.hlsVideo=!0))}catch(t){}}(),function(){var t,e,i=document.createElement("p"),n={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};for(e in document.body.insertBefore(i,null),n)void 0!==i.style[e]&&(i.style[e]="translate3d(1px,1px,1px)",t=window.getComputedStyle(i).getPropertyValue(n[e]));document.body.removeChild(i),r.css3D=void 0!==t&&0<t.length&&"none"!==t}(),r.pixelRatio=window.devicePixelRatio||1,r.iPhone=-1!==navigator.userAgent.toLowerCase().indexOf("iphone"),r.iPhone4=2===r.pixelRatio&&r.iPhone,r.iPad=-1!==navigator.userAgent.toLowerCase().indexOf("ipad"),"undefined"!=typeof Int8Array?r.typedArray=!0:r.typedArray=!1,"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint32Array&&(r.littleEndian=(t=new ArrayBuffer(4),e=new Uint8Array(t),t=new Uint32Array(t),e[0]=161,e[1]=178,e[2]=195,e[3]=212,3569595041===t[0]||2712847316!==t[0]&&null),r.LITTLE_ENDIAN=r.littleEndian),r.support32bit="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof Int32Array&&null!==r.littleEndian&&function(){if(void 0===Uint8ClampedArray)return!1;var t=PIXI.CanvasPool.create(this,1,1).getContext("2d");return!!t&&(t=t.createImageData(1,1),PIXI.CanvasPool.remove(this),t.data instanceof Uint8ClampedArray)}(),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(r.vibration=!0),function(){r.canvas=!!window.CanvasRenderingContext2D||r.cocoonJS;try{r.localStorage=!!localStorage.getItem}catch(e){r.localStorage=!1}r.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),r.fileSystem=!!window.requestFileSystem;var e={stencil:!0};r.webGL=function(){try{var t=document.createElement("canvas");return t.screencanvas=!1,!!window.WebGLRenderingContext&&(t.getContext("webgl",e)||t.getContext("experimental-webgl",e))}catch(t){return!1}}(),r.webGL=!!r.webGL,r.worker=!!window.Worker,r.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,r.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,r.getUserMedia=r.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,r.firefox&&r.firefoxVersion<21&&(r.getUserMedia=!1),!r.iOS&&(r.ie||r.firefox||r.chrome)&&(r.canvasBitBltShift=!0),(r.safari||r.mobileSafari)&&(r.canvasBitBltShift=!1)}(),function(){for(var t=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],e=document.createElement("div"),i=0;i<t.length;i++)if(e[t[i]]){r.fullscreen=!0,r.requestFullscreen=t[i];break}var n=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(r.fullscreen)for(i=0;i<n.length;i++)if(document[n[i]]){r.cancelFullscreen=n[i];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(r.fullscreenKeyboard=!0)}(),("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&1<=window.navigator.maxTouchPoints)&&(r.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(r.mspointer=!0),r.cocoonJS||("onwheel"in window||r.ie&&"WheelEvent"in window?r.wheelEvent="wheel":"onmousewheel"in window?r.wheelEvent="mousewheel":r.firefox&&"MouseScrollEvent"in window&&(r.wheelEvent="DOMMouseScroll"))},U.Device.canPlayAudio=function(t){return!!("mp3"===t&&this.mp3||"ogg"===t&&(this.ogg||this.opus)||"m4a"===t&&this.m4a||"opus"===t&&this.opus||"wav"===t&&this.wav||"webm"===t&&this.webm||"mp4"===t&&this.dolby)},U.Device.canPlayVideo=function(t){return!!("webm"===t&&(this.webmVideo||this.vp9Video)||"mp4"===t&&(this.mp4Video||this.h264Video)||("ogg"===t||"ogv"===t)&&this.oggVideo||"mpeg"===t&&this.hlsVideo)},U.Device.isConsoleOpen=function(){return!(!window.console||!window.console.firebug)||!(!window.console||(console.clear,!console.profiles))&&0<console.profiles.length},U.Device.isAndroidStockBrowser=function(){var t=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return t&&t[1]<537},U.Canvas={create:function(t,e,i,n,r){e=e||256,i=i||256;t=r?document.createElement("canvas"):PIXI.CanvasPool.create(t,e,i);return"string"==typeof n&&""!==n&&(t.id=n),t.width=e,t.height=i,t.style.display="block",t},setBackgroundColor:function(t,e){return e=e||"rgb(0,0,0)",t.style.backgroundColor=e,t},setTouchAction:function(t,e){return e=e||"none",t.style.msTouchAction=e,t.style["ms-touch-action"]=e,t.style["touch-action"]=e,t},setUserSelect:function(t,e){return e=e||"none",t.style["-webkit-touch-callout"]=e,t.style["-webkit-user-select"]=e,t.style["-khtml-user-select"]=e,t.style["-moz-user-select"]=e,t.style["-ms-user-select"]=e,t.style["user-select"]=e,t.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",t},addToDOM:function(t,e,i){var n;return void 0===i&&(i=!0),e&&("string"==typeof e?n=document.getElementById(e):"object"==typeof e&&1===e.nodeType&&(n=e)),n=n||document.body,i&&n.style&&(n.style.overflow="hidden"),n.appendChild(t),t},removeFromDOM:function(t){t.parentNode&&t.parentNode.removeChild(t)},setTransform:function(t,e,i,n,r,s,o){return t.setTransform(n,s,o,r,e,i),t},setSmoothingEnabled:function(t,e){var i=U.Canvas.getSmoothingPrefix(t);return i&&(t[i]=e),t},getSmoothingPrefix:function(t){var e,i=["i","webkitI","msI","mozI","oI"];for(e in i){var n=i[e]+"mageSmoothingEnabled";if(n in t)return n}return null},getSmoothingEnabled:function(t){var e=U.Canvas.getSmoothingPrefix(t);if(e)return t[e]},setImageRenderingCrisp:function(t){for(var e=["optimizeSpeed","crisp-edges","-moz-crisp-edges","-webkit-optimize-contrast","optimize-contrast","pixelated"],i=0;i<e.length;i++)t.style["image-rendering"]=e[i];return t.style.msInterpolationMode="nearest-neighbor",t},setImageRenderingBicubic:function(t){return t.style["image-rendering"]="auto",t.style.msInterpolationMode="bicubic",t}},U.RequestAnimationFrame=function(t,e){void 0===e&&(e=!1),this.game=t,this.isRunning=!1,this.forceSetTimeOut=e;for(var i=["ms","moz","webkit","o"],n=0;n<i.length&&!window.requestAnimationFrame;n++)window.requestAnimationFrame=window[i[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[i[n]+"CancelAnimationFrame"];this._isSetTimeOut=!1,this._onLoop=null,this._timeOutID=null},U.RequestAnimationFrame.prototype={start:function(){this.isRunning=!0;var e=this;!window.requestAnimationFrame||this.forceSetTimeOut?(this._isSetTimeOut=!0,this._onLoop=function(){return e.updateSetTimeout()},this._timeOutID=window.setTimeout(this._onLoop,0)):(this._isSetTimeOut=!1,this._onLoop=function(t){return e.updateRAF(t)},this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateRAF:function(t){this.isRunning&&(this.game.update(Math.floor(t)),this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateSetTimeout:function(){this.isRunning&&(this.game.update(Date.now()),this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall))},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame(this._timeOutID),this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return!1===this._isSetTimeOut}},U.RequestAnimationFrame.prototype.constructor=U.RequestAnimationFrame,U.Math={PI2:2*Math.PI,between:function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},fuzzyEqual:function(t,e,i){return void 0===i&&(i=1e-4),Math.abs(t-e)<i},fuzzyLessThan:function(t,e,i){return void 0===i&&(i=1e-4),t<e+i},fuzzyGreaterThan:function(t,e,i){return void 0===i&&(i=1e-4),e-i<t},fuzzyCeil:function(t,e){return void 0===e&&(e=1e-4),Math.ceil(t-e)},fuzzyFloor:function(t,e){return void 0===e&&(e=1e-4),Math.floor(t+e)},average:function(){for(var t=0,e=arguments.length,i=0;i<e;i++)t+=+arguments[i];return t/e},shear:function(t){return t%1},snapTo:function(t,e,i){return void 0===i&&(i=0),0===e?t:(t-=i,i+(t=e*Math.round(t/e)))},snapToFloor:function(t,e,i){return void 0===i&&(i=0),0===e?t:(t-=i,i+(t=e*Math.floor(t/e)))},snapToCeil:function(t,e,i){return void 0===i&&(i=0),0===e?t:(t-=i,i+(t=e*Math.ceil(t/e)))},roundTo:function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=10);e=Math.pow(i,-e);return Math.round(t*e)/e},floorTo:function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=10);e=Math.pow(i,-e);return Math.floor(t*e)/e},ceilTo:function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=10);e=Math.pow(i,-e);return Math.ceil(t*e)/e},rotateToAngle:function(t,e,i){return void 0===i&&(i=.05),t===e||(Math.abs(e-t)<=i||Math.abs(e-t)>=U.Math.PI2-i?t=e:(Math.abs(e-t)>Math.PI&&(e<t?e+=U.Math.PI2:e-=U.Math.PI2),t<e?t+=i:e<t&&(t-=i))),t},getShortestAngle:function(t,e){t=e-t;return 0==t?0:t-360*Math.floor((t+180)/360)},angleBetween:function(t,e,i,n){return Math.atan2(n-e,i-t)},angleBetweenY:function(t,e,i,n){return Math.atan2(i-t,n-e)},angleBetweenPoints:function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},angleBetweenPointsY:function(t,e){return Math.atan2(e.x-t.x,e.y-t.y)},reverseAngle:function(t){return this.normalizeAngle(t+Math.PI,!0)},normalizeAngle:function(t){return 0<=(t%=2*Math.PI)?t:t+2*Math.PI},maxAdd:function(t,e,i){return Math.min(t+e,i)},minSub:function(t,e,i){return Math.max(t-e,i)},wrap:function(t,e,i){i-=e;if(i<=0)return 0;t=(t-e)%i;return t<0&&(t+=i),t+e},wrapValue:function(t,e,i){return((t=Math.abs(t))+(e=Math.abs(e)))%(i=Math.abs(i))},isOdd:function(t){return!!(1&t)},isEven:function(t){return!(1&t)},min:function(){for(var t,e=1,i=0,n=(t=1===arguments.length&&"object"==typeof arguments[0]?arguments[0]:arguments).length;e<n;e++)t[e]<t[i]&&(i=e);return t[i]},max:function(){for(var t,e=1,i=0,n=(t=1===arguments.length&&"object"==typeof arguments[0]?arguments[0]:arguments).length;e<n;e++)t[e]>t[i]&&(i=e);return t[i]},minProperty:function(t){for(var e,i=1,n=0,r=(e=2===arguments.length&&"object"==typeof arguments[1]?arguments[1]:arguments.slice(1)).length;i<r;i++)e[i][t]<e[n][t]&&(n=i);return e[n][t]},maxProperty:function(t){for(var e,i=1,n=0,r=(e=2===arguments.length&&"object"==typeof arguments[1]?arguments[1]:arguments.slice(1)).length;i<r;i++)e[i][t]>e[n][t]&&(n=i);return e[n][t]},wrapAngle:function(t,e){return e?this.wrap(t,-Math.PI,Math.PI):this.wrap(t,-180,180)},linearInterpolation:function(t,e){var i=t.length-1,n=i*e,r=Math.floor(n);return e<0?this.linear(t[0],t[1],n):1<e?this.linear(t[i],t[i-1],i-n):this.linear(t[r],t[i<r+1?i:r+1],n-r)},bezierInterpolation:function(t,e){for(var i=0,n=t.length-1,r=0;r<=n;r++)i+=Math.pow(1-e,n-r)*Math.pow(e,r)*t[r]*this.bernstein(n,r);return i},catmullRomInterpolation:function(t,e){var i=t.length-1,n=i*e,r=Math.floor(n);return t[0]===t[i]?(e<0&&(r=Math.floor(n=i*(1+e))),this.catmullRom(t[(r-1+i)%i],t[r],t[(r+1)%i],t[(r+2)%i],n-r)):e<0?t[0]-(this.catmullRom(t[0],t[0],t[1],t[1],-n)-t[0]):1<e?t[i]-(this.catmullRom(t[i],t[i],t[i-1],t[i-1],n-i)-t[i]):this.catmullRom(t[r?r-1:0],t[r],t[i<r+1?i:r+1],t[i<r+2?i:r+2],n-r)},linear:function(t,e,i){return(e-t)*i+t},bernstein:function(t,e){return this.factorial(t)/this.factorial(e)/this.factorial(t-e)},factorial:function(t){if(0===t)return 1;for(var e=t;--t;)e*=t;return e},catmullRom:function(t,e,i,n,r){var s=.5*(i-t),t=.5*(n-e),n=r*r;return r*n*(2*e-2*i+s+t)+(-3*e+3*i-2*s-t)*n+s*r+e},difference:function(t,e){return Math.abs(t-e)},roundAwayFromZero:function(t){return 0<t?Math.ceil(t):Math.floor(t)},sinCosGenerator:function(t,e,i,n){void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n=1);for(var r=e,s=i,o=n*Math.PI/t,a=[],l=[],p=0;p<t;p++)r+=(s-=r*o)*o,a[p]=s,l[p]=r;return{sin:l,cos:a,length:t}},distance:function(t,e,i,n){i=t-i,n=e-n;return Math.sqrt(i*i+n*n)},distanceSq:function(t,e,i,n){i=t-i,n=e-n;return i*i+n*n},distancePow:function(t,e,i,n,r){return void 0===r&&(r=2),Math.sqrt(Math.pow(i-t,r)+Math.pow(n-e,r))},clamp:function(t,e,i){return t<e?e:i<t?i:t},clampBottom:function(t,e){return t<e?e:t},within:function(t,e,i){return Math.abs(t-e)<=i},mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},smoothstep:function(t,e,i){return(t=Math.max(0,Math.min(1,(t-e)/(i-e))))*t*(3-2*t)},smootherstep:function(t,e,i){return(t=Math.max(0,Math.min(1,(t-e)/(i-e))))*t*t*(t*(6*t-15)+10)},sign:function(t){return t<0?-1:0<t?1:0},percent:function(t,e,i){return void 0===i&&(i=0),e<t||e<i?1:t<i||t<i?0:(t-i)/e}};var r=Math.PI/180,o=180/Math.PI;return U.Math.degToRad=function(t){return t*r},U.Math.radToDeg=function(t){return t*o},U.RandomDataGenerator=function(t){void 0===t&&(t=[]),this.c=1,this.s0=0,this.s1=0,this.s2=0,"string"==typeof t?this.state(t):this.sow(t)},U.RandomDataGenerator.prototype={rnd:function(){var t=2091639*this.s0+2.3283064365386963e-10*this.c;return this.c=0|t,this.s0=this.s1,this.s1=this.s2,this.s2=t-this.c,this.s2},sow:function(t){if(this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1),this.c=1,t)for(var e=0;e<t.length&&null!=t[e];e++){var i=t[e];this.s0-=this.hash(i),this.s0+=~~(this.s0<0),this.s1-=this.hash(i),this.s1+=~~(this.s1<0),this.s2-=this.hash(i),this.s2+=~~(this.s2<0)}},hash:function(t){var e,i,n=4022871197;for(t=t.toString(),i=0;i<t.length;i++)e=.02519603282416938*(n+=t.charCodeAt(i)),e-=n=e>>>0,n=(e*=n)>>>0,n+=4294967296*(e-=n);return 2.3283064365386963e-10*(n>>>0)},integer:function(){return 4294967296*this.rnd.apply(this)},frac:function(){return this.rnd.apply(this)+11102230246251565e-32*(2097152*this.rnd.apply(this)|0)},real:function(){return this.integer()+this.frac()},integerInRange:function(t,e){return Math.floor(this.realInRange(0,e-t+1)+t)},between:function(t,e){return this.integerInRange(t,e)},realInRange:function(t,e){return this.frac()*(e-t)+t},normal:function(){return 1-2*this.frac()},uuid:function(){for(var t="",e="",e=t="";t++<36;e+=~t%5|3*t&4?(15^t?8^this.frac()*(20^t?16:4):4).toString(16):"-");return e},pick:function(t){return t[this.integerInRange(0,t.length-1)]},sign:function(){return this.pick([-1,1])},weightedPick:function(t){return t[~~(Math.pow(this.frac(),2)*(t.length-1)+.5)]},timestamp:function(t,e){return this.realInRange(t||9466848e5,e||1577862e6)},angle:function(){return this.integerInRange(-180,180)},state:function(t){return"string"==typeof t&&t.match(/^!rnd/)&&(t=t.split(","),this.c=parseFloat(t[1]),this.s0=parseFloat(t[2]),this.s1=parseFloat(t[3]),this.s2=parseFloat(t[4])),["!rnd",this.c,this.s0,this.s1,this.s2].join(",")}},U.RandomDataGenerator.prototype.constructor=U.RandomDataGenerator,U.QuadTree=function(t,e,i,n,r,s,o){this.maxObjects=10,this.maxLevels=4,this.level=0,this.bounds={},this.objects=[],this.nodes=[],this._empty=[],this.reset(t,e,i,n,r,s,o)},U.QuadTree.prototype={reset:function(t,e,i,n,r,s,o){this.maxObjects=r||10,this.maxLevels=s||4,this.level=o||0,this.bounds={x:Math.round(t),y:Math.round(e),width:i,height:n,subWidth:Math.floor(i/2),subHeight:Math.floor(n/2),right:Math.round(t)+Math.floor(i/2),bottom:Math.round(e)+Math.floor(n/2)},this.objects.length=0,this.nodes.length=0},populate:function(t){t.forEach(this.populateHandler,this,!0)},populateHandler:function(t){t.body&&t.exists&&this.insert(t.body)},split:function(){this.nodes[0]=new U.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[1]=new U.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[2]=new U.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[3]=new U.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1)},insert:function(t){var e,i=0;if(null==this.nodes[0]||-1===(e=this.getIndex(t))){if(this.objects.push(t),this.objects.length>this.maxObjects&&this.level<this.maxLevels)for(null==this.nodes[0]&&this.split();i<this.objects.length;)-1!==(e=this.getIndex(this.objects[i]))?this.nodes[e].insert(this.objects.splice(i,1)[0]):i++}else this.nodes[e].insert(t)},getIndex:function(t){var e=-1;return t.x<this.bounds.right&&t.right<this.bounds.right?t.y<this.bounds.bottom&&t.bottom<this.bounds.bottom?e=1:t.y>this.bounds.bottom&&(e=2):t.x>this.bounds.right&&(t.y<this.bounds.bottom&&t.bottom<this.bounds.bottom?e=0:t.y>this.bounds.bottom&&(e=3)),e},retrieve:function(t){if(t instanceof U.Rectangle)var e=this.objects,i=this.getIndex(t);else{if(!t.body)return this._empty;e=this.objects,i=this.getIndex(t.body)}return this.nodes[0]&&(e=-1!==i?e.concat(this.nodes[i].retrieve(t)):(e=(e=(e=e.concat(this.nodes[0].retrieve(t))).concat(this.nodes[1].retrieve(t))).concat(this.nodes[2].retrieve(t))).concat(this.nodes[3].retrieve(t))),e},clear:function(){this.objects.length=0;for(var t=this.nodes.length;t--;)this.nodes[t].clear(),this.nodes.splice(t,1);this.nodes.length=0}},U.QuadTree.prototype.constructor=U.QuadTree,U.Net=function(t){this.game=t},U.Net.prototype={getHostName:function(){return window.location&&window.location.hostname?window.location.hostname:null},checkDomainName:function(t){return-1!==window.location.hostname.indexOf(t)},updateQueryString:function(t,e,i,n){void 0===i&&(i=!1),void 0!==n&&""!==n||(n=window.location.href);var r,s="",o=new RegExp("([?|&])"+t+"=.*?(&|#|$)(.*)","gi"),s=o.test(n)?null!=e?n.replace(o,"$1"+t+"="+e+"$2$3"):n.replace(o,"$1$3").replace(/(&|\?)$/,""):(null!=e&&(r=-1!==n.indexOf("?")?"&":"?",n=(o=n.split("#"))[0]+r+t+"="+e,o[1]&&(n+="#"+o[1])),n);if(!i)return s;window.location.href=s},getQueryString:function(t){void 0===t&&(t="");var e,i={},n=location.search.substring(1).split("&");for(e in n){var r=n[e].split("=");if(1<r.length){if(t&&t===this.decodeURI(r[0]))return this.decodeURI(r[1]);i[this.decodeURI(r[0])]=this.decodeURI(r[1])}}return i},decodeURI:function(t){return decodeURIComponent(t.replace(/\+/g," "))}},U.Net.prototype.constructor=U.Net,U.TweenManager=function(t){this.game=t,this.frameBased=!1,this._tweens=[],this._add=[],this.easeMap={Power0:U.Easing.Power0,Power1:U.Easing.Power1,Power2:U.Easing.Power2,Power3:U.Easing.Power3,Power4:U.Easing.Power4,Linear:U.Easing.Linear.None,Quad:U.Easing.Quadratic.Out,Cubic:U.Easing.Cubic.Out,Quart:U.Easing.Quartic.Out,Quint:U.Easing.Quintic.Out,Sine:U.Easing.Sinusoidal.Out,Expo:U.Easing.Exponential.Out,Circ:U.Easing.Circular.Out,Elastic:U.Easing.Elastic.Out,Back:U.Easing.Back.Out,Bounce:U.Easing.Bounce.Out,"Quad.easeIn":U.Easing.Quadratic.In,"Cubic.easeIn":U.Easing.Cubic.In,"Quart.easeIn":U.Easing.Quartic.In,"Quint.easeIn":U.Easing.Quintic.In,"Sine.easeIn":U.Easing.Sinusoidal.In,"Expo.easeIn":U.Easing.Exponential.In,"Circ.easeIn":U.Easing.Circular.In,"Elastic.easeIn":U.Easing.Elastic.In,"Back.easeIn":U.Easing.Back.In,"Bounce.easeIn":U.Easing.Bounce.In,"Quad.easeOut":U.Easing.Quadratic.Out,"Cubic.easeOut":U.Easing.Cubic.Out,"Quart.easeOut":U.Easing.Quartic.Out,"Quint.easeOut":U.Easing.Quintic.Out,"Sine.easeOut":U.Easing.Sinusoidal.Out,"Expo.easeOut":U.Easing.Exponential.Out,"Circ.easeOut":U.Easing.Circular.Out,"Elastic.easeOut":U.Easing.Elastic.Out,"Back.easeOut":U.Easing.Back.Out,"Bounce.easeOut":U.Easing.Bounce.Out,"Quad.easeInOut":U.Easing.Quadratic.InOut,"Cubic.easeInOut":U.Easing.Cubic.InOut,"Quart.easeInOut":U.Easing.Quartic.InOut,"Quint.easeInOut":U.Easing.Quintic.InOut,"Sine.easeInOut":U.Easing.Sinusoidal.InOut,"Expo.easeInOut":U.Easing.Exponential.InOut,"Circ.easeInOut":U.Easing.Circular.InOut,"Elastic.easeInOut":U.Easing.Elastic.InOut,"Back.easeInOut":U.Easing.Back.InOut,"Bounce.easeInOut":U.Easing.Bounce.InOut},this.game.onPause.add(this._pauseAll,this),this.game.onResume.add(this._resumeAll,this)},U.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var t=0;t<this._tweens.length;t++)this._tweens[t].pendingDelete=!0;this._add=[]},removeFrom:function(t,e){if(void 0===e&&(e=!0),Array.isArray(t))for(i=0,n=t.length;i<n;i++)this.removeFrom(t[i]);else if(t.type===U.GROUP&&e)for(var i=0,n=t.children.length;i<n;i++)this.removeFrom(t.children[i]);else{for(i=0,n=this._tweens.length;i<n;i++)t===this._tweens[i].target&&this.remove(this._tweens[i]);for(i=0,n=this._add.length;i<n;i++)t===this._add[i].target&&this.remove(this._add[i])}},add:function(t){(t._manager=this)._add.push(t)},create:function(t){return new U.Tween(t,this.game,this)},remove:function(t){var e=this._tweens.indexOf(t);-1!==e?this._tweens[e].pendingDelete=!0:-1!==(e=this._add.indexOf(t))&&(this._add[e].pendingDelete=!0)},update:function(){var t=this._add.length,e=this._tweens.length;if(0===e&&0===t)return!1;for(var i=0;i<e;)this._tweens[i].update(this.game.time.time)?i++:(this._tweens.splice(i,1),e--);return 0<t&&(this._tweens=this._tweens.concat(this._add),this._add.length=0),!0},isTweening:function(e){return this._tweens.some(function(t){return t.target===e})},_pauseAll:function(){for(var t=this._tweens.length-1;0<=t;t--)this._tweens[t]._pause()},_resumeAll:function(){for(var t=this._tweens.length-1;0<=t;t--)this._tweens[t]._resume()},pauseAll:function(){for(var t=this._tweens.length-1;0<=t;t--)this._tweens[t].pause()},resumeAll:function(){for(var t=this._tweens.length-1;0<=t;t--)this._tweens[t].resume(!0)}},U.TweenManager.prototype.constructor=U.TweenManager,U.Tween=function(t,e,i){this.game=e,this.target=t,this.manager=i,this.timeline=[],this.reverse=!1,this.timeScale=1,this.repeatCounter=0,this.pendingDelete=!1,this.onStart=new U.Signal,this.onLoop=new U.Signal,this.onRepeat=new U.Signal,this.onChildComplete=new U.Signal,this.onComplete=new U.Signal,this.isRunning=!1,this.current=0,this.properties={},this.chainedTween=null,this.isPaused=!1,this.frameBased=i.frameBased,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,this._pausedTime=0,this._codePaused=!1,this._hasStarted=!1},U.Tween.prototype={to:function(t,e,i,n,r,s,o){return(void 0===e||e<=0)&&(e=1e3),null!=i||(i=U.Easing.Default),void 0===n&&(n=!1),void 0===r&&(r=0),void 0===s&&(s=0),void 0===o&&(o=!1),"string"==typeof i&&this.manager.easeMap[i]&&(i=this.manager.easeMap[i]),this.isRunning||(this.timeline.push(new U.TweenData(this).to(t,e,i,r,s,o)),n&&this.start()),this},from:function(t,e,i,n,r,s,o){return void 0===e&&(e=1e3),null!=i||(i=U.Easing.Default),void 0===n&&(n=!1),void 0===r&&(r=0),void 0===s&&(s=0),void 0===o&&(o=!1),"string"==typeof i&&this.manager.easeMap[i]&&(i=this.manager.easeMap[i]),this.isRunning||(this.timeline.push(new U.TweenData(this).from(t,e,i,r,s,o)),n&&this.start()),this},start:function(t){if(void 0===t&&(t=0),null===this.game||null===this.target||0===this.timeline.length||this.isRunning)return this;for(var e=0;e<this.timeline.length;e++)for(var i in this.timeline[e].vEnd)this.properties[i]=this.target[i]||0,Array.isArray(this.properties[i])||(this.properties[i]*=1);for(e=0;e<this.timeline.length;e++)this.timeline[e].loadValues();return this.manager.add(this),this.isRunning=!0,(t<0||t>this.timeline.length-1)&&(t=0),this.current=t,this.timeline[this.current].start(),this},stop:function(t){return void 0===t&&(t=!1),this.isRunning=!1,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,t&&(this.onComplete.dispatch(this.target,this),this._hasStarted=!1,this.chainedTween&&this.chainedTween.start()),this.manager.remove(this),this},updateTweenData:function(t,e,i){if(0===this.timeline.length)return this;if(void 0===i&&(i=0),-1===i)for(var n=0;n<this.timeline.length;n++)this.timeline[n][t]=e;else this.timeline[i][t]=e;return this},delay:function(t,e){return this.updateTweenData("delay",t,e)},repeat:function(t,e,i){return void 0===e&&(e=0),this.updateTweenData("repeatCounter",t,i),this.updateTweenData("repeatDelay",e,i)},repeatDelay:function(t,e){return this.updateTweenData("repeatDelay",t,e)},yoyo:function(t,e,i){return void 0===e&&(e=0),this.updateTweenData("yoyo",t,i),this.updateTweenData("yoyoDelay",e,i)},yoyoDelay:function(t,e){return this.updateTweenData("yoyoDelay",t,e)},easing:function(t,e){return"string"==typeof t&&this.manager.easeMap[t]&&(t=this.manager.easeMap[t]),this.updateTweenData("easingFunction",t,e)},interpolation:function(t,e,i){return void 0===e&&(e=U.Math),this.updateTweenData("interpolationFunction",t,i),this.updateTweenData("interpolationContext",e,i)},repeatAll:function(t){return void 0===t&&(t=0),this.repeatCounter=t,this},chain:function(){for(var t=arguments.length;t--;)0<t?arguments[t-1].chainedTween=arguments[t]:this.chainedTween=arguments[t];return this},loop:function(t){return void 0===t&&(t=!0),this.repeatCounter=t?-1:0,this},onUpdateCallback:function(t,e){return this._onUpdateCallback=t,this._onUpdateCallbackContext=e,this},pause:function(){this.isPaused=!0,this._codePaused=!0,this._pausedTime=this.game.time.time},_pause:function(){this._codePaused||(this.isPaused=!0,this._pausedTime=this.game.time.time)},resume:function(){if(this.isPaused){this.isPaused=!1,this._codePaused=!1;for(var t=0;t<this.timeline.length;t++)this.timeline[t].isRunning||(this.timeline[t].startTime+=this.game.time.time-this._pausedTime)}},_resume:function(){this._codePaused||this.resume()},update:function(t){if(this.pendingDelete||!this.target)return!1;if(this.isPaused)return!0;t=this.timeline[this.current].update(t);if(t===U.TweenData.PENDING)return!0;if(t===U.TweenData.RUNNING)return this._hasStarted||(this.onStart.dispatch(this.target,this),this._hasStarted=!0),null!==this._onUpdateCallback&&this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current]),this.isRunning;if(t===U.TweenData.LOOPED)return(-1===this.timeline[this.current].repeatCounter?this.onLoop:this.onRepeat).dispatch(this.target,this),!0;if(t===U.TweenData.COMPLETE){t=!1;return this.reverse?--this.current<0&&(this.current=this.timeline.length-1,t=!0):++this.current===this.timeline.length&&(t=!(this.current=0)),t?-1===this.repeatCounter?(this.timeline[this.current].start(),this.onLoop.dispatch(this.target,this),!0):0<this.repeatCounter?(this.repeatCounter--,this.timeline[this.current].start(),this.onRepeat.dispatch(this.target,this),!0):(this.isRunning=!1,this.onComplete.dispatch(this.target,this),this._hasStarted=!1,this.chainedTween&&this.chainedTween.start(),!1):(this.onChildComplete.dispatch(this.target,this),this.timeline[this.current].start(),!0)}},generateData:function(t,e){if(null===this.game||null===this.target)return null;void 0===t&&(t=60),void 0===e&&(e=[]);for(var i=0;i<this.timeline.length;i++)for(var n in this.timeline[i].vEnd)this.properties[n]=this.target[n]||0,Array.isArray(this.properties[n])||(this.properties[n]*=1);for(i=0;i<this.timeline.length;i++)this.timeline[i].loadValues();for(i=0;i<this.timeline.length;i++)e=e.concat(this.timeline[i].generateData(t));return e}},Object.defineProperty(U.Tween.prototype,"totalDuration",{get:function(){for(var t=0,e=0;e<this.timeline.length;e++)t+=this.timeline[e].duration;return t}}),U.Tween.prototype.constructor=U.Tween,U.TweenData=function(t){this.parent=t,this.game=t.game,this.vStart={},this.vStartCache={},this.vEnd={},this.vEndCache={},this.duration=1e3,this.percent=0,this.value=0,this.repeatCounter=0,this.repeatDelay=0,this.repeatTotal=0,this.interpolate=!1,this.yoyo=!1,this.yoyoDelay=0,this.inReverse=!1,this.delay=0,this.dt=0,this.startTime=null,this.easingFunction=U.Easing.Default,this.interpolationFunction=U.Math.linearInterpolation,this.interpolationContext=U.Math,this.isRunning=!1,this.isFrom=!1},U.TweenData.PENDING=0,U.TweenData.RUNNING=1,U.TweenData.LOOPED=2,U.TweenData.COMPLETE=3,U.TweenData.prototype={to:function(t,e,i,n,r,s){return this.vEnd=t,this.duration=e,this.easingFunction=i,this.delay=n,this.repeatTotal=r,this.yoyo=s,this.isFrom=!1,this},from:function(t,e,i,n,r,s){return this.vEnd=t,this.duration=e,this.easingFunction=i,this.delay=n,this.repeatTotal=r,this.yoyo=s,this.isFrom=!0,this},start:function(){if(this.startTime=this.game.time.time+this.delay,this.parent.reverse?this.dt=this.duration:this.dt=0,0<this.delay?this.isRunning=!1:this.isRunning=!0,this.isFrom)for(var t in this.vStartCache)this.vStart[t]=this.vEndCache[t],this.vEnd[t]=this.vStartCache[t],this.parent.target[t]=this.vStart[t];return this.value=0,this.yoyoCounter=0,this.repeatCounter=this.repeatTotal,this},loadValues:function(){for(var t in this.parent.properties){if(this.vStart[t]=this.parent.properties[t],Array.isArray(this.vEnd[t])){if(0===this.vEnd[t].length)continue;0===this.percent&&(this.vEnd[t]=[this.vStart[t]].concat(this.vEnd[t]))}void 0!==this.vEnd[t]?("string"==typeof this.vEnd[t]&&(this.vEnd[t]=this.vStart[t]+parseFloat(this.vEnd[t],10)),this.parent.properties[t]=this.vEnd[t]):this.vEnd[t]=this.vStart[t],this.vStartCache[t]=this.vStart[t],this.vEndCache[t]=this.vEnd[t]}return this},update:function(t){if(this.isRunning){if(t<this.startTime)return U.TweenData.RUNNING}else{if(!(t>=this.startTime))return U.TweenData.PENDING;this.isRunning=!0}var e,t=this.parent.frameBased?this.game.time.physicsElapsedMS:this.game.time.elapsedMS;for(e in this.parent.reverse?(this.dt-=t*this.parent.timeScale,this.dt=Math.max(this.dt,0)):(this.dt+=t*this.parent.timeScale,this.dt=Math.min(this.dt,this.duration)),this.percent=this.dt/this.duration,this.value=this.easingFunction(this.percent),this.vEnd){var i=this.vStart[e],n=this.vEnd[e];Array.isArray(n)?this.parent.target[e]=this.interpolationFunction.call(this.interpolationContext,n,this.value):this.parent.target[e]=i+(n-i)*this.value}return!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent?this.repeat():U.TweenData.RUNNING},generateData:function(t){this.parent.reverse?this.dt=this.duration:this.dt=0;var e=[],i=!1,n=1/t*1e3;do{this.parent.reverse?(this.dt-=n,this.dt=Math.max(this.dt,0)):(this.dt+=n,this.dt=Math.min(this.dt,this.duration)),this.percent=this.dt/this.duration,this.value=this.easingFunction(this.percent);var r,s={};for(r in this.vEnd){var o=this.vStart[r],a=this.vEnd[r];Array.isArray(a)?s[r]=this.interpolationFunction(a,this.value):s[r]=o+(a-o)*this.value}}while(e.push(s),(!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent)&&(i=!0),!i);return this.yoyo&&((t=e.slice()).reverse(),e=e.concat(t)),e},repeat:function(){if(this.yoyo){if(this.inReverse&&0===this.repeatCounter){for(var t in this.vStartCache)this.vStart[t]=this.vStartCache[t],this.vEnd[t]=this.vEndCache[t];return this.inReverse=!1,U.TweenData.COMPLETE}this.inReverse=!this.inReverse}else if(0===this.repeatCounter)return U.TweenData.COMPLETE;if(this.inReverse)for(var t in this.vStartCache)this.vStart[t]=this.vEndCache[t],this.vEnd[t]=this.vStartCache[t];else{for(var t in this.vStartCache)this.vStart[t]=this.vStartCache[t],this.vEnd[t]=this.vEndCache[t];0<this.repeatCounter&&this.repeatCounter--}return this.startTime=this.game.time.time,this.yoyo&&this.inReverse?this.startTime+=this.yoyoDelay:this.inReverse||(this.startTime+=this.repeatDelay),this.parent.reverse?this.dt=this.duration:this.dt=0,U.TweenData.LOOPED}},U.TweenData.prototype.constructor=U.TweenData,U.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},Out:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},InOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var e,i=.1;return 0===t?0:1===t?1:(e=!i||i<1?(i=1,.1):.4*Math.asin(1/i)/(2*Math.PI),-i*Math.pow(2,10*--t)*Math.sin((t-e)*(2*Math.PI)/.4))},Out:function(t){var e,i=.1;return 0===t?0:1===t?1:(e=!i||i<1?(i=1,.1):.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)},InOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(e=!i||i<1?(i=1,.1):.4*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?i*Math.pow(2,10*--t)*Math.sin((t-e)*(2*Math.PI)/.4)*-.5:i*Math.pow(2,-10*--t)*Math.sin((t-e)*(2*Math.PI)/.4)*.5+1)}},Back:{In:function(t){return t*t*(2.70158*t-1.70158)},Out:function(t){return--t*t*(2.70158*t+1.70158)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((1+e)*t-e)*.5:.5*((t-=2)*t*((1+e)*t+e)+2)}},Bounce:{In:function(t){return 1-U.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*U.Easing.Bounce.In(2*t):.5*U.Easing.Bounce.Out(2*t-1)+.5}}},U.Easing.Default=U.Easing.Linear.None,U.Easing.Power0=U.Easing.Linear.None,U.Easing.Power1=U.Easing.Quadratic.Out,U.Easing.Power2=U.Easing.Cubic.Out,U.Easing.Power3=U.Easing.Quartic.Out,U.Easing.Power4=U.Easing.Quintic.Out,U.Time=function(t){this.game=t,this.time=0,this.prevTime=0,this.now=0,this.elapsed=0,this.elapsedMS=0,this.physicsElapsed=1/60,this.physicsElapsedMS=1/60*1e3,this.desiredFpsMult=1/60,this._desiredFps=60,this.suggestedFps=this.desiredFps,this.slowMotion=1,this.advancedTiming=!1,this.frames=0,this.fps=0,this.fpsMin=1e3,this.fpsMax=0,this.msMin=1e3,this.msMax=0,this.pauseDuration=0,this.timeToCall=0,this.timeExpected=0,this.events=new U.Timer(this.game,!1),this._frameCount=0,this._elapsedAccumulator=0,this._started=0,this._timeLastSecond=0,this._pauseStarted=0,this._justResumed=!1,this._timers=[]},U.Time.prototype={boot:function(){this._started=Date.now(),this.time=Date.now(),this.events.start(),this.timeExpected=this.time},add:function(t){return this._timers.push(t),t},create:function(t){void 0===t&&(t=!0);t=new U.Timer(this.game,t);return this._timers.push(t),t},removeAll:function(){for(var t=0;t<this._timers.length;t++)this._timers[t].destroy();this._timers=[],this.events.removeAll()},refresh:function(){var t=this.time;this.time=Date.now(),this.elapsedMS=this.time-t},update:function(t){var e=this.time;this.time=Date.now(),this.elapsedMS=this.time-e,this.prevTime=this.now,this.now=t,this.elapsed=this.now-this.prevTime,this.game.raf._isSetTimeOut&&(this.timeToCall=Math.floor(Math.max(0,1e3/this._desiredFps-(this.timeExpected-t))),this.timeExpected=t+this.timeToCall),this.advancedTiming&&this.updateAdvancedTiming(),this.game.paused||(this.events.update(this.time),this._timers.length&&this.updateTimers())},updateTimers:function(){for(var t=0,e=this._timers.length;t<e;)this._timers[t].update(this.time)?t++:(this._timers.splice(t,1),e--)},updateAdvancedTiming:function(){this._frameCount++,this._elapsedAccumulator+=this.elapsed,this._frameCount>=2*this._desiredFps&&(this.suggestedFps=5*Math.floor(200/(this._elapsedAccumulator/this._frameCount)),this._frameCount=0,this._elapsedAccumulator=0),this.msMin=Math.min(this.msMin,this.elapsed),this.msMax=Math.max(this.msMax,this.elapsed),this.frames++,this.now>this._timeLastSecond+1e3&&(this.fps=Math.round(1e3*this.frames/(this.now-this._timeLastSecond)),this.fpsMin=Math.min(this.fpsMin,this.fps),this.fpsMax=Math.max(this.fpsMax,this.fps),this._timeLastSecond=this.now,this.frames=0)},gamePaused:function(){this._pauseStarted=Date.now(),this.events.pause();for(var t=this._timers.length;t--;)this._timers[t]._pause()},gameResumed:function(){this.time=Date.now(),this.pauseDuration=this.time-this._pauseStarted,this.events.resume();for(var t=this._timers.length;t--;)this._timers[t]._resume()},totalElapsedSeconds:function(){return.001*(this.time-this._started)},elapsedSince:function(t){return this.time-t},elapsedSecondsSince:function(t){return.001*(this.time-t)},reset:function(){this._started=this.time,this.removeAll()}},Object.defineProperty(U.Time.prototype,"desiredFps",{get:function(){return this._desiredFps},set:function(t){this._desiredFps=t,this.physicsElapsed=1/t,this.physicsElapsedMS=1e3*this.physicsElapsed,this.desiredFpsMult=1/t}}),U.Time.prototype.constructor=U.Time,U.Timer=function(t,e){void 0===e&&(e=!0),this.game=t,this.running=!1,this.autoDestroy=e,this.expired=!1,this.elapsed=0,this.events=[],this.onComplete=new U.Signal,this.nextTick=0,this.timeCap=1e3,this.paused=!1,this._codePaused=!1,this._started=0,this._pauseStarted=0,this._pauseTotal=0,this._now=Date.now(),this._len=0,this._marked=0,this._i=0,this._diff=0,this._newTick=0},U.Timer.MINUTE=6e4,U.Timer.SECOND=1e3,U.Timer.HALF=500,U.Timer.QUARTER=250,U.Timer.prototype={create:function(t,e,i,n,r,s){var o=t=Math.round(t);0===this._now?o+=this.game.time.time:o+=this._now;s=new U.TimerEvent(this,t,o,i,e,n,r,s);return this.events.push(s),this.order(),this.expired=!1,s},add:function(t,e,i){return this.create(t,!1,0,e,i,Array.prototype.slice.call(arguments,3))},repeat:function(t,e,i,n){return this.create(t,!1,e,i,n,Array.prototype.slice.call(arguments,4))},loop:function(t,e,i){return this.create(t,!0,0,e,i,Array.prototype.slice.call(arguments,3))},start:function(t){if(!this.running){this._started=this.game.time.time+(t||0),this.running=!0;for(var e=0;e<this.events.length;e++)this.events[e].tick=this.events[e].delay+this._started}},stop:function(t){this.running=!1,void 0===t&&(t=!0),t&&(this.events.length=0)},remove:function(t){for(var e=0;e<this.events.length;e++)if(this.events[e]===t)return this.events[e].pendingDelete=!0;return!1},order:function(){0<this.events.length&&(this.events.sort(this.sortHandler),this.nextTick=this.events[0].tick)},sortHandler:function(t,e){return t.tick<e.tick?-1:t.tick>e.tick?1:0},clearPendingEvents:function(){for(this._i=this.events.length;this._i--;)this.events[this._i].pendingDelete&&this.events.splice(this._i,1);this._len=this.events.length,this._i=0},update:function(t){if(this.paused)return!0;if(this.elapsed=t-this._now,this._now=t,this.elapsed>this.timeCap&&this.adjustEvents(t-this.elapsed),this._marked=0,this.clearPendingEvents(),this.running&&this._now>=this.nextTick&&0<this._len){for(;this._i<this._len&&this.running&&this._now>=this.events[this._i].tick&&!this.events[this._i].pendingDelete;)this._newTick=this._now+this.events[this._i].delay-(this._now-this.events[this._i].tick),this._newTick<0&&(this._newTick=this._now+this.events[this._i].delay),!0===this.events[this._i].loop?this.events[this._i].tick=this._newTick:0<this.events[this._i].repeatCount?(this.events[this._i].repeatCount--,this.events[this._i].tick=this._newTick):(this._marked++,this.events[this._i].pendingDelete=!0),this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args),this._i++;this.events.length>this._marked?this.order():(this.expired=!0,this.onComplete.dispatch(this))}return!this.expired||!this.autoDestroy},pause:function(){this.running&&(this._codePaused=!0,this.paused||(this._pauseStarted=this.game.time.time,this.paused=!0))},_pause:function(){!this.paused&&this.running&&(this._pauseStarted=this.game.time.time,this.paused=!0)},adjustEvents:function(t){for(var e,i=0;i<this.events.length;i++)this.events[i].pendingDelete||((e=this.events[i].tick-t)<0&&(e=0),this.events[i].tick=this._now+e);var n=this.nextTick-t;this.nextTick=n<0?this._now:this._now+n},resume:function(){var t;this.paused&&(t=this.game.time.time,this._pauseTotal+=t-this._now,this._now=t,this.adjustEvents(this._pauseStarted),this.paused=!1,this._codePaused=!1)},_resume:function(){this._codePaused||this.resume()},removeAll:function(){this.onComplete.removeAll(),this.events.length=0,this._len=0,this._i=0},destroy:function(){this.onComplete.removeAll(),this.running=!1,this.events=[],this._len=0,this._i=0}},Object.defineProperty(U.Timer.prototype,"next",{get:function(){return this.nextTick}}),Object.defineProperty(U.Timer.prototype,"duration",{get:function(){return this.running&&this.nextTick>this._now?this.nextTick-this._now:0}}),Object.defineProperty(U.Timer.prototype,"length",{get:function(){return this.events.length}}),Object.defineProperty(U.Timer.prototype,"ms",{get:function(){return this.running?this._now-this._started-this._pauseTotal:0}}),Object.defineProperty(U.Timer.prototype,"seconds",{get:function(){return this.running?.001*this.ms:0}}),U.Timer.prototype.constructor=U.Timer,U.TimerEvent=function(t,e,i,n,r,s,o,a){this.timer=t,this.delay=e,this.tick=i,this.repeatCount=n-1,this.loop=r,this.callback=s,this.callbackContext=o,this.args=a,this.pendingDelete=!1},U.TimerEvent.prototype.constructor=U.TimerEvent,U.AnimationManager=function(t){this.sprite=t,this.game=t.game,this.currentFrame=null,this.currentAnim=null,this.updateIfVisible=!0,this.isLoaded=!1,this._frameData=null,this._anims={},this._outputFrames=[]},U.AnimationManager.prototype={loadFrameData:function(t,e){if(void 0===t)return!1;if(this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(t);return this._frameData=t,null==e?this.frame=0:"string"==typeof e?this.frameName=e:this.frame=e,this.isLoaded=!0},copyFrameData:function(t,e){if(this._frameData=t.clone(),this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(this._frameData);return null==e?this.frame=0:"string"==typeof e?this.frameName=e:this.frame=e,this.isLoaded=!0},add:function(t,e,i,n,r){return e=e||[],i=i||60,void 0===n&&(n=!1),void 0===r&&(r=!(!e||"number"!=typeof e[0])),this._outputFrames=[],this._frameData.getFrameIndexes(e,r,this._outputFrames),this._anims[t]=new U.Animation(this.game,this.sprite,t,this._frameData,this._outputFrames,i,n),this.currentAnim=this._anims[t],this.sprite.tilingTexture&&(this.sprite.refreshTexture=!0),this._anims[t]},validateFrames:function(t,e){void 0===e&&(e=!0);for(var i=0;i<t.length;i++)if(!0===e){if(t[i]>this._frameData.total)return!1}else if(!1===this._frameData.checkFrameName(t[i]))return!1;return!0},play:function(t,e,i,n){if(this._anims[t])return this.currentAnim===this._anims[t]?!1===this.currentAnim.isPlaying?(this.currentAnim.paused=!1,this.currentAnim.play(e,i,n)):this.currentAnim:(this.currentAnim&&this.currentAnim.isPlaying&&this.currentAnim.stop(),this.currentAnim=this._anims[t],this.currentAnim.paused=!1,this.currentFrame=this.currentAnim.currentFrame,this.currentAnim.play(e,i,n))},stop:function(t,e){void 0===e&&(e=!1),!this.currentAnim||"string"==typeof t&&t!==this.currentAnim.name||this.currentAnim.stop(e)},update:function(){return!(this.updateIfVisible&&!this.sprite.visible||!this.currentAnim||!this.currentAnim.update()||(this.currentFrame=this.currentAnim.currentFrame,0))},next:function(t){this.currentAnim&&(this.currentAnim.next(t),this.currentFrame=this.currentAnim.currentFrame)},previous:function(t){this.currentAnim&&(this.currentAnim.previous(t),this.currentFrame=this.currentAnim.currentFrame)},getAnimation:function(t){return"string"==typeof t&&this._anims[t]?this._anims[t]:null},refreshFrame:function(){},destroy:function(){var t=null;for(t in this._anims)this._anims.hasOwnProperty(t)&&this._anims[t].destroy();this._anims={},this._outputFrames=[],this._frameData=null,this.currentAnim=null,this.currentFrame=null,this.sprite=null,this.game=null}},U.AnimationManager.prototype.constructor=U.AnimationManager,Object.defineProperty(U.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}}),Object.defineProperty(U.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}}),Object.defineProperty(U.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(t){this.currentAnim.paused=t}}),Object.defineProperty(U.AnimationManager.prototype,"name",{get:function(){if(this.currentAnim)return this.currentAnim.name}}),Object.defineProperty(U.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame)return this.currentFrame.index},set:function(t){"number"==typeof t&&this._frameData&&null!==this._frameData.getFrame(t)&&(this.currentFrame=this._frameData.getFrame(t),this.currentFrame&&this.sprite.setFrame(this.currentFrame))}}),Object.defineProperty(U.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame)return this.currentFrame.name},set:function(t){"string"==typeof t&&this._frameData&&null!==this._frameData.getFrameByName(t)&&(this.currentFrame=this._frameData.getFrameByName(t),this.currentFrame&&(this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame)))}}),U.Animation=function(t,e,i,n,r,s,o){void 0===o&&(o=!1),this.game=t,this._parent=e,this._frameData=n,this.name=i,this._frames=[],this._frames=this._frames.concat(r),this.delay=1e3/s,this.loop=o,this.loopCount=0,this.killOnComplete=!1,this.isFinished=!1,this.isPlaying=!1,this.isPaused=!1,this._pauseStartTime=0,this._frameIndex=0,this._frameDiff=0,this._frameSkip=1,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.onStart=new U.Signal,this.onUpdate=null,this.onComplete=new U.Signal,this.onLoop=new U.Signal,this.isReversed=!1,this.game.onPause.add(this.onPause,this),this.game.onResume.add(this.onResume,this)},U.Animation.prototype={play:function(t,e,i){return"number"==typeof t&&(this.delay=1e3/t),"boolean"==typeof e&&(this.loop=e),void 0!==i&&(this.killOnComplete=i),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=this.isReversed?this._frames.length-1:0,this.updateCurrentFrame(!1,!0),this._parent.events.onAnimationStart$dispatch(this._parent,this),this.onStart.dispatch(this._parent,this),(this._parent.animations.currentAnim=this)._parent.animations.currentFrame=this.currentFrame,this},restart:function(){this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this._parent.setFrame(this.currentFrame),(this._parent.animations.currentAnim=this)._parent.animations.currentFrame=this.currentFrame,this.onStart.dispatch(this._parent,this)},reverse:function(){return this.reversed=!this.reversed,this},reverseOnce:function(){return this.onComplete.addOnce(this.reverse,this),this.reverse()},setFrame:function(t,e){var i;if(void 0===e&&(e=!1),"string"==typeof t)for(var n=0;n<this._frames.length;n++)this._frameData.getFrame(this._frames[n]).name===t&&(i=n);else if("number"==typeof t)if(e)i=t;else for(n=0;n<this._frames.length;n++)this._frames[n]===t&&(i=n);i&&(this._frameIndex=i-1,this._timeNextFrame=this.game.time.time,this.update())},stop:function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,t&&(this.currentFrame=this._frameData.getFrame(this._frames[0]),this._parent.setFrame(this.currentFrame)),e&&(this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.time)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.time+this._frameDiff)},update:function(){return!this.isPaused&&!!(this.isPlaying&&this.game.time.time>=this._timeNextFrame)&&(this._frameSkip=1,this._frameDiff=this.game.time.time-this._timeNextFrame,this._timeLastFrame=this.game.time.time,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay),this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff),this.isReversed?this._frameIndex-=this._frameSkip:this._frameIndex+=this._frameSkip,!this.isReversed&&this._frameIndex>=this._frames.length||this.isReversed&&this._frameIndex<=-1?this.loop?(this._frameIndex=Math.abs(this._frameIndex)%this._frames.length,this.isReversed&&(this._frameIndex=this._frames.length-1-this._frameIndex),this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&this._parent.setFrame(this.currentFrame),this.loopCount++,this._parent.events.onAnimationLoop$dispatch(this._parent,this),this.onLoop.dispatch(this._parent,this),!this.onUpdate||(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData)):(this.complete(),!1):this.updateCurrentFrame(!0))},updateCurrentFrame:function(t,e){if(void 0===e&&(e=!1),!this._frameData)return!1;var i=this.currentFrame.index;return this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(e||!e&&i!==this.currentFrame.index)&&this._parent.setFrame(this.currentFrame),!this.onUpdate||!t||(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData)},next:function(t){void 0===t&&(t=1);t=this._frameIndex+t;t>=this._frames.length&&(this.loop?t%=this._frames.length:t=this._frames.length-1),t!==this._frameIndex&&(this._frameIndex=t,this.updateCurrentFrame(!0))},previous:function(t){void 0===t&&(t=1);t=this._frameIndex-t;t<0&&(this.loop?t=this._frames.length+t:t++),t!==this._frameIndex&&(this._frameIndex=t,this.updateCurrentFrame(!0))},updateFrameData:function(t){this._frameData=t,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){this._frameData&&(this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose(),this.onUpdate&&this.onUpdate.dispose())},complete:function(){this._frameIndex=this._frames.length-1,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this),this.killOnComplete&&this._parent.kill()}},U.Animation.prototype.constructor=U.Animation,Object.defineProperty(U.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(t){(this.isPaused=t)?this._pauseStartTime=this.game.time.time:this.isPlaying&&(this._timeNextFrame=this.game.time.time+this.delay)}}),Object.defineProperty(U.Animation.prototype,"reversed",{get:function(){return this.isReversed},set:function(t){this.isReversed=t}}),Object.defineProperty(U.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}}),Object.defineProperty(U.Animation.prototype,"frame",{get:function(){return null!==this.currentFrame?this.currentFrame.index:this._frameIndex},set:function(t){this.currentFrame=this._frameData.getFrame(this._frames[t]),null!==this.currentFrame&&(this._frameIndex=t,this._parent.setFrame(this.currentFrame),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))}}),Object.defineProperty(U.Animation.prototype,"speed",{get:function(){return 1e3/this.delay},set:function(t){0<t&&(this.delay=1e3/t)}}),Object.defineProperty(U.Animation.prototype,"enableUpdate",{get:function(){return null!==this.onUpdate},set:function(t){t&&null===this.onUpdate?this.onUpdate=new U.Signal:t||null===this.onUpdate||(this.onUpdate.dispose(),this.onUpdate=null)}}),U.Animation.generateFrameNames=function(t,e,i,n,r){void 0===n&&(n="");var s=[],o="";if(e<i)for(var a=e;a<=i;a++)o=t+(o="number"==typeof r?U.Utils.pad(a.toString(),r,"0",1):a.toString())+n,s.push(o);else for(a=e;i<=a;a--)o=t+(o="number"==typeof r?U.Utils.pad(a.toString(),r,"0",1):a.toString())+n,s.push(o);return s},U.Frame=function(t,e,i,n,r,s){this.index=t,this.x=e,this.y=i,this.width=n,this.height=r,this.name=s,this.centerX=Math.floor(n/2),this.centerY=Math.floor(r/2),this.distance=U.Math.distance(0,0,n,r),this.rotated=!1,this.rotationDirection="cw",this.trimmed=!1,this.sourceSizeW=n,this.sourceSizeH=r,this.spriteSourceSizeX=0,this.spriteSourceSizeY=0,this.spriteSourceSizeW=0,this.spriteSourceSizeH=0,this.right=this.x+this.width,this.bottom=this.y+this.height},U.Frame.prototype={resize:function(t,e){this.width=t,this.height=e,this.centerX=Math.floor(t/2),this.centerY=Math.floor(e/2),this.distance=U.Math.distance(0,0,t,e),this.sourceSizeW=t,this.sourceSizeH=e,this.right=this.x+t,this.bottom=this.y+e},setTrim:function(t,e,i,n,r,s,o){(this.trimmed=t)&&(this.sourceSizeW=e,this.sourceSizeH=i,this.centerX=Math.floor(e/2),this.centerY=Math.floor(i/2),this.spriteSourceSizeX=n,this.spriteSourceSizeY=r,this.spriteSourceSizeW=s,this.spriteSourceSizeH=o)},clone:function(){var t,e=new U.Frame(this.index,this.x,this.y,this.width,this.height,this.name);for(t in this)this.hasOwnProperty(t)&&(e[t]=this[t]);return e},getRect:function(t){return void 0===t?t=new U.Rectangle(this.x,this.y,this.width,this.height):t.setTo(this.x,this.y,this.width,this.height),t}},U.Frame.prototype.constructor=U.Frame,U.FrameData=function(){this._frames=[],this._frameNames=[]},U.FrameData.prototype={addFrame:function(t){return t.index=this._frames.length,this._frames.push(t),""!==t.name&&(this._frameNames[t.name]=t.index),t},getFrame:function(t){return t>=this._frames.length&&(t=0),this._frames[t]},getFrameByName:function(t){return"number"==typeof this._frameNames[t]?this._frames[this._frameNames[t]]:null},checkFrameName:function(t){return null!=this._frameNames[t]},clone:function(){for(var t,e=new U.FrameData,i=0;i<this._frames.length;i++)e._frames.push(this._frames[i].clone());for(t in this._frameNames)this._frameNames.hasOwnProperty(t)&&e._frameNames.push(this._frameNames[t]);return e},getFrameRange:function(t,e,i){void 0===i&&(i=[]);for(var n=t;n<=e;n++)i.push(this._frames[n]);return i},getFrames:function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=[]),void 0===t||0===t.length)for(var n=0;n<this._frames.length;n++)i.push(this._frames[n]);else for(n=0;n<t.length;n++)e?i.push(this.getFrame(t[n])):i.push(this.getFrameByName(t[n]));return i},getFrameIndexes:function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=[]),void 0===t||0===t.length)for(var n=0;n<this._frames.length;n++)i.push(this._frames[n].index);else for(n=0;n<t.length;n++)e&&this._frames[t[n]]?i.push(this._frames[t[n]].index):this.getFrameByName(t[n])&&i.push(this.getFrameByName(t[n]).index);return i},destroy:function(){this._frames=null,this._frameNames=null}},U.FrameData.prototype.constructor=U.FrameData,Object.defineProperty(U.FrameData.prototype,"total",{get:function(){return this._frames.length}}),U.AnimationParser={spriteSheet:function(t,e,i,n,r,s,o){var a=e;if("string"==typeof e&&(a=t.cache.getImage(e)),null===a)return null;var l=a.width,t=a.height;i<=0&&(i=Math.floor(-l/Math.min(-1,i))),n<=0&&(n=Math.floor(-t/Math.min(-1,n)));var e=Math.floor((l-s)/(i+o)),a=Math.floor((t-s)/(n+o)),p=-1!==r?r:e*a;if(0===l||0===t||l<i||t<n||0===p)return null;for(var h=new U.FrameData,u=s,c=s,d=0;d<p;d++)h.addFrame(new U.Frame(d,u,c,i,n,"")),(u+=i+o)+i>l&&(u=s,c+=n+o);return h},JSONData:function(t,e){if(e.frames){for(var i,n=new U.FrameData,r=e.frames,s=0;s<r.length;s++)i=n.addFrame(new U.Frame(s,r[s].frame.x,r[s].frame.y,r[s].frame.w,r[s].frame.h,r[s].filename)),r[s].trimmed&&i.setTrim(r[s].trimmed,r[s].sourceSize.w,r[s].sourceSize.h,r[s].spriteSourceSize.x,r[s].spriteSourceSize.y,r[s].spriteSourceSize.w,r[s].spriteSourceSize.h);return n}},JSONDataPyxel:function(t,e){if(["layers","tilewidth","tileheight","tileswide","tileshigh"].forEach(function(t){e[t]}),1===e.layers.length){for(var i=new U.FrameData,n=e.tileheight,r=e.tilewidth,s=e.layers[0].tiles,o=0;o<s.length;o++)i.addFrame(new U.Frame(o,s[o].x,s[o].y,r,n,"frame_"+o)).setTrim(!1);return i}},JSONDataHash:function(t,e){if(e.frames){var i,n,r=new U.FrameData,s=e.frames,o=0;for(n in s)i=r.addFrame(new U.Frame(o,s[n].frame.x,s[n].frame.y,s[n].frame.w,s[n].frame.h,n)),s[n].trimmed&&i.setTrim(s[n].trimmed,s[n].sourceSize.w,s[n].sourceSize.h,s[n].spriteSourceSize.x,s[n].spriteSourceSize.y,s[n].spriteSourceSize.w,s[n].spriteSourceSize.h),o++;return r}},XMLData:function(t,e){if(e.getElementsByTagName("TextureAtlas")){for(var i,n,r,s,o,a,l,p,h,u,c=new U.FrameData,d=e.getElementsByTagName("SubTexture"),_=0;_<d.length;_++)i=(n=d[_].attributes).name.value,r=parseInt(n.x.value,10),s=parseInt(n.y.value,10),o=parseInt(n.width.value,10),a=parseInt(n.height.value,10),p=l=null,n.frameX&&(l=Math.abs(parseInt(n.frameX.value,10)),p=Math.abs(parseInt(n.frameY.value,10)),h=parseInt(n.frameWidth.value,10),u=parseInt(n.frameHeight.value,10)),i=c.addFrame(new U.Frame(_,r,s,o,a,i)),null===l&&null===p||i.setTrim(!0,o,a,l,p,h,u);return c}}},U.Cache=function(t){this.game=t,this.autoResolveURL=!1,this._cache={canvas:{},image:{},texture:{},sound:{},video:{},text:{},json:{},xml:{},physics:{},tilemap:{},binary:{},bitmapData:{},bitmapFont:{},shader:{},renderTexture:{}},this._urlMap={},this._urlResolver=new Image,this._urlTemp=null,this.onSoundUnlock=new U.Signal,this._cacheMap=[],this._cacheMap[U.Cache.CANVAS]=this._cache.canvas,this._cacheMap[U.Cache.IMAGE]=this._cache.image,this._cacheMap[U.Cache.TEXTURE]=this._cache.texture,this._cacheMap[U.Cache.SOUND]=this._cache.sound,this._cacheMap[U.Cache.TEXT]=this._cache.text,this._cacheMap[U.Cache.PHYSICS]=this._cache.physics,this._cacheMap[U.Cache.TILEMAP]=this._cache.tilemap,this._cacheMap[U.Cache.BINARY]=this._cache.binary,this._cacheMap[U.Cache.BITMAPDATA]=this._cache.bitmapData,this._cacheMap[U.Cache.BITMAPFONT]=this._cache.bitmapFont,this._cacheMap[U.Cache.JSON]=this._cache.json,this._cacheMap[U.Cache.XML]=this._cache.xml,this._cacheMap[U.Cache.VIDEO]=this._cache.video,this._cacheMap[U.Cache.SHADER]=this._cache.shader,this._cacheMap[U.Cache.RENDER_TEXTURE]=this._cache.renderTexture,this.addDefaultImage(),this.addMissingImage()},U.Cache.CANVAS=1,U.Cache.IMAGE=2,U.Cache.TEXTURE=3,U.Cache.SOUND=4,U.Cache.TEXT=5,U.Cache.PHYSICS=6,U.Cache.TILEMAP=7,U.Cache.BINARY=8,U.Cache.BITMAPDATA=9,U.Cache.BITMAPFONT=10,U.Cache.JSON=11,U.Cache.XML=12,U.Cache.VIDEO=13,U.Cache.SHADER=14,U.Cache.RENDER_TEXTURE=15,U.Cache.DEFAULT=null,U.Cache.MISSING=null,U.Cache.prototype={addCanvas:function(t,e,i){void 0===i&&(i=e.getContext("2d")),this._cache.canvas[t]={canvas:e,context:i}},addImage:function(t,e,i){this.checkImageKey(t)&&this.removeImage(t);var n={key:t,url:e,data:i,base:new PIXI.BaseTexture(i),frame:new U.Frame(0,0,0,i.width,i.height,t),frameData:new U.FrameData};return n.frameData.addFrame(new U.Frame(0,0,0,i.width,i.height,e)),this._cache.image[t]=n,this._resolveURL(e,n),"__default"===t?U.Cache.DEFAULT=new PIXI.Texture(n.base):"__missing"===t&&(U.Cache.MISSING=new PIXI.Texture(n.base)),n},addDefaultImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==";t=this.addImage("__default",null,t);t.base.skipRender=!0,U.Cache.DEFAULT=new PIXI.Texture(t.base)},addMissingImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==";t=this.addImage("__missing",null,t);U.Cache.MISSING=new PIXI.Texture(t.base)},addSound:function(t,e,i,n,r){void 0===n&&(r=!(n=!0)),void 0===r&&(r=!(n=!1));var s=r?!0:!1;this._cache.sound[t]={url:e,data:i,isDecoding:!1,decoded:s,webAudio:n,audioTag:r,locked:this.game.sound.touchLocked},this._resolveURL(e,this._cache.sound[t])},addText:function(t,e,i){this._cache.text[t]={url:e,data:i},this._resolveURL(e,this._cache.text[t])},addPhysicsData:function(t,e,i,n){this._cache.physics[t]={url:e,data:i,format:n},this._resolveURL(e,this._cache.physics[t])},addTilemap:function(t,e,i,n){this._cache.tilemap[t]={url:e,data:i,format:n},this._resolveURL(e,this._cache.tilemap[t])},addBinary:function(t,e){this._cache.binary[t]=e},addBitmapData:function(t,e,i){return e.key=t,void 0===i&&(i=new U.FrameData).addFrame(e.textureFrame),this._cache.bitmapData[t]={data:e,frameData:i},e},addBitmapFont:function(t,e,i,n,r,s,o){i={url:e,data:i,font:null,base:new PIXI.BaseTexture(i)};void 0===s&&(s=0),void 0===o&&(o=0),i.font="json"===r?U.LoaderParser.jsonBitmapFont(n,i.base,s,o):U.LoaderParser.xmlBitmapFont(n,i.base,s,o),this._cache.bitmapFont[t]=i,this._resolveURL(e,i)},addJSON:function(t,e,i){this._cache.json[t]={url:e,data:i},this._resolveURL(e,this._cache.json[t])},addXML:function(t,e,i){this._cache.xml[t]={url:e,data:i},this._resolveURL(e,this._cache.xml[t])},addVideo:function(t,e,i,n){this._cache.video[t]={url:e,data:i,isBlob:n,locked:!0},this._resolveURL(e,this._cache.video[t])},addShader:function(t,e,i){this._cache.shader[t]={url:e,data:i},this._resolveURL(e,this._cache.shader[t])},addRenderTexture:function(t,e){this._cache.renderTexture[t]={texture:e,frame:new U.Frame(0,0,0,e.width,e.height,"","")}},addSpriteSheet:function(t,e,i,n,r,s,o,a){void 0===s&&(s=-1),void 0===o&&(o=0),void 0===a&&(a=0);a={key:t,url:e,data:i,frameWidth:n,frameHeight:r,margin:o,spacing:a,base:new PIXI.BaseTexture(i),frameData:U.AnimationParser.spriteSheet(this.game,i,n,r,s,o,a)};this._cache.image[t]=a,this._resolveURL(e,a)},addTextureAtlas:function(t,e,i,n,r){i={key:t,url:e,data:i,base:new PIXI.BaseTexture(i)};r===U.Loader.TEXTURE_ATLAS_XML_STARLING?i.frameData=U.AnimationParser.XMLData(this.game,n,t):r===U.Loader.TEXTURE_ATLAS_JSON_PYXEL?i.frameData=U.AnimationParser.JSONDataPyxel(this.game,n,t):Array.isArray(n.frames)?i.frameData=U.AnimationParser.JSONData(this.game,n,t):i.frameData=U.AnimationParser.JSONDataHash(this.game,n,t),this._cache.image[t]=i,this._resolveURL(e,i)},reloadSound:function(t){var e=this,i=this.getSound(t);i&&(i.data.src=i.url,i.data.addEventListener("canplaythrough",function(){return e.reloadSoundComplete(t)},!1),i.data.load())},reloadSoundComplete:function(t){var e=this.getSound(t);e&&(e.locked=!1,this.onSoundUnlock.dispatch(t))},updateSound:function(t,e,i){t=this.getSound(t);t&&(t[e]=i)},decodedSound:function(t,e){t=this.getSound(t);t.data=e,t.decoded=!0,t.isDecoding=!1},isSoundDecoded:function(t){t=this.getItem(t,U.Cache.SOUND,"isSoundDecoded");if(t)return t.decoded},isSoundReady:function(t){t=this.getItem(t,U.Cache.SOUND,"isSoundDecoded");if(t)return t.decoded&&!this.game.sound.touchLocked},checkKey:function(t,e){return!!this._cacheMap[t][e]},checkURL:function(t){return!!this._urlMap[this._resolveURL(t)]},checkCanvasKey:function(t){return this.checkKey(U.Cache.CANVAS,t)},checkImageKey:function(t){return this.checkKey(U.Cache.IMAGE,t)},checkTextureKey:function(t){return this.checkKey(U.Cache.TEXTURE,t)},checkSoundKey:function(t){return this.checkKey(U.Cache.SOUND,t)},checkTextKey:function(t){return this.checkKey(U.Cache.TEXT,t)},checkPhysicsKey:function(t){return this.checkKey(U.Cache.PHYSICS,t)},checkTilemapKey:function(t){return this.checkKey(U.Cache.TILEMAP,t)},checkBinaryKey:function(t){return this.checkKey(U.Cache.BINARY,t)},checkBitmapDataKey:function(t){return this.checkKey(U.Cache.BITMAPDATA,t)},checkBitmapFontKey:function(t){return this.checkKey(U.Cache.BITMAPFONT,t)},checkJSONKey:function(t){return this.checkKey(U.Cache.JSON,t)},checkXMLKey:function(t){return this.checkKey(U.Cache.XML,t)},checkVideoKey:function(t){return this.checkKey(U.Cache.VIDEO,t)},checkShaderKey:function(t){return this.checkKey(U.Cache.SHADER,t)},checkRenderTextureKey:function(t){return this.checkKey(U.Cache.RENDER_TEXTURE,t)},getItem:function(t,e,i,n){return this.checkKey(e,t)?void 0===n?this._cacheMap[e][t]:this._cacheMap[e][t][n]:null},getCanvas:function(t){return this.getItem(t,U.Cache.CANVAS,"getCanvas","canvas")},getImage:function(t,e){null!=t||(t="__default"),void 0===e&&(e=!1);t=this.getItem(t,U.Cache.IMAGE,"getImage");return null===t&&(t=this.getItem("__missing",U.Cache.IMAGE,"getImage")),e?t:t.data},getTextureFrame:function(t){return this.getItem(t,U.Cache.TEXTURE,"getTextureFrame","frame")},getSound:function(t){return this.getItem(t,U.Cache.SOUND,"getSound")},getSoundData:function(t){return this.getItem(t,U.Cache.SOUND,"getSoundData","data")},getText:function(t){return this.getItem(t,U.Cache.TEXT,"getText","data")},getPhysicsData:function(t,e,i){t=this.getItem(t,U.Cache.PHYSICS,"getPhysicsData","data");if(null===t||null==e)return t;if(t[e]){var n,r=t[e];if(!r||!i)return r;for(n in r)if(n=r[n],n.fixtureKey===i)return n}return null},getTilemapData:function(t){return this.getItem(t,U.Cache.TILEMAP,"getTilemapData")},getBinary:function(t){return this.getItem(t,U.Cache.BINARY,"getBinary")},getBitmapData:function(t){return this.getItem(t,U.Cache.BITMAPDATA,"getBitmapData","data")},getBitmapFont:function(t){return this.getItem(t,U.Cache.BITMAPFONT,"getBitmapFont")},getJSON:function(t,e){t=this.getItem(t,U.Cache.JSON,"getJSON","data");return t?e?U.Utils.extend(!0,Array.isArray(t)?[]:{},t):t:null},getXML:function(t){return this.getItem(t,U.Cache.XML,"getXML","data")},getVideo:function(t){return this.getItem(t,U.Cache.VIDEO,"getVideo")},getShader:function(t){return this.getItem(t,U.Cache.SHADER,"getShader","data")},getRenderTexture:function(t){return this.getItem(t,U.Cache.RENDER_TEXTURE,"getRenderTexture")},getBaseTexture:function(t,e){return void 0===e&&(e=U.Cache.IMAGE),this.getItem(t,e,"getBaseTexture","base")},getFrame:function(t,e){return void 0===e&&(e=U.Cache.IMAGE),this.getItem(t,e,"getFrame","frame")},getFrameCount:function(t,e){e=this.getFrameData(t,e);return e?e.total:0},getFrameData:function(t,e){return void 0===e&&(e=U.Cache.IMAGE),this.getItem(t,e,"getFrameData","frameData")},hasFrameData:function(t,e){return void 0===e&&(e=U.Cache.IMAGE),null!==this.getItem(t,e,"","frameData")},updateFrameData:function(t,e,i){void 0===i&&(i=U.Cache.IMAGE),this._cacheMap[i][t]&&(this._cacheMap[i][t].frameData=e)},getFrameByIndex:function(t,e,i){i=this.getFrameData(t,i);return i?i.getFrame(e):null},getFrameByName:function(t,e,i){i=this.getFrameData(t,i);return i?i.getFrameByName(e):null},getURL:function(t){return(t=this._resolveURL(t))?this._urlMap[t]:null},getKeys:function(t){void 0===t&&(t=U.Cache.IMAGE);var e=[];if(this._cacheMap[t])for(var i in this._cacheMap[t])"__default"!==i&&"__missing"!==i&&e.push(i);return e},removeCanvas:function(t){delete this._cache.canvas[t]},removeImage:function(t,e){void 0===e&&(e=!0);var i=this.getImage(t,!0);e&&i.base&&i.base.destroy(),delete this._cache.image[t]},removeSound:function(t){delete this._cache.sound[t]},removeText:function(t){delete this._cache.text[t]},removePhysics:function(t){delete this._cache.physics[t]},removeTilemap:function(t){delete this._cache.tilemap[t]},removeBinary:function(t){delete this._cache.binary[t]},removeBitmapData:function(t){delete this._cache.bitmapData[t]},removeBitmapFont:function(t){delete this._cache.bitmapFont[t]},removeJSON:function(t){delete this._cache.json[t]},removeXML:function(t){delete this._cache.xml[t]},removeVideo:function(t){delete this._cache.video[t]},removeShader:function(t){delete this._cache.shader[t]},removeRenderTexture:function(t){delete this._cache.renderTexture[t]},removeSpriteSheet:function(t){delete this._cache.spriteSheet[t]},removeTextureAtlas:function(t){delete this._cache.atlas[t]},clearGLTextures:function(){for(var t in this._cache.image)this._cache.image[t].base._glTextures=[]},_resolveURL:function(t,e){return this.autoResolveURL?(this._urlResolver.src=this.game.load.baseURL+t,this._urlTemp=this._urlResolver.src,this._urlResolver.src="",e&&(this._urlMap[this._urlTemp]=e),this._urlTemp):null},destroy:function(){for(var t=0;t<this._cacheMap.length;t++){var e,i=this._cacheMap[t];for(e in i)"__default"!==e&&"__missing"!==e&&(i[e].destroy&&i[e].destroy(),delete i[e])}this._urlMap=null,this._urlResolver=null,this._urlTemp=null}},U.Cache.prototype.constructor=U.Cache,U.Loader=function(t){this.game=t,this.cache=t.cache,this.resetLocked=!1,this.isLoading=!1,this.hasLoaded=!1,this.preloadSprite=null,this.crossOrigin=!1,this.baseURL="",this.path="",this.headers={requestedWith:!1,json:"application/json",xml:"application/xml"},this.onLoadStart=new U.Signal,this.onLoadComplete=new U.Signal,this.onPackComplete=new U.Signal,this.onFileStart=new U.Signal,this.onFileComplete=new U.Signal,this.onFileError=new U.Signal,this.useXDomainRequest=!1,this._warnedAboutXDomainRequest=!1,this.enableParallel=!0,this.maxParallelDownloads=4,this._withSyncPointDepth=0,this._fileList=[],this._flightQueue=[],this._processingHead=0,this._fileLoadStarted=!1,this._totalPackCount=0,this._totalFileCount=0,this._loadedPackCount=0,this._loadedFileCount=0},U.Loader.TEXTURE_ATLAS_JSON_ARRAY=0,U.Loader.TEXTURE_ATLAS_JSON_HASH=1,U.Loader.TEXTURE_ATLAS_XML_STARLING=2,U.Loader.PHYSICS_LIME_CORONA_JSON=3,U.Loader.PHYSICS_PHASER_JSON=4,U.Loader.TEXTURE_ATLAS_JSON_PYXEL=5,U.Loader.prototype={setPreloadSprite:function(t,e){e=e||0,this.preloadSprite={sprite:t,direction:e,width:t.width,height:t.height,rect:null},this.preloadSprite.rect=0===e?new U.Rectangle(0,0,1,t.height):new U.Rectangle(0,0,t.width,1),t.crop(this.preloadSprite.rect),t.visible=!0},resize:function(){this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height&&(this.preloadSprite.rect.height=this.preloadSprite.sprite.height)},checkKeyExists:function(t,e){return-1<this.getAssetIndex(t,e)},getAssetIndex:function(t,e){for(var i=-1,n=0;n<this._fileList.length;n++){var r=this._fileList[n];if(r.type===t&&r.key===e&&(i=n,!r.loaded&&!r.loading))break}return i},getAsset:function(t,e){e=this.getAssetIndex(t,e);return-1<e&&{index:e,file:this._fileList[e]}},reset:function(t,e){void 0===e&&(e=!1),this.resetLocked||(t&&(this.preloadSprite=null),this.isLoading=!1,this._processingHead=0,this._fileList.length=0,this._flightQueue.length=0,this._fileLoadStarted=!1,this._totalFileCount=0,this._totalPackCount=0,this._loadedPackCount=0,this._loadedFileCount=0,e&&(this.onLoadStart.removeAll(),this.onLoadComplete.removeAll(),this.onPackComplete.removeAll(),this.onFileStart.removeAll(),this.onFileComplete.removeAll(),this.onFileError.removeAll()))},addToFileList:function(t,e,i,n,r,s){if(void 0===r&&(r=!1),void 0===e||""===e)return this;if(null==i){if(!s)return this;i=e+s}var o={type:t,key:e,path:this.path,url:i,syncPoint:0<this._withSyncPointDepth,data:null,loading:!1,loaded:!1,error:!1};if(n)for(var a in n)o[a]=n[a];e=this.getAssetIndex(t,e);return r&&-1<e?(r=this._fileList[e]).loading||r.loaded?(this._fileList.push(o),this._totalFileCount++):this._fileList[e]=o:-1===e&&(this._fileList.push(o),this._totalFileCount++),this},replaceInFileList:function(t,e,i,n){return this.addToFileList(t,e,i,n,!0)},pack:function(t,e,i,n){if(void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=null),!e&&!i)return this;var r={type:"packfile",key:t,url:e,path:this.path,syncPoint:!0,data:null,loading:!1,loaded:!1,error:!1,callbackContext:n};i&&("string"==typeof i&&(i=JSON.parse(i)),r.data=i||{},r.loaded=!0);for(var s=0;s<this._fileList.length+1;s++){var o=this._fileList[s];if(!o||!o.loaded&&!o.loading&&"packfile"!==o.type){this._fileList.splice(s,0,r),this._totalPackCount++;break}}return this},image:function(t,e,i){return this.addToFileList("image",t,e,void 0,i,".png")},images:function(t,e){if(Array.isArray(e))for(var i=0;i<t.length;i++)this.image(t[i],e[i]);else for(i=0;i<t.length;i++)this.image(t[i]);return this},text:function(t,e,i){return this.addToFileList("text",t,e,void 0,i,".txt")},json:function(t,e,i){return this.addToFileList("json",t,e,void 0,i,".json")},shader:function(t,e,i){return this.addToFileList("shader",t,e,void 0,i,".frag")},xml:function(t,e,i){return this.addToFileList("xml",t,e,void 0,i,".xml")},script:function(t,e,i,n){return void 0===i&&(i=!1),!1!==i&&void 0===n&&(n=this),this.addToFileList("script",t,e,{syncPoint:!0,callback:i,callbackContext:n},!1,".js")},binary:function(t,e,i,n){return void 0===i&&(i=!1),!1!==i&&void 0===n&&(n=i),this.addToFileList("binary",t,e,{callback:i,callbackContext:n},!1,".bin")},spritesheet:function(t,e,i,n,r,s,o){return void 0===r&&(r=-1),void 0===s&&(s=0),void 0===o&&(o=0),this.addToFileList("spritesheet",t,e,{frameWidth:i,frameHeight:n,frameMax:r,margin:s,spacing:o},!1,".png")},audio:function(t,e,i){return this.game.sound.noAudio?this:(void 0===i&&(i=!0),"string"==typeof e&&(e=[e]),this.addToFileList("audio",t,e,{buffer:null,autoDecode:i}))},audioSprite:function(t,e,i,n,r){return this.game.sound.noAudio||(void 0===i&&(i=null),void 0===n&&(n=null),void 0===r&&(r=!0),this.audio(t,e,r),i?this.json(t+"-audioatlas",i):n&&("string"==typeof n&&(n=JSON.parse(n)),this.cache.addJSON(t+"-audioatlas","",n))),this},audiosprite:function(t,e,i,n,r){return this.audioSprite(t,e,i,n,r)},video:function(t,e,i,n){return void 0===i&&(i=this.game.device.firefox?"loadeddata":"canplaythrough"),void 0===n&&(n=!1),"string"==typeof e&&(e=[e]),this.addToFileList("video",t,e,{buffer:null,asBlob:n,loadEvent:i})},tilemap:function(t,e,i,n){if(void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=U.Tilemap.CSV),e||i||(e=n===U.Tilemap.CSV?t+".csv":t+".json"),i){switch(n){case U.Tilemap.CSV:break;case U.Tilemap.TILED_JSON:"string"==typeof i&&(i=JSON.parse(i))}this.cache.addTilemap(t,null,i,n)}else this.addToFileList("tilemap",t,e,{format:n});return this},physics:function(t,e,i,n){return void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=U.Physics.LIME_CORONA_JSON),e||i||(e=t+".json"),i?("string"==typeof i&&(i=JSON.parse(i)),this.cache.addPhysicsData(t,null,i,n)):this.addToFileList("physics",t,e,{format:n}),this},bitmapFont:function(t,e,i,n,r,s){if(null!=e||(e=t+".png"),void 0===i&&(i=null),void 0===n&&(n=null),null===i&&null===n&&(i=t+".xml"),void 0===r&&(r=0),void 0===s&&(s=0),i)this.addToFileList("bitmapfont",t,e,{atlasURL:i,xSpacing:r,ySpacing:s});else if("string"==typeof n){var o,a;try{o=JSON.parse(n)}catch(t){a=this.parseXml(n)}if(!a&&!o)throw new Error("Phaser.Loader. Invalid Bitmap Font atlas given");this.addToFileList("bitmapfont",t,e,{atlasURL:null,atlasData:o||a,atlasType:o?"json":"xml",xSpacing:r,ySpacing:s})}return this},atlasJSONArray:function(t,e,i,n){return this.atlas(t,e,i,n,U.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(t,e,i,n){return this.atlas(t,e,i,n,U.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(t,e,i,n){return void 0===i&&(i=null),void 0===n&&(n=null),i||n||(i=t+".xml"),this.atlas(t,e,i,n,U.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(t,e,i,n,r){if(null!=e||(e=t+".png"),void 0===i&&(i=null),void 0===n&&(n=null),void 0===r&&(r=U.Loader.TEXTURE_ATLAS_JSON_ARRAY),i||n||(i=r===U.Loader.TEXTURE_ATLAS_XML_STARLING?t+".xml":t+".json"),i)this.addToFileList("textureatlas",t,e,{atlasURL:i,format:r});else{switch(r){case U.Loader.TEXTURE_ATLAS_JSON_ARRAY:"string"==typeof n&&(n=JSON.parse(n));break;case U.Loader.TEXTURE_ATLAS_XML_STARLING:if("string"==typeof n){var s=this.parseXml(n);if(!s)throw new Error("Phaser.Loader. Invalid Texture Atlas XML given");n=s}}this.addToFileList("textureatlas",t,e,{atlasURL:null,atlasData:n,format:r})}return this},withSyncPoint:function(t,e){this._withSyncPointDepth++;try{t.call(e||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(t,e){e=this.getAsset(t,e);return e&&(e.file.syncPoint=!0),this},removeFile:function(t,e){e=this.getAsset(t,e);e&&(e.loaded||e.loading||this._fileList.splice(e.index,1))},removeAll:function(){this._fileList.length=0,this._flightQueue.length=0},start:function(){this.isLoading||(this.hasLoaded=!1,this.isLoading=!0,this.updateProgress(),this.processLoadQueue())},processLoadQueue:function(){if(this.isLoading){for(var t=0;t<this._flightQueue.length;t++)((e=this._flightQueue[t]).loaded||e.error)&&(this._flightQueue.splice(t,1),t--,e.loading=!1,e.requestUrl=null,e.requestObject=null,e.error&&this.onFileError.dispatch(e.key,e),"packfile"!==e.type?(this._loadedFileCount++,this.onFileComplete.dispatch(this.progress,e.key,!e.error,this._loadedFileCount,this._totalFileCount)):"packfile"===e.type&&e.error&&(this._loadedPackCount++,this.onPackComplete.dispatch(e.key,!e.error,this._loadedPackCount,this._totalPackCount)));for(var e,i,n=!1,r=this.enableParallel?U.Math.clamp(this.maxParallelDownloads,1,12):1,t=this._processingHead;t<this._fileList.length;t++)if("packfile"===(e=this._fileList[t]).type&&!e.error&&e.loaded&&t===this._processingHead&&(this.processPack(e),this._loadedPackCount++,this.onPackComplete.dispatch(e.key,!e.error,this._loadedPackCount,this._totalPackCount)),e.loaded||e.error?t===this._processingHead&&(this._processingHead=t+1):!e.loading&&this._flightQueue.length<r&&("packfile"!==e.type||e.data?n||(this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this._flightQueue.push(e),e.loading=!0,this.onFileStart.dispatch(this.progress,e.key,e.url),this.loadFile(e)):(this._flightQueue.push(e),e.loading=!0,this.loadFile(e))),!e.loaded&&e.syncPoint&&(n=!0),this._flightQueue.length>=r||n&&this._loadedPackCount===this._totalPackCount)break;this.updateProgress(),this._processingHead>=this._fileList.length?this.finishedLoading():this._flightQueue.length||(i=this,setTimeout(function(){i.finishedLoading(!0)},2e3))}else this.finishedLoading(!0)},finishedLoading:function(t){this.hasLoaded||(this.hasLoaded=!0,this.isLoading=!1,t||this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this.onLoadComplete.dispatch(),this.game.state.loadComplete(),this.reset())},asyncComplete:function(t,e){void 0===e&&(e=""),t.loaded=!0,t.error=!!e,e&&(t.errorMessage=e),this.processLoadQueue()},processPack:function(t){var e=t.data[t.key];if(e)for(var i=0;i<e.length;i++){var n=e[i];switch(n.type){case"image":this.image(n.key,n.url,n.overwrite);break;case"text":this.text(n.key,n.url,n.overwrite);break;case"json":this.json(n.key,n.url,n.overwrite);break;case"xml":this.xml(n.key,n.url,n.overwrite);break;case"script":this.script(n.key,n.url,n.callback,t.callbackContext||this);break;case"binary":this.binary(n.key,n.url,n.callback,t.callbackContext||this);break;case"spritesheet":this.spritesheet(n.key,n.url,n.frameWidth,n.frameHeight,n.frameMax,n.margin,n.spacing);break;case"video":this.video(n.key,n.urls);break;case"audio":this.audio(n.key,n.urls,n.autoDecode);break;case"audiosprite":this.audiosprite(n.key,n.urls,n.jsonURL,n.jsonData,n.autoDecode);break;case"tilemap":this.tilemap(n.key,n.url,n.data,U.Tilemap[n.format]);break;case"physics":this.physics(n.key,n.url,n.data,U.Loader[n.format]);break;case"bitmapFont":this.bitmapFont(n.key,n.textureURL,n.atlasURL,n.atlasData,n.xSpacing,n.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(n.key,n.textureURL,n.atlasURL,n.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(n.key,n.textureURL,n.atlasURL,n.atlasData);break;case"atlasXML":this.atlasXML(n.key,n.textureURL,n.atlasURL,n.atlasData);break;case"atlas":this.atlas(n.key,n.textureURL,n.atlasURL,n.atlasData,U.Loader[n.format]);break;case"shader":this.shader(n.key,n.url,n.overwrite)}}},transformUrl:function(t,e){return!!t&&(t.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)?t:this.baseURL+e.path+t)},loadFile:function(t){switch(t.type){case"packfile":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.fileComplete);break;case"image":case"spritesheet":case"textureatlas":case"bitmapfont":this.loadImageTag(t);break;case"audio":t.url=this.getAudioURL(t.url),t.url?this.game.sound.usingWebAudio?this.xhrLoad(t,this.transformUrl(t.url,t),"arraybuffer",this.fileComplete):this.game.sound.usingAudioTag&&this.loadAudioTag(t):this.fileError(t,null,"No supported audio URL specified or device does not have audio playback support");break;case"video":t.url=this.getVideoURL(t.url),t.url?t.asBlob?this.xhrLoad(t,this.transformUrl(t.url,t),"blob",this.fileComplete):this.loadVideoTag(t):this.fileError(t,null,"No supported video URL specified or device does not have video playback support");break;case"json":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.jsonLoadComplete);break;case"xml":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.xmlLoadComplete);break;case"tilemap":t.format===U.Tilemap.TILED_JSON?this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.jsonLoadComplete):t.format===U.Tilemap.CSV?this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.csvLoadComplete):this.asyncComplete(t,"invalid Tilemap format: "+t.format);break;case"text":case"script":case"shader":case"physics":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.fileComplete);break;case"binary":this.xhrLoad(t,this.transformUrl(t.url,t),"arraybuffer",this.fileComplete)}},loadImageTag:function(t){var e=this;t.data=new Image,e.crossOrigin="Anonymous",t.data.name=t.key,this.crossOrigin&&(t.data.crossOrigin=this.crossOrigin),t.data.onload=function(){t.data.onload&&(t.data.onload=null,t.data.onerror=null,e.fileComplete(t))},t.data.onerror=function(){t.data.onload&&(t.data.onload=null,t.data.onerror=null,e.fileError(t))},t.data.src=this.transformUrl(t.url,t),t.data.complete&&t.data.width&&t.data.height&&(t.data.onload=null,t.data.onerror=null,this.fileComplete(t))},loadVideoTag:function(t){var e=this;t.data=document.createElement("video"),t.data.name=t.key,t.data.controls=!1,t.data.autoplay=!1;var i=function(){t.data.removeEventListener(t.loadEvent,i,!1),t.data.onerror=null,t.data.canplay=!0,U.GAMES[e.game.id].load.fileComplete(t)};t.data.onerror=function(){t.data.removeEventListener(t.loadEvent,i,!1),t.data.onerror=null,t.data.canplay=!1,e.fileError(t)},t.data.addEventListener(t.loadEvent,i,!1),t.data.src=this.transformUrl(t.url,t),t.data.load()},loadAudioTag:function(t){var e,i=this;this.game.sound.touchLocked?(t.data=new Audio,t.data.name=t.key,t.data.preload="auto",t.data.src=this.transformUrl(t.url,t),this.fileComplete(t)):(t.data=new Audio,t.data.name=t.key,e=function(){t.data.removeEventListener("canplaythrough",e,!1),t.data.onerror=null,i.fileComplete(t)},t.data.onerror=function(){t.data.removeEventListener("canplaythrough",e,!1),t.data.onerror=null,i.fileError(t)},t.data.preload="auto",t.data.src=this.transformUrl(t.url,t),t.data.addEventListener("canplaythrough",e,!1),t.data.load())},xhrLoad:function(e,t,i,n,r){var s,o;this.useXDomainRequest&&window.XDomainRequest?this.xhrLoadWithXDR(e,t,i,n,r):((s=new XMLHttpRequest).open("GET",t,!0),s.responseType=i,!1!==this.headers.requestedWith&&s.setRequestHeader("X-Requested-With",this.headers.requestedWith),this.headers[e.type]&&s.setRequestHeader("Accept",this.headers[e.type]),r=r||this.fileError,o=this,s.onload=function(){try{return(4===s.readyState&&400<=s.status&&s.status<=599?r:n).call(o,e,s)}catch(t){o.hasLoaded?window.console:o.asyncComplete(e,t.message||"Exception")}},s.onerror=function(){try{return r.call(o,e,s)}catch(t){o.hasLoaded?window.console:o.asyncComplete(e,t.message||"Exception")}},e.requestObject=s,e.requestUrl=t,s.send())},xhrLoadWithXDR:function(e,t,i,n,r){this._warnedAboutXDomainRequest||this.game.device.ie&&!(10<=this.game.device.ieVersion)||(this._warnedAboutXDomainRequest=!0);var s=new window.XDomainRequest;s.open("GET",t,!0),s.responseType=i,s.timeout=3e3,r=r||this.fileError;var o=this;s.onerror=function(){try{return r.call(o,e,s)}catch(t){o.asyncComplete(e,t.message||"Exception")}},s.ontimeout=function(){try{return r.call(o,e,s)}catch(t){o.asyncComplete(e,t.message||"Exception")}},s.onprogress=function(){},s.onload=function(){try{return(4===s.readyState&&400<=s.status&&s.status<=599?r:n).call(o,e,s)}catch(t){o.asyncComplete(e,t.message||"Exception")}},e.requestObject=s,e.requestUrl=t,setTimeout(function(){s.send()},0)},getVideoURL:function(t){for(var e=0;e<t.length;e++){var i,n=t[e];if(n.uri){if(i=n.type,n=n.uri,this.game.device.canPlayVideo(i))return n}else{if(0===n.indexOf("blob:")||0===n.indexOf("data:"))return n;if(0<=n.indexOf("?")&&(n=n.substr(0,n.indexOf("?"))),i=n.substr((Math.max(0,n.lastIndexOf("."))||1/0)+1).toLowerCase(),this.game.device.canPlayVideo(i))return t[e]}}return null},getAudioURL:function(t){if(this.game.sound.noAudio)return null;for(var e=0;e<t.length;e++){var i,n=t[e];if(n.uri){if(i=n.type,n=n.uri,this.game.device.canPlayAudio(i))return n}else{if(0===n.indexOf("blob:")||0===n.indexOf("data:"))return n;if(0<=n.indexOf("?")&&(n=n.substr(0,n.indexOf("?"))),i=n.substr((Math.max(0,n.lastIndexOf("."))||1/0)+1).toLowerCase(),this.game.device.canPlayAudio(i))return t[e]}}return null},fileError:function(t,e,i){var n="error loading asset from URL "+(t.requestUrl||this.transformUrl(t.url,t));!i&&e&&(i=e.status),i&&(n=n+" ("+i+")"),this.asyncComplete(t,n)},fileComplete:function(t,e){var i=!0;switch(t.type){case"packfile":var n=JSON.parse(e.responseText);t.data=n||{};break;case"image":this.cache.addImage(t.key,t.url,t.data);break;case"spritesheet":this.cache.addSpriteSheet(t.key,t.url,t.data,t.frameWidth,t.frameHeight,t.frameMax,t.margin,t.spacing);break;case"textureatlas":if(null==t.atlasURL)this.cache.addTextureAtlas(t.key,t.url,t.data,t.atlasData,t.format);else if(i=!1,t.format===U.Loader.TEXTURE_ATLAS_JSON_ARRAY||t.format===U.Loader.TEXTURE_ATLAS_JSON_HASH||t.format===U.Loader.TEXTURE_ATLAS_JSON_PYXEL)this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.jsonLoadComplete);else{if(t.format!==U.Loader.TEXTURE_ATLAS_XML_STARLING)throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+t.format);this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.xmlLoadComplete)}break;case"bitmapfont":t.atlasURL?(i=!1,this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",function(t,e){var i;try{i=JSON.parse(e.responseText)}catch(t){}i?(t.atlasType="json",this.jsonLoadComplete(t,e)):(t.atlasType="xml",this.xmlLoadComplete(t,e))})):this.cache.addBitmapFont(t.key,t.url,t.data,t.atlasData,t.atlasType,t.xSpacing,t.ySpacing);break;case"video":if(t.asBlob)try{t.data=e.response}catch(e){throw new Error("Phaser.Loader. Unable to parse video file as Blob: "+t.key)}this.cache.addVideo(t.key,t.url,t.data,t.asBlob);break;case"audio":this.game.sound.usingWebAudio?(t.data=e.response,this.cache.addSound(t.key,t.url,t.data,!0,!1),t.autoDecode&&this.game.sound.decode(t.key)):this.cache.addSound(t.key,t.url,t.data,!1,!0);break;case"text":t.data=e.responseText,this.cache.addText(t.key,t.url,t.data);break;case"shader":t.data=e.responseText,this.cache.addShader(t.key,t.url,t.data);break;case"physics":n=JSON.parse(e.responseText);this.cache.addPhysicsData(t.key,t.url,n,t.format);break;case"script":t.data=document.createElement("script"),t.data.language="javascript",t.data.type="text/javascript",t.data.defer=!1,t.data.text=e.responseText,t.callback&&(t.data=t.callback.call(t.callbackContext,t.key,e.responseText));break;case"binary":t.callback?t.data=t.callback.call(t.callbackContext,t.key,e.response):t.data=e.response,this.cache.addBinary(t.key,t.data)}i&&this.asyncComplete(t)},jsonLoadComplete:function(t,e){e=JSON.parse(e.responseText);"tilemap"===t.type?this.cache.addTilemap(t.key,t.url,e,t.format):"bitmapfont"===t.type?this.cache.addBitmapFont(t.key,t.url,t.data,e,t.atlasType,t.xSpacing,t.ySpacing):"json"===t.type?this.cache.addJSON(t.key,t.url,e):this.cache.addTextureAtlas(t.key,t.url,t.data,e,t.format),this.asyncComplete(t)},csvLoadComplete:function(t,e){e=e.responseText;this.cache.addTilemap(t.key,t.url,e,t.format),this.asyncComplete(t)},xmlLoadComplete:function(t,e){var i=e.responseText,i=this.parseXml(i);i?("bitmapfont"===t.type?this.cache.addBitmapFont(t.key,t.url,t.data,i,t.atlasType,t.xSpacing,t.ySpacing):"textureatlas"===t.type?this.cache.addTextureAtlas(t.key,t.url,t.data,i,t.format):"xml"===t.type&&this.cache.addXML(t.key,t.url,i),this.asyncComplete(t)):(e.responseType||e.contentType,this.asyncComplete(t,"invalid XML"))},parseXml:function(t){var e;try{window.DOMParser?e=(new DOMParser).parseFromString(t,"text/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t))}catch(t){e=null}return e&&e.documentElement&&!e.getElementsByTagName("parsererror").length?e:null},updateProgress:function(){this.preloadSprite&&(0===this.preloadSprite.direction?this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress):this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite?this.preloadSprite.sprite.updateCrop():this.preloadSprite=null)},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-this._loadedPackCount}},Object.defineProperty(U.Loader.prototype,"progressFloat",{get:function(){var t=this._loadedFileCount/this._totalFileCount*100;return U.Math.clamp(t||0,0,100)}}),Object.defineProperty(U.Loader.prototype,"progress",{get:function(){return Math.round(this.progressFloat)}}),U.Loader.prototype.constructor=U.Loader,U.LoaderParser={bitmapFont:function(t,e,i,n){return this.xmlBitmapFont(t,e,i,n)},xmlBitmapFont:function(t,e,i,n){var r={},s=t.getElementsByTagName("info")[0],o=t.getElementsByTagName("common")[0];r.font=s.getAttribute("face"),r.size=parseInt(s.getAttribute("size"),10),r.lineHeight=parseInt(o.getAttribute("lineHeight"),10)+n,r.chars={};for(var a=t.getElementsByTagName("char"),l=0;l<a.length;l++){var p=parseInt(a[l].getAttribute("id"),10);r.chars[p]={x:parseInt(a[l].getAttribute("x"),10),y:parseInt(a[l].getAttribute("y"),10),width:parseInt(a[l].getAttribute("width"),10),height:parseInt(a[l].getAttribute("height"),10),xOffset:parseInt(a[l].getAttribute("xoffset"),10),yOffset:parseInt(a[l].getAttribute("yoffset"),10),xAdvance:parseInt(a[l].getAttribute("xadvance"),10)+i,kerning:{}}}for(var h=t.getElementsByTagName("kerning"),l=0;l<h.length;l++){var u=parseInt(h[l].getAttribute("first"),10),c=parseInt(h[l].getAttribute("second"),10),d=parseInt(h[l].getAttribute("amount"),10);r.chars[c].kerning[u]=d}return this.finalizeBitmapFont(e,r)},jsonBitmapFont:function(t,e,i,n){var r={font:t.font.info._face,size:parseInt(t.font.info._size,10),lineHeight:parseInt(t.font.common._lineHeight,10)+n,chars:{}};return t.font.chars.char.forEach(function(t){var e=parseInt(t._id,10);r.chars[e]={x:parseInt(t._x,10),y:parseInt(t._y,10),width:parseInt(t._width,10),height:parseInt(t._height,10),xOffset:parseInt(t._xoffset,10),yOffset:parseInt(t._yoffset,10),xAdvance:parseInt(t._xadvance,10)+i,kerning:{}}}),t.font.kernings&&t.font.kernings.kerning&&t.font.kernings.kerning.forEach(function(t){r.chars[t._second].kerning[t._first]=parseInt(t._amount,10)}),this.finalizeBitmapFont(e,r)},finalizeBitmapFont:function(e,i){return Object.keys(i.chars).forEach(function(t){t=i.chars[t];t.texture=new PIXI.Texture(e,new U.Rectangle(t.x,t.y,t.width,t.height))}),i}},U.AudioSprite=function(t,e){for(var i in this.game=t,this.key=e,this.config=this.game.cache.getJSON(e+"-audioatlas"),this.autoplayKey=null,this.autoplay=!1,this.sounds={},this.config.spritemap){var n=this.config.spritemap[i],r=this.game.add.sound(this.key);r.addMarker(i,n.start,n.end-n.start,null,n.loop),this.sounds[i]=r}this.config.autoplay&&(this.autoplayKey=this.config.autoplay,this.play(this.autoplayKey),this.autoplay=this.sounds[this.autoplayKey])},U.AudioSprite.prototype={play:function(t,e){return void 0===e&&(e=1),this.sounds[t].play(t,null,e)},stop:function(t){if(t)this.sounds[t].stop();else for(var e in this.sounds)this.sounds[e].stop()},get:function(t){return this.sounds[t]}},U.AudioSprite.prototype.constructor=U.AudioSprite,U.Sound=function(t,e,i,n,r){void 0===i&&(i=1),void 0===n&&(n=!1),void 0===r&&(r=t.sound.connectToMaster),this.game=t,this.name=e,this.key=e,this.loop=n,this.markers={},this.context=null,this.autoplay=!1,this.totalDuration=0,this.startTime=0,this.currentTime=0,this.duration=0,this.durationMS=0,this.position=0,this.stopTime=0,this.paused=!1,this.pausedPosition=0,this.pausedTime=0,this.isPlaying=!1,this.currentMarker="",this.fadeTween=null,this.pendingPlayback=!1,this.override=!1,this.allowMultiple=!1,this.usingWebAudio=this.game.sound.usingWebAudio,this.usingAudioTag=this.game.sound.usingAudioTag,this.externalNode=null,this.masterGainNode=null,this.gainNode=null,this._sound=null,this.usingWebAudio?(this.context=this.game.sound.context,this.masterGainNode=this.game.sound.masterGain,void 0===this.context.createGain?this.gainNode=this.context.createGainNode():this.gainNode=this.context.createGain(),this.gainNode.gain.value=i*this.game.sound.volume,r&&this.gainNode.connect(this.masterGainNode)):this.usingAudioTag&&(this.game.cache.getSound(e)&&this.game.cache.isSoundReady(e)?(this._sound=this.game.cache.getSoundData(e),this.totalDuration=0,this._sound.duration&&(this.totalDuration=this._sound.duration)):this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this)),this.onDecoded=new U.Signal,this.onPlay=new U.Signal,this.onPause=new U.Signal,this.onResume=new U.Signal,this.onLoop=new U.Signal,this.onStop=new U.Signal,this.onMute=new U.Signal,this.onMarkerComplete=new U.Signal,this.onFadeComplete=new U.Signal,this._volume=i,this._buffer=null,this._muted=!1,this._tempMarker=0,this._tempPosition=0,this._tempVolume=0,this._tempPause=0,this._muteVolume=0,this._tempLoop=0,this._paused=!1,this._onDecodedEventDispatched=!1},U.Sound.prototype={soundHasUnlocked:function(t){t===this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this._sound.duration)},addMarker:function(t,e,i,n,r){null!=i||(i=1),null!=n||(n=1),void 0===r&&(r=!1),this.markers[t]={name:t,start:e,stop:e+i,volume:n,duration:i,durationMS:1e3*i,loop:r}},removeMarker:function(t){delete this.markers[t]},onEndedHandler:function(){this._sound.onended=null,this.isPlaying=!1,this.currentTime=this.durationMS,this.stop()},update:function(){this.game.cache.checkSoundKey(this.key)?(this.isDecoded&&!this._onDecodedEventDispatched&&(this.onDecoded.dispatch(this),this._onDecodedEventDispatched=!0),this.pendingPlayback&&this.game.cache.isSoundReady(this.key)&&(this.pendingPlayback=!1,this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)),this.isPlaying&&(this.currentTime=this.game.time.time-this.startTime,this.currentTime>=this.durationMS&&(this.usingWebAudio?this.loop?(this.onLoop.dispatch(this),this.isPlaying=!1,""===this.currentMarker?(this.currentTime=0,this.startTime=this.game.time.time,this.isPlaying=!0):(this.onMarkerComplete.dispatch(this.currentMarker,this),this.play(this.currentMarker,0,this.volume,!0,!0))):""!==this.currentMarker&&this.stop():this.loop?(this.onLoop.dispatch(this),""===this.currentMarker&&(this.currentTime=0,this.startTime=this.game.time.time),this.isPlaying=!1,this.play(this.currentMarker,0,this.volume,!0,!0)):this.stop()))):this.destroy()},loopFull:function(t){return this.play(null,0,t,!0)},play:function(t,e,i,n,r){if(void 0!==t&&!1!==t&&null!==t||(t=""),void 0===r&&(r=!0),this.isPlaying&&!this.allowMultiple&&!r&&!this.override)return this;if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||r)){if(this.usingWebAudio){if(void 0===this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(t){}this.externalNode?this._sound.disconnect(this.externalNode):this.gainNode&&this._sound.disconnect(this.gainNode)}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);this.isPlaying=!1}if(""===t&&0<Object.keys(this.markers).length)return this;if(""!==t){if(!this.markers[t])return this;this.currentMarker=t,this.position=this.markers[t].start,this.volume=this.markers[t].volume,this.loop=this.markers[t].loop,this.duration=this.markers[t].duration,this.durationMS=this.markers[t].durationMS,void 0!==i&&(this.volume=i),void 0!==n&&(this.loop=n),this._tempMarker=t,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop}else e=e||0,void 0===i&&(i=this._volume),void 0===n&&(n=this.loop),this.position=Math.max(0,e),this.volume=i,this.loop=n,this.duration=0,this.durationMS=0,this._tempMarker=t,this._tempPosition=e,this._tempVolume=i,this._tempLoop=n;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(this._sound=this.context.createBufferSource(),this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this._buffer=this.game.cache.getSoundData(this.key),this._sound.buffer=this._buffer,this.loop&&""===t&&(this._sound.loop=!0),this.loop||""!==t||(this._sound.onended=this.onEndedHandler.bind(this)),this.totalDuration=this._sound.buffer.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=Math.ceil(1e3*this.totalDuration)),void 0===this._sound.start?this._sound.noteGrainOn(0,this.position,this.duration):this.loop&&""===t?this._sound.start(0,0):this._sound.start(0,this.position,this.duration),this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&!1===this.game.cache.getSound(this.key).isDecoding&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||4===this._sound.readyState)?(this._sound.play(),this.totalDuration=this._sound.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1e3*this.totalDuration),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._muted||this.game.sound.mute?this._sound.volume=0:this._sound.volume=this._volume,this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):this.pendingPlayback=!0,this},restart:function(t,e,i,n){t=t||"",e=e||0,i=i||1,void 0===n&&(n=!1),this.play(t,e,i,n,!0)},pause:function(){this.isPlaying&&this._sound&&(this.paused=!0,this.pausedPosition=this.currentTime,this.pausedTime=this.game.time.time,this._tempPause=this._sound.currentTime,this.onPause.dispatch(this),this.stop())},resume:function(){var t,e;this.paused&&this._sound&&(this.usingWebAudio?(t=Math.max(0,this.position+this.pausedPosition/1e3),this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this.loop&&(this._sound.loop=!0),this.loop||""!==this.currentMarker||(this._sound.onended=this.onEndedHandler.bind(this)),e=this.duration-this.pausedPosition/1e3,void 0===this._sound.start?this._sound.noteGrainOn(0,t,e):this.loop&&this.game.device.chrome?42===this.game.device.chromeVersion?this._sound.start(0):this._sound.start(0,t):this._sound.start(0,t,e)):(this._sound.currentTime=this._tempPause,this._sound.play()),this.isPlaying=!0,this.paused=!1,this.startTime+=this.game.time.time-this.pausedTime,this.onResume.dispatch(this))},stop:function(){if(this.isPlaying&&this._sound)if(this.usingWebAudio){if(void 0===this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(t){}this.externalNode?this._sound.disconnect(this.externalNode):this.gainNode&&this._sound.disconnect(this.gainNode)}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);var t;this.pendingPlayback=!1,this.isPlaying=!1,this.paused||(t=this.currentMarker,""!==this.currentMarker&&this.onMarkerComplete.dispatch(this.currentMarker,this),this.currentMarker="",null!==this.fadeTween&&this.fadeTween.stop(),this.onStop.dispatch(this,t))},fadeIn:function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=this.currentMarker),this.paused||(this.play(i,0,0,e),this.fadeTo(t,1))},fadeOut:function(t){this.fadeTo(t,0)},fadeTo:function(t,e){this.isPlaying&&!this.paused&&e!==this.volume&&(void 0===t&&(t=1e3),void 0!==e&&(this.fadeTween=this.game.add.tween(this).to({volume:e},t,U.Easing.Linear.None,!0),this.fadeTween.onComplete.add(this.fadeComplete,this)))},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume),0===this.volume&&this.stop()},updateGlobalVolume:function(t){this.usingAudioTag&&this._sound&&(this._sound.volume=t*this._volume)},destroy:function(t){void 0===t&&(t=!0),this.stop(),t?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose())}},U.Sound.prototype.constructor=U.Sound,Object.defineProperty(U.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}}),Object.defineProperty(U.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}}),Object.defineProperty(U.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(t){(t=t||!1)!==this._muted&&(t?(this._muted=!0,this._muteVolume=this._tempVolume,this.usingWebAudio?this.gainNode.gain.value=0:this.usingAudioTag&&this._sound&&(this._sound.volume=0)):(this._muted=!1,this.usingWebAudio?this.gainNode.gain.value=this._muteVolume:this.usingAudioTag&&this._sound&&(this._sound.volume=this._muteVolume)),this.onMute.dispatch(this))}}),Object.defineProperty(U.Sound.prototype,"volume",{get:function(){return this._volume},set:function(t){this.game.device.firefox&&this.usingAudioTag&&(t=this.game.math.clamp(t,0,1)),this._muted?this._muteVolume=t:(this._tempVolume=t,this._volume=t,this.usingWebAudio?this.gainNode.gain.value=t:this.usingAudioTag&&this._sound&&(this._sound.volume=t))}}),U.SoundManager=function(t){this.game=t,this.onSoundDecode=new U.Signal,this.onVolumeChange=new U.Signal,this.onMute=new U.Signal,this.onUnMute=new U.Signal,this.context=null,this.usingWebAudio=!1,this.usingAudioTag=!1,this.noAudio=!1,this.connectToMaster=!0,this.touchLocked=!1,this.channels=32,this.muteOnPause=!0,this._codeMuted=!1,this._muted=!1,this._unlockSource=null,this._volume=1,this._sounds=[],this._watchList=new U.ArraySet,this._watching=!1,this._watchCallback=null,this._watchContext=null},U.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&!1===this.game.device.webAudio&&(this.channels=1),window.PhaserGlobal){if(!0===window.PhaserGlobal.disableAudio)return this.noAudio=!0,void(this.touchLocked=!1);if(!0===window.PhaserGlobal.disableWebAudio)return this.usingAudioTag=!0,void(this.touchLocked=!1)}if(window.PhaserGlobal&&window.PhaserGlobal.audioContext)this.context=window.PhaserGlobal.audioContext;else if(window.AudioContext)try{this.context=new window.AudioContext}catch(t){this.context=null,this.usingWebAudio=!1,this.touchLocked=!1}else if(window.webkitAudioContext)try{this.context=new window.webkitAudioContext}catch(t){this.context=null,this.usingWebAudio=!1,this.touchLocked=!1}if(null===this.context){if(void 0===window.Audio)return void(this.noAudio=!0);this.usingAudioTag=!0}else this.usingWebAudio=!0,void 0===this.context.createGain?this.masterGain=this.context.createGainNode():this.masterGain=this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination);this.noAudio||!this.game.device.cocoonJS&&(this.game.device.android||this.game.device.iOS||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock)&&this.setTouchLock()},setTouchLock:function(){this.noAudio||window.PhaserGlobal&&!0===window.PhaserGlobal.disableAudio||(8<this.game.device.iOSVersion||55<=this.game.device.chromeVersion?this.game.input.touch.addTouchLockCallback(this.unlock,this,!0):this.game.input.touch.addTouchLockCallback(this.unlock,this),this.touchLocked=!0)},unlock:function(){return this.noAudio||!this.touchLocked||null!==this._unlockSource||(this.usingAudioTag?(this.touchLocked=!1,this._unlockSource=null):this.usingWebAudio&&(t=this.context.createBuffer(1,1,22050),this._unlockSource=this.context.createBufferSource(),this._unlockSource.buffer=t,this._unlockSource.connect(this.context.destination),void 0===this._unlockSource.start?this._unlockSource.noteOn(0):this._unlockSource.start(0),"suspended"===this._unlockSource.context.state&&this._unlockSource.context.resume())),!0;var t},stopAll:function(){if(!this.noAudio)for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].stop()},pauseAll:function(){if(!this.noAudio)for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].pause()},resumeAll:function(){if(!this.noAudio)for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].resume()},decode:function(e,i){i=i||null;var t=this.game.cache.getSoundData(e);if(t&&!1===this.game.cache.isSoundDecoded(e)){this.game.cache.updateSound(e,"isDecoding",!0);var n=this;try{this.context.decodeAudioData(t,function(t){t&&(n.game.cache.decodedSound(e,t),n.onSoundDecode.dispatch(e,i))})}catch(e){}}},setDecodedCallback:function(t,e,i){"string"==typeof t&&(t=[t]),this._watchList.reset();for(var n=0;n<t.length;n++)t[n]instanceof U.Sound?this.game.cache.isSoundDecoded(t[n].key)||this._watchList.add(t[n].key):this.game.cache.isSoundDecoded(t[n])||this._watchList.add(t[n]);0===this._watchList.total?(this._watching=!1,e.call(i)):(this._watching=!0,this._watchCallback=e,this._watchContext=i)},update:function(){if(!this.noAudio){!this.touchLocked||null===this._unlockSource||this._unlockSource.playbackState!==this._unlockSource.PLAYING_STATE&&this._unlockSource.playbackState!==this._unlockSource.FINISHED_STATE||(this.touchLocked=!1,this._unlockSource=null);for(var t=0;t<this._sounds.length;t++)this._sounds[t].update();if(this._watching){for(var e=this._watchList.first;e;)this.game.cache.isSoundDecoded(e)&&this._watchList.remove(e),e=this._watchList.next;0===this._watchList.total&&(this._watching=!1,this._watchCallback.call(this._watchContext))}}},add:function(t,e,i,n){void 0===e&&(e=1),void 0===i&&(i=!1),void 0===n&&(n=this.connectToMaster);n=new U.Sound(this.game,t,e,i,n);return this._sounds.push(n),n},addSprite:function(t){return new U.AudioSprite(this.game,t)},remove:function(t){for(var e=this._sounds.length;e--;)if(this._sounds[e]===t)return this._sounds[e].destroy(!1),this._sounds.splice(e,1),!0;return!1},removeByKey:function(t){for(var e=this._sounds.length,i=0;e--;)this._sounds[e].key===t&&(this._sounds[e].destroy(!1),this._sounds.splice(e,1),i++);return i},play:function(t,e,i){if(!this.noAudio){i=this.add(t,e,i);return i.play(),i}},setMute:function(){if(!this._muted){this._muted=!0,this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0);for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].mute=!0);this.onMute.dispatch()}},unsetMute:function(){if(this._muted&&!this._codeMuted){this._muted=!1,this.usingWebAudio&&(this.masterGain.gain.value=this._muteVolume);for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].mute=!1);this.onUnMute.dispatch()}},destroy:function(){this.stopAll();for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].destroy();this._sounds=[],this.onSoundDecode.dispose(),this.context&&(window.PhaserGlobal?window.PhaserGlobal.audioContext=this.context:this.context.close&&this.context.close())}},U.SoundManager.prototype.constructor=U.SoundManager,Object.defineProperty(U.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(t){(t=t||!1)?this._muted||(this._codeMuted=!0,this.setMute()):this._muted&&(this._codeMuted=!1,this.unsetMute())}}),Object.defineProperty(U.SoundManager.prototype,"volume",{get:function(){return this._volume},set:function(t){if(t<0?t=0:1<t&&(t=1),this._volume!==t){if(this._volume=t,this.usingWebAudio)this.masterGain.gain.value=t;else for(var e=0;e<this._sounds.length;e++)this._sounds[e].usingAudioTag&&this._sounds[e].updateGlobalVolume(t);this.onVolumeChange.dispatch(t)}}}),U.ScaleManager=function(t,e,i){this.game=t,this.dom=U.DOM,this.grid=null,this.width=0,this.height=0,this.minWidth=null,this.maxWidth=null,this.minHeight=null,this.maxHeight=null,this.offset=new U.Point,this.forceLandscape=!1,this.forcePortrait=!1,this.incorrectOrientation=!1,this._pageAlignHorizontally=!1,this._pageAlignVertically=!1,this.onOrientationChange=new U.Signal,this.enterIncorrectOrientation=new U.Signal,this.leaveIncorrectOrientation=new U.Signal,this.hasPhaserSetFullScreen=!1,this.fullScreenTarget=null,this._createdFullScreenTarget=null,this.onFullScreenInit=new U.Signal,this.onFullScreenChange=new U.Signal,this.onFullScreenError=new U.Signal,this.screenOrientation=this.dom.getScreenOrientation(),this.scaleFactor=new U.Point(1,1),this.scaleFactorInversed=new U.Point(1,1),this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0},this.bounds=new U.Rectangle,this.aspectRatio=0,this.sourceAspectRatio=0,this.event=null,this.windowConstraints={right:"layout",bottom:""},this.compatibility={supportsFullScreen:!1,orientationFallback:null,noMargins:!1,scrollTo:null,forceMinimumDocumentHeight:!1,canExpandParent:!0,clickTrampoline:""},this._scaleMode=U.ScaleManager.NO_SCALE,this._fullScreenScaleMode=U.ScaleManager.NO_SCALE,this.parentIsWindow=!1,this.parentNode=null,this.parentScaleFactor=new U.Point(1,1),this.trackParentInterval=2e3,this.onSizeChange=new U.Signal,this.onResize=null,this.onResizeContext=null,this._pendingScaleMode=null,this._fullScreenRestore=null,this._gameSize=new U.Rectangle,this._userScaleFactor=new U.Point(1,1),this._userScaleTrim=new U.Point(0,0),this._lastUpdate=0,this._updateThrottle=0,this._updateThrottleReset=100,this._parentBounds=new U.Rectangle,this._tempBounds=new U.Rectangle,this._lastReportedCanvasSize=new U.Rectangle,this._lastReportedGameSize=new U.Rectangle,this._booted=!1,t.config&&this.parseConfig(t.config),this.setupScale(e,i)},U.ScaleManager.EXACT_FIT=0,U.ScaleManager.NO_SCALE=1,U.ScaleManager.SHOW_ALL=2,U.ScaleManager.RESIZE=3,U.ScaleManager.USER_SCALE=4,U.ScaleManager.prototype={boot:function(){var t=this.compatibility;t.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS,this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(this.game.device.android&&!this.game.device.chrome?t.scrollTo=new U.Point(0,1):t.scrollTo=new U.Point(0,0)),this.game.device.desktop?(t.orientationFallback="screen",t.clickTrampoline="when-not-mouse"):(t.orientationFallback="",t.clickTrampoline="");var e=this;this._orientationChange=function(t){return e.orientationChange(t)},this._windowResize=function(t){return e.windowResize(t)},window.addEventListener("orientationchange",this._orientationChange,!1),window.addEventListener("resize",this._windowResize,!1),this.compatibility.supportsFullScreen&&(this._fullScreenChange=function(t){return e.fullScreenChange(t)},this._fullScreenError=function(t){return e.fullScreenError(t)},document.addEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.addEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.addEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.addEventListener("fullscreenchange",this._fullScreenChange,!1),document.addEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.addEventListener("mozfullscreenerror",this._fullScreenError,!1),document.addEventListener("MSFullscreenError",this._fullScreenError,!1),document.addEventListener("fullscreenerror",this._fullScreenError,!1)),this.game.onResume.add(this._gameResumed,this),this.dom.getOffset(this.game.canvas,this.offset),this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height),this.setGameSize(this.game.width,this.game.height),this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback),U.FlexGrid&&(this.grid=new U.FlexGrid(this,this.width,this.height)),this._booted=!0,null!==this._pendingScaleMode&&(this.scaleMode=this._pendingScaleMode,this._pendingScaleMode=null)},parseConfig:function(t){void 0!==t.scaleMode&&(this._booted?this.scaleMode=t.scaleMode:this._pendingScaleMode=t.scaleMode),void 0!==t.fullScreenScaleMode&&(this.fullScreenScaleMode=t.fullScreenScaleMode),t.fullScreenTarget&&(this.fullScreenTarget=t.fullScreenTarget)},setupScale:function(t,e){var i=new U.Rectangle;""!==this.game.parent&&("string"==typeof this.game.parent?r=document.getElementById(this.game.parent):this.game.parent&&1===this.game.parent.nodeType&&(r=this.game.parent)),r?(this.parentNode=r,this.parentIsWindow=!1,this.getParentBounds(this._parentBounds),i.width=this._parentBounds.width,i.height=this._parentBounds.height,this.offset.set(this._parentBounds.x,this._parentBounds.y)):(this.parentNode=null,this.parentIsWindow=!0,i.width=this.dom.visualBounds.width,i.height=this.dom.visualBounds.height,this.offset.set(0,0));var n=0,r=0,n="number"==typeof t?t:(this.parentScaleFactor.x=parseInt(t,10)/100,i.width*this.parentScaleFactor.x),r="number"==typeof e?e:(this.parentScaleFactor.y=parseInt(e,10)/100,i.height*this.parentScaleFactor.y);n=Math.floor(n),r=Math.floor(r),this._gameSize.setTo(0,0,n,r),this.updateDimensions(n,r,!1)},_gameResumed:function(){this.queueUpdate(!0)},setGameSize:function(t,e){this._gameSize.setTo(0,0,t,e),this.currentScaleMode!==U.ScaleManager.RESIZE&&this.updateDimensions(t,e,!0),this.queueUpdate(!0)},setUserScale:function(t,e,i,n){this._userScaleFactor.setTo(t,e),this._userScaleTrim.setTo(0|i,0|n),this.queueUpdate(!0)},setResizeCallback:function(t,e){this.onResize=t,this.onResizeContext=e},signalSizeChange:function(){var t,e;U.Rectangle.sameDimensions(this,this._lastReportedCanvasSize)&&U.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)||(t=this.width,e=this.height,this._lastReportedCanvasSize.setTo(0,0,t,e),this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height),this.grid&&this.grid.onResize(t,e),this.onSizeChange.dispatch(this,t,e),this.currentScaleMode===U.ScaleManager.RESIZE&&(this.game.state.resize(t,e),this.game.load.resize(t,e)))},setMinMax:function(t,e,i,n){this.minWidth=t,this.minHeight=e,void 0!==i&&(this.maxWidth=i),void 0!==n&&(this.maxHeight=n)},preUpdate:function(){var t,e,i,n;this.game.time.time<this._lastUpdate+this._updateThrottle||(t=this._updateThrottle,this._updateThrottleReset=400<=t?0:100,this.dom.getOffset(this.game.canvas,this.offset),e=this._parentBounds.width,i=this._parentBounds.height,e=(n=this.getParentBounds(this._parentBounds)).width!==e||n.height!==i,i=this.updateOrientationState(),(e||i)&&(this.onResize&&this.onResize.call(this.onResizeContext,this,n),this.updateLayout(),this.signalSizeChange()),n=2*this._updateThrottle,this._updateThrottle<t&&(n=Math.min(t,this._updateThrottleReset)),this._updateThrottle=U.Math.clamp(n,25,this.trackParentInterval),this._lastUpdate=this.game.time.time)},pauseUpdate:function(){this.preUpdate(),this._updateThrottle=this.trackParentInterval},updateDimensions:function(t,e,i){this.width=t*this.parentScaleFactor.x,this.height=e*this.parentScaleFactor.y,this.game.width=this.width,this.game.height=this.height,this.sourceAspectRatio=this.width/this.height,this.updateScalingAndBounds(),i&&(this.game.renderer.resize(this.width,this.height),this.game.camera.setSize(this.width,this.height),this.game.world.resize(this.width,this.height))},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height,this.scaleFactorInversed.x=this.width/this.game.width,this.scaleFactorInversed.y=this.height/this.game.height,this.aspectRatio=this.width/this.height,this.game.canvas&&this.dom.getOffset(this.game.canvas,this.offset),this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height),this.game.input&&this.game.input.scale&&this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)},forceOrientation:function(t,e){void 0===e&&(e=!1),this.forceLandscape=t,this.forcePortrait=e,this.queueUpdate(!0)},classifyOrientation:function(t){return"portrait-primary"===t||"portrait-secondary"===t?"portrait":"landscape-primary"===t||"landscape-secondary"===t?"landscape":null},updateOrientationState:function(){var t=this.screenOrientation,e=this.incorrectOrientation;this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback),this.incorrectOrientation=this.forceLandscape&&!this.isLandscape||this.forcePortrait&&!this.isPortrait;var i=t!==this.screenOrientation,n=e!==this.incorrectOrientation;return n&&(this.incorrectOrientation?this.enterIncorrectOrientation:this.leaveIncorrectOrientation).dispatch(),(i||n)&&this.onOrientationChange.dispatch(this,t,e),i||n},orientationChange:function(t){this.event=t,this.queueUpdate(!0)},windowResize:function(t){this.event=t,this.queueUpdate(!0)},scrollTop:function(){var t=this.compatibility.scrollTo;t&&window.scrollTo(t.x,t.y)},refresh:function(){this.scrollTop(),this.queueUpdate(!0)},updateLayout:function(){var t=this.currentScaleMode;t!==U.ScaleManager.RESIZE?(this.scrollTop(),this.compatibility.forceMinimumDocumentHeight&&(document.documentElement.style.minHeight=window.innerHeight+"px"),this.incorrectOrientation?this.setMaximum():t===U.ScaleManager.EXACT_FIT?this.setExactFit():t===U.ScaleManager.SHOW_ALL?(!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent&&(this.setShowAll(!0),this.resetCanvas()),this.setShowAll()):t===U.ScaleManager.NO_SCALE?(this.width=this.game.width,this.height=this.game.height):t===U.ScaleManager.USER_SCALE&&(this.width=this.game.width*this._userScaleFactor.x-this._userScaleTrim.x,this.height=this.game.height*this._userScaleFactor.y-this._userScaleTrim.y),this.compatibility.canExpandParent||t!==U.ScaleManager.SHOW_ALL&&t!==U.ScaleManager.USER_SCALE||(t=this.getParentBounds(this._tempBounds),this.width=Math.min(this.width,t.width),this.height=Math.min(this.height,t.height)),this.width=0|this.width,this.height=0|this.height,this.reflowCanvas()):this.reflowGame()},getParentBounds:function(t){var e,i=t||new U.Rectangle,n=this.boundingParent,r=this.dom.visualBounds,s=this.dom.layoutBounds;return n?(t=n.getBoundingClientRect(),n=(n.offsetParent||n).getBoundingClientRect(),i.setTo(t.left-n.left,t.top-n.top,t.width,t.height),(t=this.windowConstraints).right&&(e="layout"===t.right?s:r,i.right=Math.min(i.right,e.width)),t.bottom&&(e="layout"===t.bottom?s:r,i.bottom=Math.min(i.bottom,e.height))):i.setTo(0,0,r.width,r.height),i.setTo(Math.round(i.x),Math.round(i.y),Math.round(i.width),Math.round(i.height)),i},alignCanvas:function(t,e){var i,n,r,s,o=this.getParentBounds(this._tempBounds),a=this.game.canvas,l=this.margin;t&&(l.left=l.right=0,i=a.getBoundingClientRect(),this.width<o.width&&!this.incorrectOrientation&&(n=i.left-o.x,r=o.width/2-this.width/2,s=(r=Math.max(r,0))-n,l.left=Math.round(s)),a.style.marginLeft=l.left+"px",0!==l.left&&(l.right=-(o.width-i.width-l.left),a.style.marginRight=l.right+"px")),e&&(l.top=l.bottom=0,i=a.getBoundingClientRect(),this.height<o.height&&!this.incorrectOrientation&&(n=i.top-o.y,r=o.height/2-this.height/2,s=(r=Math.max(r,0))-n,l.top=Math.round(s)),a.style.marginTop=l.top+"px",0!==l.top&&(l.bottom=-(o.height-i.height-l.top),a.style.marginBottom=l.bottom+"px")),l.x=l.left,l.y=l.top},reflowGame:function(){this.resetCanvas("","");var t=this.getParentBounds(this._tempBounds);this.updateDimensions(t.width,t.height,!0)},reflowCanvas:function(){this.incorrectOrientation||(this.width=U.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width),this.height=U.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height)),this.resetCanvas(),this.compatibility.noMargins||(this.isFullScreen&&this._createdFullScreenTarget?this.alignCanvas(!0,!0):this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically)),this.updateScalingAndBounds()},resetCanvas:function(t,e){void 0===t&&(t=this.width+"px"),void 0===e&&(e=this.height+"px");var i=this.game.canvas;this.compatibility.noMargins||(i.style.marginLeft="",i.style.marginTop="",i.style.marginRight="",i.style.marginBottom=""),i.style.width=t,i.style.height=e},queueUpdate:function(t){t&&(this._parentBounds.width=0,this._parentBounds.height=0),this._updateThrottle=this._updateThrottleReset},reset:function(t){t&&this.grid&&this.grid.reset()},setMaximum:function(){this.width=this.dom.visualBounds.width,this.height=this.dom.visualBounds.height},setShowAll:function(t){var e=this.getParentBounds(this._tempBounds),i=e.width,e=e.height,i=t?Math.max(e/this.game.height,i/this.game.width):Math.min(e/this.game.height,i/this.game.width);this.width=Math.round(this.game.width*i),this.height=Math.round(this.game.height*i)},setExactFit:function(){var t=this.getParentBounds(this._tempBounds);this.width=t.width,this.height=t.height,this.isFullScreen||(this.maxWidth&&(this.width=Math.min(this.width,this.maxWidth)),this.maxHeight&&(this.height=Math.min(this.height,this.maxHeight)))},createFullScreenTarget:function(){var t=document.createElement("div");return t.style.margin="0",t.style.padding="0",t.style.background="#000",t},startFullScreen:function(t,e){if(this.isFullScreen)return!1;if(this.compatibility.supportsFullScreen){if("when-not-mouse"===this.compatibility.clickTrampoline){var i=this.game.input;if(i.activePointer&&i.activePointer!==i.mousePointer&&(e||!1!==e))return void i.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[t,!1])}void 0!==t&&this.game.renderType===U.CANVAS&&(this.game.stage.smoothed=t);i=this.fullScreenTarget;i||(this.cleanupCreatedTarget(),this._createdFullScreenTarget=this.createFullScreenTarget(),i=this._createdFullScreenTarget);t={targetElement:i};return this.hasPhaserSetFullScreen=!0,this.onFullScreenInit.dispatch(this,t),this._createdFullScreenTarget&&((t=this.game.canvas).parentNode.insertBefore(i,t),i.appendChild(t)),this.game.device.fullscreenKeyboard?i[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT):i[this.game.device.requestFullscreen](),!0}var n=this;setTimeout(function(){n.fullScreenError()},10)},stopFullScreen:function(){return!(!this.isFullScreen||!this.compatibility.supportsFullScreen||(this.hasPhaserSetFullScreen=!1,document[this.game.device.cancelFullscreen](),0))},cleanupCreatedTarget:function(){var t,e=this._createdFullScreenTarget;e&&e.parentNode&&((t=e.parentNode).insertBefore(this.game.canvas,e),t.removeChild(e)),this._createdFullScreenTarget=null},prepScreenMode:function(t){var e=!!this._createdFullScreenTarget,i=this._createdFullScreenTarget||this.fullScreenTarget;t?!e&&this.fullScreenScaleMode!==U.ScaleManager.EXACT_FIT||i===this.game.canvas||(this._fullScreenRestore={targetWidth:i.style.width,targetHeight:i.style.height},i.style.width="100%",i.style.height="100%"):(this._fullScreenRestore&&(i.style.width=this._fullScreenRestore.targetWidth,i.style.height=this._fullScreenRestore.targetHeight,this._fullScreenRestore=null),this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.resetCanvas())},fullScreenChange:function(t){this.event=t,this.isFullScreen?this.prepScreenMode(!0):(this.prepScreenMode(!1),this.cleanupCreatedTarget()),this.updateLayout(),this.queueUpdate(!0),this.onFullScreenChange.dispatch(this,this.width,this.height)},fullScreenError:function(t){this.event=t,this.cleanupCreatedTarget(),this.onFullScreenError.dispatch(this)},scaleSprite:function(t,e,i,n){if(void 0===e&&(e=this.width),void 0===i&&(i=this.height),void 0===n&&(n=!1),!t||!t.scale)return t;if(t.scale.x=1,t.scale.y=1,t.width<=0||t.height<=0||e<=0||i<=0)return t;var r=t.height*e/t.width,s=t.width*i/t.height,i=i;return(e<s?n:!n)?(t.width=Math.floor(e),t.height=Math.floor(r)):(t.width=Math.floor(s),t.height=Math.floor(i)),t},destroy:function(){this.game.onResume.remove(this._gameResumed,this),window.removeEventListener("orientationchange",this._orientationChange,!1),window.removeEventListener("resize",this._windowResize,!1),this.compatibility.supportsFullScreen&&(document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.removeEventListener("fullscreenchange",this._fullScreenChange,!1),document.removeEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.removeEventListener("mozfullscreenerror",this._fullScreenError,!1),document.removeEventListener("MSFullscreenError",this._fullScreenError,!1),document.removeEventListener("fullscreenerror",this._fullScreenError,!1))}},U.ScaleManager.prototype.constructor=U.ScaleManager,Object.defineProperty(U.ScaleManager.prototype,"boundingParent",{get:function(){return!(this.parentIsWindow||this.isFullScreen&&this.hasPhaserSetFullScreen&&!this._createdFullScreenTarget)&&this.game.canvas&&this.game.canvas.parentNode||null}}),Object.defineProperty(U.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(t){return t!==this._scaleMode&&(this.isFullScreen||(this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.queueUpdate(!0)),this._scaleMode=t),this._scaleMode}}),Object.defineProperty(U.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},set:function(t){return t!==this._fullScreenScaleMode&&(this.isFullScreen?(this.prepScreenMode(!1),this._fullScreenScaleMode=t,this.prepScreenMode(!0),this.queueUpdate(!0)):this._fullScreenScaleMode=t),this._fullScreenScaleMode}}),Object.defineProperty(U.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}}),Object.defineProperty(U.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},set:function(t){t!==this._pageAlignHorizontally&&(this._pageAlignHorizontally=t,this.queueUpdate(!0))}}),Object.defineProperty(U.ScaleManager.prototype,"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(t){t!==this._pageAlignVertically&&(this._pageAlignVertically=t,this.queueUpdate(!0))}}),Object.defineProperty(U.ScaleManager.prototype,"isFullScreen",{get:function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}}),Object.defineProperty(U.ScaleManager.prototype,"isPortrait",{get:function(){return"portrait"===this.classifyOrientation(this.screenOrientation)}}),Object.defineProperty(U.ScaleManager.prototype,"isLandscape",{get:function(){return"landscape"===this.classifyOrientation(this.screenOrientation)}}),Object.defineProperty(U.ScaleManager.prototype,"isGamePortrait",{get:function(){return this.height>this.width}}),Object.defineProperty(U.ScaleManager.prototype,"isGameLandscape",{get:function(){return this.width>this.height}}),U.Utils.Debug=function(t){this.game=t,this.sprite=null,this.bmd=null,this.canvas=null,this.context=null,this.font="14px Courier",this.columnWidth=100,this.lineHeight=16,this.renderShadow=!0,this.currentX=0,this.currentY=0,this.currentAlpha=1,this.dirty=!1},U.Utils.Debug.prototype={boot:function(){this.game.renderType===U.CANVAS?this.context=this.game.context:(this.bmd=new U.BitmapData(this.game,"__DEBUG",this.game.width,this.game.height,!0),this.sprite=this.game.make.image(0,0,this.bmd),this.game.stage.addChild(this.sprite),this.game.scale.onSizeChange.add(this.resize,this),this.canvas=PIXI.CanvasPool.create(this,this.game.width,this.game.height),this.context=this.canvas.getContext("2d"))},resize:function(t,e,i){this.bmd.resize(e,i),this.canvas.width=e,this.canvas.height=i},preUpdate:function(){this.dirty&&this.sprite&&(this.bmd.clear(),this.bmd.draw(this.canvas,0,0),this.context.clearRect(0,0,this.game.width,this.game.height),this.dirty=!1)},reset:function(){this.context&&this.context.clearRect(0,0,this.game.width,this.game.height),this.sprite&&this.bmd.clear()},start:function(t,e,i,n){"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0),i=i||"rgb(255,255,255)",void 0===n&&(n=0),this.currentX=t,this.currentY=e,this.currentColor=i,this.columnWidth=n,this.dirty=!0,this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.strokeStyle=i,this.context.fillStyle=i,this.context.font=this.font,this.context.globalAlpha=this.currentAlpha},stop:function(){this.context.restore()},line:function(){for(var t=this.currentX,e=0;e<arguments.length;e++)this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(arguments[e],t+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(arguments[e],t,this.currentY),t+=this.columnWidth;this.currentY+=this.lineHeight},soundInfo:function(t,e,i,n){this.start(e,i,n),this.line("Sound: "+t.key+" Locked: "+t.game.sound.touchLocked),this.line("Is Ready?: "+this.game.cache.isSoundReady(t.key)+" Pending Playback: "+t.pendingPlayback),this.line("Decoded: "+t.isDecoded+" Decoding: "+t.isDecoding),this.line("Total Duration: "+t.totalDuration+" Playing: "+t.isPlaying),this.line("Time: "+t.currentTime),this.line("Volume: "+t.volume+" Muted: "+t.mute),this.line("WebAudio: "+t.usingWebAudio+" Audio: "+t.usingAudioTag),""!==t.currentMarker&&(this.line("Marker: "+t.currentMarker+" Duration: "+t.duration+" (ms: "+t.durationMS+")"),this.line("Start: "+t.markers[t.currentMarker].start+" Stop: "+t.markers[t.currentMarker].stop),this.line("Position: "+t.position)),this.stop()},cameraInfo:function(t,e,i,n){this.start(e,i,n),this.line("Camera ("+t.width+" x "+t.height+")"),this.line("X: "+t.x+" Y: "+t.y),t.bounds&&this.line("Bounds x: "+t.bounds.x+" Y: "+t.bounds.y+" w: "+t.bounds.width+" h: "+t.bounds.height),this.line("View x: "+t.view.x+" Y: "+t.view.y+" w: "+t.view.width+" h: "+t.view.height),this.line("Total in view: "+t.totalInView),this.stop()},timer:function(t,e,i,n){this.start(e,i,n),this.line("Timer (running: "+t.running+" expired: "+t.expired+")"),this.line("Next Tick: "+t.next+" Duration: "+t.duration),this.line("Paused: "+t.paused+" Length: "+t.length),this.stop()},pointer:function(t,e,i,n,r){null!=t&&(void 0===e&&(e=!1),i=i||"rgba(0,255,0,0.5)",n=n||"rgba(255,0,0,0.5)",!0===e&&!0===t.isUp||(this.start(t.x,t.y-100,r),this.context.beginPath(),this.context.arc(t.x,t.y,t.circle.radius,0,2*Math.PI),t.active?this.context.fillStyle=i:this.context.fillStyle=n,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(t.positionDown.x,t.positionDown.y),this.context.lineTo(t.position.x,t.position.y),this.context.lineWidth=2,this.context.stroke(),this.context.closePath(),this.line("ID: "+t.id+" Active: "+t.active),this.line("World X: "+t.worldX+" World Y: "+t.worldY),this.line("Screen X: "+t.x+" Screen Y: "+t.y+" In: "+t.withinGame),this.line("Duration: "+t.duration+" ms"),this.line("is Down: "+t.isDown+" is Up: "+t.isUp),this.stop()))},spriteInputInfo:function(t,e,i,n){this.start(e,i,n),this.line("Sprite Input: ("+t.width+" x "+t.height+")"),this.line("x: "+t.input.pointerX().toFixed(1)+" y: "+t.input.pointerY().toFixed(1)),this.line("over: "+t.input.pointerOver()+" duration: "+t.input.overDuration().toFixed(0)),this.line("down: "+t.input.pointerDown()+" duration: "+t.input.downDuration().toFixed(0)),this.line("just over: "+t.input.justOver()+" just out: "+t.input.justOut()),this.stop()},key:function(t,e,i,n){this.start(e,i,n,150),this.line("Key:",t.keyCode,"isDown:",t.isDown),this.line("justDown:",t.justDown,"justUp:",t.justUp),this.line("Time Down:",t.timeDown.toFixed(0),"duration:",t.duration.toFixed(0)),this.stop()},inputInfo:function(t,e,i){this.start(t,e,i),this.line("Input"),this.line("X: "+this.game.input.x+" Y: "+this.game.input.y),this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY),this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1)),this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY),this.stop()},spriteBounds:function(t,e,i){t=t.getBounds();t.x+=this.game.camera.x,t.y+=this.game.camera.y,this.rectangle(t,e,i)},ropeSegments:function(t,e,i){var n=this;t.segments.forEach(function(t){n.rectangle(t,e,i)},this)},spriteInfo:function(t,e,i,n){this.start(e,i,n),this.line("Sprite:  ("+t.width+" x "+t.height+") anchor: "+t.anchor.x+" x "+t.anchor.y),this.line("x: "+t.x.toFixed(1)+" y: "+t.y.toFixed(1)),this.line("angle: "+t.angle.toFixed(1)+" rotation: "+t.rotation.toFixed(1)),this.line("visible: "+t.visible+" in camera: "+t.inCamera),this.line("bounds x: "+t._bounds.x.toFixed(1)+" y: "+t._bounds.y.toFixed(1)+" w: "+t._bounds.width.toFixed(1)+" h: "+t._bounds.height.toFixed(1)),this.stop()},spriteCoords:function(t,e,i,n){this.start(e,i,n,100),t.name&&this.line(t.name),this.line("x:",t.x.toFixed(2),"y:",t.y.toFixed(2)),this.line("pos x:",t.position.x.toFixed(2),"pos y:",t.position.y.toFixed(2)),this.line("world x:",t.world.x.toFixed(2),"world y:",t.world.y.toFixed(2)),this.stop()},lineInfo:function(t,e,i,n){this.start(e,i,n,80),this.line("start.x:",t.start.x.toFixed(2),"start.y:",t.start.y.toFixed(2)),this.line("end.x:",t.end.x.toFixed(2),"end.y:",t.end.y.toFixed(2)),this.line("length:",t.length.toFixed(2),"angle:",t.angle),this.stop()},pixel:function(t,e,i,n){n=n||2,this.start(),this.context.fillStyle=i,this.context.fillRect(t,e,n,n),this.stop()},geom:function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=0),e=e||"rgba(0,255,0,0.4)",this.start(),this.context.fillStyle=e,this.context.strokeStyle=e,t instanceof U.Rectangle||1===n?i?this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height):this.context.strokeRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height):t instanceof U.Circle||2===n?(this.context.beginPath(),this.context.arc(t.x-this.game.camera.x,t.y-this.game.camera.y,t.radius,0,2*Math.PI,!1),this.context.closePath(),i?this.context.fill():this.context.stroke()):t instanceof U.Point||3===n?this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,4,4):(t instanceof U.Line||4===n)&&(this.context.lineWidth=1,this.context.beginPath(),this.context.moveTo(t.start.x+.5-this.game.camera.x,t.start.y+.5-this.game.camera.y),this.context.lineTo(t.end.x+.5-this.game.camera.x,t.end.y+.5-this.game.camera.y),this.context.closePath(),this.context.stroke()),this.stop()},rectangle:function(t,e,i){void 0===i&&(i=!0),e=e||"rgba(0, 255, 0, 0.4)",this.start(),i?(this.context.fillStyle=e,this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)):(this.context.strokeStyle=e,this.context.strokeRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)),this.stop()},text:function(t,e,i,n,r){n=n||"rgb(255,255,255)",r=r||"16px Courier",this.start(),this.context.font=r,this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(t,e+1,i+1)),this.context.fillStyle=n,this.context.fillText(t,e,i),this.stop()},quadTree:function(t,e){e=e||"rgba(255,0,0,0.3)",this.start();var i=t.bounds;if(0===t.nodes.length){this.context.strokeStyle=e,this.context.strokeRect(i.x,i.y,i.width,i.height),this.text("size: "+t.objects.length,i.x+4,i.y+16,"rgb(0,200,0)","12px Courier"),this.context.strokeStyle="rgb(0,255,0)";for(var n=0;n<t.objects.length;n++)this.context.strokeRect(t.objects[n].x,t.objects[n].y,t.objects[n].width,t.objects[n].height)}else for(n=0;n<t.nodes.length;n++)this.quadTree(t.nodes[n]);this.stop()},body:function(t,e,i){t.body&&(this.start(),t.body.type===U.Physics.ARCADE?U.Physics.Arcade.Body.render(this.context,t.body,e,i):t.body.type===U.Physics.NINJA?U.Physics.Ninja.Body.render(this.context,t.body,e,i):t.body.type===U.Physics.BOX2D&&U.Physics.Box2D.renderBody(this.context,t.body,e),this.stop())},bodyInfo:function(t,e,i,n){t.body&&(this.start(e,i,n,210),t.body.type===U.Physics.ARCADE?U.Physics.Arcade.Body.renderBodyInfo(this,t.body):t.body.type===U.Physics.BOX2D&&this.game.physics.box2d.renderBodyInfo(this,t.body),this.stop())},box2dWorld:function(){this.start(),this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0),this.game.physics.box2d.renderDebugDraw(this.context),this.stop()},box2dBody:function(t,e){this.start(),U.Physics.Box2D.renderBody(this.context,t,e),this.stop()},displayList:function(t){if(void 0===t&&(t=this.game.world),t.hasOwnProperty("renderOrderID"),t.children&&0<t.children.length)for(var e=0;e<t.children.length;e++)this.game.debug.displayList(t.children[e])},destroy:function(){PIXI.CanvasPool.remove(this)}},U.Utils.Debug.prototype.constructor=U.Utils.Debug,U.DOM={getOffset:function(t,e){e=e||new U.Point;var i=t.getBoundingClientRect(),n=U.DOM.scrollY,r=U.DOM.scrollX,s=document.documentElement.clientTop,t=document.documentElement.clientLeft;return e.x=i.left+r-t,e.y=i.top+n-s,e},getBounds:function(t,e){return void 0===e&&(e=0),!(!(t=t&&!t.nodeType?t[0]:t)||1!==t.nodeType)&&this.calibrate(t.getBoundingClientRect(),e)},calibrate:function(t,e){e=+e||0;var i={width:0,height:0,left:0,right:0,top:0,bottom:0};return i.width=(i.right=t.right+e)-(i.left=t.left-e),i.height=(i.bottom=t.bottom+e)-(i.top=t.top-e),i},getAspectRatio:function(t){var e=(t=null==t?this.visualBounds:1===t.nodeType?this.getBounds(t):t).width,i=t.height;return"function"==typeof e&&(e=e.call(t)),"function"==typeof i&&(i=i.call(t)),e/i},inLayoutViewport:function(t,e){e=this.getBounds(t,e);return!!e&&0<=e.bottom&&0<=e.right&&e.top<=this.layoutBounds.width&&e.left<=this.layoutBounds.height},getScreenOrientation:function(t){var e=window.screen,i=e.orientation||e.mozOrientation||e.msOrientation;if(i&&"string"==typeof i.type)return i.type;if("string"==typeof i)return i;var n="portrait-primary",i="landscape-primary";if("screen"===t)return e.height>e.width?n:i;if("viewport"===t)return this.visualBounds.height>this.visualBounds.width?n:i;if("window.orientation"===t&&"number"==typeof window.orientation)return 0===window.orientation||180===window.orientation?n:i;if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches)return n;if(window.matchMedia("(orientation: landscape)").matches)return i}return this.visualBounds.height>this.visualBounds.width?n:i},visualBounds:new U.Rectangle,layoutBounds:new U.Rectangle,documentBounds:new U.Rectangle},U.Device.whenReady(function(t){var e=window&&"pageXOffset"in window?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft},i=window&&"pageYOffset"in window?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop};Object.defineProperty(U.DOM,"scrollX",{get:e}),Object.defineProperty(U.DOM,"scrollY",{get:i}),Object.defineProperty(U.DOM.visualBounds,"x",{get:e}),Object.defineProperty(U.DOM.visualBounds,"y",{get:i}),Object.defineProperty(U.DOM.layoutBounds,"x",{value:0}),Object.defineProperty(U.DOM.layoutBounds,"y",{value:0}),t.desktop&&document.documentElement.clientWidth<=window.innerWidth&&document.documentElement.clientHeight<=window.innerHeight?(i=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)},t=function(){return Math.max(window.innerHeight,document.documentElement.clientHeight)},Object.defineProperty(U.DOM.visualBounds,"width",{get:i}),Object.defineProperty(U.DOM.visualBounds,"height",{get:t}),Object.defineProperty(U.DOM.layoutBounds,"width",{get:i}),Object.defineProperty(U.DOM.layoutBounds,"height",{get:t})):(Object.defineProperty(U.DOM.visualBounds,"width",{get:function(){return window.innerWidth}}),Object.defineProperty(U.DOM.visualBounds,"height",{get:function(){return window.innerHeight}}),Object.defineProperty(U.DOM.layoutBounds,"width",{get:function(){var t=document.documentElement.clientWidth,e=window.innerWidth;return t<e?e:t}}),Object.defineProperty(U.DOM.layoutBounds,"height",{get:function(){var t=document.documentElement.clientHeight,e=window.innerHeight;return t<e?e:t}})),Object.defineProperty(U.DOM.documentBounds,"x",{value:0}),Object.defineProperty(U.DOM.documentBounds,"y",{value:0}),Object.defineProperty(U.DOM.documentBounds,"width",{get:function(){var t=document.documentElement;return Math.max(t.clientWidth,t.offsetWidth,t.scrollWidth)}}),Object.defineProperty(U.DOM.documentBounds,"height",{get:function(){var t=document.documentElement;return Math.max(t.clientHeight,t.offsetHeight,t.scrollHeight)}})},null,!0),U.ArraySet=function(t){this.position=0,this.list=t||[]},U.ArraySet.prototype={add:function(t){return this.exists(t)||this.list.push(t),t},getIndex:function(t){return this.list.indexOf(t)},getByKey:function(t,e){for(var i=this.list.length;i--;)if(this.list[i][t]===e)return this.list[i];return null},exists:function(t){return-1<this.list.indexOf(t)},reset:function(){this.list.length=0},remove:function(t){var e=this.list.indexOf(t);if(-1<e)return this.list.splice(e,1),t},setAll:function(t,e){for(var i=this.list.length;i--;)this.list[i]&&(this.list[i][t]=e)},callAll:function(t){for(var e=Array.prototype.slice.call(arguments,1),i=this.list.length;i--;)this.list[i]&&this.list[i][t]&&this.list[i][t].apply(this.list[i],e)},removeAll:function(t){void 0===t&&(t=!1);for(var e,i=this.list.length;i--;)this.list[i]&&(e=this.remove(this.list[i]),t&&e.destroy());this.position=0,this.list=[]}},Object.defineProperty(U.ArraySet.prototype,"total",{get:function(){return this.list.length}}),Object.defineProperty(U.ArraySet.prototype,"first",{get:function(){return(this.position=0)<this.list.length?this.list[0]:null}}),Object.defineProperty(U.ArraySet.prototype,"next",{get:function(){return this.position<this.list.length?(this.position++,this.list[this.position]):null}}),U.ArraySet.prototype.constructor=U.ArraySet,U.ArrayUtils={getRandomItem:function(t,e,i){if(null===t)return null;void 0===e&&(e=0),void 0===i&&(i=t.length);i=e+Math.floor(Math.random()*i);return void 0===t[i]?null:t[i]},removeRandomItem:function(t,e,i){if(null==t)return null;void 0===e&&(e=0),void 0===i&&(i=t.length);i=e+Math.floor(Math.random()*i);if(i<t.length){i=t.splice(i,1);return void 0===i[0]?null:i[0]}return null},shuffle:function(t){for(var e=t.length-1;0<e;e--){var i=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[i],t[i]=n}return t},transposeMatrix:function(t){for(var e=t.length,i=t[0].length,n=new Array(i),r=0;r<i;r++){n[r]=new Array(e);for(var s=e-1;-1<s;s--)n[r][s]=t[s][r]}return n},rotateMatrix:function(t,e){if("string"!=typeof e&&(e=(e%360+360)%360),90===e||-270===e||"rotateLeft"===e)t=(t=U.ArrayUtils.transposeMatrix(t)).reverse();else if(-90===e||270===e||"rotateRight"===e)t=t.reverse(),t=U.ArrayUtils.transposeMatrix(t);else if(180===Math.abs(e)||"rotate180"===e){for(var i=0;i<t.length;i++)t[i].reverse();t=t.reverse()}return t},findClosest:function(t,e){if(!e.length)return NaN;if(1===e.length||t<e[0])return e[0];for(var i=1;e[i]<t;)i++;var n=e[i-1],r=i<e.length?e[i]:Number.POSITIVE_INFINITY;return r-t<=t-n?r:n},rotateRight:function(t){var e=t.pop();return t.unshift(e),e},rotateLeft:function(t){var e=t.shift();return t.push(e),e},rotate:function(t){var e=t.shift();return t.push(e),e},numberArray:function(t,e){for(var i=[],n=t;n<=e;n++)i.push(n);return i},numberArrayStep:function(t,e,i){null!=t||(t=0),null!=e||(e=t,t=0),void 0===i&&(i=1);for(var n=[],r=Math.max(U.Math.roundAwayFromZero((e-t)/(i||1)),0),s=0;s<r;s++)n.push(t),t+=i;return n}},U.LinkedList=function(){this.next=null,this.prev=null,this.first=null,this.last=null,this.total=0},U.LinkedList.prototype={add:function(t){return 0===this.total&&null===this.first&&null===this.last?(this.first=t,this.last=t,(this.next=t).prev=this):((this.last.next=t).prev=this.last,this.last=t),this.total++,t},reset:function(){this.first=null,this.last=null,this.next=null,this.prev=null,this.total=0},remove:function(t){if(1===this.total)return this.reset(),void(t.next=t.prev=null);t===this.first?this.first=this.first.next:t===this.last&&(this.last=this.last.prev),t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),(t.next=t.prev=null)===this.first&&(this.last=null),this.total--},callAll:function(t){if(this.first&&this.last)for(var e=this.first;e&&e[t]&&e[t].call(e),e=e.next,e!==this.last.next;);}},U.LinkedList.prototype.constructor=U.LinkedList,U.Create=function(t){this.game=t,this.bmd=null,this.canvas=null,this.ctx=null,this.palettes=[{0:"#000",1:"#9D9D9D",2:"#FFF",3:"#BE2633",4:"#E06F8B",5:"#493C2B",6:"#A46422",7:"#EB8931",8:"#F7E26B",9:"#2F484E",A:"#44891A",B:"#A3CE27",C:"#1B2632",D:"#005784",E:"#31A2F2",F:"#B2DCEF"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#f5f4eb"},{0:"#000",1:"#2234d1",2:"#0c7e45",3:"#44aacc",4:"#8a3622",5:"#5c2e78",6:"#aa5c3d",7:"#b5b5b5",8:"#5e606e",9:"#4c81fb",A:"#6cd947",B:"#7be2f9",C:"#eb8a60",D:"#e23d69",E:"#ffd93f",F:"#fff"},{0:"#000",1:"#fff",2:"#8b4131",3:"#7bbdc5",4:"#8b41ac",5:"#6aac41",6:"#3931a4",7:"#d5de73",8:"#945a20",9:"#5a4100",A:"#bd736a",B:"#525252",C:"#838383",D:"#acee8b",E:"#7b73de",F:"#acacac"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#fff"}]},U.Create.PALETTE_ARNE=0,U.Create.PALETTE_JMP=1,U.Create.PALETTE_CGA=2,U.Create.PALETTE_C64=3,U.Create.PALETTE_JAPANESE_MACHINE=4,U.Create.prototype={texture:function(t,e,i,n,r){void 0===i&&(i=8),void 0===n&&(n=i),void 0===r&&(r=0);var s=e[0].length*i,o=e.length*n;null===this.bmd&&(this.bmd=this.game.make.bitmapData(),this.canvas=this.bmd.canvas,this.ctx=this.bmd.context),this.bmd.resize(s,o),this.bmd.clear();for(var a=0;a<e.length;a++)for(var l=e[a],p=0;p<l.length;p++){var h=l[p];"."!==h&&" "!==h&&(this.ctx.fillStyle=this.palettes[r][h],this.ctx.fillRect(p*i,a*n,i,n))}return this.bmd.generateTexture(t)},grid:function(t,e,i,n,r,s){null===this.bmd&&(this.bmd=this.game.make.bitmapData(),this.canvas=this.bmd.canvas,this.ctx=this.bmd.context),this.bmd.resize(e,i),this.ctx.fillStyle=s;for(var o=0;o<i;o+=r)this.ctx.fillRect(0,o,e,1);for(var a=0;a<e;a+=n)this.ctx.fillRect(a,0,1,i);return this.bmd.generateTexture(t)}},U.Create.prototype.constructor=U.Create,U.FlexGrid=function(t,e,i){this.game=t.game,this.manager=t,this.width=e,this.height=i,this.boundsCustom=new U.Rectangle(0,0,e,i),this.boundsFluid=new U.Rectangle(0,0,e,i),this.boundsFull=new U.Rectangle(0,0,e,i),this.boundsNone=new U.Rectangle(0,0,e,i),this.positionCustom=new U.Point(0,0),this.positionFluid=new U.Point(0,0),this.positionFull=new U.Point(0,0),this.positionNone=new U.Point(0,0),this.scaleCustom=new U.Point(1,1),this.scaleFluid=new U.Point(1,1),this.scaleFluidInversed=new U.Point(1,1),this.scaleFull=new U.Point(1,1),this.scaleNone=new U.Point(1,1),this.customWidth=0,this.customHeight=0,this.customOffsetX=0,this.customOffsetY=0,this.ratioH=e/i,this.ratioV=i/e,this.multiplier=0,this.layers=[]},U.FlexGrid.prototype={setSize:function(t,e){this.width=t,this.height=e,this.ratioH=t/e,this.ratioV=e/t,this.scaleNone=new U.Point(1,1),this.boundsNone.width=this.width,this.boundsNone.height=this.height,this.refresh()},createCustomLayer:function(t,e,i,n){void 0===n&&(n=!0),this.customWidth=t,this.customHeight=e,this.boundsCustom.width=t,this.boundsCustom.height=e;e=new U.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);return n&&this.game.world.add(e),this.layers.push(e),void 0!==i&&null!==typeof i&&e.addMultiple(i),e},createFluidLayer:function(t,e){void 0===e&&(e=!0);var i=new U.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);return e&&this.game.world.add(i),this.layers.push(i),void 0!==t&&null!==typeof t&&i.addMultiple(t),i},createFullLayer:function(t){var e=new U.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);return this.game.world.add(e),this.layers.push(e),void 0!==t&&e.addMultiple(t),e},createFixedLayer:function(t){var e=new U.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);return this.game.world.add(e),this.layers.push(e),void 0!==t&&e.addMultiple(t),e},reset:function(){for(var t=this.layers.length;t--;)this.layers[t].persist||(this.layers[t].position=null,this.layers[t].scale=null,this.layers.slice(t,1))},onResize:function(t,e){this.ratioH=t/e,this.ratioV=e/t,this.refresh(t,e)},refresh:function(){this.multiplier=Math.min(this.manager.height/this.height,this.manager.width/this.width),this.boundsFluid.width=Math.round(this.width*this.multiplier),this.boundsFluid.height=Math.round(this.height*this.multiplier),this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height),this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height),this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height),this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x),this.boundsFull.height=Math.round(this.manager.height*this.scaleFluidInversed.y),this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY),this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY),this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y),this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(t){this.manager.scaleSprite(t),t.x=this.manager.bounds.centerX,t.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16),this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",!1)}},U.FlexGrid.prototype.constructor=U.FlexGrid,U.FlexLayer=function(t,e,i,n){U.Group.call(this,t.game,null,"__flexLayer"+t.game.rnd.uuid(),!1),this.manager=t.manager,this.grid=t,this.persist=!1,this.position=e,this.bounds=i,this.scale=n,this.topLeft=i.topLeft,this.topMiddle=new U.Point(i.halfWidth,0),this.topRight=i.topRight,this.bottomLeft=i.bottomLeft,this.bottomMiddle=new U.Point(i.halfWidth,i.bottom),this.bottomRight=i.bottomRight},U.FlexLayer.prototype=Object.create(U.Group.prototype),U.FlexLayer.prototype.constructor=U.FlexLayer,U.FlexLayer.prototype.resize=function(){},U.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16),this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",!1),this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9"),this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9"),this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")},U.Color={packPixel:function(t,e,i,n){return U.Device.LITTLE_ENDIAN?(n<<24|i<<16|e<<8|t)>>>0:(t<<24|e<<16|i<<8|n)>>>0},unpackPixel:function(t,e,i,n){return null!=e||(e=U.Color.createColor()),null!=i||(i=!1),null!=n||(n=!1),U.Device.LITTLE_ENDIAN?(e.a=(4278190080&t)>>>24,e.b=(16711680&t)>>>16,e.g=(65280&t)>>>8,e.r=255&t):(e.r=(4278190080&t)>>>24,e.g=(16711680&t)>>>16,e.b=(65280&t)>>>8,e.a=255&t),e.color=t,e.rgba="rgba("+e.r+","+e.g+","+e.b+","+e.a/255+")",i&&U.Color.RGBtoHSL(e.r,e.g,e.b,e),n&&U.Color.RGBtoHSV(e.r,e.g,e.b,e),e},fromRGBA:function(t,e){return(e=e||U.Color.createColor()).r=(4278190080&t)>>>24,e.g=(16711680&t)>>>16,e.b=(65280&t)>>>8,e.a=255&t,e.rgba="rgba("+e.r+","+e.g+","+e.b+","+e.a+")",e},toRGBA:function(t,e,i,n){return t<<24|e<<16|i<<8|n},toABGR:function(t,e,i,n){return(n<<24|i<<16|e<<8|t)>>>0},RGBtoHSL:function(t,e,i,n){n=n||U.Color.createColor(t,e,i,1),t/=255,e/=255,i/=255;var r,s=Math.min(t,e,i),o=Math.max(t,e,i);return n.h=0,n.s=0,n.l=(o+s)/2,o!==s&&(r=o-s,n.s=.5<n.l?r/(2-o-s):r/(o+s),o===t?n.h=(e-i)/r+(e<i?6:0):o===e?n.h=(i-t)/r+2:o===i&&(n.h=(t-e)/r+4),n.h/=6),n},HSLtoRGB:function(t,e,i,n){return n?(n.r=i,n.g=i,n.b=i):n=U.Color.createColor(i,i,i),0!==e&&(e=2*i-(i=i<.5?i*(1+e):i+e-i*e),n.r=U.Color.hueToColor(e,i,t+1/3),n.g=U.Color.hueToColor(e,i,t),n.b=U.Color.hueToColor(e,i,t-1/3)),n.r=Math.floor(255*n.r|0),n.g=Math.floor(255*n.g|0),n.b=Math.floor(255*n.b|0),U.Color.updateColor(n),n},RGBtoHSV:function(t,e,i,n){n=n||U.Color.createColor(t,e,i,255),t/=255,e/=255,i/=255;var r=Math.min(t,e,i),s=Math.max(t,e,i),o=s-r;return n.h=0,n.s=0===s?0:o/s,(n.v=s)!==r&&(s===t?n.h=(e-i)/o+(e<i?6:0):s===e?n.h=(i-t)/o+2:s===i&&(n.h=(t-e)/o+4),n.h/=6),n},HSVtoRGB:function(t,e,i,n){void 0===n&&(n=U.Color.createColor(0,0,0,1,t,e,0,i));var r,s,o,a=Math.floor(6*t),t=6*t-a,l=i*(1-e),p=i*(1-t*e),h=i*(1-(1-t)*e);switch(a%6){case 0:r=i,s=h,o=l;break;case 1:r=p,s=i,o=l;break;case 2:r=l,s=i,o=h;break;case 3:r=l,s=p,o=i;break;case 4:r=h,s=l,o=i;break;case 5:r=i,s=l,o=p}return n.r=Math.floor(255*r),n.g=Math.floor(255*s),n.b=Math.floor(255*o),U.Color.updateColor(n),n},hueToColor:function(t,e,i){return i<0&&(i+=1),1<i&&--i,i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t},createColor:function(t,e,i,n,r,s,o,a){a={r:t||0,g:e||0,b:i||0,a:n||1,h:r||0,s:s||0,l:o||0,v:a||0,color:0,color32:0,rgba:""};return U.Color.updateColor(a)},updateColor:function(t){return t.rgba="rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+t.a.toString()+")",t.color=U.Color.getColor(t.r,t.g,t.b),t.color32=U.Color.getColor32(255*t.a,t.r,t.g,t.b),t},getColor32:function(t,e,i,n){return t<<24|e<<16|i<<8|n},getColor:function(t,e,i){return t<<16|e<<8|i},RGBtoString:function(t,e,i,n,r){return void 0===n&&(n=255),void 0===r&&(r="#"),"#"===r?"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1):"0x"+U.Color.componentToHex(n)+U.Color.componentToHex(t)+U.Color.componentToHex(e)+U.Color.componentToHex(i)},hexToRGB:function(t){t=U.Color.hexToColor(t);if(t)return U.Color.getColor32(t.a,t.r,t.g,t.b)},hexToColor:function(t,e){t=t.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,n){return e+e+i+i+n+n});var i,n=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return n&&(i=parseInt(n[1],16),t=parseInt(n[2],16),n=parseInt(n[3],16),e?(e.r=i,e.g=t,e.b=n):e=U.Color.createColor(i,t,n)),e},webToColor:function(t,e){e=e||U.Color.createColor();t=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(t);return t&&(e.r=parseInt(t[1],10),e.g=parseInt(t[2],10),e.b=parseInt(t[3],10),e.a=void 0!==t[4]?parseFloat(t[4]):1,U.Color.updateColor(e)),e},valueToColor:function(t,e){if(e=e||U.Color.createColor(),"string"==typeof t)return 0===t.indexOf("rgb")?U.Color.webToColor(t,e):(e.a=1,U.Color.hexToColor(t,e));if("number"!=typeof t)return e;t=U.Color.getRGB(t);return e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a/255,e},componentToHex:function(t){t=t.toString(16);return 1===t.length?"0"+t:t},HSVColorWheel:function(t,e){void 0===t&&(t=1),void 0===e&&(e=1);for(var i=[],n=0;n<=359;n++)i.push(U.Color.HSVtoRGB(n/359,t,e));return i},HSLColorWheel:function(t,e){void 0===t&&(t=.5),void 0===e&&(e=.5);for(var i=[],n=0;n<=359;n++)i.push(U.Color.HSLtoRGB(n/359,t,e));return i},interpolateColor:function(t,e,i,n,r){void 0===r&&(r=255);var s=U.Color.getRGB(t),o=U.Color.getRGB(e),t=(o.red-s.red)*n/i+s.red,e=(o.green-s.green)*n/i+s.green,s=(o.blue-s.blue)*n/i+s.blue;return U.Color.getColor32(r,t,e,s)},interpolateColorWithRGB:function(t,e,i,n,r,s){t=U.Color.getRGB(t),e=(e-t.red)*s/r+t.red,i=(i-t.green)*s/r+t.green,t=(n-t.blue)*s/r+t.blue;return U.Color.getColor(e,i,t)},interpolateRGB:function(t,e,i,n,r,s,o,a){t=(n-t)*a/o+t,e=(r-e)*a/o+e,i=(s-i)*a/o+i;return U.Color.getColor(t,e,i)},getRandomColor:function(t,e,i){if(void 0===t&&(t=0),void 0===e&&(e=255),void 0===i&&(i=255),255<e||e<t)return U.Color.getColor(255,255,255);var n=t+Math.round(Math.random()*(e-t)),r=t+Math.round(Math.random()*(e-t)),t=t+Math.round(Math.random()*(e-t));return U.Color.getColor32(i,n,r,t)},getRGB:function(t){return 16777215<t?{alpha:t>>>24,red:t>>16&255,green:t>>8&255,blue:255&t,a:t>>>24,r:t>>16&255,g:t>>8&255,b:255&t}:{alpha:255,red:t>>16&255,green:t>>8&255,blue:255&t,a:255,r:t>>16&255,g:t>>8&255,b:255&t}},getWebRGB:function(t){if("object"==typeof t)return"rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+(t.a/255).toString()+")";t=U.Color.getRGB(t);return"rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+(t.a/255).toString()+")"},getAlpha:function(t){return t>>>24},getAlphaFloat:function(t){return(t>>>24)/255},getRed:function(t){return t>>16&255},getGreen:function(t){return t>>8&255},getBlue:function(t){return 255&t},blendNormal:function(t){return t},blendLighten:function(t,e){return t<e?e:t},blendDarken:function(t,e){return t<e?t:e},blendMultiply:function(t,e){return t*e/255},blendAverage:function(t,e){return(t+e)/2},blendAdd:function(t,e){return Math.min(255,t+e)},blendSubtract:function(t,e){return Math.max(0,t+e-255)},blendDifference:function(t,e){return Math.abs(t-e)},blendNegation:function(t,e){return 255-Math.abs(255-t-e)},blendScreen:function(t,e){return 255-((255-t)*(255-e)>>8)},blendExclusion:function(t,e){return t+e-2*t*e/255},blendOverlay:function(t,e){return e<128?2*t*e/255:255-2*(255-t)*(255-e)/255},blendSoftLight:function(t,e){return e<128?2*(64+(t>>1))*(e/255):255-2*(255-(64+(t>>1)))*(255-e)/255},blendHardLight:function(t,e){return U.Color.blendOverlay(e,t)},blendColorDodge:function(t,e){return 255===e?e:Math.min(255,(t<<8)/(255-e))},blendColorBurn:function(t,e){return 0===e?e:Math.max(0,255-(255-t<<8)/e)},blendLinearDodge:function(t,e){return U.Color.blendAdd(t,e)},blendLinearBurn:function(t,e){return U.Color.blendSubtract(t,e)},blendLinearLight:function(t,e){return e<128?U.Color.blendLinearBurn(t,2*e):U.Color.blendLinearDodge(t,2*(e-128))},blendVividLight:function(t,e){return e<128?U.Color.blendColorBurn(t,2*e):U.Color.blendColorDodge(t,2*(e-128))},blendPinLight:function(t,e){return e<128?U.Color.blendDarken(t,2*e):U.Color.blendLighten(t,2*(e-128))},blendHardMix:function(t,e){return U.Color.blendVividLight(t,e)<128?0:255},blendReflect:function(t,e){return 255===e?e:Math.min(255,t*t/(255-e))},blendGlow:function(t,e){return U.Color.blendReflect(e,t)},blendPhoenix:function(t,e){return Math.min(t,e)-Math.max(t,e)+255}},U.Physics=function(t,e){e=e||{},this.game=t,this.config=e,this.arcade=null,this.p2=null,this.ninja=null,this.box2d=null,this.chipmunk=null,this.matter=null,this.parseConfig()},U.Physics.ARCADE=0,U.Physics.P2JS=1,U.Physics.NINJA=2,U.Physics.BOX2D=3,U.Physics.CHIPMUNK=4,U.Physics.MATTERJS=5,U.Physics.prototype={parseConfig:function(){this.config.hasOwnProperty("arcade")&&!0!==this.config.arcade||!U.Physics.hasOwnProperty("Arcade")||(this.arcade=new U.Physics.Arcade(this.game)),this.config.hasOwnProperty("ninja")&&!0===this.config.ninja&&U.Physics.hasOwnProperty("Ninja")&&(this.ninja=new U.Physics.Ninja(this.game)),this.config.hasOwnProperty("p2")&&!0===this.config.p2&&U.Physics.hasOwnProperty("P2")&&(this.p2=new U.Physics.P2(this.game,this.config)),this.config.hasOwnProperty("box2d")&&!0===this.config.box2d&&U.Physics.hasOwnProperty("BOX2D")&&(this.box2d=new U.Physics.BOX2D(this.game,this.config)),this.config.hasOwnProperty("matter")&&!0===this.config.matter&&U.Physics.hasOwnProperty("Matter")&&(this.matter=new U.Physics.Matter(this.game,this.config))},startSystem:function(t){t===U.Physics.ARCADE?this.arcade=new U.Physics.Arcade(this.game):t===U.Physics.P2JS?null===this.p2?this.p2=new U.Physics.P2(this.game,this.config):this.p2.reset():t===U.Physics.NINJA?this.ninja=new U.Physics.Ninja(this.game):t===U.Physics.BOX2D?null===this.box2d?this.box2d=new U.Physics.Box2D(this.game,this.config):this.box2d.reset():t===U.Physics.MATTERJS&&(null===this.matter?this.matter=new U.Physics.Matter(this.game,this.config):this.matter.reset())},enable:function(t,e,i){void 0===e&&(e=U.Physics.ARCADE),void 0===i&&(i=!1),e===U.Physics.ARCADE?this.arcade.enable(t):e===U.Physics.P2JS&&this.p2?this.p2.enable(t,i):e===U.Physics.NINJA&&this.ninja?this.ninja.enableAABB(t):e===U.Physics.BOX2D&&this.box2d?this.box2d.enable(t):e===U.Physics.MATTERJS&&this.matter&&this.matter.enable(t)},preUpdate:function(){this.p2&&this.p2.preUpdate(),this.box2d&&this.box2d.preUpdate(),this.matter&&this.matter.preUpdate()},update:function(){this.p2&&this.p2.update(),this.box2d&&this.box2d.update(),this.matter&&this.matter.update()},setBoundsToWorld:function(){this.arcade&&this.arcade.setBoundsToWorld(),this.ninja&&this.ninja.setBoundsToWorld(),this.p2&&this.p2.setBoundsToWorld(),this.box2d&&this.box2d.setBoundsToWorld(),this.matter&&this.matter.setBoundsToWorld()},clear:function(){this.p2&&this.p2.clear(),this.box2d&&this.box2d.clear(),this.matter&&this.matter.clear()},reset:function(){this.p2&&this.p2.reset(),this.box2d&&this.box2d.reset(),this.matter&&this.matter.reset()},destroy:function(){this.p2&&this.p2.destroy(),this.box2d&&this.box2d.destroy(),this.matter&&this.matter.destroy(),this.arcade=null,this.ninja=null,this.p2=null,this.box2d=null,this.matter=null}},U.Physics.prototype.constructor=U.Physics,U.Physics.Arcade=function(t){this.game=t,this.gravity=new U.Point,this.bounds=new U.Rectangle(0,0,t.world.width,t.world.height),this.checkCollision={up:!0,down:!0,left:!0,right:!0},this.maxObjects=10,this.maxLevels=4,this.OVERLAP_BIAS=4,this.forceX=!1,this.sortDirection=U.Physics.Arcade.LEFT_RIGHT,this.skipQuadTree=!0,this.isPaused=!1,this.quadTree=new U.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this._total=0,this.setBoundsToWorld()},U.Physics.Arcade.prototype.constructor=U.Physics.Arcade,U.Physics.Arcade.SORT_NONE=0,U.Physics.Arcade.LEFT_RIGHT=1,U.Physics.Arcade.RIGHT_LEFT=2,U.Physics.Arcade.TOP_BOTTOM=3,U.Physics.Arcade.BOTTOM_TOP=4,U.Physics.Arcade.prototype={setBounds:function(t,e,i,n){this.bounds.setTo(t,e,i,n)},setBoundsToWorld:function(){this.bounds.copyFrom(this.game.world.bounds)},enable:function(t,e){void 0===e&&(e=!0);var i=1;if(Array.isArray(t))for(i=t.length;i--;)t[i]instanceof U.Group?this.enable(t[i].children,e):(this.enableBody(t[i]),e&&t[i].hasOwnProperty("children")&&0<t[i].children.length&&this.enable(t[i],!0));else t instanceof U.Group?this.enable(t.children,e):(this.enableBody(t),e&&t.hasOwnProperty("children")&&0<t.children.length&&this.enable(t.children,!0))},enableBody:function(t){t.hasOwnProperty("body")&&null===t.body&&(t.body=new U.Physics.Arcade.Body(t),t.parent&&t.parent instanceof U.Group&&t.parent.addToHash(t))},updateMotion:function(t){var e=this.computeVelocity(0,t,t.angularVelocity,t.angularAcceleration,t.angularDrag,t.maxAngular)-t.angularVelocity;t.angularVelocity+=e,t.rotation+=t.angularVelocity*this.game.time.physicsElapsed,t.velocity.x=this.computeVelocity(1,t,t.velocity.x,t.acceleration.x,t.drag.x,t.maxVelocity.x),t.velocity.y=this.computeVelocity(2,t,t.velocity.y,t.acceleration.y,t.drag.y,t.maxVelocity.y)},computeVelocity:function(t,e,i,n,r,s){return void 0===s&&(s=1e4),1===t&&e.allowGravity?i+=(this.gravity.x+e.gravity.x)*this.game.time.physicsElapsed:2===t&&e.allowGravity&&(i+=(this.gravity.y+e.gravity.y)*this.game.time.physicsElapsed),n?i+=n*this.game.time.physicsElapsed:r&&(0<i-(r*=this.game.time.physicsElapsed)?i-=r:i+r<0?i+=r:i=0),s<i?i=s:i<-s&&(i=-s),i},overlap:function(t,e,i,n,r){if(i=i||null,n=n||null,r=r||i,this._total=0,!Array.isArray(t)&&Array.isArray(e))for(var s=0;s<e.length;s++)this.collideHandler(t,e[s],i,n,r,!0);else if(Array.isArray(t)&&!Array.isArray(e))for(s=0;s<t.length;s++)this.collideHandler(t[s],e,i,n,r,!0);else if(Array.isArray(t)&&Array.isArray(e))for(s=0;s<t.length;s++)for(var o=0;o<e.length;o++)this.collideHandler(t[s],e[o],i,n,r,!0);else this.collideHandler(t,e,i,n,r,!0);return 0<this._total},collide:function(t,e,i,n,r){if(i=i||null,n=n||null,r=r||i,this._total=0,!Array.isArray(t)&&Array.isArray(e))for(var s=0;s<e.length;s++)this.collideHandler(t,e[s],i,n,r,!1);else if(Array.isArray(t)&&!Array.isArray(e))for(s=0;s<t.length;s++)this.collideHandler(t[s],e,i,n,r,!1);else if(Array.isArray(t)&&Array.isArray(e))for(s=0;s<t.length;s++)for(var o=0;o<e.length;o++)this.collideHandler(t[s],e[o],i,n,r,!1);else this.collideHandler(t,e,i,n,r,!1);return 0<this._total},sortLeftRight:function(t,e){return t.body&&e.body?t.body.x-e.body.x:0},sortRightLeft:function(t,e){return t.body&&e.body?e.body.x-t.body.x:0},sortTopBottom:function(t,e){return t.body&&e.body?t.body.y-e.body.y:0},sortBottomTop:function(t,e){return t.body&&e.body?e.body.y-t.body.y:0},sort:function(t,e){null!==t.physicsSortDirection?e=t.physicsSortDirection:void 0===e&&(e=this.sortDirection),e===U.Physics.Arcade.LEFT_RIGHT?t.hash.sort(this.sortLeftRight):e===U.Physics.Arcade.RIGHT_LEFT?t.hash.sort(this.sortRightLeft):e===U.Physics.Arcade.TOP_BOTTOM?t.hash.sort(this.sortTopBottom):e===U.Physics.Arcade.BOTTOM_TOP&&t.hash.sort(this.sortBottomTop)},collideHandler:function(t,e,i,n,r,s){if(void 0===e&&t.physicsType===U.GROUP)return this.sort(t),void this.collideGroupVsSelf(t,i,n,r,s);t&&e&&t.exists&&e.exists&&(this.sortDirection!==U.Physics.Arcade.SORT_NONE&&(t.physicsType===U.GROUP&&this.sort(t),e.physicsType===U.GROUP&&this.sort(e)),t.physicsType===U.SPRITE?e.physicsType===U.SPRITE?this.collideSpriteVsSprite(t,e,i,n,r,s):e.physicsType===U.GROUP?this.collideSpriteVsGroup(t,e,i,n,r,s):e.physicsType===U.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(t,e,i,n,r,s):t.physicsType===U.GROUP?e.physicsType===U.SPRITE?this.collideSpriteVsGroup(e,t,i,n,r,s):e.physicsType===U.GROUP?this.collideGroupVsGroup(t,e,i,n,r,s):e.physicsType===U.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(t,e,i,n,r,s):t.physicsType===U.TILEMAPLAYER&&(e.physicsType===U.SPRITE?this.collideSpriteVsTilemapLayer(e,t,i,n,r,s):e.physicsType===U.GROUP&&this.collideGroupVsTilemapLayer(e,t,i,n,r,s)))},collideSpriteVsSprite:function(t,e,i,n,r,s){return!(!t.body||!e.body||(this.separate(t.body,e.body,n,r,s)&&(i&&i.call(r,t,e),this._total++),0))},collideSpriteVsGroup:function(t,e,i,n,r,s){if(0!==e.length&&t.body)if(this.skipQuadTree||t.body.skipQuadTree)for(var o={},a=0;a<e.hash.length;a++){var l=e.hash[a];if(l&&l.exists&&l.body){if(o=l.body.getBounds(o),this.sortDirection===U.Physics.Arcade.LEFT_RIGHT){if(t.body.right<o.x)break;if(o.right<t.body.x)continue}else if(this.sortDirection===U.Physics.Arcade.RIGHT_LEFT){if(t.body.x>o.right)break;if(o.x>t.body.right)continue}else if(this.sortDirection===U.Physics.Arcade.TOP_BOTTOM){if(t.body.bottom<o.y)break;if(o.bottom<t.body.y)continue}else if(this.sortDirection===U.Physics.Arcade.BOTTOM_TOP){if(t.body.y>o.bottom)break;if(o.y>t.body.bottom)continue}this.collideSpriteVsSprite(t,l,i,n,r,s)}}else{this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(e);for(var p=this.quadTree.retrieve(t),a=0;a<p.length;a++)this.separate(t.body,p[a],n,r,s)&&(i&&i.call(r,t,p[a].sprite),this._total++)}},collideGroupVsSelf:function(t,e,i,n,r){if(0!==t.length)for(var s=0;s<t.hash.length;s++){var o={},a=t.hash[s];if(a&&a.exists&&a.body){o=a.body.getBounds(o);for(var l=s+1;l<t.hash.length;l++){var p={},h=t.hash[l];if(h&&h.exists&&h.body){if(p=h.body.getBounds(p),this.sortDirection===U.Physics.Arcade.LEFT_RIGHT){if(o.right<p.x)break;if(p.right<o.x)continue}else if(this.sortDirection===U.Physics.Arcade.RIGHT_LEFT){if(o.x>p.right)continue;if(p.x>o.right)break}else if(this.sortDirection===U.Physics.Arcade.TOP_BOTTOM){if(o.bottom<p.y)continue;if(p.bottom<o.y)break}else if(this.sortDirection===U.Physics.Arcade.BOTTOM_TOP){if(o.y>p.bottom)continue;if(p.y>a.body.bottom)break}this.collideSpriteVsSprite(a,h,e,i,n,r)}}}}},collideGroupVsGroup:function(t,e,i,n,r,s){if(0!==t.length&&0!==e.length)for(var o=0;o<t.children.length;o++)t.children[o].exists&&(t.children[o].physicsType===U.GROUP?this.collideGroupVsGroup(t.children[o],e,i,n,r,s):this.collideSpriteVsGroup(t.children[o],e,i,n,r,s))},separate:function(t,e,i,n,r){if(!t.enable||!e.enable||t.checkCollision.none||e.checkCollision.none||!this.intersects(t,e))return!1;if(i&&!1===i.call(n,t.sprite,e.sprite))return!1;if(t.isCircle&&e.isCircle)return this.separateCircle(t,e,r);if(t.isCircle!==e.isCircle){var s=t.isCircle?e:t,o=t.isCircle?t:e,a=s.x,i=s.y,l=s.right,n=s.bottom,s=o.x+o.radius,o=o.y+o.radius;if((o<i||n<o)&&(s<a||l<s))return this.separateCircle(t,e,r)}l=!1,s=!1;this.forceX||Math.abs(this.gravity.y+t.gravity.y)<Math.abs(this.gravity.x+t.gravity.x)?(l=this.separateX(t,e,r),this.intersects(t,e)&&(s=this.separateY(t,e,r))):(s=this.separateY(t,e,r),this.intersects(t,e)&&(l=this.separateX(t,e,r)));s=l||s;return s&&(r?(t.onOverlap&&t.onOverlap.dispatch(t.sprite,e.sprite),e.onOverlap&&e.onOverlap.dispatch(e.sprite,t.sprite)):(t.onCollide&&t.onCollide.dispatch(t.sprite,e.sprite),e.onCollide&&e.onCollide.dispatch(e.sprite,t.sprite))),s},intersects:function(t,e){return t!==e&&(t.isCircle?e.isCircle?U.Math.distance(t.center.x,t.center.y,e.center.x,e.center.y)<=t.radius+e.radius:this.circleBodyIntersects(t,e):e.isCircle?this.circleBodyIntersects(e,t):!(t.right<=e.position.x||t.bottom<=e.position.y||t.position.x>=e.right||t.position.y>=e.bottom))},circleBodyIntersects:function(t,e){var i=U.Math.clamp(t.center.x,e.left,e.right),e=U.Math.clamp(t.center.y,e.top,e.bottom);return(t.center.x-i)*(t.center.x-i)+(t.center.y-e)*(t.center.y-e)<=t.radius*t.radius},separateCircle:function(t,e,i){this.getOverlapX(t,e),this.getOverlapY(t,e);var n=e.center.x-t.center.x,r=e.center.y-t.center.y,s=Math.atan2(r,n),o=0;if(t.isCircle!==e.isCircle?(a={x:(e.isCircle?t:e).position.x,y:(e.isCircle?t:e).position.y,right:(e.isCircle?t:e).right,bottom:(e.isCircle?t:e).bottom},(l={x:t.isCircle?t.position.x+t.radius:e.position.x+e.radius,y:t.isCircle?t.position.y+t.radius:e.position.y+e.radius,radius:(t.isCircle?t:e).radius}).y<a.y?l.x<a.x?o=U.Math.distance(l.x,l.y,a.x,a.y)-l.radius:a.right<l.x&&(o=U.Math.distance(l.x,l.y,a.right,a.y)-l.radius):a.bottom<l.y&&(l.x<a.x?o=U.Math.distance(l.x,l.y,a.x,a.bottom)-l.radius:a.right<l.x&&(o=U.Math.distance(l.x,l.y,a.right,a.bottom)-l.radius)),o*=-1):o=t.radius+e.radius-U.Math.distance(t.center.x,t.center.y,e.center.x,e.center.y),i||0===o||t.immovable&&e.immovable||t.customSeparateX||e.customSeparateX)return 0!==o&&(t.onOverlap&&t.onOverlap.dispatch(t.sprite,e.sprite),e.onOverlap&&e.onOverlap.dispatch(e.sprite,t.sprite)),0!==o;var r=t.velocity.x*Math.cos(s)+t.velocity.y*Math.sin(s),n=t.velocity.x*Math.sin(s)-t.velocity.y*Math.cos(s),a=e.velocity.x*Math.cos(s)+e.velocity.y*Math.sin(s),l=e.velocity.x*Math.sin(s)-e.velocity.y*Math.cos(s),i=((t.mass-e.mass)*r+2*e.mass*a)/(t.mass+e.mass),a=(2*t.mass*r+(e.mass-t.mass)*a)/(t.mass+e.mass);return t.immovable||(t.velocity.x=(i*Math.cos(s)-n*Math.sin(s))*t.bounce.x,t.velocity.y=(n*Math.cos(s)+i*Math.sin(s))*t.bounce.y),e.immovable||(e.velocity.x=(a*Math.cos(s)-l*Math.sin(s))*e.bounce.x,e.velocity.y=(l*Math.cos(s)+a*Math.sin(s))*e.bounce.y),Math.abs(s)<Math.PI/2?0<t.velocity.x&&!t.immovable&&e.velocity.x>t.velocity.x?t.velocity.x*=-1:e.velocity.x<0&&!e.immovable&&t.velocity.x<e.velocity.x?e.velocity.x*=-1:0<t.velocity.y&&!t.immovable&&e.velocity.y>t.velocity.y?t.velocity.y*=-1:e.velocity.y<0&&!e.immovable&&t.velocity.y<e.velocity.y&&(e.velocity.y*=-1):Math.abs(s)>Math.PI/2&&(t.velocity.x<0&&!t.immovable&&e.velocity.x<t.velocity.x?t.velocity.x*=-1:0<e.velocity.x&&!e.immovable&&t.velocity.x>e.velocity.x?e.velocity.x*=-1:t.velocity.y<0&&!t.immovable&&e.velocity.y<t.velocity.y?t.velocity.y*=-1:0<e.velocity.y&&!e.immovable&&t.velocity.x>e.velocity.y&&(e.velocity.y*=-1)),t.immovable||(t.x+=t.velocity.x*this.game.time.physicsElapsed-o*Math.cos(s),t.y+=t.velocity.y*this.game.time.physicsElapsed-o*Math.sin(s)),e.immovable||(e.x+=e.velocity.x*this.game.time.physicsElapsed+o*Math.cos(s),e.y+=e.velocity.y*this.game.time.physicsElapsed+o*Math.sin(s)),t.onCollide&&t.onCollide.dispatch(t.sprite,e.sprite),e.onCollide&&e.onCollide.dispatch(e.sprite,t.sprite),!0},getOverlapX:function(t,e,i){var n=0,r=t.deltaAbsX()+e.deltaAbsX()+this.OVERLAP_BIAS;return 0===t.deltaX()&&0===e.deltaX()?(t.embedded=!0,e.embedded=!0):t.deltaX()>e.deltaX()?r<(n=t.right-e.x)&&!i||!1===t.checkCollision.right||!1===e.checkCollision.left?n=0:(t.touching.none=!1,t.touching.right=!0,e.touching.none=!1,e.touching.left=!0):t.deltaX()<e.deltaX()&&(r<-(n=t.x-e.width-e.x)&&!i||!1===t.checkCollision.left||!1===e.checkCollision.right?n=0:(t.touching.none=!1,t.touching.left=!0,e.touching.none=!1,e.touching.right=!0)),t.overlapX=n,e.overlapX=n},getOverlapY:function(t,e,i){var n=0,r=t.deltaAbsY()+e.deltaAbsY()+this.OVERLAP_BIAS;return 0===t.deltaY()&&0===e.deltaY()?(t.embedded=!0,e.embedded=!0):t.deltaY()>e.deltaY()?r<(n=t.bottom-e.y)&&!i||!1===t.checkCollision.down||!1===e.checkCollision.up?n=0:(t.touching.none=!1,t.touching.down=!0,e.touching.none=!1,e.touching.up=!0):t.deltaY()<e.deltaY()&&(r<-(n=t.y-e.bottom)&&!i||!1===t.checkCollision.up||!1===e.checkCollision.down?n=0:(t.touching.none=!1,t.touching.up=!0,e.touching.none=!1,e.touching.down=!0)),t.overlapY=n,e.overlapY=n},separateX:function(t,e,i){var n=this.getOverlapX(t,e,i);if(i||0===n||t.immovable&&e.immovable||t.customSeparateX||e.customSeparateX)return 0!==n||t.embedded&&e.embedded;var r=t.velocity.x,i=e.velocity.x;return t.immovable||e.immovable?t.immovable?(e.x+=n,e.velocity.x=r-i*e.bounce.x,t.moves&&(e.y+=(t.y-t.prev.y)*t.friction.y)):(t.x-=n,t.velocity.x=i-r*t.bounce.x,e.moves&&(t.y+=(e.y-e.prev.y)*e.friction.y)):(n*=.5,t.x-=n,e.x+=n,n=Math.sqrt(i*i*e.mass/t.mass)*(0<i?1:-1),n-=r=.5*(n+(i=Math.sqrt(r*r*t.mass/e.mass)*(0<r?1:-1))),i-=r,t.velocity.x=r+n*t.bounce.x,e.velocity.x=r+i*e.bounce.x),!0},separateY:function(t,e,i){var n=this.getOverlapY(t,e,i);if(i||0===n||t.immovable&&e.immovable||t.customSeparateY||e.customSeparateY)return 0!==n||t.embedded&&e.embedded;var r=t.velocity.y,i=e.velocity.y;return t.immovable||e.immovable?t.immovable?(e.y+=n,e.velocity.y=r-i*e.bounce.y,t.moves&&(e.x+=(t.x-t.prev.x)*t.friction.x)):(t.y-=n,t.velocity.y=i-r*t.bounce.y,e.moves&&(t.x+=(e.x-e.prev.x)*e.friction.x)):(n*=.5,t.y-=n,e.y+=n,n=Math.sqrt(i*i*e.mass/t.mass)*(0<i?1:-1),n-=r=.5*(n+(i=Math.sqrt(r*r*t.mass/e.mass)*(0<r?1:-1))),i-=r,t.velocity.y=r+n*t.bounce.y,e.velocity.y=r+i*e.bounce.y),!0},getObjectsUnderPointer:function(t,e,i,n){if(0!==e.length&&t.exists)return this.getObjectsAtLocation(t.x,t.y,e,i,n,t)},getObjectsAtLocation:function(t,e,i,n,r,s){this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(i);for(var i=new U.Rectangle(t,e,1,1),o=[],a=this.quadTree.retrieve(i),l=0;l<a.length;l++)a[l].hitTest(t,e)&&(n&&n.call(r,s,a[l].sprite),o.push(a[l].sprite));return o},moveToObject:function(t,e,i,n){void 0===i&&(i=60),void 0===n&&(n=0);var r=Math.atan2(e.y-t.y,e.x-t.x);return 0<n&&(i=this.distanceBetween(t,e)/(n/1e3)),t.body.velocity.x=Math.cos(r)*i,t.body.velocity.y=Math.sin(r)*i,r},moveToPointer:function(t,e,i,n){void 0===e&&(e=60),i=i||this.game.input.activePointer,void 0===n&&(n=0);var r=this.angleToPointer(t,i);return 0<n&&(e=this.distanceToPointer(t,i)/(n/1e3)),t.body.velocity.x=Math.cos(r)*e,t.body.velocity.y=Math.sin(r)*e,r},moveToXY:function(t,e,i,n,r){void 0===n&&(n=60),void 0===r&&(r=0);var s=Math.atan2(i-t.y,e-t.x);return 0<r&&(n=this.distanceToXY(t,e,i)/(r/1e3)),t.body.velocity.x=Math.cos(s)*n,t.body.velocity.y=Math.sin(s)*n,s},velocityFromAngle:function(t,e,i){return void 0===e&&(e=60),(i=i||new U.Point).setTo(Math.cos(this.game.math.degToRad(t))*e,Math.sin(this.game.math.degToRad(t))*e)},velocityFromRotation:function(t,e,i){return void 0===e&&(e=60),(i=i||new U.Point).setTo(Math.cos(t)*e,Math.sin(t)*e)},accelerationFromRotation:function(t,e,i){return void 0===e&&(e=60),(i=i||new U.Point).setTo(Math.cos(t)*e,Math.sin(t)*e)},accelerateToObject:function(t,e,i,n,r){void 0===i&&(i=60),void 0===n&&(n=1e3),void 0===r&&(r=1e3);e=this.angleBetween(t,e);return t.body.acceleration.setTo(Math.cos(e)*i,Math.sin(e)*i),t.body.maxVelocity.setTo(n,r),e},accelerateToPointer:function(t,e,i,n,r){void 0===i&&(i=60),void 0===e&&(e=this.game.input.activePointer),void 0===n&&(n=1e3),void 0===r&&(r=1e3);e=this.angleToPointer(t,e);return t.body.acceleration.setTo(Math.cos(e)*i,Math.sin(e)*i),t.body.maxVelocity.setTo(n,r),e},accelerateToXY:function(t,e,i,n,r,s){void 0===n&&(n=60),void 0===r&&(r=1e3),void 0===s&&(s=1e3);i=this.angleToXY(t,e,i);return t.body.acceleration.setTo(Math.cos(i)*n,Math.sin(i)*n),t.body.maxVelocity.setTo(r,s),i},distanceBetween:function(t,e,i){void 0===i&&(i=!1);var n=i?t.world.x-e.world.x:t.x-e.x,e=i?t.world.y-e.world.y:t.y-e.y;return Math.sqrt(n*n+e*e)},distanceToXY:function(t,e,i,n){void 0===n&&(n=!1);e=n?t.world.x-e:t.x-e,i=n?t.world.y-i:t.y-i;return Math.sqrt(e*e+i*i)},distanceToPointer:function(t,e,i){void 0===e&&(e=this.game.input.activePointer),void 0===i&&(i=!1);var n=i?t.world.x-e.worldX:t.x-e.worldX,e=i?t.world.y-e.worldY:t.y-e.worldY;return Math.sqrt(n*n+e*e)},angleBetween:function(t,e,i){return void 0===i&&(i=!1),i?Math.atan2(e.world.y-t.world.y,e.world.x-t.world.x):Math.atan2(e.y-t.y,e.x-t.x)},angleBetweenCenters:function(t,e){var i=e.centerX-t.centerX,t=e.centerY-t.centerY;return Math.atan2(t,i)},angleToXY:function(t,e,i,n){return void 0===n&&(n=!1),n?Math.atan2(i-t.world.y,e-t.world.x):Math.atan2(i-t.y,e-t.x)},angleToPointer:function(t,e,i){return void 0===e&&(e=this.game.input.activePointer),void 0===i&&(i=!1),i?Math.atan2(e.worldY-t.world.y,e.worldX-t.world.x):Math.atan2(e.worldY-t.y,e.worldX-t.x)},worldAngleToPointer:function(t,e){return this.angleToPointer(t,e,!0)}},U.Physics.Arcade.Body=function(t){this.sprite=t,this.game=t.game,this.type=U.Physics.ARCADE,this.enable=!0,this.isCircle=!1,this.radius=0,this.offset=new U.Point,this.position=new U.Point(t.x,t.y),this.prev=new U.Point(this.position.x,this.position.y),this.allowRotation=!0,this.rotation=t.angle,this.preRotation=t.angle,this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height,t.texture&&(this.sourceWidth=t.texture.frame.width,this.sourceHeight=t.texture.frame.height),this.halfWidth=Math.abs(t.width/2),this.halfHeight=Math.abs(t.height/2),this.center=new U.Point(t.x+this.halfWidth,t.y+this.halfHeight),this.velocity=new U.Point,this.newVelocity=new U.Point,this.deltaMax=new U.Point,this.acceleration=new U.Point,this.drag=new U.Point,this.allowGravity=!0,this.gravity=new U.Point,this.bounce=new U.Point,this.worldBounce=null,this.onWorldBounds=null,this.onCollide=null,this.onOverlap=null,this.maxVelocity=new U.Point(1e4,1e4),this.friction=new U.Point(1,0),this.angularVelocity=0,this.angularAcceleration=0,this.angularDrag=0,this.maxAngular=1e3,this.mass=1,this.angle=0,this.speed=0,this.facing=U.NONE,this.immovable=!1,this.moves=!0,this.customSeparateX=!1,this.customSeparateY=!1,this.overlapX=0,this.overlapY=0,this.overlapR=0,this.embedded=!1,this.collideWorldBounds=!1,this.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0},this.touching={none:!0,up:!1,down:!1,left:!1,right:!1},this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1},this.blocked={up:!1,down:!1,left:!1,right:!1},this.tilePadding=new U.Point,this.dirty=!1,this.skipQuadTree=!1,this.syncBounds=!1,this.isMoving=!1,this.stopVelocityOnCollide=!0,this.moveTimer=0,this.moveDistance=0,this.moveDuration=0,this.moveTarget=null,this.moveEnd=null,this.onMoveComplete=new U.Signal,this.movementCallback=null,this.movementCallbackContext=null,this._reset=!0,this._sx=t.scale.x,this._sy=t.scale.y,this._dx=0,this._dy=0},U.Physics.Arcade.Body.prototype={updateBounds:function(){var t,e;this.syncBounds?((e=this.sprite.getBounds()).ceilAll(),e.width===this.width&&e.height===this.height||(this.width=e.width,this.height=e.height,this._reset=!0)):(t=Math.abs(this.sprite.scale.x),e=Math.abs(this.sprite.scale.y),t===this._sx&&e===this._sy||(this.width=this.sourceWidth*t,this.height=this.sourceHeight*e,this._sx=t,this._sy=e,this._reset=!0)),this._reset&&(this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight))},preUpdate:function(){this.enable&&!this.game.physics.arcade.isPaused&&(this.dirty=!0,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.world.x-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x,this.position.x-=this.sprite.scale.x<0?this.width:0,this.position.y=this.sprite.world.y-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y,this.position.y-=this.sprite.scale.y<0?this.height:0,this.rotation=this.sprite.angle,this.preRotation=this.rotation,(this._reset||this.sprite.fresh)&&(this.prev.x=this.position.x,this.prev.y=this.position.y),this.moves&&(this.game.physics.arcade.updateMotion(this),this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,this.position.x===this.prev.x&&this.position.y===this.prev.y||(this.angle=Math.atan2(this.velocity.y,this.velocity.x)),this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.collideWorldBounds&&this.checkWorldBounds()&&this.onWorldBounds&&this.onWorldBounds.dispatch(this.sprite,this.blocked.up,this.blocked.down,this.blocked.left,this.blocked.right)),this._dx=this.deltaX(),this._dy=this.deltaY(),this._reset=!1)},updateMovement:function(){var t,e=0,i=0!==this.overlapX||0!==this.overlapY,e=0<this.moveDuration?(this.moveTimer+=this.game.time.elapsedMS,this.moveTimer/this.moveDuration):(this.moveTarget.end.set(this.position.x,this.position.y),this.moveTarget.length/this.moveDistance);return this.movementCallback&&(t=this.movementCallback.call(this.movementCallbackContext,this,this.velocity,e)),!(i||1<=e||void 0!==t&&!0!==t)||(this.stopMovement(1<=e||this.stopVelocityOnCollide&&i),!1)},stopMovement:function(t){this.isMoving&&(this.isMoving=!1,t&&this.velocity.set(0),this.onMoveComplete.dispatch(this.sprite,0!==this.overlapX||0!==this.overlapY))},postUpdate:function(){this.enable&&this.dirty&&(this.isMoving&&this.updateMovement(),this.dirty=!1,this.deltaX()<0?this.facing=U.LEFT:0<this.deltaX()&&(this.facing=U.RIGHT),this.deltaY()<0?this.facing=U.UP:0<this.deltaY()&&(this.facing=U.DOWN),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),0!==this.deltaMax.x&&0!==this._dx&&(this._dx<0&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:0<this._dx&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),0!==this.deltaMax.y&&0!==this._dy&&(this._dy<0&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:0<this._dy&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),this.sprite.position.x+=this._dx,this.sprite.position.y+=this._dy,this._reset=!0),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.allowRotation&&(this.sprite.angle+=this.deltaZ()),this.prev.x=this.position.x,this.prev.y=this.position.y)},checkWorldBounds:function(){var t,e,i,n,r=this.position,s=this.game.physics.arcade.bounds,o=this.game.physics.arcade.checkCollision,a=this.worldBounce?-this.worldBounce.x:-this.bounce.x,l=this.worldBounce?-this.worldBounce.y:-this.bounce.y;return this.isCircle?(t=this.center.x-this.radius,e=this.center.y-this.radius,i=this.center.x+this.radius,n=this.center.y+this.radius,t<s.x&&o.left?(r.x=s.x-this.halfWidth+this.radius,this.velocity.x*=a,this.blocked.left=!0):i>s.right&&o.right&&(r.x=s.right-this.halfWidth-this.radius,this.velocity.x*=a,this.blocked.right=!0),e<s.y&&o.up?(r.y=s.y-this.halfHeight+this.radius,this.velocity.y*=l,this.blocked.up=!0):n>s.bottom&&o.down&&(r.y=s.bottom-this.halfHeight-this.radius,this.velocity.y*=l,this.blocked.down=!0)):(r.x<s.x&&o.left?(r.x=s.x,this.velocity.x*=a,this.blocked.left=!0):this.right>s.right&&o.right&&(r.x=s.right-this.width,this.velocity.x*=a,this.blocked.right=!0),r.y<s.y&&o.up?(r.y=s.y,this.velocity.y*=l,this.blocked.up=!0):this.bottom>s.bottom&&o.down&&(r.y=s.bottom-this.height,this.velocity.y*=l,this.blocked.down=!0)),this.blocked.up||this.blocked.down||this.blocked.left||this.blocked.right},moveFrom:function(t,e,i){return void 0===e&&(e=this.speed),0!==e&&(void 0===i?(n=this.angle,i=this.game.math.radToDeg(n)):n=this.game.math.degToRad(i),this.moveTimer=0,this.moveDuration=t,0===i||180===i?this.velocity.set(Math.cos(n)*e,0):90===i||270===i?this.velocity.set(0,Math.sin(n)*e):this.velocity.set(Math.cos(n)*e,Math.sin(n)*e),this.isMoving=!0);var n},moveTo:function(t,e,i){var n,t=e/(t/1e3);return 0!=t&&(void 0===i?(n=this.angle,i=this.game.math.radToDeg(n)):n=this.game.math.degToRad(i),e=Math.abs(e),this.moveDuration=0,this.moveDistance=e,null===this.moveTarget&&(this.moveTarget=new U.Line,this.moveEnd=new U.Point),this.moveTarget.fromAngle(this.x,this.y,n,e),this.moveEnd.set(this.moveTarget.end.x,this.moveTarget.end.y),this.moveTarget.setTo(this.x,this.y,this.x,this.y),0===i||180===i?this.velocity.set(Math.cos(n)*t,0):90===i||270===i?this.velocity.set(0,Math.sin(n)*t):this.velocity.set(Math.cos(n)*t,Math.sin(n)*t),this.isMoving=!0)},setSize:function(t,e,i,n){void 0===i&&(i=this.offset.x),void 0===n&&(n=this.offset.y),this.sourceWidth=t,this.sourceHeight=e,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.setTo(i,n),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.isCircle=!1,this.radius=0},setCircle:function(t,e,i){void 0===e&&(e=this.offset.x),void 0===i&&(i=this.offset.y),0<t?(this.isCircle=!0,this.radius=t,this.sourceWidth=2*t,this.sourceHeight=2*t,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.setTo(e,i),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)):this.isCircle=!1},reset:function(t,e){this.velocity.set(0),this.acceleration.set(0),this.speed=0,this.angularVelocity=0,this.angularAcceleration=0,this.position.x=t-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x,this.position.x-=this.sprite.scale.x<0?this.width:0,this.position.y=e-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y,this.position.y-=this.sprite.scale.y<0?this.height:0,this.prev.x=this.position.x,this.prev.y=this.position.y,this.rotation=this.sprite.angle,this.preRotation=this.rotation,this._sx=this.sprite.scale.x,this._sy=this.sprite.scale.y,this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},getBounds:function(t){return this.isCircle?(t.x=this.center.x-this.radius,t.y=this.center.y-this.radius,t.right=this.center.x+this.radius,t.bottom=this.center.y+this.radius):(t.x=this.x,t.y=this.y,t.right=this.right,t.bottom=this.bottom),t},hitTest:function(t,e){return(this.isCircle?U.Circle:U.Rectangle).contains(this,t,e)},onFloor:function(){return this.blocked.down},onCeiling:function(){return this.blocked.up},onWall:function(){return this.blocked.left||this.blocked.right},deltaAbsX:function(){return 0<this.deltaX()?this.deltaX():-this.deltaX()},deltaAbsY:function(){return 0<this.deltaY()?this.deltaY():-this.deltaY()},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation},destroy:function(){this.sprite.parent&&this.sprite.parent instanceof U.Group&&this.sprite.parent.removeFromHash(this.sprite),this.sprite.body=null,this.sprite=null}},Object.defineProperty(U.Physics.Arcade.Body.prototype,"left",{get:function(){return this.position.x}}),Object.defineProperty(U.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}}),Object.defineProperty(U.Physics.Arcade.Body.prototype,"top",{get:function(){return this.position.y}}),Object.defineProperty(U.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}}),Object.defineProperty(U.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(U.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),U.Physics.Arcade.Body.render=function(t,e,i,n){void 0===n&&(n=!0),i=i||"rgba(0,255,0,0.4)",t.fillStyle=i,t.strokeStyle=i,e.isCircle?(t.beginPath(),t.arc(e.center.x-e.game.camera.x,e.center.y-e.game.camera.y,e.radius,0,2*Math.PI),n?t.fill():t.stroke()):n?t.fillRect(e.position.x-e.game.camera.x,e.position.y-e.game.camera.y,e.width,e.height):t.strokeRect(e.position.x-e.game.camera.x,e.position.y-e.game.camera.y,e.width,e.height)},U.Physics.Arcade.Body.renderBodyInfo=function(t,e){t.line("x: "+e.x.toFixed(2),"y: "+e.y.toFixed(2),"width: "+e.width,"height: "+e.height),t.line("velocity x: "+e.velocity.x.toFixed(2),"y: "+e.velocity.y.toFixed(2),"deltaX: "+e._dx.toFixed(2),"deltaY: "+e._dy.toFixed(2)),t.line("acceleration x: "+e.acceleration.x.toFixed(2),"y: "+e.acceleration.y.toFixed(2),"speed: "+e.speed.toFixed(2),"angle: "+e.angle.toFixed(2)),t.line("gravity x: "+e.gravity.x,"y: "+e.gravity.y,"bounce x: "+e.bounce.x.toFixed(2),"y: "+e.bounce.y.toFixed(2)),t.line("touching left: "+e.touching.left,"right: "+e.touching.right,"up: "+e.touching.up,"down: "+e.touching.down),t.line("blocked left: "+e.blocked.left,"right: "+e.blocked.right,"up: "+e.blocked.up,"down: "+e.blocked.down)},U.Physics.Arcade.Body.prototype.constructor=U.Physics.Arcade.Body,U.Physics.Arcade.TilemapCollision=function(){},U.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(t,e,i,n,r,s){if(t.body){var o=e.getTiles(t.body.position.x-t.body.tilePadding.x,t.body.position.y-t.body.tilePadding.y,t.body.width+t.body.tilePadding.x,t.body.height+t.body.tilePadding.y,!1,!1);if(0!==o.length)for(var a=0;a<o.length;a++)n?n.call(r,t,o[a])&&this.separateTile(a,t.body,o[a],e,s)&&(this._total++,i&&i.call(r,t,o[a])):this.separateTile(a,t.body,o[a],e,s)&&(this._total++,i&&i.call(r,t,o[a]))}},collideGroupVsTilemapLayer:function(t,e,i,n,r,s){if(0!==t.length)for(var o=0;o<t.children.length;o++)t.children[o].exists&&this.collideSpriteVsTilemapLayer(t.children[o],e,i,n,r,s)},separateTile:function(t,e,i,n,r){if(!e.enable)return!1;var s=n.fixedToCamera?0:n.position.x,o=n.fixedToCamera?0:n.position.y;if(!i.intersects(e.position.x-s,e.position.y-o,e.right-s,e.bottom-o))return!1;if(r)return!0;if(i.collisionCallback&&!i.collisionCallback.call(i.collisionCallbackContext,e.sprite,i))return!1;if(void 0!==i.layer.callbacks&&i.layer.callbacks[i.index]&&!i.layer.callbacks[i.index].callback.call(i.layer.callbacks[i.index].callbackContext,e.sprite,i))return!1;if(!(i.faceLeft||i.faceRight||i.faceTop||i.faceBottom))return!1;var a=0,l=0,p=0,r=1;if(e.deltaAbsX()>e.deltaAbsY()?p=-1:e.deltaAbsX()<e.deltaAbsY()&&(r=-1),0!==e.deltaX()&&0!==e.deltaY()&&(i.faceLeft||i.faceRight)&&(i.faceTop||i.faceBottom)&&(p=Math.min(Math.abs(e.position.x-s-i.right),Math.abs(e.right-s-i.left)),r=Math.min(Math.abs(e.position.y-o-i.bottom),Math.abs(e.bottom-o-i.top))),p<r){if((i.faceLeft||i.faceRight)&&0!==(a=this.tileCheckX(e,i,n))&&!i.intersects(e.position.x-s,e.position.y-o,e.right-s,e.bottom-o))return!0;(i.faceTop||i.faceBottom)&&(l=this.tileCheckY(e,i,n))}else{if((i.faceTop||i.faceBottom)&&0!==(l=this.tileCheckY(e,i,n))&&!i.intersects(e.position.x-s,e.position.y-o,e.right-s,e.bottom-o))return!0;(i.faceLeft||i.faceRight)&&(a=this.tileCheckX(e,i,n))}return 0!==a||0!==l},tileCheckX:function(t,e,i){var n=0,i=i.fixedToCamera?0:i.position.x;return t.deltaX()<0&&!t.blocked.left&&e.collideRight&&t.checkCollision.left?e.faceRight&&t.x-i<e.right&&(n=t.x-i-e.right)<-this.TILE_BIAS&&(n=0):0<t.deltaX()&&!t.blocked.right&&e.collideLeft&&t.checkCollision.right&&e.faceLeft&&t.right-i>e.left&&(n=t.right-i-e.left)>this.TILE_BIAS&&(n=0),0!==n&&(t.customSeparateX?t.overlapX=n:this.processTileSeparationX(t,n)),n},tileCheckY:function(t,e,i){var n=0,i=i.fixedToCamera?0:i.position.y;return t.deltaY()<0&&!t.blocked.up&&e.collideDown&&t.checkCollision.up?e.faceBottom&&t.y-i<e.bottom&&(n=t.y-i-e.bottom)<-this.TILE_BIAS&&(n=0):0<t.deltaY()&&!t.blocked.down&&e.collideUp&&t.checkCollision.down&&e.faceTop&&t.bottom-i>e.top&&(n=t.bottom-i-e.top)>this.TILE_BIAS&&(n=0),0!==n&&(t.customSeparateY?t.overlapY=n:this.processTileSeparationY(t,n)),n},processTileSeparationX:function(t,e){e<0?t.blocked.left=!0:0<e&&(t.blocked.right=!0),t.position.x-=e,0===t.bounce.x?t.velocity.x=0:t.velocity.x=-t.velocity.x*t.bounce.x},processTileSeparationY:function(t,e){e<0?t.blocked.up=!0:0<e&&(t.blocked.down=!0),t.position.y-=e,0===t.bounce.y?t.velocity.y=0:t.velocity.y=-t.velocity.y*t.bounce.y}},U.Utils.mixinPrototype(U.Physics.Arcade.prototype,U.Physics.Arcade.TilemapCollision.prototype),p2.Body.prototype.parent=null,p2.Spring.prototype.parent=null,U.Physics.P2=function(t,e){this.game=t,void 0===e?e={gravity:[0,0],broadphase:new p2.SAPBroadphase}:(e.hasOwnProperty("gravity")||(e.gravity=[0,0]),e.hasOwnProperty("broadphase")||(e.broadphase=new p2.SAPBroadphase)),this.config=e,this.world=new p2.World(this.config),this.frameRate=1/60,this.useElapsedTime=!1,this.paused=!1,this.materials=[],this.gravity=new U.Physics.P2.InversePointProxy(this,this.world.gravity),this.walls={left:null,right:null,top:null,bottom:null},this.onBodyAdded=new U.Signal,this.onBodyRemoved=new U.Signal,this.onSpringAdded=new U.Signal,this.onSpringRemoved=new U.Signal,this.onConstraintAdded=new U.Signal,this.onConstraintRemoved=new U.Signal,this.onContactMaterialAdded=new U.Signal,this.onContactMaterialRemoved=new U.Signal,this.postBroadphaseCallback=null,this.callbackContext=null,this.onBeginContact=new U.Signal,this.onEndContact=new U.Signal,e.hasOwnProperty("mpx")&&e.hasOwnProperty("pxm")&&e.hasOwnProperty("mpxi")&&e.hasOwnProperty("pxmi")&&(this.mpx=e.mpx,this.mpxi=e.mpxi,this.pxm=e.pxm,this.pxmi=e.pxmi),this.world.on("beginContact",this.beginContactHandler,this),this.world.on("endContact",this.endContactHandler,this),this.collisionGroups=[],this.nothingCollisionGroup=new U.Physics.P2.CollisionGroup(1),this.boundsCollisionGroup=new U.Physics.P2.CollisionGroup(2),this.everythingCollisionGroup=new U.Physics.P2.CollisionGroup(2147483648),this.boundsCollidesWith=[],this._toRemove=[],this._collisionGroupID=2,this._boundsLeft=!0,this._boundsRight=!0,this._boundsTop=!0,this._boundsBottom=!0,this._boundsOwnGroup=!1,this.setBoundsToWorld(!0,!0,!0,!0,!1)},U.Physics.P2.prototype={removeBodyNextStep:function(t){this._toRemove.push(t)},preUpdate:function(){for(var t=this._toRemove.length;t--;)this.removeBody(this._toRemove[t]);this._toRemove.length=0},enable:function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!0);var n=1;if(Array.isArray(t))for(n=t.length;n--;)t[n]instanceof U.Group?this.enable(t[n].children,e,i):(this.enableBody(t[n],e),i&&t[n].hasOwnProperty("children")&&0<t[n].children.length&&this.enable(t[n],e,!0));else t instanceof U.Group?this.enable(t.children,e,i):(this.enableBody(t,e),i&&t.hasOwnProperty("children")&&0<t.children.length&&this.enable(t.children,e,!0))},enableBody:function(t,e){t.hasOwnProperty("body")&&null===t.body&&(t.body=new U.Physics.P2.Body(this.game,t,t.x,t.y,1),t.body.debug=e,void 0!==t.anchor&&t.anchor.set(.5))},setImpactEvents:function(t){t?this.world.on("impact",this.impactHandler,this):this.world.off("impact",this.impactHandler,this)},setPostBroadphaseCallback:function(t,e){this.postBroadphaseCallback=t,this.callbackContext=e,null!==t?this.world.on("postBroadphase",this.postBroadphaseHandler,this):this.world.off("postBroadphase",this.postBroadphaseHandler,this)},postBroadphaseHandler:function(t){if(this.postBroadphaseCallback&&0!==t.pairs.length)for(var e=t.pairs.length-2;0<=e;e-=2)t.pairs[e].parent&&t.pairs[e+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,t.pairs[e].parent,t.pairs[e+1].parent)&&t.pairs.splice(e,2)},impactHandler:function(t){var e,i;t.bodyA.parent&&t.bodyB.parent&&(e=t.bodyA.parent,i=t.bodyB.parent,e._bodyCallbacks[t.bodyB.id]&&e._bodyCallbacks[t.bodyB.id].call(e._bodyCallbackContext[t.bodyB.id],e,i,t.shapeA,t.shapeB),i._bodyCallbacks[t.bodyA.id]&&i._bodyCallbacks[t.bodyA.id].call(i._bodyCallbackContext[t.bodyA.id],i,e,t.shapeB,t.shapeA),e._groupCallbacks[t.shapeB.collisionGroup]&&e._groupCallbacks[t.shapeB.collisionGroup].call(e._groupCallbackContext[t.shapeB.collisionGroup],e,i,t.shapeA,t.shapeB),i._groupCallbacks[t.shapeA.collisionGroup]&&i._groupCallbacks[t.shapeA.collisionGroup].call(i._groupCallbackContext[t.shapeA.collisionGroup],i,e,t.shapeB,t.shapeA))},beginContactHandler:function(t){t.bodyA&&t.bodyB&&(this.onBeginContact.dispatch(t.bodyA,t.bodyB,t.shapeA,t.shapeB,t.contactEquations),t.bodyA.parent&&t.bodyA.parent.onBeginContact.dispatch(t.bodyB.parent,t.bodyB,t.shapeA,t.shapeB,t.contactEquations),t.bodyB.parent&&t.bodyB.parent.onBeginContact.dispatch(t.bodyA.parent,t.bodyA,t.shapeB,t.shapeA,t.contactEquations))},endContactHandler:function(t){t.bodyA&&t.bodyB&&(this.onEndContact.dispatch(t.bodyA,t.bodyB,t.shapeA,t.shapeB),t.bodyA.parent&&t.bodyA.parent.onEndContact.dispatch(t.bodyB.parent,t.bodyB,t.shapeA,t.shapeB),t.bodyB.parent&&t.bodyB.parent.onEndContact.dispatch(t.bodyA.parent,t.bodyA,t.shapeB,t.shapeA))},setBoundsToWorld:function(t,e,i,n,r){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,t,e,i,n,r)},setWorldMaterial:function(t,e,i,n,r){void 0===e&&(e=!0),void 0===i&&(i=!0),void 0===n&&(n=!0),void 0===r&&(r=!0),e&&this.walls.left&&(this.walls.left.shapes[0].material=t),i&&this.walls.right&&(this.walls.right.shapes[0].material=t),n&&this.walls.top&&(this.walls.top.shapes[0].material=t),r&&this.walls.bottom&&(this.walls.bottom.shapes[0].material=t)},updateBoundsCollisionGroup:function(t){void 0===t&&(t=!0);var e=(t?this.boundsCollisionGroup:this.everythingCollisionGroup).mask;this.walls.left&&(this.walls.left.shapes[0].collisionGroup=e),this.walls.right&&(this.walls.right.shapes[0].collisionGroup=e),this.walls.top&&(this.walls.top.shapes[0].collisionGroup=e),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionGroup=e),this._boundsOwnGroup=t},setBounds:function(t,e,i,n,r,s,o,a,l){void 0===r&&(r=this._boundsLeft),void 0===s&&(s=this._boundsRight),void 0===o&&(o=this._boundsTop),void 0===a&&(a=this._boundsBottom),void 0===l&&(l=this._boundsOwnGroup),this.setupWall(r,"left",t,e,1.5707963267948966,l),this.setupWall(s,"right",t+i,e,-1.5707963267948966,l),this.setupWall(o,"top",t,e,-3.141592653589793,l),this.setupWall(a,"bottom",t,e+n,0,l),this._boundsLeft=r,this._boundsRight=s,this._boundsTop=o,this._boundsBottom=a,this._boundsOwnGroup=l},setupWall:function(t,e,i,n,r,s){t?(this.walls[e]?this.walls[e].position=[this.pxmi(i),this.pxmi(n)]:(this.walls[e]=new p2.Body({mass:0,position:[this.pxmi(i),this.pxmi(n)],angle:r}),this.walls[e].addShape(new p2.Plane),this.world.addBody(this.walls[e])),s&&(this.walls[e].shapes[0].collisionGroup=this.boundsCollisionGroup.mask)):this.walls[e]&&(this.world.removeBody(this.walls[e]),this.walls[e]=null)},pause:function(){this.paused=!0},resume:function(){this.paused=!1},update:function(){this.paused||(this.useElapsedTime?this.world.step(this.game.time.physicsElapsed):this.world.step(this.frameRate))},reset:function(){this.world.on("beginContact",this.beginContactHandler,this),this.world.on("endContact",this.endContactHandler,this),this.nothingCollisionGroup=new U.Physics.P2.CollisionGroup(1),this.boundsCollisionGroup=new U.Physics.P2.CollisionGroup(2),this.everythingCollisionGroup=new U.Physics.P2.CollisionGroup(2147483648),this._collisionGroupID=2,this.setBoundsToWorld(!0,!0,!0,!0,!1)},clear:function(){this.world.time=0,this.world.fixedStepTime=0,this.world.solver&&this.world.solver.equations.length&&this.world.solver.removeAllEquations();for(var t=this.world.constraints,e=t.length-1;0<=e;e--)this.world.removeConstraint(t[e]);for(var i=this.world.bodies,e=i.length-1;0<=e;e--)this.world.removeBody(i[e]);for(var n=this.world.springs,e=n.length-1;0<=e;e--)this.world.removeSpring(n[e]);for(var r=this.world.contactMaterials,e=r.length-1;0<=e;e--)this.world.removeContactMaterial(r[e]);this.world.off("beginContact",this.beginContactHandler,this),this.world.off("endContact",this.endContactHandler,this),this.postBroadphaseCallback=null,this.callbackContext=null,this.impactCallback=null,this.collisionGroups=[],this._toRemove=[],this.boundsCollidesWith=[],this.walls={left:null,right:null,top:null,bottom:null}},destroy:function(){this.clear(),this.game=null},addBody:function(t){return!t.data.world&&(this.world.addBody(t.data),this.onBodyAdded.dispatch(t),!0)},removeBody:function(t){return t.data.world===this.world&&(this.world.removeBody(t.data),this.onBodyRemoved.dispatch(t)),t},addSpring:function(t){return t instanceof U.Physics.P2.Spring||t instanceof U.Physics.P2.RotationalSpring?this.world.addSpring(t.data):this.world.addSpring(t),this.onSpringAdded.dispatch(t),t},removeSpring:function(t){return t instanceof U.Physics.P2.Spring||t instanceof U.Physics.P2.RotationalSpring?this.world.removeSpring(t.data):this.world.removeSpring(t),this.onSpringRemoved.dispatch(t),t},createDistanceConstraint:function(t,e,i,n,r,s){if(t=this.getBody(t),e=this.getBody(e),t&&e)return this.addConstraint(new U.Physics.P2.DistanceConstraint(this,t,e,i,n,r,s))},createGearConstraint:function(t,e,i,n){if(t=this.getBody(t),e=this.getBody(e),t&&e)return this.addConstraint(new U.Physics.P2.GearConstraint(this,t,e,i,n))},createRevoluteConstraint:function(t,e,i,n,r,s){if(t=this.getBody(t),i=this.getBody(i),t&&i)return this.addConstraint(new U.Physics.P2.RevoluteConstraint(this,t,e,i,n,r,s))},createLockConstraint:function(t,e,i,n,r){if(t=this.getBody(t),e=this.getBody(e),t&&e)return this.addConstraint(new U.Physics.P2.LockConstraint(this,t,e,i,n,r))},createPrismaticConstraint:function(t,e,i,n,r,s,o){if(t=this.getBody(t),e=this.getBody(e),t&&e)return this.addConstraint(new U.Physics.P2.PrismaticConstraint(this,t,e,i,n,r,s,o))},addConstraint:function(t){return this.world.addConstraint(t),this.onConstraintAdded.dispatch(t),t},removeConstraint:function(t){return this.world.removeConstraint(t),this.onConstraintRemoved.dispatch(t),t},addContactMaterial:function(t){return this.world.addContactMaterial(t),this.onContactMaterialAdded.dispatch(t),t},removeContactMaterial:function(t){return this.world.removeContactMaterial(t),this.onContactMaterialRemoved.dispatch(t),t},getContactMaterial:function(t,e){return this.world.getContactMaterial(t,e)},setMaterial:function(t,e){for(var i=e.length;i--;)e[i].setMaterial(t)},createMaterial:function(t,e){t=t||"";t=new U.Physics.P2.Material(t);return this.materials.push(t),void 0!==e&&e.setMaterial(t),t},createContactMaterial:function(t,e,i){void 0===t&&(t=this.createMaterial()),void 0===e&&(e=this.createMaterial());i=new U.Physics.P2.ContactMaterial(t,e,i);return this.addContactMaterial(i)},getBodies:function(){for(var t=[],e=this.world.bodies.length;e--;)t.push(this.world.bodies[e].parent);return t},getBody:function(t){return t instanceof p2.Body?t:t instanceof U.Physics.P2.Body?t.data:t.body&&t.body.type===U.Physics.P2JS?t.body.data:null},getSprings:function(){for(var t=[],e=this.world.springs.length;e--;)t.push(this.world.springs[e].parent);return t},getConstraints:function(){for(var t=[],e=this.world.constraints.length;e--;)t.push(this.world.constraints[e]);return t},hitTest:function(t,e,i,n){void 0===e&&(e=this.world.bodies),void 0===i&&(i=5),void 0===n&&(n=!1);for(var t=[this.pxmi(t.x),this.pxmi(t.y)],r=[],s=e.length;s--;)e[s]instanceof U.Physics.P2.Body&&(!n||e[s].data.type!==p2.Body.STATIC)?r.push(e[s].data):e[s]instanceof p2.Body&&e[s].parent&&(!n||e[s].type!==p2.Body.STATIC)?r.push(e[s]):e[s]instanceof U.Sprite&&e[s].hasOwnProperty("body")&&(!n||e[s].body.data.type!==p2.Body.STATIC)&&r.push(e[s].body.data);return this.world.hitTest(t,r,i)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(t){var e=Math.pow(2,this._collisionGroupID);this.walls.left&&(this.walls.left.shapes[0].collisionMask=this.walls.left.shapes[0].collisionMask|e),this.walls.right&&(this.walls.right.shapes[0].collisionMask=this.walls.right.shapes[0].collisionMask|e),this.walls.top&&(this.walls.top.shapes[0].collisionMask=this.walls.top.shapes[0].collisionMask|e),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionMask=this.walls.bottom.shapes[0].collisionMask|e),this._collisionGroupID++;e=new U.Physics.P2.CollisionGroup(e);return this.collisionGroups.push(e),t&&this.setCollisionGroup(t,e),e},setCollisionGroup:function(t,e){if(t instanceof U.Group)for(var i=0;i<t.total;i++)t.children[i].body&&t.children[i].body.type===U.Physics.P2JS&&t.children[i].body.setCollisionGroup(e);else t.body.setCollisionGroup(e)},createSpring:function(t,e,i,n,r,s,o,a,l){if(t=this.getBody(t),e=this.getBody(e),t&&e)return this.addSpring(new U.Physics.P2.Spring(this,t,e,i,n,r,s,o,a,l))},createRotationalSpring:function(t,e,i,n,r){if(t=this.getBody(t),e=this.getBody(e),t&&e)return this.addSpring(new U.Physics.P2.RotationalSpring(this,t,e,i,n,r))},createBody:function(t,e,i,n,r,s){void 0===n&&(n=!1);i=new U.Physics.P2.Body(this.game,null,t,e,i);return!(s&&!i.addPolygon(r,s))&&(n&&this.world.addBody(i.data),i)},createParticle:function(t,e,i,n,r,s){void 0===n&&(n=!1);i=new U.Physics.P2.Body(this.game,null,t,e,i);return!(s&&!i.addPolygon(r,s))&&(n&&this.world.addBody(i.data),i)},convertCollisionObjects:function(t,e,i){void 0===i&&(i=!0);for(var n=[],r=0,s=t.collision[e].length;r<s;r++){var o=t.collision[e][r],o=this.createBody(o.x,o.y,0,i,{},o.polyline);o&&n.push(o)}return n},clearTilemapLayerBodies:function(t,e){e=t.getLayer(e);for(var i=t.layers[e].bodies.length;i--;)t.layers[e].bodies[i].destroy();t.layers[e].bodies.length=0},convertTilemap:function(t,e,i,n){e=t.getLayer(e),void 0===i&&(i=!0),void 0===n&&(n=!0),this.clearTilemapLayerBodies(t,e);for(var r=0,s=0,o=0,a=0,l=t.layers[e].height;a<l;a++)for(var p=r=0,h=t.layers[e].width;p<h;p++){var u,c,d=t.layers[e].data[a][p];d&&-1<d.index&&d.collides&&(n?(u=t.getTileRight(e,p,a),0===r&&(s=d.x*d.width,o=d.y*d.height,r=d.width),u&&u.collides?r+=d.width:((c=this.createBody(s,o,0,!1)).addRectangle(r,d.height,r/2,d.height/2,0),i&&this.addBody(c),t.layers[e].bodies.push(c),r=0)):((c=this.createBody(d.x*d.width,d.y*d.height,0,!1)).addRectangle(d.width,d.height,d.width/2,d.height/2,0),i&&this.addBody(c),t.layers[e].bodies.push(c)))}return t.layers[e].bodies},mpx:function(t){return 20*t},pxm:function(t){return.05*t},mpxi:function(t){return-20*t},pxmi:function(t){return-.05*t}},Object.defineProperty(U.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(t){this.world.defaultContactMaterial.friction=t}}),Object.defineProperty(U.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(t){this.world.defaultContactMaterial.restitution=t}}),Object.defineProperty(U.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(t){this.world.defaultContactMaterial=t}}),Object.defineProperty(U.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(t){this.world.applySpringForces=t}}),Object.defineProperty(U.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(t){this.world.applyDamping=t}}),Object.defineProperty(U.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(t){this.world.applyGravity=t}}),Object.defineProperty(U.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(t){this.world.solveConstraints=t}}),Object.defineProperty(U.Physics.P2.prototype,"time",{get:function(){return this.world.time}}),Object.defineProperty(U.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(t){this.world.emitImpactEvent=t}}),Object.defineProperty(U.Physics.P2.prototype,"sleepMode",{get:function(){return this.world.sleepMode},set:function(t){this.world.sleepMode=t}}),Object.defineProperty(U.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}}),U.Physics.P2.FixtureList=function(t){Array.isArray(t)||(t=[t]),this.rawList=t,this.init(),this.parse(this.rawList)},U.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={},this.groupedFixtures=[],this.allFixtures=[]},setCategory:function(e,t){this.getFixtures(t).forEach(function(t){t.collisionGroup=e})},setMask:function(e,t){this.getFixtures(t).forEach(function(t){t.collisionMask=e})},setSensor:function(e,t){this.getFixtures(t).forEach(function(t){t.sensor=e})},setMaterial:function(e,t){this.getFixtures(t).forEach(function(t){t.material=e})},getFixtures:function(t){var e=[];if(t){t instanceof Array||(t=[t]);var i=this;return t.forEach(function(t){i.namedFixtures[t]&&e.push(i.namedFixtures[t])}),this.flatten(e)}return this.allFixtures},getFixtureByKey:function(t){return this.namedFixtures[t]},getGroup:function(t){return this.groupedFixtures[t]},parse:function(){var t,e,i=this.rawList,n=[];for(t in i)e=i[t],isNaN(+t)?this.namedFixtures[t]=this.flatten(e):(this.groupedFixtures[t]=this.groupedFixtures[t]||[],this.groupedFixtures[t]=this.groupedFixtures[t].concat(e)),n.push(this.allFixtures=this.flatten(this.groupedFixtures))},flatten:function(t){var e=[],i=arguments.callee;return t.forEach(function(t){return Array.prototype.push.apply(e,Array.isArray(t)?i(t):[t])}),e}},U.Physics.P2.PointProxy=function(t,e){this.world=t,this.destination=e},U.Physics.P2.PointProxy.prototype.constructor=U.Physics.P2.PointProxy,Object.defineProperty(U.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.world.mpx(this.destination[0])},set:function(t){this.destination[0]=this.world.pxm(t)}}),Object.defineProperty(U.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.world.mpx(this.destination[1])},set:function(t){this.destination[1]=this.world.pxm(t)}}),Object.defineProperty(U.Physics.P2.PointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(t){this.destination[0]=t}}),Object.defineProperty(U.Physics.P2.PointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(t){this.destination[1]=t}}),U.Physics.P2.InversePointProxy=function(t,e){this.world=t,this.destination=e},U.Physics.P2.InversePointProxy.prototype.constructor=U.Physics.P2.InversePointProxy,Object.defineProperty(U.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.world.mpxi(this.destination[0])},set:function(t){this.destination[0]=this.world.pxmi(t)}}),Object.defineProperty(U.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.world.mpxi(this.destination[1])},set:function(t){this.destination[1]=this.world.pxmi(t)}}),Object.defineProperty(U.Physics.P2.InversePointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(t){this.destination[0]=-t}}),Object.defineProperty(U.Physics.P2.InversePointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(t){this.destination[1]=-t}}),U.Physics.P2.Body=function(t,e,i,n,r){e=e||null,i=i||0,n=n||0,void 0===r&&(r=1),this.game=t,this.world=t.physics.p2,this.sprite=e,this.type=U.Physics.P2JS,this.offset=new U.Point,this.data=new p2.Body({position:[this.world.pxmi(i),this.world.pxmi(n)],mass:r}),(this.data.parent=this).velocity=new U.Physics.P2.InversePointProxy(this.world,this.data.velocity),this.force=new U.Physics.P2.InversePointProxy(this.world,this.data.force),this.gravity=new U.Point,this.onBeginContact=new U.Signal,this.onEndContact=new U.Signal,this.collidesWith=[],this.removeNextStep=!1,this.debugBody=null,this.dirty=!1,this._collideWorldBounds=!0,this._bodyCallbacks={},this._bodyCallbackContext={},this._groupCallbacks={},this._groupCallbackContext={},this._reset=!1,e&&(this.setRectangleFromSprite(e),e.exists&&this.game.physics.p2.addBody(this))},U.Physics.P2.Body.prototype={createBodyCallback:function(t,e,i){var n=-1;t.id?n=t.id:t.body&&(n=t.body.id),-1<n&&(null===e?(delete this._bodyCallbacks[n],delete this._bodyCallbackContext[n]):(this._bodyCallbacks[n]=e,this._bodyCallbackContext[n]=i))},createGroupCallback:function(t,e,i){null===e?(delete this._groupCallbacks[t.mask],delete this._groupCallbackContext[t.mask]):(this._groupCallbacks[t.mask]=e,this._groupCallbackContext[t.mask]=i)},getCollisionMask:function(){var t=0;this._collideWorldBounds&&(t=this.game.physics.p2.boundsCollisionGroup.mask);for(var e=0;e<this.collidesWith.length;e++)t|=this.collidesWith[e].mask;return t},updateCollisionMask:function(t){var e=this.getCollisionMask();if(void 0===t)for(var i=this.data.shapes.length-1;0<=i;i--)this.data.shapes[i].collisionMask=e;else t.collisionMask=e},setCollisionGroup:function(t,e){var i=this.getCollisionMask();if(void 0===e)for(var n=this.data.shapes.length-1;0<=n;n--)this.data.shapes[n].collisionGroup=t.mask,this.data.shapes[n].collisionMask=i;else e.collisionGroup=t.mask,e.collisionMask=i},clearCollision:function(t,e,i){if(void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===i)for(var n=this.data.shapes.length-1;0<=n;n--)t&&(this.data.shapes[n].collisionGroup=null),e&&(this.data.shapes[n].collisionMask=null);else t&&(i.collisionGroup=null),e&&(i.collisionMask=null);t&&(this.collidesWith.length=0)},removeCollisionGroup:function(t,e,i){var n;if(void 0===e&&(e=!0),Array.isArray(t))for(var r=0;r<t.length;r++)-1<(n=this.collidesWith.indexOf(t[r]))&&(this.collidesWith.splice(n,1),e&&(delete this._groupCallbacks[t.mask],delete this._groupCallbackContext[t.mask]));else-1<(n=this.collidesWith.indexOf(t))&&(this.collidesWith.splice(n,1),e&&(delete this._groupCallbacks[t.mask],delete this._groupCallbackContext[t.mask]));var s=this.getCollisionMask();if(void 0===i)for(r=this.data.shapes.length-1;0<=r;r--)this.data.shapes[r].collisionMask=s;else i.collisionMask=s},collides:function(t,e,i,n){if(Array.isArray(t))for(var r=0;r<t.length;r++)-1===this.collidesWith.indexOf(t[r])&&(this.collidesWith.push(t[r]),e&&this.createGroupCallback(t[r],e,i));else-1===this.collidesWith.indexOf(t)&&(this.collidesWith.push(t),e&&this.createGroupCallback(t,e,i));var s=this.getCollisionMask();if(void 0===n)for(r=this.data.shapes.length-1;0<=r;r--)this.data.shapes[r].collisionMask=s;else n.collisionMask=s},adjustCenterOfMass:function(){this.data.adjustCenterOfMass(),this.shapeChanged()},getVelocityAtPoint:function(t,e){return this.data.getVelocityAtPoint(t,e)},applyDamping:function(t){this.data.applyDamping(t)},applyImpulse:function(t,e,i){this.data.applyImpulse(t,[this.world.pxmi(e),this.world.pxmi(i)])},applyImpulseLocal:function(t,e,i){this.data.applyImpulseLocal(t,[this.world.pxmi(e),this.world.pxmi(i)])},applyForce:function(t,e,i){this.data.applyForce(t,[this.world.pxmi(e),this.world.pxmi(i)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0,this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0,this.data.angularDamping=0},toLocalFrame:function(t,e){return this.data.toLocalFrame(t,e)},toWorldFrame:function(t,e){return this.data.toWorldFrame(t,e)},rotateLeft:function(t){this.data.angularVelocity=this.world.pxm(-t)},rotateRight:function(t){this.data.angularVelocity=this.world.pxm(t)},moveForward:function(t){var e=this.world.pxmi(-t),t=this.data.angle+Math.PI/2;this.data.velocity[0]=e*Math.cos(t),this.data.velocity[1]=e*Math.sin(t)},moveBackward:function(t){var e=this.world.pxmi(-t),t=this.data.angle+Math.PI/2;this.data.velocity[0]=-e*Math.cos(t),this.data.velocity[1]=-e*Math.sin(t)},thrust:function(t){var e=this.world.pxmi(-t),t=this.data.angle+Math.PI/2;this.data.force[0]+=e*Math.cos(t),this.data.force[1]+=e*Math.sin(t)},thrustLeft:function(t){var e=this.world.pxmi(-t),t=this.data.angle;this.data.force[0]+=e*Math.cos(t),this.data.force[1]+=e*Math.sin(t)},thrustRight:function(t){var e=this.world.pxmi(-t),t=this.data.angle;this.data.force[0]-=e*Math.cos(t),this.data.force[1]-=e*Math.sin(t)},reverse:function(t){var e=this.world.pxmi(-t),t=this.data.angle+Math.PI/2;this.data.force[0]-=e*Math.cos(t),this.data.force[1]-=e*Math.sin(t)},moveLeft:function(t){this.data.velocity[0]=this.world.pxmi(-t)},moveRight:function(t){this.data.velocity[0]=this.world.pxmi(t)},moveUp:function(t){this.data.velocity[1]=this.world.pxmi(-t)},moveDown:function(t){this.data.velocity[1]=this.world.pxmi(t)},preUpdate:function(){this.dirty=!0,this.removeNextStep&&(this.removeFromWorld(),this.removeNextStep=!1)},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0])+this.offset.x,this.sprite.y=this.world.mpxi(this.data.position[1])+this.offset.y,this.fixedRotation||(this.sprite.rotation=this.data.angle),this.debugBody&&this.debugBody.updateSpriteTransform(),this.dirty=!1},reset:function(t,e,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),this.setZeroForce(),this.setZeroVelocity(),this.setZeroRotation(),i&&this.setZeroDamping(),n&&(this.mass=1),this.x=t,this.y=e},addToWorld:function(){if(this.game.physics.p2._toRemove)for(var t=0;t<this.game.physics.p2._toRemove.length;t++)this.game.physics.p2._toRemove[t]===this&&this.game.physics.p2._toRemove.splice(t,1);this.data.world!==this.game.physics.p2.world&&this.game.physics.p2.addBody(this)},removeFromWorld:function(){this.data.world===this.game.physics.p2.world&&this.game.physics.p2.removeBodyNextStep(this)},destroy:function(){this.removeFromWorld(),this.clearShapes(),this._bodyCallbacks={},this._bodyCallbackContext={},this._groupCallbacks={},this._groupCallbackContext={},this.debugBody&&this.debugBody.destroy(!0,!0),this.debugBody=null,this.sprite&&(this.sprite.body=null,this.sprite=null)},clearShapes:function(){for(var t=this.data.shapes.length;t--;)this.data.removeShape(this.data.shapes[t]);this.shapeChanged()},addShape:function(t,e,i,n){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.data.addShape(t,[this.world.pxmi(e),this.world.pxmi(i)],n),this.shapeChanged(),t},addCircle:function(t,e,i,n){t=new p2.Circle({radius:this.world.pxm(t)});return this.addShape(t,e,i,n)},addRectangle:function(t,e,i,n,r){e=new p2.Box({width:this.world.pxm(t),height:this.world.pxm(e)});return this.addShape(e,i,n,r)},addPlane:function(t,e,i){var n=new p2.Plane;return this.addShape(n,t,e,i)},addParticle:function(t,e,i){var n=new p2.Particle;return this.addShape(n,t,e,i)},addLine:function(t,e,i,n){t=new p2.Line({length:this.world.pxm(t)});return this.addShape(t,e,i,n)},addCapsule:function(t,e,i,n,r){e=new p2.Capsule({length:this.world.pxm(t),radius:this.world.pxm(e)});return this.addShape(e,i,n,r)},addPolygon:function(t,e){t=t||{},Array.isArray(e)||(e=Array.prototype.slice.call(arguments,1));var i=[];if(1===e.length&&Array.isArray(e[0]))i=e[0].slice(0);else if(Array.isArray(e[0]))i=e.slice();else if("number"==typeof e[0])for(var n=0,r=e.length;n<r;n+=2)i.push([e[n],e[n+1]]);var s=i.length-1;i[s][0]===i[0][0]&&i[s][1]===i[0][1]&&i.pop();for(var o=0;o<i.length;o++)i[o][0]=this.world.pxmi(i[o][0]),i[o][1]=this.world.pxmi(i[o][1]);s=this.data.fromPolygon(i,t);return this.shapeChanged(),s},removeShape:function(t){t=this.data.removeShape(t);return this.shapeChanged(),t},setCircle:function(t,e,i,n){return this.clearShapes(),this.addCircle(t,e,i,n)},setRectangle:function(t,e,i,n,r){return void 0===t&&(t=16),void 0===e&&(e=16),this.clearShapes(),this.addRectangle(t,e,i,n,r)},setRectangleFromSprite:function(t){return void 0===t&&(t=this.sprite),this.clearShapes(),this.addRectangle(t.width,t.height,0,0,t.rotation)},setMaterial:function(t,e){if(void 0===e)for(var i=this.data.shapes.length-1;0<=i;i--)this.data.shapes[i].material=t;else e.material=t},shapeChanged:function(){this.debugBody&&this.debugBody.draw()},addPhaserPolygon:function(t,e){for(var i=this.game.cache.getPhysicsData(t,e),n=[],r=0;r<i.length;r++){var s=i[r],o=this.addFixture(s);n[s.filter.group]=n[s.filter.group]||[],n[s.filter.group]=n[s.filter.group].concat(o),s.fixtureKey&&(n[s.fixtureKey]=o)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),n},addFixture:function(t){var e=[];if(t.circle){(p=new p2.Circle({radius:this.world.pxm(t.circle.radius)})).collisionGroup=t.filter.categoryBits,p.collisionMask=t.filter.maskBits,p.sensor=t.isSensor;var i=p2.vec2.create();i[0]=this.world.pxmi(t.circle.position[0]-this.sprite.width/2),i[1]=this.world.pxmi(t.circle.position[1]-this.sprite.height/2),this.data.addShape(p,i),e.push(p)}else for(var n=t.polygons,r=p2.vec2.create(),s=0;s<n.length;s++){for(var o=n[s],a=[],l=0;l<o.length;l+=2)a.push([this.world.pxmi(o[l]),this.world.pxmi(o[l+1])]);for(var p=new p2.Convex({vertices:a}),h=0;h!==p.vertices.length;h++){var u=p.vertices[h];p2.vec2.sub(u,u,p.centerOfMass)}p2.vec2.scale(r,p.centerOfMass,1),r[0]-=this.world.pxmi(this.sprite.width/2),r[1]-=this.world.pxmi(this.sprite.height/2),p.updateTriangles(),p.updateCenterOfMass(),p.updateBoundingRadius(),p.collisionGroup=t.filter.categoryBits,p.collisionMask=t.filter.maskBits,p.sensor=t.isSensor,this.data.addShape(p,r),e.push(p)}return e},loadPolygon:function(t,e){var i;i=null===t?e:this.game.cache.getPhysicsData(t,e);for(var n=p2.vec2.create(),r=0;r<i.length;r++){for(var s=[],o=0;o<i[r].shape.length;o+=2)s.push([this.world.pxmi(i[r].shape[o]),this.world.pxmi(i[r].shape[o+1])]);for(var a=new p2.Convex({vertices:s}),l=0;l!==a.vertices.length;l++){var p=a.vertices[l];p2.vec2.sub(p,p,a.centerOfMass)}p2.vec2.scale(n,a.centerOfMass,1),n[0]-=this.world.pxmi(this.sprite.width/2),n[1]-=this.world.pxmi(this.sprite.height/2),a.updateTriangles(),a.updateCenterOfMass(),a.updateBoundingRadius(),this.data.addShape(a,n)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),!0}},U.Physics.P2.Body.prototype.constructor=U.Physics.P2.Body,U.Physics.P2.Body.DYNAMIC=1,U.Physics.P2.Body.STATIC=2,U.Physics.P2.Body.KINEMATIC=4,Object.defineProperty(U.Physics.P2.Body.prototype,"static",{get:function(){return this.data.type===U.Physics.P2.Body.STATIC},set:function(t){t&&this.data.type!==U.Physics.P2.Body.STATIC?(this.data.type=U.Physics.P2.Body.STATIC,this.mass=0):t||this.data.type!==U.Physics.P2.Body.STATIC||(this.data.type=U.Physics.P2.Body.DYNAMIC,this.mass=1)}}),Object.defineProperty(U.Physics.P2.Body.prototype,"dynamic",{get:function(){return this.data.type===U.Physics.P2.Body.DYNAMIC},set:function(t){t&&this.data.type!==U.Physics.P2.Body.DYNAMIC?(this.data.type=U.Physics.P2.Body.DYNAMIC,this.mass=1):t||this.data.type!==U.Physics.P2.Body.DYNAMIC||(this.data.type=U.Physics.P2.Body.STATIC,this.mass=0)}}),Object.defineProperty(U.Physics.P2.Body.prototype,"kinematic",{get:function(){return this.data.type===U.Physics.P2.Body.KINEMATIC},set:function(t){t&&this.data.type!==U.Physics.P2.Body.KINEMATIC?(this.data.type=U.Physics.P2.Body.KINEMATIC,this.mass=4):t||this.data.type!==U.Physics.P2.Body.KINEMATIC||(this.data.type=U.Physics.P2.Body.STATIC,this.mass=0)}}),Object.defineProperty(U.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(t){t!==this.data.allowSleep&&(this.data.allowSleep=t)}}),Object.defineProperty(U.Physics.P2.Body.prototype,"angle",{get:function(){return U.Math.wrapAngle(U.Math.radToDeg(this.data.angle))},set:function(t){this.data.angle=U.Math.degToRad(U.Math.wrapAngle(t))}}),Object.defineProperty(U.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(t){this.data.angularDamping=t}}),Object.defineProperty(U.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(t){this.data.angularForce=t}}),Object.defineProperty(U.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(t){this.data.angularVelocity=t}}),Object.defineProperty(U.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(t){this.data.damping=t}}),Object.defineProperty(U.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(t){t!==this.data.fixedRotation&&(this.data.fixedRotation=t)}}),Object.defineProperty(U.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(t){this.data.inertia=t}}),Object.defineProperty(U.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(t){t!==this.data.mass&&(this.data.mass=t,this.data.updateMassProperties())}}),Object.defineProperty(U.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.type},set:function(t){t!==this.data.type&&(this.data.type=t)}}),Object.defineProperty(U.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(t){this.data.angle=t}}),Object.defineProperty(U.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(t){this.data.sleepSpeedLimit=t}}),Object.defineProperty(U.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(t){this.data.position[0]=this.world.pxmi(t)}}),Object.defineProperty(U.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(t){this.data.position[1]=this.world.pxmi(t)}}),Object.defineProperty(U.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}}),Object.defineProperty(U.Physics.P2.Body.prototype,"debug",{get:function(){return null!==this.debugBody},set:function(t){t&&!this.debugBody?this.debugBody=new U.Physics.P2.BodyDebug(this.game,this.data):!t&&this.debugBody&&(this.debugBody.destroy(),this.debugBody=null)}}),Object.defineProperty(U.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(t){t&&!this._collideWorldBounds?(this._collideWorldBounds=!0,this.updateCollisionMask()):!t&&this._collideWorldBounds&&(this._collideWorldBounds=!1,this.updateCollisionMask())}}),U.Physics.P2.BodyDebug=function(t,e,i){U.Group.call(this,t);var n={pixelsPerLengthUnit:t.physics.p2.mpx(1),debugPolygons:!1,lineWidth:1,alpha:.5};this.settings=U.Utils.extend(n,i),this.ppu=this.settings.pixelsPerLengthUnit,this.ppu=-1*this.ppu,this.body=e,this.canvas=new U.Graphics(t),this.canvas.alpha=this.settings.alpha,this.add(this.canvas),this.draw(),this.updateSpriteTransform()},U.Physics.P2.BodyDebug.prototype=Object.create(U.Group.prototype),U.Physics.P2.BodyDebug.prototype.constructor=U.Physics.P2.BodyDebug,U.Utils.extend(U.Physics.P2.BodyDebug.prototype,{updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu,this.position.y=this.body.position[1]*this.ppu,this.rotation=this.body.angle},draw:function(){var t,e,i,n,r,s,o,a,l,p,h,u,c=this.body,d=this.canvas;if(d.clear(),i=parseInt(this.randomPastelHex(),16),r=16711680,s=this.lineWidth,c instanceof p2.Body&&c.shapes.length)for(var _=c.shapes.length,y=0;y!==_;){if(o=(e=c.shapes[y]).position||0,t=e.angle||0,e instanceof p2.Circle)this.drawCircle(d,o[0]*this.ppu,o[1]*this.ppu,t,e.radius*this.ppu,i,s);else if(e instanceof p2.Capsule)this.drawCapsule(d,o[0]*this.ppu,o[1]*this.ppu,t,e.length*this.ppu,e.radius*this.ppu,r,i,s);else if(e instanceof p2.Plane)this.drawPlane(d,o[0]*this.ppu,-o[1]*this.ppu,i,r,5*s,10*s,10*s,100*this.ppu,t);else if(e instanceof p2.Line)this.drawLine(d,e.length*this.ppu,r,s);else if(e instanceof p2.Box)this.drawRectangle(d,o[0]*this.ppu,o[1]*this.ppu,t,e.width*this.ppu,e.height*this.ppu,r,i,s);else if(e instanceof p2.Convex){for(l=[],p=p2.vec2.create(),n=h=0,u=e.vertices.length;0<=u?h<u:u<h;n=0<=u?++h:--h)a=e.vertices[n],p2.vec2.rotate(p,a,t),l.push([(p[0]+o[0])*this.ppu,-(p[1]+o[1])*this.ppu]);this.drawConvex(d,l,e.triangles,r,i,s,this.settings.debugPolygons,[o[0]*this.ppu,-o[1]*this.ppu])}y++}},drawRectangle:function(t,e,i,n,r,s,o,a,l){void 0===l&&(l=1),void 0===o&&(o=0),t.lineStyle(l,o,1),t.beginFill(a),t.drawRect(e-r/2,i-s/2,r,s)},drawCircle:function(t,e,i,n,r,s,o){void 0===o&&(o=1),void 0===s&&(s=16777215),t.lineStyle(o,0,1),t.beginFill(s,1),t.drawCircle(e,i,2*-r),t.endFill(),t.moveTo(e,i),t.lineTo(e+r*Math.cos(-n),i+r*Math.sin(-n))},drawLine:function(t,e,i,n){void 0===n&&(n=1),void 0===i&&(i=0),t.lineStyle(5*n,i,1),t.moveTo(-e/2,0),t.lineTo(e/2,0)},drawConvex:function(t,e,i,n,r,s,o,a){var l,p,h,u,c,d,_,y;if(void 0===s&&(s=1),void 0===n&&(n=0),o){for(l=[16711680,65280,255],p=0;p!==e.length+1;)c=e[p%e.length],y=e[(p+1)%e.length],u=c[0],_=c[1],c=y[0],y=y[1],t.lineStyle(s,l[p%l.length],1),t.moveTo(u,-_),t.lineTo(c,-y),t.drawCircle(u,-_,2*s),p++;return t.lineStyle(s,0,1),t.drawCircle(a[0],a[1],2*s)}for(t.lineStyle(s,n,1),t.beginFill(r),p=0;p!==e.length;)h=(d=e[p])[0],d=d[1],0===p?t.moveTo(h,-d):t.lineTo(h,-d),p++;if(t.endFill(),2<e.length)return t.moveTo(e[e.length-1][0],-e[e.length-1][1]),t.lineTo(e[0][0],-e[0][1])},drawPath:function(t,e,i,n,r){var s,o,a,l,p,h;for(void 0===r&&(r=1),void 0===i&&(i=0),t.lineStyle(r,i,1),"number"==typeof n&&t.beginFill(n),a=o=null,s=0;s<e.length;)p=(l=e[s])[0],h=l[1],p===o&&h===a||(0===s?t.moveTo(p,h):(l=e[(s+1)%e.length][0],0!=(p-o)*(e[(s+1)%e.length][1]-a)-(l-o)*(h-a)&&t.lineTo(p,h)),o=p,a=h),s++;"number"==typeof n&&t.endFill(),2<e.length&&"number"==typeof n&&(t.moveTo(e[e.length-1][0],e[e.length-1][1]),t.lineTo(e[0][0],e[0][1]))},drawPlane:function(t,e,i,n,r,s,o,a,l,p){void 0===s&&(s=1),void 0===n&&(n=16777215),t.lineStyle(s,r,11),t.beginFill(n),t.moveTo(e,-i),n=e+Math.cos(p)*this.game.width,l=i+Math.sin(p)*this.game.height,t.lineTo(n,-l),t.moveTo(e,-i),n=e+Math.cos(p)*-this.game.width,l=i+Math.sin(p)*-this.game.height,t.lineTo(n,-l)},drawCapsule:function(t,e,i,n,r,s,o,a,l){void 0===l&&(l=1),void 0===o&&(o=0),t.lineStyle(l,o,1);var p=Math.cos(n),n=Math.sin(n);t.beginFill(a,1),t.drawCircle(-r/2*p+e,-r/2*n+i,2*-s),t.drawCircle(r/2*p+e,r/2*n+i,2*-s),t.endFill(),t.lineStyle(l,o,0),t.beginFill(a,1),t.moveTo(-r/2*p+s*n+e,-r/2*n+s*p+i),t.lineTo(r/2*p+s*n+e,r/2*n+s*p+i),t.lineTo(r/2*p-s*n+e,r/2*n-s*p+i),t.lineTo(-r/2*p-s*n+e,-r/2*n-s*p+i),t.endFill(),t.lineStyle(l,o,1),t.moveTo(-r/2*p+s*n+e,-r/2*n+s*p+i),t.lineTo(r/2*p+s*n+e,r/2*n+s*p+i),t.moveTo(-r/2*p-s*n+e,-r/2*n-s*p+i),t.lineTo(r/2*p-s*n+e,r/2*n-s*p+i)},randomPastelHex:function(){var t=[255,255,255],e=Math.floor(256*Math.random()),i=Math.floor(256*Math.random()),n=Math.floor(256*Math.random());return e=Math.floor((e+3*t[0])/4),i=Math.floor((i+3*t[1])/4),n=Math.floor((n+3*t[2])/4),this.rgbToHex(e,i,n)},rgbToHex:function(t,e,i){return this.componentToHex(t)+this.componentToHex(e)+this.componentToHex(i)},componentToHex:function(t){t=t.toString(16);return 2===t.length?t:t+"0"}}),U.Physics.P2.Spring=function(t,e,i,n,r,s,o,a,l,p){this.game=t.game,void 0===n&&(n=1),void 0===r&&(r=100),void 0===s&&(s=1);s={restLength:n=(this.world=t).pxm(n),stiffness:r,damping:s};null!=o&&(s.worldAnchorA=[t.pxm(o[0]),t.pxm(o[1])]),null!=a&&(s.worldAnchorB=[t.pxm(a[0]),t.pxm(a[1])]),null!=l&&(s.localAnchorA=[t.pxm(l[0]),t.pxm(l[1])]),null!=p&&(s.localAnchorB=[t.pxm(p[0]),t.pxm(p[1])]),this.data=new p2.LinearSpring(e,i,s),this.data.parent=this},U.Physics.P2.Spring.prototype.constructor=U.Physics.P2.Spring,U.Physics.P2.RotationalSpring=function(t,e,i,n,r,s){this.game=t.game,this.world=t,void 0===n&&(n=null),void 0===r&&(r=100),void 0===s&&(s=1);s={restAngle:n=n&&t.pxm(n),stiffness:r,damping:s};this.data=new p2.RotationalSpring(e,i,s),this.data.parent=this},U.Physics.P2.Spring.prototype.constructor=U.Physics.P2.Spring,U.Physics.P2.Material=function(t){this.name=t,p2.Material.call(this)},U.Physics.P2.Material.prototype=Object.create(p2.Material.prototype),U.Physics.P2.Material.prototype.constructor=U.Physics.P2.Material,U.Physics.P2.ContactMaterial=function(t,e,i){p2.ContactMaterial.call(this,t,e,i)},U.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype),U.Physics.P2.ContactMaterial.prototype.constructor=U.Physics.P2.ContactMaterial,U.Physics.P2.CollisionGroup=function(t){this.mask=t},U.Physics.P2.DistanceConstraint=function(t,e,i,n,r,s,o){void 0===n&&(n=100),void 0===r&&(r=[0,0]),void 0===s&&(s=[0,0]),void 0===o&&(o=Number.MAX_VALUE),this.game=t.game;o={distance:n=(this.world=t).pxm(n),localAnchorA:r=[t.pxmi(r[0]),t.pxmi(r[1])],localAnchorB:s=[t.pxmi(s[0]),t.pxmi(s[1])],maxForce:o};p2.DistanceConstraint.call(this,e,i,o)},U.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype),U.Physics.P2.DistanceConstraint.prototype.constructor=U.Physics.P2.DistanceConstraint,U.Physics.P2.GearConstraint=function(t,e,i,n,r){void 0===n&&(n=0),void 0===r&&(r=1),this.game=t.game,this.world=t;r={angle:n,ratio:r};p2.GearConstraint.call(this,e,i,r)},U.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype),U.Physics.P2.GearConstraint.prototype.constructor=U.Physics.P2.GearConstraint,U.Physics.P2.LockConstraint=function(t,e,i,n,r,s){void 0===n&&(n=[0,0]),void 0===r&&(r=0),void 0===s&&(s=Number.MAX_VALUE),this.game=t.game;s={localOffsetB:n=[(this.world=t).pxm(n[0]),t.pxm(n[1])],localAngleB:r,maxForce:s};p2.LockConstraint.call(this,e,i,s)},U.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype),U.Physics.P2.LockConstraint.prototype.constructor=U.Physics.P2.LockConstraint,U.Physics.P2.PrismaticConstraint=function(t,e,i,n,r,s,o,a){void 0===n&&(n=!0),void 0===r&&(r=[0,0]),void 0===s&&(s=[0,0]),void 0===o&&(o=[0,0]),void 0===a&&(a=Number.MAX_VALUE),this.game=t.game;n={localAnchorA:r=[(this.world=t).pxmi(r[0]),t.pxmi(r[1])],localAnchorB:s=[t.pxmi(s[0]),t.pxmi(s[1])],localAxisA:o,maxForce:a,disableRotationalLock:!n};p2.PrismaticConstraint.call(this,e,i,n)},U.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype),U.Physics.P2.PrismaticConstraint.prototype.constructor=U.Physics.P2.PrismaticConstraint,U.Physics.P2.RevoluteConstraint=function(t,e,i,n,r,s,o){void 0===s&&(s=Number.MAX_VALUE),void 0===o&&(o=null),this.game=t.game,i=[(this.world=t).pxmi(i[0]),t.pxmi(i[1])],r=[t.pxmi(r[0]),t.pxmi(r[1])];s={worldPivot:o=o&&[t.pxmi(o[0]),t.pxmi(o[1])],localPivotA:i,localPivotB:r,maxForce:s};p2.RevoluteConstraint.call(this,e,n,s)},U.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype),U.Physics.P2.RevoluteConstraint.prototype.constructor=U.Physics.P2.RevoluteConstraint,U.ImageCollection=function(t,e,i,n,r,s,o){(void 0===i||i<=0)&&(i=32),(void 0===n||n<=0)&&(n=32),void 0===r&&(r=0),void 0===s&&(s=0),this.name=t,this.firstgid=0|e,this.imageWidth=0|i,this.imageHeight=0|n,this.imageMargin=0|r,this.imageSpacing=0|s,this.properties=o||{},this.images=[],this.total=0},U.ImageCollection.prototype={containsImageIndex:function(t){return t>=this.firstgid&&t<this.firstgid+this.total},addImage:function(t,e){this.images.push({gid:t,image:e}),this.total++}},U.ImageCollection.prototype.constructor=U.ImageCollection,U.Tile=function(t,e,i,n,r,s){this.layer=t,this.index=e,this.x=i,this.y=n,this.rotation=0,this.flipped=!1,this.worldX=i*r,this.worldY=n*s,this.width=r,this.height=s,this.centerX=Math.abs(r/2),this.centerY=Math.abs(s/2),this.alpha=1,this.properties={},this.scanned=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1,this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.collisionCallback=null,this.collisionCallbackContext=this},U.Tile.prototype={containsPoint:function(t,e){return!(t<this.worldX||e<this.worldY||t>this.right||e>this.bottom)},intersects:function(t,e,i,n){return!(i<=this.worldX||n<=this.worldY||t>=this.worldX+this.width||e>=this.worldY+this.height)},setCollisionCallback:function(t,e){this.collisionCallback=t,this.collisionCallbackContext=e},destroy:function(){this.collisionCallback=null,this.collisionCallbackContext=null,this.properties=null},setCollision:function(t,e,i,n){this.collideLeft=t,this.collideRight=e,this.collideUp=i,this.collideDown=n,this.faceLeft=t,this.faceRight=e,this.faceTop=i,this.faceBottom=n},resetCollision:function(){this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1},isInteresting:function(t,e){return t&&e?this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback:t?this.collideLeft||this.collideRight||this.collideUp||this.collideDown:!!e&&(this.faceTop||this.faceBottom||this.faceLeft||this.faceRight)},copy:function(t){this.index=t.index,this.alpha=t.alpha,this.properties=t.properties,this.collideUp=t.collideUp,this.collideDown=t.collideDown,this.collideLeft=t.collideLeft,this.collideRight=t.collideRight,this.collisionCallback=t.collisionCallback,this.collisionCallbackContext=t.collisionCallbackContext}},U.Tile.prototype.constructor=U.Tile,Object.defineProperty(U.Tile.prototype,"collides",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}}),Object.defineProperty(U.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback}}),Object.defineProperty(U.Tile.prototype,"left",{get:function(){return this.worldX}}),Object.defineProperty(U.Tile.prototype,"right",{get:function(){return this.worldX+this.width}}),Object.defineProperty(U.Tile.prototype,"top",{get:function(){return this.worldY}}),Object.defineProperty(U.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}}),U.Tilemap=function(t,e,i,n,r,s){this.game=t,this.key=e;s=U.TilemapParser.parse(this.game,e,i,n,r,s);null!==s&&(this.width=s.width,this.height=s.height,this.tileWidth=s.tileWidth,this.tileHeight=s.tileHeight,this.orientation=s.orientation,this.format=s.format,this.version=s.version,this.properties=s.properties,this.widthInPixels=s.widthInPixels,this.heightInPixels=s.heightInPixels,this.layers=s.layers,this.tilesets=s.tilesets,this.imagecollections=s.imagecollections,this.tiles=s.tiles,this.objects=s.objects,this.collideIndexes=[],this.collision=s.collision,this.images=s.images,this.enableDebug=!1,this.currentLayer=0,this.debugMap=[],this._results=[],this._tempA=0,this._tempB=0)},U.Tilemap.CSV=0,U.Tilemap.TILED_JSON=1,U.Tilemap.NORTH=0,U.Tilemap.EAST=1,U.Tilemap.SOUTH=2,U.Tilemap.WEST=3,U.Tilemap.prototype={create:function(t,e,i,n,r,s){return void 0===s&&(s=this.game.world),this.width=e,this.height=i,this.setTileSize(n,r),this.layers.length=0,this.createBlankLayer(t,e,i,n,r,s)},setTileSize:function(t,e){this.tileWidth=t,this.tileHeight=e,this.widthInPixels=this.width*t,this.heightInPixels=this.height*e},addTilesetImage:function(t,e,i,n,r,s,o){if(void 0===t)return null;void 0===i&&(i=this.tileWidth),void 0===n&&(n=this.tileHeight),void 0===r&&(r=0),void 0===s&&(s=0),void 0===o&&(o=0),0===i&&(i=32),0===n&&(n=32);var a=null;if(null!=e||(e=t),e instanceof U.BitmapData)a=e.canvas;else{if(!this.game.cache.checkImageKey(e))return null;a=this.game.cache.getImage(e)}e=this.getTilesetIndex(t);if(null===e&&this.format===U.Tilemap.TILED_JSON)return null;if(this.tilesets[e])return this.tilesets[e].setImage(a),this.tilesets[e];var l=new U.Tileset(t,o,i,n,r,s,{});l.setImage(a),this.tilesets.push(l);for(var p=this.tilesets.length-1,h=r,u=r,c=0,d=0,_=0,y=o;y<o+l.total&&(this.tiles[y]=[h,u,p],h+=i+s,++c!==l.total)&&(++d!==l.columns||(h=r,u+=n+s,d=0,++_!==l.rows));y++);return l},createFromObjects:function(t,e,i,n,r,s,o,a,l){if(void 0===r&&(r=!0),void 0===s&&(s=!1),void 0===o&&(o=this.game.world),void 0===a&&(a=U.Sprite),void 0===l&&(l=!0),this.objects[t])for(var p=0;p<this.objects[t].length;p++){var h=!1,u=this.objects[t][p];if((void 0!==u.gid&&"number"==typeof e&&u.gid===e||void 0!==u.id&&"number"==typeof e&&u.id===e||void 0!==u.name&&"string"==typeof e&&u.name===e)&&(h=!0),h){var c,d=new a(this.game,parseFloat(u.x,10),parseFloat(u.y,10),i,n);for(c in d.name=u.name,d.visible=u.visible,d.autoCull=s,d.exists=r,u.width&&(d.width=u.width),u.height&&(d.height=u.height),u.rotation&&(d.angle=u.rotation),l&&(d.y-=d.height),o.add(d),u.properties)o.set(d,c,u.properties[c],!1,!1,0,!0)}}},createFromTiles:function(t,e,i,n,r,s){"number"==typeof t&&(t=[t]),null==e?e=[]:"number"==typeof e&&(e=[e]),n=this.getLayer(n),void 0===r&&(r=this.game.world),void 0===s&&(s={}),void 0===s.customClass&&(s.customClass=U.Sprite),void 0===s.adjustY&&(s.adjustY=!0);var o=this.layers[n].width,a=this.layers[n].height;if(this.copy(0,0,o,a,n),this._results.length<2)return 0;for(var l,p=0,h=1,u=this._results.length;h<u;h++)if(-1!==t.indexOf(this._results[h].index)){for(var c in l=new s.customClass(this.game,this._results[h].worldX,this._results[h].worldY,i),s)l[c]=s[c];r.add(l),p++}if(1===e.length)for(h=0;h<t.length;h++)this.replace(t[h],e[0],0,0,o,a,n);else if(1<e.length)for(h=0;h<t.length;h++)this.replace(t[h],e[h],0,0,o,a,n);return p},createLayer:function(t,e,i,n){void 0===e&&(e=this.game.width),void 0===i&&(i=this.game.height),void 0===n&&(n=this.game.world);var r=t;if("string"==typeof t&&(r=this.getLayerIndex(t)),!(null===r||r>this.layers.length)){void 0===e||e<=0?e=Math.min(this.game.width,this.layers[r].widthInPixels):e>this.game.width&&(e=this.game.width),void 0===i||i<=0?i=Math.min(this.game.height,this.layers[r].heightInPixels):i>this.game.height&&(i=this.game.height),this.enableDebug;i=n.add(new U.TilemapLayer(this.game,this,r,e,i));return this.enableDebug,i}},createBlankLayer:function(t,e,i,n,r,s){if(void 0===s&&(s=this.game.world),null===this.getLayerIndex(t)){for(var o,a={name:t,x:0,y:0,width:e,height:i,widthInPixels:e*n,heightInPixels:i*r,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:null},l=[],p=0;p<i;p++){o=[];for(var h=0;h<e;h++)o.push(new U.Tile(a,-1,h,p,n,r));l.push(o)}a.data=l,this.layers.push(a),this.currentLayer=this.layers.length-1;var u=a.widthInPixels,c=a.heightInPixels;return u>this.game.width&&(u=this.game.width),c>this.game.height&&(c=this.game.height),(l=new U.TilemapLayer(this.game,this,this.layers.length-1,u,c)).name=t,s.add(l)}},getIndex:function(t,e){for(var i=0;i<t.length;i++)if(t[i].name===e)return i;return null},getLayerIndex:function(t){return this.getIndex(this.layers,t)},getTilesetIndex:function(t){return this.getIndex(this.tilesets,t)},getImageIndex:function(t){return this.getIndex(this.images,t)},setTileIndexCallback:function(t,e,i,n){if(n=this.getLayer(n),"number"==typeof t)this.layers[n].callbacks[t]={callback:e,callbackContext:i};else for(var r=0,s=t.length;r<s;r++)this.layers[n].callbacks[t[r]]={callback:e,callbackContext:i}},setTileLocationCallback:function(t,e,i,n,r,s,o){if(o=this.getLayer(o),this.copy(t,e,i,n,o),!(this._results.length<2))for(var a=1;a<this._results.length;a++)this._results[a].setCollisionCallback(r,s)},setCollision:function(t,e,i,n){if(void 0===e&&(e=!0),void 0===n&&(n=!0),i=this.getLayer(i),"number"==typeof t)return this.setCollisionByIndex(t,e,i,!0);if(Array.isArray(t)){for(var r=0;r<t.length;r++)this.setCollisionByIndex(t[r],e,i,!1);n&&this.calculateFaces(i)}},setCollisionBetween:function(t,e,i,n,r){if(void 0===i&&(i=!0),void 0===r&&(r=!0),n=this.getLayer(n),!(e<t)){for(var s=t;s<=e;s++)this.setCollisionByIndex(s,i,n,!1);r&&this.calculateFaces(n)}},setCollisionByExclusion:function(t,e,i,n){void 0===e&&(e=!0),void 0===n&&(n=!0),i=this.getLayer(i);for(var r=0,s=this.tiles.length;r<s;r++)-1===t.indexOf(r)&&this.setCollisionByIndex(r,e,i,!1);n&&this.calculateFaces(i)},setCollisionByIndex:function(t,e,i,n){var r;void 0===e&&(e=!0),void 0===i&&(i=this.currentLayer),void 0===n&&(n=!0),e?this.collideIndexes.push(t):-1<(r=this.collideIndexes.indexOf(t))&&this.collideIndexes.splice(r,1);for(var s=0;s<this.layers[i].height;s++)for(var o=0;o<this.layers[i].width;o++){var a=this.layers[i].data[s][o];a&&a.index===t&&(e?a.setCollision(!0,!0,!0,!0):a.resetCollision(),a.faceTop=e,a.faceBottom=e,a.faceLeft=e,a.faceRight=e)}return n&&this.calculateFaces(i),i},getLayer:function(t){return void 0===t?t=this.currentLayer:"string"==typeof t?t=this.getLayerIndex(t):t instanceof U.TilemapLayer&&(t=t.index),t},setPreventRecalculate:function(t){if(!0===t&&!0!==this.preventingRecalculate&&(this.preventingRecalculate=!0,this.needToRecalculate={}),!1===t&&!0===this.preventingRecalculate){for(var e in this.preventingRecalculate=!1,this.needToRecalculate)this.calculateFaces(e);this.needToRecalculate=!1}},calculateFaces:function(t){if(this.preventingRecalculate)this.needToRecalculate[t]=!0;else for(var e,i,n,r,s=0,o=this.layers[t].height;s<o;s++)for(var a=0,l=this.layers[t].width;a<l;a++){var p=this.layers[t].data[s][a];p&&(e=this.getTileAbove(t,a,s),i=this.getTileBelow(t,a,s),n=this.getTileLeft(t,a,s),r=this.getTileRight(t,a,s),p.collides&&(p.faceTop=!0,p.faceBottom=!0,p.faceLeft=!0,p.faceRight=!0),e&&e.collides&&(p.faceTop=!1),i&&i.collides&&(p.faceBottom=!1),n&&n.collides&&(p.faceLeft=!1),r&&r.collides&&(p.faceRight=!1))}},getTileAbove:function(t,e,i){return 0<i?this.layers[t].data[i-1][e]:null},getTileBelow:function(t,e,i){return i<this.layers[t].height-1?this.layers[t].data[i+1][e]:null},getTileLeft:function(t,e,i){return 0<e?this.layers[t].data[i][e-1]:null},getTileRight:function(t,e,i){return e<this.layers[t].width-1?this.layers[t].data[i][e+1]:null},setLayer:function(t){t=this.getLayer(t),this.layers[t]&&(this.currentLayer=t)},hasTile:function(t,e,i){return i=this.getLayer(i),void 0!==this.layers[i].data[e]&&void 0!==this.layers[i].data[e][t]&&-1<this.layers[i].data[e][t].index},removeTile:function(t,e,i){if(i=this.getLayer(i),0<=t&&t<this.layers[i].width&&0<=e&&e<this.layers[i].height&&this.hasTile(t,e,i)){var n=this.layers[i].data[e][t];return this.layers[i].data[e][t]=new U.Tile(this.layers[i],-1,t,e,this.tileWidth,this.tileHeight),this.layers[i].dirty=!0,this.calculateFaces(i),n}},removeTileWorldXY:function(t,e,i,n,r){return r=this.getLayer(r),t=this.game.math.snapToFloor(t,i)/i,e=this.game.math.snapToFloor(e,n)/n,this.removeTile(t,e,r)},putTile:function(t,e,i,n){return null===t?this.removeTile(e,i,n):(n=this.getLayer(n),0<=e&&e<this.layers[n].width&&0<=i&&i<this.layers[n].height?(t instanceof U.Tile?(r=t.index,this.hasTile(e,i,n)?this.layers[n].data[i][e].copy(t):this.layers[n].data[i][e]=new U.Tile(n,r,e,i,t.width,t.height)):(r=t,this.hasTile(e,i,n)?this.layers[n].data[i][e].index=r:this.layers[n].data[i][e]=new U.Tile(this.layers[n],r,e,i,this.tileWidth,this.tileHeight)),-1<this.collideIndexes.indexOf(r)?this.layers[n].data[i][e].setCollision(!0,!0,!0,!0):this.layers[n].data[i][e].resetCollision(),this.layers[n].dirty=!0,this.calculateFaces(n),this.layers[n].data[i][e]):null);var r},putTileWorldXY:function(t,e,i,n,r,s){return s=this.getLayer(s),e=this.game.math.snapToFloor(e,n)/n,i=this.game.math.snapToFloor(i,r)/r,this.putTile(t,e,i,s)},searchTileIndex:function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=!1),n=this.getLayer(n);var r=0;if(i){for(var s=this.layers[n].height-1;0<=s;s--)for(var o=this.layers[n].width-1;0<=o;o--)if(this.layers[n].data[s][o].index===t){if(r===e)return this.layers[n].data[s][o];r++}}else for(s=0;s<this.layers[n].height;s++)for(o=0;o<this.layers[n].width;o++)if(this.layers[n].data[s][o].index===t){if(r===e)return this.layers[n].data[s][o];r++}return null},getTile:function(t,e,i,n){return void 0===n&&(n=!1),i=this.getLayer(i),0<=t&&t<this.layers[i].width&&0<=e&&e<this.layers[i].height&&(-1!==this.layers[i].data[e][t].index||n)?this.layers[i].data[e][t]:null},getTileWorldXY:function(t,e,i,n,r,s){return void 0===i&&(i=this.tileWidth),void 0===n&&(n=this.tileHeight),r=this.getLayer(r),t=this.game.math.snapToFloor(t,i)/i,e=this.game.math.snapToFloor(e,n)/n,this.getTile(t,e,r,s)},copy:function(t,e,i,n,r){if(r=this.getLayer(r),this.layers[r]){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=this.layers[r].width),void 0===n&&(n=this.layers[r].height),t<0&&(t=0),e<0&&(e=0),i>this.layers[r].width&&(i=this.layers[r].width),n>this.layers[r].height&&(n=this.layers[r].height),this._results.length=0,this._results.push({x:t,y:e,width:i,height:n,layer:r});for(var s=e;s<e+n;s++)for(var o=t;o<t+i;o++)this._results.push(this.layers[r].data[s][o]);return this._results}this._results.length=0},paste:function(t,e,i,n){if(void 0===t&&(t=0),void 0===e&&(e=0),n=this.getLayer(n),i&&!(i.length<2)){for(var r=t-i[1].x,s=e-i[1].y,o=1;o<i.length;o++)this.layers[n].data[s+i[o].y][r+i[o].x].copy(i[o]);this.layers[n].dirty=!0,this.calculateFaces(n)}},swap:function(t,e,i,n,r,s,o){o=this.getLayer(o),this.copy(i,n,r,s,o),this._results.length<2||(this._tempA=t,this._tempB=e,this._results.forEach(this.swapHandler,this),this.paste(i,n,this._results,o))},swapHandler:function(t){t.index===this._tempA?t.index=this._tempB:t.index===this._tempB&&(t.index=this._tempA)},forEach:function(t,e,i,n,r,s,o){o=this.getLayer(o),this.copy(i,n,r,s,o),this._results.length<2||(this._results.forEach(t,e),this.paste(i,n,this._results,o))},replace:function(t,e,i,n,r,s,o){if(o=this.getLayer(o),this.copy(i,n,r,s,o),!(this._results.length<2)){for(var a=1;a<this._results.length;a++)this._results[a].index===t&&(this._results[a].index=e);this.paste(i,n,this._results,o)}},random:function(t,e,i,n,r){if(r=this.getLayer(r),this.copy(t,e,i,n,r),!(this._results.length<2)){for(var s,o=[],a=1;a<this._results.length;a++)this._results[a].index&&(s=this._results[a].index,-1===o.indexOf(s)&&o.push(s));for(var l=1;l<this._results.length;l++)this._results[l].index=this.game.rnd.pick(o);this.paste(t,e,this._results,r)}},shuffle:function(t,e,i,n,r){if(r=this.getLayer(r),this.copy(t,e,i,n,r),!(this._results.length<2)){for(var s=[],o=1;o<this._results.length;o++)this._results[o].index&&s.push(this._results[o].index);U.ArrayUtils.shuffle(s);for(var a=1;a<this._results.length;a++)this._results[a].index=s[a-1];this.paste(t,e,this._results,r)}},fill:function(t,e,i,n,r,s){if(s=this.getLayer(s),this.copy(e,i,n,r,s),!(this._results.length<2)){for(var o=1;o<this._results.length;o++)this._results[o].index=t;this.paste(e,i,this._results,s)}},removeAllLayers:function(){this.layers.length=0,this.currentLayer=0},dump:function(){for(var t="",e=[""],i=0;i<this.layers[this.currentLayer].height;i++){for(var n=0;n<this.layers[this.currentLayer].width;n++)t+="%c  ",1<this.layers[this.currentLayer].data[i][n]?this.debugMap[this.layers[this.currentLayer].data[i][n]]?e.push("background: "+this.debugMap[this.layers[this.currentLayer].data[i][n]]):e.push("background: #ffffff"):e.push("background: rgb(0, 0, 0)");t+="\n"}e[0]=t},destroy:function(){this.removeAllLayers(),this.data=[],this.game=null}},U.Tilemap.prototype.constructor=U.Tilemap,Object.defineProperty(U.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(t){t!==this.currentLayer&&this.setLayer(t)}}),U.TilemapLayer=function(t,e,i,n,r){n|=0,r|=0,U.Sprite.call(this,t,0,0),this.map=e,this.index=i,this.layer=e.layers[i],this.canvas=PIXI.CanvasPool.create(this,n,r),this.context=this.canvas.getContext("2d"),this.setTexture(new PIXI.Texture(new PIXI.BaseTexture(this.canvas))),this.type=U.TILEMAPLAYER,this.physicsType=U.TILEMAPLAYER,this.renderSettings={enableScrollDelta:!1,overdrawRatio:.2,copyCanvas:null},this.debug=!1,this.exists=!0,this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:!0,debugAlpha:.5,facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"},this.scrollFactorX=1,this.scrollFactorY=1,this.dirty=!0,this.rayStepRate=4,this._wrap=!1,this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:e.tileWidth,tileHeight:e.tileHeight,cw:e.tileWidth,ch:e.tileHeight,tilesets:[]},this._scrollX=0,this._scrollY=0,this._results=[],t.device.canvasBitBltShift||(this.renderSettings.copyCanvas=U.TilemapLayer.ensureSharedCopyCanvas()),this.fixedToCamera=!0},U.TilemapLayer.prototype=Object.create(U.Sprite.prototype),U.TilemapLayer.prototype.constructor=U.TilemapLayer,U.TilemapLayer.prototype.preUpdateCore=U.Component.Core.preUpdate,U.TilemapLayer.sharedCopyCanvas=null,U.TilemapLayer.ensureSharedCopyCanvas=function(){return this.sharedCopyCanvas||(this.sharedCopyCanvas=PIXI.CanvasPool.create(this,2,2)),this.sharedCopyCanvas},U.TilemapLayer.prototype.preUpdate=function(){return this.preUpdateCore()},U.TilemapLayer.prototype.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y),this._scrollX=this.game.camera.view.x*this.scrollFactorX/this.scale.x,this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y},U.TilemapLayer.prototype._renderCanvas=function(t){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y),this._scrollX=this.game.camera.view.x*this.scrollFactorX/this.scale.x,this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y,this.render(),PIXI.Sprite.prototype._renderCanvas.call(this,t)},U.TilemapLayer.prototype._renderWebGL=function(t){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y),this._scrollX=this.game.camera.view.x*this.scrollFactorX/this.scale.x,this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y,this.render(),PIXI.Sprite.prototype._renderWebGL.call(this,t)},U.TilemapLayer.prototype.destroy=function(){PIXI.CanvasPool.remove(this),U.Component.Destroy.prototype.destroy.call(this)},U.TilemapLayer.prototype.resize=function(t,e){this.canvas.width=t,this.canvas.height=e,this.texture.frame.resize(t,e),this.texture.width=t,this.texture.height=e,this.texture.crop.width=t,this.texture.crop.height=e,this.texture.baseTexture.width=t,this.texture.baseTexture.height=e,this.texture.baseTexture.dirty(),this.texture.requiresUpdate=!0,this.texture._updateUvs(),this.dirty=!0},U.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)},U.TilemapLayer.prototype._fixX=function(t){return 1===this.scrollFactorX||0===this.scrollFactorX&&0===this.position.x?t:0===this.scrollFactorX&&0!==this.position.x?t-this.position.x:this._scrollX+(t-this._scrollX/this.scrollFactorX)},U.TilemapLayer.prototype._unfixX=function(t){return 1===this.scrollFactorX?t:this._scrollX/this.scrollFactorX+(t-this._scrollX)},U.TilemapLayer.prototype._fixY=function(t){return 1===this.scrollFactorY||0===this.scrollFactorY&&0===this.position.y?t:0===this.scrollFactorY&&0!==this.position.y?t-this.position.y:this._scrollY+(t-this._scrollY/this.scrollFactorY)},U.TilemapLayer.prototype._unfixY=function(t){return 1===this.scrollFactorY?t:this._scrollY/this.scrollFactorY+(t-this._scrollY)},U.TilemapLayer.prototype.getTileX=function(t){return Math.floor(this._fixX(t)/this._mc.tileWidth)},U.TilemapLayer.prototype.getTileY=function(t){return Math.floor(this._fixY(t)/this._mc.tileHeight)},U.TilemapLayer.prototype.getTileXY=function(t,e,i){return i.x=this.getTileX(t),i.y=this.getTileY(e),i},U.TilemapLayer.prototype.getRayCastTiles=function(t,e,i,n){e=e||this.rayStepRate,void 0===i&&(i=!1),void 0===n&&(n=!1);var r=this.getTiles(t.x,t.y,t.width,t.height,i,n);if(0===r.length)return[];for(var s=t.coordinatesOnLine(e),o=[],a=0;a<r.length;a++)for(var l=0;l<s.length;l++){var p=r[a],h=s[l];if(p.containsPoint(h[0],h[1])){o.push(p);break}}return o},U.TilemapLayer.prototype.getTiles=function(t,e,i,n,r,s){void 0===r&&(r=!1),void 0===s&&(s=!1);var o=!(r||s);t=this._fixX(t),e=this._fixY(e);for(var a=Math.floor(t/(this._mc.cw*this.scale.x)),l=Math.floor(e/(this._mc.ch*this.scale.y)),p=Math.ceil((t+i)/(this._mc.cw*this.scale.x))-a,h=Math.ceil((e+n)/(this._mc.ch*this.scale.y))-l;this._results.length;)this._results.pop();for(var u=l;u<l+h;u++)for(var c=a;c<a+p;c++){var d=this.layer.data[u];d&&d[c]&&(o||d[c].isInteresting(r,s))&&this._results.push(d[c])}return this._results.slice()},U.TilemapLayer.prototype.resolveTileset=function(t){var e=this._mc.tilesets;if(t<2e3)for(;e.length<t;)e.push(void 0);var i=this.map.tiles[t]&&this.map.tiles[t][2];if(null!==i){i=this.map.tilesets[i];if(i&&i.containsTileIndex(t))return e[t]=i}return e[t]=null},U.TilemapLayer.prototype.resetTilesetCache=function(){for(var t=this._mc.tilesets;t.length;)t.pop()},U.TilemapLayer.prototype.setScale=function(t,e){t=t||1,e=e||t;for(var i=0;i<this.layer.data.length;i++)for(var n=this.layer.data[i],r=0;r<n.length;r++){var s=n[r];s.width=this.map.tileWidth*t,s.height=this.map.tileHeight*e,s.worldX=s.x*s.width,s.worldY=s.y*s.height}this.scale.setTo(t,e)},U.TilemapLayer.prototype.shiftCanvas=function(t,e,i){var n=t.canvas,r=n.width-Math.abs(e),s=n.height-Math.abs(i),o=0,a=0,l=e,p=i;e<0&&(o=-e,l=0),i<0&&(a=-i,p=0);e=this.renderSettings.copyCanvas;e?((e.width<r||e.height<s)&&(e.width=r,e.height=s),(i=e.getContext("2d")).clearRect(0,0,r,s),i.drawImage(n,o,a,r,s,0,0,r,s),t.clearRect(l,p,r,s),t.drawImage(e,0,0,r,s,l,p,r,s)):(t.save(),t.globalCompositeOperation="copy",t.drawImage(n,o,a,r,s,l,p,r,s),t.restore())},U.TilemapLayer.prototype.renderRegion=function(t,e,i,n,r,s){var o=this.context,a=this.layer.width,l=this.layer.height,p=this._mc.tileWidth,h=this._mc.tileHeight,u=this._mc.tilesets,c=NaN;this._wrap||(i<=r&&(i=Math.max(0,i),r=Math.min(a-1,r)),n<=s&&(n=Math.max(0,n),s=Math.min(l-1,s)));for(var d=i*p-t,_=(i+(1<<20)*a)%a,y=(n+(1<<20)*l)%l,f=s-n,m=n*h-e;0<=f;y++,f--,m+=h){l<=y&&(y-=l);for(var x=this.layer.data[y],v=_,g=r-i,b=d;0<=g;v++,g--,b+=p){a<=v&&(v-=a);var z,w,C=x[v];!C||C.index<0||(void 0===(w=u[z=C.index])&&(w=this.resolveTileset(z)),C.alpha===c||this.debug||(o.globalAlpha=C.alpha,c=C.alpha),w?C.rotation||C.flipped?(o.save(),o.translate(b+C.centerX,m+C.centerY),o.rotate(C.rotation),C.flipped&&o.scale(-1,1),w.draw(o,-C.centerX,-C.centerY,z),o.restore()):w.draw(o,b,m,z):this.debugSettings.missingImageFill&&(o.fillStyle=this.debugSettings.missingImageFill,o.fillRect(b,m,p,h)),C.debug&&this.debugSettings.debuggedTileOverfill&&(o.fillStyle=this.debugSettings.debuggedTileOverfill,o.fillRect(b,m,p,h)))}}},U.TilemapLayer.prototype.renderDeltaScroll=function(t,e){var i=this._mc.scrollX,n=this._mc.scrollY,r=this.canvas.width,s=this.canvas.height,o=this._mc.tileWidth,a=this._mc.tileHeight,l=0,p=-o,h=0,u=-a;t<0?(l=r+t,p=r-1):0<t&&(p=t),e<0?(h=s+e,u=s-1):0<e&&(u=e),this.shiftCanvas(this.context,t,e),l=Math.floor((l+i)/o),p=Math.floor((p+i)/o),h=Math.floor((h+n)/a),u=Math.floor((u+n)/a),l<=p&&(this.context.clearRect(l*o-i,0,(p-l+1)*o,s),e=Math.floor((0+n)/a),s=Math.floor((s-1+n)/a),this.renderRegion(i,n,l,e,p,s)),h<=u&&(this.context.clearRect(0,h*a-n,r,(u-h+1)*a),a=Math.floor((0+i)/o),o=Math.floor((r-1+i)/o),this.renderRegion(i,n,a,h,o,u))},U.TilemapLayer.prototype.renderFull=function(){var t=this._mc.scrollX,e=this._mc.scrollY,i=this.canvas.width,n=this.canvas.height,r=this._mc.tileWidth,s=this._mc.tileHeight,o=Math.floor(t/r),a=Math.floor((i-1+t)/r),r=Math.floor(e/s),s=Math.floor((n-1+e)/s);this.context.clearRect(0,0,i,n),this.renderRegion(t,e,o,r,a,s)},U.TilemapLayer.prototype.render=function(){var t=!1;if(this.visible){(this.dirty||this.layer.dirty)&&(t=!(this.layer.dirty=!1));var e=this.canvas.width,i=this.canvas.height,n=0|this._scrollX,r=0|this._scrollY,s=this._mc,o=s.scrollX-n,a=s.scrollY-r;if(t||0!=o||0!=a||s.renderWidth!==e||s.renderHeight!==i)return this.context.save(),s.scrollX=n,s.scrollY=r,s.renderWidth===e&&s.renderHeight===i||(s.renderWidth=e,s.renderHeight=i),this.debug&&(this.context.globalAlpha=this.debugSettings.debugAlpha,this.debugSettings.forceFullRedraw&&(t=!0)),!t&&this.renderSettings.enableScrollDelta&&Math.abs(o)+Math.abs(a)<Math.min(e,i)?this.renderDeltaScroll(o,a):this.renderFull(),this.debug&&(this.context.globalAlpha=1,this.renderDebug()),this.texture.baseTexture.dirty(),this.dirty=!1,this.context.restore(),!0}},U.TilemapLayer.prototype.renderDebug=function(){var t,e,i,n=this._mc.scrollX,r=this._mc.scrollY,s=this.context,o=this.canvas.width,a=this.canvas.height,l=this.layer.width,p=this.layer.height,h=this._mc.tileWidth,u=this._mc.tileHeight,c=Math.floor(n/h),d=Math.floor((o-1+n)/h),o=Math.floor(r/u),a=Math.floor((a-1+r)/u),_=c*h-n,n=o*u-r,y=(c+(1<<20)*l)%l,r=(o+(1<<20)*p)%p;for(s.strokeStyle=this.debugSettings.facingEdgeStroke,e=r,i=a-o,t=n;0<=i;e++,i--,t+=u){p<=e&&(e-=p);for(var f=this.layer.data[e],m=y,x=d-c,v=_;0<=x;m++,x--,v+=h){l<=m&&(m-=l);var g=f[m];!g||g.index<0||!g.collides||(this.debugSettings.collidingTileOverfill&&(s.fillStyle=this.debugSettings.collidingTileOverfill,s.fillRect(v,t,this._mc.cw,this._mc.ch)),this.debugSettings.facingEdgeStroke&&(s.beginPath(),g.faceTop&&(s.moveTo(v,t),s.lineTo(v+this._mc.cw,t)),g.faceBottom&&(s.moveTo(v,t+this._mc.ch),s.lineTo(v+this._mc.cw,t+this._mc.ch)),g.faceLeft&&(s.moveTo(v,t),s.lineTo(v,t+this._mc.ch)),g.faceRight&&(s.moveTo(v+this._mc.cw,t),s.lineTo(v+this._mc.cw,t+this._mc.ch)),s.closePath(),s.stroke()))}}},Object.defineProperty(U.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(t){this._wrap=t,this.dirty=!0}}),Object.defineProperty(U.TilemapLayer.prototype,"scrollX",{get:function(){return this._scrollX},set:function(t){this._scrollX=t}}),Object.defineProperty(U.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(t){this._scrollY=t}}),Object.defineProperty(U.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(t){this._mc.cw=0|t,this.dirty=!0}}),Object.defineProperty(U.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(t){this._mc.ch=0|t,this.dirty=!0}}),U.TilemapParser={INSERT_NULL:!1,parse:function(t,e,i,n,r,s){if(void 0===i&&(i=32),void 0===n&&(n=32),void 0===r&&(r=10),void 0===s&&(s=10),void 0===e)return this.getEmptyData();if(null===e)return this.getEmptyData(i,n,r,s);t=t.cache.getTilemapData(e);return t?t.format===U.Tilemap.CSV?this.parseCSV(e,t.data,i,n):t.format&&t.format!==U.Tilemap.TILED_JSON?void 0:this.parseTiledJSON(t.data):void 0},parseCSV:function(t,e,i,n){for(var r=this.getEmptyData(),s=[],o=(e=e.trim()).split("\n"),e=o.length,a=0,l=0;l<o.length;l++){s[l]=[];for(var p=o[l].split(","),h=0;h<p.length;h++)s[l][h]=new U.Tile(r.layers[0],parseInt(p[h],10),h,l,i,n);0===a&&(a=p.length)}return r.format=U.Tilemap.CSV,r.name=t,r.width=a,r.height=e,r.tileWidth=i,r.tileHeight=n,r.widthInPixels=a*i,r.heightInPixels=e*n,r.layers[0].width=a,r.layers[0].height=e,r.layers[0].widthInPixels=r.widthInPixels,r.layers[0].heightInPixels=r.heightInPixels,r.layers[0].data=s,r},getEmptyData:function(t,e,i,n){return{width:null!=i?i:0,height:null!=n?n:0,tileWidth:null!=t?t:0,tileHeight:null!=e?e:0,orientation:"orthogonal",version:"1",properties:{},widthInPixels:0,heightInPixels:0,layers:[{name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:[]}],images:[],objects:{},collision:{},tilesets:[],tiles:[]}},parseTiledJSON:function(t){function e(t,e){var i,n={};for(i in e){var r=e[i];void 0!==t[r]&&(n[r]=t[r])}return n}if("orthogonal"!==t.orientation)return null;for(var i={width:t.width,height:t.height,tileWidth:t.tilewidth,tileHeight:t.tileheight,orientation:t.orientation,format:U.Tilemap.TILED_JSON,version:t.version,properties:t.properties,widthInPixels:t.width*t.tilewidth,heightInPixels:t.height*t.tileheight},n=[],r=0;r<t.layers.length;r++)if("tilelayer"===t.layers[r].type){var s=t.layers[r];if(!s.compression&&s.encoding&&"base64"===s.encoding){for(var o=window.atob(s.data),a=o.length,l=new Array(a),p=0;p<a;p+=4)l[p/4]=(o.charCodeAt(p)|o.charCodeAt(p+1)<<8|o.charCodeAt(p+2)<<16|o.charCodeAt(p+3)<<24)>>>0;s.data=l,delete s.encoding}else if(s.compression)continue;var h={name:s.name,x:s.x,y:s.y,width:s.width,height:s.height,widthInPixels:s.width*t.tilewidth,heightInPixels:s.height*t.tileheight,alpha:s.opacity,visible:s.visible,properties:{},indexes:[],callbacks:[],bodies:[]};s.properties&&(h.properties=s.properties);for(var u,c,d,_=0,y=[],f=[],m=0,a=s.data.length;m<a;m++){if(c=!1,d=u=0,536870912<(S=s.data[m]))switch(2147483648<S&&(S-=2147483648,d+=4),1073741824<S&&(S-=1073741824,d+=2),536870912<S&&(S-=536870912,d+=1),d){case 5:u=Math.PI/2;break;case 6:u=Math.PI;break;case 3:u=3*Math.PI/2;break;case 4:c=!(u=0);break;case 7:u=Math.PI/2,c=!0;break;case 2:u=Math.PI,c=!0;break;case 1:u=3*Math.PI/2,c=!0}0<S?((F=new U.Tile(h,S,_,f.length,t.tilewidth,t.tileheight)).rotation=u,F.flipped=c,0!==d&&(F.flippedVal=d),y.push(F)):U.TilemapParser.INSERT_NULL?y.push(null):y.push(new U.Tile(h,-1,_,f.length,t.tilewidth,t.tileheight)),++_===s.width&&(f.push(y),_=0,y=[])}h.data=f,n.push(h)}i.layers=n;for(var x,v=[],r=0;r<t.layers.length;r++)"imagelayer"===t.layers[r].type&&(T={name:(x=t.layers[r]).name,image:x.image,x:x.x,y:x.y,alpha:x.opacity,visible:x.visible,properties:{}},x.properties&&(T.properties=x.properties),v.push(T));i.images=v;for(var g=[],b=[],z=null,r=0;r<t.tilesets.length;r++){if((N=t.tilesets[r]).image){var w=new U.Tileset(N.name,N.firstgid,N.tilewidth,N.tileheight,N.margin,N.spacing,N.properties);N.tileproperties&&(w.tileProperties=N.tileproperties),w.updateTileData(N.imagewidth,N.imageheight),g.push(w)}else{var C,P=new U.ImageCollection(N.name,N.firstgid,N.tilewidth,N.tileheight,N.margin,N.spacing,N.properties);for(C in N.tiles){var T=N.tiles[C].image,S=N.firstgid+parseInt(C,10);P.addImage(S,T)}b.push(P)}z&&(z.lastgid=N.firstgid-1),z=N}i.tilesets=g,i.imagecollections=b;for(var M={},A={},r=0;r<t.layers.length;r++)if("objectgroup"===t.layers[r].type){var O=t.layers[r];M[O.name]=[],A[O.name]=[];for(var k=0,a=O.objects.length;k<a;k++)if(O.objects[k].gid){var E={gid:O.objects[k].gid,name:O.objects[k].name,type:O.objects[k].hasOwnProperty("type")?O.objects[k].type:"",x:O.objects[k].x,y:O.objects[k].y,visible:O.objects[k].visible,properties:O.objects[k].properties};O.objects[k].rotation&&(E.rotation=O.objects[k].rotation),M[O.name].push(E)}else if(O.objects[k].polyline){var E={name:O.objects[k].name,type:O.objects[k].type,x:O.objects[k].x,y:O.objects[k].y,width:O.objects[k].width,height:O.objects[k].height,visible:O.objects[k].visible,properties:O.objects[k].properties};O.objects[k].rotation&&(E.rotation=O.objects[k].rotation),E.polyline=[];for(var I=0;I<O.objects[k].polyline.length;I++)E.polyline.push([O.objects[k].polyline[I].x,O.objects[k].polyline[I].y]);A[O.name].push(E),M[O.name].push(E)}else if(O.objects[k].polygon){(E=e(O.objects[k],["name","type","x","y","visible","rotation","properties"])).polygon=[];for(I=0;I<O.objects[k].polygon.length;I++)E.polygon.push([O.objects[k].polygon[I].x,O.objects[k].polygon[I].y]);M[O.name].push(E)}else O.objects[k].ellipse?E=e(O.objects[k],["name","type","ellipse","x","y","width","height","visible","rotation","properties"]):(E=e(O.objects[k],["name","type","x","y","width","height","visible","rotation","properties"])).rectangle=!0,M[O.name].push(E)}i.objects=M,i.collision=A,i.tiles=[];for(r=0;r<i.tilesets.length;r++)for(var _=(N=i.tilesets[r]).tileMargin,D=N.tileMargin,B=0,L=0,R=0,m=N.firstgid;m<N.firstgid+N.total&&(i.tiles[m]=[_,D,r],_+=N.tileWidth+N.tileSpacing,++B!==N.total)&&(++L!==N.columns||(_=N.tileMargin,D+=N.tileHeight+N.tileSpacing,L=0,++R!==N.rows));m++);for(var F,j,N,r=0;r<i.layers.length;r++){h=i.layers[r],N=null;for(p=0;p<h.data.length;p++){y=h.data[p];for(var G=0;G<y.length;G++)null===(F=y[G])||F.index<0||(j=i.tiles[F.index][2],(N=i.tilesets[j]).tileProperties&&N.tileProperties[F.index-N.firstgid]&&(F.properties=U.Utils.mixin(N.tileProperties[F.index-N.firstgid],F.properties)))}}return i}},U.Tileset=function(t,e,i,n,r,s,o){(void 0===i||i<=0)&&(i=32),(void 0===n||n<=0)&&(n=32),void 0===r&&(r=0),void 0===s&&(s=0),this.name=t,this.firstgid=0|e,this.tileWidth=0|i,this.tileHeight=0|n,this.tileMargin=0|r,this.tileSpacing=0|s,this.properties=o||{},this.image=null,this.rows=0,this.columns=0,this.total=0,this.drawCoords=[]},U.Tileset.prototype={draw:function(t,e,i,n){n=n-this.firstgid<<1;0<=n&&1+n<this.drawCoords.length&&t.drawImage(this.image,this.drawCoords[n],this.drawCoords[1+n],this.tileWidth,this.tileHeight,e,i,this.tileWidth,this.tileHeight)},containsTileIndex:function(t){return t>=this.firstgid&&t<this.firstgid+this.total},setImage:function(t){this.image=t,this.updateTileData(t.width,t.height)},setSpacing:function(t,e){this.tileMargin=0|t,this.tileSpacing=0|e,this.image&&this.updateTileData(this.image.width,this.image.height)},updateTileData:function(t,e){e=(e-2*this.tileMargin+this.tileSpacing)/(this.tileHeight+this.tileSpacing),t=(t-2*this.tileMargin+this.tileSpacing)/(this.tileWidth+this.tileSpacing),e=Math.floor(e),t=Math.floor(t);this.rows&&this.rows!==e||this.columns&&this.columns,this.rows=e,this.columns=t,this.total=e*t,this.drawCoords.length=0;for(var i=this.tileMargin,n=this.tileMargin,r=0;r<this.rows;r++){for(var s=0;s<this.columns;s++)this.drawCoords.push(i),this.drawCoords.push(n),i+=this.tileWidth+this.tileSpacing;i=this.tileMargin,n+=this.tileHeight+this.tileSpacing}}},U.Tileset.prototype.constructor=U.Tileset,U.Particle=function(t,e,i,n,r){U.Sprite.call(this,t,e,i,n,r),this.autoScale=!1,this.scaleData=null,this._s=0,this.autoAlpha=!1,this.alphaData=null,this._a=0},U.Particle.prototype=Object.create(U.Sprite.prototype),U.Particle.prototype.constructor=U.Particle,U.Particle.prototype.update=function(){this.autoScale&&(this._s--,this._s?this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y):this.autoScale=!1),this.autoAlpha&&(this._a--,this._a?this.alpha=this.alphaData[this._a].v:this.autoAlpha=!1)},U.Particle.prototype.onEmit=function(){},U.Particle.prototype.setAlphaData=function(t){this.alphaData=t,this._a=t.length-1,this.alpha=this.alphaData[this._a].v,this.autoAlpha=!0},U.Particle.prototype.setScaleData=function(t){this.scaleData=t,this._s=t.length-1,this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y),this.autoScale=!0},U.Particle.prototype.reset=function(t,e,i){return U.Component.Reset.prototype.reset.call(this,t,e,i),this.alpha=1,this.scale.set(1),this.autoScale=!1,this.autoAlpha=!1,this},U.Particles=function(t){this.game=t,this.emitters={},this.ID=0},U.Particles.prototype={add:function(t){return this.emitters[t.name]=t},remove:function(t){delete this.emitters[t.name]},update:function(){for(var t in this.emitters)this.emitters[t].exists&&this.emitters[t].update()}},U.Particles.prototype.constructor=U.Particles,U.Particles.Arcade={},U.Particles.Arcade.Emitter=function(t,e,i,n){this.maxParticles=n||50,U.Group.call(this,t),this.name="emitter"+this.game.particles.ID++,this.type=U.EMITTER,this.physicsType=U.GROUP,this.area=new U.Rectangle(e,i,1,1),this.minParticleSpeed=new U.Point(-100,-100),this.maxParticleSpeed=new U.Point(100,100),this.minParticleScale=1,this.maxParticleScale=1,this.scaleData=null,this.minRotation=-360,this.maxRotation=360,this.minParticleAlpha=1,this.maxParticleAlpha=1,this.alphaData=null,this.gravity=100,this.particleClass=U.Particle,this.particleDrag=new U.Point,this.angularDrag=0,this.frequency=100,this.lifespan=2e3,this.bounce=new U.Point,this.on=!1,this.particleAnchor=new U.Point(.5,.5),this.blendMode=U.blendModes.NORMAL,this.emitX=e,this.emitY=i,this.autoScale=!1,this.autoAlpha=!1,this.particleBringToTop=!1,this.particleSendToBack=!1,this._minParticleScale=new U.Point(1,1),this._maxParticleScale=new U.Point(1,1),this._quantity=0,this._timer=0,this._counter=0,this._flowQuantity=0,this._flowTotal=0,this._explode=!0,this._frames=null},U.Particles.Arcade.Emitter.prototype=Object.create(U.Group.prototype),U.Particles.Arcade.Emitter.prototype.constructor=U.Particles.Arcade.Emitter,U.Particles.Arcade.Emitter.prototype.update=function(){if(this.on&&this.game.time.time>=this._timer)if(this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion,0!==this._flowTotal)if(0<this._flowQuantity){for(var t=0;t<this._flowQuantity;t++)if(this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal)){this.on=!1;break}}else this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal&&(this.on=!1));else this.emitParticle()&&(this._counter++,0<this._quantity&&this._counter>=this._quantity&&(this.on=!1));for(t=this.children.length;t--;)this.children[t].exists&&this.children[t].update()},U.Particles.Arcade.Emitter.prototype.makeParticles=function(t,e,i,n,r){void 0===e&&(e=0),void 0===i&&(i=this.maxParticles),void 0===n&&(n=!1),void 0===r&&(r=!1);var s,o=0,a=t,l=e;for(this._frames=e,i>this.maxParticles&&(this.maxParticles=i);o<i;)Array.isArray(t)&&(a=this.game.rnd.pick(t)),Array.isArray(e)&&(l=this.game.rnd.pick(e)),s=new this.particleClass(this.game,0,0,a,l),this.game.physics.arcade.enable(s,!1),n?(s.body.checkCollision.any=!0,s.body.checkCollision.none=!1):s.body.checkCollision.none=!0,s.body.collideWorldBounds=r,s.body.skipQuadTree=!0,s.exists=!1,s.visible=!1,s.anchor.copyFrom(this.particleAnchor),this.add(s),o++;return this},U.Particles.Arcade.Emitter.prototype.kill=function(){return this.on=!1,this.alive=!1,this.exists=!1,this},U.Particles.Arcade.Emitter.prototype.revive=function(){return this.alive=!0,this.exists=!0,this},U.Particles.Arcade.Emitter.prototype.explode=function(t,e){return this._flowTotal=0,this.start(!0,t,0,e,!1),this},U.Particles.Arcade.Emitter.prototype.flow=function(t,e,i,n,r){return void 0!==i&&0!==i||(i=1),void 0===n&&(n=-1),void 0===r&&(r=!0),i>this.maxParticles&&(i=this.maxParticles),this._counter=0,this._flowQuantity=i,this._flowTotal=n,r?(this.start(!0,t,e,i),this._counter+=i,this.on=!0,this._timer=this.game.time.time+e*this.game.time.slowMotion):this.start(!1,t,e,i),this},U.Particles.Arcade.Emitter.prototype.start=function(t,e,i,n,r){if(void 0===t&&(t=!0),void 0===e&&(e=0),null!=i||(i=250),void 0===n&&(n=0),void 0===r&&(r=!1),n>this.maxParticles&&(n=this.maxParticles),this.revive(),this.visible=!0,this.lifespan=e,this.frequency=i,t||r)for(var s=0;s<n;s++)this.emitParticle();else this.on=!0,this._quantity=n,this._counter=0,this._timer=this.game.time.time+i*this.game.time.slowMotion;return this},U.Particles.Arcade.Emitter.prototype.emitParticle=function(t,e,i,n){void 0===t&&(t=null),void 0===e&&(e=null);var r=this.getFirstExists(!1);if(null===r)return!1;var s=this.game.rnd;void 0!==i&&void 0!==n?r.loadTexture(i,n):void 0!==i&&r.loadTexture(i);var o=this.emitX,i=this.emitY;null!==t?o=t:1<this.width&&(o=s.between(this.left,this.right)),null!==e?i=e:1<this.height&&(i=s.between(this.top,this.bottom)),r.reset(o,i),r.angle=0,r.lifespan=this.lifespan,this.particleBringToTop?this.bringToTop(r):this.particleSendToBack&&this.sendToBack(r),this.autoScale?r.setScaleData(this.scaleData):1!==this.minParticleScale||1!==this.maxParticleScale?r.scale.set(s.realInRange(this.minParticleScale,this.maxParticleScale)):this._minParticleScale.x===this._maxParticleScale.x&&this._minParticleScale.y===this._maxParticleScale.y||r.scale.set(s.realInRange(this._minParticleScale.x,this._maxParticleScale.x),s.realInRange(this._minParticleScale.y,this._maxParticleScale.y)),void 0===n&&(Array.isArray(this._frames)?r.frame=this.game.rnd.pick(this._frames):r.frame=this._frames),this.autoAlpha?r.setAlphaData(this.alphaData):r.alpha=s.realInRange(this.minParticleAlpha,this.maxParticleAlpha),r.blendMode=this.blendMode;n=r.body;return n.updateBounds(),n.bounce.copyFrom(this.bounce),n.drag.copyFrom(this.particleDrag),n.velocity.x=s.between(this.minParticleSpeed.x,this.maxParticleSpeed.x),n.velocity.y=s.between(this.minParticleSpeed.y,this.maxParticleSpeed.y),n.angularVelocity=s.between(this.minRotation,this.maxRotation),n.gravity.y=this.gravity,n.angularDrag=this.angularDrag,r.onEmit(),!0},U.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this),U.Group.prototype.destroy.call(this,!0,!1)},U.Particles.Arcade.Emitter.prototype.setSize=function(t,e){return this.area.width=t,this.area.height=e,this},U.Particles.Arcade.Emitter.prototype.setXSpeed=function(t,e){return t=t||0,e=e||0,this.minParticleSpeed.x=t,this.maxParticleSpeed.x=e,this},U.Particles.Arcade.Emitter.prototype.setYSpeed=function(t,e){return t=t||0,e=e||0,this.minParticleSpeed.y=t,this.maxParticleSpeed.y=e,this},U.Particles.Arcade.Emitter.prototype.setRotation=function(t,e){return t=t||0,e=e||0,this.minRotation=t,this.maxRotation=e,this},U.Particles.Arcade.Emitter.prototype.setAlpha=function(t,e,i,n,r){return void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=0),void 0===n&&(n=U.Easing.Linear.None),void 0===r&&(r=!1),this.minParticleAlpha=t,this.maxParticleAlpha=e,this.autoAlpha=!1,0<i&&t!==e&&(t={v:t},(n=this.game.make.tween(t).to({v:e},i,n)).yoyo(r),this.alphaData=n.generateData(60),this.alphaData.reverse(),this.autoAlpha=!0),this},U.Particles.Arcade.Emitter.prototype.setScale=function(t,e,i,n,r,s,o){return void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n=1),void 0===r&&(r=0),void 0===s&&(s=U.Easing.Linear.None),void 0===o&&(o=!1),this.minParticleScale=1,this.maxParticleScale=1,this._minParticleScale.set(t,i),this._maxParticleScale.set(e,n),this.autoScale=!1,0<r&&(t!==e||i!==n)&&(i={x:t,y:i},(s=this.game.make.tween(i).to({x:e,y:n},r,s)).yoyo(o),this.scaleData=s.generateData(60),this.scaleData.reverse(),this.autoScale=!0),this},U.Particles.Arcade.Emitter.prototype.at=function(t){return t.center?(this.emitX=t.center.x,this.emitY=t.center.y):(this.emitX=t.world.x+t.anchor.x*t.width,this.emitY=t.world.y+t.anchor.y*t.height),this},Object.defineProperty(U.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(t){this.area.width=t}}),Object.defineProperty(U.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(t){this.area.height=t}}),Object.defineProperty(U.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(t){this.emitX=t}}),Object.defineProperty(U.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(t){this.emitY=t}}),Object.defineProperty(U.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.area.width/2)}}),Object.defineProperty(U.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.area.width/2)}}),Object.defineProperty(U.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.area.height/2)}}),Object.defineProperty(U.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+this.area.height/2)}}),U.Weapon=function(t,e){U.Plugin.call(this,t,e),this.bullets=null,this.autoExpandBulletsGroup=!1,this.autofire=!1,this.shots=0,this.fireLimit=0,this.fireRate=100,this.fireRateVariance=0,this.fireFrom=new U.Rectangle(0,0,1,1),this.fireAngle=U.ANGLE_UP,this.bulletInheritSpriteSpeed=!1,this.bulletAnimation="",this.bulletFrameRandom=!1,this.bulletFrameCycle=!1,this.bulletWorldWrap=!1,this.bulletWorldWrapPadding=0,this.bulletAngleOffset=0,this.bulletAngleVariance=0,this.bulletSpeed=200,this.bulletSpeedVariance=0,this.bulletLifespan=0,this.bulletKillDistance=0,this.bulletGravity=new U.Point(0,0),this.bulletRotateToVelocity=!1,this.bulletKey="",this.bulletFrame="",this._bulletClass=U.Bullet,this._bulletCollideWorldBounds=!1,this._bulletKillType=U.Weapon.KILL_WORLD_BOUNDS,this._data={customBody:!1,width:0,height:0,offsetX:0,offsetY:0},this.bounds=new U.Rectangle,this.bulletBounds=t.world.bounds,this.bulletFrames=[],this.bulletFrameIndex=0,this.anims={},this.onFire=new U.Signal,this.onKill=new U.Signal,this.onFireLimit=new U.Signal,this.trackedSprite=null,this.trackedPointer=null,this.trackRotation=!1,this.trackOffset=new U.Point,this._nextFire=0,this._rotatedPoint=new U.Point},U.Weapon.prototype=Object.create(U.Plugin.prototype),U.Weapon.prototype.constructor=U.Weapon,U.Weapon.KILL_NEVER=0,U.Weapon.KILL_LIFESPAN=1,U.Weapon.KILL_DISTANCE=2,U.Weapon.KILL_WEAPON_BOUNDS=3,U.Weapon.KILL_CAMERA_BOUNDS=4,U.Weapon.KILL_WORLD_BOUNDS=5,U.Weapon.KILL_STATIC_BOUNDS=6,U.Weapon.prototype.createBullets=function(t,e,i,n){return void 0===t&&(t=1),void 0===n&&(n=this.game.world),this.bullets||(this.bullets=this.game.add.physicsGroup(U.Physics.ARCADE,n),this.bullets.classType=this._bulletClass),0!==t&&(-1===t&&(this.autoExpandBulletsGroup=!0,t=1),this.bullets.createMultiple(t,e,i),this.bullets.setAll("data.bulletManager",this),this.bulletKey=e,this.bulletFrame=i),this},U.Weapon.prototype.forEach=function(t,e){return this.bullets.forEachExists(t,e,arguments),this},U.Weapon.prototype.pauseAll=function(){return this.bullets.setAll("body.enable",!1),this},U.Weapon.prototype.resumeAll=function(){return this.bullets.setAll("body.enable",!0),this},U.Weapon.prototype.killAll=function(){return this.bullets.callAllExists("kill",!0),this.bullets.setAll("body.enable",!0),this},U.Weapon.prototype.resetShots=function(t){return void(this.shots=0)!==t&&(this.fireLimit=t),this},U.Weapon.prototype.destroy=function(){this.parent.remove(this,!1),this.bullets.destroy(),this.game=null,this.parent=null,this.active=!1,this.visible=!1},U.Weapon.prototype.update=function(){this._bulletKillType===U.Weapon.KILL_WEAPON_BOUNDS&&(this.trackedSprite?(this.trackedSprite.updateTransform(),this.bounds.centerOn(this.trackedSprite.worldPosition.x,this.trackedSprite.worldPosition.y)):this.trackedPointer&&this.bounds.centerOn(this.trackedPointer.worldX,this.trackedPointer.worldY)),this.autofire&&this.fire()},U.Weapon.prototype.trackSprite=function(t,e,i,n){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=!1),this.trackedPointer=null,this.trackedSprite=t,this.trackRotation=n,this.trackOffset.set(e,i),this},U.Weapon.prototype.trackPointer=function(t,e,i){return void 0===t&&(t=this.game.input.activePointer),void 0===e&&(e=0),void 0===i&&(i=0),this.trackedPointer=t,this.trackedSprite=null,this.trackRotation=!1,this.trackOffset.set(e,i),this},U.Weapon.prototype.fire=function(t,e,i){if(this.game.time.now<this._nextFire||0<this.fireLimit&&this.shots===this.fireLimit)return!1;var n=this.bulletSpeed;0!==this.bulletSpeedVariance&&(n+=U.Math.between(-this.bulletSpeedVariance,this.bulletSpeedVariance)),t?1<this.fireFrom.width?this.fireFrom.centerOn(t.x,t.y):(this.fireFrom.x=t.x,this.fireFrom.y=t.y):this.trackedSprite?(this.trackRotation?(this._rotatedPoint.set(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y),this._rotatedPoint.rotate(this.trackedSprite.world.x,this.trackedSprite.world.y,this.trackedSprite.rotation),1<this.fireFrom.width?this.fireFrom.centerOn(this._rotatedPoint.x,this._rotatedPoint.y):(this.fireFrom.x=this._rotatedPoint.x,this.fireFrom.y=this._rotatedPoint.y)):1<this.fireFrom.width?this.fireFrom.centerOn(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y):(this.fireFrom.x=this.trackedSprite.world.x+this.trackOffset.x,this.fireFrom.y=this.trackedSprite.world.y+this.trackOffset.y),this.bulletInheritSpriteSpeed&&(n+=this.trackedSprite.body.speed)):this.trackedPointer&&(1<this.fireFrom.width?this.fireFrom.centerOn(this.trackedPointer.world.x+this.trackOffset.x,this.trackedPointer.world.y+this.trackOffset.y):(this.fireFrom.x=this.trackedPointer.world.x+this.trackOffset.x,this.fireFrom.y=this.trackedPointer.world.y+this.trackOffset.y));var r=1<this.fireFrom.width?this.fireFrom.randomX:this.fireFrom.x,s=1<this.fireFrom.height?this.fireFrom.randomY:this.fireFrom.y,o=this.trackRotation?this.trackedSprite.angle:this.fireAngle;void 0!==e&&void 0!==i&&(o=this.game.math.radToDeg(Math.atan2(i-s,e-r))),0!==this.bulletAngleVariance&&(o+=U.Math.between(-this.bulletAngleVariance,this.bulletAngleVariance));t=0,i=0;0===o||180===o?t=Math.cos(this.game.math.degToRad(o))*n:i=(90===o||270===o||(t=Math.cos(this.game.math.degToRad(o))*n),Math.sin(this.game.math.degToRad(o))*n);e=null;return this.autoExpandBulletsGroup?(e=this.bullets.getFirstExists(!1,!0,r,s,this.bulletKey,this.bulletFrame)).data.bulletManager=this:e=this.bullets.getFirstExists(!1),e&&(e.reset(r,s),e.data.fromX=r,e.data.fromY=s,e.data.killType=this.bulletKillType,e.data.killDistance=this.bulletKillDistance,e.data.rotateToVelocity=this.bulletRotateToVelocity,this.bulletKillType===U.Weapon.KILL_LIFESPAN&&(e.lifespan=this.bulletLifespan),e.angle=o+this.bulletAngleOffset,""!==this.bulletAnimation?(null===e.animations.getAnimation(this.bulletAnimation)&&(o=this.anims[this.bulletAnimation],e.animations.add(o.name,o.frames,o.frameRate,o.loop,o.useNumericIndex)),e.animations.play(this.bulletAnimation)):this.bulletFrameCycle?(e.frame=this.bulletFrames[this.bulletFrameIndex],++this.bulletFrameIndex>=this.bulletFrames.length&&(this.bulletFrameIndex=0)):this.bulletFrameRandom&&(e.frame=this.bulletFrames[Math.floor(Math.random()*this.bulletFrames.length)]),e.data.bodyDirty&&(this._data.customBody&&e.body.setSize(this._data.width,this._data.height,this._data.offsetX,this._data.offsetY),e.body.collideWorldBounds=this.bulletCollideWorldBounds,e.data.bodyDirty=!1),e.body.velocity.set(t,i),e.body.gravity.set(this.bulletGravity.x,this.bulletGravity.y),0!==this.bulletSpeedVariance?(i=this.fireRate,(i+=U.Math.between(-this.fireRateVariance,this.fireRateVariance))<0&&(i=0),this._nextFire=this.game.time.now+i):this._nextFire=this.game.time.now+this.fireRate,this.shots++,this.onFire.dispatch(e,this,n),0<this.fireLimit&&this.shots===this.fireLimit&&this.onFireLimit.dispatch(this,this.fireLimit)),e},U.Weapon.prototype.fireAtPointer=function(t){return void 0===t&&(t=this.game.input.activePointer),this.fire(null,t.worldX,t.worldY)},U.Weapon.prototype.fireAtSprite=function(t){return this.fire(null,t.world.x,t.world.y)},U.Weapon.prototype.fireAtXY=function(t,e){return this.fire(null,t,e)},U.Weapon.prototype.setBulletBodyOffset=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),this._data.customBody=!0,this._data.width=t,this._data.height=e,this._data.offsetX=i,this._data.offsetY=n,this.bullets.callAll("body.setSize","body",t,e,i,n),this.bullets.setAll("data.bodyDirty",!1),this},U.Weapon.prototype.setBulletFrames=function(t,e,i,n){return void 0===i&&(i=!0),void 0===n&&(n=!1),this.bulletFrames=U.ArrayUtils.numberArray(t,e),this.bulletFrameIndex=0,this.bulletFrameCycle=i,this.bulletFrameRandom=n,this},U.Weapon.prototype.addBulletAnimation=function(t,e,i,n,r){return this.anims[t]={name:t,frames:e,frameRate:i,loop:n,useNumericIndex:r},this.bullets.callAll("animations.add","animations",t,e,i,n,r),this.bulletAnimation=t,this},U.Weapon.prototype.debug=function(t,e,i){void 0===t&&(t=16),void 0===e&&(e=32),void 0===i&&(i=!1),this.game.debug.text("Weapon Plugin",t,e),this.game.debug.text("Bullets Alive: "+this.bullets.total+" - Total: "+this.bullets.length,t,e+24),i&&this.bullets.forEachExists(this.game.debug.body,this.game.debug,"rgba(255, 0, 255, 0.8)")},Object.defineProperty(U.Weapon.prototype,"bulletClass",{get:function(){return this._bulletClass},set:function(t){this._bulletClass=t,this.bullets.classType=this._bulletClass}}),Object.defineProperty(U.Weapon.prototype,"bulletKillType",{get:function(){return this._bulletKillType},set:function(t){switch(t){case U.Weapon.KILL_STATIC_BOUNDS:case U.Weapon.KILL_WEAPON_BOUNDS:this.bulletBounds=this.bounds;break;case U.Weapon.KILL_CAMERA_BOUNDS:this.bulletBounds=this.game.camera.view;break;case U.Weapon.KILL_WORLD_BOUNDS:this.bulletBounds=this.game.world.bounds}this._bulletKillType=t}}),Object.defineProperty(U.Weapon.prototype,"bulletCollideWorldBounds",{get:function(){return this._bulletCollideWorldBounds},set:function(t){this._bulletCollideWorldBounds=t,this.bullets.setAll("body.collideWorldBounds",t),this.bullets.setAll("data.bodyDirty",!1)}}),Object.defineProperty(U.Weapon.prototype,"x",{get:function(){return this.fireFrom.x},set:function(t){this.fireFrom.x=t}}),Object.defineProperty(U.Weapon.prototype,"y",{get:function(){return this.fireFrom.y},set:function(t){this.fireFrom.y=t}}),U.Bullet=function(t,e,i,n,r){U.Sprite.call(this,t,e,i,n,r),this.anchor.set(.5),this.data={bulletManager:null,fromX:0,fromY:0,bodyDirty:!0,rotateToVelocity:!1,killType:0,killDistance:0}},U.Bullet.prototype=Object.create(U.Sprite.prototype),U.Bullet.prototype.constructor=U.Bullet,U.Bullet.prototype.kill=function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.data.bulletManager.onKill.dispatch(this),this},U.Bullet.prototype.update=function(){this.exists&&(this.data.killType>U.Weapon.KILL_LIFESPAN&&(this.data.killType===U.Weapon.KILL_DISTANCE?this.game.physics.arcade.distanceToXY(this,this.data.fromX,this.data.fromY,!0)>this.data.killDistance&&this.kill():this.data.bulletManager.bulletBounds.intersects(this)||this.kill()),this.data.rotateToVelocity&&(this.rotation=Math.atan2(this.body.velocity.y,this.body.velocity.x)),this.data.bulletManager.bulletWorldWrap&&this.game.world.wrap(this,this.data.bulletManager.bulletWorldWrapPadding))},U.Video=function(t,e,i){var n;void 0===e&&(e=null),void 0===i&&(i=null),this.game=t,this.key=e,this.width=0,this.height=0,this.type=U.VIDEO,this.disableTextureUpload=!1,this.touchLocked=!1,this.onPlay=new U.Signal,this.onChangeSource=new U.Signal,this.onComplete=new U.Signal,this.onAccess=new U.Signal,this.onError=new U.Signal,this.onTimeout=new U.Signal,this.timeout=15e3,this._timeOutID=null,this.video=null,this.videoStream=null,this.isStreaming=!1,this.retryLimit=20,this.retry=0,this.retryInterval=500,this._retryID=null,this._codeMuted=!1,this._muted=!1,this._codePaused=!1,this._paused=!1,this._pending=!1,this._autoplay=!1,this._endCallback=null,this._playCallback=null,e&&this.game.cache.checkVideoKey(e)?((n=this.game.cache.getVideo(e)).isBlob?this.createVideoFromBlob(n.data):this.video=n.data,this.width=this.video.videoWidth,this.height=this.video.videoHeight):i&&this.createVideoFromURL(i,!1),this.video&&!i?this.baseTexture=new PIXI.BaseTexture(this.video):this.baseTexture=new PIXI.BaseTexture(U.Cache.DEFAULT.baseTexture.source),this.baseTexture.forceLoaded(this.width,this.height),this.texture=new PIXI.Texture(this.baseTexture),this.textureFrame=new U.Frame(0,0,0,this.width,this.height,"video"),this.texture.setFrame(this.textureFrame),this.texture.valid=!1,null!==e&&this.video&&(this.texture.valid=this.video.canplay),this.snapshot=null,U.BitmapData&&(this.snapshot=new U.BitmapData(this.game,"",this.width,this.height)),!this.game.device.cocoonJS&&(this.game.device.iOS||this.game.device.android)||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock?this.setTouchLock():n&&(n.locked=!1)},U.Video.prototype={connectToMediaStream:function(t,e){return t&&e&&(this.video=t,this.videoStream=e,this.isStreaming=!0,this.baseTexture.source=this.video,this.updateTexture(null,this.video.videoWidth,this.video.videoHeight),this.onAccess.dispatch(this)),this},startMediaStream:function(t,e,i){if(void 0===t&&(t=!1),void 0===e&&(e=null),void 0===i&&(i=null),!this.game.device.getUserMedia)return this.onError.dispatch(this,"No getUserMedia"),!1;null!==this.videoStream&&(this.videoStream.active?this.videoStream.active=!1:this.videoStream.stop()),this.removeVideoElement(),this.video=document.createElement("video"),this.video.setAttribute("autoplay","autoplay"),null!==e&&(this.video.width=e),null!==i&&(this.video.height=i),this._timeOutID=window.setTimeout(this.getUserMediaTimeout.bind(this),this.timeout);try{navigator.getUserMedia({audio:t,video:!0},this.getUserMediaSuccess.bind(this),this.getUserMediaError.bind(this))}catch(t){this.getUserMediaError(t)}return this},getUserMediaTimeout:function(){clearTimeout(this._timeOutID),this.onTimeout.dispatch(this)},getUserMediaError:function(t){clearTimeout(this._timeOutID),this.onError.dispatch(this,t)},getUserMediaSuccess:function(t){clearTimeout(this._timeOutID),this.videoStream=t,void 0!==this.video.mozSrcObject?this.video.mozSrcObject=t:this.video.src=window.URL&&window.URL.createObjectURL(t)||t;var r=this;this.video.onloadeddata=function(){var n=10;!function t(){var e,i;0<n&&(0<r.video.videoWidth?(e=r.video.videoWidth,i=r.video.videoHeight,isNaN(r.video.videoHeight)&&(i=e/(4/3)),r.video.play(),r.isStreaming=!0,r.baseTexture.source=r.video,r.updateTexture(null,e,i),r.onAccess.dispatch(r)):window.setTimeout(t,500)),n--}()}},createVideoFromBlob:function(t){var e=this;return this.video=document.createElement("video"),this.video.controls=!1,this.video.setAttribute("autoplay","autoplay"),this.video.addEventListener("loadeddata",function(t){e.updateTexture(t)},!0),this.video.src=window.URL.createObjectURL(t),this.video.canplay=!0,this},createVideoFromURL:function(t,e){return void 0===e&&(e=!1),this.texture&&(this.texture.valid=!1),this.video=document.createElement("video"),this.video.controls=!1,e&&this.video.setAttribute("autoplay","autoplay"),this.video.src=t,this.video.canplay=!0,this.video.load(),this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval),this.key=t,this},updateTexture:function(t,e,i){var n=!1;null!=e||(e=this.video.videoWidth,n=!0),null!=i||(i=this.video.videoHeight),this.width=e,this.height=i,this.baseTexture.source!==this.video&&(this.baseTexture.source=this.video),this.baseTexture.forceLoaded(e,i),this.texture.frame.resize(e,i),this.texture.width=e,this.texture.height=i,this.texture.valid=!0,this.snapshot&&this.snapshot.resize(e,i),n&&null!==this.key&&(this.onChangeSource.dispatch(this,e,i),this._autoplay&&(this.video.play(),this.onPlay.dispatch(this,this.loop,this.playbackRate)))},complete:function(){this.onComplete.dispatch(this)},play:function(t,e){return void 0===t&&(t=!1),void 0===e&&(e=1),this.game.sound.onMute&&(this.game.sound.onMute.add(this.setMute,this),this.game.sound.onUnMute.add(this.unsetMute,this),this.game.sound.mute&&this.setMute()),this.game.onPause.add(this.setPause,this),this.game.onResume.add(this.setResume,this),this._endCallback=this.complete.bind(this),this.video.addEventListener("ended",this._endCallback,!0),this.video.addEventListener("webkitendfullscreen",this._endCallback,!0),this.video.loop=t?"loop":"",this.video.playbackRate=e,this.touchLocked?this._pending=!0:(this._pending=!1,null!==this.key&&(4!==this.video.readyState?(this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval)):(this._playCallback=this.playHandler.bind(this),this.video.addEventListener("playing",this._playCallback,!0))),this.video.play(),this.onPlay.dispatch(this,t,e)),this},playHandler:function(){this.video.removeEventListener("playing",this._playCallback,!0),this.updateTexture()},stop:function(){return this.game.sound.onMute&&(this.game.sound.onMute.remove(this.setMute,this),this.game.sound.onUnMute.remove(this.unsetMute,this)),this.game.onPause.remove(this.setPause,this),this.game.onResume.remove(this.setResume,this),this.isStreaming?(this.video.mozSrcObject?(this.video.mozSrcObject.stop(),this.video.src=null):(this.video.src="",this.videoStream.active?this.videoStream.active=!1:this.videoStream.getTracks?this.videoStream.getTracks().forEach(function(t){t.stop()}):this.videoStream.stop()),this.videoStream=null,this.isStreaming=!1):(this.video.removeEventListener("ended",this._endCallback,!0),this.video.removeEventListener("webkitendfullscreen",this._endCallback,!0),this.video.removeEventListener("playing",this._playCallback,!0),this.touchLocked?this._pending=!1:this.video.pause()),this},add:function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)t[e].loadTexture&&t[e].loadTexture(this);else t.loadTexture(this);return this},addToWorld:function(t,e,i,n,r,s){r=r||1,s=s||1;e=this.game.add.image(t,e,this);return e.anchor.set(i,n),e.scale.set(r,s),e},render:function(){!this.disableTextureUpload&&this.playing&&this.baseTexture.dirty()},setMute:function(){this._muted||(this._muted=!0,this.video.muted=!0)},unsetMute:function(){this._muted&&!this._codeMuted&&(this._muted=!1,this.video.muted=!1)},setPause:function(){this._paused||this.touchLocked||(this._paused=!0,this.video.pause())},setResume:function(){!this._paused||this._codePaused||this.touchLocked||(this._paused=!1,this.video.ended||this.video.play())},changeSource:function(t,e){return void 0===e&&(e=!0),this.texture.valid=!1,this.video.pause(),this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval),this.video.src=t,this.video.load(),(this._autoplay=e)||(this.paused=!0),this},checkVideoProgress:function(){4===this.video.readyState?this.updateTexture():0<--this.retry&&(this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval))},setTouchLock:function(){this.game.input.touch.addTouchLockCallback(this.unlock,this),this.touchLocked=!0},unlock:function(){var t;return this.touchLocked=!1,this.video.play(),this.onPlay.dispatch(this,this.loop,this.playbackRate),this.key&&(t=this.game.cache.getVideo(this.key))&&!t.isBlob&&(t.locked=!1),!0},grab:function(t,e,i){if(void 0===t&&(t=!1),void 0===e&&(e=1),void 0===i&&(i=null),null!==this.snapshot)return t&&this.snapshot.cls(),this.snapshot.copy(this.video,0,0,this.width,this.height,0,0,this.width,this.height,0,0,0,1,1,e,i),this.snapshot},removeVideoElement:function(){if(this.video){for(this.video.parentNode&&this.video.parentNode.removeChild(this.video);this.video.hasChildNodes();)this.video.removeChild(this.video.firstChild);this.video.removeAttribute("autoplay"),this.video.removeAttribute("src"),this.video=null}},destroy:function(){this.stop(),this.removeVideoElement(),this.touchLocked&&this.game.input.touch.removeTouchLockCallback(this.unlock,this),this._retryID&&window.clearTimeout(this._retryID)}},Object.defineProperty(U.Video.prototype,"currentTime",{get:function(){return this.video?this.video.currentTime:0},set:function(t){this.video.currentTime=t}}),Object.defineProperty(U.Video.prototype,"duration",{get:function(){return this.video?this.video.duration:0}}),Object.defineProperty(U.Video.prototype,"progress",{get:function(){return this.video?this.video.currentTime/this.video.duration:0}}),Object.defineProperty(U.Video.prototype,"mute",{get:function(){return this._muted},set:function(t){(t=t||null)?this._muted||(this._codeMuted=!0,this.setMute()):this._muted&&(this._codeMuted=!1,this.unsetMute())}}),Object.defineProperty(U.Video.prototype,"paused",{get:function(){return this._paused},set:function(t){t=t||null,this.touchLocked||(t?this._paused||(this._codePaused=!0,this.setPause()):this._paused&&(this._codePaused=!1,this.setResume()))}}),Object.defineProperty(U.Video.prototype,"volume",{get:function(){return this.video?this.video.volume:1},set:function(t){t<0?t=0:1<t&&(t=1),this.video&&(this.video.volume=t)}}),Object.defineProperty(U.Video.prototype,"playbackRate",{get:function(){return this.video?this.video.playbackRate:1},set:function(t){this.video&&(this.video.playbackRate=t)}}),Object.defineProperty(U.Video.prototype,"loop",{get:function(){return!!this.video&&this.video.loop},set:function(t){t&&this.video?this.video.loop="loop":this.video&&(this.video.loop="")}}),Object.defineProperty(U.Video.prototype,"playing",{get:function(){return!(this.video.paused&&this.video.ended)}}),U.Video.prototype.constructor=U.Video,void 0===PIXI.blendModes&&(PIXI.blendModes=U.blendModes),void 0===PIXI.scaleModes&&(PIXI.scaleModes=U.scaleModes),void 0===PIXI.Texture.emptyTexture&&(PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture)),void 0===PIXI.DisplayObject._tempMatrix&&(PIXI.DisplayObject._tempMatrix=new PIXI.Matrix),void 0===PIXI.RenderTexture.tempMatrix&&(PIXI.RenderTexture.tempMatrix=new PIXI.Matrix),PIXI.Graphics&&void 0===PIXI.Graphics.POLY&&(PIXI.Graphics.POLY=U.POLYGON,PIXI.Graphics.RECT=U.RECTANGLE,PIXI.Graphics.CIRC=U.CIRCLE,PIXI.Graphics.ELIP=U.ELLIPSE,PIXI.Graphics.RREC=U.ROUNDEDRECTANGLE),PIXI.TextureSilentFail=!0,void 0!==l&&l.exports&&(p=l.exports=U),p.Phaser=U}).call(this)}).call(p,t(59))},function(t,e){function i(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function r(e){if(p===setTimeout)return setTimeout(e,0);if((p===i||!p)&&setTimeout)return p=setTimeout,setTimeout(e,0);try{return p(e,0)}catch(t){try{return p.call(null,e,0)}catch(t){return p.call(this,e,0)}}}function s(){d&&u&&(d=!1,u.length?c=u.concat(c):_=-1,c.length&&o())}function o(){if(!d){var t=r(s);d=!0;for(var e=c.length;e;){for(u=c,c=[];++_<e;)u&&u[_].run();_=-1,e=c.length}u=null,d=!1,function(e){if(h===clearTimeout)return clearTimeout(e);if((h===n||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}(t)}}function a(t,e){this.fun=t,this.array=e}function l(){}var p,h,t=t.exports={};!function(){try{p="function"==typeof setTimeout?setTimeout:i}catch(t){p=i}try{h="function"==typeof clearTimeout?clearTimeout:n}catch(t){h=n}}();var u,c=[],d=!1,_=-1;t.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];c.push(new a(t,e)),1!==c.length||d||r(o)},a.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={},t.on=l,t.addListener=l,t.once=l,t.off=l,t.removeListener=l,t.removeAllListeners=l,t.emit=l,t.prependListener=l,t.prependOnceListener=l,t.listeners=function(t){return[]},t.binding=function(t){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(t){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}},function(it,nt,rt){var st;!function(){function n(t,e,i){return t.call.apply(t.bind,arguments)}function r(e,i,t){if(!e)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,n),e.apply(i,t)}}return function(){return e.apply(i,arguments)}}function _(t,e,i){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?n:r).apply(null,arguments)}function e(t,e){this.a=t,this.o=e||t,this.c=this.o.document}function a(t,e,i,n){if(e=t.c.createElement(e),i)for(var r in i)i.hasOwnProperty(r)&&("style"==r?e.style.cssText=i[r]:e.setAttribute(r,i[r]));return n&&e.appendChild(t.c.createTextNode(n)),e}function l(t,e,i){(t=(t=t.c.getElementsByTagName(e)[0])||document.documentElement).insertBefore(i,t.lastChild)}function i(t){t.parentNode&&t.parentNode.removeChild(t)}function y(t,e,i){e=e||[],i=i||[];for(var n=t.className.split(/\s+/),r=0;r<e.length;r+=1){for(var s=!1,o=0;o<n.length;o+=1)if(e[r]===n[o]){s=!0;break}s||n.push(e[r])}for(e=[],r=0;r<n.length;r+=1){for(s=!1,o=0;o<i.length;o+=1)if(n[r]===i[o]){s=!0;break}s||e.push(n[r])}t.className=e.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function s(t,e){for(var i=t.className.split(/\s+/),n=0,r=i.length;n<r;n++)if(i[n]==e)return!0;return!1}function h(t,e,i){function n(){o&&r&&(o(s),o=null)}e=a(t,"link",{rel:"stylesheet",href:e,media:"all"});var r=!1,s=null,o=i||null;W?(e.onload=function(){r=!0,n()},e.onerror=function(){r=!0,s=Error("Stylesheet failed to load"),n()}):setTimeout(function(){r=!0,n()},0),l(t,"head",e)}function u(t,e,i,n){var r=t.c.getElementsByTagName("head")[0];if(r){var s=a(t,"script",{src:e}),o=!1;return s.onload=s.onreadystatechange=function(){o||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(o=!0,i&&i(null),s.onload=s.onreadystatechange=null,"HEAD"==s.parentNode.tagName&&r.removeChild(s))},r.appendChild(s),setTimeout(function(){o||(o=!0,i&&i(Error("Script load timeout")))},n||5e3),s}return null}function c(){this.a=0,this.c=null}function d(t){return t.a++,function(){t.a--,o(t)}}function f(t,e){t.c=e,o(t)}function o(t){0==t.a&&t.c&&(t.c(),t.c=null)}function p(t){this.a=t||"-"}function m(t,e){this.c=t,this.f=4,this.a="n";e=(e||"n4").match(/^([nio])([1-9])$/i);e&&(this.a=e[1],this.f=parseInt(e[2],10))}function x(t){var e=[];t=t.split(/,\s*/);for(var i=0;i<t.length;i++){var n=t[i].replace(/['"]/g,"");-1!=n.indexOf(" ")||/^\d/.test(n)?e.push("'"+n+"'"):e.push(n)}return e.join(",")}function v(t){return t.a+t.f}function g(t){var e="normal";return"o"===t.a?e="oblique":"i"===t.a&&(e="italic"),e}function b(t,e){this.c=t,this.f=t.o.document.documentElement,this.h=e,this.a=new p("-"),this.j=!1!==e.events,this.g=!1!==e.classes}function z(t){var e,i,n;t.g&&(e=s(t.f,t.a.c("wf","active")),i=[],n=[t.a.c("wf","loading")],e||i.push(t.a.c("wf","inactive")),y(t.f,i,n)),w(t,"inactive")}function w(t,e,i){t.j&&t.h[e]&&(i?t.h[e](i.c,v(i)):t.h[e]())}function C(){this.c={}}function P(t,e){this.c=t,this.f=e,this.a=a(this.c,"span",{"aria-hidden":"true"},this.f)}function T(t){l(t.c,"body",t.a)}function S(t){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+x(t.c)+";font-style:"+g(t)+";font-weight:"+t.f+"00;"}function M(t,e,i,n,r,s){this.g=t,this.j=e,this.a=n,this.c=i,this.f=r||3e3,this.h=s||void 0}function A(t,e,i,n,r,s,o){this.v=t,this.B=e,this.c=i,this.a=n,this.s=o||"BESbswy",this.f={},this.w=r||3e3,this.u=s||null,this.m=this.j=this.h=this.g=null,this.g=new P(this.c,this.s),this.h=new P(this.c,this.s),this.j=new P(this.c,this.s),this.m=new P(this.c,this.s),t=S(t=new m(this.a.c+",serif",v(this.a))),this.g.a.style.cssText=t,t=S(t=new m(this.a.c+",sans-serif",v(this.a))),this.h.a.style.cssText=t,t=S(t=new m("serif",v(this.a))),this.j.a.style.cssText=t,t=S(t=new m("sans-serif",v(this.a))),this.m.a.style.cssText=t,T(this.g),T(this.h),T(this.j),T(this.m)}function O(){var t;return null===q&&(t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),q=!!t&&(parseInt(t[1],10)<536||536===parseInt(t[1],10)&&parseInt(t[2],10)<=11)),q}function k(t,e,i){for(var n in H)if(H.hasOwnProperty(n)&&e===t.f[H[n]]&&i===t.f[H[n]])return!0;return!1}function E(t){var e,i=t.g.a.offsetWidth,n=t.h.a.offsetWidth;(e=i===t.f.serif&&n===t.f["sans-serif"])||(e=O()&&k(t,i,n)),e?V()-t.A>=t.w?O()&&k(t,i,n)&&(null===t.u||t.u.hasOwnProperty(t.a.c))?I(t,t.v):I(t,t.B):setTimeout(_(function(){E(this)},t),50):I(t,t.v)}function I(t,e){setTimeout(_(function(){i(this.g.a),i(this.h.a),i(this.j.a),i(this.m.a),e(this.a)},t),0)}function D(t,e,i){this.c=t,this.a=e,this.f=0,this.m=this.j=!1,this.s=i}function B(t){0==--t.f&&t.j&&(t.m?((t=t.a).g&&y(t.f,[t.a.c("wf","active")],[t.a.c("wf","loading"),t.a.c("wf","inactive")]),w(t,"active")):z(t.a))}function t(t){this.j=t,this.a=new C,this.h=0,this.f=this.g=!0}function L(n,t,e){var i,r=[],s=e.timeout;(i=t).g&&y(i.f,[i.a.c("wf","loading")]),w(i,"loading");var r=function(t,e,i){var n,r,s=[];for(n in e)!e.hasOwnProperty(n)||(r=t.c[n])&&s.push(r(e[n],i));return s}(n.a,e,n.c),o=new D(n.c,t,s);for(n.h=r.length,t=0,e=r.length;t<e;t++)r[t].load(function(t,e,i){var p,h,u,c,d;p=o,h=t,u=e,c=i,d=0==--(i=n).h,(i.f||i.g)&&setTimeout(function(){var t=c||null,e=u||{};if(0===h.length&&d)z(p.a);else{p.f+=h.length,d&&(p.j=d);for(var i=[],n=0;n<h.length;n++){var r,s=h[n],o=e[s.c],a=p.a,l=s;a.g&&y(a.f,[a.a.c("wf",l.c,v(l).toString(),"loading")]),w(a,"fontloading",l),(a=null)===Y&&(Y=!!window.FontFace&&(l=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),r=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor),l?42<parseInt(l[1],10):!r)),a=Y?new M(_(p.g,p),_(p.h,p),p.c,s,p.s,o):new A(_(p.g,p),_(p.h,p),p.c,s,p.s,t,o),i.push(a)}for(n=0;n<i.length;n++)i[n].start()}},0)})}function R(t,e){this.c=t,this.a=e}function F(t,e){this.c=t,this.a=e}function j(t,e){this.c=t||"https://fonts.googleapis.com/css",this.a=[],this.f=[],this.g=e||""}function N(t){this.f=t,this.a=[],this.c={}}function G(t,e){this.c=t,this.a=e}function U(t,e){this.c=t,this.a=e}function X(t,e){this.c=t,this.f=e,this.a=[]}var V=Date.now||function(){return+new Date},W=!!window.FontFace;p.prototype.c=function(t){for(var e=[],i=0;i<arguments.length;i++)e.push(arguments[i].replace(/[\W_]+/g,"").toLowerCase());return e.join(this.a)},M.prototype.start=function(){var r=this.c.o.document,s=this,o=V(),t=new Promise(function(i,n){!function e(){var t;V()-o>=s.f?n():r.fonts.load(g(t=s.a)+" "+t.f+"00 300px "+x(t.c),s.h).then(function(t){1<=t.length?i():setTimeout(e,25)},function(){n()})}()}),i=null,e=new Promise(function(t,e){i=setTimeout(e,s.f)});Promise.race([e,t]).then(function(){i&&(clearTimeout(i),i=null),s.g(s.a)},function(){s.j(s.a)})};var H={D:"serif",C:"sans-serif"},q=null;A.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=V(),E(this)};var Y=null;D.prototype.g=function(t){var e=this.a;e.g&&y(e.f,[e.a.c("wf",t.c,v(t).toString(),"active")],[e.a.c("wf",t.c,v(t).toString(),"loading"),e.a.c("wf",t.c,v(t).toString(),"inactive")]),w(e,"fontactive",t),this.m=!0,B(this)},D.prototype.h=function(t){var e,i,n,r=this.a;r.g&&(e=s(r.f,r.a.c("wf",t.c,v(t).toString(),"active")),i=[],n=[r.a.c("wf",t.c,v(t).toString(),"loading")],e||i.push(r.a.c("wf",t.c,v(t).toString(),"inactive")),y(r.f,i,n)),w(r,"fontinactive",t),B(this)},t.prototype.load=function(t){this.c=new e(this.j,t.context||this.j),this.g=!1!==t.events,this.f=!1!==t.classes,L(this,new b(this.c,t),t)},R.prototype.load=function(o){var a,e=this,l=e.a.projectId,t=e.a.version;l?(a=e.c.o,u(this.c,(e.a.api||"https://fast.fonts.net/jsapi")+"/"+l+".js"+(t?"?v="+t:""),function(t){t?o([]):(a["__MonotypeConfiguration__"+l]=function(){return e.a},function t(){if(a["__mti_fntLst"+l]){var e,i=a["__mti_fntLst"+l](),n=[];if(i)for(var r=0;r<i.length;r++){var s=i[r].fontfamily;null!=i[r].fontStyle&&null!=i[r].fontWeight?(e=i[r].fontStyle+i[r].fontWeight,n.push(new m(s,e))):n.push(new m(s))}o(n)}else setTimeout(function(){t()},50)}())}).id="__MonotypeAPIScript__"+l):o([])},F.prototype.load=function(t){for(var e=this.a.urls||[],i=this.a.families||[],n=this.a.testStrings||{},r=new c,s=0,o=e.length;s<o;s++)h(this.c,e[s],d(r));var a=[];for(s=0,o=i.length;s<o;s++)if((e=i[s].split(":"))[1])for(var l=e[1].split(","),p=0;p<l.length;p+=1)a.push(new m(e[0],l[p]));else a.push(new m(e[0]));f(r,function(){t(a,n)})};var K={latin:"BESbswy","latin-ext":"Ã§Ã¶Ã¼ÄŸÅŸ",cyrillic:"Ð¹ÑÐ–",greek:"Î±Î²Î£",khmer:"áž€ážáž‚",Hanuman:"áž€ážáž‚"},Z={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},J={i:"i",italic:"i",n:"n",normal:"n"},Q=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/,$={Arimo:!0,Cousine:!0,Tinos:!0};G.prototype.load=function(t){var e=new c,i=this.c,n=new j(this.a.api,this.a.text),r=this.a.families;!function(t,e){for(var i=e.length,n=0;n<i;n++){var r=e[n].split(":");3==r.length&&t.f.push(r.pop());var s="";2==r.length&&""!=r[1]&&(s=":"),t.a.push(r.join(s))}}(n,r);var s=new N(r);(function(t){for(var e=t.f.length,i=0;i<e;i++){var n=t.f[i].split(":"),r=n[0].replace(/\+/g," "),s=["n4"];if(2<=n.length){var o,a,l=n[1],p=[];if(l)for(var h=(l=l.split(",")).length,u=0;u<h;u++)(a=!(a=l[u]).match(/^[\w-]+$/)||null==(o=Q.exec(a.toLowerCase()))?"":[a=null==(a=o[2])||""==a?"n":J[a],o=null==(o=o[1])||""==o?"4":Z[o]||(isNaN(o)?"4":o.substr(0,1))].join(""))&&p.push(a);0<p.length&&(s=p),3==n.length&&(p=[],0<(n=(n=n[2])?n.split(","):p).length&&(n=K[n[0]])&&(t.c[r]=n))}for(t.c[r]||(n=K[r])&&(t.c[r]=n),n=0;n<s.length;n+=1)t.a.push(new m(r,s[n]))}})(s),h(i,function(t){if(0==t.a.length)throw Error("No fonts to load!");if(-1!=t.c.indexOf("kit="))return t.c;for(var e=t.a.length,i=[],n=0;n<e;n++)i.push(t.a[n].replace(/ /g,"+"));return e=t.c+"?family="+i.join("%7C"),0<t.f.length&&(e+="&subset="+t.f.join(",")),0<t.g.length&&(e+="&text="+encodeURIComponent(t.g)),e}(n),d(e)),f(e,function(){t(s.a,s.c,$)})},U.prototype.load=function(o){var t=this.a.id,a=this.c.o;t?u(this.c,(this.a.api||"https://use.typekit.net")+"/"+t+".js",function(t){if(t)o([]);else if(a.Typekit&&a.Typekit.config&&a.Typekit.config.fn){t=a.Typekit.config.fn;for(var e=[],i=0;i<t.length;i+=2)for(var n=t[i],r=t[i+1],s=0;s<r.length;s++)e.push(new m(n,r[s]));try{a.Typekit.load({events:!1,classes:!1,async:!0})}catch(t){}o(e)}},2e3):o([])},X.prototype.load=function(l){var t=this.f.id,e=this.c.o,p=this;t?(e.__webfontfontdeckmodule__||(e.__webfontfontdeckmodule__={}),e.__webfontfontdeckmodule__[t]=function(t,e){for(var i,n,r,s=0,o=e.fonts.length;s<o;++s){var a=e.fonts[s];p.a.push(new m(a.name,(i="font-weight:"+a.weight+";font-style:"+a.style,a=r=n=void 0,n=4,r="n",a=null,i&&((a=i.match(/(normal|oblique|italic)/i))&&a[1]&&(r=a[1].substr(0,1).toLowerCase()),(a=i.match(/([1-9]00|normal|bold)/i))&&a[1]&&(/bold/i.test(a[1])?n=7:/[1-9]00/.test(a[1])&&(n=parseInt(a[1].substr(0,1),10)))),r+n)))}l(p.a)},u(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+((e=this.c).o.location.hostname||e.a.location.hostname)+"/"+t+".js",function(t){t&&l([])})):l([])};var tt=new t(window);tt.a.c.custom=function(t,e){return new F(e,t)},tt.a.c.fontdeck=function(t,e){return new X(e,t)},tt.a.c.monotype=function(t,e){return new R(e,t)},tt.a.c.typekit=function(t,e){return new U(e,t)},tt.a.c.google=function(t,e){return new G(e,t)};var et={load:_(tt.load,tt)};void 0!==(st=function(){return et}.call(nt,rt,nt,it))&&(it.exports=st)}()},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0,i(6),i(0);var s,o=i(62),a=i(1),l=i(3),p=i(21),h=i(50),u=i(4),c=i(12),r=(s=Phaser.State,r(d,s),d.prototype.init=function(){var t=this;this.game.canvas.oncontextmenu=function(t){t.preventDefault()},this.game.input.maxPointers=3,this.game.input.addPointer(),this.game.input.addPointer(),this.scale.scaleMode=Phaser.ScaleManager.USER_SCALE,this.scale.fullScreenScaleMode=Phaser.ScaleManager.USER_SCALE,window.addEventListener("resize",function(){return d.mobileResizeCallback(t.game.scale)}),this.game.scale.onSizeChange.add(function(){a.Constants.LANDSCAPE_LOCKED&&!u.default.isDesktop?t.game.width>t.game.height?t.handleCorrect():t.handleIncorrect():a.Constants.PORTRAIT_LOCKED&&!u.default.isDesktop&&(t.game.width<t.game.height?t.handleCorrect():t.handleIncorrect()),t.game.state.getCurrentState().resize()},this),d.mobileResizeCallback(this.game.scale),document.addEventListener("pause",function(){t.game.sound.mute=!0}),document.addEventListener("resume",function(){c.Gameplay.isAdsPause||(t.game.sound.mute=!1)}),this.stage.disableVisibilityChange=!1,this.game.onPause.add(function(){t.game.sound.mute=!0}),this.game.onResume.add(function(){c.Gameplay.isAdsPause||(t.game.sound.mute=!1)})},d.mobileResizeCallback=function(t){var e=window.innerWidth,i=window.innerHeight;0===i&&(i=1),0===e&&(e=1),d.setScaling(t.game);var n=1066*a.Constants.GAME_SCALE,r=640*a.Constants.GAME_SCALE,s=1;s/=i<e?i/r:i/n,a.Constants.WIDTH=1066,a.Constants.HEIGHT=640,a.Constants.CALCULATED_WIDTH=Math.ceil(e*s),a.Constants.CALCULATED_HEIGHT=Math.ceil(i*s),t.setGameSize(a.Constants.CALCULATED_WIDTH,a.Constants.CALCULATED_HEIGHT),t.setUserScale(1/s,1/s),a.Constants.LANDSCAPE_LOCKED&&!t.game.device.desktop&&(t.game.width>t.game.height?(document.getElementById("orientation").style.display="none",document.getElementById("content").style.display="block"):(document.getElementById("orientation").style.display="block",document.getElementById("content").style.display="none"))},d.setScaling=function(t){window.innerWidth>window.innerHeight?window.innerWidth:window.innerHeight;t.device.pixelRatio,a.Constants.GAME_SCALE=1},d.prototype.preload=function(){var e=this;this.game.load.cacheBuster=1600238831039;a.Images.preloadList.forEach(function(t){e.game.load.image(t,"/img/"+t+".png")}),a.JSONData.preloadList.forEach(function(t){e.game.load.json(t,"/assets/data/"+t+".json")}),a.Atlases.preloadList.forEach(function(t){e.game.load.atlas(t,"/assets/atlases/"+t+".png","/assets/atlases/"+t+".json")}),a.Sounds.preloadList.forEach(function(t){e.game.device.iOS?e.game.load.audio(t,["/assets/media/"+t+".m4a"]):e.game.load.audio(t,["/assets/media/"+t+".ogg","/assets/media/"+t+".mp3"])})},d.prototype.create=function(){o.default.hide(),p.default.Current===p.default.YEP10?this.game.state.start(l.default.Name):this.game.state.start(h.default.Name)},d.prototype.handleCorrect=function(){document.getElementById("orientation").style.display="none",document.getElementById("content").style.display="block"},d.prototype.handleIncorrect=function(){document.getElementById("orientation").style.display="block",document.getElementById("content").style.display="none"},d.Name="boot",d);function d(){var t=s.call(this)||this;return t.name=d.Name,t}e.default=r},function(t,e,i){"use strict";e.__esModule=!0;var n=(r.show=function(){var t=document.getElementById("loader");t&&(t.style.display="block")},r.hide=function(){var t=document.getElementById("loader");t&&(t.style.display="none")},r);function r(){}e.default=n},function(t,e,i){"use strict";e.__esModule=!0;var n=(r.DBPers2="texture2",r.DBPers="texture",r.preloadList=[r.GameLogo="128"],r.list=[r.DBPers2,r.DBPers],r);function r(){}e.default=n},function(t,e,i){"use strict";e.__esModule=!0;var n=(r.MenuMusic="24_TrackSnd",r.GameMusic="24_TrackSnd",r.Click="20_ButtonSnd",r.button="20_ButtonSnd",r.b_bounce="16_B_Bounce",r.m_countdown="19_M_Countdown",r.m_whistle="2_M_Whistle",r.shield="13_P_Shield",r.m_win="1_M_Win",r.m_lost="12_M_Lost",r.m_buzzer="9_M_Buzzer",r.p_swoosh="5_P_Swoosh",r.p_floorStand="14_P_FloorStand",r.p_floorRun="15_P_FloorRun",r.p_dash="17_P_Dash",r.p_superDash="18_P_SuperDash",r.p_energy="6_P_Energy",r.p_megaStart="11_P_MegaStart",r.m_tribune="3_M_Tribune",r.p_stunned="7_P_Stunned",r.b_steel="8_B_Steel",r.b_basket="23_B_Basket",r.b_ring="10_B_Ring",r.b_net="21_B_NET",r.b_brick="22_B_Brick",r.p_teleport="4_P_Teleport",r.preloadList=[],r.list=[r.MenuMusic,r.b_bounce,r.Click,r.m_countdown,r.m_whistle,r.shield,r.m_win,r.m_lost,r.m_buzzer,r.p_swoosh,r.p_floorStand,r.p_floorRun,r.p_dash,r.p_superDash,r.p_energy,r.p_megaStart,r.p_stunned,r.m_tribune,r.b_steel,r.b_basket,r.b_ring,r.b_net,r.b_brick,r.p_teleport],r);function r(){}e.default=n},function(t,e,i){"use strict";e.__esModule=!0;var n=(r.Players="Players",r.DBPers="sk",r.DBPers_Texture="texture",r.DBPers2="sk2",r.DBPers_Texture2="texture2",r.preloadList=[],r.list=[r.DBPers2,r.DBPers_Texture2,r.DBPers,r.DBPers_Texture,r.Players],r);function r(){}e.default=n},function(t,e,i){"use strict";e.__esModule=!0;var n=(r.prototype.start=function(){this.view.start(),this.physics.start()},r.prototype.init=function(t){this.game=t},r.prototype.add=function(t){this.objects.push(t),t.update&&(this.updatedLen=this.updated.push(t)),t.restart&&this.restarted.push(t),t.body&&this.physics.add(t),t.graphic&&this.view.add(t)},r.prototype.slow=function(t){switch(t){case 1:this.timeScale=.05;break;case 2:this.timeScale=.4;break;case 3:this.timeScale=0;break;default:this.timeScale=1}},r.prototype.update=function(t){var e=t*this.timeScale;this.physics.update(e);for(var i=0;i<this.updatedLen;i++)this.updated[i].update(e)},r.prototype.restart=function(t){void 0===t&&(t=0),this.timeScale=1;for(var e=this.restarted.length,i=0;i<e;i++)this.restarted[i].restart(t)},r.prototype.release=function(){this.timeScale=1;for(var t=this.objects.length,e=0;e<t;e++)this.objects[e].release();this.objects.splice(0,t),this.restarted.splice(0,this.restarted.length),this.updated.splice(0,this.updatedLen),this.updatedLen=0,this.view.release(),this.physics.release(),this.view=null,this.physics=null},r);function r(){this.isScored=!1,this.updated=[],this.restarted=[],this.objects=[],this.game=null,this.timeScale=1}e.GameCore=n},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(38),a=i(16),l=i(14),p=i(4),h=i(68),u=i(39),c=i(0),d=i(13),_=i(69),r=(s=o.GameView,r(y,s),y.prototype.start=function(){this.addChild(this.gameObjects),this.addChild(this.gui),this.addChild(this.gamePadLayer),this.addChild(this.matchPreloader),this.startMatch()},y.prototype.add=function(t){var e,i;t.objType===a.ObjectsType.BALL?this.ball.addChild(t.graphic):t.objType===a.ObjectsType.SHADOW?this.shadows.addChild(t.graphic):t.objType===a.ObjectsType.PLAYER?(i=1,(e=t).isHuman||e.energyBar.parent.removeChild(e.energyBar),p.default.isDesktop?e.isHuman&&(this.players.addChildAt(e.energyBar,0),i=0):e.isHuman&&(e.energyBar.bg.destroy(),e.energyBar.hint.destroy(),e.energyBar.x=0,e.energyBar.y=0,l.default.instance.btnZ.label.parent.addChild(e.energyBar)),0<this.players.length?this.players.addChildAt(t.graphic,this.players.length-i):this.players.addChild(t.graphic)):t.objType===a.ObjectsType.BASKET?(this.back.addChild(t.graphic),this.frontObjects.addChild(t.frontEar)):t.objType===a.ObjectsType.ARENA?(t.graphic.x=-299,this.matchPreloader.x=-299,this.back.addChild(t.graphic)):t.objType===a.ObjectsType.EFFECTS?this.effects.addChild(t.graphic):t.objType===a.ObjectsType.INFO&&(d.MainGameCore.instance.messageInfo=t,this.frontObjects.addChild(t.graphic))},y.prototype.startMatch=function(){this.infoPanel=new h.InfoPanelGUI,this.gui.addChild(this.infoPanel),this.timer=new u.TimerObject,this.gui.addChild(this.timer)},y.prototype.shake=function(t){1===t?this.shakeContainer(this.gameObjects,10):7!==t&&8!==t||this.shakeContainer(this.gameObjects,25)},y.prototype.resize=function(){s.prototype.resize.call(this);var t=this.game.width/p.default.GAME_W;this.gameObjects.x=this.game.width/2-p.default.DISPLAY_W2*t,this.gui.x=this.game.width/2-p.default.DISPLAY_W2*t,this.gamePadLayer.x=this.game.width/2-p.default.DISPLAY_W2*t},y.prototype.release=function(){this.gameObjects=null,this.gamePadLayer=null,this.back=null,this.shadows=null,this.players=null,this.ball=null,this.effects=null,this.frontObjects=null,this.gui=null,this.infoPanel=null,this.timer=null,s.prototype.release.call(this)},y);function y(t){t=s.call(this,t)||this;return t.gameObjects=new c.Group(t.game),t.gameObjects.interactive=!1,t.back=new c.Group(t.game,t.gameObjects,"back_container"),t.shadows=new c.Group(t.game,t.gameObjects),t.players=new c.Group(t.game,t.gameObjects),t.effects=new c.Group(t.game,t.gameObjects),t.ball=new c.Group(t.game,t.gameObjects),t.frontObjects=new c.Group(t.game,t.gameObjects),t.gui=new c.Group(t.game),t.gamePadLayer=new c.Group(t.game),t.matchPreloader=new _.MatchPreloader,l.default.instance.init(t.gamePadLayer,t.game),t}e.MainGameView=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(3),a=i(9),l=i(1),p=i(4),r=(s=Phaser.Group,r(h,s),h.prototype.start=function(t,e,i){this.emblem1.loadTexture(l.Atlases.Interface,"Emblems00"+(t[0]-1<10?"0":"")+(t[0]-1)),this.emblem2.loadTexture(l.Atlases.Interface,"Emblems00"+(t[1]-1<10?"0":"")+(t[1]-1)),this.score1.text=e.toString(),this.score2.text=i.toString()},h.prototype.updateScore=function(t,e){this.score1.text=t.toString(),this.score2.text=e.toString()},h);function h(){var t=s.call(this,o.default.game)||this;t.emblem1=null,t.emblem2=null,t.score1=null,t.score2=null,t.x=p.default.GAME_W2,t.y=60;var e=t.game.add.sprite(0,-6,l.Atlases.Gameplay,"infoPanel0000");e.anchor.set(.5),t.addChild(e),t.emblem1=t.game.add.image(-101,-18,l.Atlases.Gameplay,"bg0000"),t.emblem2=t.game.add.image(103,-18,l.Atlases.Gameplay,"bg0000"),t.emblem1.anchor.set(.5),t.emblem2.anchor.set(.5),t.emblem1.scale.set(.25),t.emblem2.scale.set(.25);e={font:"46px CfCrackBold",fill:"#FF9900"};return t.score1=new a.default(t.game,-10,5,"",e),t.score1.anchor.set(1,1),t.score1.stroke="#000000",t.score1.strokeThickness=2,t.addChild(t.score1),t.score2=new a.default(t.game,14,5,"",e),t.score2.anchor.set(0,1),t.score2.stroke="#000000",t.score2.strokeThickness=2,t.addChild(t.score2),t.addChild(t.emblem1),t.addChild(t.emblem2),t}e.InfoPanelGUI=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(0),a=i(3),r=(s=o.Graphics,r(l,s),l.prototype.setCallBacks=function(t,e,i){null===this.callBackOnShow&&(this.callBackOnShow=t,this.callBackOnHide=e,this.contextForAll=i)},l.prototype.setTime=function(t){this.time=t},l.prototype.show=function(){this.alpha=0;var t=a.default.game.add.tween(this);t.onComplete.add(this.callBackOnShow,this.contextForAll),t.to({alpha:1},this.time,o.Easing.Linear.None,!1,this.time).start()},l.prototype.hide=function(){this.alpha=1;var t=a.default.game.add.tween(this);t.onComplete.add(this.callBackOnHide,this.contextForAll),t.to({alpha:0},this.time).start()},l);function l(){var t=s.call(this,a.default.game)||this;return t.beginFill(0),t.drawRect(0,0,1398,480),t.endFill(),t.alpha=0,t.callBackOnShow=null,t.callBackOnHide=null,t.contextForAll=null,t}e.MatchPreloader=r},function(t,e,i){"use strict";e.__esModule=!0;var n=i(29),i=(Object.defineProperty(r.prototype,"matchMode",{get:function(){return this._matchMode},set:function(t){this._matchMode=t},enumerable:!0,configurable:!0}),r.prototype.resetData=function(){this.teams=[],this.players=[[],[]]},r.prototype.resetPartly=function(){this.matchMode=0,this.pb=[[],[]],this.skills=[[],[]],this.forms=[0,1],this.matchScore=[0,0]},r.prototype.resetAll=function(){this.resetData(),this.resetPartly()},r.prototype.baseInit=function(){this.matchMode=0,this.teams=[this.firstTeam,2],this.players=[[0],[0]]},r.prototype.resetScore=function(){this.matchScore=[0,0]},r.prototype.startQuickMatch=function(){this.resetAll();var t=1+Math.random()*n.PlayersData.TEAMS_COUNT>>0,e=1+Math.random()*n.PlayersData.TEAMS_COUNT>>0;t===e&&(e===n.PlayersData.TEAMS_COUNT?e--:e++),this.teams=[t,e],this.players[0][0]=Math.random()*n.PlayersData.TEAM_SIZE>>0,this.players[1][0]=Math.random()*n.PlayersData.TEAM_SIZE>>0,this.pb=[["P0"],["B0"]],this.skills=[[0],[2]]},r.prototype.startTraining=function(){this.resetAll(),this.teams[0]=1+Math.random()*n.PlayersData.TEAMS_COUNT>>0,this.teams[1]=this.teams[0],this.players[0]=[Math.random()*n.PlayersData.TEAM_SIZE>>0],this.players[1]=[],this.pb=[["P0"]],this.skills=[[0]],this.rndForms()},r.prototype.startRandomMatch=function(){0===this.matchMode?(this.pb=[["P0"],["B0"]],this.skills=[[0],[3]]):(this.fill2ndPlayers(),this.pb=[["P0","B2"],["B1","B2"]],this.skills=[[0,3],[3,3]]),this.rndForms()},r.prototype.startPlayers2Match=function(){var t,e;0===this.matchMode?(t=this.players[0][0],e=this.players[1][0],this.players=[[t],[e]],this.pb=[["P1"],["P2"]],this.skills=[[0],[0]]):1===this.matchMode?(this.fill2ndPlayers(),this.pb=[["P1","B2"],["P2","B2"]],this.skills=[[0,4],[0,4]]):(this.fill2ndPlayers(),this.pb=[["P1","P2"],["B1","B2"]],this.skills=[[0,0],[4,4]]),this.rndForms()},r.prototype.fill2ndPlayers=function(){2===this.players[0].length||this.players[0].push(0===this.players[0][0]?1:0),2===this.players[1].length||this.players[1].push(0===this.players[1][0]?1:0)},r.prototype.startTournamentMatch=function(t){this.resetAll(),this.matchMode=t.mode,this.teams=[t.team,t.opponent],this.players[0][0]=t.player,this.players[1][0]=Math.random()*n.PlayersData.TEAM_SIZE>>0;var e=4*t.difficulty+t.state+1;t.isThirdPlaceMatch()&&e--,0===this.matchMode?(this.pb=[["P0"],["B0"]],this.skills=[[0],[e]]):(this.players[0][1]=0==this.players[0][0]?1:0,this.players[1][1]=0==this.players[1][0]?1:0,this.pb=[["P0","B2"],["B1","B2"]],this.skills=[[0,4],[e,e]]),this.rndForms()},r.prototype.finishMatch=function(t){2===t||3===t?this.baseInit():(this.cutPlayers(0),this.cutPlayers(1)),this.resetPartly()},r.prototype.cutPlayers=function(t){2===this.players[t].length&&this.players[t].pop()},r.prototype.rndForms=function(){this.forms=[0,1]},r.prototype.whoWins=function(){return this.matchScore[0]>this.matchScore[1]?-1:this.matchScore[0]<this.matchScore[1]?1:0},r);function r(t){this.restarted=!1,this.firstTeam=t?1:17,this.baseInit(),this.resetPartly()}e.MatchData=i},function(t,e,i){"use strict";e.__esModule=!0;var o=i(29),i=(Object.defineProperty(n.prototype,"state",{get:function(){return this.obj.state},set:function(t){this.obj.state=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"difficulty",{get:function(){return this.obj.difficulty},set:function(t){this.obj.difficulty=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mode",{get:function(){return this.obj.mode},set:function(t){this.obj.mode=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scores",{get:function(){return this.obj.scores},set:function(t){this.obj.scores=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"team",{get:function(){return this.obj.team},set:function(t){this.obj.team=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"player",{get:function(){return this.obj.player},set:function(t){this.obj.player=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"teamRound",{get:function(){return this.obj.teamRound},set:function(t){this.obj.teamRound=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"posOfTeam",{get:function(){return this.obj.posOfTeam},set:function(t){this.obj.posOfTeam=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"opponent",{get:function(){return this.obj.opponent},set:function(t){this.obj.opponent=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rounds",{get:function(){return this.obj.rounds},set:function(t){this.obj.rounds=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"results",{get:function(){return this.obj.results},set:function(t){this.obj.results=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"points",{get:function(){return this.obj.points},set:function(t){this.obj.points=t},enumerable:!0,configurable:!0}),n.prototype.resetAll=function(){this.state=-1,this.mode=0,this.scores=0,this.team=0,this.difficulty=0,this.player=0,this.teamRound=0,this.posOfTeam=[0,1],this.opponent=0,this.rounds=[],this.results=[],this.points=0},n.prototype.createNewTournament=function(t){this.resetAll(),this.team=t.teams[0],this.player=t.players[0][0],this.mode=t.matchMode,this.rounds=[];for(var e={},i=[],n=0;n<16;n++){for(var r=1+Math.random()*o.PlayersData.TEAMS_COUNT>>0;void 0!==e[r];)r=1+Math.random()*o.PlayersData.TEAMS_COUNT>>0;e[r]=!0,i[n]=r}void 0===e[this.team]&&(i[16*Math.random()>>0]=this.team);for(var s=0;s<i.length/2;s++)this.rounds[s]=[i[2*s],i[2*s+1]],i[2*s]!==this.team&&i[2*s+1]!==this.team||(this.teamRound=s);this.results=[],this.state=0,this.scores=0,this.defineOpponent()},n.prototype.swapTeams=function(t,e){for(var i=e+8,n=e;n<i;n++){var r=e+8*Math.random()>>0,s=t[n];t[n]=t[r],t[r]=s}},n.prototype.defineOpponent=function(){this.posOfTeam=this.rounds[this.teamRound][0]===this.team?[0,1]:[1,0],this.opponent=this.rounds[this.teamRound][this.posOfTeam[1]]},n.prototype.generateResults=function(t,e,i,n){void 0===n&&(n=null);for(var r=!0,s=0;s<e-t;s++){var o=s+t,a=e+(s/2>>0);this.rounds.length===a&&this.rounds.push([]);var l=s%2,p=void 0,h=void 0;o===this.teamRound?(this.rounds[o][0]===this.team?this.results[o]=[n[0],n[1]]:this.rounds[o][1]===this.team&&(this.results[o]=[n[1],n[0]]),n[0]>n[1]?(p=this.posOfTeam[0],h=this.posOfTeam[1],r=!0,this.teamRound=a):(p=this.posOfTeam[1],h=this.posOfTeam[0],(r=i)&&(this.teamRound=a+1))):(h=Math.random()<=.5?(p=0,1):(p=1,0),this.generateMatchScore(p,h,o)),this.rounds[a][l]=this.rounds[o][p],i&&(this.rounds.length===a+1&&this.rounds.push([]),this.rounds[a+1][l]=this.rounds[o][h])}return r},n.prototype.generateMatchScore=function(t,e,i){var n=[0,0],r=30+20*Math.random()>>0,s=r-(1+10*Math.random()>>0);n[t]=r,n[e]=s,this.results[i]=n},n.prototype.getFinalistsArray=function(){var t=[],e=this.getPlace();return t.push(this.rounds[16][0],this.rounds[17][0],this.rounds[16][1]),3<e&&t.push(this.team),t.push(e),t},n.prototype.getPlace=function(){var t=5;return this.team===this.rounds[16][0]?t=1:this.team===this.rounds[17][0]?t=2:this.team===this.rounds[16][1]?t=3:this.team===this.rounds[17][1]&&(t=4),t},n.prototype.isSecondPlace=function(){return!!this.rounds[17]&&this.team===this.rounds[17][0]},n.prototype.isThirdPlaceMatch=function(){return 3===this.state&&(this.team===this.rounds[15][0]||this.team===this.rounds[15][1])},n.prototype.setValues=function(t){for(var e in t)this.obj.hasOwnProperty(e)&&(this.obj[e]=t[e])},n.prototype.getValues=function(){var t,e={};for(t in this.obj)this.obj.hasOwnProperty(t)&&(e[t]=this.obj[t]);return e},n);function n(){this.obj={},this.resetAll()}e.TournamentData=i},function(t,e,i){"use strict";e.__esModule=!0;var n=(o.calcScores=function(t,e,i,n){var r=50<t[0]?50:t[0],s=r-t[1],t=o.winKoef;s<0&&(s=0,t=n?o.winKoef:o.lostKoef);s=o.stateKoef*e+t+o.pointKoef*r+o.diffKoef*s;return 1==i&&(s*=o.hardKoef),s},o.stateKoef=1e3,o.winKoef=1e3,o.lostKoef=500,o.pointKoef=100,o.diffKoef=30,o.hardKoef=1.5,o);function o(){}e.ScoresCalculator=n},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(42),a=i(4),l=i(74),r=(s=o.BaseDataManager,r(p,s),p.prototype.getValuesForRead=function(){return this.baseData.getValuesForRead()},p.prototype.updateData=function(t,e){void 0===e&&(e=0),1===this.values[t]||t<11&&!(e>=this.limits[t])||this.setAchievement(t)},p.prototype.setAchievement=function(t){this.values[t]=1,this.saveData()},p);function p(t,e,i){var n=s.call(this)||this;return n.baseData=new l.AchievsData,n.limits=a.default.LIMITS_FOR_ACHIEVS,n.init(t,e,i),n}e.AchievsDataManager=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,i=i(43),r=(s=i.BaseData,r(o,s),o.prototype.checkAchievement=function(t){0===this.values[t]&&(this.values[t]=1)},o.prototype.getValuesForRead=function(){return this.values},o);function o(){var t=s.call(this)||this;return t.names=["points3","dunks","fromBlock","buzzer","blocks","steals","scores","pointsM","pointsMH","pointsT","pointsTH","idNet","forum","GC1","SC1","BC1","GC2","SC2","BC2","GC1H","GC2H"],t.count=21,t.createEmpty(),t}e.AchievsData=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(42),a=i(76),r=(s=o.BaseDataManager,r(l,s),l.prototype.updateData=function(t,e){void 0===e&&(e=0),6===t?this.incScore():(0===t?this.incScore(3):t<4&&this.incScore(),this.values[t]++,this.achievsMgr.updateData(t,this.values[t])),this.saveData()},l.prototype.updateScore=function(t,e){e=this.scoresNo+e;t>this.values[e]&&(this.values[e]=t,this.saveData())},l.prototype.getTotalScores=function(){return this.values[this.scoresNo]+this.values[this.scoresNo+1]},l.prototype.incScore=function(t){void 0===t&&(t=2),this.values[6]+=t,this.achievsMgr.updateData(6,this.values[6])},l);function l(t,e,i,n){var r=s.call(this)||this;return r.baseData=new a.StatsData,r.achievsMgr=n,r.init(t,e,i),r.scoresNo=r.values.length-2,r}e.StatsDataManager=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,i=i(43),r=(s=i.BaseData,r(o,s),o);function o(){var t=s.call(this)||this;return t.names=["points3","dunks","fromBlock","buzzer","blocks","steals","scores","scores1","scores2"],t.count=9,t.createEmpty(),t}e.StatsData=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=nape.space.Space,a=i(28),l=i(23),p=i(30),r=(s=a.GamePhysics,r(h,s),h.prototype.update=function(t){h.space.step(.9*t),this.updateGraphics()},h.prototype.updateGraphics=function(){for(var t=h.space.liveBodies.iterator();t.hasNext();){var e=t.next(),i=e.userData;i.graphic&&((i=i.graphic).x=e.position.x,i.y=e.position.y,i.rotation=e.rotation%(2*Math.PI))}},h.prototype.add=function(t){t.body&&(t.body.space=h.space)},h.prototype.release=function(){for(;!h.space.bodies.empty();)l.NapeUtil.disposeBody(h.space.bodies.at(0));s.prototype.release.call(this),h.space.clear(),h.space=null},h);function h(){var t=s.call(this)||this;return h.space=new o(p.ObjectsData.GRAVITY),h.space.worldLinearDrag=0,t}e.Physics2=r},function(t,e,i){"use strict";e.__esModule=!0},function(t,e,i){"use strict";e.__esModule=!0},function(t,e,i){"use strict";e.__esModule=!0},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=nape.geom.Vec2,a=nape.phys.Body,l=nape.phys.BodyType,p=nape.shape.Polygon,h=i(2),u=i(1),c=i(3),r=(s=h.GameObject,r(d,s),d.prototype.create=function(){this.createBody(),this.createGraphic()},d.prototype.createBody=function(){this.body=new a(l.STATIC,o.get(0,0));var t=new p(p.rect(-50,420,900,60),h.Materials.FlOOR,h.Filters.ARENA);t.cbTypes.add(h.CbTypes.cbGround),this.body.shapes.add(t);t=new p(p.rect(-20,-800,5,1300),h.Materials.FlOOR,h.Filters.BORDER);t.cbTypes.add(h.CbTypes.cbBorders),this.body.shapes.add(t);t=new p(p.rect(815,-800,5,1300),h.Materials.FlOOR,h.Filters.BORDER);t.cbTypes.add(h.CbTypes.cbBorders),this.body.shapes.add(t);t=new p(p.rect(-80,-800,40,1300),h.Materials.FlOOR,h.Filters.ARENA);t.cbTypes.add(h.CbTypes.cbBorders),this.body.shapes.add(t);t=new p(p.rect(840,-800,5,1300),h.Materials.FlOOR,h.Filters.ARENA);t.cbTypes.add(h.CbTypes.cbBorders),this.body.shapes.add(t)},d.prototype.createGraphic=function(){var t=new Phaser.Group(c.default.game),e=new Phaser.Image(c.default.game,0,0,u.Atlases.Gameplay,"0bg_gameplay0000");t.addChild(e),this.graphic=t},d.rndPart=function(){return 1+6*Math.random()>>0},d.prototype.setLogo=function(t){},d);function d(){var t=s.call(this)||this;return t.objType=h.ObjectsType.ARENA,t.create(),t.add(),t}e.ArenaObject=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,h=i(2),o=i(0),u=nape.geom.Vec2,a=nape.phys.Body,l=nape.phys.BodyType,c=nape.constraint.PivotJoint,d=nape.constraint.DistanceJoint,p=nape.shape.Polygon,_=i(22),y=i(3),f=i(1),r=(s=h.GameObject,r(m,s),m.prototype.showEar=function(){this.frontEar.alpha=1,y.default.game.add.tween(this.frontEar).from({alpha:0},500).start()},m.prototype.hideEar=function(){y.default.game.add.tween(this.frontEar).to({alpha:0},500).start()},m.prototype.createGlass=function(){this.body=new a(l.STATIC,u.weak(this.center,this.height)),this.glass=new p(p.rect(this.glassPos,h.ObjectsData.GLASS_Y,h.ObjectsData.GLASS_WIDTH,h.ObjectsData.GLASS_HEIGHT),h.Materials.GLASS,h.Filters.BASKET),this.glass.cbTypes.add(h.CbTypes.cbBasket),this.body.shapes.add(this.glass),this.body.userData.side=this.side},m.prototype.createRing=function(){this.leftPart=h.NapeUtil.createCircleBody(l.STATIC,h.Filters.BASKET,!1,this.partRadius,this.leftPoint,this.height,0,h.CbTypes.cbRing,h.Materials.BASKET),this.leftPart.space=this.theSpace,this.rightPart=h.NapeUtil.createCircleBody(l.STATIC,h.Filters.BASKET,!1,this.partRadius,this.rightPoint,this.height,0,h.CbTypes.cbRing,h.Materials.BASKET),this.rightPart.space=this.theSpace,this.centerPart=h.NapeUtil.createCircleBody(l.STATIC,h.Filters.BASKET,!0,this.partRadius,this.center,this.height,0,h.CbTypes.cbRing,h.Materials.BASKET),this.centerPart.space=this.theSpace,this.upperSensor=new p(p.rect(-h.ObjectsData.SENSOR_HALF,h.ObjectsData.SENSOR_UP,h.ObjectsData.SENSOR_WIDTH,h.ObjectsData.SENSOR_HEIGHT),null,h.Filters.BASKET),this.upperSensor.sensorEnabled=!0,this.upperSensor.cbTypes.add(h.CbTypes.cbUpperSensor),this.body.shapes.add(this.upperSensor),this.downSensor=new p(p.rect(-h.ObjectsData.SENSOR_HALF,h.ObjectsData.SENSOR_DOWN,h.ObjectsData.SENSOR_WIDTH,h.ObjectsData.SENSOR_HEIGHT),null,h.Filters.BASKET),this.downSensor.sensorEnabled=!0,this.downSensor.cbTypes.add(h.CbTypes.cbDownSensor),this.body.shapes.add(this.downSensor)},m.prototype.createNet=function(){var t=this.leftPoint+2,e=this.rightPoint-2,i=this.height+3,n=new u(t,i),r=new u(this.center,i),s=new u(e,i),o=new u(t,i+14),a=new u(this.center,i+12),l=new u(e,i+14),p=new u(t,i+32),t=new u(this.center,i+30),i=new u(e,i+32);this.body1=this.createBody(n.x,(n.y+o.y)/2,h.Filters.NET_COLLIDE),this.body2=this.createBody(o.x,(o.y+p.y)/2,h.Filters.NET_COLLIDE),this.body3=this.createBody(s.x,(s.y+l.y)/2,h.Filters.NET_COLLIDE),this.body4=this.createBody(l.x,(l.y+i.y)/2,h.Filters.NET_COLLIDE),this.body5=this.createBody(r.x,(r.y+a.y)/2,h.Filters.NET_NOT_COLLIDE),this.body6=this.createBody(a.x,(a.y+t.y)/2,h.Filters.NET_NOT_COLLIDE),this.body7=this.createBody(p.x,p.y+4,h.Filters.NET_NOT_COLLIDE),this.body8=this.createBody(i.x,i.y+4,h.Filters.NET_NOT_COLLIDE),this.body9=this.createBody(t.x,t.y+4,h.Filters.NET_NOT_COLLIDE),this.pivotJoint1=new c(this.body1,this.leftPart,this.body1.worldPointToLocal(n),this.leftPart.worldPointToLocal(n)),this.pivotJoint2=new c(this.body1,this.body2,this.body1.worldPointToLocal(o),this.body2.worldPointToLocal(o)),this.addPivotJoint(this.pivotJoint1),this.addPivotJoint(this.pivotJoint2),this.pivotJoint3=new c(this.body3,this.rightPart,this.body3.worldPointToLocal(s),this.rightPart.worldPointToLocal(s)),this.pivotJoint4=new c(this.body3,this.body4,this.body3.worldPointToLocal(l),this.body4.worldPointToLocal(l)),this.addPivotJoint(this.pivotJoint3),this.addPivotJoint(this.pivotJoint4),this.pivotJoint5=new c(this.body5,this.centerPart,this.body5.worldPointToLocal(r),this.centerPart.worldPointToLocal(r)),this.pivotJoint6=new c(this.body5,this.body6,this.body5.worldPointToLocal(a),this.body6.worldPointToLocal(a)),this.addPivotJoint(this.pivotJoint5),this.addPivotJoint(this.pivotJoint6),this.pivotJoint7=new c(this.body2,this.body7,this.body2.worldPointToLocal(p),this.body7.worldPointToLocal(p)),this.addPivotJoint(this.pivotJoint7),this.pivotJoint8=new c(this.body4,this.body8,this.body4.worldPointToLocal(i),this.body8.worldPointToLocal(i)),this.addPivotJoint(this.pivotJoint8),this.pivotJoint9=new c(this.body6,this.body9,this.body6.worldPointToLocal(t),this.body9.worldPointToLocal(t)),this.addPivotJoint(this.pivotJoint9),this.distJoint1=new d(this.body1,this.body5,this.body1.worldPointToLocal(o),this.body5.worldPointToLocal(a),14,14),this.distJoint2=new d(this.body3,this.body5,this.body3.worldPointToLocal(l),this.body5.worldPointToLocal(a),14,14),this.addDistanceJoint(this.distJoint1),this.addDistanceJoint(this.distJoint2),this.distJoint3=new d(this.body2,this.body6,this.body2.worldPointToLocal(p),this.body6.worldPointToLocal(t),13,13),this.distJoint4=new d(this.body6,this.body4,this.body6.worldPointToLocal(t),this.body4.worldPointToLocal(i),13,13),this.addDistanceJoint(this.distJoint3),this.addDistanceJoint(this.distJoint4)},m.prototype.createBody=function(t,e,i){e=new a(l.DYNAMIC,new u(t,e)),i=new p(p.box(2,14),h.Materials.NET,i);return e.shapes.add(i),e.space=this.theSpace,e},m.prototype.addPivotJoint=function(t){t.ignore=!0,t.space=this.theSpace},m.prototype.addDistanceJoint=function(t){t.stiff=!1,t.frequency=4,t.ignore=!0,t.space=this.theSpace},m.prototype.dampNet=function(t){this.updateBodyDampening(this.body1,t),this.updateBodyDampening(this.body2,t),this.updateBodyDampening(this.body3,t),this.updateBodyDampening(this.body4,t),this.updateBodyDampening(this.body5,t),this.updateBodyDampening(this.body6,t),this.updateBodyDampening(this.body7,t),this.updateBodyDampening(this.body8,t),this.updateBodyDampening(this.body9,t)},m.prototype.updateBodyDampening=function(t,e){t.velocity.muleq(Math.pow(.2,e)),t.angularVel*=Math.pow(.2,e)},m.prototype.createGraphic=function(){this.graphic=new Phaser.Group(y.default.game);var t=new o.Image(y.default.game,0,0,f.Atlases.Gameplay,"BasketGraphic0000");t.anchor.set(.7,.93),this.graphic.addChild(t);t=-1===this.side?1:-1;this.graphic.scale.set(t,1),this.netSpritegraphics=new o.Graphics(y.default.game),this.netSpritegraphics.x=-this.center,this.netSpritegraphics.y=-this.height,this.updateGraphics(),this.frontEar=new o.Sprite(y.default.game,0,0,f.Atlases.Gameplay,"FrontEar0000"),this.frontEar.x=this.center,this.frontEar.y=this.height,this.frontEar.anchor.set(.5),this.frontEar.scale.set(t,1),this.frontEar.addChildAt(this.netSpritegraphics,0)},m.prototype.updateGraphics=function(){this.netSpritegraphics.clear(),this.netSpritegraphics.beginFill(16777215),this.netSpritegraphics.lineStyle(2,16777215);var t=this.pivotJoint1.body1.localPointToWorld(this.pivotJoint1.anchor1),e=this.pivotJoint2.body1.localPointToWorld(this.pivotJoint2.anchor1);this.netSpritegraphics.moveTo(t.x,t.y),this.netSpritegraphics.lineTo(e.x,e.y);t=this.pivotJoint2.body1.localPointToWorld(this.pivotJoint2.anchor1),e=this.pivotJoint7.body1.localPointToWorld(this.pivotJoint7.anchor1);this.netSpritegraphics.moveTo(t.x,t.y),this.netSpritegraphics.lineTo(e.x,e.y);t=this.pivotJoint3.body1.localPointToWorld(this.pivotJoint3.anchor1),e=this.pivotJoint4.body1.localPointToWorld(this.pivotJoint4.anchor1);this.netSpritegraphics.moveTo(t.x,t.y),this.netSpritegraphics.lineTo(e.x,e.y);t=this.pivotJoint4.body1.localPointToWorld(this.pivotJoint4.anchor1),e=this.pivotJoint8.body1.localPointToWorld(this.pivotJoint8.anchor1);this.netSpritegraphics.moveTo(t.x,t.y),this.netSpritegraphics.lineTo(e.x,e.y);t=this.pivotJoint5.body1.localPointToWorld(this.pivotJoint5.anchor1),e=this.pivotJoint6.body1.localPointToWorld(this.pivotJoint6.anchor1);this.netSpritegraphics.moveTo(t.x,t.y),this.netSpritegraphics.lineTo(e.x,e.y);t=this.pivotJoint6.body1.localPointToWorld(this.pivotJoint6.anchor1),e=this.pivotJoint9.body1.localPointToWorld(this.pivotJoint9.anchor1);this.netSpritegraphics.moveTo(t.x,t.y),this.netSpritegraphics.lineTo(e.x,e.y);t=this.distJoint1.body1.localPointToWorld(this.distJoint1.anchor1),e=this.distJoint1.body2.localPointToWorld(this.distJoint1.anchor1);this.netSpritegraphics.moveTo(t.x,t.y),this.netSpritegraphics.lineTo(e.x,e.y);t=this.distJoint2.body1.localPointToWorld(this.distJoint2.anchor1),e=this.distJoint2.body2.localPointToWorld(this.distJoint2.anchor1);this.netSpritegraphics.moveTo(t.x,t.y),this.netSpritegraphics.lineTo(e.x,e.y);t=this.distJoint3.body1.localPointToWorld(this.distJoint3.anchor1),e=this.distJoint3.body2.localPointToWorld(this.distJoint3.anchor1);this.netSpritegraphics.moveTo(t.x,t.y),this.netSpritegraphics.lineTo(e.x,e.y);t=this.distJoint4.body1.localPointToWorld(this.distJoint4.anchor1),e=this.distJoint4.body2.localPointToWorld(this.distJoint4.anchor1);this.netSpritegraphics.moveTo(t.x,t.y),this.netSpritegraphics.lineTo(e.x,e.y);t=this.pivotJoint7.body2.localPointToWorld(this.pivotJoint7.anchor2),e=this.pivotJoint7.body2.localPointToWorld(new u(0,5));this.netSpritegraphics.moveTo(t.x,t.y),this.netSpritegraphics.lineTo(e.x,e.y);t=this.pivotJoint9.body2.localPointToWorld(this.pivotJoint9.anchor2),e=this.pivotJoint9.body2.localPointToWorld(new u(0,5));this.netSpritegraphics.moveTo(t.x,t.y),this.netSpritegraphics.lineTo(e.x,e.y);t=this.pivotJoint8.body2.localPointToWorld(this.pivotJoint8.anchor2),e=this.pivotJoint8.body2.localPointToWorld(new u(0,5));this.netSpritegraphics.moveTo(t.x,t.y),this.netSpritegraphics.lineTo(e.x,e.y),this.netSpritegraphics.endFill()},m.prototype.update=function(t){void 0===t&&(t=0),this.dampNet(t),this.updateGraphics()},m.prototype.release=function(){this.glass=null,this.leftPart=null,this.rightPart=null,this.centerPart=null,this.body1=null,this.body2=null,this.body3=null,this.body4=null,this.body5=null,this.body6=null,this.body7=null,this.body8=null,this.body9=null,this.pivotJoint1.space=null,this.pivotJoint1=null,this.pivotJoint2.space=null,this.pivotJoint2=null,this.pivotJoint3.space=null,this.pivotJoint3=null,this.pivotJoint4.space=null,this.pivotJoint4=null,this.pivotJoint5.space=null,this.pivotJoint5=null,this.pivotJoint6.space=null,this.pivotJoint6=null,this.pivotJoint7.space=null,this.pivotJoint7=null,this.pivotJoint8.space=null,this.pivotJoint8=null,this.pivotJoint9.space=null,this.pivotJoint9=null,this.distJoint1.space=null,this.distJoint1=null,this.distJoint2.space=null,this.distJoint2=null,this.distJoint3.space=null,this.distJoint3=null,this.distJoint4.space=null,this.distJoint4=null,this.upperSensor=null,this.downSensor=null,this.theSpace=null,this.frontEar.removeChild(this.netSpritegraphics),this.netSpritegraphics=null,this.frontEar=null,s.prototype.release.call(this)},m);function m(t){var e=s.call(this)||this;return e.objType=h.ObjectsType.BASKET,e.side=t,e.radius=h.ObjectsData.BASKET_RADIUS,e.height=h.ObjectsData.BASKET_HEIGHT,e.partRadius=h.ObjectsData.BASKET_PART_RADIUS,-1===t?(e.center=h.ObjectsData.BASKET_CENTER,e.glassPos=-e.center):(e.center=h.ObjectsData.BASKET_CENTER2,e.glassPos=h.ObjectsData.BASKET_CENTER-h.ObjectsData.GLASS_WIDTH),e.leftPoint=e.center-e.radius,e.rightPoint=e.center+e.radius,e.theSpace=_.NapePhysics.space,e.createGlass(),e.createRing(),e.createNet(),e.createGraphic(),s.prototype.add.call(e),e}e.BasketObject=r},function(t,e,i){"use strict";e.__esModule=!0;var n=nape.callbacks.CbType,n=(r.cbBall=new n,r.cbPlayer=new n,r.cbPlayersHands=new n,r.cbPlayersBlock=new n,r.cbGround=new n,r.cbBorders=new n,r.cbBasket=new n,r.cbRing=new n,r.cbUpperSensor=new n,r.cbDownSensor=new n,r.cbMiddle=new n,r.cbNet=new n,r.cbPowerUp=new n,r.cbShield=new n,r.cbAlleyOop=new n,r);function r(){}e.CbTypes=n},function(t,e,i){"use strict";e.__esModule=!0;var n=nape.dynamics.InteractionFilter,n=(r.BALL=new n(17,4368),r.NET_COLLIDE=new n(17,4368),r.NET_NOT_COLLIDE=new n(17,4352),r.BASKET=new n(16,4353),r.RAY=new n(16,4352),r.ARENA=new n(4369,4369),r.BORDER=new n(4369,4352),r.PLAYER=new n(273,4096,4096),r.PLAYER_BLOCK=new n(273,4369),r);function r(){}e.Filters=n},function(t,e,i){"use strict";e.__esModule=!0;var n=nape.phys.Material,n=(r.FlOOR=new n(.4,1,1,.9,3),r.BALL=new n(1,.6,.6,.7,1),r.NET=new n(.1,1,1,1),r.GLASS=new n(.5,1,1,1),r.BASKET=new n(.35,2,2,1),r.PLAYER=new n(0,1,1,100,0),r);function r(){}e.Materials=n},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var h,u=i(2),c=i(47),d=i(4),s=i(19),_=i(13),y=nape.geom.Vec2,o=nape.shape.Polygon,a=nape.phys.Body,l=nape.phys.BodyType,f=i(87),m=i(88),x=i(40),p=i(3),v=i(15),g=i(5),b=i(1),z=i(14),w=i(24),r=(h=u.GameObject,r(C,h),C.prototype.createGraphic=function(t,e,i,n){this.armature=n,this.armature.display.y=35,this.armature.display.scale.set(.73),this.skinID=u.PlayersData.TEAM_SIZE*(t-1)+e,u.PlayersData.switchPlayer(n,this.skinID,2*(t-1)+i),this.armature.display.addDBEventListener(dragonBones.EventObject.COMPLETE,this.onAnimationComplete,this),this.armature.display.addDBEventListener(dragonBones.EventObject.FRAME_EVENT,this.onFrameEvent,this),this.graphic=new Phaser.Group(p.default.game),this.graphic.addChild(this.armature.display),this.graphic.scale.x=-this.SIDE},C.prototype.createBody=function(){this.body=new a(l.DYNAMIC,y.get(0,0)),this.legs=new o(o.box(20,70),u.Materials.PLAYER.copy(),u.Filters.PLAYER),this.legs.cbTypes.add(u.CbTypes.cbPlayer),this.body.shapes.add(this.legs);var t=new o(o.box(30,80));t.sensorEnabled=!0,t.cbTypes.add(u.CbTypes.cbPlayersHands),this.body.shapes.add(t),this.block=new o(o.rect(-5,0,10,-70),u.Materials.BASKET,u.Filters.BASKET),this.block.cbTypes.add(u.CbTypes.cbPlayersBlock),this.blockBody=new o(o.box(20,70),u.Materials.PLAYER,u.Filters.PLAYER_BLOCK),this.body.align(),this.baseMass=3*this.body.gravMass,this.blockMass=2*this.baseMass,this.body.gravMass=this.baseMass,this.body.allowRotation=!1,this.body.userData.graphic=this.graphic,(this.body.userData.owner=this).body.userData.direction=this.SIDE},C.prototype.restart=function(t){void 0===t&&(t=0),this.returnToPhysics(),this.resetVars(),this.removeBlock(),this.withBall=!1,this.isDunking=!1,0===t&&(this.opponents=1===this.SIDE?this.gamecore.playersLeft:this.gamecore.playersRight,this.mark=this.ball.body,3===this.superID&&(this.teamMate=this.gamecore.getTeamMate(this.playerNo),this.dashOpponents=[])),this.unBlock(),this.controller.restart(t);var e=0;0===this.playerNo&&(e=t===this.SIDE?1:0),this.body.position.set(this.indents[e]),this.body.velocity.setxy(0,0),this.updateGraphic(),this.shadow.update(),this.graphic.scale.x=-this.SIDE,this.playState("idle"),this.dashDelay.activate()},C.prototype.resetVars=function(){this.isRestart=!0,this.isUnderEmotion=!1,this.isGrounded=!0,this.canTakeInHands=!0,this.canDoAction=!0,this.needBlock=!1,this.isBlockedOrPump=!1,this.readyForDash=!1,this.canAct=!0,this.deltaDig=0,this.isSuperShot=!1},C.prototype.ballInHands=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.SIDE===t?(this.playerNo===e&&this.takeBallInHands(),this.controller.ballInOwnHands(e),this.mark=null,this.needBlock=!1):(this.controller.ballInOpponentsHands(e),this.mark=this.opponents[e].body,this.needBlock=!0)},C.prototype.ballShooting=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.SIDE===t?(this.controller.ballOwnShoot(e),this.needBlock=!1):(this.controller.ballOpponentShoot(e),this.needBlock=!0),this.mark=this.ball.body},C.prototype.ballOthers=function(){this.controller.ballOthers(),this.mark=this.ball.body,this.needBlock=!1,this.removeBlock()},C.prototype.jump=function(t){t&&this.isGrounded&&"jump"!==this.state&&(this.withBall?this.makeJump("A"):this.makeJump())},C.prototype.isUnderGlass=function(){var t=this.body.position.x;return-1===this.SIDE?600<t&&t<700:100<t&&t<200},C.prototype.makeJump=function(t){var e;void 0===t&&(t=""),e=(""===t?(this.attackJump=!1,this.needBlock&&this.useBlock()):(this.pointOfThrow=this.body.position.x,this.attackJump=!0,this.canThrow=!0),"fly1"),this.playState(e),this.playerSignal.dispatch("jump"+t,this.SIDE,this.playerNo),this.body.velocity.y=this.velY,this.isGrounded=!1},C.prototype.makeSteal=function(){this.opponents&&0!==this.opponents.length&&(this.move(3),this.playerSignal.dispatch("startSteal",this.SIDE,this.playerNo),this.playState("steal"),g.default.getInstance().play(b.Sounds.p_swoosh),this.canAct=!1,this.canTakeInHands=!1)},C.prototype.tryToSteal=function(){this.canDoAction=!1,this.playerSignal.dispatch("steal",this.SIDE,this.playerNo),this.gamecore.steal(this.SIDE,this.body.position.x,this.graphic.scale.x,this.isHuman)},C.prototype.useBlock=function(){this.canTakeInHands=!1,this.body.shapes.add(this.block)},C.prototype.removeBlock=function(){return!!this.body.shapes.has(this.block)&&(this.body.shapes.remove(this.block),!0)},C.prototype.checkToBeStolen=function(t,e,i){void 0===i&&(i=!1);var n,r=-1;return this.isGrounded&&(i=n=void 0,i=1===e?(n=t)+this.stealDistance:(n=t-this.stealDistance,t),n<=(n=this.body.position.x)&&n<=i&&(r=Math.abs(n-t))),r},C.prototype.getBeStolen=function(t,e){void 0===e&&(e=!0);var i=this.withBall;return this.move(0),this.playState("stun"),g.default.getInstance().play(b.Sounds.p_stunned),this.canAct=!1,this.isBlockedOrPump&&this.unBlock(),this.canTakeInHands=!1,this.withBall&&(this.withBall=!1,e)&&(t=0<(e=this.body.position.x-t)?1:-1,this.ball.applySteal(this.body.position,Math.abs(e)/this.stealDistance,t)),this.playerSignal.dispatch("stun",this.SIDE,this.playerNo),i},C.prototype.onGroundCollision=function(){this.isRestart?this.isRestart=!1:this.isUnderEmotion||"stun"===this.state?(this.isGrounded=!0,this.canThrow=!0):this.isSuperDash?(this.isSuperDash=!1,this.playState("idle"),this.isGrounded=!0,this.canAct=!0):(this.canAct=!1,this.move(0),this.withBall?this.attackJump?(this.makeThrow(),this.canTakeInHands=!0):(this.canThrow=!0,this.controller.playerOnGround()):(this.removeBlock(),this.controller.playerOnGround(),this.canTakeInHands=!0,this.canThrow=!0),this.isGrounded=!0,this.body.velocity.y=0,this.playState("landing"))},C.prototype.move=function(t){var e;-1===t||1===t?(this.legs.material.dynamicFriction=this.legs.material.staticFriction=0,e=this.withBall?this.velBallX:this.velX,this.body.velocity.x=t*e,this.isGrounded&&this.checkRunState()&&this.playState("run")):(this.legs.material.dynamicFriction=this.baseFriction,this.legs.material.staticFriction=this.baseFriction,0===t?this.isGrounded&&this.checkIdleState()&&this.checkDigState()?this.playState("idle"):this.body.velocity.x*=.95:2===t?this.body.velocity.x=0:3===t?(this.legs.material.dynamicFriction=.08,this.legs.material.staticFriction=.08):4===t&&(this.legs.material.dynamicFriction=this.baseFriction,this.legs.material.staticFriction=this.baseFriction,this.body.velocity.x=0))},C.prototype.action=function(t){t&&this.canDoAction&&(this.withBall?this.canThrow&&(this.isGrounded?this.makeFloorThrow():this.makeThrow()):this.isGrounded&&this.makeSteal())},C.prototype.makeFloorThrow=function(){this.move(2),this.canAct=!1,this.playState("throw_land")},C.prototype.makeThrow=function(){this.withBall=!1,this.attackJump=!1,this.canDoAction=!1;var t,e=this.body.position.x,i=this.body.position.y;e>=this.paintStartX&&e<=this.paintMiddleX&&i<=this.dunkStart1Y?this.makeDunk(1+Math.round(2*Math.random())):(e-this.paintStartX)*this.SIDE<0&&i<=this.dunkStart2Y?this.makeDunk(1):(t=35,this.isGrounded?(this.pointOfThrow=this.body.position.x,t=20):this.playState("fly1"),this.canTakeInHands=this.isGrounded,this.ball.shoot(this.SIDE,e-this.SIDE*t,i-50,this.body.velocity.x,this.accuracy));i=0<=(this.pointOfThrow-this.threePointDistance)*this.SIDE?0:6;this.matchProcessor.shoot(this.SIDE,this.isHuman,i)},C.prototype.removeFromPhysics=function(){this.canAct=!1,this.body.velocity.setxy(0,0),this.body.space=null},C.prototype.returnToPhysics=function(t){void 0===t&&(t=null),t?this.body.position.set(t):this.body.position.setxy(this.dunkX,this.dunkY),this.body.space=this.theSpace,this.canTakeInHands=!1},C.prototype.makeDunk=function(t){this.removeFromPhysics();var e="dunk"+t.toString(),i=520;2==t?i=350:3==t&&(i=480),this.isDunking=!0,this.playState(e),p.default.game.add.tween(this.graphic).to({x:this.dunkX,y:this.dunkY},i/1.3333).start()},C.prototype.endDunk=function(){var t=this.ball.dunk(this.SIDE,this.chanceToCompleteDunk),e=t?1:9;this.matchProcessor.shoot(this.SIDE,this.isHuman,e),this.isHuman||t||v.Signals.EventSignal.dispatch(!1,9),this.isDunking=!1,this.returnToPhysics()},C.prototype.superShot=function(t){var e=!1;return t&&this.readyForSuper&&!this.gamecore.isSuperShot&&(0===this.superID?this.withBall&&(this.startSuper(),this.makeMegaDunk(),e=!0):1===this.superID?(this.startSuper(),this.makeShield(),e=!0):2===this.superID?this.withBall&&(this.startSuper(),this.makeAlleyOop(),e=!0):3===this.superID&&(this.startSuper(),this.makeSuperDash(),e=!0)),e},C.prototype.startSuper=function(){this.readyForSuper=!1,this.isSuperShot=!0,this.energyBar.reset(),this.gamecore.isSuperShot=!0},C.prototype.endSuper=function(){this.isSuperShot=!1,this.gamecore.isSuperShot=!1},C.prototype.makeAlleyOop=function(){this.controller instanceof u.AIController2&&this.playerID,this.canAct=!1,this.move(4),this.canTakeInHands=!1,this.graphic.scale.x=0<this.marker-this.body.position.x?1:-1,this.isGrounded?this.playState("throw_land"):this.startAlleyOop()},C.prototype.startAlleyOop=function(){this.ball.alleyOop(this.SIDE,this.body.position.x-20*this.SIDE,this.body.position.y-30,this),this.withBall=!1,this.isGrounded||this.playState("fly1")},C.prototype.continueAlleyOop=function(){this.teleport.startPlay(this.body.position.x,this.body.position.y),g.default.getInstance().play(b.Sounds.p_teleport),this.removeFromPhysics();var t=p.default.game.add.tween(this.graphic.scale);t.onComplete.addOnce(this.endAlleyOop,this),t.to({x:0,y:0},400).start()},C.prototype.endAlleyOop=function(){this.graphic.x=this.superDunkX,this.graphic.y=this.superDunkY,this.graphic.scale.x=-this.SIDE,this.graphic.scale.y=1,this.graphic.visible=!0,this.armature.animation.gotoAndStopByFrame("pumpEnd",0),this.teleport.startPlay(this.superDunkX,this.superDunkY),g.default.getInstance().play(b.Sounds.p_teleport),this.ball.removeFromPhysics();var t=p.default.game.add.tween(this.graphic.scale);t.onComplete.addOnce(this.continueSuperDunk,this),t.from({x:0,y:0},400).start()},C.prototype.makeShield=function(){this.shield.activate(),this.endSuper()},C.prototype.makeMegaDunk=function(){this.canAct=!1,this.graphic.scale.x=-this.SIDE;var t=s.default.dist(this.body.position.x,this.body.position.y,this.superDunkX,this.superDunkY);this.removeFromPhysics();var e=t/700/1.3333;e<.3&&(e=.3),this.playState("megadunk"),g.default.getInstance().play(b.Sounds.p_megaStart);t=p.default.game.add.tween(this.graphic);t.onComplete.addOnce(this.continueSuperDunk,this),t.to({x:this.superDunkX,y:this.superDunkY},1e3*e).start()},C.prototype.continueSuperDunk=function(){this.playState("megadunk_end"),p.default.game.add.tween(this.graphic).to({x:this.superDunkEndX,y:this.superDunkEndY},100).start()},C.prototype.endSuperDunk=function(){this.withBall=!1,this.ball.dunk(this.SIDE,1);var t=0===this.superID?7:8;this.matchProcessor.shoot(this.SIDE,this.isHuman,t),this.returnToPhysics(),this.endSuper()},C.prototype.makeSuperDash=function(){var t=-1;this.opponentsCount=this.opponents?this.opponents.length:0;for(var e=0;e<this.opponentsCount;e++)this.opponents[e].withBall&&(t=this.opponents[e].getX()),this.dashOpponents[e]=0;t<0&&(this.ball.isInGame()&&(t=this.ball.getX()),this.teamMate?(this.teamMate.withBall&&(t=this.teamMate.getX()),this.dashTeammate=1):this.dashTeammate=-1);var i=this.body.position.x;this.withBall?this.dashPoint=0:this.SIDE<0?this.dashPoint=i<t?0:1:this.dashPoint=t<i?0:1,this.isSuperDash=!0,this.canAct=!1,this.attackJump=!1;var n=s.default.dist(i,this.body.position.y,this.superDashX[this.dashPoint],this.superDashY)/600/1.3333;this.removeFromPhysics(),this.playState("md_start"),g.default.getInstance().play(b.Sounds.p_superDash),this.toRight=this.SIDE<0?0===this.dashPoint:1===this.dashPoint;i=p.default.game.add.tween(this.graphic);i.onComplete.addOnce(this.continueSuperDash,this),i.onUpdateCallback(this.onSuperDashUpdate,this),i.to({x:this.superDashX[this.dashPoint],y:this.superDashY},1e3*n).start()},C.prototype.onSuperDashUpdate=function(){for(var t=this.graphic.x,e=0;e<this.opponentsCount;e++)0===this.dashOpponents[e]&&(this.opponents[e].isDunking?this.dashOpponents[e]=-1:Math.abs(t-this.opponents[e].getX())<40&&(this.dashOpponents[e]=-1,this.opponents[e].getBeStolen(t,!1)&&this.gamecore.ballInHands(this.SIDE,this.playerNo)));this.ball.getY()>u.ObjectsData.BASKET_HEIGHT&&(this.withBall||(this.ball.isInGame()?(this.toRight&&t>this.ball.getX()||!this.toRight&&t<this.ball.getX())&&(this.ball.takeInHands(this.SIDE,this.playerNo,!0),this.gamecore.ballInHands(this.SIDE,this.playerNo)):0<this.dashTeammate&&(this.toRight&&t>this.teamMate.getX()||!this.toRight&&t<this.teamMate.getX())&&(this.dashTeammate=0,this.teamMate.withBall&&(this.teamMate.freeBall(),this.gamecore.ballInHands(this.SIDE,this.playerNo)))))},C.prototype.continueSuperDash=function(){this.playState("md_end"),this.canThrow=!0,this.returnToPhysics(y.weak(this.superDashX[this.dashPoint],this.superDashY)),this.endSuper()},C.prototype.takeBallInHands=function(){this.withBall=!0;var t=this.isUnderGlass();this.canThrow=t||this.isGrounded,t&&(this.pointOfThrow=this.body.position.x),this.playState(this.state)},C.prototype.freeBall=function(){return!!this.withBall&&(this.withBall=!1,this.isGrounded?this.playState("idle"):(this.canAct=!1,this.playState("fly1")),!0)},C.prototype.setEmotion=function(t){this.canTakeInHands=!1,this.isUnderEmotion=!0,this.move(2),this.withBall&&(this.withBall=!1,this.ball.fromHands(this.body.position,this.graphic.scale.x)),this.SIDE===t?this.emotionState="happiness":this.SIDE===-t?this.emotionState="sad":this.emotionState="idle",this.playState(this.emotionState),this.canAct=!1},C.prototype.update=function(t){var e;void 0===t&&(t=0),"steal"===this.state||this.isSuperShot||(e=null===this.mark?this.marker:this.mark.position.x,this.graphic.scale.x=0<e-this.body.position.x?1:-1),this.canDoAction||(this.canDoAction=this.controller.readyForAction()),this.readyForDash||(this.readyForDash=1===this.dashDelay.update(t)),this.isUnderEmotion||(this.readyForSuper||this.isSuperShot||(this.readyForSuper=this.energyBar.update(t),this.readyForSuper&&this.isHuman&&g.default.getInstance().play(b.Sounds.p_energy)),this.canAct&&(this.controller.update(t),this.isBlockedOrPump?this.releaseBlockOrPump(this.controller.releaseBlockOrPump(t)):(this.move(this.controller.currentMove),this.jump(this.controller.currentJump),this.action(this.controller.currentAction),this.makeDash(this.controller.currentDash),this.makeBlockOrPump(this.controller.currentBlockOrPump),this.superShot(this.controller.currentSuper),"idle"===this.state&&"inHands"===this.ball.state?(this.deltaDig+=t,this.deltaDig>=this.delayDig&&(this.deltaDig=0,this.makeDig())):this.deltaDig=0)))},C.prototype.makeDash=function(t){0!==t&&this.readyForDash&&this.isGrounded&&(this.canAct=!1,this.playState("dash"),g.default.getInstance().play(b.Sounds.p_dash),this.playerSignal.dispatch("dash",this.SIDE,this.playerNo),this.legs.material.dynamicFriction=this.legs.material.staticFriction=0,this.body.velocity.x=1.7*this.velX*t)},C.prototype.endDash=function(){!this.isHuman&&this.withBall&&this.controller.playerOnDashEnd(),this.legs.material.dynamicFriction=this.legs.material.staticFriction=this.baseFriction,this.canAct=!0,this.readyForDash=!1,this.dashDelay.activate()},C.prototype.makeBlockOrPump=function(t){t&&this.isGrounded&&(this.move(2),this.canAct=!1,this.withBall?(this.playState("pumpStart"),this.playerSignal.dispatch("pump",this.SIDE,this.playerNo)):(this.canTakeInHands=!1,this.playState("blockStart")))},C.prototype.setBlock=function(){this.canAct=!0,this.body.gravMass=this.blockMass,this.isBlockedOrPump=!0,this.body.shapes.add(this.blockBody),this.controller.playerOnBlock()},C.prototype.releaseBlockOrPump=function(t){t&&(this.canAct=!1,this.withBall?this.playState("pumpEnd"):(this.playState("blockEnd"),this.unBlock()))},C.prototype.unBlock=function(){this.body.gravMass=this.baseMass,this.body.shapes.remove(this.blockBody),this.isBlockedOrPump=!1,this.canTakeInHands=!0},C.prototype.release=function(){p.default.game.tweens.removeFrom(this.graphic),this.gamecore=null,this.matchProcessor=null,this.ball=null,this.opponents=null,this.teamMate=null,this.shadow=null,this.theSpace=null,this.energyBar=null,this.armature.display.removeDBEventListener(dragonBones.EventObject.COMPLETE,this.onAnimationComplete,this),this.armature.display.removeDBEventListener(dragonBones.EventObject.FRAME_EVENT,this.onFrameEvent,this),this.armature=null,this.controller.dispose(),this.controller=null;for(var t=this.indents.length,e=0;e<t;e++)this.indents[e].dispose();this.indents.splice(0,t),this.indents=null,this.legs=null,this.block=null,this.blockBody=null,this.mark=null,this.teleport=null,this.shield=null,this.playerSignal=null,this.dashDelay=null,this.superDashX=null,this.dashOpponents=null,this.graphic=null,h.prototype.release.call(this)},C.prototype.onAnimationComplete=function(t){var e=t.animationState.name,t="";"throw_land"===e||"blockEnd"===e||0<=e.indexOf("landing")?(this.canAct=!this.isSuperShot,t="idle"):"steal"===e||"stun"===e?(this.canAct=!0,this.canTakeInHands=!0,t="idle"):"megadunk_end"===e?(this.canTakeInHands=!0,t="idle"):0<=e.indexOf("dash")?(t="run",this.endDash()):"blockStart"===e?this.setBlock():"pumpStart"===e?(this.isBlockedOrPump=!0,this.canAct=!0):"pumpEnd"===e?(this.isBlockedOrPump=!1,this.canAct=!0,t="idle"):0<=e.indexOf("dig")?t="idle":0<=e.indexOf("md_start")?t="md_mid":0<=e.indexOf("md_end")&&(t="idle"),0<t.length&&this.playState(t)},C.prototype.onFrameEvent=function(t){t=t.name;"floor0"===t?g.default.getInstance().play(b.Sounds.p_floorStand):"floor"===t?g.default.getInstance().play(b.Sounds.p_floorRun):"action"===t?this.tryToSteal():"throw"===t?this.isSuperShot?this.startAlleyOop():this.makeThrow():"mega"===t?this.endSuperDunk():"dunk"===t&&this.endDunk()},C.prototype.playState=function(t){var e=t,i=!1;this.withBall&&("idle"===t||"run"===t||"dash"===t||"landing"===t||0<=t.indexOf("fly")||0<=t.indexOf("md_"))?(e=t+"_wb",this.wb||(i=!0),this.wb=!0):this.wb=this.withBall,e!==this.state&&(this.prevState=this.state,this.state=e,i?this.armature.animation.gotoAndPlay(this.state,0):this.armature.animation.gotoAndPlay(this.state),!p.default.game.device.desktop&&w.Inventory.instance.gameMode<=2&&this.isHuman&&(this.prevState.indexOf("_wb")<0&&0<this.state.indexOf("_wb")&&z.default.instance.btnDown.labelState.loadTexture(b.Atlases.Gameplay,"shoot_icon0000"),0<this.prevState.indexOf("_wb")&&this.state.indexOf("_wb")<0&&z.default.instance.btnDown.labelState.loadTexture(b.Atlases.Gameplay,"shoot_icon0001")))},C.prototype.checkRunState=function(){return this.state.indexOf("run")<0},C.prototype.checkIdleState=function(){return this.state.indexOf("idle")<0},C.prototype.checkDigState=function(){return this.state.indexOf("dig")<0},C.prototype.isMoving=function(){return 200<Math.abs(this.body.velocity.x)},C.prototype.isReadyToDash=function(){return this.state.indexOf("dash")<0&&this.readyForDash},C.prototype.makeDig=function(){var t=1+Math.round(2*Math.random());this.playState("dig"+t.toString())},C);function C(t,e,i,n,r,s,o,a){void 0===o&&(o=null),void 0===a&&(a=null);var l=h.call(this)||this;l.opponents=null,l.state="",l.prevState="",l.wb=!1,l.isDunking=!1,l.objType=u.ObjectsType.PLAYER,l.playerID=e,l.playerNo=r,l.SIDE=0===t?-1:1;var p=d.default.WIDTH;l.velX=u.ObjectsData.PLAYER_MOVE,l.velBallX=u.ObjectsData.PLAYER_MOVE_WITH_BALL,l.velY=u.ObjectsData.PLAYER_JUMP,l.stealDistance=u.ObjectsData.STEAL_DISTANCE,l.delayDig=u.ObjectsData.DIG_TIME+Math.random(),l.gamecore=_.MainGameCore.instance,l.matchProcessor=x.MatchProcessor.instance,l.ball=l.gamecore.ball,l.playerSignal=v.Signals.PlayerSignal,1===l.SIDE?(l.marker=0,l.threePointDistance=u.ObjectsData.THREE_POINTS_DISTANCE,l.paintStartX=u.ObjectsData.PAINT_START_X,l.paintMiddleX=u.ObjectsData.PAINT_MIDDLE_X,l.dunkX=u.ObjectsData.DUNK_X,l.superDunkX=u.ObjectsData.ALLEY_OOP_X,l.superDashX=[u.ObjectsData.SUPER_DASH_X1,u.ObjectsData.SUPER_DASH_X2+130]):(l.marker=p,l.threePointDistance=p-u.ObjectsData.THREE_POINTS_DISTANCE,l.paintStartX=p-u.ObjectsData.PAINT_MIDDLE_X,l.paintMiddleX=p-u.ObjectsData.PAINT_START_X,l.dunkX=p-u.ObjectsData.DUNK_X,l.superDunkX=p-u.ObjectsData.ALLEY_OOP_X,l.superDashX=[u.ObjectsData.SUPER_DASH_X2,u.ObjectsData.SUPER_DASH_X1-130]),l.dunkStart1Y=u.ObjectsData.DUNK_ZONE1_Y,l.dunkStart2Y=u.ObjectsData.DUNK_ZONE2_Y,l.dunkY=u.ObjectsData.DUNK_Y,l.superDunkY=u.ObjectsData.ALLEY_OOP_Y,l.superDunkEndX=l.dunkX+20*l.SIDE,l.superDunkEndY=l.dunkY+30,l.superDashY=u.ObjectsData.SUPER_DASH_Y,0===i?l.superID=3:1===i?l.superID=0:2===i&&(l.superID=1);t=1,p=parseInt(s.substr(1,1));return 0<=s.indexOf("B")?(l.isHuman=!1,l.controller=new(0===p?u.AIController:u.AIController2)(l,l.superShot),l.controller.init(o)):(l.isHuman=!0,t=2,0===p?l.controller=new u.PlayerControllerGeneral(l):1===p?l.controller=new u.PlayerController(l):(l.controller=new u.PlayerController2(l),t=3)),l.energyBar=new u.EnergyBar(p,l.superID,o.coolDown),0===l.superID||2===l.superID?l.teleport=new u.Teleport:1===l.superID?l.shield=new f.ShieldObject(l.SIDE):l.superID,l.accuracy=o.accuracy,l.chanceToCompleteDunk=o.chanceToCompleteDunk,l.createGraphic(e,i,n,a.armature),l.createBody(),l.indents=[],0===r?(l.indents.push(y.get(d.default.WIDTH2+l.SIDE*u.ObjectsData.PLAYER_INDENT_X,u.ObjectsData.PLAYER_INDENT_Y)),r=-1===l.SIDE?u.ObjectsData.INDENT_GENERAL_X:d.default.WIDTH-u.ObjectsData.INDENT_GENERAL_X,l.indents.push(y.get(r,u.ObjectsData.PLAYER_INDENT_Y))):l.indents.push(y.get(d.default.WIDTH2+200*l.SIDE,u.ObjectsData.PLAYER_INDENT_Y)),l.baseFriction=u.Materials.PLAYER.dynamicFriction,l.shadow=new c.ShadowObject(l.graphic,t),l.dashDelay=new m.UseDelay(u.ObjectsData.DASH_DELAY),h.prototype.add.call(l),l.theSpace=l.body.space,l}e.PlayerObject=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(2),a=nape.geom.Vec2,l=nape.shape.Polygon,p=nape.phys.Body,h=nape.phys.BodyType,u=i(13),c=i(3),d=i(1),_=i(0),y=i(5),r=(s=o.GameObject,r(f,s),f.prototype.blickComplete=function(){this.currentTime=0,this.anim.visible=!1},f.prototype.addBodyToSpace=function(){this.body.space=this.theSpace},f.prototype.activate=function(){this.startPlay(),this.basket.hideEar(),y.default.getInstance().play(d.Sounds.shield)},f.prototype.hide=function(){this.graphic.visible=!1,this.currentTime=-1},f.prototype.startPlay=function(){this.graphic.alpha=1,this.graphic.visible=!0,this.animBlur.visible=!0,this.animStart.visible=!1;var t=c.default.game.add.tween(this.animBlur);t.from({y:-600},120,_.Easing.Back.Out,!1),t.start(),(t=c.default.game.add.tween({x:0})).onComplete.addOnce(this.blackTween,this),t.to({x:100},140,_.Easing.Linear.None,!1),t.start()},f.prototype.blackTween=function(){this.animStart.visible=!0,this.animBlur.visible=!1,this.anim.visible=!0,this.anim.animations.getAnimation("ShieldMC2").play(30)},f.prototype.update=function(t){void 0===t&&(t=0),this.graphic.visible&&0<=this.currentTime&&(this.currentTime+=t,this.currentTime>=this.showTime)&&(this.currentTime=-1,(t=c.default.game.add.tween(this.graphic)).onComplete.addOnce(this.hide,this),t.to({alpha:0},500).start(),this.body.space=null,this.basket.showEar())},f.prototype.release=function(){this.theSpace=null,this.basket=null},f);function f(t){var e=s.call(this)||this;e.showTime=3,e.currentTime=0,e.animBlur=null,e.animStart=null,e.anim=null,e.objType=o.ObjectsType.EFFECTS,e.graphic=new Phaser.Group(c.default.game),e.animBlur=new Phaser.Image(c.default.game,1,0,d.Atlases.Gameplay,"ShieldMC0000"),e.animStart=new Phaser.Image(c.default.game,1,0,d.Atlases.Gameplay,"ShieldMC0000"),e.animBlur.anchor.set(.5),e.animStart.anchor.set(.5),e.anim=c.default.game.make.sprite(0,0,d.Atlases.Gameplay,"bg0000"),e.anim.anchor.set(.5),e.anim.animations.add("ShieldMC2",Phaser.Animation.generateFrameNames("ShieldMC2",0,20,"",4)),e.anim.animations.getAnimation("ShieldMC2").play(30),e.anim.animations.getAnimation("ShieldMC2").stop(),e.anim.animations.getAnimation("ShieldMC2").onStart.add(e.addBodyToSpace,e),e.anim.animations.getAnimation("ShieldMC2").onComplete.add(e.blickComplete,e);var i,n=-49;-1===t?(i=o.ObjectsData.BASKET_CENTER-23,e.basket=u.MainGameCore.instance.basket1,n+=26):(i=o.ObjectsData.BASKET_CENTER2+23,e.graphic.scale.set(-1,1),e.basket=u.MainGameCore.instance.basket2);var r=o.ObjectsData.BASKET_HEIGHT-62;e.filterBlur=c.default.game.add.filter("BlurY"),e.body=new p(h.STATIC,a.get(i,r));n=new l(l.rect(n,30,70,10));return n.filter=o.Filters.ARENA,n.cbTypes.add(o.CbTypes.cbShield),e.body.shapes.add(n),e.body.userData.side=t,s.prototype.add.call(e),e.graphic.addChild(e.animStart),e.graphic.addChild(e.animBlur),e.graphic.addChild(e.anim),e.animBlur.filters=[e.filterBlur],e.theSpace=e.body.space,e.body.space=null,e.hide(),e}e.ShieldObject=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,i=i(20),r=(s=i.FullDelay,r(o,s),o.prototype.activate=function(){this.delta=0,this.delay=this.range},o);function o(t){return s.call(this,t)||this}e.UseDelay=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,i=i(48),r=(s=i.BaseAIController,r(o,s),o.prototype.onJumpBall=function(){this.opponent=this.opponents[0],this.jumpBall.activate()},o);function o(t,e){return s.call(this,t,e)||this}e.AIController=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,i=i(20),r=(s=i.FullDelay,r(o,s),o.prototype.activate=function(){s.prototype.activate.call(this);var t=Math.random()<=.5?-1:1;this.delay=this.fixed+t*this.dispersion},o);function o(t,e){return void 0===e&&(e=0),s.call(this,t,e)||this}e.NegativeDelay=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,i=i(20),r=(s=i.FullDelay,r(o,s),o.prototype.activate=function(){this.delta=0,this.delay=this.range*Math.random()},o);function o(t){return s.call(this,t)||this}e.SimpleDelay=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,i=i(20),r=(s=i.FullDelay,r(o,s),o.prototype.activate=function(){this.delta=0,this.delay=Math.random()*this.range},o.prototype.update=function(t){if(0<=this.delta)return this.result=0,this.delta+=t,this.delta>=this.delay&&(this.result=1,this.delta=-1),this.result;if(-1===this.delta)return-1;var e=-2;return this.delta+=t,-1<=this.delta&&(e=this.delta=-1),e},o.prototype.useIt=function(){this.delta=-1-this.fixed},o.prototype.skipIt=function(){this.delta=-1-this.fixed/2},o);function o(t,e){return void 0===e&&(e=0),s.call(this,t,e)||this}e.AIUseDelay=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(48),a=i(2),r=(s=o.BaseAIController,r(l,s),l.prototype.onJumpBall=function(){0===this.playerNo&&this.jumpBall.activate(),this.opponent=this.opponents[this.playerNo]},l.prototype.ballInOwnHands=function(t){void 0===t&&(t=0),this.opponent=this.opponents[t],this.playerNo===t?(this.currentNo=0,s.prototype.ballInOwnHands.call(this)):(this.currentNo=1,this.resetBaseDelays(),this.resetCurrents(),this.strategy=4,this.reboundPoint=this.reboundPointInAttack)},l.prototype.ballInOpponentsHands=function(t){void 0===t&&(t=0),s.prototype.ballInOpponentsHands.call(this,t),this.opponent=this.opponents[t],this.playerNo!=t&&(this.strategy=5)},l.prototype.init=function(t){s.prototype.init.call(this,t),this.chanceForThree*=a.ObjectsData.CHANCE_FOR_THREE2},l.prototype.strategyDefence2=function(t){this.currentMove=this.moveToo(this.defensePoint);var e=this.stealDelay.update(t);-1===e&&this.tryToSteal(),this.currentAction=1===e,this.currentJump=1===this.defence.update(t)&&this.isOpponentCloseBehind(180)},l);function l(t,e){e=s.call(this,t,e)||this;return e.defensePoint=-1===e.SIDE?a.ObjectsData.DEFENSE_POINT:e.width-a.ObjectsData.DEFENSE_POINT,e}e.AIController2=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(14),a=i(49),l=i(0),r=(s=a.PlayerBaseController,r(p,s),p.prototype.update=function(){this.currentMove=0,this.currentDash=0,o.default.instance.isbtnA&&(o.default.instance.isbtnADouble&&(this.currentDash=-1),this.currentMove--),o.default.instance.isbtnD&&(o.default.instance.isbtnDDouble&&(this.currentDash=1),this.currentMove++),this.currentJump=o.default.instance.isbtnW,this.currentAction=o.default.instance.isbtnB,this.currentSuper=o.default.instance.isbtnV,this.currentBlockOrPump=o.default.instance.isbtnS},p.prototype.readyForAction=function(){return!o.default.instance.isbtnV},p.prototype.releaseBlockOrPump=function(){return!o.default.instance.isbtnS},p.prototype.getJump=function(){return o.default.instance.isbtnW},p.prototype.readyToJump=function(){return!o.default.instance.isbtnW},p.prototype.getShoot=function(){return o.default.instance.isbtnB},p.prototype.getTackle=function(){return o.default.instance.isbtnS},p.prototype.getSuperShot=function(){return o.default.instance.isbtnV},p);function p(t){t=s.call(this,t)||this;return t.moveLeftKey=l.Keyboard.A,t.moveRightKey=l.Keyboard.D,t.jumpKey=l.Keyboard.W,t.downKey=l.Keyboard.S,t.actionKey=l.Keyboard.B,t.superKey=l.Keyboard.V,t}e.PlayerController=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(14),i=i(49),r=(s=i.PlayerBaseController,r(a,s),a.prototype.update=function(){this.currentMove=0,this.currentDash=0,o.default.instance.isbtnLeft&&(o.default.instance.isbtnLeftDouble&&(this.currentDash=-1),this.currentMove--),o.default.instance.isbtnRight&&(o.default.instance.isbtnRightDouble&&(this.currentDash=1),this.currentMove++),this.currentJump=o.default.instance.isbtnUp,this.currentAction=o.default.instance.isbtnL,this.currentSuper=o.default.instance.isbtnK,this.currentBlockOrPump=o.default.instance.isbtnDown},a.prototype.readyForAction=function(){return!o.default.instance.isbtnL},a.prototype.releaseBlockOrPump=function(){return!o.default.instance.isbtnDown},a.prototype.getJump=function(){return o.default.instance.isbtnUp},a.prototype.readyToJump=function(){return!o.default.instance.isbtnUp},a.prototype.getShoot=function(){return o.default.instance.isbtnL},a.prototype.getTackle=function(){return o.default.instance.isbtnDown},a.prototype.getSuperShot=function(){return o.default.instance.isbtnK},a);function a(t){return s.call(this,t)||this}e.PlayerController2=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(25),a=i(14),r=(s=o.BaseController,r(l,s),l.prototype.update=function(t){this.currentDash=0,a.default.instance.isbtnLeft||a.default.instance.isbtnA?(this.currentMove=-1,(a.default.instance.isbtnLeftDouble||a.default.instance.isbtnADouble)&&(this.currentDash=-1)):a.default.instance.isbtnRight||a.default.instance.isbtnD?(this.currentMove=1,(a.default.instance.isbtnRightDouble||a.default.instance.isbtnDDouble)&&(this.currentDash=1)):this.currentMove=0,this.currentJump=a.default.instance.isbtnUp||a.default.instance.isbtnW,this.currentAction=a.default.instance.isbtnX||a.default.instance.isbtnL,this.currentSuper=a.default.instance.isbtnZ||a.default.instance.isbtnK,this.currentBlockOrPump=a.default.instance.isbtnDown||a.default.instance.isbtnS},l.prototype.readyForAction=function(){return!a.default.instance.isbtnL&&!a.default.instance.isbtnX},l.prototype.releaseBlockOrPump=function(t){return!a.default.instance.isbtnDown&&!a.default.instance.isbtnS},l.prototype.getJump=function(){return a.default.instance.isbtnUp||a.default.instance.isbtnW},l.prototype.readyToJump=function(){return!0!==a.default.instance.isbtnUp&&!0!==a.default.instance.isbtnW},l.prototype.getShoot=function(){return a.default.instance.isbtnX||a.default.instance.isbtnL},l.prototype.getTackle=function(){return a.default.instance.isbtnDown||a.default.instance.isbtnS},l.prototype.getSuperShot=function(){return a.default.instance.isbtnZ||a.default.instance.isbtnK},l);function l(t){t=s.call(this,t)||this;return t.type=1,t}e.PlayerControllerGeneral=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(2),a=i(16),l=i(3),p=i(1),h=i(0),r=(s=o.GameObject,r(u,s),u.prototype.startPlay=function(t,e){this.graphic.x=t,this.graphic.y=e,this.graphic.visible=!0,this.anim.visible=!1,this.whiteBg.visible=!1,this.whiteBg.scale.set(.086,.027),this.blackBg.scale.set(.12);e=this.blackBg.game.add.tween(this.blackBg.scale);e.onComplete.addOnce(this.blackTween,this),e.to({x:1,y:1},60,h.Easing.Linear.None,!1),e.start(),(e=this.blackBg.game.add.tween(this.blackBg)).to({angle:180},60,h.Easing.Linear.None,!1),e.start()},u.prototype.blackTween=function(){this.anim.visible=!0;var t=this.blackBg.game.add.tween(this.blackBg.scale);t.to({x:0,y:0},80,h.Easing.Back.In,!1),t.start();t=this.blackBg.game.add.tween(this.blackBg);t.onComplete.addOnce(this.whiteTween,this),t.to({angle:360},70,h.Easing.Linear.None,!1),t.start(),this.anim.animations.getAnimation("teleport3").play(30)},u.prototype.whiteTween=function(){this.whiteBg.visible=!0,this.anim.visible=!1;var t=this.blackBg.game.add.tween(this.whiteBg.scale);t.onComplete.addOnce(this.endPlay,this),t.to({x:.658,y:.596},30,h.Easing.Linear.None).to({x:.084,y:1.258},30,h.Easing.Linear.None).to({x:.028,y:.072},24,h.Easing.Linear.None),t.start()},u.prototype.endPlay=function(){this.graphic.visible=!1},u);function u(){var t=s.call(this)||this;t.tween=null,t.blackBg=null,t.whiteBg=null,t.anim=null,t.graphic=new Phaser.Group(l.default.game),t.blackBg=l.default.game.make.sprite(0,0,p.Atlases.Gameplay,"teleport10000"),t.whiteBg=l.default.game.make.sprite(0,0,p.Atlases.Gameplay,"teleport40000"),t.anim=l.default.game.make.sprite(0,0,p.Atlases.Gameplay,"bg0000"),t.anim.anchor.set(.5),t.anim.animations.add("teleport3",Phaser.Animation.generateFrameNames("teleport3",0,3,"",4)),t.anim.animations.getAnimation("teleport3").play(30),t.anim.animations.getAnimation("teleport3").stop(),t.blackBg.anchor.set(.5),t.whiteBg.anchor.set(.5);var e=l.default.game.make.image(0,0,p.Atlases.Gameplay,"teleport20000");return e.anchor.set(.5),t.graphic.addChild(t.blackBg),t.graphic.addChild(t.anim),t.graphic.addChild(t.whiteBg),t.blackBg.addChild(e),t.objType=a.ObjectsType.EFFECTS,t.endPlay(),s.prototype.add.call(t),t}e.Teleport=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(2),a=i(16),l=i(3),p=i(10),h=i(1),u=i(0),r=(s=o.GameObject,r(c,s),c.prototype.activate=function(){this.graphic.visible=!0,this.msg.setText(""),this.timer=0,this.curentFrame=1},c.prototype.tween=function(t){3<=t?this.msg.setText(" GO!!!"):this.msg.setText(""+(3-t)),this.curentFrame=t,this.graphic.scale.set(1),this.graphic.visible=!0,l.default.game.add.tween(this.graphic.scale).from({x:.2,y:.2},100,u.Easing.Back.Out,!0)},c.prototype.hide=function(){this.graphic.visible=!1},c.prototype.process=function(t){void 0===t&&(t=0),this.timer+=t;t=Math.floor(3*this.timer);return 4===t?(this.hide(),!0):(t!==this.curentFrame&&this.tween(t),!1)},c.prototype.release=function(){s.prototype.release.call(this)},c.prototype.dispose=function(){},c);function c(){var t=s.call(this)||this;return t.msg=null,t.graphic=l.default.game.add.group(),t.msg=new p.default(l.default.game,"GO!!!",h.Constants.styleMSG,null,null,h.Atlases.Gameplay),t.msg.setFrames("bg0000","bg0000","bg0000","bg0000"),t.msg.setProp("#FFFFFF",14),t.msg.btn.label.setMaxSize(400,110),t.graphic.addChild(t.msg),t.graphic.x=400,t.graphic.y=170,t.hide(),t.objType=a.ObjectsType.INFO,t.timer=0,t.curentFrame=1,s.prototype.add.call(t),t}e.CountDownObject=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(3),a=i(1),l=i(19),p=i(7),r=(s=Phaser.Group,r(h,s),h.prototype.reset=function(){this.curTime=0,this.energyBarForMask.visible=!0,this.energyBarMask.rotation=0,this.update(0),this.energyBarForMask.mask=this.energyBarMask},h.prototype.update=function(t){if(void 0===t&&(t=0),this.curTime+=t,this.energyBarMask.clear(),this.curTime>=this.fullTime)return!(this.energyBarForMask.visible=!1);this.frame=36*this.curTime/this.fullTime>>0,this.energyBarMask.beginFill(16711680,.5),this.energyBarMask.arc(0,0,36.5,0,l.default.TO_RAD*(10*this.frame),!0),this.energyBarMask.endFill(),this.energyBarMask.rotation=l.default.TO_RAD*(-90-10*this.frame)},h.prototype.dispose=function(){this.energyBar=null,this.energyBarMask=null,this.bg=null,this.curTime=0,this.hint=null,this.energyBarForMask=null},h);function h(t,e,i){var n=s.call(this,o.default.game)||this;n.bg=null,n.frame=0,n.curTime=0,n.fullTime=i,n.bg=n.game.make.sprite(0,1,a.Atlases.Gameplay,"btn_bg20000"),n.bg.anchor.set(.5),n.bg.scale.set(1.1),n.addChild(n.bg);i="Z";return 0===t?n.x=45:1===t?(n.x=185,i="V"):2===t&&(n.x=614,i="K"),n.energyBar=n.game.make.sprite(0,0,a.Atlases.Gameplay,"icon_ball000"+e),n.energyBarForMask=n.game.make.sprite(0,0,a.Atlases.Gameplay,"icon_ball2000"+e),n.hint=new p.default(n.game,i,a.Constants.styleHintSkillKey,null,null,a.Atlases.Gameplay),n.hint.setFrames("key_hint0000","key_hint0000","key_hint0000","key_hint0000"),n.hint.x=-30,n.hint.y=30,n.y=45,n.energyBar.anchor.set(.5),n.energyBarForMask.anchor.set(.5),n.addChild(n.energyBar),n.addChild(n.energyBarForMask),n.addChild(n.hint),n.energyBarMask=n.game.add.graphics(0,0,n),n.energyBarForMask.mask=n.energyBarMask,n}e.EnergyBar=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(2),a=i(16),l=i(3),p=i(10),h=i(1),u=i(0),c=i(19),r=(s=o.GameObject,r(d,s),d.prototype.hide=function(){this.graphic.visible=!1},d.prototype.show=function(t){this.msgGraphics.children[0].visible=!1,this.msgGraphics.children[1].visible=!1,l.default.game.tweens.removeFrom(this.graphic.scale),this.msg.setText(" "+t+" "),this.msg2.setText(""),this.msg.y=0,this.graphic.scale.set(1),this.graphic.visible=!0;t=l.default.game.add.tween(this.graphic.scale);t.from({x:.2,y:.2},270,u.Easing.Back.Out,!1),t.onComplete.addOnce(this.continueTween,this),t.start()},d.prototype.show2=function(t,e){var i,n;if(void 0===e&&(e=0),this.msgGraphics.children[0].visible=!1,this.msgGraphics.children[1].visible=!1,l.default.game.tweens.removeFrom(this.graphic.scale),0===t)n=2===(o=Math.random()<=.5?2:3)?(i="THREE!!!","PO-O-O-INT!!!"):(i="FROM","DOWNTOWN");else if(1===t){switch(o=4+4*Math.random()>>0){case 4:i="JAM!!!";break;case 5:i="DUUUNK!!!";break;case 6:i="FLUSH!!!";break;case 7:i="STUFF!!!"}n=""}else if(2===t)o=10,i="FROM",n="BLOCK!!!";else if(3===t)o=15,i="BUZZER",n="BEATER!!!";else if(4===t)switch(o=11+3*Math.random()>>0){case 11:i="FROM",n="BLOCK!!!";break;case 12:i="BLOCK",n="SHOT";break;case 13:i="REJECTED",n="";break;case 14:i="DENIED!!!",n=""}else if(6===t)o=1,i="SCORE!!!",n="";else if(7===t)o=8,i="MEGA",n="DU-U-U-NK!!!";else if(8===t)o=9,i="ALLEY-",n="O-O-OP!!!";else if(9===t)o=14,i="BRICK!!!",n="";else{if(11===t)return void this.show("OVERTIME");if(10===t)return void this.show("TIME!!!")}for(var r=l.default.game.cache.getJSON(h.JSONData.Players)["parts"+o],s=0;s<4;s++)r.hasOwnProperty(s)&&"BallClipMsg"===r[s].g&&(this.msgGraphics.children[0].visible?(this.msgGraphics.children[1].visible=!0,this.msgGraphics.children[1].x=r[s].x,this.msgGraphics.children[1].y=r[s].y,this.msgGraphics.children[1].rotation=r[s].r*c.default.TO_RAD,this.msgGraphics.children[1].scale.set(r[s].scaleX,r[s].scaleY)):(this.msgGraphics.children[0].visible=!0,this.msgGraphics.children[0].x=r[s].x,this.msgGraphics.children[0].y=r[s].y,this.msgGraphics.children[0].rotation=r[s].r*c.default.TO_RAD,this.msgGraphics.children[0].scale.set(r[s].scaleX,r[s].scaleY)));this.msg.setText(" "+i+" "),this.msg2.setText(" "+n+" "),0<n.length?(this.msg.y=-40,this.msg2.y=40):this.msg.y=0,this.graphic.scale.set(1),this.graphic.visible=!0;var o=l.default.game.add.tween(this.graphic.scale);o.from({x:.2,y:.2},270,u.Easing.Back.Out,!1),o.onComplete.addOnce(this.continueTween,this),o.start()},d.prototype.continueTween=function(){var t=l.default.game.add.tween(this.graphic.scale);t.to({x:.9,y:.9},450,u.Easing.Back.Out,!1),t.onComplete.addOnce(this.hide,this),t.start()},d.prototype.release=function(){s.prototype.release.call(this)},d);function d(){var t=s.call(this)||this;t.msg=null,t.msg2=null,t.msgGraphics=null,t.graphic=l.default.game.add.group(),t.msgGraphics=l.default.game.add.group(),t.msg=new p.default(l.default.game,"111111111111",h.Constants.styleMSG,null,null,h.Atlases.Gameplay),t.msg.setFrames("bg0000","bg0000","bg0000","bg0000"),t.msg.setProp("#FFFFFF",12),t.msg.btn.label.setMaxSize(640,110),t.graphic.addChild(t.msgGraphics),t.graphic.addChild(t.msg),t.msg2=new p.default(l.default.game,"111111111111",h.Constants.styleMSG,null,null,h.Atlases.Gameplay),t.msg2.setFrames("bg0000","bg0000","bg0000","bg0000"),t.msg2.setProp("#FFFFFF",12),t.msg2.btn.label.setMaxSize(640,110),t.graphic.addChild(t.msg2),t.graphic.x=400,t.graphic.y=240,t.hide(),t.objType=a.ObjectsType.INFO;var e=l.default.game.make.image(0,0,h.Atlases.Gameplay,"BallClipMsg0000");e.anchor.set(.5);var i=l.default.game.make.image(0,0,h.Atlases.Gameplay,"BallClipMsg0000");return i.anchor.set(.5),t.msgGraphics.addChild(e),t.msgGraphics.addChild(i),s.prototype.add.call(t),t}e.MessageInfo=r},function(t,e,i){"use strict";e.__esModule=!0;var n=(r.prototype.init=function(t){this.setupParticles()},r.prototype.setupParticles=function(){},r.prototype.step=function(){},r.prototype.activate=function(t,e,i){},r.prototype.update=function(t,e){},r.prototype.dispose=function(){},r.prototype.stop=function(){},r.prototype.hide=function(){},r.prototype.show=function(){},r.prototype.getActive=function(){return!1},r);function r(){}e.BallTrail=n},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var l,p=i(3),h=i(2),s=i(0),u=i(1),c=i(7),o=i(5),r=(l=Phaser.Group,r(d,l),d.prototype.updateEmblems=function(){this.emblems.loadTexture(u.Atlases.Interface,"Emblems00"+(this.emblem<=10?"0":"")+(this.emblem-1))},d.prototype.setSuperHint=function(){},d.prototype.setUp=function(t){void 0===t&&(t=0);var e=h.Inventory.instance.matchData.matchMode;0===t?(this.label1.setText("Player "+(this.id+1).toString()),this.label2.setText("CPU"),this.label1.visible=!0,this.label2.visible=1===e,this.shadow1.visible=!0,this.shadow2.visible=1===e):1===t?(this.label1.visible=!0,this.label2.visible=!0,this.label1.setText("Player 1"),this.label2.setText("Player 2"),this.shadow1.visible=!0,this.shadow2.visible=!0):2===t&&(this.label1.setText("CPU 1"),this.label2.setText("CPU 2"),this.label1.visible=!0,this.label2.visible=1===e||2===e,this.shadow1.visible=!0,this.shadow2.visible=1===e||2===e)},d.prototype.initPlayers=function(){for(var t=0;t<d.NUM_PLAYERS;t++){var e=new s.Sprite(this.game,100*t-100,179,u.Atlases.Interface,"bg0000");e.scale.set(.65),e.anchor.set(.5),this.addChild(e);var i=dragonBones.PhaserFactory.factory.buildArmatureDisplay("player");i.animation.play("idle",0),i.y=80,this.armatures[t]=i.armature,e.addChild(i),e.inputEnabled=!0,e.name=t.toString(),e.events.onInputDown.add(this.onArmatureClick,this),this.players[t]=e}this.showPlayers()},d.prototype.showPlayers=function(){if(this.armatures[0]){var t=2*(this.emblem-1),e=d.NUM_PLAYERS*this.emblem-3;h.PlayersData.switchPlayer(this.armatures[0],e,t),this.playerNames[0].setText("");for(var i=1;i<d.NUM_PLAYERS;i++)h.PlayersData.switchPlayer(this.armatures[i],e+i,t),this.playerNames[i].setText("")}this.onArmatureClick(null,h.Inventory.instance.matchData.players[this.id][0])},d.prototype.onArmatureClick=function(t,e){void 0===t&&(t=null),void 0===e&&(e=-1);var i=0<=e;i||(e=null==t?0:Number.parseInt(t.name));t=h.Inventory.instance.matchData.players[this.id];if(t[0]!==e||i){for(var n=0;n<d.NUM_PLAYERS;n++){var r=this.armatures[n];this.players[n];n===e?r.animation.play("idle",-1):r.animation.gotoAndStopByTime("idle",0)}i=t[0];i===(t[0]=e)&&(i=e+1)>=d.NUM_PLAYERS&&(i=0),t[1]=i,this.label1.x=d.defaultStartX+e*d.defaultDx,this.shadow1.x=d.defaultStartX+e*d.defaultDx,this.label2.x=d.defaultStartX+i*d.defaultDx,this.shadow2.x=d.defaultStartX+i*d.defaultDx}},d.prototype.changeTeam1=function(t){o.default.getInstance().play(u.Sounds.button),this.team=-1,this.checkEmblem(),0!==h.Inventory.instance.gameMode&&this.emblem===h.Inventory.instance.matchData.teams[(this.id+1)%2]&&this.checkEmblem(),this.updateClub()},d.prototype.changeTeam2=function(t){o.default.getInstance().play(u.Sounds.button),this.team=1,this.checkEmblem(),0!==h.Inventory.instance.gameMode&&this.emblem===h.Inventory.instance.matchData.teams[(this.id+1)%2]&&this.checkEmblem(),this.updateClub()},d.prototype.updateClub=function(){h.Inventory.instance.matchData.teams[this.id]=this.emblem,this.updateEmblems(),this.setSuperHint(),this.showPlayers()},d.prototype.checkEmblem=function(){this.emblem+=this.team,0===this.emblem?this.emblem=20:21===this.emblem&&(this.emblem=1)},d.prototype.destroy=function(){for(var t=0;t<d.NUM_PLAYERS;t++)this.armatures[t]=null,this.players[t]=null;this.manager=null,l.prototype.destroy.call(this)},d.defaultStartX=-100,d.defaultDx=100,d.NUM_PLAYERS=3,d.SUPER_HINTS=["Fast Break","Mega Dunk","Defence     "],d.SUPER_IMAGES=["icon_ball0003","icon_ball0000","icon_ball0001"],d);function d(t,e){void 0===e&&(e=!0);var i=l.call(this,p.default.game)||this;i.armatures=new Array(d.NUM_PLAYERS),i.players=new Array(d.NUM_PLAYERS),i.playerNames=new Array(d.NUM_PLAYERS),i.superHints=new Array(d.NUM_PLAYERS),i.superHintImgs=new Array(d.NUM_PLAYERS),i.playerBgs=new Array(d.NUM_PLAYERS),i.team=0,i.id=t,i.manager=h.Inventory.instance,i.bg=i.game.add.sprite(0,15,u.Atlases.Interface,"0bg100000"),i.bg.anchor.set(.5,.22),i.addChild(i.bg),0===t?i.bg.scale.set(-.85,.9):i.bg.scale.set(.85,.9),i.isLocal=i.manager.isLocal,i.btnLeft=new c.default(i.game,"",{},i.changeTeam1,i,u.Atlases.Interface),i.btnRight=new c.default(i.game,"",{},i.changeTeam2,i,u.Atlases.Interface);for(var n=-.5*(d.NUM_PLAYERS-1)*100,r=0;r<d.NUM_PLAYERS;r++){i.superHints[r]=new c.default(i.game,d.SUPER_HINTS[r],u.Constants.styleSkillName,null,null,u.Atlases.Interface),i.playerNames[r]=new c.default(i.game,"",u.Constants.stylePlayerName,null,null,u.Atlases.Interface),i.playerNames[r].label.setMaxSize(150,60),i.playerNames[r].setFrames("bg0000","bg0000","bg0000","bg0000"),i.superHints[r].setFrames("bg0000","bg0000","bg0000","bg0000"),i.superHints[r].label.boundsAlignH="left";var s=d.defaultStartX,o=d.defaultDx;i.superHintImgs[r]=i.game.add.image(s-28+r*o,250,u.Atlases.Gameplay,d.SUPER_IMAGES[r]),i.superHintImgs[r].anchor.set(.5),i.superHintImgs[r].scale.set(.3);var a=void 0;(a=i.game.add.image(n-26+100*r,250,u.Atlases.Gameplay,"btn_bg0000")).anchor.set(.5),a.scale.set(.258),i.addChild(a),i.playerBgs[r]=a,i.addChild(i.playerNames[r]),i.addChild(i.superHints[r]),i.playerNames[r].x=s+r*o,i.playerNames[r].y=90,i.superHints[r].x=s+24+r*o,i.superHints[r].y=250,i.addChild(i.superHintImgs[r])}i.label1=new c.default(i.game,"",u.Constants.stylePlayer,null,null,u.Atlases.Interface),i.label2=new c.default(i.game,"",u.Constants.stylePlayer,null,null,u.Atlases.Interface),i.label1.setFrames("bg0000","bg0000","bg0000","bg0000"),i.label2.setFrames("bg0000","bg0000","bg0000","bg0000"),i.btnLeft.setFrames("BtnLeft0000","BtnLeft0000","BtnLeft0000","BtnLeft0000"),i.btnRight.setFrames("BtnLeft0000","BtnLeft0000","BtnLeft0000","BtnLeft0000"),i.btnLeft.x=-89,i.btnLeft.y=10,i.btnRight.x=89,i.btnRight.y=10,i.btnRight.scale.set(-1,1),e||(i.btnLeft.visible=!1,i.btnRight.visible=!1),i.shadow1=i.game.add.image(-75,160,u.Atlases.Interface,"loginSelect0000"),i.shadow1.anchor.set(.5),i.shadow1.scale.set(1.2),i.addChild(i.shadow1),i.shadow2=i.game.add.image(80,160,u.Atlases.Interface,"loginSelect0000"),i.shadow2.anchor.set(.5),i.shadow2.scale.set(1.2),i.addChild(i.shadow2),i.addChild(i.btnLeft),i.addChild(i.btnRight);e=h.Inventory.instance.matchData;return 0===e.teams[t]?(1===t&&2===e.teams[0]?i.emblem=1:i.emblem=2,e.teams[t]=i.emblem):(1===t&&e.teams[0]===e.teams[1]&&(2===e.teams[0]?i.emblem=1:i.emblem=2,e.teams[t]=i.emblem),i.emblem=h.Inventory.instance.matchData.teams[t]),i.emblems=i.game.add.image(0,0,u.Atlases.Interface,"Emblems00"+(i.emblem<=10?"0":"")+(i.emblem-1)),i.setSuperHint(),i.emblems.anchor.set(.5),i.emblems.scale.set(.35),i.addChild(i.emblems),i.addChild(i.label1),i.addChild(i.label2),i.label1.y=60,i.label2.y=60,i.initPlayers(),i.game.add.existing(i),i}e.SelectPlayer=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var a,l=i(3),p=i(1),h=i(10),u=i(2),s=i(51),r=(a=Phaser.Group,r(o,a),o.prototype.createTitle=function(){this.title=new h.default(this.game,this.defineLeg(),p.Constants.stylePreMatchTop,null,null,p.Atlases.Interface),this.title.setFrames("bg0000","bg0000","bg0000","bg0000"),this.addChild(this.title)},o.prototype.createMode=function(){this.matchModePanel=new s.MatchModePanel(null),this.matchModePanel.y=220,this.matchModePanel.hideBG(),this.matchModePanel.showCurrentMode(),this.addChild(this.matchModePanel)},o.prototype.createTitleState=function(t,e){this.title_state=new h.default(this.game,t,e,null,null,p.Atlases.Interface),this.title_state.setFrames("bg0000","bg0000","bg0000","bg0000"),2===this.id?this.title_state.y=-50:this.title_state.y=55,this.addChild(this.title_state)},o.prototype.defineLeg=function(){var t,e=u.Inventory.instance.tournament.state;return 0===e?t="ROUND OF 16":1===e?t="QUARTERFINAL":2===e?t="SEMIFINAL":3===e&&(t=u.Inventory.instance.isFinal()?"FINAL":"3rd PLACE MATCH"),t},o);function o(t){var e=a.call(this,l.default.game)||this;e.id=t;var i=u.Inventory.instance.matchData.teams[0]-1,n=u.Inventory.instance.matchData.teams[1]-1,r="",s="",o=1;return 0===t?(r="MATCH PREVIEW",e.createTitle(),e.createTitleState(r,p.Constants.stylePreMatchState),s="0 : 0",e.createMode()):(o=2,r=u.Inventory.instance.matchData.matchScore[0]>u.Inventory.instance.matchData.matchScore[1]?"YOU WON!!!":"YOU LOST",e.createTitleState(r,p.Constants.styleEndMatchTop),s=u.Inventory.instance.matchData.matchScore[0].toString()+" : "+u.Inventory.instance.matchData.matchScore[1].toString()),e.score=new h.default(e.game,s,2===e.id?p.Constants.styleEndMatchScore:p.Constants.stylePreMatchScore,null,null,p.Atlases.Interface),e.score.setFrames("bg0000","bg0000","bg0000","bg0000"),2===e.id?e.score.y=60:e.score.y=140,e.addChild(e.score),e.ccc=new h.default(e.game,"",p.Constants.stylePreMatchNames,null,null,p.Atlases.Interface),e.ccc.setFrames("bg0000","bg0000","bg0000","bg0000"),e.ccc.y=220,e.ccc.x=-150*o,e.addChild(e.ccc),e.ccc2=new h.default(e.game,"",p.Constants.stylePreMatchNames,null,null,p.Atlases.Interface),e.ccc2.setFrames("bg0000","bg0000","bg0000","bg0000"),e.ccc2.y=220,e.ccc2.x=150*o,e.addChild(e.ccc2),e.ccc.visible=!1,e.ccc2.visible=!1,e.team1=e.game.add.image(-270,0,p.Atlases.Interface,"emptyBg0000"),e.team1.anchor.set(.5),e.team1.scale.set(.75),e.team1.y=50,e.addChild(e.team1),e.team2=e.game.add.image(270,0,p.Atlases.Interface,"emptyBg0000"),e.team2.anchor.set(.5),e.team2.scale.set(.75),e.team2.y=50,e.addChild(e.team2),e.team1.loadTexture(p.Atlases.Interface,"Emblems00"+(i<10?"0":"")+i),e.team2.loadTexture(p.Atlases.Interface,"Emblems00"+(n<10?"0":"")+n),e}e.PreMatchPanelResult=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0,i(6),i(0);var s,o=i(5),a=i(1),l=i(17),p=i(8),h=i(10),u=i(18),c=i(105),d=i(2),_=i(4),y=i(0),f=i(12),r=(s=Phaser.State,r(m,s),m.prototype.init=function(){this.game.world.removeAll(),this.manager=d.Inventory.instance,this.table=[]},m.prototype.create=function(){s.prototype.create.call(this),this.backgroundBase=this.game.add.sprite(0,0,a.Atlases.Interface,p.default.getBG()),this.backgroundBase2=this.game.add.sprite(299,0,a.Atlases.Interface,"bg0000"),this.backgroundBase.addChild(this.backgroundBase2),this.backgroundBaseMask=this.game.add.graphics(0,0),this.backgroundBaseMask.beginFill(65280,0),this.backgroundBaseMask.drawRect(0,0,1398,480),this.backgroundBaseMask.endFill(),this.background4=this.game.add.sprite(200,240,a.Atlases.Interface,"bg0000"),this.background4.anchor.set(.5),this.createButtons(),this.setUp(),this.backgroundBase2.addChild(this.background4),this.logo=this.game.add.sprite(400,25,a.Atlases.Interface,"bg0000"),this.logo.anchor.set(.5);var t=new h.default(this.game,"TOURNAMENT GRID",a.Constants.styleTitle2,null,null,a.Atlases.Interface);t.setFrames("bg0000","bg0000","bg0000","bg0000"),this.logo.addChild(t),this.logo.x=400,this.backgroundBase2.addChild(this.logo),this.playBtn=new h.default(this.game,"NEXT",a.Constants.stylePlayGreen,this.onPlay,this,a.Atlases.Interface),this.playBtn.setFrames("arrow20000","arrow20000","arrow20000","arrow20000"),this.playBtn.btn.btn.x=110,this.playBtn.x=646,this.playBtn.y=450;t=this.game.add.image(0,0,a.Atlases.Interface,"bg0000");t.anchor.set(.5),t.x=-80,t.height=58,t.width=200,this.playBtn.btn.btn.addChildAt(t,0),this.backBtn=new h.default(this.game,"BACK",a.Constants.styleBackArrow,this.onBack,this,a.Atlases.Interface),this.backBtn.setFrames("arrow0000","arrow0000","arrow0000","arrow0000"),this.backBtn.btn.btn.x=-110,this.backBtn.x=160,this.backBtn.y=450,(t=this.game.add.image(0,0,a.Atlases.Interface,"bg0000")).anchor.set(.5),t.x=80,t.height=58,t.width=200,this.backBtn.btn.btn.addChild(t),this.backgroundBase2.addChild(this.backBtn),this.backgroundBase2.addChild(this.playBtn),this.resize(),new l.default(this.game,this,this.show)},m.prototype.show=function(){var t=this.game.add.tween(this.logo);t.from({alpha:.001},_.default.PRELOADER_TIME),t.start(),(t=this.game.add.tween(this.playBtn)).from({y:520},_.default.PRELOADER_TIME,y.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.backBtn)).from({y:520},_.default.PRELOADER_TIME,y.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.table[0])).from({x:-70},300,y.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.table[1])).from({x:-70},300,y.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.table[2])).from({x:-70},300,y.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.table[3])).from({x:-70},300,y.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.table[4])).from({x:870},300,y.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.table[5])).from({x:870},300,y.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.table[6])).from({x:870},300,y.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.table[7])).from({x:870},300,y.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.textQuarter1)).from({x:-70},_.default.PRELOADER_TIME-50,y.Easing.Back.Out,!1,50),t.start(),(t=this.game.add.tween(this.table[8])).from({x:-70},400,y.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.table[9])).from({x:-70},400,y.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.textQuarter2)).from({x:870},_.default.PRELOADER_TIME-50,y.Easing.Back.Out,!1,50),t.start(),(t=this.game.add.tween(this.table[10])).from({x:870},400,y.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.table[11])).from({x:870},400,y.Easing.Back.Out),t.start(),(t=this.game.add.tween(this.textSemi1)).from({x:-70},_.default.PRELOADER_TIME-100,y.Easing.Back.Out,!1,100),t.start(),(t=this.game.add.tween(this.table[12])).from({x:-70},_.default.PRELOADER_TIME-100,y.Easing.Back.Out,!1,100),t.start(),(t=this.game.add.tween(this.textSemi2)).from({x:870},_.default.PRELOADER_TIME-100,y.Easing.Back.Out,!1,100),t.start(),(t=this.game.add.tween(this.table[13])).from({x:870},_.default.PRELOADER_TIME-100,y.Easing.Back.Out,!1,100),t.start(),(t=this.game.add.tween(this.textFinal)).from({y:-70},_.default.PRELOADER_TIME-150,y.Easing.Back.Out,!1,150),t.start(),(t=this.game.add.tween(this.table[14])).from({y:-70},_.default.PRELOADER_TIME-100,y.Easing.Back.Out,!1,100),t.start(),(t=this.game.add.tween(this.text3rdPlace)).from({y:550},_.default.PRELOADER_TIME-50,y.Easing.Back.Out,!1,50),t.start(),(t=this.game.add.tween(this.table[15])).from({y:550},_.default.PRELOADER_TIME-100,y.Easing.Back.Out,!1,100),t.start()},m.prototype.hide=function(){var t=this.game.add.tween(this.logo);t.to({alpha:.001},_.default.PRELOADER_TIME),t.start(),(t=this.game.add.tween(this.logo)).to({y:-60},_.default.PRELOADER_TIME,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.playBtn)).to({y:520},_.default.PRELOADER_TIME,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.backBtn)).to({y:520},_.default.PRELOADER_TIME,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.table[0])).to({x:-70},300,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.table[1])).to({x:-70},300,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.table[2])).to({x:-70},300,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.table[3])).to({x:-70},300,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.table[4])).to({x:870},300,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.table[5])).to({x:870},300,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.table[6])).to({x:870},300,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.table[7])).to({x:870},300,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.textQuarter1)).to({x:-70},_.default.PRELOADER_TIME-50,y.Easing.Linear.None,!1,50),t.start(),(t=this.game.add.tween(this.table[8])).to({x:-70},_.default.PRELOADER_TIME,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.table[9])).to({x:-70},_.default.PRELOADER_TIME,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.textQuarter2)).to({x:870},_.default.PRELOADER_TIME-50,y.Easing.Linear.None,!1,50),t.start(),(t=this.game.add.tween(this.table[10])).to({x:870},_.default.PRELOADER_TIME,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.table[11])).to({x:870},_.default.PRELOADER_TIME,y.Easing.Linear.None),t.start(),(t=this.game.add.tween(this.textSemi1)).to({x:-70},_.default.PRELOADER_TIME-100,y.Easing.Linear.None,!1,100),t.start(),(t=this.game.add.tween(this.table[12])).to({x:-70},_.default.PRELOADER_TIME-100,y.Easing.Linear.None,!1,100),t.start(),(t=this.game.add.tween(this.textSemi2)).to({x:870},_.default.PRELOADER_TIME-100,y.Easing.Linear.None,!1,100),t.start(),(t=this.game.add.tween(this.table[13])).to({x:870},_.default.PRELOADER_TIME-100,y.Easing.Linear.None,!1,100),t.start(),(t=this.game.add.tween(this.textFinal)).to({y:-70},_.default.PRELOADER_TIME-50,y.Easing.Linear.None,!1,50),t.start(),(t=this.game.add.tween(this.table[14])).to({y:-70},_.default.PRELOADER_TIME-100,y.Easing.Linear.None,!1,100),t.start(),(t=this.game.add.tween(this.text3rdPlace)).to({y:550},_.default.PRELOADER_TIME-150,y.Easing.Linear.None,!1,150),t.start(),(t=this.game.add.tween(this.table[15])).to({y:550},_.default.PRELOADER_TIME-100,y.Easing.Linear.None,!1,100),t.start()},m.prototype.createButtons=function(){for(var t,e=this.game.cache.getJSON(a.JSONData.Players),i=1;i<17;i++){var n=e["match"+i].x,r=e["match"+i].y,s="",o={font:"12px Impact2",fill:"#FFFFFF"};if(this.createButton(n,r),9===i||11===i?(s="QUARTERFINAL",11===i?n+=-2:n-=5):13===i||14===i?(s="SEMIFINAL",13===i?n+=22:n-=25):16===i?s="3rd PLACE MATCH":15===i&&(s="FINAL",o={font:"14px Impact2",fill:"#FF9900"}),""!==s)switch(t=new h.default(this.game,s,o,null,null,a.Atlases.Interface),t.setFrames("bg0000","bg0000","bg0000","bg0000"),t.x=n,t.y=r-58,this.backgroundBase2.addChild(t),i){case 9:this.textQuarter1=t;break;case 11:this.textQuarter2=t;break;case 13:this.textSemi1=t;break;case 14:this.textSemi2=t;break;case 15:this.textFinal=t;break;case 16:this.text3rdPlace=t}}},m.prototype.createButton=function(t,e){var i=new c.MatchPanelResult;i.x=t,i.y=e,this.backgroundBase2.addChild(i),this.table.push(i)},m.prototype.setUp=function(){var t=d.Inventory.instance.tournament.state;0===t?this.fillStandings(8,0):1===t?this.fillStandings(12,8):2===t?this.fillStandings(14,12):this.fillStandings(16,14)},m.prototype.fillStandings=function(t,e){for(var i=this.manager.tournament.rounds,n=this.manager.tournament.results,r=this.manager.tournament.team,s=this.manager.tournament.teamRound+1,o=0;o<this.table.length;o++){var a,l,p=this.table[o],h=o+1;h<=t&&(a=i[h-1][0],l=i[h-1][1],p.setEmblems(a,l),r!==a&&r!==l||p.setBG(2),h===s&&p.setBG(3),h<=e&&(p.ccc.text=""+n[h-1][0],p.ccc2.text=""+n[h-1][1]))}},m.prototype.onBack=function(){o.default.getInstance().play(a.Sounds.Click),new p.default(this.game,this,u.default.Name)},m.prototype.onPlay=function(){o.default.getInstance().play(a.Sounds.Click),new p.default(this.game,this,f.Gameplay.Name)},m.prototype.resize=function(){var t=1;t=1<(t=this.game.width/a.Constants.WIDTH)?1:t,t*=1.33333,this.backgroundBase.scale.set(t),this.backgroundBase.alignIn(this.world.bounds,Phaser.TOP_CENTER),this.backgroundBaseMask.scale.set(t,t),this.backgroundBaseMask.x=this.backgroundBase.x,this.backgroundBaseMask.y=this.backgroundBase.y,s.prototype.resize.call(this)},m.prototype.shutdown=function(){this.backgroundBase2=null,this.backgroundBaseMask=null,this.backBtn=null,this.playBtn=null,s.prototype.shutdown.call(this)},m.Name="tournamentstate",m);function m(){var t=s.call(this)||this;return t.name=m.Name,t.table=[],t.manager=null,t}e.default=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s,o=i(3),a=i(1),l=i(9),r=(s=Phaser.Group,r(p,s),p.prototype.setEmblems=function(t,e){t=this.game.add.image(-30,-21,a.Atlases.Interface,"Emblems00"+(t-1<10?"0":"")+(t-1)),e=this.game.add.image(-30,17,a.Atlases.Interface,"Emblems00"+(e-1<10?"0":"")+(e-1));t.anchor.set(.5),e.anchor.set(.5),t.scale.set(.15),e.scale.set(.15),this.addChild(t),this.addChild(e)},p.prototype.setBG=function(t){this.bg.loadTexture(a.Atlases.Interface,"MatchBack000"+(t-1))},p);function p(){var t=s.call(this,o.default.game)||this;t.bg=t.game.add.sprite(0,0,a.Atlases.Interface,"MatchBack0000"),t.bg.anchor.set(.5),t.addChild(t.bg);var e={font:"bold 24px Impact2",fill:"#FFFFFF"};return t.ccc=new l.default(t.game,30,-22,"-",e),t.ccc.anchor.set(.5),t.addChild(t.ccc),t.ccc2=new l.default(t.game,30,22,"-",e),t.ccc2.anchor.set(.5),t.addChild(t.ccc2),t.team1=t.game.add.image(-30,-21,a.Atlases.Interface,"emptyBg0000"),t.team1.anchor.set(.5),t.addChild(t.team1),t.team2=t.game.add.image(-30,17,a.Atlases.Interface,"emptyBg0000"),t.team2.anchor.set(.5),t.addChild(t.team2),t}e.MatchPanelResult=r}]),window.GD_OPTIONS={gameId:"null",onEvent:function(t){switch(t.name){case"START":spEvent("START");break;case"PAUSE":spEvent("PAUSE");break;case"SDK_GDPR_TRACKING":console.log("SDK_GDPR_TRACKING");break;case"SDK_GDPR_TARGETING":console.log("SDK_GDPR_TARGETING");break;case"SDK_READY":console.log("SDK_READY")}}};
